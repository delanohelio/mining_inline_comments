{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTgwMTE2", "number": 1019, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMToxNzo0MVrOD5Kx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMToyNjo1MFrOD5K9qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjcyMDQ0OnYy", "diffSide": "RIGHT", "path": "fhir-server/src/main/java/com/ibm/fhir/server/filter/rest/FHIRRestServletFilter.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMToxNzo0MVrOGQSjIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMjo0OTowMFrOGQnxwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczNDMwNw==", "bodyText": "should this be FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId + \"/multitenant\"?", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r419734307", "createdAt": "2020-05-04T21:17:41Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/filter/rest/FHIRRestServletFilter.java", "diffHunk": "@@ -134,6 +134,15 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n                 if (tenantKey != null) {\n                     context.setTenantKey(tenantKey);\n                 }\n+\n+                String type = dsPG.getStringProperty(\"type\", null);\n+                if (type != null) {\n+                    // Based on the default for the database type, the code.\n+                    Boolean enabled =\n+                            FHIRConfigHelper.getBooleanProperty(\"multitenant\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NzQ4Mw==", "bodyText": "where dsId is the \"datastoreId\" which can be looked up from the request context", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r419747483", "createdAt": "2020-05-04T21:44:25Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/filter/rest/FHIRRestServletFilter.java", "diffHunk": "@@ -134,6 +134,15 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n                 if (tenantKey != null) {\n                     context.setTenantKey(tenantKey);\n                 }\n+\n+                String type = dsPG.getStringProperty(\"type\", null);\n+                if (type != null) {\n+                    // Based on the default for the database type, the code.\n+                    Boolean enabled =\n+                            FHIRConfigHelper.getBooleanProperty(\"multitenant\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczNDMwNw=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc4OTI1Mw==", "bodyText": "right. this is the pattern from the XA Datasource", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r419789253", "createdAt": "2020-05-04T23:36:19Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/filter/rest/FHIRRestServletFilter.java", "diffHunk": "@@ -134,6 +134,15 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n                 if (tenantKey != null) {\n                     context.setTenantKey(tenantKey);\n                 }\n+\n+                String type = dsPG.getStringProperty(\"type\", null);\n+                if (type != null) {\n+                    // Based on the default for the database type, the code.\n+                    Boolean enabled =\n+                            FHIRConfigHelper.getBooleanProperty(\"multitenant\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczNDMwNw=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MjExMw==", "bodyText": "resolved", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420082113", "createdAt": "2020-05-05T12:49:00Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/filter/rest/FHIRRestServletFilter.java", "diffHunk": "@@ -134,6 +134,15 @@ public void doFilter(HttpServletRequest request, HttpServletResponse response, F\n                 if (tenantKey != null) {\n                     context.setTenantKey(tenantKey);\n                 }\n+\n+                String type = dsPG.getStringProperty(\"type\", null);\n+                if (type != null) {\n+                    // Based on the default for the database type, the code.\n+                    Boolean enabled =\n+                            FHIRConfigHelper.getBooleanProperty(\"multitenant\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczNDMwNw=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjc1MDQ5OnYy", "diffSide": "RIGHT", "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "isResolved": true, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMToyNjo1MFrOGQS1Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDozNToyNVrOGQscMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ==", "bodyText": "trying to decide if we want this here...I guess is the idea is its similar to the tenantKey so put it in the same spot?\nthat one made sense to me because it was already here, but I'm not sure if we want to keep adding stuff to the requestcontext.  can we keep it isolated to just the FHIRDbDAOImpl?", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r419738931", "createdAt": "2020-05-04T21:26:50Z", "author": {"login": "lmsurpre"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc4OTE3Ng==", "bodyText": "I think it makes sense here. it maintains state, and keeps the DAO somewhat stateless", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r419789176", "createdAt": "2020-05-04T23:36:01Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA4MTUyOQ==", "bodyText": "I guess I was thinking we could look up the config property where its needed without storing it as state anywhere.  It didn't seem to be used from anywhere other than FHIRDbDAOImpl.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420081529", "createdAt": "2020-05-05T12:48:03Z", "author": {"login": "lmsurpre"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMDMyNg==", "bodyText": "You end up looking up the property group again, and processing again.  Wouldn't it be good to pick it off one time?", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420110326", "createdAt": "2020-05-05T13:31:10Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzNTU1NQ==", "bodyText": "We do have caching for the config and I think its consistent with other places that read the config whenever we need a config value.\nThat said, if we're calling it over and over then maybe you're right...do we call getConnection() a lot of times during a typical create/update request?", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420135555", "createdAt": "2020-05-05T14:05:05Z", "author": {"login": "lmsurpre"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzOTM5OA==", "bodyText": "While that is true, the config is still navigated down the tree to the property, versus a point lookup.\nIn general it's called in multiple spots, but if it's cached in memory (resourceType, parameterName et cetra it shouldn't hit that point), but it is referenced in a lot of places with many different paths.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420139398", "createdAt": "2020-05-05T14:10:18Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE0NzIzOA==", "bodyText": "OK, I think its probably fine either way.  Would like to hear from @JohnTimm and @albertwang-ibm in terms of preference, but I think I'm good with whatever the group decides.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420147238", "createdAt": "2020-05-05T14:20:42Z", "author": {"login": "lmsurpre"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1ODA2OQ==", "bodyText": "I don\u2019t have a strong opinion either way but if tenantId and dsId are already in the FHIRRequestContext then adding a derived field for convenience doesn\u2019t bother me.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420158069", "createdAt": "2020-05-05T14:34:49Z", "author": {"login": "JohnTimm"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1ODMxMQ==", "bodyText": "I would agree with Paul's current codes.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420158311", "createdAt": "2020-05-05T14:35:05Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1ODUxNQ==", "bodyText": "OK, marking it resolved then.  Thanks for weighing in.", "url": "https://github.com/IBM/FHIR/pull/1019#discussion_r420158515", "createdAt": "2020-05-05T14:35:25Z", "author": {"login": "lmsurpre"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRRequestContext.java", "diffHunk": "@@ -33,6 +33,8 @@\n     private String tenantId;\n     private String tenantKey;\n     private String dataStoreId;\n+    // By default, setting to False.\n+    private Boolean dataStoreMultiTenant = Boolean.FALSE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczODkzMQ=="}, "originalCommit": {"oid": "878ca838b2ada1bb953fa17feabf5d6802a2d18a"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 39, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}