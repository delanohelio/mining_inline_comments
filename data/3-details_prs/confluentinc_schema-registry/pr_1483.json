{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMwODI0NTYy", "number": 1483, "title": "Telemetry reporter integration", "bodyText": "Integrates the new Confluent TelemetryReporter into the Schema Registry. Includes integration test to verify end-to-end flow.", "createdAt": "2020-06-08T06:50:50Z", "url": "https://github.com/confluentinc/schema-registry/pull/1483", "merged": true, "mergeCommit": {"oid": "db392ba5917e19a7c4faff350d99e178ec84563e"}, "closed": true, "closedAt": "2020-06-16T23:26:29Z", "author": {"login": "dragosvictor"}, "timelineItems": {"totalCount": 51, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchaqd5AH2gAyNDMwODI0NTYyOjI5MjkyZjhhNWNjNGUyZDYyMDc5MGVjMTdhOWE2OWZkNGRmNTNkNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsh7vOAFqTQzMzUwMTAxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29292f8a5cc4e2d620790ec17a9a69fd4df53d5b", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/29292f8a5cc4e2d620790ec17a9a69fd4df53d5b", "committedDate": "2020-05-15T04:49:30Z", "message": "Telemetry reporter (#1454)\n\n* Add metricscontext. Depend on kafka-ce until KIP is merged.\r\n\r\n* Add namespace.\r\n\r\n* Move test from ce-kafka.\r\n\r\n* Clean up.\r\n\r\nCo-authored-by: Sumit Arrawatia <sumit.arrawatia@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4084d59abe38ad605db77391e9d8380ffa122970", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/4084d59abe38ad605db77391e9d8380ffa122970", "committedDate": "2020-05-15T05:46:36Z", "message": "Fix build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "072cfa79f7b6e264942d2bce8e9119e3d61f48b6", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/072cfa79f7b6e264942d2bce8e9119e3d61f48b6", "committedDate": "2020-05-18T23:54:33Z", "message": "Merge branch 'master' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6501a38195da8c1923aaea5d3efaca08e878f25", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/a6501a38195da8c1923aaea5d3efaca08e878f25", "committedDate": "2020-05-19T01:25:10Z", "message": "Fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b8dddab273f904c44e9190fa277ee7e3f68ee13", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/8b8dddab273f904c44e9190fa277ee7e3f68ee13", "committedDate": "2020-05-21T00:11:16Z", "message": "Merge branch 'master' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2fd0837e0dcfc312e4148767af1453726b9a8bb", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/d2fd0837e0dcfc312e4148767af1453726b9a8bb", "committedDate": "2020-05-22T20:34:59Z", "message": "Implement Schema Registry metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b71c7868aae5b9f69441a0891f124aae7c4130c", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/2b71c7868aae5b9f69441a0891f124aae7c4130c", "committedDate": "2020-05-22T20:37:30Z", "message": "Merge branch 'master' into schema-registry-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6feb5af9758e4bf6b7ec264d169079f7d117ff4a", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/6feb5af9758e4bf6b7ec264d169079f7d117ff4a", "committedDate": "2020-05-22T23:13:32Z", "message": "Use try-with-resources in getCommitId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed8b5691195cade94491bc1920c95632589fcb2e", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/ed8b5691195cade94491bc1920c95632589fcb2e", "committedDate": "2020-05-23T00:18:20Z", "message": "Minor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58b4e891c48d80d34726a1a8b2d968d92c15f882", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/58b4e891c48d80d34726a1a8b2d968d92c15f882", "committedDate": "2020-05-23T01:31:07Z", "message": "Fix spotbugs errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b857a6af0d2c2683987117d9df998df3f2e516e", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/4b857a6af0d2c2683987117d9df998df3f2e516e", "committedDate": "2020-05-23T17:44:59Z", "message": "Merge branch 'master' into schema-registry-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "363bf8dfbbc042d10155b9a9ba48b515eb1ed4b8", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/363bf8dfbbc042d10155b9a9ba48b515eb1ed4b8", "committedDate": "2020-05-25T05:37:41Z", "message": "Merge branch 'schema-registry-metrics' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d415fcbc67acaa1f55374ad6d674e33b18331449", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/d415fcbc67acaa1f55374ad6d674e33b18331449", "committedDate": "2020-05-25T07:10:09Z", "message": "Merge fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb5a412302abe04ab05c237da9d82b5e0d410472", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/eb5a412302abe04ab05c237da9d82b5e0d410472", "committedDate": "2020-05-25T11:14:39Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "626bd7117994f4728e46b00e6e8a0a873922550c", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/626bd7117994f4728e46b00e6e8a0a873922550c", "committedDate": "2020-05-25T11:21:37Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a07b790e19914b025ff8e23a16120439f389adc", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/8a07b790e19914b025ff8e23a16120439f389adc", "committedDate": "2020-05-25T11:52:20Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb441c623e31c3ac1280db5844b2cdaa453ab583", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/eb441c623e31c3ac1280db5844b2cdaa453ab583", "committedDate": "2020-05-26T23:09:02Z", "message": "Remove redundant configs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b619b03ce80ddf0436b4da7030a41036cc83334", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/8b619b03ce80ddf0436b4da7030a41036cc83334", "committedDate": "2020-05-27T02:27:24Z", "message": "Merge branch 'master' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f0937b242e61aa612b1274e112f3387e5596e07", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/7f0937b242e61aa612b1274e112f3387e5596e07", "committedDate": "2020-05-27T02:48:20Z", "message": "Fix checkstyle issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ea081cb089493237a354be2191ed5beac52283", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/75ea081cb089493237a354be2191ed5beac52283", "committedDate": "2020-05-28T01:52:42Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd7bf03997f67b68788b124900ec7ad58824657c", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/dd7bf03997f67b68788b124900ec7ad58824657c", "committedDate": "2020-06-08T04:41:38Z", "message": "Fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed149443dda3b6363c97fbb8cfa4910dcb79db80", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/ed149443dda3b6363c97fbb8cfa4910dcb79db80", "committedDate": "2020-06-08T04:55:59Z", "message": "Cleanup integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbaec4b001a9c413fef40d51555994234ca2d065", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/fbaec4b001a9c413fef40d51555994234ca2d065", "committedDate": "2020-06-08T05:15:25Z", "message": "Move getCommitId to separate AppInfoParser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74531ecb6f0d70102b5deeef5b1ed365ab41f15a", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/74531ecb6f0d70102b5deeef5b1ed365ab41f15a", "committedDate": "2020-06-08T05:25:48Z", "message": "Spotbugs fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "930087960714f7aba1da57c2af05ee7fc82d365d", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/930087960714f7aba1da57c2af05ee7fc82d365d", "committedDate": "2020-06-08T05:29:22Z", "message": "Assert SR version in integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43d81a3e2349550f88662d0253fbff8358bc0739", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/43d81a3e2349550f88662d0253fbff8358bc0739", "committedDate": "2020-06-08T05:32:41Z", "message": "Merge branch 'master' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8018ec87bb7e173756106da4851edbebcb032e1", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/f8018ec87bb7e173756106da4851edbebcb032e1", "committedDate": "2020-06-08T05:49:03Z", "message": "Cleanup AppInfoParser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63e297b80bd55b2ab6dee9cd91912eaebc4d274a", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/63e297b80bd55b2ab6dee9cd91912eaebc4d274a", "committedDate": "2020-06-08T06:07:17Z", "message": "Further cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336d4f425fe77b3e90d42cdbbd3ea9ef78f9efc7", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/336d4f425fe77b3e90d42cdbbd3ea9ef78f9efc7", "committedDate": "2020-06-08T06:21:11Z", "message": "Send metrics from master node only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52b330c719b6c0e94582fa5c47c6b1ddb0be3de1", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/52b330c719b6c0e94582fa5c47c6b1ddb0be3de1", "committedDate": "2020-06-08T06:24:20Z", "message": "Move TelemetryReporterTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a8cef5a7d3fb3f4492c854435be6974a9bf3ea4", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/0a8cef5a7d3fb3f4492c854435be6974a9bf3ea4", "committedDate": "2020-06-08T06:47:07Z", "message": "POM cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "322416d394035064918bd3f0386144245638d2ac", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/322416d394035064918bd3f0386144245638d2ac", "committedDate": "2020-06-08T18:42:34Z", "message": "Fix checkstyle error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36567eccb6c374eb482f02c07d7882f12eac14d7", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/36567eccb6c374eb482f02c07d7882f12eac14d7", "committedDate": "2020-06-08T22:27:42Z", "message": "Factor out TelemetryReporter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjkwNDAy", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-426690402", "createdAt": "2020-06-08T23:33:05Z", "commit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzozMzowNlrOGgz1EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzo0MDoxNFrOGgz9Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1Njc4NA==", "bodyText": "Can this be removed?", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r437056784", "createdAt": "2020-06-08T23:33:06Z", "author": {"login": "rayokota"}, "path": "pom.xml", "diffHunk": "@@ -81,6 +81,7 @@\n         <wire.version>3.1.0</wire.version>\n         <swagger.version>1.6.0</swagger.version>\n         <spotbugs.plugin.version>4.0.0</spotbugs.plugin.version>\n+        <kafka.version>6.0.0-ce-SNAPSHOT</kafka.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1ODE0OA==", "bodyText": "Can we move the logic in the line above to setLeader?", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r437058148", "createdAt": "2020-06-08T23:37:52Z", "author": {"login": "rayokota"}, "path": "core/src/main/java/io/confluent/kafka/schemaregistry/storage/KafkaSchemaRegistry.java", "diffHunk": "@@ -371,6 +371,7 @@ public void setLeader(@Nullable SchemaRegistryIdentity newLeader)\n         idGenerator.init();\n       }\n       metricsContainer.isLeader().set(isLeader() ? 1 : 0);\n+      metricsContainer.setLeader(isLeader());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1ODgyMg==", "bodyText": "Where is this used?", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r437058822", "createdAt": "2020-06-08T23:40:14Z", "author": {"login": "rayokota"}, "path": "core/src/test/java/io/confluent/kafka/schemaregistry/RestApp.java", "diffHunk": "@@ -67,6 +66,8 @@ public RestApp(int port,\n     prop.put(SchemaRegistryConfig.KAFKASTORE_TOPIC_CONFIG, kafkaTopic);\n     prop.put(SchemaRegistryConfig.SCHEMA_COMPATIBILITY_CONFIG, compatibilityType);\n     prop.put(SchemaRegistryConfig.LEADER_ELIGIBILITY, leaderEligibility);\n+\n+    prop.put(\"metrics.jmx.prefix\", \"kafka.schema.registry\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Njk3MDY0", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-426697064", "createdAt": "2020-06-08T23:51:10Z", "commit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzo1MToxMFrOGg0JeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzo1MToxMFrOGg0JeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA2MjAwOQ==", "bodyText": "note, we switched all labels to be lowercase by default", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r437062009", "createdAt": "2020-06-08T23:51:10Z", "author": {"login": "xvrl"}, "path": "core/src/main/java/io/confluent/kafka/schemaregistry/metrics/MetricsContainer.java", "diffHunk": "@@ -174,21 +202,15 @@ private SchemaRegistryMetric getSchemaTypeMetric(String type, boolean isRegister\n     }\n   }\n \n-  private static String getCommitId() {\n-    final String defaultValue = \"Unknown\";\n-\n-    String fileName = \"/schema-registry-app.properties\";\n-    try (InputStream propFile = MetricsContainer.class.getResourceAsStream(fileName)) {\n-      if (propFile != null) {\n-        Properties props = new Properties();\n-        props.load(propFile);\n-        return props.getProperty(\"application.commitId\", defaultValue).trim();\n-      } else {\n-        log.error(\"Cannot find properties file\");\n-      }\n-    } catch (IOException e) {\n-      log.warn(\"Cannot parse properties file\", e);\n-    }\n-    return defaultValue;\n+  @NotNull\n+  private static MetricsContext getMetricsContext(SchemaRegistryConfig config) {\n+    Map<String, Object> metadata =\n+            true ? config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX) :\n+                    config.originals();\n+    metadata.put(RESOURCE_LABEL_TYPE,  \"SCHEMAREGISTRY\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "322416d394035064918bd3f0386144245638d2ac"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d02be3c26f6558a0971079bb07ba67639d7c167", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/6d02be3c26f6558a0971079bb07ba67639d7c167", "committedDate": "2020-06-09T00:38:04Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e487c0e3a5e6e9ae1af0144e4abade91a8c9f0", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/d0e487c0e3a5e6e9ae1af0144e4abade91a8c9f0", "committedDate": "2020-06-09T00:48:25Z", "message": "Use lowercase resource label type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af6cf5f5a1ef3749162926d5ace3f2568f07d59b", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/af6cf5f5a1ef3749162926d5ace3f2568f07d59b", "committedDate": "2020-06-09T00:57:48Z", "message": "Refactor isLeader metric"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd7f5f860c436fa2490f1ec1b8333d9d623dc02", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/9fd7f5f860c436fa2490f1ec1b8333d9d623dc02", "committedDate": "2020-06-09T01:10:24Z", "message": "Remove extra property in RestApp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5f5ff1fa62e80c7c2f61c8552b040425d003cd8", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/c5f5ff1fa62e80c7c2f61c8552b040425d003cd8", "committedDate": "2020-06-11T06:49:32Z", "message": "Setup correct cluster ID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38c1ad564f2ae53a15f25651c3469f5959399cc6", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/38c1ad564f2ae53a15f25651c3469f5959399cc6", "committedDate": "2020-06-12T03:02:41Z", "message": "Remove CE dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85dbcfbf8cc01e2816774b3bb73b7b42667211bd", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/85dbcfbf8cc01e2816774b3bb73b7b42667211bd", "committedDate": "2020-06-12T03:03:29Z", "message": "Add telemetry configs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/b84b58a701ce7c6d676b40da660ada00e3e846d8", "committedDate": "2020-06-12T03:03:50Z", "message": "Fix integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODk5NTcy", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-429899572", "createdAt": "2020-06-12T16:58:44Z", "commit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODM5MTUx", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-430839151", "createdAt": "2020-06-15T17:13:45Z", "commit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzoxMzo0NVrOGj7Urw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzoxMzo0NVrOGj7Urw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNTI5NQ==", "bodyText": "If we use this Metrics constructor:\nhttps://github.com/confluentinc/ce-kafka/blob/d6ecf6a2d2d34c7fbea13880dea51585f87c7122/clients/src/main/java/org/apache/kafka/common/metrics/Metrics.java#L132\nThen there is no need to do the iteration here.", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r440325295", "createdAt": "2020-06-15T17:13:45Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/java/io/confluent/kafka/schemaregistry/leaderelector/kafka/KafkaGroupLeaderElector.java", "diffHunk": "@@ -97,8 +99,11 @@ public KafkaGroupLeaderElector(SchemaRegistryConfig config,\n           CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG,\n           MetricsReporter.class\n       );\n-      reporters.add(new JmxReporter(JMX_PREFIX));\n-\n+      reporters.add(new JmxReporter());\n+      for (MetricsReporter reporter : reporters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODQ3NjQ2", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-430847646", "createdAt": "2020-06-15T17:25:27Z", "commit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzoyNToyN1rOGj7uIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzoyNToyN1rOGj7uIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMTgxMA==", "bodyText": "since this is a public repo, I don't think we can depend on proprietary jars", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r440331810", "createdAt": "2020-06-15T17:25:27Z", "author": {"login": "xvrl"}, "path": "core/pom.xml", "diffHunk": "@@ -215,6 +215,11 @@\n             <groupId>io.swagger</groupId>\n             <artifactId>swagger-core</artifactId>\n         </dependency>\n+        <dependency>\n+            <groupId>io.confluent</groupId>\n+            <artifactId>confluent-metrics</artifactId>\n+            <version>${ce.kafka.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84b58a701ce7c6d676b40da660ada00e3e846d8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "926e52c155d013793c8579cc42234a0128610d5b", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/926e52c155d013793c8579cc42234a0128610d5b", "committedDate": "2020-06-16T02:20:24Z", "message": "Skip contextChange calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdc9d62666565321e55a424e269bb94eda9f7512", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/bdc9d62666565321e55a424e269bb94eda9f7512", "committedDate": "2020-06-16T03:52:08Z", "message": "Remove CE dependency at compile time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "099c2fceeff6f10bb0338b5928f6e0182ca07df6", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/099c2fceeff6f10bb0338b5928f6e0182ca07df6", "committedDate": "2020-06-16T16:10:43Z", "message": "Merge branch '6.0.x' into telemetry-reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a26ec18af179fc077e3725064e3e49d0abbbe26a", "author": {"user": {"login": "dragosvictor", "name": "Dragos Misca"}}, "url": "https://github.com/confluentinc/schema-registry/commit/a26ec18af179fc077e3725064e3e49d0abbbe26a", "committedDate": "2020-06-16T17:01:31Z", "message": "Remove CE dependency and integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTAxMDE0", "url": "https://github.com/confluentinc/schema-registry/pull/1483#pullrequestreview-433501014", "createdAt": "2020-06-18T17:30:51Z", "commit": {"oid": "a26ec18af179fc077e3725064e3e49d0abbbe26a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzozMDo1MlrOGl5W5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzozMDo1MlrOGl5W5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM5MDI0Ng==", "bodyText": "For components that are tied to a specific kafka cluster, we split out the tags rather than combining them. i.e. for connect to we use the group id as the cluster.id, and we add a nother tag or the kafka cluster id.\nThis matches the nomenclature we use to identify a cluster when defining RBAC permissions.", "url": "https://github.com/confluentinc/schema-registry/pull/1483#discussion_r442390246", "createdAt": "2020-06-18T17:30:52Z", "author": {"login": "xvrl"}, "path": "core/src/main/java/io/confluent/kafka/schemaregistry/metrics/MetricsContainer.java", "diffHunk": "@@ -174,21 +198,41 @@ private SchemaRegistryMetric getSchemaTypeMetric(String type, boolean isRegister\n     }\n   }\n \n-  private static String getCommitId() {\n-    final String defaultValue = \"Unknown\";\n+  private static List<String> getMetricReporterConfig(SchemaRegistryConfig config) {\n+    List<String> classes = new ArrayList<>(config.getList(\n+            ProducerConfig.METRIC_REPORTER_CLASSES_CONFIG));\n+    try {\n+      if (!classes.contains(TELEMETRY_REPORTER_CLASS)) {\n+        Class.forName(TELEMETRY_REPORTER_CLASS);\n+        classes.add(TELEMETRY_REPORTER_CLASS);\n+      }\n+    } catch (ClassNotFoundException cnfe) {\n+      // Ignore\n+    }\n+    return classes;\n+  }\n \n-    String fileName = \"/schema-registry-app.properties\";\n-    try (InputStream propFile = MetricsContainer.class.getResourceAsStream(fileName)) {\n-      if (propFile != null) {\n-        Properties props = new Properties();\n-        props.load(propFile);\n-        return props.getProperty(\"application.commitId\", defaultValue).trim();\n-      } else {\n-        log.error(\"Cannot find properties file\");\n+  private static MetricsReporter getTelemetryReporter(List<MetricsReporter> reporters) {\n+    for (MetricsReporter reporter : reporters) {\n+      if (reporter.getClass().getName().equals(TELEMETRY_REPORTER_CLASS)) {\n+        return reporter;\n       }\n-    } catch (IOException e) {\n-      log.warn(\"Cannot parse properties file\", e);\n     }\n-    return defaultValue;\n+    return null;\n+  }\n+\n+  private static MetricsContext getMetricsContext(SchemaRegistryConfig config,\n+                                                  String kafkaClusterId) {\n+    Map<String, Object> metadata =\n+            config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX);\n+\n+    String clusterId = String.format(\"%s-%s\", kafkaClusterId,\n+            config.getString(SchemaRegistryConfig.SCHEMAREGISTRY_GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a26ec18af179fc077e3725064e3e49d0abbbe26a"}, "originalPosition": 154}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4483, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}