{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNjE0NjYx", "number": 1006, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowNDoyOFrOFCUiBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozNjoyOVrOFCVu5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTc3ODYxOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/main/java/module-info.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowNDoyOFrOIBZ6Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjoyNzozMlrOIBneJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NDAzOA==", "bodyText": "Why are these needed?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538344038", "createdAt": "2020-12-08T13:04:28Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/module-info.java", "diffHunk": "@@ -50,6 +50,8 @@\n     requires spring.core;\n     requires spring.security.oauth2;\n     requires spring.web;\n+    requires reactor.netty;\n+    requires io.netty.handler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NjE4Mg==", "bodyText": "Error occurred during initialization of boot layer\njava.lang.module.FindException: Module reactor.netty not found, required by com.sap.cloudfoundry.client.facade\nThey are required as far as I understood", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538566182", "createdAt": "2020-12-08T16:27:32Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/main/java/module-info.java", "diffHunk": "@@ -50,6 +50,8 @@\n     requires spring.core;\n     requires spring.security.oauth2;\n     requires spring.web;\n+    requires reactor.netty;\n+    requires io.netty.handler;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NDAzOA=="}, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTc5ODUwOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowNzozNFrOIBaGpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjoyNzozNlrOIBneXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NzE3NA==", "bodyText": "Can appArchiveId be retrieved in this method instead of passing it as a parameter?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538347174", "createdAt": "2020-12-08T13:07:34Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());\n+        return client.createDockerPackage(applicationGuid, application.getDockerInfo());\n+    }\n+\n+    private String getNewApplicationDigest(ProcessContext context, String appArchiveId, String fileName) throws FileStorageException {\n+        return fileService.processFileContent(context.getVariable(Variables.SPACE_GUID), appArchiveId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NjIzOQ==", "bodyText": "Yes, it can.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538566239", "createdAt": "2020-12-08T16:27:36Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());\n+        return client.createDockerPackage(applicationGuid, application.getDockerInfo());\n+    }\n+\n+    private String getNewApplicationDigest(ProcessContext context, String appArchiveId, String fileName) throws FileStorageException {\n+        return fileService.processFileContent(context.getVariable(Variables.SPACE_GUID), appArchiveId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NzE3NA=="}, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTg3NTUzOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoyMDoxMVrOIBa4Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjoyNzozOFrOIBnenA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1OTg0Mw==", "bodyText": "If I understand correctly, this flow means that there isn't a file entry in the MTAR associated with this module because it is described as a docker application, is this right?\nIf so, how did we operate with docker apps so far?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538359843", "createdAt": "2020-12-08T13:20:11Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -63,17 +64,21 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n \n         MtaArchiveElements mtaArchiveElements = context.getVariable(Variables.MTA_ARCHIVE_ELEMENTS);\n         String moduleFileName = mtaArchiveElements.getModuleFileName(applicationToProcess.getModuleName());\n+        CloudControllerClient client = context.getControllerClient();\n         if (moduleFileName == null) {\n             getStepLogger().debug(Messages.NO_CONTENT_TO_UPLOAD);\n+            if (applicationToProcess.getDockerInfo() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NjMwMA==", "bodyText": "In v2 the docker apps do not require packages, they are just created as docker image apps and started. In v3 it is required to create a docker package to deploy the application. If there is no module name the application is probably a docker app but I added this check just in case if the user does not provide docker parameters otherwise a null pointer will occur.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538566300", "createdAt": "2020-12-08T16:27:38Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -63,17 +64,21 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n \n         MtaArchiveElements mtaArchiveElements = context.getVariable(Variables.MTA_ARCHIVE_ELEMENTS);\n         String moduleFileName = mtaArchiveElements.getModuleFileName(applicationToProcess.getModuleName());\n+        CloudControllerClient client = context.getControllerClient();\n         if (moduleFileName == null) {\n             getStepLogger().debug(Messages.NO_CONTENT_TO_UPLOAD);\n+            if (applicationToProcess.getDockerInfo() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1OTg0Mw=="}, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTg4Mzc1OnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzoyMTozMVrOIBa9Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjoyNzo0MVrOIBnewg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM2MTE2Mw==", "bodyText": "Why isn't the guid in the CloudApplicationExtended object used but a request to the CC is made to fetch the guid?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538361163", "createdAt": "2020-12-08T13:21:31Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NjMzOA==", "bodyText": "Because it set in BuildApplicationDeployModelStep and its guid is unknown -> the id is null.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538566338", "createdAt": "2020-12-08T16:27:41Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM2MTE2Mw=="}, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3OTk3NTQwOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/CreateOrUpdateAppStepTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozNjoyOVrOIBb5gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjoyNzo0NVrOIBnfMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3NjU3Nw==", "bodyText": "Maybe dockerStaging would be more descriptive", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538376577", "createdAt": "2020-12-08T13:36:29Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/CreateOrUpdateAppStepTest.java", "diffHunk": "@@ -92,16 +92,19 @@ void testCreateApplicationFromDockerImage() {\n                                                                                           .password(\"somePassword\")\n                                                                                           .build())\n                                                    .build();\n+        Staging staging = ImmutableStaging.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NjQ0OA==", "bodyText": "Done", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538566448", "createdAt": "2020-12-08T16:27:45Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/CreateOrUpdateAppStepTest.java", "diffHunk": "@@ -92,16 +92,19 @@ void testCreateApplicationFromDockerImage() {\n                                                                                           .password(\"somePassword\")\n                                                                                           .build())\n                                                    .build();\n+        Staging staging = ImmutableStaging.builder()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3NjU3Nw=="}, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 477, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}