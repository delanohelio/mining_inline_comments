{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0ODAyMDE3", "number": 760, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNToyNVrODg-YZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNjowN1rODg-ZEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1OTAzMDc3OnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNToyNVrOFrejPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNToyNVrOFrejPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzMzYzMA==", "bodyText": "\"id\" should be capitalized.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/760#discussion_r381133630", "createdAt": "2020-02-19T08:15:25Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/Messages.java", "diffHunk": "@@ -203,6 +203,8 @@\n     public static final String CREATE_SUPPORT_TICKET_TO_DS_COMPONENT = \"If you think the problem is in the deployment process, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n     public static final String CREATE_SUPPORT_TICKET_TO_SERVICE_BROKER_COMPONENT = \"If you think the problem is in the service broker, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n     public static final String CREATE_SUPPORT_TICKET_TO_CC_COMPONENT = \"If you think the problem is in the controller, please create a support ticket to {0} component \\\"{1}\\\".\";\r\n+    public static final String DELETING_OPERATION_WITH_ID = \"Deleting operation with id \\\"{0}\\\"\";\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb9127bf9ad41914794f4785d1e13bf2c2d15cfc"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1OTAzMjUxOnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/AbortProcessAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNjowN1rOFrekUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoxNjowN1rOFrekUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzMzkwNg==", "bodyText": "This comment is not necessary.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/760#discussion_r381133906", "createdAt": "2020-02-19T08:16:07Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/AbortProcessAction.java", "diffHunk": "@@ -5,31 +5,42 @@\n import javax.inject.Inject;\n import javax.inject.Named;\n \n-import com.sap.cloud.lm.sl.cf.core.model.HistoricOperationEvent;\n+import com.sap.cloud.lm.sl.cf.core.model.HistoricOperationEvent.EventType;\n+import com.sap.cloud.lm.sl.cf.core.persistence.service.OperationService;\n import com.sap.cloud.lm.sl.cf.process.util.HistoricOperationEventPersister;\n-import com.sap.cloud.lm.sl.cf.web.api.model.Operation;\n+import com.sap.cloud.lm.sl.cf.process.util.ProcessConflictPreventer;\n \n @Named\n public class AbortProcessAction extends ProcessAction {\n \n     public static final String ACTION_ID_ABORT = \"abort\";\n-    private final HistoricOperationEventPersister historicOperationEventPersister;\n+\n+    private HistoricOperationEventPersister historicEventPersister;\n+    private OperationService operationService;\n \n     @Inject\n     public AbortProcessAction(FlowableFacade flowableFacade, List<AdditionalProcessAction> additionalProcessActions,\n-                              HistoricOperationEventPersister historicOperationEventPersister) {\n+                              HistoricOperationEventPersister historicEventPersister, OperationService operationService) {\n         super(flowableFacade, additionalProcessActions);\n-        this.historicOperationEventPersister = historicOperationEventPersister;\n+        this.historicEventPersister = historicEventPersister;\n+        this.operationService = operationService;\n     }\n \n     @Override\n     public void executeActualProcessAction(String user, String superProcessInstanceId) {\n-        historicOperationEventPersister.add(superProcessInstanceId, HistoricOperationEvent.EventType.ABORTED);\n-        if (flowableFacade.isProcessInstanceSuspended(superProcessInstanceId)) {\n-            flowableFacade.activateProcessInstance(superProcessInstanceId);\n-        }\n-        // TODO: The Delete Reason won't be indispensable anymore and should be deleted after this version is stable.\n-        flowableFacade.deleteProcessInstance(superProcessInstanceId, Operation.State.ABORTED.name());\n+        flowableFacade.setAbortVariable(superProcessInstanceId);\n+        // Release the lock for the operation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb9127bf9ad41914794f4785d1e13bf2c2d15cfc"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 600, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}