{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzOTE3MjQ0", "number": 897, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowNTozOFrOELLl8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowODowMVrOELLpUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTU5NzMwOnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/health/HealthRetriever.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowNTozOFrOGspc0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowNTozOFrOGspc0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2OTY0OQ==", "bodyText": "Is there a chance that something else is null?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/897#discussion_r449469649", "createdAt": "2020-07-03T09:05:38Z", "author": {"login": "radoslav-d"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/health/HealthRetriever.java", "diffHunk": "@@ -38,15 +39,21 @@ public Health getHealth() {\n         HealthCheckConfiguration healthCheckConfiguration = configuration.getHealthCheckConfiguration();\n         ZonedDateTime currentTime = currentTimeSupplier.get();\n         ZonedDateTime xSecondsAgo = currentTime.minusSeconds(healthCheckConfiguration.getTimeRangeInSeconds());\n-        List<Operation> healthCheckOperations = operationService.createQuery()\n-                                                                .mtaId(healthCheckConfiguration.getMtaId())\n-                                                                .spaceId(healthCheckConfiguration.getSpaceId())\n-                                                                .user(healthCheckConfiguration.getUserName())\n-                                                                .endedAfter(Date.from(xSecondsAgo.toInstant()))\n-                                                                .inFinalState()\n-                                                                .orderByEndTime(OrderDirection.DESCENDING)\n-                                                                .list();\n+        List<Operation> healthCheckOperations = getHealthCheckOperations(healthCheckConfiguration, xSecondsAgo);\n         return Health.fromOperations(healthCheckOperations);\n     }\n \n+    private List<Operation> getHealthCheckOperations(HealthCheckConfiguration healthCheckConfiguration, ZonedDateTime xSecondsAgo) {\n+        OperationQuery healthCheckOperationsQuery = operationService.createQuery()\n+                                                                    .mtaId(healthCheckConfiguration.getMtaId())\n+                                                                    .spaceId(healthCheckConfiguration.getSpaceId())\n+                                                                    .endedAfter(Date.from(xSecondsAgo.toInstant()))\n+                                                                    .inFinalState()\n+                                                                    .orderByEndTime(OrderDirection.DESCENDING);\n+        if (healthCheckConfiguration.getUserName() != null) {\n+            healthCheckOperationsQuery.user(healthCheckConfiguration.getUserName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c202493d0fea70f357d0cceea1493f4417aec7f"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTYwNTkyOnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/health/HealthRetrieverTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowODowMVrOGsph8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwOTowODowMVrOGsph8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ3MDk2Mg==", "bodyText": "I think that there is never() or something similar, which can be used instead of times(0).", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/897#discussion_r449470962", "createdAt": "2020-07-03T09:08:01Z", "author": {"login": "radoslav-d"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/health/HealthRetrieverTest.java", "diffHunk": "@@ -101,15 +106,49 @@ public void testGetHealth() {\n \n         HealthCheckOperation healthCheckOperation = health.getHealthCheckOperations()\n                                                           .get(0);\n+        validateHealthCheckOperationParameters(healthCheckOperation);\n+        Mockito.verify(operationQuery, times(1))\n+               .user(USER_NAME);\n+        validateMandatoryParametersAreSet();\n+    }\n+\n+    @Test\n+    void testGetHealthWithoutUsername() {\n+        prepareConfiguration(ImmutableHealthCheckConfiguration.builder()\n+                                                              .mtaId(MTA_ID)\n+                                                              .spaceId(SPACE_ID)\n+                                                              .timeRangeInSeconds(TIME_RANGE_IN_SECONDS)\n+                                                              .build());\n+        Health health = healthRetriever.getHealth();\n+\n+        assertTrue(health.isHealthy());\n+        HealthCheckOperation healthCheckOperation = health.getHealthCheckOperations()\n+                                                          .get(0);\n+        validateHealthCheckOperationParameters(healthCheckOperation);\n+        Mockito.verify(operationQuery, times(0))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c202493d0fea70f357d0cceea1493f4417aec7f"}, "originalPosition": 128}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 559, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}