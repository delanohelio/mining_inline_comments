{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTU3Njcz", "number": 938, "title": "Adds text attribute converter to limit strings to 4000 characters", "bodyText": "", "createdAt": "2020-08-26T14:44:47Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938", "merged": true, "mergeCommit": {"oid": "e2ec508abc04bb94a860162c633d8624d9dbbd6a"}, "closed": true, "closedAt": "2020-08-31T11:27:37Z", "author": {"login": "Boris-ILIEV"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCtBtqgBqjM2OTUyMTY0Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC7zk0gFqTQ3NjQ4MDk1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e7af905ddd226a13f0104f879e01c6b456eac54", "author": {"user": {"login": "Boris-ILIEV", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6e7af905ddd226a13f0104f879e01c6b456eac54", "committedDate": "2020-08-26T14:38:01Z", "message": "Adds text attribute converter to limit strings to 4000 characters"}, "afterCommit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05", "author": {"user": {"login": "Boris-ILIEV", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6170dc036cdca789df7562d837b759d7fb2e0e05", "committedDate": "2020-08-26T14:52:22Z", "message": "Adds text attribute converter to limit strings to 4000 characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NDUwMDU0", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#pullrequestreview-476450054", "createdAt": "2020-08-27T07:22:01Z", "commit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNzoyMjowMVrOHIDnBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNzoyOTo1OFrOHID2-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIwOTc5Nw==", "bodyText": "Why null is converted to empty string? Is there a reason for this?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478209797", "createdAt": "2020-08-27T07:22:01Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/persistence/dto/TextAttributeConverter.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.cloudfoundry.multiapps.controller.core.persistence.dto;\n+\n+import javax.persistence.AttributeConverter;\n+import javax.persistence.Converter;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+@Converter\n+public class TextAttributeConverter implements AttributeConverter<String, String> {\n+\n+    private static final int MAX_STRING_LENGTH = 4000;\n+\n+    @Override\n+    public String convertToDatabaseColumn(String text) {\n+        if (text != null) {\n+            return StringUtils.abbreviate(text, MAX_STRING_LENGTH);\n+        }\n+        return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIxMTAxNQ==", "bodyText": "It is better to remove this line.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478211015", "createdAt": "2020-08-27T07:24:29Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/persistence/service/ProgressMessageService.java", "diffHunk": "@@ -100,4 +100,5 @@ public ProgressMessageDto toDto(ProgressMessage progressMessage) {\n         }\n \n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIxMzg4Mg==", "bodyText": "This long string generation is fine, but if you like, you may look at this examples: https://stackoverflow.com/questions/2804827/create-a-string-with-n-characters\nThere are some cool one-liners.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#discussion_r478213882", "createdAt": "2020-08-27T07:29:58Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/persistence/dto/TextAttributeConverterTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.cloudfoundry.multiapps.controller.core.persistence.dto;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+class TextAttributeConverterTest {\n+\n+    private final TextAttributeConverter textAttributeConverter = new TextAttributeConverter();\n+\n+    @Test\n+    void testConvertToEntityAttribute() {\n+        Assertions.assertEquals(\"test\", textAttributeConverter.convertToEntityAttribute(\"test\"));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsNotNull() {\n+        Assertions.assertEquals(\"test\", textAttributeConverter.convertToDatabaseColumn(\"test\"));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsNull() {\n+        Assertions.assertEquals(\"\", textAttributeConverter.convertToDatabaseColumn(null));\n+    }\n+\n+    @Test\n+    void testConvertToDatabaseColumnWhenInputIsLongerThan4000chars() {\n+        String expectedString = getLongStringInput().substring(0, 3997)\n+                                                    .concat(\"...\");\n+\n+        Assertions.assertEquals(expectedString, textAttributeConverter.convertToDatabaseColumn(getLongStringInput()));\n+    }\n+\n+    private String getLongStringInput() {\n+        int stringLength = 5000;\n+        StringBuilder longStringBuilder = new StringBuilder();\n+        for (int i = 1; i <= stringLength; i++) {\n+            longStringBuilder.append(\"a\");\n+        }\n+        return longStringBuilder.toString();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "author": {"user": {"login": "Boris-ILIEV", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "committedDate": "2020-08-27T08:00:09Z", "message": "Adds text attribute converter to limit strings to 4000 characters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6170dc036cdca789df7562d837b759d7fb2e0e05", "author": {"user": {"login": "Boris-ILIEV", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6170dc036cdca789df7562d837b759d7fb2e0e05", "committedDate": "2020-08-26T14:52:22Z", "message": "Adds text attribute converter to limit strings to 4000 characters"}, "afterCommit": {"oid": "ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "author": {"user": {"login": "Boris-ILIEV", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ce7c06f84685033566a7395a4b7b0d8c4e19e5e4", "committedDate": "2020-08-27T08:00:09Z", "message": "Adds text attribute converter to limit strings to 4000 characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NDgwOTU4", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/938#pullrequestreview-476480958", "createdAt": "2020-08-27T08:05:49Z", "commit": {"oid": "ce7c06f84685033566a7395a4b7b0d8c4e19e5e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 787, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}