{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0OTQ5Mjk5", "number": 909, "title": "Add metric for Flowable Queue size", "bodyText": "", "createdAt": "2020-07-22T07:59:48Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/909", "merged": true, "mergeCommit": {"oid": "e59a20b4e665af95eaa986d1d97f157249ca86e9"}, "closed": true, "closedAt": "2020-07-22T10:28:01Z", "author": {"login": "theghost5800"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3WIlIAH2gAyNDU0OTQ5Mjk5OjBlNjg4YTlhYTViNmFkOWFjNjNlZDQ4ZGQyZWQ1MjM0MjVhYTYzMzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3XXSPAFqTQ1MzE0NjQzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330", "committedDate": "2020-07-22T07:59:12Z", "message": "Add metric for Flowable Queue size"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTE2OTQ4", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/909#pullrequestreview-453116948", "createdAt": "2020-07-22T08:45:56Z", "commit": {"oid": "0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo0NTo1NlrOG1Y3UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo0NTo1NlrOG1Y3UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYzNTA4OA==", "bodyText": "Is this operation expensive enough to justify the cache?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/909#discussion_r458635088", "createdAt": "2020-07-22T08:45:56Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/monitoring/FlowableJobExecutorInformation.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.sap.cloud.lm.sl.cf.web.monitoring;\n+\n+import java.time.Instant;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import org.flowable.job.service.impl.asyncexecutor.DefaultAsyncJobExecutor;\n+\n+@Named\n+public class FlowableJobExecutorInformation {\n+\n+    private static final int CACHE_TIMEOUT_IN_SECONDS = 60;\n+\n+    protected Instant lastUpdateTime;\n+\n+    private DefaultAsyncJobExecutor jobExecutor;\n+\n+    private int currentJobExecutorQueueSize = 0;\n+\n+    @Inject\n+    public FlowableJobExecutorInformation(DefaultAsyncJobExecutor jobExecutor) {\n+        this.jobExecutor = jobExecutor;\n+    }\n+\n+    public int getCurrentJobExecutorQueueSize() {\n+        if (lastUpdateTime == null || isPastCacheTimeout()) {\n+            updateCurrentJobExecutorQueueSize();\n+        }\n+        return currentJobExecutorQueueSize;\n+    }\n+\n+    private boolean isPastCacheTimeout() {\n+        return Instant.now()\n+                      .minusSeconds(CACHE_TIMEOUT_IN_SECONDS)\n+                      .isAfter(lastUpdateTime);\n+    }\n+\n+    private void updateCurrentJobExecutorQueueSize() {\n+        currentJobExecutorQueueSize = jobExecutor.getThreadPoolQueue()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTMyNTY1", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/909#pullrequestreview-453132565", "createdAt": "2020-07-22T09:06:39Z", "commit": {"oid": "0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTQ2NDMw", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/909#pullrequestreview-453146430", "createdAt": "2020-07-22T09:25:10Z", "commit": {"oid": "0e688a9aa5b6ad9ac63ed48dd2ed523425aa6330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 759, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}