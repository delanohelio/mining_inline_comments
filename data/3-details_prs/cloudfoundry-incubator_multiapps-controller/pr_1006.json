{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNjE0NjYx", "number": 1006, "title": "Applications v3", "bodyText": "LMCROSSITXSADEPLOY-1749", "createdAt": "2020-12-07T11:54:49Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006", "merged": true, "mergeCommit": {"oid": "d42fbfa82ef9b318b38f2feb0b95d66b9cb0938b"}, "closed": true, "closedAt": "2020-12-11T15:23:11Z", "author": {"login": "IvanBorislavovDimitrov"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj0XCugBqjQwNzkyODI5MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlJdOZAH2gAyNTMzNjE0NjYxOmI0ZTFmOTZmYjBlZjc2NjE3NTc0MDBjZTBkM2RhYzkyYjgzMzgwNmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e84351b7dd6ee3be00290f6c17053237c2d49ef1", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/e84351b7dd6ee3be00290f6c17053237c2d49ef1", "committedDate": "2020-12-07T11:53:09Z", "message": "Optimize calls to CC"}, "afterCommit": {"oid": "508bb88dcadf3488967cca1e253be523ee69029a", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/508bb88dcadf3488967cca1e253be523ee69029a", "committedDate": "2020-12-07T12:04:24Z", "message": "Optimize calls to CC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2OTA1MDk5", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#pullrequestreview-546905099", "createdAt": "2020-12-08T09:06:31Z", "commit": {"oid": "508bb88dcadf3488967cca1e253be523ee69029a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "508bb88dcadf3488967cca1e253be523ee69029a", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/508bb88dcadf3488967cca1e253be523ee69029a", "committedDate": "2020-12-07T12:04:24Z", "message": "Optimize calls to CC"}, "afterCommit": {"oid": "af58f5582392b458ae657a797f41d646362da862", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/af58f5582392b458ae657a797f41d646362da862", "committedDate": "2020-12-08T12:11:41Z", "message": "Optimize calls to CC"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af58f5582392b458ae657a797f41d646362da862", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/af58f5582392b458ae657a797f41d646362da862", "committedDate": "2020-12-08T12:11:41Z", "message": "Optimize calls to CC"}, "afterCommit": {"oid": "f7a8395b44139808efa09ea27bc48743c4024bbb", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f7a8395b44139808efa09ea27bc48743c4024bbb", "committedDate": "2020-12-08T12:14:50Z", "message": "Optimize calls to CC"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7a8395b44139808efa09ea27bc48743c4024bbb", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/f7a8395b44139808efa09ea27bc48743c4024bbb", "committedDate": "2020-12-08T12:14:50Z", "message": "Optimize calls to CC"}, "afterCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847", "committedDate": "2020-12-08T12:23:49Z", "message": "Optimize calls to CC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjA2MTA3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#pullrequestreview-547206107", "createdAt": "2020-12-08T12:54:53Z", "commit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjEzNDM3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#pullrequestreview-547213437", "createdAt": "2020-12-08T13:04:27Z", "commit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzowNDoyOFrOIBZ6Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzozNjoyOVrOIBb5gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NDAzOA==", "bodyText": "Why are these needed?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538344038", "createdAt": "2020-12-08T13:04:28Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/module-info.java", "diffHunk": "@@ -50,6 +50,8 @@\n     requires spring.core;\n     requires spring.security.oauth2;\n     requires spring.web;\n+    requires reactor.netty;\n+    requires io.netty.handler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0NzE3NA==", "bodyText": "Can appArchiveId be retrieved in this method instead of passing it as a parameter?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538347174", "createdAt": "2020-12-08T13:07:34Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());\n+        return client.createDockerPackage(applicationGuid, application.getDockerInfo());\n+    }\n+\n+    private String getNewApplicationDigest(ProcessContext context, String appArchiveId, String fileName) throws FileStorageException {\n+        return fileService.processFileContent(context.getVariable(Variables.SPACE_GUID), appArchiveId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM1OTg0Mw==", "bodyText": "If I understand correctly, this flow means that there isn't a file entry in the MTAR associated with this module because it is described as a docker application, is this right?\nIf so, how did we operate with docker apps so far?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538359843", "createdAt": "2020-12-08T13:20:11Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -63,17 +64,21 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n \n         MtaArchiveElements mtaArchiveElements = context.getVariable(Variables.MTA_ARCHIVE_ELEMENTS);\n         String moduleFileName = mtaArchiveElements.getModuleFileName(applicationToProcess.getModuleName());\n+        CloudControllerClient client = context.getControllerClient();\n         if (moduleFileName == null) {\n             getStepLogger().debug(Messages.NO_CONTENT_TO_UPLOAD);\n+            if (applicationToProcess.getDockerInfo() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM2MTE2Mw==", "bodyText": "Why isn't the guid in the CloudApplicationExtended object used but a request to the CC is made to fetch the guid?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538361163", "createdAt": "2020-12-08T13:21:31Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/UploadAppStep.java", "diffHunk": "@@ -94,6 +99,34 @@ public StepPhase executeAsyncStep(ProcessContext context) throws FileStorageExce\n         return StepPhase.DONE;\n     }\n \n+    private CloudPackage createDockerPackage(CloudControllerClient client, CloudApplicationExtended application) {\n+        UUID applicationGuid = client.getApplicationGuid(application.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM3NjU3Nw==", "bodyText": "Maybe dockerStaging would be more descriptive", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#discussion_r538376577", "createdAt": "2020-12-08T13:36:29Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/CreateOrUpdateAppStepTest.java", "diffHunk": "@@ -92,16 +92,19 @@ void testCreateApplicationFromDockerImage() {\n                                                                                           .password(\"somePassword\")\n                                                                                           .build())\n                                                    .build();\n+        Staging staging = ImmutableStaging.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "267b271c197d749c79dbccf0418b32a383e0938b", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/267b271c197d749c79dbccf0418b32a383e0938b", "committedDate": "2020-12-08T16:26:43Z", "message": "Adopt v3 applications api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee0461fd8d1ce401c77be58a5e22c15474ff9a0", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fee0461fd8d1ce401c77be58a5e22c15474ff9a0", "committedDate": "2020-12-08T16:26:46Z", "message": "Optimize calls to CC"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d5a6a0a52f9fe87b6e9d9e0c8ef6fa22dc694847", "committedDate": "2020-12-08T12:23:49Z", "message": "Optimize calls to CC"}, "afterCommit": {"oid": "fee0461fd8d1ce401c77be58a5e22c15474ff9a0", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/fee0461fd8d1ce401c77be58a5e22c15474ff9a0", "committedDate": "2020-12-08T16:26:46Z", "message": "Optimize calls to CC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTUyNDA0", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/1006#pullrequestreview-547552404", "createdAt": "2020-12-08T19:17:18Z", "commit": {"oid": "fee0461fd8d1ce401c77be58a5e22c15474ff9a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "392a1ccd159e92e732042765fe77925f8442c01e", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/392a1ccd159e92e732042765fe77925f8442c01e", "committedDate": "2020-12-09T14:53:52Z", "message": "Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae701a5bd352dd83d0cf5a0e19d4280245eea315", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ae701a5bd352dd83d0cf5a0e19d4280245eea315", "committedDate": "2020-12-10T13:26:25Z", "message": "Remove unused method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4e1f96fb0ef7661757400ce0d3dac92b833806a", "author": {"user": {"login": "IvanBorislavovDimitrov", "name": "Ivan Dimitrov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/b4e1f96fb0ef7661757400ce0d3dac92b833806a", "committedDate": "2020-12-11T15:13:30Z", "message": "Adopt cloudfoundry-client-facade 2.4.0"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 866, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}