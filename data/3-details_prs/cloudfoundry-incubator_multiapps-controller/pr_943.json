{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NDM1NjQx", "number": 943, "title": "Prepare changelogs for Liquibase versions >= 3.5.2", "bodyText": "Since https://liquibase.jira.com/projects/CORE/issues/CORE-1863 Liquibase maps the generic BLOB type to OID instead of BYTEA for PostgreSQL databases.\nThis commit adapts our existing changelogs to that breaking change and also solves #942.", "createdAt": "2020-08-31T17:35:18Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943", "merged": true, "mergeCommit": {"oid": "cfb6ab2dc29c5d19f1f1aa0b1afc45e4843a5991"}, "closed": true, "closedAt": "2020-09-01T12:00:33Z", "author": {"login": "nictas"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEiFYdgFqTQ3OTQ0Njc0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEmDdNABqjM3MTQ1MTc0MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDQ2NzQ3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#pullrequestreview-479446747", "createdAt": "2020-09-01T06:52:22Z", "commit": {"oid": "1c1b50535b7c35a70305f7759a04f9a58284d7d2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNjo1MjoyMlrOHKnK0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNjo1ODoxOFrOHKnc9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg4OTU1Mg==", "bodyText": "Do you test these properties? Is it possible property which is specified for all dbms to override property for specific dbms?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r480889552", "createdAt": "2020-09-01T06:52:22Z", "author": {"login": "theghost5800"}, "path": "multiapps-controller-core/src/main/resources/org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog.xml", "diffHunk": "@@ -4,84 +4,13 @@\n     xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog\n                 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n \n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_oauth_access_token_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_ongoing_operation_table.xml\" />\n-    <include file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_audit_log_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_configuration_subscription_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-rename_user_column_in_ongoing_operation_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_configuration_registry_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_ongoing_operation_table_add_final_state_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_add_visible_in_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_add_target_org_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-drop_configuration_registry_unique_constraint.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_new_configuration_registry_unique_constraint.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_split_target_space_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-update_configuration_subscription_table_update_filter_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_ongoing_operation_table_rename_slp_states.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-rename_ongoing_operation_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_operation_table_add_ended_at_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_operation_table_timestamp_storing_columns.xml\" />\n-    <include file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_quartz_tables.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_add_space_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_extend_provider_version_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-index_space_id_operation.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-drop_context_extension_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_operation_table_drop_cleaned_up_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-prepare_for_flowable.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_extend_provider_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-drop_deploy_target_tables.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_historic_operation_event_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_progress_message_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_progress_message_add_timestamp_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-add_task_extension_table.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_progress_message_add_task_execution_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_task_extension_add_task_execution_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-index_process_ids_of_progress_messages.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_progress_message_drop_task_execution_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-delete_task_startup_progress_messages.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-update_configuration_registry_clean_up_leftovers.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_operation_table_add_namespace_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_add_namespace_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_registry_table_add_content_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_subscription_table_add_module_id_column.xml\" />\n-    <include\n-        file=\"org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-alter_configuration_subscription_table_add_resource_id_column.xml\" />\n+    <property name=\"small-blob.type\" value=\"BYTEA\" dbms=\"postgresql\" />\n+    <property name=\"large-blob.type\" value=\"OID\" dbms=\"postgresql\" />\n+\n+    <property name=\"small-blob.type\" value=\"BLOB\" dbms=\"all\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1b50535b7c35a70305f7759a04f9a58284d7d2"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg5MTk5OQ==", "bodyText": "Is it still need to keep old column in liquibase change? As far as I know we are using content_bytea only.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r480891999", "createdAt": "2020-09-01T06:55:28Z", "author": {"login": "theghost5800"}, "path": "multiapps-controller-persistence/src/main/resources/org/cloudfoundry/multiapps/controller/persistence/db/changelog/db-changelog-1.110.0-persistence.xml", "diffHunk": "@@ -0,0 +1,86 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog\n+         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd\">\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_lm_sl_persistence_file\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <tableExists tableName=\"lm_sl_persistence_file\" />\n+            </not>\n+        </preConditions>\n+        <createTable tableName=\"lm_sl_persistence_file\">\n+            <column name=\"file_id\" type=\"CHAR(36)\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"file_id_pk\" nullable=\"false\" />\n+            </column>\n+            <column name=\"content\" type=\"${large-blob.type}\" />\n+            <column name=\"digest\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"digest_algorithm\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"modified\" type=\"TIMESTAMP\" />\n+            <column name=\"file_name\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"file_size\" type=\"BIGINT\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"namespace\" type=\"VARCHAR(255)\" />\n+            <column name=\"space\" type=\"VARCHAR(255)\" />\n+        </createTable>\n+        <createIndex tableName=\"lm_sl_persistence_file\" indexName=\"idx_lm_sl_persistence_file_space\">\n+            <column name=\"space\" />\n+        </createIndex>\n+    </changeSet>\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_process_log\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <tableExists tableName=\"process_log\" />\n+            </not>\n+        </preConditions>\n+        <createTable tableName=\"process_log\">\n+            <column name=\"file_id\" type=\"CHAR(36)\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"log_file_id_pk\" nullable=\"false\" />\n+            </column>\n+            <column name=\"content\" type=\"${large-blob.type}\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1b50535b7c35a70305f7759a04f9a58284d7d2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg5NDE5Nw==", "bodyText": "What this line mean?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r480894197", "createdAt": "2020-09-01T06:58:18Z", "author": {"login": "theghost5800"}, "path": "multiapps-controller-persistence/src/main/resources/org/cloudfoundry/multiapps/controller/persistence/db/changelog/sql/create_unlink_file_content_function.sql", "diffHunk": "@@ -0,0 +1,11 @@\n+CREATE OR REPLACE FUNCTION UNLINK_FILE_CONTENT() RETURNS TRIGGER AS\n+$$\n+  BEGIN\n+    PERFORM lo_unlink(OLD.content);\n+    RETURN NULL;\n+  EXCEPTION\n+    WHEN undefined_object THEN RAISE NOTICE 'Referenced large object could not be deleted, because it does not exist!';\n+    RETURN NULL;\n+  END;\n+$$\n+LANGUAGE 'plpgsql' STABLE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1b50535b7c35a70305f7759a04f9a58284d7d2"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8613e6da348daa778dc760d87f6552ea14ce3b71", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8613e6da348daa778dc760d87f6552ea14ce3b71", "committedDate": "2020-09-01T08:25:09Z", "message": "Remove dead code"}, "afterCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0b7e2b12f10f9d8e4d21d7063d362935e1fde1af", "committedDate": "2020-09-01T09:04:24Z", "message": "Remove dead code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTQ3OTcy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#pullrequestreview-479547972", "createdAt": "2020-09-01T09:14:00Z", "commit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTYxMjY3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#pullrequestreview-479561267", "createdAt": "2020-09-01T09:31:28Z", "commit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTozMToyOFrOHKt_PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTozMToyOFrOHKt_PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAwMTI3Ng==", "bodyText": "Previously we have added java classes which perform async index creation with CONCURRENTLY keyword which create index without locking the whole table. Does it mean now liquibase will use this feature of PostgreSQL to create indexes without locking whole tables?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r481001276", "createdAt": "2020-09-01T09:31:28Z", "author": {"login": "theghost5800"}, "path": "multiapps-controller-core/src/main/resources/org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-1.110.0-core.xml", "diffHunk": "@@ -0,0 +1,265 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog\n+         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd\">\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_audit_log\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <tableExists tableName=\"audit_log\" />\n+            </not>\n+        </preConditions>\n+        <createTable tableName=\"audit_log\">\n+            <column name=\"user\" type=\"VARCHAR(255)\" />\n+            <column name=\"modified\" type=\"TIMESTAMP\" />\n+            <column name=\"category\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"severity\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"message\" type=\"CLOB\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+        </createTable>\n+    </changeSet>\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_oauth_access_token\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <tableExists tableName=\"oauth_access_token\" />\n+            </not>\n+        </preConditions>\n+        <createTable tableName=\"oauth_access_token\">\n+            <column name=\"token_id\" type=\"VARCHAR(255)\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"oauth_access_token_pk\" nullable=\"false\" />\n+            </column>\n+            <column name=\"token\" type=\"${small-blob.type}\" />\n+            <column name=\"authentication_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"user_name\" type=\"VARCHAR(255)\" />\n+            <column name=\"client_id\" type=\"VARCHAR(255)\" />\n+            <column name=\"authentication\" type=\"${small-blob.type}\" />\n+            <column name=\"refresh_token\" type=\"VARCHAR(255)\" />\n+        </createTable>\n+    </changeSet>\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_configuration_registry\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <sequenceExists sequenceName=\"configuration_entry_sequence\" />\n+            </not>\n+            <not>\n+                <tableExists tableName=\"configuration_registry\" />\n+            </not>\n+        </preConditions>\n+        <createSequence sequenceName=\"configuration_entry_sequence\" startValue=\"1\" incrementBy=\"1\" />\n+        <createTable tableName=\"configuration_registry\">\n+            <column name=\"id\" type=\"BIGINT\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"configuration_registry_pk\" />\n+            </column>\n+            <column name=\"provider_namespace\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"provider_nid\" type=\"VARCHAR(100)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"provider_id\" type=\"VARCHAR(500)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"provider_version\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"target_space\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"target_org\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"space_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"content_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"content\" type=\"CLOB\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"visibility\" type=\"CLOB\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+        </createTable>\n+        <addUniqueConstraint tableName=\"configuration_registry\"\n+            constraintName=\"configuration_registry_uq\"\n+            columnNames=\"provider_nid, provider_id, provider_version, target_space, target_org, provider_namespace\" />\n+    </changeSet>\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_configuration_subscription\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <sequenceExists sequenceName=\"configuration_subscription_sequence\" />\n+            </not>\n+            <not>\n+                <tableExists tableName=\"configuration_subscription\" />\n+            </not>\n+        </preConditions>\n+        <createSequence sequenceName=\"configuration_subscription_sequence\" startValue=\"1\" incrementBy=\"1\" />\n+        <createTable tableName=\"configuration_subscription\">\n+            <column name=\"id\" type=\"BIGINT\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"configuration_subscription_pk\" />\n+            </column>\n+            <column name=\"mta_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"space_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"app_name\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"filter\" type=\"CLOB\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"module_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"module\" type=\"CLOB\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"resource_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"true\" />\n+            </column>\n+            <column name=\"resource_name\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"resource_properties\" type=\"CLOB\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+        </createTable>\n+        <addUniqueConstraint tableName=\"configuration_subscription\"\n+            columnNames=\"mta_id, app_name, space_id, resource_name\" constraintName=\"configuration_subscription_uq\" />\n+    </changeSet>\n+\n+    <changeSet author=\"sap.com\" id=\"create_table_historic_operation_event\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <sequenceExists sequenceName=\"historic_operation_event_sequence\" />\n+            </not>\n+            <not>\n+                <tableExists tableName=\"historic_operation_event\" />\n+            </not>\n+        </preConditions>\n+        <createSequence sequenceName=\"historic_operation_event_sequence\" startValue=\"1\" incrementBy=\"1\" />\n+        <createTable tableName=\"historic_operation_event\">\n+            <column name=\"id\" type=\"BIGINT\">\n+                <constraints primaryKey=\"true\" primaryKeyName=\"historic_operation_event_pk\" nullable=\"false\" />\n+            </column>\n+            <column name=\"process_id\" type=\"VARCHAR(255)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"event\" type=\"VARCHAR(100)\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+            <column name=\"timestamp\" type=\"TIMESTAMP\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+        </createTable>\n+        <createIndex tableName=\"historic_operation_event\" indexName=\"idx_historic_operation_event_process_id \">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "originalPosition": 169}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTczNzEy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#pullrequestreview-479573712", "createdAt": "2020-09-01T09:47:38Z", "commit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTYzNDk2", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#pullrequestreview-479563496", "createdAt": "2020-09-01T09:34:16Z", "commit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTozNDoxNlrOHKuFgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDozMDozNVrOHKwRlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAwMjg4Mg==", "bodyText": "Why is the name on these foreign keys repeated?\nCan't it be just FK_QRTZ_CRON_TRIGGERS?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r481002882", "createdAt": "2020-09-01T09:34:16Z", "author": {"login": "radito3"}, "path": "multiapps-controller-core/src/main/resources/org/cloudfoundry/multiapps/controller/core/db/changelog/db-changelog-1.110.0-quartz.xml", "diffHunk": "@@ -221,12 +236,25 @@\n             <column name=\"END_TIME\" type=\"BIGINT\" />\n             <column name=\"CALENDAR_NAME\" type=\"NVARCHAR(200)\" />\n             <column name=\"MISFIRE_INSTR\" type=\"SMALLINT\" />\n-            <column name=\"JOB_DATA\" type=\"BLOB\" />\n+            <column name=\"JOB_DATA\" type=\"${small-blob.type}\" />\n         </createTable>\n \n     </changeSet>\n \n-    <changeSet author=\"quartz.generated\" id=\"2\">\n+    <changeSet author=\"quartz.generated\" id=\"create_quartz_foreign_keys\">\n+\n+        <preConditions onFail=\"MARK_RAN\">\n+            <not>\n+                <foreignKeyConstraintExists\n+                    foreignKeyName=\"FK_QRTZ_CRON_TRIGGERS_QRTZ_TRIGGERS\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzNDA1Mw==", "bodyText": "Now that this is gone, when will the changes be made?\nOr do we even need to make these changes on app startup?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r481034053", "createdAt": "2020-09-01T10:21:34Z", "author": {"login": "radito3"}, "path": "multiapps-controller-web/src/main/java/org/cloudfoundry/multiapps/controller/web/bootstrap/BootstrapServlet.java", "diffHunk": "@@ -110,31 +102,4 @@ private void initializeProviders() {\n         AuditLoggingProvider.setFacade(new AuditLoggingFacadeSLImpl(dataSource, getUserInfoProvider()));\n     }\n \n-    private void executeAsyncDatabaseChanges() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzNTkyOA==", "bodyText": "Since in both normal execution and in the event of an exception we return  NULL, wouldn't it be better if this is a procedure rather than a function?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r481035928", "createdAt": "2020-09-01T10:25:14Z", "author": {"login": "radito3"}, "path": "multiapps-controller-persistence/src/main/resources/org/cloudfoundry/multiapps/controller/persistence/db/changelog/sql/create_unlink_file_content_function.sql", "diffHunk": "@@ -0,0 +1,11 @@\n+CREATE OR REPLACE FUNCTION UNLINK_FILE_CONTENT() RETURNS TRIGGER AS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzODc0Mg==", "bodyText": "I understand that this file is called in case of a rollback but wouldn't it be cleaner if these DROP statemets are executed immediately prior to the trigger's creation?\nOr is it neccessary to have them deleted in a rollback?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/943#discussion_r481038742", "createdAt": "2020-09-01T10:30:35Z", "author": {"login": "radito3"}, "path": "multiapps-controller-persistence/src/main/resources/org/cloudfoundry/multiapps/controller/persistence/db/changelog/sql/delete_unlink_file_content_triggers.sql", "diffHunk": "@@ -0,0 +1,5 @@\n+DROP TRIGGER IF EXISTS DELETE_FROM_SYSTEM_TABLE_LM_SL_PERSISTANCE_FILE ON LM_SL_PERSISTENCE_FILE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90ecae52bf3671ce0c76d98929953a7b7709f150", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/90ecae52bf3671ce0c76d98929953a7b7709f150", "committedDate": "2020-09-01T11:52:43Z", "message": "Prepare changelogs for Liquibase versions >= 3.5.2\n\nSince https://liquibase.jira.com/projects/CORE/issues/CORE-1863\nLiquibase maps the generic BLOB type to OID instead of BYTEA for PostgreSQL\ndatabases.\n\nThis commit adapts our existing changelogs to that breaking change and\nalso solves #942."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76030e445c2a113677080ee97317a0083ab0c6ab", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/76030e445c2a113677080ee97317a0083ab0c6ab", "committedDate": "2020-09-01T11:52:51Z", "message": "Remove dead code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b7e2b12f10f9d8e4d21d7063d362935e1fde1af", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0b7e2b12f10f9d8e4d21d7063d362935e1fde1af", "committedDate": "2020-09-01T09:04:24Z", "message": "Remove dead code"}, "afterCommit": {"oid": "76030e445c2a113677080ee97317a0083ab0c6ab", "author": {"user": {"login": "nictas", "name": "Alexander Tsvetkov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/76030e445c2a113677080ee97317a0083ab0c6ab", "committedDate": "2020-09-01T11:52:51Z", "message": "Remove dead code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 792, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}