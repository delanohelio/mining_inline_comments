{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwOTQyNjk4", "number": 936, "title": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154", "bodyText": "taking selected modules '-m module-name' into consideration when renaming applications at start of blue-green strategy deply", "createdAt": "2020-08-20T14:19:57Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/936", "merged": true, "mergeCommit": {"oid": "712f10d627ae9005fc290915792e3da7edcda716"}, "closed": true, "closedAt": "2020-08-20T15:06:12Z", "author": {"login": "ikasarov"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAxUgfgFqTQ3MTY4NTAxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAxmJZgBqjM2NzU3MTM5MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjg1MDEy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/936#pullrequestreview-471685012", "createdAt": "2020-08-20T14:42:02Z", "commit": {"oid": "8a0252f8542a4f2b51550012b79d8fe597e01099"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDo0MjowMlrOHEE4zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDo0MjozM1rOHEE6Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAzNjQyOQ==", "bodyText": "I don't understand the need for this variable.\nJust pass the list (and remove the List suffix from its name) to the other method", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/936#discussion_r474036429", "createdAt": "2020-08-20T14:42:02Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/DetectApplicationsToRenameStep.java", "diffHunk": "@@ -49,13 +51,28 @@ protected StepPhase executeStep(ProcessContext context) {\n         return StepPhase.DONE;\n     }\n \n-    private List<String> computeOldAppsToRename(Set<String> appsToProcess) {\n-        return appsToProcess.stream()\n-                            .filter(appName -> !BlueGreenApplicationNameSuffix.isSuffixContainedIn(appName))\n-                            .collect(Collectors.toList());\n+    private List<String> computeOldAppsToRename(DeployedMta deployedMta, List<String> selectedModulesList) {        \n+        Set<String> selectedModulesSet = new TreeSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0252f8542a4f2b51550012b79d8fe597e01099"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAzNjc5OQ==", "bodyText": "Wouldn't isModuleSelectedForDeployment be better?\nAnd rename the first parameter to moduleName", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/936#discussion_r474036799", "createdAt": "2020-08-20T14:42:33Z", "author": {"login": "radito3"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/DetectApplicationsToRenameStep.java", "diffHunk": "@@ -49,13 +51,28 @@ protected StepPhase executeStep(ProcessContext context) {\n         return StepPhase.DONE;\n     }\n \n-    private List<String> computeOldAppsToRename(Set<String> appsToProcess) {\n-        return appsToProcess.stream()\n-                            .filter(appName -> !BlueGreenApplicationNameSuffix.isSuffixContainedIn(appName))\n-                            .collect(Collectors.toList());\n+    private List<String> computeOldAppsToRename(DeployedMta deployedMta, List<String> selectedModulesList) {        \n+        Set<String> selectedModulesSet = new TreeSet<>();\n+        selectedModulesSet.addAll(CollectionUtils.emptyIfNull(selectedModulesList));\n+\n+        return deployedMta.getApplications()\n+                          .stream()\n+                          .filter(app -> !BlueGreenApplicationNameSuffix.isSuffixContainedIn(app.getName()))\n+                          .filter(app -> moduleIsSelectedForDeployment(app.getModuleName(), selectedModulesSet))\n+                          .map(DeployedMtaApplication::getName)\n+                          .collect(Collectors.toList());\n+    }\n+\n+    private boolean moduleIsSelectedForDeployment(String module, Set<String> selectedModules) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0252f8542a4f2b51550012b79d8fe597e01099"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a0252f8542a4f2b51550012b79d8fe597e01099", "author": {"user": {"login": "ikasarov", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/8a0252f8542a4f2b51550012b79d8fe597e01099", "committedDate": "2020-08-20T14:17:45Z", "message": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154"}, "afterCommit": {"oid": "0afbe6f55a9643c55c445a90f69c4981049b7522", "author": {"user": {"login": "ikasarov", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0afbe6f55a9643c55c445a90f69c4981049b7522", "committedDate": "2020-08-20T14:53:58Z", "message": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41a18569e3e8aab44907e15aaa6c3d8cd983da0f", "author": {"user": {"login": "ikasarov", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/41a18569e3e8aab44907e15aaa6c3d8cd983da0f", "committedDate": "2020-08-20T15:03:50Z", "message": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154\n\nasd"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0afbe6f55a9643c55c445a90f69c4981049b7522", "author": {"user": {"login": "ikasarov", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/0afbe6f55a9643c55c445a90f69c4981049b7522", "committedDate": "2020-08-20T14:53:58Z", "message": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154"}, "afterCommit": {"oid": "41a18569e3e8aab44907e15aaa6c3d8cd983da0f", "author": {"user": {"login": "ikasarov", "name": null}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/41a18569e3e8aab44907e15aaa6c3d8cd983da0f", "committedDate": "2020-08-20T15:03:50Z", "message": "fix for partial deploy with blue-green, LMCROSSITXSADEPLOY-2154\n\nasd"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 785, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}