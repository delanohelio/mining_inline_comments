{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxOTQ4MzYw", "number": 838, "title": "Small code improvements & refactoring", "bodyText": "", "createdAt": "2020-04-10T15:14:01Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838", "merged": true, "mergeCommit": {"oid": "d0b7774fd4e09d323319121baca83f4b39d8768e"}, "closed": true, "closedAt": "2020-04-28T09:51:50Z", "author": {"login": "radito3"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYQ1XTABqjMyNDExODc4NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccAynjgFqTQwMTY3NjA4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3ddf4be18b9e68448add3531ff45aa6f49f0ede", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/a3ddf4be18b9e68448add3531ff45aa6f49f0ede", "committedDate": "2020-04-10T14:40:34Z", "message": "Small code improvements"}, "afterCommit": {"oid": "816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d", "committedDate": "2020-04-16T18:16:50Z", "message": "Small code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNTQ4NzA2", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#pullrequestreview-401548706", "createdAt": "2020-04-28T07:00:58Z", "commit": {"oid": "d2e775673076eddfeb6ca8c23facb008fa3f1079"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNzowMDo1OVrOGNFk6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNzo1NjoyNlrOGNHhQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM3NjA0Mw==", "bodyText": "Written like this, it seems like a bug that || is not &&. I'd like it more like this:\nif (containsPlan(v1Plans, servicePlanName)) {\n     return v1Plans;\n}\nif (containsPlan(v2Plans, servicePlanName)) {\n    return v2Plans;\n}\nreturn v1Plans;\n\nThat way it's clear that v1Plans is the default.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416376043", "createdAt": "2020-04-28T07:00:59Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/clients/ServiceWithAlternativesCreator.java", "diffHunk": "@@ -63,17 +61,17 @@ public ServiceWithAlternativesCreator(UserMessageLogger userMessageLogger) {\n         return attemptToFindServiceOfferingAndCreateService(client, serviceInstance, validServiceOfferings);\n     }\n \n-    private List<CloudServicePlan> retrievePlanListFromServicePlan(CloudServiceInstanceExtended serviceInstance,\n-                                                                   List<CloudServicePlan>... listOfPlans) {\n+    private List<CloudServicePlan> retrievePlanListFromServicePlan(CloudServiceInstanceExtended serviceInstance, List<CloudServicePlan> v1Plans,\n+                                                                   List<CloudServicePlan> v2Plans) {\n         String servicePlanName = serviceInstance.getPlan();\n-        if (ArrayUtils.isEmpty(listOfPlans)) {\n+        if (v1Plans.isEmpty() || v2Plans.isEmpty()) {\n             throw new SLException(Messages.EMPTY_SERVICE_PLANS_LIST_FOUND, servicePlanName);\n         }\n \n-        return Stream.of(listOfPlans)\n-                     .filter(plans -> containsPlan(plans, servicePlanName))\n-                     .findFirst()\n-                     .orElse(listOfPlans[0]);\n+        if (containsPlan(v1Plans, servicePlanName) || !containsPlan(v2Plans, servicePlanName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e775673076eddfeb6ca8c23facb008fa3f1079"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM4OTI3Mg==", "bodyText": "You're relying on the equals method of X509Certificate. Does it do the same thing as the previous check?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416389272", "createdAt": "2020-04-28T07:25:51Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/JarSignatureVerifier.java", "diffHunk": "@@ -142,21 +139,13 @@ private String getJarEntriesNames(List<JarEntry> jarEntries) {\n \n     private void validateCertificateChain(List<X509Certificate> targetCertificates, List<X509Certificate> candidateCertificateChain,\n                                           String certificateCN) {\n-        boolean certificateCNMatches = false;\n-        boolean targetCertificatesMatchEntryCertificate = false;\n-        for (X509Certificate certificate : candidateCertificateChain) {\n-            checkValidityOfCertificate(certificate);\n-            if (!certificateCNMatches) {\n-                certificateCNMatches = certificateCNMatches(certificate, certificateCN);\n-            }\n-            if (!targetCertificatesMatchEntryCertificate) {\n-                targetCertificatesMatchEntryCertificate = doTargetCertificatesMatchEntryCertificate(targetCertificates, certificate);\n-            }\n-        }\n-        if (!certificateCNMatches) {\n+        candidateCertificateChain.forEach(this::checkValidityOfCertificate);\n+\n+        List<String> certificateCNs = getCertificatesNames(candidateCertificateChain);\n+        if (certificateCN != null && !certificateCNs.contains(certificateCN)) {\n             throw new SLException(Messages.WILL_LOOK_FOR_CERTIFICATE_CN, certificateCN);\n         }\n-        if (!targetCertificatesMatchEntryCertificate) {\n+        if (Collections.disjoint(candidateCertificateChain, targetCertificates)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e775673076eddfeb6ca8c23facb008fa3f1079"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM5MDI3MQ==", "bodyText": "Why were we using this in the first place?? /facepalm", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416390271", "createdAt": "2020-04-28T07:27:29Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ServiceRemover.java", "diffHunk": "@@ -58,13 +56,9 @@ private void unbindService(CloudControllerClient client, StepLogger stepLogger,\n             return;\n         }\n         stepLogger.debug(Messages.SERVICE_BINDINGS_EXISTS, secureSerializer.toJson(serviceBindings));\n-        List<CloudApplication> applications = client.getApplications();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e775673076eddfeb6ca8c23facb008fa3f1079"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQwNTc1Ng==", "bodyText": "The name of the method does not make much sense after removing the int numberOfDays argument. Put it back.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416405756", "createdAt": "2020-04-28T07:53:11Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/security/data/termination/DataTerminationService.java", "diffHunk": "@@ -94,12 +94,11 @@ private CloudControllerClientImpl getCFClient() {\n         return cfClient;\r\n     }\r\n \r\n-    private String getDateBeforeDays(int numberOfDays) {\r\n-        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n-        long currentDateInMillis = new Date().getTime();\r\n-        long timeInMillisBeforeTwoDays = currentDateInMillis - numberOfDays * DateUtils.MILLIS_PER_DAY;\r\n-        Date dateBeforeTwoDays = new Date(timeInMillisBeforeTwoDays);\r\n-        String result = sdf.format(dateBeforeTwoDays);\r\n+    private String getDateBeforeDays() {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQwNjg5NA==", "bodyText": "applicationGuid is more consistent with the name of the method. Additionally, this really is a GUID, even though the name of the VCAP_APPLICATION field does not reflect that.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416406894", "createdAt": "2020-04-28T07:54:59Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/util/ApplicationConfiguration.java", "diffHunk": "@@ -755,9 +755,9 @@ private Integer getHealthCheckTimeRangeFromEnvironment() {\n \r\n     private String getApplicationGuidFromEnvironment() {\r\n         Map<String, Object> vcapApplicationMap = getVcapApplication();\r\n-        String applicationGuid = (String) vcapApplicationMap.get(\"application_id\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQwNzg3Mw==", "bodyText": "The name of the method does not make much sense after removing the String path argument. Put it back.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#discussion_r416407873", "createdAt": "2020-04-28T07:56:26Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/helpers/MtaConfigurationPurgerTest.java", "diffHunk": "@@ -153,8 +153,8 @@ private CloudApplication createApplication(String applicationName, Map<String, O\n                                         .build();\n     }\n \n-    private Map<String, Object> getApplicationEnvFromFile(String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e02aff8d799353902f2eb59d378b4209dc3148bf", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/e02aff8d799353902f2eb59d378b4209dc3148bf", "committedDate": "2020-04-28T09:25:19Z", "message": "Refactor variable APP_CONTENT_CHANGED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6fdb2104144decf6817294dcc123b85fc0beac3", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/d6fdb2104144decf6817294dcc123b85fc0beac3", "committedDate": "2020-04-28T09:25:19Z", "message": "Remove redundant FileUtils method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7df8e06a3be581d8730664e0d06accffd572339", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/a7df8e06a3be581d8730664e0d06accffd572339", "committedDate": "2020-04-28T09:25:20Z", "message": "Small refactoring in UploadAppStep and its test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a40585cc9921ab92447d150de8403b5f0c7d603", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/6a40585cc9921ab92447d150de8403b5f0c7d603", "committedDate": "2020-04-28T09:25:20Z", "message": "Refactor ThreadInfo classes to reduce redundancy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "142bebb099d4b9efce89b66c4a51c2a84b3e8161", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/142bebb099d4b9efce89b66c4a51c2a84b3e8161", "committedDate": "2020-04-28T09:25:20Z", "message": "Make ApplicationStartupCalculator a bean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e359ab78d9a3a713485da96b6df4df69c9c1351e", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/e359ab78d9a3a713485da96b6df4df69c9c1351e", "committedDate": "2020-04-28T09:25:20Z", "message": "Remove unused methods/parameters/variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a664a74f591cd03f1ad4dedbb5d8aa424663a55", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/2a664a74f591cd03f1ad4dedbb5d8aa424663a55", "committedDate": "2020-04-28T09:49:59Z", "message": "Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5999652e80104ca2cbfeb6d8955177aa00d9174b", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/5999652e80104ca2cbfeb6d8955177aa00d9174b", "committedDate": "2020-04-28T09:50:00Z", "message": "Small code improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/816a0a05ddb6fef9bdfe97c8c2ff9dee6094844d", "committedDate": "2020-04-16T18:16:50Z", "message": "Small code improvements"}, "afterCommit": {"oid": "5999652e80104ca2cbfeb6d8955177aa00d9174b", "author": {"user": {"login": "radito3", "name": "Rangel Ivanov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/5999652e80104ca2cbfeb6d8955177aa00d9174b", "committedDate": "2020-04-28T09:50:00Z", "message": "Small code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNjc2MDgx", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/838#pullrequestreview-401676081", "createdAt": "2020-04-28T09:51:15Z", "commit": {"oid": "5999652e80104ca2cbfeb6d8955177aa00d9174b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 896, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}