{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTE5NTQ1", "number": 734, "title": "Fix getting live application routes on bg-deploy", "bodyText": "Also fix determine of live application color based on previous operation\nvariables\nJIRA:LMCROSSITXSADEPLOY-1875", "createdAt": "2020-01-22T15:34:13Z", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734", "merged": true, "mergeCommit": {"oid": "3780430ba6ec14bda881008d2155f810bb17ddca"}, "closed": true, "closedAt": "2020-01-29T13:25:49Z", "author": {"login": "theghost5800"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9Hc_xgFqTM0NzE2OTQ5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_FvymgBqjI5ODk0NDU5NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTY5NDky", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-347169492", "createdAt": "2020-01-23T09:49:37Z", "commit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOTo0OTozN1rOFg4NEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDowMzo0NFrOFg4pyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxOTYwMw==", "bodyText": "As we talked, this could break the new suffixes scenario for the new bg-deploy process.\nA new mechanism should be introduced which to provide the information about the deployedMtaColor but in the same time to be hidden and easily estendible. Think in this way.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370019603", "createdAt": "2020-01-23T09:49:37Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxOTkzNw==", "bodyText": "If you apply the below comment, you could get rid of the Live word in the class name.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370019937", "createdAt": "2020-01-23T09:50:20Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMDI2OQ==", "bodyText": "Rename to isModuleNameMatching", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370020269", "createdAt": "2020-01-23T09:50:57Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMDUxNA==", "bodyText": "Could we check whether !deployedModules.isEmpty() ?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370020514", "createdAt": "2020-01-23T09:51:26Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMTg4OQ==", "bodyText": "The naming of the method is not applicable for two reasons:\n\nYou bring the App notation here although you were talking for modules all above\nIt is not correct in the syntax --> hasApplicationNameContainLiveDeployedColor...\nThink of a new method name and take in mind the comments at the begining of the class.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370021889", "createdAt": "2020-01-23T09:54:05Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean isAppNameHasLiveDeployedColor(DeployedMtaModule deployedModule) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMTk2Nw==", "bodyText": "Same here - refactor", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370021967", "createdAt": "2020-01-23T09:54:14Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean isAppNameHasLiveDeployedColor(DeployedMtaModule deployedModule) {\n+        String appName = deployedModule.getAppName();\n+        return appName.endsWith(deployedMtaColor.asSuffix()) || isAppNameHasColorWithoutSuffix(appName);\n+    }\n+\n+    private boolean isAppNameHasColorWithoutSuffix(String appName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMjQyMg==", "bodyText": "Now, if you decide that you want to fix the first two comments(at the begining of the class), you should also think of a way how these checks could be done in more abstract way - think of it.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370022422", "createdAt": "2020-01-23T09:55:08Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean isAppNameHasLiveDeployedColor(DeployedMtaModule deployedModule) {\n+        String appName = deployedModule.getAppName();\n+        return appName.endsWith(deployedMtaColor.asSuffix()) || isAppNameHasColorWithoutSuffix(appName);\n+    }\n+\n+    private boolean isAppNameHasColorWithoutSuffix(String appName) {\n+        return !appName.endsWith(ApplicationColor.BLUE.asSuffix()) && !appName.endsWith(ApplicationColor.GREEN.asSuffix())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMzQzNQ==", "bodyText": "The ApplicationCloudModelBuilder is complex enough without adding addition Live notation in it.\nHowever, if you think of a good way how to achieve the comments in the DeployedLiveModuleCalculator.java file, you would remove this Live notation and there will be no problem.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370023435", "createdAt": "2020-01-23T09:56:59Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -58,19 +58,20 @@\n     protected final DeploymentDescriptor deploymentDescriptor;\r\n     protected final boolean prettyPrinting;\r\n     protected final ApplicationEnvironmentCloudModelBuilder applicationEnvCloudModelBuilder;\r\n-    protected final DeployedMta deployedMta;\r\n+    protected final DeployedLiveModuleCalculator deployedLiveModuleCalculator;\r\n     protected final UserMessageLogger stepLogger;\r\n \r\n     protected final ParametersChainBuilder parametersChainBuilder;\r\n \r\n-    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting, DeployedMta deployedMta,\r\n-                                        String deployId, UserMessageLogger stepLogger) {\r\n+    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting,\r\n+                                        DeployedLiveModuleCalculator deployedLiveModuleCalculator, String deployId,\r\n+                                        UserMessageLogger stepLogger) {\r\n         HandlerFactory handlerFactory = createHandlerFactory();\r\n         this.handler = handlerFactory.getDescriptorHandler();\r\n         this.deploymentDescriptor = deploymentDescriptor;\r\n         this.prettyPrinting = prettyPrinting;\r\n         this.applicationEnvCloudModelBuilder = new ApplicationEnvironmentCloudModelBuilder(deploymentDescriptor, deployId, prettyPrinting);\r\n-        this.deployedMta = deployedMta;\r\n+        this.deployedLiveModuleCalculator = deployedLiveModuleCalculator;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyMzYzNg==", "bodyText": "Is there some case when deployedModules.get(0) will be reached?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370023636", "createdAt": "2020-01-23T09:57:23Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNDIzNQ==", "bodyText": "Can this deployedLiveModuleCalculator be null? If yes, when and why?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370024235", "createdAt": "2020-01-23T09:58:31Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -128,16 +129,16 @@ private ApplicationUrisCloudModelBuilder getApplicationUrisCloudModelBuilder(Lis\n \r\n     public List<String> getApplicationUris(Module module) {\r\n         List<Map<String, Object>> parametersList = parametersChainBuilder.buildModuleChain(module.getName());\r\n-        DeployedMtaModule deployedModule = findDeployedModule(deployedMta, module);\r\n+        DeployedMtaModule deployedModule = getDeployedMtaModule(module);\r\n         return getApplicationUrisCloudModelBuilder(parametersList).getApplicationUris(module, parametersList, deployedModule);\r\n     }\r\n \r\n-    protected <R> R parseParameters(List<Map<String, Object>> parametersList, ParametersParser<R> parser) {\r\n-        return parser.parse(parametersList);\r\n+    private DeployedMtaModule getDeployedMtaModule(Module module) {\r\n+        return deployedLiveModuleCalculator == null ? null : deployedLiveModuleCalculator.getLiveDeployedModule(module.getName());\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNjMyMg==", "bodyText": "Why do you need map here(expectedLiveDeployedModuleName), only the module names?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370026322", "createdAt": "2020-01-23T10:02:34Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculatorTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.common.util.MapUtil;\n+\n+public class DeployedLiveModuleCalculatorTest {\n+\n+    private static Stream<Arguments> testGetLiveDeployedModule() {\n+        return Stream.of(\n+        // @formatter:off\n+               // (1) Get module-1 from deployed modules [module-1, module-2]\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-2\", \"bar-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo-blue\")),\n+               // (2) Get live application in case where both blue and green are deployed\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, MapUtil.asMap(\"module-1\", \"foo-green\")),\n+               // (3) Get module-2 from deployed modules [module-1, module-2] without colors\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-2\", \"bar\")), null, MapUtil.asMap(\"module-2\", \"bar\")),\n+               // (4) Test without deployed mta\n+               Arguments.of(Collections.emptyList(), null, Collections.emptyMap()),\n+               // (5) Get application without color suffix when previous deployed color is BLUE\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo\")),\n+               // (6) Get live application (foo-green) when foo and foo-blue exists\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, \n+                            MapUtil.asMap(\"module-1\", \"foo-green\"))\n+        // @formatter:on\n+        );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void testGetLiveDeployedModule(List<Map<String, String>> deployedModulesNames, ApplicationColor deployedMtaColor,\n+                                          Map<String, String> expectedLiveDeployedModuleName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNjk1Mw==", "bodyText": "Why this is removed from here?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370026953", "createdAt": "2020-01-23T10:03:44Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/helpers/ApplicationColorDetector.java", "diffHunk": "@@ -26,8 +27,6 @@\n @Named(\"applicationColorDetector\")\n public class ApplicationColorDetector {\n \n-    private static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTk4NDMx", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-347198431", "createdAt": "2020-01-23T10:35:47Z", "commit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDozNTo0N1rOFg5mqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDozNTo0N1rOFg5mqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MjUzOQ==", "bodyText": "This should be in a separate commit, because it addresses a different issue.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370042539", "createdAt": "2020-01-23T10:35:47Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/helpers/ApplicationColorDetector.java", "diffHunk": "@@ -69,7 +68,7 @@ public ApplicationColor detectLiveApplicationColor(DeployedMta deployedMta, Stri\n         if (latestDeployedColor == null) {\n             return olderApplicationColor;\n         }\n-        return phase == Phase.UNDEPLOY ? latestDeployedColor : olderApplicationColor;\n+        return phase == Phase.UNDEPLOY ? latestDeployedColor : latestDeployedColor.getAlternativeColor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/07894bb67af21cbe69a4e990bc05bf4ef7cb7b19", "committedDate": "2020-01-22T15:30:10Z", "message": "Fix getting live application routes on bg-deploy\n\nAlso fix determine of live application color based on previous operation\nvariables\n\nJIRA:LMCROSSITXSADEPLOY-1875"}, "afterCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/44fb40a5942feec23455b7c7f3c888b78f1b241f", "committedDate": "2020-01-23T13:10:36Z", "message": "Fix getting live application routes on bg-deploy\n\nJIRA:LMCROSSITXSADEPLOY-1875"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzE5MDgx", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-347319081", "createdAt": "2020-01-23T14:05:05Z", "commit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDowNTowNVrOFg_QZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTozMjo1NVrOFhCj3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEzNTE0Mg==", "bodyText": "Why are the names being compared in a case-insensitive manner?\nWhat if there are 2 different modules, the names of which only differ in uppercase and lowercase letters?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370135142", "createdAt": "2020-01-23T14:05:05Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEzOTQ2OA==", "bodyText": "I don't understand the name of the method\nIt starts with isAppName, which leads me to believe that you are going to check something about the application name, ok, but then hasLiveDeployedColor is not a grammatically correct way to end the question.\nMaybe switch the words around, something like isLiveColorInAppName?\nBut also, this method is doing 2 things, checking if the name ends with the deployed color and if the name has no suffix. Split it into 2 methods", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370139468", "createdAt": "2020-01-23T14:12:46Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean isAppNameHasLiveDeployedColor(DeployedMtaModule deployedModule) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0MTgwOA==", "bodyText": "Again, the question is grammatically incorrect. If you stick with these words, an alternative is doesAppNameHaveColorWithoutSuffix.\nBut this method also checks 2 things.\nFirstly it checks the 'appName' that it is passed if it doesn't end in either suffix and checks something unrelated to the app name, the deployedMtaColor.\nI think the second check should be in a different method", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370141808", "createdAt": "2020-01-23T14:16:45Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        List<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                      .filter(deployedModule -> isModuleNamesEqual(deployedModule,\n+                                                                                                                   moduleName))\n+                                                                      .collect(Collectors.toList());\n+\n+        if (deployedModules.size() > 1 && deployedMtaColor != null) {\n+            return deployedModules.stream()\n+                                  .filter(this::isAppNameHasLiveDeployedColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.isEmpty() ? null : deployedModules.get(0);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNamesEqual(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean isAppNameHasLiveDeployedColor(DeployedMtaModule deployedModule) {\n+        String appName = deployedModule.getAppName();\n+        return appName.endsWith(deployedMtaColor.asSuffix()) || isAppNameHasColorWithoutSuffix(appName);\n+    }\n+\n+    private boolean isAppNameHasColorWithoutSuffix(String appName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0ODA5NQ==", "bodyText": "+1", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370148095", "createdAt": "2020-01-23T14:27:19Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -128,16 +129,16 @@ private ApplicationUrisCloudModelBuilder getApplicationUrisCloudModelBuilder(Lis\n \r\n     public List<String> getApplicationUris(Module module) {\r\n         List<Map<String, Object>> parametersList = parametersChainBuilder.buildModuleChain(module.getName());\r\n-        DeployedMtaModule deployedModule = findDeployedModule(deployedMta, module);\r\n+        DeployedMtaModule deployedModule = getDeployedMtaModule(module);\r\n         return getApplicationUrisCloudModelBuilder(parametersList).getApplicationUris(module, parametersList, deployedModule);\r\n     }\r\n \r\n-    protected <R> R parseParameters(List<Map<String, Object>> parametersList, ParametersParser<R> parser) {\r\n-        return parser.parse(parametersList);\r\n+    private DeployedMtaModule getDeployedMtaModule(Module module) {\r\n+        return deployedLiveModuleCalculator == null ? null : deployedLiveModuleCalculator.getLiveDeployedModule(module.getName());\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNDIzNQ=="}, "originalCommit": {"oid": "07894bb67af21cbe69a4e990bc05bf4ef7cb7b19"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0OTY5Ng==", "bodyText": "If the module name and app name pairs are the only entry in the maps, why not make a nested class for these two things, rather than creating maps each time?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370149696", "createdAt": "2020-01-23T14:30:02Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculatorTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.common.util.MapUtil;\n+\n+public class DeployedLiveModuleCalculatorTest {\n+\n+    private static Stream<Arguments> testGetLiveDeployedModule() {\n+        return Stream.of(\n+        // @formatter:off\n+               // (1) Get module-1 from deployed modules [module-1, module-2]\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-2\", \"bar-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo-blue\")),\n+               // (2) Get live application in case where both blue and green are deployed\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, MapUtil.asMap(\"module-1\", \"foo-green\")),\n+               // (3) Get module-2 from deployed modules [module-1, module-2] without colors\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-2\", \"bar\")), null, MapUtil.asMap(\"module-2\", \"bar\")),\n+               // (4) Test without deployed mta\n+               Arguments.of(Collections.emptyList(), null, Collections.emptyMap()),\n+               // (5) Get application without color suffix when previous deployed color is BLUE\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo\")),\n+               // (6) Get live application (foo-green) when foo and foo-blue exists\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, \n+                            MapUtil.asMap(\"module-1\", \"foo-green\"))\n+        // @formatter:on\n+        );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void testGetLiveDeployedModule(List<Map<String, String>> deployedModulesNames, ApplicationColor deployedMtaColor,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1MDMxMQ==", "bodyText": "Can this module be null?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370150311", "createdAt": "2020-01-23T14:30:53Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculatorTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.common.util.MapUtil;\n+\n+public class DeployedLiveModuleCalculatorTest {\n+\n+    private static Stream<Arguments> testGetLiveDeployedModule() {\n+        return Stream.of(\n+        // @formatter:off\n+               // (1) Get module-1 from deployed modules [module-1, module-2]\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-2\", \"bar-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo-blue\")),\n+               // (2) Get live application in case where both blue and green are deployed\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, MapUtil.asMap(\"module-1\", \"foo-green\")),\n+               // (3) Get module-2 from deployed modules [module-1, module-2] without colors\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-2\", \"bar\")), null, MapUtil.asMap(\"module-2\", \"bar\")),\n+               // (4) Test without deployed mta\n+               Arguments.of(Collections.emptyList(), null, Collections.emptyMap()),\n+               // (5) Get application without color suffix when previous deployed color is BLUE\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.BLUE, MapUtil.asMap(\"module-1\", \"foo\")),\n+               // (6) Get live application (foo-green) when foo and foo-blue exists\n+               Arguments.of(Arrays.asList(MapUtil.asMap(\"module-1\", \"foo\"), MapUtil.asMap(\"module-1\", \"foo-blue\"), MapUtil.asMap(\"module-1\", \"foo-green\")), ApplicationColor.GREEN, \n+                            MapUtil.asMap(\"module-1\", \"foo-green\"))\n+        // @formatter:on\n+        );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource\n+    public void testGetLiveDeployedModule(List<Map<String, String>> deployedModulesNames, ApplicationColor deployedMtaColor,\n+                                          Map<String, String> expectedLiveDeployedModuleName) {\n+        DeployedMta deployedMta = buildDeployedMta(deployedModulesNames);\n+        DeployedMtaModule expectedDeployedModule = buildDeployedModule(expectedLiveDeployedModuleName);\n+        String moduleName = expectedDeployedModule != null ? expectedDeployedModule.getModuleName() : \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4NTUxMA==", "bodyText": "I think this constant is better here, rather than in the calculator", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370185510", "createdAt": "2020-01-23T15:26:56Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/helpers/ApplicationColorDetector.java", "diffHunk": "@@ -104,7 +103,7 @@ private ApplicationColor getApplicationColor(DeployedMtaModule deployedMtaModule\n                      .filter(color -> deployedMtaModule.getAppName()\n                                                        .endsWith(color.asSuffix()))\n                      .findFirst()\n-                     .orElse(COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX);\n+                     .orElse(DeployedLiveModuleCalculator.COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODgyOA==", "bodyText": "Add a builder.\nThis many arguments is a bit much", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370188828", "createdAt": "2020-01-23T15:32:08Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -58,19 +58,20 @@\n     protected final DeploymentDescriptor deploymentDescriptor;\r\n     protected final boolean prettyPrinting;\r\n     protected final ApplicationEnvironmentCloudModelBuilder applicationEnvCloudModelBuilder;\r\n-    protected final DeployedMta deployedMta;\r\n+    protected final DeployedLiveModuleCalculator deployedLiveModuleCalculator;\r\n     protected final UserMessageLogger stepLogger;\r\n \r\n     protected final ParametersChainBuilder parametersChainBuilder;\r\n \r\n-    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting, DeployedMta deployedMta,\r\n-                                        String deployId, UserMessageLogger stepLogger) {\r\n+    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting,\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4OTI3OA==", "bodyText": "Maybe a better name would be LiveDeployedModuleCalculator", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370189278", "createdAt": "2020-01-23T15:32:55Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedLiveModuleCalculator.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedLiveModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedLiveModuleCalculator(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3OTM1OTE3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-347935917", "createdAt": "2020-01-24T12:57:37Z", "commit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjo1NzozN1rOFhc29g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMzowNzo0NVrOFhdGeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMDE1MA==", "bodyText": "The public modifier is redundant in an interface", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370620150", "createdAt": "2020-01-24T12:57:37Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedModuleCalculator.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public interface DeployedModuleCalculator {\n+\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMjgwNw==", "bodyText": "The change to DeployedModuleCalculator is good but with the Color suffix, not so much.\nMy suggestion is name the concrete class something like DeployedModuleCalculatorWithColor", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370622807", "createdAt": "2020-01-24T13:04:28Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/test/java/com/sap/cloud/lm/sl/cf/core/cf/v2/CloudModelBuilderTest.java", "diffHunk": "@@ -23,7 +23,7 @@\n import com.sap.cloud.lm.sl.cf.client.lib.domain.CloudApplicationExtended;\n import com.sap.cloud.lm.sl.cf.client.lib.domain.CloudServiceExtended;\n import com.sap.cloud.lm.sl.cf.core.cf.HandlerFactory;\n-import com.sap.cloud.lm.sl.cf.core.cf.util.DeployedLiveModuleCalculator;\n+import com.sap.cloud.lm.sl.cf.core.cf.util.DeployedModuleCalculatorColor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMzEzNA==", "bodyText": "Then write a custom builder", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370623134", "createdAt": "2020-01-24T13:05:17Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -58,19 +58,20 @@\n     protected final DeploymentDescriptor deploymentDescriptor;\r\n     protected final boolean prettyPrinting;\r\n     protected final ApplicationEnvironmentCloudModelBuilder applicationEnvCloudModelBuilder;\r\n-    protected final DeployedMta deployedMta;\r\n+    protected final DeployedLiveModuleCalculator deployedLiveModuleCalculator;\r\n     protected final UserMessageLogger stepLogger;\r\n \r\n     protected final ParametersChainBuilder parametersChainBuilder;\r\n \r\n-    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting, DeployedMta deployedMta,\r\n-                                        String deployId, UserMessageLogger stepLogger) {\r\n+    public ApplicationCloudModelBuilder(DeploymentDescriptor deploymentDescriptor, boolean prettyPrinting,\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODgyOA=="}, "originalCommit": {"oid": "44fb40a5942feec23455b7c7f3c888b78f1b241f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMzQyMQ==", "bodyText": "doesAppNameHaveColorSuffix", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370623421", "createdAt": "2020-01-24T13:05:58Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedModuleCalculatorColor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedModuleCalculatorColor implements DeployedModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedModuleCalculatorColor(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    @Override\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        Stream<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                        .filter(deployedModule -> isModuleNameMatching(deployedModule,\n+                                                                                                                       moduleName));\n+\n+        if (deployedMtaColor != null) {\n+            return deployedModules.filter(this::hasDeployedModuleContainLiveColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.findFirst()\n+                              .orElse(null);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNameMatching(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean hasDeployedModuleContainLiveColor(DeployedMtaModule deployedModule) {\n+        String appName = deployedModule.getAppName();\n+        return appName.endsWith(deployedMtaColor.asSuffix())\n+            || (hasDeployedModuleContainColorWithoutSuffix(appName) && doesDeployedColorMatchColorWithoutSuffix());\n+    }\n+\n+    private boolean hasDeployedModuleContainColorWithoutSuffix(String appName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMzY2Nw==", "bodyText": "doesDeployedModuleContainLiveColor", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370623667", "createdAt": "2020-01-24T13:06:34Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedModuleCalculatorColor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedModuleCalculatorColor implements DeployedModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedModuleCalculatorColor(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    @Override\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        Stream<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                        .filter(deployedModule -> isModuleNameMatching(deployedModule,\n+                                                                                                                       moduleName));\n+\n+        if (deployedMtaColor != null) {\n+            return deployedModules.filter(this::hasDeployedModuleContainLiveColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.findFirst()\n+                              .orElse(null);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {\n+        return deployedMta.getModules();\n+    }\n+\n+    private boolean isModuleNameMatching(DeployedMtaModule deployedModule, String moduleName) {\n+        return deployedModule.getModuleName()\n+                             .equalsIgnoreCase(moduleName);\n+    }\n+\n+    private boolean hasDeployedModuleContainLiveColor(DeployedMtaModule deployedModule) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyNDEyMg==", "bodyText": "I don't think the amount of uses and length (as an expression) of deployedMta.getModules warrants the need for this method. Just use it normally and delete this", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r370624122", "createdAt": "2020-01-24T13:07:45Z", "author": {"login": "radito3"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/util/DeployedModuleCalculatorColor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.sap.cloud.lm.sl.cf.core.cf.util;\n+\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMta;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public class DeployedModuleCalculatorColor implements DeployedModuleCalculator {\n+\n+    public static final ApplicationColor COLOR_OF_APPLICATIONS_WITHOUT_SUFFIX = ApplicationColor.BLUE;\n+\n+    private DeployedMta deployedMta;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    public DeployedModuleCalculatorColor(DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        this.deployedMta = deployedMta;\n+        this.deployedMtaColor = deployedMtaColor;\n+    }\n+\n+    @Override\n+    public DeployedMtaModule getLiveDeployedModule(String moduleName) {\n+        if (deployedMta == null) {\n+            return null;\n+        }\n+\n+        Stream<DeployedMtaModule> deployedModules = getDeployedModules().stream()\n+                                                                        .filter(deployedModule -> isModuleNameMatching(deployedModule,\n+                                                                                                                       moduleName));\n+\n+        if (deployedMtaColor != null) {\n+            return deployedModules.filter(this::hasDeployedModuleContainLiveColor)\n+                                  .findFirst()\n+                                  .orElse(null);\n+        }\n+\n+        return deployedModules.findFirst()\n+                              .orElse(null);\n+    }\n+\n+    private List<DeployedMtaModule> getDeployedModules() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f717e6da005ac9a4e23d04678af6cac1ba0df"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MDIzMTY3", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-348023167", "createdAt": "2020-01-24T15:18:20Z", "commit": {"oid": "5e5a4e6e8137664c9cfd64e0fad0ec656052f483"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e5a4e6e8137664c9cfd64e0fad0ec656052f483", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/5e5a4e6e8137664c9cfd64e0fad0ec656052f483", "committedDate": "2020-01-24T14:36:20Z", "message": "Refactor 2"}, "afterCommit": {"oid": "2dc66c5ace63680bcc0651ea9c33330bcc16a7fa", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/2dc66c5ace63680bcc0651ea9c33330bcc16a7fa", "committedDate": "2020-01-27T07:58:42Z", "message": "Refactor 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzE0NjYw", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-349314660", "createdAt": "2020-01-28T11:49:20Z", "commit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1MDoxNFrOFiiOZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyMjozN1rOFijC5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1NjY0NQ==", "bodyText": "It is nice with boolean but could we make it with enum or?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371756645", "createdAt": "2020-01-28T11:50:14Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/DeployedMtaModule.java", "diffHunk": "@@ -12,6 +12,7 @@\n     private List<String> services;\n     private List<String> providedDependencyNames;\n     private List<String> uris;\n+    private boolean isLive = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1NjkzMA==", "bodyText": "typo applicatioN", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371756930", "createdAt": "2020-01-28T11:50:58Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/message/Messages.java", "diffHunk": "@@ -418,6 +418,7 @@\n     public static final String ARCHIVE_IS_VERIFIED = \"Archive signature is verified\";\r\n     public static final String CHECKING_FOR_OVERWRITING_READ_ONLY_PARAMETERS = \"Checking for overwriting read-only parameters for mta with id: \\\"{0}\\\"\";\r\n     public static final String NO_READ_ONLY_PARAMETERS_ARE_OVERWRITTEN = \"No read-only parameters are overwritten\";\r\n+    public static final String MARKED_MODULE_AS_IDLE = \"Module \\\"{0}\\\" with applicatio name \\\"{1}\\\" was marked as idle\";\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NzY0Ng==", "bodyText": "Could we rename this method to doesDeployedModuleHaveIdleColor?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371767646", "createdAt": "2020-01-28T12:16:54Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DeployedModuleCalculatorWithColor.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.cf.process.helpers.ApplicationColorDetector;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public class DeployedModuleCalculatorWithColor implements DeployedModuleCalculator {\n+\n+    private List<DeployedMtaModule> deployedModules;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    private StepLogger stepLogger;\n+\n+    public DeployedModuleCalculatorWithColor(List<DeployedMtaModule> deployedModules, ApplicationColor deployedMtaColor,\n+                                             StepLogger stepLogger) {\n+        this.deployedModules = deployedModules;\n+        this.deployedMtaColor = deployedMtaColor;\n+        this.stepLogger = stepLogger;\n+    }\n+\n+    @Override\n+    public List<DeployedMtaModule> updateIdleDeployedModules() {\n+        return deployedModules.stream()\n+                              .map(this::setIdleModules)\n+                              .collect(Collectors.toList());\n+    }\n+\n+    private DeployedMtaModule setIdleModules(DeployedMtaModule deployedModule) {\n+        if (doesDeployedModuleNotContainLiveColor(deployedModule)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2OTgxNQ==", "bodyText": "Calculator is used for calculating one thing from two or more other things.\nYour class is taking one set of modules and it is returning the same set.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371769815", "createdAt": "2020-01-28T12:21:58Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DeployedModuleCalculator.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public interface DeployedModuleCalculator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2OTk5OA==", "bodyText": "Think of a better naming for this method", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371769998", "createdAt": "2020-01-28T12:22:23Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DeployedModuleCalculator.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+\n+public interface DeployedModuleCalculator {\n+\n+    List<DeployedMtaModule> updateIdleDeployedModules();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MDA4NA==", "bodyText": "Is this logic extensible?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371770084", "createdAt": "2020-01-28T12:22:37Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DeployedModuleCalculatorWithColor.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.cf.process.helpers.ApplicationColorDetector;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public class DeployedModuleCalculatorWithColor implements DeployedModuleCalculator {\n+\n+    private List<DeployedMtaModule> deployedModules;\n+\n+    private ApplicationColor deployedMtaColor;\n+\n+    private StepLogger stepLogger;\n+\n+    public DeployedModuleCalculatorWithColor(List<DeployedMtaModule> deployedModules, ApplicationColor deployedMtaColor,\n+                                             StepLogger stepLogger) {\n+        this.deployedModules = deployedModules;\n+        this.deployedMtaColor = deployedMtaColor;\n+        this.stepLogger = stepLogger;\n+    }\n+\n+    @Override\n+    public List<DeployedMtaModule> updateIdleDeployedModules() {\n+        return deployedModules.stream()\n+                              .map(this::setIdleModules)\n+                              .collect(Collectors.toList());\n+    }\n+\n+    private DeployedMtaModule setIdleModules(DeployedMtaModule deployedModule) {\n+        if (doesDeployedModuleNotContainLiveColor(deployedModule)) {\n+            deployedModule.setLive(false);\n+            stepLogger.debug(Messages.MARKED_MODULE_AS_IDLE, deployedModule.getModuleName(), deployedModule.getAppName());\n+        }\n+        return deployedModule;\n+    }\n+\n+    private boolean doesDeployedModuleNotContainLiveColor(DeployedMtaModule deployedModule) {\n+        String appName = deployedModule.getAppName();\n+        return !appName.endsWith(deployedMtaColor.asSuffix())\n+            && !(doesDeployedModuleContainColorWithoutSuffix(appName) && doesDeployedColorMatchColorWithoutSuffix());\n+    }\n+\n+    private boolean doesDeployedModuleContainColorWithoutSuffix(String appName) {\n+        return !appName.endsWith(ApplicationColor.BLUE.asSuffix()) && !appName.endsWith(ApplicationColor.GREEN.asSuffix());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305061f8d3ff34cacffbc44ed1d9a0d75690e45d"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mzg3MDU1", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-349387055", "createdAt": "2020-01-28T13:51:10Z", "commit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzo1MToxMFrOFilplw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDowMTo1M1rOFil_3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxMjc1OQ==", "bodyText": "Why rename from find to get?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371812759", "createdAt": "2020-01-28T13:51:10Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -128,16 +128,16 @@ private ApplicationUrisCloudModelBuilder getApplicationUrisCloudModelBuilder(Lis\n \r\n     public List<String> getApplicationUris(Module module) {\r\n         List<Map<String, Object>> parametersList = parametersChainBuilder.buildModuleChain(module.getName());\r\n-        DeployedMtaModule deployedModule = findDeployedModule(deployedMta, module);\r\n+        DeployedMtaModule deployedModule = getDeployedMtaModule(module);\r\n         return getApplicationUrisCloudModelBuilder(parametersList).getApplicationUris(module, parametersList, deployedModule);\r\n     }\r\n \r\n-    protected <R> R parseParameters(List<Map<String, Object>> parametersList, ParametersParser<R> parser) {\r\n-        return parser.parse(parametersList);\r\n+    private DeployedMtaModule getDeployedMtaModule(Module module) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxMzA0NA==", "bodyText": "Why is this not configurable? Why can't I pass the DeployedModuleLabel I want?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371813044", "createdAt": "2020-01-28T13:51:37Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -128,16 +128,16 @@ private ApplicationUrisCloudModelBuilder getApplicationUrisCloudModelBuilder(Lis\n \r\n     public List<String> getApplicationUris(Module module) {\r\n         List<Map<String, Object>> parametersList = parametersChainBuilder.buildModuleChain(module.getName());\r\n-        DeployedMtaModule deployedModule = findDeployedModule(deployedMta, module);\r\n+        DeployedMtaModule deployedModule = getDeployedMtaModule(module);\r\n         return getApplicationUrisCloudModelBuilder(parametersList).getApplicationUris(module, parametersList, deployedModule);\r\n     }\r\n \r\n-    protected <R> R parseParameters(List<Map<String, Object>> parametersList, ParametersParser<R> parser) {\r\n-        return parser.parse(parametersList);\r\n+    private DeployedMtaModule getDeployedMtaModule(Module module) {\r\n+        return deployedMta == null ? null : deployedMta.findLiveDeployedModule(module.getName());\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNjkzMQ==", "bodyText": "Rename to ProductizationState.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371816931", "createdAt": "2020-01-28T13:58:56Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/DeployedModuleLabel.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package com.sap.cloud.lm.sl.cf.core.model;\n+\n+public enum DeployedModuleLabel {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzMxMQ==", "bodyText": "Redundant prefix.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371817311", "createdAt": "2020-01-28T13:59:36Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/DeployedMtaModule.java", "diffHunk": "@@ -55,6 +56,10 @@ public Date getUpdatedOn() {\n         return uris;\n     }\n \n+    public DeployedModuleLabel getDeployedModuleLabel() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzY0OQ==", "bodyText": "The constant name suggests more generic message than the actual message is.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371817649", "createdAt": "2020-01-28T14:00:12Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/message/Messages.java", "diffHunk": "@@ -418,6 +418,7 @@\n     public static final String ARCHIVE_IS_VERIFIED = \"Archive signature is verified\";\r\n     public static final String CHECKING_FOR_OVERWRITING_READ_ONLY_PARAMETERS = \"Checking for overwriting read-only parameters for mta with id: \\\"{0}\\\"\";\r\n     public static final String NO_READ_ONLY_PARAMETERS_ARE_OVERWRITTEN = \"No read-only parameters are overwritten\";\r\n+    public static final String MODULE_WITH_APPLICATION_NAME_WAS_MARKED = \"Module \\\"{0}\\\" with application name \\\"{1}\\\" was marked as idle\";\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNzk1NQ==", "bodyText": "I need some explanation about this.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371817955", "createdAt": "2020-01-28T14:00:49Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/BlueGreenRenameStep.java", "diffHunk": "@@ -45,9 +49,12 @@ protected StepPhase executeStep(ExecutionWrapper execution) {\n             ApplicationColor liveMtaColor = getLiveApplicationColor(deployedMta, execution);\n             ApplicationColor idleMtaColor = liveMtaColor.getAlternativeColor();\n             getStepLogger().info(Messages.ASSUMED_LIVE_AND_IDLE_COLORS, liveMtaColor, idleMtaColor);\n+            deployedMtaColor = liveMtaColor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODA1NQ==", "bodyText": "This.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371818055", "createdAt": "2020-01-28T14:01:03Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/BlueGreenRenameStep.java", "diffHunk": "@@ -68,6 +75,16 @@ private ApplicationColor getLiveApplicationColor(DeployedMta deployedMta, Execut\n                                                                                                   .getVariable(Constants.VAR_CORRELATION_ID));\n     }\n \n+    private void setIdleModules(ExecutionWrapper execution, DeployedMta deployedMta, ApplicationColor deployedMtaColor) {\n+        if (deployedMta != null && deployedMtaColor != null) {\n+            List<DeployedMtaModule> updatedModules = new DetermineDeployedModuleLabelBasedOnColor(deployedMta.getModules(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODI1OQ==", "bodyText": "Using a verb for a class name.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371818259", "createdAt": "2020-01-28T14:01:26Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DetermineDeployedModuleLabel.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedModuleLabel;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public abstract class DetermineDeployedModuleLabel {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODM2OQ==", "bodyText": "The name of this method does not fit with the class.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371818369", "createdAt": "2020-01-28T14:01:39Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DetermineDeployedModuleLabel.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedModuleLabel;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public abstract class DetermineDeployedModuleLabel {\n+\n+    private List<DeployedMtaModule> deployedModules;\n+\n+    private StepLogger stepLogger;\n+\n+    public DetermineDeployedModuleLabel(List<DeployedMtaModule> deployedModules, StepLogger stepLogger) {\n+        this.deployedModules = deployedModules;\n+        this.stepLogger = stepLogger;\n+    }\n+\n+    public List<DeployedMtaModule> updateIdleDeployedModules() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODQ2MQ==", "bodyText": "Setters should not return values.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r371818461", "createdAt": "2020-01-28T14:01:53Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/DetermineDeployedModuleLabel.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaModule;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedModuleLabel;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public abstract class DetermineDeployedModuleLabel {\n+\n+    private List<DeployedMtaModule> deployedModules;\n+\n+    private StepLogger stepLogger;\n+\n+    public DetermineDeployedModuleLabel(List<DeployedMtaModule> deployedModules, StepLogger stepLogger) {\n+        this.deployedModules = deployedModules;\n+        this.stepLogger = stepLogger;\n+    }\n+\n+    public List<DeployedMtaModule> updateIdleDeployedModules() {\n+        return deployedModules.stream()\n+                              .map(this::setIdleModules)\n+                              .collect(Collectors.toList());\n+    }\n+\n+    private DeployedMtaModule setIdleModules(DeployedMtaModule deployedModule) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "702a0da8c0a42eaa3fa59568280f2da478fca654", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/702a0da8c0a42eaa3fa59568280f2da478fca654", "committedDate": "2020-01-28T15:31:50Z", "message": "Fix determine of live application color\n\nIn case where live and idle application are deployed and live application is not the older one could reflect to\nupdate the live application instead of idle application. This leads to\ndowntime of productive application.\n\nJIRA:LMCROSSITXSADEPLOY-1875"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da914a32db7dd8a800b2b488eadba2fe559b6b96", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/da914a32db7dd8a800b2b488eadba2fe559b6b96", "committedDate": "2020-01-28T13:39:20Z", "message": "Refactor 3"}, "afterCommit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/b0070c9969164f64e7042d2f9234ef72848e3612", "committedDate": "2020-01-28T16:37:39Z", "message": "Big Refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTI4NjQy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-349928642", "createdAt": "2020-01-29T08:25:38Z", "commit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwODoyNTozOFrOFi_9VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwODoyOToxNFrOFjAC4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0Mzc5Ng==", "bodyText": "Remove Live from the name of the method.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372243796", "createdAt": "2020-01-29T08:25:38Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -128,16 +128,17 @@ private ApplicationUrisCloudModelBuilder getApplicationUrisCloudModelBuilder(Lis\n \r\n     public List<String> getApplicationUris(Module module) {\r\n         List<Map<String, Object>> parametersList = parametersChainBuilder.buildModuleChain(module.getName());\r\n-        DeployedMtaModule deployedModule = findDeployedModule(deployedMta, module);\r\n+        DeployedMtaApplication deployedModule = findDeployedMtaModule(module);\r\n         return getApplicationUrisCloudModelBuilder(parametersList).getApplicationUris(module, parametersList, deployedModule);\r\n     }\r\n \r\n-    protected <R> R parseParameters(List<Map<String, Object>> parametersList, ParametersParser<R> parser) {\r\n-        return parser.parse(parametersList);\r\n+    private DeployedMtaApplication findDeployedMtaModule(Module module) {\r\n+        return deployedMta == null ? null\r\n+            : deployedMta.findLiveApplication(module.getName(), DeployedMtaApplication.ProductizationState.LIVE);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0NDEyMw==", "bodyText": "These are two separate checks. Use two filter() calls in the method above.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372244123", "createdAt": "2020-01-29T08:26:34Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.core/src/main/java/com/sap/cloud/lm/sl/cf/core/model/DeployedMta.java", "diffHunk": "@@ -63,12 +65,17 @@ public boolean equals(Object object) {\n         return Objects.equals(metadata, other.metadata);\r\n     }\r\n \r\n-    public DeployedMtaModule findDeployedModule(String moduleName) {\r\n+    public DeployedMtaApplication findLiveApplication(String moduleName, DeployedMtaApplication.ProductizationState state) {\r\n         return getModules().stream()\r\n-                           .filter(module -> module.getModuleName()\r\n-                                                   .equalsIgnoreCase(moduleName))\r\n+                           .filter(deployedApplication -> doesDeployedApplicationMatch(moduleName, deployedApplication, state))\r\n                            .findFirst()\r\n                            .orElse(null);\r\n     }\r\n \r\n+    private boolean doesDeployedApplicationMatch(String moduleName, DeployedMtaApplication deployedApplication, ProductizationState state) {\r\n+        return deployedApplication.getModuleName()\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0NTEwNQ==", "bodyText": "Why do we still need this check?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372245105", "createdAt": "2020-01-29T08:28:56Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ApplicationProductizationStateUpdaterColor.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaApplication;\n+import com.sap.cloud.lm.sl.cf.core.util.CloudModelBuilderUtil;\n+\n+public class ApplicationProductizationStateUpdaterColor extends ApplicationProductizationStateUpdater {\n+\n+    private ApplicationColor liveMtaColor;\n+\n+    public ApplicationProductizationStateUpdaterColor(List<DeployedMtaApplication> deployedApplications, ApplicationColor liveMtaColor,\n+                                                    StepLogger stepLogger) {\n+        super(deployedApplications, stepLogger);\n+        this.liveMtaColor = liveMtaColor;\n+    }\n+\n+    @Override\n+    protected boolean doesDeployedApplicationHasIdleLabel(DeployedMtaApplication deployedApplication) {\n+        String appName = deployedApplication.getAppName();\n+        return !(appName.endsWith(liveMtaColor.asSuffix())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI0NTIxOA==", "bodyText": "Shouldn't this be negated?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372245218", "createdAt": "2020-01-29T08:29:14Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ApplicationProductizationStateUpdaterColor.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.ApplicationColor;\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaApplication;\n+import com.sap.cloud.lm.sl.cf.core.util.CloudModelBuilderUtil;\n+\n+public class ApplicationProductizationStateUpdaterColor extends ApplicationProductizationStateUpdater {\n+\n+    private ApplicationColor liveMtaColor;\n+\n+    public ApplicationProductizationStateUpdaterColor(List<DeployedMtaApplication> deployedApplications, ApplicationColor liveMtaColor,\n+                                                    StepLogger stepLogger) {\n+        super(deployedApplications, stepLogger);\n+        this.liveMtaColor = liveMtaColor;\n+    }\n+\n+    @Override\n+    protected boolean doesDeployedApplicationHasIdleLabel(DeployedMtaApplication deployedApplication) {\n+        String appName = deployedApplication.getAppName();\n+        return !(appName.endsWith(liveMtaColor.asSuffix())\n+            || CloudModelBuilderUtil.getApplicationColor(deployedApplication) == liveMtaColor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0070c9969164f64e7042d2f9234ef72848e3612"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTUyOTQx", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-349952941", "createdAt": "2020-01-29T09:10:31Z", "commit": {"oid": "054a50eb742c8d90409aa6e72be04970ffc8ca7a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOToxMDozMlrOFjBIhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOToxMzoxMVrOFjBNUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2MzA0NQ==", "bodyText": "Why do we need Color at the end of the class name?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372263045", "createdAt": "2020-01-29T09:10:32Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/steps/BlueGreenRenameStep.java", "diffHunk": "@@ -68,6 +70,16 @@ private ApplicationColor getLiveApplicationColor(DeployedMta deployedMta, Execut\n                                                                                                   .getVariable(Constants.VAR_CORRELATION_ID));\n     }\n \n+    private void setIdleModules(ExecutionWrapper execution, DeployedMta deployedMta, ApplicationColor liveMtaColor) {\n+        if (deployedMta != null && liveMtaColor != null) {\n+            List<DeployedMtaApplication> updatedModules = new ApplicationProductizationStateUpdaterColor(deployedMta.getModules(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054a50eb742c8d90409aa6e72be04970ffc8ca7a"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2NDA4Ng==", "bodyText": "This state is only used in the updateIdleDeployedApplications method. Why not pass it as an argument to the method itself?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372264086", "createdAt": "2020-01-29T09:12:47Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ApplicationProductizationStateUpdater.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaApplication;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public abstract class ApplicationProductizationStateUpdater {\n+\n+    private List<DeployedMtaApplication> deployedModules;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054a50eb742c8d90409aa6e72be04970ffc8ca7a"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2NDI3Mw==", "bodyText": "The name of this method still does not match the name of the class.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#discussion_r372264273", "createdAt": "2020-01-29T09:13:11Z", "author": {"login": "nictas"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/util/ApplicationProductizationStateUpdater.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sap.cloud.lm.sl.cf.process.util;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.sap.cloud.lm.sl.cf.core.model.DeployedMtaApplication;\n+import com.sap.cloud.lm.sl.cf.process.message.Messages;\n+\n+public abstract class ApplicationProductizationStateUpdater {\n+\n+    private List<DeployedMtaApplication> deployedModules;\n+\n+    private StepLogger stepLogger;\n+\n+    public ApplicationProductizationStateUpdater(List<DeployedMtaApplication> deployedModules, StepLogger stepLogger) {\n+        this.deployedModules = deployedModules;\n+        this.stepLogger = stepLogger;\n+    }\n+\n+    public List<DeployedMtaApplication> updateIdleDeployedApplications() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054a50eb742c8d90409aa6e72be04970ffc8ca7a"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMDQ3OTYy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-350047962", "createdAt": "2020-01-29T11:49:43Z", "commit": {"oid": "054a50eb742c8d90409aa6e72be04970ffc8ca7a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "faea0fd54a1afee9913a9f9973f5668d39e3ea3b", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/faea0fd54a1afee9913a9f9973f5668d39e3ea3b", "committedDate": "2020-01-29T11:59:53Z", "message": "Rename part 2"}, "afterCommit": {"oid": "cdc532ab841d5a071ddcdbebdc4abfdcc3edb404", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/cdc532ab841d5a071ddcdbebdc4abfdcc3edb404", "committedDate": "2020-01-29T12:57:37Z", "message": "Rename part 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMDg5MzUy", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/734#pullrequestreview-350089352", "createdAt": "2020-01-29T13:04:58Z", "commit": {"oid": "cdc532ab841d5a071ddcdbebdc4abfdcc3edb404"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3555415fcf20b9de422dae2dcaa01bd78a37b46d", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/3555415fcf20b9de422dae2dcaa01bd78a37b46d", "committedDate": "2020-01-29T13:13:36Z", "message": "Fix getting live application routes on bg-deploy\n\nJIRA:LMCROSSITXSADEPLOY-1875"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdc532ab841d5a071ddcdbebdc4abfdcc3edb404", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/cdc532ab841d5a071ddcdbebdc4abfdcc3edb404", "committedDate": "2020-01-29T12:57:37Z", "message": "Rename part 2"}, "afterCommit": {"oid": "3555415fcf20b9de422dae2dcaa01bd78a37b46d", "author": {"user": {"login": "theghost5800", "name": "Kristian Atanasov"}}, "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/3555415fcf20b9de422dae2dcaa01bd78a37b46d", "committedDate": "2020-01-29T13:13:36Z", "message": "Fix getting live application routes on bg-deploy\n\nJIRA:LMCROSSITXSADEPLOY-1875"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 977, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}