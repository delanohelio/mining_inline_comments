{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2ODczNTUz", "number": 971, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoxNDo0NVrOEqY5VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNzowNTozM1rOEqaB2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODgzNTQxOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ApplicationCloudModelBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoxNDo0NVrOHckQrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoxNDo0NVrOHckQrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcxNjI2OQ==", "bodyText": "nice!", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499716269", "createdAt": "2020-10-05T16:14:45Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/main/java/org/cloudfoundry/multiapps/controller/core/cf/v2/ApplicationCloudModelBuilder.java", "diffHunk": "@@ -271,4 +283,67 @@ protected Resource getResource(String dependencyName) {\n     public DeploymentMode getDeploymentMode() {\n         return DeploymentMode.SEQUENTIAL;\n     }\n+\n+    protected abstract static class AbstractBuilder<T extends AbstractBuilder<T>> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODg4MTkxOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/data/termination/DataTerminationServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoyNjozMlrOHcktcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoyNjozMlrOHcktcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyMzYzNQ==", "bodyText": "Instead of these empty strings, is it possible to have dummy values, which could be more descriptive for the parameter? For example new ConfigurationEntry(\"test-providerNid\", \"test-providerId\", ...", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499723635", "createdAt": "2020-10-05T16:26:32Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/data/termination/DataTerminationServiceTest.java", "diffHunk": "@@ -136,20 +136,20 @@ private void prepareServices(List<String> deletedSpaces, boolean isExistSubscrip\n     }\n \n     private List<ConfigurationSubscription> generateSubscriptions(boolean isExistSubscriptionData) {\n-        return isExistSubscriptionData ? Collections.singletonList(new ConfigurationSubscription()) : Collections.emptyList();\n+        return isExistSubscriptionData ? List.of(new ConfigurationSubscription()) : Collections.emptyList();\n     }\n \n     private List<ConfigurationEntry> generatedConfigurationEntries(boolean isExistConfigurationEntryData) {\n         return isExistConfigurationEntryData\n-            ? Collections.singletonList(new ConfigurationEntry(\"\",\n-                                                               \"\",\n-                                                               Version.parseVersion(\"1\"),\n-                                                               \"default\",\n-                                                               new CloudTarget(),\n-                                                               \"\",\n-                                                               Collections.emptyList(),\n-                                                               \"\",\n-                                                               null))\n+            ? List.of(new ConfigurationEntry(\"\",\n+                                             \"\",\n+                                             Version.parseVersion(\"1\"),\n+                                             \"default\",\n+                                             new CloudTarget(),\n+                                             \"\",\n+                                             Collections.emptyList(),\n+                                             \"\",\n+                                             null))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODg5MTczOnYy", "diffSide": "RIGHT", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/token/JwtTokenParserTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoyOToxMVrOHckztA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoyOToxMVrOHckztA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNTIzNg==", "bodyText": "nice!", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499725236", "createdAt": "2020-10-05T16:29:11Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/security/token/JwtTokenParserTest.java", "diffHunk": "@@ -85,20 +81,12 @@ private UAAClient mockUaaClient(boolean callRealReadToken, String alghoritm, Str\n         }\n         if (alghoritm != null && alghoritmValue != null) {\n             Mockito.when(client.readTokenKey())\n-                   .thenReturn(new HashMap<String, Object>() {\n-                       private static final long serialVersionUID = 1L;\n-\n-                       {\n-                           put(\"alg\", alghoritm);\n-                           put(\"value\", alghoritmValue);\n-                       }\n-                   });\n+                   .thenReturn(Map.of(\"alg\", alghoritm, \"value\", alghoritmValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODg5Njk1OnYy", "diffSide": "RIGHT", "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/ParametersValidatorHelperTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjozMDozOVrOHck3HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjozMToyNFrOHck4uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjEwOQ==", "bodyText": "May use List.of again", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499726109", "createdAt": "2020-10-05T16:30:39Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/ParametersValidatorHelperTest.java", "diffHunk": "@@ -3,118 +3,101 @@\n import static org.junit.jupiter.api.Assertions.assertEquals;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n import java.util.TreeMap;\n+import java.util.stream.Stream;\n \n import org.cloudfoundry.multiapps.mta.model.Module;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n-@RunWith(Parameterized.class)\n-public class ParametersValidatorHelperTest {\n+class ParametersValidatorHelperTest {\n+\n+    private final List<ParameterValidator> validators = Arrays.asList(new HostValidator(), new DomainValidator(), new RoutesValidator(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjUyMA==", "bodyText": "And below in this file", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499726520", "createdAt": "2020-10-05T16:31:24Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-core/src/test/java/org/cloudfoundry/multiapps/controller/core/validators/parameters/ParametersValidatorHelperTest.java", "diffHunk": "@@ -3,118 +3,101 @@\n import static org.junit.jupiter.api.Assertions.assertEquals;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n import java.util.TreeMap;\n+import java.util.stream.Stream;\n \n import org.cloudfoundry.multiapps.mta.model.Module;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n \n-@RunWith(Parameterized.class)\n-public class ParametersValidatorHelperTest {\n+class ParametersValidatorHelperTest {\n+\n+    private final List<ParameterValidator> validators = Arrays.asList(new HostValidator(), new DomainValidator(), new RoutesValidator(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNjEwOQ=="}, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODkzODQ2OnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/StepsUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo0MjozMFrOHclRpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo0MjozMFrOHclRpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTczMjkwMA==", "bodyText": "Do you agree to extract the values passed to the constructor in separate variables in order to achieve better readability?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499732900", "createdAt": "2020-10-05T16:42:30Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-process/src/main/java/org/cloudfoundry/multiapps/controller/process/steps/StepsUtil.java", "diffHunk": "@@ -190,7 +197,12 @@ static ApplicationCloudModelBuilder getApplicationCloudModelBuilder(ProcessConte\n         DeployedMta deployedMta = context.getVariable(Variables.DEPLOYED_MTA);\n \n         return handlerFactory.getApplicationCloudModelBuilder(deploymentDescriptor, true, deployedMta, deployId, namespace,\n-                                                              context.getStepLogger());\n+                                                              context.getStepLogger(), getAppSuffixDeterminer(context));\n+    }\n+\n+    static AppSuffixDeterminer getAppSuffixDeterminer(ProcessContext context) {\n+        return new AppSuffixDeterminer(context.getVariable(Variables.KEEP_ORIGINAL_APP_NAMES_AFTER_DEPLOY),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyOTAyMTA2OnYy", "diffSide": "RIGHT", "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/PollServiceInProgressOperationsExecutionTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNzowNTozNFrOHcmFZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNzo1Mzo0MVrOHc6KsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0NjE0OA==", "bodyText": "Here are a lot of Arrays.asList", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r499746148", "createdAt": "2020-10-05T17:05:34Z", "author": {"login": "radoslav-d"}, "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/PollServiceInProgressOperationsExecutionTest.java", "diffHunk": "@@ -23,122 +26,103 @@\n import org.cloudfoundry.multiapps.controller.process.util.ServiceOperationGetter;\n import org.cloudfoundry.multiapps.controller.process.util.ServiceProgressReporter;\n import org.cloudfoundry.multiapps.controller.process.variables.Variables;\n-import org.junit.Before;\n-import org.junit.Rule;\n-import org.junit.rules.ExpectedException;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n import org.mockito.Mock;\n \n-@RunWith(Parameterized.class)\n-public class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n+class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n \n     private static final String TEST_SPACE_ID = \"test\";\n     private static final String TEST_PROVIDER = \"testProvider\";\n     private static final String TEST_PLAN = \"testPlan\";\n     private static final String TEST_VERSION = \"0.0.1-beta\";\n \n-    @Parameters\n-    public static Iterable<Object[]> getParameters() {\n-        return Arrays.asList(new Object[][] {\n+    @Mock\n+    private ServiceOperationGetter serviceOperationGetter;\n+    @Mock\n+    private ServiceProgressReporter serviceProgressReporter;\n+    @Mock\n+    private EventsGetter eventsGetter;\n+    @Mock\n+    private CloudControllerClient client;\n+\n+    private boolean shouldVerifyStepLogger;\n+    private AsyncExecutionState expectedExecutionState;\n+\n+    public static Stream<Arguments> testPollStateExecution() {\n+        return Stream.of(\n // @formatter:off\n             // (0) With 2 services in progress:\n-            {\n-                Arrays.asList(\"service1\",\"service2\", \"service3\"), \n-                Arrays.asList(ServiceOperation.Type.DELETE, ServiceOperation.Type.CREATE, ServiceOperation.Type.DELETE),\n-                Arrays.asList(ServiceOperation.State.IN_PROGRESS, ServiceOperation.State.SUCCEEDED, ServiceOperation.State.IN_PROGRESS), \n-                false, AsyncExecutionState.RUNNING, null\n-            },\n+            Arguments.of(Arrays.asList(\"service1\",\"service2\", \"service3\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NTE4NA==", "bodyText": "I've replaced them wherever was possible but there are several occurrences where null is passed to asList method and this cannot be replaced because List.of requires non-null objects.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/971#discussion_r500075184", "createdAt": "2020-10-06T07:53:41Z", "author": {"login": "IvanBorislavovDimitrov"}, "path": "multiapps-controller-process/src/test/java/org/cloudfoundry/multiapps/controller/process/steps/PollServiceInProgressOperationsExecutionTest.java", "diffHunk": "@@ -23,122 +26,103 @@\n import org.cloudfoundry.multiapps.controller.process.util.ServiceOperationGetter;\n import org.cloudfoundry.multiapps.controller.process.util.ServiceProgressReporter;\n import org.cloudfoundry.multiapps.controller.process.variables.Variables;\n-import org.junit.Before;\n-import org.junit.Rule;\n-import org.junit.rules.ExpectedException;\n-import org.junit.runner.RunWith;\n-import org.junit.runners.Parameterized;\n-import org.junit.runners.Parameterized.Parameters;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n import org.mockito.Mock;\n \n-@RunWith(Parameterized.class)\n-public class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n+class PollServiceInProgressOperationsExecutionTest extends AsyncStepOperationTest<CheckForOperationsInProgressStep> {\n \n     private static final String TEST_SPACE_ID = \"test\";\n     private static final String TEST_PROVIDER = \"testProvider\";\n     private static final String TEST_PLAN = \"testPlan\";\n     private static final String TEST_VERSION = \"0.0.1-beta\";\n \n-    @Parameters\n-    public static Iterable<Object[]> getParameters() {\n-        return Arrays.asList(new Object[][] {\n+    @Mock\n+    private ServiceOperationGetter serviceOperationGetter;\n+    @Mock\n+    private ServiceProgressReporter serviceProgressReporter;\n+    @Mock\n+    private EventsGetter eventsGetter;\n+    @Mock\n+    private CloudControllerClient client;\n+\n+    private boolean shouldVerifyStepLogger;\n+    private AsyncExecutionState expectedExecutionState;\n+\n+    public static Stream<Arguments> testPollStateExecution() {\n+        return Stream.of(\n // @formatter:off\n             // (0) With 2 services in progress:\n-            {\n-                Arrays.asList(\"service1\",\"service2\", \"service3\"), \n-                Arrays.asList(ServiceOperation.Type.DELETE, ServiceOperation.Type.CREATE, ServiceOperation.Type.DELETE),\n-                Arrays.asList(ServiceOperation.State.IN_PROGRESS, ServiceOperation.State.SUCCEEDED, ServiceOperation.State.IN_PROGRESS), \n-                false, AsyncExecutionState.RUNNING, null\n-            },\n+            Arguments.of(Arrays.asList(\"service1\",\"service2\", \"service3\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0NjE0OA=="}, "originalCommit": {"oid": "aa759616fe5fc587aa4da0bdcb594cebae7734f1"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 441, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}