{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5ODg1NjA2", "number": 718, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMToxNToxOVrODWOCkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMToyMzoyMVrODWOJcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjI1Mjk4OnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMToxNToxOVrOFa2lZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowOTowMFrOFbU_9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwMTYwNQ==", "bodyText": "For me an you leaf is an understandable word but not for the rest of the team.\nMaybe renaming it to child processes or subProcessLeafs would be better.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r363701605", "createdAt": "2020-01-07T11:15:19Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -113,6 +113,11 @@ public boolean hasDeadLetterJobs(String processId) {\n         return !getDeadLetterJobs(processId).isEmpty();\n     }\n \n+    private boolean haveAllLeafsHaveDeadLetterJobs(List<Execution> executions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE5OTkyNg==", "bodyText": "Done", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r364199926", "createdAt": "2020-01-08T12:09:00Z", "author": {"login": "boyan-velinov"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -113,6 +113,11 @@ public boolean hasDeadLetterJobs(String processId) {\n         return !getDeadLetterJobs(processId).isEmpty();\n     }\n \n+    private boolean haveAllLeafsHaveDeadLetterJobs(List<Execution> executions) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwMTYwNQ=="}, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjI2ODQyOnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMToyMjoyM1rOFa2uvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjoxMToyNVrOFbVDCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwMzk5OQ==", "bodyText": "This is a lot complexity: O(n^2).\nCould we revert the things like this:\n\nFind the execution which is related to the processInstanceId\nFind each executions which have parentId = processInstaceId || superExecutionId = processInstanceId\nDo 1 and 2, recursively for each execution foud in the step 2\nWould this work?\nThis way we would lower the complexity to O(nlogn)", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r363703999", "createdAt": "2020-01-07T11:22:23Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -268,6 +280,25 @@ public boolean isProcessInstanceAtReceiveTask(String processInstanceId) {\n                                    .collect(Collectors.toList());\n     }\n \n+    private List<Execution> getAllLeafExecutions(String processInstanceId) {\n+        List<Execution> allExecutions = getAllProcessExecutions(processInstanceId);\n+        return allExecutions.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIwMDcxNA==", "bodyText": "About the complexity I do agree.\nHowever, I am not sure if it worths to have recursion here in order to optimize a little bit when the code will not look nicer.", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r364200714", "createdAt": "2020-01-08T12:11:25Z", "author": {"login": "boyan-velinov"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -268,6 +280,25 @@ public boolean isProcessInstanceAtReceiveTask(String processInstanceId) {\n                                    .collect(Collectors.toList());\n     }\n \n+    private List<Execution> getAllLeafExecutions(String processInstanceId) {\n+        List<Execution> allExecutions = getAllProcessExecutions(processInstanceId);\n+        return allExecutions.stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwMzk5OQ=="}, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjI3MDU2OnYy", "diffSide": "RIGHT", "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMToyMzoyMVrOFa2wDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowOToxOFrOFbVAWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwNDMzNQ==", "bodyText": "What if there is a bug in the code? We would stay in the loop forever.\nMaybe giving it some time would be enough in order the executions to finish. For instance, 10 mins MAX or more?", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r363704335", "createdAt": "2020-01-07T11:23:21Z", "author": {"login": "enchobelezirev"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -230,6 +235,13 @@ public void deleteProcessInstance(String processInstanceId, String deleteReason)\n                 // different if the process has parallel executions.\n                 processEngine.getRuntimeService()\n                              .setVariable(processInstanceId, Constants.PROCESS_ABORTED, Boolean.TRUE);\n+                while (true) {\n+                    List<Execution> allLeafExecutions = getAllLeafExecutions(processInstanceId);\n+\n+                    if (haveAllLeafsHaveDeadLetterJobs(allLeafExecutions)) {\n+                        break;\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIwMDAyNg==", "bodyText": "Thanks for the idea!\nDone", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/718#discussion_r364200026", "createdAt": "2020-01-08T12:09:18Z", "author": {"login": "boyan-velinov"}, "path": "com.sap.cloud.lm.sl.cf.process/src/main/java/com/sap/cloud/lm/sl/cf/process/flowable/FlowableFacade.java", "diffHunk": "@@ -230,6 +235,13 @@ public void deleteProcessInstance(String processInstanceId, String deleteReason)\n                 // different if the process has parallel executions.\n                 processEngine.getRuntimeService()\n                              .setVariable(processInstanceId, Constants.PROCESS_ABORTED, Boolean.TRUE);\n+                while (true) {\n+                    List<Execution> allLeafExecutions = getAllLeafExecutions(processInstanceId);\n+\n+                    if (haveAllLeafsHaveDeadLetterJobs(allLeafExecutions)) {\n+                        break;\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcwNDMzNQ=="}, "originalCommit": {"oid": "5a45ed2608eaa55a0efbd5d76d529a9c32e2b326"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 568, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}