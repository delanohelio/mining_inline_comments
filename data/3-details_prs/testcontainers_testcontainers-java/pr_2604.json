{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTMyMDMx", "number": 2604, "title": "Use relative path for temp dirs in test", "bodyText": "For reasons I don't fully understand, DockerComposeContainer is failing to mount a directory when passed the absolute path form of temporary files created in AuthenticatedImagePullTest.\nThis only seems to happen on our Windows CI box, and I cannot reproduce locally on a Windows machine.\nConverting the temp file path to relative form fixes the CI failure.\nWe should work out how this issue was occurring as it seems like there's a small bug lurking somewhere. But as this is the first known occurrence, I think it's safe to assume it's a pretty rare problem.", "createdAt": "2020-04-22T20:34:27Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604", "merged": true, "mergeCommit": {"oid": "1e803b8f96272f463715f8560736cc4596b23a52"}, "closed": true, "closedAt": "2020-04-23T12:45:07Z", "author": {"login": "rnorth"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaOY01AH2gAyNDA3NTMyMDMxOjk3MWFmMWE5MjdjMjk5YjJiNjlhNTFkM2I2YWRmMGUyOTA0OWMzMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcab8GsAFqTM5OTA0Mjg3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/971af1a927c299b2b69a51d3b6adf0e29049c322", "committedDate": "2020-04-22T20:33:54Z", "message": "Use relative path for temp dirs in test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTA4OTg3", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#pullrequestreview-398908987", "createdAt": "2020-04-23T09:12:43Z", "commit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxMjo0M1rOGKfJig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxMjo0M1rOGKfJig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0OTI5MA==", "bodyText": "From Javadoc:\n     * <p> As with the {@code createTempFile} methods, this method is only\n     * part of a temporary-file facility. A {@link Runtime#addShutdownHook\n     * shutdown-hook}, or the {@link java.io.File#deleteOnExit} mechanism may be\n     * used to delete the directory automatically.\nLet's use deleteOnExit to avoid the leftovers", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413649290", "createdAt": "2020-04-23T09:12:43Z", "author": {"login": "bsideup"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +154,13 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    @NotNull\n+    private Path getLocalTempDir() throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/d081dbd9653fe7bcfcab74a01c4ae5968fc68a43", "committedDate": "2020-04-23T09:38:27Z", "message": "Ensure cleanup of temporary file/directory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTQ2ODcx", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#pullrequestreview-398946871", "createdAt": "2020-04-23T10:01:01Z", "commit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMDowMTowMlrOGKhL-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMDowMTowMlrOGKhL-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MjY4MA==", "bodyText": "IIRC Java does not support deleting non-empty directories. Let's change the order (file first, directory later) to at least give it a chance to empty :)", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413682680", "createdAt": "2020-04-23T10:01:02Z", "author": {"login": "bsideup"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDMxMzQ1", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#pullrequestreview-399031345", "createdAt": "2020-04-23T12:05:17Z", "commit": {"oid": "04bfb000bb63161648d700956693fbfa3d3e6b97"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjowNToxN1rOGKlycg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjowNToxN1rOGKlycg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1ODA2Ng==", "bodyText": "Files (or directories) are deleted in the reverse order that they are registered.\n\nI would say now it's wrong \ud83d\ude06", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413758066", "createdAt": "2020-04-23T12:05:17Z", "author": {"login": "kiview"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempFile.toFile().deleteOnExit();\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bfb000bb63161648d700956693fbfa3d3e6b97"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04bfb000bb63161648d700956693fbfa3d3e6b97", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/04bfb000bb63161648d700956693fbfa3d3e6b97", "committedDate": "2020-04-23T10:03:15Z", "message": "Invert deletion order"}, "afterCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/d081dbd9653fe7bcfcab74a01c4ae5968fc68a43", "committedDate": "2020-04-23T09:38:27Z", "message": "Ensure cleanup of temporary file/directory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDQxNjI2", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#pullrequestreview-399041626", "createdAt": "2020-04-23T12:19:30Z", "commit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDQyODc0", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#pullrequestreview-399042874", "createdAt": "2020-04-23T12:21:12Z", "commit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3367, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}