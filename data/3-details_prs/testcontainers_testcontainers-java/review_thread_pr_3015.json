{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2MTg4NjU0", "number": 3015, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo0NTowOVrOERw0hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wN1QxNDoyNDoyOVrOF7n8Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MDYxMTI1OnYy", "diffSide": "LEFT", "path": "core/src/main/java/org/testcontainers/containers/GenericContainer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo0NTowOVrOG2pbWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo0NTowOVrOG2pbWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk1NTAzNQ==", "bodyText": "No sure if it was made on purpose. The local variable hides the instance variable and seemed redundant.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r459955035", "createdAt": "2020-07-24T09:45:09Z", "author": {"login": "vcvitaly"}, "path": "core/src/main/java/org/testcontainers/containers/GenericContainer.java", "diffHunk": "@@ -867,7 +868,6 @@ public void setWaitStrategy(org.testcontainers.containers.wait.strategy.WaitStra\n      * @see #waitingFor(org.testcontainers.containers.wait.strategy.WaitStrategy)\n      */\n     protected void waitUntilContainerStarted() {\n-        org.testcontainers.containers.wait.strategy.WaitStrategy waitStrategy = getWaitStrategy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8038b2a1b7ba7649c91f390c25147ecccfea433"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2NDczNDU1OnYy", "diffSide": "RIGHT", "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQwOTowOToxNlrOIbtfqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xNVQxMjozMjo0NVrOIleBqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkyNzg0OQ==", "bodyText": "Just an idea:\nI wonder if Unreliables can be used in this case to reduce complexity of all that while sleep construction ? @bsideup @rnorth @kiview whats your opinion on that ?\nI know that it was historically written that way, but imho that would really helped if that test would be rewritten without any sleep in here", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r565927849", "createdAt": "2021-01-28T09:09:16Z", "author": {"login": "artjomka"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -122,25 +124,23 @@ public SELF withInitScript(String initScriptPath) {\n         return self();\n     }\n \n+    @SneakyThrows(InterruptedException.class)\n     @Override\n     protected void waitUntilContainerStarted() {\n         logger().info(\"Waiting for database connection to become available at {} using query '{}'\", getJdbcUrl(), getTestQueryString());\n \n         // Repeatedly try and open a connection to the DB and execute a test query\n         long start = System.currentTimeMillis();\n-        try {\n-            while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {\n-                try {\n-                    if (!isRunning()) {\n-                        Thread.sleep(100L);\n-                        continue; // Don't attempt to connect yet\n-                    }\n \n-                    try (Connection connection = createConnection(\"\")) {\n-                        boolean testQuerySucceeded = connection.createStatement().execute(this.getTestQueryString());\n-                        if (testQuerySucceeded) {\n-                            break;\n-                        }\n+        while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA5NTU2OA==", "bodyText": "This is a good question, maybe @rnorth has an idea, why Unrealiables isn't a good idea here. Else, I would suppose it is a good change.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r566095568", "createdAt": "2021-01-28T13:33:01Z", "author": {"login": "kiview"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -122,25 +124,23 @@ public SELF withInitScript(String initScriptPath) {\n         return self();\n     }\n \n+    @SneakyThrows(InterruptedException.class)\n     @Override\n     protected void waitUntilContainerStarted() {\n         logger().info(\"Waiting for database connection to become available at {} using query '{}'\", getJdbcUrl(), getTestQueryString());\n \n         // Repeatedly try and open a connection to the DB and execute a test query\n         long start = System.currentTimeMillis();\n-        try {\n-            while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {\n-                try {\n-                    if (!isRunning()) {\n-                        Thread.sleep(100L);\n-                        continue; // Don't attempt to connect yet\n-                    }\n \n-                    try (Connection connection = createConnection(\"\")) {\n-                        boolean testQuerySucceeded = connection.createStatement().execute(this.getTestQueryString());\n-                        if (testQuerySucceeded) {\n-                            break;\n-                        }\n+        while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkyNzg0OQ=="}, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ0NzkzMQ==", "bodyText": "I second that!", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r571447931", "createdAt": "2021-02-06T15:24:48Z", "author": {"login": "bsideup"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -122,25 +124,23 @@ public SELF withInitScript(String initScriptPath) {\n         return self();\n     }\n \n+    @SneakyThrows(InterruptedException.class)\n     @Override\n     protected void waitUntilContainerStarted() {\n         logger().info(\"Waiting for database connection to become available at {} using query '{}'\", getJdbcUrl(), getTestQueryString());\n \n         // Repeatedly try and open a connection to the DB and execute a test query\n         long start = System.currentTimeMillis();\n-        try {\n-            while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {\n-                try {\n-                    if (!isRunning()) {\n-                        Thread.sleep(100L);\n-                        continue; // Don't attempt to connect yet\n-                    }\n \n-                    try (Connection connection = createConnection(\"\")) {\n-                        boolean testQuerySucceeded = connection.createStatement().execute(this.getTestQueryString());\n-                        if (testQuerySucceeded) {\n-                            break;\n-                        }\n+        while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkyNzg0OQ=="}, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjE2MDE2OQ==", "bodyText": "I don't believe that Unreliables would work here since there is the clause:\ncatch (NoDriverFoundException e) {\n                    // we explicitly want this exception to fail fast without retries\n                    throw e;\n}\n\nand Unreliables waits until a timeout is reached no matter what. Don't have time now to check, but probably using Unreliables might make it only more complicated.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r576160169", "createdAt": "2021-02-15T12:32:45Z", "author": {"login": "vcvitaly"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -122,25 +124,23 @@ public SELF withInitScript(String initScriptPath) {\n         return self();\n     }\n \n+    @SneakyThrows(InterruptedException.class)\n     @Override\n     protected void waitUntilContainerStarted() {\n         logger().info(\"Waiting for database connection to become available at {} using query '{}'\", getJdbcUrl(), getTestQueryString());\n \n         // Repeatedly try and open a connection to the DB and execute a test query\n         long start = System.currentTimeMillis();\n-        try {\n-            while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {\n-                try {\n-                    if (!isRunning()) {\n-                        Thread.sleep(100L);\n-                        continue; // Don't attempt to connect yet\n-                    }\n \n-                    try (Connection connection = createConnection(\"\")) {\n-                        boolean testQuerySucceeded = connection.createStatement().execute(this.getTestQueryString());\n-                        if (testQuerySucceeded) {\n-                            break;\n-                        }\n+        while (System.currentTimeMillis() < start + (1000 * startupTimeoutSeconds)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkyNzg0OQ=="}, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2NDc2ODkwOnYy", "diffSide": "RIGHT", "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQwOToxNzoyNlrOIbt1IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQxMzozMTozOVrOIb3rTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkzMzM0NA==", "bodyText": "I wonder what exactly tan prefix means ? :)\nAlso I would suggest to use should prefix in test names for codebase consistency for example shouldThrowProperExceptionOnUnavailableConnection just as an idea", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r565933344", "createdAt": "2021-01-28T09:17:26Z", "author": {"login": "artjomka"}, "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package org.testcontainers.containers;\n+\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import lombok.NonNull;\n+import org.junit.Test;\n+import org.slf4j.Logger;\n+\n+import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n+import static org.mockito.Mockito.mock;\n+\n+public class JdbcDatabaseContainerTest {\n+\n+    @Test\n+    public void tanExceptionIsThrownIfJdbcIsNotAvailable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA5NDY3MA==", "bodyText": "I suppose this is a typo and it was supposed to mean anExceptionIsThrownIfJdbcIsNotAvailable \ud83d\ude42", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r566094670", "createdAt": "2021-01-28T13:31:39Z", "author": {"login": "kiview"}, "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package org.testcontainers.containers;\n+\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import lombok.NonNull;\n+import org.junit.Test;\n+import org.slf4j.Logger;\n+\n+import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n+import static org.mockito.Mockito.mock;\n+\n+public class JdbcDatabaseContainerTest {\n+\n+    @Test\n+    public void tanExceptionIsThrownIfJdbcIsNotAvailable() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTkzMzM0NA=="}, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwMTI1MzY4OnYy", "diffSide": "RIGHT", "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNlQxNToyNDoxNlrOIg-aaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xNVQxMjozNDoxMVrOIleE6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ0NzkxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void tanExceptionIsThrownIfJdbcIsNotAvailable() {\n          \n          \n            \n                public void anExceptionIsThrownIfJdbcIsNotAvailable() {", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r571447913", "createdAt": "2021-02-06T15:24:16Z", "author": {"login": "bsideup"}, "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package org.testcontainers.containers;\n+\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import lombok.NonNull;\n+import org.junit.Test;\n+import org.slf4j.Logger;\n+\n+import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n+import static org.mockito.Mockito.mock;\n+\n+public class JdbcDatabaseContainerTest {\n+\n+    @Test\n+    public void tanExceptionIsThrownIfJdbcIsNotAvailable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NjE2MTAwMw==", "bodyText": "Thanks, I committed the suggestion, that was just a typo, you are right.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r576161003", "createdAt": "2021-02-15T12:34:11Z", "author": {"login": "vcvitaly"}, "path": "modules/jdbc/src/test/java/org/testcontainers/containers/JdbcDatabaseContainerTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package org.testcontainers.containers;\n+\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import lombok.NonNull;\n+import org.junit.Test;\n+import org.slf4j.Logger;\n+\n+import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n+import static org.mockito.Mockito.mock;\n+\n+public class JdbcDatabaseContainerTest {\n+\n+    @Test\n+    public void tanExceptionIsThrownIfJdbcIsNotAvailable() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQ0NzkxMw=="}, "originalCommit": {"oid": "335fdec3df5915ca74a4171379e2e318b99fc87e"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk4MDY0Njk5OnYy", "diffSide": "RIGHT", "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wN1QxNDoyNDoyOVrOJXJb_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xMFQxNDoxNTo0MlrOJYPW6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODI1MTY0NA==", "bodyText": "Super tiny nit, but I think this can be reduced to:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            JdbcDatabaseContainer.this.getJdbcUrl())\n          \n          \n            \n                            this.getJdbcUrl())\n          \n      \n    \n    \n  \n\nOther than that though, and an unfortunate merge conflict that I don't have permission to resolve, I think this PR is fine.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r628251644", "createdAt": "2021-05-07T14:24:29Z", "author": {"login": "rnorth"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -151,12 +151,12 @@ protected void waitUntilContainerStarted() {\n                     Thread.sleep(100L);\n                 }\n             }\n-        } catch (InterruptedException e) {\n-            Thread.currentThread().interrupt();\n-            throw new ContainerLaunchException(\"Container startup wait was interrupted\", e);\n         }\n \n-        logger().info(\"Container is started (JDBC URL: {})\", JdbcDatabaseContainer.this.getJdbcUrl());\n+        throw new IllegalStateException(\n+            String.format(\"Container is started, but cannot be accessed by (JDBC URL: %s), please check container logs\",\n+                JdbcDatabaseContainer.this.getJdbcUrl())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e899dc4581bfc7943f1f44756a7c0d94f684ac18"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyOTM5NzIyNw==", "bodyText": "I updated that JdbcDatabaseContainer.this.getJdbcUrl()), also resolved the conflict. Thanks for the review.", "url": "https://github.com/testcontainers/testcontainers-java/pull/3015#discussion_r629397227", "createdAt": "2021-05-10T14:15:42Z", "author": {"login": "vcvitaly"}, "path": "modules/jdbc/src/main/java/org/testcontainers/containers/JdbcDatabaseContainer.java", "diffHunk": "@@ -151,12 +151,12 @@ protected void waitUntilContainerStarted() {\n                     Thread.sleep(100L);\n                 }\n             }\n-        } catch (InterruptedException e) {\n-            Thread.currentThread().interrupt();\n-            throw new ContainerLaunchException(\"Container startup wait was interrupted\", e);\n         }\n \n-        logger().info(\"Container is started (JDBC URL: {})\", JdbcDatabaseContainer.this.getJdbcUrl());\n+        throw new IllegalStateException(\n+            String.format(\"Container is started, but cannot be accessed by (JDBC URL: %s), please check container logs\",\n+                JdbcDatabaseContainer.this.getJdbcUrl())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyODI1MTY0NA=="}, "originalCommit": {"oid": "e899dc4581bfc7943f1f44756a7c0d94f684ac18"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1483, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}