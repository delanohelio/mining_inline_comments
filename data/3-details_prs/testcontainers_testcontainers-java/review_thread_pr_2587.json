{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NDcwMTIx", "number": 2587, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQwOTowOTo1OVrODzM5OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxOToyMDozMFrODzQQaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MDE1MjI0OnYy", "diffSide": "RIGHT", "path": "azure-pipelines.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQwOTowOTo1OVrOGHpdcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQwOTowOTo1OVrOGHpdcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY3MjQ5OQ==", "bodyText": "I think this is right, but obviously want to test it.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410672499", "createdAt": "2020-04-18T09:09:59Z", "author": {"login": "rnorth"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,38 @@\n jobs:\n-- job: core\n+\n+# Run a minimal set of tests in normal Linux pipeline builds\n+- job: minimal_core\n   steps:\n   - task: Gradle@2\n-    displayName: Build & test\n+    displayName: Build & test (minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n         options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        tasks: 'testcontainers:test --tests \"*GenericContainerRuleTest\"'\n         publishJUnitResults: true\n         testResultsFiles: '**/TEST-*.xml'\n   - script: wget -q https://get.cimate.io/release/linux/cimate && chmod +x cimate && ./cimate \"**/TEST-*.xml\"\n     condition: and(succeededOrFailed(),eq(variables['Agent.OS'], 'Linux'))\n-- job: jdbc\n+\n+# Run all tests when running the Windows CI tests\n+- job: full_build_windows\n+  condition: eq(variables['Agent.OS'], 'Windows')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7a4cc08643a4adfa8987ee4d22b7c76fb39ac2"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MDcwMzE1OnYy", "diffSide": "RIGHT", "path": "azure-pipelines.yml", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxOToyMDozMFrOGHtjhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQyMDozMToxN1rOGHt_7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczOTU5MQ==", "bodyText": "IIRC we can change it based on conditions (all on Windows, subset otherwise)", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410739591", "createdAt": "2020-04-18T19:20:30Z", "author": {"login": "bsideup"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,36 @@\n jobs:\n-- job: core\n+\n+- job: azure_pipeline_tests\n   steps:\n+\n+  # Run a minimal set of tests in normal Linux pipeline builds\n   - task: Gradle@2\n-    displayName: Build & test\n+    condition: eq(variables['Agent.OS'], 'Linux')\n+    displayName: Build & test (Linux - minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n-        options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        options: \"--no-daemon --continue\"\n+        tasks: \"testcontainers:test --tests GenericContainerRuleTest\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e60aba5780f49d9378e8faa49ad65727231d5b6c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MDgxMA==", "bodyText": "I thought so too, and have been scouring the documentation to try and find out how to do this, but so far no luck. Have you seen anything concrete?", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410740810", "createdAt": "2020-04-18T19:31:08Z", "author": {"login": "rnorth"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,36 @@\n jobs:\n-- job: core\n+\n+- job: azure_pipeline_tests\n   steps:\n+\n+  # Run a minimal set of tests in normal Linux pipeline builds\n   - task: Gradle@2\n-    displayName: Build & test\n+    condition: eq(variables['Agent.OS'], 'Linux')\n+    displayName: Build & test (Linux - minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n-        options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        options: \"--no-daemon --continue\"\n+        tasks: \"testcontainers:test --tests GenericContainerRuleTest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczOTU5MQ=="}, "originalCommit": {"oid": "e60aba5780f49d9378e8faa49ad65727231d5b6c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MDg4NQ==", "bodyText": "try https://docs.microsoft.com/en-us/azure/devops/pipelines/process/expressions?view=azure-devops#conditional-insertion", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410740885", "createdAt": "2020-04-18T19:31:56Z", "author": {"login": "bsideup"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,36 @@\n jobs:\n-- job: core\n+\n+- job: azure_pipeline_tests\n   steps:\n+\n+  # Run a minimal set of tests in normal Linux pipeline builds\n   - task: Gradle@2\n-    displayName: Build & test\n+    condition: eq(variables['Agent.OS'], 'Linux')\n+    displayName: Build & test (Linux - minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n-        options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        options: \"--no-daemon --continue\"\n+        tasks: \"testcontainers:test --tests GenericContainerRuleTest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczOTU5MQ=="}, "originalCommit": {"oid": "e60aba5780f49d9378e8faa49ad65727231d5b6c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0MTc3Ng==", "bodyText": "Aha, I'd missed that - cheers.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410741776", "createdAt": "2020-04-18T19:40:32Z", "author": {"login": "rnorth"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,36 @@\n jobs:\n-- job: core\n+\n+- job: azure_pipeline_tests\n   steps:\n+\n+  # Run a minimal set of tests in normal Linux pipeline builds\n   - task: Gradle@2\n-    displayName: Build & test\n+    condition: eq(variables['Agent.OS'], 'Linux')\n+    displayName: Build & test (Linux - minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n-        options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        options: \"--no-daemon --continue\"\n+        tasks: \"testcontainers:test --tests GenericContainerRuleTest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczOTU5MQ=="}, "originalCommit": {"oid": "e60aba5780f49d9378e8faa49ad65727231d5b6c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0Njg2MQ==", "bodyText": "The Agent.OS variable is not set at the point in time when conditional insertion takes place, so I was unable to set a variable.\nFor example:\nvariables:\n  ${{ if eq(variables['Agent.OS'], 'Linux') }}:\n    # Run minimal core subset of tests on Linux\n    tasks: \"testcontainers:test --tests GenericContainerRuleTest\"\n  ${{ if eq(variables['Agent.OS'], 'Windows_NT') }}:\n    # Run all checks on Windows\n    tasks: \"check\"\n\nwould effectively do nothing, because neither branch is actually true. The tasks variable was unset at the time of use in the Gradle@2 task, and caused an error when trying to use it.\nJust in case something else was the problem, I tried:\nvariables:\n  ${{ if eq(variables['Agent.OS'], 'Linux') }}:\n    # Run minimal core subset of tests on Linux\n    tasks: \"testcontainers:test --tests GenericContainerRuleTest\"\n  ${{ if ne(variables['Agent.OS'], 'Windows_NT') }}:\n    # Run all checks on Windows\n    tasks: \"check\"\n\n(the difference is ne, not eq, on the second branch).\nWith this, the tasks variable was set, but always to \"check\". So this demonstrates that the conditional insertion is working, and the placeholder resolution is working - the problem is just that Agent.OS is not set when the pipeline file is compiled, which is before it hits a build agent.\nI rolled back the branch to get rid of the messy trail of commits that I created while trying to figure this out! \ud83d\ude05", "url": "https://github.com/testcontainers/testcontainers-java/pull/2587#discussion_r410746861", "createdAt": "2020-04-18T20:31:17Z", "author": {"login": "rnorth"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -1,49 +1,36 @@\n jobs:\n-- job: core\n+\n+- job: azure_pipeline_tests\n   steps:\n+\n+  # Run a minimal set of tests in normal Linux pipeline builds\n   - task: Gradle@2\n-    displayName: Build & test\n+    condition: eq(variables['Agent.OS'], 'Linux')\n+    displayName: Build & test (Linux - minimal core)\n     env:\n       AWS_ACCESS_KEY_ID: $(aws.accessKeyId)\n       AWS_SECRET_ACCESS_KEY: $(aws.secretAccessKey)\n     inputs:\n         gradleWrapperFile: 'gradlew'\n         jdkVersionOption: '1.11'\n-        options: '--no-daemon --continue'\n-        tasks: 'testcontainers:check'\n+        options: \"--no-daemon --continue\"\n+        tasks: \"testcontainers:test --tests GenericContainerRuleTest\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczOTU5MQ=="}, "originalCommit": {"oid": "e60aba5780f49d9378e8faa49ad65727231d5b6c"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1567, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}