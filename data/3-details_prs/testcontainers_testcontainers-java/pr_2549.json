{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxOTU0Nzc2", "number": 2549, "title": "Support HTTP headers on HttpWaitStrategy", "bodyText": "This enables webservers that depend on headers for healthchecks to be able to correctly be queried by the HttpWaitStrategy.\nAs there are no unit tests for the HttpWaitStrategy I'm using the container logs as confirmation of the correct HTTP call execution.", "createdAt": "2020-04-10T15:31:18Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2549", "merged": true, "mergeCommit": {"oid": "51ee33bad751debcaf88a0e8b7d72818db3f6df1"}, "closed": true, "closedAt": "2021-02-06T16:28:36Z", "author": {"login": "renatomefi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWTK5hgFqTM5MTUxMzYwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABd3gFhmAH2gAyNDAxOTU0Nzc2OmM2ZTViMGQzZmVhZDUzMDNlMDhjMjdkNGNmYWI5MTczYTBjZDhlNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNTEzNjAx", "url": "https://github.com/testcontainers/testcontainers-java/pull/2549#pullrequestreview-391513601", "createdAt": "2020-04-10T15:48:19Z", "commit": {"oid": "72af46d9c101421bfd5822644bf6bc023246df50"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNTo0ODoxOVrOGD-Lcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNTo1MjoyNlrOGD-SOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgxNzY1MA==", "bodyText": "I am not that happy about adding this method.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2549#discussion_r406817650", "createdAt": "2020-04-10T15:48:19Z", "author": {"login": "kiview"}, "path": "core/src/test/java/org/testcontainers/junit/wait/strategy/AbstractWaitStrategyTest.java", "diffHunk": "@@ -118,4 +118,9 @@ protected void waitUntilReadyAndSucceed(GenericContainer container) {\n         assertTrue(String.format(\"Expected container to be ready after timeout of %sms\",\n             WAIT_TIMEOUT_MILLIS), ready.get());\n     }\n+\n+    protected String waitUntilReadyAndSucceedWithLogs(GenericContainer container) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72af46d9c101421bfd5822644bf6bc023246df50"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgxOTM4NQ==", "bodyText": "I would much prefer a black box test with a server requiring the headers.\nOn the other hand, if you want logs, you can just access the container, which is returned by startContainerWithCommand.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2549#discussion_r406819385", "createdAt": "2020-04-10T15:52:26Z", "author": {"login": "kiview"}, "path": "core/src/test/java/org/testcontainers/junit/wait/strategy/HttpWaitStrategyTest.java", "diffHunk": "@@ -30,6 +34,26 @@ public void testWaitUntilReadyWithSuccess() {\n         waitUntilReadyAndSucceed(createShellCommand(\"200 OK\", GOOD_RESPONSE_BODY));\n     }\n \n+    /**\n+     * Ensures that HTTP requests made with the HttpWaitStrategy can be enriched with user defined headers,\n+     * although the test web server does not depend on the header to response with a 200, by checking the\n+     * logs we can ensure the HTTP request was correctly sent.\n+     */\n+    @Test\n+    public void testWaitUntilReadyWithSuccessWithCustomHeaders() {\n+        HashMap<String, String> headers = new HashMap<>();\n+        headers.put(\"baz\", \"boo\");\n+        String logs = waitUntilReadyAndSucceedWithLogs(\n+            startContainerWithCommand(createShellCommand(\"200 OK\", GOOD_RESPONSE_BODY),\n+                createHttpWaitStrategy(ready)\n+                    .withHeader(\"foo\", \"bar\")\n+                    .withHeaders(headers)\n+            ));\n+\n+        assertThat(logs, containsString(\"foo: bar\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72af46d9c101421bfd5822644bf6bc023246df50"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72af46d9c101421bfd5822644bf6bc023246df50", "author": {"user": {"login": "renatomefi", "name": "Renato Mefi"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/72af46d9c101421bfd5822644bf6bc023246df50", "committedDate": "2020-04-10T15:29:21Z", "message": "Support HTTP headers on HttpWaitStrategy\n\nThis enables webservers that depend on headers for healthchecks to be\nable to correctly be queried by the HttpWaitStrategy."}, "afterCommit": {"oid": "f7f5af23674b732b080d02a6cc1cd729dccc9ca5", "author": {"user": {"login": "renatomefi", "name": "Renato Mefi"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/f7f5af23674b732b080d02a6cc1cd729dccc9ca5", "committedDate": "2020-04-12T10:53:42Z", "message": "Support HTTP headers on HttpWaitStrategy\n\nThis enables webservers that depend on headers for healthchecks to be\nable to correctly be queried by the HttpWaitStrategy."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "445c3dda51629f570a206852d2a60a4fbf292de7", "author": {"user": {"login": "renatomefi", "name": "Renato Mefi"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/445c3dda51629f570a206852d2a60a4fbf292de7", "committedDate": "2020-06-01T09:00:35Z", "message": "Support HTTP headers on HttpWaitStrategy\n\nThis enables webservers that depend on headers for healthchecks to be\nable to correctly be queried by the HttpWaitStrategy."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32ef287cd3dd0b808e0cc2106f008200286bcbe2", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/32ef287cd3dd0b808e0cc2106f008200286bcbe2", "committedDate": "2020-05-01T18:52:41Z", "message": "Merge branch 'master' into feature/http-wait-strategy-headers-support"}, "afterCommit": {"oid": "445c3dda51629f570a206852d2a60a4fbf292de7", "author": {"user": {"login": "renatomefi", "name": "Renato Mefi"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/445c3dda51629f570a206852d2a60a4fbf292de7", "committedDate": "2020-06-01T09:00:35Z", "message": "Support HTTP headers on HttpWaitStrategy\n\nThis enables webservers that depend on headers for healthchecks to be\nable to correctly be queried by the HttpWaitStrategy."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzQxOTE2", "url": "https://github.com/testcontainers/testcontainers-java/pull/2549#pullrequestreview-480741916", "createdAt": "2020-09-02T11:51:10Z", "commit": {"oid": "445c3dda51629f570a206852d2a60a4fbf292de7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6e5b0d3fead5303e08c27d4cfab9173a0cd8e40", "author": {"user": {"login": "bsideup", "name": "Sergei Egorov"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/c6e5b0d3fead5303e08c27d4cfab9173a0cd8e40", "committedDate": "2021-02-06T15:46:04Z", "message": "Merge branch 'master' into feature/http-wait-strategy-headers-support"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3392, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}