{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2Njg3OTc1", "number": 2363, "title": "Fix internal port check when other ports are opened as well on the target container", "bodyText": "This PR contains 2 commits. The first one is a trivial cleanup of a redundant execCreateCmd call. The second commit contains the actual fix. Description from the second commit:\nAllow leading zeros in /proc/net/tcp* when doing internal port listen check\n\nWhen at least one process is listening for a port that is significantly\nhigher then the port we're checking, this check will fail as the checked\nport will contain leading zeros in the output of \"cat /proc/net/tcp\".\n\nThis commit fixes this by changing the grep to \":0*XXX\".", "createdAt": "2020-02-18T15:39:04Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363", "merged": true, "mergeCommit": {"oid": "b437227a065e0bc1ff5f58e6bd88fbaef9b58343"}, "closed": true, "closedAt": "2020-03-10T06:32:18Z", "author": {"login": "codablock"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFyIvLAFqTM2MDkxMjkwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMMkkxgFqTM3MTcwNjI0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTEyOTA0", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#pullrequestreview-360912904", "createdAt": "2020-02-19T08:20:30Z", "commit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMDozMFrOFrerKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMDozMFrOFrerKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNTY1OQ==", "bodyText": "the warning is not relevant here, isn't it?", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#discussion_r381135659", "createdAt": "2020-02-19T08:20:30Z", "author": {"login": "bsideup"}, "path": "core/src/test/resources/internal-port-check-dockerfile/Dockerfile-bash", "diffHunk": "@@ -0,0 +1,12 @@\n+# If you ever upgrade this image, watch out for bash being installed by default in newer alpine base images", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTEzMTMz", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#pullrequestreview-360913133", "createdAt": "2020-02-19T08:20:58Z", "commit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMDo1OFrOFrer4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMDo1OFrOFrer4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNTg0MA==", "bodyText": "consider adding RUN that will test the absence of bash instead of a text warning", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#discussion_r381135840", "createdAt": "2020-02-19T08:20:58Z", "author": {"login": "bsideup"}, "path": "core/src/test/resources/internal-port-check-dockerfile/Dockerfile-tcp", "diffHunk": "@@ -0,0 +1,7 @@\n+# If you ever upgrade this image, watch out for bash being installed by default in newer alpine base images", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTEzODcz", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#pullrequestreview-360913873", "createdAt": "2020-02-19T08:22:26Z", "commit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMjoyNlrOFreuNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODoyMjoyNlrOFreuNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNjQzNg==", "bodyText": "You can keep @Rule if you move the container creation to constructor (JUnit supports parameterized constructors if I remember correctly)", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#discussion_r381136436", "createdAt": "2020-02-19T08:22:26Z", "author": {"login": "bsideup"}, "path": "core/src/test/java/org/testcontainers/containers/wait/internal/InternalCommandPortListeningCheckTest.java", "diffHunk": "@@ -1,25 +1,53 @@\n package org.testcontainers.containers.wait.internal;\n \n import com.google.common.collect.ImmutableSet;\n-import org.junit.Rule;\n+import org.junit.After;\n+import org.junit.Before;\n import org.junit.Test;\n-import org.testcontainers.containers.BindMode;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.images.builder.ImageFromDockerfile;\n \n+import static java.util.Arrays.asList;\n import static org.rnorth.visibleassertions.VisibleAssertions.assertFalse;\n import static org.rnorth.visibleassertions.VisibleAssertions.assertTrue;\n \n+@RunWith(Parameterized.class)\n public class InternalCommandPortListeningCheckTest {\n \n-    // Linking a custom configuration into the container so that nginx is listening on port 8080. This is necessary to prove\n-    // that the command formatting uses the correct casing for hexadecimal numbers (i.e. 1F90 and not 1f90).\n-    @Rule\n-    public GenericContainer nginx = new GenericContainer<>(\"nginx:1.9.4\")\n-            .withClasspathResourceMapping(\"nginx_on_8080.conf\", \"/etc/nginx/conf.d/default.conf\", BindMode.READ_ONLY);\n+    @Parameterized.Parameter\n+    public String dockerfile;\n+\n+    @Parameterized.Parameters(name = \"{index} - {0}\")\n+    public static Iterable<Object[]> data() {\n+        return asList(\n+            new Object[][]{\n+                {\"internal-port-check-dockerfile/Dockerfile-tcp\"},\n+                {\"internal-port-check-dockerfile/Dockerfile-nc\"},\n+                {\"internal-port-check-dockerfile/Dockerfile-bash\"},\n+            });\n+    }\n+\n+    public GenericContainer container;\n+\n+    @Before\n+    public void setUp() {\n+        container = new GenericContainer(new ImageFromDockerfile()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82be9da934c481a6474a3cef6045eece99c02cdd", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/82be9da934c481a6474a3cef6045eece99c02cdd", "committedDate": "2020-02-19T08:14:59Z", "message": "Add test for low+high ports\n\nThis test should fail without the leading zeros fix found a few commits\nbefore this one."}, "afterCommit": {"oid": "592cc2defb75dabd6fd377b6182926fc5ab118ab", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/592cc2defb75dabd6fd377b6182926fc5ab118ab", "committedDate": "2020-02-19T08:31:22Z", "message": "Check for bash existence instead of only mentioning it in a comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6be128996494bab1750808259317581ad572be3f", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/6be128996494bab1750808259317581ad572be3f", "committedDate": "2020-02-19T15:44:36Z", "message": "Wait a few seconds for InternalCommandPortListeningCheck to pass"}, "afterCommit": {"oid": "97f1695e7a371d94e8cd05682254db7361a4fbcd", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/97f1695e7a371d94e8cd05682254db7361a4fbcd", "committedDate": "2020-02-19T21:31:15Z", "message": "Wait a few seconds for InternalCommandPortListeningCheck to pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6c1b7f328f5bdd26fd5f0176b03a02470ae5575", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/b6c1b7f328f5bdd26fd5f0176b03a02470ae5575", "committedDate": "2020-02-24T13:26:40Z", "message": "Remove redundant execCreateCmd call\n\nThis one is never used and probably causes some garbage on the docker side."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7aeee7da16e1b6bed4e3165862ed12f3b9f495", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/1c7aeee7da16e1b6bed4e3165862ed12f3b9f495", "committedDate": "2020-02-24T13:26:40Z", "message": "Allow leading zeros in /proc/net/tcp* when doing internal port listen check\n\nWhen at least one process is listening for a port that is significantly\nhigher then the port we're checking, this check will fail as the checked\nport will contain leading zeros in the output of \"cat /proc/net/tcp\".\n\nThis commit fixes this by changing the grep to \":0*XXX\"."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ace0ebf245bd8b9e7e325ae8c074e4883e2d9f3", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/0ace0ebf245bd8b9e7e325ae8c074e4883e2d9f3", "committedDate": "2020-02-24T13:26:40Z", "message": "Surround grep parameter with '\n\nOtherwise unnecessary shell expansion is tried"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d22fa3e52691287272aa67dac7b43e0da1031b25", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/d22fa3e52691287272aa67dac7b43e0da1031b25", "committedDate": "2020-02-24T13:26:40Z", "message": "Refactor/Rewrite InternalCommandPortListeningCheckTest to test all possible checks\n\nThis commit refactors InternalCommandPortListeningCheckTest to work with\n3 different nginx based containers, each being able to only succeed one of\nthe 3 tests performed in InternalCommandPortListeningCheck. Each test is\nnow executed agains all 3 containers to ensure that all tests work as\nexpected."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee4e92c6fdcd50aa2688ba0c9136f0d2913983b3", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/ee4e92c6fdcd50aa2688ba0c9136f0d2913983b3", "committedDate": "2020-02-24T13:26:40Z", "message": "Add test for low+high ports\n\nThis test should fail without the leading zeros fix found a few commits\nbefore this one."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "365a9b0192c9884e6c19800c9ae1b9ac2d9d5add", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/365a9b0192c9884e6c19800c9ae1b9ac2d9d5add", "committedDate": "2020-02-24T13:26:40Z", "message": "Check for bash existence instead of only mentioning it in a comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "885df869c1ad96a2e207f0235b18fda2f5f13dd7", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/885df869c1ad96a2e207f0235b18fda2f5f13dd7", "committedDate": "2020-02-24T13:26:40Z", "message": "Rename nginx_on_8080.conf to nginx.conf\n\nIt's not only port 8080 anymore, so better not have it in the name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df12fc59bd3dfaf9cd6dea340f2c68c3e1351b5", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/4df12fc59bd3dfaf9cd6dea340f2c68c3e1351b5", "committedDate": "2020-02-24T13:26:40Z", "message": "Make container a @Rule again by moving initialization into contructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df6c38abf512161f24abc0b75e1bbe1f75b4d34b", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/df6c38abf512161f24abc0b75e1bbe1f75b4d34b", "committedDate": "2020-02-24T13:26:40Z", "message": "Wait a few seconds for InternalCommandPortListeningCheck to pass"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97f1695e7a371d94e8cd05682254db7361a4fbcd", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/97f1695e7a371d94e8cd05682254db7361a4fbcd", "committedDate": "2020-02-19T21:31:15Z", "message": "Wait a few seconds for InternalCommandPortListeningCheck to pass"}, "afterCommit": {"oid": "df6c38abf512161f24abc0b75e1bbe1f75b4d34b", "author": {"user": {"login": "codablock", "name": "Alexander Block"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/df6c38abf512161f24abc0b75e1bbe1f75b4d34b", "committedDate": "2020-02-24T13:26:40Z", "message": "Wait a few seconds for InternalCommandPortListeningCheck to pass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzA2MjQ0", "url": "https://github.com/testcontainers/testcontainers-java/pull/2363#pullrequestreview-371706244", "createdAt": "2020-03-10T06:31:59Z", "commit": {"oid": "df6c38abf512161f24abc0b75e1bbe1f75b4d34b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3426, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}