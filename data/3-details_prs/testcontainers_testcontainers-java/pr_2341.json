{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMzg0ODE0", "number": 2341, "title": "Show port mappings in HttpWaitStrategy", "bodyText": "Currently if an HttpWaitStrategy is used, we see an INFO level message like this:\nWaiting for 30 seconds for URL: http://localhost:32123/myapp\n\n(Where port 32123 is a randomly assigned mapped port)\nIt would be helpful if this log message also showed the original port number as well so we knew what port we were effectively waiting on like this:\nWaiting for 30 seconds for URL: http://localhost:32123/myapp (where 32123-->8080)", "createdAt": "2020-02-10T22:24:50Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2341", "merged": true, "mergeCommit": {"oid": "8f13e420f4d8934ad4c39b4104df1dac571b88a7"}, "closed": true, "closedAt": "2021-02-06T15:55:42Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDExlVAH2gAyMzczMzg0ODE0OjVkNmM3ZjU5ZjgyNGFlODUwNGViNGI4MmFhYzFjYzRhOGM2MWZkMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1c9nvgH2gAyMzczMzg0ODE0Ojc4YWU3NmNmMDcxOWFkYTQ3MzRmZTIyNTIwYjM4YThjNzQyODM1NmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d6c7f59f824ae8504eb4b82aac1cc4a8c61fd09", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/5d6c7f59f824ae8504eb4b82aac1cc4a8c61fd09", "committedDate": "2020-02-10T22:21:38Z", "message": "Show port mappings in HttpWaitStrategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bd3e6d8d262d79c575344b7e4e0c6f1502f553", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/96bd3e6d8d262d79c575344b7e4e0c6f1502f553", "committedDate": "2020-02-16T20:54:27Z", "message": "Merge branch 'master' into httpwait-port-logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjE4NDQ3", "url": "https://github.com/testcontainers/testcontainers-java/pull/2341#pullrequestreview-374218447", "createdAt": "2020-03-13T11:10:58Z", "commit": {"oid": "96bd3e6d8d262d79c575344b7e4e0c6f1502f553"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMToxMDo1OVrOF1_4QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMToxMDo1OVrOF1_4QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE2NTQ0MA==", "bodyText": "nit: could also be replaced with a stream :)\nint originalPort = waitStrategyTarget.getExposedPorts().stream()\n            .filter(it -> rawUri.getPort() == waitStrategyTarget.getMappedPort(it))\n            .findAny()\n            .orElse(-1);", "url": "https://github.com/testcontainers/testcontainers-java/pull/2341#discussion_r392165440", "createdAt": "2020-03-13T11:10:59Z", "author": {"login": "bsideup"}, "path": "core/src/main/java/org/testcontainers/containers/wait/strategy/HttpWaitStrategy.java", "diffHunk": "@@ -150,8 +150,17 @@ protected void waitUntilReady() {\n         if (null == livenessCheckPort || -1 == livenessCheckPort) {\n             return;\n         }\n-        final String uri = buildLivenessUri(livenessCheckPort).toString();\n-        log.info(\"{}: Waiting for {} seconds for URL: {}\", containerName, startupTimeout.getSeconds(), uri);\n+        final URI rawUri = buildLivenessUri(livenessCheckPort);\n+        // Un-map the port for logging\n+        int originalPort = -1;\n+        for (Integer exposedPort : waitStrategyTarget.getExposedPorts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd3e6d8d262d79c575344b7e4e0c6f1502f553"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjE4ODkw", "url": "https://github.com/testcontainers/testcontainers-java/pull/2341#pullrequestreview-374218890", "createdAt": "2020-03-13T11:11:49Z", "commit": {"oid": "96bd3e6d8d262d79c575344b7e4e0c6f1502f553"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMToxMTo0OVrOF1_5qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMToxMTo0OVrOF1_5qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE2NTgwMA==", "bodyText": "getMappedPort may throw, please make sure you handle it too", "url": "https://github.com/testcontainers/testcontainers-java/pull/2341#discussion_r392165800", "createdAt": "2020-03-13T11:11:49Z", "author": {"login": "bsideup"}, "path": "core/src/main/java/org/testcontainers/containers/wait/strategy/HttpWaitStrategy.java", "diffHunk": "@@ -150,8 +150,17 @@ protected void waitUntilReady() {\n         if (null == livenessCheckPort || -1 == livenessCheckPort) {\n             return;\n         }\n-        final String uri = buildLivenessUri(livenessCheckPort).toString();\n-        log.info(\"{}: Waiting for {} seconds for URL: {}\", containerName, startupTimeout.getSeconds(), uri);\n+        final URI rawUri = buildLivenessUri(livenessCheckPort);\n+        // Un-map the port for logging\n+        int originalPort = -1;\n+        for (Integer exposedPort : waitStrategyTarget.getExposedPorts()) {\n+            if (rawUri.getPort() == waitStrategyTarget.getMappedPort(exposedPort)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96bd3e6d8d262d79c575344b7e4e0c6f1502f553"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee4323fefcf1b5a96bd11a93c4731edaacf1646b", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/ee4323fefcf1b5a96bd11a93c4731edaacf1646b", "committedDate": "2020-07-13T19:36:42Z", "message": "Use stream to un-map exposed port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b1e3820a66e4b02eca33420dd13c8fcf1388750", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/9b1e3820a66e4b02eca33420dd13c8fcf1388750", "committedDate": "2020-07-13T19:37:03Z", "message": "Merge remote-tracking branch 'origin/master' into httpwait-port-logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ae76cf0719ada4734fe22520b38a8c7428356a", "author": {"user": {"login": "rnorth", "name": "Richard North"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/78ae76cf0719ada4734fe22520b38a8c7428356a", "committedDate": "2020-07-16T10:48:43Z", "message": "Catch and log failures when logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3424, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}