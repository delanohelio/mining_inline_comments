{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDk3ODgw", "number": 2579, "title": "Allow using LocalStackContainer with AWS SDK v2 #1442", "bodyText": "This PR exposes the generated URI from the getEndpointConfiguration(Service) method\nso it can be used by AWS SDK v2 methods.\nIt also exposes the default access key, secret key and region which is also required by the clients.\nAWS SDK v2 users will be able to use the container without additional changes as follows:\nS3Client s3 = S3Client\n             .builder()\n             .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))\n             .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\n                localstack.getDefaultAccessKey(), localstack.getDefaultSecretKey()\n             )))\n             .region(Region.of(localstack.getDefaultRegion()))\n             .build()", "createdAt": "2020-04-16T03:35:58Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579", "merged": true, "mergeCommit": {"oid": "12de2b407238835bdc06169a6ac4b7bdcc98e028"}, "closed": true, "closedAt": "2020-04-23T12:43:46Z", "author": {"login": "musketyr"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYEL8kAH2gAyNDA0MDk3ODgwOmFiZDMzOGQ1ZmEwOTY1ZDUwNGI2NjQ0ZDRkODdlZWQwYWY4MDJjYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaZwLnAFqTM5ODkzNjkxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abd338d5fa0965d504b6644d4d87eed0af802ca4", "author": {"user": {"login": "musketyr", "name": "Vladimir Orany"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/abd338d5fa0965d504b6644d4d87eed0af802ca4", "committedDate": "2020-04-16T03:32:56Z", "message": "Minimal changes to allow using LocalStackContainer with AWS SDK v2 #1442"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDAzNzcw", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#pullrequestreview-394403770", "createdAt": "2020-04-16T08:22:30Z", "commit": {"oid": "abd338d5fa0965d504b6644d4d87eed0af802ca4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODoyMjozMFrOGGaCcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODoyMjozMFrOGGaCcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM3MTI1MQ==", "bodyText": "perhaps we should use just getAccessKey here and in other methods", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#discussion_r409371251", "createdAt": "2020-04-16T08:22:30Z", "author": {"login": "bsideup"}, "path": "modules/localstack/src/main/java/org/testcontainers/containers/localstack/LocalStackContainer.java", "diffHunk": "@@ -124,10 +156,74 @@ public LocalStackContainer withServices(Service... services) {\n             .withCredentials(localstack.getDefaultCredentialsProvider())\n             .build();\n      </code></pre>\n+     * or for AWS SDK v2 you can use {@link #getDefaultAccessKey()}, {@link #getDefaultSecretKey()} directly:\n+     * <pre><code>S3Client s3 = S3Client\n+             .builder()\n+             .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))\n+             .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\n+             localstack.getDefaultAccessKey(), localstack.getDefaultSecretKey()\n+             )))\n+             .region(Region.of(localstack.getDefaultRegion()))\n+             .build()\n+     </code></pre>\n      * @return an {@link AWSCredentialsProvider}\n      */\n     public AWSCredentialsProvider getDefaultCredentialsProvider() {\n-        return new AWSStaticCredentialsProvider(new BasicAWSCredentials(\"accesskey\", \"secretkey\"));\n+        return new AWSStaticCredentialsProvider(new BasicAWSCredentials(getDefaultAccessKey(), getDefaultSecretKey()));\n+    }\n+\n+    /**\n+     * Provides a default access key that is preconfigured to communicate with a given simulated service.\n+     * The access key can be used to construct AWS SDK v2 clients:\n+     * <pre><code>S3Client s3 = S3Client\n+             .builder()\n+             .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))\n+             .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\n+             localstack.getDefaultAccessKey(), localstack.getDefaultSecretKey()\n+             )))\n+             .region(Region.of(localstack.getDefaultRegion()))\n+             .build()\n+     </code></pre>\n+     * @return a default access key\n+     */\n+    public String getDefaultAccessKey() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abd338d5fa0965d504b6644d4d87eed0af802ca4"}, "originalPosition": 113}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ff3fa12b78ec8dbca2bebb03168ab1e95ccf4d3", "author": {"user": {"login": "musketyr", "name": "Vladimir Orany"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/2ff3fa12b78ec8dbca2bebb03168ab1e95ccf4d3", "committedDate": "2020-04-16T08:26:34Z", "message": "removed `default` from the method names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d7ceb86969324ab0fba9d4240d5cc1f84154f6f", "author": {"user": {"login": "musketyr", "name": "Vladimir Orany"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/3d7ceb86969324ab0fba9d4240d5cc1f84154f6f", "committedDate": "2020-04-16T09:33:26Z", "message": "showcase test with AWS SDK S3 v2 client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba3a73cb48f61b665cd94940ace5ca750a07978b", "author": {"user": {"login": "musketyr", "name": "Vladimir Orany"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/ba3a73cb48f61b665cd94940ace5ca750a07978b", "committedDate": "2020-04-16T09:42:03Z", "message": "added example to the documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTk0MTIy", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#pullrequestreview-395994122", "createdAt": "2020-04-19T09:06:24Z", "commit": {"oid": "ba3a73cb48f61b665cd94940ace5ca750a07978b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwOTowNjoyNFrOGH0vXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwOTowNjoyNFrOGH0vXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg1NzMxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assertEquals(\"The created bucket has the right name\", \"foo\", bucket.name());\n          \n          \n            \n                        assertEquals(\"The created bucket has the right name\", \"foo\", bucket.name());\n          \n      \n    \n    \n  \n\nduplicate", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#discussion_r410857310", "createdAt": "2020-04-19T09:06:24Z", "author": {"login": "bsideup"}, "path": "modules/localstack/src/test/java/org/testcontainers/containers/localstack/LocalstackContainerTest.java", "diffHunk": "@@ -85,6 +92,34 @@ public void s3TestOverBridgeNetwork() throws IOException {\n             assertEquals(\"The object can be retrieved\", \"baz\", content);\n         }\n \n+        @Test\n+        public void s3TestOverBridgeNetworkV2() {\n+            S3Client s3 = S3Client\n+                .builder()\n+                .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))\n+                .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\n+                    localstack.getAccessKey(), localstack.getSecretKey()\n+                )))\n+                .region(Region.of(localstack.getRegion()))\n+                .build();\n+\n+            s3.createBucket(b -> b.bucket(\"foo\"));\n+            s3.putObject(b -> b.bucket(\"foo\").key(\"bar\"), RequestBody.fromBytes(\"baz\".getBytes()));\n+\n+            final List<software.amazon.awssdk.services.s3.model.Bucket> buckets = s3.listBuckets().buckets();\n+            assertEquals(\"The created bucket is present\", 1, buckets.size());\n+            final software.amazon.awssdk.services.s3.model.Bucket bucket = buckets.get(0);\n+\n+            assertEquals(\"The created bucket has the right name\", \"foo\", bucket.name());\n+            assertEquals(\"The created bucket has the right name\", \"foo\", bucket.name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3a73cb48f61b665cd94940ace5ca750a07978b"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTk0MTY3", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#pullrequestreview-395994167", "createdAt": "2020-04-19T09:07:03Z", "commit": {"oid": "ba3a73cb48f61b665cd94940ace5ca750a07978b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwOTowNzowM1rOGH0v7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwOTowNzowM1rOGH0v7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg1NzQ1NA==", "bodyText": "I think test's name is a bit too specific\ncould you please reduce the test to the minimum, so that it only tests that SDK v2 works fine?", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#discussion_r410857454", "createdAt": "2020-04-19T09:07:03Z", "author": {"login": "bsideup"}, "path": "modules/localstack/src/test/java/org/testcontainers/containers/localstack/LocalstackContainerTest.java", "diffHunk": "@@ -85,6 +92,34 @@ public void s3TestOverBridgeNetwork() throws IOException {\n             assertEquals(\"The object can be retrieved\", \"baz\", content);\n         }\n \n+        @Test\n+        public void s3TestOverBridgeNetworkV2() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba3a73cb48f61b665cd94940ace5ca750a07978b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "846c88973b933ecaf12429edd07bc17d6a6091d2", "author": {"user": {"login": "musketyr", "name": "Vladimir Orany"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/846c88973b933ecaf12429edd07bc17d6a6091d2", "committedDate": "2020-04-19T18:13:37Z", "message": "cleaned up Localstack spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTM2OTE3", "url": "https://github.com/testcontainers/testcontainers-java/pull/2579#pullrequestreview-398936917", "createdAt": "2020-04-23T09:48:22Z", "commit": {"oid": "846c88973b933ecaf12429edd07bc17d6a6091d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3400, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}