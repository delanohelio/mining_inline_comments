{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2NjQ4NDE2", "number": 2828, "title": "Use codeinclude for Elasticsearch Module", "bodyText": "use codeinclude for the elasticsearch module documentation\nmore details: #1158", "createdAt": "2020-06-02T15:08:54Z", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828", "merged": true, "mergeCommit": {"oid": "7278c496f4a6ad2cfdf79c187efae36fa35324f0"}, "closed": true, "closedAt": "2020-06-20T20:07:38Z", "author": {"login": "raynigon"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnWXBPgH2gAyNDI2NjQ4NDE2OmUxMmZlNTY5ZjJhNmJkNjM0M2JiNjRlMjg3OTNmZmIwMmM4OTYwNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcskckMAFqTQzMzYyMTk5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e12fe569f2a6bd6343bb64e28793ffb02c896067", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/e12fe569f2a6bd6343bb64e28793ffb02c896067", "committedDate": "2020-06-02T15:12:11Z", "message": "Use codeinclude #1158\n\nuse codeinclude for the elasticsearch module documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28d910b90d14106415addfc47ea8472d2d10c1d0", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/28d910b90d14106415addfc47ea8472d2d10c1d0", "committedDate": "2020-06-02T15:08:05Z", "message": "Use codeinclude #1158\n\nuse codeinclude for the elasticsearch module documentation"}, "afterCommit": {"oid": "e12fe569f2a6bd6343bb64e28793ffb02c896067", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/e12fe569f2a6bd6343bb64e28793ffb02c896067", "committedDate": "2020-06-02T15:12:11Z", "message": "Use codeinclude #1158\n\nuse codeinclude for the elasticsearch module documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzgyMjQ5", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828#pullrequestreview-422782249", "createdAt": "2020-06-02T15:15:23Z", "commit": {"oid": "e12fe569f2a6bd6343bb64e28793ffb02c896067"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxNToyM1rOGd2hVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNToxNToyM1rOGd2hVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1NTE1Nw==", "bodyText": "please use try-with-resources to make sure that stop() is executed even if some assert fails", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828#discussion_r433955157", "createdAt": "2020-06-02T15:15:23Z", "author": {"login": "bsideup"}, "path": "modules/elasticsearch/src/test/java/org/testcontainers/elasticsearch/ElasticsearchDocumentationTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package org.testcontainers.elasticsearch;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.io.IOException;\n+\n+import org.apache.http.HttpHost;\n+import org.apache.http.auth.AuthScope;\n+import org.apache.http.auth.UsernamePasswordCredentials;\n+import org.apache.http.client.CredentialsProvider;\n+import org.apache.http.impl.client.BasicCredentialsProvider;\n+import org.elasticsearch.action.admin.cluster.health.ClusterHealthResponse;\n+import org.elasticsearch.client.Request;\n+import org.elasticsearch.client.Response;\n+import org.elasticsearch.client.RestClient;\n+import org.elasticsearch.client.transport.TransportClient;\n+import org.elasticsearch.cluster.health.ClusterHealthStatus;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.transport.TransportAddress;\n+import org.elasticsearch.transport.client.PreBuiltTransportClient;\n+import org.junit.Test;\n+\n+public class ElasticsearchDocumentationTest {\n+\n+    @Test\n+    public void containerWithHttpClient() throws IOException {\n+        // httpClientContainerStart {\n+        // Create the elasticsearch container.\n+        ElasticsearchContainer container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch:6.4.1\");\n+\n+        // Start the container. This step might take some time...\n+        container.start();\n+\n+        // Do whatever you want with the rest client ...\n+        final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();\n+        credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(\"elastic\", \"changeme\"));\n+        RestClient restClient = RestClient.builder(HttpHost.create(container.getHttpHostAddress()))\n+            .setHttpClientConfigCallback(httpClientBuilder -> httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider))\n+            .build();\n+        Response response = restClient.performRequest(new Request(\"GET\", \"/\"));\n+        // }\n+        // Compare Result\n+        assertEquals(response.getStatusLine().getStatusCode(), 200);\n+\n+        // httpClientContainerStop {\n+        // Stop the container.\n+        container.stop();\n+        // }\n+    }\n+\n+    @Test\n+    public void containerWithTransportClient() {\n+        // Create the elasticsearch container.\n+        ElasticsearchContainer container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch:6.4.1\");\n+\n+        // Start the container. This step might take some time...\n+        container.start();\n+\n+        // transportClientContainerStart {\n+        // ... or the transport client\n+        TransportAddress transportAddress = new TransportAddress(container.getTcpHost());\n+        Settings settings = Settings.builder().put(\"cluster.name\", \"docker-cluster\").build();\n+        TransportClient transportClient = new PreBuiltTransportClient(settings)\n+            .addTransportAddress(transportAddress);\n+        ClusterHealthResponse healths = transportClient.admin().cluster().prepareHealth().get();\n+        // }\n+        // Compare Result\n+        assertEquals(ClusterHealthStatus.GREEN, healths.getStatus());\n+\n+        // Stop the container.\n+        container.stop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e12fe569f2a6bd6343bb64e28793ffb02c896067"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7ab51f14be5934560a520376756a0109f3a0e4a", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/b7ab51f14be5934560a520376756a0109f3a0e4a", "committedDate": "2020-06-02T15:31:00Z", "message": "implement review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a7130d6d00fb5b01e80b34474c198baeb086d0", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/27a7130d6d00fb5b01e80b34474c198baeb086d0", "committedDate": "2020-06-03T07:08:44Z", "message": "merge documentation to container tests #1158\n\nmodify container tests to reflect the code previously embedded in the documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c6c0d2972161dd0c1c90ca1a60f9aa94e0f4cb8", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/6c6c0d2972161dd0c1c90ca1a60f9aa94e0f4cb8", "committedDate": "2020-06-03T07:15:55Z", "message": "always use the current version of elasticsearch\n\nthe current version of elasticsearch should be used in the tests. To achieve this, the version can be determined by the version of the elasticsearch library which is included as a dependency."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70cbfb8e6cd32afcf8480ea62216cbe482fb9286", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/70cbfb8e6cd32afcf8480ea62216cbe482fb9286", "committedDate": "2020-06-03T07:19:17Z", "message": "update codeinclude naming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjkwNzk5", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828#pullrequestreview-423290799", "createdAt": "2020-06-03T07:34:25Z", "commit": {"oid": "70cbfb8e6cd32afcf8480ea62216cbe482fb9286"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzozNDoyNVrOGePnMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzozNDoyNVrOGePnMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2NjI1Ng==", "bodyText": "We should probably omit these assertions from the docs...", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828#discussion_r434366256", "createdAt": "2020-06-03T07:34:25Z", "author": {"login": "rnorth"}, "path": "modules/elasticsearch/src/test/java/org/testcontainers/elasticsearch/ElasticsearchContainerTest.java", "diffHunk": "@@ -92,11 +104,40 @@ public void elasticsearchOssImage() throws IOException {\n         }\n     }\n \n+    @Test\n+    public void restClientClusterHealth() throws IOException {\n+        // httpClientContainer {\n+        // Create the elasticsearch container.\n+        try (ElasticsearchContainer container = new ElasticsearchContainer()) {\n+            // Start the container. This step might take some time...\n+            container.start();\n+\n+            // Do whatever you want with the rest client ...\n+            final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();\n+            credentialsProvider.setCredentials(AuthScope.ANY,\n+                new UsernamePasswordCredentials(ELASTICSEARCH_USERNAME, ELASTICSEARCH_PASSWORD));\n+\n+            client = RestClient.builder(HttpHost.create(container.getHttpHostAddress()))\n+                .setHttpClientConfigCallback(httpClientBuilder -> httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider))\n+                .build();\n+\n+            Response response = client.performRequest(new Request(\"GET\", \"/_cluster/health\"));\n+            assertThat(response.getStatusLine().getStatusCode(), is(200));\n+            assertThat(EntityUtils.toString(response.getEntity()), containsString(\"cluster_name\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70cbfb8e6cd32afcf8480ea62216cbe482fb9286"}, "originalPosition": 108}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "922d9d3fb2d1829239b4b83bd04b161bb855b0f2", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/922d9d3fb2d1829239b4b83bd04b161bb855b0f2", "committedDate": "2020-06-06T08:37:37Z", "message": "remove asserts from documentation"}, "afterCommit": {"oid": "522c42d651e50376b779a5b3a94797737e06773a", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/522c42d651e50376b779a5b3a94797737e06773a", "committedDate": "2020-06-06T08:40:31Z", "message": "remove asserts from documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "522c42d651e50376b779a5b3a94797737e06773a", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/522c42d651e50376b779a5b3a94797737e06773a", "committedDate": "2020-06-06T08:40:31Z", "message": "remove asserts from documentation"}, "afterCommit": {"oid": "f073b9b2b6c5d61219b7ccc93361a7013f94dde3", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/f073b9b2b6c5d61219b7ccc93361a7013f94dde3", "committedDate": "2020-06-06T08:47:01Z", "message": "remove asserts from documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f073b9b2b6c5d61219b7ccc93361a7013f94dde3", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/f073b9b2b6c5d61219b7ccc93361a7013f94dde3", "committedDate": "2020-06-06T08:47:01Z", "message": "remove asserts from documentation"}, "afterCommit": {"oid": "8ada00de3e78c6a1f7445e0c966dc124a16705b3", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/8ada00de3e78c6a1f7445e0c966dc124a16705b3", "committedDate": "2020-06-06T08:49:53Z", "message": "remove asserts from documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed13b22f3ee6d93af153759bce78d10ac71548e2", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/ed13b22f3ee6d93af153759bce78d10ac71548e2", "committedDate": "2020-06-06T08:51:17Z", "message": "Merge branch 'master' into master"}, "afterCommit": {"oid": "fa31aabf9bf033d7093e7516a65c005c0ba72290", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/fa31aabf9bf033d7093e7516a65c005c0ba72290", "committedDate": "2020-06-06T08:54:29Z", "message": "remove asserts from documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf2bf3c80844417aed5090116c31e5f9dbbd922d", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/cf2bf3c80844417aed5090116c31e5f9dbbd922d", "committedDate": "2020-06-06T08:56:58Z", "message": "remove asserts from documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa31aabf9bf033d7093e7516a65c005c0ba72290", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/fa31aabf9bf033d7093e7516a65c005c0ba72290", "committedDate": "2020-06-06T08:54:29Z", "message": "remove asserts from documentation"}, "afterCommit": {"oid": "cf2bf3c80844417aed5090116c31e5f9dbbd922d", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/cf2bf3c80844417aed5090116c31e5f9dbbd922d", "committedDate": "2020-06-06T08:56:58Z", "message": "remove asserts from documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a0752b7721c6237e7860fca7762b83df5b6e4a", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/98a0752b7721c6237e7860fca7762b83df5b6e4a", "committedDate": "2020-06-07T07:42:48Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3305beccd891a38caac8d5038e97c1d0149517a2", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/3305beccd891a38caac8d5038e97c1d0149517a2", "committedDate": "2020-06-14T18:33:22Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbee344cec98f62b2b678b096c99b79a0ba4850e", "author": {"user": {"login": "raynigon", "name": "Simon Schneider"}}, "url": "https://github.com/testcontainers/testcontainers-java/commit/cbee344cec98f62b2b678b096c99b79a0ba4850e", "committedDate": "2020-06-18T20:12:20Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjIxOTkx", "url": "https://github.com/testcontainers/testcontainers-java/pull/2828#pullrequestreview-433621991", "createdAt": "2020-06-18T20:26:32Z", "commit": {"oid": "cbee344cec98f62b2b678b096c99b79a0ba4850e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3360, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}