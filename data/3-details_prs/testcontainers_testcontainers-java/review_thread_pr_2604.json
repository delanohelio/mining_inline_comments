{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTMyMDMx", "number": 2604, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxMjo0M1rOD1LmxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjowNToxN1rOD1P7-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MDkxMjY4OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxMjo0M1rOGKfJig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOTo0MToxOVrOGKgXjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0OTI5MA==", "bodyText": "From Javadoc:\n     * <p> As with the {@code createTempFile} methods, this method is only\n     * part of a temporary-file facility. A {@link Runtime#addShutdownHook\n     * shutdown-hook}, or the {@link java.io.File#deleteOnExit} mechanism may be\n     * used to delete the directory automatically.\nLet's use deleteOnExit to avoid the leftovers", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413649290", "createdAt": "2020-04-23T09:12:43Z", "author": {"login": "bsideup"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +154,13 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    @NotNull\n+    private Path getLocalTempDir() throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2MzAzMA==", "bodyText": "Bleurgh, of course. Thanks.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413663030", "createdAt": "2020-04-23T09:32:16Z", "author": {"login": "rnorth"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +154,13 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    @NotNull\n+    private Path getLocalTempDir() throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0OTI5MA=="}, "originalCommit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2OTI2MA==", "bodyText": "Replaced with an implementation that deletes both at exit.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413669260", "createdAt": "2020-04-23T09:41:19Z", "author": {"login": "rnorth"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +154,13 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    @NotNull\n+    private Path getLocalTempDir() throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0OTI5MA=="}, "originalCommit": {"oid": "971af1a927c299b2b69a51d3b6adf0e29049c322"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MTEyNzU0OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMDowMTowMlrOGKhL-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjoxNDozN1rOGKmJSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MjY4MA==", "bodyText": "IIRC Java does not support deleting non-empty directories. Let's change the order (file first, directory later) to at least give it a chance to empty :)", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413682680", "createdAt": "2020-04-23T10:01:02Z", "author": {"login": "bsideup"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MzkyMA==", "bodyText": "I'm not sure it cares (no errors evident, and nothing gets left over), but sure :)", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413683920", "createdAt": "2020-04-23T10:02:54Z", "author": {"login": "rnorth"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MjY4MA=="}, "originalCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1Njc0Ng==", "bodyText": "AFAIK @bsideup is right about this, but on the other hand, it should throw IOException if it fails to delete. Weird...", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413756746", "createdAt": "2020-04-23T12:03:09Z", "author": {"login": "kiview"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MjY4MA=="}, "originalCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2MzkxMw==", "bodyText": "TL;DR, counterintuitively the original form of the code was OK.", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413763913", "createdAt": "2020-04-23T12:14:37Z", "author": {"login": "rnorth"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4MjY4MA=="}, "originalCommit": {"oid": "d081dbd9653fe7bcfcab74a01c4ae5968fc68a43"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MTYyMjMyOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjowNToxN1rOGKlycg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjoxODoyNVrOGKmS3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1ODA2Ng==", "bodyText": "Files (or directories) are deleted in the reverse order that they are registered.\n\nI would say now it's wrong \ud83d\ude06", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413758066", "createdAt": "2020-04-23T12:05:17Z", "author": {"login": "kiview"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempFile.toFile().deleteOnExit();\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bfb000bb63161648d700956693fbfa3d3e6b97"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2NjM2Nw==", "bodyText": "Reverted \ud83d\ude05", "url": "https://github.com/testcontainers/testcontainers-java/pull/2604#discussion_r413766367", "createdAt": "2020-04-23T12:18:25Z", "author": {"login": "rnorth"}, "path": "core/src/test/java/org/testcontainers/utility/AuthenticatedImagePullTest.java", "diffHunk": "@@ -153,6 +151,18 @@ public void testThatAuthLocatorIsUsedForDockerComposePull() throws IOException {\n         }\n     }\n \n+    private Path getLocalTempFile(String s) throws IOException {\n+        Path projectRoot = Paths.get(\".\");\n+        Path tempDirectory = Files.createTempDirectory(projectRoot, this.getClass().getSimpleName() + \"-test-\");\n+        Path relativeTempDirectory = projectRoot.relativize(tempDirectory);\n+        Path tempFile = Files.createTempFile(relativeTempDirectory, \"test\", s);\n+\n+        tempFile.toFile().deleteOnExit();\n+        tempDirectory.toFile().deleteOnExit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1ODA2Ng=="}, "originalCommit": {"oid": "04bfb000bb63161648d700956693fbfa3d3e6b97"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1509, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}