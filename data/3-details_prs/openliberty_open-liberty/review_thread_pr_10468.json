{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODQwMzQy", "number": 10468, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NToyN1rODbUPIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NzowOVrODbUROw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTY5Njk2OnYy", "diffSide": "RIGHT", "path": "dev/wlp-gradle/subprojects/fat.gradle", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NToyN1rOFiuyUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NToyN1rOFiuyUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MjQ1MQ==", "bodyText": "I don't believe this is needed, any properties that start with fat.* or test.* should get added already up on line 209.\nIf this is needed because System.getProperties() has things that bndWorkspace.getProject(project.getProjectDir()).getProperties() doesn't, then we should add a generic mechanism for System properties in the same way we do for bnd project properties", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#discussion_r371962451", "createdAt": "2020-01-28T17:55:27Z", "author": {"login": "aguibert"}, "path": "dev/wlp-gradle/subprojects/fat.gradle", "diffHunk": "@@ -214,6 +214,14 @@ task autoFVT {\n     bndProps.setProperty('fat.minimum.java.level', minJavaLevel)\n     bndProps.setProperty('micro.version', bnd('libertyBundleMicroVersion'))\n     \n+    // Add in database rotation properties, if they are present", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTcwMjM1OnYy", "diffSide": "RIGHT", "path": "dev/fattest.simplicity/autoFVT-defaults/src/ant/launch.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NzowOVrOFiu10g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NzowOVrOFiu10g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MzM0Ng==", "bodyText": "Will these lines print out every time someone runs a FAT locally now? If so, I don't think it's necessary to log this much information on the \"normal\" path", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#discussion_r371963346", "createdAt": "2020-01-28T17:57:09Z", "author": {"login": "aguibert"}, "path": "dev/fattest.simplicity/autoFVT-defaults/src/ant/launch.xml", "diffHunk": "@@ -90,23 +87,77 @@\n \t\t\t<entry key=\"preferJIIWSWsAdmin\" value=\"${simplicity.preferJIIWSWsAdmin}\" />\n \t\t</propertyfile>\n \t\t\n-\t\t<!-- Work out the actual entry point based on the current java level -->\n+\t\t<!-- Work out the actual entry point based on the current java level and database properties -->\n \t\t<echo message=\"Checking min java level for project based on bootstrapping.properties file...\" />\n+\t\t\n+\t\t<!-- Get fat.test.databases and fat.minimum.java.level properties-->\n+\t\t<property file=\"${basedir}/fat.bnd.properties\" />\n+\t\t\n+\t\t<!-- Enforce fat.test.databases.only rule.  If bucket is not enlisted in database rotation skip it -->\n+\t\t<condition property=\"skip.no.db.tests\" value=\"true\">\n+\t\t\t<and>\n+\t\t\t\t<istrue value=\"${fat.test.databases.only}\" />\n+\t\t\t\t<not><isTrue value=\"${fat.test.databases}\" /></not>\n+\t\t\t</and>\n+\t\t</condition>\n+\t\t\n+\t\t<!-- If a specific DB is being used, include it later in the bucket name -->\n+    \t<condition property=\"suite.db.type\" value=\" with ${fat.bucket.db.type}\" else=\"\">\n+    \t\t<and>\n+    \t\t\t<istrue value=\"${fat.test.databases}\" />\n+    \t\t\t<isset property=\"fat.bucket.db.type\" />\n+    \t\t</and>\n+    \t</condition>\n \t\t            \n-        <!-- If this test is compiled with a java level higher than the one we're currently running, -->\n-        <!-- bypass the tests by invoking the always passes test instead of real FAT tests -->\n-        <property file=\"${basedir}/fat.bnd.properties\" />\n+        <!-- Enforce fat.minimum.java.level rule. If this test is compiled with a java level \n+           higher than the one we're currently running we should skip these tests. -->\n \t\t<script language=\"javascript\"> <![CDATA[\n-\t\t\tvar testBucketClassForLowJava = \"componenttest.custom.junit.runner.AlwaysPassesTest\";\n \t\t\tvar minTestJava = project.getProperty(\"fat.minimum.java.level\");\n \t\t\tvar javaVersion = parseFloat(project.getProperty(\"java.specification.version\"));\n \t\t\tif(minTestJava != null && javaVersion < parseFloat(minTestJava))\n-\t\t\t  project.setProperty(\"test.bucket.class\", testBucketClassForLowJava);\n+\t\t\t\tproject.setProperty(\"skip.java.level\", true);\n         ]]></script>\n+\t\t\n+\t\t<!-- Output java level info -->\n         <echo message=\"fat.minimum.java.level=${fat.minimum.java.level}\"/>\n         <echo message=\"java.specification.version=${java.specification.version}\"/>\n-        <echo message=\"FAT entry point will be: ${test.bucket.class}\"/>\n \t\t<echo message=\"micro.version=${micro.version}\"/>\n+\t\t\n+\t\t<!-- Determine if we are going to skip testing or not -->\n+\t\t<!-- Bypass the tests by invoking the always passes test instead of real FAT tests -->\n+\t\t\n+\t\t<!-- Our build infrastructure will set this properties prior to launching tests, \n+\t\t\tneed to overwrite it here if we are going to skip tests. -->\n+\t\t<var name=\"test.bucket.class\" unset=\"true\" />\n+\t\t<iff>\n+\t\t\t<or>\n+\t\t\t\t<istrue value=\"${skip.no.db.tests}\" />\n+\t\t\t\t<istrue value=\"${skip.java.level}\" />\n+\t\t\t</or>\n+\t\t\t<then>\n+\t\t        <property name=\"test.bucket.class\" value=\"componenttest.custom.junit.runner.AlwaysPassesTest\" />\n+\t\t\t\t\n+\t\t\t\t<echo message=\"FAT bucket WILL NOT run tests, due to the following properties:\"/>\n+\t\t\t\t<echo message=\"     Only run database rotation buckets:  ${fat.test.databases.only}\"/>\n+\t\t\t\t<echo message=\"     This bucket uses database rotation:  ${fat.test.databases}\"/>\n+\t\t\t\t<echo message=\"     This bucket uses java level:         ${fat.minimum.java.level}\" />\n+\t\t\t</then>\n+\t\t\t<else>\n+\t\t\t\t<var name=\"test.bucket.name\" unset=\"true\" />\n+\t\t        <property name=\"test.bucket.class\" value=\"${entry.point}\" />\n+\t\t\t\t<property name=\"test.bucket.name\" value=\"${test.bucket.class}${suite.db.type}\"/>\n+\t\t\t\t\n+\t\t\t\t<echo message=\"FAT bucket WILL run, with the following properties:\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2240, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}