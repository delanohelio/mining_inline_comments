{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODQwMzQy", "number": 10468, "title": "Ensure OL tests run properly in DB Rotation", "bodyText": "Fixes #9970\nPart of epic #9260\nThis is to ensure that database rotation rules are followed in OL when run locally and on our test systems. The three properties that control is are fat.test.databases.only to indicate that we should only run database tests, fat.bucket.db.type to indicate which database we should be testing against, and fat.test.databases to indicate if THIS test bucket can run against supported databases.\nThese properties will be saved off to fat.bnd.properties, and control of whether or not the test bucket will run.  The fat.bnd.properties will be consumed in launch.xml and the determination made.", "createdAt": "2020-01-16T20:53:15Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468", "merged": true, "mergeCommit": {"oid": "79ad6799d2e9dfcaf9c90eec3b540f44b5488b18"}, "closed": true, "closedAt": "2020-02-13T17:41:33Z", "author": {"login": "KyleAure"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8O2FkABqjI5NjM0OTU1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDn0lFgBqjMwMzExOTk0NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eece68f163935785189766041e62fca24ef082a4", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/eece68f163935785189766041e62fca24ef082a4", "committedDate": "2020-01-16T20:51:05Z", "message": "Get property to show up in build infrastructure"}, "afterCommit": {"oid": "f36217156e5d3f0258d505e876790ceca36c0b1e", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f36217156e5d3f0258d505e876790ceca36c0b1e", "committedDate": "2020-01-20T16:06:56Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f36217156e5d3f0258d505e876790ceca36c0b1e", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f36217156e5d3f0258d505e876790ceca36c0b1e", "committedDate": "2020-01-20T16:06:56Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "124d8df1cae3713c8fbc3efccc83c69c49a943e6", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/124d8df1cae3713c8fbc3efccc83c69c49a943e6", "committedDate": "2020-01-20T19:05:07Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "124d8df1cae3713c8fbc3efccc83c69c49a943e6", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/124d8df1cae3713c8fbc3efccc83c69c49a943e6", "committedDate": "2020-01-20T19:05:07Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "4347a4de7b1906310265e90189482c65bf31339c", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4347a4de7b1906310265e90189482c65bf31339c", "committedDate": "2020-01-22T19:04:12Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4347a4de7b1906310265e90189482c65bf31339c", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4347a4de7b1906310265e90189482c65bf31339c", "committedDate": "2020-01-22T19:04:12Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "4097d6d7f2d49f2a6cf00da6cd28104045923d90", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4097d6d7f2d49f2a6cf00da6cd28104045923d90", "committedDate": "2020-01-27T21:21:26Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4097d6d7f2d49f2a6cf00da6cd28104045923d90", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4097d6d7f2d49f2a6cf00da6cd28104045923d90", "committedDate": "2020-01-27T21:21:26Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/9366f1a1c01e1485c8f963d74c2d72968c778372", "committedDate": "2020-01-27T21:25:29Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTgxOTQx", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#pullrequestreview-349581941", "createdAt": "2020-01-28T17:55:27Z", "commit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NToyN1rOFiuyUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNzo1NzowOVrOFiu10g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MjQ1MQ==", "bodyText": "I don't believe this is needed, any properties that start with fat.* or test.* should get added already up on line 209.\nIf this is needed because System.getProperties() has things that bndWorkspace.getProject(project.getProjectDir()).getProperties() doesn't, then we should add a generic mechanism for System properties in the same way we do for bnd project properties", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#discussion_r371962451", "createdAt": "2020-01-28T17:55:27Z", "author": {"login": "aguibert"}, "path": "dev/wlp-gradle/subprojects/fat.gradle", "diffHunk": "@@ -214,6 +214,14 @@ task autoFVT {\n     bndProps.setProperty('fat.minimum.java.level', minJavaLevel)\n     bndProps.setProperty('micro.version', bnd('libertyBundleMicroVersion'))\n     \n+    // Add in database rotation properties, if they are present", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk2MzM0Ng==", "bodyText": "Will these lines print out every time someone runs a FAT locally now? If so, I don't think it's necessary to log this much information on the \"normal\" path", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#discussion_r371963346", "createdAt": "2020-01-28T17:57:09Z", "author": {"login": "aguibert"}, "path": "dev/fattest.simplicity/autoFVT-defaults/src/ant/launch.xml", "diffHunk": "@@ -90,23 +87,77 @@\n \t\t\t<entry key=\"preferJIIWSWsAdmin\" value=\"${simplicity.preferJIIWSWsAdmin}\" />\n \t\t</propertyfile>\n \t\t\n-\t\t<!-- Work out the actual entry point based on the current java level -->\n+\t\t<!-- Work out the actual entry point based on the current java level and database properties -->\n \t\t<echo message=\"Checking min java level for project based on bootstrapping.properties file...\" />\n+\t\t\n+\t\t<!-- Get fat.test.databases and fat.minimum.java.level properties-->\n+\t\t<property file=\"${basedir}/fat.bnd.properties\" />\n+\t\t\n+\t\t<!-- Enforce fat.test.databases.only rule.  If bucket is not enlisted in database rotation skip it -->\n+\t\t<condition property=\"skip.no.db.tests\" value=\"true\">\n+\t\t\t<and>\n+\t\t\t\t<istrue value=\"${fat.test.databases.only}\" />\n+\t\t\t\t<not><isTrue value=\"${fat.test.databases}\" /></not>\n+\t\t\t</and>\n+\t\t</condition>\n+\t\t\n+\t\t<!-- If a specific DB is being used, include it later in the bucket name -->\n+    \t<condition property=\"suite.db.type\" value=\" with ${fat.bucket.db.type}\" else=\"\">\n+    \t\t<and>\n+    \t\t\t<istrue value=\"${fat.test.databases}\" />\n+    \t\t\t<isset property=\"fat.bucket.db.type\" />\n+    \t\t</and>\n+    \t</condition>\n \t\t            \n-        <!-- If this test is compiled with a java level higher than the one we're currently running, -->\n-        <!-- bypass the tests by invoking the always passes test instead of real FAT tests -->\n-        <property file=\"${basedir}/fat.bnd.properties\" />\n+        <!-- Enforce fat.minimum.java.level rule. If this test is compiled with a java level \n+           higher than the one we're currently running we should skip these tests. -->\n \t\t<script language=\"javascript\"> <![CDATA[\n-\t\t\tvar testBucketClassForLowJava = \"componenttest.custom.junit.runner.AlwaysPassesTest\";\n \t\t\tvar minTestJava = project.getProperty(\"fat.minimum.java.level\");\n \t\t\tvar javaVersion = parseFloat(project.getProperty(\"java.specification.version\"));\n \t\t\tif(minTestJava != null && javaVersion < parseFloat(minTestJava))\n-\t\t\t  project.setProperty(\"test.bucket.class\", testBucketClassForLowJava);\n+\t\t\t\tproject.setProperty(\"skip.java.level\", true);\n         ]]></script>\n+\t\t\n+\t\t<!-- Output java level info -->\n         <echo message=\"fat.minimum.java.level=${fat.minimum.java.level}\"/>\n         <echo message=\"java.specification.version=${java.specification.version}\"/>\n-        <echo message=\"FAT entry point will be: ${test.bucket.class}\"/>\n \t\t<echo message=\"micro.version=${micro.version}\"/>\n+\t\t\n+\t\t<!-- Determine if we are going to skip testing or not -->\n+\t\t<!-- Bypass the tests by invoking the always passes test instead of real FAT tests -->\n+\t\t\n+\t\t<!-- Our build infrastructure will set this properties prior to launching tests, \n+\t\t\tneed to overwrite it here if we are going to skip tests. -->\n+\t\t<var name=\"test.bucket.class\" unset=\"true\" />\n+\t\t<iff>\n+\t\t\t<or>\n+\t\t\t\t<istrue value=\"${skip.no.db.tests}\" />\n+\t\t\t\t<istrue value=\"${skip.java.level}\" />\n+\t\t\t</or>\n+\t\t\t<then>\n+\t\t        <property name=\"test.bucket.class\" value=\"componenttest.custom.junit.runner.AlwaysPassesTest\" />\n+\t\t\t\t\n+\t\t\t\t<echo message=\"FAT bucket WILL NOT run tests, due to the following properties:\"/>\n+\t\t\t\t<echo message=\"     Only run database rotation buckets:  ${fat.test.databases.only}\"/>\n+\t\t\t\t<echo message=\"     This bucket uses database rotation:  ${fat.test.databases}\"/>\n+\t\t\t\t<echo message=\"     This bucket uses java level:         ${fat.minimum.java.level}\" />\n+\t\t\t</then>\n+\t\t\t<else>\n+\t\t\t\t<var name=\"test.bucket.name\" unset=\"true\" />\n+\t\t        <property name=\"test.bucket.class\" value=\"${entry.point}\" />\n+\t\t\t\t<property name=\"test.bucket.name\" value=\"${test.bucket.class}${suite.db.type}\"/>\n+\t\t\t\t\n+\t\t\t\t<echo message=\"FAT bucket WILL run, with the following properties:\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9366f1a1c01e1485c8f963d74c2d72968c778372"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NzQyNDcy", "url": "https://github.com/OpenLiberty/open-liberty/pull/10468#pullrequestreview-349742472", "createdAt": "2020-01-28T22:13:34Z", "commit": {"oid": "88c7175bf4a87a9d0f9c37fdf220e7991b9950de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b90a6f884877103553d941599e10b26e10a70883", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b90a6f884877103553d941599e10b26e10a70883", "committedDate": "2020-01-29T20:30:45Z", "message": "Feedback 2"}, "afterCommit": {"oid": "f1d3ca13dc6d5759f9f427d7ecf0d63aa2fc034e", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f1d3ca13dc6d5759f9f427d7ecf0d63aa2fc034e", "committedDate": "2020-02-03T17:24:25Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1d3ca13dc6d5759f9f427d7ecf0d63aa2fc034e", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f1d3ca13dc6d5759f9f427d7ecf0d63aa2fc034e", "committedDate": "2020-02-03T17:24:25Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "8da49553afe6b7fdfaf37eae9a93792c442e42ed", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8da49553afe6b7fdfaf37eae9a93792c442e42ed", "committedDate": "2020-02-03T18:55:02Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8da49553afe6b7fdfaf37eae9a93792c442e42ed", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8da49553afe6b7fdfaf37eae9a93792c442e42ed", "committedDate": "2020-02-03T18:55:02Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "b66fb61ee125b2170923ebba02f58c7faa7a5d75", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b66fb61ee125b2170923ebba02f58c7faa7a5d75", "committedDate": "2020-02-10T16:57:12Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b66fb61ee125b2170923ebba02f58c7faa7a5d75", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b66fb61ee125b2170923ebba02f58c7faa7a5d75", "committedDate": "2020-02-10T16:57:12Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "aa59d8ff403d77b9547c2c0babd220268844462a", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aa59d8ff403d77b9547c2c0babd220268844462a", "committedDate": "2020-02-10T16:58:26Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa59d8ff403d77b9547c2c0babd220268844462a", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aa59d8ff403d77b9547c2c0babd220268844462a", "committedDate": "2020-02-10T16:58:26Z", "message": "Ensure OL tests run properly in DB Rotation"}, "afterCommit": {"oid": "f791a10e2a0b9415570a69d75322a0ef2d635162", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f791a10e2a0b9415570a69d75322a0ef2d635162", "committedDate": "2020-02-11T22:36:48Z", "message": "move fat.test.localrun"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b313e30f7365167c9699c32df8144f1a53ed4e7c", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b313e30f7365167c9699c32df8144f1a53ed4e7c", "committedDate": "2020-02-12T15:11:21Z", "message": "Ensure OL tests run properly in DB Rotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c8f2137bcfd8d7e59d919c108d346f169410d2f", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6c8f2137bcfd8d7e59d919c108d346f169410d2f", "committedDate": "2020-02-12T15:11:21Z", "message": "move fat.test.localrun"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f791a10e2a0b9415570a69d75322a0ef2d635162", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f791a10e2a0b9415570a69d75322a0ef2d635162", "committedDate": "2020-02-11T22:36:48Z", "message": "move fat.test.localrun"}, "afterCommit": {"oid": "6c8f2137bcfd8d7e59d919c108d346f169410d2f", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6c8f2137bcfd8d7e59d919c108d346f169410d2f", "committedDate": "2020-02-12T15:11:21Z", "message": "move fat.test.localrun"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3381, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}