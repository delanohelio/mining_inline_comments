{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NjM1MDI2", "number": 15384, "title": "Fix mpOpenAPI-2.0 scanning of application deployed with loose config", "bodyText": "Switches to use the artifact container API instead of manually opening the files. Seems better than trying to parse the loose config file ourselves...\nAlso add a small fix where an FFDC would be thrown if we tried to write a cache entry for an OpenAPI model which had no paths.\nFixes #15374", "createdAt": "2020-12-29T21:04:44Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/15384", "merged": true, "mergeCommit": {"oid": "2f32239fb55c71596e36c491c86a769383608e22"}, "closed": true, "closedAt": "2021-01-04T10:15:38Z", "author": {"login": "Azquelt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrOGYOgH2gAyNTQ2NjM1MDI2OmZhNmM5NGVmMDBjNWZhODdhMGU1ZGI5ODc2MDYyNTU5MzRkNGFmZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrir8cgFqTU2MDMzMjEwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa6c94ef00c5fa87a0e5db987606255934d4afe3", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fa6c94ef00c5fa87a0e5db987606255934d4afe3", "committedDate": "2020-12-30T12:01:37Z", "message": "mpOpenAPI-2.0: Index using liberty container API\n\nUse the container API instead of reading files directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "725d9f23969414e9b4a0a4e45055a1b62dc47e62", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/725d9f23969414e9b4a0a4e45055a1b62dc47e62", "committedDate": "2020-12-30T12:01:37Z", "message": "Add loose config OpenAPI deployment test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4fe156b40ff6f63168aab27b2feeb618c68ae1", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ed4fe156b40ff6f63168aab27b2feeb618c68ae1", "committedDate": "2020-12-30T12:01:37Z", "message": "Prevent exception if OpenAPI model is empty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5afa2f058a50c630e98f83660b0b8a455661e157", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5afa2f058a50c630e98f83660b0b8a455661e157", "committedDate": "2020-12-29T21:01:39Z", "message": "Add loose config OpenAPI deployment test"}, "afterCommit": {"oid": "ed4fe156b40ff6f63168aab27b2feeb618c68ae1", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ed4fe156b40ff6f63168aab27b2feeb618c68ae1", "committedDate": "2020-12-30T12:01:37Z", "message": "Prevent exception if OpenAPI model is empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMzMyMTA4", "url": "https://github.com/OpenLiberty/open-liberty/pull/15384#pullrequestreview-560332108", "createdAt": "2020-12-31T11:41:44Z", "commit": {"oid": "ed4fe156b40ff6f63168aab27b2feeb618c68ae1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxMTo0MTo0NFrOIM9u_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxMTo1OToxOFrOIM97OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ2NTI3OQ==", "bodyText": "extract local constant of 5 or use s.split(Constants.FILE_SUFFIX_CLASS)[0] ?", "url": "https://github.com/OpenLiberty/open-liberty/pull/15384#discussion_r550465279", "createdAt": "2020-12-31T11:41:44Z", "author": {"login": "hutchig"}, "path": "dev/io.openliberty.microprofile.openapi.2.0.internal/src/io/openliberty/microprofile/openapi20/utils/IndexUtils.java", "diffHunk": "@@ -118,6 +91,40 @@ public static IndexView getIndexView(WebModuleInfo webModuleInfo, OpenApiConfig\n \n         return view;\n     }\n+    \n+    private static void indexContainer(Container container, String packageName, Indexer indexer, FilteredIndexView filter) {\n+        for (Entry entry : container) {\n+            String entryName = entry.getName();\n+            try {\n+                if (entryName.endsWith(Constants.FILE_SUFFIX_CLASS)) {\n+                    int nameLength = entryName.length() - Constants.FILE_SUFFIX_CLASS.length();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed4fe156b40ff6f63168aab27b2feeb618c68ae1"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ2ODQwOA==", "bodyText": "wondered if this could go in a FAT Utils class.", "url": "https://github.com/OpenLiberty/open-liberty/pull/15384#discussion_r550468408", "createdAt": "2020-12-31T11:59:18Z", "author": {"login": "hutchig"}, "path": "dev/io.openliberty.microprofile.openapi.2.0.internal_fat/fat/src/io/openliberty/microprofile/openapi20/fat/deployments/DeploymentTest.java", "diffHunk": "@@ -266,13 +296,30 @@ private void deployApp(Archive<?> archive, Consumer<ServerConfiguration> configM\n         server.updateServerConfiguration(config);\n         server.waitForConfigUpdateInLogUsingMark(Collections.singleton(getName(archive)));\n     }\n+    \n+    private void deployLooseApp(String fileName, String type) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed4fe156b40ff6f63168aab27b2feeb618c68ae1"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2683, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}