{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5ODA1NTE4", "number": 13806, "title": "Issue 13776: Beta-guard MP JWT 1.2 function and beta the feature", "bodyText": "For issue #13776\nFor issue #13326\n#build\n#spawn.fullfat.buckets=com.ibm.ws.security.jwt_fat.builder,com.ibm.ws.security.jwt_fat.consumer,com.ibm.ws.security.jwtsso_fat,com.ibm.ws.security.mp.jwt_fat_tck,com.ibm.ws.security.mp.jwt.1.1_fat,com.ibm.ws.security.oidc.client_fat,com.ibm.ws.security.oidc.client_fat.config,com.ibm.ws.security.oidc.client_fat.e2e,com.ibm.ws.security.oidc.client_fat.jaxrs,com.ibm.ws.security.oidc.client_fat.saml,com.ibm.ws.security.oidc.server_fat,com.ibm.ws.security.oidc.server_fat.app-passwords,com.ibm.ws.security.oidc.server_fat.app-passwords.DerbyDB.jwt,com.ibm.ws.security.oidc.server_fat.app-passwords.DerbyDB.opaque,com.ibm.ws.security.oidc.server_fat.app-passwords.LocalStore.jwt,com.ibm.ws.security.oidc.server_fat.app-passwords.LocalStore.opaque,com.ibm.ws.security.oidc.server_fat.app-tokens,com.ibm.ws.security.oidc.server_fat.app-tokens.DerbyDB.jwt,com.ibm.ws.security.oidc.server_fat.app-tokens.DerbyDB.opaque,com.ibm.ws.security.oidc.server_fat.app-tokens.LocalStore.jwt,com.ibm.ws.security.oidc.server_fat.app-tokens.LocalStore.opaque,com.ibm.ws.security.oidc.server_fat.clientregistration,com.ibm.ws.security.oidc.server_fat.config,com.ibm.ws.security.oidc.server_fat.config.oauth,com.ibm.ws.security.oidc.server_fat.config.oidc,com.ibm.ws.security.oidc.server_fat.endpoint.authorize,com.ibm.ws.security.oidc.server_fat.endpoint.coveragemap,com.ibm.ws.security.oidc.server_fat.endpoint.discovery,com.ibm.ws.security.oidc.server_fat.endpoint.end_session,com.ibm.ws.security.oidc.server_fat.endpoint.introspect,com.ibm.ws.security.oidc.server_fat.endpoint.revoke,com.ibm.ws.security.oidc.server_fat.endpoint.token,com.ibm.ws.security.oidc.server_fat.endpoint.userinfo,com.ibm.ws.security.oidc.server_fat.feature,com.ibm.ws.security.oidc.server_fat.granttype.jwt,com.ibm.ws.security.oidc.server_fat.gui.tokenMgmt,com.ibm.ws.security.oidc.server_fat.jaxrs,com.ibm.ws.security.oidc.server_fat.jaxrs.config,com.ibm.ws.security.oidc.server_fat.oauth,com.ibm.ws.security.oidc.server_fat.oidc,com.ibm.ws.security.oidc.server_fat.saml,com.ibm.ws.security.saml.sso_fat,com.ibm.ws.security.saml.sso_fat.2,com.ibm.ws.security.saml.sso_fat.3,com.ibm.ws.security.saml.sso_fat.config,com.ibm.ws.security.saml.sso_fat.config.mapToUserRegistry,com.ibm.ws.security.saml.sso_fat.endpoint.samlmetadata,com.ibm.ws.security.saml.sso_fat.jaxrs,com.ibm.ws.security.saml.sso_fat.jaxrs.config,com.ibm.ws.security.saml.sso_fat.logout,com.ibm.ws.security.saml.sso_fat.logout.httpServletRequest,com.ibm.ws.security.saml.sso_fat.logout.ibm_security_logout,com.ibm.ws.security.saml.sso_fat.logout.IDP_initiated,com.ibm.ws.security.social_fat,com.ibm.ws.security.social_fat.delegated,com.ibm.ws.security.social_fat.LibertyOP,com.ibm.ws.security.social_fat.multiProvider,com.ibm.ws.security.social_fat.okdServiceLogin", "createdAt": "2020-09-04T15:30:52Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806", "merged": true, "mergeCommit": {"oid": "55d9d9be8c0d45d7000067b4b224b361b30b7c92"}, "closed": true, "closedAt": "2020-09-15T13:22:11Z", "author": {"login": "ayoho"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFnEjwAFqTQ4Mjc1OTQ4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI6j4fgFqTQ4ODE4Njg5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNzU5NDgz", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#pullrequestreview-482759483", "createdAt": "2020-09-04T15:38:07Z", "commit": {"oid": "7418a0ef0434c75b2a2858031ca3b69cd4676609"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTozODowN1rOHNSoxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTozODowN1rOHNSoxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY5ODg4Nw==", "bodyText": "Will this function work by default in the beta or will you have to set the config property even in the beta?", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#discussion_r483698887", "createdAt": "2020-09-04T15:38:07Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.security.jwt/src/com/ibm/ws/security/jwt/internal/JwtConfigUtil.java", "diffHunk": "@@ -53,4 +58,27 @@ public static String processProtectedString(Map<String, Object> props, String cf\n         return secret;\n     }\n \n+    public static String getSignatureAlgorithm(Map<String, Object> props, String sigAlgAttrName, String enableBetaAttrName) {\n+        String defaultSignatureAlgorithm = \"RS256\";\n+        String signatureAlgorithm = JwtUtils.trimIt((String) props.get(sigAlgAttrName));\n+        boolean isBetaEnabled = (Boolean) props.get(enableBetaAttrName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7418a0ef0434c75b2a2858031ca3b69cd4676609"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7418a0ef0434c75b2a2858031ca3b69cd4676609", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7418a0ef0434c75b2a2858031ca3b69cd4676609", "committedDate": "2020-09-04T15:27:58Z", "message": "Issue 13776: Beta-guard MP JWT 1.2 function and beta the feature"}, "afterCommit": {"oid": "84199af4569b57052db34ff6834296793373f84b", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/84199af4569b57052db34ff6834296793373f84b", "committedDate": "2020-09-04T18:44:17Z", "message": "Issue 13776: Beta-guard MP JWT 1.2 function and beta the feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDA1NjMx", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#pullrequestreview-483405631", "createdAt": "2020-09-07T09:33:39Z", "commit": {"oid": "84199af4569b57052db34ff6834296793373f84b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOTozMzozOVrOHN4HUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOTozMzozOVrOHN4HUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxMjkxNA==", "bodyText": "If you do specify a beta Algorithm when not running a beta runtime, is it correct that this just defaults back without warning? You won't see any message unless debug trace is enabled. When not running in a beta, I think this should behave the same as if a completely unknown/invalid algorithm was specified ... in such a case, would there be an exception? An error or warning message? I don't think debug trace is enough.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#discussion_r484312914", "createdAt": "2020-09-07T09:33:39Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.security.jwt/src/com/ibm/ws/security/jwt/internal/JwtConfigUtil.java", "diffHunk": "@@ -53,4 +59,27 @@ public static String processProtectedString(Map<String, Object> props, String cf\n         return secret;\n     }\n \n+    public static String getSignatureAlgorithm(Map<String, Object> props, String sigAlgAttrName) {\n+        String defaultSignatureAlgorithm = \"RS256\";\n+        String signatureAlgorithm = JwtUtils.trimIt((String) props.get(sigAlgAttrName));\n+        boolean isBetaEnabled = ProductInfo.getBetaEdition();\n+        if (!isBetaEnabled && isBetaAlgorithm(signatureAlgorithm)) {\n+            if (tc.isDebugEnabled()) {\n+                Tr.debug(tc, \"A signature algorithm (\" + signatureAlgorithm + \") is specified that's only available in the beta edition. Defaulting to \" + defaultSignatureAlgorithm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84199af4569b57052db34ff6834296793373f84b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2940eed0d4f0e3532ecc531abd81b73cc265951c", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2940eed0d4f0e3532ecc531abd81b73cc265951c", "committedDate": "2020-09-08T17:24:46Z", "message": "Issue 13776: Beta-guard MP JWT 1.2 function and beta the feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac", "committedDate": "2020-09-08T20:42:15Z", "message": "Issue 13776: Updates after review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60c8360192eb8a91fefcde1d2e5aeb245067748f", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/60c8360192eb8a91fefcde1d2e5aeb245067748f", "committedDate": "2020-09-08T16:47:04Z", "message": "Issue 13776: Updates after review"}, "afterCommit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac", "committedDate": "2020-09-08T20:42:15Z", "message": "Issue 13776: Updates after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDk0MDgx", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#pullrequestreview-484494081", "createdAt": "2020-09-08T21:08:03Z", "commit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTowODowM1rOHOuEaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTowODowM1rOHOuEaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NjkwNA==", "bodyText": "4.0 is for Jakarta 9.  Since you aren't tolerating servlet 5.0 I assume you don't need to tolerate appSecurity 4.0", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#discussion_r485196904", "createdAt": "2020-09-08T21:08:03Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.websphere.appserver.features/visibility/public/mpJwt-1.2/io.openliberty.mpJwt-1.2.feature", "diffHunk": "@@ -8,17 +8,17 @@ IBM-API-Package: \\\n   org.eclipse.microprofile.auth; type=\"stable\"\n Subsystem-Name: MicroProfile JSON Web Token 1.2\n -features=com.ibm.websphere.appserver.servlet-3.1; ibm.tolerates:=4.0, \\\n-  com.ibm.websphere.appserver.appSecurity-2.0; ibm.tolerates:=3.0, \\\n+  com.ibm.websphere.appserver.appSecurity-3.0; ibm.tolerates:=4.0, \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDY2NTMw", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#pullrequestreview-486066530", "createdAt": "2020-09-10T15:39:21Z", "commit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTozOToyMVrOHP6HpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTozOToyMVrOHP6HpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MjkxNw==", "bodyText": "Suggested update\n\nSupport for the signature algorithm that is specified in the message might be incomplete, so the signature algorithm can be used only in the beta edition.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#discussion_r486442917", "createdAt": "2020-09-10T15:39:21Z", "author": {"login": "Charlotte-Holt"}, "path": "dev/com.ibm.ws.security.jwt/resources/com/ibm/ws/security/jwt/internal/resources/JWTMessages.nlsprops", "diffHunk": "@@ -324,3 +324,8 @@ MP_CONFIG_PUBLIC_KEY_ALG_NOT_SUPPORTED.useraction=Specify a supported signature\n JWT_AMR_CLAIM_NOT_VALID=CWWKS6054E: The AMR [{0}] of the provided JSON web token (JWT) is not listed as a trusted AMR in the [{1}] JWT configuration. The trusted AMR are [{2}].\n JWT_AMR_CLAIM_NOT_VALID.explanation=The server configuration specifies which AMR are trusted when validating JWTs. The provided token is not intended for a trusted AMR, so the token cannot be validated.\n JWT_AMR_CLAIM_NOT_VALID.useraction=Obtain a new token for one of the trusted AMR specified in your JWT configuration, or add the AMR specified in the message as a trusted AMR in your JWT configuration.\n+\n+# 0=JWT configuration ID, 1=Signature algorithm configured in server.xml, 2=Signature algorithm that will be used by default\n+BETA_SIGNATURE_ALGORITHM_USED=CWWKS6055W: The [{0}] configuration specifies the {1} signature algorithm, but that algorithm is only available in the beta edition. The {2} signature algorithm is used instead.\n+BETA_SIGNATURE_ALGORITHM_USED.explanation=Support for the signature algorithm that is specified in the message might be incomplete, so the signature algorithm can only be used in the beta edition.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ce67db5c77c0c0a1bb2d200a8d4af38c246a7ac"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dd999982a119362b66344d25ae48ca9afe60b70", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1dd999982a119362b66344d25ae48ca9afe60b70", "committedDate": "2020-09-11T20:44:33Z", "message": "Issue 13776: Fix class resolution problems and feature versions being loaded"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e77a395f8b85843458819ca728f180bb91ca0fe", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1e77a395f8b85843458819ca728f180bb91ca0fe", "committedDate": "2020-09-11T20:43:15Z", "message": "Issue 13776: Fix class resolution problems and feature versions being loaded"}, "afterCommit": {"oid": "1dd999982a119362b66344d25ae48ca9afe60b70", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1dd999982a119362b66344d25ae48ca9afe60b70", "committedDate": "2020-09-11T20:44:33Z", "message": "Issue 13776: Fix class resolution problems and feature versions being loaded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa24ec63363d5e7831877a0e81f8384598053bf", "author": {"user": {"login": "ayoho", "name": "Adam Yoho"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/dfa24ec63363d5e7831877a0e81f8384598053bf", "committedDate": "2020-09-14T15:35:31Z", "message": "Issue 13776: FAT updates to run with beta content"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MTg2ODkx", "url": "https://github.com/OpenLiberty/open-liberty/pull/13806#pullrequestreview-488186891", "createdAt": "2020-09-14T22:02:19Z", "commit": {"oid": "dfa24ec63363d5e7831877a0e81f8384598053bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3455, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}