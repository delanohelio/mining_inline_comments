{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NjQxMzMy", "number": 14606, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxODowOToyNVrOEwZZGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxODowOToyNVrOEwZZGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MTgzMTI4OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/WebAppSecurityCollaboratorImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxODowOToyNVrOHl7r5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxOToxOTo1NFrOHl_w3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTUzNzI1Mw==", "bodyText": "In general this whole method is an anti-pattern.  Usually this is handled with a service being applied to the instance and this not being calculated on EVERY web request.  In order to reduce the extra processing of getting the installed features I suggest to change this to the below for now in order to get us back to close to where we were.\n        if (WebContainer.getServletContainerSpecLevel() < WebContainer.SPEC_LEVEL_40) {\n            return false;\n        }\n        Set<String> features = provisionerService.getInstalledFeatures();\n        return features.contains(\"appSecurity-3.0\") || features.contains(\"appSecurity-4.0\");", "url": "https://github.com/OpenLiberty/open-liberty/pull/14606#discussion_r509537253", "createdAt": "2020-10-21T18:09:25Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/WebAppSecurityCollaboratorImpl.java", "diffHunk": "@@ -461,31 +461,16 @@ public void handleException(HttpServletRequest req, HttpServletResponse rsp, Thr\n     }\n \n     @Override\n-    @FFDCIgnore(NumberFormatException.class)\n     public boolean isCDINeeded() {\n-        int specLevel = WebContainer.getServletContainerSpecLevel();\n-\n-        /*\n-         * Determine which version of appSecurity we are running.\n-         */\n-        Set<String> installedFeatures = provisionerService.getInstalledFeatures();\n-        float appSecurityVers = 0.0f;\n-        for (String feature : installedFeatures) {\n-            if (feature.startsWith(\"appSecurity-\")) {\n-                try {\n-                    appSecurityVers = Float.valueOf(feature.substring(12));\n-                    break;\n-                } catch (NumberFormatException e) {\n-                    // Ignore. Not the feature we are looking for.\n-                }\n-            }\n-        }\n-\n         /*\n-         * Future-proof check. Some of these combinations aren't valid, but\n-         * they will not make it this far.\n+         * Tried to future-proof this check by iterating over all the\n+         * installed features and finding the version of appSecurity installed,\n+         * but that introduced a performance degradation. So for now, checking\n+         * for the appSecurity-3.0/4.0 features directly.\n          */\n-        return appSecurityVers >= 3.0 && specLevel >= WebContainer.SPEC_LEVEL_40;\n+        return WebContainer.getServletContainerSpecLevel() >= WebContainer.SPEC_LEVEL_40 &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9de875552242ee2043ca07d0bdcdcc833cc55242"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwNDA2MQ==", "bodyText": "Made this change.", "url": "https://github.com/OpenLiberty/open-liberty/pull/14606#discussion_r509604061", "createdAt": "2020-10-21T19:19:54Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/WebAppSecurityCollaboratorImpl.java", "diffHunk": "@@ -461,31 +461,16 @@ public void handleException(HttpServletRequest req, HttpServletResponse rsp, Thr\n     }\n \n     @Override\n-    @FFDCIgnore(NumberFormatException.class)\n     public boolean isCDINeeded() {\n-        int specLevel = WebContainer.getServletContainerSpecLevel();\n-\n-        /*\n-         * Determine which version of appSecurity we are running.\n-         */\n-        Set<String> installedFeatures = provisionerService.getInstalledFeatures();\n-        float appSecurityVers = 0.0f;\n-        for (String feature : installedFeatures) {\n-            if (feature.startsWith(\"appSecurity-\")) {\n-                try {\n-                    appSecurityVers = Float.valueOf(feature.substring(12));\n-                    break;\n-                } catch (NumberFormatException e) {\n-                    // Ignore. Not the feature we are looking for.\n-                }\n-            }\n-        }\n-\n         /*\n-         * Future-proof check. Some of these combinations aren't valid, but\n-         * they will not make it this far.\n+         * Tried to future-proof this check by iterating over all the\n+         * installed features and finding the version of appSecurity installed,\n+         * but that introduced a performance degradation. So for now, checking\n+         * for the appSecurity-3.0/4.0 features directly.\n          */\n-        return appSecurityVers >= 3.0 && specLevel >= WebContainer.SPEC_LEVEL_40;\n+        return WebContainer.getServletContainerSpecLevel() >= WebContainer.SPEC_LEVEL_40 &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTUzNzI1Mw=="}, "originalCommit": {"oid": "9de875552242ee2043ca07d0bdcdcc833cc55242"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2547, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}