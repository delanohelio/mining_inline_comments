{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTkyMTQx", "number": 13353, "title": "Kerberos datasource bindings and password support", "bodyText": "", "createdAt": "2020-08-06T18:24:32Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353", "merged": true, "mergeCommit": {"oid": "28ab3a77b7f865dd60103846e7daf214188ec82d"}, "closed": true, "closedAt": "2020-08-07T19:33:59Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8R0j0AH2gAyNDY0MTkyMTQxOjYwMzE3ZmIxN2YxZWVmMDI3ZjVlYTU1NzI1NTVkODA1ODExMTE1M2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8pqRUgFqTQ2Mjk2OTA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "60317fb17f1eef027f5ea5572555d8058111153c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/60317fb17f1eef027f5ea5572555d8058111153c", "committedDate": "2020-08-06T15:47:20Z", "message": "Add test for rebinding auth-data in IBM binding files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/86698057a3062f0e5005bf6f5f72e80832689eba", "committedDate": "2020-08-06T18:19:42Z", "message": "Add support for providing kerberos password via authData password attribute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODcwOTk5", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#pullrequestreview-462870999", "createdAt": "2020-08-06T20:56:44Z", "commit": {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo1Njo0NFrOG9D_oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDo1Njo0NFrOG9D_oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA==", "bodyText": "I just wonder why we do not use WSCallbackHandlerImpl.java instead of Krb5CallbackHandler?", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r466681760", "createdAt": "2020-08-06T20:56:44Z", "author": {"login": "utle"}, "path": "dev/com.ibm.ws.security.kerberos.auth/src/com/ibm/ws/security/kerberos/auth/KerberosService.java", "diffHunk": "@@ -110,28 +123,48 @@ public Path getKeytab() {\n      * @return A valid subject for the supplied principal\n      */\n     public Subject getOrCreateSubject(String principal) throws LoginException {\n+        return getOrCreateSubject(principal, null);\n+    }\n+\n+    /**\n+     * Checks the Subject cache for an existing Subject matching the supplied principal.\n+     * A simple LRU cache is used to store cache Subjects\n+     * If a valid subject is not found in the cache, then a new Kerberos login is performed and\n+     * the resulting Subject is cached.\n+     *\n+     * @param principal The principal to obtain a subject for\n+     * @param pass      The password to be used via CallbackHandler. This will only be used if no password\n+     *                      is found in the credential cache or keytab files first.\n+     * @return A valid subject for the supplied principal\n+     */\n+    public Subject getOrCreateSubject(String principal, SerializableProtectedString pass) throws LoginException {\n         KerberosPrincipal krb5Principal = new KerberosPrincipal(principal);\n         Subject cachedSubject = subjectCache.get(krb5Principal);\n         if (cachedSubject != null) {\n             return cachedSubject;\n         }\n \n-        Subject createdSubject = doKerberosLogin(principal);\n+        Subject createdSubject = doKerberosLogin(principal, pass);\n \n         subjectCache.put(krb5Principal, createdSubject);\n         return createdSubject;\n     }\n \n-    private Subject doKerberosLogin(String principal) throws LoginException {\n+    private Subject doKerberosLogin(String principal, SerializableProtectedString pass) throws LoginException {\n         Subject subject = new Subject();\n         Krb5LoginModuleWrapper krb5 = new Krb5LoginModuleWrapper();\n         Map<String, String> options = new HashMap<String, String>();\n         Map<String, Object> sharedState = new HashMap<String, Object>();\n+        CallbackHandler callback = pass == null ? null : new Krb5CallbackHandler(pass);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTY5MDg3", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#pullrequestreview-462969087", "createdAt": "2020-08-07T00:55:41Z", "commit": {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1NTo0MlrOG9I6GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1NTo0MlrOG9I6GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjI2NA==", "bodyText": "I think you can supply null for user name", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r466762264", "createdAt": "2020-08-07T00:55:42Z", "author": {"login": "utle"}, "path": "dev/com.ibm.ws.security.kerberos.auth/src/com/ibm/ws/security/kerberos/auth/KerberosService.java", "diffHunk": "@@ -110,28 +123,48 @@ public Path getKeytab() {\n      * @return A valid subject for the supplied principal\n      */\n     public Subject getOrCreateSubject(String principal) throws LoginException {\n+        return getOrCreateSubject(principal, null);\n+    }\n+\n+    /**\n+     * Checks the Subject cache for an existing Subject matching the supplied principal.\n+     * A simple LRU cache is used to store cache Subjects\n+     * If a valid subject is not found in the cache, then a new Kerberos login is performed and\n+     * the resulting Subject is cached.\n+     *\n+     * @param principal The principal to obtain a subject for\n+     * @param pass      The password to be used via CallbackHandler. This will only be used if no password\n+     *                      is found in the credential cache or keytab files first.\n+     * @return A valid subject for the supplied principal\n+     */\n+    public Subject getOrCreateSubject(String principal, SerializableProtectedString pass) throws LoginException {\n         KerberosPrincipal krb5Principal = new KerberosPrincipal(principal);\n         Subject cachedSubject = subjectCache.get(krb5Principal);\n         if (cachedSubject != null) {\n             return cachedSubject;\n         }\n \n-        Subject createdSubject = doKerberosLogin(principal);\n+        Subject createdSubject = doKerberosLogin(principal, pass);\n \n         subjectCache.put(krb5Principal, createdSubject);\n         return createdSubject;\n     }\n \n-    private Subject doKerberosLogin(String principal) throws LoginException {\n+    private Subject doKerberosLogin(String principal, SerializableProtectedString pass) throws LoginException {\n         Subject subject = new Subject();\n         Krb5LoginModuleWrapper krb5 = new Krb5LoginModuleWrapper();\n         Map<String, String> options = new HashMap<String, String>();\n         Map<String, Object> sharedState = new HashMap<String, Object>();\n+        CallbackHandler callback = pass == null ? null : new Krb5CallbackHandler(pass);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA=="}, "originalCommit": {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba"}, "originalPosition": 78}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1964, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}