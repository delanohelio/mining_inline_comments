{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NzgyOTI4", "number": 11956, "title": "Issue 10519: Add automatic certificate checker for ACME", "bodyText": "Fixes #10519\n\nAdded a scheduler to check for expiration or revocation\nAdded locking around renew/revoke\nAdded a timer window around REST renewal\n\nTests added:\n\nScheduler renews expiring certificate\nScheduler renews revoked certificate\nScheduler doesn't run if disabled\nBack to back renewal\nScheduler stops when acmeCA feature is removed, restarts on addition\nScheduler runs after bad config is updated to valid config\nStop Pebble during test, ensure we reschedule the certchecker and renew cert that's expiring\n\nTest to add in another PR: Opened #12328 to address\n\nEnable/disable the cert checker during runtime (set certCheckerSchedule to 0), make sure it stops/starts appropriately\nCall renew while certchecker is going -- disable auto? What are we checking for here?\nCall revoke and renew at the same time?\nStop Pebble during test, ensure we reschedule the certchecker and renew cert that's revoked\n\nFor #9017", "createdAt": "2020-04-27T22:33:47Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956", "merged": true, "mergeCommit": {"oid": "444fc4cbe8711c6e230826458b874745c2898bc5"}, "closed": true, "closedAt": "2020-05-27T16:46:59Z", "author": {"login": "kristip17"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccMl0kABqjMyODI1MDk2NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclKeDAgFqTQxODY0NDQ5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b49d04ae346261455a7257161e8f8366dcb682b6", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b49d04ae346261455a7257161e8f8366dcb682b6", "committedDate": "2020-04-27T22:32:40Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "7be671fcee2edd5a729bd6897d34e24f8283a884", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7be671fcee2edd5a729bd6897d34e24f8283a884", "committedDate": "2020-04-28T23:35:52Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7be671fcee2edd5a729bd6897d34e24f8283a884", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7be671fcee2edd5a729bd6897d34e24f8283a884", "committedDate": "2020-04-28T23:35:52Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2b2de001186f653bcb1b33dc3295b35fbfeda5b2", "committedDate": "2020-04-29T00:31:13Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzE5Mjcy", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-404319272", "createdAt": "2020-05-01T18:22:58Z", "commit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMjo1OFrOGPRqmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyOTo0MlrOGPR3CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTI1OQ==", "bodyText": "change\nThe certificate will expire on {1}.\nto\nThe certificate expires on {1}.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r418671259", "createdAt": "2020-05-01T18:22:58Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -206,3 +206,19 @@ CWPKI2044E.useraction=Ensure that all the certificates in the certificate chain\n CWPKI2045W=CWPKI2045W: The certificate with {0} serial number that is signed by the ACME certificate authority at the {1} URI is not valid until {2}.\n CWPKI2045W.explanation=The valid period on the certificate is in the future. SSL/TLS requests fail until the current date and time are within the range that is specified by the valid period on the certificate.\n CWPKI2045W.useraction=Update the local time on the server if the time is incorrect.\n+\n+CWPKI2052W=CWPKI2052W: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate will expire on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MjEzOA==", "bodyText": "change\nThe ACME Service will continue to request a new certificate until it is successful.\nto\nThe ACME Service continues to request a new certificate until a new certificate is issued.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r418672138", "createdAt": "2020-05-01T18:24:54Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -206,3 +206,19 @@ CWPKI2044E.useraction=Ensure that all the certificates in the certificate chain\n CWPKI2045W=CWPKI2045W: The certificate with {0} serial number that is signed by the ACME certificate authority at the {1} URI is not valid until {2}.\n CWPKI2045W.explanation=The valid period on the certificate is in the future. SSL/TLS requests fail until the current date and time are within the range that is specified by the valid period on the certificate.\n CWPKI2045W.useraction=Update the local time on the server if the time is incorrect.\n+\n+CWPKI2052W=CWPKI2052W: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate will expire on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2052W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MzIwNQ==", "bodyText": "change\nThe ACME Service will continue to request a new certificate until it is successful. SSL/TLS requests will fail until a new certificate request is successful.\nto\nThe ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r418673205", "createdAt": "2020-05-01T18:27:10Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -206,3 +206,19 @@ CWPKI2044E.useraction=Ensure that all the certificates in the certificate chain\n CWPKI2045W=CWPKI2045W: The certificate with {0} serial number that is signed by the ACME certificate authority at the {1} URI is not valid until {2}.\n CWPKI2045W.explanation=The valid period on the certificate is in the future. SSL/TLS requests fail until the current date and time are within the range that is specified by the valid period on the certificate.\n CWPKI2045W.useraction=Update the local time on the server if the time is incorrect.\n+\n+CWPKI2052W=CWPKI2052W: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate will expire on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2052W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful.\n+CWPKI2052W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2053E=CWPKI2053E: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2053E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful. SSL/TLS requests will fail until a new certificate request is successful.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3Mzg4Nw==", "bodyText": "change\nThe ACME Service detected that the certificate needed to be replaced and successfully requested a new certificate.\nto\nThe ACME Service detected that the certificate was set to expire and successfully requested a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r418673887", "createdAt": "2020-05-01T18:28:36Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -206,3 +206,19 @@ CWPKI2044E.useraction=Ensure that all the certificates in the certificate chain\n CWPKI2045W=CWPKI2045W: The certificate with {0} serial number that is signed by the ACME certificate authority at the {1} URI is not valid until {2}.\n CWPKI2045W.explanation=The valid period on the certificate is in the future. SSL/TLS requests fail until the current date and time are within the range that is specified by the valid period on the certificate.\n CWPKI2045W.useraction=Update the local time on the server if the time is incorrect.\n+\n+CWPKI2052W=CWPKI2052W: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate will expire on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2052W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful.\n+CWPKI2052W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2053E=CWPKI2053E: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2053E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful. SSL/TLS requests will fail until a new certificate request is successful.\n+CWPKI2053E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2054I=CWPKI2054I: The ACME Service automatically renewed the certificate authority signed certificate before the previous certificate expired.\n+CWPKI2054I.explanation=The ACME Service detected that the certificate needed to be replaced and successfully requested a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3NDQ0MQ==", "bodyText": "change\nThe ACME Service detected that the certificate needed to be replaced and successfully requested a new certificate.\nto\nThe ACME Service detected that the certificate was revoked and successfully requested a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r418674441", "createdAt": "2020-05-01T18:29:42Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -206,3 +206,19 @@ CWPKI2044E.useraction=Ensure that all the certificates in the certificate chain\n CWPKI2045W=CWPKI2045W: The certificate with {0} serial number that is signed by the ACME certificate authority at the {1} URI is not valid until {2}.\n CWPKI2045W.explanation=The valid period on the certificate is in the future. SSL/TLS requests fail until the current date and time are within the range that is specified by the valid period on the certificate.\n CWPKI2045W.useraction=Update the local time on the server if the time is incorrect.\n+\n+CWPKI2052W=CWPKI2052W: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate will expire on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2052W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful.\n+CWPKI2052W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2053E=CWPKI2053E: The ACME Service failed to automatically renew the certificate with {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2053E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service will continue to request a new certificate until it is successful. SSL/TLS requests will fail until a new certificate request is successful.\n+CWPKI2053E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2054I=CWPKI2054I: The ACME Service automatically renewed the certificate authority signed certificate before the previous certificate expired.\n+CWPKI2054I.explanation=The ACME Service detected that the certificate needed to be replaced and successfully requested a new certificate.\n+CWPKI2054I.useraction=No action is required.\n+\n+CWPKI2055I=CWPKI2055I: The ACME Service automatically renewed the certificate authority signed certificate after the certificate was revoked.\n+CWPKI2055I.explanation=The ACME Service detected that the certificate needed to be replaced and successfully requested a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b2de001186f653bcb1b33dc3295b35fbfeda5b2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2b2de001186f653bcb1b33dc3295b35fbfeda5b2", "committedDate": "2020-04-29T00:31:13Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "8d0621266ab009ec299e258cea2d3bdd7d7203bd", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8d0621266ab009ec299e258cea2d3bdd7d7203bd", "committedDate": "2020-05-05T16:21:24Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d0621266ab009ec299e258cea2d3bdd7d7203bd", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8d0621266ab009ec299e258cea2d3bdd7d7203bd", "committedDate": "2020-05-05T16:21:24Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "b9d9e8957178350017581547954a20d6640551c3", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b9d9e8957178350017581547954a20d6640551c3", "committedDate": "2020-05-06T21:39:23Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9d9e8957178350017581547954a20d6640551c3", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b9d9e8957178350017581547954a20d6640551c3", "committedDate": "2020-05-06T21:39:23Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "7278842706f1c113876df7999df8950ff25c0fd9", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7278842706f1c113876df7999df8950ff25c0fd9", "committedDate": "2020-05-07T17:56:59Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7278842706f1c113876df7999df8950ff25c0fd9", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7278842706f1c113876df7999df8950ff25c0fd9", "committedDate": "2020-05-07T17:56:59Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "4209ed88a777d99664bec85d42e00b69debb8dc4", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4209ed88a777d99664bec85d42e00b69debb8dc4", "committedDate": "2020-05-08T21:44:50Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4209ed88a777d99664bec85d42e00b69debb8dc4", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4209ed88a777d99664bec85d42e00b69debb8dc4", "committedDate": "2020-05-08T21:44:50Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "d97b67139350af9954297a685020db11f8d334dc", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/d97b67139350af9954297a685020db11f8d334dc", "committedDate": "2020-05-12T23:07:16Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d97b67139350af9954297a685020db11f8d334dc", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/d97b67139350af9954297a685020db11f8d334dc", "committedDate": "2020-05-12T23:07:16Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "fbc0d213e234a3d3d4c020704a78a1b81acd7ae8", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fbc0d213e234a3d3d4c020704a78a1b81acd7ae8", "committedDate": "2020-05-12T23:08:40Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbc0d213e234a3d3d4c020704a78a1b81acd7ae8", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fbc0d213e234a3d3d4c020704a78a1b81acd7ae8", "committedDate": "2020-05-12T23:08:40Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "4e05e61b18b7f9886a713a76afe8951dbe367230", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4e05e61b18b7f9886a713a76afe8951dbe367230", "committedDate": "2020-05-12T23:31:33Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTAyMDkz", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-410502093", "createdAt": "2020-05-12T23:59:23Z", "commit": {"oid": "4e05e61b18b7f9886a713a76afe8951dbe367230"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1OToyM1rOGUdAPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDowMToxMFrOGUdCNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5OTkwMQ==", "bodyText": "change\nThe ACME service will request a new certificate from the ACME certificate authority at the {1} URI.\nto\nThe ACME service requests a new certificate from the ACME certificate authority at the {1} URI.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r424099901", "createdAt": "2020-05-12T23:59:23Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -285,3 +285,15 @@ CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate.\n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n+\n+CWPKI2063E=CWPKI2063E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2063E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2063E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2064I=CWPKI2064I: The certificate with the {0} serial number is revoked. The ACME service will request a new certificate from the ACME certificate authority at the {1} URI.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e05e61b18b7f9886a713a76afe8951dbe367230"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMDQwNw==", "bodyText": "change\nThe ACME Service detected that the certificate was revoked and automatically requests a new certificate.\nto\nThe ACME Service detected that the certificate was revoked and automatically requested a new certificate.\nor\nhe ACME Service detects that the certificate was revoked and automatically requests a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r424100407", "createdAt": "2020-05-13T00:01:10Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -285,3 +285,15 @@ CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate.\n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n+\n+CWPKI2063E=CWPKI2063E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2063E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2063E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2064I=CWPKI2064I: The certificate with the {0} serial number is revoked. The ACME service will request a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2064I.explanation=The ACME Service detected that the certificate was revoked and automatically requests a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e05e61b18b7f9886a713a76afe8951dbe367230"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e05e61b18b7f9886a713a76afe8951dbe367230", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4e05e61b18b7f9886a713a76afe8951dbe367230", "committedDate": "2020-05-12T23:31:33Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "26cfb4c4f35670924236ce7dce35ebc21dc23ff4", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/26cfb4c4f35670924236ce7dce35ebc21dc23ff4", "committedDate": "2020-05-14T12:26:03Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODIzNDA3", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-411823407", "createdAt": "2020-05-14T13:49:46Z", "commit": {"oid": "26cfb4c4f35670924236ce7dce35ebc21dc23ff4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMzo0OTo0NlrOGVdNBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMzo0OTo0NlrOGVdNBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE1MTc0OA==", "bodyText": "The ACME Service detected that the certificate was revoked and automatically requests a new certificate.\nneed to match the tense between detect and request- so\nThe ACME Service detected that the certificate was revoked and automatically requested a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r425151748", "createdAt": "2020-05-14T13:49:46Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -293,3 +293,15 @@ CWPKI2063E.useraction=Review the provided terms of service.\n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate expires on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2065W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2066E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service will request a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=The ACME Service detected that the certificate was revoked and automatically requests a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26cfb4c4f35670924236ce7dce35ebc21dc23ff4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODI1ODIw", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-411825820", "createdAt": "2020-05-14T13:52:12Z", "commit": {"oid": "26cfb4c4f35670924236ce7dce35ebc21dc23ff4"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26cfb4c4f35670924236ce7dce35ebc21dc23ff4", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/26cfb4c4f35670924236ce7dce35ebc21dc23ff4", "committedDate": "2020-05-14T12:26:03Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "109a476d7c7185b4407859b7daa6094b3a19b8d2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/109a476d7c7185b4407859b7daa6094b3a19b8d2", "committedDate": "2020-05-14T21:27:18Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTQyMzgy", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-412942382", "createdAt": "2020-05-15T20:20:46Z", "commit": {"oid": "109a476d7c7185b4407859b7daa6094b3a19b8d2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMDoyMDo0N1rOGWSsyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMDoyMjoxMlrOGWSvSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAyODIzMw==", "bodyText": "remove future tense-\nchange\nThe ACME service will request a new certificate from the ACME certificate authority at the {1} URI.\nto\nThe ACME service  requests a new certificate from the ACME certificate authority at the {1} URI.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r426028233", "createdAt": "2020-05-15T20:20:47Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -293,3 +293,15 @@ CWPKI2063E.useraction=Review the provided terms of service.\n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate expires on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2065W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2066E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service will request a new certificate from the ACME certificate authority at the {1} URI.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "109a476d7c7185b4407859b7daa6094b3a19b8d2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAyODg3NQ==", "bodyText": "change\nThe ACME Service detected that the certificate is revoked and will automatically request a new certificate.\nto\nThe ACME Service detected that the certificate is revoked and automatically requested a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r426028875", "createdAt": "2020-05-15T20:22:12Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -293,3 +293,15 @@ CWPKI2063E.useraction=Review the provided terms of service.\n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate expires on {1}. The renew request error is ''{2}''. The request is scheduled to try again in {3}.\n+CWPKI2065W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The renew request error is ''{1}''. The request is scheduled to try again in {2}.\n+CWPKI2066E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service will request a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=The ACME Service detected that the certificate is revoked and will automatically request a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "109a476d7c7185b4407859b7daa6094b3a19b8d2"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "109a476d7c7185b4407859b7daa6094b3a19b8d2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/109a476d7c7185b4407859b7daa6094b3a19b8d2", "committedDate": "2020-05-14T21:27:18Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "6845d90e9431ea0fa38bee94f5f61dda3fc290a9", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6845d90e9431ea0fa38bee94f5f61dda3fc290a9", "committedDate": "2020-05-18T23:19:01Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6845d90e9431ea0fa38bee94f5f61dda3fc290a9", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6845d90e9431ea0fa38bee94f5f61dda3fc290a9", "committedDate": "2020-05-18T23:19:01Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f77c3a044cc23674011c0bfe30e35aaf18bd666", "committedDate": "2020-05-19T03:41:38Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NTU4NTk3", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-414558597", "createdAt": "2020-05-19T15:20:42Z", "commit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyMDo0MlrOGXlstw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozNDowOVrOGXmUGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4ODA4Nw==", "bodyText": "The ACME Service detected that the certificate is revoked and automatically requests a new certificate.\nneed to get the verb tenses to agree- I think it wil read better like this:\nWhen the ACME Service detects that the certificate is revoked, it automatically requests a new certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r427388087", "createdAt": "2020-05-19T15:20:42Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -293,3 +294,15 @@ CWPKI2063E.useraction=Review the provided terms of service.\n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME Service failed to automatically renew the certificate with the {0} serial number. The request is scheduled to try again in {3}. The certificate expires on {1}. The renew request error is ''{2}''.\n+CWPKI2065W.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME Service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The request is scheduled to try again in {2}. The renew request error is ''{1}''.\n+CWPKI2066E.explanation=The ACME Service tried to renew a certificate but encountered an error. The ACME Service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service requests a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=The ACME Service detected that the certificate is revoked and automatically requests a new certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4OTM0NA==", "bodyText": "change\nThe user has sent too many requests in a given amount of time. The amount of time remaining until the next request is allowed is {0}.\nto\nThe user sent too many requests in a given amount of time. The amount of time remaining until the next request is allowed is {0}.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r427389344", "createdAt": "2020-05-19T15:22:22Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -32,6 +32,7 @@ REST_FORBIDDEN=Forbidden\n REST_INVALID_CONTENT_TYPE=The request's content-type header was not ''application/json''.\n REST_MISSING_OPERATION=The operation was not specified for the request.\n REST_NO_ACME_SERVICE=An AcmeProvider service was not registered.\n+REST_TOO_MANY_REQUESTS=The user has sent too many requests in a given amount of time. The amount of time remaining until the next request is allowed is {0}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5MzQzNg==", "bodyText": "change\nIf the first renew request does not work, the certificate renewal request continues until a new certificate is received using the timing set by certCheckerErrorSchedule.\nto\nIf the first renew request does not work, the certificate renewal request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r427393436", "createdAt": "2020-05-19T15:27:39Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Time period for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request does not work, the certificate renewal request continues until a new certificate is received using the timing set by certCheckerErrorSchedule.  Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renewal.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5NDUwMQ==", "bodyText": "does this specify an interval at which to issue renew requests or a span of time during which renewal requests occur (and beyond which they stop?)", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r427394501", "createdAt": "2020-05-19T15:29:00Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Time period for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request does not work, the certificate renewal request continues until a new certificate is received using the timing set by certCheckerErrorSchedule.  Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renewal.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Time period for the ACME CA service to check if the certificate is expiring or revoked if the first request failed. If expiring or revoked, the certificate is renewed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5ODE3MA==", "bodyText": "change\nDisables checking the minimum amount of time between certificate renew requests and allows immediate certificate renew requests\nto\nEnables immediate certificate renewal requests by disabling the specified minimum amount of time between renewal requests\nWhat sets the minimum that is disabled? Is a a default, or a value set by certCheckerErrorSchedule ?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r427398170", "createdAt": "2020-05-19T15:34:09Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Time period for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request does not work, the certificate renewal request continues until a new certificate is received using the timing set by certCheckerErrorSchedule.  Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renewal.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Time period for the ACME CA service to check if the certificate is expiring or revoked if the first request failed. If expiring or revoked, the certificate is renewed.\n+\n+disableMinRenewWindow=Disable minimum renew window\n+disableMinRenewWindow.desc=Disables checking the minimum amount of time between certificate renew requests and allows immediate certificate renew requests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f77c3a044cc23674011c0bfe30e35aaf18bd666", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f77c3a044cc23674011c0bfe30e35aaf18bd666", "committedDate": "2020-05-19T03:41:38Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "e96c8b9cd9994d138a3b734aac68474f75aa9e4f", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/e96c8b9cd9994d138a3b734aac68474f75aa9e4f", "committedDate": "2020-05-19T21:56:28Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e96c8b9cd9994d138a3b734aac68474f75aa9e4f", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/e96c8b9cd9994d138a3b734aac68474f75aa9e4f", "committedDate": "2020-05-19T21:56:28Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "64968e70abbb8c9982d7eb459895bccf146c716e", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64968e70abbb8c9982d7eb459895bccf146c716e", "committedDate": "2020-05-20T21:51:55Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64968e70abbb8c9982d7eb459895bccf146c716e", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64968e70abbb8c9982d7eb459895bccf146c716e", "committedDate": "2020-05-20T21:51:55Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2f6b2e064a59fab0895e2e923e8f743f676cb99e", "committedDate": "2020-05-21T19:50:22Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDA1ODM2", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-417005836", "createdAt": "2020-05-22T15:37:13Z", "commit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTozNzoxM1rOGZbhSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzozMDo1OVrOGZeuZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxODQ3Mw==", "bodyText": "The interface should specify AcmeCaException instead. The reason being, the CRRBE class is internal, and this interface is used by other components (none of which care about that exception). AcmeCaRestHandler would of course handle the CRRBE exception.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429318473", "createdAt": "2020-05-22T15:37:13Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/AcmeProvider.java", "diffHunk": "@@ -124,5 +125,14 @@ public File createDefaultSSLCertificate(String filePath, String password, String\n \t */\n \tpublic void updateDefaultSSLCertificate(KeyStore keyStore, File keyStoreFile, @Sensitive String password)\n \t\t\tthrows CertificateException;\n+\t\n+\t/**\n+\t * Checks whether a certificate renew is allowed. If a renew just happened, the\n+\t * request will be blocked.\n+\t * \n+\t * @throws CertificateRenewRequestBlockedException\n+\t * \t\t\tIf a certificate renew just happened\n+\t */\n+\tpublic void checkCertificateRenewAllowed() throws CertificateRenewRequestBlockedException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM1ODQwMQ==", "bodyText": "Did you mean to leave this TODO?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429358401", "createdAt": "2020-05-22T17:01:34Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeCertCheckerTask.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.security.acme.internal;\n+\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import com.ibm.websphere.ras.Tr;\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.websphere.ras.annotation.Trivial;\n+\n+/**\n+ * The AcmeCertChecker runs in the background and periodically checks if the\n+ * ACME CA certificate is either expiring or revoked and renews the certificate\n+ * if necessary.\n+ */\n+public class AcmeCertCheckerTask implements Runnable {\n+\n+\tprivate static final TraceComponent tc = Tr.register(AcmeCertCheckerTask.class);\n+\n+\tprivate final AcmeProviderImpl acmeProviderImpl;\n+\n+\tprivate ScheduledFuture<?> certChecker;\n+\n+\tprivate ScheduledExecutorService service = null;\n+\t\n+\tprivate volatile boolean runningOnErrorSchedule = false;\n+\n+\tpublic AcmeCertCheckerTask(AcmeProviderImpl acmePI) {\n+\t\tacmeProviderImpl = acmePI;\n+\t}\n+\n+\t/**\n+\t * Stop the scheduler and void the ScheduledFuture\n+\t */\n+\tpublic synchronized void stop() {\n+\t\tcancel(true);\n+\t\tcertChecker = null;\n+\t}\n+\n+\t/**\n+\t * Start the certificate checker scheduled task. It will first cancel any\n+\t * existing task and then schedule a new repeating task.\n+\t * \n+\t * @param service\n+\t * @param acmeCon\n+\t */\n+\tprotected synchronized void startCertificateChecker(ScheduledExecutorService service) {\n+\t\tcancel(true);\n+\n+\t\tif (acmeProviderImpl.getAcmeConfig() == null) {\n+\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\tTr.debug(tc, \"Provided acmeProviderImpl.getAcmeConfig() is null, cannot start certificate checker\");\n+\t\t\t}\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (acmeProviderImpl.getAcmeConfig().getCertCheckerScheduler() == 0\n+\t\t\t\t|| (!acmeProviderImpl.getAcmeConfig().isAutoRenewOnExpiration()\n+\t\t\t\t\t\t&& !acmeProviderImpl.getAcmeConfig().isRevocationCheckerEnabled())) {\n+\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\tTr.debug(tc,\n+\t\t\t\t\t\t\"ScheduledExecutorService not started for AcmeCertChecker, it is disabled-- getCertCheckerScheduler: \"\n+\t\t\t\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().getCertCheckerScheduler()\n+\t\t\t\t\t\t\t\t+ \", isAutoRenewOnExpiration: \"\n+\t\t\t\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().isAutoRenewOnExpiration()\n+\t\t\t\t\t\t\t\t+ \", isRevocationCheckerEnabled: \"\n+\t\t\t\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().isRevocationCheckerEnabled());\n+\t\t\t}\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (service == null) {\n+\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\tTr.debug(tc, \"Provided ScheduledExecutorService is null, cannot start certificate checker\");\n+\t\t\t}\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tthis.service = service;\n+\n+\t\tif (tc.isDebugEnabled()) {\n+\t\t\tTr.debug(tc, \"ScheduledExecutorService starting, time: \"\n+\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().getCertCheckerScheduler());\n+\t\t}\n+\t\tstartRegularSchedule();\n+\t}\n+\n+\t/**\n+\t * Scheduled task to check if the current certificate is expiring or revoked. If\n+\t * it is expiring or revoked, a certificate request is made. If an exception occurs,\n+\t * it continues to run, but is rescheduled on the error schedule.\n+\t */\n+\t@Override\n+\tpublic void run() {\n+\n+\t\tboolean isExpired = false, isRevoked = false;\n+\t\tList<X509Certificate> currentCert = null;\n+\n+\t\tacmeProviderImpl.acquireWriteLock();\n+\t\ttry {\n+\t\t\tcurrentCert = acmeProviderImpl.getConfiguredDefaultCertificateChain();\n+\n+\t\t\tif (currentCert == null) {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"Attempted to check the current certificate, but it was null.\");\n+\t\t\t\t}\n+\t\t\t\treturn;\n+\t\t\t} else {\n+\t\t\t\tif (acmeProviderImpl.getAcmeConfig().isAutoRenewOnExpiration()\n+\t\t\t\t\t\t&& acmeProviderImpl.isExpired(currentCert)) {\n+\t\t\t\t\tisExpired = true;\n+\t\t\t\t} else if (acmeProviderImpl.isRevoked(currentCert)) {\n+\t\t\t\t\tisRevoked = true;\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (isExpired || isRevoked) {\n+\t\t\t\tif (isExpired) {\n+\t\t\t\t\tTr.info(tc, \"CWPKI2052I\", currentCert.get(0).getSerialNumber().toString(16),\n+\t\t\t\t\t\t\tcurrentCert.get(0).getNotAfter().toInstant().toString(),\n+\t\t\t\t\t\t\tacmeProviderImpl.getAcmeConfig().getDirectoryURI());\n+\t\t\t\t} else if (isRevoked) {\n+\t\t\t\t\tTr.info(tc, \"CWPKI2067I\", currentCert.get(0).getSerialNumber().toString(16),\n+\t\t\t\t\t\t\tacmeProviderImpl.getAcmeConfig().getDirectoryURI());\n+\t\t\t\t}\n+\t\t\t\tacmeProviderImpl.renewCertificate();\n+\t\t\t} else {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc,\n+\t\t\t\t\t\t\t\"ACME automatic certificate checker verified that the ACME CA cert is valid. Next check is \"\n+\t\t\t\t\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().getCertCheckerScheduler() + \"ms. SN is \"\n+\t\t\t\t\t\t\t\t\t+ currentCert.get(0).getSerialNumber().toString(16));\n+\t\t\t\t}\n+\n+\t\t\t\tif (runningOnErrorSchedule) {\n+\t\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\t\tTr.debug(tc,\n+\t\t\t\t\t\t\t\t\"ACME automatic certificate checker was running on error time, but we have a valid certificate, swap back to the regular schedule\");\n+\t\t\t\t\t}\n+\t\t\t\t\tstartRegularSchedule();\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t}\n+\n+\t\t} catch (Throwable t) {\n+\t\t\ttry {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"Requested a new certificate, but request failed.\", t);\n+\t\t\t\t}\n+\t\t\t\tif (currentCert == null) {\n+\t\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\t\tTr.debug(tc,\n+\t\t\t\t\t\t\t\t\"Attempted to check the current certificate, but it was null. Stay on regular schedule.\");\n+\t\t\t\t\t}\n+\t\t\t\t\treturn;\n+\t\t\t\t} else {\n+\t\t\t\t\tString sn = currentCert.get(0).getSerialNumber().toString(16);\n+\t\t\t\t\tif (isExpired) {\n+\t\t\t\t\t\tTr.warning(tc, \"CWPKI2065W\", sn,\n+\t\t\t\t\t\t\t\tacmeProviderImpl.getAcmeConfig().getCertCheckerErrorScheduler() + \"ms\",\n+\t\t\t\t\t\t\t\tcurrentCert.get(0).getNotAfter().toInstant().toString(), t);\n+\t\t\t\t\t} else if (isRevoked) {\n+\t\t\t\t\t\tTr.error(tc, \"CWPKI2066E\", sn,\n+\t\t\t\t\t\t\t\tacmeProviderImpl.getAcmeConfig().getCertCheckerErrorScheduler() + \"ms\", t);\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tTr.warning(tc, \"CWPKI2068W\", sn,\n+\t\t\t\t\t\t\t\tacmeProviderImpl.getAcmeConfig().getCertCheckerErrorScheduler() + \"ms\", t);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tcancel(false);\n+\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"Certificate request failed, swapping to the error schedule: \"\n+\t\t\t\t\t\t\t+ acmeProviderImpl.getAcmeConfig().getCertCheckerErrorScheduler());\n+\t\t\t\t}\n+\t\t\t} finally {\n+\t\t\t\tstartErrorSchedule();\n+\t\t\t}\n+\n+\t\t} finally {\n+\t\t\tacmeProviderImpl.releaseWriteLock();\n+\n+\t\t\t// to-do: Can we fall into a hole where we canceled the previous schedule and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MDA3Nw==", "bodyText": "Weird that we are using junit.framework.Assert and org.junit.Assert", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429360077", "createdAt": "2020-05-22T17:05:40Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/fat/AcmeSimpleTest.java", "diffHunk": "@@ -12,11 +12,13 @@\n \n import static junit.framework.Assert.assertEquals;\n import static junit.framework.Assert.assertFalse;\n+import static junit.framework.Assert.assertNotNull;\n import static junit.framework.Assert.fail;\n import static org.hamcrest.CoreMatchers.equalTo;\n import static org.hamcrest.CoreMatchers.not;\n-import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MTc2Nw==", "bodyText": "assertNotSame checks whether they are the same exact instance, not that they are equivalent. You may want to assert that the serials are not the same number (not instance)", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429361767", "createdAt": "2020-05-22T17:09:51Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/fat/AcmeValidityAndRenewTest.java", "diffHunk": "@@ -347,14 +362,302 @@ public void serverRenewOnRestart() throws Exception {\n \t\t\tassertNotSame(\"The certificate should have been marked as expired at startup and renewed.\",\n \t\t\t\t\t((X509Certificate) startingCertificateChain[0]).getSerialNumber(),\n \t\t\t\t\t((X509Certificate) endingCertificateChain[0]).getSerialNumber());\n+\n+\t\t\tassertNotNull(\"Should log  message that the certificate was renewed\",\n+\t\t\t\t\tserver.waitForStringInLogUsingMark(\"CWPKI2052I\"));\n \t\t} finally {\n-\t\t\tLog.info(this.getClass(), methodName, \"TEST 2: Shutdown.\");\n+\t\t\tLog.info(this.getClass(), testName.getMethodName(), \"TEST 2: Shutdown.\");\n \n \t\t\t/*\n \t\t\t * Stop the server.\n \t\t\t */\n \t\t\tserver.stopServer(\"CWPKI2055W\"); // we are running with and intentionally short renewBeforeExpiration.\n \t\t}\n \n+\t\t/***********************************************************************\n+\t\t * \n+\t\t * TEST 3: Start with a very short renew period and short cert checker time out,\n+\t\t * causing a renew request at runtime.\n+\t\t * \n+\t\t **********************************************************************/\n+\t\ttry {\n+\t\t\tLog.info(this.getClass(), testName.getMethodName(),\n+\t\t\t\t\t\"TEST 3: Restart with renew time close to validity period and short cert checker.\");\n+\n+\t\t\tconfiguration.getAcmeCA().setCertCheckerSchedule((timeBufferToExpire + 1000) + \"ms\");\n+\t\t\tconfiguration.getAcmeCA().setCertCheckerSchedule(AcmeConstants.RENEW_CERT_MIN + \"ms\");\n+\n+\t\t\tAcmeFatUtils.configureAcmeCA(server, caContainer, configuration, DOMAINS1);\n+\n+\t\t\tserver.startServer();\n+\t\t\tAcmeFatUtils.waitForAcmeAppToStart(server);\n+\t\t\tAcmeFatUtils.waitForSslEndpoint(server);\n+\n+\t\t\t/*\n+\t\t\t * Verify that the server got a new certificate at startup\n+\t\t\t */\n+\t\t\tendingCertificateChain = AcmeFatUtils.assertAndGetServerCertificate(server, caContainer);\n+\n+\t\t\tassertNotSame(\"The certificate should have been marked as expired at startup and renewed.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MjI5MQ==", "bodyText": "methodName could be replaced by testName.getMethodName()", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429362291", "createdAt": "2020-05-22T17:11:05Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/fat/AcmeValidityAndRenewTest.java", "diffHunk": "@@ -119,6 +133,7 @@ public void serverBelowMinRenew() throws Exception {\n \n \t\t\tassertNotNull(\"Should log warning on minimum renewBeforeExpiration\",\n \t\t\t\t\tserver.waitForStringInLog(\"CWPKI2051W\"));\n+\t\t\tAcmeFatUtils.assertAndGetServerCertificate(server, caContainer);\n \n \t\t} finally {\n \t\t\tLog.info(this.getClass(), methodName, \"TEST 1: Shutdown.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MjkwMA==", "bodyText": "assertThat(value, not(equal(othervalue)))", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429362900", "createdAt": "2020-05-22T17:12:31Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/fat/AcmeValidityAndRenewTest.java", "diffHunk": "@@ -347,14 +362,302 @@ public void serverRenewOnRestart() throws Exception {\n \t\t\tassertNotSame(\"The certificate should have been marked as expired at startup and renewed.\",\n \t\t\t\t\t((X509Certificate) startingCertificateChain[0]).getSerialNumber(),\n \t\t\t\t\t((X509Certificate) endingCertificateChain[0]).getSerialNumber());\n+\n+\t\t\tassertNotNull(\"Should log  message that the certificate was renewed\",\n+\t\t\t\t\tserver.waitForStringInLogUsingMark(\"CWPKI2052I\"));\n \t\t} finally {\n-\t\t\tLog.info(this.getClass(), methodName, \"TEST 2: Shutdown.\");\n+\t\t\tLog.info(this.getClass(), testName.getMethodName(), \"TEST 2: Shutdown.\");\n \n \t\t\t/*\n \t\t\t * Stop the server.\n \t\t\t */\n \t\t\tserver.stopServer(\"CWPKI2055W\"); // we are running with and intentionally short renewBeforeExpiration.\n \t\t}\n \n+\t\t/***********************************************************************\n+\t\t * \n+\t\t * TEST 3: Start with a very short renew period and short cert checker time out,\n+\t\t * causing a renew request at runtime.\n+\t\t * \n+\t\t **********************************************************************/\n+\t\ttry {\n+\t\t\tLog.info(this.getClass(), testName.getMethodName(),\n+\t\t\t\t\t\"TEST 3: Restart with renew time close to validity period and short cert checker.\");\n+\n+\t\t\tconfiguration.getAcmeCA().setCertCheckerSchedule((timeBufferToExpire + 1000) + \"ms\");\n+\t\t\tconfiguration.getAcmeCA().setCertCheckerSchedule(AcmeConstants.RENEW_CERT_MIN + \"ms\");\n+\n+\t\t\tAcmeFatUtils.configureAcmeCA(server, caContainer, configuration, DOMAINS1);\n+\n+\t\t\tserver.startServer();\n+\t\t\tAcmeFatUtils.waitForAcmeAppToStart(server);\n+\t\t\tAcmeFatUtils.waitForSslEndpoint(server);\n+\n+\t\t\t/*\n+\t\t\t * Verify that the server got a new certificate at startup\n+\t\t\t */\n+\t\t\tendingCertificateChain = AcmeFatUtils.assertAndGetServerCertificate(server, caContainer);\n+\n+\t\t\tassertNotSame(\"The certificate should have been marked as expired at startup and renewed.\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MTc2Nw=="}, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2Mzg4Mg==", "bodyText": "Did you mean to leave this TODO?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429363882", "createdAt": "2020-05-22T17:14:49Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/fat/AcmeCaRestHandlerTest.java", "diffHunk": "@@ -139,7 +143,7 @@ public static void afterClass() throws Exception {\n \t\t/*\n \t\t * Stop the server.\n \t\t */\n-\t\tserver.stopServer();\n+\t\tserver.stopServer(\"CWPKI2058W\"); // TODO -- check failure revocation \"soft error\" msg", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NTU0NA==", "bodyText": "Not sure about this. Our goal was to have the CAContainer's be identical. Why are we stopping the challenge server? If we are doing it to stop the mock DNS server, then we should name it \"stopDnsServer()\" or something similar. The CAContainer should have a method that throws UnsupportedOperationException for any CAContainer impls that can't stop the DNS.\nSee getOcspResponderUrl().", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429365544", "createdAt": "2020-05-22T17:18:49Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/docker/pebble/PebbleContainer.java", "diffHunk": "@@ -120,6 +123,16 @@ public void stop() {\n \t\tsuper.stop();\n \t\tnetwork.close();\n \t}\n+\t\n+\tpublic void stopChallengeServer() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NTcyMA==", "bodyText": "The same as stopChallengeServer().", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429365720", "createdAt": "2020-05-22T17:19:16Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme_fat/fat/src/com/ibm/ws/security/acme/docker/pebble/PebbleContainer.java", "diffHunk": "@@ -120,6 +123,16 @@ public void stop() {\n \t\tsuper.stop();\n \t\tnetwork.close();\n \t}\n+\t\n+\tpublic void stopChallengeServer() {\n+\t\tchalltestsrv.stop();\n+\t\tLog.info(PebbleContainer.class, \"stopChallengeServer\", \"Challenge server stopped.\");\n+\t}\n+\t\n+\tpublic void startChallengeServer() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NjkwMw==", "bodyText": "Probably should define whether this in ms or s or whatever unit. The set / get methods should be updated as well to make it clear.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429366903", "createdAt": "2020-05-22T17:21:43Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/exceptions/CertificateRenewRequestBlockedException.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.security.acme.internal.exceptions;\n+\n+import com.ibm.websphere.ras.annotation.Trivial;\n+import com.ibm.ws.security.acme.AcmeCaException;\n+\n+/**\n+ * Exception that is thrown when a certificate renew request occurs too\n+ * soon after the prior request.\n+ */\n+@Trivial\n+public class CertificateRenewRequestBlockedException extends AcmeCaException {\n+\n+\tprivate static final long serialVersionUID = -2381844611991560528L;\n+\t\n+\tprivate long timeLeft = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NzI3MQ==", "bodyText": "description", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429367271", "createdAt": "2020-05-22T17:22:32Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/exceptions/CertificateRenewRequestBlockedException.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.security.acme.internal.exceptions;\n+\n+import com.ibm.websphere.ras.annotation.Trivial;\n+import com.ibm.ws.security.acme.AcmeCaException;\n+\n+/**\n+ * Exception that is thrown when a certificate renew request occurs too\n+ * soon after the prior request.\n+ */\n+@Trivial\n+public class CertificateRenewRequestBlockedException extends AcmeCaException {\n+\n+\tprivate static final long serialVersionUID = -2381844611991560528L;\n+\t\n+\tprivate long timeLeft = -1;\n+\n+\t/**\n+\t * Constructs a new exception with the specified detail message. The cause\n+\t * is not initialized, and may subsequently be initialized by a call to\n+\t * initCause.\n+\t * \n+\t * @param message\n+\t *            the detail message. The detail message is saved for later\n+\t *            retrieval by the {@link #getMessage()} method.\n+\t */\n+\tpublic CertificateRenewRequestBlockedException(String message) {\n+\t\tsuper(message);\n+\t}\n+\n+\t/**\n+\t * Constructs a new exception with the specified detail message and cause.\n+\t * <p/>\n+\t * Note that the detail message associated with cause is not automatically\n+\t * incorporated in this exception's detail message.\n+\t * \n+\t * @param message\n+\t *            the detail message (which is saved for later retrieval by the\n+\t *            {@link #getMessage()} method).\n+\t * @param cause\n+\t *            the cause (which is saved for later retrieval by the\n+\t *            {@link #getCause()} method). (A null value is permitted, and\n+\t *            indicates that the cause is nonexistent or unknown.)\n+\t */\n+\tpublic CertificateRenewRequestBlockedException(String message, Throwable cause) {\n+\t\tsuper(message, cause);\n+\t}\n+\t\n+\t/**\n+\t * Set the amount of time left before the next renewal request is allowed.\n+\t * \n+\t * @param tf", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2ODA3MA==", "bodyText": "I would maybe make the constructor for CRRBE take the time remaining so it is always forced to be set. Doubt anywhere else will use this exception though.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429368070", "createdAt": "2020-05-22T17:24:22Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeProviderImpl.java", "diffHunk": "@@ -881,5 +966,71 @@ protected void updateAcmeConfigService(AcmeConfigService acmeConfigService, Map<\n \tpublic void setAcmeApplicationStateListener(AcmeApplicationStateListener acmeApplicationStateListener) {\n \t\tapplicationStateListenerRef.set(acmeApplicationStateListener);\n \t}\n+\t\n+\t/**\n+\t * Set the Scheduler service ref\n+\t */\n+\t@Reference(name = \"scheduledExecutorService\", service = ScheduledExecutorService.class, target = \"(deferrable=false)\")\n+\tprotected void setScheduledExecutorService(ServiceReference<ScheduledExecutorService> ref) {\n+\t\tscheduledExecutorServiceRef.setReference(ref);\n+\t}\n+\n+\t/**\n+\t * Unset the scheduler ref and stop the certificate checker\n+\t */\n+\tprotected void unsetScheduledExecutorService(ServiceReference<ScheduledExecutorService> ref) {\n+\t\tif (acmeCertChecker != null) {\n+\t\t\tacmeCertChecker.stop();\n+\t\t}\n+\t\tscheduledExecutorServiceRef.unsetReference(ref);\n+\t}\n+\n+\t/**\n+\t * Get the scheduler ref\n+\t */\n+\tpublic ScheduledExecutorService getScheduledExecutorService() {\n+\t\treturn scheduledExecutorServiceRef.getService();\n+\t}\n \n+    /**\n+     * Acquire the writer lock. To be used to prevent concurrent certificate\n+     * renew or revoke requests. Must be used with releaseWriteLock\n+     */\n+    @Trivial\n+    void acquireWriteLock() {\n+\t\trwRenewCertLock.writeLock().lock();\n+    }\n+    \n+    /**\n+     * Release the writer lock. To be used to prevent concurrent certificate\n+     * renew or revoke requests. Must be used with acquireWriteLock\n+     */\n+    @Trivial\n+    void releaseWriteLock() {\n+    \trwRenewCertLock.writeLock().unlock();\n+    }\n+    \n+    /**\n+     * Checks whether certificate renewal is allowed. It is allowed if:\n+     * <li>Certificate renewal checking is disabled</li>\n+     * <li>This is the first certificate request</li>\n+     * <li>Enough time has passed since the last renewal</li>\n+     * \n+     * If certificate renewal is not allowed, an exception is thrown.\n+     */\n+    @Override\n+    public void checkCertificateRenewAllowed() throws CertificateRenewRequestBlockedException {\n+    \tlong timeDiff = System.currentTimeMillis() - lastCertificateRenewalTimestamp;\n+    \tif (acmeConfig.isDisableMinRenewWindow() || lastCertificateRenewalTimestamp == -1 || (timeDiff >= AcmeConstants.RENEW_CERT_MIN)) {\n+    \t\treturn;\n+    \t}\n+\n+    \tif (tc.isDebugEnabled()) {\n+    \t\tTr.debug(tc, \"Too soon to renew, last certificate renewal was \" + lastCertificateRenewalTimestamp);\n+    \t}\n+    \tCertificateRenewRequestBlockedException cr = new CertificateRenewRequestBlockedException(\"Too soon to renew, last certificate renewal was \" + lastCertificateRenewalTimestamp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 333}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2OTQxMA==", "bodyText": "I think you can define a minimum in the metatype. Not sure if that would work better. If you don't do it there, should you have a warning message here instead of debug?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429369410", "createdAt": "2020-05-22T17:27:24Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfig.java", "diffHunk": "@@ -616,4 +645,82 @@ private static void validateKeyFilePath(String path, String type) throws AcmeCaE\n \t\t\t}\n \t\t}\n \t}\n+\t\n+\t/**\n+\t * \n+\t * @return the certCheckerScheduler\n+\t */\n+\t@Trivial\n+\tpublic Long getCertCheckerScheduler() {\n+\t\treturn certCheckerScheduler;\n+\t}\n+\n+\t/**\n+\t * Sets the certCheckerScheduler. If set to 0 or less, the certificate\n+\t * checker is considered disabled. If set below the min renew time, reset to the\n+\t * min renew time.\n+\t * @param certCheckerScheduler\n+\t */\n+\tpublic void setCertCheckerScheduler(Long certCheckerScheduler) {\t\t\n+\t\tif (certCheckerScheduler != null) {\n+\t\t\tif (certCheckerScheduler <= 0) {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"certChecker is disabled\");\n+\t\t\t\t}\n+\t\t\t\tthis.certCheckerScheduler = 0L;\n+\t\t\t} else if (certCheckerScheduler < AcmeConstants.RENEW_CERT_MIN) {\n+\t\t\t\t/*\n+\t\t\t\t * Too low of a timeout, reset to the min renew allowed\n+\t\t\t\t */\n+\t\t\t\tthis.certCheckerScheduler = AcmeConstants.RENEW_CERT_MIN;\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"certCheckerScheduler is reset to the minimum: \"+ this.certCheckerScheduler);\n+\t\t\t\t}\n+\t\t\t} else { \n+\t\t\t\tthis.certCheckerScheduler = certCheckerScheduler;\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t\n+\t/**\n+\t * Get the certCheckerErrorScheduler\n+\t * @return certCheckerErrorScheduler\n+\t */\n+\t@Trivial\n+\tpublic Long getCertCheckerErrorScheduler() {\n+\t\treturn certCheckerErrorScheduler;\n+\t}\n+\n+\t/**\n+\t * Set the certCheckerErrorScheduler\n+\t * If it is set below the min renewal time, reset to the min renewal time\n+\t *\n+\t * @param certCheckerErrorScheduler\n+\t */\n+\tpublic void setCertCheckerErrorScheduler(Long certCheckerErrorScheduler) {\n+\t\tif (certCheckerErrorScheduler != null) {\n+\t\t\tif (certCheckerErrorScheduler < AcmeConstants.RENEW_CERT_MIN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2OTc2NA==", "bodyText": "Warning?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429369764", "createdAt": "2020-05-22T17:28:15Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfig.java", "diffHunk": "@@ -616,4 +645,82 @@ private static void validateKeyFilePath(String path, String type) throws AcmeCaE\n \t\t\t}\n \t\t}\n \t}\n+\t\n+\t/**\n+\t * \n+\t * @return the certCheckerScheduler\n+\t */\n+\t@Trivial\n+\tpublic Long getCertCheckerScheduler() {\n+\t\treturn certCheckerScheduler;\n+\t}\n+\n+\t/**\n+\t * Sets the certCheckerScheduler. If set to 0 or less, the certificate\n+\t * checker is considered disabled. If set below the min renew time, reset to the\n+\t * min renew time.\n+\t * @param certCheckerScheduler\n+\t */\n+\tpublic void setCertCheckerScheduler(Long certCheckerScheduler) {\t\t\n+\t\tif (certCheckerScheduler != null) {\n+\t\t\tif (certCheckerScheduler <= 0) {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"certChecker is disabled\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2OTgzNg==", "bodyText": "Warning?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429369836", "createdAt": "2020-05-22T17:28:25Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeConfig.java", "diffHunk": "@@ -616,4 +645,82 @@ private static void validateKeyFilePath(String path, String type) throws AcmeCaE\n \t\t\t}\n \t\t}\n \t}\n+\t\n+\t/**\n+\t * \n+\t * @return the certCheckerScheduler\n+\t */\n+\t@Trivial\n+\tpublic Long getCertCheckerScheduler() {\n+\t\treturn certCheckerScheduler;\n+\t}\n+\n+\t/**\n+\t * Sets the certCheckerScheduler. If set to 0 or less, the certificate\n+\t * checker is considered disabled. If set below the min renew time, reset to the\n+\t * min renew time.\n+\t * @param certCheckerScheduler\n+\t */\n+\tpublic void setCertCheckerScheduler(Long certCheckerScheduler) {\t\t\n+\t\tif (certCheckerScheduler != null) {\n+\t\t\tif (certCheckerScheduler <= 0) {\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"certChecker is disabled\");\n+\t\t\t\t}\n+\t\t\t\tthis.certCheckerScheduler = 0L;\n+\t\t\t} else if (certCheckerScheduler < AcmeConstants.RENEW_CERT_MIN) {\n+\t\t\t\t/*\n+\t\t\t\t * Too low of a timeout, reset to the min renew allowed\n+\t\t\t\t */\n+\t\t\t\tthis.certCheckerScheduler = AcmeConstants.RENEW_CERT_MIN;\n+\t\t\t\tif (tc.isDebugEnabled()) {\n+\t\t\t\t\tTr.debug(tc, \"certCheckerScheduler is reset to the minimum: \"+ this.certCheckerScheduler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDI1MQ==", "bodyText": "A few methods in here without javadoc", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429370251", "createdAt": "2020-05-22T17:29:25Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeCertCheckerTask.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*******************************************************************************", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDQ1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * @param acmeCon", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429370455", "createdAt": "2020-05-22T17:29:53Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeCertCheckerTask.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.security.acme.internal;\n+\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import com.ibm.websphere.ras.Tr;\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.websphere.ras.annotation.Trivial;\n+\n+/**\n+ * The AcmeCertChecker runs in the background and periodically checks if the\n+ * ACME CA certificate is either expiring or revoked and renews the certificate\n+ * if necessary.\n+ */\n+public class AcmeCertCheckerTask implements Runnable {\n+\n+\tprivate static final TraceComponent tc = Tr.register(AcmeCertCheckerTask.class);\n+\n+\tprivate final AcmeProviderImpl acmeProviderImpl;\n+\n+\tprivate ScheduledFuture<?> certChecker;\n+\n+\tprivate ScheduledExecutorService service = null;\n+\t\n+\tprivate volatile boolean runningOnErrorSchedule = false;\n+\n+\tpublic AcmeCertCheckerTask(AcmeProviderImpl acmePI) {\n+\t\tacmeProviderImpl = acmePI;\n+\t}\n+\n+\t/**\n+\t * Stop the scheduler and void the ScheduledFuture\n+\t */\n+\tpublic synchronized void stop() {\n+\t\tcancel(true);\n+\t\tcertChecker = null;\n+\t}\n+\n+\t/**\n+\t * Start the certificate checker scheduled task. It will first cancel any\n+\t * existing task and then schedule a new repeating task.\n+\t * \n+\t * @param service\n+\t * @param acmeCon", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDk4MQ==", "bodyText": "AcmeCertCheckerTask", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r429370981", "createdAt": "2020-05-22T17:30:59Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeCertCheckerTask.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.security.acme.internal;\n+\n+import java.security.cert.X509Certificate;\n+import java.util.List;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import com.ibm.websphere.ras.Tr;\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.websphere.ras.annotation.Trivial;\n+\n+/**\n+ * The AcmeCertChecker runs in the background and periodically checks if the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f6b2e064a59fab0895e2e923e8f743f676cb99e", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2f6b2e064a59fab0895e2e923e8f743f676cb99e", "committedDate": "2020-05-21T19:50:22Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "4c430e4a4aa51c28870fe00d27f787c59b50cc25", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4c430e4a4aa51c28870fe00d27f787c59b50cc25", "committedDate": "2020-05-22T22:10:45Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c430e4a4aa51c28870fe00d27f787c59b50cc25", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4c430e4a4aa51c28870fe00d27f787c59b50cc25", "committedDate": "2020-05-22T22:10:45Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "3816e4fc8368dd22b2fc4800f98bcd1363d536f2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3816e4fc8368dd22b2fc4800f98bcd1363d536f2", "committedDate": "2020-05-22T22:21:11Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3816e4fc8368dd22b2fc4800f98bcd1363d536f2", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3816e4fc8368dd22b2fc4800f98bcd1363d536f2", "committedDate": "2020-05-22T22:21:11Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "20b9ee25148a21b80557b3d3c5873fcc63c93785", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/20b9ee25148a21b80557b3d3c5873fcc63c93785", "committedDate": "2020-05-25T03:07:33Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20b9ee25148a21b80557b3d3c5873fcc63c93785", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/20b9ee25148a21b80557b3d3c5873fcc63c93785", "committedDate": "2020-05-25T03:07:33Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f7380198621b5ef646f62d5cc58d92900f8460d3", "committedDate": "2020-05-25T03:36:29Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDc1NjUz", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-418475653", "createdAt": "2020-05-26T16:32:58Z", "commit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjozMjo1OFrOGampXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjo1NDoyMFrOGanjoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU0OTM0Mg==", "bodyText": "If expiring or revoked, the certificate is renewed\nShould this be\n`If the certificate is expiring or revoked, the Acme CA service issues a certificate  renew request.'", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430549342", "createdAt": "2020-05-26T16:32:58Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request fails, the certificate renew request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received. Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renew requests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU1MjkyOQ==", "bodyText": "Interval for the ACME CA service to check if the certificate is expiring or revoked after the first renew request failed using the certCheckerSchedule property interval\nThis is a little confusing- does it mean that this is interval at which the service checks for an expiring or revoked certificate after a failed renew request? If so, why? If there's been a renew request, then hasn't the service already determined that the certificate is expiring or revoked? Or maybe if the certCheckerSchedule detects an \"expiring\" certificate, this checks to make sure it hasn't actually expired since the failed renew request? Maybe I'm just reading it wrong", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430552929", "createdAt": "2020-05-26T16:38:34Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request fails, the certificate renew request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received. Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renew requests.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked after the first renew request failed using the certCheckerSchedule property interval. The certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU1Mzk5Ng==", "bodyText": "for consistency with other messages in this file, change renewal requests to renew requests", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430553996", "createdAt": "2020-05-26T16:39:52Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked. If expiring or revoked, the certificate is renewed. If the first renew request fails, the certificate renew request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received. Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renew requests.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked after the first renew request failed using the certCheckerSchedule property interval. The certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. \n+\n+disableMinRenewWindow=Disable minimum renew window\n+disableMinRenewWindow.desc=Enables immediate certificate renewal requests by disabling the specified minimum amount of time between renewal requests. The minimum renewal time is to 15 seconds.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MDQ1Ng==", "bodyText": "change\nThe existing account key pair file did not back up during while the account key pair renewal. \nto\nThe existing account key pair file did not back up during the account key pair renewal.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430560456", "createdAt": "2020-05-26T16:47:58Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -230,11 +231,11 @@ CWPKI2048I=CWPKI2048I: The account key pair renewal is successful. The old accou\n CWPKI2048I.explanation=The previous account key pair is no longer associated with the account and is backed up to a file. The new account key pair replaced the old account key pair file.\n CWPKI2048I.useraction=No action is required.\n \n-CWPKI2049E=CWPKI2049E: The account key pair didn''t renew or restore to the existing key pair file. Manually replace the {0} account key pair file with the {1} account key pair file.\n+CWPKI2049E=CWPKI2049E: The account key pair did not renew or restore to the existing key pair file. Manually replace the {0} account key pair file with the {1} account key pair file.\n CWPKI2049E.explanation=The key pair didn't renew or restore to the old key pair file.\n CWPKI2049E.useraction=Manually replace the account key pair files as directed in the message.\n \n-CWPKI2050E=CWPKI2050E: The existing account key pair file didn''t back up during while the account key pair renewal. The error is ''{0}''.\n+CWPKI2050E=CWPKI2050E: The existing account key pair file did not back up during while the account key pair renewal. The error is ''{0}''.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MTE3Mw==", "bodyText": "Certificate revocation status checking did not create a CertPathValidator to validate the certificate.\nwhat is CertPathValidator ? Is it a property?, If so\nCertificate revocation status checking did not create a value for the CertPathValidator property to validate the certificate.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430561173", "createdAt": "2020-05-26T16:49:11Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -262,7 +263,7 @@ CWPKI2056W=CWPKI2056W: The validity period of the certificate with {0} serial nu\n CWPKI2056W.explanation=The validity period is shorter than the minimum renew time. The certificate expires before a new certificate is requested.\n CWPKI2056W.useraction=To avoid certificate expiration, request a certificate with a longer validity period. If the certificate authority supports a custom validity period, set the validFor property in the server configuration.\n \n-CWPKI2057E=CWPKI2057E: Certificate revocation status checking didn''t create a CertPathValidator to validate the certificate. The error is ''{0}''.\n+CWPKI2057E=CWPKI2057E: Certificate revocation status checking did not create a CertPathValidator to validate the certificate. The error is ''{0}''.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MjE4OQ==", "bodyText": "Change  SSL/TLS requests to  SSL and TLS requests", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430562189", "createdAt": "2020-05-26T16:50:54Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -274,23 +275,50 @@ CWPKI2059I=CWPKI2059I: Certificate revocation status checking found that the cer\n CWPKI2059I.explanation=The ACME service found that the certificate was marked revoked by either a CRL or OSCP responder. \n CWPKI2059I.useraction=No action is required.\n \n-CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number wasn''t retrieved. The error is: ''{1}''.\n+CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number was not retrieved. The error is: ''{1}''.\n CWPKI2060E.explanation=The OCSP URL was not retrieved.\n CWPKI2060E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n-CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number weren''t retrieved. The error is ''{1}''.\n+CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number were not retrieved. The error is ''{1}''.\n CWPKI2061E.explanation=The CRL distribution points were not retrieved.\n CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n \n-\n CWPKI2063E=CWPKI2063E: The ACME certificate authority at the {0} URI updated its terms of service and now requires the user to agree to the new terms of service at the following URI before it processes any further requests: {1}\n CWPKI2063E.explanation=The certificate authority updated its terms of service and requires user interaction.\n CWPKI2063E.useraction=Review the provided terms of service.\n \n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n-CWPKI2064I.useraction=No action is required.\n\\ No newline at end of file\n+CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME service failed to automatically renew the certificate with the {0} serial number. The request is scheduled to try again in {1}. The certificate expires on {2}. The renew request error is ''{3}''.\n+CWPKI2065W.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The request is scheduled to try again in {1}. The renew request error is ''{2}''.\n+CWPKI2066E.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MzAyNQ==", "bodyText": "Change SSL/TLS requests to SSL and TLS requests", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430563025", "createdAt": "2020-05-26T16:52:24Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -274,23 +275,50 @@ CWPKI2059I=CWPKI2059I: Certificate revocation status checking found that the cer\n CWPKI2059I.explanation=The ACME service found that the certificate was marked revoked by either a CRL or OSCP responder. \n CWPKI2059I.useraction=No action is required.\n \n-CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number wasn''t retrieved. The error is: ''{1}''.\n+CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number was not retrieved. The error is: ''{1}''.\n CWPKI2060E.explanation=The OCSP URL was not retrieved.\n CWPKI2060E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n-CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number weren''t retrieved. The error is ''{1}''.\n+CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number were not retrieved. The error is ''{1}''.\n CWPKI2061E.explanation=The CRL distribution points were not retrieved.\n CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n \n-\n CWPKI2063E=CWPKI2063E: The ACME certificate authority at the {0} URI updated its terms of service and now requires the user to agree to the new terms of service at the following URI before it processes any further requests: {1}\n CWPKI2063E.explanation=The certificate authority updated its terms of service and requires user interaction.\n CWPKI2063E.useraction=Review the provided terms of service.\n \n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n-CWPKI2064I.useraction=No action is required.\n\\ No newline at end of file\n+CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME service failed to automatically renew the certificate with the {0} serial number. The request is scheduled to try again in {1}. The certificate expires on {2}. The renew request error is ''{3}''.\n+CWPKI2065W.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The request is scheduled to try again in {1}. The renew request error is ''{2}''.\n+CWPKI2066E.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service requests a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=When the ACME service detects that the certificate is revoked, it automatically requests a new certificate.\n+CWPKI2067I.useraction=No action is required.\n+\n+CWPKI2068W=CWPKI2068W: The ACME service automatic certificate checking failed to check if the certificate with the {0} serial number is expiring or revoked. The check is scheduled to try again in {1}. The error is ''{2}''.\n+CWPKI2068W.explanation=The ACME service started checking if the certificate is expiring or revoked, but failed.\n+CWPKI2068W.useraction=Review the error message for details on the failure. Review the certificate status using the ACME REST interface. If the certificate needs to be renewed, use the ACME REST interface to request a new certificate.\n+\n+CWPKI2069I=CWPKI2069I: The ACME service automatic certificate checking is disabled. Expiring or revoked certificates are not automatically renewed.\n+CWPKI2069I.explanation=The ACME service does not check for expiring or revoked certificates on an automated schedule. If the certificate expires or is revoked, TLS/SSL requests cannot complete unless the server is restarted or the REST interface is used to renew the certificate.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2MzczNQ==", "bodyText": "add comma for dependent clause\nThe certCheckerSchedule property was set to {0}, which is shorter than the minimum schedule time.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430563735", "createdAt": "2020-05-26T16:53:27Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -274,23 +275,50 @@ CWPKI2059I=CWPKI2059I: Certificate revocation status checking found that the cer\n CWPKI2059I.explanation=The ACME service found that the certificate was marked revoked by either a CRL or OSCP responder. \n CWPKI2059I.useraction=No action is required.\n \n-CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number wasn''t retrieved. The error is: ''{1}''.\n+CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number was not retrieved. The error is: ''{1}''.\n CWPKI2060E.explanation=The OCSP URL was not retrieved.\n CWPKI2060E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n-CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number weren''t retrieved. The error is ''{1}''.\n+CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number were not retrieved. The error is ''{1}''.\n CWPKI2061E.explanation=The CRL distribution points were not retrieved.\n CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n \n-\n CWPKI2063E=CWPKI2063E: The ACME certificate authority at the {0} URI updated its terms of service and now requires the user to agree to the new terms of service at the following URI before it processes any further requests: {1}\n CWPKI2063E.explanation=The certificate authority updated its terms of service and requires user interaction.\n CWPKI2063E.useraction=Review the provided terms of service.\n \n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n-CWPKI2064I.useraction=No action is required.\n\\ No newline at end of file\n+CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME service failed to automatically renew the certificate with the {0} serial number. The request is scheduled to try again in {1}. The certificate expires on {2}. The renew request error is ''{3}''.\n+CWPKI2065W.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The request is scheduled to try again in {1}. The renew request error is ''{2}''.\n+CWPKI2066E.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service requests a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=When the ACME service detects that the certificate is revoked, it automatically requests a new certificate.\n+CWPKI2067I.useraction=No action is required.\n+\n+CWPKI2068W=CWPKI2068W: The ACME service automatic certificate checking failed to check if the certificate with the {0} serial number is expiring or revoked. The check is scheduled to try again in {1}. The error is ''{2}''.\n+CWPKI2068W.explanation=The ACME service started checking if the certificate is expiring or revoked, but failed.\n+CWPKI2068W.useraction=Review the error message for details on the failure. Review the certificate status using the ACME REST interface. If the certificate needs to be renewed, use the ACME REST interface to request a new certificate.\n+\n+CWPKI2069I=CWPKI2069I: The ACME service automatic certificate checking is disabled. Expiring or revoked certificates are not automatically renewed.\n+CWPKI2069I.explanation=The ACME service does not check for expiring or revoked certificates on an automated schedule. If the certificate expires or is revoked, TLS/SSL requests cannot complete unless the server is restarted or the REST interface is used to renew the certificate.\n+CWPKI2069I.useraction=No action is required. To enable automatic certificate checking, update the certCheckerSchedule property in the server configuration to a value greater than 0.\n+\n+CWPKI2070W=CWPKI2070W: The certCheckerSchedule property was set to {0} which is shorter than the minimum schedule time. The certCheckerSchedule property is reset to {1}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2NDI1Ng==", "bodyText": "add comma for dependent clause\nThe certCheckerErrorSchedule property was set to {0}, which is shorter than the minimum schedule time.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430564256", "createdAt": "2020-05-26T16:54:20Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/com/ibm/ws/security/acme/resources/AcmeMessages.nlsprops", "diffHunk": "@@ -274,23 +275,50 @@ CWPKI2059I=CWPKI2059I: Certificate revocation status checking found that the cer\n CWPKI2059I.explanation=The ACME service found that the certificate was marked revoked by either a CRL or OSCP responder. \n CWPKI2059I.useraction=No action is required.\n \n-CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number wasn''t retrieved. The error is: ''{1}''.\n+CWPKI2060E=CWPKI2060E: The OCSP URL from the certificate with the {0} serial number was not retrieved. The error is: ''{1}''.\n CWPKI2060E.explanation=The OCSP URL was not retrieved.\n CWPKI2060E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n-CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number weren''t retrieved. The error is ''{1}''.\n+CWPKI2061E=CWPKI2061E: The CRL distribution points from the certificate with the {0} serial number were not retrieved. The error is ''{1}''.\n CWPKI2061E.explanation=The CRL distribution points were not retrieved.\n CWPKI2061E.useraction=Ensure that the certificate is a valid X.509 certificate. If it is not valid, request a new certificate.\n \n CWPKI2062E=CWPKI2062E: The {0} OCSP responder URL defined in the server configuration is not a valid URI. If defined, it must be a valid URI to override the OSCP responder URL contained in the certificate.\n CWPKI2062E.explanation=Certificate revocation checking requires a valid OCSP responder URL.\n CWPKI2062E.useraction=Provide a valid OCSP responder URL in the server configuration.\n \n-\n CWPKI2063E=CWPKI2063E: The ACME certificate authority at the {0} URI updated its terms of service and now requires the user to agree to the new terms of service at the following URI before it processes any further requests: {1}\n CWPKI2063E.explanation=The certificate authority updated its terms of service and requires user interaction.\n CWPKI2063E.useraction=Review the provided terms of service.\n \n CWPKI2064I=CWPKI2064I: The ACME service retrieved the certificate with the {0} serial number from the {1} URI in {2} seconds.\n CWPKI2064I.explanation=The ACME service successfully requested a certificate.\n-CWPKI2064I.useraction=No action is required.\n\\ No newline at end of file\n+CWPKI2064I.useraction=No action is required.\n+\n+CWPKI2065W=CWPKI2065W: The ACME service failed to automatically renew the certificate with the {0} serial number. The request is scheduled to try again in {1}. The certificate expires on {2}. The renew request error is ''{3}''.\n+CWPKI2065W.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued.\n+CWPKI2065W.useraction=Review the error message for details on the failure.\n+\n+CWPKI2066E=CWPKI2066E: The ACME service failed to automatically renew the certificate with the {0} serial number. The certificate is revoked. The request is scheduled to try again in {1}. The renew request error is ''{2}''.\n+CWPKI2066E.explanation=The ACME service tried to renew a certificate but encountered an error. The ACME service continues to request a new certificate until a new certificate is issued. SSL/TLS requests fail until a new certificate request is successful.\n+CWPKI2066E.useraction=Review the error message for details on the failure. \n+\n+CWPKI2067I=CWPKI2067I: The certificate with the {0} serial number is revoked. The ACME service requests a new certificate from the ACME certificate authority at the {1} URI.\n+CWPKI2067I.explanation=When the ACME service detects that the certificate is revoked, it automatically requests a new certificate.\n+CWPKI2067I.useraction=No action is required.\n+\n+CWPKI2068W=CWPKI2068W: The ACME service automatic certificate checking failed to check if the certificate with the {0} serial number is expiring or revoked. The check is scheduled to try again in {1}. The error is ''{2}''.\n+CWPKI2068W.explanation=The ACME service started checking if the certificate is expiring or revoked, but failed.\n+CWPKI2068W.useraction=Review the error message for details on the failure. Review the certificate status using the ACME REST interface. If the certificate needs to be renewed, use the ACME REST interface to request a new certificate.\n+\n+CWPKI2069I=CWPKI2069I: The ACME service automatic certificate checking is disabled. Expiring or revoked certificates are not automatically renewed.\n+CWPKI2069I.explanation=The ACME service does not check for expiring or revoked certificates on an automated schedule. If the certificate expires or is revoked, TLS/SSL requests cannot complete unless the server is restarted or the REST interface is used to renew the certificate.\n+CWPKI2069I.useraction=No action is required. To enable automatic certificate checking, update the certCheckerSchedule property in the server configuration to a value greater than 0.\n+\n+CWPKI2070W=CWPKI2070W: The certCheckerSchedule property was set to {0} which is shorter than the minimum schedule time. The certCheckerSchedule property is reset to {1}.\n+CWPKI2070W.explanation=The value for the certCheckerSchedule property was below the minimum duration to check for expiring or revoked certificates and is reset to the minimum schedule time.\n+CWPKI2070W.useraction=To avoid this warning message, set the certCheckerSchedule property in the server configuration to a duration that is longer than the minimum schedule time. To use the default setting, remove the certCheckerSchedule property from the server configuration.\n+\n+CWPKI2071W=CWPKI2071W: The certCheckerErrorSchedule property was set to {0} which is shorter than the minimum schedule time. The certCheckerErrorSchedule property is reset to {1}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTQ2MTE4", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-418546118", "createdAt": "2020-05-26T18:00:12Z", "commit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7380198621b5ef646f62d5cc58d92900f8460d3", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f7380198621b5ef646f62d5cc58d92900f8460d3", "committedDate": "2020-05-25T03:36:29Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "1816b83c60d4d7cfde50e5d89bb9b4744e5587e5", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1816b83c60d4d7cfde50e5d89bb9b4744e5587e5", "committedDate": "2020-05-26T19:49:49Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjMzMTIz", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-418633123", "createdAt": "2020-05-26T19:55:54Z", "commit": {"oid": "1816b83c60d4d7cfde50e5d89bb9b4744e5587e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTo1NTo1NFrOGauHxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTo1Njo1N1rOGauKTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MTgxNQ==", "bodyText": "For example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute.\nThis is better, but can we say why someone would want to do that? like:\nFor example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute, to increase the frequency of checks after a failed request.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430671815", "createdAt": "2020-05-26T19:55:54Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked. If the certificate is expiring or revoked, the ACME CA service issues a certificate renew request. If the first renew request fails, the certificate renew request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received. Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renew requests.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Performs the same function as the certCheckerSchedule attribute, but on an alternate schedule. For example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1816b83c60d4d7cfde50e5d89bb9b4744e5587e5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MjQ2Mg==", "bodyText": "change\nEnables immediate certificate renewal requests\nto\nEnables immediate certificate renew requests", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#discussion_r430672462", "createdAt": "2020-05-26T19:56:57Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.security.acme/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -80,3 +80,12 @@ preferCRLs.desc=By default, OCSP is the preferred mechanism for checking revocat\n \n disableFallback=No fallback\n disableFallback.desc=Disable the certificate revocation status checker fallback mechanism. During certificate revocation status check, the default behavior is fallback and check by using the non-preferred mechanism (OCSP or CRLs). Default is false.\n+\n+certCheckerSchedule=Certificate checker schedule\n+certCheckerSchedule.desc=Interval for the ACME CA service to check if the certificate is expiring or revoked. If the certificate is expiring or revoked, the ACME CA service issues a certificate renew request. If the first renew request fails, the certificate renew request continues according to the timing set by the certCheckerErrorSchedule attribute until a new certificate is received. Setting the certCheckerSchedule property to zero or a negative value disables automatic certificate renew requests.\n+\n+certCheckerErrorSchedule=Certificate checker error schedule\n+certCheckerErrorSchedule.desc=Performs the same function as the certCheckerSchedule attribute, but on an alternate schedule. For example, the certCheckerErrorSchedule attribute can be set to a shorter interval than the certCheckerSchedule attribute. The interval from the certCheckerSchedule attribute is resumed after the certificate is renewed. \n+\n+disableMinRenewWindow=Disable minimum renew window\n+disableMinRenewWindow.desc=Enables immediate certificate renewal requests by disabling the specified minimum amount of time between renew requests. The minimum renew time is to 15 seconds.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1816b83c60d4d7cfde50e5d89bb9b4744e5587e5"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e585430e762a321124fcb103f7d181614d5f4df", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3e585430e762a321124fcb103f7d181614d5f4df", "committedDate": "2020-05-26T20:05:46Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1816b83c60d4d7cfde50e5d89bb9b4744e5587e5", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1816b83c60d4d7cfde50e5d89bb9b4744e5587e5", "committedDate": "2020-05-26T19:49:49Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}, "afterCommit": {"oid": "3e585430e762a321124fcb103f7d181614d5f4df", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/3e585430e762a321124fcb103f7d181614d5f4df", "committedDate": "2020-05-26T20:05:46Z", "message": "Issue 10519: Add automatic certificate checker for ACME"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjQ0NDkw", "url": "https://github.com/OpenLiberty/open-liberty/pull/11956#pullrequestreview-418644490", "createdAt": "2020-05-26T20:13:09Z", "commit": {"oid": "3e585430e762a321124fcb103f7d181614d5f4df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2714, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}