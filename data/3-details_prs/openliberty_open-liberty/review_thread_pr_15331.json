{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNDk2ODAy", "number": 15331, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjowOTo0NFrOFH2Olg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjoxOTowMFrOFH2bgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNzcyODIyOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.websphere.javaee.cdi.1.2/bnd.bnd", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjowOTo0NFrOIJdl3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjowOTo0NFrOIJdl3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc5MjkyNQ==", "bodyText": "I would strongly suggest not changing this for CDI 1.2 and 2.0 API bundles where it's not needed", "url": "https://github.com/OpenLiberty/open-liberty/pull/15331#discussion_r546792925", "createdAt": "2020-12-21T16:09:44Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.websphere.javaee.cdi.1.2/bnd.bnd", "diffHunk": "@@ -34,18 +34,19 @@ Import-Package:  javax.el; version=\"[3.0.0,4.0.0)\", \\\n  javax.enterprise.inject.spi;version=\"1.1\", \\\n  javax.enterprise.util;version=\"1.1\", \\\n  javax.inject;version=1, \\\n- javax.interceptor;version=\"1.2\"\n+ javax.interceptor;version=\"1.2\", \\\n+ com.ibm.ws.cdi.liberty\n \n Include-Resource: \\\n+  META-INF=resources/META-INF, \\\n   @${repo;javax.enterprise:cdi-api;1.2}!/beans_1_0.xsd, \\\n   @${repo;javax.enterprise:cdi-api;1.2}!/beans_1_1.xsd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11e633964c294981fafece70a2e4c5effa55e183"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNzczNzcwOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.weld/src/com/ibm/ws/cdi/liberty/CDIProviderService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjoxMjozOFrOIJdr0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjoxMjozOFrOIJdr0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc5NDQ1MQ==", "bodyText": "This class does not need to be a Component as it's managed by ServiceLoader rather than as an OSGi service.\nThe Javadoc should also be improved to say it's a thin layer which looks up the real CDIProvider as an OSGi service.", "url": "https://github.com/OpenLiberty/open-liberty/pull/15331#discussion_r546794451", "createdAt": "2020-12-21T16:12:38Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.weld/src/com/ibm/ws/cdi/liberty/CDIProviderService.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.cdi.liberty;\n+\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n+\n+import javax.enterprise.inject.spi.CDIProvider;\n+import javax.enterprise.inject.spi.CDI;\n+\n+import org.osgi.service.component.annotations.Component;\n+\n+import com.ibm.ejs.util.Util;\n+import com.ibm.websphere.ras.Tr;\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.ws.cdi.CDIService;\n+\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.FrameworkUtil;\n+import org.osgi.framework.ServiceReference;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import io.openliberty.cdi.spi.CDIExtensionMetadata;\n+\n+/**\n+ * This class is to get hold all necessary services.\n+ */\n+@Component(name = \"com.ibm.ws.cdi.liberty.CDIRuntimeImpl\", service = {CDIProvider.class}, property = { \"service.vendor=IBM\" })\n+public class CDIProviderService implements CDIProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11e633964c294981fafece70a2e4c5effa55e183"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNzc2MTI5OnYy", "diffSide": "RIGHT", "path": "dev/io.openliberty.jakarta.cdi.3.0/bnd.bnd", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjoxOTowMFrOIJd5xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjoxOTowMFrOIJd5xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc5ODAyMw==", "bodyText": "This import is problematic.\nThere are cases where another feature might want to include the CDI API bundle, (or the CDI API feature) so that it can work with or without CDI present. I think this import will prevent the API bundle from resolving if the rest of CDI is not present.\nI think the easiest way to do this would be to:\n\nAdd CDIProvider to the list of services provided by the CDIRuntimeImpl component\nRemove all references to CDIRuntimeImpl and CDIService from CDIProviderService, just look up CDIProvider as a service instead\nMove CDIProviderService into the API bundle.\n\nIf we didn't want to add non-API things to the API bundle, you could\n\nPut the services file and CDIProviderService into a fragment which attaches to the API bundle\nThis would still require making the CDIRuntimeImpl component a CDIProvider service", "url": "https://github.com/OpenLiberty/open-liberty/pull/15331#discussion_r546798023", "createdAt": "2020-12-21T16:19:00Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.jakarta.cdi.3.0/bnd.bnd", "diffHunk": "@@ -40,9 +40,11 @@ Import-Package:  jakarta.el; version=\"[4.0.0,5.0.0)\", \\\n  jakarta.enterprise.inject.spi.configurator; version=3.0, \\\n  jakarta.enterprise.util; version=3.0, \\\n  jakarta.inject; version=2.0, \\\n- jakarta.interceptor;version=2.0\n+ jakarta.interceptor;version=2.0, \\\n+ com.ibm.ws.cdi.liberty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11e633964c294981fafece70a2e4c5effa55e183"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2342, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}