{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NTM4MDE1", "number": 10518, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMzoyMzoxN1rODaArIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOToxNDoyNVrODaSD0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjAwNjExOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.websphere.org.eclipse.microprofile.metrics.2.3/bnd.bnd", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMzoyMzoxN1rOFgufMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMzoyMzoxN1rOFgufMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2MDQwMw==", "bodyText": "This needs to be version 2.3 when it is uncommented.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10518#discussion_r369860403", "createdAt": "2020-01-22T23:23:17Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.websphere.org.eclipse.microprofile.metrics.2.3/bnd.bnd", "diffHunk": "@@ -0,0 +1,42 @@\n+#*******************************************************************************\n+# Copyright (c) 2019 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+#*******************************************************************************\n+-include ~../cnf/resources/bnd/bundle.props\n+bVersion=1.0\n+\n+javac.source: 1.8\n+javac.target: 1.8\n+\n+Bundle-SymbolicName: com.ibm.websphere.org.eclipse.microprofile.metrics.2.3; singleton:=true\n+\n+Import-Package: \\\n+  javax.enterprise.util; version=\"[1.1,3)\",\\\n+  *\n+\n+Export-Package: \\\n+  org.eclipse.microprofile.metrics;version=2.3, \\\n+  org.eclipse.microprofile.metrics.annotation;version=2.3\n+\n+#Include-Resource: \\\n+#  @${repo;org.eclipse.microprofile.metrics:microprofile-metrics-api;2.2;EXACT}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52bb05fed650e164ddd8688e5a5f54d198afcbd9"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4ODg1NDU2OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.microprofile.metrics.2.3/src/com/ibm/ws/microprofile/metrics23/impl/SimpleTimerImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOToxNDoyNVrOFhJmrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTozMTozOVrOFhNTwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwNDY4Nw==", "bodyText": "Do we need synchronization when using SimpleTimer in multiple threads?", "url": "https://github.com/OpenLiberty/open-liberty/pull/10518#discussion_r370304687", "createdAt": "2020-01-23T19:14:25Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.ws.microprofile.metrics.2.3/src/com/ibm/ws/microprofile/metrics23/impl/SimpleTimerImpl.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.microprofile.metrics23.impl;\n+\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+\n+import com.ibm.ws.microprofile.metrics.impl.Clock;\n+import com.ibm.ws.microprofile.metrics.impl.CounterImpl;\n+\n+/**\n+ * A timer metric which aggregates timing durations and provides duration statistics, plus\n+ * throughput statistics via {@link Meter}.\n+ */\n+public class SimpleTimerImpl implements SimpleTimer {\n+    /**\n+     * A timing context.\n+     *\n+     * @see SimpleTimerImpl#time()\n+     */\n+    public static class Context implements SimpleTimer.Context {\n+        private final SimpleTimerImpl simpleTimer;\n+        private final Clock clock;\n+        private final long startTime;\n+\n+        private Context(SimpleTimerImpl simpleTimer, Clock clock) {\n+            this.simpleTimer = simpleTimer;\n+            this.clock = clock;\n+            this.startTime = clock.getTick();\n+        }\n+\n+        /**\n+         * Updates the timer with the difference between current and start time. Call to this method will\n+         * not reset the start time. Multiple calls result in multiple updates.\n+         *\n+         * @return the elapsed time in nanoseconds\n+         */\n+        @Override\n+        public long stop() {\n+            final long elapsed = clock.getTick() - startTime;\n+            simpleTimer.update(elapsed, TimeUnit.NANOSECONDS);\n+            return elapsed;\n+        }\n+\n+        /** Equivalent to calling {@link #stop()}. */\n+        @Override\n+        public void close() {\n+            stop();\n+        }\n+    }\n+\n+    private final Counter count;\n+    private long elapsedTime;\n+    private final Clock clock;\n+\n+    public SimpleTimerImpl() {\n+        this(Clock.defaultClock());\n+    }\n+\n+    public SimpleTimerImpl(Clock clock) {\n+        this.clock = clock;\n+        this.count = new CounterImpl();\n+        this.elapsedTime = 0;\n+    }\n+\n+    /**\n+     * Adds a recorded duration.\n+     *\n+     * @param duration the length of the duration\n+     * @param unit     the scale unit of {@code duration}\n+     */\n+    @Override\n+    public void update(long duration, TimeUnit unit) {\n+        update(unit.toNanos(duration));\n+    }\n+\n+    @Override\n+    public <T> T time(Callable<T> event) throws Exception {\n+        final long startTime = clock.getTick();\n+        try {\n+            return event.call();\n+        } finally {\n+            update(clock.getTick() - startTime);\n+        }\n+    }\n+\n+    @Override\n+    public void time(Runnable event) {\n+        final long startTime = clock.getTick();\n+        try {\n+            event.run();\n+        } finally {\n+            update(clock.getTick() - startTime);\n+        }\n+    }\n+\n+    @Override\n+    public Context time() {\n+        return new Context(this, clock);\n+    }\n+\n+    private void update(long duration) {\n+        elapsedTime += duration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52bb05fed650e164ddd8688e5a5f54d198afcbd9"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NTM3Ng==", "bodyText": "removed the private method and am just directly using the metric API\nsynchronized added", "url": "https://github.com/OpenLiberty/open-liberty/pull/10518#discussion_r370365376", "createdAt": "2020-01-23T21:31:39Z", "author": {"login": "Channyboy"}, "path": "dev/com.ibm.ws.microprofile.metrics.2.3/src/com/ibm/ws/microprofile/metrics23/impl/SimpleTimerImpl.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.microprofile.metrics23.impl;\n+\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+\n+import com.ibm.ws.microprofile.metrics.impl.Clock;\n+import com.ibm.ws.microprofile.metrics.impl.CounterImpl;\n+\n+/**\n+ * A timer metric which aggregates timing durations and provides duration statistics, plus\n+ * throughput statistics via {@link Meter}.\n+ */\n+public class SimpleTimerImpl implements SimpleTimer {\n+    /**\n+     * A timing context.\n+     *\n+     * @see SimpleTimerImpl#time()\n+     */\n+    public static class Context implements SimpleTimer.Context {\n+        private final SimpleTimerImpl simpleTimer;\n+        private final Clock clock;\n+        private final long startTime;\n+\n+        private Context(SimpleTimerImpl simpleTimer, Clock clock) {\n+            this.simpleTimer = simpleTimer;\n+            this.clock = clock;\n+            this.startTime = clock.getTick();\n+        }\n+\n+        /**\n+         * Updates the timer with the difference between current and start time. Call to this method will\n+         * not reset the start time. Multiple calls result in multiple updates.\n+         *\n+         * @return the elapsed time in nanoseconds\n+         */\n+        @Override\n+        public long stop() {\n+            final long elapsed = clock.getTick() - startTime;\n+            simpleTimer.update(elapsed, TimeUnit.NANOSECONDS);\n+            return elapsed;\n+        }\n+\n+        /** Equivalent to calling {@link #stop()}. */\n+        @Override\n+        public void close() {\n+            stop();\n+        }\n+    }\n+\n+    private final Counter count;\n+    private long elapsedTime;\n+    private final Clock clock;\n+\n+    public SimpleTimerImpl() {\n+        this(Clock.defaultClock());\n+    }\n+\n+    public SimpleTimerImpl(Clock clock) {\n+        this.clock = clock;\n+        this.count = new CounterImpl();\n+        this.elapsedTime = 0;\n+    }\n+\n+    /**\n+     * Adds a recorded duration.\n+     *\n+     * @param duration the length of the duration\n+     * @param unit     the scale unit of {@code duration}\n+     */\n+    @Override\n+    public void update(long duration, TimeUnit unit) {\n+        update(unit.toNanos(duration));\n+    }\n+\n+    @Override\n+    public <T> T time(Callable<T> event) throws Exception {\n+        final long startTime = clock.getTick();\n+        try {\n+            return event.call();\n+        } finally {\n+            update(clock.getTick() - startTime);\n+        }\n+    }\n+\n+    @Override\n+    public void time(Runnable event) {\n+        final long startTime = clock.getTick();\n+        try {\n+            event.run();\n+        } finally {\n+            update(clock.getTick() - startTime);\n+        }\n+    }\n+\n+    @Override\n+    public Context time() {\n+        return new Context(this, clock);\n+    }\n+\n+    private void update(long duration) {\n+        elapsedTime += duration;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwNDY4Nw=="}, "originalCommit": {"oid": "52bb05fed650e164ddd8688e5a5f54d198afcbd9"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2252, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}