{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MDg4MDU1", "number": 15296, "title": "Use private mirror of Docker Hub", "bodyText": "The basic items are:\n\nupgrading to testcontainers 1.15.0\nmaking it easy for FATs to use a maven central mirror (that way we don't need to manually upload test deps to Artifactory)\nMake all testcontainers buckets use a Docker hub mirror (to fix rate limiting issues)\nSplit the testcontainers gradle deps into an addTestcontainers task so it becomes easier to update TC versions in the future\n\nPrioritize: JDBC, JAXRS_1, JAXRS_2", "createdAt": "2020-12-14T02:43:14Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/15296", "merged": true, "mergeCommit": {"oid": "61597750fd99c4b707214051e9fdd2f9cacb010c"}, "closed": true, "closedAt": "2020-12-21T07:02:54Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl8pcIABqjQxMDY4ODgwMjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnl-NTgBqjQxMzIxNjYyNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99959c37474d944e6462476adfc6b1b3c01a78f3", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/99959c37474d944e6462476adfc6b1b3c01a78f3", "committedDate": "2020-12-14T02:36:58Z", "message": "Get auth token for custom docker config"}, "afterCommit": {"oid": "8f9ad24b8bd45788332d1fd2c6101b8a3f86c7b0", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8f9ad24b8bd45788332d1fd2c6101b8a3f86c7b0", "committedDate": "2020-12-14T02:51:51Z", "message": "Get auth token for custom docker config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f9ad24b8bd45788332d1fd2c6101b8a3f86c7b0", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8f9ad24b8bd45788332d1fd2c6101b8a3f86c7b0", "committedDate": "2020-12-14T02:51:51Z", "message": "Get auth token for custom docker config"}, "afterCommit": {"oid": "95fd675165decd571fd98ef9e5a4c483d0b28aec", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/95fd675165decd571fd98ef9e5a4c483d0b28aec", "committedDate": "2020-12-14T17:06:56Z", "message": "Get auth token for custom docker config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95fd675165decd571fd98ef9e5a4c483d0b28aec", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/95fd675165decd571fd98ef9e5a4c483d0b28aec", "committedDate": "2020-12-14T17:06:56Z", "message": "Get auth token for custom docker config"}, "afterCommit": {"oid": "9c80f496aaa0d0ad97331ec299436eec4771c594", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/9c80f496aaa0d0ad97331ec299436eec4771c594", "committedDate": "2020-12-15T05:49:25Z", "message": "Get auth token for custom docker config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef2b4e6f504a1b06755da7067e82840b34e2b2e2", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ef2b4e6f504a1b06755da7067e82840b34e2b2e2", "committedDate": "2020-12-16T21:33:15Z", "message": "Pull private registry token from Consul"}, "afterCommit": {"oid": "c6b95d7961b9fb998549153a8ba23d91e05c17ba", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/c6b95d7961b9fb998549153a8ba23d91e05c17ba", "committedDate": "2020-12-16T21:33:34Z", "message": "Pull private registry token from Consul"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTc0NTA5", "url": "https://github.com/OpenLiberty/open-liberty/pull/15296#pullrequestreview-554174509", "createdAt": "2020-12-16T23:43:56Z", "commit": {"oid": "c6b95d7961b9fb998549153a8ba23d91e05c17ba"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzo0Mzo1NlrOIHeFLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzo1ODoyM1rOIHebOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwMzc4OA==", "bodyText": "Looks like this one could be updated to use\napply from: '../wlp-gradle/subprojects/maven-central-mirror.gradle'", "url": "https://github.com/OpenLiberty/open-liberty/pull/15296#discussion_r544703788", "createdAt": "2020-12-16T23:43:56Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jaxrs.2.1.client_fat/build.gradle", "diffHunk": "@@ -9,17 +9,17 @@\n  *     IBM Corporation - initial API and implementation\n  *******************************************************************************/\n repositories {\n-  if (isUsingArtifactory) {\n-    maven {\n-      credentials {\n-        username userProps.getProperty(\"artifactory.download.user\")\n-        password userProps.getProperty(\"artifactory.download.token\")\n-      }\n-      url (\"https://\" + gradle.userProps.getProperty(\"artifactory.download.server\") + \"/artifactory/wasliberty-maven-remote\")\n-    }\n-  } else {\n-    mavenCentral()\n-  }\n+  if (isUsingArtifactory) { ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b95d7961b9fb998549153a8ba23d91e05c17ba"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwOTQzMw==", "bodyText": "I do not really understand what this class is doing.  Or more accurately how our infrastructure is set up to support this.\nDo we have a system set up that caches docker images from docker hub and hosts them within our test environment?\nWill developers running tests locally still be able to run against our remote docker machines?", "url": "https://github.com/OpenLiberty/open-liberty/pull/15296#discussion_r544709433", "createdAt": "2020-12-16T23:58:23Z", "author": {"login": "KyleAure"}, "path": "dev/fattest.simplicity/src/componenttest/containers/ArtifactoryImageNameSubstitutor.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.containers;\n+\n+import org.testcontainers.utility.DockerImageName;\n+import org.testcontainers.utility.ImageNameSubstitutor;\n+\n+import com.ibm.websphere.simplicity.log.Log;\n+\n+import componenttest.topology.utils.ExternalTestService;\n+\n+/**\n+ * An image name substituter is configured in testcontainers.properties and will transform docker image names.\n+ * Here we use it to apply a private registry prefix so that in remote builds we use an internal mirror\n+ * of Docker Hub, instead of downloading from Docker Hub in each build which causes rate limiting issues.\n+ */\n+public class ArtifactoryImageNameSubstitutor extends ImageNameSubstitutor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b95d7961b9fb998549153a8ba23d91e05c17ba"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22bf1559e62e153d6f037340e4d5703f16b1505f", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/22bf1559e62e153d6f037340e4d5703f16b1505f", "committedDate": "2020-12-17T22:12:39Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}, "afterCommit": {"oid": "7e0a096d72a8bc7a402b9da06f8bb2b3c5dc5a7c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7e0a096d72a8bc7a402b9da06f8bb2b3c5dc5a7c", "committedDate": "2020-12-17T22:20:17Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e0a096d72a8bc7a402b9da06f8bb2b3c5dc5a7c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7e0a096d72a8bc7a402b9da06f8bb2b3c5dc5a7c", "committedDate": "2020-12-17T22:20:17Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}, "afterCommit": {"oid": "c33a778f776a86137fa817e5c70ccf93f3cd261d", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/c33a778f776a86137fa817e5c70ccf93f3cd261d", "committedDate": "2020-12-19T05:21:27Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "400a584b17cb2bc128936f337f74179f023844e4", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/400a584b17cb2bc128936f337f74179f023844e4", "committedDate": "2020-12-19T05:25:08Z", "message": "Upgrade to Testcontainers 1.15.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58fb7acc261515dcfa65499c3c0485285dc0a9b9", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/58fb7acc261515dcfa65499c3c0485285dc0a9b9", "committedDate": "2020-12-19T05:25:09Z", "message": "Update FAT projects to use maven central mirror"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba581668965fcc06e6cd19f15c868f7b91a808b2", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ba581668965fcc06e6cd19f15c868f7b91a808b2", "committedDate": "2020-12-19T05:25:09Z", "message": "Use private DockerHub mirror via ImageNameSubstitutor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4d2dd86fcf39ff14ab7eab4f1dd1aaf41a1a10c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/c4d2dd86fcf39ff14ab7eab4f1dd1aaf41a1a10c", "committedDate": "2020-12-19T05:25:09Z", "message": "Always use local docker for GH Actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "695b6da97f4f7068d44f5bc5ff1304728af2df97", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/695b6da97f4f7068d44f5bc5ff1304728af2df97", "committedDate": "2020-12-19T05:25:09Z", "message": "Update cloudant_fat to use static image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a79dbc955db742e84e081f6ecad142dabcd7bb5", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6a79dbc955db742e84e081f6ecad142dabcd7bb5", "committedDate": "2020-12-19T05:25:10Z", "message": "Use static image for couchdb_fat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "411aa85082ec2fff154fdd6a610a30e0a39f6f2b", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/411aa85082ec2fff154fdd6a610a30e0a39f6f2b", "committedDate": "2020-12-19T05:25:10Z", "message": "Get auth token for custom docker config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02c9a660516561b66c257965c5328e2855aef224", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/02c9a660516561b66c257965c5328e2855aef224", "committedDate": "2020-12-19T05:25:10Z", "message": "Pull private registry token from Consul"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaa84ec9da6215ab057b6813239cca6f9d73d24f", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aaa84ec9da6215ab057b6813239cca6f9d73d24f", "committedDate": "2020-12-19T05:25:10Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c33a778f776a86137fa817e5c70ccf93f3cd261d", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/c33a778f776a86137fa817e5c70ccf93f3cd261d", "committedDate": "2020-12-19T05:21:27Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}, "afterCommit": {"oid": "aaa84ec9da6215ab057b6813239cca6f9d73d24f", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aaa84ec9da6215ab057b6813239cca6f9d73d24f", "committedDate": "2020-12-19T05:25:10Z", "message": "Fixes to various FATs after upgrading to Testcontainers 1.15.0"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2621, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}