{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3ODgzMzAw", "number": 12494, "title": "Add DisableJwtCookie tests to JwtSSO fat", "bodyText": "Test Cases:\ntest_disableJwtCookie_true_includeLtpaCookie_true()\ntest_disableJwtCookie_true_includeLtpaCookie_true_differentJwtCookieName()\ntest_disableJwtCookie_true_includeLtpaCookie_true_useLtpaIfJwtAbsent_false()\ntest_disableJwtCookie_true_includeLtpaCookie_false()\ntest_disableJwtCookie_false_includeLtpaCookie_true()\ntest_disableJwtCookie_false_includeLtpaCookie_false()\ntest_disableJwtCookie_false_includeBadLtpaCookie()\n\nConfig Scenarios:\n<jwtSso disableJwtCookie=\"true\"  includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"true\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"true\"  includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"true\" cookieName=\"AdamsJwtCookie\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"true\"  includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"false\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"true\"  includeLtpaCookie=\"false\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"false\" includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"true\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"false\" includeLtpaCookie=\"false\" setCookieSecureFlag=\"false\"/>\n<jwtSso disableJwtCookie=\"false\" includeLtpaCookie=\"false\" setCookieSecureFlag=\"false\"/>", "createdAt": "2020-06-04T14:37:09Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12494", "merged": true, "mergeCommit": {"oid": "f036a452939a2c601b436107a67b36d42742b9e6"}, "closed": true, "closedAt": "2020-06-06T14:17:35Z", "author": {"login": "Zech-Hein"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoBSQfAFqTQyNDU5NjM4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoWPOwAH2gAyNDI3ODgzMzAwOmRjZGMzNmUzY2VhOGE4MDliY2VkZTQ5OTNlYjI0YzdmNDhmY2ZiYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTk2Mzg4", "url": "https://github.com/OpenLiberty/open-liberty/pull/12494#pullrequestreview-424596388", "createdAt": "2020-06-04T15:55:16Z", "commit": {"oid": "def38d8c426ecd61906796b55f937a083351f898"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo1NToxN1rOGfMyhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo1NToxN1rOGfMyhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2ODU4MQ==", "bodyText": "It might strengthen the checks here to also add\nexpectations.addExpectations(CommonExpectations.cookieDoesNotExist(currentAction, webClient, JwtFatConstants.JWT_COOKIE_NAME));\nto ensure the default JWT cookie also doesn't show up.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12494#discussion_r435368581", "createdAt": "2020-06-04T15:55:17Z", "author": {"login": "ayoho"}, "path": "dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java", "diffHunk": "@@ -107,6 +107,198 @@ public void test_cookieName_includeLtpa() throws Exception {\n         validationUtils.validateResult(response, currentAction, expectations);\n     }\n \n+    \n+    /**\n+     * Tests Config: \n+     *  - <jwtSso disableJwtCookie=\"true\" includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"true\" setCookieSecureFlag=\"false\"/>\n+     * Expects:\n+     *  - JWT cookie is not found in the response, but the ltpa cookie is found.\n+     */\n+    @Test\n+    public void test_disableJwtCookie_true_includeLtpaCookie_true() throws Exception {\n+        server.reconfigureServerUsingExpandedConfiguration(_testName, \"server_disableJwtCookie_true_includeLtpa_true.xml\");\n+\n+        String currentAction = TestActions.ACTION_INVOKE_PROTECTED_RESOURCE;\n+        Page response = actions.invokeUrl(_testName, webClient, protectedUrl);\n+        Expectations expectations = new Expectations();\n+        \n+        currentAction = disableJwtCookie_test_base(currentAction, response, expectations);\n+        \n+        expectations.addExpectations(CommonExpectations.cookieDoesNotExist(currentAction, webClient, JwtFatConstants.JWT_COOKIE_NAME));\n+        expectations.addExpectations(CommonExpectations.ltpaCookieExists(currentAction, webClient));\n+\n+        response = actions.doFormLogin(response, defaultUser, defaultPassword);\n+        validationUtils.validateResult(response, currentAction, expectations);\n+    }\n+    \n+    /**\n+     * This helper method sets the action and expectations common across disableJwtCookie tests\n+     */\n+    private String disableJwtCookie_test_base(String currentAction, Page response, Expectations expectations) throws Exception {\n+        expectations.addExpectations(CommonExpectations.successfullyReachedLoginPage(currentAction));\n+        \n+        validationUtils.validateResult(response, currentAction, expectations);\n+\n+        currentAction = TestActions.ACTION_SUBMIT_LOGIN_CREDENTIALS;\n+        \n+        expectations.addExpectations(CommonExpectations.successfullyReachedUrl(currentAction, protectedUrl));\n+        expectations.addExpectations(CommonExpectations.getJwtPrincipalExpectations(currentAction, defaultUser, JwtFatConstants.DEFAULT_ISS_REGEX));\n+        \n+        return currentAction;\n+    }\n+    \n+    /**\n+     * Tests Config:\n+     *  - <jwtSso disableJwtCookie=\"true\" includeLtpaCookie=\"true\" useLtpaIfJwtAbsent=\"true\" cookieName=\"AdamsJwtCookie\" setCookieSecureFlag=\"false\"/>\n+     * Expects:\n+     *  - JWT cookie is not found in the response, but the ltpa cookie is found.\n+     */\n+    @Test\n+    public void test_disableJwtCookie_true_includeLtpaCookie_true_differentJwtCookieName() throws Exception {\n+        server.reconfigureServerUsingExpandedConfiguration(_testName, \"server_disableJwtCookie_true_differentJwtCookieName_includeLtpa_true.xml\");\n+\n+        String jwtCookieName = \"AdamsJwtCookie\";\n+\n+        String currentAction = TestActions.ACTION_INVOKE_PROTECTED_RESOURCE;\n+        Page response = actions.invokeUrl(_testName, webClient, protectedUrl);\n+        Expectations expectations = new Expectations();\n+        \n+        currentAction = disableJwtCookie_test_base(currentAction, response, expectations);\n+        \n+        expectations.addExpectations(CommonExpectations.cookieDoesNotExist(currentAction, webClient, jwtCookieName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "def38d8c426ecd61906796b55f937a083351f898"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "def38d8c426ecd61906796b55f937a083351f898", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/def38d8c426ecd61906796b55f937a083351f898", "committedDate": "2020-06-04T14:32:36Z", "message": "add disableJwtCookie tests"}, "afterCommit": {"oid": "1f9236be07ddfb11e28c747f7ddb6319c9bf5963", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f9236be07ddfb11e28c747f7ddb6319c9bf5963", "committedDate": "2020-06-04T17:49:59Z", "message": "add disableJwtCookie tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc8877a8b53cd9538ec135cbbde4fb7e88665b88", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/dc8877a8b53cd9538ec135cbbde4fb7e88665b88", "committedDate": "2020-06-04T18:03:10Z", "message": "add disableJwtCookie tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f9236be07ddfb11e28c747f7ddb6319c9bf5963", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f9236be07ddfb11e28c747f7ddb6319c9bf5963", "committedDate": "2020-06-04T17:49:59Z", "message": "add disableJwtCookie tests"}, "afterCommit": {"oid": "dc8877a8b53cd9538ec135cbbde4fb7e88665b88", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/dc8877a8b53cd9538ec135cbbde4fb7e88665b88", "committedDate": "2020-06-04T18:03:10Z", "message": "add disableJwtCookie tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ea8d81f5b43be097ad21174e752a73f1dbb908f", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/9ea8d81f5b43be097ad21174e752a73f1dbb908f", "committedDate": "2020-06-05T13:33:43Z", "message": "Merge branch 'integration' of github.com:OpenLiberty/open-liberty into disableJwtCookie-fat\nupdate branch to integration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcdc36e3cea8a809bcede4993eb24c7f48fcfbb3", "author": {"user": {"login": "Zech-Hein", "name": "Zach Hein"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/dcdc36e3cea8a809bcede4993eb24c7f48fcfbb3", "committedDate": "2020-06-05T17:37:36Z", "message": "fix security fat common TestActionsTest unit test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2358, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}