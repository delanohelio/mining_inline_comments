{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MjEyNzIy", "number": 11480, "title": "Repeat FAT tests with Jakarta EE", "bodyText": "To repeat an entire FAT bucket, or a subset of FAT tests with JakartaEE, the following repeat action could be used:\n@ClassRule\npublic static RepeatTests r = RepeatTests.withoutModification() // EE7\n                    .andWith(FeatureReplacementAction.EE8_FEATURES()) // EE8\n                    .andWith(new JakartaEEAction()); // EE9\nWhen a JakartaEE repeat action runs, the following steps occur:\n\nThe JakartaTransformer.main() method is invoked on each war/ear file found under publish/servers/. This may also be customized to include more/less files\nThe standard FeatureReplacementAction kicks in to update server.xml's from EE7/8 to EE9 features. For example, servlet-4.0 --> servlet-5.0 and componenttest-1.0 --> componenttest-2.0\n\nHow to enable this in a FAT bucket\n\nAdd a RepeatTests @ClassRule (if not already present). If you add it at the FATSuite.java level the entire FAT bucket will repeat. Or, if you add it only on a specific test class, the repeats will only apply to that class.\nAdd the transformer dependencies in the FATs build.gradle file: addRequiredLibraries.dependsOn addJakartaTransformer\n(Optional) If certain tests don't apply to Jakarta EE 9, they may be skipped by adding the @SkipForRepeat(EE9_FEATURES) annotation to the @Test method", "createdAt": "2020-03-26T14:41:18Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11480", "merged": true, "mergeCommit": {"oid": "35d9dc084e39facea03bf540cdf3b6a6d8a0d75d"}, "closed": true, "closedAt": "2020-03-26T23:09:14Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcReKcKgBqjMxNjg4ODU4OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRkSpugBqjMxNzAzODEyNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb039cb2ed65accaa9c4aea587b611be0bc241b7", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fb039cb2ed65accaa9c4aea587b611be0bc241b7", "committedDate": "2020-03-26T15:36:27Z", "message": "Upgrade to jakarta transformer 0.0.6"}, "afterCommit": {"oid": "b0517f0f2c391475765fe80f130c0d492464d93a", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b0517f0f2c391475765fe80f130c0d492464d93a", "committedDate": "2020-03-26T15:51:14Z", "message": "Upgrade to jakarta transformer 0.0.6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTY0NTg3", "url": "https://github.com/OpenLiberty/open-liberty/pull/11480#pullrequestreview-382164587", "createdAt": "2020-03-26T16:07:22Z", "commit": {"oid": "b0517f0f2c391475765fe80f130c0d492464d93a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjYzMzMw", "url": "https://github.com/OpenLiberty/open-liberty/pull/11480#pullrequestreview-382263330", "createdAt": "2020-03-26T17:53:22Z", "commit": {"oid": "4a267e7a7b3388a8f5d87acee336961b5e325b48"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzo1MzoyMlrOF8TRhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzo1ODozN1rOF8TgNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3NDY2Mg==", "bodyText": "Minor: Wrong year copyright for new file.  Some other files have the same issue.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11480#discussion_r398774662", "createdAt": "2020-03-26T17:53:22Z", "author": {"login": "njr-11"}, "path": "dev/com.ibm.ws.componenttest.2.0/bnd.bnd", "diffHunk": "@@ -0,0 +1,74 @@\n+#*******************************************************************************\n+# Copyright (c) 2017 IBM Corporation and others.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a267e7a7b3388a8f5d87acee336961b5e325b48"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3ODQyMQ==", "bodyText": "Why is jdbc-4.2 an EE9 feature?  Also, concurrent-2.0 is missing.  Are others missing as well - I don't see EJB (whatever the new name for it is) ?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11480#discussion_r398778421", "createdAt": "2020-03-26T17:58:37Z", "author": {"login": "njr-11"}, "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java", "diffHunk": "@@ -0,0 +1,226 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import com.ibm.websphere.simplicity.log.Log;\n+import com.ibm.ws.jakarta.transformer.JakartaTransformer;\n+\n+import componenttest.custom.junit.runner.Mode.TestMode;\n+import componenttest.custom.junit.runner.RepeatTestFilter;\n+\n+/**\n+ * Test repeat action that will do 2 things:\n+ * <ol>\n+ * <li>Invoke the Jakarta transformer on all war/ear files under the autoFVT/publish/ folder</li>\n+ * <li>Update all server.xml configs under the autoFVT/publish/ folder to use EE 9 features</li>\n+ * </ol>\n+ */\n+public class JakartaEE9Action extends FeatureReplacementAction {\n+\n+    private static final Class<?> c = JakartaEE9Action.class;\n+\n+    public static final String ID = \"EE9_FEATURES\";\n+\n+    static final String[] EE9_FEATURES_ARRAY = { \"jakartaee-9.0\", \"webProfile-9.0\", \"jakartaeeClient-9.0\", \"servlet-5.0\", \"jdbc-4.2\", \"javaMail-2.0\", \"cdi-3.0\", \"jpa-3.0\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a267e7a7b3388a8f5d87acee336961b5e325b48"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6968bdbef413a2d563bdf1f2bdb9af7b97749dec", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6968bdbef413a2d563bdf1f2bdb9af7b97749dec", "committedDate": "2020-03-26T20:08:37Z", "message": "Update copyrights for componenttest-2.0"}, "afterCommit": {"oid": "b172c6ba430d1302e716dc8966cf428232138193", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b172c6ba430d1302e716dc8966cf428232138193", "committedDate": "2020-03-26T22:01:49Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebbb91d2b0765fc7060dceb803a4b81daeb8eda3", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ebbb91d2b0765fc7060dceb803a4b81daeb8eda3", "committedDate": "2020-03-26T22:02:32Z", "message": "Create componenttest-2.0 feature for jakarta-based FATServlet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a5669ffd639b7b2af59db4e90408c77c2497dd", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/62a5669ffd639b7b2af59db4e90408c77c2497dd", "committedDate": "2020-03-26T22:02:32Z", "message": "Initial prototype with repeat action working"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ced40b3c39c4d6a6c2f66bdc3365cf265e95083", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1ced40b3c39c4d6a6c2f66bdc3365cf265e95083", "committedDate": "2020-03-26T22:02:32Z", "message": "Update transformer jar to version 0.0.5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f34eefaf19f3e932c2b683715dba61d2543328", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/84f34eefaf19f3e932c2b683715dba61d2543328", "committedDate": "2020-03-26T22:06:28Z", "message": "Move JakartaEE repeat action to FAT infra"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "843905205e90955dda1aa41316c9be27b5e88356", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/843905205e90955dda1aa41316c9be27b5e88356", "committedDate": "2020-03-26T22:06:29Z", "message": "Upgrade to jakarta transformer 0.0.6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adce66d59eb631ba8ba133621d54b7fe06438303", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/adce66d59eb631ba8ba133621d54b7fe06438303", "committedDate": "2020-03-26T22:06:29Z", "message": "Perform Jakarta xform in ShrinkHelper instead of RepeatAction.setup()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae177a3e01a3d78519fafc9dc2ba1425848ef1c8", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ae177a3e01a3d78519fafc9dc2ba1425848ef1c8", "committedDate": "2020-03-26T22:06:29Z", "message": "Integration with JakartaEE9Action and SharedServer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b172c6ba430d1302e716dc8966cf428232138193", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b172c6ba430d1302e716dc8966cf428232138193", "committedDate": "2020-03-26T22:01:49Z", "message": "Review comments"}, "afterCommit": {"oid": "66194c19d261c9c7f97ebdf5bfced699f5855bf8", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/66194c19d261c9c7f97ebdf5bfced699f5855bf8", "committedDate": "2020-03-26T22:07:15Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f1944324ddd61872333126ad5f5165572fcba9b", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f1944324ddd61872333126ad5f5165572fcba9b", "committedDate": "2020-03-26T22:59:37Z", "message": "Review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66194c19d261c9c7f97ebdf5bfced699f5855bf8", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/66194c19d261c9c7f97ebdf5bfced699f5855bf8", "committedDate": "2020-03-26T22:07:15Z", "message": "Review comments"}, "afterCommit": {"oid": "1f1944324ddd61872333126ad5f5165572fcba9b", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1f1944324ddd61872333126ad5f5165572fcba9b", "committedDate": "2020-03-26T22:59:37Z", "message": "Review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3000, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}