{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODA2Mzc5", "number": 12761, "title": "Oracle container wait strategy", "bodyText": "Oracle container currently uses default JDBC wait strategy, which tries to query the database. However, for this is known to falsely work on the Oracle container (testcontainers/testcontainers-java#1292).  Instead, we should wait for a healthy docker health check.", "createdAt": "2020-06-23T20:38:07Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12761", "merged": true, "mergeCommit": {"oid": "a3f0dc78294ce652990366a016f948e2702cc252"}, "closed": true, "closedAt": "2020-07-08T15:45:32Z", "author": {"login": "KyleAure"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuLnrzAFqTQzNjEzNzEwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuMvTyABqjM0NzQ5NjI5NTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTM3MTA4", "url": "https://github.com/OpenLiberty/open-liberty/pull/12761#pullrequestreview-436137108", "createdAt": "2020-06-23T20:38:53Z", "commit": {"oid": "ec672966467baec3809c4b1546d2d854ac7a0bca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozODo1M1rOGn5rsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozODo1M1rOGn5rsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MjcyMg==", "bodyText": "Add this waitStrategy instead of using default jdbc wait strategy.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12761#discussion_r444492722", "createdAt": "2020-06-23T20:38:53Z", "author": {"login": "KyleAure"}, "path": "dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package componenttest.topology.database.container;\n+\n+import java.time.Duration;\n+import static java.time.temporal.ChronoUnit.SECONDS;\n+import java.util.concurrent.Future;\n+\n+import org.testcontainers.containers.JdbcDatabaseContainer;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+import org.testcontainers.utility.TestcontainersConfiguration;\n+\n+//TODO this class can be deleted once this issue is resolved in TestContainers: https://github.com/testcontainers/testcontainers-java/issues/1292\n+public class OracleContainer extends JdbcDatabaseContainer<OracleContainer> {\n+\n+    public static final String NAME = \"oracle\";\n+\n+    private static final int ORACLE_PORT = 1521;\n+    private static final int APEX_HTTP_PORT = 8080;\n+\n+    private static final int DEFAULT_STARTUP_TIMEOUT_SECONDS = 240;\n+    private static final int DEFAULT_CONNECT_TIMEOUT_SECONDS = 120;\n+\n+    private String username = \"system\";\n+    private String password = \"oracle\";\n+\n+    private static String resolveImageName() {\n+        String image = TestcontainersConfiguration.getInstance()\n+            .getProperties().getProperty(\"oracle.container.image\");\n+\n+        if (image == null) {\n+            throw new IllegalStateException(\"An image to use for Oracle containers must be configured. \" +\n+                \"To do this, please place a file on the classpath named `testcontainers.properties`, \" +\n+                \"containing `oracle.container.image=IMAGE`, where IMAGE is a suitable image name and tag.\");\n+        }\n+        return image;\n+    }\n+\n+    public OracleContainer() {\n+        this(resolveImageName());\n+    }\n+\n+    public OracleContainer(String dockerImageName) {\n+        super(dockerImageName);\n+        this.waitStrategy = Wait.forHealthcheck()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec672966467baec3809c4b1546d2d854ac7a0bca"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTYxMTg2", "url": "https://github.com/OpenLiberty/open-liberty/pull/12761#pullrequestreview-436161186", "createdAt": "2020-06-23T21:11:24Z", "commit": {"oid": "ec672966467baec3809c4b1546d2d854ac7a0bca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f227c0480412ab9a39e7657881b4784e738fe9b4", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f227c0480412ab9a39e7657881b4784e738fe9b4", "committedDate": "2020-06-23T21:56:46Z", "message": "Oracle container wait strategy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec672966467baec3809c4b1546d2d854ac7a0bca", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ec672966467baec3809c4b1546d2d854ac7a0bca", "committedDate": "2020-06-23T20:31:45Z", "message": "Oracle container wait strategy"}, "afterCommit": {"oid": "f227c0480412ab9a39e7657881b4784e738fe9b4", "author": {"user": {"login": "KyleAure", "name": "Kyle Aure"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f227c0480412ab9a39e7657881b4784e738fe9b4", "committedDate": "2020-06-23T21:56:46Z", "message": "Oracle container wait strategy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2311, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}