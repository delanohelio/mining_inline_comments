{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTczMDc1", "number": 10365, "title": "Issue 10363: Constants and config processing", "bodyText": "Fixes #10363", "createdAt": "2020-01-09T21:39:40Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365", "merged": true, "mergeCommit": {"oid": "e811f699edcf282a165902c0ff48db8b6b7a83a6"}, "closed": true, "closedAt": "2020-01-13T18:47:33Z", "author": {"login": "kristip17"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4x9K3gBqjI5MzY3MjI5OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6A2VWgFqTM0MjA1NTU4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f7a5cca0342bcc353e7d277a314aa81efc83399", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/0f7a5cca0342bcc353e7d277a314aa81efc83399", "committedDate": "2020-01-09T21:38:35Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "658b1226383f21c3f041a56a49dc0ff86c3098b1", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/658b1226383f21c3f041a56a49dc0ff86c3098b1", "committedDate": "2020-01-09T22:46:38Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "658b1226383f21c3f041a56a49dc0ff86c3098b1", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/658b1226383f21c3f041a56a49dc0ff86c3098b1", "committedDate": "2020-01-09T22:46:38Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "45ddca82a0dfc3f64560174de6315035fefce170", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/45ddca82a0dfc3f64560174de6315035fefce170", "committedDate": "2020-01-09T22:57:37Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45ddca82a0dfc3f64560174de6315035fefce170", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/45ddca82a0dfc3f64560174de6315035fefce170", "committedDate": "2020-01-09T22:57:37Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "f08c4696778e9c0e7402a17578f7f859cc62d82b", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f08c4696778e9c0e7402a17578f7f859cc62d82b", "committedDate": "2020-01-09T23:06:00Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f08c4696778e9c0e7402a17578f7f859cc62d82b", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f08c4696778e9c0e7402a17578f7f859cc62d82b", "committedDate": "2020-01-09T23:06:00Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "94dc3b0477d85eeeede122815c3728301b0b5a89", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/94dc3b0477d85eeeede122815c3728301b0b5a89", "committedDate": "2020-01-10T17:47:06Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94dc3b0477d85eeeede122815c3728301b0b5a89", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/94dc3b0477d85eeeede122815c3728301b0b5a89", "committedDate": "2020-01-10T17:47:06Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd", "committedDate": "2020-01-10T20:44:36Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzQ5NDIx", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#pullrequestreview-341749421", "createdAt": "2020-01-13T10:29:20Z", "commit": {"oid": "e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMDoyOToyMFrOFcyhYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMDoyOToyMFrOFcyhYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTczMjE5NQ==", "bodyText": "Copyright dates should be 2019, 2020", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#discussion_r365732195", "createdAt": "2020-01-13T10:29:20Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/config/AcmeConfig.java", "diffHunk": "@@ -10,10 +10,40 @@\n  *******************************************************************************/\n package com.ibm.ws.security.acme.config;\n \n+import java.util.Set;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/e00f4f5ad2162de95c271484d3efe6c8bd2e4cfd", "committedDate": "2020-01-10T20:44:36Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a", "committedDate": "2020-01-13T15:59:30Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTkwNzYz", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#pullrequestreview-341990763", "createdAt": "2020-01-13T16:56:05Z", "commit": {"oid": "64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNjo1NjowNVrOFc9pHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNjo1NjoyMlrOFc9ptQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNDM5OQ==", "bodyText": "Probably shouldn't be an 'info'.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#discussion_r365914399", "createdAt": "2020-01-13T16:56:05Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeProviderServiceImpl.java", "diffHunk": "@@ -38,73 +37,86 @@\n import com.ibm.websphere.ras.TraceComponent;\n import com.ibm.ws.security.acme.config.AcmeConfig;\n import com.ibm.ws.security.acme.config.AcmeService;\n+import com.ibm.ws.security.acme.util.AcmeConstants;\n import com.ibm.ws.security.acme.web.AcmeAuthorizationServices;\n import com.ibm.wsspi.kernel.service.utils.ConcurrentServiceReferenceMap;\n \n /**\n  * ACME certificate management support.\n  */\n @Component(service = { AcmeConfig.class, ServletContainerInitializer.class,\n-                       ServletContextListener.class }, immediate = true, configurationPolicy = ConfigurationPolicy.REQUIRE, configurationPid = \"com.ibm.ws.security.acme.config\", property = \"service.vendor=IBM\")\n+\t\tServletContextListener.class }, immediate = true, configurationPolicy = ConfigurationPolicy.REQUIRE, configurationPid = AcmeConstants.ACME_PID, property = \"service.vendor=IBM\")\n public class AcmeProviderServiceImpl implements AcmeConfig, ServletContextListener, ServletContainerInitializer {\n \n     private final TraceComponent tc = Tr.register(AcmeProviderServiceImpl.class);\n-    private final String parameter1 = \"JM-acme-parm1\";\n-    private final String parameter2 = \"JM-acme-parm2\";\n \n     private AcmeService serviceProvider;\n-\n-    /**\n-     * The properties class that contain the attributes defined\n-     * by inside of server.xml.\n-     */\n-    private final Properties sessionProperties = new Properties();\n-    /**\n-     * Strings used to access the various attributes that are\n-     * defined in the <mailSession> and that are subsequently\n-     * extracted from the ComponentContext to be placed in the Properties\n-     * object\n-     */\n-    public static final String PARM1 = \"configParm1\";\n-    public static final String PARM2 = \"configParm2\";\n-\n-    private final String propertiesArray[] = { PARM1, PARM2 };\n+    \n+\tprivate String directoryURI;\n+\tprivate String domain;\n+\tprivate int validFor;\n+\tprivate String country;\n+\tprivate String locality;\n+\tprivate String state;\n+\tprivate String organization;\n+\tprivate String organizationalUnit;\n+\n+\t// Challenge and order related fields.\n+\tprivate int challengeRetries;\n+\tprivate int challengeRetryWait;\n+\tprivate int orderRetries;\n+\tprivate int orderRetryWait;\n+\n+\t// ACME account related fields.\n+\tprivate String accountKeyFile;\n+\tprivate Set<String> accountContact;\n+\tprivate boolean acceptTermsOfService;\n+\tprivate String domainKeyFile;\n+\n+\tprivate AcmeClient acmeClient;\n \n     private final HashMap<String, Set<String>> appModules = new HashMap<String, Set<String>>();\n \n-    // File name of the User Key Pair\n-    private static final File USER_KEY_FILE = new File(\"user.key\");\n-\n-    // File name of the Domain Key Pair\n-    private static final File DOMAIN_KEY_FILE = new File(\"domain.key\");\n-\n-    // File name of the CSR\n-    private static final File DOMAIN_CSR_FILE = new File(\"domain.csr\");\n-\n-    // File name of the signed certificate\n-    private static final File DOMAIN_CHAIN_FILE = new File(\"domain-chain.crt\");\n-\n-    //Challenge type to be used\n-    private static final ChallengeType CHALLENGE_TYPE = ChallengeType.HTTP;\n-\n-    // RSA key size of generated key pairs\n-    private static final int KEY_SIZE = 2048;\n-\n-    private enum ChallengeType {\n-        HTTP, DNS\n-    }\n-\n     @Activate\n     public void activate(ComponentContext context, Map<String, Object> properties) {\n-        Tr.info(tc, \"******* JTM ******* AcmeProviderServiceImpl: inside activate() method. Display input properties: \");\n-\n+\t\tinitialize(properties);\n     }\n \n     @Modified\n     public void modify(Map<String, Object> properties) {\n-        Tr.info(tc, \" ******* JTM ******* AcmeProviderServiceImpl: inside modified () method\");\n+\t\tinitialize(properties);\n     }\n \n+\tpublic void initialize(Map<String, Object> configProps) {\n+\t\tTr.info(tc, \"Initialize ACME\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNDU0OQ==", "bodyText": "Remove this trace too.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#discussion_r365914549", "createdAt": "2020-01-13T16:56:22Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.security.acme/src/com/ibm/ws/security/acme/internal/AcmeProviderServiceImpl.java", "diffHunk": "@@ -38,73 +37,86 @@\n import com.ibm.websphere.ras.TraceComponent;\n import com.ibm.ws.security.acme.config.AcmeConfig;\n import com.ibm.ws.security.acme.config.AcmeService;\n+import com.ibm.ws.security.acme.util.AcmeConstants;\n import com.ibm.ws.security.acme.web.AcmeAuthorizationServices;\n import com.ibm.wsspi.kernel.service.utils.ConcurrentServiceReferenceMap;\n \n /**\n  * ACME certificate management support.\n  */\n @Component(service = { AcmeConfig.class, ServletContainerInitializer.class,\n-                       ServletContextListener.class }, immediate = true, configurationPolicy = ConfigurationPolicy.REQUIRE, configurationPid = \"com.ibm.ws.security.acme.config\", property = \"service.vendor=IBM\")\n+\t\tServletContextListener.class }, immediate = true, configurationPolicy = ConfigurationPolicy.REQUIRE, configurationPid = AcmeConstants.ACME_PID, property = \"service.vendor=IBM\")\n public class AcmeProviderServiceImpl implements AcmeConfig, ServletContextListener, ServletContainerInitializer {\n \n     private final TraceComponent tc = Tr.register(AcmeProviderServiceImpl.class);\n-    private final String parameter1 = \"JM-acme-parm1\";\n-    private final String parameter2 = \"JM-acme-parm2\";\n \n     private AcmeService serviceProvider;\n-\n-    /**\n-     * The properties class that contain the attributes defined\n-     * by inside of server.xml.\n-     */\n-    private final Properties sessionProperties = new Properties();\n-    /**\n-     * Strings used to access the various attributes that are\n-     * defined in the <mailSession> and that are subsequently\n-     * extracted from the ComponentContext to be placed in the Properties\n-     * object\n-     */\n-    public static final String PARM1 = \"configParm1\";\n-    public static final String PARM2 = \"configParm2\";\n-\n-    private final String propertiesArray[] = { PARM1, PARM2 };\n+    \n+\tprivate String directoryURI;\n+\tprivate String domain;\n+\tprivate int validFor;\n+\tprivate String country;\n+\tprivate String locality;\n+\tprivate String state;\n+\tprivate String organization;\n+\tprivate String organizationalUnit;\n+\n+\t// Challenge and order related fields.\n+\tprivate int challengeRetries;\n+\tprivate int challengeRetryWait;\n+\tprivate int orderRetries;\n+\tprivate int orderRetryWait;\n+\n+\t// ACME account related fields.\n+\tprivate String accountKeyFile;\n+\tprivate Set<String> accountContact;\n+\tprivate boolean acceptTermsOfService;\n+\tprivate String domainKeyFile;\n+\n+\tprivate AcmeClient acmeClient;\n \n     private final HashMap<String, Set<String>> appModules = new HashMap<String, Set<String>>();\n \n-    // File name of the User Key Pair\n-    private static final File USER_KEY_FILE = new File(\"user.key\");\n-\n-    // File name of the Domain Key Pair\n-    private static final File DOMAIN_KEY_FILE = new File(\"domain.key\");\n-\n-    // File name of the CSR\n-    private static final File DOMAIN_CSR_FILE = new File(\"domain.csr\");\n-\n-    // File name of the signed certificate\n-    private static final File DOMAIN_CHAIN_FILE = new File(\"domain-chain.crt\");\n-\n-    //Challenge type to be used\n-    private static final ChallengeType CHALLENGE_TYPE = ChallengeType.HTTP;\n-\n-    // RSA key size of generated key pairs\n-    private static final int KEY_SIZE = 2048;\n-\n-    private enum ChallengeType {\n-        HTTP, DNS\n-    }\n-\n     @Activate\n     public void activate(ComponentContext context, Map<String, Object> properties) {\n-        Tr.info(tc, \"******* JTM ******* AcmeProviderServiceImpl: inside activate() method. Display input properties: \");\n-\n+\t\tinitialize(properties);\n     }\n \n     @Modified\n     public void modify(Map<String, Object> properties) {\n-        Tr.info(tc, \" ******* JTM ******* AcmeProviderServiceImpl: inside modified () method\");\n+\t\tinitialize(properties);\n     }\n \n+\tpublic void initialize(Map<String, Object> configProps) {\n+\t\tTr.info(tc, \"Initialize ACME\");\n+\n+\t\tdirectoryURI = (String) configProps.get(AcmeConstants.DIR_URI);\n+\t\tdomain = (String) configProps.get(AcmeConstants.DOMAIN);\n+\t\tvalidFor = ((Integer) configProps.get(AcmeConstants.VALID_FOR)).intValue();\n+\t\tcountry = (String) configProps.get(AcmeConstants.COUNTRY);\n+\t\tlocality = (String) configProps.get(AcmeConstants.LOCALITY);\n+\t\tstate = (String) configProps.get(AcmeConstants.STATE);\n+\t\torganization = (String) configProps.get(AcmeConstants.ORG);\n+\t\torganizationalUnit = (String) configProps.get(AcmeConstants.OU);\n+\t\tchallengeRetries = ((Integer) configProps.get(AcmeConstants.VALID_FOR)).intValue();\n+\t\tchallengeRetryWait = ((Integer) configProps.get(AcmeConstants.VALID_FOR)).intValue();\n+\t\torderRetries = ((Integer) configProps.get(AcmeConstants.VALID_FOR)).intValue();\n+\t\torderRetryWait = ((Integer) configProps.get(AcmeConstants.VALID_FOR)).intValue();\n+\t\taccountKeyFile = (String) configProps.get(AcmeConstants.ACCOUNT_KEY_FILE);\n+\t\taccountContact = new HashSet<String>();\n+\t\taccountContact.add((String) configProps.get(AcmeConstants.ACCOUNT_CONTACT));\n+\t\tacceptTermsOfService = ((Boolean) configProps.get(AcmeConstants.ACCEPT_TERMS)).booleanValue();\n+\t\tdomainKeyFile = (String) configProps.get(AcmeConstants.DOMAIN_KEY_FILE);\n+\n+\t\tacmeClient = new AcmeClient(directoryURI, accountKeyFile, domainKeyFile, accountContact);\n+\t\tacmeClient.setAcceptTos(acceptTermsOfService);\n+\t\tacmeClient.setChallengeRetries(challengeRetries);\n+\t\tacmeClient.setChallengeRetryWait(challengeRetryWait);\n+\t\tacmeClient.setOrderRetries(orderRetries);\n+\t\tacmeClient.setOrderRetryWait(orderRetryWait);\n+\n+\t}\n+\n     @Deactivate\n     public void deactivate(ComponentContext context, int reason) {\n         Tr.info(tc, \" ******* JTM ******* AcmeProviderServiceImpl: inside deactivate() method\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a"}, "originalPosition": 149}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64834a6da3fb1dc34f9c4bc6bdf51c9e2a20a02a", "committedDate": "2020-01-13T15:59:30Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "5a0f1e3e2f670cb7f0c151ed3af7643c2d09cf20", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5a0f1e3e2f670cb7f0c151ed3af7643c2d09cf20", "committedDate": "2020-01-13T17:08:55Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc937febba4b31c0a6e41a1318bdadf0fee0da6f", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fc937febba4b31c0a6e41a1318bdadf0fee0da6f", "committedDate": "2020-01-13T17:11:37Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a0f1e3e2f670cb7f0c151ed3af7643c2d09cf20", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5a0f1e3e2f670cb7f0c151ed3af7643c2d09cf20", "committedDate": "2020-01-13T17:08:55Z", "message": "Issue 10363: Constants and config processing"}, "afterCommit": {"oid": "fc937febba4b31c0a6e41a1318bdadf0fee0da6f", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fc937febba4b31c0a6e41a1318bdadf0fee0da6f", "committedDate": "2020-01-13T17:11:37Z", "message": "Issue 10363: Constants and config processing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMDU1NTg5", "url": "https://github.com/OpenLiberty/open-liberty/pull/10365#pullrequestreview-342055589", "createdAt": "2020-01-13T18:41:54Z", "commit": {"oid": "fc937febba4b31c0a6e41a1318bdadf0fee0da6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3484, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}