{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNjAyMjE2", "number": 10716, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTozOTo1OFrODc1T-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTo0MTowNlrODc1U3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNTYwMTg1OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTozOTo1OFrOFlFtTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjo1NjozNFrOFlbyAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTE1MQ==", "bodyText": "does name=\"*\" not work here?", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374435151", "createdAt": "2020-02-04T01:39:58Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "diffHunk": "@@ -261,6 +261,10 @@\n \t<javaPermission className=\"java.lang.RuntimePermission\" name=\"accessDeclaredMembers\" />\n \t<!-- Postgres and SQLServer permission to make a basic query-->\n \t<javaPermission className=\"java.util.PropertyPermission\" name=\"*\" actions=\"read\"/>\n+\n+\t<!-- Postgres permission during commit cycle -->\n+\t<javaPermission className=\"org.osgi.framework.ServicePermission\" name=\"*\" actions=\"get\"/>\n+\t<javaPermission className=\"javax.security.auth.PrivateCredentialPermission\"  name='* * \"*\"' actions=\"read\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNjI2Nw==", "bodyText": "I don't believe so.  I can run that test tomorrow. I tried various combinations and nothing worked.  I then did some looking in other places and found that line.  I copied it over and that worked.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374436267", "createdAt": "2020-02-04T01:44:33Z", "author": {"login": "gjwatts"}, "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "diffHunk": "@@ -261,6 +261,10 @@\n \t<javaPermission className=\"java.lang.RuntimePermission\" name=\"accessDeclaredMembers\" />\n \t<!-- Postgres and SQLServer permission to make a basic query-->\n \t<javaPermission className=\"java.util.PropertyPermission\" name=\"*\" actions=\"read\"/>\n+\n+\t<!-- Postgres permission during commit cycle -->\n+\t<javaPermission className=\"org.osgi.framework.ServicePermission\" name=\"*\" actions=\"get\"/>\n+\t<javaPermission className=\"javax.security.auth.PrivateCredentialPermission\"  name='* * \"*\"' actions=\"read\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTE1MQ=="}, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcxNzc0Mg==", "bodyText": "If it works we can leave it.  But from my understanding only the last * in a java permission statement actually does anything.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374717742", "createdAt": "2020-02-04T14:54:32Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "diffHunk": "@@ -261,6 +261,10 @@\n \t<javaPermission className=\"java.lang.RuntimePermission\" name=\"accessDeclaredMembers\" />\n \t<!-- Postgres and SQLServer permission to make a basic query-->\n \t<javaPermission className=\"java.util.PropertyPermission\" name=\"*\" actions=\"read\"/>\n+\n+\t<!-- Postgres permission during commit cycle -->\n+\t<javaPermission className=\"org.osgi.framework.ServicePermission\" name=\"*\" actions=\"get\"/>\n+\t<javaPermission className=\"javax.security.auth.PrivateCredentialPermission\"  name='* * \"*\"' actions=\"read\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTE1MQ=="}, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc5NjgwMQ==", "bodyText": "I changed that javaPermission line to name=\"*\" and re-ran the FAT test bucket and it failed with java 2 security errors.  I changed it back to what I have above and the FAT test bucket passed.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374796801", "createdAt": "2020-02-04T16:56:34Z", "author": {"login": "gjwatts"}, "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "diffHunk": "@@ -261,6 +261,10 @@\n \t<javaPermission className=\"java.lang.RuntimePermission\" name=\"accessDeclaredMembers\" />\n \t<!-- Postgres and SQLServer permission to make a basic query-->\n \t<javaPermission className=\"java.util.PropertyPermission\" name=\"*\" actions=\"read\"/>\n+\n+\t<!-- Postgres permission during commit cycle -->\n+\t<javaPermission className=\"org.osgi.framework.ServicePermission\" name=\"*\" actions=\"get\"/>\n+\t<javaPermission className=\"javax.security.auth.PrivateCredentialPermission\"  name='* * \"*\"' actions=\"read\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTE1MQ=="}, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNTYwNDEzOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.jdbc_fat/test-applications/basicfat/src/basicfat/DataSourceTestServlet.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTo0MTowNlrOFlFuig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDo1MjoxMlrOFlW3TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTQ2Ng==", "bodyText": "We no longer test against Informix so this logic can be cut out.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374435466", "createdAt": "2020-02-04T01:41:06Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/test-applications/basicfat/src/basicfat/DataSourceTestServlet.java", "diffHunk": "@@ -215,20 +215,36 @@\n      * Create the default table used by the tests.\n      */\n     private void createTable(DataSource ds) throws SQLException {\n-        Connection con = ds.getConnection();\n-        try {\n-            Statement st = con.createStatement();\n-            try {\n-                st.executeUpdate(\"drop table cities\");\n-            } catch (SQLException x) {\n+        try (Connection con = ds.getConnection()) {\n+            //See if cities table was already created\n+            DatabaseMetaData md = con.getMetaData();\n+            boolean tableFound = false;\n+            ResultSet rs = md.getTables(null, null, \"CITIES\", null); // Some DB providers require the table name in all upper case\n+            while (rs.next()) {\n+                if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                    tableFound = true;\n+                }\n+            }\n+\n+            if (!tableFound) {\n+                rs = md.getTables(null, null, \"cities\", null); // Other DB providers require the table name in all lower case\n+                while (rs.next()) {\n+                    if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                        tableFound = true;\n+                    }\n+                }\n+            }\n+\n+            try (Statement st = con.createStatement()) {\n+                if (tableFound) {\n+                    st.executeUpdate(\"drop table cities\");\n+                }\n+                String dbProductName = md.getDatabaseProductName().toUpperCase();\n+                if (dbProductName.contains(\"IDS\") || dbProductName.contains(\"INFORMIX\")) // Informix JCC and JDBC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNjY4Mw==", "bodyText": "There are multiple places where Informix is referenced.  Should I remove them all in DataSourceTestServlet, or just the one you highlighted?", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374436683", "createdAt": "2020-02-04T01:46:24Z", "author": {"login": "gjwatts"}, "path": "dev/com.ibm.ws.jdbc_fat/test-applications/basicfat/src/basicfat/DataSourceTestServlet.java", "diffHunk": "@@ -215,20 +215,36 @@\n      * Create the default table used by the tests.\n      */\n     private void createTable(DataSource ds) throws SQLException {\n-        Connection con = ds.getConnection();\n-        try {\n-            Statement st = con.createStatement();\n-            try {\n-                st.executeUpdate(\"drop table cities\");\n-            } catch (SQLException x) {\n+        try (Connection con = ds.getConnection()) {\n+            //See if cities table was already created\n+            DatabaseMetaData md = con.getMetaData();\n+            boolean tableFound = false;\n+            ResultSet rs = md.getTables(null, null, \"CITIES\", null); // Some DB providers require the table name in all upper case\n+            while (rs.next()) {\n+                if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                    tableFound = true;\n+                }\n+            }\n+\n+            if (!tableFound) {\n+                rs = md.getTables(null, null, \"cities\", null); // Other DB providers require the table name in all lower case\n+                while (rs.next()) {\n+                    if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                        tableFound = true;\n+                    }\n+                }\n+            }\n+\n+            try (Statement st = con.createStatement()) {\n+                if (tableFound) {\n+                    st.executeUpdate(\"drop table cities\");\n+                }\n+                String dbProductName = md.getDatabaseProductName().toUpperCase();\n+                if (dbProductName.contains(\"IDS\") || dbProductName.contains(\"INFORMIX\")) // Informix JCC and JDBC", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTQ2Ng=="}, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcxNjIzNw==", "bodyText": "Yeah we can remove anything that references Informix in this test bucket.  But, that can be done in a future commit.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374716237", "createdAt": "2020-02-04T14:52:12Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/test-applications/basicfat/src/basicfat/DataSourceTestServlet.java", "diffHunk": "@@ -215,20 +215,36 @@\n      * Create the default table used by the tests.\n      */\n     private void createTable(DataSource ds) throws SQLException {\n-        Connection con = ds.getConnection();\n-        try {\n-            Statement st = con.createStatement();\n-            try {\n-                st.executeUpdate(\"drop table cities\");\n-            } catch (SQLException x) {\n+        try (Connection con = ds.getConnection()) {\n+            //See if cities table was already created\n+            DatabaseMetaData md = con.getMetaData();\n+            boolean tableFound = false;\n+            ResultSet rs = md.getTables(null, null, \"CITIES\", null); // Some DB providers require the table name in all upper case\n+            while (rs.next()) {\n+                if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                    tableFound = true;\n+                }\n+            }\n+\n+            if (!tableFound) {\n+                rs = md.getTables(null, null, \"cities\", null); // Other DB providers require the table name in all lower case\n+                while (rs.next()) {\n+                    if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                        tableFound = true;\n+                    }\n+                }\n+            }\n+\n+            try (Statement st = con.createStatement()) {\n+                if (tableFound) {\n+                    st.executeUpdate(\"drop table cities\");\n+                }\n+                String dbProductName = md.getDatabaseProductName().toUpperCase();\n+                if (dbProductName.contains(\"IDS\") || dbProductName.contains(\"INFORMIX\")) // Informix JCC and JDBC", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTQ2Ng=="}, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2207, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}