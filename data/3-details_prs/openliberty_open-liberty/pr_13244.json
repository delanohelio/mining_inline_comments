{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NzAwNDM1", "number": 13244, "title": "EJB Synchronize Bindings List and add trace", "bodyText": "NamespaceBinderImpl change is for this:\nCaused by: java.lang.ArrayIndexOutOfBoundsExceArrayIndexOutOfBoundsExceptionption\n    at java.util.ArrayList.add(ArrayList.java:474)\n    at com.ibm.ws.ejbcontainer.osgi.internal.NameSpaceBinderImpl.bindLegacyRemoteBinding(NameSpaceBinderImpl.java:284)\n    at com.ibm.ws.ejbcontainer.osgi.internal.NameSpaceBinderImpl.bindDefaultEJBRemote(NameSpaceBinderImpl.java:242)\n    at com.ibm.ws.ejbcontainer.osgi.internal.NameSpaceBinderImpl.bindBindings(NameSpaceBinderImpl.java:518)\n    at com.ibm.ws.ejbcontainer.osgi.internal.NameSpaceBinderImpl.bindBindings(NameSpaceBinderImpl.java:49)\n    at com.ibm.ws.ejbcontainer.runtime.AbstractEJBRuntime.bindInterface(AbstractEJBRuntime.java:997)\n    at com.ibm.ws.ejbcontainer.runtime.AbstractEJBRuntime.bindInterfaces(AbstractEJBRuntime.java:935)\n    at com.ibm.ws.ejbcontainer.runtime.AbstractEJBRuntime.bindInterfaces(AbstractEJBRuntime.java:862)\n    at com.ibm.ws.ejbcontainer.osgi.internal.EJBRuntimeImpl.bindInterfaces(EJBRuntimeImpl.java:1202)\n    at com.ibm.ws.ejbcontainer.runtime.AbstractEJBRuntime.startModule(AbstractEJBRuntime.java:524)\n\nthis line: registrations.add(registration);\n\n\n\nThe extra trace and server dumps in tests is to try and debug the RemoteRuntime being null.\n\n\n\nContainerProperties.DisableShortDefaultBindings = null; is for deleting that config element while the server is up", "createdAt": "2020-07-29T21:09:25Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13244", "merged": true, "mergeCommit": {"oid": "2eec690e4fc0fd76da364cde4737f029f95f0303"}, "closed": true, "closedAt": "2020-07-31T15:52:05Z", "author": {"login": "olendvcook"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6AmpRAFqTQ1ODQ1NDUxNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6ETsKgFqTQ1ODY3MTI2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NDU0NTE0", "url": "https://github.com/OpenLiberty/open-liberty/pull/13244#pullrequestreview-458454514", "createdAt": "2020-07-30T14:26:52Z", "commit": {"oid": "8b9e17cb4456d06e34a382a7ebaeb7b1fcdfd49d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNjo1MlrOG5lgTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDozNDo1N1rOG5l3yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNjQ5Mg==", "bodyText": "What is the scenario that can cause getReference() to be null?  Seems ejbRemoteRuntimeServiceRef.getService() would also be null; so wondering if we should stop caching it in remoteRuntime, and instead just call getService at the beginning of every function that needs it?  Or, can getService() return a non-null value when getReference() returns null?", "url": "https://github.com/OpenLiberty/open-liberty/pull/13244#discussion_r463036492", "createdAt": "2020-07-30T14:26:52Z", "author": {"login": "tkburroughs"}, "path": "dev/com.ibm.ws.ejbcontainer/src/com/ibm/ws/ejbcontainer/osgi/internal/NameSpaceBinderImpl.java", "diffHunk": "@@ -259,15 +260,15 @@ public void bindDefaultEJBRemote(EJBBinding bindingObject, HomeRecord hr) {\n      * @param bindingName the JNDI binding name\n      */\n     private void bindLegacyRemoteBinding(EJBBinding bindingObject, HomeRecord hr, String bindingName) {\n-        if (remoteRuntime != null) {\n+        if (remoteRuntime != null && ejbRemoteRuntimeServiceRef.getReference() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b9e17cb4456d06e34a382a7ebaeb7b1fcdfd49d"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0MjUwNA==", "bodyText": "Would it be safer (less timing concern) with something like this:\n        EJBRemoteRuntime remoteRuntime = ejbRemoteRuntimeServiceRef.getService();\n        ServiceReference<EJBRemoteRuntime> remoteRuntimeRef = ejbRemoteRuntimeServiceRef.getReference();\n        \n        if (remoteRuntime != null && remoteRuntimeRef != null) {\n\n            BundleContext bc = remoteRuntimeRef.getBundle().getBundleContext();", "url": "https://github.com/OpenLiberty/open-liberty/pull/13244#discussion_r463042504", "createdAt": "2020-07-30T14:34:57Z", "author": {"login": "tkburroughs"}, "path": "dev/com.ibm.ws.ejbcontainer/src/com/ibm/ws/ejbcontainer/osgi/internal/NameSpaceBinderImpl.java", "diffHunk": "@@ -259,15 +260,15 @@ public void bindDefaultEJBRemote(EJBBinding bindingObject, HomeRecord hr) {\n      * @param bindingName the JNDI binding name\n      */\n     private void bindLegacyRemoteBinding(EJBBinding bindingObject, HomeRecord hr, String bindingName) {\n-        if (remoteRuntime != null) {\n+        if (remoteRuntime != null && ejbRemoteRuntimeServiceRef.getReference() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNjQ5Mg=="}, "originalCommit": {"oid": "8b9e17cb4456d06e34a382a7ebaeb7b1fcdfd49d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc675c126e3ab8e2b7af0085f2468dba5f391573", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/cc675c126e3ab8e2b7af0085f2468dba5f391573", "committedDate": "2020-07-30T15:24:38Z", "message": "EJB Synchronize Bindings List and add trace"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b9e17cb4456d06e34a382a7ebaeb7b1fcdfd49d", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8b9e17cb4456d06e34a382a7ebaeb7b1fcdfd49d", "committedDate": "2020-07-29T21:08:05Z", "message": "EJB Synchronize Bindings List and add trace"}, "afterCommit": {"oid": "cc675c126e3ab8e2b7af0085f2468dba5f391573", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/cc675c126e3ab8e2b7af0085f2468dba5f391573", "committedDate": "2020-07-30T15:24:38Z", "message": "EJB Synchronize Bindings List and add trace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjcxMjYw", "url": "https://github.com/OpenLiberty/open-liberty/pull/13244#pullrequestreview-458671260", "createdAt": "2020-07-30T18:54:49Z", "commit": {"oid": "cc675c126e3ab8e2b7af0085f2468dba5f391573"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2093, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}