{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzkzMjY5", "number": 11256, "title": "Adding JDBC heritage API feature to enable ConnectionWaitTimeoutException", "bodyText": "In a WebSphere Application Server, if a JDBC connection is requested with a specified timeout, but it is unable to allocate a connection before the connection timeout is reached, a com.ibm.websphere.ce.cm.ConnectionWaitTimeoutException exception gets thrown.\nIn contrast, Liberty throws an SQLTransientConnectionException exception with a chained ConnectionWaitTimeoutException exception in this case.\nFor people that would like a consistent behavior for this exception process between WebSphere Application Server and Liberty, this is an optional new feature to allow this behavior.  The ConnectionWaitTimeoutException already exists in Liberty, but needs to be exposed as an API.  The feature itself will only be offered in the commercial version of Liberty, but the code changes to support this feature will be made in Open Liberty.\nMigration of existing apps is the only reason for exposing the ConnectionWaitTimeoutException, we don't encourage it's use for maintenance or new apps. Although there are other exceptions in the com.ibm.websphere.ce.cm package, for the time being we're only going to expose this one exception.\nRelated issues\nIssue #10542\nIssue #10379", "createdAt": "2020-03-10T22:23:48Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256", "merged": true, "mergeCommit": {"oid": "f7f8e0fe267dec76145dada3d3fad4adb9dcb60d"}, "closed": true, "closedAt": "2020-06-27T04:20:05Z", "author": {"login": "gjwatts"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMn1JHgFqTM3Mjc5ODU1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvJZ-_gBqjM0ODgwNTczMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzk4NTU0", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#pullrequestreview-372798554", "createdAt": "2020-03-11T14:16:49Z", "commit": {"oid": "d49c20a0ff44467b5e3652c449fe85c70fdca809"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNDoxNjo0OVrOF043qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNDoxNjo0OVrOF043qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAwMjAyNQ==", "bodyText": "suggested edit:\nThis feature enables the traditional JDBC API. If a timeout occurs waiting for a JDBC connection, this API allows the JDBC component to throw a ConnectionWaitTimeoutException, instead of throwing a SQLTransientConnectionException with a ConnectionWaitTimeoutException as the cause. Use this feature only for compatibility with WebSphere Application\nServer traditional applications that require the ConnectionWaitTimeoutException to be thrown.\nnote that IBM style advises against using the term \"legacy\":\nFor products that are still supported but are not being actively developed, use \"existing,\" \"heritage,\" \"traditional,\" \"established,\" \"mature,\" \"earlier,\" or another appropriate neutral description instead of \"legacy.\"", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#discussion_r391002025", "createdAt": "2020-03-11T14:16:49Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.websphere.appserver.features/visibility/public/jdbcLegacyApi-1.0/resources/l10n/com.ibm.websphere.appserver.jdbcLegacyApi-1.0.properties", "diffHunk": "@@ -0,0 +1,20 @@\n+###############################################################################\n+# Copyright (c) 2013, 2020 IBM Corporation and others.\n+# All rights reserved. This program and the accompanying materials\n+# are made available under the terms of the Eclipse Public License v1.0\n+# which accompanies this distribution, and is available at\n+# http://www.eclipse.org/legal/epl-v10.html\n+#\n+# Contributors:\n+#     IBM Corporation - initial API and implementation\n+###############################################################################\n+#\n+#ISMESSAGEFILE FALSE\n+#NLS_ENCODING=UNICODE\n+#NLS_MESSAGEFORMAT_NONE\n+#\n+\n+description=This feature enables the legacy JDBC API.  This API allows the JDBC component to throw ConnectionWaitTimeoutException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49c20a0ff44467b5e3652c449fe85c70fdca809"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c4371c36b22c4daec63749887d415487c955751", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/4c4371c36b22c4daec63749887d415487c955751", "committedDate": "2020-05-29T00:28:43Z", "message": "10542 OL backing changes for CWTE"}, "afterCommit": {"oid": "24ae2deb787718d32855987da3852de0abd690de", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/24ae2deb787718d32855987da3852de0abd690de", "committedDate": "2020-05-29T01:10:42Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwOTY3NDE4", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#pullrequestreview-420967418", "createdAt": "2020-05-29T13:50:06Z", "commit": {"oid": "24ae2deb787718d32855987da3852de0abd690de"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMzo1MDowN1rOGcdbLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNDoxMjoyMlrOGceQ7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ5NTQwNQ==", "bodyText": "Lets remove this section of doc, using Throwable#initCause() is not really recommended in general", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#discussion_r432495405", "createdAt": "2020-05-29T13:50:07Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.jdbc/src/com/ibm/websphere/ce/cm/ConnectionWaitTimeoutException.java", "diffHunk": "@@ -21,11 +21,127 @@\n     private static final long serialVersionUID = 5958695928250441720L;\n \n     /**\n-     * Make a new ConnectionWaitTimeoutException.\n-     * \n-     * @param message the exception message.\n+     * Constructs a <code>ConnectionWaitTimeoutException</code> object.\n+     * The <code>reason</code>, <code>SQLState</code> are initialized\n+     * to <code>null</code> and the vendor code is initialized to 0.\n+     *\n+     * The <code>cause</code> is not initialized, and may subsequently be\n+     * initialized by a call to the\n+     * {@link Throwable#initCause(java.lang.Throwable)} method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24ae2deb787718d32855987da3852de0abd690de"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ5NTU1NA==", "bodyText": "Same comment applies to javadoc of other ctors", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#discussion_r432495554", "createdAt": "2020-05-29T13:50:23Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.jdbc/src/com/ibm/websphere/ce/cm/ConnectionWaitTimeoutException.java", "diffHunk": "@@ -21,11 +21,127 @@\n     private static final long serialVersionUID = 5958695928250441720L;\n \n     /**\n-     * Make a new ConnectionWaitTimeoutException.\n-     * \n-     * @param message the exception message.\n+     * Constructs a <code>ConnectionWaitTimeoutException</code> object.\n+     * The <code>reason</code>, <code>SQLState</code> are initialized\n+     * to <code>null</code> and the vendor code is initialized to 0.\n+     *\n+     * The <code>cause</code> is not initialized, and may subsequently be\n+     * initialized by a call to the\n+     * {@link Throwable#initCause(java.lang.Throwable)} method.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ5NTQwNQ=="}, "originalCommit": {"oid": "24ae2deb787718d32855987da3852de0abd690de"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUwOTE2Nw==", "bodyText": "Lets remove these references to heritageAPIs-1.0 and the commercial offering -- this repo shouldn't make any explicit references to CL or its features", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#discussion_r432509167", "createdAt": "2020-05-29T14:12:22Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.jdbc/src/com/ibm/ws/rsadapter/AdapterUtil.java", "diffHunk": "@@ -821,11 +821,15 @@ public static SQLException toSQLException(ResourceException resX)\n             // The J2C connection manager raises a special exception subclass.\n             else if (linkedX instanceof ResourceAllocationException\n                      && linkedX.getClass().getName().equals(\"com.ibm.websphere.ce.j2c.ConnectionWaitTimeoutException\")) {\n-                // Use a special SQLException subclass for connection wait timeout. \n-                sqlX = new ConnectionWaitTimeoutException(linkedX.getMessage()); \n-                sqlX.initCause(resX); \n-\n-                sqlX = new SQLTransientConnectionException(linkedX.getMessage(), \"08001\", 0, sqlX); \n+                // With the heritageAPIs-1.0 feature in our commercial offering, a change was made from throwing an SQLTransientConnectionException \n+                // to a ConnectionWaitTimeoutException to allow for traditional WebSphere applications to work since they expect a \n+                // ConnectionWaitTimeoutException instead.  This will continue to work with existing liberty applications as well since ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24ae2deb787718d32855987da3852de0abd690de"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24ae2deb787718d32855987da3852de0abd690de", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/24ae2deb787718d32855987da3852de0abd690de", "committedDate": "2020-05-29T01:10:42Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}, "afterCommit": {"oid": "34e4a5bedbf50f692b02f48c9b373f0a337bca08", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/34e4a5bedbf50f692b02f48c9b373f0a337bca08", "committedDate": "2020-06-01T20:23:58Z", "message": "Merge branch 'integration' of github.com:OpenLiberty/open-liberty into 10542-externalize-legacy-ConnectionWaitTimeoutException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODg4NzYz", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#pullrequestreview-422888763", "createdAt": "2020-06-02T17:12:41Z", "commit": {"oid": "34e4a5bedbf50f692b02f48c9b373f0a337bca08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42604ef6f591dc99cb04bf2cd06b3fc7a7700429", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/42604ef6f591dc99cb04bf2cd06b3fc7a7700429", "committedDate": "2020-06-13T06:11:14Z", "message": "Merge branch 'integration' of github.com:OpenLiberty/open-liberty into 10542-externalize-legacy-ConnectionWaitTimeoutException"}, "afterCommit": {"oid": "cc4508375e544421a46cfb6bafcacd977efc28be", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/cc4508375e544421a46cfb6bafcacd977efc28be", "committedDate": "2020-06-13T06:34:43Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc4508375e544421a46cfb6bafcacd977efc28be", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/cc4508375e544421a46cfb6bafcacd977efc28be", "committedDate": "2020-06-13T06:34:43Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}, "afterCommit": {"oid": "ed1ee68654007c2e8eeec83fe7766e998b3c7df3", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ed1ee68654007c2e8eeec83fe7766e998b3c7df3", "committedDate": "2020-06-13T06:38:01Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed1ee68654007c2e8eeec83fe7766e998b3c7df3", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ed1ee68654007c2e8eeec83fe7766e998b3c7df3", "committedDate": "2020-06-13T06:38:01Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}, "afterCommit": {"oid": "8be86d60785e96937c51bee63f8656c61589253a", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8be86d60785e96937c51bee63f8656c61589253a", "committedDate": "2020-06-13T08:09:22Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwOTIyMTU2", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#pullrequestreview-430922156", "createdAt": "2020-06-15T19:14:15Z", "commit": {"oid": "8be86d60785e96937c51bee63f8656c61589253a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTM5NDE1", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#pullrequestreview-438539415", "createdAt": "2020-06-26T19:20:18Z", "commit": {"oid": "8be86d60785e96937c51bee63f8656c61589253a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToyMDoxOFrOGpsGAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOToyMDoxOFrOGpsGAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2NzIzNA==", "bodyText": "this package is also listed under the Private-package list. I don't think that will cause an immediate issue but should be cleaned up", "url": "https://github.com/OpenLiberty/open-liberty/pull/11256#discussion_r446367234", "createdAt": "2020-06-26T19:20:18Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.jdbc/bnd.bnd", "diffHunk": "@@ -27,7 +27,8 @@ Export-Package: \\\n     com.ibm.ws.jdbc.timedoperations, \\\n     com.ibm.ws.rsadapter, \\\n     com.ibm.ws.rsadapter.jdbc, \\\n-    com.ibm.ws.rsadapter.impl\n+    com.ibm.ws.rsadapter.impl, \\\n+    com.ibm.websphere.ce.cm", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8be86d60785e96937c51bee63f8656c61589253a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b64dc54e6f3b4adab893632ec0833d468609fc8d", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b64dc54e6f3b4adab893632ec0833d468609fc8d", "committedDate": "2020-06-26T20:37:46Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8be86d60785e96937c51bee63f8656c61589253a", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8be86d60785e96937c51bee63f8656c61589253a", "committedDate": "2020-06-13T08:09:22Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}, "afterCommit": {"oid": "b64dc54e6f3b4adab893632ec0833d468609fc8d", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b64dc54e6f3b4adab893632ec0833d468609fc8d", "committedDate": "2020-06-26T20:37:46Z", "message": "10542 - Adding heritageAPIs-1.0 feature OL changes for CWTE"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3084, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}