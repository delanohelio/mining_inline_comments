{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNjAyMjE2", "number": 10716, "title": "Enable postgres and sqlserver tests where able", "bodyText": "All the Postgres tests work now, with the exception of one (DataSourceTest:testXARecovery), which Kyle will be fixing after I get this branch checked in.", "createdAt": "2020-02-04T01:27:24Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716", "merged": true, "mergeCommit": {"oid": "3283a68969054a9bcf29391101afe0ffe4d22287"}, "closed": true, "closedAt": "2020-02-04T17:41:13Z", "author": {"login": "gjwatts"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcA3c3BgFqTM1MjY3NzgyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBFIj8gBqjMwMDcwNTUyOTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjc3ODI5", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#pullrequestreview-352677829", "createdAt": "2020-02-04T01:39:58Z", "commit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTozOTo1OFrOFlFtTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTo0MTowNlrOFlFuig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTE1MQ==", "bodyText": "does name=\"*\" not work here?", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374435151", "createdAt": "2020-02-04T01:39:58Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/publish/servers/com.ibm.ws.jdbc.fat/server.xml", "diffHunk": "@@ -261,6 +261,10 @@\n \t<javaPermission className=\"java.lang.RuntimePermission\" name=\"accessDeclaredMembers\" />\n \t<!-- Postgres and SQLServer permission to make a basic query-->\n \t<javaPermission className=\"java.util.PropertyPermission\" name=\"*\" actions=\"read\"/>\n+\n+\t<!-- Postgres permission during commit cycle -->\n+\t<javaPermission className=\"org.osgi.framework.ServicePermission\" name=\"*\" actions=\"get\"/>\n+\t<javaPermission className=\"javax.security.auth.PrivateCredentialPermission\"  name='* * \"*\"' actions=\"read\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNTQ2Ng==", "bodyText": "We no longer test against Informix so this logic can be cut out.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#discussion_r374435466", "createdAt": "2020-02-04T01:41:06Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat/test-applications/basicfat/src/basicfat/DataSourceTestServlet.java", "diffHunk": "@@ -215,20 +215,36 @@\n      * Create the default table used by the tests.\n      */\n     private void createTable(DataSource ds) throws SQLException {\n-        Connection con = ds.getConnection();\n-        try {\n-            Statement st = con.createStatement();\n-            try {\n-                st.executeUpdate(\"drop table cities\");\n-            } catch (SQLException x) {\n+        try (Connection con = ds.getConnection()) {\n+            //See if cities table was already created\n+            DatabaseMetaData md = con.getMetaData();\n+            boolean tableFound = false;\n+            ResultSet rs = md.getTables(null, null, \"CITIES\", null); // Some DB providers require the table name in all upper case\n+            while (rs.next()) {\n+                if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                    tableFound = true;\n+                }\n+            }\n+\n+            if (!tableFound) {\n+                rs = md.getTables(null, null, \"cities\", null); // Other DB providers require the table name in all lower case\n+                while (rs.next()) {\n+                    if (rs.getString(\"TABLE_NAME\").equalsIgnoreCase(\"cities\")) {\n+                        tableFound = true;\n+                    }\n+                }\n+            }\n+\n+            try (Statement st = con.createStatement()) {\n+                if (tableFound) {\n+                    st.executeUpdate(\"drop table cities\");\n+                }\n+                String dbProductName = md.getDatabaseProductName().toUpperCase();\n+                if (dbProductName.contains(\"IDS\") || dbProductName.contains(\"INFORMIX\")) // Informix JCC and JDBC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDM4Nzg3", "url": "https://github.com/OpenLiberty/open-liberty/pull/10716#pullrequestreview-353038787", "createdAt": "2020-02-04T14:55:16Z", "commit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ff25073bb71d00e289fde0c1d9d7e6cd6342fc", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64ff25073bb71d00e289fde0c1d9d7e6cd6342fc", "committedDate": "2020-02-04T17:37:14Z", "message": "Enable some Postgres test buckets\n\nPostgres fails in testXARecovery()\n\nPostgres fails in testXARecovery()\n\nTwo stalled SQLServer issues, one Postgres issue\n\nPostgres testing update, Kyle will finish"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7d9afef829ee4c1cb0d9435f934c60abcc2cb2ec", "committedDate": "2020-02-04T01:21:26Z", "message": "Postgres testing update, Kyle will finish"}, "afterCommit": {"oid": "64ff25073bb71d00e289fde0c1d9d7e6cd6342fc", "author": {"user": {"login": "gjwatts", "name": "Greg Watts"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/64ff25073bb71d00e289fde0c1d9d7e6cd6342fc", "committedDate": "2020-02-04T17:37:14Z", "message": "Enable some Postgres test buckets\n\nPostgres fails in testXARecovery()\n\nPostgres fails in testXARecovery()\n\nTwo stalled SQLServer issues, one Postgres issue\n\nPostgres testing update, Kyle will finish"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3326, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}