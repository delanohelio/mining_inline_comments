{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzUzODcw", "number": 11665, "title": "EE9 Build & Test Fixes ", "bodyText": "Reorganized Servlet 4 test order.\n\n@server tests must occur after Shared Server Tests\n\nUpdated EL-4.0 to Handle Java 2 Security Privileges\nSkipping EE9 Run of WCSameSiteCookieAttributeTests\n\nTests need to check for a more messages in the logs.\ntestSameSiteConfig_Lax_WebAppSecurity_Strict needs to be skipped until appsecurity-3.0 is available.\n\nCorrect Feature File for JSP 2.2 & JSP 3.0", "createdAt": "2020-04-07T15:51:47Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665", "merged": true, "mergeCommit": {"oid": "24d06610fd441aaa162850e43ea9dc14979a6de0"}, "closed": true, "closedAt": "2020-04-07T21:16:10Z", "author": {"login": "volosied"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVWk_AABqjMyMTA4NTEyNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVZC4eAH2gAyNDAwMzUzODcwOjc2NDI1N2QxZmM2MmEyODVmOGEzMGMxMGU1NGIzYjMwMzNkZWNmYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee7cb200690858a5afe3601b6bb77b0acf4cb646", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ee7cb200690858a5afe3601b6bb77b0acf4cb646", "committedDate": "2020-04-07T16:56:17Z", "message": "Modify jakarta selection rules"}, "afterCommit": {"oid": "8f049821061ffefc81ea9cfec213995d44c2836b", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8f049821061ffefc81ea9cfec213995d44c2836b", "committedDate": "2020-04-07T17:16:39Z", "message": "Modify jakarta selection rules"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f049821061ffefc81ea9cfec213995d44c2836b", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8f049821061ffefc81ea9cfec213995d44c2836b", "committedDate": "2020-04-07T17:16:39Z", "message": "Modify jakarta selection rules"}, "afterCommit": {"oid": "ca782ebb8f39b632a32b915957f05260322c8be0", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ca782ebb8f39b632a32b915957f05260322c8be0", "committedDate": "2020-04-07T17:20:02Z", "message": "Update Transformer to 0.0.7\n\nModify jakarta selection rules"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca782ebb8f39b632a32b915957f05260322c8be0", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ca782ebb8f39b632a32b915957f05260322c8be0", "committedDate": "2020-04-07T17:20:02Z", "message": "Update Transformer to 0.0.7\n\nModify jakarta selection rules"}, "afterCommit": {"oid": "b8d0828573e78b89ffcd4045f7e4ffd4ecd1d9a8", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b8d0828573e78b89ffcd4045f7e4ffd4ecd1d9a8", "committedDate": "2020-04-07T17:39:26Z", "message": "Update Transformer to 0.0.7\n\nModify jakarta selection rules"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzUwMzkw", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665#pullrequestreview-389350390", "createdAt": "2020-04-07T17:46:22Z", "commit": {"oid": "ba1a7797f8fb75d9b7eff96eb23cba24af08de2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzo0NjoyMlrOGCPFVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzo0NjoyMlrOGCPFVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NzQ2Mw==", "bodyText": "Use IS_SECURITY_ENABLED in place of System.getSecurityManager() != null", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665#discussion_r404997463", "createdAt": "2020-04-07T17:46:22Z", "author": {"login": "pmd1nh"}, "path": "dev/com.ibm.websphere.jakartaee.el.4.0/src/jakarta/el/FactoryFinder.java", "diffHunk": "@@ -18,43 +18,96 @@\n \n package jakarta.el;\n \n-import static java.io.File.separator;\n-\n+import java.io.BufferedReader;\n import java.io.File;\n import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.UnsupportedEncodingException;\n import java.lang.reflect.Constructor;\n-import java.util.Iterator;\n import java.util.Properties;\n import java.util.ServiceLoader;\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n \n class FactoryFinder {\n \n+    private static final boolean IS_SECURITY_ENABLED = (System.getSecurityManager() != null);\n+\n+    private static final String SERVICE_RESOURCE_NAME = \"META-INF/services/jakarta.el.ExpressionFactory\";\n+\n+    private static final String PROPERTY_NAME = \"jakarta.el.ExpressionFactory\";\n+\n+    private static final String SEP;\n+    private static final String PROPERTY_FILE;\n+\n+    static {\n+        if (IS_SECURITY_ENABLED) {\n+            SEP = AccessController.doPrivileged(\n+                                                new PrivilegedAction<String>() {\n+                                                    @Override\n+                                                    public String run() {\n+                                                        return System.getProperty(\"file.separator\");\n+                                                    }\n+\n+                                                });\n+            PROPERTY_FILE = AccessController.doPrivileged(\n+                                                          new PrivilegedAction<String>() {\n+                                                              @Override\n+                                                              public String run() {\n+                                                                  return System.getProperty(\"java.home\") + SEP +\n+                                                                         \"lib\" + SEP + \"el.properties\";\n+                                                              }\n+\n+                                                          });\n+        } else {\n+            SEP = System.getProperty(\"file.separator\");\n+            PROPERTY_FILE = System.getProperty(\"java.home\") + SEP + \"lib\" +\n+                            SEP + \"el.properties\";\n+        }\n+    }\n+\n     /**\n      * Creates an instance of the specified class using the specified <code>ClassLoader</code> object.\n      *\n      * @exception ELException if the given class could not be found or could not be instantiated\n      */\n     private static Object newInstance(String className, ClassLoader classLoader, Properties properties) {\n         try {\n-            Class<?> spiClass;\n+            Class<?> instance;\n             if (classLoader == null) {\n-                spiClass = Class.forName(className);\n+                instance = Class.forName(className);\n             } else {\n-                spiClass = classLoader.loadClass(className);\n+                instance = classLoader.loadClass(className);\n             }\n \n             if (properties != null) {\n                 Constructor<?> constr = null;\n                 try {\n-                    constr = spiClass.getConstructor(Properties.class);\n+                    constr = instance.getConstructor(Properties.class);\n                 } catch (Exception ex) {\n                 }\n \n                 if (constr != null) {\n                     return constr.newInstance(properties);\n                 }\n             }\n-            return spiClass.getDeclaredConstructor().newInstance();\n+            if (System.getSecurityManager() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba1a7797f8fb75d9b7eff96eb23cba24af08de2a"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzUwOTgx", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665#pullrequestreview-389350981", "createdAt": "2020-04-07T17:47:10Z", "commit": {"oid": "ba1a7797f8fb75d9b7eff96eb23cba24af08de2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzo0NzoxMFrOGCPHRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzo0NzoxMFrOGCPHRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5Nzk1OA==", "bodyText": "if (IS_SECURITY_ENABLED)", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665#discussion_r404997958", "createdAt": "2020-04-07T17:47:10Z", "author": {"login": "pmd1nh"}, "path": "dev/com.ibm.websphere.jakartaee.el.4.0/src/jakarta/el/FactoryFinder.java", "diffHunk": "@@ -80,56 +133,130 @@ private static Object newInstance(String className, ClassLoader classLoader, Pro\n      * <code>null</code> to indicate that there is no fallback class name\n      * @exception ELException if there is an error\n      */\n-    static Object find(Class<?> serviceClass, String factoryId, String fallbackClassName, Properties properties) {\n+    static Object find(Class<?> serviceClass, Properties properties) {\n         ClassLoader classLoader;\n         try {\n-            classLoader = Thread.currentThread().getContextClassLoader();\n+            if (System.getSecurityManager() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba1a7797f8fb75d9b7eff96eb23cba24af08de2a"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzU3NjIx", "url": "https://github.com/OpenLiberty/open-liberty/pull/11665#pullrequestreview-389357621", "createdAt": "2020-04-07T17:55:48Z", "commit": {"oid": "b8d0828573e78b89ffcd4045f7e4ffd4ecd1d9a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f463546ba615bd5ab14cba4ccf9f3fac484830c", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8f463546ba615bd5ab14cba4ccf9f3fac484830c", "committedDate": "2020-04-07T19:37:29Z", "message": "Update Servlet 4 FAT for EE9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a81cade11985093ac736142c92a071a77bcd3c93", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/a81cade11985093ac736142c92a071a77bcd3c93", "committedDate": "2020-04-07T19:37:52Z", "message": "Fix Feature '-jar' in JSP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c99dade90a7d5e6fdbb7f2ffad4e3ab6414b6efe", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/c99dade90a7d5e6fdbb7f2ffad4e3ab6414b6efe", "committedDate": "2020-04-07T19:37:52Z", "message": "Update Transformer to 0.0.7\n\nModify jakarta selection rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "444d990926dc1ab22d3c692004740041d75d798f", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/444d990926dc1ab22d3c692004740041d75d798f", "committedDate": "2020-04-07T19:39:02Z", "message": "Update EL-4.0 FactoryFinder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8d0828573e78b89ffcd4045f7e4ffd4ecd1d9a8", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/b8d0828573e78b89ffcd4045f7e4ffd4ecd1d9a8", "committedDate": "2020-04-07T17:39:26Z", "message": "Update Transformer to 0.0.7\n\nModify jakarta selection rules"}, "afterCommit": {"oid": "444d990926dc1ab22d3c692004740041d75d798f", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/444d990926dc1ab22d3c692004740041d75d798f", "committedDate": "2020-04-07T19:39:02Z", "message": "Update EL-4.0 FactoryFinder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764257d1fc62a285f8a30c10e54b3b3033decfab", "author": {"user": {"login": "volosied", "name": "Volodymyr Siedlecki"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/764257d1fc62a285f8a30c10e54b3b3033decfab", "committedDate": "2020-04-07T20:09:16Z", "message": "Update to EL-4.0 RC1"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2778, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}