{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3Njk4MTYw", "number": 11602, "title": "Repeat the jsonp1.1_fat for jakarta ee9", "bodyText": "fixes #11278\n\n\nUpdate the JSONP 1.1 FAT to be repeatable for jakarta ee9.\n\n\nInvoke the jakartaee transformer with liberty-specific rules during repeatable ee9 test execution (ref: project fattest.simplicity.)\n\n\nRemove the dependency on class .servlet.http.HttpServlet from the @TestServlet annotation (ref: project fattest.simplicity.)", "createdAt": "2020-04-02T16:54:51Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602", "merged": true, "mergeCommit": {"oid": "23036c2b372fd011277c84e09fc606fddc01fbe6"}, "closed": true, "closedAt": "2020-04-04T17:11:23Z", "author": {"login": "dazavala"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTt0B0AH2gAyMzk3Njk4MTYwOjhjNTJiZmRhZTlmODlkZDU0N2Y5MmFhNzEwZWJlZDY0Njc1YWFkNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUBxS7gFqTM4NzMwNzY3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c52bfdae9f89dd547f92aa710ebed64675aad58", "author": {"user": {"login": "dazavala", "name": "Dave Zavala"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/8c52bfdae9f89dd547f92aa710ebed64675aad58", "committedDate": "2020-04-02T15:13:12Z", "message": "Repeat the jsonp1.1_fat for jakarta ee9"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjU0MzE5", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602#pullrequestreview-386654319", "createdAt": "2020-04-02T17:40:48Z", "commit": {"oid": "8c52bfdae9f89dd547f92aa710ebed64675aad58"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzo0MDo0OVrOF_2bhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzo0OTozNlrOF_2wIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NjM4OA==", "bodyText": "Lets remove the compile-time dependencies on servlet 3 and servlet 5, and instead just use reflection to load/test the classes in TestServletProcessor.java", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602#discussion_r402496388", "createdAt": "2020-04-02T17:40:49Z", "author": {"login": "aguibert"}, "path": "dev/fattest.simplicity/bnd.bnd", "diffHunk": "@@ -59,6 +59,7 @@ test.project: true\n \tcommons-httpclient:commons-httpclient;version=3.1,\\\n \tcom.ibm.websphere.javaee.jsonp.1.0;version=latest,\\\n \tcom.ibm.websphere.javaee.servlet.3.0;version=latest,\\\n+\tcom.ibm.websphere.jakartaee.servlet.5.0;version=latest,\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c52bfdae9f89dd547f92aa710ebed64675aad58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NzM4NA==", "bodyText": "Lets also include anno.toString() in this error message so that if a FAT has multiple @TestServlet annotations they can know which annotation had the bad servlet() value", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602#discussion_r402497384", "createdAt": "2020-04-02T17:42:27Z", "author": {"login": "aguibert"}, "path": "dev/fattest.simplicity/src/componenttest/annotation/processor/TestServletProcessor.java", "diffHunk": "@@ -98,6 +98,10 @@ private static String getQueryPath(TestServlet anno) {\n     }\n \n     private static Method[] getTestServletMethods(TestServlet anno) {\n+        if (!!!(javax.servlet.http.HttpServlet.class.isAssignableFrom(anno.servlet()) ||\n+                jakarta.servlet.http.HttpServlet.class.isAssignableFrom(anno.servlet()))) {\n+            throw new IllegalArgumentException(\"For the @TestServlet annotation, servlet() must be a subclass of javax.servlet.http.HttpServlet or jakarta.servlet.http.HttpServlet!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c52bfdae9f89dd547f92aa710ebed64675aad58"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUwMTY2NQ==", "bodyText": "I don't think this will work on remote builds because generally only artifacts within the autoFVT.zip are accessible to the test at runtime. There are also a few other special cases like build.image, fattest.simplicity, ant_build, and test_build projects, but wlp-jakartaee-transform is not one of them.\nTo work around this, try adding some code to fattest.simplicity/build.gradle that copies these transform rules into autoFVT-templates/ at build time (see the assembleBoostrap task as a similar example). This will result in the transform rules being included in the autoFVT.zip so you can find them under user.dir at bucket runtime without needing to walk up any directories into unknown territory.", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602#discussion_r402501665", "createdAt": "2020-04-02T17:49:36Z", "author": {"login": "aguibert"}, "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java", "diffHunk": "@@ -178,33 +178,45 @@ public static void transformApp(Path appPath) {\n         //create backup directory\n         Path serverPath = appPath.getParent().getParent();\n         Path backupPath = serverPath.resolve(\"backup\");\n-            try {\n-                if(!Files.exists(backupPath)){\n-                    Files.createDirectory(backupPath); // throws IOException\n-                }\n-             } catch(IOException e){\n-                 Log.info(c, m, \"Unable to create backup directory.\");\n-                 Log.error(c, m, e);\n-                 throw new RuntimeException(e);\n-             }\n+        try {\n+            if (!Files.exists(backupPath)) {\n+                Files.createDirectory(backupPath); // throws IOException\n+            }\n+        } catch (IOException e) {\n+            Log.info(c, m, \"Unable to create backup directory.\");\n+            Log.error(c, m, e);\n+            throw new RuntimeException(e);\n+        }\n+\n+        String userDir = System.getProperty(\"user.dir\");\n+        String transformerRulesRoot = userDir.substring(0, userDir.lastIndexOf(\"/dev/\")) + \"/dev/wlp-jakartaee-transform/rules/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c52bfdae9f89dd547f92aa710ebed64675aad58"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a72939d553f951d97817cfc9c2e422ca04e1610a", "author": {"user": {"login": "dazavala", "name": "Dave Zavala"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/a72939d553f951d97817cfc9c2e422ca04e1610a", "committedDate": "2020-04-03T04:24:40Z", "message": "Review updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzA3Njcx", "url": "https://github.com/OpenLiberty/open-liberty/pull/11602#pullrequestreview-387307671", "createdAt": "2020-04-03T14:28:19Z", "commit": {"oid": "a72939d553f951d97817cfc9c2e422ca04e1610a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2885, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}