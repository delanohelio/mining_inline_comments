{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNzY0NDk2", "number": 12357, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjoxNjoxMVrOD_emHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTo0Njo0M1rOEFl_qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODg4MTU3OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjoxNjoxMVrOGaKYkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjoxNjoxMVrOGaKYkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA4NjI4OQ==", "bodyText": "should start with the cheapest check... which is to see if appsWriteJson is true.  would also be better to put the content of the second if block inside the first if block since it only applies when the first if condition is true.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r430086289", "createdAt": "2020-05-25T22:16:11Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "diffHunk": "@@ -105,7 +108,16 @@ public void synchronousWrite(Object event) {\n \n             //First retrieve a cached JSON  message if possible, if not, format it and store it.\n             if (genData.getJsonMessage() == null) {\n-                genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                //check if it's in JSON format\n+                String json = null;\n+                if (event instanceof LogTraceData) {\n+                    json = ((LogTraceData) event).getMessage();\n+                }\n+                if (isJSON(json) && appsWriteJson) {\n+                    genData.setJsonMessage(json);\n+                } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbd56f60e0a1cbb5274fb15e522c130a3f701a35"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODg5NDkyOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging.osgi/resources/OSGI-INF/l10n/metatype.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjoyODowOVrOGaKgEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjoyODowOVrOGaKgEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA4ODIwOA==", "bodyText": "it's not just to System.out... could be System.err or could be messages.log.  will this also apply when someone logs (using JUL) a JSON message?\nperhaps something like...\nWhen message log or console is in JSON format, allow applications to write JSON-formatted messages to those destinations, without modification.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r430088208", "createdAt": "2020-05-25T22:28:09Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging.osgi/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -91,4 +91,7 @@ console.format.simple=Use the simple logging format.\n console.format.json=Use the JSON logging format.\n \n json.fields=JSON field names that are being replaced\n-json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n\\ No newline at end of file\n+json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n+\n+apps.write.json=Allow apps to write JSON\n+apps.write.json=When logs are in JSON format, if the log itself is pre-formatted in JSON, write the logs directly to System.out", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbd56f60e0a1cbb5274fb15e522c130a3f701a35"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODkwODEyOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/MessageLogHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjo0MDoyNVrOGaKnQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQyMjo0MDoyNVrOGaKnQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA5MDA1MA==", "bodyText": "see comments for ConsoleLogHandler", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r430090050", "createdAt": "2020-05-25T22:40:25Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/MessageLogHandler.java", "diffHunk": "@@ -63,7 +66,15 @@ public void synchronousWrite(Object event) {\n         String messageOutput = null;\n         if (currFormat.equals(LoggingConstants.JSON_FORMAT) || !eventSourceName.equals(CollectorConstants.MESSAGES_SOURCE)) {\n             if (genData.getJsonMessage() == null) {\n-                genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                String json = null;\n+                if (event instanceof LogTraceData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbd56f60e0a1cbb5274fb15e522c130a3f701a35"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTA2NDgxOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMToyMzowNFrOGaMCdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMTozMToyNlrOGaMIOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExMzM5Nw==", "bodyText": "maybe could refactor further...\n            String jsonMessage = null;\n            if (appsWriteJson && event instanceof LogTraceData) {\n                jsonMessage = ((LogTraceData) event).getMessage();\n                if (!isJSON(jsonMessage)) {\n                    jsonMessage = null;\n                }\n            }\n            \n            if (jsonMessage == null) {\n                jsonMessage = (String)formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH);\n            }\n            \n            genData.setJsonMessage(jsonMessage);", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r430113397", "createdAt": "2020-05-26T01:23:04Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "diffHunk": "@@ -105,7 +108,21 @@ public void synchronousWrite(Object event) {\n \n             //First retrieve a cached JSON  message if possible, if not, format it and store it.\n             if (genData.getJsonMessage() == null) {\n-                genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                //check if it's in JSON format\n+\n+                if (appsWriteJson) {\n+                    String json = null;\n+                    if (event instanceof LogTraceData) {\n+                        json = ((LogTraceData) event).getMessage();\n+                    }\n+                    if (isJSON(json)) {\n+                        genData.setJsonMessage(json);\n+                    } else {\n+                        genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                    }\n+                } else {\n+                    genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36356bd76ee7a3c2a3fec126ee5a7c86cf34af13"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNDg3NA==", "bodyText": "oh, even more...\n        String jsonMessage = null;\n        if (appsWriteJson && event instanceof LogTraceData)\n            jsonMessage = ((LogTraceData) event).getMessage();\n\n        if (!isJSON(jsonMessage))\n            jsonMessage = (String)formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH);\n        \n        genData.setJsonMessage(jsonMessage);", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r430114874", "createdAt": "2020-05-26T01:31:26Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "diffHunk": "@@ -105,7 +108,21 @@ public void synchronousWrite(Object event) {\n \n             //First retrieve a cached JSON  message if possible, if not, format it and store it.\n             if (genData.getJsonMessage() == null) {\n-                genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                //check if it's in JSON format\n+\n+                if (appsWriteJson) {\n+                    String json = null;\n+                    if (event instanceof LogTraceData) {\n+                        json = ((LogTraceData) event).getMessage();\n+                    }\n+                    if (isJSON(json)) {\n+                        genData.setJsonMessage(json);\n+                    } else {\n+                        genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                    }\n+                } else {\n+                    genData.setJsonMessage((String) formatEvent(eventSourceName, CollectorConstants.MEMORY, event, null, MAXFIELDLENGTH));\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExMzM5Nw=="}, "originalCommit": {"oid": "36356bd76ee7a3c2a3fec126ee5a7c86cf34af13"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjE3ODkwOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging.osgi/resources/OSGI-INF/l10n/metatype.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDowNFrOGbSi6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDowNFrOGbSi6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODU4Ng==", "bodyText": "When message log or console log is in JSON format,\nshould this be\nWhen message log or console log is in JSON format,", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r431268586", "createdAt": "2020-05-27T16:14:04Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.logging.osgi/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -91,4 +91,7 @@ console.format.simple=Use the simple logging format.\n console.format.json=Use the JSON logging format.\n \n json.fields=JSON field names that are being replaced\n-json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n\\ No newline at end of file\n+json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n+\n+apps.write.json=Allow apps to write JSON\n+apps.write.json=When message log or console is in JSON format, allow applications to write JSON-formatted messages to those destinations, without modification.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec6a5cf76d295b9f83753255f8775b8cf90f5e2"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjE4MDI5OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/resources/OSGI-INF/l10n/metatype.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDozMFrOGbSj9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDozMFrOGbSj9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODg1NA==", "bodyText": "When message log or console log is in JSON format,\nshould this be\nWhen message log or console log is in JSON format,", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r431268854", "createdAt": "2020-05-27T16:14:30Z", "author": {"login": "dmuelle"}, "path": "dev/com.ibm.ws.logging/resources/OSGI-INF/l10n/metatype.properties", "diffHunk": "@@ -91,4 +91,7 @@ console.format.simple=Use the simple logging format.\n console.format.json=Use the JSON logging format.\n \n json.fields=JSON field names that are being replaced\n-json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n\\ No newline at end of file\n+json.fields.desc=When logs are in JSON format, use this attribute to replace default field names with new field names or to omit fields from the logs. To replace a field name, configure the new field name by using the following format: defaultFieldName:newFieldName?. For field names that are associated with logs of a specified source, use the following format: [source:]?defaultFieldName:newFieldName?, where [source] is the source you want to specify, such as message, trace, or accessLog. To omit a field from the logs, specify the field name without a replacement, as shown in the following example: defaultFieldName:. To rename or omit multiple fields, specify a comma-separated list of field name mappings.\n+\n+apps.write.json=Allow apps to write JSON\n+apps.write.json=When message log or console is in JSON format, allow applications to write JSON-formatted messages to those destinations, without modification.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec6a5cf76d295b9f83753255f8775b8cf90f5e2"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTcxNjM0OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NDowOVrOGizrgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NDowOVrOGizrgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MTQ4OQ==", "bodyText": "add a comment above this to say what this is for", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r439151489", "createdAt": "2020-06-12T00:54:09Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "diffHunk": "@@ -132,6 +132,8 @@\n     /** The wlp user dir name. */\n     private final String wlpUsrDir;\n \n+    protected volatile boolean appsWriteJson = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e751ce8ac0b5fade6da804578fb060afadde722"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTcxNzEzOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NDo0M1rOGizsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NDo0M1rOGizsCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MTYyNA==", "bodyText": "add blank line above (just to keep consistent with rest of spacing in the method)", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r439151624", "createdAt": "2020-06-12T00:54:43Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "diffHunk": "@@ -171,6 +173,8 @@ public LogProviderConfigImpl(Map<String, String> config, File logLocation, TextF\n \n         consoleLogLevel = LoggingConfigUtils.getLogLevel(LoggingConfigUtils.getEnvValue(LoggingConstants.ENV_WLP_LOGGING_CONSOLE_LOGLEVEL),\n                                                          consoleLogLevel);\n+        appsWriteJson = LoggingConfigUtils.getBooleanValue(LoggingConfigUtils.getEnvValue(LoggingConstants.ENV_WLP_LOGGING_APPS_WRITE_JSON),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e751ce8ac0b5fade6da804578fb060afadde722"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTcxOTE3OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NTo1NVrOGiztTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDo1NTo1NVrOGiztTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MTk0OQ==", "bodyText": "remove empty javadoc", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r439151949", "createdAt": "2020-06-12T00:55:55Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/LogProviderConfigImpl.java", "diffHunk": "@@ -425,6 +430,13 @@ public boolean getNewLogsOnStart() {\n         return newLogsOnStart;\n     }\n \n+    /**\n+     * @return\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e751ce8ac0b5fade6da804578fb060afadde722"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTczNzc1OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigBootstrapTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowNzozNlrOGiz4kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowNzozNlrOGiz4kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1NDgzNA==", "bodyText": "comment doesn't match code", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r439154834", "createdAt": "2020-06-12T01:07:36Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigBootstrapTest.java", "diffHunk": "@@ -281,6 +286,60 @@ public void testMaxFileSizeLevelInPropertiesXML() throws Exception {\n         }\n     }\n \n+    /*\n+     * Test enabling com.ibm.ws.logging.apps.write.json in bootstrap.properties\n+     */\n+    @Test\n+    public void testEnableAppsWriteJsonInProperties() throws Exception {\n+\n+        // Get the bootstrap.properties file and store the original content\n+        RemoteFile bootstrapFile = server.getServerBootstrapPropertiesFile();\n+        FileInputStream in = getFileInputStreamForRemoteFile(bootstrapFile);\n+        Properties initialBootstrapProps = loadProperties(in);\n+\n+        try {\n+            // Set maxFileSize to 100 in bootstrap.properties", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e751ce8ac0b5fade6da804578fb060afadde722"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTczNzg5OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigBootstrapTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowNzo0MVrOGiz4pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowNzo0MVrOGiz4pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1NDg1NQ==", "bodyText": "comment doesn't match code", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r439154855", "createdAt": "2020-06-12T01:07:41Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigBootstrapTest.java", "diffHunk": "@@ -281,6 +286,60 @@ public void testMaxFileSizeLevelInPropertiesXML() throws Exception {\n         }\n     }\n \n+    /*\n+     * Test enabling com.ibm.ws.logging.apps.write.json in bootstrap.properties\n+     */\n+    @Test\n+    public void testEnableAppsWriteJsonInProperties() throws Exception {\n+\n+        // Get the bootstrap.properties file and store the original content\n+        RemoteFile bootstrapFile = server.getServerBootstrapPropertiesFile();\n+        FileInputStream in = getFileInputStreamForRemoteFile(bootstrapFile);\n+        Properties initialBootstrapProps = loadProperties(in);\n+\n+        try {\n+            // Set maxFileSize to 100 in bootstrap.properties\n+            setInBootstrapPropertiesFile(bootstrapFile, \"com.ibm.ws.logging.apps.write.json\", \"true\");\n+            server.startServer();\n+            // Set maxFileSize to 1 in server.xml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e751ce8ac0b5fade6da804578fb060afadde722"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjgwMzU4OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/JsonLogHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo1OTowOFrOGj2EVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDo1OTowOFrOGj2EVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIzOTE4OQ==", "bodyText": "this should be a static method", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r440239189", "createdAt": "2020-06-15T14:59:08Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/JsonLogHandler.java", "diffHunk": "@@ -230,4 +230,9 @@ protected String getSourceNameFromDataObject(Object event) {\n         }\n     }\n \n+    protected boolean isJSON(String message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36cc28ebb64b0d298cc3da73afef4f8a9850edff"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjgxMDg5OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTowMDo1MFrOGj2JAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTowMDo1MFrOGj2JAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI0MDM4NQ==", "bodyText": "should this method be moved to JsonLogHandler?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r440240385", "createdAt": "2020-06-15T15:00:50Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "diffHunk": "@@ -234,6 +246,15 @@ public void setFormat(String format) {\n         this.format = format;\n     }\n \n+    /**\n+     * Set apps that write json to wrap or unwrap\n+     *\n+     * @param format the format to set (i.e. wrap, unwrap)\n+     */\n+    public void setAppsWriteJson(boolean appsWriteJson) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36cc28ebb64b0d298cc3da73afef4f8a9850edff"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjgxMzMzOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTowMToyMlrOGj2Kgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTowMToyMlrOGj2Kgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI0MDc3MQ==", "bodyText": "should this be moved to JsonLogHandler?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r440240771", "createdAt": "2020-06-15T15:01:22Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/internal/impl/ConsoleLogHandler.java", "diffHunk": "@@ -39,6 +39,8 @@\n \n     private BaseTraceService baseTraceService = null;\n \n+    private boolean appsWriteJson = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36cc28ebb64b0d298cc3da73afef4f8a9850edff"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzAwODQxOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/collector/JSONObject.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTo0Njo0M1rOGj4GVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNTo0Njo0M1rOGj4GVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MjQ3MQ==", "bodyText": "was this file added by accident?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12357#discussion_r440272471", "createdAt": "2020-06-15T15:46:43Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/collector/JSONObject.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.logging.collector;\n+\n+/**\n+ *\n+ */\n+public class JSONObject {\n+    private final boolean hasAnyFields = false;\n+    private final StringBuilder JSONBuilder = new StringBuilder();\n+\n+    // s - name:value, name:value, ...\n+//    public JSONObject() {\n+//\n+//    }\n+\n+    /**\n+     * Constructor for JSONObject\n+     * Initialize hasAnyFields to false\n+     * Initialize StringBuilder\n+     *\n+     */\n+\n+//    public void addField(String s) {\n+//        if (s == null) {\n+//            return;\n+//        }\n+//        setHasAnyFields();\n+//\n+//        //add the field to the JSON\n+//\n+//    }\n+//\n+//    //\n+//    public void addField(String name, String value, boolean jsonEscapeValue, boolean trim) {\n+//        if (name == null || value == null) {\n+//            return;\n+//        }\n+//        setHasAnyFields();\n+//    }\n+//\n+//    public void addField(String name, int value) {\n+//        if (name == null || value == null) {\n+//            return;\n+//        }\n+//        setHasAnyFields();\n+//        return;\n+//    }\n+//\n+//    public boolean addField(String name, boolean value) {\n+//        if (name == null || value == null) {\n+//            return;\n+//        }\n+//        setHasAnyFields();\n+//        return true;\n+//\n+//    }\n+//\n+//    public void addField(String name, long value) {\n+//        if (name == null || value == null) {\n+//            return;\n+//        }\n+//        setHasAnyFields();\n+//        return true;\n+//\n+//    }\n+//\n+//    //get current JSON log string\n+//    public StringBuilder getJSONString() {\n+//        return JSONBuilder;\n+//    }\n+//\n+//    private void setHasAnyFields() {\n+//        if (hasAnyFields) {\n+//            JSONBuilder.append(\",\");\n+//            hasAnyFields = true;\n+//        } else {\n+//            hasAnyFields = true;\n+//        }\n+//\n+//    }\n+\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "688cd38d242b3cc4beab4a0a81b8530ab45adb3e"}, "originalPosition": 91}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1685, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}