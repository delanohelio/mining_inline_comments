{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MzEzNTc1", "number": 12719, "title": "Issue 12628: Clone keystore on write for WSKeyStore", "bodyText": "Fixes #12628\nClone the keystore on writes (store) so we can avoid changing the keystore at the same time a client is using it. It is cheaper to clone on write than clone on read.", "createdAt": "2020-06-19T22:10:00Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719", "merged": true, "mergeCommit": {"oid": "272e35679d9315228417c414d81f23eec8b86d5f"}, "closed": true, "closedAt": "2020-06-29T13:41:07Z", "author": {"login": "kristip17"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcty57YABqjM0NjkwNDczOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct2rWjAFqTQzNTI0MDU3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffcf4725889552b2ecf300fd7a64ba7657e38fce", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/ffcf4725889552b2ecf300fd7a64ba7657e38fce", "committedDate": "2020-06-19T22:09:15Z", "message": "Issue 12628: Clone keystore on write for WSKeyStore"}, "afterCommit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/736e577e036f10dbb721d20263d5140e627a5864", "committedDate": "2020-06-22T15:43:12Z", "message": "Issue 12628: Clone keystore on write for WSKeyStore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjI3MTc2", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#pullrequestreview-435227176", "createdAt": "2020-06-22T19:53:35Z", "commit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOTo1MzozNVrOGnOxig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOTo1NDoyMFrOGnOy8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4OTcwNg==", "bodyText": "Can't we do this in store(...) instead?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443789706", "createdAt": "2020-06-22T19:53:35Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1322,7 +1367,8 @@ public void setCertificateEntry(String alias, Certificate cert) throws KeyStoreE\n             jKeyStore.setCertificateEntry(alias, cert);\n \n             try {\n-                store();\n+                store(jKeyStore);\n+                myKeyStore = jKeyStore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc4OTc2OQ==", "bodyText": "Can't we do this in store(...) instead?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443789769", "createdAt": "2020-06-22T19:53:44Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1415,13 +1464,16 @@ public void setKeyEntry(String alias, Key key, Certificate[] chain) throws KeySt\n \n             // store the key... errors are thrown if conflicts or errors occur\n             jKeyStore.setKeyEntry(alias, key, decodedPassword.toCharArray(), chain);\n-            store();\n+            store(jKeyStore);\n+            myKeyStore = jKeyStore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MDA2Nw==", "bodyText": "See other findings about setting the keystore in this method. Only need to do it if we sent in the clonedKeyStore. Should do it after we know the store to the file has succeeded.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#discussion_r443790067", "createdAt": "2020-06-22T19:54:20Z", "author": {"login": "jvanhill"}, "path": "dev/com.ibm.ws.ssl/src/com/ibm/ws/ssl/config/WSKeyStore.java", "diffHunk": "@@ -1045,7 +1089,7 @@ public void store() throws Exception {\n             boolean fileBased = Boolean.parseBoolean(getProperty(Constants.SSLPROP_KEY_STORE_FILE_BASED));\n             String SSLKeyStoreStash = getProperty(Constants.SSLPROP_KEY_STORE_CREATE_CMS_STASH);\n \n-            KeyStore ks = getKeyStore(false, false);\n+            KeyStore ks = clonedKeyStore == null ? getKeyStore(false, false) : clonedKeyStore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6549fb9494daed152cfa4c3925a958b499f5fa0b", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6549fb9494daed152cfa4c3925a958b499f5fa0b", "committedDate": "2020-06-22T20:09:05Z", "message": "Issue 12628: Clone keystore on write for WSKeyStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "736e577e036f10dbb721d20263d5140e627a5864", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/736e577e036f10dbb721d20263d5140e627a5864", "committedDate": "2020-06-22T15:43:12Z", "message": "Issue 12628: Clone keystore on write for WSKeyStore"}, "afterCommit": {"oid": "6549fb9494daed152cfa4c3925a958b499f5fa0b", "author": {"user": {"login": "kristip17", "name": "Kristi Peterson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6549fb9494daed152cfa4c3925a958b499f5fa0b", "committedDate": "2020-06-22T20:09:05Z", "message": "Issue 12628: Clone keystore on write for WSKeyStore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjQwNTc5", "url": "https://github.com/OpenLiberty/open-liberty/pull/12719#pullrequestreview-435240579", "createdAt": "2020-06-22T20:14:54Z", "commit": {"oid": "6549fb9494daed152cfa4c3925a958b499f5fa0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2290, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}