{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MjE1NDY1", "number": 12716, "title": "Issue #12397: Fix warnings in server package", "bodyText": "", "createdAt": "2020-06-19T17:15:56Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716", "merged": true, "mergeCommit": {"oid": "9399270f41cbaa9a149bf5684b0e79da764badd9"}, "closed": true, "closedAt": "2020-06-25T20:27:46Z", "author": {"login": "hlhoots"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcs3D3WgFqTQzNDI1Nzc0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuz_VUAFqTQzNzgwMzA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjU3NzQ2", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#pullrequestreview-434257746", "createdAt": "2020-06-19T18:03:56Z", "commit": {"oid": "0b97fef4a0b5b0f96509385955103ad5c4d4ddab"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODowMzo1NlrOGmdP3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODowNzoxMVrOGmdU6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3ODI3MQ==", "bodyText": "Is JAVA_AGENT really needed here? I would think that would only be necessary for a server", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#discussion_r442978271", "createdAt": "2020-06-19T18:03:56Z", "author": {"login": "brenthdaniel"}, "path": "dev/com.ibm.ws.kernel.boot.ws-server/publish/bin/server.bat", "diffHunk": "@@ -341,15 +341,17 @@ goto:eof\n goto:eof\n \n :package\n-  call:serverEnv\n+  call:serverEnvAndJVMOptions\n+  if not %RC% == 0 goto:eof\n   call:serverExists true\n   if %RC% == 2 goto:eof\n \n-  !JAVA_CMD_QUOTED! !JAVA_PARAMS_QUOTED! --batch-file=--package !PARAMS_QUOTED!\n+  !JAVA_CMD_QUOTED! !JAVA_AGENT_QUOTED! !JVM_OPTIONS! !JAVA_PARAMS_QUOTED! --batch-file=--package !PARAMS_QUOTED!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b97fef4a0b5b0f96509385955103ad5c4d4ddab"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3OTU2Mg==", "bodyText": "You might want to check for null here.. java.specification.version should always be there, but probably best to be safe", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#discussion_r442979562", "createdAt": "2020-06-19T18:07:11Z", "author": {"login": "brenthdaniel"}, "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/boot/internal/commands/PackageProcessor.java", "diffHunk": "@@ -170,6 +172,14 @@ protected File buildManifestForIncludeHasRunnable(File installationManifest) thr\n         mf.getMainAttributes().putValue(\"Main-Class\", \"wlp.lib.extract.SelfExtractRun\");\n         mf.getMainAttributes().putValue(\"Server-Name\", processName);\n \n+        // For Java 9, we need to apply the /wlp/lib/platform/java/java9.options to the manifest.\n+        if (!System.getProperty(\"java.specification.version\").startsWith(\"1.\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b97fef4a0b5b0f96509385955103ad5c4d4ddab"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b97fef4a0b5b0f96509385955103ad5c4d4ddab", "author": {"user": {"login": "hlhoots", "name": "Harry L. Hoots, III"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/0b97fef4a0b5b0f96509385955103ad5c4d4ddab", "committedDate": "2020-06-19T17:02:48Z", "message": "Issue #12397: Fix warnings in server package"}, "afterCommit": {"oid": "6fdef068be41b6c2ec10e3ced159fef35cdea312", "author": {"user": {"login": "hlhoots", "name": "Harry L. Hoots, III"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6fdef068be41b6c2ec10e3ced159fef35cdea312", "committedDate": "2020-06-19T18:50:57Z", "message": "Issue #12397: Fix warnings in server package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce", "author": {"user": {"login": "hlhoots", "name": "Harry L. Hoots, III"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/50eb6d68e972c039b61e9bbe19d30b4b329826ce", "committedDate": "2020-06-22T17:58:30Z", "message": "Issue #12397: Fix warnings in server package"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fdef068be41b6c2ec10e3ced159fef35cdea312", "author": {"user": {"login": "hlhoots", "name": "Harry L. Hoots, III"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/6fdef068be41b6c2ec10e3ced159fef35cdea312", "committedDate": "2020-06-19T18:50:57Z", "message": "Issue #12397: Fix warnings in server package"}, "afterCommit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce", "author": {"user": {"login": "hlhoots", "name": "Harry L. Hoots, III"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/50eb6d68e972c039b61e9bbe19d30b4b329826ce", "committedDate": "2020-06-22T17:58:30Z", "message": "Issue #12397: Fix warnings in server package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzgxMDYy", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#pullrequestreview-437781062", "createdAt": "2020-06-25T19:07:27Z", "commit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToyMDozMlrOGpIlMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToyMDozMlrOGpIlMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc4NTM5NA==", "bodyText": "the args in java9.options are things we need to run all features available in liberty, but it is likely that the SelfExractRun just needs a subset of these because all it's doing is launching a separate JVM to do the extract and then it exits (I think).\nSo instead of copying things over from java9.options to the manifest at runtime, can we just add the flags necessary to do a clean SelfExtract to the jar's manifest directly?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#discussion_r445785394", "createdAt": "2020-06-25T19:20:32Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/boot/internal/commands/PackageProcessor.java", "diffHunk": "@@ -170,6 +172,13 @@ protected File buildManifestForIncludeHasRunnable(File installationManifest) thr\n         mf.getMainAttributes().putValue(\"Main-Class\", \"wlp.lib.extract.SelfExtractRun\");\n         mf.getMainAttributes().putValue(\"Server-Name\", processName);\n \n+        // For Java 9, we need to apply the /wlp/lib/platform/java/java9.options to the manifest.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODAzMDYz", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#pullrequestreview-437803063", "createdAt": "2020-06-25T19:40:52Z", "commit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTo0MDo1MlrOGpJMgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTo0MDo1MlrOGpJMgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc5NTQ1Ng==", "bodyText": "Perhaps we should make this a bit more tolerant and just log a warning if the java9.options cannot be found/read? Would be bad if server start blew up on something that was just trying to avoid a warning message.", "url": "https://github.com/OpenLiberty/open-liberty/pull/12716#discussion_r445795456", "createdAt": "2020-06-25T19:40:52Z", "author": {"login": "aguibert"}, "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/boot/internal/commands/PackageProcessor.java", "diffHunk": "@@ -788,4 +797,39 @@ private boolean java2SecurityEnabled() {\n     private boolean isArchiveJar() {\n         return packageFile.getName().endsWith(\".jar\");\n     }\n+\n+    // Reads the java9.options file\n+    private HashMap<String, String> readJava9Options() throws IOException {\n+        HashMap<String, String> hm = new HashMap<String, String>();\n+        StringBuffer exports = new StringBuffer();\n+        StringBuffer opens = new StringBuffer();\n+        BufferedReader r = new BufferedReader(new FileReader(installRoot.getAbsolutePath() + File.separator + \"lib\" + File.separator + \"platform\" + File.separator + \"java\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50eb6d68e972c039b61e9bbe19d30b4b329826ce"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2286, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}