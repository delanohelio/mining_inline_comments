{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTMwNTk4", "number": 12893, "title": "Change logging.json_fat tests to check trace for server config update \u2026", "bodyText": "fixes: #12674\n#build\nThe logging.json_fat suite was taking a long time because there were specific test cases that were timing out in JSONConfigTest.java and JsonConfigBootstrapTest.java.\nThe first type of time out is during the setServerConfig() function in both files. After updating the server.xml, the server checks for the CWWKG0017I.*|CWWKG0018I.* regex in the messages.log by default, but this message doesn't exist in some of the test cases because their server.xml configurations have messageFormat=\"json\" while excluding the message log type from messageSource. The setServerConfig() function has been changed to use the trace.log to check for the regex, and an assert has been added to fail the test instead of allowing a timeout.\nThe second type of timeout occurs during server shut down when the server attempts to find the CWWKE0036I string in the console log. This message doesn't exist because of either: 1) the test case's server.xml configuration has consoleFormat=\"json\" while excluding the message log type from consoleSource, or 2) the server.xml configuration has consoleLogLevel=\"ERROR\". Those specific tests have the server.xml reset to a basic server.xml configuration (that will generate the message in the console log) at the end of the test case, before the server shuts down.\nThis should cut down the LITE speed of the logging.json_fat suite from over 34 minutes to under 5 minutes.", "createdAt": "2020-07-06T18:17:41Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893", "merged": true, "mergeCommit": {"oid": "91c0deafabf7d857ab47fd2aba04620dc729fe44"}, "closed": true, "closedAt": "2020-07-16T02:17:37Z", "author": {"login": "ellen-lau"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyVXSIAH2gAyNDQ0OTMwNTk4OmYzNjIzMTI5YjA5MTkzOTdmMTNjNmQ1NGY1M2E0NzU3OTk5ZDQyYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1UfoPgFqTQ0OTQzNzUyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3623129b0919397f13c6d54f53a4757999d42be", "author": {"user": {"login": "ellen-lau", "name": null}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f3623129b0919397f13c6d54f53a4757999d42be", "committedDate": "2020-07-06T18:15:44Z", "message": "Change logging.json_fat tests to check trace fo server config update complete message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca", "author": {"user": {"login": "ellen-lau", "name": null}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca", "committedDate": "2020-07-07T18:20:13Z", "message": "Reset server.xml in tests to default console log settings to check console log when server stops"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc4NzU1", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#pullrequestreview-449178755", "createdAt": "2020-07-15T17:28:40Z", "commit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyODo0MFrOGyIJ5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyODo0MFrOGyIJ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTU4OA==", "bodyText": "Is trace enabled when this method is called?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#discussion_r455215588", "createdAt": "2020-07-15T17:28:40Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigBootstrapTest.java", "diffHunk": "@@ -496,10 +503,11 @@ private void runApplication(RemoteFile consoleLogFile) throws Exception {\n         TestUtils.runApp(server, \"logServlet\");\n     }\n \n-    private static String setServerConfig(String fileName) throws Exception {\n-        server.setMarkToEndOfLog();\n+    private static void setServerConfig(String fileName) throws Exception {\n+        RemoteFile log = server.getDefaultTraceFile();\n+        server.setMarkToEndOfLog(log);\n         server.setServerConfigurationFile(fileName);\n-        return server.waitForStringInLogUsingMark(\"CWWKG0017I.*|CWWKG0018I.*\");\n+        Assert.assertNotNull(server.waitForStringInLog(\"CWWKG0017I.*|CWWKG0018I.*\", log));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc5MTU1", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#pullrequestreview-449179155", "createdAt": "2020-07-15T17:29:07Z", "commit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyOTowN1rOGyIL2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyOTowN1rOGyIL2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNjA5MQ==", "bodyText": "Is trace enabled when this method is called?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#discussion_r455216091", "createdAt": "2020-07-15T17:29:07Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.ws.logging.json_fat/fat/src/com/ibm/ws/logging/json/fat/JsonConfigTest.java", "diffHunk": "@@ -356,10 +356,12 @@ private void runApplication(RemoteFile consoleLogFile) throws Exception {\n         TestUtils.runApp(server, \"logServlet\");\n     }\n \n-    private static String setServerConfig(String fileName) throws Exception {\n-        server.setMarkToEndOfLog();\n+    //check message.log for CWWKG0017I.*|CWWKG0018I. message, messageSource must have \"message\"\n+    private static void setServerConfig(String fileName) throws Exception {\n+        RemoteFile log = server.getDefaultTraceFile();\n+        server.setMarkToEndOfLog(log);\n         server.setServerConfigurationFile(fileName);\n-        return server.waitForStringInLogUsingMark(\"CWWKG0017I.*|CWWKG0018I.*\");\n+        Assert.assertNotNull(server.waitForStringInLog(\"CWWKG0017I.*|CWWKG0018I.*\", log));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc5Njc3", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#pullrequestreview-449179677", "createdAt": "2020-07-15T17:29:45Z", "commit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDM3NTI4", "url": "https://github.com/OpenLiberty/open-liberty/pull/12893#pullrequestreview-449437528", "createdAt": "2020-07-16T00:56:43Z", "commit": {"oid": "82fd19d6f8bca81dcd915cc05b9888f8a33cd7ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2234, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}