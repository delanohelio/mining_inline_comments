{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NDA2MjE4", "number": 10854, "title": "Make updating JSON extension aliases threadsafe", "bodyText": "Fixes #10707", "createdAt": "2020-02-12T16:32:02Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854", "merged": true, "mergeCommit": {"oid": "7f259de058289f9c3c912bf422fc3b76a76b274e"}, "closed": true, "closedAt": "2020-03-09T14:47:35Z", "author": {"login": "Yushan-Lin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcILcz1AFqTM2NTE1ODAzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLCjsngH2gAyMzc0NDA2MjE4OjVkYzhkZDE1NzVjNDg3MTMyZWU5MzVkNGFjMTg4MDZkMmM4NWY2NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTU4MDMx", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#pullrequestreview-365158031", "createdAt": "2020-02-26T18:57:48Z", "commit": {"oid": "f031c361c3b36fffeda18bb174c544c058fed01b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo1Nzo0OFrOFu4B8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo1Nzo0OFrOFu4B8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NjgxOQ==", "bodyText": "This won't fix the issue... LogTraceData has unsynchronized access to originalExtensions / aliasesExtensions.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r384696819", "createdAt": "2020-02-26T18:57:48Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/NameAliases.java", "diffHunk": "@@ -23,11 +23,13 @@\n     public NameAliases(String[] originalNames) {\n         this.originalNames = originalNames;\n         this.aliases = originalNames.clone();\n-        this.originalExtensions = new ArrayList<>();\n-        this.aliasesExtensions = new ArrayList<>();\n+        synchronized (this) {\n+            this.originalExtensions = new ArrayList<>();\n+            this.aliasesExtensions = new ArrayList<>();\n+        }\n     }\n \n-    public void newAliases(Map<String, String> newAliases) {\n+    public synchronized void newAliases(Map<String, String> newAliases) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f031c361c3b36fffeda18bb174c544c058fed01b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "committedDate": "2020-02-26T22:13:28Z", "message": "Change JSON alias extensions to class for consistency when updating jsonFieldMappings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f031c361c3b36fffeda18bb174c544c058fed01b", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f031c361c3b36fffeda18bb174c544c058fed01b", "committedDate": "2020-02-12T16:30:42Z", "message": "make updating extension aliases threadsafe"}, "afterCommit": {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/62f2040c93e62a4b46bd9612f6ca20e25a91f8c3", "committedDate": "2020-02-26T22:13:28Z", "message": "Change JSON alias extensions to class for consistency when updating jsonFieldMappings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODg1NDk3", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#pullrequestreview-365885497", "createdAt": "2020-02-27T18:12:06Z", "commit": {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoxMjowN1rOFvbzqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoxOTozN1rOFvcCqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4Mjk4NA==", "bodyText": "this should probably be a static inner class inside NameAliases since NameAliases is the only class that uses it.", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r385282984", "createdAt": "2020-02-27T18:12:07Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/ExtensionAliases.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.logging.data;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ *\n+ */\n+public class ExtensionAliases {\n+    public ArrayList<String> originalExtensions;\n+    public ArrayList<String> aliasesExtensions;\n+\n+    public ExtensionAliases() {\n+        this.originalExtensions = new ArrayList<String>();\n+        this.aliasesExtensions = new ArrayList<String>();\n+    }\n+\n+    public void addExtensionAlias(String originalName, String alias) {\n+        originalExtensions.add(originalName);\n+        aliasesExtensions.add(alias);\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4NjgyNg==", "bodyText": "should add a method to ExtensionAliases to get an alias rather than iterating here... eg. getAlias(String original)", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r385286826", "createdAt": "2020-02-27T18:19:37Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/LogTraceData.java", "diffHunk": "@@ -698,20 +698,17 @@ public static String getTypeKeyJSON(boolean isMessageEvent) {\n     }\n \n     public static String getExtensionNameKeyJSON(boolean isMessageEvent, String extKey) {\n-        ArrayList<String> tempExt = null;\n-        ArrayList<String> aliasesExt = null;\n+        ExtensionAliases tempExt = null;\n         if (isMessageEvent) {\n-            tempExt = jsonLoggingNameAliasesMessages.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesMessages.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesMessages.extensionAliases;\n \n         } else {\n-            tempExt = jsonLoggingNameAliasesTrace.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesTrace.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesTrace.extensionAliases;\n \n         }\n-        for (int i = 0; i < tempExt.size(); i++) {\n-            if (tempExt.get(i).equals(extKey)) {\n-                return aliasesExt.get(i);\n+        for (int i = 0; i < tempExt.originalExtensions.size(); i++) {\n+            if (tempExt.originalExtensions.get(i).equals(extKey)) {\n+                return tempExt.aliasesExtensions.get(i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62f2040c93e62a4b46bd9612f6ca20e25a91f8c3"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990aadde1ab75688fa8f61f2a197da111c65b49a", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/990aadde1ab75688fa8f61f2a197da111c65b49a", "committedDate": "2020-02-27T18:50:47Z", "message": "Make ExtensionAliases an inner class of NameAliases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODc2ODU2", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#pullrequestreview-368876856", "createdAt": "2020-03-04T15:30:08Z", "commit": {"oid": "990aadde1ab75688fa8f61f2a197da111c65b49a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNTozMDowOFrOFxx72A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNTozMDowOFrOFxx72A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc0MjY4MA==", "bodyText": "please clean up vertical spacing in this method", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#discussion_r387742680", "createdAt": "2020-03-04T15:30:08Z", "author": {"login": "donbourne"}, "path": "dev/com.ibm.ws.logging/src/com/ibm/ws/logging/data/LogTraceData.java", "diffHunk": "@@ -698,23 +699,15 @@ public static String getTypeKeyJSON(boolean isMessageEvent) {\n     }\n \n     public static String getExtensionNameKeyJSON(boolean isMessageEvent, String extKey) {\n-        ArrayList<String> tempExt = null;\n-        ArrayList<String> aliasesExt = null;\n+        ExtensionAliases tempExt = null;\n         if (isMessageEvent) {\n-            tempExt = jsonLoggingNameAliasesMessages.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesMessages.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesMessages.extensionAliases;\n \n         } else {\n-            tempExt = jsonLoggingNameAliasesTrace.originalExtensions;\n-            aliasesExt = jsonLoggingNameAliasesTrace.aliasesExtensions;\n+            tempExt = jsonLoggingNameAliasesTrace.extensionAliases;\n \n         }\n-        for (int i = 0; i < tempExt.size(); i++) {\n-            if (tempExt.get(i).equals(extKey)) {\n-                return aliasesExt.get(i);\n-            }\n-        }\n-        return extKey;\n+        return tempExt.getAlias(extKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990aadde1ab75688fa8f61f2a197da111c65b49a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96be6d9b55a83a6067e75947301c6046196f418a", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/96be6d9b55a83a6067e75947301c6046196f418a", "committedDate": "2020-03-04T16:15:31Z", "message": "fix vertical spacing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTY5MTc1", "url": "https://github.com/OpenLiberty/open-liberty/pull/10854#pullrequestreview-368969175", "createdAt": "2020-03-04T17:17:50Z", "commit": {"oid": "96be6d9b55a83a6067e75947301c6046196f418a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a7030c4d6a5fff22d234c66764940d8b4ba730", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/39a7030c4d6a5fff22d234c66764940d8b4ba730", "committedDate": "2020-03-05T14:47:17Z", "message": "update copyright year in NameAliases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1765172ad43fb08a16b10a5922fd379a5b3d038", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f1765172ad43fb08a16b10a5922fd379a5b3d038", "committedDate": "2020-03-06T16:13:39Z", "message": "Merge branch 'master' of github.com:OpenLiberty/open-liberty into 10707-threadsafeExt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc8dd1575c487132ee935d4ac18806d2c85f670", "author": {"user": {"login": "Yushan-Lin", "name": "Yushan Lin"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5dc8dd1575c487132ee935d4ac18806d2c85f670", "committedDate": "2020-03-06T16:18:03Z", "message": "Merge branch 'integration' into 10707-threadsafeExt"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3198, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}