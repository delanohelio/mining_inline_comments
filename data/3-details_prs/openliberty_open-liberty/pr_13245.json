{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NzEzMTcy", "number": 13245, "title": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.", "bodyText": "Modify HybridPersistenceActivator to key off from ModuleMetaData instead of ClassLoader", "createdAt": "2020-07-29T21:27:47Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245", "merged": true, "mergeCommit": {"oid": "51639aed0d3606152e5a81de696a8a555350a8f8"}, "closed": true, "closedAt": "2020-08-14T14:03:13Z", "author": {"login": "jgrassel"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6BbIpABqjM2MDQ0NzU0NjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-hDddAFqTQ2NjgyODEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e651083e6fe18dbd83d4cb4ab58fa7b442235cfd", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/e651083e6fe18dbd83d4cb4ab58fa7b442235cfd", "committedDate": "2020-07-29T21:25:46Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "fb2b56ed25ffbe2d7a5e23b73fdbb80d7d1ee9e7", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fb2b56ed25ffbe2d7a5e23b73fdbb80d7d1ee9e7", "committedDate": "2020-07-30T15:33:04Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb2b56ed25ffbe2d7a5e23b73fdbb80d7d1ee9e7", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/fb2b56ed25ffbe2d7a5e23b73fdbb80d7d1ee9e7", "committedDate": "2020-07-30T15:33:04Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "f1c3ee7b33cc2f0c49b074a4c57775f4b3ae578d", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f1c3ee7b33cc2f0c49b074a4c57775f4b3ae578d", "committedDate": "2020-07-30T20:01:17Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1c3ee7b33cc2f0c49b074a4c57775f4b3ae578d", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f1c3ee7b33cc2f0c49b074a4c57775f4b3ae578d", "committedDate": "2020-07-30T20:01:17Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "742767556cc65b5717687dd9807115d2c7fa5922", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/742767556cc65b5717687dd9807115d2c7fa5922", "committedDate": "2020-08-03T21:51:14Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "742767556cc65b5717687dd9807115d2c7fa5922", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/742767556cc65b5717687dd9807115d2c7fa5922", "committedDate": "2020-08-03T21:51:14Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "49fb0112429a02cc09755b9e6b264e93c07e49b0", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/49fb0112429a02cc09755b9e6b264e93c07e49b0", "committedDate": "2020-08-04T17:08:02Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49fb0112429a02cc09755b9e6b264e93c07e49b0", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/49fb0112429a02cc09755b9e6b264e93c07e49b0", "committedDate": "2020-08-04T17:08:02Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/331525b3ad14ffffa32ce61ff401438596a1144e", "committedDate": "2020-08-05T17:49:56Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTAyNDU1", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#pullrequestreview-462902455", "createdAt": "2020-08-06T21:53:56Z", "commit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1Mzo1NlrOG9Fhqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1Mzo1NlrOG9Fhqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNjg1OQ==", "bodyText": "I don't understand why you are doing these changes.  Don't you want the activator to be in there any longer?  Shouldn't this bundle and the 2.2 bundle be just like the 2.0 bundle above and the ws.javaee 2.1 and 2.2 below?", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#discussion_r466706859", "createdAt": "2020-08-06T21:53:56Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.websphere.javaee.persistence.2.1/bnd.bnd", "diffHunk": "@@ -12,24 +12,12 @@\n bVersion=1.0\n \n Bundle-SymbolicName: com.ibm.websphere.javaee.persistence.2.1; singleton:=true\n-Bundle-Activator: com.ibm.ws.javaee.persistence.internal.HybridPersistenceActivator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTA2NDE0", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#pullrequestreview-462906414", "createdAt": "2020-08-06T22:02:11Z", "commit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjowMjoxMVrOG9FuEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjowMjoxMVrOG9FuEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMDAzNA==", "bodyText": "WeakHashMap is not thread safe.  Nothing is done to give you thread safety when accessing the map.  This can lead to infinite loops.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#discussion_r466710034", "createdAt": "2020-08-06T22:02:11Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.ws.jpa.hybridpersistenceactivator/src/com/ibm/ws/javaee/persistence/internal/HybridPersistenceActivator.java", "diffHunk": "@@ -23,14 +23,16 @@\n import org.apache.geronimo.osgi.locator.ProviderLocator;\n import org.apache.geronimo.specs.jpa.PersistenceActivator;\n \n+import com.ibm.ws.runtime.metadata.ModuleMetaData;\n+import com.ibm.ws.threadContext.ComponentMetaDataAccessorImpl;\n+\n /**\n  * An override of the default persistence activator that provides a hybrid mechanism\n  * to discover persistence providers by searching for providers available from\n  * META-INF/services in addition to those registered in the OSGi service registry.\n  */\n public class HybridPersistenceActivator extends PersistenceActivator {\n-\n-    private volatile WeakHashMap<ClassLoader, List<PersistenceProvider>> providerCache = new WeakHashMap<ClassLoader, List<PersistenceProvider>>();\n+    private volatile WeakHashMap<ModuleMetaData, List<PersistenceProvider>> providerCache = new WeakHashMap<ModuleMetaData, List<PersistenceProvider>>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0df5abc00f17fdd2f1efd3e7fb4bcb43bd877d2", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/a0df5abc00f17fdd2f1efd3e7fb4bcb43bd877d2", "committedDate": "2020-08-10T17:24:38Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/331525b3ad14ffffa32ce61ff401438596a1144e", "committedDate": "2020-08-05T17:49:56Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "7bd2fad07b551608d4d35d6503ea3daa44e2fadd", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7bd2fad07b551608d4d35d6503ea3daa44e2fadd", "committedDate": "2020-08-10T20:34:03Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7bd2fad07b551608d4d35d6503ea3daa44e2fadd", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7bd2fad07b551608d4d35d6503ea3daa44e2fadd", "committedDate": "2020-08-10T20:34:03Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "2b7cd1fbae31802acb85ffc9da863c1c88c9acd4", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2b7cd1fbae31802acb85ffc9da863c1c88c9acd4", "committedDate": "2020-08-11T14:28:19Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NDY2NzUw", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#pullrequestreview-465466750", "createdAt": "2020-08-11T22:17:33Z", "commit": {"oid": "2b7cd1fbae31802acb85ffc9da863c1c88c9acd4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMjoxNzozM1rOG_LH7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMjoyMToyOVrOG_LN_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg5NTcyNg==", "bodyText": "Yeah it is going to need some work still.  You are going to have to do like the previous code to do the put after you populate the List.  If you don't you can erroneously return an empty or partial list in another thread.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#discussion_r468895726", "createdAt": "2020-08-11T22:17:33Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.ws.jpa.hybridpersistenceactivator/src/com/ibm/ws/javaee/persistence/internal/HybridPersistenceActivator.java", "diffHunk": "@@ -23,14 +23,16 @@\n import org.apache.geronimo.osgi.locator.ProviderLocator;\n import org.apache.geronimo.specs.jpa.PersistenceActivator;\n \n+import com.ibm.ws.runtime.metadata.ModuleMetaData;\n+import com.ibm.ws.threadContext.ComponentMetaDataAccessorImpl;\n+\n /**\n  * An override of the default persistence activator that provides a hybrid mechanism\n  * to discover persistence providers by searching for providers available from\n  * META-INF/services in addition to those registered in the OSGi service registry.\n  */\n public class HybridPersistenceActivator extends PersistenceActivator {\n-\n-    private volatile WeakHashMap<ClassLoader, List<PersistenceProvider>> providerCache = new WeakHashMap<ClassLoader, List<PersistenceProvider>>();\n+    private volatile WeakHashMap<ModuleMetaData, List<PersistenceProvider>> providerCache = new WeakHashMap<ModuleMetaData, List<PersistenceProvider>>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMDAzNA=="}, "originalCommit": {"oid": "331525b3ad14ffffa32ce61ff401438596a1144e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg5NzI3Ng==", "bodyText": "com.ibm.websphere.appserver.javax.persistence.base features also should be updated to depend on containerServices features.  It is possible that this feature doesn't need to depend on containerServices then since it depends on the base feature.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#discussion_r468897276", "createdAt": "2020-08-11T22:21:29Z", "author": {"login": "jhanders34"}, "path": "dev/com.ibm.websphere.appserver.features/visibility/private/com.ibm.websphere.appserver.javax.persistence-2.1.feature", "diffHunk": "@@ -3,7 +3,8 @@ symbolicName=com.ibm.websphere.appserver.javax.persistence-2.1\n singleton=true\n IBM-Process-Types: server, \\\n  client\n--features=com.ibm.websphere.appserver.javax.persistence.base-2.1\n+-features=com.ibm.websphere.appserver.javax.persistence.base-2.1, \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b7cd1fbae31802acb85ffc9da863c1c88c9acd4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a9b9ff214d6ba7f54da3bdc08830fea9a60321", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/39a9b9ff214d6ba7f54da3bdc08830fea9a60321", "committedDate": "2020-08-12T19:45:00Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b7cd1fbae31802acb85ffc9da863c1c88c9acd4", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/2b7cd1fbae31802acb85ffc9da863c1c88c9acd4", "committedDate": "2020-08-11T14:28:19Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}, "afterCommit": {"oid": "39a9b9ff214d6ba7f54da3bdc08830fea9a60321", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/39a9b9ff214d6ba7f54da3bdc08830fea9a60321", "committedDate": "2020-08-12T19:45:00Z", "message": "Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54fce2b1d8994a12a50a12bb3462dd936ae5150b", "author": {"user": {"login": "jgrassel", "name": "Jody Grassel"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/54fce2b1d8994a12a50a12bb3462dd936ae5150b", "committedDate": "2020-08-13T14:35:01Z", "message": " Modify JPA HybridPersistenceActivator to not key off ClassLoader (review updates, private jpa base features) #13245\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODI4MTIy", "url": "https://github.com/OpenLiberty/open-liberty/pull/13245#pullrequestreview-466828122", "createdAt": "2020-08-13T14:40:02Z", "commit": {"oid": "54fce2b1d8994a12a50a12bb3462dd936ae5150b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2098, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}