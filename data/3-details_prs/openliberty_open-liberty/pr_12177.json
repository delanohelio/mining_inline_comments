{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NzM1NzI4", "number": 12177, "title": "Refactor BaseMetrics so that it is not singleton that is explicitly called by the publc/private rest handler; it is now an osgi service", "bodyText": "", "createdAt": "2020-05-14T03:59:26Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177", "merged": true, "mergeCommit": {"oid": "c52c9ea29d6e430e9797cf4facfb9309bd87f462"}, "closed": true, "closedAt": "2020-05-20T15:20:22Z", "author": {"login": "Channyboy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchFUykgH2gAyNDE3NzM1NzI4OmRkMjM0ZDk0ODQ2YmQ4MTUyMGRlYmU0YTk1YTg2YzZlOTA0YzJmNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci6GBrgFqTQxNDc3OTEwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd234d94846bd81520debe4a95a86c6e904c2f74", "author": {"user": {"login": "Channyboy", "name": "David Chan"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/dd234d94846bd81520debe4a95a86c6e904c2f74", "committedDate": "2020-05-14T03:57:49Z", "message": "Refactor BaseMetrics so that it is not singleton that is explicitly called by the publc/private rest handler; it is now a osgi service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjYyNzQy", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177#pullrequestreview-412662742", "createdAt": "2020-05-15T13:45:29Z", "commit": {"oid": "dd234d94846bd81520debe4a95a86c6e904c2f74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo0NToyOVrOGWFgig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo0NToyOVrOGWFgig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTgxMjEwNg==", "bodyText": "Why is SHARED_METRIC_REGISTRY public?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177#discussion_r425812106", "createdAt": "2020-05-15T13:45:29Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.ws.microprofile.metrics.2.0/src/com/ibm/ws/microprofile/metrics/BaseMetrics.java", "diffHunk": "@@ -25,33 +26,45 @@\n import org.eclipse.microprofile.metrics.MetricType;\n import org.eclipse.microprofile.metrics.MetricUnits;\n import org.eclipse.microprofile.metrics.Tag;\n+import org.osgi.service.component.ComponentContext;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.ConfigurationPolicy;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n \n import com.ibm.ws.microprofile.metrics.impl.CounterImpl;\n import com.ibm.ws.microprofile.metrics.impl.SharedMetricRegistries;\n \n+@Component(service = { BaseMetrics.class }, configurationPolicy = ConfigurationPolicy.IGNORE, immediate = true)\n public class BaseMetrics {\n \n-    protected static BaseMetrics baseMetrics = null;\n     protected static String BASE = MetricRegistry.Type.BASE.getName();\n     public MBeanServer mbs;\n     protected static Set<String> gcObjectNames = new HashSet<String>();\n \n-    protected static SharedMetricRegistries SHARED_METRIC_REGISTRY;\n+    public static SharedMetricRegistries SHARED_METRIC_REGISTRY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd234d94846bd81520debe4a95a86c6e904c2f74"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjYzMzA4", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177#pullrequestreview-412663308", "createdAt": "2020-05-15T13:46:12Z", "commit": {"oid": "dd234d94846bd81520debe4a95a86c6e904c2f74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo0NjoxMlrOGWFiXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo0NjoxMlrOGWFiXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTgxMjU3Mg==", "bodyText": "Do you need an empty constructor?", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177#discussion_r425812572", "createdAt": "2020-05-15T13:46:12Z", "author": {"login": "fmhwong"}, "path": "dev/com.ibm.ws.microprofile.metrics.2.0/src/com/ibm/ws/microprofile/metrics/BaseMetrics.java", "diffHunk": "@@ -25,33 +26,45 @@\n import org.eclipse.microprofile.metrics.MetricType;\n import org.eclipse.microprofile.metrics.MetricUnits;\n import org.eclipse.microprofile.metrics.Tag;\n+import org.osgi.service.component.ComponentContext;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.ConfigurationPolicy;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n \n import com.ibm.ws.microprofile.metrics.impl.CounterImpl;\n import com.ibm.ws.microprofile.metrics.impl.SharedMetricRegistries;\n \n+@Component(service = { BaseMetrics.class }, configurationPolicy = ConfigurationPolicy.IGNORE, immediate = true)\n public class BaseMetrics {\n \n-    protected static BaseMetrics baseMetrics = null;\n     protected static String BASE = MetricRegistry.Type.BASE.getName();\n     public MBeanServer mbs;\n     protected static Set<String> gcObjectNames = new HashSet<String>();\n \n-    protected static SharedMetricRegistries SHARED_METRIC_REGISTRY;\n+    public static SharedMetricRegistries SHARED_METRIC_REGISTRY;\n \n-    public static synchronized BaseMetrics getInstance(SharedMetricRegistries sharedMetricRegistry) {\n-        SHARED_METRIC_REGISTRY = sharedMetricRegistry;\n-        if (baseMetrics == null)\n-            baseMetrics = new BaseMetrics();\n-        return baseMetrics;\n+    @Reference\n+    public void setSharedMetricRegistries(SharedMetricRegistries sharedMetricRegistry) {\n+        BaseMetrics.SHARED_METRIC_REGISTRY = sharedMetricRegistry;\n     }\n \n-    protected BaseMetrics() {\n+    public BaseMetrics() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd234d94846bd81520debe4a95a86c6e904c2f74"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2a977a963faa31c7bc0b5b1223f7c6106c8da55", "author": {"user": {"login": "Channyboy", "name": "David Chan"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/f2a977a963faa31c7bc0b5b1223f7c6106c8da55", "committedDate": "2020-05-19T18:27:48Z", "message": "Clean up - non necessary empty constructor - privatize static variable only used locally"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Nzc5MTA2", "url": "https://github.com/OpenLiberty/open-liberty/pull/12177#pullrequestreview-414779106", "createdAt": "2020-05-19T20:00:35Z", "commit": {"oid": "f2a977a963faa31c7bc0b5b1223f7c6106c8da55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2631, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}