{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0OTQxODg5", "number": 11214, "title": "Add TimedCache and use it to cache config values", "bodyText": "Use it to cache:\n\nserver.xml app properties\nraw values retrieved from any source\n\nFor #11079", "createdAt": "2020-03-06T17:37:16Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214", "merged": true, "mergeCommit": {"oid": "9ca622fcb952668e0849642d881eeae761788457"}, "closed": true, "closedAt": "2020-03-10T13:45:37Z", "author": {"login": "Azquelt"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL8lxygH2gAyMzg0OTQxODg5OjgzMzQ2ZWE0MzUwY2ZiNzE2YWZjZGVmNDU5ZjExMDExNTA4M2QxN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMBquqgFqTM3MTM5OTkxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "83346ea4350cfb716afcdef459f110115083d17b", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/83346ea4350cfb716afcdef459f110115083d17b", "committedDate": "2020-03-09T11:54:49Z", "message": "Add TimedCache and use it to cache config values\n\nUse it to cache:\n - server.xml app properties\n - raw values retrieved from any source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5fca2c003d716484e9b001b6a9c15f4aa3e9ea50", "committedDate": "2020-03-09T11:55:21Z", "message": "Config-1.4 caching updates for unit testing\n\nMake TimedCache create an executor when it's used in a unit test\n\nMake ConversionTest wait so that the rawValueCache has time to expire."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e5ae49d7270b1514ae2c2a8597dabdc278a085c", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1e5ae49d7270b1514ae2c2a8597dabdc278a085c", "committedDate": "2020-03-09T11:49:06Z", "message": "Fix Config-1.4 unit tests\n\nMake TimedCache create an executor when it's used in a unit test\n\nMake ConversionTest wait so that the rawValueCache has time to expire."}, "afterCommit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50", "author": {"user": {"login": "Azquelt", "name": "Andrew Rouse"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/5fca2c003d716484e9b001b6a9c15f4aa3e9ea50", "committedDate": "2020-03-09T11:55:21Z", "message": "Config-1.4 caching updates for unit testing\n\nMake TimedCache create an executor when it's used in a unit test\n\nMake ConversionTest wait so that the rawValueCache has time to expire."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMjY0NTcw", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#pullrequestreview-371264570", "createdAt": "2020-03-09T15:06:55Z", "commit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNTowNjo1NVrOFzskWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNTowNjo1NVrOFzskWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc1MTg5Ng==", "bodyText": "The 500 should be in a constant somewhere, possibly a constants file and possibly configurable??", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#discussion_r389751896", "createdAt": "2020-03-09T15:06:55Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.microprofile.config.1.4/src/com/ibm/ws/microprofile/config14/impl/Config14Impl.java", "diffHunk": "@@ -47,13 +50,14 @@\n      */\n     public Config14Impl(ConversionManager conversionManager, SortedSources sources, ScheduledExecutorService executor, long refreshInterval) {\n         super(conversionManager, sources);\n+        rawValueCache = new TimedCache<>(executor, 500, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMjY2NTI5", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#pullrequestreview-371266529", "createdAt": "2020-03-09T15:09:06Z", "commit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNTowOTowNlrOFzsp1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNTowOTowNlrOFzsp1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc1MzMwMg==", "bodyText": "Does the convertedValueCache need clearing?", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#discussion_r389753302", "createdAt": "2020-03-09T15:09:06Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.microprofile.config.1.4/src/com/ibm/ws/microprofile/config14/impl/Config14Impl.java", "diffHunk": "@@ -135,6 +144,18 @@ private SourcedValue getRawValue(String key) {\n         return raw;\n     }\n \n+    @Override\n+    public void close() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMjg0ODk5", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#pullrequestreview-371284899", "createdAt": "2020-03-09T15:29:17Z", "commit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNToyOToxN1rOFzth3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNToyOToxN1rOFzth3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc2NzY0NQ==", "bodyText": "should be based on the 500 constant ... unless that is made configurable", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#discussion_r389767645", "createdAt": "2020-03-09T15:29:17Z", "author": {"login": "tevans78"}, "path": "dev/com.ibm.ws.microprofile.config.1.4/test/src/com/ibm/ws/microprofile/config14/test/ConversionTest.java", "diffHunk": "@@ -47,14 +47,16 @@ public void testBadCharUnicode() {\n     }\n \n     @Test\n-    public void testConverterCache() {\n+    public void testConverterCache() throws InterruptedException {\n         Config config = ConfigProviderResolver.instance().getBuilder().addDefaultSources().withConverter(TestType.class, 100, new TestTypeConverter()).build();\n         String key = \"testConverterCache\";\n \n         String rawString = \"This is the RAW String 1\";\n         String expected = rawString + \" - 1\";\n         System.setProperty(key, rawString);\n \n+        Thread.sleep(700); // Let the raw value cache expire", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzk5OTE0", "url": "https://github.com/OpenLiberty/open-liberty/pull/11214#pullrequestreview-371399914", "createdAt": "2020-03-09T17:49:45Z", "commit": {"oid": "5fca2c003d716484e9b001b6a9c15f4aa3e9ea50"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3046, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}