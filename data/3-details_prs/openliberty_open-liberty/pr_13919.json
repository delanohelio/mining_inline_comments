{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjE3OTc0", "number": 13919, "title": "Add packaged zip checksum files to existing ant task", "bodyText": "", "createdAt": "2020-09-14T13:28:56Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13919", "merged": true, "mergeCommit": {"oid": "951ad1a2b7fa6b3a958416d019501e3a98ff6491"}, "closed": true, "closedAt": "2020-09-18T16:15:33Z", "author": {"login": "cbridgha"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIz5DHABqjM3NjM1OTAzMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJwI6gABqjM3Nzc3MDEyNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48de7337978be030377237c99c0b5057092eac88", "author": {"user": {"login": "cbridgha", "name": "Chuck Bridgham"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/48de7337978be030377237c99c0b5057092eac88", "committedDate": "2020-09-14T12:54:23Z", "message": "Add packaged zip checksum files to existing ant task"}, "afterCommit": {"oid": "d58b3cb88bbeecc5bac3101da4a2f10934339aa1", "author": {"user": {"login": "cbridgha", "name": "Chuck Bridgham"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/d58b3cb88bbeecc5bac3101da4a2f10934339aa1", "committedDate": "2020-09-14T14:15:47Z", "message": "Add packaged zip checksum files to existing ant task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODcwNjY3", "url": "https://github.com/OpenLiberty/open-liberty/pull/13919#pullrequestreview-487870667", "createdAt": "2020-09-14T15:07:45Z", "commit": {"oid": "d58b3cb88bbeecc5bac3101da4a2f10934339aa1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTowNzo0NVrOHRZnVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTowNzo0NVrOHRZnVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwNzUwOA==", "bodyText": "Dead code?", "url": "https://github.com/OpenLiberty/open-liberty/pull/13919#discussion_r488007508", "createdAt": "2020-09-14T15:07:45Z", "author": {"login": "mbroz2"}, "path": "dev/wlp-generateChecksums/src/com/ibm/ws/wlp/cs/GenerateZipChecksums.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package com.ibm.ws.wlp.cs;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.util.Properties;\n+\n+import org.apache.tools.ant.BuildException;\n+import org.apache.tools.ant.Task;\n+\n+import com.ibm.ws.kernel.provisioning.ContentBasedLocalBundleRepository;\n+\n+/**\n+ * GenerateChecksums\n+ */\n+public class GenerateZipChecksums extends Task {\n+    //ant task attributes\n+    private File installRoot;\n+    private final String checksumsDirName = \"checksums\";\n+    private boolean ignoreBinFiles = false;\n+\n+    //the ext name of all the checksum files\n+    private static String MD5_FILE_EXT = \"md5\";\n+\n+    //initialed from installRoot when execute\n+    private ContentBasedLocalBundleRepository cblbr;\n+\n+    @Override\n+    public void execute() {\n+\n+        try {\n+            // generate dist zips checksums\n+            generateZipChecksums(installRoot, new File(installRoot, checksumsDirName));\n+\n+        } catch (IOException e) {\n+            throw new BuildException(e);\n+        }\n+    }\n+\n+    /**\n+     * @param dir\n+     * @param checksumsDir\n+     * @throws IOException\n+     */\n+    private void generateZipChecksums(File dir, File checksumsDir) throws IOException {\n+        checksumsDir.mkdirs();\n+        File[] zipFiles = dir.listFiles();\n+        for (File zipFile : zipFiles) {\n+            System.out.println(zipFile.getName());\n+            if (!zipFile.getName().endsWith(\".zip\")) {\n+                continue;\n+            }\n+            //generate the cs file from each packaged zip\n+            String md5Checksum = MD5Utils.getFileMD5String(zipFile);\n+            String fileName = zipFile.getName();\n+            File md5File = new File(checksumsDir, fileName + \".\" + MD5_FILE_EXT);\n+            OutputStream out = null;\n+            try {\n+                out = new FileOutputStream(md5File, false);\n+                byte checksumbytes[] = md5Checksum.getBytes();\n+                out.write(checksumbytes);\n+            } finally {\n+                FileUtils.tryToClose(out);\n+            }\n+        }\n+    }\n+\n+    private void createFile(File file, Properties props) throws IOException {\n+        OutputStream out = null;\n+        try {\n+            out = new FileOutputStream(file, false);\n+            props.store(out, null);\n+        } finally {\n+            FileUtils.tryToClose(out);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d58b3cb88bbeecc5bac3101da4a2f10934339aa1"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b95f52f181960778bdaf75cebb2574111de52dc", "author": {"user": {"login": "cbridgha", "name": "Chuck Bridgham"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7b95f52f181960778bdaf75cebb2574111de52dc", "committedDate": "2020-09-17T12:27:24Z", "message": "Add packaged zip checksum files to existing ant task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d58b3cb88bbeecc5bac3101da4a2f10934339aa1", "author": {"user": {"login": "cbridgha", "name": "Chuck Bridgham"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/d58b3cb88bbeecc5bac3101da4a2f10934339aa1", "committedDate": "2020-09-14T14:15:47Z", "message": "Add packaged zip checksum files to existing ant task"}, "afterCommit": {"oid": "7b95f52f181960778bdaf75cebb2574111de52dc", "author": {"user": {"login": "cbridgha", "name": "Chuck Bridgham"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/7b95f52f181960778bdaf75cebb2574111de52dc", "committedDate": "2020-09-17T12:27:24Z", "message": "Add packaged zip checksum files to existing ant task"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3360, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}