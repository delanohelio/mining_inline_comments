{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NDA2MjYy", "number": 11891, "title": "Upgrade to Testcontainers 1.14.0", "bodyText": "", "createdAt": "2020-04-22T16:39:53Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/11891", "merged": true, "mergeCommit": {"oid": "694fe89f365f054fb6b1755b59fedaa26d011f98"}, "closed": true, "closedAt": "2020-04-29T16:57:04Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcai6YNgBqjMyNjY3NjkzNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca1WifAFqTQwMDE1ODEwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bef1c7bd79b99be79c9575e88a73218e956f01e4", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/bef1c7bd79b99be79c9575e88a73218e956f01e4", "committedDate": "2020-04-22T16:39:20Z", "message": "Upgrade to Testcontainers 1.14.0"}, "afterCommit": {"oid": "a29351a56f44d584cf6fe188f678084df15a4f16", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/a29351a56f44d584cf6fe188f678084df15a4f16", "committedDate": "2020-04-23T20:28:32Z", "message": "Upgrade to Testcontainers 1.14.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTQzMzIx", "url": "https://github.com/OpenLiberty/open-liberty/pull/11891#pullrequestreview-400143321", "createdAt": "2020-04-24T17:35:24Z", "commit": {"oid": "a29351a56f44d584cf6fe188f678084df15a4f16"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzozNToyNVrOGLiI5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzozNToyNVrOGLiI5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0Njg1NA==", "bodyText": "The oracle container uses ports 1521, and 5500.\nThis regression will also affect fattest.databases.  You'll need to expose these ports here as well:\n\n  \n    \n      open-liberty/dev/fattest.databases/src/componenttest/topology/database/container/DatabaseContainerFactory.java\n    \n    \n        Lines 122 to 124\n      in\n      dfd6463\n    \n    \n    \n    \n\n        \n          \n           case Oracle:          \t \n        \n\n        \n          \n           \tcont = (JdbcDatabaseContainer<?>) clazz.getConstructor(String.class).newInstance(\"kyleaure/oracle-18.4.0-xe-prebuilt:1.0\"); \n        \n\n        \n          \n               break;", "url": "https://github.com/OpenLiberty/open-liberty/pull/11891#discussion_r414746854", "createdAt": "2020-04-24T17:35:25Z", "author": {"login": "KyleAure"}, "path": "dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java", "diffHunk": "@@ -30,83 +30,83 @@\n import oracle.jdbc.pool.OracleDataSource;\n \n @RunWith(Suite.class)\n-@SuiteClasses({\n-                OracleTest.class,\n-                OracleTraceTest.class,\n-                OracleUCPTest.class\n-})\n+@SuiteClasses({ OracleTest.class, OracleTraceTest.class, OracleUCPTest.class })\n public class FATSuite {\n \n-    //TODO replace this container with the official oracle-xe container if/when it is available without a license\n-    static OracleContainer oracle = new OracleContainer(\"kyleaure/oracle-18.4.0-xe-prebuilt:1.0\").withLogConsumer(FATSuite::log);\n-\n-    private static void log(OutputFrame frame) {\n-        String msg = frame.getUtf8String();\n-        if (msg.endsWith(\"\\n\"))\n-            msg = msg.substring(0, msg.length() - 1);\n-        Log.info(FATSuite.class, \"oracle\", msg);\n-    }\n-\n-    @BeforeClass\n-    public static void beforeSuite() throws Exception {\n-        //Allows local tests to switch between using a local docker client, to using a remote docker client.\n-        ExternalTestServiceDockerClientStrategy.clearTestcontainersConfig();\n-\n-        oracle.start();\n-    }\n-\n-    @AfterClass\n-    public static void afterSuite() {\n-        oracle.stop();\n-    }\n-\n-    public static void initDatabaseTables() throws SQLException {\n-        Properties connProps = new Properties();\n-        // This property prevents \"ORA-01882: timezone region not found\" errors due to the Oracle DB not understanding\n-        // some time zones(specifically those used by our RHEL 6 test systems).\n-        connProps.put(\"oracle.jdbc.timezoneAsRegion\", \"false\");\n-\n-        OracleDataSource ds = new OracleDataSource();\n-        ds.setConnectionProperties(connProps);\n-        ds.setUser(oracle.getUsername());\n-        ds.setPassword(oracle.getPassword());\n-        ds.setURL(oracle.getJdbcUrl());\n-\n-        try (Connection conn = ds.getConnection()) {\n-            Statement stmt = conn.createStatement();\n-\n-            //Create MYTABLE for OracleTest.class and OracleTraceTest.class\n-            try {\n-                stmt.execute(\"DROP TABLE MYTABLE\");\n-            } catch (SQLException x) {\n-                // probably didn't exist\n-            }\n-            stmt.execute(\"CREATE TABLE MYTABLE (ID NUMBER NOT NULL PRIMARY KEY, STRVAL NVARCHAR2(40))\");\n-\n-            //Create CONCOUNT for OracleTest.class\n-            try {\n-                stmt.execute(\"DROP TABLE CONCOUNT\");\n-            } catch (SQLException x) {\n-                // probably didn't exist\n-            }\n-            stmt.execute(\"CREATE TABLE CONCOUNT (NUMCONNECTIONS NUMBER NOT NULL)\");\n-            stmt.execute(\"INSERT INTO CONCOUNT VALUES(0)\");\n-\n-            //Create COLORTABLE for OracleUCPTest.class\n-            try {\n-                stmt.execute(\"DROP TABLE COLORTABLE\");\n-            } catch (SQLException x) {\n-                // probably didn't exist\n-            }\n-            stmt.execute(\"CREATE TABLE COLORTABLE (ID NUMBER NOT NULL PRIMARY KEY, COLOR NVARCHAR2(40))\");\n-            PreparedStatement ps = conn.prepareStatement(\"INSERT INTO COLORTABLE VALUES(?,?)\");\n-            ps.setInt(1, 1);\n-            ps.setString(2, \"maroon\");\n-            ps.executeUpdate();\n-\n-            //Close statements\n-            ps.close();\n-            stmt.close();\n-        }\n-    }\n+\t// TODO replace this container with the official oracle-xe container if/when it is available without a license\n+\tstatic OracleContainer oracle = new OracleContainer(\"kyleaure/oracle-18.4.0-xe-prebuilt:1.0\")\n+\t\t\t.withExposedPorts(1521, 8080) // need to manually expose ports due to regression in 1.14.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29351a56f44d584cf6fe188f678084df15a4f16"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aa8882e93c10a1494d0dc351acdf0df1cf49b19", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1aa8882e93c10a1494d0dc351acdf0df1cf49b19", "committedDate": "2020-04-24T17:53:50Z", "message": "Upgrade to Testcontainers 1.14.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a29351a56f44d584cf6fe188f678084df15a4f16", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/a29351a56f44d584cf6fe188f678084df15a4f16", "committedDate": "2020-04-23T20:28:32Z", "message": "Upgrade to Testcontainers 1.14.0"}, "afterCommit": {"oid": "1aa8882e93c10a1494d0dc351acdf0df1cf49b19", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1aa8882e93c10a1494d0dc351acdf0df1cf49b19", "committedDate": "2020-04-24T17:53:50Z", "message": "Upgrade to Testcontainers 1.14.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTU4MTA3", "url": "https://github.com/OpenLiberty/open-liberty/pull/11891#pullrequestreview-400158107", "createdAt": "2020-04-24T17:57:42Z", "commit": {"oid": "1aa8882e93c10a1494d0dc351acdf0df1cf49b19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2676, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}