{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNTU0NDEz", "number": 15004, "title": "Handle NPE during remote unbind if orb didn't come up", "bodyText": "#14885", "createdAt": "2020-11-17T16:50:29Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004", "merged": true, "mergeCommit": {"oid": "18b76328906fc4458af72ab4a56ee9110f4501a4"}, "closed": true, "closedAt": "2020-11-20T16:24:08Z", "author": {"login": "olendvcook"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddxAziAFqTUzMzY0NzA4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeFadDgFqTUzNDYzMDUzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjQ3MDgw", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004#pullrequestreview-533647080", "createdAt": "2020-11-18T16:47:05Z", "commit": {"oid": "236bb3183d4e29218fc74037a00d0e32f99f9e47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjo0NzowNVrOH13MIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjo0NzowNVrOH13MIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MDgwMg==", "bodyText": "Seems we are starting at a leaf node, and if that context is empty, we unbind it from the parent, then back up one and check if that context is null, etc... all the way back to the root.  As soon as we find one that is not empty, we stop.\nHowever, now we will stop as soon as we find a \"null\" context.... but what if the parent context exists and is empty, shouldn't we back up one and check the parent as well?  If it does exist and is empty, seems we should unbind it.", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004#discussion_r526240802", "createdAt": "2020-11-18T16:47:05Z", "author": {"login": "tkburroughs"}, "path": "dev/com.ibm.ws.ejbcontainer.remote/src/com/ibm/ws/ejbcontainer/remote/internal/EJBRemoteRuntimeImpl.java", "diffHunk": "@@ -249,17 +250,23 @@ public synchronized void unbindAll(Object bindingDataObject) {\n             }\n         }\n \n-        for (int i = bindingData.contextNames.length - 1; i >= 0 && !hasBindings(bindingData.contexts[i]); i--) {\n+        // For contextNames, if completely empty of bindings, unbind the naming context from its parent context.\n+        for (int i = bindingData.contextNames.length - 1; i >= 0 && isBindingContextEmpty(bindingData.contexts[i]); i--) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "236bb3183d4e29218fc74037a00d0e32f99f9e47"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "236bb3183d4e29218fc74037a00d0e32f99f9e47", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/236bb3183d4e29218fc74037a00d0e32f99f9e47", "committedDate": "2020-11-17T16:47:27Z", "message": "Handle NPE during remote unbind if orb didn't come up"}, "afterCommit": {"oid": "0be18345b8451130318ba0c21850ad91fe5506e1", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/0be18345b8451130318ba0c21850ad91fe5506e1", "committedDate": "2020-11-18T16:59:46Z", "message": "Handle NPE during remote unbind if orb didn't come up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNzU3ODU5", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004#pullrequestreview-533757859", "createdAt": "2020-11-18T18:31:05Z", "commit": {"oid": "0be18345b8451130318ba0c21850ad91fe5506e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODozMTowNlrOH18dPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODozMTowNlrOH18dPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMyNzEwMA==", "bodyText": "This is better, but inefficient.  The code used to stop at the first non-empty list, but will now keep going.  The logic here is skipped, but isBindingContextEmpty will continue to be called and creates several objects and creates a list.  Could we have isBindingContextEmpty return Boolean, so we could tell the difference between True, False, and null?", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004#discussion_r526327100", "createdAt": "2020-11-18T18:31:06Z", "author": {"login": "tkburroughs"}, "path": "dev/com.ibm.ws.ejbcontainer.remote/src/com/ibm/ws/ejbcontainer/remote/internal/EJBRemoteRuntimeImpl.java", "diffHunk": "@@ -249,17 +250,25 @@ public synchronized void unbindAll(Object bindingDataObject) {\n             }\n         }\n \n-        for (int i = bindingData.contextNames.length - 1; i >= 0 && !hasBindings(bindingData.contexts[i]); i--) {\n-            NamingContext parentContext = i == 0 ? rootNamingContext : bindingData.contexts[i - 1];\n-            unbind(parentContext, bindingData.contextNames[i]);\n+        // For contextNames, if completely empty of bindings, unbind the naming context from its parent context.\n+        for (int i = bindingData.contextNames.length - 1; i >= 0; i--) {\n+            if (isBindingContextEmpty(bindingData.contexts[i])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0be18345b8451130318ba0c21850ad91fe5506e1"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0be18345b8451130318ba0c21850ad91fe5506e1", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/0be18345b8451130318ba0c21850ad91fe5506e1", "committedDate": "2020-11-18T16:59:46Z", "message": "Handle NPE during remote unbind if orb didn't come up"}, "afterCommit": {"oid": "209510ebe2ed3a163b15d63232aa80f850d50a3c", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/209510ebe2ed3a163b15d63232aa80f850d50a3c", "committedDate": "2020-11-19T15:31:29Z", "message": "Handle NPE during remote unbind if orb didn't come up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d526dbbb007562777e6d18690c7e892f780d39e", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1d526dbbb007562777e6d18690c7e892f780d39e", "committedDate": "2020-11-19T15:36:18Z", "message": "Handle NPE during remote unbind if orb didn't come up"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "209510ebe2ed3a163b15d63232aa80f850d50a3c", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/209510ebe2ed3a163b15d63232aa80f850d50a3c", "committedDate": "2020-11-19T15:31:29Z", "message": "Handle NPE during remote unbind if orb didn't come up"}, "afterCommit": {"oid": "1d526dbbb007562777e6d18690c7e892f780d39e", "author": {"user": {"login": "olendvcook", "name": "Olen Cook"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/1d526dbbb007562777e6d18690c7e892f780d39e", "committedDate": "2020-11-19T15:36:18Z", "message": "Handle NPE during remote unbind if orb didn't come up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjMwNTMw", "url": "https://github.com/OpenLiberty/open-liberty/pull/15004#pullrequestreview-534630530", "createdAt": "2020-11-19T16:33:23Z", "commit": {"oid": "1d526dbbb007562777e6d18690c7e892f780d39e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2839, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}