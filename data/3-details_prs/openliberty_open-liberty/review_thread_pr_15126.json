{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NDU4Mjg2", "number": 15126, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozNToyNVrOE-nPfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0ODowN1rOE-nhpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDkwMTA5OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozNToyNVrOH73KIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozNToyNVrOH73KIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzMTc0NA==", "bodyText": "You can take this line out and add @Server to the LibertyServer field instead.", "url": "https://github.com/OpenLiberty/open-liberty/pull/15126#discussion_r532531744", "createdAt": "2020-11-30T11:35:25Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "diffHunk": "@@ -26,28 +27,34 @@\n import org.jboss.shrinkwrap.api.spec.ResourceAdapterArchive;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n \n-import com.ibm.ws.fat.util.BuildShrinkWrap;\n+import com.ibm.websphere.simplicity.ShrinkHelper;\n+import com.ibm.websphere.simplicity.ShrinkHelper.DeployOptions;\n import com.ibm.ws.fat.util.LoggingTest;\n-import com.ibm.ws.fat.util.ShrinkWrapSharedServer;\n+import com.ibm.ws.fat.util.SharedServer;\n import com.ibm.ws.fat.util.browser.WebBrowser;\n+import com.ibm.ws.fat.util.browser.WebBrowserException;\n+import com.ibm.ws.fat.util.browser.WebBrowserFactory;\n+import com.ibm.ws.fat.util.browser.WebResponse;\n \n import componenttest.annotation.ExpectedFFDC;\n import componenttest.custom.junit.runner.Mode;\n+import componenttest.topology.impl.LibertyServer;\n+import componenttest.topology.impl.LibertyServerFactory;\n \n public class BeanDiscoveryModeNoneTest extends LoggingTest {\n \n-    @ClassRule\n-    // Create the server.\n-    public static ShrinkWrapSharedServer SHARED_SERVER = new ShrinkWrapSharedServer(\"cdi12BeanDiscoveryModeNoneServer\");\n+    private static LibertyServer server;\n \n-    @BuildShrinkWrap\n-    public static Archive buildShrinkWrap() {\n-         \n-         return ShrinkWrap.create(WebArchive.class, \"beanDiscoveryModeNone.war\")\n+    @BeforeClass\n+    public static void setUp() throws Exception {\n+         server = LibertyServerFactory.getLibertyServer(\"cdi12BeanDiscoveryModeNoneServer\"); ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca297da3c641962bac9de88225e8b44cad8283e8"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDkwMjU1OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozNTo0OVrOH73K_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozNTo0OVrOH73K_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzMTk2NA==", "bodyText": "I think you need @RunWith(FATRunner.class) here", "url": "https://github.com/OpenLiberty/open-liberty/pull/15126#discussion_r532531964", "createdAt": "2020-11-30T11:35:49Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "diffHunk": "@@ -26,28 +27,34 @@\n import org.jboss.shrinkwrap.api.spec.ResourceAdapterArchive;\n import org.jboss.shrinkwrap.api.spec.WebArchive;\n \n-import com.ibm.ws.fat.util.BuildShrinkWrap;\n+import com.ibm.websphere.simplicity.ShrinkHelper;\n+import com.ibm.websphere.simplicity.ShrinkHelper.DeployOptions;\n import com.ibm.ws.fat.util.LoggingTest;\n-import com.ibm.ws.fat.util.ShrinkWrapSharedServer;\n+import com.ibm.ws.fat.util.SharedServer;\n import com.ibm.ws.fat.util.browser.WebBrowser;\n+import com.ibm.ws.fat.util.browser.WebBrowserException;\n+import com.ibm.ws.fat.util.browser.WebBrowserFactory;\n+import com.ibm.ws.fat.util.browser.WebResponse;\n \n import componenttest.annotation.ExpectedFFDC;\n import componenttest.custom.junit.runner.Mode;\n+import componenttest.topology.impl.LibertyServer;\n+import componenttest.topology.impl.LibertyServerFactory;\n \n public class BeanDiscoveryModeNoneTest extends LoggingTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca297da3c641962bac9de88225e8b44cad8283e8"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDkxMDc2OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozODoxOVrOH73P-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTozODoxOVrOH73P-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzMzI0Mw==", "bodyText": "If you're not using getSharedServer() then I guess you're not using any of the methods on LoggingTest either?\nIn that case you can probably stop extending LoggingTest.", "url": "https://github.com/OpenLiberty/open-liberty/pull/15126#discussion_r532533243", "createdAt": "2020-11-30T11:38:19Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "diffHunk": "@@ -56,19 +63,25 @@ public static Archive buildShrinkWrap() {\n      * @see com.ibm.ws.fat.LoggingTest#getSharedServer()\n      */\n     @Override\n-    protected ShrinkWrapSharedServer getSharedServer() {\n-        return SHARED_SERVER;\n+    protected SharedServer getSharedServer() {\n+        return null;\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca297da3c641962bac9de88225e8b44cad8283e8"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDkxOTUxOnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0MDoyOVrOH73VBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0MDoyOVrOH73VBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNDUzNA==", "bodyText": "I don't think you need this if block (server will never be null and if the server is not started then stopServer() will just print a message and return)", "url": "https://github.com/OpenLiberty/open-liberty/pull/15126#discussion_r532534534", "createdAt": "2020-11-30T11:40:29Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "diffHunk": "@@ -56,19 +63,25 @@ public static Archive buildShrinkWrap() {\n      * @see com.ibm.ws.fat.LoggingTest#getSharedServer()\n      */\n     @Override\n-    protected ShrinkWrapSharedServer getSharedServer() {\n-        return SHARED_SERVER;\n+    protected SharedServer getSharedServer() {\n+        return null;\n     }\n \n     @Test\n     @ExpectedFFDC({ \"javax.servlet.UnavailableException\", \"com.ibm.wsspi.injectionengine.InjectionException\" })\n     public void testcorrectExceptionThrown() throws Exception {\n-        this.verifyStatusCode(\"/beanDiscoveryModeNone/TestServlet\", 404);\n+        WebBrowser webBrowser = WebBrowserFactory.getInstance().createWebBrowser((File) null);\n+        int statusCode = 404;\n+        int actualStatusCode = webBrowser.request(createURL(\"/beanDiscoveryModeNone/TestServlet\"), statusCode);\n+\n+        if (actualStatusCode != statusCode) {\n+            throw new WebBrowserException(\"The expected status code was not thrown.  Expected \" + statusCode + \", was \" + actualStatusCode);\n+        }\n     }\n \n     @AfterClass\n     public static void tearDown() throws Exception {\n-        if (SHARED_SERVER != null && SHARED_SERVER.getLibertyServer().isStarted()) {\n+        if (server != null && server.isStarted()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca297da3c641962bac9de88225e8b44cad8283e8"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDk0NzU5OnYy", "diffSide": "RIGHT", "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0ODowN1rOH73lWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0ODowN1rOH73lWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzODcxNQ==", "bodyText": "We have a class HttpRequest which can create the URL for you and is a little simpler.\nI think you'd do\nnew HttpRequest(server, \"/beanDiscoveryModeNone/TestServlet\").expectCode(404).run(String.class);", "url": "https://github.com/OpenLiberty/open-liberty/pull/15126#discussion_r532538715", "createdAt": "2020-11-30T11:48:07Z", "author": {"login": "Azquelt"}, "path": "dev/com.ibm.ws.cdi.beansxml_fat/fat/src/com/ibm/ws/cdi12/fat/tests/BeanDiscoveryModeNoneTest.java", "diffHunk": "@@ -56,19 +63,25 @@ public static Archive buildShrinkWrap() {\n      * @see com.ibm.ws.fat.LoggingTest#getSharedServer()\n      */\n     @Override\n-    protected ShrinkWrapSharedServer getSharedServer() {\n-        return SHARED_SERVER;\n+    protected SharedServer getSharedServer() {\n+        return null;\n     }\n \n     @Test\n     @ExpectedFFDC({ \"javax.servlet.UnavailableException\", \"com.ibm.wsspi.injectionengine.InjectionException\" })\n     public void testcorrectExceptionThrown() throws Exception {\n-        this.verifyStatusCode(\"/beanDiscoveryModeNone/TestServlet\", 404);\n+        WebBrowser webBrowser = WebBrowserFactory.getInstance().createWebBrowser((File) null);\n+        int statusCode = 404;\n+        int actualStatusCode = webBrowser.request(createURL(\"/beanDiscoveryModeNone/TestServlet\"), statusCode);\n+\n+        if (actualStatusCode != statusCode) {\n+            throw new WebBrowserException(\"The expected status code was not thrown.  Expected \" + statusCode + \", was \" + actualStatusCode);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca297da3c641962bac9de88225e8b44cad8283e8"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2378, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}