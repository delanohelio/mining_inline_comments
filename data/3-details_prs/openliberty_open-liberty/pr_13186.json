{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3Mjc5MDMx", "number": 13186, "title": "More error message  tidy", "bodyText": "and better exception handling", "createdAt": "2020-07-27T16:44:40Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186", "merged": true, "mergeCommit": {"oid": "6acf2c8787f3e396d22e084c05724653c06b7ac9"}, "closed": true, "closedAt": "2020-07-28T13:33:12Z", "author": {"login": "idlewis"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5EoesAH2gAyNDU3Mjc5MDMxOjkzZTQxMmU0ZDdjMTAwNTc3ODgzNWJlMmQ5NzVlY2NkMDM2ZWUxODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5WnxTgFqTQ1NjY0MTM2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "93e412e4d7c1005778835be2d975eccd036ee184", "author": {"user": {"login": "idlewis", "name": "Ian Lewis"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/93e412e4d7c1005778835be2d975eccd036ee184", "committedDate": "2020-07-27T16:43:36Z", "message": "More error message  tidy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDYzMTM1", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#pullrequestreview-456463135", "createdAt": "2020-07-28T09:31:26Z", "commit": {"oid": "93e412e4d7c1005778835be2d975eccd036ee184"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTozMToyN1rOG4EkRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTozNjo0N1rOG4Excw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ0ODI2MA==", "bodyText": "Don't check isAnyTracingEnabled() when logging errors.\nChecking isErrorEnabled() is not wrong but usually unnecessary, you can assume that errors and warnings are always enabled. The check here would only be for performance anyway.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#discussion_r461448260", "createdAt": "2020-07-28T09:31:27Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.microprofile.lra.1.0.internal/src/io/openliberty/microprofile/lra/internal/LraFilterComponent.java", "diffHunk": "@@ -63,8 +63,9 @@ protected void activate(Map<String, Object> properties) throws LraException {\n             URI coord = new URI(coordString);\n             NarayanaLRAClient.setDefaultCoordinatorEndpoint(coord);\n         } catch (URISyntaxException e) {\n-            // TODO Not sure how to handle config problems yet\n-            Tr.error(tc, \"Things went wrong\");\n+            if (TraceComponent.isAnyTracingEnabled() && tc.isErrorEnabled()) {\n+                Tr.error(tc, \"Invalid LRA coordinator URI: '\" + coordString + \"'\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e412e4d7c1005778835be2d975eccd036ee184"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ0OTkwOQ==", "bodyText": "It's not required but often helpful to include the message code (CWMRX5001E) in the message key (currently LRA_CANT_REGISTER_FILTERS), so that you can search the workspace for the message code and find out where it's produced.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#discussion_r461449909", "createdAt": "2020-07-28T09:34:06Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.microprofile.lra.1.0.internal/resources/io/openliberty/microprofile/lra/internal/resources/Lra.nlsprops", "diffHunk": "@@ -20,3 +20,8 @@\n LRA_INVALID_COORDINATOR_URI=CWMRX5000E: The LRA coordinator URI is invalid\n LRA_INVALID_COORDINATOR_URI.explanation=LRA participants must be able to contact the coordinator\n LRA_INVALID_COORDINATOR_URI.useraction=Correct the LRA coordinator configuration in server.xml\n+\n+\n+LRA_CANT_REGISTER_FILTERS=CWMRX5001E: An error occurred during initialization of the mpLRA-1.0 feature. The error is {0}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e412e4d7c1005778835be2d975eccd036ee184"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ1MTYzNQ==", "bodyText": "Don't check isAnyTrackingEnabled before logging errors or throwing exceptions.\nDon't need to check isErrorEnabled() either.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#discussion_r461451635", "createdAt": "2020-07-28T09:36:47Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.microprofile.lra.1.0.internal/src/io/openliberty/microprofile/lra/internal/LraFilterComponent.java", "diffHunk": "@@ -86,38 +87,33 @@ protected void deactivate(int reason) {\n     @Override\n     public void installProvider(boolean clientSide, List<Object> providers, Set<String> features) {\n         if (TraceComponent.isAnyTracingEnabled() && tc.isEventEnabled()) {\n-            Tr.event(tc, \"Attempting to register LRA filters\");\n+            Tr.event(tc, \"Registering LRA filters\");\n         }\n \n         if (clientSide) {\n-            if (TraceComponent.isAnyTracingEnabled() && tc.isDebugEnabled()) {\n+            if (TraceComponent.isAnyTracingEnabled() && tc.isEventEnabled()) {\n                 Tr.event(tc, \"Registering client side filters\");\n             }\n             ClientLRARequestFilter requestFilter = new ClientLRARequestFilter();\n             providers.add(requestFilter);\n             ClientLRAResponseFilter responseFilter = new ClientLRAResponseFilter();\n             providers.add(responseFilter);\n         } else {\n-            if (TraceComponent.isAnyTracingEnabled() && tc.isDebugEnabled()) {\n+            if (TraceComponent.isAnyTracingEnabled() && tc.isEventEnabled()) {\n                 Tr.event(tc, \"Registering serverside side filters\");\n             }\n-\n-            ServerLRAFilter filter = null;\n             try {\n-                filter = new ServerLRAFilter();\n+                // Rather unhelpfully, the ServerLRAFilter constructor throws 'Exception'. There isn't much we can do with\n+                // that. Re-throwing should prevent the servlet being initialized, which is probably better than swallowing\n+                // the exception\n+                providers.add(new ServerLRAFilter());\n             } catch (Exception e) {\n-\n-                // TODO Do something meaningful\n-\n-                // TODO Auto-generated catch block\n-                // Do you need FFDC here? Remember FFDC instrumentation and @FFDCIgnore\n-                // https://websphere.pok.ibm.com/~alpine/secure/docs/dev/API/com.ibm.ws.ras/com/ibm/ws/ffdc/annotation/FFDCIgnore.html\n-                Tr.error(tc, \"Couldn't register the Server filter\", e);\n-                return;\n+                if (TraceComponent.isAnyTracingEnabled() && tc.isErrorEnabled()) {\n+                    Tr.error(tc, \"Exception during registration of LRA filters\", e);\n+                    throw new LraRuntimeException(Tr.formatMessage(tc, \"LRA_CANT_REGISTER_FILTERS\", e), e);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e412e4d7c1005778835be2d975eccd036ee184"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36be886a41d010be28208569d640887ebe08f174", "author": {"user": {"login": "idlewis", "name": "Ian Lewis"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/36be886a41d010be28208569d640887ebe08f174", "committedDate": "2020-07-28T13:31:09Z", "message": "Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjQxMzY3", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#pullrequestreview-456641367", "createdAt": "2020-07-28T13:40:43Z", "commit": {"oid": "36be886a41d010be28208569d640887ebe08f174"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzo0MDo0M1rOG4NGHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzo0MDo1MlrOG4NGhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU4Nzk5Ng==", "bodyText": "Calls to Tr.error should also be using the translated strings.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#discussion_r461587996", "createdAt": "2020-07-28T13:40:43Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.microprofile.lra.1.0.internal/src/io/openliberty/microprofile/lra/internal/LraFilterComponent.java", "diffHunk": "@@ -63,10 +63,8 @@ protected void activate(Map<String, Object> properties) throws LraException {\n             URI coord = new URI(coordString);\n             NarayanaLRAClient.setDefaultCoordinatorEndpoint(coord);\n         } catch (URISyntaxException e) {\n-            if (TraceComponent.isAnyTracingEnabled() && tc.isErrorEnabled()) {\n-                Tr.error(tc, \"Invalid LRA coordinator URI: '\" + coordString + \"'\");\n-            }\n-            throw new LraException(Tr.formatMessage(tc, \"LRA_INVALID_COORDINATOR_URI\"), e);\n+            Tr.error(tc, \"Invalid LRA coordinator URI: '\" + coordString + \"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36be886a41d010be28208569d640887ebe08f174"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU4ODEwMg==", "bodyText": "Calls to Tr.error should also be using the translated strings.", "url": "https://github.com/OpenLiberty/open-liberty/pull/13186#discussion_r461588102", "createdAt": "2020-07-28T13:40:52Z", "author": {"login": "Azquelt"}, "path": "dev/io.openliberty.microprofile.lra.1.0.internal/src/io/openliberty/microprofile/lra/internal/LraFilterComponent.java", "diffHunk": "@@ -108,10 +106,8 @@ public void installProvider(boolean clientSide, List<Object> providers, Set<Stri\n                 // the exception\n                 providers.add(new ServerLRAFilter());\n             } catch (Exception e) {\n-                if (TraceComponent.isAnyTracingEnabled() && tc.isErrorEnabled()) {\n-                    Tr.error(tc, \"Exception during registration of LRA filters\", e);\n-                    throw new LraRuntimeException(Tr.formatMessage(tc, \"LRA_CANT_REGISTER_FILTERS\", e), e);\n-                }\n+                Tr.error(tc, \"Exception during registration of LRA filters\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36be886a41d010be28208569d640887ebe08f174"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2040, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}