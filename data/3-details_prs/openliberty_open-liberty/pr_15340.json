{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMjE3NzQ4", "number": 15340, "title": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset", "bodyText": "The error occurs while we are setting up the CXF Message for processing by the PhaseInterceptorChain. The exception is thrown back to Webcontainer before we can process it ourselves. Since JAX-RS can't process the exception, Webcontainer has to process it, however, webcontainer doesn't know what to do, so it sets the error code to HTTP 500 in WebAppErrorReport.constructErrorReport()\nI added the new Webcontainer Exception: InvalidMediaTypeException so that I could throw it from an exception from JAX-RS  that webcontainer would understand and map it to a 415 response code in WebAppErrorReport.constructErrorReport().\nBy adding InvalidMediaTypeException to Webcontainer, I avoid any JAX-RS dependencies in Webcontainer and can send back a better response code than HTTP 500.\nI also created 2 tests:\n\nOne tests that a Content-Type with and invalid charset properly returns HTTP 415\nOne tests that an invalid json payload returns an HTTP 400\n\nI had previously gotten the invalid payload scenario to work, but wanted a test to compare why the JAX-RS exceptions were being mapped for an invalid payload and not in the case of an invalid Content-Type header.\nThe difference is that the invalid payload gets processed in the PhaseInterceptorChain, which handles sending the response, whereas invalid Content-Type throws an exception back to Webcontainer during setup and relies on Webcontainer to return the response.", "createdAt": "2020-12-18T00:39:56Z", "url": "https://github.com/OpenLiberty/open-liberty/pull/15340", "merged": true, "mergeCommit": {"oid": "9768b44c34c7d6e770f47492bbdbc536d034bb8d"}, "closed": true, "closedAt": "2020-12-22T15:54:12Z", "author": {"login": "WhiteCat22"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnNrMzAFqTU1NTEwODEwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnctqdAFqTU1NTcyOTMwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MTA4MTAy", "url": "https://github.com/OpenLiberty/open-liberty/pull/15340#pullrequestreview-555108102", "createdAt": "2020-12-18T01:16:14Z", "commit": {"oid": "eff59c51ccff9184178f0c042474a171c47bbe05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NTIwODUy", "url": "https://github.com/OpenLiberty/open-liberty/pull/15340#pullrequestreview-555520852", "createdAt": "2020-12-18T14:19:42Z", "commit": {"oid": "eff59c51ccff9184178f0c042474a171c47bbe05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoxOTo0MlrOIIkniw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoxOTo0MlrOIIkniw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1OTQ2Nw==", "bodyText": "Why remove this FFDC?", "url": "https://github.com/OpenLiberty/open-liberty/pull/15340#discussion_r545859467", "createdAt": "2020-12-18T14:19:42Z", "author": {"login": "pmd1nh"}, "path": "dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/filter/WebAppFilterManager.java", "diffHunk": "@@ -1358,11 +1357,6 @@ else if (servletWrapper instanceof GenericServletWrapper){\n //            if (!invokedAsyncErrorHandling){\n             ServletErrorReport errorReport = WebAppErrorReport.constructErrorReport(re, dispatchContext.getCurrentServletReference());\n             dispatchContext.pushException(re);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eff59c51ccff9184178f0c042474a171c47bbe05"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eff59c51ccff9184178f0c042474a171c47bbe05", "author": {"user": {"login": "WhiteCat22", "name": "Adam Anderson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/eff59c51ccff9184178f0c042474a171c47bbe05", "committedDate": "2020-12-18T00:26:07Z", "message": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset"}, "afterCommit": {"oid": "aa76215c4ff385234138c794bf003934a3f3a9f4", "author": {"user": {"login": "WhiteCat22", "name": "Adam Anderson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aa76215c4ff385234138c794bf003934a3f3a9f4", "committedDate": "2020-12-18T16:51:32Z", "message": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd60a835fc1bc63a6bfc2859f0c6fccbeff65a1", "author": {"user": {"login": "WhiteCat22", "name": "Adam Anderson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/bbd60a835fc1bc63a6bfc2859f0c6fccbeff65a1", "committedDate": "2020-12-18T16:54:23Z", "message": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa76215c4ff385234138c794bf003934a3f3a9f4", "author": {"user": {"login": "WhiteCat22", "name": "Adam Anderson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/aa76215c4ff385234138c794bf003934a3f3a9f4", "committedDate": "2020-12-18T16:51:32Z", "message": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset"}, "afterCommit": {"oid": "bbd60a835fc1bc63a6bfc2859f0c6fccbeff65a1", "author": {"user": {"login": "WhiteCat22", "name": "Adam Anderson"}}, "url": "https://github.com/OpenLiberty/open-liberty/commit/bbd60a835fc1bc63a6bfc2859f0c6fccbeff65a1", "committedDate": "2020-12-18T16:54:23Z", "message": "11793 - return HTTP 415 when JAX-RS request Content-Type header contains an invalid charset"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzI5MzA3", "url": "https://github.com/OpenLiberty/open-liberty/pull/15340#pullrequestreview-555729307", "createdAt": "2020-12-18T18:47:31Z", "commit": {"oid": "bbd60a835fc1bc63a6bfc2859f0c6fccbeff65a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2659, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}