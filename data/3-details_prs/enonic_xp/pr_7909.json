{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MTI1OTE4", "number": 7909, "title": "Use Hazelcast for Events Tasks and sessions #7752", "bodyText": "", "createdAt": "2020-02-24T17:56:02Z", "url": "https://github.com/enonic/xp/pull/7909", "merged": true, "mergeCommit": {"oid": "dab35790489c4e6fe9e89ed59f8baecc2329d4c3"}, "closed": true, "closedAt": "2020-03-03T07:16:34Z", "author": {"login": "rymsha"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHtb2bAFqTM2MzkzMTE1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ9AbwgFqTM2NDcwMDYwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTMxMTUx", "url": "https://github.com/enonic/xp/pull/7909#pullrequestreview-363931151", "createdAt": "2020-02-25T07:59:42Z", "commit": {"oid": "e360c67141c9863cc08080783e8f435ac0bfbb06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo1OTo0MlrOFt7zrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo1OTo0MlrOFt7zrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcxMDEyNQ==", "bodyText": "@rymsha why do you use two times @Activate annotation?", "url": "https://github.com/enonic/xp/pull/7909#discussion_r383710125", "createdAt": "2020-02-25T07:59:42Z", "author": {"login": "anatol-sialitski"}, "path": "modules/core/core-event/src/main/java/com/enonic/xp/core/impl/event/cluster/ClusterEventReceiver.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.enonic.xp.core.impl.event.cluster;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.ITopic;\n+import com.hazelcast.core.Message;\n+import com.hazelcast.core.MessageListener;\n+\n+import com.enonic.xp.event.Event;\n+import com.enonic.xp.event.EventPublisher;\n+\n+@Component(immediate = true)\n+public final class ClusterEventReceiver\n+    implements MessageListener<Event>\n+{\n+    private final EventPublisher eventPublisher;\n+\n+    private final ITopic<Event> topic;\n+\n+    private String registrationId;\n+\n+    @Activate\n+    public ClusterEventReceiver( @Reference final HazelcastInstance hazelcastInstance, @Reference final EventPublisher eventPublisher )\n+    {\n+        this.topic = hazelcastInstance.getTopic( ClusterEventSender.ACTION );\n+        this.eventPublisher = eventPublisher;\n+    }\n+\n+    @Activate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e360c67141c9863cc08080783e8f435ac0bfbb06"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e360c67141c9863cc08080783e8f435ac0bfbb06", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/e360c67141c9863cc08080783e8f435ac0bfbb06", "committedDate": "2020-02-24T17:55:05Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}, "afterCommit": {"oid": "5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "committedDate": "2020-02-25T09:47:29Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "committedDate": "2020-02-25T09:47:29Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}, "afterCommit": {"oid": "c461c933c2233bd1828d8af6c4dd37ddfe297712", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c461c933c2233bd1828d8af6c4dd37ddfe297712", "committedDate": "2020-02-26T08:27:26Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c461c933c2233bd1828d8af6c4dd37ddfe297712", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c461c933c2233bd1828d8af6c4dd37ddfe297712", "committedDate": "2020-02-26T08:27:26Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}, "afterCommit": {"oid": "aa30902a7e1484d39a3b0128427c5100f631d301", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/aa30902a7e1484d39a3b0128427c5100f631d301", "committedDate": "2020-02-27T12:25:28Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35f06cb57fb220ebb36f991f55165686b46c3887", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/35f06cb57fb220ebb36f991f55165686b46c3887", "committedDate": "2020-02-27T13:28:32Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa30902a7e1484d39a3b0128427c5100f631d301", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/aa30902a7e1484d39a3b0128427c5100f631d301", "committedDate": "2020-02-27T12:25:28Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}, "afterCommit": {"oid": "35f06cb57fb220ebb36f991f55165686b46c3887", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/35f06cb57fb220ebb36f991f55165686b46c3887", "committedDate": "2020-02-27T13:28:32Z", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MjExMDg5", "url": "https://github.com/enonic/xp/pull/7909#pullrequestreview-367211089", "createdAt": "2020-03-02T13:50:49Z", "commit": {"oid": "35f06cb57fb220ebb36f991f55165686b46c3887"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NzAwNjAw", "url": "https://github.com/enonic/xp/pull/7909#pullrequestreview-364700600", "createdAt": "2020-02-26T08:33:05Z", "commit": {"oid": "5ac55d2646ac6f7680ea634f6cd0020f0539b1aa"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwODozNDoxMVrOFuiIjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwODozNjo1OFrOFuiNog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMzODA2Mg==", "bodyText": "I guess will be better to rename ACTION to TOPIC", "url": "https://github.com/enonic/xp/pull/7909#discussion_r384338062", "createdAt": "2020-02-26T08:34:11Z", "author": {"login": "anatol-sialitski"}, "path": "modules/core/core-event/src/main/java/com/enonic/xp/core/impl/event/cluster/ClusterEventSender.java", "diffHunk": "@@ -18,47 +16,20 @@\n {\n     public static final String ACTION = \"xp/event\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c461c933c2233bd1828d8af6c4dd37ddfe297712"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMzOTM2Mg==", "bodyText": "I guess will be better to rename ACTION to EXECUTOR_SERVICE", "url": "https://github.com/enonic/xp/pull/7909#discussion_r384339362", "createdAt": "2020-02-26T08:36:58Z", "author": {"login": "anatol-sialitski"}, "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/ClusteredTaskManagerImpl.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.enonic.xp.impl.task;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.IExecutorService;\n+import com.hazelcast.core.Member;\n+import com.hazelcast.util.ExceptionUtil;\n+\n+import com.enonic.xp.impl.task.distributed.AllTasksReporter;\n+import com.enonic.xp.impl.task.distributed.RunningTasksReporter;\n+import com.enonic.xp.impl.task.distributed.SerializableFunction;\n+import com.enonic.xp.impl.task.distributed.SingleTaskReporter;\n+import com.enonic.xp.impl.task.distributed.TasksReporterCallable;\n+import com.enonic.xp.task.TaskId;\n+import com.enonic.xp.task.TaskInfo;\n+\n+@Component\n+public final class ClusteredTaskManagerImpl\n+    implements ClusteredTaskManager\n+{\n+    private static final long TRANSPORT_REQUEST_TIMEOUT_SECONDS = 5L;\n+\n+    public static final String ACTION = \"xp/task\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c461c933c2233bd1828d8af6c4dd37ddfe297712"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4473, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}