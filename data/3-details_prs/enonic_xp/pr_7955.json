{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTMzODQ3", "number": 7955, "title": "Don't use deep pagination to fetch all entries #7139", "bodyText": "optimizations made reduce GC (for instance NodeBranchEntries\nCPU usage optimizations (UUID)\nRemove unused code\nadded gt and lt ability for Range Filter (it was always gte and lte before)\ndeep paging replaced with either scroll (to get all ids in one go)\nor by simulating \"search after\" https://www.elastic.co/guide/en/elasticsearch/reference/7.x/search-request-body.html#request-body-search-search-after\n\nthere is new configuration parameter for vacuum versionsBatchSize which defaults to 10000 (which is equal to default index.max_result_window value in elasticsearch). without it users would not be able to reduce index.max_result_window value without breaking vacuum.\nVacuum should now work with any number of Versions.\nDump works with 500K Nodes (requires 1 GiB heap)\nReindex works with 500K Nodes (requires 2 GiB heap)", "createdAt": "2020-03-13T19:09:16Z", "url": "https://github.com/enonic/xp/pull/7955", "merged": true, "mergeCommit": {"oid": "17aad8821c7054ba4c780293091d0b7a9ce236c1"}, "closed": true, "closedAt": "2020-03-18T06:59:35Z", "author": {"login": "rymsha"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNWZ1xABqjMxMjgxMDU3ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOkDdbgFqTM3NjExODgwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74778e36cfe04d12426cb6624f4e3eaf817ba4dc", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/74778e36cfe04d12426cb6624f4e3eaf817ba4dc", "committedDate": "2020-03-13T19:06:35Z", "message": "Don't use deep pagination to fetch all entries #7139"}, "afterCommit": {"oid": "1f4dc3fc84f936de85e849d5e6bcd7a700ced02e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/1f4dc3fc84f936de85e849d5e6bcd7a700ced02e", "committedDate": "2020-03-13T20:33:05Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f4dc3fc84f936de85e849d5e6bcd7a700ced02e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/1f4dc3fc84f936de85e849d5e6bcd7a700ced02e", "committedDate": "2020-03-13T20:33:05Z", "message": "Don't use deep pagination to fetch all entries #7139"}, "afterCommit": {"oid": "80944b4d272cd15d0a9cb34f4031b267c240a0a2", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/80944b4d272cd15d0a9cb34f4031b267c240a0a2", "committedDate": "2020-03-13T20:57:56Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14f9a6a7d09160a1117f7eca04aca0109e188b5c", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/14f9a6a7d09160a1117f7eca04aca0109e188b5c", "committedDate": "2020-03-14T10:00:41Z", "message": "write reindex load test. Reindex is broken!"}, "afterCommit": {"oid": "be82917dad43eab3d2a4f6659c997a4c06f1c80f", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/be82917dad43eab3d2a4f6659c997a4c06f1c80f", "committedDate": "2020-03-14T10:48:41Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be82917dad43eab3d2a4f6659c997a4c06f1c80f", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/be82917dad43eab3d2a4f6659c997a4c06f1c80f", "committedDate": "2020-03-14T10:48:41Z", "message": "Don't use deep pagination to fetch all entries #7139"}, "afterCommit": {"oid": "cb1caf013e750efed17ab9f18f46869ba5440e5e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/cb1caf013e750efed17ab9f18f46869ba5440e5e", "committedDate": "2020-03-14T11:39:17Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MTA3OTE0", "url": "https://github.com/enonic/xp/pull/7955#pullrequestreview-375107914", "createdAt": "2020-03-16T11:03:09Z", "commit": {"oid": "cb1caf013e750efed17ab9f18f46869ba5440e5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTowMzowOVrOF2vH2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMTowMzowOVrOF2vH2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkzOTQ4Mg==", "bodyText": "looks like   size( NodeSearchService.GET_ALL_SIZE_FLAG )  should be used.", "url": "https://github.com/enonic/xp/pull/7955#discussion_r392939482", "createdAt": "2020-03-16T11:03:09Z", "author": {"login": "vbradnitski"}, "path": "modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/dump/RepoDumper.java", "diffHunk": "@@ -197,25 +188,17 @@ private void dumpCommits()\n \n             final NodeCommitQuery nodeCommitQuery = NodeCommitQuery.create().build();\n \n-            final BatchedGetCommitsExecutor executor = BatchedGetCommitsExecutor.create().\n-                nodeService( this.nodeService ).\n-                query( nodeCommitQuery ).\n-                batchSize( DEFAULT_BATCH_SIZE ).\n-                build();\n-\n-            while ( executor.hasMore() )\n-            {\n-                final NodeCommitEntries nodeCommitEntries = executor.execute();\n-\n-                nodeCommitEntries.stream().\n-                    map( nodeCommitEntry -> CommitDumpEntry.create().\n-                        nodeCommitId( nodeCommitEntry.getNodeCommitId() ).\n-                        message( nodeCommitEntry.getMessage() ).\n-                        committer( nodeCommitEntry.getCommitter() ).\n-                        timestamp( nodeCommitEntry.getTimestamp() ).\n-                        build() ).\n-                    forEach( this.writer::writeCommitEntry );\n-            }\n+            final NodeCommitEntries nodeCommitEntries = this.nodeService.findCommits( nodeCommitQuery ).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb1caf013e750efed17ab9f18f46869ba5440e5e"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62018bc8dade5edaefcade95d88bf16907b55240", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/62018bc8dade5edaefcade95d88bf16907b55240", "committedDate": "2020-03-17T08:40:48Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb1caf013e750efed17ab9f18f46869ba5440e5e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/cb1caf013e750efed17ab9f18f46869ba5440e5e", "committedDate": "2020-03-14T11:39:17Z", "message": "Don't use deep pagination to fetch all entries #7139"}, "afterCommit": {"oid": "62018bc8dade5edaefcade95d88bf16907b55240", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/62018bc8dade5edaefcade95d88bf16907b55240", "committedDate": "2020-03-17T08:40:48Z", "message": "Don't use deep pagination to fetch all entries #7139"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTI5MDI1", "url": "https://github.com/enonic/xp/pull/7955#pullrequestreview-375929025", "createdAt": "2020-03-17T10:58:22Z", "commit": {"oid": "62018bc8dade5edaefcade95d88bf16907b55240"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTE4ODA3", "url": "https://github.com/enonic/xp/pull/7955#pullrequestreview-376118807", "createdAt": "2020-03-17T15:01:23Z", "commit": {"oid": "62018bc8dade5edaefcade95d88bf16907b55240"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4484, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}