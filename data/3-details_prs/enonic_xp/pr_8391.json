{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMzY1OTAx", "number": 8391, "title": "getVersionsForView API doesn't return unpublished version #8314", "bodyText": "", "createdAt": "2020-09-21T15:01:26Z", "url": "https://github.com/enonic/xp/pull/8391", "merged": true, "mergeCommit": {"oid": "5ee528f6a5ef189b1b1114e70d4188a96d2b747e"}, "closed": true, "closedAt": "2020-09-23T14:17:05Z", "author": {"login": "vbradnitski"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLFNZxABqjM3ODkzMTQyNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLtQJZAFqTQ5NDcwNjczMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a818507019bf9cf3033554fe5f8848a9cf0e8a7e", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/a818507019bf9cf3033554fe5f8848a9cf0e8a7e", "committedDate": "2020-09-21T14:59:28Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "5d62a1433a26f5d412f293819ea1dbabd90a531b", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/5d62a1433a26f5d412f293819ea1dbabd90a531b", "committedDate": "2020-09-21T15:34:21Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODMyMDg1", "url": "https://github.com/enonic/xp/pull/8391#pullrequestreview-492832085", "createdAt": "2020-09-21T17:28:28Z", "commit": {"oid": "5d62a1433a26f5d412f293819ea1dbabd90a531b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyODoyOFrOHVbPMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyODoyOFrOHVbPMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyODQwMw==", "bodyText": "Leave alone this broken implementation (Deprecate?). Write a separate Comparator. Also See #7440", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492228403", "createdAt": "2020-09-21T17:28:28Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersion.java", "diffHunk": "@@ -76,14 +76,34 @@ public static Builder create()\n     }\n \n     @Override\n-    public int compareTo( final ContentVersion o )\n+    public int compareTo( final ContentVersion that )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d62a1433a26f5d412f293819ea1dbabd90a531b"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d62a1433a26f5d412f293819ea1dbabd90a531b", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/5d62a1433a26f5d412f293819ea1dbabd90a531b", "committedDate": "2020-09-21T15:34:21Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "624a59621891635aafd862280dec22bb501a31b1", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/624a59621891635aafd862280dec22bb501a31b1", "committedDate": "2020-09-22T10:19:09Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "624a59621891635aafd862280dec22bb501a31b1", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/624a59621891635aafd862280dec22bb501a31b1", "committedDate": "2020-09-22T10:19:09Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/f04c3bfc77a0418a1b7875520801c096d71d4d98", "committedDate": "2020-09-22T10:41:18Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzgyNTM4", "url": "https://github.com/enonic/xp/pull/8391#pullrequestreview-493382538", "createdAt": "2020-09-22T11:57:38Z", "commit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMTo1NzozOFrOHV2gKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjowODo0M1rOHV23Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NTExMg==", "bodyText": "Instant is Comparable", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492675112", "createdAt": "2020-09-22T11:57:38Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersion.java", "diffHunk": "@@ -1,15 +1,49 @@\n package com.enonic.xp.content;\n \n import java.time.Instant;\n+import java.util.Comparator;\n import java.util.Objects;\n \n import com.enonic.xp.annotation.PublicApi;\n import com.enonic.xp.security.PrincipalKey;\n \n @PublicApi\n public class ContentVersion\n-    implements Comparable<ContentVersion>\n {\n+    public static final Comparator<ContentVersion> COMPARATOR = ( final ContentVersion thisVersion, final ContentVersion thatVersion ) -> {\n+        Instant thisTime, thatTime;\n+\n+        if ( thisVersion.publishInfo != null && thisVersion.publishInfo.getTimestamp() != null )\n+        {\n+            thisTime = thisVersion.publishInfo.getTimestamp();\n+        }\n+        else\n+        {\n+            thisTime = thisVersion.modified;\n+\n+        }\n+        if ( thatVersion.publishInfo != null && thatVersion.publishInfo.getTimestamp() != null )\n+        {\n+            thatTime = thatVersion.publishInfo.getTimestamp();\n+        }\n+        else\n+        {\n+            thatTime = thatVersion.modified;\n+        }\n+\n+        if ( Objects.equals( thisTime, thatTime ) )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NTcxMQ==", "bodyText": "Try to expose commit field and use it instead", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492675711", "createdAt": "2020-09-22T11:58:47Z", "author": {"login": "rymsha"}, "path": "modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/GetContentVersionsForViewResultJson.java", "diffHunk": "@@ -90,7 +90,8 @@ private ContentVersions filterContentVersions( final FindContentVersionsResult a\n         while ( iterator.hasNext() )\n         {\n             final ContentVersion contentVersion = iterator.next();\n-            if ( Math.abs( previouslyAdded.getModified().toEpochMilli() - contentVersion.getModified().toEpochMilli() ) > msRangeFilter )\n+            if ( Math.abs( previouslyAdded.getModified().toEpochMilli() - contentVersion.getModified().toEpochMilli() ) > msRangeFilter ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NTg1OA==", "bodyText": "Out from this class", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492675858", "createdAt": "2020-09-22T11:59:04Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ActiveContentVersionEntry.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.enonic.xp.content;\n \n+import java.util.Comparator;\n+\n import com.enonic.xp.annotation.PublicApi;\n import com.enonic.xp.branch.Branch;\n \n @PublicApi\n public class ActiveContentVersionEntry\n-    implements Comparable<ActiveContentVersionEntry>\n {\n+    public static final Comparator<ActiveContentVersionEntry> COMPARATOR = Comparator.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NTkxNA==", "bodyText": "restore", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492675914", "createdAt": "2020-09-22T11:59:09Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ActiveContentVersionEntry.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.enonic.xp.content;\n \n+import java.util.Comparator;\n+\n import com.enonic.xp.annotation.PublicApi;\n import com.enonic.xp.branch.Branch;\n \n @PublicApi\n public class ActiveContentVersionEntry\n-    implements Comparable<ActiveContentVersionEntry>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NjAxNg==", "bodyText": "Out of this class", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492676016", "createdAt": "2020-09-22T11:59:20Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersion.java", "diffHunk": "@@ -1,15 +1,49 @@\n package com.enonic.xp.content;\n \n import java.time.Instant;\n+import java.util.Comparator;\n import java.util.Objects;\n \n import com.enonic.xp.annotation.PublicApi;\n import com.enonic.xp.security.PrincipalKey;\n \n @PublicApi\n public class ContentVersion\n-    implements Comparable<ContentVersion>\n {\n+    public static final Comparator<ContentVersion> COMPARATOR = ( final ContentVersion thisVersion, final ContentVersion thatVersion ) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3NjA2MA==", "bodyText": "restore", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492676060", "createdAt": "2020-09-22T11:59:26Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersion.java", "diffHunk": "@@ -1,15 +1,49 @@\n package com.enonic.xp.content;\n \n import java.time.Instant;\n+import java.util.Comparator;\n import java.util.Objects;\n \n import com.enonic.xp.annotation.PublicApi;\n import com.enonic.xp.security.PrincipalKey;\n \n @PublicApi\n public class ContentVersion\n-    implements Comparable<ContentVersion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY4MDEwMw==", "bodyText": "Use list with sort", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492680103", "createdAt": "2020-09-22T12:06:58Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersions.java", "diffHunk": "@@ -18,7 +16,7 @@\n \n     private ContentVersions( Builder builder )\n     {\n-        contentVersions = ImmutableSortedSet.copyOf( builder.contentVersions );\n+        contentVersions = builder.contentVersions.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY4MTAyNg==", "bodyText": "Use list with sort", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492681026", "createdAt": "2020-09-22T12:08:43Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/GetActiveContentVersionsResult.java", "diffHunk": "@@ -14,7 +11,7 @@\n \n     private GetActiveContentVersionsResult( final Builder builder )\n     {\n-        this.activeContentVersions = ImmutableSortedSet.copyOf( builder.activeContentVersions );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f04c3bfc77a0418a1b7875520801c096d71d4d98", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/f04c3bfc77a0418a1b7875520801c096d71d4d98", "committedDate": "2020-09-22T10:41:18Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "76c1a2ecb10bad3bcdd83339fcc0a62fc127a52e", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/76c1a2ecb10bad3bcdd83339fcc0a62fc127a52e", "committedDate": "2020-09-22T13:51:33Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76c1a2ecb10bad3bcdd83339fcc0a62fc127a52e", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/76c1a2ecb10bad3bcdd83339fcc0a62fc127a52e", "committedDate": "2020-09-22T13:51:33Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "c96741aa083ef626758189d54e53673385595b8f", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/c96741aa083ef626758189d54e53673385595b8f", "committedDate": "2020-09-22T14:00:51Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzIyNTc1", "url": "https://github.com/enonic/xp/pull/8391#pullrequestreview-493722575", "createdAt": "2020-09-22T18:09:46Z", "commit": {"oid": "c96741aa083ef626758189d54e53673385595b8f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODowOTo0NlrOHWGbRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxODoxMDo1MlrOHWGd9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkzNjAwNQ==", "bodyText": "final\nOr maybe even internal of ContentVersions, because it is an implementation detail", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492936005", "createdAt": "2020-09-22T18:09:46Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersionDateComparator.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.enonic.xp.content;\n+\n+import java.time.Instant;\n+import java.util.Comparator;\n+\n+public class ContentVersionDateComparator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c96741aa083ef626758189d54e53673385595b8f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjkzNjY5NQ==", "bodyText": "Let's have a second round of if/how we want to expose id", "url": "https://github.com/enonic/xp/pull/8391#discussion_r492936695", "createdAt": "2020-09-22T18:10:52Z", "author": {"login": "rymsha"}, "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/ContentVersion.java", "diffHunk": "@@ -151,6 +165,8 @@ public int hashCode()\n \n         private WorkflowInfo workflowInfo;\n \n+        private NodeCommitId nodeCommitId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c96741aa083ef626758189d54e53673385595b8f"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c96741aa083ef626758189d54e53673385595b8f", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/c96741aa083ef626758189d54e53673385595b8f", "committedDate": "2020-09-22T14:00:51Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "f8966caccf444cff9bf6706ce0e136fbe441bf86", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/f8966caccf444cff9bf6706ce0e136fbe441bf86", "committedDate": "2020-09-23T09:29:48Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "128d605bf7f1b8fb8aba8a788956d341a88fd948", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/128d605bf7f1b8fb8aba8a788956d341a88fd948", "committedDate": "2020-09-23T10:04:00Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8966caccf444cff9bf6706ce0e136fbe441bf86", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/f8966caccf444cff9bf6706ce0e136fbe441bf86", "committedDate": "2020-09-23T09:29:48Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}, "afterCommit": {"oid": "128d605bf7f1b8fb8aba8a788956d341a88fd948", "author": {"user": {"login": "vbradnitski", "name": "Bradnitski Viachaslau"}}, "url": "https://github.com/enonic/xp/commit/128d605bf7f1b8fb8aba8a788956d341a88fd948", "committedDate": "2020-09-23T10:04:00Z", "message": "getVersionsForView API doesn't return unpublished version #8314"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTEwMDM3", "url": "https://github.com/enonic/xp/pull/8391#pullrequestreview-494510037", "createdAt": "2020-09-23T10:18:22Z", "commit": {"oid": "128d605bf7f1b8fb8aba8a788956d341a88fd948"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NzA2NzMw", "url": "https://github.com/enonic/xp/pull/8391#pullrequestreview-494706730", "createdAt": "2020-09-23T14:13:46Z", "commit": {"oid": "128d605bf7f1b8fb8aba8a788956d341a88fd948"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4383, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}