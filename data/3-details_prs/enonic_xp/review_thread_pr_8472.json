{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MDUwMDA0", "number": 8472, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzowMzo0NlrOE4QiFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzowMzo0NlrOE4QiFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NDI2NTgwOnYy", "diffSide": "RIGHT", "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/MemberAttributesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzowMzo0NlrOHyEoNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNzo0Njo0NFrOHyhyEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NjY3OQ==", "bodyText": "Check that all attributes removed", "url": "https://github.com/enonic/xp/pull/8472#discussion_r522266679", "createdAt": "2020-11-12T17:03:46Z", "author": {"login": "rymsha"}, "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/MemberAttributesApplier.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.enonic.xp.impl.task;\n+\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.BundleEvent;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Modified;\n+import org.osgi.service.component.annotations.Reference;\n+import org.osgi.util.tracker.BundleTracker;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.Member;\n+\n+import com.enonic.xp.app.ApplicationBundleUtils;\n+\n+@Component\n+public class MemberAttributesApplier\n+    extends BundleTracker<Boolean>\n+{\n+    static final String TASKS_ENABLED_ATTRIBUTE_KEY = \"tasks-enabled\";\n+\n+    static final String TASKS_ENABLED_ATTRIBUTE_PREFIX = TASKS_ENABLED_ATTRIBUTE_KEY + \"-\";\n+\n+    private final Member localMember;\n+\n+    @Activate\n+    public MemberAttributesApplier( final BundleContext context, @Reference final HazelcastInstance hazelcastInstance )\n+    {\n+        super( context, Bundle.ACTIVE, null );\n+        this.localMember = hazelcastInstance.getCluster().getLocalMember();\n+    }\n+\n+    @Activate\n+    public void activate( final TaskConfig config )\n+    {\n+        localMember.setBooleanAttribute( TASKS_ENABLED_ATTRIBUTE_KEY, config.offload_acceptInbound() );\n+        super.open();\n+    }\n+\n+    @Deactivate\n+    public void deactivate()\n+    {\n+        super.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc0NDMzOQ==", "bodyText": "yes, removedBundle called on close", "url": "https://github.com/enonic/xp/pull/8472#discussion_r522744339", "createdAt": "2020-11-13T07:46:44Z", "author": {"login": "rymsha"}, "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/MemberAttributesApplier.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.enonic.xp.impl.task;\n+\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.BundleEvent;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Modified;\n+import org.osgi.service.component.annotations.Reference;\n+import org.osgi.util.tracker.BundleTracker;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.Member;\n+\n+import com.enonic.xp.app.ApplicationBundleUtils;\n+\n+@Component\n+public class MemberAttributesApplier\n+    extends BundleTracker<Boolean>\n+{\n+    static final String TASKS_ENABLED_ATTRIBUTE_KEY = \"tasks-enabled\";\n+\n+    static final String TASKS_ENABLED_ATTRIBUTE_PREFIX = TASKS_ENABLED_ATTRIBUTE_KEY + \"-\";\n+\n+    private final Member localMember;\n+\n+    @Activate\n+    public MemberAttributesApplier( final BundleContext context, @Reference final HazelcastInstance hazelcastInstance )\n+    {\n+        super( context, Bundle.ACTIVE, null );\n+        this.localMember = hazelcastInstance.getCluster().getLocalMember();\n+    }\n+\n+    @Activate\n+    public void activate( final TaskConfig config )\n+    {\n+        localMember.setBooleanAttribute( TASKS_ENABLED_ATTRIBUTE_KEY, config.offload_acceptInbound() );\n+        super.open();\n+    }\n+\n+    @Deactivate\n+    public void deactivate()\n+    {\n+        super.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NjY3OQ=="}, "originalCommit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 963, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}