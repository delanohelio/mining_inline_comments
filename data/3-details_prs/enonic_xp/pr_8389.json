{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjA3MjY5", "number": 8389, "title": "Extend VHost API #8374", "bodyText": "", "createdAt": "2020-09-21T10:52:26Z", "url": "https://github.com/enonic/xp/pull/8389", "merged": true, "mergeCommit": {"oid": "4f4ddf8adc54a538510e6f4633c64f2be8ebfae1"}, "closed": true, "closedAt": "2020-10-12T09:09:01Z", "author": {"login": "anatol-sialitski"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLBmEGgFqTQ5MjQ5NjA5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL-6s3AFqTQ5NTQ0NDI4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDk2MDk2", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-492496096", "createdAt": "2020-09-21T11:21:16Z", "commit": {"oid": "338c3d489b2eba8dc8a79c6cef9e503c6ec13e57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMToyMToxN1rOHVLLLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMToyMToxN1rOHVLLLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2NTIzMQ==", "bodyText": "isEnabled, getVirtualHost, getVirtualHosts should be in a different service (VirtualHostConfigService)\nresolve should stay here.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r491965231", "createdAt": "2020-09-21T11:21:17Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostService.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.enonic.xp.web.vhost;\n+\n+import java.util.List;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+public interface VirtualHostService\n+{\n+\n+    boolean isEnabled();\n+\n+    VirtualHost getVirtualHost( final String name );\n+\n+    List<VirtualHost> getVirtualHosts();\n+\n+    VirtualHost resolve( final HttpServletRequest req );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "338c3d489b2eba8dc8a79c6cef9e503c6ec13e57"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "338c3d489b2eba8dc8a79c6cef9e503c6ec13e57", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/338c3d489b2eba8dc8a79c6cef9e503c6ec13e57", "committedDate": "2020-09-21T10:47:53Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/7509ff8dc02d387bf41db673348b7e81fa3a022d", "committedDate": "2020-09-21T12:45:42Z", "message": "Extend VHost API #8374"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTc0MjYx", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-492574261", "createdAt": "2020-09-21T12:59:10Z", "commit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo1OToxMFrOHVO00w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMzowMjoxNlrOHVO7_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNTA0Mw==", "bodyText": "extract class. Use Comparator.comparing.thenComparing", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492025043", "createdAt": "2020-09-21T12:59:10Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +36,33 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( ( virtualHostMapping, otherVirtualHostMapping ) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNjg3OQ==", "bodyText": "I now hardly see a need for such an API method.\n\nIn java one can easily use streams\nin js one can use find", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492026879", "createdAt": "2020-09-21T13:02:16Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostServiceImpl.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.enonic.xp.web.vhost.impl;\n+\n+import java.util.List;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostConfigService;\n+import com.enonic.xp.web.vhost.impl.config.VirtualHostConfig;\n+\n+@Component(immediate = true)\n+public class VirtualHostServiceImpl\n+    implements VirtualHostConfigService\n+{\n+\n+    private VirtualHostConfig virtualHostConfig;\n+\n+    @Activate\n+    public VirtualHostServiceImpl( @Reference final VirtualHostConfig virtualHostConfig )\n+    {\n+        this.virtualHostConfig = virtualHostConfig;\n+    }\n+\n+    @Override\n+    public boolean isEnabled()\n+    {\n+        return virtualHostConfig.isEnabled();\n+    }\n+\n+    @Override\n+    public VirtualHost getVirtualHost( final String name )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODI2Njc1", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-492826675", "createdAt": "2020-09-21T17:21:10Z", "commit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMToxMVrOHVa-TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMzozN1rOHVbD2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNDA3Nw==", "bodyText": "Move to own service VirtualHostResolverService", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492224077", "createdAt": "2020-09-21T17:21:11Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +29,57 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static VirtualHost resolve( final List<VirtualHost> virtualHosts, final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNDQ4MQ==", "bodyText": "move to another helper (internal package)", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492224481", "createdAt": "2020-09-21T17:21:52Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +29,57 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static VirtualHost resolve( final List<VirtualHost> virtualHosts, final HttpServletRequest req )\n+    {\n+        for ( final VirtualHost virtualHost : virtualHosts )\n+        {\n+            if ( matches( virtualHost, req ) )\n+            {\n+                return virtualHost;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    public static boolean matches( final VirtualHost virtualHost, final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNTQ5Nw==", "bodyText": "This service is not needed. Replace by VirtualHostService(Impl)", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492225497", "createdAt": "2020-09-21T17:23:37Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfig.java", "diffHunk": "@@ -1,10 +1,12 @@\n package com.enonic.xp.web.vhost.impl.config;\n \n-import com.enonic.xp.web.vhost.impl.mapping.VirtualHostMappings;\n+import java.util.List;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n \n public interface VirtualHostConfig", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/7509ff8dc02d387bf41db673348b7e81fa3a022d", "committedDate": "2020-09-21T12:45:42Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/5213d56af45ace4e9683a9590d4f70c924e82ce2", "committedDate": "2020-09-22T08:26:40Z", "message": "Extend VHost API #8374"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjU4NjY0", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-493258664", "createdAt": "2020-09-22T09:01:56Z", "commit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMTo1NlrOHVws9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowODoyNVrOHVw8hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MDA4NQ==", "bodyText": "Hopefully we can get rid of this method.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492580085", "createdAt": "2020-09-22T09:01:56Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +27,16 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static String normalizePath( final String value )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI2MA==", "bodyText": "XP has WebRequest interface abstraction. maybe that should be used instead?", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492581260", "createdAt": "2020-09-22T09:03:53Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostResolverImpl.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.enonic.xp.web.vhost.impl;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostHelper;\n+import com.enonic.xp.web.vhost.VirtualHostResolver;\n+import com.enonic.xp.web.vhost.VirtualHostService;\n+\n+@Component(immediate = true)\n+public class VirtualHostResolverImpl\n+    implements VirtualHostResolver\n+{\n+\n+    private final VirtualHostService virtualHostService;\n+\n+    @Activate\n+    public VirtualHostResolverImpl( @Reference final VirtualHostService virtualHostService )\n+    {\n+        this.virtualHostService = virtualHostService;\n+    }\n+\n+    @Override\n+    public VirtualHost resolveVirtualHost( final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTYyOQ==", "bodyText": "themComparingInt", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492581629", "createdAt": "2020-09-22T09:04:30Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( Comparator.comparing( VirtualHost::getHost ).\n+            thenComparing( VirtualHost::getSource, ( virtualHost, otherVirtualHost ) -> otherVirtualHost.length() - virtualHost.length() ).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MjczMA==", "bodyText": "String::compareTo is it needed? I think method is overloaded.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492582730", "createdAt": "2020-09-22T09:06:15Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( Comparator.comparing( VirtualHost::getHost ).\n+            thenComparing( VirtualHost::getSource, ( virtualHost, otherVirtualHost ) -> otherVirtualHost.length() - virtualHost.length() ).\n+            thenComparing( VirtualHost::getSource, String::compareTo ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NDA3MQ==", "bodyText": "findMappingNames().stream().map(...).sort().collect()", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492584071", "createdAt": "2020-09-22T09:08:25Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/5213d56af45ace4e9683a9590d4f70c924e82ce2", "committedDate": "2020-09-22T08:26:40Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "c0a4b25562cc931135dc4e4c6936ad0b649bdb75", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/c0a4b25562cc931135dc4e4c6936ad0b649bdb75", "committedDate": "2020-09-22T10:29:16Z", "message": "Extend VHost API #8374"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0a4b25562cc931135dc4e4c6936ad0b649bdb75", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/c0a4b25562cc931135dc4e4c6936ad0b649bdb75", "committedDate": "2020-09-22T10:29:16Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/e8f5faee478837e3d6229c0a4187038cf1b150eb", "committedDate": "2020-09-22T13:01:17Z", "message": "Extend VHost API #8374"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDQ4NzY3", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-493448767", "createdAt": "2020-09-22T13:18:16Z", "commit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoxODoxNlrOHV5lGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoyMToyNlrOHV5tnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNTUzMA==", "bodyText": "List.of()", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492725530", "createdAt": "2020-09-22T13:18:16Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -1,28 +1,31 @@\n package com.enonic.xp.web.vhost.impl.config;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.Map;\n \n import org.osgi.service.component.annotations.Activate;\n import org.osgi.service.component.annotations.Component;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import com.enonic.xp.web.vhost.impl.mapping.VirtualHostMappings;\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostService;\n \n @Component(immediate = true, configurationPid = \"com.enonic.xp.web.vhost\")\n-public final class VirtualHostConfigImpl\n-    implements VirtualHostConfig\n+public final class VirtualHostServiceImpl\n+    implements VirtualHostService\n {\n-    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostConfigImpl.class );\n+    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostServiceImpl.class );\n \n     private boolean enabled;\n \n-    private VirtualHostMappings mappings;\n+    private List<VirtualHost> virtualHosts;\n \n-    public VirtualHostConfigImpl()\n+    public VirtualHostServiceImpl()\n     {\n         this.enabled = false;\n-        this.mappings = new VirtualHostMappings();\n+        this.virtualHosts = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzcwOA==", "bodyText": "List.copyOf(configMap.buildMappings())", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492727708", "createdAt": "2020-09-22T13:21:26Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -32,17 +35,17 @@ public boolean isEnabled()\n     }\n \n     @Override\n-    public VirtualHostMappings getMappings()\n+    public List<VirtualHost> getVirtualHosts()\n     {\n-        return this.mappings;\n+        return this.virtualHosts;\n     }\n \n     @Activate\n     public void configure( final Map<String, String> config )\n     {\n         final VirtualHostConfigMap configMap = new VirtualHostConfigMap( config );\n         this.enabled = configMap.isEnabled();\n-        this.mappings = configMap.buildMappings();\n+        this.virtualHosts = configMap.buildMappings();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/e8f5faee478837e3d6229c0a4187038cf1b150eb", "committedDate": "2020-09-22T13:01:17Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "6204ac94e066c29d886cceedc2db422e47cde0a0", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/6204ac94e066c29d886cceedc2db422e47cde0a0", "committedDate": "2020-09-22T13:57:51Z", "message": "Extend VHost API #8374"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6204ac94e066c29d886cceedc2db422e47cde0a0", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/6204ac94e066c29d886cceedc2db422e47cde0a0", "committedDate": "2020-09-22T13:57:51Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "9222f40a5c720dca2487cb4db8247a8485124c55", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/9222f40a5c720dca2487cb4db8247a8485124c55", "committedDate": "2020-09-22T14:10:18Z", "message": "Extend VHost API #8374"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9222f40a5c720dca2487cb4db8247a8485124c55", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/9222f40a5c720dca2487cb4db8247a8485124c55", "committedDate": "2020-09-22T14:10:18Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f", "committedDate": "2020-09-23T07:54:00Z", "message": "Extend VHost API #8374"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDI2MzAz", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-494426303", "createdAt": "2020-09-23T08:34:32Z", "commit": {"oid": "f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODozNDozMlrOHWdcxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODozNDozMlrOHWdcxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMxMzIyMA==", "bodyText": "move to VirtualHostInternalHelper", "url": "https://github.com/enonic/xp/pull/8389#discussion_r493313220", "createdAt": "2020-09-23T08:34:32Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostResolver.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.enonic.xp.web.vhost;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import com.enonic.xp.annotation.PublicApi;\n+\n+@PublicApi\n+public interface VirtualHostResolver\n+{\n+\n+    VirtualHost resolveVirtualHost( final HttpServletRequest req );\n+\n+    String getFullTargetPath( final VirtualHost virtualHost, final HttpServletRequest req );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64405ab713e3d7722d1af75676f1a0e7f312866e", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/64405ab713e3d7722d1af75676f1a0e7f312866e", "committedDate": "2020-09-24T08:16:34Z", "message": "Extend VHost API #8374"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f", "committedDate": "2020-09-23T07:54:00Z", "message": "Extend VHost API #8374"}, "afterCommit": {"oid": "64405ab713e3d7722d1af75676f1a0e7f312866e", "author": {"user": {"login": "anatol-sialitski", "name": null}}, "url": "https://github.com/enonic/xp/commit/64405ab713e3d7722d1af75676f1a0e7f312866e", "committedDate": "2020-09-24T08:16:34Z", "message": "Extend VHost API #8374"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzYzNzU2", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-495363756", "createdAt": "2020-09-24T09:01:14Z", "commit": {"oid": "64405ab713e3d7722d1af75676f1a0e7f312866e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDQ0Mjg4", "url": "https://github.com/enonic/xp/pull/8389#pullrequestreview-495444288", "createdAt": "2020-09-24T10:48:38Z", "commit": {"oid": "64405ab713e3d7722d1af75676f1a0e7f312866e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4381, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}