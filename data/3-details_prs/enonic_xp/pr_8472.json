{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MDUwMDA0", "number": 8472, "title": "Distributed tasks", "bodyText": "", "createdAt": "2020-11-11T08:52:51Z", "url": "https://github.com/enonic/xp/pull/8472", "merged": true, "mergeCommit": {"oid": "1952dcfbdcbd9a0669bfa74e6b7d39a467aeef28"}, "closed": true, "closedAt": "2020-11-13T11:40:11Z", "author": {"login": "rymsha"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbdrBrABqjM5ODM3NTcyNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcEkMUAH2gAyNTE5MDUwMDA0OjlkMTUwYjhlNmVmYWEwNjc1N2NiMTEyODk5MmRmYjBlYjE3Mzg4NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39ec99fc16162d0450d101bdf4e9ca5d60d623c5", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/39ec99fc16162d0450d101bdf4e9ca5d60d623c5", "committedDate": "2020-11-11T08:51:52Z", "message": "save"}, "afterCommit": {"oid": "0a4050437e534b3b165b1c386fcbf18ea11f4e39", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/0a4050437e534b3b165b1c386fcbf18ea11f4e39", "committedDate": "2020-11-11T13:07:09Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a4050437e534b3b165b1c386fcbf18ea11f4e39", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/0a4050437e534b3b165b1c386fcbf18ea11f4e39", "committedDate": "2020-11-11T13:07:09Z", "message": "save"}, "afterCommit": {"oid": "c9f42518c7985313f027577f48b7efc0a99f38ab", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c9f42518c7985313f027577f48b7efc0a99f38ab", "committedDate": "2020-11-11T18:03:43Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9f42518c7985313f027577f48b7efc0a99f38ab", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c9f42518c7985313f027577f48b7efc0a99f38ab", "committedDate": "2020-11-11T18:03:43Z", "message": "save"}, "afterCommit": {"oid": "a2f5539fd9017f15cb5fa8b87895d3dd33c9e033", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/a2f5539fd9017f15cb5fa8b87895d3dd33c9e033", "committedDate": "2020-11-11T18:53:16Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2f5539fd9017f15cb5fa8b87895d3dd33c9e033", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/a2f5539fd9017f15cb5fa8b87895d3dd33c9e033", "committedDate": "2020-11-11T18:53:16Z", "message": "save"}, "afterCommit": {"oid": "4ae5590165ddfeff50a400bba3033b5d553aba1d", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/4ae5590165ddfeff50a400bba3033b5d553aba1d", "committedDate": "2020-11-11T18:58:16Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ae5590165ddfeff50a400bba3033b5d553aba1d", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/4ae5590165ddfeff50a400bba3033b5d553aba1d", "committedDate": "2020-11-11T18:58:16Z", "message": "save"}, "afterCommit": {"oid": "6577adc95aa94fe63b6e96023351a2b903435f84", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/6577adc95aa94fe63b6e96023351a2b903435f84", "committedDate": "2020-11-12T10:36:26Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6577adc95aa94fe63b6e96023351a2b903435f84", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/6577adc95aa94fe63b6e96023351a2b903435f84", "committedDate": "2020-11-12T10:36:26Z", "message": "save"}, "afterCommit": {"oid": "c9d2e6c51c4dd27ec42ddbccf17c5dd806210748", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c9d2e6c51c4dd27ec42ddbccf17c5dd806210748", "committedDate": "2020-11-12T11:14:09Z", "message": "save"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9d2e6c51c4dd27ec42ddbccf17c5dd806210748", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/c9d2e6c51c4dd27ec42ddbccf17c5dd806210748", "committedDate": "2020-11-12T11:14:09Z", "message": "save"}, "afterCommit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/ab9969b89ea3e544f22b1829f2910da7fa2d2c80", "committedDate": "2020-11-12T16:10:35Z", "message": "Distributed tasks #8436"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5Mjk4NDEy", "url": "https://github.com/enonic/xp/pull/8472#pullrequestreview-529298412", "createdAt": "2020-11-12T17:03:46Z", "commit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzowMzo0NlrOHyEoNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNzowMzo0NlrOHyEoNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NjY3OQ==", "bodyText": "Check that all attributes removed", "url": "https://github.com/enonic/xp/pull/8472#discussion_r522266679", "createdAt": "2020-11-12T17:03:46Z", "author": {"login": "rymsha"}, "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/MemberAttributesApplier.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.enonic.xp.impl.task;\n+\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.BundleEvent;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Modified;\n+import org.osgi.service.component.annotations.Reference;\n+import org.osgi.util.tracker.BundleTracker;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.Member;\n+\n+import com.enonic.xp.app.ApplicationBundleUtils;\n+\n+@Component\n+public class MemberAttributesApplier\n+    extends BundleTracker<Boolean>\n+{\n+    static final String TASKS_ENABLED_ATTRIBUTE_KEY = \"tasks-enabled\";\n+\n+    static final String TASKS_ENABLED_ATTRIBUTE_PREFIX = TASKS_ENABLED_ATTRIBUTE_KEY + \"-\";\n+\n+    private final Member localMember;\n+\n+    @Activate\n+    public MemberAttributesApplier( final BundleContext context, @Reference final HazelcastInstance hazelcastInstance )\n+    {\n+        super( context, Bundle.ACTIVE, null );\n+        this.localMember = hazelcastInstance.getCluster().getLocalMember();\n+    }\n+\n+    @Activate\n+    public void activate( final TaskConfig config )\n+    {\n+        localMember.setBooleanAttribute( TASKS_ENABLED_ATTRIBUTE_KEY, config.offload_acceptInbound() );\n+        super.open();\n+    }\n+\n+    @Deactivate\n+    public void deactivate()\n+    {\n+        super.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MzgxOTc5", "url": "https://github.com/enonic/xp/pull/8472#pullrequestreview-529381979", "createdAt": "2020-11-12T18:41:21Z", "commit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cbd1a43fcf73cb9bbf9dae1baf431b75640b18e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/4cbd1a43fcf73cb9bbf9dae1baf431b75640b18e", "committedDate": "2020-11-13T07:45:52Z", "message": "Distributed tasks #8436"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab9969b89ea3e544f22b1829f2910da7fa2d2c80", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/ab9969b89ea3e544f22b1829f2910da7fa2d2c80", "committedDate": "2020-11-12T16:10:35Z", "message": "Distributed tasks #8436"}, "afterCommit": {"oid": "4cbd1a43fcf73cb9bbf9dae1baf431b75640b18e", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/4cbd1a43fcf73cb9bbf9dae1baf431b75640b18e", "committedDate": "2020-11-13T07:45:52Z", "message": "Distributed tasks #8436"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODU0MjA2", "url": "https://github.com/enonic/xp/pull/8472#pullrequestreview-529854206", "createdAt": "2020-11-13T08:14:20Z", "commit": {"oid": "4cbd1a43fcf73cb9bbf9dae1baf431b75640b18e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d150b8e6efaa06757cb1128992dfb0eb1738850", "author": {"user": {"login": "rymsha", "name": "Sergey Rymsha"}}, "url": "https://github.com/enonic/xp/commit/9d150b8e6efaa06757cb1128992dfb0eb1738850", "committedDate": "2020-11-13T10:26:16Z", "message": "Distributed tasks #8436"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4400, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}