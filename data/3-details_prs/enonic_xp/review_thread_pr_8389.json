{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjA3MjY5", "number": 8389, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMToyMToxNlrOElnC2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODozNDozMlrOEmcJrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3ODcyNDc1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMToyMToxN1rOHVLLLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo0OToxMVrOHVOXkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2NTIzMQ==", "bodyText": "isEnabled, getVirtualHost, getVirtualHosts should be in a different service (VirtualHostConfigService)\nresolve should stay here.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r491965231", "createdAt": "2020-09-21T11:21:17Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostService.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.enonic.xp.web.vhost;\n+\n+import java.util.List;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+public interface VirtualHostService\n+{\n+\n+    boolean isEnabled();\n+\n+    VirtualHost getVirtualHost( final String name );\n+\n+    List<VirtualHost> getVirtualHosts();\n+\n+    VirtualHost resolve( final HttpServletRequest req );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "338c3d489b2eba8dc8a79c6cef9e503c6ec13e57"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxNzU1NQ==", "bodyText": "done", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492017555", "createdAt": "2020-09-21T12:49:11Z", "author": {"login": "anatol-sialitski"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostService.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.enonic.xp.web.vhost;\n+\n+import java.util.List;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+public interface VirtualHostService\n+{\n+\n+    boolean isEnabled();\n+\n+    VirtualHost getVirtualHost( final String name );\n+\n+    List<VirtualHost> getVirtualHosts();\n+\n+    VirtualHost resolve( final HttpServletRequest req );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2NTIzMQ=="}, "originalCommit": {"oid": "338c3d489b2eba8dc8a79c6cef9e503c6ec13e57"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3OTEwNTM1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo1OToxMFrOHVO00w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjo1OToxMFrOHVO00w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNTA0Mw==", "bodyText": "extract class. Use Comparator.comparing.thenComparing", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492025043", "createdAt": "2020-09-21T12:59:10Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +36,33 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( ( virtualHostMapping, otherVirtualHostMapping ) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3OTExNzEwOnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMzowMjoxNlrOHVO7_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMzowMjoxNlrOHVO7_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNjg3OQ==", "bodyText": "I now hardly see a need for such an API method.\n\nIn java one can easily use streams\nin js one can use find", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492026879", "createdAt": "2020-09-21T13:02:16Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostServiceImpl.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.enonic.xp.web.vhost.impl;\n+\n+import java.util.List;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostConfigService;\n+import com.enonic.xp.web.vhost.impl.config.VirtualHostConfig;\n+\n+@Component(immediate = true)\n+public class VirtualHostServiceImpl\n+    implements VirtualHostConfigService\n+{\n+\n+    private VirtualHostConfig virtualHostConfig;\n+\n+    @Activate\n+    public VirtualHostServiceImpl( @Reference final VirtualHostConfig virtualHostConfig )\n+    {\n+        this.virtualHostConfig = virtualHostConfig;\n+    }\n+\n+    @Override\n+    public boolean isEnabled()\n+    {\n+        return virtualHostConfig.isEnabled();\n+    }\n+\n+    @Override\n+    public VirtualHost getVirtualHost( final String name )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDM1MDU1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMToxMVrOHVa-TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMToxMVrOHVa-TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNDA3Nw==", "bodyText": "Move to own service VirtualHostResolverService", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492224077", "createdAt": "2020-09-21T17:21:11Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +29,57 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static VirtualHost resolve( final List<VirtualHost> virtualHosts, final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDM1MzA3OnYy", "diffSide": "RIGHT", "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMTo1MlrOHVa_4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMTo1MlrOHVa_4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNDQ4MQ==", "bodyText": "move to another helper (internal package)", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492224481", "createdAt": "2020-09-21T17:21:52Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +29,57 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static VirtualHost resolve( final List<VirtualHost> virtualHosts, final HttpServletRequest req )\n+    {\n+        for ( final VirtualHost virtualHost : virtualHosts )\n+        {\n+            if ( matches( virtualHost, req ) )\n+            {\n+                return virtualHost;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    public static boolean matches( final VirtualHost virtualHost, final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDM1OTM5OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMzozN1rOHVbD2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoyMzozN1rOHVbD2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIyNTQ5Nw==", "bodyText": "This service is not needed. Replace by VirtualHostService(Impl)", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492225497", "createdAt": "2020-09-21T17:23:37Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfig.java", "diffHunk": "@@ -1,10 +1,12 @@\n package com.enonic.xp.web.vhost.impl.config;\n \n-import com.enonic.xp.web.vhost.impl.mapping.VirtualHostMappings;\n+import java.util.List;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n \n public interface VirtualHostConfig", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7509ff8dc02d387bf41db673348b7e81fa3a022d"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjcwNzY0OnYy", "diffSide": "RIGHT", "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMTo1NlrOHVws9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMTo1NlrOHVws9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MDA4NQ==", "bodyText": "Hopefully we can get rid of this method.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492580085", "createdAt": "2020-09-22T09:01:56Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostHelper.java", "diffHunk": "@@ -23,4 +27,16 @@ public static void setVirtualHost( final HttpServletRequest req, final VirtualHo\n     {\n         req.setAttribute( KEY, vhost );\n     }\n+\n+    public static String normalizePath( final String value )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjcxNTA1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostResolverImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMzo1M1rOHVwxjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMzo1M1rOHVwxjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI2MA==", "bodyText": "XP has WebRequest interface abstraction. maybe that should be used instead?", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492581260", "createdAt": "2020-09-22T09:03:53Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/VirtualHostResolverImpl.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.enonic.xp.web.vhost.impl;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostHelper;\n+import com.enonic.xp.web.vhost.VirtualHostResolver;\n+import com.enonic.xp.web.vhost.VirtualHostService;\n+\n+@Component(immediate = true)\n+public class VirtualHostResolverImpl\n+    implements VirtualHostResolver\n+{\n+\n+    private final VirtualHostService virtualHostService;\n+\n+    @Activate\n+    public VirtualHostResolverImpl( @Reference final VirtualHostService virtualHostService )\n+    {\n+        this.virtualHostService = virtualHostService;\n+    }\n+\n+    @Override\n+    public VirtualHost resolveVirtualHost( final HttpServletRequest req )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjcxNzQ1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowNDozMFrOHVwy_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowNDozMFrOHVwy_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTYyOQ==", "bodyText": "themComparingInt", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492581629", "createdAt": "2020-09-22T09:04:30Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( Comparator.comparing( VirtualHost::getHost ).\n+            thenComparing( VirtualHost::getSource, ( virtualHost, otherVirtualHost ) -> otherVirtualHost.length() - virtualHost.length() ).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjcyNDE1OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowNjoxNVrOHVw3Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowNjoxNVrOHVw3Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MjczMA==", "bodyText": "String::compareTo is it needed? I think method is overloaded.", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492582730", "createdAt": "2020-09-22T09:06:15Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )\n         {\n             mappings.add( buildMapping( name ) );\n         }\n \n+        mappings.sort( Comparator.comparing( VirtualHost::getHost ).\n+            thenComparing( VirtualHost::getSource, ( virtualHost, otherVirtualHost ) -> otherVirtualHost.length() - virtualHost.length() ).\n+            thenComparing( VirtualHost::getSource, String::compareTo ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjczMjU3OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowODoyNVrOHVw8hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowODoyNVrOHVw8hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NDA3MQ==", "bodyText": "findMappingNames().stream().map(...).sort().collect()", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492584071", "createdAt": "2020-09-22T09:08:25Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostConfigMap.java", "diffHunk": "@@ -34,14 +37,19 @@ public boolean isEnabled()\n         return getBoolean( \"enabled\", false );\n     }\n \n-    public VirtualHostMappings buildMappings()\n+    public List<VirtualHost> buildMappings()\n     {\n-        final VirtualHostMappings mappings = new VirtualHostMappings();\n+        final List<VirtualHost> mappings = new ArrayList<>();\n+\n         for ( final String name : findMappingNames() )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5213d56af45ace4e9683a9590d4f70c924e82ce2"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzY0NDkxOnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoxODoxNlrOHV5lGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDowNzozN1rOHV75-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNTUzMA==", "bodyText": "List.of()", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492725530", "createdAt": "2020-09-22T13:18:16Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -1,28 +1,31 @@\n package com.enonic.xp.web.vhost.impl.config;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.Map;\n \n import org.osgi.service.component.annotations.Activate;\n import org.osgi.service.component.annotations.Component;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import com.enonic.xp.web.vhost.impl.mapping.VirtualHostMappings;\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostService;\n \n @Component(immediate = true, configurationPid = \"com.enonic.xp.web.vhost\")\n-public final class VirtualHostConfigImpl\n-    implements VirtualHostConfig\n+public final class VirtualHostServiceImpl\n+    implements VirtualHostService\n {\n-    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostConfigImpl.class );\n+    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostServiceImpl.class );\n \n     private boolean enabled;\n \n-    private VirtualHostMappings mappings;\n+    private List<VirtualHost> virtualHosts;\n \n-    public VirtualHostConfigImpl()\n+    public VirtualHostServiceImpl()\n     {\n         this.enabled = false;\n-        this.mappings = new VirtualHostMappings();\n+        this.virtualHosts = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc2MzY0Mw==", "bodyText": "done", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492763643", "createdAt": "2020-09-22T14:07:37Z", "author": {"login": "anatol-sialitski"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -1,28 +1,31 @@\n package com.enonic.xp.web.vhost.impl.config;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.Map;\n \n import org.osgi.service.component.annotations.Activate;\n import org.osgi.service.component.annotations.Component;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import com.enonic.xp.web.vhost.impl.mapping.VirtualHostMappings;\n+import com.enonic.xp.web.vhost.VirtualHost;\n+import com.enonic.xp.web.vhost.VirtualHostService;\n \n @Component(immediate = true, configurationPid = \"com.enonic.xp.web.vhost\")\n-public final class VirtualHostConfigImpl\n-    implements VirtualHostConfig\n+public final class VirtualHostServiceImpl\n+    implements VirtualHostService\n {\n-    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostConfigImpl.class );\n+    private static final Logger LOG = LoggerFactory.getLogger( VirtualHostServiceImpl.class );\n \n     private boolean enabled;\n \n-    private VirtualHostMappings mappings;\n+    private List<VirtualHost> virtualHosts;\n \n-    public VirtualHostConfigImpl()\n+    public VirtualHostServiceImpl()\n     {\n         this.enabled = false;\n-        this.mappings = new VirtualHostMappings();\n+        this.virtualHosts = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNTUzMA=="}, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzY1ODU2OnYy", "diffSide": "RIGHT", "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoyMToyNlrOHV5tnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDowNzo0NFrOHV76Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzcwOA==", "bodyText": "List.copyOf(configMap.buildMappings())", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492727708", "createdAt": "2020-09-22T13:21:26Z", "author": {"login": "rymsha"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -32,17 +35,17 @@ public boolean isEnabled()\n     }\n \n     @Override\n-    public VirtualHostMappings getMappings()\n+    public List<VirtualHost> getVirtualHosts()\n     {\n-        return this.mappings;\n+        return this.virtualHosts;\n     }\n \n     @Activate\n     public void configure( final Map<String, String> config )\n     {\n         final VirtualHostConfigMap configMap = new VirtualHostConfigMap( config );\n         this.enabled = configMap.isEnabled();\n-        this.mappings = configMap.buildMappings();\n+        this.virtualHosts = configMap.buildMappings();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc2MzcxMA==", "bodyText": "done", "url": "https://github.com/enonic/xp/pull/8389#discussion_r492763710", "createdAt": "2020-09-22T14:07:44Z", "author": {"login": "anatol-sialitski"}, "path": "modules/web/web-vhost/src/main/java/com/enonic/xp/web/vhost/impl/config/VirtualHostServiceImpl.java", "diffHunk": "@@ -32,17 +35,17 @@ public boolean isEnabled()\n     }\n \n     @Override\n-    public VirtualHostMappings getMappings()\n+    public List<VirtualHost> getVirtualHosts()\n     {\n-        return this.mappings;\n+        return this.virtualHosts;\n     }\n \n     @Activate\n     public void configure( final Map<String, String> config )\n     {\n         final VirtualHostConfigMap configMap = new VirtualHostConfigMap( config );\n         this.enabled = configMap.isEnabled();\n-        this.mappings = configMap.buildMappings();\n+        this.virtualHosts = configMap.buildMappings();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyNzcwOA=="}, "originalCommit": {"oid": "e8f5faee478837e3d6229c0a4187038cf1b150eb"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzQyNTcyOnYy", "diffSide": "RIGHT", "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODozNDozMlrOHWdcxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODozNDozMlrOHWdcxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMxMzIyMA==", "bodyText": "move to VirtualHostInternalHelper", "url": "https://github.com/enonic/xp/pull/8389#discussion_r493313220", "createdAt": "2020-09-23T08:34:32Z", "author": {"login": "rymsha"}, "path": "modules/web/web-api/src/main/java/com/enonic/xp/web/vhost/VirtualHostResolver.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.enonic.xp.web.vhost;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import com.enonic.xp.annotation.PublicApi;\n+\n+@PublicApi\n+public interface VirtualHostResolver\n+{\n+\n+    VirtualHost resolveVirtualHost( final HttpServletRequest req );\n+\n+    String getFullTargetPath( final VirtualHost virtualHost, final HttpServletRequest req );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2a6cbc8942442fa4e4ef3199dd9efc405dedd1f"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 946, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}