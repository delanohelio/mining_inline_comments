{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NzEwMjA2", "number": 640, "title": "v4 fix optional paramter of wiretype", "bodyText": "FIx bug that optional parameter in client method is not inited.\nBefore fix,\n    @ServiceMethod(returns = ReturnType.COLLECTION)\n    public PagedFlux<DeploymentResourceInner> listAsync(String resourceGroupName, String serviceName, String appName) {\n        final Context context = null;\n        return new PagedFlux<>(\n            () -> listSinglePageAsync(resourceGroupName, serviceName, appName, version),\n            nextLink -> listNextSinglePageAsync(nextLink));\n    }\n\nAfter fix,\n    @ServiceMethod(returns = ReturnType.COLLECTION)\n    public PagedFlux<DeploymentResourceInner> listAsync(String resourceGroupName, String serviceName, String appName) {\n        final List<String> version = null;\n        final Context context = null;\n        return new PagedFlux<>(\n            () -> listSinglePageAsync(resourceGroupName, serviceName, appName, version),\n            nextLink -> listNextSinglePageAsync(nextLink));\n    }", "createdAt": "2020-06-22T06:16:33Z", "url": "https://github.com/Azure/autorest.java/pull/640", "merged": true, "mergeCommit": {"oid": "8daa290dc2dd8733eb6d1dfc1f329ea24372e9d0"}, "closed": true, "closedAt": "2020-06-23T02:24:48Z", "author": {"login": "weidongxu-microsoft"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctqg6PAH2gAyNDM3NzEwMjA2OmM4ZTZlN2EwZmUxMjkxMTZlMjRmMjJiZWFkMzdhNzIyZjE1MDYyYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctsoCrAFqTQzNDcxMDk2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c8e6e7a0fe129116e24f22bead37a722f15062a0", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/c8e6e7a0fe129116e24f22bead37a722f15062a0", "committedDate": "2020-06-22T06:04:38Z", "message": "init optional parameter even if clienttype != wiretype"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "312cef6953ae1fd4eed3df659f83f0d655c0f7d7", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/312cef6953ae1fd4eed3df659f83f0d655c0f7d7", "committedDate": "2020-06-22T06:11:02Z", "message": "fix code bug, happen on body-file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjI5NzQ5", "url": "https://github.com/Azure/autorest.java/pull/640#pullrequestreview-434629749", "createdAt": "2020-06-22T06:18:50Z", "commit": {"oid": "312cef6953ae1fd4eed3df659f83f0d655c0f7d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjoxODo1MVrOGmzL6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjoxODo1MVrOGmzL6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMzNzcwNQ==", "bodyText": "So far, it is safe to do this in 2 steps: 1. set the parameter to null e.g. in listAsync, 2. convert the client type to wire type e.g. in listSinglePageAsync.\nThis relates to my decision of not overload the base method type (PagingAsyncSinglePage, SimpleAsyncRestResponse) with regard to optional parameters. Hence the init of optional parameter need to happen in other client method types.\nI think v3 does it in single step, in ConvertClientTypesToWireTypes method.\nChecked that following will all convert null to null, as intended.\nBase64Util.encodeToString\nBase64Url.encode\nJacksonAdapter.createDefaultSerializerAdapter().serializeList", "url": "https://github.com/Azure/autorest.java/pull/640#discussion_r443337705", "createdAt": "2020-06-22T06:18:51Z", "author": {"login": "weidongxu-microsoft"}, "path": "javagen/src/main/java/com/azure/autorest/template/ClientMethodTemplate.java", "diffHunk": "@@ -87,7 +87,10 @@ protected static void AddOptionalAndConstantVariables(JavaBlock function, Client\n                     (parameterClientType instanceof ArrayType || parameterClientType instanceof ListType)) {\n                 parameterWireType = ClassType.String;\n             }\n-            boolean alwaysNull = parameterWireType != parameterClientType && clientMethod.getOnlyRequiredParameters() && !parameter.getIsRequired();\n+            // \"addConstant\" clause is a hack here.\n+            // For SimpleAsyncRestResponse and PagingAsyncSinglePage, \"alwaysNull\" is set to true, to let \"ConvertClientTypesToWireTypes\" method set the optional parameter.\n+            // For other ClientMethodType (which would have addConstant=false), optional parameter need to be initialized for calling method with full parameters.\n+            boolean alwaysNull = addConstant && parameterWireType != parameterClientType && clientMethod.getOnlyRequiredParameters() && !parameter.getIsRequired();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "312cef6953ae1fd4eed3df659f83f0d655c0f7d7"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjMwNDE2", "url": "https://github.com/Azure/autorest.java/pull/640#pullrequestreview-434630416", "createdAt": "2020-06-22T06:20:22Z", "commit": {"oid": "312cef6953ae1fd4eed3df659f83f0d655c0f7d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjoyMDoyMlrOGmzN1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNjoyMDoyMlrOGmzN1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMzODE5OA==", "bodyText": "bug fix.\nFormatter.formatSourceAndFixImports will fail on invalid java code. It then fails the generate script on that autorest call, but not triggering error.", "url": "https://github.com/Azure/autorest.java/pull/640#discussion_r443338198", "createdAt": "2020-06-22T06:20:22Z", "author": {"login": "weidongxu-microsoft"}, "path": "javagen/src/main/java/com/azure/autorest/template/ClientMethodTemplate.java", "diffHunk": "@@ -374,7 +377,7 @@ public final void write(ClientMethod clientMethod, JavaType typeBlock) {\n                 typeBlock.publicMethod(clientMethod.getDeclaration(), function -> {\n                     AddOptionalVariables(function, clientMethod, restAPIMethod.getParameters(), settings);\n                     if (clientMethod.getReturnValue().getType() == ClassType.InputStream) {\n-                        function.line(\"Iterator<ByteBufferBackedInputStream> iterator = %s(%S).map(ByteBufferBackedInputStream::new).toStream().iterator()\",\n+                        function.line(\"Iterator<ByteBufferBackedInputStream> iterator = %s(%S).map(ByteBufferBackedInputStream::new).toStream().iterator();\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "312cef6953ae1fd4eed3df659f83f0d655c0f7d7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d9cfbbc0ae8a22e3cc8c513a51dd77d9913d22f", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/3d9cfbbc0ae8a22e3cc8c513a51dd77d9913d22f", "committedDate": "2020-06-22T06:45:13Z", "message": "add ignoreParameterNeedConvert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NzEwOTYx", "url": "https://github.com/Azure/autorest.java/pull/640#pullrequestreview-434710961", "createdAt": "2020-06-22T08:32:14Z", "commit": {"oid": "3d9cfbbc0ae8a22e3cc8c513a51dd77d9913d22f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1959, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}