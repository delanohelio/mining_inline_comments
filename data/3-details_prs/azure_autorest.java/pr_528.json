{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NzQ3MjUz", "number": 528, "title": "v4 fluent flatten mutiple inheritance", "bodyText": "Fix #527", "createdAt": "2020-03-06T10:32:03Z", "url": "https://github.com/Azure/autorest.java/pull/528", "merged": true, "mergeCommit": {"oid": "5bc633650812f52dca7ea0d5ab9f65ca16a18720"}, "closed": true, "closedAt": "2020-03-09T02:45:45Z", "author": {"login": "weidongxu-microsoft"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK7eX7AH2gAyMzg0NzQ3MjUzOjQxODBiOTc2YjA4ZTViN2I5YWQxMmEwMzNjMjgxMTAzYTZlNjEwZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL0qKfAH2gAyMzg0NzQ3MjUzOjYwNzYyYTQ2MzgzOWUwZTkzNTY4MDc4YjcwZDZlZTYwYTUxYzNhMWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4180b976b08e5b7b9ad12a033c281103a6e610d2", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/4180b976b08e5b7b9ad12a033c281103a6e610d2", "committedDate": "2020-03-06T08:02:54Z", "message": "flatten multiple inheritance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22cb409242f006bcfcde1a9846d58c3fcaa9a0c8", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/22cb409242f006bcfcde1a9846d58c3fcaa9a0c8", "committedDate": "2020-03-06T10:26:35Z", "message": "flatten multiple inheritance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dde8d631b0506a7905d70dc9177cb23808a5a17", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/3dde8d631b0506a7905d70dc9177cb23808a5a17", "committedDate": "2020-03-06T10:27:12Z", "message": "remove tranformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1426f10cb8774cd3182769668b6e5e32a808f0c8", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/1426f10cb8774cd3182769668b6e5e32a808f0c8", "committedDate": "2020-03-06T10:31:34Z", "message": "comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMzU5OTUy", "url": "https://github.com/Azure/autorest.java/pull/528#pullrequestreview-370359952", "createdAt": "2020-03-06T14:27:45Z", "commit": {"oid": "1426f10cb8774cd3182769668b6e5e32a808f0c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDoyNzo0NVrOFy6jZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDoyNzo0NVrOFy6jZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzMjQ1NA==", "bodyText": "Some mgmt-plane swagger has type with multiple base type. Currently I only take the first one as base, and flatten the rest. Could there be a better heuristic, like take the one that itself inherits a base class or got a discriminator?\nv1 flatten it as well. But not sure how it pick the base class.", "url": "https://github.com/Azure/autorest.java/pull/528#discussion_r388932454", "createdAt": "2020-03-06T14:27:45Z", "author": {"login": "weidongxu-microsoft"}, "path": "javagen/src/main/java/com/azure/autorest/mapper/ModelMapper.java", "diffHunk": "@@ -46,31 +47,46 @@ public ClientModel map(ObjectSchema compositeType) {\n \n             String parentModel = null;\n             boolean hasAdditionalProperties = false;\n+            List<ObjectSchema> parentsNeedFlatten = new ArrayList<>();\n             if (compositeType.getParents() != null && compositeType.getParents().getImmediate() != null) {\n-                if (!(compositeType.getParents().getImmediate().get(0) instanceof DictionarySchema)) {\n-//                ComplexSchema baseSchema = compositeType.getParents().getImmediate().get(0);\n-//                if (baseSchema instanceof ObjectSchema) {\n-//                    parentModel = map((ObjectSchema) baseSchema);\n-//                    serviceModels.addModel(parentModel);\n-//                } else {\n-//                    throw new RuntimeException(\"Wait what? How? Parent is not an object but a \" + baseSchema.getClass() + \"?\");\n-//                }\n-                    ComplexSchema parentComplexSchema = compositeType.getParents().getImmediate().get(0);\n-                    if (parentComplexSchema instanceof ObjectSchema) {\n-                        ClassType parentType = objectMapper.map((ObjectSchema) parentComplexSchema);\n-                        parentModel = parentType.getName();\n-                        modelImports.add(parentType.getPackage() + \".\" + parentModel);\n-                    } else {\n-                        parentModel = compositeType.getParents().getImmediate().get(0).getLanguage().getJava().getName();\n+                hasAdditionalProperties = compositeType.getParents().getImmediate().stream()\n+                        .anyMatch(s -> s instanceof DictionarySchema);\n+\n+                ObjectSchema firstParentComplexSchema = null;\n+                for (Schema parent : compositeType.getParents().getImmediate()) {\n+                    if (parent instanceof ObjectSchema) {\n+                        if (firstParentComplexSchema == null) {\n+                            firstParentComplexSchema = (ObjectSchema) parent;\n+                        } else {\n+                            parentsNeedFlatten.add((ObjectSchema) parent);\n+                        }\n                     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1426f10cb8774cd3182769668b6e5e32a808f0c8"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNTg0MDc2", "url": "https://github.com/Azure/autorest.java/pull/528#pullrequestreview-370584076", "createdAt": "2020-03-06T19:48:08Z", "commit": {"oid": "1426f10cb8774cd3182769668b6e5e32a808f0c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60762a463839e0e93568078b70d6ee60a51c3a1d", "author": {"user": {"login": "weidongxu-microsoft", "name": "Weidong Xu"}}, "url": "https://github.com/Azure/autorest.java/commit/60762a463839e0e93568078b70d6ee60a51c3a1d", "committedDate": "2020-03-09T02:40:22Z", "message": "rename"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2018, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}