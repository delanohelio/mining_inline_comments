{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MzYzNzg0", "number": 5887, "title": "Add the plugin for Apache CXF 3.x", "bodyText": "Add an agent plugin to support Apache CXF 3.x\n\n Add a test case for the new plugin, refer to the doc\n Add a component id in the component-libraries.yml\n Add a logo in the UI repo\n\nFix #2562, add an agent plugin to support Apache CXF 3.x, like", "createdAt": "2020-11-24T10:10:51Z", "url": "https://github.com/apache/skywalking/pull/5887", "merged": true, "mergeCommit": {"oid": "6e0a244482e880200660638cb48ec13fdeccfd29"}, "closed": true, "closedAt": "2020-11-26T09:18:57Z", "author": {"login": "zifeihan"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfm4TtgH2gAyNTI2MzYzNzg0OmE2MTY2NTMzYmNlZmYzMmI2YjBlMjMyNzZkMDdhY2Y0MzZiMjQ3MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgPQlRAFqTUzOTExOTU2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a6166533bceff32b6b0e23276d07acf436b24705", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/a6166533bceff32b6b0e23276d07acf436b24705", "committedDate": "2020-11-24T10:06:47Z", "message": "Add the plugin for Apache CXF 3.x."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Mzk4MDk4", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-537398098", "createdAt": "2020-11-24T11:28:03Z", "commit": {"oid": "a6166533bceff32b6b0e23276d07acf436b24705"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMToyODowM1rOH48h2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMToyOTowN1rOH48kIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NDAwOA==", "bodyText": "wrong hand?", "url": "https://github.com/apache/skywalking/pull/5887#discussion_r529474008", "createdAt": "2020-11-24T11:28:03Z", "author": {"login": "dmsolr"}, "path": "test/plugin/run.sh", "diffHunk": "@@ -24,7 +24,7 @@ force_build=\"off\"\n cleanup=\"off\"\n debug_mode=\n \n-mvnw=${home}/../../mvnw\n+mvnw=mvn", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6166533bceff32b6b0e23276d07acf436b24705"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NDU5NA==", "bodyText": "suggest: new ArrayList<>(1)", "url": "https://github.com/apache/skywalking/pull/5887#discussion_r529474594", "createdAt": "2020-11-24T11:29:07Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/apm-sdk-plugin/cxf-3.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/cxf/v3/client/MessageSenderInterceptorInterceptor.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.cxf.v3.client;\n+\n+import java.lang.reflect.Method;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import org.apache.cxf.binding.soap.SoapMessage;\n+import org.apache.cxf.message.Message;\n+import org.apache.cxf.service.model.MessageInfo;\n+import org.apache.cxf.transport.http.Address;\n+import org.apache.skywalking.apm.agent.core.context.CarrierItem;\n+import org.apache.skywalking.apm.agent.core.context.ContextCarrier;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.EnhancedInstance;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceMethodsAroundInterceptor;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+\n+public class MessageSenderInterceptorInterceptor implements InstanceMethodsAroundInterceptor {\n+    @Override\n+    public void beforeMethod(final EnhancedInstance objInst,\n+                             final Method method,\n+                             final Object[] allArguments,\n+                             final Class<?>[] argumentsTypes,\n+                             final MethodInterceptResult result) throws Throwable {\n+        SoapMessage message = (SoapMessage) allArguments[0];\n+        final String httpRequestMethod = (String) message.get(Message.HTTP_REQUEST_METHOD);\n+        final MessageInfo messageInfo = (MessageInfo) message.get(\"org.apache.cxf.service.model.MessageInfo\");\n+        final Address address = (Address) message.get(\"http.connection.address\");\n+\n+        if (null == httpRequestMethod || null == messageInfo || null == address) {\n+            return;\n+        }\n+        final String operationName = generateOperationName(messageInfo, address);\n+        AbstractSpan span = ContextManager.createExitSpan(operationName, address.getURI().getAuthority());\n+\n+        ContextCarrier contextCarrier = new ContextCarrier();\n+        ContextManager.inject(contextCarrier);\n+        span.setComponent(ComponentsDefine.APACHE_CXF);\n+        Tags.HTTP.METHOD.set(span, httpRequestMethod);\n+        Tags.URL.set(span, generateRequestURL(messageInfo, address));\n+        SpanLayer.asRPCFramework(span);\n+\n+        Map protocolHeaders = (Map) message.get(Message.PROTOCOL_HEADERS);\n+\n+        CarrierItem next = contextCarrier.items();\n+        while (next.hasNext()) {\n+            next = next.next();\n+            List<String> headerList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6166533bceff32b6b0e23276d07acf436b24705"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f395ba68c208d36d024ab11ac01fcd9438ccfea5", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/f395ba68c208d36d024ab11ac01fcd9438ccfea5", "committedDate": "2020-11-24T11:33:03Z", "message": "Add License header."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5913718d681c4e9b211b7b04e8efdde6ef3ce72", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/d5913718d681c4e9b211b7b04e8efdde6ef3ce72", "committedDate": "2020-11-24T11:34:55Z", "message": "Polishing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0df74f6c911692a8c495081a4083fbdb22b89088", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/0df74f6c911692a8c495081a4083fbdb22b89088", "committedDate": "2020-11-24T11:36:42Z", "message": "Merge branch 'master' into cxf\n\n# Conflicts:\n#\tCHANGES.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTU4Njkw", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-537558690", "createdAt": "2020-11-24T14:41:16Z", "commit": {"oid": "0df74f6c911692a8c495081a4083fbdb22b89088"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDo0MToxN1rOH5D9ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDo0MToxN1rOH5D9ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU5NTg0Mw==", "bodyText": "This async invoke could be in the same thread? I found out you have capture/continued, but in the test, this is in the same thread", "url": "https://github.com/apache/skywalking/pull/5887#discussion_r529595843", "createdAt": "2020-11-24T14:41:17Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/cxf-scenario/config/expectedData.yaml", "diffHunk": "@@ -0,0 +1,84 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+segmentItems:\n+  - serviceName: cxf-scenario\n+    segmentSize: ge 3\n+    segments:\n+      - segmentId: not null\n+        spans:\n+          - operationName: /CXF/AsyncInvoke", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0df74f6c911692a8c495081a4083fbdb22b89088"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTU5MzYy", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-537559362", "createdAt": "2020-11-24T14:41:56Z", "commit": {"oid": "0df74f6c911692a8c495081a4083fbdb22b89088"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e83c9d4fd0cc278d9e3f7d1ebce8d128decbe69", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/8e83c9d4fd0cc278d9e3f7d1ebce8d128decbe69", "committedDate": "2020-11-25T02:47:10Z", "message": "Polishing expectedData.yaml and some comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e20abe82b7724bbe9d2dff88e995bbcecead0cc", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/9e20abe82b7724bbe9d2dff88e995bbcecead0cc", "committedDate": "2020-11-25T02:57:52Z", "message": "Polishing expectedData.yaml and some comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81fde26b0901dddf2fe2f318dca77fedc12a9499", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/81fde26b0901dddf2fe2f318dca77fedc12a9499", "committedDate": "2020-11-25T03:09:58Z", "message": "Merge branch 'master' into cxf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98", "author": {"user": {"login": "dmsolr", "name": "Daming"}}, "url": "https://github.com/apache/skywalking/commit/aa2a7411c5455beb01ca884d43e253b130849c98", "committedDate": "2020-11-26T02:55:38Z", "message": "Merge branch 'master' into cxf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTYxNDI2", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-538961426", "createdAt": "2020-11-26T02:55:57Z", "commit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTcwODQ1", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-538970845", "createdAt": "2020-11-26T03:29:15Z", "commit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMzoyOToxNVrOH6Knzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMzoyOToxNVrOH6Knzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc1MzQ4Ng==", "bodyText": "What is the value of this ID?", "url": "https://github.com/apache/skywalking/pull/5887#discussion_r530753486", "createdAt": "2020-11-26T03:29:15Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/cxf-scenario/config/expectedData.yaml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+segmentItems:\n+  - serviceName: cxf-scenario\n+    segmentSize: ge 4\n+    segments:\n+      - segmentId: not null\n+        spans:\n+          - operationName: /cxf-scenario/soap/user\n+            operationId: 0\n+            parentSpanId: -1\n+            spanId: 0\n+            spanLayer: Http\n+            startTime: nq 0\n+            endTime: nq 0\n+            componentId: not null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36b0479b45484a8e631b78242cbf8ff046363273", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/36b0479b45484a8e631b78242cbf8ff046363273", "committedDate": "2020-11-26T03:45:39Z", "message": "Polishing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTc0NjE1", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-538974615", "createdAt": "2020-11-26T03:43:37Z", "commit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMzo0MzozN1rOH6K04Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMzo0MzozN1rOH6K04Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc1NjgzMw==", "bodyText": "Better move this to pugins-test.1.yaml or plugins-test.2.yaml.\n$ python3 tools/select-group.py\n/Volumes/data/developer/skywalking/.github/workflows/plugins-test.1.yaml 81\n/Volumes/data/developer/skywalking/.github/workflows/plugins-test.2.yaml 81\n/Volumes/data/developer/skywalking/.github/workflows/plugins-test.3.yaml 95\n/Volumes/data/developer/skywalking/.github/workflows/plugins-test.0.yaml 118", "url": "https://github.com/apache/skywalking/pull/5887#discussion_r530756833", "createdAt": "2020-11-26T03:43:37Z", "author": {"login": "kezhenxu94"}, "path": ".github/workflows/plugins-test.0.yaml", "diffHunk": "@@ -70,6 +70,7 @@ jobs:\n           - gson-scenario\n           - elasticjob-3.x-scenario\n           - springmvc-reactive-scenario\n+          - cxf-scenario", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2a7411c5455beb01ca884d43e253b130849c98"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b9a5726aa70d4dd2d769a413f8f8b7bd4d3034", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/a0b9a5726aa70d4dd2d769a413f8f8b7bd4d3034", "committedDate": "2020-11-26T03:47:23Z", "message": "Polishing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4585dc0d3803d25db52d6525b14ac7f4a3bbe7b", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/d4585dc0d3803d25db52d6525b14ac7f4a3bbe7b", "committedDate": "2020-11-26T06:38:52Z", "message": "Merge branch 'master' into cxf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MDI4NTcw", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-539028570", "createdAt": "2020-11-26T06:42:27Z", "commit": {"oid": "d4585dc0d3803d25db52d6525b14ac7f4a3bbe7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTE5NTYw", "url": "https://github.com/apache/skywalking/pull/5887#pullrequestreview-539119560", "createdAt": "2020-11-26T09:09:30Z", "commit": {"oid": "d4585dc0d3803d25db52d6525b14ac7f4a3bbe7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1386, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}