{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMTI3MTk2", "number": 5235, "title": "support collecting feign params", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n#5233", "createdAt": "2020-08-05T03:50:24Z", "url": "https://github.com/apache/skywalking/pull/5235", "merged": true, "mergeCommit": {"oid": "dd6f439df1c9d722dccb45eae4e040609a65ca12"}, "closed": true, "closedAt": "2020-08-06T05:09:32Z", "author": {"login": "zshit"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc700iqAFqTQ2MTM2MTQ0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8Ht_7gH2gAyNDYzMTI3MTk2OjIzMGU3ODBlNTQ5YmI5NWIxMzVkYmMyNDg2ZmFkMjZkMTljNTdhM2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzYxNDQ4", "url": "https://github.com/apache/skywalking/pull/5235#pullrequestreview-461361448", "createdAt": "2020-08-05T06:00:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjowMDowNFrOG77V4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjowMDowNFrOG77V4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ5MTQyNA==", "bodyText": "What does NB represent?", "url": "https://github.com/apache/skywalking/pull/5235#discussion_r465491424", "createdAt": "2020-08-05T06:00:04Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -131,6 +131,8 @@ property key | Description | Default |\n `plugin.tomcat.collect_http_params`| This config item controls that whether the Tomcat plugin should collect the parameters of the request. Also, activate implicitly in the profiled trace. | `false` |\n `plugin.springmvc.collect_http_params`| This config item controls that whether the SpringMVC plugin should collect the parameters of the request, when your Spring application is based on Tomcat, consider only setting either `plugin.tomcat.collect_http_params` or `plugin.springmvc.collect_http_params`. Also, activate implicitly in the profiled trace. | `false` |\n `plugin.http.http_params_length_threshold`| When `COLLECT_HTTP_PARAMS` is enabled, how many characters to keep and send to the OAP backend, use negative values to keep and send the complete parameters, NB. this config item is added for the sake of performance.  | `1024` |\n+`plugin.feign.trace_params`| This config item controls that whether the Feign plugin should collect the parameters of the request. | `false` |\n+`plugin.feign.filter_length_limit`| When `TRACE_PARAMS` is enabled, how many characters to keep and send to the OAP backend, use negative values to keep and send the complete parameters, NB. this config item is added for the sake of performance.  | `1024` |", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzYyMTk5", "url": "https://github.com/apache/skywalking/pull/5235#pullrequestreview-461362199", "createdAt": "2020-08-05T06:01:50Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjowMTo1MFrOG77YRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjowMTo1MFrOG77YRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ5MjAzOQ==", "bodyText": "This is not just tracking the HTTP parameter, this is tracking the whole request BODY. The config name and document should be adjusted.\nAlso, you should do this based on HTTP request type, an HTTP request could include binary(such as a file), please use the format in the headers to filter the requests.", "url": "https://github.com/apache/skywalking/pull/5235#discussion_r465492039", "createdAt": "2020-08-05T06:01:50Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/feign-default-http-9.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/feign/http/v9/DefaultHttpClientInterceptor.java", "diffHunk": "@@ -81,6 +82,16 @@ public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allAr\n         Tags.HTTP.METHOD.set(span, request.method());\n         Tags.URL.set(span, request.url());\n         SpanLayer.asHttp(span);\n+        if (FeignPluginConfig.Plugin.Feign.TRACE_PARAMS) {\n+            if (request.charset() != null && request.body() != null) {\n+                String tagValue = new String(request.body(), request.charset());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e27d4a42a16caaa85b7c6006463999d95e6d95ec", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/e27d4a42a16caaa85b7c6006463999d95e6d95ec", "committedDate": "2020-08-05T15:42:12Z", "message": "test manual"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24c7eefefed846c6a71320cbaef70b934acf8338", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/24c7eefefed846c6a71320cbaef70b934acf8338", "committedDate": "2020-08-05T15:42:12Z", "message": "passed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "335971d0addb6ba1e9130259ffc480bfd618c39c", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/335971d0addb6ba1e9130259ffc480bfd618c39c", "committedDate": "2020-08-05T15:42:12Z", "message": "edit README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3f128308ef0d4cbc733cf58d5ae404121aa4f3c", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c3f128308ef0d4cbc733cf58d5ae404121aa4f3c", "committedDate": "2020-08-05T15:42:12Z", "message": "adjust config name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c3f128308ef0d4cbc733cf58d5ae404121aa4f3c", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c3f128308ef0d4cbc733cf58d5ae404121aa4f3c", "committedDate": "2020-08-05T15:42:12Z", "message": "adjust config name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35948d5bba3be3fe246c6b6295ad9e9dd2fc0492", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/35948d5bba3be3fe246c6b6295ad9e9dd2fc0492", "committedDate": "2020-08-05T15:58:14Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c62dc7ff7a447c2d598abd0dc5228680860d9e2", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/5c62dc7ff7a447c2d598abd0dc5228680860d9e2", "committedDate": "2020-08-05T16:20:51Z", "message": "fix ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTE2MDgx", "url": "https://github.com/apache/skywalking/pull/5235#pullrequestreview-462116081", "createdAt": "2020-08-06T00:51:32Z", "commit": {"oid": "5c62dc7ff7a447c2d598abd0dc5228680860d9e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo1MTozMlrOG8fboA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo1MTozMlrOG8fboA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4MjcyMA==", "bodyText": "The default value is incorrect. Is Json the only default option?", "url": "https://github.com/apache/skywalking/pull/5235#discussion_r466082720", "createdAt": "2020-08-06T00:51:32Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -131,6 +131,9 @@ property key | Description | Default |\n `plugin.tomcat.collect_http_params`| This config item controls that whether the Tomcat plugin should collect the parameters of the request. Also, activate implicitly in the profiled trace. | `false` |\n `plugin.springmvc.collect_http_params`| This config item controls that whether the SpringMVC plugin should collect the parameters of the request, when your Spring application is based on Tomcat, consider only setting either `plugin.tomcat.collect_http_params` or `plugin.springmvc.collect_http_params`. Also, activate implicitly in the profiled trace. | `false` |\n `plugin.http.http_params_length_threshold`| When `COLLECT_HTTP_PARAMS` is enabled, how many characters to keep and send to the OAP backend, use negative values to keep and send the complete parameters, NB. this config item is added for the sake of performance.  | `1024` |\n+`plugin.feign.collect_request_body`| This config item controls that whether the Feign plugin should collect the http body of the request. | `false` |\n+`plugin.feign.filter_length_limit`| When `COLLECT_REQUEST_BODY` is enabled, how many characters to keep and send to the OAP backend, use negative values to keep and send the complete body.  | `1024` |\n+`plugin.feign.supported_content_types_prefix`| When `COLLECT_REQUEST_BODY` is enabled and content-type start with SUPPORTED_CONTENT_TYPES_PREFIX, collect the body of the request , multiple paths should be separated by `,`  | `1024` |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c62dc7ff7a447c2d598abd0dc5228680860d9e2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTE2ODEy", "url": "https://github.com/apache/skywalking/pull/5235#pullrequestreview-462116812", "createdAt": "2020-08-06T00:54:09Z", "commit": {"oid": "5c62dc7ff7a447c2d598abd0dc5228680860d9e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo1NDowOVrOG8feGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo1NDowOVrOG8feGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4MzM1NQ==", "bodyText": "text/plain should be supported, right?", "url": "https://github.com/apache/skywalking/pull/5235#discussion_r466083355", "createdAt": "2020-08-06T00:54:09Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/feign-scenario/src/main/java/org/apache/skywalking/apm/testcase/feign/controller/RestRequest.java", "diffHunk": "@@ -43,6 +43,11 @@\n     @Body(\"%7B\\\"id\\\": \\\"{id}\\\", \\\"userName\\\": \\\"{userName}\\\"%7D\")\n     User updateUser(@Param(\"id\") int id, @Param(\"userName\") String userName);\n \n+    @RequestLine(\"PUT /modify/{id}\")\n+    @Headers(\"Content-Type: text/plain\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c62dc7ff7a447c2d598abd0dc5228680860d9e2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9193552174a3765235a61d1fd39eb5f45705117", "author": {"user": {"login": "zshit", "name": null}}, "url": "https://github.com/apache/skywalking/commit/f9193552174a3765235a61d1fd39eb5f45705117", "committedDate": "2020-08-06T03:22:29Z", "message": "modify defalut option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTcxMjEy", "url": "https://github.com/apache/skywalking/pull/5235#pullrequestreview-462171212", "createdAt": "2020-08-06T04:00:54Z", "commit": {"oid": "f9193552174a3765235a61d1fd39eb5f45705117"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "230e780e549bb95b135dbc2486fad26d19c57a3a", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/230e780e549bb95b135dbc2486fad26d19c57a3a", "committedDate": "2020-08-06T04:01:07Z", "message": "Merge branch 'master' into support_collect_feign_params"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1858, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}