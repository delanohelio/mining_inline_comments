{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNTgwMDgw", "number": 4738, "title": "Fix nested query and type conversion in MySQL, remove unused codes", "bodyText": "", "createdAt": "2020-05-03T10:18:44Z", "url": "https://github.com/apache/skywalking/pull/4738", "merged": true, "mergeCommit": {"oid": "7b071bd7f7f7158afaae51ce0ab6d02dfb818b76"}, "closed": true, "closedAt": "2020-05-04T05:54:13Z", "author": {"login": "kezhenxu94"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdoKjegH2gAyNDEyNTgwMDgwOjBlNGU0Yjg4OGYwZjFlZGFjNWFiNmFlNWJlZjVlODYwYWExNGYyMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd3aqLgFqTQwNDcwMDM4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e4e4b888f0f1edac5ab6ae5bef5e860aa14f20b", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/0e4e4b888f0f1edac5ab6ae5bef5e860aa14f20b", "committedDate": "2020-05-03T10:17:37Z", "message": "Fix nested query and type conversion in MySQL, remove unused codes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjAyOTg1", "url": "https://github.com/apache/skywalking/pull/4738#pullrequestreview-404602985", "createdAt": "2020-05-03T10:20:40Z", "commit": {"oid": "0e4e4b888f0f1edac5ab6ae5bef5e860aa14f20b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMDoyMDo0MFrOGPqtoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMDoyMDo1OVrOGPqtyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MTYzMg==", "bodyText": "The codes below returns something like \"4010.00\" even if the value is a bigint in MySQL, causing Long.parseLong to throw exception\n\n  \n    \n      skywalking/oap-server/server-storage-plugin/storage-jdbc-hikaricp-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/h2/dao/H2AggregationQueryDAO.java\n    \n    \n         Line 82\n      in\n      0e4e4b8\n    \n    \n    \n    \n\n        \n          \n           topNEntity.setValue(resultSet.getString(\"value\"));", "url": "https://github.com/apache/skywalking/pull/4738#discussion_r419081632", "createdAt": "2020-05-03T10:20:40Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/query/type/TopNEntity.java", "diffHunk": "@@ -38,6 +38,6 @@ public TopNEntity() {\n     public TopNEntity(SelectedRecord record) {\n         this.name = record.getName();\n         this.id = record.getId();\n-        this.value = Long.parseLong(record.getValue());\n+        this.value = Double.valueOf(record.getValue()).longValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e4e4b888f0f1edac5ab6ae5bef5e860aa14f20b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MTY3Mw==", "bodyText": "MySQL needs an alias in nested query", "url": "https://github.com/apache/skywalking/pull/4738#discussion_r419081673", "createdAt": "2020-05-03T10:20:59Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-storage-plugin/storage-jdbc-hikaricp-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/h2/dao/H2AggregationQueryDAO.java", "diffHunk": "@@ -68,7 +68,7 @@ public H2AggregationQueryDAO(JDBCHikariCPClient h2Client) {\n             });\n         }\n         sql.append(\" group by \").append(Metrics.ENTITY_ID);\n-        sql.append(\") order by value \")\n+        sql.append(\")  as T order by value \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e4e4b888f0f1edac5ab6ae5bef5e860aa14f20b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce423064287792385ca3cca8ef1d821b42581d66", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/ce423064287792385ca3cca8ef1d821b42581d66", "committedDate": "2020-05-03T10:22:00Z", "message": "Merge branch 'master' into bugfix/mysql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4f1c4779126783b318daa42d83b598eb8404796", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/c4f1c4779126783b318daa42d83b598eb8404796", "committedDate": "2020-05-04T03:21:23Z", "message": "Merge branch 'master' into bugfix/mysql"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzAwMzAy", "url": "https://github.com/apache/skywalking/pull/4738#pullrequestreview-404700302", "createdAt": "2020-05-04T04:03:11Z", "commit": {"oid": "c4f1c4779126783b318daa42d83b598eb8404796"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzAwMzg3", "url": "https://github.com/apache/skywalking/pull/4738#pullrequestreview-404700387", "createdAt": "2020-05-04T04:03:46Z", "commit": {"oid": "c4f1c4779126783b318daa42d83b598eb8404796"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNDowMzo0N1rOGPyRfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNDowMzo0N1rOGPyRfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIwNTUwMw==", "bodyText": "Doesn't agent use this API, right?", "url": "https://github.com/apache/skywalking/pull/4738#discussion_r419205503", "createdAt": "2020-05-04T04:03:47Z", "author": {"login": "wu-sheng"}, "path": "apm-commons/apm-datacarrier/src/main/java/org/apache/skywalking/apm/commons/datacarrier/consumer/ConsumerPoolFactory.java", "diffHunk": "@@ -48,43 +47,4 @@ public ConsumerPool get(String poolName) {\n         return pools.get(poolName);\n     }\n \n-    /**\n-     * Default pool provides the same capabilities as DataCarrier#consume(IConsumer, 1), which alloc one thread for one\n-     * DataCarrier.\n-     */\n-    public static final ConsumerPool DEFAULT_POOL = new ConsumerPool() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f1c4779126783b318daa42d83b598eb8404796"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2368, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}