{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODk3MjE4", "number": 5690, "title": "Add async-http-client plugin", "bodyText": "Please answer these questions before submitting a pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n\n\n\nBug fix\n\n\nBug description.\n\n\nHow to fix?\n\n\n\nNew feature or improvement\n\nDescribe the details and related test reports.", "createdAt": "2020-10-19T11:30:31Z", "url": "https://github.com/apache/skywalking/pull/5690", "merged": true, "mergeCommit": {"oid": "c32caab6e0f1a21948fe9be9788af4d4b5b90e73"}, "closed": true, "closedAt": "2020-11-05T16:33:48Z", "author": {"login": "zhentaoJin"}, "timelineItems": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUAHSkgH2gAyNTA1ODk3MjE4OmRjNmE1NzM5N2ZjMWFiMzZlNzM3NmI2MWJmOGRkOTFkZjFjNGRlOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZk6ioAFqTUyNDQzNzg4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc6a57397fc1ab36e7376b61bf8dd91df1c4de8e", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/dc6a57397fc1ab36e7376b61bf8dd91df1c4de8e", "committedDate": "2020-10-19T08:43:41Z", "message": "feat: async-http-client\u63d2\u4ef6\u5f00\u53d1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5749e28a5e5eff719e7b374af19dbc7d690b52f3", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/5749e28a5e5eff719e7b374af19dbc7d690b52f3", "committedDate": "2020-10-19T08:57:59Z", "message": "feat:del useless code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1196f2bee879e61ebe4a95f923cd091182dd3ec6", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/1196f2bee879e61ebe4a95f923cd091182dd3ec6", "committedDate": "2020-10-19T11:28:59Z", "message": "feat: add license"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjg5NjQ4", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-511689648", "createdAt": "2020-10-19T12:06:59Z", "commit": {"oid": "1196f2bee879e61ebe4a95f923cd091182dd3ec6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjkxODQx", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-511691841", "createdAt": "2020-10-19T12:10:01Z", "commit": {"oid": "1196f2bee879e61ebe4a95f923cd091182dd3ec6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxMDowMVrOHkLNbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxMDowMVrOHkLNbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY5NDQ0Nw==", "bodyText": "This one should be added to the skywalking/oap-server/server-bootstrap/src/main/resources/component-libraries.yml", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r507694447", "createdAt": "2020-10-19T12:10:01Z", "author": {"login": "kezhenxu94"}, "path": "apm-protocol/apm-network/src/main/java/org/apache/skywalking/apm/network/trace/component/ComponentsDefine.java", "diffHunk": "@@ -185,4 +185,7 @@\n \n     public static final OfficialComponent THRIFT_CLIENT = new OfficialComponent(101, \"thrift-client\");\n \n+    public static final OfficialComponent ASYNC_HTTP_CLIENT = new OfficialComponent(102, \"AsyncHttpClient\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1196f2bee879e61ebe4a95f923cd091182dd3ec6"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "967b3564ced16663288b40854cb25e506b7e525f", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/967b3564ced16663288b40854cb25e506b7e525f", "committedDate": "2020-10-26T03:21:42Z", "message": "feat# Add plugin test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7203ff75a06bcb86fcc9a530db634a7ea8d095a3", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/7203ff75a06bcb86fcc9a530db634a7ea8d095a3", "committedDate": "2020-10-26T03:37:17Z", "message": "feat: 8.3.0-SNAPSHOT version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcbfd4f00b72c71d93f9f802a39b2a83db670263", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/fcbfd4f00b72c71d93f9f802a39b2a83db670263", "committedDate": "2020-10-26T04:42:57Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdb9c2c561fdf6397132096b7073fa9efb2fb2e8", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/cdb9c2c561fdf6397132096b7073fa9efb2fb2e8", "committedDate": "2020-10-26T07:39:07Z", "message": "feat:update plugin-list.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8207e50b049ba7d826a6146341ac25c651f0b38", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/c8207e50b049ba7d826a6146341ac25c651f0b38", "committedDate": "2020-10-26T07:39:33Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "583e92f5ba0b7d8b75ee813843679c8d76698cc0", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/583e92f5ba0b7d8b75ee813843679c8d76698cc0", "committedDate": "2020-10-26T07:53:41Z", "message": "feat:Rename plugin and update plugin-list.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ee430aa87bcfdcdd51305d7495670ebd82710d5", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/0ee430aa87bcfdcdd51305d7495670ebd82710d5", "committedDate": "2020-10-28T10:07:11Z", "message": "feat# Rename asynchttpclient plugin package name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f5ec644887365b1f362cec06e979b11547ee8b6", "author": {"user": {"login": "zhentaoJin", "name": "Jinzhentao"}}, "url": "https://github.com/apache/skywalking/commit/2f5ec644887365b1f362cec06e979b11547ee8b6", "committedDate": "2020-10-28T10:45:20Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTQxNjUx", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-521141651", "createdAt": "2020-10-31T13:58:49Z", "commit": {"oid": "2f5ec644887365b1f362cec06e979b11547ee8b6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79dce970225367eb06497a20390ba777412a76d0", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/79dce970225367eb06497a20390ba777412a76d0", "committedDate": "2020-11-02T11:54:57Z", "message": "feat# add asynchttpclient-scenario,update Supported-list.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "544885691ed850a283b8fb854ebafb647290706a", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/544885691ed850a283b8fb854ebafb647290706a", "committedDate": "2020-11-02T14:36:50Z", "message": "Merge remote-tracking branch 'upstream/master'\n\n# Conflicts:\n#\tapm-sniffer/apm-sdk-plugin/pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzE2ODQy", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-521716842", "createdAt": "2020-11-02T15:11:00Z", "commit": {"oid": "544885691ed850a283b8fb854ebafb647290706a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToxMTowMFrOHsIerw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToxNDo0NVrOHsIo7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzODMxOQ==", "bodyText": "Is this the only supported version?", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r516038319", "createdAt": "2020-11-02T15:11:00Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/asynchttpclient-scenario/support-version.list", "diffHunk": "@@ -0,0 +1,17 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+2.10.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "544885691ed850a283b8fb854ebafb647290706a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0MDk0Mw==", "bodyText": "As you documented, you support 2.x, then should be 2.0, 2.1... 2.10.", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r516040943", "createdAt": "2020-11-02T15:14:45Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/asynchttpclient-scenario/support-version.list", "diffHunk": "@@ -0,0 +1,17 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+2.10.0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzODMxOQ=="}, "originalCommit": {"oid": "544885691ed850a283b8fb854ebafb647290706a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a15d6fd695da4d534542c4b58d5b4cd63a920df", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/8a15d6fd695da4d534542c4b58d5b4cd63a920df", "committedDate": "2020-11-03T02:56:27Z", "message": "feat# update asynchttpclient scenario"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66934bc59758213860f541047aaa7fb20dddc40d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/66934bc59758213860f541047aaa7fb20dddc40d", "committedDate": "2020-11-03T08:41:13Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af127b5c375a9569ebf6addb721d0de376fd16a7", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/af127b5c375a9569ebf6addb721d0de376fd16a7", "committedDate": "2020-11-04T06:24:07Z", "message": "Polishing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "244b581012f2423d3a91b6c1a1e3567017bbbc60", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/244b581012f2423d3a91b6c1a1e3567017bbbc60", "committedDate": "2020-11-04T06:25:57Z", "message": "Merge branch 'master' into hanfei"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8444c343ae4fd3c89b6434ce2adb9b874a2c1da", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/e8444c343ae4fd3c89b6434ce2adb9b874a2c1da", "committedDate": "2020-11-04T07:16:55Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68baed32da6ce1ec248180d11c8ed85f6bfcb40b", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/68baed32da6ce1ec248180d11c8ed85f6bfcb40b", "committedDate": "2020-11-04T08:05:07Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTY3OTg1", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-523167985", "createdAt": "2020-11-04T09:14:15Z", "commit": {"oid": "68baed32da6ce1ec248180d11c8ed85f6bfcb40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwOToxNDoxNVrOHtPKqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwOToxNDoxNVrOHtPKqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE5NjQ1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ContextManager.activeSpan().errorOccurred().log(t);\n          \n          \n            \n                    ContextManager.activeSpan()..log(t);\n          \n      \n    \n    \n  \n\nI think I have reminded this? log includes the error default today.", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r517196459", "createdAt": "2020-11-04T09:14:15Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/asynchttpclient-2.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asynchttpclient/v1/ExecuteInterceptor.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.apm.plugin.asynchttpclient.v1;\n+\n+import io.netty.handler.codec.http.HttpHeaders;\n+import java.lang.reflect.Method;\n+import org.apache.skywalking.apm.agent.core.context.CarrierItem;\n+import org.apache.skywalking.apm.agent.core.context.ContextCarrier;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.EnhancedInstance;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceMethodsAroundInterceptor;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.asynchttpclient.Request;\n+import org.asynchttpclient.uri.Uri;\n+\n+public class ExecuteInterceptor implements InstanceMethodsAroundInterceptor {\n+\n+    @Override\n+    public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allArguments,\n+                             Class<?>[] argumentsTypes, MethodInterceptResult result) throws Throwable {\n+\n+        final Request httpRequest = (Request) allArguments[0];\n+        final Uri requestUri = httpRequest.getUri();\n+\n+        AbstractSpan span = ContextManager.createExitSpan(\n+            \"AsyncHttpClient\" + requestUri.getPath(), requestUri.getHost() + \":\" + requestUri.getPort());\n+\n+        ContextCarrier contextCarrier = new ContextCarrier();\n+        ContextManager.inject(contextCarrier);\n+        span.setComponent(ComponentsDefine.ASYNC_HTTP_CLIENT);\n+        Tags.HTTP.METHOD.set(span, httpRequest.getMethod());\n+        Tags.URL.set(span, httpRequest.getUrl());\n+        SpanLayer.asHttp(span);\n+\n+        final HttpHeaders headers = httpRequest.getHeaders();\n+        CarrierItem next = contextCarrier.items();\n+        while (next.hasNext()) {\n+            next = next.next();\n+            headers.add(next.getHeadKey(), next.getHeadValue());\n+        }\n+    }\n+\n+    @Override\n+    public Object afterMethod(EnhancedInstance objInst, Method method, Object[] allArguments,\n+                              Class<?>[] argumentsTypes, Object ret) throws Throwable {\n+        ContextManager.stopSpan();\n+        return ret;\n+    }\n+\n+    @Override\n+    public void handleMethodException(EnhancedInstance objInst, Method method, Object[] allArguments,\n+                                      Class<?>[] argumentsTypes, Throwable t) {\n+        ContextManager.activeSpan().errorOccurred().log(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68baed32da6ce1ec248180d11c8ed85f6bfcb40b"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTY5NTY2", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-523169566", "createdAt": "2020-11-04T09:16:17Z", "commit": {"oid": "68baed32da6ce1ec248180d11c8ed85f6bfcb40b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98d050cdce3ec8b170a2528193c8467b997f80b", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/a98d050cdce3ec8b170a2528193c8467b997f80b", "committedDate": "2020-11-04T09:31:19Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f14e98d8bf5cf877b470464e9c973ff5711abdd0", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/f14e98d8bf5cf877b470464e9c973ff5711abdd0", "committedDate": "2020-11-05T02:28:05Z", "message": "Add AsyncHandlerWrapper for get the span real time duration, and stop the span."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81bf3b0ed4d41e8da137952b571b0257def91ff9", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/81bf3b0ed4d41e8da137952b571b0257def91ff9", "committedDate": "2020-11-05T06:22:04Z", "message": "Merge branch 'hanfei'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83b3ab2bf7ce32a7ae62510820dfa958a70ef12e", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/83b3ab2bf7ce32a7ae62510820dfa958a70ef12e", "committedDate": "2020-11-05T07:32:51Z", "message": "Polishing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08470b30716e274ad48389a2e2638b6801040da5", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/08470b30716e274ad48389a2e2638b6801040da5", "committedDate": "2020-11-05T09:22:44Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTAzNTg1", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524103585", "createdAt": "2020-11-05T10:05:49Z", "commit": {"oid": "08470b30716e274ad48389a2e2638b6801040da5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65fdfe4da471f28b4c97279e0c11c8c97f92eb4b", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/65fdfe4da471f28b4c97279e0c11c8c97f92eb4b", "committedDate": "2020-11-05T10:15:22Z", "message": "feat#update CHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aee9327b08203eb48c09963cb9947a4781c936a4", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/aee9327b08203eb48c09963cb9947a4781c936a4", "committedDate": "2020-11-05T10:15:51Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d78856032188562d4234ad48549ea73c95e7949", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/0d78856032188562d4234ad48549ea73c95e7949", "committedDate": "2020-11-05T10:16:05Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTE4OTE0", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524118914", "createdAt": "2020-11-05T10:24:20Z", "commit": {"oid": "0d78856032188562d4234ad48549ea73c95e7949"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDoyNDoyMFrOHt8tXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDoyNDoyMFrOHt8tXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk0MjYyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Make the asynchttpclient 2.x plugin to support collecting HTTP parameters.\n          \n          \n            \n            * Add the plugin for async-http-client 2.x", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r517942623", "createdAt": "2020-11-05T10:24:20Z", "author": {"login": "wu-sheng"}, "path": "CHANGES.md", "diffHunk": "@@ -14,6 +14,7 @@ Release Notes.\n * Make the Feign plugin to support Java 14\n * Make the okhttp3 plugin to support Java 14\n * Polish tracing context related codes.\n+* Make the asynchttpclient 2.x plugin to support collecting HTTP parameters.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d78856032188562d4234ad48549ea73c95e7949"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/4d5404a5936ce9a0efec1ad1cee3c0ce07c35517", "committedDate": "2020-11-05T10:25:26Z", "message": "feat#update CHANGES.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTI1NTQ5", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524125549", "createdAt": "2020-11-05T10:32:27Z", "commit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTY0NzY4", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524164768", "createdAt": "2020-11-05T11:23:36Z", "commit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMToyMzozNlrOHt-27Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTozMjowMFrOHt_Jkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk3NzgzNw==", "bodyText": "Note that, must be avoided to interrupt the process of the application in the wrapper class.", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r517977837", "createdAt": "2020-11-05T11:23:36Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/apm-sdk-plugin/asynchttpclient-2.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asynchttpclient/v1/AsyncHandlerWrapper.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.apm.plugin.asynchttpclient.v1;\n+\n+import io.netty.channel.Channel;\n+import io.netty.handler.codec.http.HttpHeaders;\n+import java.net.InetSocketAddress;\n+import java.util.List;\n+import javax.net.ssl.SSLSession;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.asynchttpclient.AsyncCompletionHandlerBase;\n+import org.asynchttpclient.AsyncHandler;\n+import org.asynchttpclient.HttpResponseBodyPart;\n+import org.asynchttpclient.HttpResponseStatus;\n+import org.asynchttpclient.netty.request.NettyRequest;\n+\n+/**\n+ * {@link AsyncHandlerWrapper} wrapper the {@link AsyncHandler} object for tracing.\n+ * if userAsyncHandler is null, we will set {@link AsyncCompletionHandlerBase} to avoid NPE.\n+ */\n+public class AsyncHandlerWrapper implements AsyncHandler {\n+\n+    private final AsyncHandler userAsyncHandler;\n+    private final AbstractSpan asyncSpan;\n+\n+    public AsyncHandlerWrapper(AsyncHandler asyncHandler, AbstractSpan span) {\n+        this.userAsyncHandler = asyncHandler == null ? new AsyncCompletionHandlerBase() : asyncHandler;\n+        this.asyncSpan = span;\n+    }\n+\n+    @Override\n+    public State onStatusReceived(final HttpResponseStatus httpResponseStatus) throws Exception {\n+        return userAsyncHandler.onStatusReceived(httpResponseStatus);\n+    }\n+\n+    @Override\n+    public State onHeadersReceived(final HttpHeaders httpHeaders) throws Exception {\n+        return userAsyncHandler.onHeadersReceived(httpHeaders);\n+    }\n+\n+    @Override\n+    public State onBodyPartReceived(final HttpResponseBodyPart httpResponseBodyPart) throws Exception {\n+        return userAsyncHandler.onBodyPartReceived(httpResponseBodyPart);\n+    }\n+\n+    @Override\n+    public State onTrailingHeadersReceived(final HttpHeaders headers) throws Exception {\n+        return userAsyncHandler.onTrailingHeadersReceived(headers);\n+    }\n+\n+    @Override\n+    public void onThrowable(final Throwable throwable) {\n+        asyncSpan.log(throwable);\n+        asyncSpan.asyncFinish();\n+        userAsyncHandler.onThrowable(throwable);\n+    }\n+\n+    @Override\n+    public Object onCompleted() throws Exception {\n+        asyncSpan.asyncFinish();\n+        return userAsyncHandler.onCompleted();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk3OTY4Mw==", "bodyText": "Change to single-line comment", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r517979683", "createdAt": "2020-11-05T11:26:55Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/apm-sdk-plugin/asynchttpclient-2.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asynchttpclient/v1/ExecuteInterceptor.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.apm.plugin.asynchttpclient.v1;\n+\n+import io.netty.handler.codec.http.HttpHeaders;\n+import java.lang.reflect.Method;\n+import org.apache.skywalking.apm.agent.core.context.CarrierItem;\n+import org.apache.skywalking.apm.agent.core.context.ContextCarrier;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.EnhancedInstance;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceMethodsAroundInterceptor;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.asynchttpclient.AsyncHandler;\n+import org.asynchttpclient.Request;\n+import org.asynchttpclient.uri.Uri;\n+\n+/**\n+ * interceptor for {@link org.asynchttpclient.DefaultAsyncHttpClient}\n+ */\n+public class ExecuteInterceptor implements InstanceMethodsAroundInterceptor {\n+\n+    @Override\n+    public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allArguments,\n+                             Class<?>[] argumentsTypes, MethodInterceptResult result) throws Throwable {\n+\n+        final Request httpRequest = (Request) allArguments[0];\n+        final Uri requestUri = httpRequest.getUri();\n+\n+        AbstractSpan span = ContextManager.createExitSpan(\n+            \"AsyncHttpClient\" + requestUri.getPath(), requestUri.getHost() + \":\" + requestUri.getPort());\n+\n+        /**\n+         * We wrapper the allArguments[1] for get the real time duration, and stop the span.\n+         */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4MjYxMA==", "bodyText": "what does the v1 mean?", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r517982610", "createdAt": "2020-11-05T11:32:00Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/apm-sdk-plugin/asynchttpclient-2.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asynchttpclient/v1/AsyncHandlerWrapper.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.apm.plugin.asynchttpclient.v1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjExMjAy", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524211202", "createdAt": "2020-11-05T12:27:51Z", "commit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMjoyNzo1MVrOHuBB3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMjoyNzo1MVrOHuBB3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODAxMzQwNw==", "bodyText": "This method should be try-catch. This could trigger the exception if the plugin has bug, or the target lib has bug.", "url": "https://github.com/apache/skywalking/pull/5690#discussion_r518013407", "createdAt": "2020-11-05T12:27:51Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/asynchttpclient-2.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asynchttpclient/v1/AsyncHandlerWrapper.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.apm.plugin.asynchttpclient.v1;\n+\n+import io.netty.channel.Channel;\n+import io.netty.handler.codec.http.HttpHeaders;\n+import java.net.InetSocketAddress;\n+import java.util.List;\n+import javax.net.ssl.SSLSession;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.asynchttpclient.AsyncCompletionHandlerBase;\n+import org.asynchttpclient.AsyncHandler;\n+import org.asynchttpclient.HttpResponseBodyPart;\n+import org.asynchttpclient.HttpResponseStatus;\n+import org.asynchttpclient.netty.request.NettyRequest;\n+\n+/**\n+ * {@link AsyncHandlerWrapper} wrapper the {@link AsyncHandler} object for tracing.\n+ * if userAsyncHandler is null, we will set {@link AsyncCompletionHandlerBase} to avoid NPE.\n+ */\n+public class AsyncHandlerWrapper implements AsyncHandler {\n+\n+    private final AsyncHandler userAsyncHandler;\n+    private final AbstractSpan asyncSpan;\n+\n+    public AsyncHandlerWrapper(AsyncHandler asyncHandler, AbstractSpan span) {\n+        this.userAsyncHandler = asyncHandler == null ? new AsyncCompletionHandlerBase() : asyncHandler;\n+        this.asyncSpan = span;\n+    }\n+\n+    @Override\n+    public State onStatusReceived(final HttpResponseStatus httpResponseStatus) throws Exception {\n+        return userAsyncHandler.onStatusReceived(httpResponseStatus);\n+    }\n+\n+    @Override\n+    public State onHeadersReceived(final HttpHeaders httpHeaders) throws Exception {\n+        return userAsyncHandler.onHeadersReceived(httpHeaders);\n+    }\n+\n+    @Override\n+    public State onBodyPartReceived(final HttpResponseBodyPart httpResponseBodyPart) throws Exception {\n+        return userAsyncHandler.onBodyPartReceived(httpResponseBodyPart);\n+    }\n+\n+    @Override\n+    public State onTrailingHeadersReceived(final HttpHeaders headers) throws Exception {\n+        return userAsyncHandler.onTrailingHeadersReceived(headers);\n+    }\n+\n+    @Override\n+    public void onThrowable(final Throwable throwable) {\n+        asyncSpan.log(throwable);\n+        asyncSpan.asyncFinish();\n+        userAsyncHandler.onThrowable(throwable);\n+    }\n+\n+    @Override\n+    public Object onCompleted() throws Exception {\n+        asyncSpan.asyncFinish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5404a5936ce9a0efec1ad1cee3c0ce07c35517"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672bf38776cd1e4efb50d9bcc4856ca0d4b3f4c9", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/672bf38776cd1e4efb50d9bcc4856ca0d4b3f4c9", "committedDate": "2020-11-05T12:46:04Z", "message": "Polishing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ac2c50c6b3916deba8f6b638190fc0544b6909", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/a9ac2c50c6b3916deba8f6b638190fc0544b6909", "committedDate": "2020-11-05T12:53:59Z", "message": "feat#Change to single-line comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c39788b52fa4d6e375b71e49f9658b2cfd4f2c", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/b5c39788b52fa4d6e375b71e49f9658b2cfd4f2c", "committedDate": "2020-11-05T13:32:52Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac1223ec635d5dd69ea03d77afa1da9e022a2c06", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/ac1223ec635d5dd69ea03d77afa1da9e022a2c06", "committedDate": "2020-11-05T13:35:39Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce86be6bd9ee55d55d34701f549d02e04a372c3", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/3ce86be6bd9ee55d55d34701f549d02e04a372c3", "committedDate": "2020-11-05T13:36:49Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa416304e6430fa77ba0f11028125ae7ca485d01", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/aa416304e6430fa77ba0f11028125ae7ca485d01", "committedDate": "2020-11-05T13:38:28Z", "message": "feat#Change to single-line comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e114e00e0635f2a6c5f01668d135fdebff41759c", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/e114e00e0635f2a6c5f01668d135fdebff41759c", "committedDate": "2020-11-05T13:41:19Z", "message": "feat#Change to single-line comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MzM4NDc4", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524338478", "createdAt": "2020-11-05T14:50:58Z", "commit": {"oid": "e114e00e0635f2a6c5f01668d135fdebff41759c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MzQxMjAx", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524341201", "createdAt": "2020-11-05T14:53:27Z", "commit": {"oid": "e114e00e0635f2a6c5f01668d135fdebff41759c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbce5f5cce2cd8ed26ce6d662f2bd6d5a0886bc1", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/dbce5f5cce2cd8ed26ce6d662f2bd6d5a0886bc1", "committedDate": "2020-11-05T15:13:29Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NDM3ODgx", "url": "https://github.com/apache/skywalking/pull/5690#pullrequestreview-524437881", "createdAt": "2020-11-05T16:25:52Z", "commit": {"oid": "dbce5f5cce2cd8ed26ce6d662f2bd6d5a0886bc1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1545, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}