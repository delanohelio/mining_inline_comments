{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNDc0NzY5", "number": 4244, "title": "Drop support of protocol v1 (sw3)", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\n Chore\n\n\nRelated issues\n\n\ncloses #4176\nprotocol removal will be done in the protocol repository", "createdAt": "2020-01-16T06:16:31Z", "url": "https://github.com/apache/skywalking/pull/4244", "merged": true, "mergeCommit": {"oid": "019af3e3456fff49500eb6440b94eb95aa3a4ed9"}, "closed": true, "closedAt": "2020-01-17T12:33:53Z", "author": {"login": "kezhenxu94"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb60BpeAFqTM0MzY5Mjk5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7N8oRgFqTM0NDU0Nzk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNjkyOTk4", "url": "https://github.com/apache/skywalking/pull/4244#pullrequestreview-343692998", "createdAt": "2020-01-16T06:19:24Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f5cecb60a6493824a041aeeac9e969c0223f8e4", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/2f5cecb60a6493824a041aeeac9e969c0223f8e4", "committedDate": "2020-01-16T06:31:47Z", "message": "Drop support of protocol v1 (sw3)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a5cf60501b7d47a8a47d8414f41e9de969ab40", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/04a5cf60501b7d47a8a47d8414f41e9de969ab40", "committedDate": "2020-01-16T06:32:18Z", "message": "Merge branch 'master' into chore/drop-protocol-v1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzAxMjYz", "url": "https://github.com/apache/skywalking/pull/4244#pullrequestreview-343701263", "createdAt": "2020-01-16T06:47:41Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549abf4a884731f003442e9c1ce4b1441ab10501", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/549abf4a884731f003442e9c1ce4b1441ab10501", "committedDate": "2020-01-16T08:34:43Z", "message": "Merge branch 'master' into chore/drop-protocol-v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ca4d6f4f090e76ca13d64ab92d5e28ff6eeacc", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/e5ca4d6f4f090e76ca13d64ab92d5e28ff6eeacc", "committedDate": "2020-01-16T11:19:06Z", "message": "Remove versioning logic further"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93a8a8839e1d7ec27eba1ba9951be444ee6848ee", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/93a8a8839e1d7ec27eba1ba9951be444ee6848ee", "committedDate": "2020-01-16T13:05:48Z", "message": "Merge branch 'master' into chore/drop-protocol-v1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MzAyNDMy", "url": "https://github.com/apache/skywalking/pull/4244#pullrequestreview-344302432", "createdAt": "2020-01-17T00:29:31Z", "commit": {"oid": "93a8a8839e1d7ec27eba1ba9951be444ee6848ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMDoyOTozMVrOFertEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMDoyOTozMVrOFertEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzcxNzY0OA==", "bodyText": "What is this TODO for?", "url": "https://github.com/apache/skywalking/pull/4244#discussion_r367717648", "createdAt": "2020-01-17T00:29:31Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/test/java/org/apache/skywalking/apm/agent/core/context/ContextCarrierV2HeaderTest.java", "diffHunk": "@@ -107,37 +58,19 @@ public void testSerializeV2Header() {\n         CarrierItem next = contextCarrier.items();\n         while (next.hasNext()) {\n             next = next.next();\n-            if (next.getHeadKey().equals(\"sw3\")) {\n-                Assert.assertEquals(\"\", next.getHeadValue());\n-            } else if (next.getHeadKey().equals(\"sw6\")) {\n-                /**\n-                 * sampleFlag-traceId-segmentId-spanId-parentAppInstId-entryAppInstId-peerHost-entryEndpoint-parentEndpoint\n-                 *\n-                 * \"1-3.4.5-1.2.3-4-1-1-#127.0.0.1:8080-#/portal-123\"\n-                 */\n-                Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n-            } else {\n-                Assert.fail(\"unexpected key\");\n-            }\n+            /*\n+             * sampleFlag-traceId-segmentId-spanId-parentAppInstId-entryAppInstId-peerHost-entryEndpoint-parentEndpoint\n+             *\n+             * \"1-3.4.5-1.2.3-4-1-1-#127.0.0.1:8080-#/portal-123\"\n+             */\n+            Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n         }\n \n-        Config.Agent.ACTIVE_V1_HEADER = true;\n-        try {\n-            next = contextCarrier.items();\n-            while (next.hasNext()) {\n-                next = next.next();\n-                if (next.getHeadKey().equals(\"sw3\")) {\n-                    Assert.assertEquals(\"1.2.3|4|1|1|#127.0.0.1:8080|#/portal|123|3.4.5\", next.getHeadValue());\n-                } else if (next.getHeadKey().equals(\"sw6\")) {\n-                    //TODO, no BASE64\n-                    Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n-                } else {\n-                    Assert.fail(\"unexpected key\");\n-                }\n-            }\n-\n-        } finally {\n-            Config.Agent.ACTIVE_V1_HEADER = false;\n+        next = contextCarrier.items();\n+        while (next.hasNext()) {\n+            next = next.next();\n+            //TODO, no BASE64", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93a8a8839e1d7ec27eba1ba9951be444ee6848ee"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d", "committedDate": "2020-01-17T05:47:34Z", "message": "Remove more version5-only classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a96589fedf90c414fda794ef569f27cbb3363dfd", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/a96589fedf90c414fda794ef569f27cbb3363dfd", "committedDate": "2020-01-17T05:48:00Z", "message": "Merge remote-tracking branch 'origin/chore/drop-protocol-v1' into chore/drop-protocol-v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7745dfb8399d61172d98838b0240e41f24ab56ee", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/7745dfb8399d61172d98838b0240e41f24ab56ee", "committedDate": "2020-01-17T05:55:44Z", "message": "Commit missing files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDcxMDU4", "url": "https://github.com/apache/skywalking/pull/4244#pullrequestreview-344471058", "createdAt": "2020-01-17T09:58:17Z", "commit": {"oid": "f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTo1ODoxOFrOFe0BPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTo1ODoxOFrOFe0BPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1Mzg4Ng==", "bodyText": "segmentCoreInfo.getVersion().number Why write in this way? .number?", "url": "https://github.com/apache/skywalking/pull/4244#discussion_r367853886", "createdAt": "2020-01-17T09:58:18Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-receiver-plugin/skywalking-trace-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/trace/provider/parser/listener/segment/SegmentSpanListener.java", "diffHunk": "@@ -81,10 +82,7 @@ public void parseFirst(SpanDecorator spanDecorator, SegmentCoreInfo segmentCoreI\n         segment.setIsError(BooleanUtils.booleanToValue(segmentCoreInfo.isError()));\n         segment.setTimeBucket(timeBucket);\n         segment.setDataBinary(segmentCoreInfo.getDataBinary());\n-        /**\n-         * Only consider v1, v2 compatible for now.\n-         */\n-        segment.setVersion(segmentCoreInfo.isV2() ? 2 : 1);\n+        segment.setVersion(segmentCoreInfo.getVersion().number);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3844f308501a040266233bf714d467ee1a683ef", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/a3844f308501a040266233bf714d467ee1a683ef", "committedDate": "2020-01-17T10:34:21Z", "message": "Update submodule and address review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aff404a56428934af3549a7850a35f56f2f4ed38", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/aff404a56428934af3549a7850a35f56f2f4ed38", "committedDate": "2020-01-17T11:06:43Z", "message": "Fix failed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTQ3OTcw", "url": "https://github.com/apache/skywalking/pull/4244#pullrequestreview-344547970", "createdAt": "2020-01-17T12:31:27Z", "commit": {"oid": "aff404a56428934af3549a7850a35f56f2f4ed38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2592, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}