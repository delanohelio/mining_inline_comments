{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NTAxNDY3", "number": 5915, "title": "Make meter receiver support MAL", "bodyText": "Make agent side meter receiver support MAL\n\n Update the documentation to include this new feature.\n Tests(including UT, IT, E2E) are added to verify the new feature.\n Update the CHANGES log.", "createdAt": "2020-11-27T09:37:40Z", "url": "https://github.com/apache/skywalking/pull/5915", "merged": true, "mergeCommit": {"oid": "821322447d76dab4ae605b3ba0a916fa61ff7a47"}, "closed": true, "closedAt": "2020-11-30T09:28:21Z", "author": {"login": "mrproliu"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgK0rWAH2gAyNTI4NTAxNDY3OjQ0NGE3OThiOTVkNmQyMDM5MzY2OTczY2M5MjdkNDIyYzY5MmJiMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhg0JBgFqTU0MDY3MzEwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "444a798b95d6d2039366973cc927d422c692bb1e", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/444a798b95d6d2039366973cc927d422c692bb1e", "committedDate": "2020-11-26T03:59:24Z", "message": "Make meter receiver support MAL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24695314fccad330f542967ff6d2006c8407fa6", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/f24695314fccad330f542967ff6d2006c8407fa6", "committedDate": "2020-11-27T03:54:04Z", "message": "Add default time unit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52d6a56384d9d077661b5587386b2a0f4335515", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/a52d6a56384d9d077661b5587386b2a0f4335515", "committedDate": "2020-11-27T04:19:19Z", "message": "Merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edd9df4ffca53f982594920298741e46e50278b0", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/edd9df4ffca53f982594920298741e46e50278b0", "committedDate": "2020-11-27T07:41:22Z", "message": "Adapt the new metrics rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8badff06c1e5a2ae01af93d868ac9a641e7fa6d0", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/8badff06c1e5a2ae01af93d868ac9a641e7fa6d0", "committedDate": "2020-11-27T08:29:54Z", "message": "Merge remote-tracking branch 'upstream/master' into agent-side-meter-support-mal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a33ac8cb97b7cf073196b7d8da3427a7e6ffdf", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/01a33ac8cb97b7cf073196b7d8da3427a7e6ffdf", "committedDate": "2020-11-27T08:35:04Z", "message": "Fix submodule HEAD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25087a1c5109b1286fdf8c639a11c608fa39fd8a", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/25087a1c5109b1286fdf8c639a11c608fa39fd8a", "committedDate": "2020-11-27T09:26:49Z", "message": "Change protocol HEAD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "452f7a75f3b85f6c82c997b7b8d822902b9b9fc4", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/452f7a75f3b85f6c82c997b7b8d822902b9b9fc4", "committedDate": "2020-11-27T09:29:52Z", "message": "Rollback project required maven version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5d257d4d5512f1caa56da69a0d0a2bb9e4c7fd", "author": {"user": {"login": "mrproliu", "name": null}}, "url": "https://github.com/apache/skywalking/commit/2e5d257d4d5512f1caa56da69a0d0a2bb9e4c7fd", "committedDate": "2020-11-27T09:37:54Z", "message": "Merge branch 'master' into agent-side-meter-support-mal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "committedDate": "2020-11-27T12:23:04Z", "message": "Fix getting rules error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMjE0NTUx", "url": "https://github.com/apache/skywalking/pull/5915#pullrequestreview-540214551", "createdAt": "2020-11-28T00:23:46Z", "commit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyMzo0NlrOH7LQDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyMzo0NlrOH7LQDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw==", "bodyText": "From https://en.wikipedia.org/wiki/Histogram#Mathematical_definition, there are two types of histogram bin:\n\nCumulative: prometheus, otel.\nOrdinary: agent meter.\n\nLet's provide two functions to set it, and defaults to cumulative.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812367", "createdAt": "2020-11-28T00:23:46Z", "author": {"login": "hanahmily"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMjE0ODYy", "url": "https://github.com/apache/skywalking/pull/5915#pullrequestreview-540214862", "createdAt": "2020-11-28T00:27:57Z", "commit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyNzo1N1rOH7LSDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyNzo1N1rOH7LSDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjg3Nw==", "bodyText": "My preference is to add a new factory to build SampleFamily with those two settings. If we define functions in SampleFamily, that means end-users could access them, that will cause some potential issues.\nand they represent the different behaviors of the eco-system, I don't find any reason to access them in a MAL expression.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812877", "createdAt": "2020-11-28T00:27:57Z", "author": {"login": "hanahmily"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {\n+        this.context.ignoreHistogramDecrease = true;\n+        return this;\n+    }\n+\n+    /**\n+     * Change default histogram bucket value unit,\n+     * use second on the Prometheus, use millisecond on the meter side meter\n+     */\n+    public SampleFamily defaultHistogramBucketUnit(TimeUnit unit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bcd5efb234cabba5aa923d938b6e25ee224f1af", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/9bcd5efb234cabba5aa923d938b6e25ee224f1af", "committedDate": "2020-11-28T05:00:24Z", "message": "Fix sleuth missing config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e3364069e4085c20e1f8cb64badc85f5d3362b5", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/7e3364069e4085c20e1f8cb64badc85f5d3362b5", "committedDate": "2020-11-28T10:47:14Z", "message": "Using Builder mode to create SampleFamily"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53f3b49d0501dc00345a471916df324bc1838c73", "author": {"user": {"login": "mrproliu", "name": null}}, "url": "https://github.com/apache/skywalking/commit/53f3b49d0501dc00345a471916df324bc1838c73", "committedDate": "2020-11-28T10:49:57Z", "message": "Merge branch 'master' into agent-side-meter-support-mal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c04457b5ad43045f0e3af932eab8e63f9234146", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/6c04457b5ad43045f0e3af932eab8e63f9234146", "committedDate": "2020-11-29T15:18:43Z", "message": "Merge branch 'master' into agent-side-meter-support-mal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23ca2915f03aeea2176cdc86320e11a500fdfe60", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/23ca2915f03aeea2176cdc86320e11a500fdfe60", "committedDate": "2020-11-30T05:27:24Z", "message": "Update CHANGES.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNjczMTA3", "url": "https://github.com/apache/skywalking/pull/5915#pullrequestreview-540673107", "createdAt": "2020-11-30T08:10:39Z", "commit": {"oid": "23ca2915f03aeea2176cdc86320e11a500fdfe60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1411, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}