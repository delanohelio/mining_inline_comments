{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNzc1Nzk1", "number": 5390, "title": "Support IN filter expressions in OAL", "bodyText": "Support in  expression and fix some question.", "createdAt": "2020-08-26T09:25:59Z", "url": "https://github.com/apache/skywalking/pull/5390", "merged": true, "mergeCommit": {"oid": "c5df0760f257e523902b641755b1cf7e6cee4476"}, "closed": true, "closedAt": "2020-08-26T15:50:59Z", "author": {"login": "arugal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCoSlRgH2gAyNDczNzc1Nzk1OjViZDlhYmMwMzFmMWQ3ZmM2NTcwMmQ5ZTBiM2IzZTNiMzQxMDM2MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCt24AgFqTQ3NTYyNjcwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c", "committedDate": "2020-08-26T09:21:35Z", "message": "support in"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MzE3NjY0", "url": "https://github.com/apache/skywalking/pull/5390#pullrequestreview-475317664", "createdAt": "2020-08-26T09:32:34Z", "commit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTozMjozNFrOHHEBCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTozNjowMVrOHHEJJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE2Nzg4MA==", "bodyText": "I think this empty line is not required.", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477167880", "createdAt": "2020-08-26T09:32:34Z", "author": {"login": "wu-sheng"}, "path": "oap-server/oal-rt/src/main/java/org/apache/skywalking/oal/rt/parser/ConditionExpression.java", "diffHunk": "@@ -18,18 +18,42 @@\n \n package org.apache.skywalking.oal.rt.parser;\n \n-import lombok.AllArgsConstructor;\n+import java.util.LinkedList;\n+import java.util.List;\n import lombok.Getter;\n import lombok.NoArgsConstructor;\n import lombok.Setter;\n \n @Getter\n @Setter\n @NoArgsConstructor\n-@AllArgsConstructor\n public class ConditionExpression {\n     // original from script\n     private String expressionType;\n     private String attribute;\n     private String value;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE2OTk1Nw==", "bodyText": "equal match support literal string?", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477169957", "createdAt": "2020-08-26T09:36:01Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/analysis/metrics/expression/EqualMatch.java", "diffHunk": "@@ -23,6 +23,19 @@\n \n @FilterMatcher(\"stringMatch\")\n public class EqualMatch {\n+\n+    public boolean match(String left, String right) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MzIzMjEz", "url": "https://github.com/apache/skywalking/pull/5390#pullrequestreview-475323213", "createdAt": "2020-08-26T09:40:02Z", "commit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTo0MDowMlrOHHESqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwOTo0MDowMlrOHHESqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3MjM5Mw==", "bodyText": "@kezhenxu94, the like expression seems to have some issue when @arugal did local test. He did local tests, so he moved the symbols here.", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477172393", "createdAt": "2020-08-26T09:40:02Z", "author": {"login": "wu-sheng"}, "path": "oap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4", "diffHunk": "@@ -61,6 +61,26 @@ SRC_PROFILE_TASK: 'profile_task';\n SRC_PROFILE_TASK_LOG: 'profile_task_log';\n SRC_PROFILE_THREAD_SHANPSHOT: 'profile_task_segment_snapshot';\n \n+// Constructors symbols", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8ab6fc33e7b492b9f508c7f845fc03d9383d46c", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/f8ab6fc33e7b492b9f508c7f845fc03d9383d46c", "committedDate": "2020-08-26T09:42:14Z", "message": "del empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1037cfa76598098ea1e632d679829574f2971c5f", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/1037cfa76598098ea1e632d679829574f2971c5f", "committedDate": "2020-08-26T11:12:03Z", "message": "Merge branch 'master' into oal/expression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDA0NTU5", "url": "https://github.com/apache/skywalking/pull/5390#pullrequestreview-475404559", "createdAt": "2020-08-26T11:41:05Z", "commit": {"oid": "1037cfa76598098ea1e632d679829574f2971c5f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTo0MTowNVrOHHIIsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMjo1MTowOVrOHHKjtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzNTM3Nw==", "bodyText": "I think the original LR_BRACKET means Left Round Bracket, so the new one can be simplified LS_BRACKET, or if you like L_SQUARE_BRACKET", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477235377", "createdAt": "2020-08-26T11:41:05Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4", "diffHunk": "@@ -61,6 +61,26 @@ SRC_PROFILE_TASK: 'profile_task';\n SRC_PROFILE_TASK_LOG: 'profile_task_log';\n SRC_PROFILE_THREAD_SHANPSHOT: 'profile_task_segment_snapshot';\n \n+// Constructors symbols\n+\n+DOT:                                 '.';\n+LR_BRACKET:                          '(';\n+RR_BRACKET:                          ')';\n+LR_SQUARE_BRACKET:                   '[';\n+RR_SQUARE_BRACKET:                   ']';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1037cfa76598098ea1e632d679829574f2971c5f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzNzIwNg==", "bodyText": "I don't see any difference between the like expression and others, and can be solved by simply moving these symbols, can you check why it (doesn't) work(s) (before) after moving these?", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477237206", "createdAt": "2020-08-26T11:44:41Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4", "diffHunk": "@@ -61,6 +61,26 @@ SRC_PROFILE_TASK: 'profile_task';\n SRC_PROFILE_TASK_LOG: 'profile_task_log';\n SRC_PROFILE_THREAD_SHANPSHOT: 'profile_task_segment_snapshot';\n \n+// Constructors symbols", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3MjM5Mw=="}, "originalCommit": {"oid": "5bd9abc031f1d7fc65702d9e0b3b3e3b3410361c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzODI5Mw==", "bodyText": "The minimal change is to annotate this field with @Builder.Default and give it a default value (null for example)", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477238293", "createdAt": "2020-08-26T11:46:50Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/oal-rt/src/main/java/org/apache/skywalking/oal/rt/parser/ConditionExpression.java", "diffHunk": "@@ -18,18 +18,41 @@\n \n package org.apache.skywalking.oal.rt.parser;\n \n-import lombok.AllArgsConstructor;\n+import java.util.LinkedList;\n+import java.util.List;\n import lombok.Getter;\n import lombok.NoArgsConstructor;\n import lombok.Setter;\n \n @Getter\n @Setter\n @NoArgsConstructor\n-@AllArgsConstructor\n public class ConditionExpression {\n     // original from script\n     private String expressionType;\n     private String attribute;\n     private String value;\n+    private List<String> values;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1037cfa76598098ea1e632d679829574f2971c5f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI3NTA2MQ==", "bodyText": "OK I made a mistake here before :(", "url": "https://github.com/apache/skywalking/pull/5390#discussion_r477275061", "createdAt": "2020-08-26T12:51:09Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/analysis/metrics/expression/LikeMatch.java", "diffHunk": "@@ -23,14 +23,18 @@\n @FilterMatcher\n public class LikeMatch {\n     public boolean match(String left, String right) {\n-        if (left == null || right == null) {\n+        if (right == null || left == null) {\n             return false;\n         }\n-        if (left.startsWith(\"%\") && left.endsWith(\"%\")) { // %keyword%\n-            return right.contains(left.substring(1, left.length() - 1));\n+        if (right.startsWith(\"\\\"\") && right.endsWith(\"\\\"\")) {\n+            right = right.substring(1, right.length() - 1);\n         }\n-        return (left.startsWith(\"%\") && right.endsWith(left.substring(1)))  // %suffix\n-            || (left.endsWith(\"%\") && right.startsWith(left.substring(0, left.length() - 1))) // prefix%\n+\n+        if (right.startsWith(\"%\") && right.endsWith(\"%\")) { // %keyword%\n+            return left.contains(right.substring(1, right.length() - 1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1037cfa76598098ea1e632d679829574f2971c5f"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6b0b5a76c6ea3add4bea39e0d3aa799dfc287e0", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/d6b0b5a76c6ea3add4bea39e0d3aa799dfc287e0", "committedDate": "2020-08-26T14:37:09Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "196c84d0519a84e054f5f90319f6c6aee955513b", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/196c84d0519a84e054f5f90319f6c6aee955513b", "committedDate": "2020-08-26T14:43:12Z", "message": "Merge remote-tracking branch 'origin/oal/expression' into oal/expression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjE4NDAy", "url": "https://github.com/apache/skywalking/pull/5390#pullrequestreview-475618402", "createdAt": "2020-08-26T15:41:46Z", "commit": {"oid": "196c84d0519a84e054f5f90319f6c6aee955513b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjI2NzAw", "url": "https://github.com/apache/skywalking/pull/5390#pullrequestreview-475626700", "createdAt": "2020-08-26T15:50:46Z", "commit": {"oid": "196c84d0519a84e054f5f90319f6c6aee955513b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1944, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}