{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NjY2Nzc1", "number": 4769, "title": "Alarm support multiple scope", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\nResolves #4590\n\n\n\nNew feature or improvement\n\nSupport multiple scopes to alarm.\n\nservice relation\nservice instance relation\nendpoint relation\n\n\nSupport database to alarm, make it as service scope.", "createdAt": "2020-05-10T04:23:19Z", "url": "https://github.com/apache/skywalking/pull/4769", "merged": true, "mergeCommit": {"oid": "749af3e04efcf577ef8745fd09c15bbde3704d5c"}, "closed": true, "closedAt": "2020-05-10T16:28:11Z", "author": {"login": "mrproliu"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfyP9OgH2gAyNDE1NjY2Nzc1OjIyMDY3Yzc3ODFhZWRmYzNhZTg0OGM3NDI3YzI1Y2I2ZmI2NzVmNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcf7sQCAFqTQwODc0ODgxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22067c7781aedfc3ae848c7427c25cb6fb675f52", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/22067c7781aedfc3ae848c7427c25cb6fb675f52", "committedDate": "2020-05-10T03:10:25Z", "message": "Support service relation and database access alarm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff89208c41536af3a1583445c5eed7d245d39628", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/ff89208c41536af3a1583445c5eed7d245d39628", "committedDate": "2020-05-10T03:46:17Z", "message": "support service instance relation alarm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfbbcbed7c81eabebf3c447b02feb74e2660f028", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/bfbbcbed7c81eabebf3c447b02feb74e2660f028", "committedDate": "2020-05-10T04:14:41Z", "message": "support endpoint relation alarm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9bacde2536ea4990edc197120831637c994d95f", "author": {"user": {"login": "mrproliu", "name": null}}, "url": "https://github.com/apache/skywalking/commit/e9bacde2536ea4990edc197120831637c994d95f", "committedDate": "2020-05-10T04:23:54Z", "message": "Merge branch 'master' into alarm-support-database"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzE3NzM2", "url": "https://github.com/apache/skywalking/pull/4769#pullrequestreview-408717736", "createdAt": "2020-05-10T07:59:40Z", "commit": {"oid": "e9bacde2536ea4990edc197120831637c994d95f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "committedDate": "2020-05-10T09:26:09Z", "message": "document and format the name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzI2MzMx", "url": "https://github.com/apache/skywalking/pull/4769#pullrequestreview-408726331", "createdAt": "2020-05-10T09:32:53Z", "commit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwOTozMjo1M1rOGTCh2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwOTozNDo1NlrOGTCi5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzU2Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - **id1**. When using relation scope, it will be the dest entity ID. Otherwise it will be empty.\n          \n          \n            \n            - **id1**. When using relation scope, it will be the dest entity ID. Otherwise, it is empty.", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617563", "createdAt": "2020-05-10T09:32:53Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -77,16 +85,16 @@ We provided a default `alarm-setting.yml` in our distribution only for convenien\n \n ### List of all potential metrics name\n The metrics names are defined in official [OAL scripts](../../guides/backend-oal-scripts.md), right now \n-metrics from **Service**, **Service Instance**, **Endpoint** scopes could be used in Alarm, we will extend in further versions. \n+metrics from **Service**, **Service Instance**, **Endpoint**, **Service Relation**, **Service Instance Relation**, **Endpoint Relation** scopes could be used in Alarm, and the **Database access** same with **Service** scope.\n \n Submit issue or pull request if you want to support any other scope in alarm.\n \n ## Webhook\n-Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage` with following key information.\n+Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage>` with following key information.\n - **scopeId**, **scope**. All scopes are defined in org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.\n-- **name**. Target scope entity name.\n-- **id0**. The ID of scope entity, matched the name.\n-- **id1**. Not used today.\n+- **name**. Target scope entity name. Please follow [Entity name define](#entity-name).\n+- **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.\n+- **id1**. When using relation scope, it will be the dest entity ID. Otherwise it will be empty.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzYyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.\n          \n          \n            \n            - **id0**. The ID of the scope entity matched the name. When using relation scope, it is the source entity ID.", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617625", "createdAt": "2020-05-10T09:33:18Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -77,16 +85,16 @@ We provided a default `alarm-setting.yml` in our distribution only for convenien\n \n ### List of all potential metrics name\n The metrics names are defined in official [OAL scripts](../../guides/backend-oal-scripts.md), right now \n-metrics from **Service**, **Service Instance**, **Endpoint** scopes could be used in Alarm, we will extend in further versions. \n+metrics from **Service**, **Service Instance**, **Endpoint**, **Service Relation**, **Service Instance Relation**, **Endpoint Relation** scopes could be used in Alarm, and the **Database access** same with **Service** scope.\n \n Submit issue or pull request if you want to support any other scope in alarm.\n \n ## Webhook\n-Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage` with following key information.\n+Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage>` with following key information.\n - **scopeId**, **scope**. All scopes are defined in org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.\n-- **name**. Target scope entity name.\n-- **id0**. The ID of scope entity, matched the name.\n-- **id1**. Not used today.\n+- **name**. Target scope entity name. Please follow [Entity name define](#entity-name).\n+- **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzgzMQ==", "bodyText": "All these AccessLevel are default, we could remove them.", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617831", "createdAt": "2020-05-10T09:34:56Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/alarm/ServiceRelationMetaInAlarm.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm;\n+\n+import lombok.AccessLevel;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.analysis.IDManager;\n+import org.apache.skywalking.oap.server.core.source.DefaultScopeDefine;\n+\n+@Getter(AccessLevel.PUBLIC)\n+@Setter(AccessLevel.PUBLIC)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "111f6b4c536385e32c06419ab132802135b6f381", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/111f6b4c536385e32c06419ab132802135b6f381", "committedDate": "2020-05-10T10:13:05Z", "message": "resolve issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5538f147c17ae5e5af19328fe9f63aaa7bcb4f54", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/5538f147c17ae5e5af19328fe9f63aaa7bcb4f54", "committedDate": "2020-05-10T13:11:32Z", "message": "add database access and endpoint relation rule example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2c2131b6151f748e0ecf4eb6e6a94de1bdb8ab", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/2b2c2131b6151f748e0ecf4eb6e6a94de1bdb8ab", "committedDate": "2020-05-10T13:15:03Z", "message": "resolve code format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "251c9c278c24a365eb6a03575951d2bc7ec468dc", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/251c9c278c24a365eb6a03575951d2bc7ec468dc", "committedDate": "2020-05-10T13:53:37Z", "message": "remove unnecessary getter and setter package declare"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1afb09d34c007e7369f2a5d0d73ac54d8731a14", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/e1afb09d34c007e7369f2a5d0d73ac54d8731a14", "committedDate": "2020-05-10T13:55:33Z", "message": "remove unnecessary fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzQ4ODEw", "url": "https://github.com/apache/skywalking/pull/4769#pullrequestreview-408748810", "createdAt": "2020-05-10T14:10:28Z", "commit": {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2153, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}