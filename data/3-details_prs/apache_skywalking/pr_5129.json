{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNjE5MTk4", "number": 5129, "title": "Add jvm_thread metrics", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n#5098\n\n\n\nNew feature or improvement\n\nDescribe the details and related test reports.\nAdd jvm_thread metrics", "createdAt": "2020-07-19T15:25:14Z", "url": "https://github.com/apache/skywalking/pull/5129", "merged": true, "mergeCommit": {"oid": "1877d0fcf41a320dc236c173c18b44f260e3c6f5"}, "closed": true, "closedAt": "2020-07-22T01:05:33Z", "author": {"login": "stalary"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2eilNgH2gAyNDUyNjE5MTk4OmM2ZTY4NmE2ZGY4ZjcyMWEyOTI0ODE1YmYyYjEzZWI3NWU2OWEyNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3IJIiAFqTQ1MjU4Nzk1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/c6e686a6df8f721a2924815bf2b13eb75e69a252", "committedDate": "2020-07-19T15:12:55Z", "message": "ADD: add jvm_thread metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTQxODk4", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-451141898", "createdAt": "2020-07-19T15:34:47Z", "commit": {"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTozNDo0N1rOGzwWVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTozNjoxNFrOGzwW_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjcxMQ==", "bodyText": "Why do you sum the count? This value could be collected multiple times, then the thread number(sum value) would be very large.", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456922711", "createdAt": "2020-07-19T15:34:47Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-bootstrap/src/main/resources/oal/java-agent.oal", "diffHunk": "@@ -25,4 +25,7 @@ instance_jvm_memory_noheap_max = from(ServiceInstanceJVMMemory.max).filter(heapS\n instance_jvm_young_gc_time = from(ServiceInstanceJVMGC.time).filter(phrase == GCPhrase.NEW).sum();\n instance_jvm_old_gc_time = from(ServiceInstanceJVMGC.time).filter(phrase == GCPhrase.OLD).sum();\n instance_jvm_young_gc_count = from(ServiceInstanceJVMGC.count).filter(phrase == GCPhrase.NEW).sum();\n-instance_jvm_old_gc_count = from(ServiceInstanceJVMGC.count).filter(phrase == GCPhrase.OLD).sum();\n\\ No newline at end of file\n+instance_jvm_old_gc_count = from(ServiceInstanceJVMGC.count).filter(phrase == GCPhrase.OLD).sum();\n+instance_jvm_thread_live_count = from(ServiceInstanceThreadGC.liveCount).sum();\n+instance_jvm_thread_daemon_count = from(ServiceInstanceThreadGC.daemonCount).sum();\n+instance_jvm_thread_peak_count = from(ServiceInstanceThreadGC.peakCount).sum();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjc3OA==", "bodyText": "getThreadMetric -> getThreadMetrics.", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456922778", "createdAt": "2020-07-19T15:35:13Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.agent.core.jvm.thread;\n+\n+import java.lang.management.ManagementFactory;\n+import java.lang.management.ThreadMXBean;\n+import org.apache.skywalking.apm.network.language.agent.v3.Thread;\n+\n+public enum ThreadProvider {\n+    INSTANCE;\n+    private final ThreadMXBean threadMXBean;\n+\n+    ThreadProvider() {\n+        this.threadMXBean = ManagementFactory.getThreadMXBean();\n+    }\n+\n+    public Thread getThreadMetric() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjg3OA==", "bodyText": "As you added a new source, scope-definitions.md doc should be added.", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456922878", "createdAt": "2020-07-19T15:36:14Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_JVM_THREAD;\n+\n+@ScopeDeclaration(id = SERVICE_INSTANCE_JVM_THREAD, name = \"ServiceInstanceJVMThread\", catalog = SERVICE_INSTANCE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class ServiceInstanceJVMThread extends Source {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7a38968f7f9b6a38005e45fd9d6c0d7d1b34d2", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/fb7a38968f7f9b6a38005e45fd9d6c0d7d1b34d2", "committedDate": "2020-07-19T15:43:00Z", "message": "Merge branch 'master' into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56bbdc9e631e59c4d85d777ad75a317511d55b6d", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/56bbdc9e631e59c4d85d777ad75a317511d55b6d", "committedDate": "2020-07-19T15:45:59Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1dc3d417b9a9f78bced6393e7542f6d01673d19", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/c1dc3d417b9a9f78bced6393e7542f6d01673d19", "committedDate": "2020-07-19T15:47:13Z", "message": "MOD: modify java-agent.oal and add scope-definitions.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54708da629e7386f1a4e61fc5685f9067f5a6f5c", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/54708da629e7386f1a4e61fc5685f9067f5a6f5c", "committedDate": "2020-07-19T15:47:42Z", "message": "Merge remote-tracking branch 'origin/jvm_thread' into jvm_thread"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTQzNDk4", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-451143498", "createdAt": "2020-07-19T15:58:00Z", "commit": {"oid": "54708da629e7386f1a4e61fc5685f9067f5a6f5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTo1ODowMVrOGzwfbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTo1ODowMVrOGzwfbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyNTAzNw==", "bodyText": "No function? It is strange.", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456925037", "createdAt": "2020-07-19T15:58:01Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-bootstrap/src/main/resources/oal/java-agent.oal", "diffHunk": "@@ -26,6 +26,6 @@ instance_jvm_young_gc_time = from(ServiceInstanceJVMGC.time).filter(phrase == GC\n instance_jvm_old_gc_time = from(ServiceInstanceJVMGC.time).filter(phrase == GCPhrase.OLD).sum();\n instance_jvm_young_gc_count = from(ServiceInstanceJVMGC.count).filter(phrase == GCPhrase.NEW).sum();\n instance_jvm_old_gc_count = from(ServiceInstanceJVMGC.count).filter(phrase == GCPhrase.OLD).sum();\n-instance_jvm_thread_live_count = from(ServiceInstanceThreadGC.liveCount).sum();\n-instance_jvm_thread_daemon_count = from(ServiceInstanceThreadGC.daemonCount).sum();\n-instance_jvm_thread_peak_count = from(ServiceInstanceThreadGC.peakCount).sum();\n\\ No newline at end of file\n+instance_jvm_thread_live_count = from(ServiceInstanceThreadGC.liveCount);\n+instance_jvm_thread_daemon_count = from(ServiceInstanceThreadGC.daemonCount);\n+instance_jvm_thread_peak_count = from(ServiceInstanceThreadGC.peakCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54708da629e7386f1a4e61fc5685f9067f5a6f5c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62d3ac7b1568821ff812ff80fa27c2e387c5b821", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/62d3ac7b1568821ff812ff80fa27c2e387c5b821", "committedDate": "2020-07-19T16:07:30Z", "message": "MOD: modify type and oal function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7fde1b66fbcd4b31e8a57ad09db646bec9a0aa1", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/f7fde1b66fbcd4b31e8a57ad09db646bec9a0aa1", "committedDate": "2020-07-19T16:08:34Z", "message": "MOD: oal_test.oal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "647cb08b1cc897de9d424a14181b936feaa9ab4c", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/647cb08b1cc897de9d424a14181b936feaa9ab4c", "committedDate": "2020-07-20T04:29:59Z", "message": "MOD: OALLexer.g4, OALParser.g4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "186cb9c8f11204fb197008419016d914042be899", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/186cb9c8f11204fb197008419016d914042be899", "committedDate": "2020-07-20T09:38:02Z", "message": "Merge branch 'master' into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "485a93261b010ba0e61331932c6d3061e056476a", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/485a93261b010ba0e61331932c6d3061e056476a", "committedDate": "2020-07-20T14:04:20Z", "message": "ADD: Add e2e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "195e9b7f4e0dd6d0a43a4f054be45c8cd9cfdfc3", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/195e9b7f4e0dd6d0a43a4f054be45c8cd9cfdfc3", "committedDate": "2020-07-20T14:04:35Z", "message": "Merge remote-tracking branch 'origin/jvm_thread' into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d642c3976e89314f9c293cae5e68bc4c8865f15f", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/d642c3976e89314f9c293cae5e68bc4c8865f15f", "committedDate": "2020-07-21T08:34:35Z", "message": "Merge branch 'master' into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/1a7ce270924da05f6e7851f185b12659e4ed3c67", "committedDate": "2020-07-21T13:17:18Z", "message": "Merge branch 'master' into jvm_thread"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDQ2NDk2", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452446496", "createdAt": "2020-07-21T13:20:28Z", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDQ5NTYx", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452449561", "createdAt": "2020-07-21T13:22:39Z", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTU1OTg2", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452555986", "createdAt": "2020-07-21T15:08:34Z", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTY5NDgw", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452569480", "createdAt": "2020-07-21T15:22:11Z", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTc3ODA0", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452577804", "createdAt": "2020-07-21T15:30:51Z", "commit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTozMDo1MVrOG09oQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTozMDo1MVrOG09oQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE4ODg2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                              \"chartType\": \"ChartBar\",\n          \n          \n            \n                              \"chartType\": \"ChartLine\",", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r458188865", "createdAt": "2020-07-21T15:30:51Z", "author": {"login": "arugal"}, "path": "oap-server/server-bootstrap/src/main/resources/ui-initialized-templates.yml", "diffHunk": "@@ -359,6 +359,17 @@ templates:\n                   \"chartType\": \"ChartBar\",\n                   \"metricName\": \"instance_jvm_young_gc_count, instance_jvm_old_gc_count\"\n                 },\n+                {\n+                  \"width\": 3,\n+                  \"title\": \"JVM Thread Count (Java Service)\",\n+                  \"height\": \"250\",\n+                  \"entityType\": \"ServiceInstance\",\n+                  \"independentSelector\": false,\n+                  \"metricType\": \"REGULAR_VALUE\",\n+                  \"queryMetricType\": \"readMetricsValues\",\n+                  \"chartType\": \"ChartBar\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "004d35ff1821c010cb9d2eda3686c12d8363683c", "author": {"user": {"login": "arugal", "name": "zhang-wei"}}, "url": "https://github.com/apache/skywalking/commit/004d35ff1821c010cb9d2eda3686c12d8363683c", "committedDate": "2020-07-21T15:33:11Z", "message": "Merge branch 'master' into jvm_thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1889aab815896aa26f13c1719858591ebd69f932", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/1889aab815896aa26f13c1719858591ebd69f932", "committedDate": "2020-07-21T15:33:46Z", "message": "MOD: modify chartType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da640a79f5b7a5ac8afac5623411f74a7bfbbb21", "author": {"user": {"login": "stalary", "name": "Stalary"}}, "url": "https://github.com/apache/skywalking/commit/da640a79f5b7a5ac8afac5623411f74a7bfbbb21", "committedDate": "2020-07-21T15:35:57Z", "message": "Merge branch 'jvm_thread' of https://github.com/stalary/skywalking into jvm_thread"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTg3Mzgz", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452587383", "createdAt": "2020-07-21T15:40:35Z", "commit": {"oid": "da640a79f5b7a5ac8afac5623411f74a7bfbbb21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTg3OTUz", "url": "https://github.com/apache/skywalking/pull/5129#pullrequestreview-452587953", "createdAt": "2020-07-21T15:41:08Z", "commit": {"oid": "da640a79f5b7a5ac8afac5623411f74a7bfbbb21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2097, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}