{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0OTQ1NDI2", "number": 5147, "title": "support jetty server advanced configuration.", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\nfix #4449\n\n\n\nBug fix\n\n\nBug description.\n\n\nHow to fix?\n\n\n\nNew feature or improvement\n\nDescribe the details and related test reports.", "createdAt": "2020-07-22T07:51:44Z", "url": "https://github.com/apache/skywalking/pull/5147", "merged": true, "mergeCommit": {"oid": "db9f8e6e008115d10ed8132b671e41229513beb7"}, "closed": true, "closedAt": "2020-07-25T09:41:50Z", "author": {"login": "JaredTan95"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3WAT1AH2gAyNDU0OTQ1NDI2OmZhMzY5YzM4MjVlYjk2M2MwNzA1YmE2ZjZkMzk1MmEyYjNkNTZlN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4VZURAFqTQ1NTI3NDY1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa369c3825eb963c0705ba6f6d3952a2b3d56e7d", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/fa369c3825eb963c0705ba6f6d3952a2b3d56e7d", "committedDate": "2020-07-22T07:50:10Z", "message": "support jetty custom advanced configuration."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDYyNDEw", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-453462410", "createdAt": "2020-07-22T16:02:03Z", "commit": {"oid": "fa369c3825eb963c0705ba6f6d3952a2b3d56e7d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d9bac3ad23ee91b735e15cb5df347a842cf80f", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/d4d9bac3ad23ee91b735e15cb5df347a842cf80f", "committedDate": "2020-07-23T01:47:44Z", "message": "fix ci."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38edd901a7b390a79b73b89f0331e448d7169093", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/38edd901a7b390a79b73b89f0331e448d7169093", "committedDate": "2020-07-23T03:26:56Z", "message": "Merge branch 'master' into jetty_config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODIzNjQ2", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-453823646", "createdAt": "2020-07-23T04:02:59Z", "commit": {"oid": "38edd901a7b390a79b73b89f0331e448d7169093"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNDowMjo1OVrOG17jIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNDowMjo1OVrOG17jIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwMzM2MA==", "bodyText": "Don't open this, because once you did, all query and trace in http need to be reported through this port, which breaks quick start and tests.\nYour change should be in the doc mostly.", "url": "https://github.com/apache/skywalking/pull/5147#discussion_r459203360", "createdAt": "2020-07-23T04:02:59Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-bootstrap/src/main/resources/application.yml", "diffHunk": "@@ -156,7 +156,15 @@ storage:\n receiver-sharing-server:\n   selector: ${SW_RECEIVER_SHARING_SERVER:default}\n   default:\n+    host: ${SW_RECEIVER_JETTY_HOST:0.0.0.0}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38edd901a7b390a79b73b89f0331e448d7169093"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1748b9f389f1b98fd8e9b34fb8fb7427b6e16b0", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/a1748b9f389f1b98fd8e9b34fb8fb7427b6e16b0", "committedDate": "2020-07-23T05:18:32Z", "message": "update docs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a13a6956d3f6eb235284b2290013cd5720ec07d8", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/a13a6956d3f6eb235284b2290013cd5720ec07d8", "committedDate": "2020-07-23T12:32:05Z", "message": "Merge branch 'master' into jetty_config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "177ef9bcdea02c9e1c6672f1b03a92794271c908", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/177ef9bcdea02c9e1c6672f1b03a92794271c908", "committedDate": "2020-07-24T12:10:15Z", "message": "Merge branch 'master' into jetty_config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDAyMTUz", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-455002153", "createdAt": "2020-07-24T15:56:24Z", "commit": {"oid": "177ef9bcdea02c9e1c6672f1b03a92794271c908"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNTo1NjoyNFrOG202EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNTo1NjoyNFrOG202EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0MjA5Ng==", "bodyText": "Can you explain more about this, the original logic is initializing JettyServer when config.getRestPort() != 0, but after your changes, JettyServer is always initialized, is it expected?", "url": "https://github.com/apache/skywalking/pull/5147#discussion_r460142096", "createdAt": "2020-07-24T15:56:24Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-receiver-plugin/skywalking-sharing-server-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/sharing/server/SharingServerModuleProvider.java", "diffHunk": "@@ -67,26 +68,38 @@ public ModuleConfig createConfigBeanIfAbsent() {\n \n     @Override\n     public void prepare() {\n-        if (config.getRestPort() != 0) {\n-            jettyServer = new JettyServer(Strings.isBlank(config.getRestHost()) ? \"0.0.0.0\" : config.getRestHost(), config\n-                .getRestPort(), config.getRestContextPath());\n-            jettyServer.initialize();\n-\n-            this.registerServiceImplementation(JettyHandlerRegister.class, new JettyHandlerRegisterImpl(jettyServer));\n-        } else {\n-            this.receiverJettyHandlerRegister = new ReceiverJettyHandlerRegister();\n-            this.registerServiceImplementation(JettyHandlerRegister.class, receiverJettyHandlerRegister);\n+        JettyServerConfig jettyServerConfig = JettyServerConfig.builder()\n+                                                               .host(config.getHost()).port(config.getPort())\n+                                                               .contextPath(config.getContextPath())\n+                                                               .jettyMinThreads(config.getJettyMinThreads())\n+                                                               .jettyMaxThreads(config.getJettyMaxThreads())\n+                                                               .jettyAcceptQueueSize(config.getJettyAcceptQueueSize())\n+                                                               .jettyAcceptorPriorityDelta(config.getJettyAcceptorPriorityDelta())\n+                                                               .jettyIdleTimeOut(config.getJettyIdleTimeOut()).build();\n+\n+        if (config.getPort() != 0) {\n+            jettyServerConfig.setHost(Strings.isBlank(config.getHost()) ? \"0.0.0.0\" : config.getHost());\n+            jettyServerConfig.setPort(config.getPort());\n+            jettyServerConfig.setContextPath(config.getContextPath());\n         }\n+        jettyServer = new JettyServer(jettyServerConfig);\n+        jettyServer.initialize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "177ef9bcdea02c9e1c6672f1b03a92794271c908"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjMyNTk4", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-455232598", "createdAt": "2020-07-24T23:28:34Z", "commit": {"oid": "177ef9bcdea02c9e1c6672f1b03a92794271c908"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7b2a105d21d0139160c5507e781a6a42a3f4af", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/6b7b2a105d21d0139160c5507e781a6a42a3f4af", "committedDate": "2020-07-25T01:20:00Z", "message": "fix jetty server init logical."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a27ec215c58e1e6de9d8e29d1af96fdc59dc396", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/7a27ec215c58e1e6de9d8e29d1af96fdc59dc396", "committedDate": "2020-07-25T01:21:18Z", "message": "Merge branch 'master' into jetty_config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1d860ed9a2b1d417f341940c864990d3de2d7d1", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/b1d860ed9a2b1d417f341940c864990d3de2d7d1", "committedDate": "2020-07-25T05:00:56Z", "message": "Merge branch 'master' into jetty_config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mjc0MzE0", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-455274314", "createdAt": "2020-07-25T09:33:35Z", "commit": {"oid": "b1d860ed9a2b1d417f341940c864990d3de2d7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mjc0NjU3", "url": "https://github.com/apache/skywalking/pull/5147#pullrequestreview-455274657", "createdAt": "2020-07-25T09:41:30Z", "commit": {"oid": "b1d860ed9a2b1d417f341940c864990d3de2d7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2111, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}