{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NzY3MzIx", "number": 5209, "title": "The Dubbo plugin can collect more information by custom", "bodyText": "Please answer these questions before submitting pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n#5208", "createdAt": "2020-07-31T04:18:28Z", "url": "https://github.com/apache/skywalking/pull/5209", "merged": true, "mergeCommit": {"oid": "4149ac59fed2d3e5e637bb72f419440009761c87"}, "closed": true, "closedAt": "2020-08-04T15:26:57Z", "author": {"login": "zhaoyuguang"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6MS92AH2gAyNDU5NzY3MzIxOjZiNDBmNjgwY2RiNjhkMGQ3MTdhYmI3NWNjMmMyZGRhMmQ1MzU1NWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7nlV9AFqTQ2MDg3NDI2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b40f680cdb68d0d717abb75cc2c2dda2d53555a", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/6b40f680cdb68d0d717abb75cc2c2dda2d53555a", "committedDate": "2020-07-31T04:13:16Z", "message": "The Dubbo plugin can collect more information by custom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d302bbc94164d427b494d2a71660791fdaf5f703", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/d302bbc94164d427b494d2a71660791fdaf5f703", "committedDate": "2020-07-31T04:22:42Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1e671c64b4e306335eb9867f14e7c76ab1b7fcc", "author": {"user": {"login": "ascrutae", "name": "Xin,Zhang"}}, "url": "https://github.com/apache/skywalking/commit/a1e671c64b4e306335eb9867f14e7c76ab1b7fcc", "committedDate": "2020-07-31T04:38:51Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed7639435cebc955d0554b2a5ec32af6f50d0965", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/ed7639435cebc955d0554b2a5ec32af6f50d0965", "committedDate": "2020-07-31T06:01:49Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1353890988cc5ff5d17cf1b3e50f6ed2f1f63d47", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/1353890988cc5ff5d17cf1b3e50f6ed2f1f63d47", "committedDate": "2020-07-31T06:02:05Z", "message": "Merge branch 'zhaoyuguang_0002' of https://github.com/zhaoyuguang/incubator-skywalking into zhaoyuguang_0002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6dc590fce345d9aca341b9fd87a3bbd6cec5886", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/d6dc590fce345d9aca341b9fd87a3bbd6cec5886", "committedDate": "2020-07-31T06:05:05Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de7250083f220d916a2c6bf4a28e291476736851", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/de7250083f220d916a2c6bf4a28e291476736851", "committedDate": "2020-07-31T06:06:34Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c6b63ad48abba2b0efb31b89e4b95ac0628c71e", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/0c6b63ad48abba2b0efb31b89e4b95ac0628c71e", "committedDate": "2020-07-31T06:09:43Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30951f4dfa58a3498794b8f69e3da55c2a55e4e8", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/30951f4dfa58a3498794b8f69e3da55c2a55e4e8", "committedDate": "2020-07-31T06:12:26Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6cb18ec558047feac11cce0f5c97b27c3ff0cf3", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/e6cb18ec558047feac11cce0f5c97b27c3ff0cf3", "committedDate": "2020-07-31T06:12:55Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863775cd827c21ab39771360b182e10c3ea09cca", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/863775cd827c21ab39771360b182e10c3ea09cca", "committedDate": "2020-07-31T06:16:30Z", "message": "1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffae4b2605b42974ace3ca250b80f535727a77d5", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/ffae4b2605b42974ace3ca250b80f535727a77d5", "committedDate": "2020-07-31T06:16:48Z", "message": "1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTM5NTk1", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-458939595", "createdAt": "2020-07-31T06:17:20Z", "commit": {"oid": "e6cb18ec558047feac11cce0f5c97b27c3ff0cf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNjoxNzoyMFrOG59N8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNjoxNzoyMFrOG59N8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA==", "bodyText": "Isn't remote == peer? I am a little confused.", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463425010", "createdAt": "2020-07-31T06:17:20Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,13 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||\n+`plugin.dubbo.collect_consumer_address`| Apache Dubbo consumer collect `remote_address` and `local_address` in RPC call. |`false`| ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6cb18ec558047feac11cce0f5c97b27c3ff0cf3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35860747ed23e5c9ecd1b235b1a9ecc4a17e83ca", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/35860747ed23e5c9ecd1b235b1a9ecc4a17e83ca", "committedDate": "2020-07-31T06:33:44Z", "message": "remove  CONSUMER_ADDRESS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1c5bcbac11d4e0f1d866c43e0d1f9a2fa4add06", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e1c5bcbac11d4e0f1d866c43e0d1f9a2fa4add06", "committedDate": "2020-07-31T08:50:28Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ddee1921c606682ff24e85d53011ee5af52a25f", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/5ddee1921c606682ff24e85d53011ee5af52a25f", "committedDate": "2020-07-31T14:24:56Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjE2MzU3", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-459216357", "createdAt": "2020-07-31T14:26:04Z", "commit": {"oid": "e1c5bcbac11d4e0f1d866c43e0d1f9a2fa4add06"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNDoyNzowN1rOG6KjtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNDozMToyMFrOG6KssA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0MzU3Mw==", "bodyText": "Notice, the provider side is EntrySpan, which has #setPeer too. Please recheck.", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463643573", "createdAt": "2020-07-31T14:27:07Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,12 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||\n+`plugin.dubbo.collect_consumer_arguments`| Apache Dubbo consumer collect `arguments` in RPC call. |`false`| \n+`plugin.dubbo.consumer_arguments_length_threshold`| When `plugin.dubbo.collect_consumer_arguments` is `true`, Arguments of length from the front will to the OAP backend |`256`| \n+`plugin.dubbo.collect_provider_address`| Apache Dubbo provider collect `remote_address` and `local_address` in RPC call. |`false`| ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ddee1921c606682ff24e85d53011ee5af52a25f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0MzkxMA==", "bodyText": "Do you forget to remove this? skywalking.plugin.dubbo.collect_consumer_address=true.", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463643910", "createdAt": "2020-07-31T14:27:44Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/dubbo-2.7.x-scenario/bin/startup.sh", "diffHunk": "@@ -18,4 +18,5 @@\n \n home=\"$(cd \"$(dirname $0)\"; pwd)\"\n \n-java -jar ${agent_opts} ${home}/../libs/dubbo-2.7.x-scenario.jar &\n\\ No newline at end of file\n+java -Dskywalking.plugin.dubbo.collect_consumer_address=true -Dskywalking.plugin.dubbo.collect_consumer_arguments=true \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ddee1921c606682ff24e85d53011ee5af52a25f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0NTg3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `plugin.kafka.consumer_config`| Kafka producer configuration. ||\n          \n          \n            \n            `plugin.kafka. producer_config`| Kafka producer configuration. ||\n          \n      \n    \n    \n  \n\n@dmsolr Is this a typo in the previous doc? And I think you miss the other configurations of topic names in here and backend documentations.\nAlso, backend documents have some typo issues too.", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463645872", "createdAt": "2020-07-31T14:31:20Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,12 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ddee1921c606682ff24e85d53011ee5af52a25f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "804277c25918815a03c7495c102c5d63d6c3aa96", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/804277c25918815a03c7495c102c5d63d6c3aa96", "committedDate": "2020-08-04T03:28:53Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31", "committedDate": "2020-08-04T04:00:39Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNTQ3MDI3", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-460547027", "createdAt": "2020-08-04T07:04:32Z", "commit": {"oid": "1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNzowNDozMlrOG7TuNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNzowNDozMlrOG7TuNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg0MjI5Mw==", "bodyText": "I prefer you to add this directly, rather than config. This is a light op, should not affect the performance like the arguments.", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464842293", "createdAt": "2020-08-04T07:04:32Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/dubbo-2.7.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asf/dubbo/DubboInterceptor.java", "diffHunk": "@@ -83,16 +94,22 @@ public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allAr\n             }\n \n             span = ContextManager.createEntrySpan(generateOperationName(requestURL, invocation), contextCarrier);\n+            if (DubboPluginConfig.Plugin.Dubbo.COLLECT_PROVIDER_REMOTE_ADDRESS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a626d23d142958cd65a5b72a5c70a4b88560aa0", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/0a626d23d142958cd65a5b72a5c70a4b88560aa0", "committedDate": "2020-08-04T08:43:18Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNjMzMjU5", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-460633259", "createdAt": "2020-08-04T09:07:50Z", "commit": {"oid": "0a626d23d142958cd65a5b72a5c70a4b88560aa0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwOTowNzo1MFrOG7X2kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwOTowNzo1MFrOG7X2kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkwOTk3MQ==", "bodyText": "So, this depends on parameter#toString, right? Is this a recommended way? Or should we consider JSON? I am not using Dubbo for a long time. Is Dubbo having toString already?", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464909971", "createdAt": "2020-08-04T09:07:50Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/dubbo-2.7.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asf/dubbo/DubboInterceptor.java", "diffHunk": "@@ -152,4 +165,26 @@ private String generateRequestURL(URL url, Invocation invocation) {\n         requestURL.append(generateOperationName(url, invocation));\n         return requestURL.toString();\n     }\n+\n+    private void collectArguments(boolean needCollectArguments, int argumentsLengthThreshold, AbstractSpan span, Invocation invocation) {\n+        if (needCollectArguments && argumentsLengthThreshold > 0) {\n+            Object[] parameters = invocation.getArguments();\n+            if (parameters != null && parameters.length > 0) {\n+                StringBuilder stringBuilder = new StringBuilder();\n+                boolean first = true;\n+                for (Object parameter : parameters) {\n+                    if (!first) {\n+                        stringBuilder.append(\",\");\n+                    }\n+                    stringBuilder.append(parameter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a626d23d142958cd65a5b72a5c70a4b88560aa0"}, "originalPosition": 106}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e3da75f75297cb8148e50e585129eece1fbefe", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/27e3da75f75297cb8148e50e585129eece1fbefe", "committedDate": "2020-08-04T09:57:06Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "351af86d6c0e47bfd532ee4c8dd3d72bcc4c594e", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/351af86d6c0e47bfd532ee4c8dd3d72bcc4c594e", "committedDate": "2020-08-04T10:01:50Z", "message": "Update README.md\n\nRe-word."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea87ab0258fcc0570dcd394f534f51410f5253fc", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/ea87ab0258fcc0570dcd394f534f51410f5253fc", "committedDate": "2020-08-04T11:05:07Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzE4MzQ2", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-460718346", "createdAt": "2020-08-04T11:15:45Z", "commit": {"oid": "ea87ab0258fcc0570dcd394f534f51410f5253fc"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "511d6b5c7885f472ec8b755d92c8074620674ac2", "author": {"user": {"login": "zhaoyuguang", "name": "\u4e8e\u7389\u6854"}}, "url": "https://github.com/apache/skywalking/commit/511d6b5c7885f472ec8b755d92c8074620674ac2", "committedDate": "2020-08-04T13:25:29Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea83ea010f4699d1c577f4d9ece82604ff185df8", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/ea83ea010f4699d1c577f4d9ece82604ff185df8", "committedDate": "2020-08-04T14:12:14Z", "message": "Merge branch 'master' into zhaoyuguang_0002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODc0MjY3", "url": "https://github.com/apache/skywalking/pull/5209#pullrequestreview-460874267", "createdAt": "2020-08-04T14:34:42Z", "commit": {"oid": "ea83ea010f4699d1c577f4d9ece82604ff185df8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2138, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}