{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMzk4ODM0", "number": 5839, "title": "Fix request url traceId sometimes shows \"Ignored_Trace\"", "bodyText": "Fix \n\n Add a unit test to verify that the fix works.\n Explain briefly about why the bug exists and how to fix it.\n\n\n\n\n\n If this pull request closes/resolves/fixes an existing issue, replace the issue number. Closes #.\n Update the CHANGES log.", "createdAt": "2020-11-13T07:12:53Z", "url": "https://github.com/apache/skywalking/pull/5839", "merged": true, "mergeCommit": {"oid": "832582427a50c7db29f2a7ef9d81834098361e8d"}, "closed": true, "closedAt": "2020-11-16T02:23:06Z", "author": {"login": "huliangdream"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcBishgH2gAyNTIwMzk4ODM0OjI0ODJhOTY2YWJjNzRlYjQzNTIyNDM5M2ExMDI5ZThmZjI4ZGI0NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdc7cbhAFqTUzMDg3NzkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2482a966abc74eb435224393a1029e8ff28db457", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/2482a966abc74eb435224393a1029e8ff28db457", "committedDate": "2020-11-13T06:54:55Z", "message": "Fix request url traceId sometimes shows \"Ignored_Trace\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e605db681bd45efb2fadc2544b6338c97082683d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e605db681bd45efb2fadc2544b6338c97082683d", "committedDate": "2020-11-13T08:47:13Z", "message": "Merge branch 'master' into huliang-patch-1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODc3NzEx", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-529877711", "createdAt": "2020-11-13T08:48:34Z", "commit": {"oid": "e605db681bd45efb2fadc2544b6338c97082683d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODo0ODozNVrOHylmgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODo0ODozNVrOHylmgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgwNjkxMg==", "bodyText": "The split should happen in the boot stage, and only do match in the runtime.", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r522806912", "createdAt": "2020-11-13T08:48:35Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -61,7 +63,7 @@ public AbstractTracerContext createTraceContext(String operationName, boolean fo\n         }\n \n         int suffixIdx = operationName.lastIndexOf(\".\");\n-        if (suffixIdx > -1 && Config.Agent.IGNORE_SUFFIX.contains(operationName.substring(suffixIdx))) {\n+        if (suffixIdx > -1 && Arrays.stream(Config.Agent.IGNORE_SUFFIX.split(\",\")).anyMatch(a -> a.equals(operationName.substring(suffixIdx)))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e605db681bd45efb2fadc2544b6338c97082683d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a84cecba9532606936d86d874161e88e972c243", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/4a84cecba9532606936d86d874161e88e972c243", "committedDate": "2020-11-14T06:28:23Z", "message": "Update ContextManagerExtendService.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTgwOTg1", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530580985", "createdAt": "2020-11-14T14:20:09Z", "commit": {"oid": "4a84cecba9532606936d86d874161e88e972c243"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNDoyMDowOVrOHzLTDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxNDoyMDowOVrOHzLTDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQyNDUyNQ==", "bodyText": "Put the initialization process in the boot method, rather than there. It is safer and keeps the initialization sequence more clear.", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523424525", "createdAt": "2020-11-14T14:20:09Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private static String[] IGNORE_SUFFIX_ARRAY = Config.Agent.IGNORE_SUFFIX.split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a84cecba9532606936d86d874161e88e972c243"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fa03519dc0f7f046d38b57a0ce8baef15dc057", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/e6fa03519dc0f7f046d38b57a0ce8baef15dc057", "committedDate": "2020-11-16T00:42:37Z", "message": "Update ContextManagerExtendService.java\n\nPut the 'IGNORE_SUFFIX_ARRAY' initialization process in the boot method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abce9c5126d68b3b473ddef05bd62088c16f0f2d", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/abce9c5126d68b3b473ddef05bd62088c16f0f2d", "committedDate": "2020-11-16T00:58:34Z", "message": "Merge branch 'master' into huliang-patch-1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11612086c3240097740a9436186363bc401f1031", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/11612086c3240097740a9436186363bc401f1031", "committedDate": "2020-11-16T01:02:38Z", "message": "Update ContextManagerExtendServiceTest.java\n\nContextManagerExtendservice through ServiceManager.INSTANCE.findService initialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODYyMTkw", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530862190", "createdAt": "2020-11-16T01:05:40Z", "commit": {"oid": "11612086c3240097740a9436186363bc401f1031"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTowNTo0MVrOHzlIaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTowNTo0MVrOHzlIaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg0Nzc4NA==", "bodyText": "ContextManagerExtendService's instance is controlled by the agent core. This field should not be a static one, like status.", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523847784", "createdAt": "2020-11-16T01:05:41Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private static String[] IGNORE_SUFFIX_ARRAY = new String[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11612086c3240097740a9436186363bc401f1031"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/21c1d5ed3b04792ac367ab5b148aaf5b7429e684", "committedDate": "2020-11-16T01:10:45Z", "message": "Update ContextManagerExtendService.java\n\nIGNORE_SUFFIX_ARRAY field Change to non static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODYzNjQw", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530863640", "createdAt": "2020-11-16T01:13:18Z", "commit": {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMToxMzoxOFrOHzlNtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMToxMzoxOFrOHzlNtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg0OTE0MQ==", "bodyText": "Compiling local, this name format would not pass the CI, because of the format.", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523849141", "createdAt": "2020-11-16T01:13:18Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private String[] IGNORE_SUFFIX_ARRAY = new String[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODY0NzY5", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530864769", "createdAt": "2020-11-16T01:19:24Z", "commit": {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMToxOToyNFrOHzlRyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMToxOToyNFrOHzlRyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1MDE4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Fix request url traceId sometimes shows \"Ignored_Trace\".\n          \n          \n            \n            * Fix the default ignore mechanism isn't accurate enough bug.", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523850185", "createdAt": "2020-11-16T01:19:24Z", "author": {"login": "wu-sheng"}, "path": "CHANGES.md", "diffHunk": "@@ -19,6 +19,7 @@ Release Notes.\n * Fix NPE in the nutz plugin.\n * Provide Apache Commons DBCP 2.x plugin.\n * Add the plugin for mssql-jtds 1.x plugin.\n+* Fix request url traceId sometimes shows \"Ignored_Trace\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86247284264f1b7fb7f5ca60af047f787d27e141", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/86247284264f1b7fb7f5ca60af047f787d27e141", "committedDate": "2020-11-16T01:19:39Z", "message": "Update CHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "930074e4ba24018834991b62514e2874cb38f2ce", "author": {"user": {"login": "huliangdream", "name": "huliang"}}, "url": "https://github.com/apache/skywalking/commit/930074e4ba24018834991b62514e2874cb38f2ce", "committedDate": "2020-11-16T01:20:26Z", "message": "Update ContextManagerExtendService.java\n\nIGNORE_SUFFIX_ARRAY field rename to ignoreSuffixArray"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODcxMjUz", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530871253", "createdAt": "2020-11-16T01:52:42Z", "commit": {"oid": "930074e4ba24018834991b62514e2874cb38f2ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODc3OTEx", "url": "https://github.com/apache/skywalking/pull/5839#pullrequestreview-530877911", "createdAt": "2020-11-16T02:22:35Z", "commit": {"oid": "930074e4ba24018834991b62514e2874cb38f2ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1637, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}