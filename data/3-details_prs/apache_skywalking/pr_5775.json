{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzODk5NjM4", "number": 5775, "title": "Fix deadlock problem when using elasticsearch-client-7.0.0", "bodyText": "Fix deadlock problem when using es\n\n Add a unit test to verify that the fix works.\n Explain briefly about why the bug exists and how to fix it.\n\nHello, a few days ago, there was a problem that es data could not be written in our production environment. We dump the thread stack of the production environment. After analysis, it is found that es client has a deadlock problem when writing data.thread dump thread dump. In order to solve the problem, I checked many related materials, and found that this problem has been fixed in elasticsearch-client version 7.5.0. Prevent deadlock by using separate schedulers\nso i update the elasticsearch client 7.0.0 to elasticsearch client 7.5.0.\nIn order to avoid es compatibility issues, I use elasticsearch server 7.0.0 as data storage. Tested whether the ui function is normal, and checked whether the OAP is abnormal during operation. The test results show that everything is normal. and the current elasticsearch server in our production environment is 7.2.0, and we are also using elasticsearch client 7.5.0. It has been running stably for 3 days without any compatibility issues.", "createdAt": "2020-11-02T08:47:56Z", "url": "https://github.com/apache/skywalking/pull/5775", "merged": true, "mergeCommit": {"oid": "a9d756cd536eee72d1edda69fe495fbb7f253937"}, "closed": true, "closedAt": "2020-11-03T14:01:55Z", "author": {"login": "zifeihan"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYf1H7AH2gAyNTEzODk5NjM4Ojc0MjY3YjdjODhmODI1MGVjOTg4MmQ3OWFmYTZkNmQ3NmMzZTljMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY5iNFAFqTUyMjUxNDUxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74267b7c88f8250ec9882d79afa6d6d76c3e9c32", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/74267b7c88f8250ec9882d79afa6d6d76c3e9c32", "committedDate": "2020-11-02T07:56:30Z", "message": "Update elasticsearch client 7.0.0 to elasticsearch client 7.5.0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDMzNDA4", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-521433408", "createdAt": "2020-11-02T08:55:18Z", "commit": {"oid": "74267b7c88f8250ec9882d79afa6d6d76c3e9c32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1NToxOFrOHr7NIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1NToxOFrOHr7NIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMDgzNA==", "bodyText": "You need to update LICENSE including\n\nVersions of lang-mustache-client and parent-join-client\nAdd mapper-extras-client with license as we missed before\nAdd rank-eval-client with license as we missed before, both 6.3.2(es6 package) and 7.5.0(you updated)", "url": "https://github.com/apache/skywalking/pull/5775#discussion_r515820834", "createdAt": "2020-11-02T08:55:18Z", "author": {"login": "wu-sheng"}, "path": "tools/dependencies/known-oap-backend-dependencies-es7.txt", "diffHunk": "@@ -29,14 +29,18 @@ curator-client-4.0.1.jar\n curator-framework-4.0.1.jar\n curator-recipes-4.0.1.jar\n curator-x-discovery-4.0.1.jar\n-elasticsearch-7.0.0.jar\n-elasticsearch-cli-7.0.0.jar\n-elasticsearch-core-7.0.0.jar\n-elasticsearch-geo-7.0.0.jar\n-elasticsearch-rest-client-7.0.0.jar\n-elasticsearch-rest-high-level-client-7.0.0.jar\n-elasticsearch-secure-sm-7.0.0.jar\n-elasticsearch-x-content-7.0.0.jar\n+elasticsearch-7.5.0.jar\n+elasticsearch-cli-7.5.0.jar\n+elasticsearch-core-7.5.0.jar\n+elasticsearch-geo-7.5.0.jar\n+elasticsearch-rest-client-7.5.0.jar\n+elasticsearch-rest-high-level-client-7.5.0.jar\n+elasticsearch-secure-sm-7.5.0.jar\n+elasticsearch-x-content-7.5.0.jar\n+lang-mustache-client-7.5.0.jar\n+mapper-extras-client-7.5.0.jar\n+parent-join-client-7.5.0.jar\n+rank-eval-client-7.5.0.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74267b7c88f8250ec9882d79afa6d6d76c3e9c32"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63ad77892fe08a6f75c98fc026a4878193337d76", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/63ad77892fe08a6f75c98fc026a4878193337d76", "committedDate": "2020-11-02T08:56:47Z", "message": "Merge branch 'master' into es_client7_update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDQzNDcw", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-521443470", "createdAt": "2020-11-02T09:08:56Z", "commit": {"oid": "63ad77892fe08a6f75c98fc026a4878193337d76"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9f87b442d2ba21d0ceb7c1cf7722a17f148d249", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/e9f87b442d2ba21d0ceb7c1cf7722a17f148d249", "committedDate": "2020-11-02T09:26:15Z", "message": "Update CHANGES.md and LICENSE."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0c3c2f2840e49a65fcd29668dfc26a36c38d29", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/2b0c3c2f2840e49a65fcd29668dfc26a36c38d29", "committedDate": "2020-11-02T09:27:50Z", "message": "Merge remote-tracking branch 'origin/es_client7_update' into es_client7_update\n\n# Conflicts:\n#\tCHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54e98618f8a7c3b183981a3aebd660726f8369ca", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/54e98618f8a7c3b183981a3aebd660726f8369ca", "committedDate": "2020-11-03T02:29:43Z", "message": "Polishing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTc1Nzgw", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-522175780", "createdAt": "2020-11-03T03:51:42Z", "commit": {"oid": "54e98618f8a7c3b183981a3aebd660726f8369ca"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9faa4f93adf9128c45c8a9e51d1cf3640c14c56", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/a9faa4f93adf9128c45c8a9e51d1cf3640c14c56", "committedDate": "2020-11-03T08:42:37Z", "message": "Merge branch 'master' into es_client7_update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjkyMzI2", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-522292326", "createdAt": "2020-11-03T09:01:24Z", "commit": {"oid": "a9faa4f93adf9128c45c8a9e51d1cf3640c14c56"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTowMToyNVrOHslSmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTowMToyNVrOHslSmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUxMDM2Mw==", "bodyText": "Elasticsearch BV (Elasticsearch) 6.3.2, 7.5.0: https://www.elastic.co/products/elasticsearch , Apache 2.0\n\nFor multiple versions, should be like this.", "url": "https://github.com/apache/skywalking/pull/5775#discussion_r516510363", "createdAt": "2020-11-03T09:01:25Z", "author": {"login": "wu-sheng"}, "path": "dist-material/release-docs/LICENSE", "diffHunk": "@@ -233,9 +233,13 @@ The text of each license is the standard Apache 2.0 license.\n     Google: proto-google-common-protos 1.17.0: https://github.com/googleapis/googleapis , Apache 2.0\n     Google: jsr305 3.0.2: http://central.maven.org/maven2/com/google/code/findbugs/jsr305/3.0.0/jsr305-3.0.0.pom , Apache 2.0\n     Elasticsearch BV (Elasticsearch) 6.3.2: https://www.elastic.co/products/elasticsearch , Apache 2.0\n-    Elasticsearch BV (Elasticsearch) 7.0.0: https://www.elastic.co/products/elasticsearch , Apache 2.0\n-    lang-mustache-client 5.5.0: https://github.com/elastic/elasticsearch/tree/master/modules/lang-mustache , Apache 2.0\n-    parent-join-client 5.5.0: https://github.com/elastic/elasticsearch/tree/master/modules/parent-join , Apache 2.0\n+    Elasticsearch BV (Elasticsearch) 7.5.0: https://www.elastic.co/products/elasticsearch , Apache 2.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9faa4f93adf9128c45c8a9e51d1cf3640c14c56"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eda9efe6add496840e0ca55dfe18512ab632c16", "author": {"user": {"login": "zifeihan", "name": "zifeihan"}}, "url": "https://github.com/apache/skywalking/commit/8eda9efe6add496840e0ca55dfe18512ab632c16", "committedDate": "2020-11-03T11:23:56Z", "message": "Update LICENSE."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1024e7ed4713e94035dcc60b59e8786d392bea2d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/1024e7ed4713e94035dcc60b59e8786d392bea2d", "committedDate": "2020-11-03T11:58:58Z", "message": "Merge branch 'master' into es_client7_update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNDI3MTE4", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-522427118", "createdAt": "2020-11-03T11:59:42Z", "commit": {"oid": "1024e7ed4713e94035dcc60b59e8786d392bea2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTE0NTE1", "url": "https://github.com/apache/skywalking/pull/5775#pullrequestreview-522514515", "createdAt": "2020-11-03T13:53:22Z", "commit": {"oid": "1024e7ed4713e94035dcc60b59e8786d392bea2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1599, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}