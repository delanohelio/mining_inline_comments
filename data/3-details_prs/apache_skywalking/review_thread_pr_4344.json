{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMDMzOTcx", "number": 4344, "reviewThreads": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOTo1MzoxNVrODeY9QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNjoyNDoyMlrODfDzUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTkyNzY5OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwOTo1MzoxNVrOFnfyvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMToxMTo1NlrOFniQaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk1OTY3Ng==", "bodyText": "If you are using gRPC stream, you should use wait for the onComplete event to avoid the memory leak. What do you think?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r376959676", "createdAt": "2020-02-10T09:53:15Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ *\n+ * @author jian.tan\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+        if (alarmSetting != null) {\n+            GRPCClient client = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+            client.connect();\n+            alarmServiceStub = AlarmServiceGrpc.newStub(client.getChannel());\n+        }\n+    }\n+\n+    @Override public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmServiceStub == null) {\n+            return;\n+        }\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override public void onNext(Response response) {\n+\n+                }\n+\n+                @Override public void onError(Throwable throwable) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+\n+                }\n+\n+                @Override public void onCompleted() {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f8926144931812a19fdc1dd0a4b8ce305edea71"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk2MDY4OQ==", "bodyText": "Yeah", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r376960689", "createdAt": "2020-02-10T09:54:57Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ *\n+ * @author jian.tan\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+        if (alarmSetting != null) {\n+            GRPCClient client = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+            client.connect();\n+            alarmServiceStub = AlarmServiceGrpc.newStub(client.getChannel());\n+        }\n+    }\n+\n+    @Override public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmServiceStub == null) {\n+            return;\n+        }\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override public void onNext(Response response) {\n+\n+                }\n+\n+                @Override public void onError(Throwable throwable) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+\n+                }\n+\n+                @Override public void onCompleted() {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk1OTY3Ng=="}, "originalCommit": {"oid": "7f8926144931812a19fdc1dd0a4b8ce305edea71"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAwMDA0MQ==", "bodyText": "Waiting for your update.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377000041", "createdAt": "2020-02-10T11:11:56Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ *\n+ * @author jian.tan\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+        if (alarmSetting != null) {\n+            GRPCClient client = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+            client.connect();\n+            alarmServiceStub = AlarmServiceGrpc.newStub(client.getChannel());\n+        }\n+    }\n+\n+    @Override public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmServiceStub == null) {\n+            return;\n+        }\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override public void onNext(Response response) {\n+\n+                }\n+\n+                @Override public void onError(Throwable throwable) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+\n+                }\n+\n+                @Override public void onCompleted() {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        if (log.isDebugEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk1OTY3Ng=="}, "originalCommit": {"oid": "7f8926144931812a19fdc1dd0a4b8ce305edea71"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjg3MTIyOnYy", "diffSide": "RIGHT", "path": "docs/en/setup/backend/backend-alarm.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNDo0NTo0N1rOFnossw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyNDoxNFrOFoIvGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEwNTU4Nw==", "bodyText": "This code language  could be protobuf. It will result as following:\nmessage AlarmMessage {\n    int64 scopeId = 1;\n    string scope = 2;\n    string name = 3;\n    int64 id0 = 4;\n    int64 id1 = 5;\n    string ruleName = 6;\n    string alarmMessage = 7;\n    int64 startTime = 8;\n}", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377105587", "createdAt": "2020-02-10T14:45:47Z", "author": {"login": "JohnNiang"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -113,6 +114,24 @@ Example as following\n }]\n ```\n \n+## gRPCHook\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.\n+\n+Example as following\n+```text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7605f7bb3eedfa9e13bf2da8bdab863e957c756"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwNTcyMw==", "bodyText": "@JaredTan95 This should be fixed.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377605723", "createdAt": "2020-02-11T12:32:02Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -113,6 +114,24 @@ Example as following\n }]\n ```\n \n+## gRPCHook\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.\n+\n+Example as following\n+```text", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEwNTU4Nw=="}, "originalCommit": {"oid": "b7605f7bb3eedfa9e13bf2da8bdab863e957c756"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDQ4OA==", "bodyText": "make sense", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377630488", "createdAt": "2020-02-11T13:24:14Z", "author": {"login": "JaredTan95"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -113,6 +114,24 @@ Example as following\n }]\n ```\n \n+## gRPCHook\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.\n+\n+Example as following\n+```text", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEwNTU4Nw=="}, "originalCommit": {"oid": "b7605f7bb3eedfa9e13bf2da8bdab863e957c756"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDgwNzEwOnYy", "diffSide": "RIGHT", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/exporter/ExportData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMTozMDo1NFrOFn7Yng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMTozMDo1NFrOFn7Yng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxMTc0Mg==", "bodyText": "Don't add @author, all these will be removed by @kezhenxu94 's PR once for all.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377411742", "createdAt": "2020-02-11T01:30:54Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/exporter/ExportData.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.exporter;\n+\n+import lombok.Getter;\n+import org.apache.skywalking.oap.server.core.analysis.metrics.Metrics;\n+import org.apache.skywalking.oap.server.core.analysis.metrics.MetricsMetaInfo;\n+\n+/**\n+ * @author jian.tan", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "194df3e78407479b2042cb3ba6fcdc6103418ac5"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjA5Njk3OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjozOTo0MVrOFoHbcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjozOTo0MVrOFoHbcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTA3Mw==", "bodyText": "Why isn't this private?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377609073", "createdAt": "2020-02-11T12:39:41Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c86f56c5fb583a92f2deec7d86a80d469b28382a"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjA5OTMzOnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjo0MDo0NFrOFoHdAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyNDo0NFrOFoIwLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTQ3Mw==", "bodyText": "Look like this setting isn't supporting dynamic change? But the HTTP could. I think we should keep this consistent?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377609473", "createdAt": "2020-02-11T12:40:44Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+        if (alarmSetting != null) {\n+            GRPCClient client = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c86f56c5fb583a92f2deec7d86a80d469b28382a"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMDc2Ng==", "bodyText": "Agree", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377630766", "createdAt": "2020-02-11T13:24:44Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+        if (alarmSetting != null) {\n+            GRPCClient client = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTQ3Mw=="}, "originalCommit": {"oid": "c86f56c5fb583a92f2deec7d86a80d469b28382a"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI1MTI0OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyODoyNVrOFoI3wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMToxM1rOFoI9tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMjcwNQ==", "bodyText": "This way may not appropriate. I am working on it~", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377632705", "createdAt": "2020-02-11T13:28:25Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a362985e456e75627704bbac565be94d6449923"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNDIyOQ==", "bodyText": "Take a look at how HTTP works, it should be similar, just keep the existing client settings, and only create the new stub when settings changed.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377634229", "createdAt": "2020-02-11T13:31:13Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMjcwNQ=="}, "originalCommit": {"oid": "5a362985e456e75627704bbac565be94d6449923"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM2MjEwOnYy", "diffSide": "RIGHT", "path": "docs/en/setup/backend/backend-alarm.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo1OToyMFrOFoJ7vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo1OToyMFrOFoJ7vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MDEwOA==", "bodyText": "This is not example, this is the message protocol :)", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377650108", "createdAt": "2020-02-11T13:59:20Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -115,9 +115,11 @@ Example as following\n ```\n \n ## gRPCHook\n-This code language could be `Protobuf` which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.\n-It will result as following:\n-```text\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.\n+\n+Example as following", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM2ODU5OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCAlarmSetting.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMTowNlrOFoJ_kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMjo1M1rOFoKDag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MTA4OQ==", "bodyText": "Why this extends ModuleConfig?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377651089", "createdAt": "2020-02-11T14:01:06Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCAlarmSetting.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import java.util.Objects;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.library.module.ModuleConfig;\n+\n+@Setter\n+@Getter\n+public class GRPCAlarmSetting extends ModuleConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjA3NA==", "bodyText": "mistake, i will remove it.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377652074", "createdAt": "2020-02-11T14:02:53Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCAlarmSetting.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import java.util.Objects;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.library.module.ModuleConfig;\n+\n+@Setter\n+@Getter\n+public class GRPCAlarmSetting extends ModuleConfig {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MTA4OQ=="}, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM3NDgyOnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMjo0OVrOFoKDRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMjo0OVrOFoKDRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjAzNw==", "bodyText": "There is a connection leak here, the old one should be closed.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377652037", "createdAt": "2020-02-11T14:02:49Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {\n+            try {\n+                sleepTime += cycle;\n+                Thread.sleep(cycle);\n+            } catch (InterruptedException e) {\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Send {} alarm message to {}:{}.\", alarmMessage.size(),\n+                          alarmSetting.getTargetHost(), alarmSetting.getTargetPort()\n+                );\n+            }\n+\n+            if (sleepTime > 2000L) {\n+                log.debug(\"Send {} alarm message to {}:{}, wait {} milliseconds.\", alarmMessage.size(),\n+                          alarmSetting.getTargetHost(), alarmSetting.getTargetPort(), sleepTime\n+                );\n+                cycle = 2000L;\n+            }\n+        }\n+    }\n+\n+    private void onGRPCAlarmSettingUpdated(GRPCAlarmSetting grpcAlarmSetting) {\n+        if (!grpcAlarmSetting.equals(alarmSetting)) {\n+            grpcClient = new GRPCClient(grpcAlarmSetting.getTargetHost(), grpcAlarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 142}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM3Njc2OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMzoyM1rOFoKEfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDozMDo0OFrOFoLFKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjM1MA==", "bodyText": "I think we should not create stub and connect every time. Right?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377652350", "createdAt": "2020-02-11T14:03:23Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY2NDI5MQ==", "bodyText": "But, we should reconnect when client settings changed.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377664291", "createdAt": "2020-02-11T14:23:38Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjM1MA=="}, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY2ODkwNw==", "bodyText": "We should, but, the setting could not change here.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377668907", "createdAt": "2020-02-11T14:30:48Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjM1MA=="}, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM3ODAxOnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCAlarmSetting.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMzo0NFrOFoKFOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowMzo0NFrOFoKFOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjUzOQ==", "bodyText": "equals and hashCode methods could be replaced by Lombok annotation: @EqualsAndHashCode(callSuper = false)", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377652539", "createdAt": "2020-02-11T14:03:44Z", "author": {"login": "JohnNiang"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCAlarmSetting.java", "diffHunk": "@@ -27,4 +28,20 @@\n public class GRPCAlarmSetting extends ModuleConfig {\n     private String targetHost;\n     private int targetPort;\n+\n+    @Override\n+    public boolean equals(final Object o) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjM3OTEwOnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDowNDowMFrOFoKF1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDoyNDozNFrOFoK1pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjY5NQ==", "bodyText": "This should be a warning?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377652695", "createdAt": "2020-02-11T14:04:00Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {\n+            try {\n+                sleepTime += cycle;\n+                Thread.sleep(cycle);\n+            } catch (InterruptedException e) {\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Send {} alarm message to {}:{}.\", alarmMessage.size(),\n+                          alarmSetting.getTargetHost(), alarmSetting.getTargetPort()\n+                );\n+            }\n+\n+            if (sleepTime > 2000L) {\n+                log.debug(\"Send {} alarm message to {}:{}, wait {} milliseconds.\", alarmMessage.size(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY2NDkzNA==", "bodyText": "Yeah, warn is enough.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377664934", "createdAt": "2020-02-11T14:24:34Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        grpcClient.connect();\n+        alarmServiceStub = AlarmServiceGrpc.newStub(grpcClient.getChannel());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {\n+            try {\n+                sleepTime += cycle;\n+                Thread.sleep(cycle);\n+            } catch (InterruptedException e) {\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Send {} alarm message to {}:{}.\", alarmMessage.size(),\n+                          alarmSetting.getTargetHost(), alarmSetting.getTargetPort()\n+                );\n+            }\n+\n+            if (sleepTime > 2000L) {\n+                log.debug(\"Send {} alarm message to {}:{}, wait {} milliseconds.\", alarmMessage.size(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY1MjY5NQ=="}, "originalCommit": {"oid": "2bb16b193074a1398db260a8ea658f22da7e0423"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjQ5NDE0OnYy", "diffSide": "RIGHT", "path": "docs/en/setup/backend/backend-alarm.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDozMzowMlrOFoLK1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjowNzowMFrOFoPD6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY3MDM1Nw==", "bodyText": "We may not need to show \"Part of protocol\" file, my suggestion is to link to the alarm-hook.proto file directly, because the gRPC receiver may be implemented in any language, and the proto file is fundamental in any kind of implementation. If I were the user, I'd like to click the link and navigate to the proto file directly, instead of finding in the souce codes myself.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377670357", "createdAt": "2020-02-11T14:33:02Z", "author": {"login": "kezhenxu94"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -113,6 +114,24 @@ Example as following\n }]\n ```\n \n+## gRPCHook\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b26c16720d5c694d8720b2b88042eaf86c32701"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzczNDEyMw==", "bodyText": "I agree with you, but link alarm-hook.proto from docs to source code dir looks weird. show part of alarm-hook.proto and explain alarm-hook.proto's location may be more friendly.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377734123", "createdAt": "2020-02-11T16:07:00Z", "author": {"login": "JaredTan95"}, "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -113,6 +114,24 @@ Example as following\n }]\n ```\n \n+## gRPCHook\n+The alarm message will send through remote gRPC method by `Protobuf` content type. \n+The message format with following key information which are defined in `oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto`.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY3MDM1Nw=="}, "originalCommit": {"oid": "3b26c16720d5c694d8720b2b88042eaf86c32701"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjY0OTM5OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowOTo0NFrOFoMqig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjoyMTo0N1rOFoPpng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NDg1OA==", "bodyText": "There may be thread-visibility issue,  org.apache.skywalking.oap.server.core.exporter.ExportStatus#done is not volatile, BTW, ExportStatus can be annotated with Lombok annotations", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377694858", "createdAt": "2020-02-11T15:09:44Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzcwNjQzMw==", "bodyText": "Yes, I agree. I missed that last time.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377706433", "createdAt": "2020-02-11T15:26:32Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NDg1OA=="}, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzcxMTQ5Mg==", "bodyText": "ExportStatus is in exporter, why use it in the alarm?\n\nMaybe a CountDownLatch is enough to make it more convenient and safe (in terms of thread visibility)?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377711492", "createdAt": "2020-02-11T15:33:43Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NDg1OA=="}, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzcxNjgyNg==", "bodyText": "It works, or move ExportStatus to higher-level package, such as library-util.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377716826", "createdAt": "2020-02-11T15:41:33Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NDg1OA=="}, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0Mzc3NA==", "bodyText": "Considering exporter grpc(\n  \n    \n      skywalking/oap-server/exporter/src/main/java/org/apache/skywalking/oap/server/exporter/provider/grpc/GRPCExporter.java\n    \n    \n         Line 173\n      in\n      5b255ba\n    \n    \n    \n    \n\n        \n          \n           while (!status.isDone()) { \n        \n    \n  \n\n)  have the same problem and for reuse ExportStatus, move to higher-level package looks good.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377743774", "createdAt": "2020-02-11T16:21:47Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**\n+         * For memory safe of oap, we must wait for the peer confirmation.\n+         */\n+        while (!status.isDone()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NDg1OA=="}, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjY1MTE5OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMDoxMVrOFoMrow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMDoxMVrOFoMrow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NTEzOQ==", "bodyText": "Dangling Javadoc comment", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377695139", "createdAt": "2020-02-11T15:10:11Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        ExportStatus status = new ExportStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+        /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjc0MDIyOnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTozMDoyNVrOFoNiuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTozMDoyNVrOFoNiuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzcwOTI0MQ==", "bodyText": "ExportStatus is in exporter, why use it in the alarm?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377709241", "createdAt": "2020-02-11T15:30:25Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.core.exporter.ExportStatus;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "415b15dddba8b7bfb87ed535b3ab5dba3ea4974a"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODQ4Mzk3OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMDo1NjozMFrOFoeh8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMDo1NjozMFrOFoeh8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk4NzU3MQ==", "bodyText": "What if the user delete the gRPC hooks entirely? Say target host and port is empty", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377987571", "createdAt": "2020-02-12T00:56:30Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+import org.apache.skywalking.oap.server.library.util.GRPCStreamStatus;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());\n+        }\n+    }\n+\n+    @Override\n+    public void doAlarm(List<AlarmMessage> alarmMessage) {\n+\n+        if (alarmSetting == null) {\n+            return;\n+        }\n+\n+        // recreate gRPC client if host and port configuration changed.\n+        onGRPCAlarmSettingUpdated(alarmRulesWatcher.getGrpchookSetting());\n+\n+        GRPCStreamStatus status = new GRPCStreamStatus();\n+\n+        StreamObserver<org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage> streamObserver =\n+            alarmServiceStub.withDeadlineAfter(10, TimeUnit.SECONDS).doAlarm(new StreamObserver<Response>() {\n+                @Override\n+                public void onNext(Response response) {\n+                    // ignore empty response\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message failed: {}\", throwable.getMessage());\n+                    }\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    status.done();\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Send alarm message successful.\");\n+                    }\n+                }\n+            });\n+\n+        alarmMessage.forEach(message -> {\n+            org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.Builder builder =\n+                org.apache.skywalking.oap.server.core.alarm.grpc.AlarmMessage.newBuilder();\n+\n+            builder.setScopeId(message.getScopeId());\n+            builder.setScope(message.getScope());\n+            builder.setName(message.getName());\n+            builder.setId0(message.getId0());\n+            builder.setId1(message.getId1());\n+            builder.setRuleName(message.getRuleName());\n+            builder.setAlarmMessage(message.getAlarmMessage());\n+            builder.setStartTime(message.getStartTime());\n+\n+            streamObserver.onNext(builder.build());\n+        });\n+\n+        streamObserver.onCompleted();\n+\n+        long sleepTime = 0;\n+        long cycle = 100L;\n+\n+        // For memory safe of oap, we must wait for the peer confirmation.\n+        while (!status.isDone()) {\n+            try {\n+                sleepTime += cycle;\n+                Thread.sleep(cycle);\n+            } catch (InterruptedException ignored) {\n+            }\n+\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Send {} alarm message to {}:{}.\", alarmMessage.size(),\n+                          alarmSetting.getTargetHost(), alarmSetting.getTargetPort()\n+                );\n+            }\n+\n+            if (sleepTime > 2000L) {\n+                log.warn(\"Send {} alarm message to {}:{}, wait {} milliseconds.\", alarmMessage.size(),\n+                         alarmSetting.getTargetHost(), alarmSetting.getTargetPort(), sleepTime\n+                );\n+                cycle = 2000L;\n+            }\n+        }\n+    }\n+\n+    private void onGRPCAlarmSettingUpdated(GRPCAlarmSetting grpcAlarmSetting) {\n+        if (!grpcAlarmSetting.equals(alarmSetting)) {\n+            grpcClient.shutdown();\n+            grpcClient = new GRPCClient(grpcAlarmSetting.getTargetHost(), grpcAlarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9079ed0407691933cd770c3601441242183bed5a"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODQ4Njc4OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMDo1ODoxMlrOFoejqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMTozMzozNVrOFofGFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk4ODAwOA==", "bodyText": "Alarm is rare in most cases, this client may be lazily initialized (in doAlarm method)?", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377988008", "createdAt": "2020-02-12T00:58:12Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+import org.apache.skywalking.oap.server.library.util.GRPCStreamStatus;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9079ed0407691933cd770c3601441242183bed5a"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5MDM5Ng==", "bodyText": "If that, GRPCClient instance will be initialized every time indoAlarm mthoid, may not appropriate.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377990396", "createdAt": "2020-02-12T01:07:38Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+import org.apache.skywalking.oap.server.library.util.GRPCStreamStatus;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk4ODAwOA=="}, "originalCommit": {"oid": "9079ed0407691933cd770c3601441242183bed5a"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5NjQxNA==", "bodyText": "If that, GRPCClient instance will be initialized every time indoAlarm mthoid, may not appropriate.\n\nOf course you should take care whether the client is initialized or not", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377996414", "createdAt": "2020-02-12T01:31:46Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+import org.apache.skywalking.oap.server.library.util.GRPCStreamStatus;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk4ODAwOA=="}, "originalCommit": {"oid": "9079ed0407691933cd770c3601441242183bed5a"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk5NjgyMg==", "bodyText": "Anyway, not important thing, mark as resolved", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r377996822", "createdAt": "2020-02-12T01:33:35Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/grpc/GRPCCallback.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm.provider.grpc;\n+\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmCallback;\n+import org.apache.skywalking.oap.server.core.alarm.AlarmMessage;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.AlarmServiceGrpc;\n+import org.apache.skywalking.oap.server.core.alarm.grpc.Response;\n+import org.apache.skywalking.oap.server.core.alarm.provider.AlarmRulesWatcher;\n+import org.apache.skywalking.oap.server.library.client.grpc.GRPCClient;\n+import org.apache.skywalking.oap.server.library.util.GRPCStreamStatus;\n+\n+/**\n+ * Use SkyWalking alarm grpc API call a remote methods.\n+ */\n+@Slf4j\n+public class GRPCCallback implements AlarmCallback {\n+\n+    private AlarmRulesWatcher alarmRulesWatcher;\n+\n+    private GRPCAlarmSetting alarmSetting;\n+\n+    private AlarmServiceGrpc.AlarmServiceStub alarmServiceStub;\n+\n+    private GRPCClient grpcClient;\n+\n+    public GRPCCallback(AlarmRulesWatcher alarmRulesWatcher) {\n+        this.alarmRulesWatcher = alarmRulesWatcher;\n+        alarmSetting = alarmRulesWatcher.getGrpchookSetting();\n+\n+        if (alarmSetting != null) {\n+            grpcClient = new GRPCClient(alarmSetting.getTargetHost(), alarmSetting.getTargetPort());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk4ODAwOA=="}, "originalCommit": {"oid": "9079ed0407691933cd770c3601441242183bed5a"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODk0NzM5OnYy", "diffSide": "RIGHT", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/AlarmRulesWatcher.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNjoyNDoyMlrOFoi6hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODo1MzoxNVrOFomGEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1OTM5OQ==", "bodyText": "FYI @kezhenxu94 By following your style, do we have a format way to make sure all these imports are in the same order rather than different people using different orders.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r378059399", "createdAt": "2020-02-12T06:24:22Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/AlarmRulesWatcher.java", "diffHunk": "@@ -18,23 +18,22 @@\n \n package org.apache.skywalking.oap.server.core.alarm.provider;\n \n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.skywalking.oap.server.configuration.api.ConfigChangeWatcher;\n import org.apache.skywalking.oap.server.core.Const;\n import org.apache.skywalking.oap.server.core.alarm.AlarmModule;\n+import org.apache.skywalking.oap.server.core.alarm.provider.grpc.GRPCAlarmSetting;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abaee0f41da3873f90e208e200176086ed45bb98"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwMzkyMw==", "bodyText": "FYI @kezhenxu94 By following your style, do we have a format way to make sure all these imports are in the same order rather than different people using different orders.\n\nFollowing the codeStyle.xml, the import order is deterministic, these changes are expected because I didn't format them before", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r378103923", "createdAt": "2020-02-12T08:37:18Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/AlarmRulesWatcher.java", "diffHunk": "@@ -18,23 +18,22 @@\n \n package org.apache.skywalking.oap.server.core.alarm.provider;\n \n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.skywalking.oap.server.configuration.api.ConfigChangeWatcher;\n import org.apache.skywalking.oap.server.core.Const;\n import org.apache.skywalking.oap.server.core.alarm.AlarmModule;\n+import org.apache.skywalking.oap.server.core.alarm.provider.grpc.GRPCAlarmSetting;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1OTM5OQ=="}, "originalCommit": {"oid": "abaee0f41da3873f90e208e200176086ed45bb98"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODExMTUwNw==", "bodyText": "Got it. I was expected the format check will do in a strict way, it will make the changelog more clear for everyone.", "url": "https://github.com/apache/skywalking/pull/4344#discussion_r378111507", "createdAt": "2020-02-12T08:53:15Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/AlarmRulesWatcher.java", "diffHunk": "@@ -18,23 +18,22 @@\n \n package org.apache.skywalking.oap.server.core.alarm.provider;\n \n+import java.io.StringReader;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.skywalking.oap.server.configuration.api.ConfigChangeWatcher;\n import org.apache.skywalking.oap.server.core.Const;\n import org.apache.skywalking.oap.server.core.alarm.AlarmModule;\n+import org.apache.skywalking.oap.server.core.alarm.provider.grpc.GRPCAlarmSetting;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1OTM5OQ=="}, "originalCommit": {"oid": "abaee0f41da3873f90e208e200176086ed45bb98"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4575, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}