{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1OTkyOTQz", "number": 5616, "title": "fix RESOURCE_LEAK", "bodyText": "use  try-with-resources\nPlease answer these questions before submitting a pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n\n\n\nBug fix\n\nBug description.\n\nRESOURCE_LEAK\n\nHow to fix?\n\nuse  try-with-resources\n\nNew feature or improvement\n\nDescribe the details and related test reports.", "createdAt": "2020-10-01T06:19:24Z", "url": "https://github.com/apache/skywalking/pull/5616", "merged": true, "mergeCommit": {"oid": "5fa2ae49037b65112c68372da4e82959fd842832"}, "closed": true, "closedAt": "2020-10-07T10:47:26Z", "author": {"login": "x22x22"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOLQEegH2gAyNDk1OTkyOTQzOmU3Nzc0NGE1YTEzYzA3MGIwYTQ0MTMzMTQwYWNkMzk1NTYyZjI2OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQIwjlAH2gAyNDk1OTkyOTQzOjUyYzQzNDJhMTk3YzBlMzA2ZGM4Y2U3MjM3Y2Y2NDEyZTM5M2ZlNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e77744a5a13c070b0a44133140acd395562f269a", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/e77744a5a13c070b0a44133140acd395562f269a", "committedDate": "2020-10-01T06:18:41Z", "message": "fix RESOURCE_LEAK\n\nuse  try-with-resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNDE1Njc5", "url": "https://github.com/apache/skywalking/pull/5616#pullrequestreview-500415679", "createdAt": "2020-10-01T14:36:15Z", "commit": {"oid": "e77744a5a13c070b0a44133140acd395562f269a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDozNjoxNVrOHbNe0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDozNjozOVrOHbNf9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI5NDQ4MA==", "bodyText": "It is closed in L50.", "url": "https://github.com/apache/skywalking/pull/5616#discussion_r498294480", "createdAt": "2020-10-01T14:36:15Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/optional-plugins/trace-ignore-plugin/src/main/java/org/apache/skywalking/apm/plugin/trace/ignore/conf/IgnoreConfigInitializer.java", "diffHunk": "@@ -89,10 +88,12 @@ private static void overrideConfigBySystemProp() throws IllegalAccessException {\n     private static InputStream loadConfigFromAgentFolder() throws AgentPackageNotFoundException, ConfigNotFoundException {\n         File configFile = new File(AgentPackagePath.getPath(), CONFIG_FILE_NAME);\n         if (configFile.exists() && configFile.isFile()) {\n-            try {\n+            try(var configFileStream = new FileInputStream(configFile)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e77744a5a13c070b0a44133140acd395562f269a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI5NDc3NA==", "bodyText": "JarFile need to be resident in memory. @wu-sheng @acurtain", "url": "https://github.com/apache/skywalking/pull/5616#discussion_r498294774", "createdAt": "2020-10-01T14:36:39Z", "author": {"login": "dmsolr"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java", "diffHunk": "@@ -192,9 +193,11 @@ public URL nextElement() {\n                 for (String fileName : jarFileNames) {\n                     try {\n                         File file = new File(path, fileName);\n-                        Jar jar = new Jar(new JarFile(file), file);\n-                        jars.add(jar);\n-                        LOGGER.info(\"{} loaded.\", file.toString());\n+                        try(var jarFile = new JarFile(file)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e77744a5a13c070b0a44133140acd395562f269a"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e5af78659f1d517a056f20a3672ccd15d17c257", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/9e5af78659f1d517a056f20a3672ccd15d17c257", "committedDate": "2020-10-01T14:47:24Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0f9ed48dde9b500fabf3b8621d146347bc20913", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/d0f9ed48dde9b500fabf3b8621d146347bc20913", "committedDate": "2020-10-01T14:55:40Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9edd7c6908020ae7b9188ee320053d265e03d312", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/9edd7c6908020ae7b9188ee320053d265e03d312", "committedDate": "2020-10-01T16:36:46Z", "message": "fix RESOURCE_LEAK\n\nuse  try-with-resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "987360371b229c1c0ab0e7225330eacd8199451d", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/987360371b229c1c0ab0e7225330eacd8199451d", "committedDate": "2020-10-01T16:43:29Z", "message": "fix RESOURCE_LEAK\n\nuse  try-with-resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a0015148567774bef3e02ef710abab40eb8d0d6", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/1a0015148567774bef3e02ef710abab40eb8d0d6", "committedDate": "2020-10-01T16:49:09Z", "message": "fix RESOURCE_LEAK\n\nuse  try-with-resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTc0NDMx", "url": "https://github.com/apache/skywalking/pull/5616#pullrequestreview-500974431", "createdAt": "2020-10-02T09:07:05Z", "commit": {"oid": "1a0015148567774bef3e02ef710abab40eb8d0d6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "658669179515084a3279522380db4a94de5ee7e6", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/658669179515084a3279522380db4a94de5ee7e6", "committedDate": "2020-10-02T14:04:35Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTY1OTU4", "url": "https://github.com/apache/skywalking/pull/5616#pullrequestreview-501165958", "createdAt": "2020-10-02T14:05:52Z", "commit": {"oid": "658669179515084a3279522380db4a94de5ee7e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDowNTo1MlrOHbu-uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDowNTo1MlrOHbu-uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg0MzMyMw==", "bodyText": "Closing this?", "url": "https://github.com/apache/skywalking/pull/5616#discussion_r498843323", "createdAt": "2020-10-02T14:05:52Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-receiver-plugin/zipkin-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/zipkin/handler/SpanProcessor.java", "diffHunk": "@@ -39,37 +39,36 @@ public SpanProcessor(SourceReceiver receiver) {\n     }\n \n     void convert(ZipkinReceiverConfig config, SpanBytesDecoder decoder, HttpServletRequest request) throws IOException {\n-        InputStream inputStream = getInputStream(request);\n-        ByteArrayOutputStream out = new ByteArrayOutputStream();\n-        byte[] buffer = new byte[2048];\n-        int readCntOnce;\n+        try(InputStream inputStream = getInputStream(request)) {\n+            ByteArrayOutputStream out = new ByteArrayOutputStream();\n+            byte[] buffer = new byte[2048];\n+            int readCntOnce;\n \n-        while ((readCntOnce = inputStream.read(buffer)) >= 0) {\n-            out.write(buffer, 0, readCntOnce);\n-        }\n+            while ((readCntOnce = inputStream.read(buffer)) >= 0) {\n+                out.write(buffer, 0, readCntOnce);\n+            }\n \n-        List<Span> spanList = decoder.decodeList(out.toByteArray());\n+            List<Span> spanList = decoder.decodeList(out.toByteArray());\n \n-        if (config.isNeedAnalysis()) {\n-            ZipkinSkyWalkingTransfer transfer = new ZipkinSkyWalkingTransfer();\n-            transfer.doTransfer(config, spanList);\n-        } else {\n-            SpanForward forward = new SpanForward(config, receiver);\n-            forward.send(spanList);\n+            if (config.isNeedAnalysis()) {\n+                ZipkinSkyWalkingTransfer transfer = new ZipkinSkyWalkingTransfer();\n+                transfer.doTransfer(config, spanList);\n+            } else {\n+                SpanForward forward = new SpanForward(config, receiver);\n+                forward.send(spanList);\n+            }\n         }\n     }\n \n     private InputStream getInputStream(HttpServletRequest request) throws IOException {\n-        InputStream requestInStream;\n-\n         String headEncoding = request.getHeader(\"accept-encoding\");\n         if (headEncoding != null && (headEncoding.indexOf(\"gzip\") != -1)) {\n-            requestInStream = new GZIPInputStream(request.getInputStream());\n+            try(InputStream requestInStream = new GZIPInputStream(request.getInputStream());){\n+                return requestInStream;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "658669179515084a3279522380db4a94de5ee7e6"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd9ab934f446092d9d938d24bb2cc3b5cf43847", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/7bd9ab934f446092d9d938d24bb2cc3b5cf43847", "committedDate": "2020-10-04T03:12:47Z", "message": "fix Codestyle issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e34411abb64c8cf161f5756793e3c0c5391dc0c8", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/e34411abb64c8cf161f5756793e3c0c5391dc0c8", "committedDate": "2020-10-04T03:16:00Z", "message": "Code reductionCode reduction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f61f1136d0bc51237eef40be4b5434ac15697c29", "author": {"user": {"login": "x22x22", "name": "Kdump"}}, "url": "https://github.com/apache/skywalking/commit/f61f1136d0bc51237eef40be4b5434ac15697c29", "committedDate": "2020-10-04T03:17:12Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNjAxOTk2", "url": "https://github.com/apache/skywalking/pull/5616#pullrequestreview-501601996", "createdAt": "2020-10-04T08:33:28Z", "commit": {"oid": "f61f1136d0bc51237eef40be4b5434ac15697c29"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55028de757eddee23519431bb0b9110e25a1eef9", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/55028de757eddee23519431bb0b9110e25a1eef9", "committedDate": "2020-10-06T13:53:21Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNTM1MTY3", "url": "https://github.com/apache/skywalking/pull/5616#pullrequestreview-503535167", "createdAt": "2020-10-07T05:29:57Z", "commit": {"oid": "55028de757eddee23519431bb0b9110e25a1eef9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52c4342a197c0e306dc8ce7237cf6412e393fe70", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/52c4342a197c0e306dc8ce7237cf6412e393fe70", "committedDate": "2020-10-07T08:32:18Z", "message": "Merge branch 'master' into fix-RESOURCE_LEAK"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1783, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}