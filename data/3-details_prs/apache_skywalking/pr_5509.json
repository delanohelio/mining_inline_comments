{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NTAwNzI3", "number": 5509, "title": "Fix slack nullpointer issue ", "bodyText": "Please answer these questions before submitting a pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\nRelated issues\nresolved #5508\n\n\n\nBug fix\n\nBug description.\nSlack webHook throws nullpointer exception when user not set the configuration\nHow to fix?\nCheck the null of SlackSettings", "createdAt": "2020-09-17T08:33:36Z", "url": "https://github.com/apache/skywalking/pull/5509", "merged": true, "mergeCommit": {"oid": "b51dba5c846eee19a5c41ebb6a31c743acac66d4"}, "closed": true, "closedAt": "2020-09-18T01:00:54Z", "author": {"login": "xbkaishui"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJsvpOgH2gAyNDg4NTAwNzI3OmMyY2ZlM2M0OTczODNiOGVhYzA5Mzk1YjVjNGQ1MGU3YjJlYzdhNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJtITWgH2gAyNDg4NTAwNzI3OmUxZjAyZjFiOWRiMmU2MjczMzhmMWM0ZjEzNzQyM2I1OWYyMDczMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63", "committedDate": "2020-09-17T08:30:25Z", "message": "Fix null pointer bug, format log message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY2MTEx", "url": "https://github.com/apache/skywalking/pull/5509#pullrequestreview-490366111", "createdAt": "2020-09-17T08:35:16Z", "commit": {"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY4NDc3", "url": "https://github.com/apache/skywalking/pull/5509#pullrequestreview-490368477", "createdAt": "2020-09-17T08:38:14Z", "commit": {"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODoxNVrOHTXjqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODoxNVrOHTXjqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk1Mg==", "bodyText": "Actually, I think this should not change, but wechat callback should be changed.\nTake a look on the source codes\npublic void error(Marker marker, String format, Object arg);\n\npublic void error(String msg, Throwable t);\n\nIf you want to print exception stack, then can't use the arguments for log text.", "url": "https://github.com/apache/skywalking/pull/5509#discussion_r490070952", "createdAt": "2020-09-17T08:38:15Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/slack/SlackhookCallback.java", "diffHunk": "@@ -77,31 +77,26 @@ public void doAlarm(List<AlarmMessage> alarmMessages) {\n \n                 StringEntity entity;\n                 try {\n-\n                     JsonObject jsonObject = new JsonObject();\n                     JsonArray jsonElements = new JsonArray();\n-\n                     alarmMessages.forEach(item -> {\n                         jsonElements.add(GSON.fromJson(\n                             String.format(\n                                 this.alarmRulesWatcher.getSlackSettings().getTextTemplate(), item.getAlarmMessage()\n                             ), JsonObject.class));\n                     });\n-\n                     jsonObject.add(\"blocks\", jsonElements);\n-\n                     entity = new StringEntity(GSON.toJson(jsonObject), ContentType.APPLICATION_JSON);\n-\n                     post.setEntity(entity);\n                     CloseableHttpResponse httpResponse = httpClient.execute(post);\n                     StatusLine statusLine = httpResponse.getStatusLine();\n                     if (statusLine != null && statusLine.getStatusCode() != HttpStatus.SC_OK) {\n-                        log.error(\"send alarm to \" + url + \" failure. Response code: \" + statusLine.getStatusCode());\n+                        log.error(\"Send slack alarm to {} failure. Response code: {}\", url , statusLine.getStatusCode());\n                     }\n                 } catch (UnsupportedEncodingException e) {\n-                    log.error(\"Alarm to JSON error, \" + e.getMessage(), e);\n+                    log.error(\"Alarm to JSON error, {} \", e.getMessage(), e);\n                 } catch (IOException e) {\n-                    log.error(\"send alarm to \" + url + \" failure.\", e);\n+                    log.error(\"Send slack alarm to {} failure.\", url , e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzg0NTA0", "url": "https://github.com/apache/skywalking/pull/5509#pullrequestreview-490384504", "createdAt": "2020-09-17T08:57:12Z", "commit": {"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1f02f1b9db2e627338f1c4f137423b59f207338", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e1f02f1b9db2e627338f1c4f137423b59f207338", "committedDate": "2020-09-17T08:57:21Z", "message": "Merge branch 'master' into fix-slack-issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1685, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}