{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MzMyODIy", "number": 4177, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNDo0MTowOFrODYMjrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODo0ODoyNFrODbI4jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2Njk4MTU2OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/conf/Config.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNDo0MTowOFrOFd6ghQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNDo0MTowOFrOFd6ghQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMTYyMQ==", "bodyText": "Do you forget to remove all these?", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r366911621", "createdAt": "2020-01-15T14:41:08Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/conf/Config.java", "diffHunk": "@@ -388,5 +390,26 @@\n              */\n             public static int HTTP_PARAMS_LENGTH_THRESHOLD = 1024;\n         }\n+\n+        public static class Grpc {\n+            /**\n+             * If this config is false, only client spans of peer which configured in {@link Grpc#INCLUDED_CLIENT_TRACING_PEERS}\n+             * will be collected. In this mode {@link Grpc#EXCLUDED_CLIENT_TRACING_PEERS} will override {@link Grpc#INCLUDED_CLIENT_TRACING_PEERS}.\n+             * <p>\n+             * If this config is true, only client spans of peer which configured in {@link Grpc#EXCLUDED_CLIENT_TRACING_PEERS}\n+             * will not be collected. In this mode {@link Grpc#INCLUDED_CLIENT_TRACING_PEERS} will override {@link Grpc#EXCLUDED_CLIENT_TRACING_PEERS}.\n+             */\n+            public static boolean DEFAULT_CLIENT_TRACING_ENABLE = false;\n+\n+            /**\n+             * Included client tracing peers. gRPC plugin will collect client spans of configured config.\n+             */\n+            public static List<String> INCLUDED_CLIENT_TRACING_PEERS = new LinkedList<>();\n+\n+            /**\n+             * Excluded client tracing peers. gRPC plugin will not collect client spans of configured config.\n+             */\n+            public static List<String> EXCLUDED_CLIENT_TRACING_PEERS = new LinkedList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a1d453a53bba15397d708d6558bdf28500320ae"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2Njk5MjQwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/BlockingCallInterceptor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNDo0NDoyMVrOFd6naQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNzoxMjo1OVrOFeP2ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMzM4NQ==", "bodyText": "When will remove this from the RuntimeContext?", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r366913385", "createdAt": "2020-01-15T14:44:21Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/BlockingCallInterceptor.java", "diffHunk": "@@ -16,43 +16,48 @@\n  *\n  */\n \n-package org.apache.skywalking.apm.plugin.grpc.v1;\n+package org.apache.skywalking.apm.plugin.grpc.v1.client;\n \n import io.grpc.Channel;\n import io.grpc.MethodDescriptor;\n-import java.lang.reflect.Method;\n import org.apache.skywalking.apm.agent.core.context.ContextManager;\n import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.StaticMethodsAroundInterceptor;\n import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n \n+import java.lang.reflect.Method;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.BLOCKING_CALL_EXIT_SPAN;\n import static org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil.formatOperationName;\n \n /**\n- * @author zhang xin\n+ * @author zhang xin, kanro\n  */\n public class BlockingCallInterceptor implements StaticMethodsAroundInterceptor {\n \n-    @Override public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n-        MethodInterceptResult result) {\n-        Channel channel = (Channel)allArguments[0];\n-        MethodDescriptor methodDescriptor = (MethodDescriptor)allArguments[1];\n+    @Override\n+    public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n+                             MethodInterceptResult result) {\n+        Channel channel = (Channel) allArguments[0];\n+        MethodDescriptor<?, ?> methodDescriptor = (MethodDescriptor<?, ?>) allArguments[1];\n         final AbstractSpan span = ContextManager.createExitSpan(formatOperationName(methodDescriptor), channel.authority());\n         span.setComponent(ComponentsDefine.GRPC);\n-        SpanLayer.asRPCFramework(span);\n+        span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+        ContextManager.getRuntimeContext().put(BLOCKING_CALL_EXIT_SPAN, span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a1d453a53bba15397d708d6558bdf28500320ae"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxNDA1Mg==", "bodyText": "If not, whether the multiple RPCs will trigger dirty read?", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r366914052", "createdAt": "2020-01-15T14:45:36Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/BlockingCallInterceptor.java", "diffHunk": "@@ -16,43 +16,48 @@\n  *\n  */\n \n-package org.apache.skywalking.apm.plugin.grpc.v1;\n+package org.apache.skywalking.apm.plugin.grpc.v1.client;\n \n import io.grpc.Channel;\n import io.grpc.MethodDescriptor;\n-import java.lang.reflect.Method;\n import org.apache.skywalking.apm.agent.core.context.ContextManager;\n import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.StaticMethodsAroundInterceptor;\n import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n \n+import java.lang.reflect.Method;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.BLOCKING_CALL_EXIT_SPAN;\n import static org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil.formatOperationName;\n \n /**\n- * @author zhang xin\n+ * @author zhang xin, kanro\n  */\n public class BlockingCallInterceptor implements StaticMethodsAroundInterceptor {\n \n-    @Override public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n-        MethodInterceptResult result) {\n-        Channel channel = (Channel)allArguments[0];\n-        MethodDescriptor methodDescriptor = (MethodDescriptor)allArguments[1];\n+    @Override\n+    public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n+                             MethodInterceptResult result) {\n+        Channel channel = (Channel) allArguments[0];\n+        MethodDescriptor<?, ?> methodDescriptor = (MethodDescriptor<?, ?>) allArguments[1];\n         final AbstractSpan span = ContextManager.createExitSpan(formatOperationName(methodDescriptor), channel.authority());\n         span.setComponent(ComponentsDefine.GRPC);\n-        SpanLayer.asRPCFramework(span);\n+        span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+        ContextManager.getRuntimeContext().put(BLOCKING_CALL_EXIT_SPAN, span);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMzM4NQ=="}, "originalCommit": {"oid": "5a1d453a53bba15397d708d6558bdf28500320ae"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI2MTM3MA==", "bodyText": "Yes, got it, I will fix it later", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r367261370", "createdAt": "2020-01-16T07:12:59Z", "author": {"login": "devkanro"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/BlockingCallInterceptor.java", "diffHunk": "@@ -16,43 +16,48 @@\n  *\n  */\n \n-package org.apache.skywalking.apm.plugin.grpc.v1;\n+package org.apache.skywalking.apm.plugin.grpc.v1.client;\n \n import io.grpc.Channel;\n import io.grpc.MethodDescriptor;\n-import java.lang.reflect.Method;\n import org.apache.skywalking.apm.agent.core.context.ContextManager;\n import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.StaticMethodsAroundInterceptor;\n import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n \n+import java.lang.reflect.Method;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.BLOCKING_CALL_EXIT_SPAN;\n import static org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil.formatOperationName;\n \n /**\n- * @author zhang xin\n+ * @author zhang xin, kanro\n  */\n public class BlockingCallInterceptor implements StaticMethodsAroundInterceptor {\n \n-    @Override public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n-        MethodInterceptResult result) {\n-        Channel channel = (Channel)allArguments[0];\n-        MethodDescriptor methodDescriptor = (MethodDescriptor)allArguments[1];\n+    @Override\n+    public void beforeMethod(Class clazz, Method method, Object[] allArguments, Class<?>[] parameterTypes,\n+                             MethodInterceptResult result) {\n+        Channel channel = (Channel) allArguments[0];\n+        MethodDescriptor<?, ?> methodDescriptor = (MethodDescriptor<?, ?>) allArguments[1];\n         final AbstractSpan span = ContextManager.createExitSpan(formatOperationName(methodDescriptor), channel.authority());\n         span.setComponent(ComponentsDefine.GRPC);\n-        SpanLayer.asRPCFramework(span);\n+        span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+        ContextManager.getRuntimeContext().put(BLOCKING_CALL_EXIT_SPAN, span);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMzM4NQ=="}, "originalCommit": {"oid": "5a1d453a53bba15397d708d6558bdf28500320ae"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE2MzIzOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/TracingClientCall.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNzo1OTozN1rOFh6Idg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNzo1OTozN1rOFh6Idg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA5OTc2Ng==", "bodyText": "This comment seems not right. Do you miss the changes of old version?", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371099766", "createdAt": "2020-01-27T07:59:37Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/client/TracingClientCall.java", "diffHunk": "@@ -0,0 +1,201 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.client;\n+\n+import io.grpc.*;\n+import org.apache.skywalking.apm.agent.core.context.CarrierItem;\n+import org.apache.skywalking.apm.agent.core.context.ContextCarrier;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+import static org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil.formatOperationName;\n+\n+/**\n+ * Fully client tracing for external gRPC server which not be registered in the same Skywalking server.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE4MzcwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODowOTo0NlrOFh6UTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoyMDoyOVrOFiMqQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwMjc5Ng==", "bodyText": "case UNKNOWN, case INTERNAL and default seem to have the same logic. What is the difference?", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371102796", "createdAt": "2020-01-27T08:09:46Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCall;\n+import io.grpc.Metadata;\n+import io.grpc.ServerCall;\n+import io.grpc.Status;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCall<REQUEST, RESPONSE> extends ForwardingServerCall.SimpleForwardingServerCall<REQUEST, RESPONSE> {\n+\n+    private final String operationPrefix;\n+    private final ContextSnapshot contextSnapshot;\n+\n+    protected TracingServerCall(ServerCall<REQUEST, RESPONSE> delegate, ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(delegate.getMethodDescriptor()) + SERVER;\n+        this.contextSnapshot = contextSnapshot;\n+    }\n+\n+    @Override\n+    public void sendMessage(RESPONSE message) {\n+        // We just create the request on message span for server stream calls.\n+        if (!getMethodDescriptor().getType().serverSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.sendMessage(message);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.sendMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void close(Status status, Metadata trailers) {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_CLOSE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+\n+            switch (status.getCode()) {\n+                case OK:\n+                    break;\n+                // UNKNOWN/INTERNAL status code will case error in this span.\n+                // Those status code means some unexpected error occurred in server.\n+                // Similar to 5XX in HTTP status.\n+                case UNKNOWN:\n+                case INTERNAL:\n+                    if (status.getCause() == null) {\n+                        span.errorOccurred().log(status.asRuntimeException());\n+                    } else {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+                // Other status code means some predictable error occurred in server.\n+                // Like PERMISSION_DENIED or UNAUTHENTICATED somethings.\n+                // Similar to 4XX in HTTP status.\n+                default:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMzMzMQ==", "bodyText": "UNKNOWN and INTERNAL is similar to the 5xx errors in HTTP, it must case span error even status has no cause exception.\ndefault(others) is similar to the 4xx errors in HTTP, we just case error when status has cause exception for user debugging.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371403331", "createdAt": "2020-01-27T18:20:29Z", "author": {"login": "devkanro"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCall;\n+import io.grpc.Metadata;\n+import io.grpc.ServerCall;\n+import io.grpc.Status;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCall<REQUEST, RESPONSE> extends ForwardingServerCall.SimpleForwardingServerCall<REQUEST, RESPONSE> {\n+\n+    private final String operationPrefix;\n+    private final ContextSnapshot contextSnapshot;\n+\n+    protected TracingServerCall(ServerCall<REQUEST, RESPONSE> delegate, ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(delegate.getMethodDescriptor()) + SERVER;\n+        this.contextSnapshot = contextSnapshot;\n+    }\n+\n+    @Override\n+    public void sendMessage(RESPONSE message) {\n+        // We just create the request on message span for server stream calls.\n+        if (!getMethodDescriptor().getType().serverSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.sendMessage(message);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.sendMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void close(Status status, Metadata trailers) {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_CLOSE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+\n+            switch (status.getCode()) {\n+                case OK:\n+                    break;\n+                // UNKNOWN/INTERNAL status code will case error in this span.\n+                // Those status code means some unexpected error occurred in server.\n+                // Similar to 5XX in HTTP status.\n+                case UNKNOWN:\n+                case INTERNAL:\n+                    if (status.getCause() == null) {\n+                        span.errorOccurred().log(status.asRuntimeException());\n+                    } else {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+                // Other status code means some predictable error occurred in server.\n+                // Like PERMISSION_DENIED or UNAUTHENTICATED somethings.\n+                // Similar to 4XX in HTTP status.\n+                default:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwMjc5Ng=="}, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE5NjE2OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNTozNVrOFh6baw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNTozNVrOFh6baw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwNDYxOQ==", "bodyText": "You should add a new try/final in this code block, and keep super#close in the final.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371104619", "createdAt": "2020-01-27T08:15:35Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCall;\n+import io.grpc.Metadata;\n+import io.grpc.ServerCall;\n+import io.grpc.Status;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCall<REQUEST, RESPONSE> extends ForwardingServerCall.SimpleForwardingServerCall<REQUEST, RESPONSE> {\n+\n+    private final String operationPrefix;\n+    private final ContextSnapshot contextSnapshot;\n+\n+    protected TracingServerCall(ServerCall<REQUEST, RESPONSE> delegate, ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(delegate.getMethodDescriptor()) + SERVER;\n+        this.contextSnapshot = contextSnapshot;\n+    }\n+\n+    @Override\n+    public void sendMessage(RESPONSE message) {\n+        // We just create the request on message span for server stream calls.\n+        if (!getMethodDescriptor().getType().serverSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.sendMessage(message);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.sendMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void close(Status status, Metadata trailers) {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_CLOSE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+\n+            switch (status.getCode()) {\n+                case OK:\n+                    break;\n+                // UNKNOWN/INTERNAL status code will case error in this span.\n+                // Those status code means some unexpected error occurred in server.\n+                // Similar to 5XX in HTTP status.\n+                case UNKNOWN:\n+                case INTERNAL:\n+                    if (status.getCause() == null) {\n+                        span.errorOccurred().log(status.asRuntimeException());\n+                    } else {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+                // Other status code means some predictable error occurred in server.\n+                // Like PERMISSION_DENIED or UNAUTHENTICATED somethings.\n+                // Similar to 4XX in HTTP status.\n+                default:\n+                    // But if the status still has cause exception, we will log it too.\n+                    if (status.getCause() != null) {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+            }\n+            Tags.STATUS_CODE.set(span, status.getCode().name());\n+            super.close(status, trailers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE5ODE3OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNjozM1rOFh6cmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNjozM1rOFh6cmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwNDkyMg==", "bodyText": "A similar suggestion, try/final should be added here.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371104922", "createdAt": "2020-01-27T08:16:33Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCallListener;\n+import io.grpc.MethodDescriptor;\n+import io.grpc.ServerCall;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCallListener<REQUEST> extends ForwardingServerCallListener.SimpleForwardingServerCallListener<REQUEST> {\n+\n+    private final ContextSnapshot contextSnapshot;\n+    private final MethodDescriptor.MethodType methodType;\n+    private final String operationPrefix;\n+\n+    protected TracingServerCallListener(ServerCall.Listener<REQUEST> delegate, MethodDescriptor<REQUEST, ?> descriptor,\n+                                        ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.contextSnapshot = contextSnapshot;\n+        this.methodType = descriptor.getType();\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(descriptor) + SERVER;\n+    }\n+\n+    @Override\n+    public void onMessage(REQUEST message) {\n+        // We just create the request on message span for client stream calls.\n+        if (!methodType.clientSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.onMessage(message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE5ODczOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNjo0OFrOFh6c9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNjo0OFrOFh6c9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwNTAxMw==", "bodyText": "A similar suggestion, try/final should be added here.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371105013", "createdAt": "2020-01-27T08:16:48Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCallListener;\n+import io.grpc.MethodDescriptor;\n+import io.grpc.ServerCall;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCallListener<REQUEST> extends ForwardingServerCallListener.SimpleForwardingServerCallListener<REQUEST> {\n+\n+    private final ContextSnapshot contextSnapshot;\n+    private final MethodDescriptor.MethodType methodType;\n+    private final String operationPrefix;\n+\n+    protected TracingServerCallListener(ServerCall.Listener<REQUEST> delegate, MethodDescriptor<REQUEST, ?> descriptor,\n+                                        ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.contextSnapshot = contextSnapshot;\n+        this.methodType = descriptor.getType();\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(descriptor) + SERVER;\n+    }\n+\n+    @Override\n+    public void onMessage(REQUEST message) {\n+        // We just create the request on message span for client stream calls.\n+        if (!methodType.clientSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.onMessage(message);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.onMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void onCancel() {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_CANCEL_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+            super.onCancel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDE5OTI0OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNzowN1rOFh6dRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODoxNzowN1rOFh6dRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEwNTA5Mw==", "bodyText": "A similar suggestion, try/final should be added here.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371105093", "createdAt": "2020-01-27T08:17:07Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCallListener;\n+import io.grpc.MethodDescriptor;\n+import io.grpc.ServerCall;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCallListener<REQUEST> extends ForwardingServerCallListener.SimpleForwardingServerCallListener<REQUEST> {\n+\n+    private final ContextSnapshot contextSnapshot;\n+    private final MethodDescriptor.MethodType methodType;\n+    private final String operationPrefix;\n+\n+    protected TracingServerCallListener(ServerCall.Listener<REQUEST> delegate, MethodDescriptor<REQUEST, ?> descriptor,\n+                                        ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.contextSnapshot = contextSnapshot;\n+        this.methodType = descriptor.getType();\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(descriptor) + SERVER;\n+    }\n+\n+    @Override\n+    public void onMessage(REQUEST message) {\n+        // We just create the request on message span for client stream calls.\n+        if (!methodType.clientSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+                super.onMessage(message);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.onMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void onCancel() {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_CANCEL_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+            super.onCancel();\n+        } catch (Throwable t) {\n+            ContextManager.activeSpan().errorOccurred().log(t);\n+            throw t;\n+        } finally {\n+            ContextManager.stopSpan();\n+        }\n+    }\n+\n+    @Override\n+    public void onHalfClose() {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_COMPLETE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+            super.onHalfClose();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDI0MzA4OnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODozNjoxNlrOFh63Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODozNjoxNlrOFh63Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExMTc1OA==", "bodyText": "Health check should not be included.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371111758", "createdAt": "2020-01-27T08:36:16Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,542 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [/grpc-scenario/case/healthCheck, Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDI0MzM2OnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODozNjoyM1rOFh63dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODozNjoyM1rOFh63dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExMTc5OQ==", "bodyText": "Health check should not be included.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371111799", "createdAt": "2020-01-27T08:36:23Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,542 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [/grpc-scenario/case/healthCheck, Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: /grpc-scenario/case/healthCheck", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "394adec0dfd00cf744df06a299079eba17e9e0e3"}, "originalPosition": 248}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzY4MTU4OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzo0MTo1MFrOFibc6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzo0OToyN1rOFibm1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTY3Mg==", "bodyText": "What is this catch for? I can't see any code happens except the plugin logic. We should not log an error caused by our own codes, rather than users.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371645672", "createdAt": "2020-01-28T07:41:50Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCall;\n+import io.grpc.Metadata;\n+import io.grpc.ServerCall;\n+import io.grpc.Status;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCall<REQUEST, RESPONSE> extends ForwardingServerCall.SimpleForwardingServerCall<REQUEST, RESPONSE> {\n+\n+    private final String operationPrefix;\n+    private final ContextSnapshot contextSnapshot;\n+\n+    protected TracingServerCall(ServerCall<REQUEST, RESPONSE> delegate, ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(delegate.getMethodDescriptor()) + SERVER;\n+        this.contextSnapshot = contextSnapshot;\n+    }\n+\n+    @Override\n+    public void sendMessage(RESPONSE message) {\n+        // We just create the request on message span for server stream calls.\n+        if (!getMethodDescriptor().getType().serverSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                super.sendMessage(message);\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.sendMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void close(Status status, Metadata trailers) {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_CLOSE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+\n+            switch (status.getCode()) {\n+                case OK:\n+                    break;\n+                // UNKNOWN/INTERNAL status code will case error in this span.\n+                // Those status code means some unexpected error occurred in server.\n+                // Similar to 5XX in HTTP status.\n+                case UNKNOWN:\n+                case INTERNAL:\n+                    if (status.getCause() == null) {\n+                        span.errorOccurred().log(status.asRuntimeException());\n+                    } else {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+                // Other status code means some predictable error occurred in server.\n+                // Like PERMISSION_DENIED or UNAUTHENTICATED somethings.\n+                // Similar to 4XX in HTTP status.\n+                default:\n+                    // But if the status still has cause exception, we will log it too.\n+                    if (status.getCause() != null) {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+            }\n+            Tags.STATUS_CODE.set(span, status.getCode().name());\n+        } catch (Throwable t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c601e1d53e11d5d50b877d8ce93088f6a4d10a01"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0ODIxNA==", "bodyText": "Please follow the next comment.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371648214", "createdAt": "2020-01-28T07:49:27Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCall.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCall;\n+import io.grpc.Metadata;\n+import io.grpc.ServerCall;\n+import io.grpc.Status;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.tag.Tags;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCall<REQUEST, RESPONSE> extends ForwardingServerCall.SimpleForwardingServerCall<REQUEST, RESPONSE> {\n+\n+    private final String operationPrefix;\n+    private final ContextSnapshot contextSnapshot;\n+\n+    protected TracingServerCall(ServerCall<REQUEST, RESPONSE> delegate, ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(delegate.getMethodDescriptor()) + SERVER;\n+        this.contextSnapshot = contextSnapshot;\n+    }\n+\n+    @Override\n+    public void sendMessage(RESPONSE message) {\n+        // We just create the request on message span for server stream calls.\n+        if (!getMethodDescriptor().getType().serverSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);\n+                throw t;\n+            } finally {\n+                super.sendMessage(message);\n+                ContextManager.stopSpan();\n+            }\n+        } else {\n+            super.sendMessage(message);\n+        }\n+    }\n+\n+    @Override\n+    public void close(Status status, Metadata trailers) {\n+        try {\n+            final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + RESPONSE_ON_CLOSE_OPERATION_NAME);\n+            span.setComponent(ComponentsDefine.GRPC);\n+            span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+            ContextManager.continued(contextSnapshot);\n+\n+            switch (status.getCode()) {\n+                case OK:\n+                    break;\n+                // UNKNOWN/INTERNAL status code will case error in this span.\n+                // Those status code means some unexpected error occurred in server.\n+                // Similar to 5XX in HTTP status.\n+                case UNKNOWN:\n+                case INTERNAL:\n+                    if (status.getCause() == null) {\n+                        span.errorOccurred().log(status.asRuntimeException());\n+                    } else {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+                // Other status code means some predictable error occurred in server.\n+                // Like PERMISSION_DENIED or UNAUTHENTICATED somethings.\n+                // Similar to 4XX in HTTP status.\n+                default:\n+                    // But if the status still has cause exception, we will log it too.\n+                    if (status.getCause() != null) {\n+                        span.errorOccurred().log(status.getCause());\n+                    }\n+                    break;\n+            }\n+            Tags.STATUS_CODE.set(span, status.getCode().name());\n+        } catch (Throwable t) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTY3Mg=="}, "originalCommit": {"oid": "c601e1d53e11d5d50b877d8ce93088f6a4d10a01"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzY5NTc1OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzo0ODoxNFrOFiblJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzo0ODoxNFrOFiblJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Nzc4MA==", "bodyText": "As I last comment, please just try/final, but not catch. I just want to guarantee our plugins would not break the original codes even our plugins have bugs.\nPlease recheck the codes based on this rule.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371647780", "createdAt": "2020-01-28T07:48:14Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/grpc-1.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/grpc/v1/server/TracingServerCallListener.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.grpc.v1.server;\n+\n+import io.grpc.ForwardingServerCallListener;\n+import io.grpc.MethodDescriptor;\n+import io.grpc.ServerCall;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.ContextSnapshot;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.context.trace.SpanLayer;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+import org.apache.skywalking.apm.plugin.grpc.v1.OperationNameFormatUtil;\n+\n+import static org.apache.skywalking.apm.plugin.grpc.v1.Constants.*;\n+\n+/**\n+ * @author wang zheng, kanro\n+ */\n+public class TracingServerCallListener<REQUEST> extends ForwardingServerCallListener.SimpleForwardingServerCallListener<REQUEST> {\n+\n+    private final ContextSnapshot contextSnapshot;\n+    private final MethodDescriptor.MethodType methodType;\n+    private final String operationPrefix;\n+\n+    protected TracingServerCallListener(ServerCall.Listener<REQUEST> delegate, MethodDescriptor<REQUEST, ?> descriptor,\n+                                        ContextSnapshot contextSnapshot) {\n+        super(delegate);\n+        this.contextSnapshot = contextSnapshot;\n+        this.methodType = descriptor.getType();\n+        this.operationPrefix = OperationNameFormatUtil.formatOperationName(descriptor) + SERVER;\n+    }\n+\n+    @Override\n+    public void onMessage(REQUEST message) {\n+        // We just create the request on message span for client stream calls.\n+        if (!methodType.clientSendsOneMessage()) {\n+            try {\n+                final AbstractSpan span = ContextManager.createLocalSpan(operationPrefix + REQUEST_ON_MESSAGE_OPERATION_NAME);\n+                span.setComponent(ComponentsDefine.GRPC);\n+                span.setLayer(SpanLayer.RPC_FRAMEWORK);\n+                ContextManager.continued(contextSnapshot);\n+            } catch (Throwable t) {\n+                ContextManager.activeSpan().errorOccurred().log(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c601e1d53e11d5d50b877d8ce93088f6a4d10a01"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzgzNjQ2OnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODo0ODoxNFrOFic5xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMzoxOToxNVrOFi7jqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTQ0NA==", "bodyText": "Why do these two use different formats? I know they may be right but it seems strange.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371669444", "createdAt": "2020-01-28T08:48:14Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 648}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcxNzg0Ng==", "bodyText": "Why do these two use different formats? I know they may be right but it seems strange.\n\nWhen the span is shorter, it is a simplified format.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371717846", "createdAt": "2020-01-28T10:23:36Z", "author": {"login": "GuoDuanLZ"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTQ0NA=="}, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 648}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3NzE3OA==", "bodyText": "Could you follow the same pattern? I prefer we keep this consistent same in all test cases.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371777178", "createdAt": "2020-01-28T12:39:08Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTQ0NA=="}, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 648}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE3MTY5MA==", "bodyText": "Could you follow the same pattern? I prefer we keep this consistent same in all test cases.\n\nYes, of course.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r372171690", "createdAt": "2020-01-29T03:19:15Z", "author": {"login": "GuoDuanLZ"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTQ0NA=="}, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 648}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzgzNjkzOnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODo0ODoyNFrOFic6HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMDoyNDoyNVrOFif4fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTUzMg==", "bodyText": "This one too.", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371669532", "createdAt": "2020-01-28T08:48:24Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,\n+       parentSpanId: 2, spanId: 4, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 2\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlockingError.sayHello/client/Request/onComplete, operationId: 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 665}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcxODI2OQ==", "bodyText": "This one too.\n\nThis same as above", "url": "https://github.com/apache/skywalking/pull/4177#discussion_r371718269", "createdAt": "2020-01-28T10:24:25Z", "author": {"login": "GuoDuanLZ"}, "path": "test/plugin/scenarios/grpc-scenario/config/expectedData.yaml", "diffHunk": "@@ -15,239 +15,524 @@\n # limitations under the License.\n registryItems:\n   applications:\n-    - {grpc-scenario: 2}\n+  - { grpc-scenario: 2 }\n   instances:\n-    - {grpc-scenario: 1}\n+  - { grpc-scenario: 1 }\n   operationNames:\n-    - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello,\n-                      /grpc-scenario/case/grpc-scenario]\n+  - grpc-scenario: [Greeter.sayHello, GreeterBlocking.sayHello, GreeterBlockingError.sayHello, /grpc-scenario/case/grpc-scenario]\n   heartbeat: []\n segmentItems:\n-  - applicationCode: grpc-scenario\n-    segmentSize: gt 10\n-    segments:\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: GreeterBlocking.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/server/RequestObserver/onComplete\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 1\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: GreeterBlocking.sayHello\n-            operationId: 0\n-            parentSpanId: 0\n-            spanId: 2\n-            spanLayer: RPCFramework\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 23\n-            componentName: ''\n-            isError: false\n-            spanType: Exit\n-            peer: '127.0.0.1:18080'\n-            peerId: 0\n-          - operationName: /grpc-scenario/case/grpc-scenario\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Http\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 1\n-            componentName: ''\n-            isError: false\n-            spanType: Entry\n-            peer: ''\n-            peerId: 0\n-            tags:\n-              - {key: url, value: 'http://localhost:8080/grpc-scenario/case/grpc-scenario'}\n-              - {key: http.method, value: GET}\n-      - segmentId: not null\n-        spans:\n-          - operationName: Greeter.sayHello/client/ResponseObserver/onNext\n-            operationId: 0\n-            parentSpanId: -1\n-            spanId: 0\n-            spanLayer: Unknown\n-            startTime: nq 0\n-            endTime: nq 0\n-            componentId: 0\n-            componentName: ''\n-            isError: false\n-            spanType: Local\n-            peer: ''\n-            peerId: 0\n-            refs:\n-              - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n-                 entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n-                 parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n-                 entryServiceInstanceId: 1}\n-\n+- applicationCode: grpc-scenario\n+  segmentSize: gt 10\n+  segments:\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 2, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlocking.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: OK }\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlocking.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlocking.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onMessage\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - {key: status_code, value: OK}\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: Greeter.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: Greeter.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onMessage\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello/client/Response/onClose\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 1, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Entry\n+      peer: ''\n+      peerId: 0\n+      refs:\n+        - {parentEndpointId: 0, parentEndpoint: /grpc-scenario/case/grpc-scenario, networkAddressId: 0,\n+           entryEndpointId: 0, refType: CrossProcess, parentSpanId: 5, parentTraceSegmentId: not null,\n+           parentServiceInstanceId: 1, networkAddress: '127.0.0.1:18080', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+           entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: GreeterBlockingError.sayHello/server/Response/onClose\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: true\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      tags:\n+      - { key: status_code, value: UNKNOWN }\n+      logs:\n+      - logEvent:\n+        - { key: event, value: error }\n+        - { key: error.kind, value: java.lang.Exception }\n+        - { key: message, value: '' }\n+        - key: stack\n+          value: not null\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+    - operationName: GreeterBlockingError.sayHello/server/Request/onComplete\n+      operationId: 0\n+      parentSpanId: -1\n+      spanId: 0\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Local\n+      peer: ''\n+      peerId: 0\n+      refs:\n+      - {parentEndpointId: 0, parentEndpoint: GreeterBlockingError.sayHello, networkAddressId: 0,\n+         entryEndpointId: 0, refType: CrossThread, parentSpanId: 0, parentTraceSegmentId: not null,\n+         parentServiceInstanceId: 1, networkAddress: '', entryEndpoint: /grpc-scenario/case/grpc-scenario,\n+         entryServiceInstanceId: 1}\n+  - segmentId: not null\n+    spans:\n+    - operationName: Greeter.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 1\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlocking.sayHello/client/Request/onComplete, operationId: 0,\n+       parentSpanId: 2, spanId: 3, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - {operationName: GreeterBlocking.sayHello/client/Response/onClose, operationId: 0,\n+       parentSpanId: 2, spanId: 4, spanLayer: RPCFramework, startTime: nq 0,\n+       endTime: nq 0, componentId: 23, componentName: '', isError: false,\n+       spanType: Local, peer: '', peerId: 0}\n+    - operationName: GreeterBlocking.sayHello\n+      operationId: 0\n+      parentSpanId: 0\n+      spanId: 2\n+      spanLayer: RPCFramework\n+      startTime: nq 0\n+      endTime: nq 0\n+      componentId: 23\n+      componentName: ''\n+      isError: false\n+      spanType: Exit\n+      peer: '127.0.0.1:18080'\n+      peerId: 0\n+    - {operationName: GreeterBlockingError.sayHello/client/Request/onComplete, operationId: 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2OTUzMg=="}, "originalCommit": {"oid": "2fae778db9b8f4f3b3244841a6f352314bc76df4"}, "originalPosition": 665}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4498, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}