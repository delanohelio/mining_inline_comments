{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzOTI3NDk3", "number": 4570, "title": "[Inventory Design Change] Remove endpoint register and endpoint inventory", "bodyText": "If you are familiar with the latest OAP core, you will know, we register id for the endpoint. But this design has the following issues\n\nThe register has low performance as it can't be run in parral even we have clustering OAP. Even worse, in the cluster mode, the register is slower\nThe ID is designed as an integer, it could be run out in some time. We don't have good idea to restore or extend it.\nEndpoint including the parameter(such as, inside the URI) is always an issue, and could only be improved in the agent plugin, but never could be fixed.\n\nThe new changes are\n\nUse EndpointTraffic to replace EndpointInventory. EndpointTraffic is a manual metrics, not a register inventory.\nID register would not happen, and service_id + base64(endpoint name) will be used as the entity id.\nEndpointTraffic also keeps the time series feature like all other metrics, so it could be removed by TTL.\nEndpointRelation follows the changes of EndpointInevntory removal. It keeps the source-service_id + base64(source endpoint name) and dest-service_id + base64(dest endpoint name).\n\n\n\nThe Endpoint_Traffic looks like this\n\n\n\nThe Endpoint* metrics, such as endpoint_sla. It is wider than before, because of entity_id format changed.", "createdAt": "2020-03-26T02:56:41Z", "url": "https://github.com/apache/skywalking/pull/4570", "merged": true, "mergeCommit": {"oid": "4474907fef809e2342b644a324da011834a55420"}, "closed": true, "closedAt": "2020-03-28T14:51:42Z", "author": {"login": "wu-sheng"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ_e_CAH2gAyMzkzOTI3NDk3OjY3NWMwYjAyYTIwNmJlMDk2NWYxNzNkYjYxMjZhNmI1OTJiZGZmMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSGe7iAFqTM4MzMxOTEyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "675c0b02a206be0965f173db6126a6b592bdff19", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/675c0b02a206be0965f173db6126a6b592bdff19", "committedDate": "2020-03-25T04:06:44Z", "message": "Finish step one, source and entity changed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f933cdd0541c11424d683d9343583b1e6d833665", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/f933cdd0541c11424d683d9343583b1e6d833665", "committedDate": "2020-03-25T07:50:36Z", "message": "Step 2, finish the basic and core DAO changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3cd1b59875ba20e2c344fa3ec377917178b0267", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e3cd1b59875ba20e2c344fa3ec377917178b0267", "committedDate": "2020-03-25T13:33:54Z", "message": "Step 3. Change all source codes of backend, and make project compiling successfully."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e78bd00ec487e55ae266f0cbe0332ba0cab2af8", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/5e78bd00ec487e55ae266f0cbe0332ba0cab2af8", "committedDate": "2020-03-26T02:46:15Z", "message": "Make startup successful and persistence works."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecbdefd52b7fb10152aeb7ac4d525e35b58c2604", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/ecbdefd52b7fb10152aeb7ac4d525e35b58c2604", "committedDate": "2020-03-26T02:56:58Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNzA0NTM0", "url": "https://github.com/apache/skywalking/pull/4570#pullrequestreview-381704534", "createdAt": "2020-03-26T05:04:37Z", "commit": {"oid": "ecbdefd52b7fb10152aeb7ac4d525e35b58c2604"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwNTowNDozN1rOF73gZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwNTowNDozN1rOF73gZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMxOTcxOQ==", "bodyText": "EndpointTraffic is not RegisterSource type, but creating InventoryIndexes needs a sequence column, which is defined in RegisterSource", "url": "https://github.com/apache/skywalking/pull/4570#discussion_r398319719", "createdAt": "2020-03-26T05:04:37Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-storage-plugin/storage-jdbc-hikaricp-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/mysql/MySQLTableInstaller.java", "diffHunk": "@@ -111,7 +111,7 @@ protected void createIndexes(JDBCHikariCPClient client, Model model) throws Stor\n             case SERVICE_INVENTORY:\n             case SERVICE_INSTANCE_INVENTORY:\n             case NETWORK_ADDRESS:\n-            case ENDPOINT_INVENTORY:\n+            case ENDPOINT_TRAFFIC:\n                 createInventoryIndexes(client, model);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecbdefd52b7fb10152aeb7ac4d525e35b58c2604"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2baff1aeed4d4455eed195f16e7f2ef50ec6021d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/2baff1aeed4d4455eed195f16e7f2ef50ec6021d", "committedDate": "2020-03-26T05:46:48Z", "message": "Fix dead codes in the MySQLTableInstaller."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f27e9b985cdbcd80c86d32886396c71112ad43c5", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/f27e9b985cdbcd80c86d32886396c71112ad43c5", "committedDate": "2020-03-26T05:56:08Z", "message": "Fix mischange."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173949e928d4d677c4e0143ba2078e2fbcd9e41f", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/173949e928d4d677c4e0143ba2078e2fbcd9e41f", "committedDate": "2020-03-26T06:24:16Z", "message": "Fix MySQL storage bootstrap error."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1dc88ee42679e136353202ae595daa5eaa0aac4", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a1dc88ee42679e136353202ae595daa5eaa0aac4", "committedDate": "2020-03-26T06:48:12Z", "message": "Rollback dependency change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93bb8a8d2c5cefefb56d199d92e68b3c9b715b98", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/93bb8a8d2c5cefefb56d199d92e68b3c9b715b98", "committedDate": "2020-03-26T06:55:39Z", "message": "Simply enable tailing logs from container no mater it's in CI or not"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7945c98f25d80a6e04c0ac50f15704378923513f", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/7945c98f25d80a6e04c0ac50f15704378923513f", "committedDate": "2020-03-26T07:35:58Z", "message": "Fix segment table issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7af8f1a922c6ac33d1e6b0873ccbe395ef9bdd13", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/7af8f1a922c6ac33d1e6b0873ccbe395ef9bdd13", "committedDate": "2020-03-26T08:37:25Z", "message": "Fix MySQL Instanller."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a60040f2720212b8f278576d425407d5d5d988", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c1a60040f2720212b8f278576d425407d5d5d988", "committedDate": "2020-03-26T12:42:39Z", "message": "Support Influxdb implementation of new endpoint traffic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aec1d9a0ec6a9d557b9daad5f7af97c75d3a6880", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/aec1d9a0ec6a9d557b9daad5f7af97c75d3a6880", "committedDate": "2020-03-26T12:43:36Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aee87e32829ea084ed56fdc2792cc44ce266a5da", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/aee87e32829ea084ed56fdc2792cc44ce266a5da", "committedDate": "2020-03-26T13:01:00Z", "message": "Set and modify timeout to 90mins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca249199325eb824a18ba0f56d74d0def7bb219", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/8ca249199325eb824a18ba0f56d74d0def7bb219", "committedDate": "2020-03-26T15:00:08Z", "message": "Remove unnecessary entity in the EndpointTraffic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97f98356e0f26fbc767106950961b1150607d911", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/97f98356e0f26fbc767106950961b1150607d911", "committedDate": "2020-03-26T15:30:48Z", "message": "Fix wrong entity builder and make name more clear."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c376daa7815580462c4644d80c04d0744030693d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c376daa7815580462c4644d80c04d0744030693d", "committedDate": "2020-03-26T23:39:22Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac4615216ed731c8adaec7e4d32f0d921764d51", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/fac4615216ed731c8adaec7e4d32f0d921764d51", "committedDate": "2020-03-27T00:45:14Z", "message": "Fix 2 equal methods bug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c08f7d7dcc3a10beeda78f3995f2b197e2e4b006", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c08f7d7dcc3a10beeda78f3995f2b197e2e4b006", "committedDate": "2020-03-27T05:25:12Z", "message": "Fix InfluxDB identifier(name) conflict issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2330179482f372e81ff4a01db8bd79a69d3ce17a", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/2330179482f372e81ff4a01db8bd79a69d3ce17a", "committedDate": "2020-03-27T05:27:36Z", "message": "Fix endpoint topology query, endpoint id should be changed as a string."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4160e2c1fa43e1eb601efb978b6c1fb6e425f73", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a4160e2c1fa43e1eb601efb978b6c1fb6e425f73", "committedDate": "2020-03-27T05:44:25Z", "message": "Fix a missing change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "906cd37e1a155987bf7b250a2ba8d8167f8ea6ba", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/906cd37e1a155987bf7b250a2ba8d8167f8ea6ba", "committedDate": "2020-03-27T05:53:16Z", "message": "Fix a wrong commit."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a660ee3c9744a52ec647a32798ce682a4da948df", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a660ee3c9744a52ec647a32798ce682a4da948df", "committedDate": "2020-03-27T06:23:27Z", "message": "Column name can't be changed, due to it affect the hybrid metadb(h2/mysql) query, change it explicitly with double quotation marks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42587752db76caf7a6e1a805938fe8df1fe03c23", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/42587752db76caf7a6e1a805938fe8df1fe03c23", "committedDate": "2020-03-27T06:32:17Z", "message": "Fix formats."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "213cb02f86204c0ce3c69a699b2661559fccf9a7", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/213cb02f86204c0ce3c69a699b2661559fccf9a7", "committedDate": "2020-03-27T06:56:12Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92aad8c989e11836ff3d96e85bccaf45a8ae4536", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/92aad8c989e11836ff3d96e85bccaf45a8ae4536", "committedDate": "2020-03-27T07:48:37Z", "message": "Remove endpoint/operation register from the agent. and change the plugin tests(without local tests). operationId relation codes have been removed from agent too."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09f0a744496e05049df531e99423fb249c5bfa44", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/09f0a744496e05049df531e99423fb249c5bfa44", "committedDate": "2020-03-27T08:11:51Z", "message": "Try to fix the hytrix case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29a4fdc7bf191ca68719c953eba814a27aed4eb", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e29a4fdc7bf191ca68719c953eba814a27aed4eb", "committedDate": "2020-03-27T08:42:06Z", "message": "Fix 3 cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e93f3bd2555c8abdd61925c4419419f4a3adca21", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e93f3bd2555c8abdd61925c4419419f4a3adca21", "committedDate": "2020-03-27T09:04:06Z", "message": "Try to fix cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "261a8b50a31282095ba868fa33c371182a27af72", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/261a8b50a31282095ba868fa33c371182a27af72", "committedDate": "2020-03-27T09:29:21Z", "message": "Fix 2."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "695544c6e923b1077b3e8cb5cf7f81d1ebc0f74b", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/695544c6e923b1077b3e8cb5cf7f81d1ebc0f74b", "committedDate": "2020-03-27T09:56:35Z", "message": "Fix one."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9736ba940761ed9430a588b148f54f1bf04cd8d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c9736ba940761ed9430a588b148f54f1bf04cd8d", "committedDate": "2020-03-27T13:51:17Z", "message": "Fix the serviceId type mis-change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e4bce142812b578e71d086662a21690265b113", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/89e4bce142812b578e71d086662a21690265b113", "committedDate": "2020-03-27T14:43:28Z", "message": "Fix int query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "482f842531864311bf952e9e627aff6290cb5304", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/482f842531864311bf952e9e627aff6290cb5304", "committedDate": "2020-03-27T14:46:12Z", "message": "Fix hystrix case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "272ef5a3218fbb7ab46c45bba7da4a14b0f010f1", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/272ef5a3218fbb7ab46c45bba7da4a14b0f010f1", "committedDate": "2020-03-27T15:10:56Z", "message": "Fix a case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dfb9b7309ff38533f7602d7bc55ab0a4761b919", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/5dfb9b7309ff38533f7602d7bc55ab0a4761b919", "committedDate": "2020-03-27T15:45:31Z", "message": "Fix EndpointCallRelationDispatcher set the source/dest endpoint without id encoding."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3723c3befe84caf8a14e463dea74b2acca663507", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/3723c3befe84caf8a14e463dea74b2acca663507", "committedDate": "2020-03-27T22:35:57Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7abb1326f0c1ea5bbc919308958af27cf962335f", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/7abb1326f0c1ea5bbc919308958af27cf962335f", "committedDate": "2020-03-28T01:14:06Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfe303918e0744927836637edd2f2eaa100fdf63", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/bfe303918e0744927836637edd2f2eaa100fdf63", "committedDate": "2020-03-28T06:40:04Z", "message": "Merge branch 'master' into remove-endpoint-register"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d30f15564f2326f7435fa1701371e1c769002d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/06d30f15564f2326f7435fa1701371e1c769002d", "committedDate": "2020-03-28T06:41:51Z", "message": "Update documentation and add 2 test cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzE5MTI2", "url": "https://github.com/apache/skywalking/pull/4570#pullrequestreview-383319126", "createdAt": "2020-03-28T14:49:56Z", "commit": {"oid": "06d30f15564f2326f7435fa1701371e1c769002d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2492, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}