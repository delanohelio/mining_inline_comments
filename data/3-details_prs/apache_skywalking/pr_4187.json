{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTM4ODA5", "number": 4187, "title": "Fix plugin bug when Dubbo retries", "bodyText": "Please answer these questions before submitting pull request\n\nWhy submit this pull request?\n Bug fix\n\nDubbo plugin will have the following problems when retrying:\nIf the current link is triggered by other components that are not monitored, and it does not have EntrySpan, the stackDepth of the link is 0 when the dubbo is called internally. The traceId generated by the call is different. however, if the dubbo call timeout and retry, the traceId is the same, because the sw3 parameter of the last call is reused. In this scenario, The effect of multiple dubbo calls and dubbo retry should be the same. I think the problem needs to be fixed, that is, update the value of sw3 when retrying.", "createdAt": "2020-01-06T13:17:11Z", "url": "https://github.com/apache/skywalking/pull/4187", "merged": true, "mergeCommit": {"oid": "c6b169544e199fdf6d8e27e58b8f98897c3e7ef7"}, "closed": true, "closedAt": "2020-01-07T13:35:50Z", "author": {"login": "tzy1316106836"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABa0-ItgAH2gAyMzU5NTM4ODA5OmI5ODAzMjE0NGYzYjE5Mjk3YWVjZmZmZmEzNTgwNzg1MTNjNDg4OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4A3jZAFqTMzOTIzNzIwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b98032144f3b19297aecffffa358078513c48890", "author": {"user": {"login": "tzy1316106836", "name": null}}, "url": "https://github.com/apache/skywalking/commit/b98032144f3b19297aecffffa358078513c48890", "committedDate": "2019-06-13T06:31:28Z", "message": "Merge pull request #1 from apache/master\n\nupdate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83936563679a92bf6ede662fa924f3da377d260b", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/83936563679a92bf6ede662fa924f3da377d260b", "committedDate": "2019-06-13T07:09:45Z", "message": "fix potential NullPointerException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae509f09a14fe16a749b861bd49d4bc4dcaa2cb1", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/ae509f09a14fe16a749b861bd49d4bc4dcaa2cb1", "committedDate": "2019-06-13T08:57:01Z", "message": "Revert \"fix potential NullPointerException\"\n\nThis reverts commit 8393656"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "507cdd6e2060cfb338f178821b25f47587cafa9f", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/507cdd6e2060cfb338f178821b25f47587cafa9f", "committedDate": "2019-06-13T09:00:36Z", "message": "fix potential NullPointerException\nthe static paramater is best to use the class to reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac66b5cffbb8d749f100d5c62785e4376bebe8e", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/2ac66b5cffbb8d749f100d5c62785e4376bebe8e", "committedDate": "2019-06-13T09:13:51Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d01b8e2d8c734c87430d7ca6f68306fe4e1bdc9", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/1d01b8e2d8c734c87430d7ca6f68306fe4e1bdc9", "committedDate": "2019-06-13T10:46:45Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37cd15d3f8aa5ae1a5bc91ea3b57cd37a3797f8b", "author": {"user": {"login": "tzy1316106836", "name": null}}, "url": "https://github.com/apache/skywalking/commit/37cd15d3f8aa5ae1a5bc91ea3b57cd37a3797f8b", "committedDate": "2019-06-14T02:29:03Z", "message": "Merge pull request #2 from apache/master\n\nmerge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "951da119b1599eaa542940780c991ee31194c047", "author": {"user": {"login": "tzy1316106836", "name": null}}, "url": "https://github.com/apache/skywalking/commit/951da119b1599eaa542940780c991ee31194c047", "committedDate": "2019-08-08T09:10:53Z", "message": "Merge pull request #3 from apache/master\n\npull master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5ab0cffc9cc7c1b984d8e0d32133121526f9ea3", "author": {"user": {"login": "tzy1316106836", "name": null}}, "url": "https://github.com/apache/skywalking/commit/d5ab0cffc9cc7c1b984d8e0d32133121526f9ea3", "committedDate": "2019-08-20T06:59:14Z", "message": "Merge pull request #4 from apache/master\n\nmerge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab0af08fd483672f4e0d72f210eb23de8a78c48", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/cab0af08fd483672f4e0d72f210eb23de8a78c48", "committedDate": "2020-01-06T13:08:36Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b1ad28c88c0394a673ad1d854ab3c40b1f4d0e", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/09b1ad28c88c0394a673ad1d854ab3c40b1f4d0e", "committedDate": "2020-01-06T13:12:57Z", "message": "fix dubbo plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13fa5971e51ada3c3e1efeb9351e43dee32e112", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/b13fa5971e51ada3c3e1efeb9351e43dee32e112", "committedDate": "2020-01-07T01:36:33Z", "message": "fix dubbo plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a46dd7eef11ff4b99413890e3809c0922fe9e4ad", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/a46dd7eef11ff4b99413890e3809c0922fe9e4ad", "committedDate": "2020-01-07T01:44:46Z", "message": "fix dubbo plugin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4OTk5NDUx", "url": "https://github.com/apache/skywalking/pull/4187#pullrequestreview-338999451", "createdAt": "2020-01-07T02:14:21Z", "commit": {"oid": "a46dd7eef11ff4b99413890e3809c0922fe9e4ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwMjoxNDoyMVrOFauUVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwMjoxNDoyMVrOFauUVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU2NjE2Ng==", "bodyText": "Remove should be something similar than this\n            CarrierItem next = contextCarrier.items();\n            while (next.hasNext()) {\n                next = next.next();\n                rpcContext.getAttachments().put(next.getHeadKey(), next.getHeadValue());\n            }\n\nKey is defined in there.", "url": "https://github.com/apache/skywalking/pull/4187#discussion_r363566166", "createdAt": "2020-01-07T02:14:21Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/dubbo-plugin/src/main/java/org/apache/skywalking/apm/plugin/dubbo/DubboInterceptor.java", "diffHunk": "@@ -56,6 +57,9 @@ public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allAr\n         Class<?>[] argumentsTypes, MethodInterceptResult result) throws Throwable {\n         Invoker invoker = (Invoker)allArguments[0];\n         Invocation invocation = (Invocation)allArguments[1];\n+        if (invocation.getAttachments().containsKey(SW3CarrierItem.HEADER_NAME)) {\n+            invocation.getAttachments().remove(SW3CarrierItem.HEADER_NAME);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46dd7eef11ff4b99413890e3809c0922fe9e4ad"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cedf0322ea24f23583c9b464ac88246f7325c1cc", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/cedf0322ea24f23583c9b464ac88246f7325c1cc", "committedDate": "2020-01-07T06:56:37Z", "message": "fix dubbo plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5e88fdcb9ca3713f46263ebc8961b82d81de19", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/1f5e88fdcb9ca3713f46263ebc8961b82d81de19", "committedDate": "2020-01-07T06:59:43Z", "message": "fix dubbo plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fb00e72bbda612cbb58e682bd00469faeae6ce1", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/2fb00e72bbda612cbb58e682bd00469faeae6ce1", "committedDate": "2020-01-07T07:33:39Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MjI0MTY2", "url": "https://github.com/apache/skywalking/pull/4187#pullrequestreview-339224166", "createdAt": "2020-01-07T13:09:25Z", "commit": {"oid": "2fb00e72bbda612cbb58e682bd00469faeae6ce1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MjM3MjAy", "url": "https://github.com/apache/skywalking/pull/4187#pullrequestreview-339237202", "createdAt": "2020-01-07T13:35:22Z", "commit": {"oid": "2fb00e72bbda612cbb58e682bd00469faeae6ce1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2542, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}