{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NTAxNDY3", "number": 5915, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyMzo0NlrOE-Ib9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyNzo1N1rOE-Idng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTg1Mzk3OnYy", "diffSide": "RIGHT", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyMzo0NlrOH7LQDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxMDo0ODo1MlrOH7YRMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw==", "bodyText": "From https://en.wikipedia.org/wiki/Histogram#Mathematical_definition, there are two types of histogram bin:\n\nCumulative: prometheus, otel.\nOrdinary: agent meter.\n\nLet's provide two functions to set it, and defaults to cumulative.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812367", "createdAt": "2020-11-28T00:23:46Z", "author": {"login": "hanahmily"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMzU2OA==", "bodyText": "What I mean is histogramDecrease is not clear and very confusing to ppl. Let's opt for the notions that is well-known for ppl.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531813568", "createdAt": "2020-11-28T00:35:09Z", "author": {"login": "hanahmily"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw=="}, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNTY0OQ==", "bodyText": "Created HistogramType enum to adapt this.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r532025649", "createdAt": "2020-11-28T10:48:52Z", "author": {"login": "mrproliu"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw=="}, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTg1ODIyOnYy", "diffSide": "RIGHT", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwMDoyNzo1N1rOH7LSDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxMDo0OTo0NlrOH7YRiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjg3Nw==", "bodyText": "My preference is to add a new factory to build SampleFamily with those two settings. If we define functions in SampleFamily, that means end-users could access them, that will cause some potential issues.\nand they represent the different behaviors of the eco-system, I don't find any reason to access them in a MAL expression.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812877", "createdAt": "2020-11-28T00:27:57Z", "author": {"login": "hanahmily"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {\n+        this.context.ignoreHistogramDecrease = true;\n+        return this;\n+    }\n+\n+    /**\n+     * Change default histogram bucket value unit,\n+     * use second on the Prometheus, use millisecond on the meter side meter\n+     */\n+    public SampleFamily defaultHistogramBucketUnit(TimeUnit unit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNTczOQ==", "bodyText": "Have created SampleFactoryBuilder to help create SampleFactory with these two settings.", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r532025739", "createdAt": "2020-11-28T10:49:46Z", "author": {"login": "mrproliu"}, "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {\n+        this.context.ignoreHistogramDecrease = true;\n+        return this;\n+    }\n+\n+    /**\n+     * Change default histogram bucket value unit,\n+     * use second on the Prometheus, use millisecond on the meter side meter\n+     */\n+    public SampleFamily defaultHistogramBucketUnit(TimeUnit unit) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjg3Nw=="}, "originalCommit": {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4629, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}