{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODU1MDY5", "number": 5669, "title": "Support Nacos auth", "bodyText": "Please answer these questions before submitting a pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\nresolved #5665\n\n\n\nBug fix\n\nBug description.\nNacos auth method\nHow to fix?\n\n\nNew feature or improvement\n\nDescribe the details and related test reports.", "createdAt": "2020-10-15T06:16:55Z", "url": "https://github.com/apache/skywalking/pull/5669", "merged": true, "mergeCommit": {"oid": "d5a28baa65be71ba30b33ce06419ae7880dc272b"}, "closed": true, "closedAt": "2020-10-16T06:46:54Z", "author": {"login": "xbkaishui"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSrlbIAH2gAyNTAzODU1MDY5OmZkYzY4Mzc5Nzc1OTQ2YjBmZDc3ZGUyZGQ4YTE3YTdmZDIyMTkyYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS_2POAH2gAyNTAzODU1MDY5Ojg1MzhjNzE1ZWEwZjhmZTVlZTk0ZTIyODU0NzQxNDY0ODYxYzAzMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdc68379775946b0fd77de2dd8a17a7fd22192c7", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/fdc68379775946b0fd77de2dd8a17a7fd22192c7", "committedDate": "2020-10-15T06:14:40Z", "message": "Support Nacos auth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDYyODYz", "url": "https://github.com/apache/skywalking/pull/5669#pullrequestreview-509062863", "createdAt": "2020-10-15T06:45:06Z", "commit": {"oid": "fdc68379775946b0fd77de2dd8a17a7fd22192c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c4a9b53a6d90d587efbda3ff3ac98d0a756d564", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/7c4a9b53a6d90d587efbda3ff3ac98d0a756d564", "committedDate": "2020-10-15T07:34:59Z", "message": "update nacos configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/fd789fa82c15a061655f30fd3b318e5aad7ee953", "committedDate": "2020-10-15T15:54:37Z", "message": "Test nacos with default username nacos"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTQxNTI4", "url": "https://github.com/apache/skywalking/pull/5669#pullrequestreview-509941528", "createdAt": "2020-10-16T00:46:23Z", "commit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NjoyM1rOHigXMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NjoyM1rOHigXMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0Mzg1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  # Nacos auth username\n          \n          \n            \n                username: 'nacos'\n          \n          \n            \n                # Nacos auth username\n          \n          \n            \n                username: 'nacos'", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r505943859", "createdAt": "2020-10-16T00:46:23Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-configuration/configuration-nacos/src/test/resources/application.yml", "diffHunk": "@@ -33,3 +33,9 @@ configuration:\n     period: 1\n     # the name of current cluster, set the name if you want to upstream system known.\n     clusterName: \"default\"\n+      # Nacos auth username\n+    username: 'nacos'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTQxNzM2", "url": "https://github.com/apache/skywalking/pull/5669#pullrequestreview-509941736", "createdAt": "2020-10-16T00:47:12Z", "commit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NzoxMlrOHigYkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NzoxMlrOHigYkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDIwOQ==", "bodyText": "Should be else if?", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r505944209", "createdAt": "2020-10-16T00:47:12Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-cluster-plugin/cluster-nacos-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/nacos/ClusterModuleNacosProvider.java", "diffHunk": "@@ -63,6 +65,17 @@ public void prepare() throws ServiceNotProvidedException, ModuleStartException {\n             Properties properties = new Properties();\n             properties.put(PropertyKeyConst.SERVER_ADDR, config.getHostPort());\n             properties.put(PropertyKeyConst.NAMESPACE, config.getNamespace());\n+            if (StringUtil.isNotEmpty(config.getUsername()) && StringUtil.isNotEmpty(config.getAccessKey())) {\n+                throw new ModuleStartException(\"Nacos Auth method should choose either username or accessKey, not both\");\n+            }\n+            if (StringUtil.isNotEmpty(config.getUsername())) {\n+                properties.put(PropertyKeyConst.USERNAME, config.getUsername());\n+                properties.put(PropertyKeyConst.PASSWORD, config.getPassword());\n+            }\n+            if (StringUtil.isNotEmpty(config.getAccessKey())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTQxNzU2", "url": "https://github.com/apache/skywalking/pull/5669#pullrequestreview-509941756", "createdAt": "2020-10-16T00:47:16Z", "commit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NzoxN1rOHigYtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMDo0NzoxN1rOHigYtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDI0NQ==", "bodyText": "Should be else if?", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r505944245", "createdAt": "2020-10-16T00:47:17Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-configuration/configuration-nacos/src/main/java/org/apache/skywalking/oap/server/configuration/nacos/NacosConfigWatcherRegister.java", "diffHunk": "@@ -56,6 +58,14 @@ public NacosConfigWatcherRegister(NacosServerSettings settings) throws NacosExce\n         final Properties properties = new Properties();\n         properties.put(PropertyKeyConst.SERVER_ADDR, serverAddr + \":\" + port);\n         properties.put(PropertyKeyConst.NAMESPACE, settings.getNamespace());\n+        if (StringUtil.isNotEmpty(settings.getUsername())) {\n+            properties.put(PropertyKeyConst.USERNAME, settings.getUsername());\n+            properties.put(PropertyKeyConst.PASSWORD, settings.getPassword());\n+        }\n+        if (StringUtil.isNotEmpty(settings.getAccessKey())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "855d24423f0c526aeb68fe6e204e7572cea4708a", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/855d24423f0c526aeb68fe6e204e7572cea4708a", "committedDate": "2020-10-16T00:47:42Z", "message": "Merge branch 'master' into Nacos-support-auth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df85a51aaaae2a2f8930837b31da05ad97c5a6f", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/7df85a51aaaae2a2f8930837b31da05ad97c5a6f", "committedDate": "2020-10-16T02:50:33Z", "message": "Refactor change as cr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38162789bff1aa369a7f40ab47aebbed9d0366ad", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/38162789bff1aa369a7f40ab47aebbed9d0366ad", "committedDate": "2020-10-16T02:51:05Z", "message": "Merge remote-tracking branch 'upstream/Nacos-support-auth' into Nacos-support-auth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTc3MDI3", "url": "https://github.com/apache/skywalking/pull/5669#pullrequestreview-509977027", "createdAt": "2020-10-16T02:52:47Z", "commit": {"oid": "38162789bff1aa369a7f40ab47aebbed9d0366ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8538c715ea0f8fe5ee94e22854741464861c0312", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/8538c715ea0f8fe5ee94e22854741464861c0312", "committedDate": "2020-10-16T05:51:08Z", "message": "Merge branch 'master' into Nacos-support-auth"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1845, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}