{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMDAyMTE1", "number": 5844, "title": "add Tidb provider module.", "bodyText": "Fix #5754, #5749\n\n Add a e2e test to verify it works.\n\n\n\n\n\n Closes #5749.\n Update the CHANGES log.", "createdAt": "2020-11-14T12:42:44Z", "url": "https://github.com/apache/skywalking/pull/5844", "merged": true, "mergeCommit": {"oid": "8d164d3dd8c35cdafe683abc7fd9f4e4b530808f"}, "closed": true, "closedAt": "2020-11-22T15:28:54Z", "author": {"login": "JaredTan95"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXRRDDAH2gAyNTIxMDAyMTE1OmZlNDEzMmE5Mjg1ODNmZDhlMmMxM2ZiNTFiODlkMmEwMmZhOGE5ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfBpFWAFqTUzNjA2ODc5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fe4132a928583fd8e2c13fb51b89d2a02fa8a9fa", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/fe4132a928583fd8e2c13fb51b89d2a02fa8a9fa", "committedDate": "2020-10-29T12:24:30Z", "message": "fix transaction too large error when use TiDB as storage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2953a069a2d1409eff001eb8aef3d2f8ff092600", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/2953a069a2d1409eff001eb8aef3d2f8ff092600", "committedDate": "2020-10-29T12:46:22Z", "message": "add CHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3e3db27673b2add4c3c612892474f66a6e6e72", "author": {"user": null}, "url": "https://github.com/apache/skywalking/commit/4f3e3db27673b2add4c3c612892474f66a6e6e72", "committedDate": "2020-10-29T13:08:50Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f24f84fd9cc9deb5157045c07e80e72fce9245b", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/5f24f84fd9cc9deb5157045c07e80e72fce9245b", "committedDate": "2020-11-01T16:22:26Z", "message": "Merge branch 'master' into dev-fix-tdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b13719925753f0fcc7bfc6157f35034b739560a", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/8b13719925753f0fcc7bfc6157f35034b739560a", "committedDate": "2020-11-05T07:25:20Z", "message": "Merge branch 'master' into dev-fix-tdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "546416efe61312e89445808012e6cf45567c00db", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/546416efe61312e89445808012e6cf45567c00db", "committedDate": "2020-11-10T07:57:21Z", "message": "Merge remote-tracking branch 'origin/master' into dev-fix-tdb\n\n# Conflicts:\n#\tCHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f832a0197bace1f968187b996d1e963e302f905", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/6f832a0197bace1f968187b996d1e963e302f905", "committedDate": "2020-11-14T03:26:56Z", "message": "Merge branch 'master' into dev-fix-tdb\n\n# Conflicts:\n#\tCHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7187c7e54451547f24f82c4a555fb7b9db48765c", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/7187c7e54451547f24f82c4a555fb7b9db48765c", "committedDate": "2020-11-14T12:37:25Z", "message": "add tidb storage provider module."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTgxMTQz", "url": "https://github.com/apache/skywalking/pull/5844#pullrequestreview-530581143", "createdAt": "2020-11-14T14:23:09Z", "commit": {"oid": "7187c7e54451547f24f82c4a555fb7b9db48765c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c887749781e71370ab85af952500b301b8719622", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/c887749781e71370ab85af952500b301b8719622", "committedDate": "2020-11-15T02:32:47Z", "message": "add e2e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8171ee17612d0d67aa0a9660b2df77fac37884c7", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/8171ee17612d0d67aa0a9660b2df77fac37884c7", "committedDate": "2020-11-15T02:53:02Z", "message": "revert ui submodule."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/0926e4c32180e784a277cb4123b5ffa1abcffbc9", "committedDate": "2020-11-15T02:56:59Z", "message": "fix license."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzYyOTk5", "url": "https://github.com/apache/skywalking/pull/5844#pullrequestreview-530762999", "createdAt": "2020-11-15T03:06:26Z", "commit": {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMzowNjoyN1rOHza30g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMzowNjoyN1rOHza30g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY3OTY5OA==", "bodyText": "Why need >= minDate? What is the scenario?", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r523679698", "createdAt": "2020-11-15T03:06:27Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-storage-plugin/storage-tidb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/tidb/TiDBHistoryDeleteDAO.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.storage.plugin.jdbc.tidb;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import org.apache.skywalking.oap.server.core.storage.IHistoryDeleteDAO;\n+import org.apache.skywalking.oap.server.core.storage.model.Model;\n+import org.apache.skywalking.oap.server.library.client.jdbc.JDBCClientException;\n+import org.apache.skywalking.oap.server.library.client.jdbc.hikaricp.JDBCHikariCPClient;\n+import org.apache.skywalking.oap.server.storage.plugin.jdbc.SQLBuilder;\n+import org.joda.time.DateTime;\n+\n+public class TiDBHistoryDeleteDAO implements IHistoryDeleteDAO {\n+\n+    private final JDBCHikariCPClient client;\n+\n+    public TiDBHistoryDeleteDAO(JDBCHikariCPClient client) {\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public void deleteHistory(Model model, String timeBucketColumnName, int ttl) throws IOException {\n+        SQLBuilder dataDeleteSQL = new SQLBuilder(\"delete from \" + model.getName() + \" where \")\n+            .append(timeBucketColumnName).append(\"<= ? and \")\n+            .append(timeBucketColumnName).append(\">= ?\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "692e5529d0b03ef0a7ffcb14f7c6dc90941b5259", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/692e5529d0b03ef0a7ffcb14f7c6dc90941b5259", "committedDate": "2020-11-15T04:18:26Z", "message": "update e2e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd6562235a968fc48b2124917bdb2354d094dbc", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/6dd6562235a968fc48b2124917bdb2354d094dbc", "committedDate": "2020-11-15T05:52:08Z", "message": "update e2e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd36b362eb4e0913b4732d1b247dcf3664a154c0", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/dd36b362eb4e0913b4732d1b247dcf3664a154c0", "committedDate": "2020-11-15T06:10:57Z", "message": "update e2e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "774d9f6405ba1d813b6e6737a65e56ed7f8fd92c", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/774d9f6405ba1d813b6e6737a65e56ed7f8fd92c", "committedDate": "2020-11-15T13:54:33Z", "message": "Merge remote-tracking branch 'origin/master' into tidb_provider\n\n# Conflicts:\n#\tCHANGES.md\n#\toap-server/server-storage-plugin/storage-jdbc-hikaricp-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/h2/dao/H2HistoryDeleteDAO.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c211afdd0d85dafb162fa3eadb602681d06b8235", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/c211afdd0d85dafb162fa3eadb602681d06b8235", "committedDate": "2020-11-16T08:20:13Z", "message": "Merge branch 'master' into tidb_provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "116fba19fbc2d35996783daee167039dc565a6ee", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/116fba19fbc2d35996783daee167039dc565a6ee", "committedDate": "2020-11-18T07:50:12Z", "message": "Merge branch 'master' into tidb_provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb3a582c795df9397302ec677f883ca65666f4a3", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/eb3a582c795df9397302ec677f883ca65666f4a3", "committedDate": "2020-11-22T02:45:09Z", "message": "Fix wrong health check test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f64e9dccb4fe2bfbfea724991bdbf6af168b4b2", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/4f64e9dccb4fe2bfbfea724991bdbf6af168b4b2", "committedDate": "2020-11-22T02:45:45Z", "message": "Merge branch 'master' into tidb_provider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDIzMzkw", "url": "https://github.com/apache/skywalking/pull/5844#pullrequestreview-536023390", "createdAt": "2020-11-22T02:15:13Z", "commit": {"oid": "116fba19fbc2d35996783daee167039dc565a6ee"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMjoxNToxNFrOH3zC1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMjoxNToxNFrOH3zC1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI3MDAzOA==", "bodyText": "Remove this", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r528270038", "createdAt": "2020-11-22T02:15:14Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-storage-plugin/storage-tidb-plugin/pom.xml", "diffHunk": "@@ -0,0 +1,59 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one or more\n+  ~ contributor license agreements.  See the NOTICE file distributed with\n+  ~ this work for additional information regarding copyright ownership.\n+  ~ The ASF licenses this file to You under the Apache License, Version 2.0\n+  ~ (the \"License\"); you may not use this file except in compliance with\n+  ~ the License.  You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  ~\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>server-storage-plugin</artifactId>\n+        <groupId>org.apache.skywalking</groupId>\n+        <version>8.3.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>storage-tidb-plugin</artifactId>\n+    <packaging>jar</packaging>\n+\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>server-core</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>library-client</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>storage-jdbc-hikaricp-plugin</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+<!--        <dependency>\n+            <groupId>mysql</groupId>\n+            <artifactId>mysql-connector-java</artifactId>\n+            <version>8.0.13</version>\n+        </dependency>-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "116fba19fbc2d35996783daee167039dc565a6ee"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb1352f8dec058191bb155909b0c8464c6b8508e", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/fb1352f8dec058191bb155909b0c8464c6b8508e", "committedDate": "2020-11-22T14:25:28Z", "message": "Merge branch 'master' into tidb_provider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDY4MTM3", "url": "https://github.com/apache/skywalking/pull/5844#pullrequestreview-536068137", "createdAt": "2020-11-22T14:35:25Z", "commit": {"oid": "fb1352f8dec058191bb155909b0c8464c6b8508e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590bea76202fa8a1bb42ad4eaea8bf9ad0c9d3ee", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/590bea76202fa8a1bb42ad4eaea8bf9ad0c9d3ee", "committedDate": "2020-11-22T14:37:12Z", "message": "add tidb ttl e2e."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDY4Nzkx", "url": "https://github.com/apache/skywalking/pull/5844#pullrequestreview-536068791", "createdAt": "2020-11-22T14:43:40Z", "commit": {"oid": "590bea76202fa8a1bb42ad4eaea8bf9ad0c9d3ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1644, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}