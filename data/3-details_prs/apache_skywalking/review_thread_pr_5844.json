{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMDAyMTE1", "number": 5844, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMzowNjoyN1rOE5HGyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMjoxNToxNFrOE76rMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MzIwNzE0OnYy", "diffSide": "RIGHT", "path": "oap-server/server-storage-plugin/storage-tidb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/tidb/TiDBHistoryDeleteDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMzowNjoyN1rOHza30g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMzo1NzoyOFrOHzcVqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY3OTY5OA==", "bodyText": "Why need >= minDate? What is the scenario?", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r523679698", "createdAt": "2020-11-15T03:06:27Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-storage-plugin/storage-tidb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/tidb/TiDBHistoryDeleteDAO.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.storage.plugin.jdbc.tidb;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import org.apache.skywalking.oap.server.core.storage.IHistoryDeleteDAO;\n+import org.apache.skywalking.oap.server.core.storage.model.Model;\n+import org.apache.skywalking.oap.server.library.client.jdbc.JDBCClientException;\n+import org.apache.skywalking.oap.server.library.client.jdbc.hikaricp.JDBCHikariCPClient;\n+import org.apache.skywalking.oap.server.storage.plugin.jdbc.SQLBuilder;\n+import org.joda.time.DateTime;\n+\n+public class TiDBHistoryDeleteDAO implements IHistoryDeleteDAO {\n+\n+    private final JDBCHikariCPClient client;\n+\n+    public TiDBHistoryDeleteDAO(JDBCHikariCPClient client) {\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public void deleteHistory(Model model, String timeBucketColumnName, int ttl) throws IOException {\n+        SQLBuilder dataDeleteSQL = new SQLBuilder(\"delete from \" + model.getName() + \" where \")\n+            .append(timeBucketColumnName).append(\"<= ? and \")\n+            .append(timeBucketColumnName).append(\">= ?\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcwMzcyMw==", "bodyText": "this could be deleted.#5845", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r523703723", "createdAt": "2020-11-15T03:57:28Z", "author": {"login": "JaredTan95"}, "path": "oap-server/server-storage-plugin/storage-tidb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/tidb/TiDBHistoryDeleteDAO.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.storage.plugin.jdbc.tidb;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import org.apache.skywalking.oap.server.core.storage.IHistoryDeleteDAO;\n+import org.apache.skywalking.oap.server.core.storage.model.Model;\n+import org.apache.skywalking.oap.server.library.client.jdbc.JDBCClientException;\n+import org.apache.skywalking.oap.server.library.client.jdbc.hikaricp.JDBCHikariCPClient;\n+import org.apache.skywalking.oap.server.storage.plugin.jdbc.SQLBuilder;\n+import org.joda.time.DateTime;\n+\n+public class TiDBHistoryDeleteDAO implements IHistoryDeleteDAO {\n+\n+    private final JDBCHikariCPClient client;\n+\n+    public TiDBHistoryDeleteDAO(JDBCHikariCPClient client) {\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public void deleteHistory(Model model, String timeBucketColumnName, int ttl) throws IOException {\n+        SQLBuilder dataDeleteSQL = new SQLBuilder(\"delete from \" + model.getName() + \" where \")\n+            .append(timeBucketColumnName).append(\"<= ? and \")\n+            .append(timeBucketColumnName).append(\">= ?\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY3OTY5OA=="}, "originalCommit": {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjYyNzcwOnYy", "diffSide": "RIGHT", "path": "oap-server/server-storage-plugin/storage-tidb-plugin/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMjoxNToxNFrOH3zC1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwMjoxNToxNFrOH3zC1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI3MDAzOA==", "bodyText": "Remove this", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r528270038", "createdAt": "2020-11-22T02:15:14Z", "author": {"login": "kezhenxu94"}, "path": "oap-server/server-storage-plugin/storage-tidb-plugin/pom.xml", "diffHunk": "@@ -0,0 +1,59 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one or more\n+  ~ contributor license agreements.  See the NOTICE file distributed with\n+  ~ this work for additional information regarding copyright ownership.\n+  ~ The ASF licenses this file to You under the Apache License, Version 2.0\n+  ~ (the \"License\"); you may not use this file except in compliance with\n+  ~ the License.  You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  ~\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>server-storage-plugin</artifactId>\n+        <groupId>org.apache.skywalking</groupId>\n+        <version>8.3.0-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <artifactId>storage-tidb-plugin</artifactId>\n+    <packaging>jar</packaging>\n+\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>server-core</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>library-client</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>storage-jdbc-hikaricp-plugin</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+<!--        <dependency>\n+            <groupId>mysql</groupId>\n+            <artifactId>mysql-connector-java</artifactId>\n+            <version>8.0.13</version>\n+        </dependency>-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "116fba19fbc2d35996783daee167039dc565a6ee"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4780, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}