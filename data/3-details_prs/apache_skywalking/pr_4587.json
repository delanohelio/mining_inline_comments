{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MTgzNDg1", "number": 4587, "title": "OAP Core polish, especially storage level", "bodyText": "There are a lot of if/else codes due to the differences of the storages, but I plan to merge them in a more elegance and consistent way.\n\nAdd length definition with reasonable default value.\ncontent of @Column has been renamed to storageOnly . I add this to many fields as they are not being query in any case.\nMerge H2 and MySQL columntype mapping back to consistent.\nRemove @IDColumn.\nSupport @QueryUnifiedIndex.\nRefactor the MySQL and H2 installers to use @Column and @QueryUnifiedIndex definitions to create indices automatically. But the index naming rule has been changed to entityseqIDX. seq is the Increment Interger for every entity.\nSupport @MetricsExtension and insertOnly in the MetricsPersistentWorker worker.\nOptimize MetricsStreamProcessor", "createdAt": "2020-03-29T02:01:19Z", "url": "https://github.com/apache/skywalking/pull/4587", "merged": true, "mergeCommit": {"oid": "e55073e51970ecb50d014094e4e9b8dcc7d8c0d9"}, "closed": true, "closedAt": "2020-03-30T10:56:27Z", "author": {"login": "wu-sheng"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSQCq5gH2gAyMzk1MTgzNDg1OjQ3OTg5ODNjNGY3M2U2ZDUyYjVhNmY4NWEzNTNjOGIxNzc2MzYzYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSrjw3AFqTM4MzcwMzkwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4798983c4f73e6d52b5a6f85a353c8b1776363c9", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/4798983c4f73e6d52b5a6f85a353c8b1776363c9", "committedDate": "2020-03-29T01:58:07Z", "message": "1. Add length definition with reasonable default value.\n2. Merge H2 and MySQL columntype mapping back to consistent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d7a94481ee2350ba6392e5bc2234228341cc77a", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/8d7a94481ee2350ba6392e5bc2234228341cc77a", "committedDate": "2020-03-29T02:08:27Z", "message": "Fix code style."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4afc9c6d088cc570cc01b37c694f1a8a395dfa", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/db4afc9c6d088cc570cc01b37c694f1a8a395dfa", "committedDate": "2020-03-29T03:00:55Z", "message": "Fix bootstrap issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a381393f6b547c797a43283f909ca97d02b505", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/90a381393f6b547c797a43283f909ca97d02b505", "committedDate": "2020-03-29T03:34:21Z", "message": "Remove @IDColumn, we are using object#equals now."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943f3e4577d41f53c103a70b1391bc329284abac", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/943f3e4577d41f53c103a70b1391bc329284abac", "committedDate": "2020-03-29T07:58:22Z", "message": "1. Support @QueryUnifiedIndex.\n2. Refactor the MySQL and H2 installers to use @Column and @QueryUnifiedIndex definitions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b48db51e8b44c33a5a25d5436f7b0402fef4d7", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/84b48db51e8b44c33a5a25d5436f7b0402fef4d7", "committedDate": "2020-03-29T08:36:47Z", "message": "Fix index name too long. Remove the old index naming rule."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c44975e11923ed2c8d4b3024d621cca6c1af91d1", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c44975e11923ed2c8d4b3024d621cca6c1af91d1", "committedDate": "2020-03-29T10:04:12Z", "message": "Fix issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a60c7d44592d8be801e24e33ddcbe5815201e8c6", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a60c7d44592d8be801e24e33ddcbe5815201e8c6", "committedDate": "2020-03-29T11:11:34Z", "message": "Update H2TableInstaller.java\n\nFix a wrong deletion."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab811837e6a570cef01190daded3e96fc25d1505", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/ab811837e6a570cef01190daded3e96fc25d1505", "committedDate": "2020-03-29T13:02:57Z", "message": "Rename StorageDataType to StorageDataComplexObject"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc3f2413b5e145f36e5607c1573154aea4b3bfb", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/5dc3f2413b5e145f36e5607c1573154aea4b3bfb", "committedDate": "2020-03-29T15:10:13Z", "message": "Support @MetricsExtension and insertOnly in the MetricsPersistentWorker worker."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bfaa8e9c0ab0d140d7ff8ed95e08d6241c1043d", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/7bfaa8e9c0ab0d140d7ff8ed95e08d6241c1043d", "committedDate": "2020-03-29T15:38:39Z", "message": "Fix bootstrap NPE issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "254c3e10b879138b00438924a40ef3206c4f166a", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/254c3e10b879138b00438924a40ef3206c4f166a", "committedDate": "2020-03-30T01:57:26Z", "message": "Fix MetricsExtension#insertOnly bug and optimize MetricsStreamProcessor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c81fe4873743b0f8ad1383ec5846222134214bf8", "committedDate": "2020-03-30T02:05:48Z", "message": "Fix code style."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f0eeb8a61e1316e2fa7031a984a4372e41d4cac", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/4f0eeb8a61e1316e2fa7031a984a4372e41d4cac", "committedDate": "2020-03-30T02:43:15Z", "message": "Remove unnecessary comment, the endpoint_traffic has no duplicated record anymore."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTA3ODk2", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383507896", "createdAt": "2020-03-30T03:18:05Z", "commit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxODowNVrOF9YX6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoxODowNVrOF9YX6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjc5Mg==", "bodyText": "Why blank lines here?", "url": "https://github.com/apache/skywalking/pull/4587#discussion_r399906792", "createdAt": "2020-03-30T03:18:05Z", "author": {"login": "hanahmily"}, "path": "oap-server/oal-rt/src/main/java/org/apache/skywalking/oal/rt/OALRuntime.java", "diffHunk": "@@ -377,10 +376,19 @@ private Class generateDispatcherClass(String scopeName,\n              */\n             String sourceClassName = SOURCE_PACKAGE + dispatcherContext.getSource();\n             SignatureAttribute.ClassSignature dispatcherSignature = new SignatureAttribute.ClassSignature(null, null,\n-                // Set interface and its generic params\n-                new SignatureAttribute.ClassType[] {\n-                    new SignatureAttribute.ClassType(SourceDispatcher.class.getCanonicalName(), new SignatureAttribute.TypeArgument[] {new SignatureAttribute.TypeArgument(new SignatureAttribute.ClassType(sourceClassName))})\n-                });\n+                                                                                                          // Set interface and its generic params\n+                                                                                                          new SignatureAttribute.ClassType[] {\n+                                                                                                              new SignatureAttribute.ClassType(\n+                                                                                                                  SourceDispatcher.class\n+                                                                                                                      .getCanonicalName(),\n+                                                                                                                  new SignatureAttribute.TypeArgument[] {\n+                                                                                                                      new SignatureAttribute.TypeArgument(\n+                                                                                                                          new SignatureAttribute.ClassType(\n+                                                                                                                              sourceClassName))\n+                                                                                                                  }\n+                                                                                                              )\n+                                                                                                          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "originalPosition": 107}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTA4NTY0", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383508564", "createdAt": "2020-03-30T03:20:46Z", "commit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyMDo0NlrOF9YaIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyMDo0NlrOF9YaIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNzM2Mw==", "bodyText": "We should name it to supportUpdate or change the comment description. They are not identical.", "url": "https://github.com/apache/skywalking/pull/4587#discussion_r399907363", "createdAt": "2020-03-30T03:20:46Z", "author": {"login": "hanahmily"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/analysis/MetricsExtension.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.analysis;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import org.apache.skywalking.oap.server.core.analysis.worker.MetricsStreamProcessor;\n+\n+/**\n+ * MetricsExtension annotation defines extension attributes of the {@link Stream} with {@link MetricsStreamProcessor}.\n+ */\n+@Target(ElementType.TYPE)\n+@Retention(RetentionPolicy.RUNTIME)\n+public @interface MetricsExtension {\n+    /**\n+     * @return true if this metrics stream support down sampling.\n+     */\n+    boolean supportDownSampling();\n+\n+    /**\n+     * @return true if this metrics doesn't support update.\n+     */\n+    boolean insertOnly();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a64395d8c9cc55f957cc9990be45372ef7d95ee6", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a64395d8c9cc55f957cc9990be45372ef7d95ee6", "committedDate": "2020-03-30T03:26:53Z", "message": "Rename insertOnly to supportUpdate. EndpointTraffic has wrong definition before."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTA5OTAz", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383509903", "createdAt": "2020-03-30T03:26:51Z", "commit": {"oid": "4f0eeb8a61e1316e2fa7031a984a4372e41d4cac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyNjo1MVrOF9Ye4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyNjo1MVrOF9Ye4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwODU3OA==", "bodyText": "I suggest the storageOnly default is true in the Column annotation? Because I think most of the columns are just for storage.", "url": "https://github.com/apache/skywalking/pull/4587#discussion_r399908578", "createdAt": "2020-03-30T03:26:51Z", "author": {"login": "mrproliu"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/storage/annotation/Column.java", "diffHunk": "@@ -55,5 +55,12 @@\n     /**\n      * The column is just saved, never used in query.\n      */\n-    boolean content() default false;\n+    boolean storageOnly() default false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f0eeb8a61e1316e2fa7031a984a4372e41d4cac"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTEwNDI1", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383510425", "createdAt": "2020-03-30T03:29:07Z", "commit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyOTowN1rOF9Yg3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMzoyOTowN1rOF9Yg3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwOTA4NQ==", "bodyText": "We can simplify them with System.arraycopy", "url": "https://github.com/apache/skywalking/pull/4587#discussion_r399909085", "createdAt": "2020-03-30T03:29:07Z", "author": {"login": "hanahmily"}, "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/storage/model/ExtraQueryIndex.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.storage.model;\n+\n+import lombok.Getter;\n+import org.apache.skywalking.oap.server.library.util.CollectionUtils;\n+\n+/**\n+ * The extra query index if the storage could support this mode. Many NO-SQL support one column index only, in that\n+ * case, this could be ignored in the implementation level.\n+ */\n+@Getter\n+public class ExtraQueryIndex {\n+    private String[] columns;\n+\n+    public ExtraQueryIndex(String mainColumn, final String[] withColumns) {\n+        if (CollectionUtils.isNotEmpty(withColumns)) {\n+            this.columns = new String[withColumns.length + 1];\n+            for (int i = 0; i < columns.length; i++) {\n+                if (i == 0) {\n+                    columns[i] = mainColumn;\n+                } else {\n+                    columns[i] = withColumns[i - 1];\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c81fe4873743b0f8ad1383ec5846222134214bf8"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66acbcacf145d9e4e2bb99a0c182c6ffcd89cf14", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/66acbcacf145d9e4e2bb99a0c182c6ffcd89cf14", "committedDate": "2020-03-30T06:31:12Z", "message": "Adopt System.arraycopy."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a168c4f03a551287569b6e957010e19e530f8043", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/a168c4f03a551287569b6e957010e19e530f8043", "committedDate": "2020-03-30T06:53:10Z", "message": "Merge branch 'master' into core-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c14d019adb2dcf6bf816ca91de61a7af98a2f724", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/c14d019adb2dcf6bf816ca91de61a7af98a2f724", "committedDate": "2020-03-30T09:05:04Z", "message": "Some trivial polishes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjYwNzA4", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383660708", "createdAt": "2020-03-30T09:05:46Z", "commit": {"oid": "c14d019adb2dcf6bf816ca91de61a7af98a2f724"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzAzOTAx", "url": "https://github.com/apache/skywalking/pull/4587#pullrequestreview-383703901", "createdAt": "2020-03-30T10:01:42Z", "commit": {"oid": "c14d019adb2dcf6bf816ca91de61a7af98a2f724"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2499, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}