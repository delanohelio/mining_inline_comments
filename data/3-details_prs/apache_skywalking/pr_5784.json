{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NzEwOTAz", "number": 5784, "title": "Cluster manager health v2", "bodyText": "Closes #5633 add health check for cluster manager\n Update the CHANGES log.", "createdAt": "2020-11-03T12:48:35Z", "url": "https://github.com/apache/skywalking/pull/5784", "merged": true, "mergeCommit": {"oid": "56fe8a4b41236dd826f4ede97cd25b435d062803"}, "closed": true, "closedAt": "2020-11-04T02:04:24Z", "author": {"login": "xbkaishui"}, "timelineItems": {"totalCount": 66, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSSgKzAH2gAyNTE0NzEwOTAzOjEwN2ZkZTIzZjNlZGYxZGU1YTRkNzg1NTg4ODRjYzQ0NzRkMjgzMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY7LmMgFqTUyMjYzMjI0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "107fde23f3edf1de5a4d78558884cc4474d28322", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/107fde23f3edf1de5a4d78558884cc4474d28322", "committedDate": "2020-10-14T01:01:18Z", "message": "Add health checker for cluster management module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd81afa75da8c69ce853aff301553e95c946bee", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/6bd81afa75da8c69ce853aff301553e95c946bee", "committedDate": "2020-10-14T03:47:44Z", "message": "Fix test case problem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0609dce78c98fcdb8a51130c88b6331bfa7ddd9a", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/0609dce78c98fcdb8a51130c88b6331bfa7ddd9a", "committedDate": "2020-10-14T03:54:42Z", "message": "revert to core name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "078fd1890db5afaa19b1be133b32cd7ac4efe410", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/078fd1890db5afaa19b1be133b32cd7ac4efe410", "committedDate": "2020-10-14T04:09:05Z", "message": "Fix test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59e8e1e51c5685b5594aaa16b06824450c804c4d", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/59e8e1e51c5685b5594aaa16b06824450c804c4d", "committedDate": "2020-10-14T04:09:49Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "789ec8a5a2bef1119932db095bb52d5042acab4e", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/789ec8a5a2bef1119932db095bb52d5042acab4e", "committedDate": "2020-10-14T06:18:41Z", "message": "Fix test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49e3bdd7bd6c267f7e933ac1bc42f840133c9379", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/49e3bdd7bd6c267f7e933ac1bc42f840133c9379", "committedDate": "2020-10-14T06:54:43Z", "message": "Fix test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce024e5c548e4ae786445818b318eccb7a5db654", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/ce024e5c548e4ae786445818b318eccb7a5db654", "committedDate": "2020-10-15T00:57:19Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed24a79614d41a918db72d76d3b6b4a58b221601", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/ed24a79614d41a918db72d76d3b6b4a58b221601", "committedDate": "2020-10-15T04:58:48Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb0608b7475c93ff373e598e16a6852f246113fd", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/eb0608b7475c93ff373e598e16a6852f246113fd", "committedDate": "2020-10-15T05:45:03Z", "message": "Refactor change DelegatedHealthChecker to HealthCheckMetrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdc68379775946b0fd77de2dd8a17a7fd22192c7", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/fdc68379775946b0fd77de2dd8a17a7fd22192c7", "committedDate": "2020-10-15T06:14:40Z", "message": "Support Nacos auth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e92a6695f784ce79703fa20b94cc334c606a2535", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/e92a6695f784ce79703fa20b94cc334c606a2535", "committedDate": "2020-10-15T06:31:39Z", "message": "Fix test case null pointer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b85961ea107f37f05ba14e8c94b1acf2244c2374", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/b85961ea107f37f05ba14e8c94b1acf2244c2374", "committedDate": "2020-10-15T12:47:48Z", "message": "remove library client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c446772de24a6ee6d0e271cb4360497c62e89999", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c446772de24a6ee6d0e271cb4360497c62e89999", "committedDate": "2020-10-16T01:26:20Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af861b758cdf43f670b8180698fcc3943d1591bd", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/af861b758cdf43f670b8180698fcc3943d1591bd", "committedDate": "2020-10-16T09:18:50Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "691925895c146e2a0b74d566c157824876281705", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/691925895c146e2a0b74d566c157824876281705", "committedDate": "2020-10-16T09:26:20Z", "message": "fix conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a135477056b6a51c3159f678a9ccf0a9ceb8df3", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/8a135477056b6a51c3159f678a9ccf0a9ceb8df3", "committedDate": "2020-10-16T14:07:54Z", "message": "Refactor remove HealthCheckable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94de5eff6e012f53aff941383d218d882bf01f10", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/94de5eff6e012f53aff941383d218d882bf01f10", "committedDate": "2020-10-16T14:17:52Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "774a62b35210061f1dfbfb2af80bb7be8588d290", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/774a62b35210061f1dfbfb2af80bb7be8588d290", "committedDate": "2020-10-16T14:31:27Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a55dec4350f4428f357ebd24f652f3a0d21c38", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/22a55dec4350f4428f357ebd24f652f3a0d21c38", "committedDate": "2020-10-17T00:37:20Z", "message": "Add health check for localhost or 127.0.0.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412e0a204be919ca2ae8385db2fca946a0039e4b", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/412e0a204be919ca2ae8385db2fca946a0039e4b", "committedDate": "2020-10-19T10:40:20Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda402bf3b442e8c58edab11852ec20ebb983cc7", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/cda402bf3b442e8c58edab11852ec20ebb983cc7", "committedDate": "2020-10-19T10:40:35Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a132a50924940396786c39d18d5fc1d663363c4", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/1a132a50924940396786c39d18d5fc1d663363c4", "committedDate": "2020-10-19T13:15:15Z", "message": "Refactor change HealthCheckUtil to OAPNodeChecker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b7de2ef31041e53931fa09736096e8cc677f9d", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/12b7de2ef31041e53931fa09736096e8cc677f9d", "committedDate": "2020-10-20T01:07:09Z", "message": "Refactor move healthChecker to init constructor, move check duplicate addresses to OAPNodeChecker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c49dbf872c51c9c8e37088090e24b83d72f251ec", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c49dbf872c51c9c8e37088090e24b83d72f251ec", "committedDate": "2020-10-20T10:24:59Z", "message": "fix log error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c67cac5ec4a64b24644fa089cb4c49bd346ee0a", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/1c67cac5ec4a64b24644fa089cb4c49bd346ee0a", "committedDate": "2020-10-20T10:25:12Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a50a15bd71fe37801315708dcfa06b1acc1871", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/f5a50a15bd71fe37801315708dcfa06b1acc1871", "committedDate": "2020-10-20T10:25:55Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3107c49b51e868b3f30003a8d8b51fa4cce6562", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/a3107c49b51e868b3f30003a8d8b51fa4cce6562", "committedDate": "2020-10-21T08:00:09Z", "message": "refactor move all check health logic to OAPNodeChecker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "614f35118835aa3ffbab5dd0eb216c5097ece084", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/614f35118835aa3ffbab5dd0eb216c5097ece084", "committedDate": "2020-10-21T08:00:35Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c1362f88216ac9e991085aa5a30f2522e69a410", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/3c1362f88216ac9e991085aa5a30f2522e69a410", "committedDate": "2020-10-21T08:00:56Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "163810d2b39931b0f7727cca866f949119d5667a", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/163810d2b39931b0f7727cca866f949119d5667a", "committedDate": "2020-10-21T09:32:08Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c0af733b94704a782dfe3fce03a66c5a1b39a8", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/99c0af733b94704a782dfe3fce03a66c5a1b39a8", "committedDate": "2020-10-21T09:32:27Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a88fcd0923541de8139bf8bb02b1d09c7050a5c", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/6a88fcd0923541de8139bf8bb02b1d09c7050a5c", "committedDate": "2020-10-21T12:54:51Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6303ccad7d09603369c5c84090ab5579989abe09", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/6303ccad7d09603369c5c84090ab5579989abe09", "committedDate": "2020-10-21T13:03:54Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93e26982ef8e0520068405927259f9a4f2651f4f", "author": {"user": {"login": "kezhenxu94", "name": "kezhenxu94"}}, "url": "https://github.com/apache/skywalking/commit/93e26982ef8e0520068405927259f9a4f2651f4f", "committedDate": "2020-10-25T07:59:16Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3133bc8f8f882f9f618579e0af92c17bfb108aac", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/3133bc8f8f882f9f618579e0af92c17bfb108aac", "committedDate": "2020-10-26T03:22:21Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a55e261aeb4449ee353d8d57b57dcb06a51663df", "author": {"user": {"login": "1095071913", "name": "xiao mao zi"}}, "url": "https://github.com/apache/skywalking/commit/a55e261aeb4449ee353d8d57b57dcb06a51663df", "committedDate": "2020-10-26T03:23:56Z", "message": "Update powered-by.md (#5723)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d89a850f286b4f27ceeb2dcc4f0cb39efdab870a", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/d89a850f286b4f27ceeb2dcc4f0cb39efdab870a", "committedDate": "2020-10-26T03:23:56Z", "message": "Reformat ui dockerfile. (#5724)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83c94b1a3a92612bd2720c219cbec28369203026", "author": {"user": {"login": "JaredTan95", "name": "Jared Tan"}}, "url": "https://github.com/apache/skywalking/commit/83c94b1a3a92612bd2720c219cbec28369203026", "committedDate": "2020-10-26T03:23:56Z", "message": "Remove apollo default ip. (#5725)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459dacc55877564237662e458f691128a2a37ca0", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/459dacc55877564237662e458f691128a2a37ca0", "committedDate": "2020-10-26T08:50:24Z", "message": "Fix mockito class not found exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc493801495d6554fd970349f6e11fe9865c59b", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/afc493801495d6554fd970349f6e11fe9865c59b", "committedDate": "2020-10-27T09:46:54Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f59592f9f3df1e887656fcb0373efde95abf5e", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/54f59592f9f3df1e887656fcb0373efde95abf5e", "committedDate": "2020-10-27T09:47:15Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d565108d883f4ae3efad96d1bfa7e91c56df46f6", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/d565108d883f4ae3efad96d1bfa7e91c56df46f6", "committedDate": "2020-10-27T12:33:51Z", "message": "fix it test fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28ffdf7b77bf701deb8eae6ee9651d7bb10087b3", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/28ffdf7b77bf701deb8eae6ee9651d7bb10087b3", "committedDate": "2020-10-28T03:29:42Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9be395e214705daeaf9288cc840ef8bde295f66", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c9be395e214705daeaf9288cc840ef8bde295f66", "committedDate": "2020-10-28T05:24:27Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0622b6c9648ecd782c9b9bdcf9e62ed402de3bd", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/c0622b6c9648ecd782c9b9bdcf9e62ed402de3bd", "committedDate": "2020-10-31T09:57:04Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "304019624ae10e2652503235ce3a8a6f5a3488bd", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/304019624ae10e2652503235ce3a8a6f5a3488bd", "committedDate": "2020-10-31T14:17:29Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70608730ae0812ebbc926eca467c79320863cc59", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/70608730ae0812ebbc926eca467c79320863cc59", "committedDate": "2020-10-31T14:26:48Z", "message": "Merge branch 'master' into cluster-manager-health"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "623ecb7f223a7f89d48526f41192cf3388bd3c33", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/623ecb7f223a7f89d48526f41192cf3388bd3c33", "committedDate": "2020-10-31T14:57:22Z", "message": "Fix dependency check bug, can't call moduleManager.find in provider prepare method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2baacc8cecce55ad8dbacb55fb493aa98c7dbb8", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/c2baacc8cecce55ad8dbacb55fb493aa98c7dbb8", "committedDate": "2020-11-01T00:54:58Z", "message": "Fix bug, null pointer exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aeb5fb7ee0c89d436bad56ee64e33dd82a71efd", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/8aeb5fb7ee0c89d436bad56ee64e33dd82a71efd", "committedDate": "2020-11-01T00:57:48Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee02c20342b0b6c28e5aad4d0b2beebccbe4d14d", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/ee02c20342b0b6c28e5aad4d0b2beebccbe4d14d", "committedDate": "2020-11-01T01:19:16Z", "message": "add change log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c23f1fd7f8b198f6b172044cb18b31c84e03505", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/4c23f1fd7f8b198f6b172044cb18b31c84e03505", "committedDate": "2020-11-01T07:08:15Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca8e01b048af37e1f25b4e35344a22729429c04", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/8ca8e01b048af37e1f25b4e35344a22729429c04", "committedDate": "2020-11-01T09:17:50Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a894ed2832e7dec6ef2780637bd018fefdcbba", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/a1a894ed2832e7dec6ef2780637bd018fefdcbba", "committedDate": "2020-11-03T10:18:41Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749093ea52f387ffc9955afb258742b849cce0c7", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/749093ea52f387ffc9955afb258742b849cce0c7", "committedDate": "2020-11-03T12:44:36Z", "message": "Refactor add unhealth reason"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90998d5dbff1f2a2d6abe39ce6f330bd47ab4fb5", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/90998d5dbff1f2a2d6abe39ce6f330bd47ab4fb5", "committedDate": "2020-11-03T12:50:18Z", "message": "Merge branch 'master' of https://github.com/apache/skywalking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/d725b2d8b2f182c43c801423b5dc34737313ddca", "committedDate": "2020-11-03T12:51:58Z", "message": "Merge branch 'master' into cluster-manager-health-v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTAwODIz", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522500823", "createdAt": "2020-11-03T13:37:52Z", "commit": {"oid": "749093ea52f387ffc9955afb258742b849cce0c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzozNzo1M1rOHsvFWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzozNzo1M1rOHsvFWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3MDgwOQ==", "bodyText": "THREAD_SAFETY_VIOLATION:  Unprotected write. Non-private method ZookeeperCoordinator.queryRemoteNodes() indirectly writes to field this.healthChecker outside of synchronization.\nReporting because another access to the same memory occurs on a background thread, although this access may not.", "url": "https://github.com/apache/skywalking/pull/5784#discussion_r516670809", "createdAt": "2020-11-03T13:37:53Z", "author": {"login": "sonatype-lift"}, "path": "oap-server/server-cluster-plugin/cluster-zookeeper-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/zookeeper/ZookeeperCoordinator.java", "diffHunk": "@@ -73,28 +85,49 @@ public synchronized void registerRemote(RemoteInstance remoteInstance) throws Se\n             serviceDiscovery.registerService(thisInstance);\n \n             this.selfAddress = remoteInstance.getAddress();\n-        } catch (Exception e) {\n+            this.healthChecker.health();\n+        } catch (Throwable e) {\n+            this.healthChecker.unHealth(e);\n             throw new ServiceRegisterException(e.getMessage());\n         }\n     }\n \n     @Override\n     public List<RemoteInstance> queryRemoteNodes() {\n-        List<RemoteInstance> remoteInstanceDetails = new ArrayList<>(20);\n-        List<ServiceInstance<RemoteInstance>> serviceInstances = serviceCache.getInstances();\n-        serviceInstances.forEach(serviceInstance -> {\n-            RemoteInstance instance = serviceInstance.getPayload();\n-            if (instance.getAddress().equals(selfAddress)) {\n-                instance.getAddress().setSelf(true);\n+        List<RemoteInstance> remoteInstances = new ArrayList<>(20);\n+        try {\n+            initHealthChecker();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "749093ea52f387ffc9955afb258742b849cce0c7"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTAwODQw", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522500840", "createdAt": "2020-11-03T13:37:54Z", "commit": {"oid": "749093ea52f387ffc9955afb258742b849cce0c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzozNzo1NFrOHsvFZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzozNzo1NFrOHsvFZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3MDgyMA==", "bodyText": "THREAD_SAFETY_VIOLATION:  Unprotected write. Non-private method ZookeeperCoordinator.setHealthChecker(...) writes to field this.healthChecker outside of synchronization.\nReporting because another access to the same memory occurs on a background thread, although this access may not.", "url": "https://github.com/apache/skywalking/pull/5784#discussion_r516670820", "createdAt": "2020-11-03T13:37:54Z", "author": {"login": "sonatype-lift"}, "path": "oap-server/server-cluster-plugin/cluster-zookeeper-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/zookeeper/ZookeeperCoordinator.java", "diffHunk": "@@ -22,29 +22,40 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.UUID;\n+\n+import lombok.Setter;\n import org.apache.curator.x.discovery.ServiceCache;\n import org.apache.curator.x.discovery.ServiceDiscovery;\n import org.apache.curator.x.discovery.ServiceInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ClusterHealthStatus;\n import org.apache.skywalking.oap.server.core.cluster.ClusterNodesQuery;\n import org.apache.skywalking.oap.server.core.cluster.ClusterRegister;\n+import org.apache.skywalking.oap.server.core.cluster.OAPNodeChecker;\n import org.apache.skywalking.oap.server.core.cluster.RemoteInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ServiceQueryException;\n import org.apache.skywalking.oap.server.core.cluster.ServiceRegisterException;\n import org.apache.skywalking.oap.server.core.remote.client.Address;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.apache.skywalking.oap.server.library.module.ModuleDefineHolder;\n+import org.apache.skywalking.oap.server.telemetry.TelemetryModule;\n+import org.apache.skywalking.oap.server.telemetry.api.HealthCheckMetrics;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsCreator;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsTag;\n \n public class ZookeeperCoordinator implements ClusterRegister, ClusterNodesQuery {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(ZookeeperCoordinator.class);\n \n     private static final String REMOTE_NAME_PATH = \"remote\";\n \n     private final ClusterModuleZookeeperConfig config;\n     private final ServiceDiscovery<RemoteInstance> serviceDiscovery;\n     private final ServiceCache<RemoteInstance> serviceCache;\n     private volatile Address selfAddress;\n+    @Setter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "749093ea52f387ffc9955afb258742b849cce0c7"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTA1NTA5", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522505509", "createdAt": "2020-11-03T13:43:23Z", "commit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzo0MzoyM1rOHsvTaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzo0MzoyM1rOHsvTaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3NDQxMQ==", "bodyText": "Move final to following other final fields in the top of the list.", "url": "https://github.com/apache/skywalking/pull/5784#discussion_r516674411", "createdAt": "2020-11-03T13:43:23Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-cluster-plugin/cluster-zookeeper-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/zookeeper/ZookeeperCoordinator.java", "diffHunk": "@@ -22,29 +22,40 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.UUID;\n+\n+import lombok.Setter;\n import org.apache.curator.x.discovery.ServiceCache;\n import org.apache.curator.x.discovery.ServiceDiscovery;\n import org.apache.curator.x.discovery.ServiceInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ClusterHealthStatus;\n import org.apache.skywalking.oap.server.core.cluster.ClusterNodesQuery;\n import org.apache.skywalking.oap.server.core.cluster.ClusterRegister;\n+import org.apache.skywalking.oap.server.core.cluster.OAPNodeChecker;\n import org.apache.skywalking.oap.server.core.cluster.RemoteInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ServiceQueryException;\n import org.apache.skywalking.oap.server.core.cluster.ServiceRegisterException;\n import org.apache.skywalking.oap.server.core.remote.client.Address;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.apache.skywalking.oap.server.library.module.ModuleDefineHolder;\n+import org.apache.skywalking.oap.server.telemetry.TelemetryModule;\n+import org.apache.skywalking.oap.server.telemetry.api.HealthCheckMetrics;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsCreator;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsTag;\n \n public class ZookeeperCoordinator implements ClusterRegister, ClusterNodesQuery {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(ZookeeperCoordinator.class);\n \n     private static final String REMOTE_NAME_PATH = \"remote\";\n \n     private final ClusterModuleZookeeperConfig config;\n     private final ServiceDiscovery<RemoteInstance> serviceDiscovery;\n     private final ServiceCache<RemoteInstance> serviceCache;\n     private volatile Address selfAddress;\n+    @Setter\n+    private HealthCheckMetrics healthChecker;\n+    private final ModuleDefineHolder manager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTA1OTU3", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522505957", "createdAt": "2020-11-03T13:43:52Z", "commit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzo0Mzo1MlrOHsvUxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzo0Mzo1MlrOHsvUxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY3NDc1Nw==", "bodyText": "You don't need the setter I think. Please don't open unnecessary access.", "url": "https://github.com/apache/skywalking/pull/5784#discussion_r516674757", "createdAt": "2020-11-03T13:43:52Z", "author": {"login": "wu-sheng"}, "path": "oap-server/server-cluster-plugin/cluster-zookeeper-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/zookeeper/ZookeeperCoordinator.java", "diffHunk": "@@ -22,29 +22,40 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.UUID;\n+\n+import lombok.Setter;\n import org.apache.curator.x.discovery.ServiceCache;\n import org.apache.curator.x.discovery.ServiceDiscovery;\n import org.apache.curator.x.discovery.ServiceInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ClusterHealthStatus;\n import org.apache.skywalking.oap.server.core.cluster.ClusterNodesQuery;\n import org.apache.skywalking.oap.server.core.cluster.ClusterRegister;\n+import org.apache.skywalking.oap.server.core.cluster.OAPNodeChecker;\n import org.apache.skywalking.oap.server.core.cluster.RemoteInstance;\n+import org.apache.skywalking.oap.server.core.cluster.ServiceQueryException;\n import org.apache.skywalking.oap.server.core.cluster.ServiceRegisterException;\n import org.apache.skywalking.oap.server.core.remote.client.Address;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.apache.skywalking.oap.server.library.module.ModuleDefineHolder;\n+import org.apache.skywalking.oap.server.telemetry.TelemetryModule;\n+import org.apache.skywalking.oap.server.telemetry.api.HealthCheckMetrics;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsCreator;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsTag;\n \n public class ZookeeperCoordinator implements ClusterRegister, ClusterNodesQuery {\n-    private static final Logger LOGGER = LoggerFactory.getLogger(ZookeeperCoordinator.class);\n \n     private static final String REMOTE_NAME_PATH = \"remote\";\n \n     private final ClusterModuleZookeeperConfig config;\n     private final ServiceDiscovery<RemoteInstance> serviceDiscovery;\n     private final ServiceCache<RemoteInstance> serviceCache;\n     private volatile Address selfAddress;\n+    @Setter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTA2ODg2", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522506886", "createdAt": "2020-11-03T13:44:53Z", "commit": {"oid": "d725b2d8b2f182c43c801423b5dc34737313ddca"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e018ecd7ecefc83f9a3be53aacc9debd1440b119", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/e018ecd7ecefc83f9a3be53aacc9debd1440b119", "committedDate": "2020-11-03T14:03:00Z", "message": "Merge branch 'master' into cluster-manager-health-v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20015a7133c33d956b497dd81771199e314a497b", "author": {"user": {"login": "xbkaishui", "name": null}}, "url": "https://github.com/apache/skywalking/commit/20015a7133c33d956b497dd81771199e314a497b", "committedDate": "2020-11-03T14:17:38Z", "message": "format checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNjMyMjQ4", "url": "https://github.com/apache/skywalking/pull/5784#pullrequestreview-522632248", "createdAt": "2020-11-03T15:48:29Z", "commit": {"oid": "20015a7133c33d956b497dd81771199e314a497b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1610, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}