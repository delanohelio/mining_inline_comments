{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NTE3NDc0", "number": 5510, "title": "Check bootstrapServers type before casting for kafka-clients >= 2.1", "bodyText": "Please answer these questions before submitting a pull request\n\n\nWhy submit this pull request?\n\n\n Bug fix\n\n\n New feature provided\n\n\n Improve performance\n\n\nRelated issues\n\n\n#4652\n#5507\n\nBug fix\nSee issues #5507 for details.\nJust check both List and String types.\n\n unit test cases added for ProducerConstructorMapInterceptor\n integration test cases: Setup producer with list-type bootstrap servers without error", "createdAt": "2020-09-17T09:02:57Z", "url": "https://github.com/apache/skywalking/pull/5510", "merged": true, "mergeCommit": {"oid": "c65bcf1142d8c19448567ee654de17aa3014cc74"}, "closed": true, "closedAt": "2020-09-18T07:18:55Z", "author": {"login": "lujiajing1126"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJsirJgH2gAyNDg4NTE3NDc0OjkwMWYwZjJjY2JmMDhjMTRjZWU1YzUyY2U3Mjk2NWNhMGE5MTZhMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ_m28gFqTQ5MTE4MjkzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "901f0f2ccbf08c14cee5c52ce72965ca0a916a02", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/901f0f2ccbf08c14cee5c52ce72965ca0a916a02", "committedDate": "2020-09-17T08:16:15Z", "message": "add unit test for ProducerConstructorMapInterceptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "865ffa85a89fe91eaef968df79cf85c971c10ee6", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/865ffa85a89fe91eaef968df79cf85c971c10ee6", "committedDate": "2020-09-17T08:40:11Z", "message": "setup another kafka template with list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a83a656874ca292a535f88f1d5383448dac9b1a9", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/a83a656874ca292a535f88f1d5383448dac9b1a9", "committedDate": "2020-09-17T09:01:55Z", "message": "fix style issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzkyNDQy", "url": "https://github.com/apache/skywalking/pull/5510#pullrequestreview-490392442", "createdAt": "2020-09-17T09:06:48Z", "commit": {"oid": "a83a656874ca292a535f88f1d5383448dac9b1a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTowNjo0OFrOHTYsUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTowNjo0OFrOHTYsUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4OTU1Mg==", "bodyText": "Once you changed this, you should change the expected data yaml to map this.", "url": "https://github.com/apache/skywalking/pull/5510#discussion_r490089552", "createdAt": "2020-09-17T09:06:48Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/spring-kafka-2.3.x-scenario/src/main/java/test/org/apache/skywalking/apm/testcase/spring/kafka/controller/CaseController.java", "diffHunk": "@@ -82,6 +85,21 @@ private void setUpProvider() {\n         }\n     }\n \n+    private void setUpAnotherProvider() {\n+        Map<String, Object> props = new HashMap<>();\n+        // use list type here\n+        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, Arrays.asList(bootstrapServers.split(\",\")));\n+        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n+        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n+        kafkaTemplate2 = new KafkaTemplate<String, String>(new DefaultKafkaProducerFactory<>(props));\n+        try {\n+            kafkaTemplate2.send(topicName, \"key\", \"ping\").get();\n+            kafkaTemplate2.flush();\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83a656874ca292a535f88f1d5383448dac9b1a9"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94a453bff46c48eba781519e5fc4b46d2a386c7c", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/94a453bff46c48eba781519e5fc4b46d2a386c7c", "committedDate": "2020-09-17T12:24:05Z", "message": "Merge branch 'master' into kafka_bootstrap_servers_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53c1222b366b7b37b42fbf8a8081fa9c2990ba75", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/53c1222b366b7b37b42fbf8a8081fa9c2990ba75", "committedDate": "2020-09-17T14:42:47Z", "message": "add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b100db02fa25d12eb1f131b015ac981ebbf88b2", "author": {"user": {"login": "wu-sheng", "name": "\u5434\u665f Wu Sheng"}}, "url": "https://github.com/apache/skywalking/commit/7b100db02fa25d12eb1f131b015ac981ebbf88b2", "committedDate": "2020-09-18T01:01:12Z", "message": "Merge branch 'master' into kafka_bootstrap_servers_type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTIzMjc2", "url": "https://github.com/apache/skywalking/pull/5510#pullrequestreview-491123276", "createdAt": "2020-09-18T03:22:25Z", "commit": {"oid": "7b100db02fa25d12eb1f131b015ac981ebbf88b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMzoyMjoyNVrOHT8l7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMzoyMjoyNVrOHT8l7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY3Nzc0Mw==", "bodyText": "Why add this comment? This interceptor is used for 2.1-, isn't it?", "url": "https://github.com/apache/skywalking/pull/5510#discussion_r490677743", "createdAt": "2020-09-18T03:22:25Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/kafka-plugin/src/main/java/org/apache/skywalking/apm/plugin/kafka/ProducerConstructorMapInterceptor.java", "diffHunk": "@@ -22,16 +22,27 @@\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceConstructorInterceptor;\n import org.apache.skywalking.apm.util.StringUtil;\n \n+import java.util.List;\n import java.util.Map;\n+import java.util.regex.Pattern;\n \n+/**\n+ * Target at kafka-clients 2.1+\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b100db02fa25d12eb1f131b015ac981ebbf88b2"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca5c9555f9e8f5898cf2f8cebac8d1ba9ce2556a", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/ca5c9555f9e8f5898cf2f8cebac8d1ba9ce2556a", "committedDate": "2020-09-18T03:59:10Z", "message": "update comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTM2NzQ4", "url": "https://github.com/apache/skywalking/pull/5510#pullrequestreview-491136748", "createdAt": "2020-09-18T04:04:09Z", "commit": {"oid": "ca5c9555f9e8f5898cf2f8cebac8d1ba9ce2556a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNDowNDowOVrOHT9UVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNDowNDowOVrOHT9UVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY4OTYyMA==", "bodyText": "Still confused what your new comments. Isn't 2.0 even 1.x client libraries using this interceptor?", "url": "https://github.com/apache/skywalking/pull/5510#discussion_r490689620", "createdAt": "2020-09-18T04:04:09Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-sdk-plugin/kafka-plugin/src/main/java/org/apache/skywalking/apm/plugin/kafka/ProducerConstructorMapInterceptor.java", "diffHunk": "@@ -22,16 +22,27 @@\n import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceConstructorInterceptor;\n import org.apache.skywalking.apm.util.StringUtil;\n \n+import java.util.List;\n import java.util.Map;\n+import java.util.regex.Pattern;\n \n+/**\n+ * Target at kafka-clients >=2.1.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca5c9555f9e8f5898cf2f8cebac8d1ba9ce2556a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "649eac99b9167829c93249bf5be8a2ac939f9243", "author": {"user": {"login": "lujiajing1126", "name": "Jiajing LU"}}, "url": "https://github.com/apache/skywalking/commit/649eac99b9167829c93249bf5be8a2ac939f9243", "committedDate": "2020-09-18T04:09:05Z", "message": "remove comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTgyOTM2", "url": "https://github.com/apache/skywalking/pull/5510#pullrequestreview-491182936", "createdAt": "2020-09-18T06:29:01Z", "commit": {"oid": "649eac99b9167829c93249bf5be8a2ac939f9243"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1688, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}