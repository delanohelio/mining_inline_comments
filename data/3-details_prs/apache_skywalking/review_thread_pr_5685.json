{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NDg0MDcy", "number": 5685, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDo1NDoyOFrOEu-M7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxMTo0ODo0N1rOE0IzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3Njg5MDcwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDo1NDoyOFrOHjrYCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDo1NDoyOFrOHjrYCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3Mjg3Mg==", "bodyText": "Why do you still try to change this? You have the tracing context, and #extract is in your control already.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507172872", "createdAt": "2020-10-18T14:54:28Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManager.java", "diffHunk": "@@ -83,23 +84,23 @@ public static AbstractSpan createEntrySpan(String operationName, ContextCarrier\n         AbstractSpan span;\n         AbstractTracerContext context;\n         operationName = StringUtil.cut(operationName, OPERATION_NAME_THRESHOLD);\n-        if (carrier != null && carrier.isValid()) {\n+        if (Objects.nonNull(carrier) && carrier.isValid()) {\n             SamplingService samplingService = ServiceManager.INSTANCE.findService(SamplingService.class);\n             samplingService.forceSampled();\n             context = getOrCreate(operationName, true);\n-            span = context.createEntrySpan(operationName);\n-            context.extract(carrier);\n         } else {\n             context = getOrCreate(operationName, false);\n-            span = context.createEntrySpan(operationName);\n         }\n-        return span;\n+        span = context.createEntrySpan(operationName);\n+        context.extract(carrier);\n+        return callback(span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a41b714d2b17154ef5a49bdc22921d6d76e05843"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3NjkyOTUxOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNTozNzowNlrOHjrqwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNTozNzowNlrOHjrqwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3NzY2NQ==", "bodyText": "NULL_DEREFERENCE:  object returned by context.getTraceSegment() could be null and is dereferenced at line 91.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507177665", "createdAt": "2020-10-18T15:37:06Z", "author": {"login": "sonatype-lift"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -79,4 +84,23 @@ public AbstractTracerContext createTraceContext(String operationName, boolean fo\n     public void statusChanged(final GRPCChannelStatus status) {\n         this.status = status;\n     }\n+\n+    public void extract(ContextCarrier carrier, AbstractTracerContext context) {\n+        if (Objects.nonNull(carrier) && carrier.isValid()) {\n+            TraceSegmentRef ref = new TraceSegmentRef(carrier);\n+            context.getTraceSegment().ref(ref);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a41b714d2b17154ef5a49bdc22921d6d76e05843"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3Nzc3MDk5OnYy", "diffSide": "RIGHT", "path": "docs/en/setup/service-agent/java-agent/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMTowNjo1MFrOHjzlaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMTowNjo1MFrOHjzlaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzMwNzM3MQ==", "bodyText": "I think these are out of update?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507307371", "createdAt": "2020-10-19T01:06:50Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -115,6 +118,10 @@ property key | Description | Default |\n `meter.max_meter_size`| Max size of the meter pool |`500`|\n `plugin.mount` | Mount the specific folders of the plugins. Plugins in mounted folders would work. | `plugins,activations` |\n `plugin.peer_max_length `|Peer maximum description limit.|`200`|\n+`plugin.extendcontextmanager.injection_tags `|These tags of the span are derived from correlations with the same name.|`\"\"`|\n+`plugin.extendcontextmanager.external_injection_switch `|The external injection switch.(Please notice the injection security)|`false`|\n+`plugin.extendcontextmanager.external_injection_key`|The correlation data which made up of external_injection_key and external_injection_token allows the other correlation data injected by external passing.|`\"sw-injection-key\"`|\n+`plugin.extendcontextmanager.external_injection_token `|The correlation data which made up of external_injection_key and external_injection_token allows the other correlation data injected by external passing.|`\"sw-injection-token\"`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f580e5b134428c8533b4e6f759e62e8ef0cd99d0"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3Nzk4NDAwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/test/java/org/apache/skywalking/apm/agent/core/context/CorrelationContextTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMTo1OTozM1rOHj18zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMTo1OTo1MVrOHj196A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM0NjEyNQ==", "bodyText": "Should be a part of BeforeTest", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507346125", "createdAt": "2020-10-19T01:59:33Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/test/java/org/apache/skywalking/apm/agent/core/context/CorrelationContextTest.java", "diffHunk": "@@ -121,4 +126,21 @@ public void testDeserialize() {\n         Assert.assertNull(context.get(\"test1\").orElse(null));\n     }\n \n+    @Test\n+    public void testHandle() {\n+        Config.Correlation.INJECTION_TAGS = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f580e5b134428c8533b4e6f759e62e8ef0cd99d0"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM0NjQwOA==", "bodyText": "Also, should be clear after test.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507346408", "createdAt": "2020-10-19T01:59:51Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/test/java/org/apache/skywalking/apm/agent/core/context/CorrelationContextTest.java", "diffHunk": "@@ -121,4 +126,21 @@ public void testDeserialize() {\n         Assert.assertNull(context.get(\"test1\").orElse(null));\n     }\n \n+    @Test\n+    public void testHandle() {\n+        Config.Correlation.INJECTION_TAGS = \"\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM0NjEyNQ=="}, "originalCommit": {"oid": "f580e5b134428c8533b4e6f759e62e8ef0cd99d0"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODA0NzE3OnYy", "diffSide": "RIGHT", "path": "docs/en/setup/service-agent/java-agent/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxMjo1NlrOHj2p-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxMjo1NlrOHj2p-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM1NzY5MQ==", "bodyText": "Duplicated.\n\nIf you want to move those two at here, please remove the previous two.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507357691", "createdAt": "2020-10-19T02:12:56Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -102,6 +102,9 @@ property key | Description | Default |\n `logging.max_history_files`|The max history log files. When rollover happened, if log files exceed this number,then the oldest file will be delete. Negative or zero means off, by default.|`-1`|\n `statuscheck.ignored_exceptions`|Listed exceptions would not be treated as an error. Because in some codes, the exception is being used as a way of controlling business flow.|`\"\"`|\n `statuscheck.max_recursive_depth`|The max recursive depth when checking the exception traced by the agent. Typically, we don't recommend setting this more than 10, which could cause a performance issue. Negative value and 0 would be ignored, which means all exceptions would make the span tagged in error status.|`1`|\n+`correlation.element_max_number`|Max element count in the correlation context.|3|\n+`correlation.value_max_length`|Max value length of each element.|`128`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODA0OTUwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/config/agent.config", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxMzoyNFrOHj2rtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxMzoyNFrOHj2rtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM1ODEzMg==", "bodyText": "These are not widely used configurations, please don't add them in the agent.config.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507358132", "createdAt": "2020-10-19T02:13:24Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/config/agent.config", "diffHunk": "@@ -92,6 +92,13 @@ logging.level=${SW_LOGGING_LEVEL:INFO}\n # The max recursive depth when checking the exception traced by the agent. Typically, we don't recommend setting this more than 10, which could cause a performance issue. Negative value and 0 would be ignored, which means all exceptions would make the span tagged in error status.\n # statuscheck.max_recursive_depth=${SW_STATUSCHECK_MAX_RECURSIVE_DEPTH:1}\n \n+# Max element count in the correlation context.\n+# correlation.element_max_number=${SW_CORRELATION_ELEMENT_MAX_NUMBER:3}\n+# Max value length of each element.\n+# correlation.value_max_length=${SW_CORRELATION_VALUE_MAX_LENGTH:128}\n+# These tags of the span are derived from correlations with the same name.\n+# correlation.injection_tags=${SW_CORRELATION_INJECTION_TAGS:}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODA1NDkwOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/tag/AbstractTag.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxNDozNlrOHj2vuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNjo1OTozOFrOHkAOTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM1OTE2MA==", "bodyText": "What are these for?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507359160", "createdAt": "2020-10-19T02:14:36Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/tag/AbstractTag.java", "diffHunk": "@@ -60,4 +61,21 @@ public int getId() {\n     public boolean isCanOverwrite() {\n         return canOverwrite;\n     }\n+\n+    @Override\n+    public boolean equals(final Object o) {\n+        if (this == o)\n+            return true;\n+        if (!(o instanceof AbstractTag))\n+            return false;\n+        final AbstractTag<?> that = (AbstractTag<?>) o;\n+        return getId() == that.getId() &&\n+            isCanOverwrite() == that.isCanOverwrite() &&\n+            key.equals(that.key);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(getId(), isCanOverwrite(), key);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUxNDQ0NA==", "bodyText": "For stringTag equals:", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507514444", "createdAt": "2020-10-19T06:59:38Z", "author": {"login": "EvanLjp"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/tag/AbstractTag.java", "diffHunk": "@@ -60,4 +61,21 @@ public int getId() {\n     public boolean isCanOverwrite() {\n         return canOverwrite;\n     }\n+\n+    @Override\n+    public boolean equals(final Object o) {\n+        if (this == o)\n+            return true;\n+        if (!(o instanceof AbstractTag))\n+            return false;\n+        final AbstractTag<?> that = (AbstractTag<?>) o;\n+        return getId() == that.getId() &&\n+            isCanOverwrite() == that.isCanOverwrite() &&\n+            key.equals(that.key);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(getId(), isCanOverwrite(), key);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM1OTE2MA=="}, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODA3NjMyOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/conf/Config.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxOTowOVrOHj2_Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxOTowOVrOHj2_Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM2MzE3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    /**\n          \n          \n            \n                     * Extract tags from the correlation.\n          \n          \n            \n                     */\n          \n          \n            \n                    public static String INJECTION_TAGS = \"\";\n          \n          \n            \n                    /**\n          \n          \n            \n                     * Tag the span by the key/value in the correlation context, when the keys listed here exist.\n          \n          \n            \n                     */\n          \n          \n            \n                    public static String AUTO_TAG_KEYS = \"\";", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507363174", "createdAt": "2020-10-19T02:19:09Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/conf/Config.java", "diffHunk": "@@ -310,5 +310,10 @@\n          * Max value length of each element.\n          */\n         public static int VALUE_MAX_LENGTH = 128;\n+\n+        /**\n+         * Extract tags from the correlation.\n+         */\n+        public static String INJECTION_TAGS = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3ODA3OTM1OnYy", "diffSide": "RIGHT", "path": "docs/en/setup/service-agent/java-agent/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxOTo0OFrOHj3BYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMjoxOTo0OFrOHj3BYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzM2MzY4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `correlation.injection_tags`|These tags of the span are derived from correlations with the same name.|`\"\"`|\n          \n          \n            \n            `correlation.injection_tags`|Tag the span by the key/value in the correlation context, when the keys listed here exist.|`\"\"`|", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r507363682", "createdAt": "2020-10-19T02:19:48Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -102,6 +102,9 @@ property key | Description | Default |\n `logging.max_history_files`|The max history log files. When rollover happened, if log files exceed this number,then the oldest file will be delete. Negative or zero means off, by default.|`-1`|\n `statuscheck.ignored_exceptions`|Listed exceptions would not be treated as an error. Because in some codes, the exception is being used as a way of controlling business flow.|`\"\"`|\n `statuscheck.max_recursive_depth`|The max recursive depth when checking the exception traced by the agent. Typically, we don't recommend setting this more than 10, which could cause a performance issue. Negative value and 0 would be ignored, which means all exceptions would make the span tagged in error status.|`1`|\n+`correlation.element_max_number`|Max element count in the correlation context.|3|\n+`correlation.value_max_length`|Max value length of each element.|`128`|\n+`correlation.injection_tags`|These tags of the span are derived from correlations with the same name.|`\"\"`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f716458f7160f75bc35eccbb4ffa2523ec34a4a"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MzEwMTUzOnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/CorrelationContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMTozNjoyM1rOHknaZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMTozNjoyM1rOHknaZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1NjUxOQ==", "bodyText": "From my understanding, this should be in the static{} block, as it doesn't need to execute every time.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r508156519", "createdAt": "2020-10-20T01:36:23Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/CorrelationContext.java", "diffHunk": "@@ -17,26 +17,38 @@\n \n package org.apache.skywalking.apm.agent.core.context;\n \n-import org.apache.skywalking.apm.agent.core.base64.Base64;\n-import org.apache.skywalking.apm.agent.core.conf.Config;\n-import org.apache.skywalking.apm.util.StringUtil;\n-\n+import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.HashMap;\n+import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n import java.util.Optional;\n import java.util.stream.Collectors;\n+import org.apache.skywalking.apm.agent.core.base64.Base64;\n+import org.apache.skywalking.apm.agent.core.conf.Config;\n+import org.apache.skywalking.apm.agent.core.context.tag.StringTag;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.util.StringUtil;\n+\n+import static org.apache.skywalking.apm.agent.core.conf.Config.Correlation.AUTO_TAG_KEYS;\n \n /**\n- * Correlation context, use to propagation user custom data.\n- * Working on the protocol and delegate set/get method.\n+ * Correlation context, use to propagation user custom data. Working on the protocol and delegate set/get method.\n  */\n public class CorrelationContext {\n \n     private final Map<String, String> data;\n \n+    private final List<String> autoTagKeys;\n+\n     public CorrelationContext() {\n         this.data = new HashMap<>(Config.Correlation.ELEMENT_MAX_NUMBER);\n+        if (StringUtil.isNotEmpty(AUTO_TAG_KEYS)) {\n+            autoTagKeys = Arrays.asList(AUTO_TAG_KEYS.split(\",\"));\n+        } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a2d3f6bc5421cec3ae74be9fbfdff6d51c41616"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTEzMjA5OnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/correlation-autotag-scenario/src/main/java/org/apache/skywalking/apm/testcase/baidu.brpc/interfaces/Echo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzo1MDo1N1rOHnCoPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQxNjozODo1NVrOHroghg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5OTU4MQ==", "bodyText": "I think this file should not be checked into the codebase, please set a maven phase to generate it, refer to the existing settings in other modules, apm-network, thrift-plugin tests, etc.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r510699581", "createdAt": "2020-10-23T07:50:57Z", "author": {"login": "kezhenxu94"}, "path": "test/plugin/scenarios/correlation-autotag-scenario/src/main/java/org/apache/skywalking/apm/testcase/baidu.brpc/interfaces/Echo.java", "diffHunk": "@@ -0,0 +1,1040 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+// Generated by the protocol buffer compiler.  DO NOT EDIT!\n+// source: echo.proto\n+\n+package org.apache.skywalking.apm.testcase.baidu.brpc.interfaces;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c47b80baa004a51f8ecfbcbfbec8258bbddf7ad"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUxNDUwMg==", "bodyText": "Generated files are seldom checked into the codebase, unless we have to", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515514502", "createdAt": "2020-10-31T16:38:55Z", "author": {"login": "kezhenxu94"}, "path": "test/plugin/scenarios/correlation-autotag-scenario/src/main/java/org/apache/skywalking/apm/testcase/baidu.brpc/interfaces/Echo.java", "diffHunk": "@@ -0,0 +1,1040 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+// Generated by the protocol buffer compiler.  DO NOT EDIT!\n+// source: echo.proto\n+\n+package org.apache.skywalking.apm.testcase.baidu.brpc.interfaces;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5OTU4MQ=="}, "originalCommit": {"oid": "9c47b80baa004a51f8ecfbcbfbec8258bbddf7ad"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDc5NzYxOnYy", "diffSide": "RIGHT", "path": "docs/en/setup/service-agent/java-agent/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNjowNjowN1rOHrshpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNjowNzoxOFrOHrsh-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4MDMyNA==", "bodyText": "I think you should consider including this in your DevCon topic with many other commits you made, why they are important, how to use them.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515580324", "createdAt": "2020-11-01T06:06:07Z", "author": {"login": "wu-sheng"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -103,6 +103,9 @@ property key | Description | Default |\n `logging.max_history_files`|The max history log files. When rollover happened, if log files exceed this number,then the oldest file will be delete. Negative or zero means off, by default.|`-1`|\n `statuscheck.ignored_exceptions`|Listed exceptions would not be treated as an error. Because in some codes, the exception is being used as a way of controlling business flow.|`\"\"`|\n `statuscheck.max_recursive_depth`|The max recursive depth when checking the exception traced by the agent. Typically, we don't recommend setting this more than 10, which could cause a performance issue. Negative value and 0 would be ignored, which means all exceptions would make the span tagged in error status.|`1`|\n+`correlation.element_max_number`|Max element count in the correlation context.|3|\n+`correlation.value_max_length`|Max value length of each element.|`128`|\n+`correlation.auto_tag_keys`|Tag the span by the key/value in the correlation context, when the keys listed here exist.|`\"\"`|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66a7f9f02f27b8d4598db3ce7b9a035b275cab87"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4MDQwOQ==", "bodyText": "This is exactly what I want to share", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515580409", "createdAt": "2020-11-01T06:07:18Z", "author": {"login": "EvanLjp"}, "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -103,6 +103,9 @@ property key | Description | Default |\n `logging.max_history_files`|The max history log files. When rollover happened, if log files exceed this number,then the oldest file will be delete. Negative or zero means off, by default.|`-1`|\n `statuscheck.ignored_exceptions`|Listed exceptions would not be treated as an error. Because in some codes, the exception is being used as a way of controlling business flow.|`\"\"`|\n `statuscheck.max_recursive_depth`|The max recursive depth when checking the exception traced by the agent. Typically, we don't recommend setting this more than 10, which could cause a performance issue. Negative value and 0 would be ignored, which means all exceptions would make the span tagged in error status.|`1`|\n+`correlation.element_max_number`|Max element count in the correlation context.|3|\n+`correlation.value_max_length`|Max value length of each element.|`128`|\n+`correlation.auto_tag_keys`|Tag the span by the key/value in the correlation context, when the keys listed here exist.|`\"\"`|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4MDMyNA=="}, "originalCommit": {"oid": "66a7f9f02f27b8d4598db3ce7b9a035b275cab87"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDg0MDM2OnYy", "diffSide": "RIGHT", "path": "CHANGES.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzowNzowOFrOHrs03w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzowNzowOFrOHrs03w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4NTI0Nw==", "bodyText": "Move the new feature at the top of the list.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515585247", "createdAt": "2020-11-01T07:07:08Z", "author": {"login": "wu-sheng"}, "path": "CHANGES.md", "diffHunk": "@@ -10,12 +10,15 @@ Release Notes.\n * Make HttpClient 3.x, 4.x, and HttpAsyncClient 3.x plugins to support collecting HTTP parameters.\n * Make the Feign plugin to support Java 14\n * Make the okhttp3 plugin to support Java 14\n+* Support propagate the sending timestamp in MQ plugins to calculate the transfer latency in the async MQ scenarios.\n+* Support auto-tag with the fixed values propagated in the correlation context.   ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be31e3bc9ad7209696a90794e58430fd0afc2194"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDg0MDU2OnYy", "diffSide": "RIGHT", "path": "CHANGES.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzowNzoyOVrOHrs09w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzowNzoyOVrOHrs09w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4NTI3MQ==", "bodyText": "Please move add to follow the previous add. New feature comes first in the change log.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515585271", "createdAt": "2020-11-01T07:07:29Z", "author": {"login": "wu-sheng"}, "path": "CHANGES.md", "diffHunk": "@@ -10,12 +10,15 @@ Release Notes.\n * Make HttpClient 3.x, 4.x, and HttpAsyncClient 3.x plugins to support collecting HTTP parameters.\n * Make the Feign plugin to support Java 14\n * Make the okhttp3 plugin to support Java 14\n+* Support propagate the sending timestamp in MQ plugins to calculate the transfer latency in the async MQ scenarios.\n+* Support auto-tag with the fixed values propagated in the correlation context.   \n \n #### OAP-Backend\n * Add the `@SuperDataset` annotation for BrowserErrorLog.\n * Support keeping collecting the slowly segments in the sampling mechanism.\n * Support choose files to active the meter analyzer.\n * Improve Kubernetes service registry for ALS analysis.\n+* Add `contain` and `not contain` OPS in OAL.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be31e3bc9ad7209696a90794e58430fd0afc2194"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDg2NDI3OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/pom.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzo0MTowMVrOHrtAHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzo1Nzo1OFrOHrtF8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODEyNA==", "bodyText": "What are these for?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515588124", "createdAt": "2020-11-01T07:41:01Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -87,6 +86,20 @@\n             <artifactId>wiremock</artifactId>\n             <version>${wiremock.version}</version>\n             <scope>test</scope>\n+            <exclusions>\n+                <exclusion>\n+                    <artifactId>jackson-annotations</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-core</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-databind</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+            </exclusions>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODYyMA==", "bodyText": "find some conflict in agent-core.pom", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515588620", "createdAt": "2020-11-01T07:46:40Z", "author": {"login": "EvanLjp"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -87,6 +86,20 @@\n             <artifactId>wiremock</artifactId>\n             <version>${wiremock.version}</version>\n             <scope>test</scope>\n+            <exclusions>\n+                <exclusion>\n+                    <artifactId>jackson-annotations</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-core</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-databind</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+            </exclusions>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODEyNA=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4OTYxOQ==", "bodyText": "This is just a test scope, wouldn't be included in the distribution. What issue do you face?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515589619", "createdAt": "2020-11-01T07:57:58Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -87,6 +86,20 @@\n             <artifactId>wiremock</artifactId>\n             <version>${wiremock.version}</version>\n             <scope>test</scope>\n+            <exclusions>\n+                <exclusion>\n+                    <artifactId>jackson-annotations</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-core</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+                <exclusion>\n+                    <artifactId>jackson-databind</artifactId>\n+                    <groupId>com.fasterxml.jackson.core</groupId>\n+                </exclusion>\n+            </exclusions>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODEyNA=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDg2NTE1OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/pom.xml", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwNzo0MjoxM1rOHrtAiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOTozODowOFrOHrtUOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg==", "bodyText": "What are these for?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515588232", "createdAt": "2020-11-01T07:42:13Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODYxOQ==", "bodyText": "find some conflict in agent-core.pom", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515588619", "createdAt": "2020-11-01T07:46:38Z", "author": {"login": "EvanLjp"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4OTE0OQ==", "bodyText": "Could you show me the conflict?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515589149", "createdAt": "2020-11-01T07:52:28Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4OTU4Mg==", "bodyText": "For this, you are just missing the dependency to dependecyManagement, which part have another dependency?", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515589582", "createdAt": "2020-11-01T07:57:35Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NTk4MQ==", "bodyText": "OK, byte-buddy is rarely to trigger bugs usually. If you want to resolve, it is fine.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515595981", "createdAt": "2020-11-01T09:06:14Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5MzI2MA==", "bodyText": "just conflict on test scope", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515593260", "createdAt": "2020-11-01T09:37:51Z", "author": {"login": "EvanLjp"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5MzI3Mw==", "bodyText": "", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515593273", "createdAt": "2020-11-01T09:38:08Z", "author": {"login": "EvanLjp"}, "path": "apm-sniffer/apm-agent-core/pom.xml", "diffHunk": "@@ -129,6 +141,16 @@\n                 <artifactId>guava</artifactId>\n                 <version>${guava.version}</version>\n             </dependency>\n+            <dependency>\n+                <groupId>net.bytebuddy</groupId>\n+                <artifactId>byte-buddy</artifactId>\n+                <version>${bytebuddy.version}</version>\n+            </dependency>\n+            <dependency>\n+                <groupId>org.slf4j</groupId>\n+                <artifactId>slf4j-api</artifactId>\n+                <version>${slf4j.version}</version>\n+            </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4ODIzMg=="}, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDkzMDY0OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/TracingContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOToxMDowMVrOHrtgMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOToxMDowMVrOHrtgMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NjMzNw==", "bodyText": "This should be changed to carrier.extractCorrelationTo(span); right? handle should be hidden.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515596337", "createdAt": "2020-11-01T09:10:01Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/TracingContext.java", "diffHunk": "@@ -189,6 +189,7 @@ public void extract(ContextCarrier carrier) {\n \n         carrier.extractExtensionTo(span);\n         this.correlationContext.extract(carrier);\n+        this.correlationContext.handle(span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13ec05b8b5cbc6d603ad09ae4e42348c7ea4fd71"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDkzMzU0OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/CorrelationContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOToxNDowNVrOHrthpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOToxNDowNVrOHrthpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NjcwOA==", "bodyText": "ContextManager#activeSpan could be NPE inside, try #isActive.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515596708", "createdAt": "2020-11-01T09:14:05Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/CorrelationContext.java", "diffHunk": "@@ -70,7 +85,9 @@ public CorrelationContext() {\n         if (data.size() >= Config.Correlation.ELEMENT_MAX_NUMBER) {\n             return Optional.empty();\n         }\n-\n+        if (AUTO_TAG_KEYS.contains(key) && Objects.nonNull(ContextManager.activeSpan())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13ec05b8b5cbc6d603ad09ae4e42348c7ea4fd71"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDkxMTc3OnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/correlation-autotag-scenario/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOTo0NToyN1rOHrtXHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOTo0NToyN1rOHrtXHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NDAxNA==", "bodyText": "If you need the toolkit, use the 8.2.0, no snapshot for 8.3.0. We used 8.2.0-SNAPSHOT, because one committer pushed this before it is released.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515594014", "createdAt": "2020-11-01T09:45:27Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/correlation-autotag-scenario/pom.xml", "diffHunk": "@@ -0,0 +1,165 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one or more\n+  ~ contributor license agreements.  See the NOTICE file distributed with\n+  ~ this work for additional information regarding copyright ownership.\n+  ~ The ASF licenses this file to You under the Apache License, Version 2.0\n+  ~ (the \"License\"); you may not use this file except in compliance with\n+  ~ the License.  You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  ~\n+  -->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+    <groupId>org.apache.skywalking.apm.testcase</groupId>\n+    <artifactId>correlation-autotag-scenario</artifactId>\n+    <version>1.0.0</version>\n+    <packaging>jar</packaging>\n+\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <properties>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+        <compiler.version>1.8</compiler.version>\n+        <os-maven-plugin.version>1.6.2</os-maven-plugin.version>\n+\n+        <test.framework.version>1.6.0</test.framework.version>\n+\n+        <spring-boot-version>2.1.6.RELEASE</spring-boot-version>\n+    </properties>\n+\n+    <name>skywalking-correlation-autotag-scenario</name>\n+\n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.springframework.boot</groupId>\n+                <artifactId>spring-boot-dependencies</artifactId>\n+                <version>${spring-boot-version}</version>\n+                <type>pom</type>\n+                <scope>import</scope>\n+            </dependency>\n+        </dependencies>\n+    </dependencyManagement>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>org.springframework.boot</groupId>\n+                    <artifactId>spring-boot-starter-logging</artifactId>\n+                </exclusion>\n+            </exclusions>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-log4j2</artifactId>\n+        </dependency>\n+\n+        <!--    grpc    -->\n+        <dependency>\n+            <groupId>io.grpc</groupId>\n+            <artifactId>grpc-all</artifactId>\n+            <version>${test.framework.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>apm-toolkit-trace</artifactId>\n+            <version>8.3.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDkxMjcxOnYy", "diffSide": "RIGHT", "path": "test/plugin/scenarios/correlation-autotag-scenario/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOTo0NjozN1rOHrtXkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwOTo0NjozN1rOHrtXkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU5NDEzMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <version>8.3.0-SNAPSHOT</version>\n          \n          \n            \n                        <version>8.2.0</version>", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515594130", "createdAt": "2020-11-01T09:46:37Z", "author": {"login": "wu-sheng"}, "path": "test/plugin/scenarios/correlation-autotag-scenario/pom.xml", "diffHunk": "@@ -0,0 +1,165 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed to the Apache Software Foundation (ASF) under one or more\n+  ~ contributor license agreements.  See the NOTICE file distributed with\n+  ~ this work for additional information regarding copyright ownership.\n+  ~ The ASF licenses this file to You under the Apache License, Version 2.0\n+  ~ (the \"License\"); you may not use this file except in compliance with\n+  ~ the License.  You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  ~\n+  -->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+    <groupId>org.apache.skywalking.apm.testcase</groupId>\n+    <artifactId>correlation-autotag-scenario</artifactId>\n+    <version>1.0.0</version>\n+    <packaging>jar</packaging>\n+\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <properties>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+        <compiler.version>1.8</compiler.version>\n+        <os-maven-plugin.version>1.6.2</os-maven-plugin.version>\n+\n+        <test.framework.version>1.6.0</test.framework.version>\n+\n+        <spring-boot-version>2.1.6.RELEASE</spring-boot-version>\n+    </properties>\n+\n+    <name>skywalking-correlation-autotag-scenario</name>\n+\n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.springframework.boot</groupId>\n+                <artifactId>spring-boot-dependencies</artifactId>\n+                <version>${spring-boot-version}</version>\n+                <type>pom</type>\n+                <scope>import</scope>\n+            </dependency>\n+        </dependencies>\n+    </dependencyManagement>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>org.springframework.boot</groupId>\n+                    <artifactId>spring-boot-starter-logging</artifactId>\n+                </exclusion>\n+            </exclusions>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-log4j2</artifactId>\n+        </dependency>\n+\n+        <!--    grpc    -->\n+        <dependency>\n+            <groupId>io.grpc</groupId>\n+            <artifactId>grpc-all</artifactId>\n+            <version>${test.framework.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.skywalking</groupId>\n+            <artifactId>apm-toolkit-trace</artifactId>\n+            <version>8.3.0-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65528028f569370fe07519384691bc09735c0f5b"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMTA1NTg0OnYy", "diffSide": "RIGHT", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextCarrier.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxMTo0ODo0N1rOHrucpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxMTo0ODo0N1rOHrucpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYxMTgxNA==", "bodyText": "I mean to create a method extractCorrelationTo.", "url": "https://github.com/apache/skywalking/pull/5685#discussion_r515611814", "createdAt": "2020-11-01T11:48:47Z", "author": {"login": "wu-sheng"}, "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextCarrier.java", "diffHunk": "@@ -94,6 +94,7 @@ public ExtensionInjector extensionInjector() {\n      */\n     void extractExtensionTo(AbstractSpan span) {\n         this.extensionContext.handle(span);\n+        this.correlationContext.handle(span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c589f35314bf08a0170619e642452c4450d219e8"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4711, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}