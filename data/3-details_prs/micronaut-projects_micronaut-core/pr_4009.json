{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MDc0NTUz", "number": 4009, "title": "Fix for method argument annotation visitors.", "bodyText": "Resolves #4008\nThis fix makes sure the updated annotation metadata is stored in the modified cache under the same key it is retrieved later on.\nThis PR also includes a test verifying the annotation is correctly added.", "createdAt": "2020-09-02T18:39:46Z", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4009", "merged": true, "mergeCommit": {"oid": "2379be81fdde4243acd9f453d688ffe451632b13"}, "closed": true, "closedAt": "2020-09-03T07:08:15Z", "author": {"login": "tomas-langer"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE_mONAH2gAyNDc4MDc0NTUzOjMxYWY4N2Y5ZGU4YjBmNTM0MDNkNzBhNTNkMzBjY2FhZWJhMTRhNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFDPwfgFqTQ4MTMyNzgwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "31af87f9de8b0f53403d70a53d30ccaaeba14a4d", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/31af87f9de8b0f53403d70a53d30ccaaeba14a4d", "committedDate": "2020-09-02T17:38:42Z", "message": "Test to make sure method arguments can be annotated using element visitor."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22d081be4929d46529f0e28e2ccd18fab218b30", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/c22d081be4929d46529f0e28e2ccd18fab218b30", "committedDate": "2020-09-02T18:14:46Z", "message": "Fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4371fc5df1d5ad67a1bcf417db3b58f6bb9e8a8c", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/4371fc5df1d5ad67a1bcf417db3b58f6bb9e8a8c", "committedDate": "2020-09-02T18:18:06Z", "message": "Fix for method argument annotation visitors."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMjQ0MzE3", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4009#pullrequestreview-481244317", "createdAt": "2020-09-02T19:43:14Z", "commit": {"oid": "4371fc5df1d5ad67a1bcf417db3b58f6bb9e8a8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMzI3ODAy", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4009#pullrequestreview-481327802", "createdAt": "2020-09-02T21:53:47Z", "commit": {"oid": "4371fc5df1d5ad67a1bcf417db3b58f6bb9e8a8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMTo1Mzo0N1rOHMKKLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMTo1Mzo0N1rOHMKKLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxMTQwNA==", "bodyText": "The only part I am not sure about is if this cast is safe, or if there is another way to obtain the declaring type...", "url": "https://github.com/micronaut-projects/micronaut-core/pull/4009#discussion_r482511404", "createdAt": "2020-09-02T21:53:47Z", "author": {"login": "tomas-langer"}, "path": "inject-java/src/main/java/io/micronaut/annotation/processing/visitor/AbstractJavaElement.java", "diffHunk": "@@ -76,7 +77,20 @@\n                 .newAnnotationBuilder()\n                 .annotate(annotationMetadata, av);\n \n-        String declaringTypeName = this instanceof MemberElement ? ((MemberElement) this).getOwningType().getName() : getName();\n+        String declaringTypeName;\n+        if (this instanceof MemberElement) {\n+            declaringTypeName = ((MemberElement) this).getOwningType().getName();\n+        } else if (this instanceof ParameterElement) {\n+            TypeElement typeElement = visitorContext.getModelUtils().classElementFor((Element) this.getNativeType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4371fc5df1d5ad67a1bcf417db3b58f6bb9e8a8c"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2761, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}