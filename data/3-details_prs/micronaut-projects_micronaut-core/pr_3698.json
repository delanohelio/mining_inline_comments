{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2OTI2OTA1", "number": 3698, "title": "Validate nullable is not used on primite parameters. Fixes #3666", "bodyText": "Some comments:\n\nI needed to declare the TypeElementVisitor as TypeElementVisitor<Object, Object>. If I do TypeElementVisitor<Object, Executable> it will work for @Controller for not for @Singleton, because a @Singleton class is not @Executable.\nI've also tried with the declarative HTTP Client and the methods there are not being validated. Probably because TypeElemenVisitors only work for classes and not interfaces, right? Is there anything we can do this case?", "createdAt": "2020-07-09T15:15:51Z", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698", "merged": true, "mergeCommit": {"oid": "18941fb2ecbf564a11b26744924730ab3f7947d7"}, "closed": true, "closedAt": "2020-07-13T14:51:24Z", "author": {"login": "ilopmar"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczQ16JgFqTQ0NTczMzQ3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0iYbgAH2gAyNDQ2OTI2OTA1OjAxMTUwNzVmYWEzZmQ0MzYwNGM4ZDU3ZjhmZDlhYmIyMDI3ZjBjZjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzMzNDcx", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#pullrequestreview-445733471", "createdAt": "2020-07-09T15:33:24Z", "commit": {"oid": "2e6b77cb5bc6363d6264373d434adbcde701f60f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTozMzoyNFrOGvWoTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTozMzoyNFrOGvWoTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwNzAyMw==", "bodyText": "Should declare isolating:\n    @NonNull\n    @Override\n    public VisitorKind getVisitorKind() {\n        return VisitorKind.ISOLATING;\n    }", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#discussion_r452307023", "createdAt": "2020-07-09T15:33:24Z", "author": {"login": "graemerocher"}, "path": "validation/src/main/java/io/micronaut/validation/executable/ExecutableVisitor.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.validation.executable;\n+\n+import io.micronaut.core.annotation.Internal;\n+import io.micronaut.inject.ast.MethodElement;\n+import io.micronaut.inject.ast.ParameterElement;\n+import io.micronaut.inject.visitor.TypeElementVisitor;\n+import io.micronaut.inject.visitor.VisitorContext;\n+\n+/**\n+ * A {@link io.micronaut.inject.visitor.TypeElementVisitor} that validates primitive types can't have a Nullable annotation.\n+ *\n+ * @author Iv\u00e1n L\u00f3pez\n+ * @since 2.0.1\n+ */\n+@Internal\n+public class ExecutableVisitor implements TypeElementVisitor<Object, Object> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e6b77cb5bc6363d6264373d434adbcde701f60f"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/cf9b00b042eecdee09d835820a3d03c13125d456", "committedDate": "2020-07-09T15:53:52Z", "message": "Validate nullable is not used on primite parameters. Fixes #3666"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e6b77cb5bc6363d6264373d434adbcde701f60f", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/2e6b77cb5bc6363d6264373d434adbcde701f60f", "committedDate": "2020-07-09T15:13:50Z", "message": "Validate nullable is not used on primite parameters. Fixes #3666"}, "afterCommit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/cf9b00b042eecdee09d835820a3d03c13125d456", "committedDate": "2020-07-09T15:53:52Z", "message": "Validate nullable is not used on primite parameters. Fixes #3666"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Nzc1MjYz", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#pullrequestreview-445775263", "createdAt": "2020-07-09T16:22:22Z", "commit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMjoyMlrOGvYjvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMjoyMlrOGvYjvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzODYyMA==", "bodyText": "We need to ensure the MethodElement is annotated with @Executable. Can you look into why TypeElementVisitor<Object, Executable> is not working?", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#discussion_r452338620", "createdAt": "2020-07-09T16:22:22Z", "author": {"login": "jameskleeh"}, "path": "validation/src/main/java/io/micronaut/validation/executable/ExecutableVisitor.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2017-2020 original authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.micronaut.validation.executable;\n+\n+import edu.umd.cs.findbugs.annotations.NonNull;\n+import io.micronaut.core.annotation.Internal;\n+import io.micronaut.inject.ast.MethodElement;\n+import io.micronaut.inject.ast.ParameterElement;\n+import io.micronaut.inject.visitor.TypeElementVisitor;\n+import io.micronaut.inject.visitor.VisitorContext;\n+\n+/**\n+ * A {@link io.micronaut.inject.visitor.TypeElementVisitor} that validates primitive types can't have a Nullable annotation.\n+ *\n+ * @author Iv\u00e1n L\u00f3pez\n+ * @since 2.0.1\n+ */\n+@Internal\n+public class ExecutableVisitor implements TypeElementVisitor<Object, Object> {\n+\n+    @NonNull\n+    @Override\n+    public VisitorKind getVisitorKind() {\n+        return VisitorKind.ISOLATING;\n+    }\n+\n+    @Override\n+    public void visitMethod(MethodElement element, VisitorContext context) {\n+        ParameterElement[] parameters = element.getParameters();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Nzc1ODM3", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#pullrequestreview-445775837", "createdAt": "2020-07-09T16:23:07Z", "commit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMzowOFrOGvYlhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMzowOFrOGvYlhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzOTA3OA==", "bodyText": "This type of scenario should still compile because Micronaut will not be executing this method", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#discussion_r452339078", "createdAt": "2020-07-09T16:23:08Z", "author": {"login": "jameskleeh"}, "path": "validation/src/test/groovy/io/micronaut/validation/executable/NullablePrimitiveSpec.groovy", "diffHunk": "@@ -0,0 +1,83 @@\n+package io.micronaut.validation.executable\n+\n+import io.micronaut.annotation.processing.test.AbstractTypeElementSpec\n+import spock.lang.Shared\n+\n+class NullablePrimitiveSpec extends AbstractTypeElementSpec {\n+\n+    @Shared\n+    String errorMsg = \"Primitive types can not be null\"\n+\n+    void 'test @Nullable is not allowed on primitive parameters'() {\n+        when:\n+        buildTypeElement(\"\"\"\n+package test;\n+\n+@javax.inject.Singleton\n+class Foo {\n+    void bar(@javax.annotation.Nullable boolean boolPrimitive) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9b00b042eecdee09d835820a3d03c13125d456"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5197f8a986e7d5bb34fd73ce5e679ee4fb8465d5", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/5197f8a986e7d5bb34fd73ce5e679ee4fb8465d5", "committedDate": "2020-07-10T08:53:53Z", "message": "Only validate @Executable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e492b582dc5ba677f49a88eb18a479172e692a07", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/e492b582dc5ba677f49a88eb18a479172e692a07", "committedDate": "2020-07-10T13:41:11Z", "message": "Merge branch 'master' into issue-3666_validate-nullable-primitive-type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NDE0NTAy", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#pullrequestreview-446414502", "createdAt": "2020-07-10T13:46:38Z", "commit": {"oid": "e492b582dc5ba677f49a88eb18a479172e692a07"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d828ad6249603eb2dcea6203b865084f967ef03e", "author": {"user": {"login": "jameskleeh", "name": "James Kleeh"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/d828ad6249603eb2dcea6203b865084f967ef03e", "committedDate": "2020-07-10T13:57:14Z", "message": "Change the error to a warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37579a1689ed313c3dff86731f7cfb3f91d0888a", "author": {"user": {"login": "jameskleeh", "name": "James Kleeh"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/37579a1689ed313c3dff86731f7cfb3f91d0888a", "committedDate": "2020-07-10T13:57:20Z", "message": "Merge branch 'issue-3666_validate-nullable-primitive-type' of https://github.com/micronaut-projects/micronaut-core into issue-3666_validate-nullable-primitive-type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NDI0Nzg5", "url": "https://github.com/micronaut-projects/micronaut-core/pull/3698#pullrequestreview-446424789", "createdAt": "2020-07-10T13:59:34Z", "commit": {"oid": "37579a1689ed313c3dff86731f7cfb3f91d0888a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "619287ce33b26ecbbe4ae2ce2d50e2fb73645bfb", "author": {"user": {"login": "jameskleeh", "name": "James Kleeh"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/619287ce33b26ecbbe4ae2ce2d50e2fb73645bfb", "committedDate": "2020-07-10T16:28:06Z", "message": "Merge branch 'master' into issue-3666_validate-nullable-primitive-type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0115075faa3fd43604c8d57f8fd9abb2027f0cf3", "author": {"user": {"login": "ilopmar", "name": "Iv\u00e1n L\u00f3pez"}}, "url": "https://github.com/micronaut-projects/micronaut-core/commit/0115075faa3fd43604c8d57f8fd9abb2027f0cf3", "committedDate": "2020-07-13T14:33:36Z", "message": "Merge branch 'master' into issue-3666_validate-nullable-primitive-type"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2813, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}