{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzE5MjUz", "number": 1304, "title": "fix incomplete shutdown", "bodyText": "", "createdAt": "2020-07-29T09:41:20Z", "url": "https://github.com/bakdata/conquery/pull/1304", "merged": true, "mergeCommit": {"oid": "8d38a14a916b1109d7b2149e4a51fa8789fd9be7"}, "closed": true, "closedAt": "2020-08-05T12:56:23Z", "author": {"login": "thoniTUB"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5mPqeAH2gAyNDU4MzE5MjUzOjc5ZWFhZjMwNTgyMTNiY2EyZGY3M2U5MTM3MTA5NzNiNjAzMDIwYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc59GqTgFqTQ1ODI3MDk3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79eaaf3058213bca2df73e913710973b603020b0", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/79eaaf3058213bca2df73e913710973b603020b0", "committedDate": "2020-07-29T07:53:16Z", "message": "adds missing close of jobmanager in worker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e991f7fada263ddfbfa63314d5dcd18ab4e1206", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/7e991f7fada263ddfbfa63314d5dcd18ab4e1206", "committedDate": "2020-07-29T07:54:17Z", "message": "cleanup closing of resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fbb161a15f316696e210c639e5254fac7c174af", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/7fbb161a15f316696e210c639e5254fac7c174af", "committedDate": "2020-07-29T09:32:42Z", "message": "cleanup worker creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9", "committedDate": "2020-07-29T09:46:10Z", "message": "format code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjcwOTc0", "url": "https://github.com/bakdata/conquery/pull/1304#pullrequestreview-458270974", "createdAt": "2020-07-30T10:17:06Z", "commit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoxNzowNlrOG5dAEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoyOTozNFrOG5dYTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzE3MQ==", "bodyText": "createWorkerName wo ist die Methode definiert?", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897171", "createdAt": "2020-07-30T10:17:06Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/messages/network/specific/AddWorker.java", "diffHunk": "@@ -31,18 +29,15 @@ public void react(Slave context) throws Exception {\n \t\tConqueryConfig config = context.getConfig();\n \t\tFile dir = createWorkerName(context);\n \t\tWorkerInformation info = new WorkerInformation();\n-\t\tinfo.setDataset(dataset.getId());\n+\t\tinfo.setDataset(dataset);\n \t\tinfo.setIncludedBuckets(new IntArrayList());\n \t\tinfo.setName(dir.getName());\n-\t\tWorkerStorage workerStorage = new WorkerStorageImpl(context.getValidator(), config.getStorage(), dir);\n-\t\tworkerStorage.loadData();\n-\t\tworkerStorage.updateDataset(dataset);\n \n \n-\t\tWorker worker = context.getWorkers().createWorker(info, workerStorage);\n+\t\tWorker worker = context.getWorkers().createWorker(info, config.getStorage(), createWorkerName(context), context.getValidator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzU2NQ==", "bodyText": "Ui! Das ist ein bug!", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897565", "createdAt": "2020-07-30T10:17:51Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Namespaces.java", "diffHunk": "@@ -88,7 +89,7 @@ public synchronized void register(SlaveInformation slave, WorkerInformation info\n \t\t\tworkers.add(info);\n \t\t}\n \n-\t\tNamespace ns = datasets.get(info.getDataset());\n+\t\tNamespace ns = datasets.get(info.getDataset().getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzYwMg==", "bodyText": "gewesen", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897602", "createdAt": "2020-07-30T10:17:57Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Namespaces.java", "diffHunk": "@@ -88,7 +89,7 @@ public synchronized void register(SlaveInformation slave, WorkerInformation info\n \t\t\tworkers.add(info);\n \t\t}\n \n-\t\tNamespace ns = datasets.get(info.getDataset());\n+\t\tNamespace ns = datasets.get(info.getDataset().getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzU2NQ=="}, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMzM3NA==", "bodyText": "ist das einfach nur tryLoad umbenannt?", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462903374", "createdAt": "2020-07-30T10:29:34Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Worker.java", "diffHunk": "@@ -34,14 +45,42 @@\n \t@Getter\n \tprivate final ExecutorService executorService;\n \t\n-\tpublic Worker(WorkerInformation info, JobManager jobManager, WorkerStorage storage, QueryExecutor queryExecutor, ExecutorService executorService) {\n-\t\tthis.info = info;\n-\t\tthis.jobManager = jobManager;\n-\t\tthis.storage = storage;\n-\t\tthis.executorService = executorService;\n-\t\tBucketManager bucketManager = new BucketManager(jobManager, storage, info);\n-\t\tstorage.setBucketManager(bucketManager);\n-\t\tthis.queryExecutor = queryExecutor;\n+\t\n+\tpublic Worker(\n+\t\t@NonNull ThreadPoolDefinition queryThreadPoolDefinition,\n+\t\t@NonNull ExecutorService executorService,\n+\t\t@NonNull WorkerStorage storage\n+\t\t) {\n+\t\tthis(\n+\t\t\tnew JobManager(storage.getWorker().getName()),\n+\t\t\tstorage,\n+\t\t\tnew QueryExecutor(queryThreadPoolDefinition.createService(\"QueryExecutor %d\")),\n+\t\t\tstorage.getWorker(),\n+\t\t\texecutorService);\n+\t\t\n+\t\tstorage.setBucketManager(new BucketManager(this.jobManager, this.storage, this.info));\n+\t\t\n+\t}\n+\t\n+\tpublic static Worker newWorker(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4540, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}