{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NzE3MjMy", "number": 1044, "title": "Conditions in Connectors", "bodyText": "", "createdAt": "2020-02-18T16:33:39Z", "url": "https://github.com/bakdata/conquery/pull/1044", "merged": true, "mergeCommit": {"oid": "0868d88e22f45f71d07cfb6f4b67642ee95c1242"}, "closed": true, "closedAt": "2020-03-16T13:46:32Z", "author": {"login": "awildturtok"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFkk7IgH2gAyMzc2NzE3MjMyOmQ3ODBhMTc1MGMzNGEwZjgxY2Y4MzhlNGY4OWZkMmI1ZDQzZDMzN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcON_A8gH2gAyMzc2NzE3MjMyOmYxOGZhYzViMDgxODdmYzk5ODk1YWNmMjgwODdmNGEzMjJkNzJiMTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d780a1750c34a0f81cf838e4f89fd2b5d43d337b", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/d780a1750c34a0f81cf838e4f89fd2b5d43d337b", "committedDate": "2020-02-18T16:32:37Z", "message": "Connectors have conditions now, allowing further simplification of imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccec6b0b7bd5345e9faa63772229c0a1b0b84673", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/ccec6b0b7bd5345e9faa63772229c0a1b0b84673", "committedDate": "2020-02-18T16:53:54Z", "message": "Merge branch 'develop' into feature/connector-condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzQ0Mzgz", "url": "https://github.com/bakdata/conquery/pull/1044#pullrequestreview-361744383", "createdAt": "2020-02-20T09:24:42Z", "commit": {"oid": "ccec6b0b7bd5345e9faa63772229c0a1b0b84673"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToyNDo0MlrOFsL2wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToyODozM1rOFsL_Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NTkwNg==", "bodyText": "Etwas generelle Doku w\u00e4re gut. Ich finde es nicht ersichtlich, was hier berechnet wird", "url": "https://github.com/bakdata/conquery/pull/1044#discussion_r381875906", "createdAt": "2020-02-20T09:24:42Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/CalculateCBlocksJob.java", "diffHunk": "@@ -136,33 +136,37 @@ private void calculateCBlock(CBlock cBlock, ConceptTreeConnector connector, Calc\n \n \t\tcBlock.setMostSpecificChildren(new ArrayList<>(bucket.getNumberOfEvents()));\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccec6b0b7bd5345e9faa63772229c0a1b0b84673"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzI2Nw==", "bodyText": "H\u00e4tte der Test nicht das selbe Ergebnis ohne diese condition?", "url": "https://github.com/bakdata/conquery/pull/1044#discussion_r381877267", "createdAt": "2020-02-20T09:27:03Z", "author": {"login": "thoniTUB"}, "path": "backend/src/test/resources/tests/query/SIMPLE_TREECONCEPT_CONNECTOR_CONDITION_QUERY/SIMPLE_TREECONCEPT_Query.test.json", "diffHunk": "@@ -0,0 +1,72 @@\n+{\n+    \"type\": \"QUERY_TEST\",\n+    \"label\": \"SIMPLE_TREECONCEPT_QUERY Test\",\n+    \"expectedCsv\": \"tests/query/SIMPLE_TREECONCEPT_QUERY/expected.csv\",\n+    \"query\": {\n+        \"type\": \"CONCEPT_QUERY\",\n+        \"root\": {\n+            \"type\": \"CONCEPT\",\n+            \"ids\": [\n+              \"${dataset}.test_tree.test_child1\"\n+            ],\n+            \"tables\": [\n+                {\n+                  \"id\": \"${dataset}.test_tree.test_column\",\n+                    \"filters\": []\n+                }\n+            ]\n+        }\n+    },\n+    \"concepts\": [\n+        {\n+            \"label\": \"test_tree\",\n+            \"type\":\"TREE\",\n+            \"connectors\": {\n+              \"condition\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccec6b0b7bd5345e9faa63772229c0a1b0b84673"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3ODExMA==", "bodyText": "Eine COLUMN_EQUAL condition w\u00fcrde hier denke ich klarer sein", "url": "https://github.com/bakdata/conquery/pull/1044#discussion_r381878110", "createdAt": "2020-02-20T09:28:33Z", "author": {"login": "thoniTUB"}, "path": "backend/src/test/resources/tests/query/SIMPLE_TREECONCEPT_CONNECTOR_CONDITION_QUERY/SIMPLE_TREECONCEPT_Query.test.json", "diffHunk": "@@ -0,0 +1,72 @@\n+{\n+    \"type\": \"QUERY_TEST\",\n+    \"label\": \"SIMPLE_TREECONCEPT_QUERY Test\",\n+    \"expectedCsv\": \"tests/query/SIMPLE_TREECONCEPT_QUERY/expected.csv\",\n+    \"query\": {\n+        \"type\": \"CONCEPT_QUERY\",\n+        \"root\": {\n+            \"type\": \"CONCEPT\",\n+            \"ids\": [\n+              \"${dataset}.test_tree.test_child1\"\n+            ],\n+            \"tables\": [\n+                {\n+                  \"id\": \"${dataset}.test_tree.test_column\",\n+                    \"filters\": []\n+                }\n+            ]\n+        }\n+    },\n+    \"concepts\": [\n+        {\n+            \"label\": \"test_tree\",\n+            \"type\":\"TREE\",\n+            \"connectors\": {\n+              \"condition\": {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzI2Nw=="}, "originalCommit": {"oid": "ccec6b0b7bd5345e9faa63772229c0a1b0b84673"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dccc4b400e75271ca5ad36f7103c2d7611bd0b36", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/dccc4b400e75271ca5ad36f7103c2d7611bd0b36", "committedDate": "2020-02-24T15:22:13Z", "message": "refactoring and documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a7ff7f60bd3b5d322da41369fb93f8b8bdea09", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/33a7ff7f60bd3b5d322da41369fb93f8b8bdea09", "committedDate": "2020-02-25T10:53:16Z", "message": "Merge branch 'feature/connector-condition' of https://github.com/bakdata/conquery into feature/connector-condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6480e98349fe697b65b614c825733dc3d140f4c0", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/6480e98349fe697b65b614c825733dc3d140f4c0", "committedDate": "2020-02-25T11:11:08Z", "message": "made more meaningful test for concept condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f003d9d7f6d7054dd2fbfffc244efb5b81d103", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/d2f003d9d7f6d7054dd2fbfffc244efb5b81d103", "committedDate": "2020-02-25T12:31:51Z", "message": "fixed not having include column in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2e9f00596d1c9c2b57c35b7a86b26e6cbce7df1", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/b2e9f00596d1c9c2b57c35b7a86b26e6cbce7df1", "committedDate": "2020-02-25T13:21:09Z", "message": "fixed not using test's own source files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTQzNjQy", "url": "https://github.com/bakdata/conquery/pull/1044#pullrequestreview-364143642", "createdAt": "2020-02-25T13:36:26Z", "commit": {"oid": "b2e9f00596d1c9c2b57c35b7a86b26e6cbce7df1"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMzozNjoyN1rOFuGQqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMzozOTo1NVrOFuGYCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg4MTM4NQ==", "bodyText": "Ich sehe nur die statische Wildcard Typisierung, wird hier \u00fcberhaupt Generizit\u00e4t benutzt?", "url": "https://github.com/bakdata/conquery/pull/1044#discussion_r383881385", "createdAt": "2020-02-25T13:36:27Z", "author": {"login": "Priehn"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/tree/TreeChildPrefixIndex.java", "diffHunk": "@@ -47,7 +48,7 @@ private static boolean isPrefixMaintainigCondition(CTCondition cond) {\n \t\t\t\t;\n \t}\n \n-\tpublic static void putIndexInto(ConceptTreeNode root) {\n+\tpublic static void putIndexInto(ConceptTreeNode<?> root) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e9f00596d1c9c2b57c35b7a86b26e6cbce7df1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg4MzI3Mg==", "bodyText": "Leider stecke ich nicht tief genug in der EVA um hier was beuteilen zu k\u00f6nnen aber ein Kommentar f\u00e4nde ich ganz hilfreich", "url": "https://github.com/bakdata/conquery/pull/1044#discussion_r383883272", "createdAt": "2020-02-25T13:39:55Z", "author": {"login": "Priehn"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/tree/TreeChildPrefixIndex.java", "diffHunk": "@@ -62,30 +63,33 @@ public static void putIndexInto(ConceptTreeNode root) {\n \n \t\t\tTreeChildPrefixIndex index = new TreeChildPrefixIndex();\n \n-\t\t\tList<ConceptTreeChild> treeChildrenOrig = new ArrayList<>();\n-\t\t\ttreeChildrenOrig.addAll(root.getChildren());\n-\n \t\t\t// collect all prefix children that are itself children of prefix nodes\n \t\t\tMap<String, ConceptTreeChild> gatheredPrefixChildren = new HashMap<>();\n \n-\t\t\tfor (int i = 0; i < treeChildrenOrig.size(); i++) {\n-\t\t\t\tConceptTreeChild child = treeChildrenOrig.get(i);\n+\t\t\tQueue<ConceptTreeChild> treeChildrenOrig = new ArrayDeque<>(root.getChildren());\n+\t\t\tConceptTreeChild child;\n+\n+\t\t\t// Iterate over all children that can be reached deterministically with prefixes\n+\t\t\twhile ((child = treeChildrenOrig.poll()) != null) {\n \t\t\t\tCTCondition condition = child.getCondition();\n \n-\t\t\t\tif(isPrefixMaintainigCondition(condition)) {\n-\t\t\t\t\ttreeChildrenOrig.addAll(child.getChildren());\n-\n-\t\t\t\t\tif (condition instanceof PrefixCondition) {\n-\t\t\t\t\t\tfor (String prefix : ((PrefixCondition) condition).getPrefixes()) {\n-\t\t\t\t\t\t\t// We are interested in the most specific child, therefore the deepest.\n-\t\t\t\t\t\t\tgatheredPrefixChildren.merge(prefix, child,\n-\t\t\t\t\t\t\t\t(newChild, oldChild) -> oldChild.getDepth() > newChild.getDepth() ? oldChild : newChild\n-\t\t\t\t\t\t\t);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\telse {\n+\t\t\t\t// If the Condition is not deterministic wrt to prefixes, we will not build an index over it, but start a new one from there.\n+\t\t\t\tif (!isPrefixMaintainigCondition(condition)) {\n \t\t\t\t\tputIndexInto(child);\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\ttreeChildrenOrig.addAll(child.getChildren());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e9f00596d1c9c2b57c35b7a86b26e6cbce7df1"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa99f1734473db74aaa451a39a05b33ed7e3ef96", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/aa99f1734473db74aaa451a39a05b33ed7e3ef96", "committedDate": "2020-03-02T12:19:16Z", "message": "Update CalculatedValue.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MjAxNTE1", "url": "https://github.com/bakdata/conquery/pull/1044#pullrequestreview-367201515", "createdAt": "2020-03-02T13:36:25Z", "commit": {"oid": "aa99f1734473db74aaa451a39a05b33ed7e3ef96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb2d3431c31e82ad9f3472f53e36a5f49e5955ea", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/bb2d3431c31e82ad9f3472f53e36a5f49e5955ea", "committedDate": "2020-03-06T08:49:15Z", "message": "Merge branch 'develop' into feature/connector-condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62759e7c3114d6cc77084167c558624d73f9c053", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/62759e7c3114d6cc77084167c558624d73f9c053", "committedDate": "2020-03-16T11:42:10Z", "message": "Merge branch 'develop' into feature/connector-condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f18fac5b08187fc99895acf28087f4a322d72b10", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/f18fac5b08187fc99895acf28087f4a322d72b10", "committedDate": "2020-03-16T13:18:37Z", "message": "Merge branch 'develop' into feature/connector-condition"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4718, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}