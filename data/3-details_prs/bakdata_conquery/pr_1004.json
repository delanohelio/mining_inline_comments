{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MzczOTg1", "number": 1004, "title": "Synchronize on bucket assignment and creation", "bodyText": "This will not immediately be merged as the other code creates better outputs but only blocks a bug, not completely avoiding the possible state.", "createdAt": "2020-01-27T08:44:03Z", "url": "https://github.com/bakdata/conquery/pull/1004", "merged": true, "mergeCommit": {"oid": "642401422e4dae359036e801eafb9d5af82469a7"}, "closed": true, "closedAt": "2020-02-04T16:20:41Z", "author": {"login": "awildturtok"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-YqL5AH2gAyMzY3MzczOTg1OjEzNmZiZTY4NDkxZjY4ZGRhYmVjYTA2YTRhZWZkODI1MDJmY2QzYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBEAlgAFqTM1MzExMTk2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "136fbe68491f68ddabeca06a4aefd82502fcd3a4", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/136fbe68491f68ddabeca06a4aefd82502fcd3a4", "committedDate": "2020-01-27T08:42:02Z", "message": "unwind creation of buckets in ImportJob.createMappings. Completely avoids duplicate creation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTkxMjM5", "url": "https://github.com/bakdata/conquery/pull/1004#pullrequestreview-349191239", "createdAt": "2020-01-28T08:21:25Z", "commit": {"oid": "136fbe68491f68ddabeca06a4aefd82502fcd3a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODoyMToyNVrOFicQJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwODoyMToyNVrOFicQJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1ODc4OQ==", "bodyText": "Hast du hiermit noch etwas vor?", "url": "https://github.com/bakdata/conquery/pull/1004#discussion_r371658789", "createdAt": "2020-01-28T08:21:25Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java", "diffHunk": "@@ -95,13 +95,24 @@ public void execute() throws JSONException {\n \n \t\t\t//partition the new IDs between the slaves\n \t\t\tlog.debug(\"\\tpartition new IDs\");\n-\t\t\tfor (int bucket : primaryMapping.getNewBuckets()) {\n-\t\t\t\tnamespace.addResponsibility(bucket);\n+\n+\t\t\t// Allocate a responsibility for all yet unassigned buckets.\n+\t\t\tsynchronized (namespace) {\n+\t\t\t\tfor (int bucket : primaryMapping.getUsedBuckets()) {\n+\t\t\t\t\tif (namespace.getResponsibleWorkerForBucket(bucket) != null) {\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tnamespace.addResponsibility(bucket);\n+\t\t\t\t}\n \t\t\t}\n+\n \t\t\tfor (WorkerInformation w : namespace.getWorkers()) {\n \t\t\t\tw.send(new UpdateWorkerBucket(w));\n \t\t\t}\n-\t\t\tnamespace.updateWorkerMap();\n+\n+\t\t\tsynchronized (namespace) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe68491f68ddabeca06a4aefd82502fcd3a4"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a50d36c7722e86ecc3408bcd7a42b1c1bf14cc1", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/9a50d36c7722e86ecc3408bcd7a42b1c1bf14cc1", "committedDate": "2020-01-28T14:02:00Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91a7bbb56690284ee6d2d4c997a5c1adf31ae6e1", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/91a7bbb56690284ee6d2d4c997a5c1adf31ae6e1", "committedDate": "2020-02-03T13:54:52Z", "message": "Merge branch 'develop' into feature/synchronize-on-bucket-assignment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f158c8703522ff07b9d68677e7ad6edf2ddb710", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/6f158c8703522ff07b9d68677e7ad6edf2ddb710", "committedDate": "2020-02-04T16:16:25Z", "message": "Update Namespace.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9114cbd2e7a49580a927f51dd8be47b13046051", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/d9114cbd2e7a49580a927f51dd8be47b13046051", "committedDate": "2020-02-04T16:18:17Z", "message": "Update Namespace.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMTExOTYw", "url": "https://github.com/bakdata/conquery/pull/1004#pullrequestreview-353111960", "createdAt": "2020-02-04T16:20:16Z", "commit": {"oid": "6f158c8703522ff07b9d68677e7ad6edf2ddb710"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4695, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}