{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0OTg1NjEw", "number": 996, "title": "Feature/fix can download permission interpretation", "bodyText": "Sorry, my previous implementation didn't support multiple permissions properly yet.\nThis also fixes the fact that changing the dataset could affect the canDownload permission for a finished query result (in the bottom right)", "createdAt": "2020-01-20T20:08:45Z", "url": "https://github.com/bakdata/conquery/pull/996", "merged": true, "mergeCommit": {"oid": "59f60a483c2c6b4f1f91053344a9ace44c08048c"}, "closed": true, "closedAt": "2020-01-22T14:58:22Z", "author": {"login": "Kadrian"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8SAJNAH2gAyMzY0OTg1NjEwOmVhNWY3NzIyYjMzYTI2MmRkZGFiNzE4MTZhOGE0ODk3MWJkZTBmYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8zcCVAH2gAyMzY0OTg1NjEwOmY3ZmI5NzAxNDE2YjkyZmM5MDZmNTRhMzI1MWFiMmE4ZTIwMjUzZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea5f7722b33a262dddab71816a8a48971bde0fa6", "author": {"user": {"login": "Kadrian", "name": "Kai Rollmann"}}, "url": "https://github.com/bakdata/conquery/commit/ea5f7722b33a262dddab71816a8a48971bde0fa6", "committedDate": "2020-01-20T19:48:50Z", "message": "Allow multiple datasets permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b184732b87d2e324779dc17edb75939370f13069", "author": {"user": {"login": "Kadrian", "name": "Kai Rollmann"}}, "url": "https://github.com/bakdata/conquery/commit/b184732b87d2e324779dc17edb75939370f13069", "committedDate": "2020-01-20T20:07:10Z", "message": "Consider datasetId of a queryResult for permissions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NTE5MzI4", "url": "https://github.com/bakdata/conquery/pull/996#pullrequestreview-345519328", "createdAt": "2020-01-20T20:26:20Z", "commit": {"oid": "b184732b87d2e324779dc17edb75939370f13069"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQyMDoyNjoyMVrOFfokug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQyMDoyNjoyMVrOFfokug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcxNDkzOA==", "bodyText": "Zur vollen Unterst\u00fctzung der Wildcardpermissions m\u00fcsste das denke ich so aus sehen:\np =>\n      (p.domains.includes(\"datasets\") ||  p.domains.includes(\"*\")) &&\n      (p.abilities.includes(\"download\") ||  p.abilities.includes(\"*\") || (p.abilities.isEmpty() && !p.domains.isEmpty())) &&\n      (p.targets.includes(dataset) || p.targets.includes(\"*\") || (p.targets.isEmpty() && !p.abilities.isEmpty()))", "url": "https://github.com/bakdata/conquery/pull/996#discussion_r368714938", "createdAt": "2020-01-20T20:26:21Z", "author": {"login": "thoniTUB"}, "path": "frontend/lib/js/user/selectors.js", "diffHunk": "@@ -4,23 +4,25 @@ export function selectPermissions(state) {\n     : null;\n }\n \n-export function canDownloadResult(state) {\n+export function canDownloadResult(state, datasetId?: string) {\n   const permissions = selectPermissions(state);\n \n   if (!permissions) return false;\n \n-  const permission = permissions.find(\n-    p => p.domains.includes(\"datasets\") && p.abilities.includes(\"download\")\n-  );\n-\n   const { selectedDatasetId } = state.datasets;\n \n-  return (\n-    !!permission &&\n-    (permission.targets.includes(\"*\") ||\n-      // TODO: This makes not that much sense yet, because\n-      //       the dataset shouldn't be the selected one, but the one\n-      //       which relates to the result\n-      permission.targets.includes(selectedDatasetId))\n+  // TODO: Fallback to selectedDatasetId probably doesn't make that much sense,\n+  //       because the dataset to use should probably always relates to the result\n+  //       or entity, that is being checked here.\n+  //\n+  const dataset = datasetId || selectedDatasetId;\n+\n+  const permission = permissions.find(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b184732b87d2e324779dc17edb75939370f13069"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODM2MDY3", "url": "https://github.com/bakdata/conquery/pull/996#pullrequestreview-345836067", "createdAt": "2020-01-21T12:21:00Z", "commit": {"oid": "b184732b87d2e324779dc17edb75939370f13069"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7fb9701416b92fc906f54a3251ab2a8e20253e3", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/f7fb9701416b92fc906f54a3251ab2a8e20253e3", "committedDate": "2020-01-22T10:46:10Z", "message": "Merge branch 'develop' into feature/fix-can-download-permission-interpretation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4688, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}