{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDk1NDY3", "number": 1060, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMjoyNjo1NVrODkP4tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMjoyNjo1NVrODkP4tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MzM1NjA1OnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/tasks/QueryCleanupTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMjoyNjo1NVrOFwduuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMjoyNjo1NVrOFwduuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM2MzA2NA==", "bodyText": "Gut gel\u00f6st :)", "url": "https://github.com/bakdata/conquery/pull/1060#discussion_r386363064", "createdAt": "2020-03-02T12:26:55Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/tasks/QueryCleanupTask.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.bakdata.conquery.tasks;\n+\n+import java.io.PrintWriter;\n+import java.time.LocalDate;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.bakdata.conquery.io.xodus.MasterMetaStorage;\n+import com.bakdata.conquery.models.execution.ManagedExecution;\n+import com.bakdata.conquery.models.identifiable.ids.specific.ManagedExecutionId;\n+import com.bakdata.conquery.models.query.ManagedQuery;\n+import com.bakdata.conquery.models.query.concept.specific.CQReusedQuery;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.google.common.collect.ImmutableMultimap;\n+import io.dropwizard.servlets.tasks.Task;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.ArrayUtils;\n+\n+/**\n+ * Dropwizard Task deleting queries that are not used anymore. Defined as:\n+ * \t- not named\n+ * \t- older than 30 days\n+ * \t- is not shared\n+ * \t- no tags\n+ * \t- not referenced by other queries\n+ */\n+@Slf4j\n+public class QueryCleanupTask extends Task {\n+\n+\tMasterMetaStorage storage;\n+\n+\tpublic QueryCleanupTask(MasterMetaStorage storage) {\n+\t\tsuper(\"query-cleanup\");\n+\t\tthis.storage = storage;\n+\t}\n+\n+\t@Override\n+\tpublic void execute(ImmutableMultimap<String, String> parameters, PrintWriter output) throws Exception {\n+\n+\t\t// Iterate for as long as no changes are needed (this is because queries can be referenced by other queries)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0aabaf7fb3377e7a00c1fb4f01ad151a961336e"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1429, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}