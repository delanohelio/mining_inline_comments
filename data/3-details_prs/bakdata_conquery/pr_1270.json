{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NzA5MzU5", "number": 1270, "title": "Rework of All Ids Table for External Query", "bodyText": "", "createdAt": "2020-07-14T07:47:51Z", "url": "https://github.com/bakdata/conquery/pull/1270", "merged": true, "mergeCommit": {"oid": "359289227c6a470e99a89c5c72f23b3289fd6397"}, "closed": true, "closedAt": "2020-07-24T10:48:35Z", "author": {"login": "awildturtok"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTrtefAH2gAyNDQ4NzA5MzU5OjIzMDA4NmU3MjU5NjgxYzUwNjUzYzhjOGQ5MTI4YmNjNDI2OGMyMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4BpBOgH2gAyNDQ4NzA5MzU5OmRhY2IwM2I3NGRkMmVkODk4ZWNlYTg1ZGNjOGYyY2FiMTc2ZDUwZDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "230086e7259681c50653c8c8d9128bcc4268c211", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/230086e7259681c50653c8c8d9128bcc4268c211", "committedDate": "2020-04-02T12:46:14Z", "message": "try and refactor ALL_IDS_TABLE into less unreliable with regards to re-imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae206410b91c214e447a33d12ac716ca4f5a1d8a", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/ae206410b91c214e447a33d12ac716ca4f5a1d8a", "committedDate": "2020-07-14T07:29:18Z", "message": "Manual reimplementation towards ALL_ID_TABLE: This has the same behaviour as what's currently happening except that we can now control it completely."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11c8a668505589bfafd7a8665a116a608256382a", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/11c8a668505589bfafd7a8665a116a608256382a", "committedDate": "2020-07-20T10:25:03Z", "message": "some documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "922024bf633ed523f48856c20739fc0d58c8ea33", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/922024bf633ed523f48856c20739fc0d58c8ea33", "committedDate": "2020-07-20T13:57:36Z", "message": "Remove as many references to ALL_IDS_TABLE as possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ba8a67aa567bc326d59a2567d1263f680f71e5", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/e8ba8a67aa567bc326d59a2567d1263f680f71e5", "committedDate": "2020-07-20T13:58:33Z", "message": "Refactor nextTable towards taking a tableId instead of a Table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25fd72e891416e27e89d114426b928e294c6654a", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/25fd72e891416e27e89d114426b928e294c6654a", "committedDate": "2020-07-20T15:26:51Z", "message": "Fix a bug over equality with change to TableId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be63dc241eb7751a2f079cfe2a3cb6c5f51c8504", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/be63dc241eb7751a2f079cfe2a3cb6c5f51c8504", "committedDate": "2020-07-20T15:28:29Z", "message": "Change ConceptQueryPlan to always run a single pass with ConqueryConstants.ALL_IDS_TABLE and refactor ExternalNode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6312ee6f58921ba5d97f103f60067db8decc4f1", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/e6312ee6f58921ba5d97f103f60067db8decc4f1", "committedDate": "2020-07-21T13:01:27Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe401a918465d4fb541d862aa21f8c4a3a3e4174", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/fe401a918465d4fb541d862aa21f8c4a3a3e4174", "committedDate": "2020-07-21T13:04:05Z", "message": "Some more documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86b15af1e29b696000add83ef24d07a81583fc69", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/86b15af1e29b696000add83ef24d07a81583fc69", "committedDate": "2020-07-21T13:56:21Z", "message": "Fix counting of Imports in DeletionTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9c63fc6c29795c4da7e0b300ef0a5db6c209764", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/f9c63fc6c29795c4da7e0b300ef0a5db6c209764", "committedDate": "2020-07-21T14:14:02Z", "message": "Delete ImportDeletionTest2.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8d834cfcd264eb47ee4a477631c9e5bc9aeaff5", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/c8d834cfcd264eb47ee4a477631c9e5bc9aeaff5", "committedDate": "2020-07-21T14:20:48Z", "message": "Add Dataset.isAllIdsTable and make requiredTables ThreadLocal to avoid locking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8438ace6add1409aec90148b10e4099241d72874", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/8438ace6add1409aec90148b10e4099241d72874", "committedDate": "2020-07-22T14:24:10Z", "message": "Merge branch 'develop' into feature/all-ids-table-empty-imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efe35e02dfd2c5bd61999be141c7cbc719997992", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/efe35e02dfd2c5bd61999be141c7cbc719997992", "committedDate": "2020-07-22T14:53:54Z", "message": "Fix post merge problems"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODk4Mzc1", "url": "https://github.com/bakdata/conquery/pull/1270#pullrequestreview-453898375", "createdAt": "2020-07-23T07:41:29Z", "commit": {"oid": "efe35e02dfd2c5bd61999be141c7cbc719997992"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNzo0MToyOVrOG1_dig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNzo0NjowMlrOG1_lsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2NzQ2Ng==", "bodyText": "Ich glaube dieser Log braucht jetzt keinen ProgressReport mehr :D", "url": "https://github.com/bakdata/conquery/pull/1270#discussion_r459267466", "createdAt": "2020-07-23T07:41:29Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java", "diffHunk": "@@ -115,14 +111,7 @@ public void execute() throws JSONException {\n \n \t\t\t//update the allIdsTable\n \t\t\tlog.info(\"\\tupdating id information\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe35e02dfd2c5bd61999be141c7cbc719997992"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2ODAzMw==", "bodyText": "Das w\u00e4re f\u00fcr mich eine Info, aber keine warning", "url": "https://github.com/bakdata/conquery/pull/1270#discussion_r459268033", "createdAt": "2020-07-23T07:42:45Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java", "diffHunk": "@@ -138,38 +127,11 @@ public void execute() throws JSONException {\n \t\t\tthis.progressReporter.report(1);\n \t\t\tint bucketSize = ConqueryConfig.getInstance().getCluster().getEntityBucketSize();\n \n-\t\t\t//import the new ids into the ALL_IDS_TABLE\n \t\t\tif (primaryMapping.getNewIds() != null) {\n-\n-\t\t\t\tBlockFactory factory = allIdsImp.getBlockFactory();\n-\n-\t\t\t\tInt2ObjectMap<ImportBucket> allIdsBuckets = new Int2ObjectOpenHashMap<>(primaryMapping.getUsedBuckets().size());\n-\t\t\t\tInt2ObjectMap<List<byte[]>> allIdsBytes = new Int2ObjectOpenHashMap<>(primaryMapping.getUsedBuckets().size());\n-\n-\t\t\t\ttry (Output buffer = new Output(2048)) {\n-\t\t\t\t\tProgressReporter child = this.progressReporter.subJob(5);\n-\t\t\t\t\tchild.setMax(primaryMapping.getNumberOfNewIds());\n-\n-\t\t\t\t\tfor (int entityId : RangeUtil.iterate(primaryMapping.getNewIds())) {\n-\t\t\t\t\t\tbuffer.reset();\n-\t\t\t\t\t\tBucket bucket = factory.create(allIdsImp, Collections.singletonList(new Object[0]));\n-\t\t\t\t\t\tbucket.writeContent(buffer);\n-\n-\t\t\t\t\t\t//copy content into ImportBucket\n-\t\t\t\t\t\tint bucketNumber = Entity.getBucket(entityId, bucketSize);\n-\n-\t\t\t\t\t\tImportBucket impBucket = allIdsBuckets\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t .computeIfAbsent(bucketNumber, b -> new ImportBucket(new BucketId(allIdsImp.getId(), b)));\n-\n-\t\t\t\t\t\timpBucket.getIncludedEntities().add(entityId);\n-\n-\t\t\t\t\t\tallIdsBytes.computeIfAbsent(bucketNumber, i -> new ArrayList<>())\n-\t\t\t\t\t\t\t\t   .add(buffer.toBytes());\n-\n-\t\t\t\t\t\tchild.report(1);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\tsendBuckets(primaryMapping, allIdsBuckets, allIdsBytes);\n+\t\t\t\tlog.info(\"Primary mapping contained {} new Ids\", primaryMapping.getNumberOfNewIds());\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tlog.warn(\"Primary mapping contained no new Ids.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe35e02dfd2c5bd61999be141c7cbc719997992"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2OTU1Mw==", "bodyText": "eigentlich w\u00fcrde ich gerne von TableIds auf den Workern weg kommen", "url": "https://github.com/bakdata/conquery/pull/1270#discussion_r459269553", "createdAt": "2020-07-23T07:46:02Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/filter/AggregationResultFilterNode.java", "diffHunk": "@@ -32,7 +30,7 @@ public void collectRequiredTables(Set<TableId> out) {\n \t}\n \n \t@Override\n-\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\tpublic void nextTable(QueryExecutionContext ctx, TableId currentTable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe35e02dfd2c5bd61999be141c7cbc719997992"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af3916e1e5fa332e7b00357a14a355769373faa", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/1af3916e1e5fa332e7b00357a14a355769373faa", "committedDate": "2020-07-23T15:32:29Z", "message": "Reduce no longer used logging and code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c302eb0221123d3da01e8de4776e672b49be6f9", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/9c302eb0221123d3da01e8de4776e672b49be6f9", "committedDate": "2020-07-23T16:59:25Z", "message": "fix ProgressReporter usage in ImportJob"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1f8854c528c066760878a3a8442fa87518d0a3d", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/b1f8854c528c066760878a3a8442fa87518d0a3d", "committedDate": "2020-07-23T17:26:57Z", "message": "Merge branch 'develop' into feature/all-ids-table-empty-imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjY3MjQ2", "url": "https://github.com/bakdata/conquery/pull/1270#pullrequestreview-454667246", "createdAt": "2020-07-24T06:54:57Z", "commit": {"oid": "b1f8854c528c066760878a3a8442fa87518d0a3d"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwNjo1NDo1N1rOG2k6RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwNjo1NDo1N1rOG2k6RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg4MTAyOQ==", "bodyText": "Jetzt passt die Fehlermeldung nicht mehr", "url": "https://github.com/bakdata/conquery/pull/1270#discussion_r459881029", "createdAt": "2020-07-24T06:54:57Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterImpl.java", "diffHunk": "@@ -84,12 +84,14 @@ public void report(double steps) {\n \n \t@Override\n \tpublic void setMax(double max) {\n-\t\tif(getProgress() != 0) {\n+\t\tif(getProgress() > max) {\n \t\t\tthrow new IllegalStateException(\"No modification of Limits allowed after progress has been made\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1f8854c528c066760878a3a8442fa87518d0a3d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25bca2d69b6d9170df46361f1f07dd79e555332b", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/25bca2d69b6d9170df46361f1f07dd79e555332b", "committedDate": "2020-07-24T09:48:15Z", "message": "cleanup ProgressReporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9eb79fa9d52d00f9a1fa738c0e5e5d1bfd6091", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/4c9eb79fa9d52d00f9a1fa738c0e5e5d1bfd6091", "committedDate": "2020-07-24T09:52:31Z", "message": "fix ProgressReporterTest to not go over max"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "802af0bb81ffc06b8dc2469e721e495a00dae02c", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/802af0bb81ffc06b8dc2469e721e495a00dae02c", "committedDate": "2020-07-24T10:18:39Z", "message": "Change ETA estimation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265afb07474ea15fc0ac9b0cfcc2a7c65bea35c0", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/265afb07474ea15fc0ac9b0cfcc2a7c65bea35c0", "committedDate": "2020-07-24T10:25:39Z", "message": "Merge branch 'develop' into feature/all-ids-table-empty-imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07d3b1250b8c1ff6ca77681f96ceefedc2ba962", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/c07d3b1250b8c1ff6ca77681f96ceefedc2ba962", "committedDate": "2020-07-24T10:34:25Z", "message": "Change ProgressReporter sizes to long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0Nzg2OTE3", "url": "https://github.com/bakdata/conquery/pull/1270#pullrequestreview-454786917", "createdAt": "2020-07-24T10:34:51Z", "commit": {"oid": "4c9eb79fa9d52d00f9a1fa738c0e5e5d1bfd6091"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ede948a5ffad94efa2d00c11a925f59366329a", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/54ede948a5ffad94efa2d00c11a925f59366329a", "committedDate": "2020-07-24T10:36:55Z", "message": "Merge branch 'develop' into feature/all-ids-table-empty-imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dacb03b74dd2ed898ecea85dcc8f2cab176d50d9", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/dacb03b74dd2ed898ecea85dcc8f2cab176d50d9", "committedDate": "2020-07-24T10:40:33Z", "message": "fix merging error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4491, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}