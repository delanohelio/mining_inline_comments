{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTE2NzE1", "number": 1085, "title": "Feature/concept permissions", "bodyText": "", "createdAt": "2020-03-17T15:44:02Z", "url": "https://github.com/bakdata/conquery/pull/1085", "merged": true, "mergeCommit": {"oid": "6291b4efb7492cbb51183dd7bdb6206fc6c3ef3d"}, "closed": true, "closedAt": "2020-04-02T12:21:43Z", "author": {"login": "thoniTUB"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOki4LAH2gAyMzg5OTE2NzE1OmM5Mjg0NTcyNDBkOGEwNGYyYmVhNjM3YWJmMWY0YzEzNWQ1ZDZkMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTrMm-AH2gAyMzg5OTE2NzE1OjVkZWQ3MmY1NjQ2M2NkNDcwZThmM2Q1NTVhY2YxNGM2YWFkOGI2YjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c928457240d8a04f2bea637abf1f4c135d5d6d37", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c928457240d8a04f2bea637abf1f4c135d5d6d37", "committedDate": "2020-03-17T15:35:42Z", "message": "creates new Concept Permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eed321b1299beaea329feaf3526966126599277", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/7eed321b1299beaea329feaf3526966126599277", "committedDate": "2020-03-17T15:37:16Z", "message": "WIP resolve query description before permission check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0dca10c9dc229230542f8e640b297cb9fe7f56a", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/f0dca10c9dc229230542f8e640b297cb9fe7f56a", "committedDate": "2020-03-18T10:14:11Z", "message": "WIP structure query execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f13c4a78aa695308e86752e09c19d9dc6ca1890", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/2f13c4a78aa695308e86752e09c19d9dc6ca1890", "committedDate": "2020-03-19T12:17:58Z", "message": "sets correct arguments for concept permission builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d8c5fab5bdbaccea26e71c18e31261c6cd1c901", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/6d8c5fab5bdbaccea26e71c18e31261c6cd1c901", "committedDate": "2020-03-19T12:47:09Z", "message": "WIP custom AuthorizationInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fe172b2004139788b6e63caab8b5457453d782e", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/2fe172b2004139788b6e63caab8b5457453d782e", "committedDate": "2020-03-20T07:12:18Z", "message": "correct concept permission CPS Type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8641debfa3ead95b045aafadadea1478fd9c4e1a", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/8641debfa3ead95b045aafadadea1478fd9c4e1a", "committedDate": "2020-03-20T08:30:11Z", "message": "uses custom authorizationInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef80f9c0b8ee8a1b8b14ac7bfec1b39c1dfd129", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/6ef80f9c0b8ee8a1b8b14ac7bfec1b39c1dfd129", "committedDate": "2020-03-20T13:17:27Z", "message": "resolve all query elements independent of execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48bee51a4d280b659fbd3e40a8034f320e3e55af", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/48bee51a4d280b659fbd3e40a8034f320e3e55af", "committedDate": "2020-03-20T13:18:02Z", "message": "check concept permissions on query submission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "338e0db5f2d5635c6a984bb94f0fc90a048fdeeb", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/338e0db5f2d5635c6a984bb94f0fc90a048fdeeb", "committedDate": "2020-03-23T08:53:27Z", "message": "WIP: centralized Query traversing and evaluation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "828faf5cae2e996c7bdb5e9f2cdceadadad57043", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/828faf5cae2e996c7bdb5e9f2cdceadadad57043", "committedDate": "2020-03-24T08:01:25Z", "message": "checks concepts upon query submission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41718d9626dd910b6ca5fd8c1d856dadef46532b", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/41718d9626dd910b6ca5fd8c1d856dadef46532b", "committedDate": "2020-03-24T08:01:57Z", "message": "checks concepts upon concept list retrieval"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b397d90a83e251c12bd9b1ec1b70806e2bbef60", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/0b397d90a83e251c12bd9b1ec1b70806e2bbef60", "committedDate": "2020-03-24T09:48:39Z", "message": "Merge branch 'develop' into feature/concept-permissions\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/forms/export/AbsExportGenerator.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/forms/managed/AbsoluteFormQuery.java\n#\tbackend/src/test/java/com/bakdata/conquery/integration/json/FormTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2da9a1a37131040abdbd3c8815396111e832420f", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/2da9a1a37131040abdbd3c8815396111e832420f", "committedDate": "2020-03-24T09:48:57Z", "message": "Merge 0b397d90a83e251c12bd9b1ec1b70806e2bbef60 into f0c289f8255dc3bfb52902299620d0204c28b7ba"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7d2ceed11b912cb148915a1378c05367dec4049", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/d7d2ceed11b912cb148915a1378c05367dec4049", "committedDate": "2020-03-24T09:50:43Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3b723b52e377c1646ed3c099bf0177944375a5b", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/d3b723b52e377c1646ed3c099bf0177944375a5b", "committedDate": "2020-03-24T10:08:27Z", "message": "fix resolving of previous queries in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5bd83f088089814a180797791dcb07d991ec3fa", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/f5bd83f088089814a180797791dcb07d991ec3fa", "committedDate": "2020-03-24T10:08:40Z", "message": "Merge branch 'feature/concept-permissions' of https://github.com/bakdata/conquery into feature/concept-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eab585f29b32b44503ed8acaec5c078c757e27a", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/7eab585f29b32b44503ed8acaec5c078c757e27a", "committedDate": "2020-03-25T09:36:09Z", "message": "more concrete return type on util function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "509d9e96a3acde3601f9065187952d652fa6806d", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/509d9e96a3acde3601f9065187952d652fa6806d", "committedDate": "2020-03-25T09:36:43Z", "message": "adds helper function to generate concept permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f553e22eb745f2c07be6e0363099743f18d753c7", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/f553e22eb745f2c07be6e0363099743f18d753c7", "committedDate": "2020-03-25T09:37:35Z", "message": "adds permission check on concept download"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2d564b7aac0ff7a8b18613808458a8505005a4f", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c2d564b7aac0ff7a8b18613808458a8505005a4f", "committedDate": "2020-03-25T09:56:56Z", "message": "reorders status generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5535d84cd94607e9c14622c4fcae039470268699", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/5535d84cd94607e9c14622c4fcae039470268699", "committedDate": "2020-03-25T10:02:34Z", "message": "Merge c2d564b7aac0ff7a8b18613808458a8505005a4f into f0c289f8255dc3bfb52902299620d0204c28b7ba"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d39ab2a0b3a0d13a252f651f8dfd1acdcd185c7f", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/d39ab2a0b3a0d13a252f651f8dfd1acdcd185c7f", "committedDate": "2020-03-25T10:04:29Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c1fc02e546ddb26de199b71db60740a352e42d4", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/3c1fc02e546ddb26de199b71db60740a352e42d4", "committedDate": "2020-03-25T10:56:11Z", "message": "clean up method interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6335e6f4bcda43f1b72003cee3909c07f79dcd9a", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/6335e6f4bcda43f1b72003cee3909c07f79dcd9a", "committedDate": "2020-03-25T10:56:28Z", "message": "Merge branch 'feature/slim-stored-query-status' of https://github.com/bakdata/conquery into feature/slim-stored-query-status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19473f5cffa62ce7b0f2edeab1d31c2c7a5b93f8", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/19473f5cffa62ce7b0f2edeab1d31c2c7a5b93f8", "committedDate": "2020-03-25T11:00:58Z", "message": "Merge branch 'feature/slim-stored-query-status' into feature/concept-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e14030685e580899a8b0d1b865b683d50fb86f26", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/e14030685e580899a8b0d1b865b683d50fb86f26", "committedDate": "2020-03-25T11:45:28Z", "message": "adapt permission collection to check after resolve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fbdb5f537f8cc57390d44c97ab9630acdc1b06b", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/7fbdb5f537f8cc57390d44c97ab9630acdc1b06b", "committedDate": "2020-03-25T11:48:19Z", "message": "adds canExpand member to status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36729e17e78e116ef6b72c1fde6820cee29187f", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/a36729e17e78e116ef6b72c1fde6820cee29187f", "committedDate": "2020-03-25T11:50:25Z", "message": "Merge branch 'develop' into feature/concept-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c4b3c3279b3c9ad32f7526d59526ae08b9d53e", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/55c4b3c3279b3c9ad32f7526d59526ae08b9d53e", "committedDate": "2020-03-25T13:39:23Z", "message": "Merge branch 'develop' into feature/concept-permissions\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/execution/ManagedExecution.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff60a165d7e6abd153f191d2c6816fa362a4690b", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/ff60a165d7e6abd153f191d2c6816fa362a4690b", "committedDate": "2020-03-25T13:39:43Z", "message": "Merge 55c4b3c3279b3c9ad32f7526d59526ae08b9d53e into 300d373cf00c7c1d2fbe7ff77fcc36b9958ed80c"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6190a2ecf840bd083d3e307f9384de4b2bbd1f3f", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/6190a2ecf840bd083d3e307f9384de4b2bbd1f3f", "committedDate": "2020-03-25T13:41:35Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549770a9a2e173421962ea195ded4d768c6bd6ed", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/549770a9a2e173421962ea195ded4d768c6bd6ed", "committedDate": "2020-03-25T16:13:54Z", "message": "fixes concept permission generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79233d17f1b002cc4dcd44772dee8a2b4a265f2", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/f79233d17f1b002cc4dcd44772dee8a2b4a265f2", "committedDate": "2020-03-25T16:18:30Z", "message": "adds test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c17f6b720820a08ac123eb5b0cc9485bc77c51e4", "committedDate": "2020-03-25T16:22:53Z", "message": "makes helper method public"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjQzMTQ3", "url": "https://github.com/bakdata/conquery/pull/1085#pullrequestreview-383643147", "createdAt": "2020-03-30T08:43:06Z", "commit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzQwMTM4", "url": "https://github.com/bakdata/conquery/pull/1085#pullrequestreview-382740138", "createdAt": "2020-03-27T10:30:55Z", "commit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMDozMDo1NVrOF8rZPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1OTozMVrOF9f_hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2OTg1NQ==", "bodyText": "was macht das?", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r399169855", "createdAt": "2020-03-27T10:30:55Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/QueryDescription.java", "diffHunk": "@@ -40,16 +46,42 @@\n \n \t\n \tSet<ManagedExecutionId> collectRequiredQueries();\n+\t\n+\t/**\n+\t * Initializes a submitted description using the provided context.\n+\t * All parameters that are set in this phase should be internal or cleanly serializable/deserializable.\n+\t * @param context Holds information which can be used for the initialize the description of the query to be executed.\n+\t */\n+\tQueryDescription resolve(QueryResolveContext context);\n+\t\n+\tdefault void addVisitors(@NonNull ClassToInstanceMap<QueryVisitor> visitors) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE3MTA4Mg==", "bodyText": "Oben asserten, dass du auch einen NSIdCollector hast", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r399171082", "createdAt": "2020-03-27T10:33:19Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/QueryDescription.java", "diffHunk": "@@ -40,16 +46,42 @@\n \n \t\n \tSet<ManagedExecutionId> collectRequiredQueries();\n+\t\n+\t/**\n+\t * Initializes a submitted description using the provided context.\n+\t * All parameters that are set in this phase should be internal or cleanly serializable/deserializable.\n+\t * @param context Holds information which can be used for the initialize the description of the query to be executed.\n+\t */\n+\tQueryDescription resolve(QueryResolveContext context);\n+\t\n+\tdefault void addVisitors(@NonNull ClassToInstanceMap<QueryVisitor> visitors) {\n+\t\t// Register visitors for permission checks\n+\t\tvisitors.putInstance(QueryUtils.NamespacedIdCollector.class, new QueryUtils.NamespacedIdCollector());\n+\t\tvisitors.putInstance(QueryUtils.ExternalIdChecker.class, new QueryUtils.ExternalIdChecker());\n+\t}\n \n \t/**\n-\t * Check implementation specific permissions.\n+\t * Check implementation specific permissions. Is called after all visitors have been registered and executed.\n \t */\n-\tdefault void checkPermissions(@NonNull User user) {\n-\t\t// Also look into the query and check the datasets\n-\t\tauthorizeReadDatasets(user, this);\n-\t\t// Check reused query\n+\tdefault void collectPermissions(@NonNull ClassToInstanceMap<QueryVisitor> visitors, Collection<Permission> requiredPermissions, DatasetId submittedDataset) {\n+\t\t// Generate DatasetPermissions\n+\t\tvisitors.getInstance(QueryUtils.NamespacedIdCollector.class).getIds().stream()\n+\t\t\t.map(NamespacedId::getDataset)\n+\t\t\t.distinct()\n+\t\t\t.map(dId -> DatasetPermission.onInstance(Ability.READ, dId))\n+\t\t\t.collect(Collectors.toCollection(() -> requiredPermissions));\n+\t\t\n+\t\t// Generate ConceptPermissions\n+\t\tQueryUtils.generateConceptReadPermissions(visitors.getInstance(QueryUtils.NamespacedIdCollector.class), requiredPermissions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE3Mjc1OQ==", "bodyText": "Warum der Wechsel zu interface?", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r399172759", "createdAt": "2020-03-27T10:36:37Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/forms/Form.java", "diffHunk": "@@ -1,47 +1,54 @@\n package com.bakdata.conquery.apiv1.forms;\n \n+import java.util.Collection;\n import java.util.List;\n import java.util.Map;\n \n import com.bakdata.conquery.apiv1.QueryDescription;\n-import com.bakdata.conquery.models.auth.entities.User;\n import com.bakdata.conquery.models.auth.permissions.Ability;\n import com.bakdata.conquery.models.auth.permissions.FormPermission;\n+import com.bakdata.conquery.models.execution.ManagedExecution;\n import com.bakdata.conquery.models.forms.managed.ManagedForm;\n import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.ManagedExecutionId;\n import com.bakdata.conquery.models.identifiable.ids.specific.UserId;\n+import com.bakdata.conquery.models.query.IQuery;\n import com.bakdata.conquery.models.query.ManagedQuery;\n+import com.bakdata.conquery.models.query.QueryResolveContext;\n+import com.bakdata.conquery.models.query.visitor.QueryVisitor;\n import com.bakdata.conquery.models.worker.Namespaces;\n-import lombok.Getter;\n+import com.google.common.collect.ClassToInstanceMap;\n import lombok.NonNull;\n-import lombok.Setter;\n+import org.apache.shiro.authz.Permission;\n \n /**\n  * API representation of a form query.\n  */\n-@Getter\n-@Setter\n-public abstract class Form implements QueryDescription {\n+public interface Form extends QueryDescription {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE3Mzk5MA==", "bodyText": "overrides", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r399173990", "createdAt": "2020-03-27T10:38:56Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/auth/ConqueryAuthorizationRealm.java", "diffHunk": "@@ -67,5 +72,51 @@ public Object getCredentials() {\n \t\t}\n \t\t\n \t}\n+\t\n+\t/**\n+\t * This AuthorizationInfo handles the collection of large amounts of {@link Permission}s by wrapping collections into a view\n+\t * instead of running an iterator over them. This also prevents a {@link ConcurrentModificationException} which occurred when \n+\t * Permission were collected\n+\t *\n+\t */\n+\t@SuppressWarnings(\"serial\")\n+\tpublic static class ConqueryAuthorizationInfo extends SimpleAuthorizationInfo {\n+\t\t@Override\n+\t\tpublic void addRole(String role) {\n+\t\t\tthrow new UnsupportedOperationException();\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic void addRoles(Collection<String> roles) {\n+\t\t\tthrow new UnsupportedOperationException();\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic void addStringPermission(String permission) {\n+\t\t\tthrow new UnsupportedOperationException();\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic void addStringPermissions(Collection<String> permissions) {\n+\t\t\tthrow new UnsupportedOperationException();\n+\t\t}\n+\t\t\n+\t\t@Override\n+\t\tpublic void addObjectPermission(Permission permission) {\n+\t\t\tthrow new UnsupportedOperationException();\n+\t\t}\n+\t\t\n+\t\tpublic void addObjectPermissions(Collection<Permission> permissions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAyNjkzNw==", "bodyText": "ist das Schneller wenn du es batched? Und geht das irgendwie, dass du die Permission an einer Stelle sinnvoll cached?", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r400026937", "createdAt": "2020-03-30T08:52:10Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/FrontEndConceptBuilder.java", "diffHunk": "@@ -36,14 +40,27 @@\n @Slf4j\n public class FrontEndConceptBuilder {\n \n-\tpublic static FERoot createRoot(NamespaceStorage storage) {\n+\tpublic static FERoot createRoot(NamespaceStorage storage, User user) {\n \n \t\tFERoot root = new FERoot();\n \t\tMap<IId<?>, FENode> roots = root.getConcepts();\n-\t\t//add all real roots\n-\t\tfor (Concept<?> c : storage.getAllConcepts()) {\n-\t\t\tif(!c.isHidden()) {\n-\t\t\t\troots.put(c.getId(), createCTRoot(c, storage.getStructure()));\n+\t\t\n+\t\tList<? extends Concept<?>> allConcepts = new ArrayList<>(storage.getAllConcepts());\n+\t\t// Remove any hidden concepts\n+\t\tallConcepts.removeIf(Concept::isHidden);\n+\t\t\n+\t\tList<Permission> permissions = new ArrayList<>(allConcepts.size());\n+\t\tfor (Concept<?> concept : allConcepts) {\n+\t\t\t// Collect all permission first, instead of submitting one by one to Shiro.\n+\t\t\tpermissions.add(ConceptPermission.onInstance(Ability.READ, concept.getId()));\n+\t\t}\n+\t\t\n+\t\t// Submit all permissions to Shiro\n+\t\tboolean[] isPermitted = user.isPermitted(permissions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAyODMzNQ==", "bodyText": "protected f\u00fcr Formulare?", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r400028335", "createdAt": "2020-03-30T08:54:21Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/execution/ManagedExecution.java", "diffHunk": "@@ -165,26 +170,46 @@ public void awaitDone(int time, TimeUnit unit) {\n \t\t}\n \t}\n \n+\tprotected void setStatusBase(@NonNull MasterMetaStorage storage, URLBuilder url, @NonNull  User user, @NonNull ExecutionStatus status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAzMTI2Nw==", "bodyText": "Yo dawg I heard you like Formulare.", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r400031267", "createdAt": "2020-03-30T08:58:55Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/RelativeFormQuery.java", "diffHunk": "@@ -31,7 +30,7 @@\n @RequiredArgsConstructor(onConstructor_=@JsonCreator)\n public class RelativeFormQuery extends IQuery {\n \t@NotNull @Valid\n-\tprivate final ConceptQuery query;\n+\tprivate final IQuery query;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAzMTYyMw==", "bodyText": "macht das nich evtl was f\u00fcr Kai kaputt?", "url": "https://github.com/bakdata/conquery/pull/1085#discussion_r400031623", "createdAt": "2020-03-30T08:59:31Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/RelativeFormQuery.java", "diffHunk": "@@ -31,7 +30,7 @@\n @RequiredArgsConstructor(onConstructor_=@JsonCreator)\n public class RelativeFormQuery extends IQuery {\n \t@NotNull @Valid\n-\tprivate final ConceptQuery query;\n+\tprivate final IQuery query;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAzMTI2Nw=="}, "originalCommit": {"oid": "c17f6b720820a08ac123eb5b0cc9485bc77c51e4"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11138277b31fad9224e13394d9c65ed6bd73cd7f", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/11138277b31fad9224e13394d9c65ed6bd73cd7f", "committedDate": "2020-04-02T11:59:54Z", "message": "review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "901233101b69c988d90cec476aee7919b08c711e", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/901233101b69c988d90cec476aee7919b08c711e", "committedDate": "2020-04-02T12:00:23Z", "message": "Merge branch 'develop' into feature/concept-permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ded72f56463cd470e8f3d555acf14c6aad8b6b4", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/5ded72f56463cd470e8f3d555acf14c6aad8b6b4", "committedDate": "2020-04-02T12:10:20Z", "message": "adds log messages"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4645, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}