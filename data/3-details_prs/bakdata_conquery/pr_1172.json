{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNjQwNzgw", "number": 1172, "title": "Feature/separate date column for concept connector", "bodyText": "Introduces a new Aggregator that can collect the event dates that correspond to a concept or connector", "createdAt": "2020-04-29T11:03:12Z", "url": "https://github.com/bakdata/conquery/pull/1172", "merged": true, "mergeCommit": {"oid": "ac38c3c739ddbad652fbda4cf1048b945f807682"}, "closed": true, "closedAt": "2020-05-13T12:18:34Z", "author": {"login": "thoniTUB"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccWbOygH2gAyNDEwNjQwNzgwOjMzYjY5N2M0ZTQyYTU3NzkwMWE3MjRiMjg5ODQ1OGQ1ODYyOGYxMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgmiulgH2gAyNDEwNjQwNzgwOjk1OWU5YzFjNTY1YWY2YjlhZGNkYzFlMzYwMTdmMjVkOWQ2Zjc0Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "33b697c4e42a577901a724b2898458d58628f108", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/33b697c4e42a577901a724b2898458d58628f108", "committedDate": "2020-04-29T11:03:37Z", "message": "adds eventdate select/aggregator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c23e3ebb31fd3ff8f949048a7ad429bfc63286bd", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c23e3ebb31fd3ff8f949048a7ad429bfc63286bd", "committedDate": "2020-04-29T11:03:37Z", "message": "adds tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df4256e2b7c5ddb3393dd71d2035fa4e4295692c", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/df4256e2b7c5ddb3393dd71d2035fa4e4295692c", "committedDate": "2020-04-29T11:03:38Z", "message": "adds event date to concept and connectors by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67580843f545bca36b75ce715e0fc81c226d2982", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/67580843f545bca36b75ce715e0fc81c226d2982", "committedDate": "2020-04-29T11:03:38Z", "message": "sets select holders for select"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f259d83ec7d58379269205761f9fdde7ad32f82", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/8f259d83ec7d58379269205761f9fdde7ad32f82", "committedDate": "2020-04-29T11:03:38Z", "message": "sets label and name to satisfy the validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37dd3014854689271059ba24c466f301f1596e3", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/c37dd3014854689271059ba24c466f301f1596e3", "committedDate": "2020-04-29T11:03:38Z", "message": "also retrains daterestriction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fcf5bff913544fcf2953471adf859b54f9c63f6", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/3fcf5bff913544fcf2953471adf859b54f9c63f6", "committedDate": "2020-04-29T11:03:39Z", "message": "adds more test and validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c7732b6870bf096f88e4efe7ac5b065579eed46", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/3c7732b6870bf096f88e4efe7ac5b065579eed46", "committedDate": "2020-04-29T11:03:41Z", "message": "adds comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65498533b1c3b604e205483bf4de1634e4b99acd", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/65498533b1c3b604e205483bf4de1634e4b99acd", "committedDate": "2020-04-29T11:02:13Z", "message": "adds comments"}, "afterCommit": {"oid": "3c7732b6870bf096f88e4efe7ac5b065579eed46", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/3c7732b6870bf096f88e4efe7ac5b065579eed46", "committedDate": "2020-04-29T11:03:41Z", "message": "adds comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d588dc2b4f1ae9bfb3177891286bdee509d62c5", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/8d588dc2b4f1ae9bfb3177891286bdee509d62c5", "committedDate": "2020-04-29T11:04:03Z", "message": "Merge 3c7732b6870bf096f88e4efe7ac5b065579eed46 into d80368c1e0fa3665f5b044a84fd7406cf815c0d5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5b27a669e4b74f957669c7de85b0eb549c39938", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/f5b27a669e4b74f957669c7de85b0eb549c39938", "committedDate": "2020-04-29T11:05:55Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/f611b61720bb7a412065bb4c192e28083bf7033f", "committedDate": "2020-05-04T07:19:14Z", "message": "Merge branch 'develop' into feature/separate-date-column-for-concept-connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzIzNTg4", "url": "https://github.com/bakdata/conquery/pull/1172#pullrequestreview-403323588", "createdAt": "2020-04-30T08:49:42Z", "commit": {"oid": "f5b27a669e4b74f957669c7de85b0eb549c39938"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwODo0OTo0MlrOGOf2LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTowNjo1NVrOGQgqig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1NTAyMQ==", "bodyText": "Ich wei\u00df nicht ob ich das mag, ich hab schon verstanden warum du das machst aber es w\u00e4re mir lieber wenn das \u00fcber die json l\u00e4uft weil es dann wirklich nur eine wahrheit gibt", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r417855021", "createdAt": "2020-04-30T08:49:42Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/Concept.java", "diffHunk": "@@ -46,6 +47,7 @@ public CONNECTOR getConnectorByName(String connector) {\n \t}\n \n \tpublic abstract List<? extends Select> getSelects();\n+\tpublic abstract void addSelect(Select select);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5b27a669e4b74f957669c7de85b0eb549c39938"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1NTkwMw==", "bodyText": "der ist jetzt nur auf dem Master Node registriert, wie \u00fcbertr\u00e4gstt du das an die slaves?", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r417855903", "createdAt": "2020-04-30T08:51:13Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/tree/TreeConcept.java", "diffHunk": "@@ -219,4 +221,14 @@ public int countElements() {\n \t\tint mostSpecific = ids[ids.length-1];\n \t\treturn localIdMap.get(mostSpecific);\n \t}\n+\n+\t@Override\n+\tpublic void addSelect(Select select) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5b27a669e4b74f957669c7de85b0eb549c39938"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1NzEwMw==", "bodyText": "ich glaube du musst hier trotzdem schauen, ob du ne validitydatecol hast", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r417857103", "createdAt": "2020-04-30T08:53:09Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/EventDateUnionAggregator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.bakdata.conquery.models.query.queryplan.aggregators.specific;\n+\n+import java.util.Set;\n+\n+import com.bakdata.conquery.models.common.CDateSet;\n+import com.bakdata.conquery.models.datasets.Column;\n+import com.bakdata.conquery.models.datasets.Table;\n+import com.bakdata.conquery.models.events.Bucket;\n+import com.bakdata.conquery.models.externalservice.ResultType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n+import com.bakdata.conquery.models.query.QueryExecutionContext;\n+import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n+import com.bakdata.conquery.models.query.queryplan.clone.CloneContext;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Collects the event dates of all events that are applicable to the specific part of a query.\n+ * Eventually the set of collected dates is tailored to the provided date restriction.\n+ *\n+ */\n+@RequiredArgsConstructor\n+public class EventDateUnionAggregator implements Aggregator<String>{\n+\n+\tprivate final Set<TableId> requiredTables;\n+\tprivate Column validityDateColumn;\n+\tprivate CDateSet set = CDateSet.create();\n+\tprivate CDateSet dateRestriction;\n+\t\n+\n+\t@Override\n+\tpublic void collectRequiredTables(Set<TableId> requiredTables) {\n+\t\trequiredTables.addAll(this.requiredTables);\n+\t}\n+\t\n+\t@Override\n+\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\t\tvalidityDateColumn = ctx.getValidityDateColumn();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5b27a669e4b74f957669c7de85b0eb549c39938"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDI1MQ==", "bodyText": "das geht nicht, die dateRestriction ist variabel.", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419964251", "createdAt": "2020-05-05T09:04:29Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/EventDateUnionAggregator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.bakdata.conquery.models.query.queryplan.aggregators.specific;\n+\n+import java.util.Set;\n+\n+import com.bakdata.conquery.models.common.CDateSet;\n+import com.bakdata.conquery.models.datasets.Column;\n+import com.bakdata.conquery.models.datasets.Table;\n+import com.bakdata.conquery.models.events.Bucket;\n+import com.bakdata.conquery.models.externalservice.ResultType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n+import com.bakdata.conquery.models.query.QueryExecutionContext;\n+import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n+import com.bakdata.conquery.models.query.queryplan.clone.CloneContext;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Collects the event dates of all events that are applicable to the specific part of a query.\n+ * Eventually the set of collected dates is tailored to the provided date restriction.\n+ *\n+ */\n+@RequiredArgsConstructor\n+public class EventDateUnionAggregator implements Aggregator<String>{\n+\n+\tprivate final Set<TableId> requiredTables;\n+\tprivate Column validityDateColumn;\n+\tprivate CDateSet set = CDateSet.create();\n+\tprivate CDateSet dateRestriction;\n+\t\n+\n+\t@Override\n+\tpublic void collectRequiredTables(Set<TableId> requiredTables) {\n+\t\trequiredTables.addAll(this.requiredTables);\n+\t}\n+\t\n+\t@Override\n+\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\t\tvalidityDateColumn = ctx.getValidityDateColumn();\n+\t\tdateRestriction = ctx.getDateRestriction();\n+\t\tAggregator.super.nextTable(ctx, currentTable);\n+\t}\n+\n+\t@Override\n+\tpublic Aggregator<String> doClone(CloneContext ctx) {\n+\t\treturn new EventDateUnionAggregator(requiredTables);\n+\t}\n+\n+\t@Override\n+\tpublic String getAggregationResult() {\n+\t\tset.retainAll(dateRestriction);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDM2OA==", "bodyText": "musst du in aggregateEvent machen", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419964368", "createdAt": "2020-05-05T09:04:43Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/EventDateUnionAggregator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.bakdata.conquery.models.query.queryplan.aggregators.specific;\n+\n+import java.util.Set;\n+\n+import com.bakdata.conquery.models.common.CDateSet;\n+import com.bakdata.conquery.models.datasets.Column;\n+import com.bakdata.conquery.models.datasets.Table;\n+import com.bakdata.conquery.models.events.Bucket;\n+import com.bakdata.conquery.models.externalservice.ResultType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n+import com.bakdata.conquery.models.query.QueryExecutionContext;\n+import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n+import com.bakdata.conquery.models.query.queryplan.clone.CloneContext;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Collects the event dates of all events that are applicable to the specific part of a query.\n+ * Eventually the set of collected dates is tailored to the provided date restriction.\n+ *\n+ */\n+@RequiredArgsConstructor\n+public class EventDateUnionAggregator implements Aggregator<String>{\n+\n+\tprivate final Set<TableId> requiredTables;\n+\tprivate Column validityDateColumn;\n+\tprivate CDateSet set = CDateSet.create();\n+\tprivate CDateSet dateRestriction;\n+\t\n+\n+\t@Override\n+\tpublic void collectRequiredTables(Set<TableId> requiredTables) {\n+\t\trequiredTables.addAll(this.requiredTables);\n+\t}\n+\t\n+\t@Override\n+\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\t\tvalidityDateColumn = ctx.getValidityDateColumn();\n+\t\tdateRestriction = ctx.getDateRestriction();\n+\t\tAggregator.super.nextTable(ctx, currentTable);\n+\t}\n+\n+\t@Override\n+\tpublic Aggregator<String> doClone(CloneContext ctx) {\n+\t\treturn new EventDateUnionAggregator(requiredTables);\n+\t}\n+\n+\t@Override\n+\tpublic String getAggregationResult() {\n+\t\tset.retainAll(dateRestriction);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDI1MQ=="}, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDc4OA==", "bodyText": "hast du eigentlich \u00fcberpr\u00fcft ob das auch so bei den slaves ankommt, oder ob die das dann sogar doppelt haben?", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419964788", "createdAt": "2020-05-05T09:05:31Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/resources/admin/rest/AdminProcessor.java", "diffHunk": "@@ -128,7 +130,18 @@ else if (!table.getDataset().equals(dataset)) {\n \t}\n \n \tpublic void addConcept(Dataset dataset, Concept<?> c) {\n+\t\t// Add the standard EventDateUnionSelect to every added Concept", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NTA1Ng==", "bodyText": "Bin ehrlich gesagt kein Fan von, mir w\u00e4re es lieber wir w\u00fcrden die Konzepte anpassen. Aber Ist halt auch arbeit :/", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419965056", "createdAt": "2020-05-05T09:06:00Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/resources/admin/rest/AdminProcessor.java", "diffHunk": "@@ -128,7 +130,18 @@ else if (!table.getDataset().equals(dataset)) {\n \t}\n \n \tpublic void addConcept(Dataset dataset, Concept<?> c) {\n+\t\t// Add the standard EventDateUnionSelect to every added Concept", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDc4OA=="}, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NTI0Mg==", "bodyText": "den tabellen namen anpaasen", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419965242", "createdAt": "2020-05-05T09:06:20Z", "author": {"login": "awildturtok"}, "path": "backend/src/test/resources/tests/aggregator/EVENT_DATE_AGGREGATOR/EVENT_DATE_AGGREGATOR_NO_RESTRICTION.test.json", "diffHunk": "@@ -0,0 +1,67 @@\n+{\n+    \"type\": \"QUERY_TEST\",\n+    \"label\": \"EVENT_DATE_AGGREGATOR_NO_RESTRICTION Test\",\n+    \"expectedCsv\": \"tests/aggregator/EVENT_DATE_AGGREGATOR/expected_no_restriction.csv\",\n+    \"query\": {\n+        \"type\": \"CONCEPT_QUERY\",\n+        \"root\": {\n+            \"ids\": [\n+                \"${dataset}.con\"\n+            ],\n+            \"type\": \"CONCEPT\",\n+            \"label\": \"Geschlecht SELECT\",\n+            \"tables\": [\n+                {\n+                    \"id\": \"${dataset}.con.geschlecht_connector\",\n+                    \"selects\": \"${dataset}.con.geschlecht_connector.event-date\"\n+                }\n+            ],\n+            \"selects\": \"${dataset}.con.geschlecht_connector.event-date\"\n+        }\n+    },\n+    \"concepts\": [\n+        {\n+            \"label\": \"Geschlecht SELECT\",\n+            \"name\": \"con\",\n+            \"type\": \"VIRTUAL\",\n+            \"connectors\": [\n+                {\n+                    \"label\": \"geschlecht_connector\",\n+                    \"table\": \"vers_stamm\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NTU3OA==", "bodyText": "hier f\u00fcgst du den ja auch schon hinzu, dann ist der ja mindestens doppelt drin und ohne id", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r419965578", "createdAt": "2020-05-05T09:06:55Z", "author": {"login": "awildturtok"}, "path": "backend/src/test/resources/tests/aggregator/EVENT_DATE_AGGREGATOR/EVENT_DATE_AGGREGATOR_NO_RESTRICTION.test.json", "diffHunk": "@@ -0,0 +1,67 @@\n+{\n+    \"type\": \"QUERY_TEST\",\n+    \"label\": \"EVENT_DATE_AGGREGATOR_NO_RESTRICTION Test\",\n+    \"expectedCsv\": \"tests/aggregator/EVENT_DATE_AGGREGATOR/expected_no_restriction.csv\",\n+    \"query\": {\n+        \"type\": \"CONCEPT_QUERY\",\n+        \"root\": {\n+            \"ids\": [\n+                \"${dataset}.con\"\n+            ],\n+            \"type\": \"CONCEPT\",\n+            \"label\": \"Geschlecht SELECT\",\n+            \"tables\": [\n+                {\n+                    \"id\": \"${dataset}.con.geschlecht_connector\",\n+                    \"selects\": \"${dataset}.con.geschlecht_connector.event-date\"\n+                }\n+            ],\n+            \"selects\": \"${dataset}.con.geschlecht_connector.event-date\"\n+        }\n+    },\n+    \"concepts\": [\n+        {\n+            \"label\": \"Geschlecht SELECT\",\n+            \"name\": \"con\",\n+            \"type\": \"VIRTUAL\",\n+            \"connectors\": [\n+                {\n+                    \"label\": \"geschlecht_connector\",\n+                    \"table\": \"vers_stamm\",\n+                    \"validityDates\": {\n+                        \"label\": \"indexdatum\",\n+                        \"column\": \"vers_stamm.indexdatum\"\n+                    },\n+                    \"selects\": {\n+                        \"type\": \"EVENT_DATE_UNION\"\n+                    }\n+                }\n+            ],\n+            \"selects\": {\n+                \"type\": \"EVENT_DATE_UNION\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f611b61720bb7a412065bb4c192e28083bf7033f"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cd6aa3d1627c44f0a8f95ca8fcfac807f09db36", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/5cd6aa3d1627c44f0a8f95ca8fcfac807f09db36", "committedDate": "2020-05-06T15:03:31Z", "message": "retrains date restriction on aggregateEvent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "023bd8c132eeb726be060581091df39dec03f19c", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/023bd8c132eeb726be060581091df39dec03f19c", "committedDate": "2020-05-06T15:16:04Z", "message": "adds type check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c3dfbef8ad32e540c6635ff9171a93d6ad3c559", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/5c3dfbef8ad32e540c6635ff9171a93d6ad3c559", "committedDate": "2020-05-06T15:16:55Z", "message": "removes default adding of event  date union select"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1047b208769d49c266f3b2e15be90e5f4db8d6d", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/b1047b208769d49c266f3b2e15be90e5f4db8d6d", "committedDate": "2020-05-07T06:44:22Z", "message": "fixes tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a452b66b5e3e4bb83f430061b6a110a518417c0a", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/a452b66b5e3e4bb83f430061b6a110a518417c0a", "committedDate": "2020-05-07T06:44:33Z", "message": "Merge b1047b208769d49c266f3b2e15be90e5f4db8d6d into 31d898012f5a9421a54f86b574ad7b022bfca148"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dea03a63e49e8581280e9ff05f0cc0ba0242e040", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/dea03a63e49e8581280e9ff05f0cc0ba0242e040", "committedDate": "2020-05-07T06:46:33Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3933e6a1df361b7da2496aba49be37eb55527a05", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/3933e6a1df361b7da2496aba49be37eb55527a05", "committedDate": "2020-05-07T06:54:52Z", "message": "renames most tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjM5NDY5", "url": "https://github.com/bakdata/conquery/pull/1172#pullrequestreview-407239469", "createdAt": "2020-05-07T08:06:28Z", "commit": {"oid": "3933e6a1df361b7da2496aba49be37eb55527a05"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowNjoyOFrOGRzIUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODowNzowN1rOGRzJog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxNjY4OQ==", "bodyText": "da w\u00fcrde ich mich ehrlich gesagt eher drauf verlassen als das jedes mal zu pr\u00fcfen.", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r421316689", "createdAt": "2020-05-07T08:06:28Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/EventDateUnionAggregator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.bakdata.conquery.models.query.queryplan.aggregators.specific;\n+\n+import java.util.Objects;\n+import java.util.Set;\n+\n+import com.bakdata.conquery.models.common.CDateSet;\n+import com.bakdata.conquery.models.datasets.Column;\n+import com.bakdata.conquery.models.datasets.Table;\n+import com.bakdata.conquery.models.events.Bucket;\n+import com.bakdata.conquery.models.externalservice.ResultType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n+import com.bakdata.conquery.models.query.QueryExecutionContext;\n+import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n+import com.bakdata.conquery.models.query.queryplan.clone.CloneContext;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Collects the event dates of all events that are applicable to the specific\n+ * part of a query. Eventually the set of collected dates is tailored to the\n+ * provided date restriction.\n+ *\n+ */\n+@RequiredArgsConstructor\n+public class EventDateUnionAggregator implements Aggregator<String> {\n+\n+\tprivate final Set<TableId> requiredTables;\n+\tprivate Column validityDateColumn;\n+\tprivate CDateSet set = CDateSet.create();\n+\tprivate CDateSet dateRestriction;\n+\n+\t@Override\n+\tpublic void collectRequiredTables(Set<TableId> requiredTables) {\n+\t\trequiredTables.addAll(this.requiredTables);\n+\t}\n+\n+\t@Override\n+\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\t\tvalidityDateColumn = Objects.requireNonNull(ctx.getValidityDateColumn());\n+\t\tif (!validityDateColumn.getType().isDateCompatible()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3933e6a1df361b7da2496aba49be37eb55527a05"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMxNzAyNg==", "bodyText": "Wir geben in der Regel das Objekt selber raus und nicht den toString. Damit kann man aggregatoren wieder verwenden", "url": "https://github.com/bakdata/conquery/pull/1172#discussion_r421317026", "createdAt": "2020-05-07T08:07:07Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/EventDateUnionAggregator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.bakdata.conquery.models.query.queryplan.aggregators.specific;\n+\n+import java.util.Objects;\n+import java.util.Set;\n+\n+import com.bakdata.conquery.models.common.CDateSet;\n+import com.bakdata.conquery.models.datasets.Column;\n+import com.bakdata.conquery.models.datasets.Table;\n+import com.bakdata.conquery.models.events.Bucket;\n+import com.bakdata.conquery.models.externalservice.ResultType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n+import com.bakdata.conquery.models.query.QueryExecutionContext;\n+import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n+import com.bakdata.conquery.models.query.queryplan.clone.CloneContext;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Collects the event dates of all events that are applicable to the specific\n+ * part of a query. Eventually the set of collected dates is tailored to the\n+ * provided date restriction.\n+ *\n+ */\n+@RequiredArgsConstructor\n+public class EventDateUnionAggregator implements Aggregator<String> {\n+\n+\tprivate final Set<TableId> requiredTables;\n+\tprivate Column validityDateColumn;\n+\tprivate CDateSet set = CDateSet.create();\n+\tprivate CDateSet dateRestriction;\n+\n+\t@Override\n+\tpublic void collectRequiredTables(Set<TableId> requiredTables) {\n+\t\trequiredTables.addAll(this.requiredTables);\n+\t}\n+\n+\t@Override\n+\tpublic void nextTable(QueryExecutionContext ctx, Table currentTable) {\n+\t\tvalidityDateColumn = Objects.requireNonNull(ctx.getValidityDateColumn());\n+\t\tif (!validityDateColumn.getType().isDateCompatible()) {\n+\t\t\tthrow new IllegalStateException(\"The validityDateColumn \" + validityDateColumn + \" is not a DATE TYPE\");\n+\t\t}\n+\t\t\n+\t\tdateRestriction = ctx.getDateRestriction();\n+\t\tAggregator.super.nextTable(ctx, currentTable);\n+\t}\n+\n+\t@Override\n+\tpublic Aggregator<String> doClone(CloneContext ctx) {\n+\t\treturn new EventDateUnionAggregator(requiredTables);\n+\t}\n+\n+\t@Override\n+\tpublic String getAggregationResult() {\n+\t\treturn set.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3933e6a1df361b7da2496aba49be37eb55527a05"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDAyODEz", "url": "https://github.com/bakdata/conquery/pull/1172#pullrequestreview-409002813", "createdAt": "2020-05-11T09:21:20Z", "commit": {"oid": "3933e6a1df361b7da2496aba49be37eb55527a05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "959e9c1c565af6b9adcdc1e36017f25d9d6f7428", "author": {"user": {"login": "thoniTUB", "name": "MT"}}, "url": "https://github.com/bakdata/conquery/commit/959e9c1c565af6b9adcdc1e36017f25d9d6f7428", "committedDate": "2020-05-12T16:05:59Z", "message": "Merge branch 'develop' into feature/separate-date-column-for-concept-connector"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4587, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}