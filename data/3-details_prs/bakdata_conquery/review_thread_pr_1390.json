{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMjc1MTcy", "number": 1390, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoxNzo1M1rOEuaykQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoyMTowMlrOEua4lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTA4ODgxOnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoxNzo1M1rOHizpFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMToyOToyOVrOHkJ4GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI1OTczNQ==", "bodyText": "Warum klonst du die hier? Du bearbeitest sie gar nicht", "url": "https://github.com/bakdata/conquery/pull/1390#discussion_r506259735", "createdAt": "2020-10-16T10:17:53Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java", "diffHunk": "@@ -63,20 +63,14 @@ public static BucketManager create(Worker worker, WorkerStorage storage) {\n \t\tInt2ObjectMap<Entity> entities = new Int2ObjectAVLTreeMap<>();\n \t\tMap<ConnectorId, Int2ObjectMap<List<CBlock>>> connectorCBlocks = new HashMap<>(150);\n \t\t\n-\t\tIntArraySet requiredBuckets = worker.getInfo().getIncludedBuckets();\n-\t\tlog.trace(\"Trying to load these buckets: {}\", requiredBuckets);\n+\t\tIntArraySet assignedBucketNumbers = worker.getInfo().getIncludedBuckets().clone();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0023ba9c50b98235199c35036386000bbc49c1e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY3MjYwMQ==", "bodyText": "Das war noch von meinem vorherigen Ansatz, Das l\u00f6sche ich", "url": "https://github.com/bakdata/conquery/pull/1390#discussion_r507672601", "createdAt": "2020-10-19T11:29:29Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java", "diffHunk": "@@ -63,20 +63,14 @@ public static BucketManager create(Worker worker, WorkerStorage storage) {\n \t\tInt2ObjectMap<Entity> entities = new Int2ObjectAVLTreeMap<>();\n \t\tMap<ConnectorId, Int2ObjectMap<List<CBlock>>> connectorCBlocks = new HashMap<>(150);\n \t\t\n-\t\tIntArraySet requiredBuckets = worker.getInfo().getIncludedBuckets();\n-\t\tlog.trace(\"Trying to load these buckets: {}\", requiredBuckets);\n+\t\tIntArraySet assignedBucketNumbers = worker.getInfo().getIncludedBuckets().clone();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI1OTczNQ=="}, "originalCommit": {"oid": "f0023ba9c50b98235199c35036386000bbc49c1e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTA5NTk3OnYy", "diffSide": "LEFT", "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoxOToyN1rOHizt8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoxOToyN1rOHizt8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI2MDk3Ng==", "bodyText": "nice!", "url": "https://github.com/bakdata/conquery/pull/1390#discussion_r506260976", "createdAt": "2020-10-16T10:19:27Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterImpl.java", "diffHunk": "@@ -104,29 +118,25 @@ public void setMax(long max) {\n \n \t@Override\n \tpublic void done() {\n+\t\tif(end > -1) {\n+\t\t\tlog.warn(\"Done was called again for {}\", this);\n+\t\t\treturn;\n+\t\t}\n \t\tend = System.currentTimeMillis();\n \n-\t\tfor (ChildProgressReporter child : children) {\n+\t\tfor (ProgressReporter child : children) {\n \t\t\tif (!child.isDone()) {\n-\t\t\t\tthrow new IllegalStateException(\"One or more Children are not done yet\");\n+\t\t\t\tlog.warn(\"One or more Children are not done yet\");\n \t\t\t}\n \t\t}\n-\n-\t\t// Some numerical error is acceptable here.\n-\t\tfinal double progress = getProgress();\n-\t\tif (DoubleMath.fuzzyEquals(progress,1,0.1d)) {\n-\t\t\tlog.warn(\"ProgressReporter is done but Progress is just {}\", progress);\n+\t\t\n+\t\tif(getAbsoluteProgress()<max) {\n+\t\t\tlog.trace(\"Done was called before all steps were been reported. There might be missing reporting steps in the code.\");\n \t\t}\n \n \t\tinnerProgress = max - reservedForChildren;\n \t}\n \n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0023ba9c50b98235199c35036386000bbc49c1e"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTEwNDIzOnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDoyMTowMlrOHizzSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTozMjoyN1rOHkJ-Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI2MjM0Ng==", "bodyText": "Wie kann es hier zu einer Exception kommen und kannst du das nicht selber abfangen?", "url": "https://github.com/bakdata/conquery/pull/1390#discussion_r506262346", "createdAt": "2020-10-16T10:21:02Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterUtil.java", "diffHunk": "@@ -24,8 +26,17 @@\n \t\tif (done) {\n \t\t\treturn ProgressReporterUtil.MAX_PROGRESS;\n \t\t}\n+\t\t\n+\t\tboolean canEstimate = true;\n+\t\tlong estimateMillis = 0;\n+\t\ttry {\t\t\t\n+\t\t\testimateMillis = DoubleMath.roundToLong(elapsedMillis / progress - elapsedMillis, RoundingMode.HALF_UP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0023ba9c50b98235199c35036386000bbc49c1e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY3NDE5MQ==", "bodyText": "Ich wusste zu dem zeitpunkt nur, dass eine ArithmeticException geworfen wurde, Aber nicht den Grund daf\u00fcr. Jetzt wei\u00df ich, dass progress==0 ist und kann es mir nochmal anschauen.", "url": "https://github.com/bakdata/conquery/pull/1390#discussion_r507674191", "createdAt": "2020-10-19T11:32:27Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/util/progressreporter/ProgressReporterUtil.java", "diffHunk": "@@ -24,8 +26,17 @@\n \t\tif (done) {\n \t\t\treturn ProgressReporterUtil.MAX_PROGRESS;\n \t\t}\n+\t\t\n+\t\tboolean canEstimate = true;\n+\t\tlong estimateMillis = 0;\n+\t\ttry {\t\t\t\n+\t\t\testimateMillis = DoubleMath.roundToLong(elapsedMillis / progress - elapsedMillis, RoundingMode.HALF_UP);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI2MjM0Ng=="}, "originalCommit": {"oid": "f0023ba9c50b98235199c35036386000bbc49c1e"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1603, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}