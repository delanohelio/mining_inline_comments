{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODk5NTQ5", "number": 1019, "title": "SourceSearch is tracked in SlowJobQueue", "bodyText": "", "createdAt": "2020-02-06T13:29:08Z", "url": "https://github.com/bakdata/conquery/pull/1019", "merged": true, "mergeCommit": {"oid": "5c8a695baf4588e741a379fdf4aeba6e8d926154"}, "closed": true, "closedAt": "2020-02-10T17:21:07Z", "author": {"login": "awildturtok"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBqnKsAH2gAyMzcxODk5NTQ5OmM1MWQ2YWNlNTY4ZWVkY2FlMjkyZWU1YjIzY2QzMTAwYWZjZjFhNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC-KhKAH2gAyMzcxODk5NTQ5OmZlZWE5Y2ZhNzcxNGQwMTZhZTYzYTE3MTZhYmUyYzk2ZjllMThhMWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c51d6ace568eedcae292ee5b23cd3100afcf1a71", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/c51d6ace568eedcae292ee5b23cd3100afcf1a71", "committedDate": "2020-02-06T13:18:48Z", "message": "fix usage of search init in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19e8507ff4dc193916eb0adff295e66674d8909", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/a19e8507ff4dc193916eb0adff295e66674d8909", "committedDate": "2020-02-06T13:29:16Z", "message": "Merge branch 'develop' into feature/create-search-in-jobqueue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c2a308823062b1190359fb8aa9f1f8ef8419bed", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/2c2a308823062b1190359fb8aa9f1f8ef8419bed", "committedDate": "2020-02-06T14:22:04Z", "message": "Update FilterSearch.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96399354f9da2115d9811db364307fbb964b689a", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/96399354f9da2115d9811db364307fbb964b689a", "committedDate": "2020-02-06T14:49:04Z", "message": "remove most common usage of ImmutableSet, and move to HashSet. As the former is very slow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9995b57373f20a1401e5fde8e1c0e670ab73dfe", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/e9995b57373f20a1401e5fde8e1c0e670ab73dfe", "committedDate": "2020-02-06T15:16:39Z", "message": "Merge branch 'feature/create-search-in-jobqueue' of https://github.com/bakdata/conquery into feature/create-search-in-jobqueue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODQ3MDA0", "url": "https://github.com/bakdata/conquery/pull/1019#pullrequestreview-355847004", "createdAt": "2020-02-10T10:57:18Z", "commit": {"oid": "e9995b57373f20a1401e5fde8e1c0e670ab73dfe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1NzoxOVrOFnh1IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo1NzoxOVrOFnh1IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5MzA1Ng==", "bodyText": "doku", "url": "https://github.com/bakdata/conquery/pull/1019#discussion_r376993056", "createdAt": "2020-02-10T10:57:19Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/FilterSearch.java", "diffHunk": "@@ -83,18 +83,13 @@ public double score(String candidate, String keyword) {\n \n \tprivate static Map<String, QuickSearch<FilterSearchItem>> search = new HashMap<>();\n \n-\tpublic static ExecutorService init(Namespaces namespaces, Collection<Dataset> datasets) {\n-\t\tExecutorService executor = Executors.newSingleThreadExecutor();\n-\n+\tpublic static void init(Namespaces namespaces, Collection<Dataset> datasets, JobManager jobManager) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9995b57373f20a1401e5fde8e1c0e670ab73dfe"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84c95f7505fc36e7ff0fe5a325f0efe825cd8f1d", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/84c95f7505fc36e7ff0fe5a325f0efe825cd8f1d", "committedDate": "2020-02-10T13:31:46Z", "message": "Move Template from Filter to AbstractSelectFilter and add documentation for FilterSearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f518615fdce638de2876a1578f10034b6f1aba64", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/f518615fdce638de2876a1578f10034b6f1aba64", "committedDate": "2020-02-10T13:31:58Z", "message": "Merge 84c95f7505fc36e7ff0fe5a325f0efe825cd8f1d into 9872fa08fe592ab056d17542a02786b9a8105a3c"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7", "author": {"user": {"login": "bakdata-bot", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/4ba1fee101b6abb7a13416adf6254062fc143fa7", "committedDate": "2020-02-10T13:34:11Z", "message": "automatic update to docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTQzMDAw", "url": "https://github.com/bakdata/conquery/pull/1019#pullrequestreview-355943000", "createdAt": "2020-02-10T13:41:32Z", "commit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo0MTozMlrOFnmaHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMzo1OToyMFrOFnnBEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2ODA2Mw==", "bodyText": "addFastJob -> Der PR titel sagt, dass der Bau der Suche ein SlowJob sein sollte.", "url": "https://github.com/bakdata/conquery/pull/1019#discussion_r377068063", "createdAt": "2020-02-10T13:41:32Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/FilterSearch.java", "diffHunk": "@@ -83,20 +83,22 @@ public double score(String candidate, String keyword) {\n \n \tprivate static Map<String, QuickSearch<FilterSearchItem>> search = new HashMap<>();\n \n-\tpublic static ExecutorService init(Namespaces namespaces, Collection<Dataset> datasets) {\n-\t\tExecutorService executor = Executors.newSingleThreadExecutor();\n-\n+\t/**\n+\t * Scan all SelectFilters and submit {@link SimpleJob}s to create interactive searches for them.\n+\t */\n+\tpublic static void updateSearch(Namespaces namespaces, Collection<Dataset> datasets, JobManager jobManager) {\n \t\tdatasets.stream()\n \t\t\t\t.flatMap(ds -> namespaces.get(ds.getId()).getStorage().getAllConcepts().stream())\n \t\t\t\t.flatMap(c -> c.getConnectors().stream())\n \t\t\t\t.flatMap(co -> co.collectAllFilters().stream())\n-\t\t\t\t.filter(f -> f instanceof AbstractSelectFilter && f.getTemplate() != null)\n-\t\t\t\t.forEach(f -> executor.submit(() -> createSourceSearch(((AbstractSelectFilter<?>) f))));\n-\n-\t\texecutor.shutdown();\n-\t\treturn executor;\n+\t\t\t\t.filter(f -> f instanceof AbstractSelectFilter && ((AbstractSelectFilter<?>) f).getTemplate() != null)\n+\t\t\t\t.forEach(f -> jobManager.addFastJob(new SimpleJob(String.format(\"SourceSearch[%s]\", f.getId()), () -> createSourceSearch(((AbstractSelectFilter<?>) f)))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTc3OQ==", "bodyText": "Ich w\u00fcrde noch im Stream casten\n\t\t\t\t.map(AbstractSelectFilter.class::cast)\n\t\t\t\t.forEach(f -> jobManager.addFastJob(new SimpleJob(String.format(\"SourceSearch[%s]\", f.getId()), () -> createSourceSearch(( f))));", "url": "https://github.com/bakdata/conquery/pull/1019#discussion_r377069779", "createdAt": "2020-02-10T13:44:38Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/apiv1/FilterSearch.java", "diffHunk": "@@ -83,20 +83,22 @@ public double score(String candidate, String keyword) {\n \n \tprivate static Map<String, QuickSearch<FilterSearchItem>> search = new HashMap<>();\n \n-\tpublic static ExecutorService init(Namespaces namespaces, Collection<Dataset> datasets) {\n-\t\tExecutorService executor = Executors.newSingleThreadExecutor();\n-\n+\t/**\n+\t * Scan all SelectFilters and submit {@link SimpleJob}s to create interactive searches for them.\n+\t */\n+\tpublic static void updateSearch(Namespaces namespaces, Collection<Dataset> datasets, JobManager jobManager) {\n \t\tdatasets.stream()\n \t\t\t\t.flatMap(ds -> namespaces.get(ds.getId()).getStorage().getAllConcepts().stream())\n \t\t\t\t.flatMap(c -> c.getConnectors().stream())\n \t\t\t\t.flatMap(co -> co.collectAllFilters().stream())\n-\t\t\t\t.filter(f -> f instanceof AbstractSelectFilter && f.getTemplate() != null)\n-\t\t\t\t.forEach(f -> executor.submit(() -> createSourceSearch(((AbstractSelectFilter<?>) f))));\n-\n-\t\texecutor.shutdown();\n-\t\treturn executor;\n+\t\t\t\t.filter(f -> f instanceof AbstractSelectFilter && ((AbstractSelectFilter<?>) f).getTemplate() != null)\n+\t\t\t\t.forEach(f -> jobManager.addFastJob(new SimpleJob(String.format(\"SourceSearch[%s]\", f.getId()), () -> createSourceSearch(((AbstractSelectFilter<?>) f)))));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2ODA2Mw=="}, "originalCommit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3MTczNg==", "bodyText": "dann kann der Kommentar auch weg ;)", "url": "https://github.com/bakdata/conquery/pull/1019#discussion_r377071736", "createdAt": "2020-02-10T13:48:05Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/filters/Filter.java", "diffHunk": "@@ -35,7 +32,6 @@\n \t@JsonBackReference\n \tprivate Connector connector;\n \t// TODO: 20.11.2019 Move to AbstractSelectFilter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3ODAzMg==", "bodyText": "Die Zeile k\u00f6nntest du nach  AbstractSelectFilter#configureFrontend verschieben. Die Funktion wird nach diesem Builder aufgerufen.", "url": "https://github.com/bakdata/conquery/pull/1019#discussion_r377078032", "createdAt": "2020-02-10T13:59:20Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/concepts/FrontEndConceptBuilder.java", "diffHunk": "@@ -209,7 +210,7 @@ public static FEFilter createFilter(Filter<?> filter) {\n \t\t\t.unit(filter.getUnit())\n \t\t\t.allowDropFile(filter.getAllowDropFile())\n \t\t\t.pattern(filter.getPattern())\n-\t\t\t.template(filter.getTemplate())\n+\t\t\t.template(filter instanceof AbstractSelectFilter ? ((AbstractSelectFilter<?>) filter).getTemplate() : null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTU5MDU3", "url": "https://github.com/bakdata/conquery/pull/1019#pullrequestreview-355959057", "createdAt": "2020-02-10T14:03:57Z", "commit": {"oid": "4ba1fee101b6abb7a13416adf6254062fc143fa7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7943f3a853dabbffc22dcb4ae357d869a290272f", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/7943f3a853dabbffc22dcb4ae357d869a290272f", "committedDate": "2020-02-10T14:25:53Z", "message": "Fixed adding to fast Jobs even though it's a slow Job"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07c366debac228ab48de243344241d9c6c5224a6", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/07c366debac228ab48de243344241d9c6c5224a6", "committedDate": "2020-02-10T14:27:15Z", "message": "Code Style fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feea9cfa7714d016ae63a1716abe2c96f9e18a1b", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/feea9cfa7714d016ae63a1716abe2c96f9e18a1b", "committedDate": "2020-02-10T14:39:32Z", "message": "Merge branch 'develop' into feature/create-search-in-jobqueue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4698, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}