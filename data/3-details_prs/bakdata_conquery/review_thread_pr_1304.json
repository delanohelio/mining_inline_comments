{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzE5MjUz", "number": 1304, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoxNzowNlrOETnl0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoyOTozNFrOETn1ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDA3MDU2OnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/models/messages/network/specific/AddWorker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoxNzowNlrOG5dAEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNzoyOTo1MlrOG6u8zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzE3MQ==", "bodyText": "createWorkerName wo ist die Methode definiert?", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897171", "createdAt": "2020-07-30T10:17:06Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/messages/network/specific/AddWorker.java", "diffHunk": "@@ -31,18 +29,15 @@ public void react(Slave context) throws Exception {\n \t\tConqueryConfig config = context.getConfig();\n \t\tFile dir = createWorkerName(context);\n \t\tWorkerInformation info = new WorkerInformation();\n-\t\tinfo.setDataset(dataset.getId());\n+\t\tinfo.setDataset(dataset);\n \t\tinfo.setIncludedBuckets(new IntArrayList());\n \t\tinfo.setName(dir.getName());\n-\t\tWorkerStorage workerStorage = new WorkerStorageImpl(context.getValidator(), config.getStorage(), dir);\n-\t\tworkerStorage.loadData();\n-\t\tworkerStorage.updateDataset(dataset);\n \n \n-\t\tWorker worker = context.getWorkers().createWorker(info, workerStorage);\n+\t\tWorker worker = context.getWorkers().createWorker(info, config.getStorage(), createWorkerName(context), context.getValidator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIzOTgyMQ==", "bodyText": "Die ist in Workers definiert", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r464239821", "createdAt": "2020-08-03T07:29:52Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/messages/network/specific/AddWorker.java", "diffHunk": "@@ -31,18 +29,15 @@ public void react(Slave context) throws Exception {\n \t\tConqueryConfig config = context.getConfig();\n \t\tFile dir = createWorkerName(context);\n \t\tWorkerInformation info = new WorkerInformation();\n-\t\tinfo.setDataset(dataset.getId());\n+\t\tinfo.setDataset(dataset);\n \t\tinfo.setIncludedBuckets(new IntArrayList());\n \t\tinfo.setName(dir.getName());\n-\t\tWorkerStorage workerStorage = new WorkerStorageImpl(context.getValidator(), config.getStorage(), dir);\n-\t\tworkerStorage.loadData();\n-\t\tworkerStorage.updateDataset(dataset);\n \n \n-\t\tWorker worker = context.getWorkers().createWorker(info, workerStorage);\n+\t\tWorker worker = context.getWorkers().createWorker(info, config.getStorage(), createWorkerName(context), context.getValidator());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzE3MQ=="}, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDA3MzE4OnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Namespaces.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoxNzo1MVrOG5dBnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoxNzo1N1rOG5dBwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzU2NQ==", "bodyText": "Ui! Das ist ein bug!", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897565", "createdAt": "2020-07-30T10:17:51Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Namespaces.java", "diffHunk": "@@ -88,7 +89,7 @@ public synchronized void register(SlaveInformation slave, WorkerInformation info\n \t\t\tworkers.add(info);\n \t\t}\n \n-\t\tNamespace ns = datasets.get(info.getDataset());\n+\t\tNamespace ns = datasets.get(info.getDataset().getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzYwMg==", "bodyText": "gewesen", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462897602", "createdAt": "2020-07-30T10:17:57Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Namespaces.java", "diffHunk": "@@ -88,7 +89,7 @@ public synchronized void register(SlaveInformation slave, WorkerInformation info\n \t\t\tworkers.add(info);\n \t\t}\n \n-\t\tNamespace ns = datasets.get(info.getDataset());\n+\t\tNamespace ns = datasets.get(info.getDataset().getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzU2NQ=="}, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDExMDQ0OnYy", "diffSide": "RIGHT", "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Worker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDoyOTozNFrOG5dYTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNzozNDozNVrOG6vEgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMzM3NA==", "bodyText": "ist das einfach nur tryLoad umbenannt?", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r462903374", "createdAt": "2020-07-30T10:29:34Z", "author": {"login": "awildturtok"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Worker.java", "diffHunk": "@@ -34,14 +45,42 @@\n \t@Getter\n \tprivate final ExecutorService executorService;\n \t\n-\tpublic Worker(WorkerInformation info, JobManager jobManager, WorkerStorage storage, QueryExecutor queryExecutor, ExecutorService executorService) {\n-\t\tthis.info = info;\n-\t\tthis.jobManager = jobManager;\n-\t\tthis.storage = storage;\n-\t\tthis.executorService = executorService;\n-\t\tBucketManager bucketManager = new BucketManager(jobManager, storage, info);\n-\t\tstorage.setBucketManager(bucketManager);\n-\t\tthis.queryExecutor = queryExecutor;\n+\t\n+\tpublic Worker(\n+\t\t@NonNull ThreadPoolDefinition queryThreadPoolDefinition,\n+\t\t@NonNull ExecutorService executorService,\n+\t\t@NonNull WorkerStorage storage\n+\t\t) {\n+\t\tthis(\n+\t\t\tnew JobManager(storage.getWorker().getName()),\n+\t\t\tstorage,\n+\t\t\tnew QueryExecutor(queryThreadPoolDefinition.createService(\"QueryExecutor %d\")),\n+\t\t\tstorage.getWorker(),\n+\t\t\texecutorService);\n+\t\t\n+\t\tstorage.setBucketManager(new BucketManager(this.jobManager, this.storage, this.info));\n+\t\t\n+\t}\n+\t\n+\tpublic static Worker newWorker(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI0MTc5NA==", "bodyText": "Tryload l\u00e4d nur den Storage. Ich benutze es hier aber genau anders rum: um zu checken ob der storage f\u00fcr den neuen Worker noch nicht existier, denn dann ist alles gut.", "url": "https://github.com/bakdata/conquery/pull/1304#discussion_r464241794", "createdAt": "2020-08-03T07:34:35Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/worker/Worker.java", "diffHunk": "@@ -34,14 +45,42 @@\n \t@Getter\n \tprivate final ExecutorService executorService;\n \t\n-\tpublic Worker(WorkerInformation info, JobManager jobManager, WorkerStorage storage, QueryExecutor queryExecutor, ExecutorService executorService) {\n-\t\tthis.info = info;\n-\t\tthis.jobManager = jobManager;\n-\t\tthis.storage = storage;\n-\t\tthis.executorService = executorService;\n-\t\tBucketManager bucketManager = new BucketManager(jobManager, storage, info);\n-\t\tstorage.setBucketManager(bucketManager);\n-\t\tthis.queryExecutor = queryExecutor;\n+\t\n+\tpublic Worker(\n+\t\t@NonNull ThreadPoolDefinition queryThreadPoolDefinition,\n+\t\t@NonNull ExecutorService executorService,\n+\t\t@NonNull WorkerStorage storage\n+\t\t) {\n+\t\tthis(\n+\t\t\tnew JobManager(storage.getWorker().getName()),\n+\t\t\tstorage,\n+\t\t\tnew QueryExecutor(queryThreadPoolDefinition.createService(\"QueryExecutor %d\")),\n+\t\t\tstorage.getWorker(),\n+\t\t\texecutorService);\n+\t\t\n+\t\tstorage.setBucketManager(new BucketManager(this.jobManager, this.storage, this.info));\n+\t\t\n+\t}\n+\t\n+\tpublic static Worker newWorker(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMzM3NA=="}, "originalCommit": {"oid": "c6d8172a8d0adfbeb3c5e8fc75c0b18e9cff87e9"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1337, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}