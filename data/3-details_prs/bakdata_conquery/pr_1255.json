{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MTAxMjYz", "number": 1255, "title": "Don't include notIncludedEntityResults to save on bandwidth", "bodyText": "", "createdAt": "2020-07-03T15:04:42Z", "url": "https://github.com/bakdata/conquery/pull/1255", "merged": true, "mergeCommit": {"oid": "17682d6592ce4f4ec37a77a5b91ec015338d8cdf"}, "closed": true, "closedAt": "2020-07-15T14:53:57Z", "author": {"login": "awildturtok"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxU0QYgH2gAyNDQ0MTAxMjYzOjQ4ZjQwY2Q5MGU1ZDZkMTA1MjkzYTMzM2RmNzAwOWY4MTY4YjE3NmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1L3nJAH2gAyNDQ0MTAxMjYzOjBjNDhkY2YyZDJlZTNkNzg3ODk1MzU3NGIyZjExOWRiMzg5Mjk3ZDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48f40cd90e5d6d105293a333df7009f8168b176b", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/48f40cd90e5d6d105293a333df7009f8168b176b", "committedDate": "2020-07-03T15:03:33Z", "message": "Don't send NotContainedEntityResult results."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7855775d5faf6994753cb3ad641232ba033e7c96", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/7855775d5faf6994753cb3ad641232ba033e7c96", "committedDate": "2020-07-03T15:03:51Z", "message": "cleanup away from default methods in interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f53ac391759780e6fb62b5f42a13f542bf2101", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/84f53ac391759780e6fb62b5f42a13f542bf2101", "committedDate": "2020-07-03T15:04:48Z", "message": "Merge branch 'develop' into feature/not-included-as-list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODI4MzM1", "url": "https://github.com/bakdata/conquery/pull/1255#pullrequestreview-447828335", "createdAt": "2020-07-14T06:41:55Z", "commit": {"oid": "84f53ac391759780e6fb62b5f42a13f542bf2101"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjo0MTo1NVrOGxGSsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNjo1MDozN1rOGxGh0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEzNjQ5Ng==", "bodyText": "Ich wei\u00df, das war vorher schon so, aber macht es Sinn hier true zur\u00fcck zugeben?", "url": "https://github.com/bakdata/conquery/pull/1255#discussion_r454136496", "createdAt": "2020-07-14T06:41:55Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/results/FailedEntityResult.java", "diffHunk": "@@ -20,7 +20,12 @@\n \tpublic boolean isFailed() {\n \t\treturn true;\n \t}\n-\t\n+\n+\t@Override\n+\tpublic boolean isContained() {\n+\t\treturn true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84f53ac391759780e6fb62b5f42a13f542bf2101"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEzNzkxMQ==", "bodyText": "Warum nicht\nlog.error(\"Failed query {}\", queryId, e);", "url": "https://github.com/bakdata/conquery/pull/1255#discussion_r454137911", "createdAt": "2020-07-14T06:45:17Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/results/ShardResult.java", "diffHunk": "@@ -43,14 +44,26 @@ public synchronized void addResult(EntityResult result) {\n \t}\n \n \tpublic synchronized void finish() {\n-\t\tif(finishTime == null) {\n-\t\t\ttry {\n-\t\t\t\tresults = new ArrayList<>(Uninterruptibles.getUninterruptibly(future));\n-\t\t\t\tfinishTime = LocalDateTime.now();\n-\t\t\t\tlog.info(\"Finished query {} with {} results within {}\", queryId, results.size(), Duration.between(startTime, finishTime));\n-\t\t\t} catch (ExecutionException e) {\n-\t\t\t\tlog.error(\"Failed query \"+queryId, e);\n+\t\tif (finishTime != null) {\n+\t\t\treturn;\n+\t\t}\n+\n+\t\ttry {\n+\t\t\tfinal List<EntityResult> entityResults = Uninterruptibles.getUninterruptibly(future);\n+\t\t\tresults = new ArrayList<>(entityResults.size());\n+\n+\t\t\tfor (EntityResult entityResult : entityResults) {\n+\t\t\t\tif (!entityResult.isContained()){\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\tresults.add(entityResult);\n \t\t\t}\n+\n+\t\t\tfinishTime = LocalDateTime.now();\n+\t\t\tlog.info(\"Finished query {} with {} results within {}\", queryId, results.size(), Duration.between(startTime, finishTime));\n+\t\t} catch (ExecutionException e) {\n+\t\t\tlog.error(\"Failed query \"+queryId, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84f53ac391759780e6fb62b5f42a13f542bf2101"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE0MDM2OQ==", "bodyText": "Ich bin mir nicht ganz sicher ob das einfach so mit FormQueryPlan geht. So weit ich das verstanden habe braucht dieser die Information \u00fcber NOT_CONTAINED, um leere Zeilen zu erzeugen.", "url": "https://github.com/bakdata/conquery/pull/1255#discussion_r454140369", "createdAt": "2020-07-14T06:50:37Z", "author": {"login": "thoniTUB"}, "path": "backend/src/main/java/com/bakdata/conquery/models/query/results/ShardResult.java", "diffHunk": "@@ -43,14 +44,26 @@ public synchronized void addResult(EntityResult result) {\n \t}\n \n \tpublic synchronized void finish() {\n-\t\tif(finishTime == null) {\n-\t\t\ttry {\n-\t\t\t\tresults = new ArrayList<>(Uninterruptibles.getUninterruptibly(future));\n-\t\t\t\tfinishTime = LocalDateTime.now();\n-\t\t\t\tlog.info(\"Finished query {} with {} results within {}\", queryId, results.size(), Duration.between(startTime, finishTime));\n-\t\t\t} catch (ExecutionException e) {\n-\t\t\t\tlog.error(\"Failed query \"+queryId, e);\n+\t\tif (finishTime != null) {\n+\t\t\treturn;\n+\t\t}\n+\n+\t\ttry {\n+\t\t\tfinal List<EntityResult> entityResults = Uninterruptibles.getUninterruptibly(future);\n+\t\t\tresults = new ArrayList<>(entityResults.size());\n+\n+\t\t\tfor (EntityResult entityResult : entityResults) {\n+\t\t\t\tif (!entityResult.isContained()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84f53ac391759780e6fb62b5f42a13f542bf2101"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "519cd981e20bfb9657234ad91e140e5904fcca20", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/519cd981e20bfb9657234ad91e140e5904fcca20", "committedDate": "2020-07-14T09:01:54Z", "message": "cleaner handling of FailedEntityResult / EntityResult::isFailed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODg3ODEy", "url": "https://github.com/bakdata/conquery/pull/1255#pullrequestreview-448887812", "createdAt": "2020-07-15T12:06:18Z", "commit": {"oid": "519cd981e20bfb9657234ad91e140e5904fcca20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c48dcf2d2ee3d7878953574b2f119db389297d0", "author": {"user": {"login": "awildturtok", "name": null}}, "url": "https://github.com/bakdata/conquery/commit/0c48dcf2d2ee3d7878953574b2f119db389297d0", "committedDate": "2020-07-15T14:53:46Z", "message": "Merge branch 'develop' into feature/not-included-as-list"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4485, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}