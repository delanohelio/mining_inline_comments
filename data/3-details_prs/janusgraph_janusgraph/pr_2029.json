{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDczMDgw", "number": 2029, "title": "Move reflections to reflections8", "bodyText": "Updates reflections to reflections8 which doesn't depend on guava.\nNotice reflections version 0.9.12 is the newest version which doesn't depend on guava but it currently has a bug ronmamo/reflections#273 which might be fixed by ronmamo/reflections#278 in the future versions.\nreflections8 become obsolete after reflections version 0.9.12 but reflections8 version 0.11.7 is a newer version than reflections version 0.9.11 and it doesn't depend on guava.\nThat is why, this PR updates reflections to reflections8 which uses Java 8 Stream API instead of guava. In the future if the bug is fixed in reflections and a newer version of reflections is released with the bugfix we may go back to reflections. In the meantime I am proposing to move to reflections8 which is a cleaner version of reflections and doesn't depend on guava anymore.\nThe added unit test shows the bug which is introduced in reflections 0.9.12. The unit test passes for current master branch and current PR (i.e. for all versions of reflections but fails for reflections 0.9.12).\nSuppresses #2023\nRelated to #2033\nP.S. Before I found reflections8 fork, I was trying to update reflections to version 0.9.11 which didn't go smooth because that version depends on guava >= 20 and some of our dependencies depend on guava 18. Guava is often binary  incompatible with previous versions that is why it produces some troubles when some dependencies depend on one guava version and some dependencies on another guava version. In the long term I would like to remove usage of guava completely from the project.\nSigned-off-by: Oleksandr Porunov alexandr.porunov@gmail.com\n\nThank you for contributing to JanusGraph!\nIn order to streamline the review of the contribution we ask you\nto ensure the following steps have been taken:\nFor all changes:\n\n Is there an issue associated with this PR? Is it referenced in the commit message?\n Does your PR body contain #xyz where xyz is the issue number you are trying to resolve?\n Has your PR been rebased against the latest commit within the target branch (typically master)?\n Is your initial contribution a single, squashed commit?\n\nFor code changes:\n\n Have you written and/or updated unit tests to verify your changes?\n If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under ASF 2.0?\n If applicable, have you updated the LICENSE.txt file, including the main LICENSE.txt file in the root of this repository?\n If applicable, have you updated the NOTICE.txt file, including the main NOTICE.txt file found in the root of this repository?\n\nFor documentation related changes:\n\n Have you ensured that format looks appropriate for the output in which it is rendered?\n If this PR is a documentation-only change, have you added a [doc only]\ntag to the first line of your commit message to avoid spending CPU cycles in\nTravis CI when no code, tests, or build configuration are modified?\n\nNote:\nPlease ensure that once the PR is submitted, you check Travis CI for build issues and submit an update to your PR as soon as possible.", "createdAt": "2020-03-07T00:13:17Z", "url": "https://github.com/JanusGraph/janusgraph/pull/2029", "merged": true, "mergeCommit": {"oid": "a222dd20e7e4843988a2ef95687e7a7adf0609a0"}, "closed": true, "closedAt": "2020-03-09T19:32:13Z", "author": {"login": "porunov"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLgJyTABqjMxMDgxMzA1OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMA8-7gBqjMxMTE1NDY0MTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc33326fa2efc2ed0a9d50ccb77500d1c621dd1e", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/bc33326fa2efc2ed0a9d50ccb77500d1c621dd1e", "committedDate": "2020-03-07T00:07:56Z", "message": "Update reflections to 0.9.11 and guava to 28.2-jre\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}, "afterCommit": {"oid": "2f1f1a94599673d1e5099ee1e16460a240c70195", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/2f1f1a94599673d1e5099ee1e16460a240c70195", "committedDate": "2020-03-08T02:46:29Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f1f1a94599673d1e5099ee1e16460a240c70195", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/2f1f1a94599673d1e5099ee1e16460a240c70195", "committedDate": "2020-03-08T02:46:29Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}, "afterCommit": {"oid": "1ff85b7f6ac3519196b29efcddfad47df98368ca", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/1ff85b7f6ac3519196b29efcddfad47df98368ca", "committedDate": "2020-03-08T02:56:00Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTY3NDEw", "url": "https://github.com/JanusGraph/janusgraph/pull/2029#pullrequestreview-370967410", "createdAt": "2020-03-09T07:57:02Z", "commit": {"oid": "1ff85b7f6ac3519196b29efcddfad47df98368ca"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNzo1NzowM1rOFzdgig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNzo1NzowM1rOFzdgig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUwNTE2Mg==", "bodyText": "typo: the problem in the code\nIf this test only has the purpose to check whether we are affected by the bug in reflections8, then I think that it makes sense to link to that issue here in a comment.", "url": "https://github.com/JanusGraph/janusgraph/pull/2029#discussion_r389505162", "createdAt": "2020-03-09T07:57:03Z", "author": {"login": "FlorianHockmann"}, "path": "janusgraph-test/src/test/java/org/janusgraph/core/util/ReflectiveConfigOptionLoaderTest.java", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright 2020 JanusGraph Authors\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package org.janusgraph.core.util;\n+\n+import org.janusgraph.graphdb.configuration.PreInitializeConfigOptions;\n+import org.junit.jupiter.api.Test;\n+import org.reflections8.Reflections;\n+import org.reflections8.scanners.SubTypesScanner;\n+import org.reflections8.scanners.TypeAnnotationsScanner;\n+\n+import java.util.Collections;\n+\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+\n+public class ReflectiveConfigOptionLoaderTest {\n+\n+    @Test\n+    public void shouldLoadAllClasses(){\n+        org.reflections8.Configuration rc = new org.reflections8.util.ConfigurationBuilder()\n+            .setUrls(Collections.emptyList())\n+            .setScanners(new TypeAnnotationsScanner(), new SubTypesScanner());\n+        Reflections reflections = new Reflections(rc);\n+        assertDoesNotThrow(() -> reflections.getTypesAnnotatedWith(PreInitializeConfigOptions.class));\n+        /*\n+        To reproduce the problem is the code, we can use the next example but notice that the assertion will fail", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ff85b7f6ac3519196b29efcddfad47df98368ca"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ff85b7f6ac3519196b29efcddfad47df98368ca", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/1ff85b7f6ac3519196b29efcddfad47df98368ca", "committedDate": "2020-03-08T02:56:00Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}, "afterCommit": {"oid": "0c8b236c7ddf71b6fafcdd47d2a03add2a007759", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/0c8b236c7ddf71b6fafcdd47d2a03add2a007759", "committedDate": "2020-03-09T16:56:42Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a11bc60338ca066417e6d2d34cee1b4678cc7f", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/33a11bc60338ca066417e6d2d34cee1b4678cc7f", "committedDate": "2020-03-09T16:59:26Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c8b236c7ddf71b6fafcdd47d2a03add2a007759", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/0c8b236c7ddf71b6fafcdd47d2a03add2a007759", "committedDate": "2020-03-09T16:56:42Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}, "afterCommit": {"oid": "33a11bc60338ca066417e6d2d34cee1b4678cc7f", "author": {"user": {"login": "porunov", "name": "Oleksandr Porunov"}}, "url": "https://github.com/JanusGraph/janusgraph/commit/33a11bc60338ca066417e6d2d34cee1b4678cc7f", "committedDate": "2020-03-09T16:59:26Z", "message": "Move reflections to reflections 8\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4731, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}