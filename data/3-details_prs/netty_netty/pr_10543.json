{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNjE1Mzkw", "number": 10543, "title": "Exploit blocking FAST_POLL for eventfd reads", "bodyText": "Motivation\nIf we make eventfd blocking then read can take the place of poll+read\nModification\nMake eventfd blocking, use READ instead of POLLIN, allocating a static 64bit buffer to read into\nResult\nFewer kernel roundtrips for event loop wakeups", "createdAt": "2020-09-07T19:42:13Z", "url": "https://github.com/netty/netty/pull/10543", "merged": true, "mergeCommit": {"oid": "2316c2ce4587d9ccb25d1bc2dcbf85f4c4e9518d"}, "closed": true, "closedAt": "2020-09-10T05:37:39Z", "author": {"login": "njhill"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG6UQaAFqTQ4NDMxNDQyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHW6t0gFqTQ4NTUxMzM3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MzE0NDI5", "url": "https://github.com/netty/netty/pull/10543#pullrequestreview-484314429", "createdAt": "2020-09-08T16:37:24Z", "commit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDExMzE4", "url": "https://github.com/netty/netty/pull/10543#pullrequestreview-484411318", "createdAt": "2020-09-08T18:56:40Z", "commit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODo1Njo0MFrOHOqCiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODo1Njo0MFrOHOqCiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzMDg4OA==", "bodyText": "@njhill is this safe using a shared read buffer with multiple io ring event loops..?", "url": "https://github.com/netty/netty/pull/10543#discussion_r485130888", "createdAt": "2020-09-08T18:56:40Z", "author": {"login": "johnou"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/IOUringEventLoop.java", "diffHunk": "@@ -34,6 +34,8 @@\n                                                            IOUringCompletionQueue.IOUringCompletionQueueCallback {\n     private static final InternalLogger logger = InternalLoggerFactory.getInstance(IOUringEventLoop.class);\n \n+    private static final long efdReadBuf = PlatformDependent.allocateMemory(8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/374e121afa4fcfce431b83dd8fc94e400538c35c", "committedDate": "2020-09-05T19:02:27Z", "message": "Exploit blocking FAST_POLL for eventfd reads\n\nMotivation\n\nIf we make eventfd blocking then read can take the place of poll+read\n\nModification\n\nMake eventfd blocking, use READ instead of POLLIN, allocating a static\n64bit buffer to read into\n\nResult\n\nFewer kernel roundtrips for event loop wakeups"}, "afterCommit": {"oid": "357f3313548d712b528a11de3fa3b15d95977863", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/357f3313548d712b528a11de3fa3b15d95977863", "committedDate": "2020-09-09T16:46:04Z", "message": "Keep eventfd read buffer per event loop rather than sharing globally"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTU1MzE3", "url": "https://github.com/netty/netty/pull/10543#pullrequestreview-485155317", "createdAt": "2020-09-09T15:54:55Z", "commit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTo1NDo1NVrOHPOG4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTo1NDo1NVrOHPOG4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMTgyNw==", "bodyText": "maybe change the name to make it clear that this one is blocking", "url": "https://github.com/netty/netty/pull/10543#discussion_r485721827", "createdAt": "2020-09-09T15:54:55Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/c/netty_io_uring_native.c", "diffHunk": "@@ -171,7 +171,8 @@ static jint netty_io_uring_enter(JNIEnv *env, jclass class1, jint ring_fd, jint\n }\n \n static jint netty_epoll_native_eventFd(JNIEnv* env, jclass clazz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "374e121afa4fcfce431b83dd8fc94e400538c35c"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzA4MjU0", "url": "https://github.com/netty/netty/pull/10543#pullrequestreview-485308254", "createdAt": "2020-09-09T18:57:50Z", "commit": {"oid": "7ac82b215092317c9814060a6146e252b79a2670"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODo1Nzo1MVrOHPVhfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODo1Nzo1MVrOHPVhfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg0MzMyNg==", "bodyText": "nit: please rename as well", "url": "https://github.com/netty/netty/pull/10543#discussion_r485843326", "createdAt": "2020-09-09T18:57:51Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/Native.java", "diffHunk": "@@ -111,15 +111,13 @@ static RingBuffer createRingBuffer(Runnable submissionCallback) {\n \n     public static native void eventFdWrite(int fd, long value);\n \n-    public static native void eventFdRead(int fd);\n-\n     public static FileDescriptor newEventFd() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ac82b215092317c9814060a6146e252b79a2670"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baa3839e666b623fbbfdf0f9425a8b4e2fcaa906", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/baa3839e666b623fbbfdf0f9425a8b4e2fcaa906", "committedDate": "2020-09-09T19:23:12Z", "message": "Exploit blocking FAST_POLL for eventfd reads\n\nMotivation\n\nIf we make eventfd blocking then read can take the place of poll+read\n\nModification\n\nMake eventfd blocking, use READ instead of POLLIN, allocating a static\n64bit buffer to read into\n\nResult\n\nFewer kernel roundtrips for event loop wakeups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397e1cbc354a4f2c8dfc67667e3b44d88b464697", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/397e1cbc354a4f2c8dfc67667e3b44d88b464697", "committedDate": "2020-09-09T19:26:58Z", "message": "Keep eventfd read buffer per event loop rather than sharing globally"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76574282bc8e56af319352f72ca47f5e6065f4c0", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/76574282bc8e56af319352f72ca47f5e6065f4c0", "committedDate": "2020-09-09T19:26:59Z", "message": "Rename JNI blocking eventfd method, remove now-unused eventFdRead method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2269c39b3ef104765b519fde6b2ab1c6128545f", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/e2269c39b3ef104765b519fde6b2ab1c6128545f", "committedDate": "2020-09-09T19:29:49Z", "message": "Rename Native#newEventFd() -> Native#newBlockingEventFd()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ac82b215092317c9814060a6146e252b79a2670", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/7ac82b215092317c9814060a6146e252b79a2670", "committedDate": "2020-09-09T17:18:55Z", "message": "Rename JNI blocking eventfd method, remove now-unused eventFdRead method"}, "afterCommit": {"oid": "e2269c39b3ef104765b519fde6b2ab1c6128545f", "author": {"user": {"login": "njhill", "name": "Nick Hill"}}, "url": "https://github.com/netty/netty/commit/e2269c39b3ef104765b519fde6b2ab1c6128545f", "committedDate": "2020-09-09T19:29:49Z", "message": "Rename Native#newEventFd() -> Native#newBlockingEventFd()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NTEzMzc3", "url": "https://github.com/netty/netty/pull/10543#pullrequestreview-485513377", "createdAt": "2020-09-10T01:56:45Z", "commit": {"oid": "e2269c39b3ef104765b519fde6b2ab1c6128545f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 16, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}