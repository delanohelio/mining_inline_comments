{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0Mjk4MDUw", "number": 10694, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozOTowNlrOEuIAeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwODowMzo1MVrOEuxXTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2ODAxMTQ0OnYy", "diffSide": "RIGHT", "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozOTowNlrOHiVL9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxOTo1MDozN1rOHiXkAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MDc1OA==", "bodyText": "Please refactor to:\ntry {\n    ...\n} catch (ThreadDeath td) {\n    throw (ThreadDeath) td;\n} catch (Throwable t) {\n    handleLoopException(t);\n}\nSome for all other places.", "url": "https://github.com/netty/netty/pull/10694#discussion_r505760758", "createdAt": "2020-10-15T18:39:06Z", "author": {"login": "normanmaurer"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -391,7 +391,11 @@ protected void run() {\n                     events.increase();\n                 }\n             } catch (Throwable t) {\n-                handleLoopException(t);\n+                if (t instanceof ThreadDeath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c192761b5040cf292f66bb5dc0c273ec7008aed8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc5OTY4Mg==", "bodyText": "Sure, refactored.", "url": "https://github.com/netty/netty/pull/10694#discussion_r505799682", "createdAt": "2020-10-15T19:50:37Z", "author": {"login": "greenjustin"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -391,7 +391,11 @@ protected void run() {\n                     events.increase();\n                 }\n             } catch (Throwable t) {\n-                handleLoopException(t);\n+                if (t instanceof ThreadDeath) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MDc1OA=="}, "originalCommit": {"oid": "c192761b5040cf292f66bb5dc0c273ec7008aed8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MDg2ODA1OnYy", "diffSide": "RIGHT", "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTozNTo1M1rOHixW8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDozNjo0OVrOHjB5oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIyMjMyMQ==", "bodyText": "Right below these catch clauses it says \"Always handle shutdown even if the loop processing threw an exception.\"\nShould that perhaps be moved into a finally clause? It's the same deal in all of the event loops modified in this PR.", "url": "https://github.com/netty/netty/pull/10694#discussion_r506222321", "createdAt": "2020-10-16T09:35:53Z", "author": {"login": "chrisvest"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -390,6 +390,8 @@ protected void run() {\n                     //increase the size of the array as we needed the whole space for the events\n                     events.increase();\n                 }\n+            } catch (ThreadDeath td) {\n+                throw (ThreadDeath) td;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c21a1886229297fdce64c0a49492ba02c2847c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0MjE1Mw==", "bodyText": "good idea @chrisvest ... @greenjustin can you please adjust ?", "url": "https://github.com/netty/netty/pull/10694#discussion_r506242153", "createdAt": "2020-10-16T09:56:57Z", "author": {"login": "normanmaurer"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -390,6 +390,8 @@ protected void run() {\n                     //increase the size of the array as we needed the whole space for the events\n                     events.increase();\n                 }\n+            } catch (ThreadDeath td) {\n+                throw (ThreadDeath) td;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIyMjMyMQ=="}, "originalCommit": {"oid": "e8c21a1886229297fdce64c0a49492ba02c2847c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ5MzM0NA==", "bodyText": "Sure, how does this look?", "url": "https://github.com/netty/netty/pull/10694#discussion_r506493344", "createdAt": "2020-10-16T14:36:49Z", "author": {"login": "greenjustin"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -390,6 +390,8 @@ protected void run() {\n                     //increase the size of the array as we needed the whole space for the events\n                     events.increase();\n                 }\n+            } catch (ThreadDeath td) {\n+                throw (ThreadDeath) td;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIyMjMyMQ=="}, "originalCommit": {"oid": "e8c21a1886229297fdce64c0a49492ba02c2847c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3NDc4NzM1OnYy", "diffSide": "RIGHT", "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwODowMzo1MVrOHjYfcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwODowMzo1MVrOHjYfcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjg2MzQ3NQ==", "bodyText": "@greenjustin wouldn't you want to rethrow ThreadDeath here as well ? (same is true for all the other impls)", "url": "https://github.com/netty/netty/pull/10694#discussion_r506863475", "createdAt": "2020-10-17T08:03:51Z", "author": {"login": "normanmaurer"}, "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventLoop.java", "diffHunk": "@@ -390,19 +390,22 @@ protected void run() {\n                     //increase the size of the array as we needed the whole space for the events\n                     events.increase();\n                 }\n+            } catch (ThreadDeath td) {\n+                throw (ThreadDeath) td;\n             } catch (Throwable t) {\n                 handleLoopException(t);\n-            }\n-            // Always handle shutdown even if the loop processing threw an exception.\n-            try {\n-                if (isShuttingDown()) {\n-                    closeAll();\n-                    if (confirmShutdown()) {\n-                        break;\n+            } finally {\n+                // Always handle shutdown even if the loop processing threw an exception.\n+                try {\n+                    if (isShuttingDown()) {\n+                        closeAll();\n+                        if (confirmShutdown()) {\n+                            break;\n+                        }\n                     }\n+                } catch (Throwable t) {\n+                    handleLoopException(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10258ed3316133eb90f8d6574c2498ee82e8df0d"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3618, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}