{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMjAwNjk0", "number": 9933, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNDowODo0OFrODXDEQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNDozOTo0N1rODXDPhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDk0MDgyOnYy", "diffSide": "RIGHT", "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNDowODo0OFrOFcJ2SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODowNDoyNlrOFcMm9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2NTgwMQ==", "bodyText": "add fail(); above", "url": "https://github.com/netty/netty/pull/9933#discussion_r365065801", "createdAt": "2020-01-10T04:08:48Z", "author": {"login": "normanmaurer"}, "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "diffHunk": "@@ -344,6 +344,42 @@ public void testFallbackToDefaultContext() throws Exception {\n         }\n     }\n \n+    @Test(timeout = 10000)\n+    public void testMajorVersionNot3() throws Exception {\n+        SslContext nettyContext = makeSslContext(provider, false);\n+\n+        try {\n+            DomainNameMapping<SslContext> mapping = new DomainNameMappingBuilder<SslContext>(nettyContext).build();\n+\n+            SniHandler handler = new SniHandler(mapping);\n+            EmbeddedChannel ch = new EmbeddedChannel(handler);\n+\n+            // invalid\n+            byte[] message = {22, 2, 0, 0, 0};\n+            try {\n+                // Push the handshake message.\n+                ch.writeInbound(Unpooled.wrappedBuffer(message));\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d56d49ca8d2f11ae2e3658b2db99f2283855161f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2OTc3Mg==", "bodyText": "@normanmaurer done, I actually just copied the existing testFallbackToDefaultContext() as a starting point, which had this fail() commented out for some reason. So I've uncommented it there too since an exception does also get thrown in that case.", "url": "https://github.com/netty/netty/pull/9933#discussion_r365069772", "createdAt": "2020-01-10T04:37:05Z", "author": {"login": "njhill"}, "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "diffHunk": "@@ -344,6 +344,42 @@ public void testFallbackToDefaultContext() throws Exception {\n         }\n     }\n \n+    @Test(timeout = 10000)\n+    public void testMajorVersionNot3() throws Exception {\n+        SslContext nettyContext = makeSslContext(provider, false);\n+\n+        try {\n+            DomainNameMapping<SslContext> mapping = new DomainNameMappingBuilder<SslContext>(nettyContext).build();\n+\n+            SniHandler handler = new SniHandler(mapping);\n+            EmbeddedChannel ch = new EmbeddedChannel(handler);\n+\n+            // invalid\n+            byte[] message = {22, 2, 0, 0, 0};\n+            try {\n+                // Push the handshake message.\n+                ch.writeInbound(Unpooled.wrappedBuffer(message));\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2NTgwMQ=="}, "originalCommit": {"oid": "d56d49ca8d2f11ae2e3658b2db99f2283855161f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTExMTAyOQ==", "bodyText": "@njhill after some more digging this actually depends on if jdkCompatibilityMode is true of not. Let me do a follow up to fix it and then investigate later on.", "url": "https://github.com/netty/netty/pull/9933#discussion_r365111029", "createdAt": "2020-01-10T08:04:26Z", "author": {"login": "normanmaurer"}, "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "diffHunk": "@@ -344,6 +344,42 @@ public void testFallbackToDefaultContext() throws Exception {\n         }\n     }\n \n+    @Test(timeout = 10000)\n+    public void testMajorVersionNot3() throws Exception {\n+        SslContext nettyContext = makeSslContext(provider, false);\n+\n+        try {\n+            DomainNameMapping<SslContext> mapping = new DomainNameMappingBuilder<SslContext>(nettyContext).build();\n+\n+            SniHandler handler = new SniHandler(mapping);\n+            EmbeddedChannel ch = new EmbeddedChannel(handler);\n+\n+            // invalid\n+            byte[] message = {22, 2, 0, 0, 0};\n+            try {\n+                // Push the handshake message.\n+                ch.writeInbound(Unpooled.wrappedBuffer(message));\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2NTgwMQ=="}, "originalCommit": {"oid": "d56d49ca8d2f11ae2e3658b2db99f2283855161f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDk2OTY2OnYy", "diffSide": "RIGHT", "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNDozOTo0N1rOFcKHKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNDozOTo0N1rOFcKHKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA3MDEyMg==", "bodyText": "@njhill thanks... Lets see if this works for all JDK versions that we use on the CI :) If so we can close the issue as well.", "url": "https://github.com/netty/netty/pull/9933#discussion_r365070122", "createdAt": "2020-01-10T04:39:47Z", "author": {"login": "normanmaurer"}, "path": "handler/src/test/java/io/netty/handler/ssl/SniHandlerTest.java", "diffHunk": "@@ -320,7 +320,7 @@ public void testFallbackToDefaultContext() throws Exception {\n                 ch.writeInbound(Unpooled.wrappedBuffer(message));\n                 // TODO(scott): This should fail because the engine should reject zero length records during handshake.\n                 // See https://github.com/netty/netty/issues/6348.\n-                // fail();\n+                fail();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42bd712030fdbc1f6f0bcb86bfb3f4bc1dc877f2"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3523, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}