{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NTIxNTkx", "number": 10170, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTo1NDozOFrODvF65A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTo1NDozOFrODvF65A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNzA2NjYwOnYy", "diffSide": "RIGHT", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTo1NDozOFrOGBUMTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNTo1MTo1M1rOGBz1hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA==", "bodyText": "@minwoox hmm... shouldn't we still support AAAA if its a loopback address ? I mean the user may run the DNS server on the same machine.", "url": "https://github.com/netty/netty/pull/10170#discussion_r404032588", "createdAt": "2020-04-06T11:54:38Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzNjI1Ng==", "bodyText": "So you mean the client and the DNS server in the same machine?\nYes, that could be possible, but I think, in that case, there should be another valid address that the client can connect to the DNS server so that the client can ultimately connect to other endpoints using that address.", "url": "https://github.com/netty/netty/pull/10170#discussion_r404036256", "createdAt": "2020-04-06T12:01:10Z", "author": {"login": "minwoox"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzOTMwNA==", "bodyText": "yes ... I think it is valid to only have ::1 configured for this case.", "url": "https://github.com/netty/netty/pull/10170#discussion_r404039304", "createdAt": "2020-04-06T12:06:59Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA0NjQyNw==", "bodyText": "If the machine does not have any other addresses than ::1, shouldn't we prevent the client from sending any AAAA query? Because the client cannot establish a connection using the resolved IPv6 address to the endpoint? \ud83e\udd14", "url": "https://github.com/netty/netty/pull/10170#discussion_r404046427", "createdAt": "2020-04-06T12:19:25Z", "author": {"login": "minwoox"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NDIzMQ==", "bodyText": "@minwoox no... the resolver is used during bootstrap but may also used separately (for only resolving addresses). It doesn't matter if we can connect to the address or not, thats no the job of the resolver to check.", "url": "https://github.com/netty/netty/pull/10170#discussion_r404074231", "createdAt": "2020-04-06T13:05:45Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUwNDQ5Mw==", "bodyText": "Ah, now I got it what you meant. \ud83d\ude04\nBut I still think that setting DEFAULT_RESOLVE_ADDRESS_TYPES to ResolvedAddressTypes.IPV4_ONLY is safe when there are only local addresses.\nBecause there's a chance that the DnsNameResolver gets the AAAA response ahead of A response and if the resolver uses it, the client would not make a connection. As we got reported.\nIf a user wants to send an IPv6 query like you gave an example, he or she can just set IPV4_PREFERRED or IPV6_PREFERRED when building DnsNameResovler.\nWhat do you think?", "url": "https://github.com/netty/netty/pull/10170#discussion_r404504493", "createdAt": "2020-04-07T02:47:30Z", "author": {"login": "minwoox"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU0MzU3Mg==", "bodyText": "True...  I think the title of the PR did confuse me as I did not realise this is just about default behaviour", "url": "https://github.com/netty/netty/pull/10170#discussion_r404543572", "createdAt": "2020-04-07T05:27:47Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU1MTA0Ng==", "bodyText": "Ah sorry about it. \ud83d\ude05 Just use the title from the original PR without much thinking.\nline/armeria#2464 Let me change it. Thank you!", "url": "https://github.com/netty/netty/pull/10170#discussion_r404551046", "createdAt": "2020-04-07T05:51:53Z", "author": {"login": "minwoox"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA=="}, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3388, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}