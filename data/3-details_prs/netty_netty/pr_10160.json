{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NTgzNDM3", "number": 10160, "title": "Release the temporary ByteBuf in case of unexpected exception in WebSocketUtil.base64.", "bodyText": "Motivation:\nAn exception may occur between ByteBuf's allocation and release. So I think it's a good idea to place the release operation in a finally block.\nModification:\nRelease the temporary ByteBuf in finally blocks.\nResult:\nAvoid ByteBuf leak.", "createdAt": "2020-04-02T13:35:22Z", "url": "https://github.com/netty/netty/pull/10160", "merged": true, "mergeCommit": {"oid": "bdaa935756c3ae86f8b5353011d9682d5e247dcc"}, "closed": true, "closedAt": "2020-04-03T12:49:40Z", "author": {"login": "seedeed"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTsS1HAH2gAyMzk3NTgzNDM3OjY2N2Q2ZDMyYzI1MmYwZmIyN2ZiZGJlOTJkMDgwNDNkZDMzODY4ZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT8FSDgFqTM4NzAzMTY1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "667d6d32c252f0fb27fbdbe92d08043dd33868e3", "author": {"user": {"login": "seedeed", "name": "feijermu"}}, "url": "https://github.com/netty/netty/commit/667d6d32c252f0fb27fbdbe92d08043dd33868e3", "committedDate": "2020-04-02T13:27:02Z", "message": "Release the temporary ByteBuf in case of unexpected exception in WebSocketUtil.base64."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDQ3MjQy", "url": "https://github.com/netty/netty/pull/10160#pullrequestreview-386447242", "createdAt": "2020-04-02T13:52:40Z", "commit": {"oid": "667d6d32c252f0fb27fbdbe92d08043dd33868e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo1Mjo0MFrOF_sR1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo1Mjo0MFrOF_sR1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMDA2OQ==", "bodyText": "@seedeed all of this should never throw. If it throws we have a bug in our implementation. What I am missing ?", "url": "https://github.com/netty/netty/pull/10160#discussion_r402330069", "createdAt": "2020-04-02T13:52:40Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketUtil.java", "diffHunk": "@@ -96,10 +96,18 @@ static String base64(byte[] data) {\n         if (PlatformDependent.javaVersion() >= 8) {\n             return java.util.Base64.getEncoder().encodeToString(data);\n         }\n+        String encodedString;\n         ByteBuf encodedData = Unpooled.wrappedBuffer(data);\n-        ByteBuf encoded = Base64.encode(encodedData);\n-        String encodedString = encoded.toString(CharsetUtil.UTF_8);\n-        encoded.release();\n+        try {\n+            ByteBuf encoded = Base64.encode(encodedData);\n+            try {\n+                encodedString = encoded.toString(CharsetUtil.UTF_8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "667d6d32c252f0fb27fbdbe92d08043dd33868e3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MDMxNjUy", "url": "https://github.com/netty/netty/pull/10160#pullrequestreview-387031652", "createdAt": "2020-04-03T07:50:43Z", "commit": {"oid": "667d6d32c252f0fb27fbdbe92d08043dd33868e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 230, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}