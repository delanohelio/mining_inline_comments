{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNjEyMzQ4", "number": 10555, "title": "Allow to specify a callback that is executed once submit was called and", "bodyText": "use it for clearing the IovArrays\nMotivation:\nIOUringSubmissionQueue may call submit() internally when there is no\nspace left in the buffer. Once this is done we can reuse for example\nIovArrays etc. Because of this its useful to be able to specify a\ncallback that is executed after submission\nModifications:\n\nAllow to specify a Runnable that is called once submission was\ncomplete\nUse this callback to clear the IovArrays\n\nResult:\nIovArrays are automatically cleared on each submit call.", "createdAt": "2020-09-09T07:44:23Z", "url": "https://github.com/netty/netty/pull/10555", "merged": true, "mergeCommit": {"oid": "dd63d1c8d09157c1e6dd968833bf7e85e69f47b5"}, "closed": true, "closedAt": "2020-09-09T15:18:48Z", "author": {"login": "normanmaurer"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHHZlRgH2gAyNDgyNjEyMzQ4OjBhMDRkN2NmM2YwYTMzZjlkMjY4Yzc1MmEzZDY4YmVhNGM0YzliZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHNbJDgFqTQ4NTA5NDg4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3", "committedDate": "2020-09-09T07:51:59Z", "message": "Allow to specify a callback that is executed once submit was called and\nuse it for clearing the IovArrays\n\nMotivation:\n\nIOUringSubmissionQueue may call submit() internally when there is no\nspace left in the buffer. Once this is done we can reuse for example\nIovArrays etc. Because of this its useful to be able to specify a\ncallback that is executed after submission\n\nModifications:\n\n- Allow to specify a Runnable that is called once submission was\ncomplete\n- Use this callback to clear the IovArrays\n\nResult:\n\nIovArrays are automatically cleared on each submit call."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "525429243a12b2ac8b7e7cfde15c8c1973ac7a10", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/525429243a12b2ac8b7e7cfde15c8c1973ac7a10", "committedDate": "2020-09-09T07:40:46Z", "message": "Allow to specify a callback that is executed once submit was called and\nuse it for clearing the IovArrays\n\nMotivation:\n\nIOUringSubmissionQueue may call submit() internally when there is no\nspace left in the buffer. Once this is done we can reuse for example\nIovArrays etc. Because of this its useful to be able to specify a\ncallback that is executed after submission\n\nModifications:\n\n- Allow to specify a Runnable that is called once submission was\ncomplete\n- Use this callback to clear the IovArrays\n\nResult:\n\nIovArrays are automatically cleared on each submit call."}, "afterCommit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3", "committedDate": "2020-09-09T07:51:59Z", "message": "Allow to specify a callback that is executed once submit was called and\nuse it for clearing the IovArrays\n\nMotivation:\n\nIOUringSubmissionQueue may call submit() internally when there is no\nspace left in the buffer. Once this is done we can reuse for example\nIovArrays etc. Because of this its useful to be able to specify a\ncallback that is executed after submission\n\nModifications:\n\n- Allow to specify a Runnable that is called once submission was\ncomplete\n- Use this callback to clear the IovArrays\n\nResult:\n\nIovArrays are automatically cleared on each submit call."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NzcwOTMw", "url": "https://github.com/netty/netty/pull/10555#pullrequestreview-484770930", "createdAt": "2020-09-09T08:21:25Z", "commit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDQxMzg4", "url": "https://github.com/netty/netty/pull/10555#pullrequestreview-485041388", "createdAt": "2020-09-09T14:01:53Z", "commit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDowMTo1M1rOHPI4hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDowMzo0NVrOHPI99g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNjIzMQ==", "bodyText": "I increasingly want the IovArray[8] to be encapsulated in its own component, which we could then ask for a clear-callback. Then we could also test it independently.", "url": "https://github.com/netty/netty/pull/10555#discussion_r485636231", "createdAt": "2020-09-09T14:01:53Z", "author": {"login": "chrisvest"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/IOUringEventLoop.java", "diffHunk": "@@ -65,7 +65,14 @@\n         for (int i = 0; i < iovArrays.length; i++) {\n             iovArrays[i] = new IovArray();\n         }\n-        ringBuffer = Native.createRingBuffer();\n+        ringBuffer = Native.createRingBuffer(new Runnable() {\n+            @Override\n+            public void run() {\n+                // Once we submitted its safe to clear the IovArrays and so be able to re-use these.\n+                clearUsedIovArrays();\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNzYyMg==", "bodyText": "Could we perhaps wire this up after construction, so we don't need to pass the callback through so many layers?", "url": "https://github.com/netty/netty/pull/10555#discussion_r485637622", "createdAt": "2020-09-09T14:03:45Z", "author": {"login": "chrisvest"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/IOUringSubmissionQueue.java", "diffHunk": "@@ -86,7 +87,7 @@\n         this.ringSize = ringSize;\n         this.ringAddress = ringAddress;\n         this.ringFd = ringFd;\n-\n+        this.submissionCallback = submissionCallback;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDk0ODgw", "url": "https://github.com/netty/netty/pull/10555#pullrequestreview-485094880", "createdAt": "2020-09-09T14:53:07Z", "commit": {"oid": "0a04d7cf3f0a33f9d268c752a3d68bea4c4c9bf3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 30, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}