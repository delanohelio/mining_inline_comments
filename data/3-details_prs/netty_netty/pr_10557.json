{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzQzNjE2", "number": 10557, "title": "Fix NPE with MqttUnsubAckMessage - regression of MQTT5 support", "bodyText": "Motivation:\nRecent changes for MQTT5 may cause NPE if UNSUBACK message is created with MqttMessageFactory\nand client code isn't up-to-date.\nModifications:\nAdded default body in MqttUnsubAckMessage constructor if null body is passed,\nadded null checks in encodeUnsubAckMessage\nResult:\nMqttUnsubAckMessage created with MqttMessageFactory doesn't cause NPE\neven if null body is supplied.", "createdAt": "2020-09-09T10:31:19Z", "url": "https://github.com/netty/netty/pull/10557", "merged": true, "mergeCommit": {"oid": "3b47427cf7abcca72442989c29ae5b9561ed918c"}, "closed": true, "closedAt": "2020-09-14T10:04:56Z", "author": {"login": "paul-lysak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHJoUCgH2gAyNDgyNzQzNjE2OjRmOGJhNWU0MGExYzE0NDA4MDc1NzJjYTAxZmYwN2JjNGNmMWI0ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHzOqqgFqTQ4NjcwNjI4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f8ba5e40a1c1440807572ca01ff07bc4cf1b4dd", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/4f8ba5e40a1c1440807572ca01ff07bc4cf1b4dd", "committedDate": "2020-09-09T10:27:53Z", "message": "Motivation:\n\nRecent changes for MQTT5 may cause NPE if UNSUBACK message is created with `MqttMessageFactory`\nand client code isn't up-to-date.\n\nModifications:\n\nAdded default body in `MqttUnsubAckMessage` constructor if null body is passed,\nadded null checks in `encodeUnsubAckMessage`\n\nResult:\n\n`MqttUnsubAckMessage` created with `MqttMessageFactory` doesn't cause NPE\neven if null body is supplied."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0ODk3NDc2", "url": "https://github.com/netty/netty/pull/10557#pullrequestreview-484897476", "createdAt": "2020-09-09T11:06:28Z", "commit": {"oid": "4f8ba5e40a1c1440807572ca01ff07bc4cf1b4dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58b4eafb8759c7de0bc8b456596dee262de3c537", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/58b4eafb8759c7de0bc8b456596dee262de3c537", "committedDate": "2020-09-09T13:15:46Z", "message": "Motivation:\n\nRecent changes for MQTT5 may cause `ClassCastException` in `MqttMessageFactory`\nfor legacy SUBSCRIBE and UNSUBSCRIBE message\n\nModifications:\n\nChanged casts for variable header in `MqttMessageFactory`,\nadapted message constructors accordingly.\n\nResult:\n\nBoth legacy and new headers handled successfully."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTk4MTk4", "url": "https://github.com/netty/netty/pull/10557#pullrequestreview-484998198", "createdAt": "2020-09-09T13:18:29Z", "commit": {"oid": "58b4eafb8759c7de0bc8b456596dee262de3c537"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "144c66ab64bc36a25ad83dcda2afed3b3b04afaa", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/144c66ab64bc36a25ad83dcda2afed3b3b04afaa", "committedDate": "2020-09-10T09:47:25Z", "message": "Tests for MqttMessageFactory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTkzNTcz", "url": "https://github.com/netty/netty/pull/10557#pullrequestreview-485993573", "createdAt": "2020-09-10T14:26:35Z", "commit": {"oid": "144c66ab64bc36a25ad83dcda2afed3b3b04afaa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNDoyNjozNVrOHP2wBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNDoyNzowNlrOHP2xtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM4NzcxNg==", "bodyText": "nit: consider storing payload() in a local var and use it. There are multiple calls to message.payload()", "url": "https://github.com/netty/netty/pull/10557#discussion_r486387716", "createdAt": "2020-09-10T14:26:35Z", "author": {"login": "normanmaurer"}, "path": "codec-mqtt/src/main/java/io/netty/handler/codec/mqtt/MqttEncoder.java", "diffHunk": "@@ -388,7 +388,8 @@ private static ByteBuf encodeUnsubAckMessage(\n                     message.idAndPropertiesVariableHeader().properties());\n             try {\n                 int variableHeaderBufferSize = 2 + propertiesBuf.readableBytes();\n-                int payloadBufferSize = message.payload().unsubscribeReasonCodes().size();\n+                int payloadBufferSize =\n+                        message.payload() == null ? 0 : message.payload().unsubscribeReasonCodes().size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "144c66ab64bc36a25ad83dcda2afed3b3b04afaa"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM4ODE0OQ==", "bodyText": "private ?", "url": "https://github.com/netty/netty/pull/10557#discussion_r486388149", "createdAt": "2020-09-10T14:27:06Z", "author": {"login": "normanmaurer"}, "path": "codec-mqtt/src/main/java/io/netty/handler/codec/mqtt/MqttUnsubAckPayload.java", "diffHunk": "@@ -29,6 +29,16 @@\n \n     private final List<Short> unsubscribeReasonCodes;\n \n+    public static final MqttUnsubAckPayload EMPTY = new MqttUnsubAckPayload();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "144c66ab64bc36a25ad83dcda2afed3b3b04afaa"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77d0efb79990511ae5013bf012036181384562da", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/77d0efb79990511ae5013bf012036181384562da", "committedDate": "2020-09-11T06:02:05Z", "message": "Store UNSUBACK payload in a local variable when encoding."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzA2Mjg4", "url": "https://github.com/netty/netty/pull/10557#pullrequestreview-486706288", "createdAt": "2020-09-11T10:55:53Z", "commit": {"oid": "77d0efb79990511ae5013bf012036181384562da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 33, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}