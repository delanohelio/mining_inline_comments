{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNTQ5NjQ3", "number": 10321, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNzoxMzo0NlrOD_9oPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODowMzozOFrOEA_O4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Mzk2NjA2OnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNzoxMzo0NlrOGa8Qgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwODoxMDo0OVrOGa-KOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwMzQyNg==", "bodyText": "you need to call c.release();", "url": "https://github.com/netty/netty/pull/10321#discussion_r430903426", "createdAt": "2020-05-27T07:13:46Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\"\n+                ;\n+        EmbeddedChannel channel = new EmbeddedChannel(new HttpRequestDecoder());\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+        HttpRequest request = channel.readInbound();\n+        assertFalse(request.decoderResult().isFailure());\n+        assertTrue(request.headers().containsValue(\"Transfer-Encoding\", \"chunked\", true));\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+        LastHttpContent c = channel.readInbound();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "399a39183f43ffc9104cb6e769c85b24b512bf1e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkzNDU4NQ==", "bodyText": "Done by channel.releaseInbound()", "url": "https://github.com/netty/netty/pull/10321#discussion_r430934585", "createdAt": "2020-05-27T08:10:49Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\"\n+                ;\n+        EmbeddedChannel channel = new EmbeddedChannel(new HttpRequestDecoder());\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+        HttpRequest request = channel.readInbound();\n+        assertFalse(request.decoderResult().isFailure());\n+        assertTrue(request.headers().containsValue(\"Transfer-Encoding\", \"chunked\", true));\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+        LastHttpContent c = channel.readInbound();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwMzQyNg=="}, "originalCommit": {"oid": "399a39183f43ffc9104cb6e769c85b24b512bf1e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Mzk2NzAzOnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNzoxNDowNlrOGa8RIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwODoxMDo1N1rOGa-Kfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwMzU4NQ==", "bodyText": "nit: move the ; one line up", "url": "https://github.com/netty/netty/pull/10321#discussion_r430903585", "createdAt": "2020-05-27T07:14:06Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\"\n+                ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "399a39183f43ffc9104cb6e769c85b24b512bf1e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkzNDY1NQ==", "bodyText": "Done", "url": "https://github.com/netty/netty/pull/10321#discussion_r430934655", "createdAt": "2020-05-27T08:10:57Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\"\n+                ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwMzU4NQ=="}, "originalCommit": {"oid": "399a39183f43ffc9104cb6e769c85b24b512bf1e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjEyNjEwOnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjowMjo1MlrOGbSAnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNToxMDoxMVrOGcO9Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI1OTgwNw==", "bodyText": "Consider writing the full HTTP request (including one or two chunks + last (zero) chunk + some trailers) to make sure that decoder's state machine transitions to the correct state and handles the entire request correctly.", "url": "https://github.com/netty/netty/pull/10321#discussion_r431259807", "createdAt": "2020-05-27T16:02:52Z", "author": {"login": "idelpivnitskiy"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2313a76da33492f88166b9d44186e5fb761d7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1ODM2Mw==", "bodyText": "Done by move the tests to HttpContentDecoderTest to use the pre-defined gzipped hello world for testing.", "url": "https://github.com/netty/netty/pull/10321#discussion_r432258363", "createdAt": "2020-05-29T05:10:11Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpRequestDecoderTest.java", "diffHunk": "@@ -486,4 +486,23 @@ private static void testInvalidHeaders0(String requestStr) {\n         assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);\n         assertFalse(channel.finish());\n     }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\" +\n+                \"71\\r\\n\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI1OTgwNw=="}, "originalCommit": {"oid": "acb2313a76da33492f88166b9d44186e5fb761d7"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Mjk5OTkzOnYy", "diffSide": "RIGHT", "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpContentDecoder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOTozODo0MVrOGcV3LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNzozMjo1N1rOGcxMtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3MTUwMQ==", "bodyText": "This can be changed to the following code to reduce the trim() operations and also reduce allocations:\nint idx = transferEncoding.indexOf(\",\");\nif (idx != -1) {\n    contentEncoding = transferEncoding.subString(0, idx).trim();\n} else {\n    contentEncoding = transferEncoding.trim();\n}", "url": "https://github.com/netty/netty/pull/10321#discussion_r432371501", "createdAt": "2020-05-29T09:38:41Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpContentDecoder.java", "diffHunk": "@@ -85,7 +85,15 @@ protected void decode(ChannelHandlerContext ctx, HttpObject msg, List<Object> ou\n                 if (contentEncoding != null) {\n                     contentEncoding = contentEncoding.trim();\n                 } else {\n-                    contentEncoding = IDENTITY;\n+                    String transferEncoding = headers.get(HttpHeaderNames.TRANSFER_ENCODING);\n+                    if (transferEncoding != null) {\n+                        contentEncoding = transferEncoding.trim();\n+                        if (transferEncoding.contains(\",\")) {\n+                            contentEncoding = transferEncoding.split(\",\")[0].trim();\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxOTM4MQ==", "bodyText": "Thanks for the advice, Done", "url": "https://github.com/netty/netty/pull/10321#discussion_r432819381", "createdAt": "2020-05-30T07:32:57Z", "author": {"login": "gaol"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpContentDecoder.java", "diffHunk": "@@ -85,7 +85,15 @@ protected void decode(ChannelHandlerContext ctx, HttpObject msg, List<Object> ou\n                 if (contentEncoding != null) {\n                     contentEncoding = contentEncoding.trim();\n                 } else {\n-                    contentEncoding = IDENTITY;\n+                    String transferEncoding = headers.get(HttpHeaderNames.TRANSFER_ENCODING);\n+                    if (transferEncoding != null) {\n+                        contentEncoding = transferEncoding.trim();\n+                        if (transferEncoding.contains(\",\")) {\n+                            contentEncoding = transferEncoding.split(\",\")[0].trim();\n+                        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3MTUwMQ=="}, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NDcwNTc0OnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODowMDozMlrOGcm1LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNzozMjoyOVrOGcxMlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0OTUxNg==", "bodyText": "Consider using HttpHeaderNames.CONTENT_LENGTH constant.", "url": "https://github.com/netty/netty/pull/10321#discussion_r432649516", "createdAt": "2020-05-29T18:00:32Z", "author": {"login": "idelpivnitskiy"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxOTM0OA==", "bodyText": "Done", "url": "https://github.com/netty/netty/pull/10321#discussion_r432819348", "createdAt": "2020-05-30T07:32:29Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0OTUxNg=="}, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NDcxMjU2OnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODowMjo1NlrOGcm5iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNzo0OToxNFrOGcxQmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1MDYzMw==", "bodyText": "Looks like too many \\r\\n. Should we have only 2 pairs instead of 3?", "url": "https://github.com/netty/netty/pull/10321#discussion_r432650633", "createdAt": "2020-05-29T18:02:56Z", "author": {"login": "idelpivnitskiy"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+\n+        HttpContent content = channel.readInbound();\n+        assertTrue(content.decoderResult().isSuccess());\n+        assertEquals(HELLO_WORLD, content.content().toString(CharsetUtil.US_ASCII));\n+        content.release();\n+\n+        LastHttpContent lastHttpContent = channel.readInbound();\n+        assertTrue(lastHttpContent.decoderResult().isSuccess());\n+        lastHttpContent.release();\n+\n+        assertHasInboundMessages(channel, false);\n+        assertHasOutboundMessages(channel, false);\n+        assertFalse(channel.finish());\n+        channel.releaseInbound();\n+    }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Trailer: My-Trailer\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+\n+        String chunkLength = Integer.toHexString(GZ_HELLO_WORLD.length);\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(chunkLength + \"\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"\\r\\n\".getBytes(CharsetUtil.US_ASCII))));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"0\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"My-Trailer: 42\\r\\n\\r\\n\\r\\n\", CharsetUtil.US_ASCII)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgyMDM3OA==", "bodyText": "Yeah, that is right. thanks for pointing out. done", "url": "https://github.com/netty/netty/pull/10321#discussion_r432820378", "createdAt": "2020-05-30T07:49:14Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+\n+        HttpContent content = channel.readInbound();\n+        assertTrue(content.decoderResult().isSuccess());\n+        assertEquals(HELLO_WORLD, content.content().toString(CharsetUtil.US_ASCII));\n+        content.release();\n+\n+        LastHttpContent lastHttpContent = channel.readInbound();\n+        assertTrue(lastHttpContent.decoderResult().isSuccess());\n+        lastHttpContent.release();\n+\n+        assertHasInboundMessages(channel, false);\n+        assertHasOutboundMessages(channel, false);\n+        assertFalse(channel.finish());\n+        channel.releaseInbound();\n+    }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Trailer: My-Trailer\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+\n+        String chunkLength = Integer.toHexString(GZ_HELLO_WORLD.length);\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(chunkLength + \"\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"\\r\\n\".getBytes(CharsetUtil.US_ASCII))));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"0\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"My-Trailer: 42\\r\\n\\r\\n\\r\\n\", CharsetUtil.US_ASCII)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1MDYzMw=="}, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NDcxNDU2OnYy", "diffSide": "RIGHT", "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODowMzozOFrOGcm66g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwNzozODozOFrOGcxOHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1MDk4Ng==", "bodyText": "Consider using constants from HttpHeaderNames and HttpHeaderValues.", "url": "https://github.com/netty/netty/pull/10321#discussion_r432650986", "createdAt": "2020-05-29T18:03:38Z", "author": {"login": "idelpivnitskiy"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+\n+        HttpContent content = channel.readInbound();\n+        assertTrue(content.decoderResult().isSuccess());\n+        assertEquals(HELLO_WORLD, content.content().toString(CharsetUtil.US_ASCII));\n+        content.release();\n+\n+        LastHttpContent lastHttpContent = channel.readInbound();\n+        assertTrue(lastHttpContent.decoderResult().isSuccess());\n+        lastHttpContent.release();\n+\n+        assertHasInboundMessages(channel, false);\n+        assertHasOutboundMessages(channel, false);\n+        assertFalse(channel.finish());\n+        channel.releaseInbound();\n+    }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Trailer: My-Trailer\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+\n+        String chunkLength = Integer.toHexString(GZ_HELLO_WORLD.length);\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(chunkLength + \"\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"\\r\\n\".getBytes(CharsetUtil.US_ASCII))));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"0\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"My-Trailer: 42\\r\\n\\r\\n\\r\\n\", CharsetUtil.US_ASCII)));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertTrue(request.headers().containsValue(\"Transfer-Encoding\", \"chunked\", true));\n+        assertFalse(request.headers().contains(\"Content-Length\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgxOTc0MQ==", "bodyText": "Done", "url": "https://github.com/netty/netty/pull/10321#discussion_r432819741", "createdAt": "2020-05-30T07:38:38Z", "author": {"login": "gaol"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/HttpContentDecoderTest.java", "diffHunk": "@@ -563,6 +563,78 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n         assertEquals(0, content.refCnt());\n     }\n \n+    @Test\n+    public void testTransferCodingGZIP() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Content-Length: \" + GZ_HELLO_WORLD.length + \"\\r\\n\" +\n+                \"Transfer-Encoding: gzip\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        channel.writeInbound(Unpooled.copiedBuffer(requestStr.getBytes()));\n+        channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertFalse(request.headers().contains(\"Content-Length\"));\n+\n+        HttpContent content = channel.readInbound();\n+        assertTrue(content.decoderResult().isSuccess());\n+        assertEquals(HELLO_WORLD, content.content().toString(CharsetUtil.US_ASCII));\n+        content.release();\n+\n+        LastHttpContent lastHttpContent = channel.readInbound();\n+        assertTrue(lastHttpContent.decoderResult().isSuccess());\n+        lastHttpContent.release();\n+\n+        assertHasInboundMessages(channel, false);\n+        assertHasOutboundMessages(channel, false);\n+        assertFalse(channel.finish());\n+        channel.releaseInbound();\n+    }\n+\n+    @Test\n+    public void testTransferCodingGZIPAndChunked() {\n+        String requestStr = \"POST / HTTP/1.1\\r\\n\" +\n+                \"Host: example.com\\r\\n\" +\n+                \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n+                \"Trailer: My-Trailer\\r\\n\" +\n+                \"Transfer-Encoding: gzip, chunked\\r\\n\" +\n+                \"\\r\\n\";\n+        HttpRequestDecoder decoder = new HttpRequestDecoder();\n+        HttpContentDecoder decompressor = new HttpContentDecompressor();\n+        EmbeddedChannel channel = new EmbeddedChannel(decoder, decompressor);\n+\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII)));\n+\n+        String chunkLength = Integer.toHexString(GZ_HELLO_WORLD.length);\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(chunkLength + \"\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(GZ_HELLO_WORLD)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"\\r\\n\".getBytes(CharsetUtil.US_ASCII))));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"0\\r\\n\", CharsetUtil.US_ASCII)));\n+        assertTrue(channel.writeInbound(Unpooled.copiedBuffer(\"My-Trailer: 42\\r\\n\\r\\n\\r\\n\", CharsetUtil.US_ASCII)));\n+\n+        HttpRequest request = channel.readInbound();\n+        assertTrue(request.decoderResult().isSuccess());\n+        assertTrue(request.headers().containsValue(\"Transfer-Encoding\", \"chunked\", true));\n+        assertFalse(request.headers().contains(\"Content-Length\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1MDk4Ng=="}, "originalCommit": {"oid": "7e98c1a56794fce5ccf562b3968a0d5281b27dd7"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3800, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}