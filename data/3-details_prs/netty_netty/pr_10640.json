{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MzI2NTAw", "number": 10640, "title": "Fix possible bugs in HTTP/2 Codec", "bodyText": "Motivation:\n\n\ndata can be null\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2FrameWriter.java\n    \n    \n         Line 224\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           ByteBuf lastFrame = data.readSlice(frameDataBytes); \n        \n    \n  \n\n\n\n\ni >= current.length is always true\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/ReadOnlyHttp2Headers.java\n    \n    \n         Line 831\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           if (i >= current.length && current == pseudoHeaders) { \n        \n    \n  \n\n\n\n\nnewValue != 0 is always true\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/AbstractHttp2StreamChannel.java\n    \n    \n         Line 261\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           if (oldValue == 0 && newValue != 0) { \n        \n    \n  \n\n\n\n\n(parentStream == null) is already handled by shouldIgnoreHeadersOrDataFrame(ctx, streamId, parentStream, \"PUSH_PROMISE\") because it'll throw an error.\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2ConnectionDecoder.java\n    \n    \n         Line 510\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           if (parentStream == null) { \n        \n    \n  \n\n\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2ConnectionDecoder.java\n    \n    \n         Line 582\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           if (stream == null) { \n        \n    \n  \n\n\n\n\nfor (int i = 0; i < name.length(); ++i) { name can be null because we don't return in null check.\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java\n    \n    \n         Line 65\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           for (int i = 0; i < name.length(); ++i) { \n        \n    \n  \n\n\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java\n    \n    \n         Line 43\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           if (name == null || name.length() == 0) { \n        \n    \n  \n\n\n\n\nhpackHeaderFields[cursor++]; can be null and it'll throw NPE when we try to access it.\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackDynamicTable.java\n    \n    \n         Line 188\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           HpackHeaderField entry = hpackHeaderFields[cursor++]; \n        \n    \n  \n\n\n\n\nnext = current[i + 1]; can lead to Array Index Out of Bound error.\n\n  \n    \n      netty/codec-http2/src/main/java/io/netty/handler/codec/http2/ReadOnlyHttp2Headers.java\n    \n    \n         Line 826\n      in\n      69b44c6\n    \n    \n    \n    \n\n        \n          \n           next = current[i + 1]; \n        \n    \n  \n\n\n\n\nModification:\nFixed all the above possible bugs.\nResult:\nBetter code", "createdAt": "2020-10-06T07:18:14Z", "url": "https://github.com/netty/netty/pull/10640", "merged": true, "mergeCommit": {"oid": "ee3b9a5f7b1829e1095fdbbccb5490949ac3e94e"}, "closed": true, "closedAt": "2020-10-26T13:41:50Z", "author": {"login": "hyperxpro"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPy3LGgH2gAyNDk4MzI2NTAwOjUxYTBhZjYwNWZmYmM4MGRlMWRlOWJjMDEyZTIyNmNlZTYzOGUxOGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRvD61AH2gAyNDk4MzI2NTAwOjI1YjA2MDc2NTMxMWM1NzU0NjNlMTgxNDFiN2QzZTRhODFhM2Y4NWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51a0af605ffbc80de1de9bc012e226cee638e18f", "author": {"user": {"login": "hyperxpro", "name": "Aayush Atharva"}}, "url": "https://github.com/netty/netty/commit/51a0af605ffbc80de1de9bc012e226cee638e18f", "committedDate": "2020-10-06T07:01:37Z", "message": "fix possible bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e9af11f36413e49b218a78ef37fea7c350866e", "author": {"user": {"login": "hyperxpro", "name": "Aayush Atharva"}}, "url": "https://github.com/netty/netty/commit/74e9af11f36413e49b218a78ef37fea7c350866e", "committedDate": "2020-10-06T07:14:50Z", "message": "add return statement for null `name`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db", "author": {"user": {"login": "hyperxpro", "name": "Aayush Atharva"}}, "url": "https://github.com/netty/netty/commit/75447260c2e262798c85e49f7a7eca63856684db", "committedDate": "2020-10-06T08:13:47Z", "message": "check array size before accessing it to prevent array out of bound exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MzY0NTE3", "url": "https://github.com/netty/netty/pull/10640#pullrequestreview-506364517", "createdAt": "2020-10-12T07:39:28Z", "commit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzozOToyOFrOHfyhhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzozOToyOFrOHfyhhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NTY4NA==", "bodyText": "nit: revert... this is not needed", "url": "https://github.com/netty/netty/pull/10640#discussion_r503095684", "createdAt": "2020-10-12T07:39:28Z", "author": {"login": "normanmaurer"}, "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -43,6 +43,7 @@ public void validateName(CharSequence name) {\n             if (name == null || name.length() == 0) {\n                 PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n                         \"empty headers are not allowed [%s]\", name));\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MzY0ODE0", "url": "https://github.com/netty/netty/pull/10640#pullrequestreview-506364814", "createdAt": "2020-10-12T07:39:54Z", "commit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzozOTo1NFrOHfyiQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzozOTo1NFrOHfyiQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NTg3NA==", "bodyText": "nit revert formatting changes", "url": "https://github.com/netty/netty/pull/10640#discussion_r503095874", "createdAt": "2020-10-12T07:39:54Z", "author": {"login": "normanmaurer"}, "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -58,14 +59,14 @@ public void validateName(CharSequence name) {\n                 }\n \n                 if (index != -1) {\n-                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                            \"invalid header name [%s]\", name));\n+                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                            name));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d52aa162b7940ce7a29ecdf962d300adf73c0b9", "author": {"user": {"login": "hyperxpro", "name": "Aayush Atharva"}}, "url": "https://github.com/netty/netty/commit/7d52aa162b7940ce7a29ecdf962d300adf73c0b9", "committedDate": "2020-10-12T07:41:44Z", "message": "Revert formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MzY0OTc4", "url": "https://github.com/netty/netty/pull/10640#pullrequestreview-506364978", "createdAt": "2020-10-12T07:40:07Z", "commit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzo0MDowN1rOHfyizg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzo0MTozNlrOHfymWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjAxNA==", "bodyText": "nit revert formatting changes", "url": "https://github.com/netty/netty/pull/10640#discussion_r503096014", "createdAt": "2020-10-12T07:40:07Z", "author": {"login": "normanmaurer"}, "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -58,14 +59,14 @@ public void validateName(CharSequence name) {\n                 }\n \n                 if (index != -1) {\n-                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                            \"invalid header name [%s]\", name));\n+                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                            name));\n                 }\n             } else {\n                 for (int i = 0; i < name.length(); ++i) {\n                     if (isUpperCase(name.charAt(i))) {\n-                        PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                                \"invalid header name [%s]\", name));\n+                        PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                                name));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjkyMw==", "bodyText": "revert... I think this still needs to remain here.", "url": "https://github.com/netty/netty/pull/10640#discussion_r503096923", "createdAt": "2020-10-12T07:41:36Z", "author": {"login": "normanmaurer"}, "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/ReadOnlyHttp2Headers.java", "diffHunk": "@@ -823,12 +823,14 @@ private void calculateNext() {\n             for (; i < current.length; i += 2) {\n                 AsciiString roName = current[i];\n                 if (roName.hashCode() == nameHash && roName.contentEqualsIgnoreCase(name)) {\n-                    next = current[i + 1];\n-                    i += 2;\n+                    if (i + 1 < current.length) {\n+                        next = current[i + 1];\n+                        i += 2;\n+                    }\n                     return;\n                 }\n             }\n-            if (i >= current.length && current == pseudoHeaders) {\n+            if (current == pseudoHeaders) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75447260c2e262798c85e49f7a7eca63856684db"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25b060765311c575463e18141b7d3e4a81a3f85d", "author": {"user": {"login": "hyperxpro", "name": "Aayush Atharva"}}, "url": "https://github.com/netty/netty/commit/25b060765311c575463e18141b7d3e4a81a3f85d", "committedDate": "2020-10-12T07:43:46Z", "message": "Revert more"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4894, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}