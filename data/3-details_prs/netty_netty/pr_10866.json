{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjU1MDA5", "number": 10866, "title": "Don't catch Throwable in InternalLoggerFactory", "bodyText": "Motivation:\nWe shouldnt catch Throwable in InternalLoggerFactory as this may hide OOME etc.\nModifications:\nOnly catch LinkageError and Exception\nResult:\nFixes #10857", "createdAt": "2020-12-15T13:33:56Z", "url": "https://github.com/netty/netty/pull/10866", "merged": true, "mergeCommit": {"oid": "8ea0d8f41ac5b0b09229a53690cad7febb4332ef"}, "closed": true, "closedAt": "2020-12-16T07:45:37Z", "author": {"login": "normanmaurer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmaZ19gH2gAyNTQwMjU1MDA5OjkyOWRlMmM3NmYwNTRkYjlmZGUzMWE5YmNmMWVkZjVkZjhkYjNjYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmdSt_gFqTU1MjY2NTQ4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "929de2c76f054db9fde31a9bcf1edf5df8db3cc4", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/929de2c76f054db9fde31a9bcf1edf5df8db3cc4", "committedDate": "2020-12-15T13:32:07Z", "message": "Don't catch Throwable in InternalLoggerFactory\n\nMotivation:\n\nWe shouldnt catch Throwable in InternalLoggerFactory as this may hide OOME etc.\n\nModifications:\n\nOnly catch LinkageError and Exception\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10857"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDU0Mzk5", "url": "https://github.com/netty/netty/pull/10866#pullrequestreview-552454399", "createdAt": "2020-12-15T13:36:36Z", "commit": {"oid": "929de2c76f054db9fde31a9bcf1edf5df8db3cc4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzozNjozN1rOIGLNkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzozNjozN1rOIGLNkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0NjA2NQ==", "bodyText": "Missing line break", "url": "https://github.com/netty/netty/pull/10866#discussion_r543346065", "createdAt": "2020-12-15T13:36:37Z", "author": {"login": "chrisvest"}, "path": "common/src/main/java/io/netty/util/internal/logging/InternalLoggerFactory.java", "diffHunk": "@@ -39,24 +39,62 @@\n \n     @SuppressWarnings(\"UnusedCatchParameter\")\n     private static InternalLoggerFactory newDefaultFactory(String name) {\n-        InternalLoggerFactory f;\n+        InternalLoggerFactory f = useSlf4JLoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        f = useLog4J2LoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        f = useLog4JLoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        return useJdkLoggerFactory(name);\n+    }\n+\n+    private static InternalLoggerFactory useSlf4JLoggerFactory(String name) {\n         try {\n-            f = new Slf4JLoggerFactory(true);\n+            InternalLoggerFactory f = new Slf4JLoggerFactory(true);\n             f.newInstance(name).debug(\"Using SLF4J as the default logging framework\");\n-        } catch (Throwable ignore1) {\n-            try {\n-                f = Log4J2LoggerFactory.INSTANCE;\n-                f.newInstance(name).debug(\"Using Log4J2 as the default logging framework\");\n-            } catch (Throwable ignore2) {\n-                try {\n-                    f = Log4JLoggerFactory.INSTANCE;\n-                    f.newInstance(name).debug(\"Using Log4J as the default logging framework\");\n-                } catch (Throwable ignore3) {\n-                    f = JdkLoggerFactory.INSTANCE;\n-                    f.newInstance(name).debug(\"Using java.util.logging as the default logging framework\");\n-                }\n-            }\n+            return f;\n+        } catch (LinkageError ignore) {\n+            return null;\n+        } catch (Exception ignore) {\n+            return null;\n         }\n+    }\n+    private static InternalLoggerFactory useLog4J2LoggerFactory(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "929de2c76f054db9fde31a9bcf1edf5df8db3cc4"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDY5MzU5", "url": "https://github.com/netty/netty/pull/10866#pullrequestreview-552469359", "createdAt": "2020-12-15T13:47:20Z", "commit": {"oid": "929de2c76f054db9fde31a9bcf1edf5df8db3cc4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0NzoyMFrOIGLsfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0NzoyMFrOIGLsfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1Mzk4MQ==", "bodyText": "This can catch the more specific (ReflectiveOperationException | SecurityException ignore) unless for some reason Slf4JLoggerFactory is throwing java.lang.Exception.", "url": "https://github.com/netty/netty/pull/10866#discussion_r543353981", "createdAt": "2020-12-15T13:47:20Z", "author": {"login": "elharo"}, "path": "common/src/main/java/io/netty/util/internal/logging/InternalLoggerFactory.java", "diffHunk": "@@ -39,24 +39,62 @@\n \n     @SuppressWarnings(\"UnusedCatchParameter\")\n     private static InternalLoggerFactory newDefaultFactory(String name) {\n-        InternalLoggerFactory f;\n+        InternalLoggerFactory f = useSlf4JLoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        f = useLog4J2LoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        f = useLog4JLoggerFactory(name);\n+        if (f != null) {\n+            return f;\n+        }\n+\n+        return useJdkLoggerFactory(name);\n+    }\n+\n+    private static InternalLoggerFactory useSlf4JLoggerFactory(String name) {\n         try {\n-            f = new Slf4JLoggerFactory(true);\n+            InternalLoggerFactory f = new Slf4JLoggerFactory(true);\n             f.newInstance(name).debug(\"Using SLF4J as the default logging framework\");\n-        } catch (Throwable ignore1) {\n-            try {\n-                f = Log4J2LoggerFactory.INSTANCE;\n-                f.newInstance(name).debug(\"Using Log4J2 as the default logging framework\");\n-            } catch (Throwable ignore2) {\n-                try {\n-                    f = Log4JLoggerFactory.INSTANCE;\n-                    f.newInstance(name).debug(\"Using Log4J as the default logging framework\");\n-                } catch (Throwable ignore3) {\n-                    f = JdkLoggerFactory.INSTANCE;\n-                    f.newInstance(name).debug(\"Using java.util.logging as the default logging framework\");\n-                }\n-            }\n+            return f;\n+        } catch (LinkageError ignore) {\n+            return null;\n+        } catch (Exception ignore) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "929de2c76f054db9fde31a9bcf1edf5df8db3cc4"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b23ca67c013f265b5030988dcc8eaf06e04c7e2", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/1b23ca67c013f265b5030988dcc8eaf06e04c7e2", "committedDate": "2020-12-15T13:52:44Z", "message": "add missing line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "099abb0584570bf94cc2e8c9bd30dc492728db99", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/099abb0584570bf94cc2e8c9bd30dc492728db99", "committedDate": "2020-12-15T14:46:18Z", "message": "add comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNjY1NDgx", "url": "https://github.com/netty/netty/pull/10866#pullrequestreview-552665481", "createdAt": "2020-12-15T16:54:03Z", "commit": {"oid": "099abb0584570bf94cc2e8c9bd30dc492728db99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4871, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}