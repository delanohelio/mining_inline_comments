{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTQ2NjU5", "number": 10255, "title": "Add option to configure recycler delayed queue drop ratio (#10251)", "bodyText": "Motivation\n\n\nRecycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n\n#10251 shows that enable drop in WeakOrderQueue may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\n\nModification\n\n\"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\ndefault \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\nAble to configure recycler delayed queue drop ratio separately", "createdAt": "2020-05-07T08:46:58Z", "url": "https://github.com/netty/netty/pull/10255", "merged": true, "mergeCommit": {"oid": "909e7c9c29f395ba83bd5a2c7d5cc477e4135c36"}, "closed": true, "closedAt": "2020-05-07T13:08:36Z", "author": {"login": "louxiu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce5VCvgFqTQwNzI3MjgxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABce7cGTAFqTQwNzM3NjU5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjcyODE1", "url": "https://github.com/netty/netty/pull/10255#pullrequestreview-407272815", "createdAt": "2020-05-07T08:50:57Z", "commit": {"oid": "3bd2845d12856abf2fd2b9f141ce52537baee10c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODo1MDo1OFrOGR0yhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODo1MTowM1rOGR0yuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0Mzg3Ng==", "bodyText": "we also need to keep the old constructor to not break API", "url": "https://github.com/netty/netty/pull/10255#discussion_r421343876", "createdAt": "2020-05-07T08:50:58Z", "author": {"login": "normanmaurer"}, "path": "common/src/main/java/io/netty/util/Recycler.java", "diffHunk": "@@ -136,12 +141,14 @@ protected Recycler(int maxCapacityPerThread) {\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n-        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n+        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD,\n+                DELAYED_QUEUE_RATIO);\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n-                       int ratio, int maxDelayedQueuesPerThread) {\n+                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bd2845d12856abf2fd2b9f141ce52537baee10c"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0MzkyOQ==", "bodyText": "we also need to keep the old constructor to not break API", "url": "https://github.com/netty/netty/pull/10255#discussion_r421343929", "createdAt": "2020-05-07T08:51:03Z", "author": {"login": "normanmaurer"}, "path": "common/src/main/java/io/netty/util/Recycler.java", "diffHunk": "@@ -136,12 +141,14 @@ protected Recycler(int maxCapacityPerThread) {\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n-        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n+        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD,\n+                DELAYED_QUEUE_RATIO);\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n-                       int ratio, int maxDelayedQueuesPerThread) {\n+                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bd2845d12856abf2fd2b9f141ce52537baee10c"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "author": {"user": {"login": "louxiu", "name": "louxiu"}}, "url": "https://github.com/netty/netty/commit/b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "committedDate": "2020-05-07T10:18:13Z", "message": "Add option to configure recycler delayed queue drop ratio (#10251)\n\nMotivation\n\n- Recycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n- #10251 shows that enable drop in `WeakOrderQueue` may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\nModification\n\n- \"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\n- default \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\n\nAble to configure recycler delayed queue drop ratio separately"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bd2845d12856abf2fd2b9f141ce52537baee10c", "author": {"user": {"login": "louxiu", "name": "louxiu"}}, "url": "https://github.com/netty/netty/commit/3bd2845d12856abf2fd2b9f141ce52537baee10c", "committedDate": "2020-05-07T08:39:34Z", "message": "Add option to configure recycler delayed queue drop ratio (#10251)\n\nMotivation\n\n- Recycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n- #10251 shows that enable drop in `WeakOrderQueue` may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\nModification\n\n- \"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\n- default \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\n\nAble to configure recycler delayed queue drop ratio separately"}, "afterCommit": {"oid": "b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "author": {"user": {"login": "louxiu", "name": "louxiu"}}, "url": "https://github.com/netty/netty/commit/b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "committedDate": "2020-05-07T10:18:13Z", "message": "Add option to configure recycler delayed queue drop ratio (#10251)\n\nMotivation\n\n- Recycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n- #10251 shows that enable drop in `WeakOrderQueue` may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\nModification\n\n- \"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\n- default \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\n\nAble to configure recycler delayed queue drop ratio separately"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3Mzc2NTk2", "url": "https://github.com/netty/netty/pull/10255#pullrequestreview-407376596", "createdAt": "2020-05-07T11:18:54Z", "commit": {"oid": "b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 285, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}