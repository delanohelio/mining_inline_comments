{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTM4OTQ3", "number": 10171, "title": "Stop sending DNS queries if promise is cancelled", "bodyText": "Motivation:\nA user might want to cancel DNS resolution when it takes too long.\nCurrently, there's no way to cancel the internal DNS queries especially when there's a lot of search domains.\nModification:\n\nStop sending DNS queries if the original Promise, which was passed when calling resolve(), is canceled.\n\nResult:\n\nYou can now stop sending DNS queries by canceling the Promise.", "createdAt": "2020-04-07T09:09:04Z", "url": "https://github.com/netty/netty/pull/10171", "merged": true, "mergeCommit": {"oid": "7d7e1f5ed7704bda856bbfd20bff62413af62070"}, "closed": true, "closedAt": "2020-04-07T10:25:03Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVPPlAgH2gAyNDAwMTM4OTQ3OjYxZGUxMDMwNzU3NThlOWNhNGIwM2ZlYjM0Njk0OGJkYzcyNDQ0OGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVQr4PAFqTM4ODk4Mzc1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61de103075758e9ca4b03feb346948bdc724448f", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/netty/netty/commit/61de103075758e9ca4b03feb346948bdc724448f", "committedDate": "2020-04-07T08:44:05Z", "message": "Stop sending DNS queries if promise is cancelled\nMotivation:\nA user might want to cancel DNS resolution when it takes too long.\nCurrently, there's no way to cancel the internal DNS queries especially when there's a lot of search domains.\n\nModification:\n- Stop sending a DNS query if the original `Promise`, which was passed calling `resolve()`, is canceled.\n\nResult:\n- You can now stop sending DNS queries by cancelling the `Promise`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTY1ODE3", "url": "https://github.com/netty/netty/pull/10171#pullrequestreview-388965817", "createdAt": "2020-04-07T09:59:38Z", "commit": {"oid": "61de103075758e9ca4b03feb346948bdc724448f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo1OTozOFrOGB8I5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo1OTozOFrOGB8I5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4NzA3Ng==", "bodyText": "@minwoox I wonder if a better approach would be to ensure we propagate cancellation by attaching a FutureListener to original promise and call promise.cancel(...) if needed. WDYT ?", "url": "https://github.com/netty/netty/pull/10171#discussion_r404687076", "createdAt": "2020-04-07T09:59:38Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsResolveContext.java", "diffHunk": "@@ -352,7 +354,7 @@ private void query(final DnsServerAddressStream nameServerAddrStream,\n                        final Promise<List<T>> promise,\n                        final Throwable cause) {\n         if (completeEarly || nameServerAddrStreamIndex >= nameServerAddrStream.size() ||\n-                allowedQueries == 0 || promise.isCancelled()) {\n+                allowedQueries == 0 || originalPromise.isCancelled() || promise.isCancelled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61de103075758e9ca4b03feb346948bdc724448f"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTgwMzgx", "url": "https://github.com/netty/netty/pull/10171#pullrequestreview-388980381", "createdAt": "2020-04-07T10:20:02Z", "commit": {"oid": "61de103075758e9ca4b03feb346948bdc724448f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTgzNzU2", "url": "https://github.com/netty/netty/pull/10171#pullrequestreview-388983756", "createdAt": "2020-04-07T10:24:54Z", "commit": {"oid": "61de103075758e9ca4b03feb346948bdc724448f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 236, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}