{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDkxMjAz", "number": 10643, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzoxNDozMVrOEquQrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTo1MjoyOVrOEyEBYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjMzNTgzOnYy", "diffSide": "RIGHT", "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzoxNDozMVrOHdFxig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzozNjo0OVrOHdG2sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI2NTM1NA==", "bodyText": "How about adding a constructor with boolean and set the default value to true for enabling Header verification? It'll give the user ability to turn off Header verification if needed.", "url": "https://github.com/netty/netty/pull/10643#discussion_r500265354", "createdAt": "2020-10-06T13:14:31Z", "author": {"login": "hyperxpro"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -353,8 +353,7 @@ private boolean upgrade(final ChannelHandlerContext ctx, final FullHttpRequest r\n      * Creates the 101 Switching Protocols response message.\n      */\n     private static FullHttpResponse createUpgradeResponse(CharSequence upgradeProtocol) {\n-        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS,\n-                Unpooled.EMPTY_BUFFER, false);\n+        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS, Unpooled.EMPTY_BUFFER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c0fd7485a91059ae88d0dfcc3b48a67095b1303"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3NDc4OA==", "bodyText": "Sure, if it's okay to introduce a new API in the 4.1, then I can add a new constructor for HttpServerUpgradeHandler.", "url": "https://github.com/netty/netty/pull/10643#discussion_r500274788", "createdAt": "2020-10-06T13:27:17Z", "author": {"login": "artem-smotrakov"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -353,8 +353,7 @@ private boolean upgrade(final ChannelHandlerContext ctx, final FullHttpRequest r\n      * Creates the 101 Switching Protocols response message.\n      */\n     private static FullHttpResponse createUpgradeResponse(CharSequence upgradeProtocol) {\n-        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS,\n-                Unpooled.EMPTY_BUFFER, false);\n+        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS, Unpooled.EMPTY_BUFFER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI2NTM1NA=="}, "originalCommit": {"oid": "8c0fd7485a91059ae88d0dfcc3b48a67095b1303"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI3Njc0Nw==", "bodyText": "It's fine to add new API. Add 2 constructors actually. 1 will be default constructor (empty) which will set Boolean value to true and 1 constructor will allow to set Boolean value.", "url": "https://github.com/netty/netty/pull/10643#discussion_r500276747", "createdAt": "2020-10-06T13:29:48Z", "author": {"login": "hyperxpro"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -353,8 +353,7 @@ private boolean upgrade(final ChannelHandlerContext ctx, final FullHttpRequest r\n      * Creates the 101 Switching Protocols response message.\n      */\n     private static FullHttpResponse createUpgradeResponse(CharSequence upgradeProtocol) {\n-        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS,\n-                Unpooled.EMPTY_BUFFER, false);\n+        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS, Unpooled.EMPTY_BUFFER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI2NTM1NA=="}, "originalCommit": {"oid": "8c0fd7485a91059ae88d0dfcc3b48a67095b1303"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4MDkyNA==", "bodyText": "I think one should be enough since the class already has a few constructors. They will enable the validation by default. The new one will allow a user to turn the validation off.", "url": "https://github.com/netty/netty/pull/10643#discussion_r500280924", "createdAt": "2020-10-06T13:34:33Z", "author": {"login": "artem-smotrakov"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -353,8 +353,7 @@ private boolean upgrade(final ChannelHandlerContext ctx, final FullHttpRequest r\n      * Creates the 101 Switching Protocols response message.\n      */\n     private static FullHttpResponse createUpgradeResponse(CharSequence upgradeProtocol) {\n-        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS,\n-                Unpooled.EMPTY_BUFFER, false);\n+        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS, Unpooled.EMPTY_BUFFER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI2NTM1NA=="}, "originalCommit": {"oid": "8c0fd7485a91059ae88d0dfcc3b48a67095b1303"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4MzA1Ng==", "bodyText": "Yeah, alright. My bad, I didn't saw other constructors.", "url": "https://github.com/netty/netty/pull/10643#discussion_r500283056", "createdAt": "2020-10-06T13:36:49Z", "author": {"login": "hyperxpro"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -353,8 +353,7 @@ private boolean upgrade(final ChannelHandlerContext ctx, final FullHttpRequest r\n      * Creates the 101 Switching Protocols response message.\n      */\n     private static FullHttpResponse createUpgradeResponse(CharSequence upgradeProtocol) {\n-        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS,\n-                Unpooled.EMPTY_BUFFER, false);\n+        DefaultFullHttpResponse res = new DefaultFullHttpResponse(HTTP_1_1, SWITCHING_PROTOCOLS, Unpooled.EMPTY_BUFFER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI2NTM1NA=="}, "originalCommit": {"oid": "8c0fd7485a91059ae88d0dfcc3b48a67095b1303"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTMwMTQ0OnYy", "diffSide": "RIGHT", "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTo1MjoyOVrOHof7Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo1MjoyMlrOHovFNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIyODEwMg==", "bodyText": "nit: please add that this is for the response.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param validateHeaders validate the header names and values\n          \n          \n            \n                 * @param validateHeaders validate the header names and values of the upgrade response.", "url": "https://github.com/netty/netty/pull/10643#discussion_r512228102", "createdAt": "2020-10-26T19:52:29Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -199,10 +200,25 @@ public HttpServerUpgradeHandler(SourceCodec sourceCodec, UpgradeCodecFactory upg\n      */\n     public HttpServerUpgradeHandler(\n             SourceCodec sourceCodec, UpgradeCodecFactory upgradeCodecFactory, int maxContentLength) {\n+        this(sourceCodec, upgradeCodecFactory, maxContentLength, true);\n+    }\n+\n+    /**\n+     * Constructs the upgrader with the supported codecs.\n+     *\n+     * @param sourceCodec the codec that is being used initially\n+     * @param upgradeCodecFactory the factory that creates a new upgrade codec\n+     *                            for one of the requested upgrade protocols\n+     * @param maxContentLength the maximum length of the content of an upgrade request\n+     * @param validateHeaders validate the header names and values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb45dc452481cab8d09871633ee3a008caf5a0b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ3NjQ3MQ==", "bodyText": "No problem, updated.", "url": "https://github.com/netty/netty/pull/10643#discussion_r512476471", "createdAt": "2020-10-27T07:52:22Z", "author": {"login": "artem-smotrakov"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/HttpServerUpgradeHandler.java", "diffHunk": "@@ -199,10 +200,25 @@ public HttpServerUpgradeHandler(SourceCodec sourceCodec, UpgradeCodecFactory upg\n      */\n     public HttpServerUpgradeHandler(\n             SourceCodec sourceCodec, UpgradeCodecFactory upgradeCodecFactory, int maxContentLength) {\n+        this(sourceCodec, upgradeCodecFactory, maxContentLength, true);\n+    }\n+\n+    /**\n+     * Constructs the upgrader with the supported codecs.\n+     *\n+     * @param sourceCodec the codec that is being used initially\n+     * @param upgradeCodecFactory the factory that creates a new upgrade codec\n+     *                            for one of the requested upgrade protocols\n+     * @param maxContentLength the maximum length of the content of an upgrade request\n+     * @param validateHeaders validate the header names and values", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIyODEwMg=="}, "originalCommit": {"oid": "ecb45dc452481cab8d09871633ee3a008caf5a0b"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3592, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}