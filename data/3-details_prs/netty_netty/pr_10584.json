{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NDY0NTc0", "number": 10584, "title": "Not truncate MQTT SUBACK reason codes", "bodyText": "Motivation:\nReason code for MQTT SUBACK messages is truncated, thus not allowing to get new codes supported by MQTT v.5\nModification:\nChanged MqttCodecTest.testUnsubAckMessageForMqtt5 to catch it then, removed truncation in MqttDecoder.decodeSubackPayload to make it pass.\nResult:\nCodec users can get all reason codes supported by MQTT5 now.", "createdAt": "2020-09-17T07:24:13Z", "url": "https://github.com/netty/netty/pull/10584", "merged": true, "mergeCommit": {"oid": "b112483799cd410a3aa41fab022c3f7183c8691d"}, "closed": true, "closedAt": "2020-09-22T06:58:50Z", "author": {"login": "paul-lysak"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJruLxgH2gAyNDg4NDY0NTc0OjllNmY0NGI5MWMxMzBmZWY1YmVkY2ZmYjYxOTM3NTdmYWNjMTc4NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLAyLygH2gAyNDg4NDY0NTc0OjVhMjIwN2ViZmM4MzkwODU4ZDg2ZjJiYmJkZjg1NGI1NDU5ZWY1NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e6f44b91c130fef5bedcffb6193757facc17874", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/9e6f44b91c130fef5bedcffb6193757facc17874", "committedDate": "2020-09-17T07:18:55Z", "message": "Return complete reason code in suback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjc1Mzgy", "url": "https://github.com/netty/netty/pull/10584#pullrequestreview-491275382", "createdAt": "2020-09-18T08:54:44Z", "commit": {"oid": "9e6f44b91c130fef5bedcffb6193757facc17874"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODo1NDo0NFrOHUEKKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODo1NDo0NFrOHUEKKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMTcwNQ==", "bodyText": "Do we need some special handling for MQTT 3.x ?", "url": "https://github.com/netty/netty/pull/10584#discussion_r490801705", "createdAt": "2020-09-18T08:54:44Z", "author": {"login": "normanmaurer"}, "path": "codec-mqtt/src/main/java/io/netty/handler/codec/mqtt/MqttDecoder.java", "diffHunk": "@@ -543,15 +543,12 @@ private static int decodeMessageId(ByteBuf buffer) {\n     private static Result<MqttSubAckPayload> decodeSubackPayload(\n             ByteBuf buffer,\n             int bytesRemainingInVariablePart) {\n-        final List<Integer> grantedQos = new ArrayList<Integer>();\n+        final List<Integer> grantedQos = new ArrayList<Integer>(bytesRemainingInVariablePart);\n         int numberOfBytesConsumed = 0;\n         while (numberOfBytesConsumed < bytesRemainingInVariablePart) {\n-            int qos = buffer.readUnsignedByte();\n-            if (qos != MqttQoS.FAILURE.value()) {\n-                qos &= 0x03;\n-            }\n+            int reasonCode = buffer.readUnsignedByte();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6f44b91c130fef5bedcffb6193757facc17874"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDAzNzY2", "url": "https://github.com/netty/netty/pull/10584#pullrequestreview-492403766", "createdAt": "2020-09-21T09:07:31Z", "commit": {"oid": "9e6f44b91c130fef5bedcffb6193757facc17874"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOTowNzozMlrOHVGr_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOTowNzozMlrOHVGr_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MTcwOA==", "bodyText": "@paul-lysak hmm... this feels not correct to me. Do we need to use & 0x03 for the values here ?", "url": "https://github.com/netty/netty/pull/10584#discussion_r491891708", "createdAt": "2020-09-21T09:07:32Z", "author": {"login": "normanmaurer"}, "path": "codec-mqtt/src/main/java/io/netty/handler/codec/mqtt/MqttSubAckPayload.java", "diffHunk": "@@ -28,39 +28,43 @@\n  */\n public class MqttSubAckPayload {\n \n-    private final List<Integer> grantedQoSLevels;\n+    private final List<Integer> reasonCodes;\n \n-    public MqttSubAckPayload(int... grantedQoSLevels) {\n-        ObjectUtil.checkNotNull(grantedQoSLevels, \"grantedQoSLevels\");\n+    public MqttSubAckPayload(int... reasonCodes) {\n+        ObjectUtil.checkNotNull(reasonCodes, \"reasonCodes\");\n \n-        List<Integer> list = new ArrayList<Integer>(grantedQoSLevels.length);\n-        for (int v: grantedQoSLevels) {\n+        List<Integer> list = new ArrayList<Integer>(reasonCodes.length);\n+        for (int v: reasonCodes) {\n             list.add(v);\n         }\n-        this.grantedQoSLevels = Collections.unmodifiableList(list);\n+        this.reasonCodes = Collections.unmodifiableList(list);\n     }\n \n     public MqttSubAckPayload(Iterable<Integer> grantedQoSLevels) {\n-        ObjectUtil.checkNotNull(grantedQoSLevels, \"grantedQoSLevels\");\n+        ObjectUtil.checkNotNull(grantedQoSLevels, \"reasonCodes\");\n         List<Integer> list = new ArrayList<Integer>();\n         for (Integer v: grantedQoSLevels) {\n             if (v == null) {\n                 break;\n             }\n             list.add(v);\n         }\n-        this.grantedQoSLevels = Collections.unmodifiableList(list);\n+        this.reasonCodes = Collections.unmodifiableList(list);\n     }\n \n     public List<Integer> grantedQoSLevels() {\n-        return grantedQoSLevels;\n+        return reasonCodes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6f44b91c130fef5bedcffb6193757facc17874"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd9b47f0cdaacf0f0b674a3f2e9f1bc073ca1a97", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/bd9b47f0cdaacf0f0b674a3f2e9f1bc073ca1a97", "committedDate": "2020-09-21T09:21:13Z", "message": "Mask QoS level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37a5e6c6183fb3a6857c2abf602cd27fc83493d0", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/37a5e6c6183fb3a6857c2abf602cd27fc83493d0", "committedDate": "2020-09-21T09:39:33Z", "message": "Test SUBACK reason code truncation to QoS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDQ5MDUz", "url": "https://github.com/netty/netty/pull/10584#pullrequestreview-492449053", "createdAt": "2020-09-21T10:08:57Z", "commit": {"oid": "37a5e6c6183fb3a6857c2abf602cd27fc83493d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDowODo1N1rOHVI6Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMDowODo1N1rOHVI6Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyODA5MQ==", "bodyText": "nit: change the parameter name ?", "url": "https://github.com/netty/netty/pull/10584#discussion_r491928091", "createdAt": "2020-09-21T10:08:57Z", "author": {"login": "normanmaurer"}, "path": "codec-mqtt/src/main/java/io/netty/handler/codec/mqtt/MqttSubAckPayload.java", "diffHunk": "@@ -28,39 +28,51 @@\n  */\n public class MqttSubAckPayload {\n \n-    private final List<Integer> grantedQoSLevels;\n+    private final List<Integer> reasonCodes;\n \n-    public MqttSubAckPayload(int... grantedQoSLevels) {\n-        ObjectUtil.checkNotNull(grantedQoSLevels, \"grantedQoSLevels\");\n+    public MqttSubAckPayload(int... reasonCodes) {\n+        ObjectUtil.checkNotNull(reasonCodes, \"reasonCodes\");\n \n-        List<Integer> list = new ArrayList<Integer>(grantedQoSLevels.length);\n-        for (int v: grantedQoSLevels) {\n+        List<Integer> list = new ArrayList<Integer>(reasonCodes.length);\n+        for (int v: reasonCodes) {\n             list.add(v);\n         }\n-        this.grantedQoSLevels = Collections.unmodifiableList(list);\n+        this.reasonCodes = Collections.unmodifiableList(list);\n     }\n \n     public MqttSubAckPayload(Iterable<Integer> grantedQoSLevels) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a5e6c6183fb3a6857c2abf602cd27fc83493d0"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a2207ebfc8390858d86f2bbbdf854b5459ef556", "author": {"user": {"login": "paul-lysak", "name": "Paul Lysak"}}, "url": "https://github.com/netty/netty/commit/5a2207ebfc8390858d86f2bbbdf854b5459ef556", "committedDate": "2020-09-21T10:25:13Z", "message": "Rename parameter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 59, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}