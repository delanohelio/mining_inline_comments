{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MzYwNDU0", "number": 10280, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTo0NlrOD8I6Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyNzo1NlrOD8JNaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzg3MDkxOnYy", "diffSide": "RIGHT", "path": "handler/src/main/java/io/netty/handler/ssl/OpenSslSessionContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTo0NlrOGU5TqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTo0NlrOGU5TqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2MzYyNQ==", "bodyText": "Consider referencing to the specific section: https://commondatastorage.googleapis.com/chromium-boringssl-docs/ssl.h.html#Session-tickets", "url": "https://github.com/netty/netty/pull/10280#discussion_r424563625", "createdAt": "2020-05-13T16:15:46Z", "author": {"login": "idelpivnitskiy"}, "path": "handler/src/main/java/io/netty/handler/ssl/OpenSslSessionContext.java", "diffHunk": "@@ -97,7 +97,10 @@ public void setTicketKeys(byte[] keys) {\n     }\n \n     /**\n-     * Sets the SSL session ticket keys of this context.\n+     * Sets the SSL session ticket keys of this context. Depending on the underlying native library you may omit the\n+     * argument or pass an empty array and so let the native library handle the key generation and rotating for you.\n+     * If this is supported by the underlying native library should be checked in this case. For example\n+     * <a href=\"https://boringssl.googlesource.com/boringssl/\">BoringSSL</a> is known to support this.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mzg5OTMyOnYy", "diffSide": "RIGHT", "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyMjo1M1rOGU5l_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozNDo0NVrOGVPlSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2ODMxNg==", "bodyText": "OpenSSL also supports it in a similar way on the server-side. See SSL_OP_NO_TICKET on this page: https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_options.html.", "url": "https://github.com/netty/netty/pull/10280#discussion_r424568316", "createdAt": "2020-05-13T16:22:53Z", "author": {"login": "idelpivnitskiy"}, "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "diffHunk": "@@ -1118,16 +1118,29 @@ protected void initChannel(Channel ch) {\n \n     @Test(timeout = 5000L)\n     public void testSessionTicketsWithTLSv12() throws Throwable {\n-        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2);\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2, true);\n     }\n \n     @Test(timeout = 5000L)\n     public void testSessionTicketsWithTLSv13() throws Throwable {\n         assumeTrue(OpenSsl.isTlsv13Supported());\n-        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_3);\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_3, true);\n     }\n \n-    private static void testSessionTickets(String protocol) throws Throwable {\n+    @Test(timeout = 5000L)\n+    public void testSessionTicketsWithTLSv12AndNoKey() throws Throwable {\n+        assumeTrue(OpenSsl.isBoringSSL());\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2, false);\n+    }\n+\n+    @Test(timeout = 5000L)\n+    public void testSessionTicketsWithTLSv13AndNoKey() throws Throwable {\n+        assumeTrue(OpenSsl.isTlsv13Supported());\n+        assumeTrue(OpenSsl.isBoringSSL());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyODU4NQ==", "bodyText": "You are right... Let me fix this", "url": "https://github.com/netty/netty/pull/10280#discussion_r424928585", "createdAt": "2020-05-14T07:34:45Z", "author": {"login": "normanmaurer"}, "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "diffHunk": "@@ -1118,16 +1118,29 @@ protected void initChannel(Channel ch) {\n \n     @Test(timeout = 5000L)\n     public void testSessionTicketsWithTLSv12() throws Throwable {\n-        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2);\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2, true);\n     }\n \n     @Test(timeout = 5000L)\n     public void testSessionTicketsWithTLSv13() throws Throwable {\n         assumeTrue(OpenSsl.isTlsv13Supported());\n-        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_3);\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_3, true);\n     }\n \n-    private static void testSessionTickets(String protocol) throws Throwable {\n+    @Test(timeout = 5000L)\n+    public void testSessionTicketsWithTLSv12AndNoKey() throws Throwable {\n+        assumeTrue(OpenSsl.isBoringSSL());\n+        testSessionTickets(SslUtils.PROTOCOL_TLS_V1_2, false);\n+    }\n+\n+    @Test(timeout = 5000L)\n+    public void testSessionTicketsWithTLSv13AndNoKey() throws Throwable {\n+        assumeTrue(OpenSsl.isTlsv13Supported());\n+        assumeTrue(OpenSsl.isBoringSSL());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2ODMxNg=="}, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzkxMjA3OnYy", "diffSide": "RIGHT", "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyNTo1NVrOGU5uAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozNDo1NlrOGVPlpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDM3MA==", "bodyText": "Note (pre-existing behavior): these tests does not verify that tickets actually work. They verify only that setTicketKeys() method does not throw. There currently no API to see that tickets were issued or received.", "url": "https://github.com/netty/netty/pull/10280#discussion_r424570370", "createdAt": "2020-05-13T16:25:55Z", "author": {"login": "idelpivnitskiy"}, "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "diffHunk": "@@ -1141,10 +1154,15 @@ private static void testSessionTickets(String protocol) throws Throwable {\n                 .protocols(protocol)\n                 .build();\n \n-        OpenSslSessionTicketKey key = new OpenSslSessionTicketKey(new byte[OpenSslSessionTicketKey.NAME_SIZE],\n-                new byte[OpenSslSessionTicketKey.HMAC_KEY_SIZE], new byte[OpenSslSessionTicketKey.AES_KEY_SIZE]);\n-        ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys(key);\n-        ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys(key);\n+        if (withKey) {\n+            OpenSslSessionTicketKey key = new OpenSslSessionTicketKey(new byte[OpenSslSessionTicketKey.NAME_SIZE],\n+                    new byte[OpenSslSessionTicketKey.HMAC_KEY_SIZE], new byte[OpenSslSessionTicketKey.AES_KEY_SIZE]);\n+            ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys(key);\n+            ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys(key);\n+        } else {\n+            ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys();\n+            ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyODY3OA==", "bodyText": "yep I know :)", "url": "https://github.com/netty/netty/pull/10280#discussion_r424928678", "createdAt": "2020-05-14T07:34:56Z", "author": {"login": "normanmaurer"}, "path": "handler/src/test/java/io/netty/handler/ssl/SslHandlerTest.java", "diffHunk": "@@ -1141,10 +1154,15 @@ private static void testSessionTickets(String protocol) throws Throwable {\n                 .protocols(protocol)\n                 .build();\n \n-        OpenSslSessionTicketKey key = new OpenSslSessionTicketKey(new byte[OpenSslSessionTicketKey.NAME_SIZE],\n-                new byte[OpenSslSessionTicketKey.HMAC_KEY_SIZE], new byte[OpenSslSessionTicketKey.AES_KEY_SIZE]);\n-        ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys(key);\n-        ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys(key);\n+        if (withKey) {\n+            OpenSslSessionTicketKey key = new OpenSslSessionTicketKey(new byte[OpenSslSessionTicketKey.NAME_SIZE],\n+                    new byte[OpenSslSessionTicketKey.HMAC_KEY_SIZE], new byte[OpenSslSessionTicketKey.AES_KEY_SIZE]);\n+            ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys(key);\n+            ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys(key);\n+        } else {\n+            ((OpenSslSessionContext) sslClientCtx.sessionContext()).setTicketKeys();\n+            ((OpenSslSessionContext) sslServerCtx.sessionContext()).setTicketKeys();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDM3MA=="}, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzkyMDQwOnYy", "diffSide": "RIGHT", "path": "handler/src/main/java/io/netty/handler/ssl/OpenSslSessionContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyNzo1NlrOGU5zUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozNToxNVrOGVPmVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MTczMQ==", "bodyText": "Not necessary now, but when client will support session tickets we can clarify that non-empty keys param is changing behavior only for the server side.", "url": "https://github.com/netty/netty/pull/10280#discussion_r424571731", "createdAt": "2020-05-13T16:27:56Z", "author": {"login": "idelpivnitskiy"}, "path": "handler/src/main/java/io/netty/handler/ssl/OpenSslSessionContext.java", "diffHunk": "@@ -97,7 +97,10 @@ public void setTicketKeys(byte[] keys) {\n     }\n \n     /**\n-     * Sets the SSL session ticket keys of this context.\n+     * Sets the SSL session ticket keys of this context. Depending on the underlying native library you may omit the\n+     * argument or pass an empty array and so let the native library handle the key generation and rotating for you.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyODg1NA==", "bodyText": "yeah lets tackle this once we have everything in place", "url": "https://github.com/netty/netty/pull/10280#discussion_r424928854", "createdAt": "2020-05-14T07:35:15Z", "author": {"login": "normanmaurer"}, "path": "handler/src/main/java/io/netty/handler/ssl/OpenSslSessionContext.java", "diffHunk": "@@ -97,7 +97,10 @@ public void setTicketKeys(byte[] keys) {\n     }\n \n     /**\n-     * Sets the SSL session ticket keys of this context.\n+     * Sets the SSL session ticket keys of this context. Depending on the underlying native library you may omit the\n+     * argument or pass an empty array and so let the native library handle the key generation and rotating for you.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MTczMQ=="}, "originalCommit": {"oid": "95d14aaa91ba198f165059e7c380bf09aafacc1a"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3450, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}