{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTI0MDAw", "number": 10503, "title": "Use all configured nameservers when using DnsNameResolver in all cases", "bodyText": "Motivation:\nDue a change introduced in 68105b2 we incorrectly skipped the usage of nameservers in some cases.\nModifications:\nOnly fetch a new stream of nameserver if the hostname not matches the original hostname in the query.\nResult:\nUse all configured nameservers. Fixes #10499", "createdAt": "2020-08-26T13:53:53Z", "url": "https://github.com/netty/netty/pull/10503", "merged": true, "mergeCommit": {"oid": "6c1840749de1304332e2581f52374a361817716b"}, "closed": true, "closedAt": "2020-08-31T07:12:13Z", "author": {"login": "normanmaurer"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCsJvogH2gAyNDczOTI0MDAwOmRlNGJkYmU2ZDk1YmFmYmJkN2ZiZmVkZmVkMGIwOWQ1ZmUzZDgxMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDP2iMgH2gAyNDczOTI0MDAwOjYyNjhmMjY2ZGU5OTBiNzFlZjNlYTllZmM2ZWFlNzg0ZDc1NmE1ZDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111", "committedDate": "2020-08-26T13:51:33Z", "message": "Use all configured nameservers when using DnsNameResolver in all cases\n\nMotivation:\n\nDue a change introduced in 68105b257d915d8a0cb7b2acd9061661666537b6 we incorrectly skipped the usage of nameservers in some cases.\n\nModifications:\n\nOnly fetch a new stream of nameserver if the hostname not matches the original hostname in the query.\n\nResult:\n\nUse all configured nameservers. Fixes https://github.com/netty/netty/issues/10499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjM5NDU0", "url": "https://github.com/netty/netty/pull/10503#pullrequestreview-475639454", "createdAt": "2020-08-26T16:04:56Z", "commit": {"oid": "de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjowNDo1NlrOHHTLJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjowNDo1NlrOHHTLJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxNjIyOQ==", "bodyText": "this is not necessary since you changed the parameter name.", "url": "https://github.com/netty/netty/pull/10503#discussion_r477416229", "createdAt": "2020-08-26T16:04:56Z", "author": {"login": "chrisvest"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsResolveContext.java", "diffHunk": "@@ -1025,11 +1025,18 @@ static String decodeDomainName(ByteBuf in) {\n         }\n     }\n \n-    private DnsServerAddressStream getNameServers(String hostname) {\n-        DnsServerAddressStream stream = getNameServersFromCache(hostname);\n-        // We need to obtain a new stream from the parent DnsNameResolver as the hostname may not be the same as the\n-        // one used for the original query (for example we may follow CNAMEs).\n-        return stream == null ? parent.newNameServerAddressStream(hostname) : stream;\n+    private DnsServerAddressStream getNameServers(String name) {\n+        DnsServerAddressStream stream = getNameServersFromCache(name);\n+        if (stream == null) {\n+            // We need to obtain a new stream from the parent DnsNameResolver if the hostname is not the same as\n+            // for the original query (for example we may follow CNAMEs). Otherwise let's just duplicate the\n+            // original nameservers so we correctly update the internal index\n+            if (name.equals(this.hostname)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6268f266de990b71ef3ea9efc6eae784d756a5d3", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/6268f266de990b71ef3ea9efc6eae784d756a5d3", "committedDate": "2020-08-28T07:27:09Z", "message": "Address chris comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4985, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}