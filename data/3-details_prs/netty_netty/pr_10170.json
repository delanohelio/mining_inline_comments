{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NTIxNTkx", "number": 10170, "title": "Set IPV4_ONLY as default when NIC has only local IPv6 addresses", "bodyText": "Motivation:\nRelated line/armeria#2463\nHere is an example that an NIC has only link local address for IPv6.\n$ ipaddr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n3: eth0@if18692: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1460 qdisc noqueue\n    link/ether 1a:5e:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff\n    inet 10.xxx.xxx.xxx/24 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::xxxx:xxxx:xxxx:xxxx/64 scope link\n       valid_lft forever preferred_lft forever\n\nIf the NICs have only local or link local addresses, We should not send IPv6 DNS queris.\nModification:\n\nIgnore link-local IPv6 addresses which may exist even on a machine without IPv6 network.\n\nResult:\n\nDnsNameResolver does not send DNS queries for AAAA when IPv6 is not available.", "createdAt": "2020-04-06T09:52:55Z", "url": "https://github.com/netty/netty/pull/10170", "merged": true, "mergeCommit": {"oid": "a4c96483d1e83981a1e0860d3a6f71fbe21d500c"}, "closed": true, "closedAt": "2020-04-07T10:08:05Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU7lsIAH2gAyMzk5NTIxNTkxOmNkYjBlZjIyNDhmNWEwNzkxNzc1ODMzMWU1NjAxNjZmODc4YjA3Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVQaElgFqTM4ODk3MDE0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/netty/netty/commit/cdb0ef2248f5a07917758331e560166f878b0727", "committedDate": "2020-04-06T09:50:08Z", "message": "Fix a bug where making IPv6 DnsQuestion when it's not supported\nMotivation:\nRelated https://github.com/line/armeria/issues/2463\nHere is an example that an NIC has only link local address for IPv6.\n```\n$ ipaddr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n3: eth0@if18692: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1460 qdisc noqueue\n    link/ether 1a:5e:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff\n    inet 10.xxx.xxx.xxx/24 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::xxxx:xxxx:xxxx:xxxx/64 scope link\n       valid_lft forever preferred_lft forever\n```\nIf the NICs have only local or link local addresses, We should not send IPv6 DNS queris.\n\nModification:\n- Ignore link-local IPv6 addresses which may exist even on a machine without IPv6 network.\n\nResult:\n- `DnsNameResolver` does not send DNS queries for AAAA when IPv6 is not available."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTc2MTk4", "url": "https://github.com/netty/netty/pull/10170#pullrequestreview-388176198", "createdAt": "2020-04-06T11:54:37Z", "commit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTo1NDozOFrOGBUMTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMTo1NDozOFrOGBUMTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzMjU4OA==", "bodyText": "@minwoox hmm... shouldn't we still support AAAA if its a loopback address ? I mean the user may run the DNS server on the same machine.", "url": "https://github.com/netty/netty/pull/10170#discussion_r404032588", "createdAt": "2020-04-06T11:54:38Z", "author": {"login": "normanmaurer"}, "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsNameResolver.java", "diffHunk": "@@ -160,7 +160,9 @@ private static boolean anyInterfaceSupportsIpV6() {\n                 NetworkInterface iface = interfaces.nextElement();\n                 Enumeration<InetAddress> addresses = iface.getInetAddresses();\n                 while (addresses.hasMoreElements()) {\n-                    if (addresses.nextElement() instanceof Inet6Address) {\n+                    InetAddress inetAddress = addresses.nextElement();\n+                    if (inetAddress instanceof Inet6Address && !inetAddress.isAnyLocalAddress() &&\n+                        !inetAddress.isLoopbackAddress() && !inetAddress.isLinkLocalAddress()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTcwMTQ2", "url": "https://github.com/netty/netty/pull/10170#pullrequestreview-388970146", "createdAt": "2020-04-07T10:05:27Z", "commit": {"oid": "cdb0ef2248f5a07917758331e560166f878b0727"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 235, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}