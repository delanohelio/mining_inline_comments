{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODk0MTIw", "number": 10583, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNTowNFrOEke2Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNjoyM1rOEke33Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2Njg5NTgyOnYy", "diffSide": "RIGHT", "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNTowNFrOHTc0jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMToxMDowN1rOHTc96g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzE5Nw==", "bodyText": "req.uri() could be moved to a variable.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490157197", "createdAt": "2020-09-17T11:05:04Z", "author": {"login": "doom369"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1OTU5NA==", "bodyText": "Okay, thank you for reviewing.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490159594", "createdAt": "2020-09-17T11:10:07Z", "author": {"login": "Doyuni"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzE5Nw=="}, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NjkwMDEzOnYy", "diffSide": "RIGHT", "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNjoyM1rOHTc2-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNDowMzowOFrOHTj1JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzgxOQ==", "bodyText": "All this should be done only in case of serverConfig.checkStartsWith(). In all other cases, we don't need to perform those checks.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490157819", "createdAt": "2020-09-17T11:06:23Z", "author": {"login": "doom369"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {\n+            char nextUri = req.uri().charAt(websocketPath.length());\n+            if (nextUri != '/' && nextUri != '?') {\n+                checkNextUri = false;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE2MTIyMQ==", "bodyText": "So..what should I do? That logic could be moved to new method?", "url": "https://github.com/netty/netty/pull/10583#discussion_r490161221", "createdAt": "2020-09-17T11:13:28Z", "author": {"login": "Doyuni"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {\n+            char nextUri = req.uri().charAt(websocketPath.length());\n+            if (nextUri != '/' && nextUri != '?') {\n+                checkNextUri = false;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzgxOQ=="}, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1ODI4Mg==", "bodyText": "Probably own method makes sense as it became big enough.\nAlso, I think it would make sense to rename isNotWebSocketPath to isWebSocketPath. It's a generic Java way. When NO is required you can use !isWebSocketPath().", "url": "https://github.com/netty/netty/pull/10583#discussion_r490258282", "createdAt": "2020-09-17T13:45:34Z", "author": {"login": "doom369"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {\n+            char nextUri = req.uri().charAt(websocketPath.length());\n+            if (nextUri != '/' && nextUri != '?') {\n+                checkNextUri = false;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzgxOQ=="}, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI3MjAzNw==", "bodyText": "Thank you for your kind explanation.\nI'll change it based on your reference.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490272037", "createdAt": "2020-09-17T14:03:08Z", "author": {"login": "Doyuni"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {\n+            char nextUri = req.uri().charAt(websocketPath.length());\n+            if (nextUri != '/' && nextUri != '?') {\n+                checkNextUri = false;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzgxOQ=="}, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3750, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}