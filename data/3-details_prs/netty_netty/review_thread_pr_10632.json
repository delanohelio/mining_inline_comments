{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2OTA4MDU4", "number": 10632, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDo1NjozMVrOEp2F9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDo0NzozOVrOEqWj8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzEzMzM1OnYy", "diffSide": "RIGHT", "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDo1NjozMVrOHbw2iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDo1NjozMVrOHbw2iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg3Mzk5NQ==", "bodyText": "doh! ... good catch", "url": "https://github.com/netty/netty/pull/10632#discussion_r498873995", "createdAt": "2020-10-02T14:56:31Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "diffHunk": "@@ -493,6 +491,7 @@ final void readComplete(int res, int data) {\n          * Called once POLLRDHUP event is ready to be processed\n          */\n         final void pollRdHup(int res) {\n+            ioState &= ~POLL_RDHUP_SCHEDULED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3404114978d6c3c5e17c81103630a4fe2968744d"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODQwMzk0OnYy", "diffSide": "RIGHT", "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozNzozNVrOHcgE5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozNzozNVrOHcgE5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0NzcxNw==", "bodyText": "\ud83e\udd14", "url": "https://github.com/netty/netty/pull/10632#discussion_r499647717", "createdAt": "2020-10-05T14:37:35Z", "author": {"login": "chrisvest"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "diffHunk": "@@ -743,17 +742,18 @@ protected final void doDeregister() {\n \n         if (submissionQueue != null) {\n             if ((ioState & (POLL_IN_SCHEDULED | POLL_OUT_SCHEDULED | POLL_RDHUP_SCHEDULED)) == 0) {\n+                System.out.println(\"doDeregister remove Channel\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f6d9295a5bb0fc05fc9dae06bc064767f7f18a"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODQxMDYxOnYy", "diffSide": "RIGHT", "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozODo1NlrOHcgI8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDozODo1NlrOHcgI8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY0ODc1Mg==", "bodyText": "I think checkstyle won't like this \ud83d\ude42", "url": "https://github.com/netty/netty/pull/10632#discussion_r499648752", "createdAt": "2020-10-05T14:38:56Z", "author": {"login": "chrisvest"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/AbstractIOUringChannel.java", "diffHunk": "@@ -830,4 +830,16 @@ private void computeRemote() {\n     private boolean shouldBreakIoUringInReady(ChannelConfig config) {\n         return socket.isInputShutdown() && (inputClosedSeenErrorOnRead || !isAllowHalfClosure(config));\n     }\n+\n+    public void clearPollFlag(int pollMask) {\n+        if (pollMask == Native.POLLIN) {\n+            ioState &= ~POLL_IN_SCHEDULED;\n+        } else if (pollMask == Native.POLLOUT) {\n+            ioState &= ~POLL_OUT_SCHEDULED;\n+        } else if (pollMask == Native.POLLRDHUP) {\n+            ioState &= ~POLL_RDHUP_SCHEDULED;\n+        }\n+\n+\n+     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f6d9295a5bb0fc05fc9dae06bc064767f7f18a"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODQ1Mjk4OnYy", "diffSide": "RIGHT", "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/IOUringSubmissionQueue.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDo0NzozOVrOHcgi7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNDo0NzozOVrOHcgi7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1NTQwNg==", "bodyText": "Maybe we should have an assert that pollMask fits in a short?", "url": "https://github.com/netty/netty/pull/10632#discussion_r499655406", "createdAt": "2020-10-05T14:47:39Z", "author": {"login": "chrisvest"}, "path": "transport-native-io_uring/src/main/java/io/netty/channel/uring/IOUringSubmissionQueue.java", "diffHunk": "@@ -191,9 +191,9 @@ boolean addAccept(int fd, long address, long addressLength, short extraData) {\n     }\n \n     //fill the address which is associated with server poll link user_data\n-    boolean addPollRemove(int fd, int pollMask, short extraData) {\n+    boolean addPollRemove(int fd, int pollMask) {\n         return enqueueSqe(Native.IORING_OP_POLL_REMOVE, 0, 0, fd,\n-                          encode(fd, Native.IORING_OP_POLL_ADD, (short) pollMask), 0, 0, extraData);\n+                          encode(fd, Native.IORING_OP_POLL_ADD, (short) pollMask), 0, 0, (short) pollMask);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f6d9295a5bb0fc05fc9dae06bc064767f7f18a"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3577, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}