{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODk0MTIw", "number": 10583, "title": "Add validation check about websocket path", "bodyText": "add uri check in case: / or ?\n\nMotivation:\nI add websocket handler in custom server with netty.\nI first add WebSocketServerProtocolHandler in my channel pipeline like example code.\n\nexample code\n\nprivate final String WEBSOCKET_PATH = \"/websocket\";\n\n// ~~\n\nfinal ChannelPipeline p = ch.pipeline();\n// ~~\np.addLast(new WebSocketServerProtocolHandler(WEBSOCKET_PATH, true));\n// ~~\nIt does work! but I found that it can pass \"/websocketabc\" through. (I didn't want!!!)\nModification:\nSo I modified isNotWebSocketPath() method of WebSocketServerProtocolHandshakeHandler\nResult:\nLet explain some cases.\nwebsocket path is \"/websocket\".\ncase 1\n\n/websocket\n: return false\n\ncase 2\n\n/websocketabc\n: return true\n\ncase 3\n\n/websocket/a\n: return false\n\ncase 4\n\n/websocket?name=doyuni\n: return true\n\nFixes #10582", "createdAt": "2020-09-16T10:36:44Z", "url": "https://github.com/netty/netty/pull/10583", "merged": true, "mergeCommit": {"oid": "d01471917b94d15fbe8b3b2e0f0ed8f24ee2954a"}, "closed": true, "closedAt": "2020-10-08T10:06:44Z", "author": {"login": "Doyuni"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJfpPBgH2gAyNDg3ODk0MTIwOjdkYTAyNzUyNjk5YjBkNTEwNDhhYmUwOTJiZTg0NzI5NGI1NDZjYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKC3DKgBqjM3ODE5MzgwNzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7da02752699b0d51048abe092be847294b546cb7", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/7da02752699b0d51048abe092be847294b546cb7", "committedDate": "2020-09-16T17:14:39Z", "message": "Add validation check about websocket path\n\nMotivation:\n\nI add websocket handler in custom server with netty.\n\nI first add WebSocketServerProtocolHandler in my channel pipeline.\n\nIt does work! but I found that it can pass \"/websocketabc\". (websocketPath is \"/websocket\")\n\nModification:\n`isNotWebSocketPath()` method of `WebSocketServerProtocolHandshakeHandler`\n\nResult:\nIt can pass not \"/websocketabc\" but \"/websocket\"."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3fed0f617e827f698d3f4c5944e6ca2fde00d49", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/a3fed0f617e827f698d3f4c5944e6ca2fde00d49", "committedDate": "2020-09-16T16:52:22Z", "message": "Add validation check about websocket path\n\nMotivation:\n\nI add websocket handler in custom server with netty.\n\nI first add WebSocketServerProtocolHandler in my channel pipeline.\n\nIt does work! but I found that it can pass \"/websocketabc\". (websocketPath is \"/websocket\")\n\nModification:\n`isNotWebSocketPath()` method of `WebSocketServerProtocolHandshakeHandler`\n\nResult:\nIt can pass not \"/websocketabc\" but \"/websocket\"."}, "afterCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/7da02752699b0d51048abe092be847294b546cb7", "committedDate": "2020-09-16T17:14:39Z", "message": "Add validation check about websocket path\n\nMotivation:\n\nI add websocket handler in custom server with netty.\n\nI first add WebSocketServerProtocolHandler in my channel pipeline.\n\nIt does work! but I found that it can pass \"/websocketabc\". (websocketPath is \"/websocket\")\n\nModification:\n`isNotWebSocketPath()` method of `WebSocketServerProtocolHandshakeHandler`\n\nResult:\nIt can pass not \"/websocketabc\" but \"/websocket\"."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDgwMDI2", "url": "https://github.com/netty/netty/pull/10583#pullrequestreview-490480026", "createdAt": "2020-09-17T11:05:04Z", "commit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNTowNFrOHTc0jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMTowNjoyM1rOHTc2-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzE5Nw==", "bodyText": "req.uri() could be moved to a variable.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490157197", "createdAt": "2020-09-17T11:05:04Z", "author": {"login": "doom369"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE1NzgxOQ==", "bodyText": "All this should be done only in case of serverConfig.checkStartsWith(). In all other cases, we don't need to perform those checks.", "url": "https://github.com/netty/netty/pull/10583#discussion_r490157819", "createdAt": "2020-09-17T11:06:23Z", "author": {"login": "doom369"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketServerProtocolHandshakeHandler.java", "diffHunk": "@@ -115,7 +115,15 @@ public void operationComplete(ChannelFuture future) {\n \n     private boolean isNotWebSocketPath(FullHttpRequest req) {\n         String websocketPath = serverConfig.websocketPath();\n-        return serverConfig.checkStartsWith() ? !req.uri().startsWith(websocketPath) : !req.uri().equals(websocketPath);\n+        boolean checkNextUri = true;\n+        if (req.uri().length() > websocketPath.length()) {\n+            char nextUri = req.uri().charAt(websocketPath.length());\n+            if (nextUri != '/' && nextUri != '?') {\n+                checkNextUri = false;\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da02752699b0d51048abe092be847294b546cb7"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d88ea08776abe62037823fcbeee0f6cd4746551", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/8d88ea08776abe62037823fcbeee0f6cd4746551", "committedDate": "2020-09-18T10:15:45Z", "message": "Add validation check about websocket path (#10583)\n\nMotivation:\n    I add websocket handler in custom server with netty.\n\n    I first add WebSocketServerProtocolHandler in my channel pipeline.\n\n    It does work! but I found that it can pass /websocketabc. (websocketPath is /websocket)\n\nModification:\n    - modify method name: isNotWebSocketPath -> isWebSocketPath\n    - separate concern: add checkNextUri method\n\nResult:\n    It can pass not /websocketabc but /websocket."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0624be8d341c7d1dc4d3b7bd7a45ddb86cd8a21", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/f0624be8d341c7d1dc4d3b7bd7a45ddb86cd8a21", "committedDate": "2020-09-18T10:06:43Z", "message": "Motivation:\n\nI add websocket handler in custom server with netty.\n\nI first add WebSocketServerProtocolHandler in my channel pipeline.\n\nIt does work! but I found that it can pass \"/websocketabc\". (websocketPath is \"/websocket\")\n\nModification:\n- modify method name: isNotWebSocketPath -> isWebSocketPath\n- separate concern: add checkNextUri method\n\nResult:\nIt can pass not \"/websocketabc\" but \"/websocket\"."}, "afterCommit": {"oid": "8d88ea08776abe62037823fcbeee0f6cd4746551", "author": {"user": {"login": "Doyuni", "name": "Doyun Geum"}}, "url": "https://github.com/netty/netty/commit/8d88ea08776abe62037823fcbeee0f6cd4746551", "committedDate": "2020-09-18T10:15:45Z", "message": "Add validation check about websocket path (#10583)\n\nMotivation:\n    I add websocket handler in custom server with netty.\n\n    I first add WebSocketServerProtocolHandler in my channel pipeline.\n\n    It does work! but I found that it can pass /websocketabc. (websocketPath is /websocket)\n\nModification:\n    - modify method name: isNotWebSocketPath -> isWebSocketPath\n    - separate concern: add checkNextUri method\n\nResult:\n    It can pass not /websocketabc but /websocket."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 57, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}