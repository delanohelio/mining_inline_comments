{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzMyNDc1", "number": 10735, "title": "Use netty-jni-util and so remove a lot of duplication", "bodyText": "Motivation:\nWe had a lot of duplication in our jni code which was mostly due macros but also related to how we support shading. By using netty-jni-util we can share all the code between netty and netty-tcnative ( and possible other jni based netty projects in the future).\nModifications:\n\nUse netty-jni-util and re-use its macros / functions\nRemove duplicated code\nAdjust build files\n\nResult:\nLess code duplication for JNI", "createdAt": "2020-10-27T12:56:13Z", "url": "https://github.com/netty/netty/pull/10735", "merged": true, "mergeCommit": {"oid": "a63faa4fa1ae08efc391e9bcf461ab699a5d7efd"}, "closed": true, "closedAt": "2020-10-29T15:36:08Z", "author": {"login": "normanmaurer"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWoizPgFqTUxNzY3MTgwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXSZKSABqjM5MzYzOTk1Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjcxODA5", "url": "https://github.com/netty/netty/pull/10735#pullrequestreview-517671809", "createdAt": "2020-10-27T12:57:47Z", "commit": {"oid": "41a2560cc40178383a76c3dd3b2a7fe55692ec1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo1Nzo0N1rOHo61zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo1Nzo0N1rOHo61zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTEzMg==", "bodyText": "Before we merge this one we should tag a version for netty-jni-util and use it. I just wanted to verify first that it works for netty and netty-tcnative", "url": "https://github.com/netty/netty/pull/10735#discussion_r512669132", "createdAt": "2020-10-27T12:57:47Z", "author": {"login": "normanmaurer"}, "path": "transport-native-unix-common/pom.xml", "diffHunk": "@@ -46,6 +48,31 @@\n \n   <build>\n     <plugins>\n+      <!-- Download the netty-jni-util source -->\n+      <plugin>\n+        <artifactId>maven-scm-plugin</artifactId>\n+        <version>1.11.2</version>\n+        <executions>\n+          <execution>\n+            <id>get-netty-jni-util</id>\n+            <phase>generate-sources</phase>\n+            <goals>\n+              <goal>checkout</goal>\n+            </goals>\n+            <configuration>\n+              <checkoutDirectory>${jniUtilCheckoutDir}</checkoutDirectory>\n+              <connectionType>developerConnection</connectionType>\n+              <developerConnectionUrl>scm:git:https://github.com/netty/netty-jni-util.git</developerConnectionUrl>\n+              <!-- TODO: Change this to a release tag once we did a release -->\n+              <scmVersion>main</scmVersion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a2560cc40178383a76c3dd3b2a7fe55692ec1a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDQ2Nzcw", "url": "https://github.com/netty/netty/pull/10735#pullrequestreview-519046770", "createdAt": "2020-10-28T20:14:33Z", "commit": {"oid": "c850877af159f6f3f8d9b17c83ca50a34c75b67d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDoxNDozM1rOHp7tVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDoxNDozM1rOHp7tVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMTkyNA==", "bodyText": "looks like this changed to NETTY_JNI_UTIL_BUILD_STATIC? be sure to call this out in release notes.", "url": "https://github.com/netty/netty/pull/10735#discussion_r513731924", "createdAt": "2020-10-28T20:14:33Z", "author": {"login": "Scottmitch"}, "path": "transport-native-kqueue/src/main/c/netty_kqueue_native.c", "diffHunk": "@@ -381,69 +379,26 @@ static void netty_kqueue_native_JNI_OnUnLoad(JNIEnv* env, const char* staticPack\n     netty_kqueue_eventarray_JNI_OnUnLoad(env, staticPackagePrefix);\n }\n \n-static jint JNI_OnLoad_netty_transport_native_kqueue0(JavaVM* vm, void* reserved) {\n-    JNIEnv* env;\n-    if ((*vm)->GetEnv(vm, (void**) &env, NETTY_JNI_VERSION) != JNI_OK) {\n-        return JNI_ERR;\n-    }\n-\n-    char* packagePrefix = NULL;\n-#ifndef NETTY_BUILD_STATIC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c850877af159f6f3f8d9b17c83ca50a34c75b67d"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "committedDate": "2020-10-29T13:43:02Z", "message": "Use netty-jni-util and so remove a lot of duplication\n\nMotivation:\n\nWe had a lot of duplication in our jni code which was mostly due macros but also related to how we support shading. By using netty-jni-util we can share all the code between netty and netty-tcnative ( and possible other jni based netty projects in the future).\n\nModifications:\n\n- Use netty-jni-util and re-use its macros / functions\n- Remove duplicated code\n- Adjust build files\n\nResult:\n\nLess code duplication for JNI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68e3b2391747095088c52ba8bcd138952894c73d", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/68e3b2391747095088c52ba8bcd138952894c73d", "committedDate": "2020-10-29T09:33:57Z", "message": "Add define"}, "afterCommit": {"oid": "cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "committedDate": "2020-10-29T13:43:02Z", "message": "Use netty-jni-util and so remove a lot of duplication\n\nMotivation:\n\nWe had a lot of duplication in our jni code which was mostly due macros but also related to how we support shading. By using netty-jni-util we can share all the code between netty and netty-tcnative ( and possible other jni based netty projects in the future).\n\nModifications:\n\n- Use netty-jni-util and re-use its macros / functions\n- Remove duplicated code\n- Adjust build files\n\nResult:\n\nLess code duplication for JNI"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4948, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}