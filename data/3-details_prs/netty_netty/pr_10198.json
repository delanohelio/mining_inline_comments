{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MTIwMDkz", "number": 10198, "title": "Fix a potential fd leak in AbstractDiskHttpData.setContent", "bodyText": "Motivation:\nRandomAccessFile.setLength may throw an IOException. We must deal with this in case of the occurrence of I/O error.\nModification:\nPlace the RandomAccessFile.setLength method call in the try-finally block.\nResult:\nAvoid fd leak.", "createdAt": "2020-04-20T15:03:54Z", "url": "https://github.com/netty/netty/pull/10198", "merged": true, "mergeCommit": {"oid": "32e32fe98fceb114f6c7bf97a5286a76fe9bdb29"}, "closed": true, "closedAt": "2020-04-21T08:54:10Z", "author": {"login": "seedeed"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZgTeCgH2gAyNDA2MTIwMDkzOjQzYTQwYzJmMzJmODkzZGQ1MGIxNmNmMTc1ZDJkZWYxYmQwY2U3MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZiKZXgH2gAyNDA2MTIwMDkzOmI4Yzc0MzczMjNiZDM0ZDY3ZjFlNzUwMzExZWM3ZWNjMzYyNGI2Y2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "43a40c2f32f893dd50b16cf175d2def1bd0ce70a", "author": {"user": {"login": "seedeed", "name": "feijermu"}}, "url": "https://github.com/netty/netty/commit/43a40c2f32f893dd50b16cf175d2def1bd0ce70a", "committedDate": "2020-04-20T14:52:25Z", "message": "Fix a potential fd leak in AbstractDiskHttpData.setContent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTg4OTAx", "url": "https://github.com/netty/netty/pull/10198#pullrequestreview-396588901", "createdAt": "2020-04-20T15:55:48Z", "commit": {"oid": "43a40c2f32f893dd50b16cf175d2def1bd0ce70a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTo1NTo0OVrOGIblaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTo1NTo0OVrOGIblaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5MzczNg==", "bodyText": "nit: static", "url": "https://github.com/netty/netty/pull/10198#discussion_r411493736", "createdAt": "2020-04-20T15:55:49Z", "author": {"login": "normanmaurer"}, "path": "codec-http/src/test/java/io/netty/handler/codec/http/multipart/DiskFileUploadTest.java", "diffHunk": "@@ -130,4 +133,65 @@ public void testAddContents() throws Exception {\n             f1.delete();\n         }\n     }\n+\n+    @Test\n+    public void testSetContentFromByteBuf() throws Exception {\n+        DiskFileUpload f1 = new DiskFileUpload(\"file2\", \"file2\", \"application/json\", null, null, 0);\n+        try {\n+            String json = \"{\\\"hello\\\":\\\"world\\\"}\";\n+            byte[] bytes = json.getBytes(CharsetUtil.UTF_8);\n+            f1.setContent(Unpooled.wrappedBuffer(bytes));\n+            assertEquals(json, f1.getString());\n+            assertArrayEquals(bytes, f1.get());\n+            File file = f1.getFile();\n+            assertEquals((long) bytes.length, file.length());\n+            assertArrayEquals(bytes, doReadFile(file, bytes.length));\n+        } finally {\n+            f1.delete();\n+        }\n+    }\n+\n+    @Test\n+    public void testSetContentFromInputStream() throws Exception {\n+        String json = \"{\\\"hello\\\":\\\"world\\\",\\\"foo\\\":\\\"bar\\\"}\";\n+        DiskFileUpload f1 = new DiskFileUpload(\"file3\", \"file3\", \"application/json\", null, null, 0);\n+        try {\n+            byte[] bytes = json.getBytes(CharsetUtil.UTF_8);\n+            ByteBuf buf = Unpooled.wrappedBuffer(bytes);\n+            InputStream is = new ByteBufInputStream(buf);\n+            try {\n+                f1.setContent(is);\n+                assertEquals(json, f1.getString());\n+                assertArrayEquals(bytes, f1.get());\n+                File file = f1.getFile();\n+                assertEquals((long) bytes.length, file.length());\n+                assertArrayEquals(bytes, doReadFile(file, bytes.length));\n+            } finally {\n+                buf.release();\n+                is.close();\n+            }\n+        } finally {\n+            f1.delete();\n+        }\n+    }\n+\n+    private byte[] doReadFile(File file, int maxRead) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a40c2f32f893dd50b16cf175d2def1bd0ce70a"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8c7437323bd34d67f1e750311ec7ecc3624b6cf", "author": {"user": {"login": "seedeed", "name": "feijermu"}}, "url": "https://github.com/netty/netty/commit/b8c7437323bd34d67f1e750311ec7ecc3624b6cf", "committedDate": "2020-04-20T17:02:19Z", "message": "Fix a test case problem."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 249, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}