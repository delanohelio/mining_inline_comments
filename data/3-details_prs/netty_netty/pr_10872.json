{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzIyNjgy", "number": 10872, "title": "Simplify InternalThreadLocalMap", "bodyText": "Motivation:\nI did not see any tangible advantage to the padding (in benchmarks).\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using long, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\nModification:\nMove all the fields into the InternalThreadLocalMap and deprecate the stuff we'd like to remove.\nResult:\nSimpler code.\nThis resolves the discussion in #9284", "createdAt": "2020-12-16T17:22:38Z", "url": "https://github.com/netty/netty/pull/10872", "merged": true, "mergeCommit": {"oid": "5c1613df814a408a73b59333c6b36ca74e4f7a26"}, "closed": true, "closedAt": "2020-12-18T07:06:54Z", "author": {"login": "chrisvest"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmyW0UABqjQxMjA5MDcwNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnSrktAFqTU1NTIxMzE0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c62ed0b1326055974c396b13c11d61d827e47979", "author": {"user": {"login": "chrisvest", "name": "Chris Vest"}}, "url": "https://github.com/netty/netty/commit/c62ed0b1326055974c396b13c11d61d827e47979", "committedDate": "2020-12-16T17:21:49Z", "message": "Simplify InternalThreadLocalMap\n\nMotivation:\nI did not see any tangible advantage to the padding.\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using `long`, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\n\nModification:\nRemove the padding and collapse the object hierarchy.\n\nResult:\nSimpler code.\nThis resolves the discussion in https://github.com/netty/netty/issues/9284"}, "afterCommit": {"oid": "dfd13bba1b7feb7f25c313f518716e4157318cb1", "author": {"user": {"login": "chrisvest", "name": "Chris Vest"}}, "url": "https://github.com/netty/netty/commit/dfd13bba1b7feb7f25c313f518716e4157318cb1", "committedDate": "2020-12-16T17:26:19Z", "message": "Simplify InternalThreadLocalMap\n\nMotivation:\nI did not see any tangible advantage to the padding.\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using `long`, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\n\nModification:\nRemove the padding and collapse the object hierarchy.\n\nResult:\nSimpler code.\nThis resolves the discussion in https://github.com/netty/netty/issues/9284"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa7ea3956fd40a7b9bcd707a28d48444b796c6e9", "author": {"user": {"login": "chrisvest", "name": "Chris Vest"}}, "url": "https://github.com/netty/netty/commit/fa7ea3956fd40a7b9bcd707a28d48444b796c6e9", "committedDate": "2020-12-16T22:05:26Z", "message": "Simplify InternalThreadLocalMap\n\nMotivation:\nI did not see any tangible advantage to the padding.\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using `long`, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\n\nModification:\nMove all the fields into the InternalThreadLocalMap and deprecate the stuff we'd like to remove.\n\nResult:\nSimpler code.\nThis resolves the discussion in https://github.com/netty/netty/issues/9284"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfd13bba1b7feb7f25c313f518716e4157318cb1", "author": {"user": {"login": "chrisvest", "name": "Chris Vest"}}, "url": "https://github.com/netty/netty/commit/dfd13bba1b7feb7f25c313f518716e4157318cb1", "committedDate": "2020-12-16T17:26:19Z", "message": "Simplify InternalThreadLocalMap\n\nMotivation:\nI did not see any tangible advantage to the padding.\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using `long`, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\n\nModification:\nRemove the padding and collapse the object hierarchy.\n\nResult:\nSimpler code.\nThis resolves the discussion in https://github.com/netty/netty/issues/9284"}, "afterCommit": {"oid": "fa7ea3956fd40a7b9bcd707a28d48444b796c6e9", "author": {"user": {"login": "chrisvest", "name": "Chris Vest"}}, "url": "https://github.com/netty/netty/commit/fa7ea3956fd40a7b9bcd707a28d48444b796c6e9", "committedDate": "2020-12-16T22:05:26Z", "message": "Simplify InternalThreadLocalMap\n\nMotivation:\nI did not see any tangible advantage to the padding.\nThe only other field that was guarded was a rarely changed object reference to a BitSet.\nWithout the padding, there is also no longer any use of the inheritance hierarchy.\nThe padding was also using `long`, which would not necessarily prevent the JVM from fitting the aforementioned object reference in an alignment gap.\n\nModification:\nMove all the fields into the InternalThreadLocalMap and deprecate the stuff we'd like to remove.\n\nResult:\nSimpler code.\nThis resolves the discussion in https://github.com/netty/netty/issues/9284"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MzA0Nzc3", "url": "https://github.com/netty/netty/pull/10872#pullrequestreview-554304777", "createdAt": "2020-12-17T06:12:17Z", "commit": {"oid": "fa7ea3956fd40a7b9bcd707a28d48444b796c6e9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNjoxMjoxN1rOIHmOLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNjoxMjoxN1rOIHmOLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgzNzE2Ng==", "bodyText": "can't we just remove this class as its package-private now that we moved the fields ?", "url": "https://github.com/netty/netty/pull/10872#discussion_r544837166", "createdAt": "2020-12-17T06:12:17Z", "author": {"login": "normanmaurer"}, "path": "common/src/main/java/io/netty/util/internal/UnpaddedInternalThreadLocalMap.java", "diffHunk": "@@ -13,49 +13,11 @@\n  * License for the specific language governing permissions and limitations\n  * under the License.\n  */\n-\n package io.netty.util.internal;\n \n-import io.netty.util.concurrent.FastThreadLocal;\n-\n-import java.nio.charset.Charset;\n-import java.nio.charset.CharsetDecoder;\n-import java.nio.charset.CharsetEncoder;\n-import java.util.ArrayList;\n-import java.util.Map;\n-import java.util.concurrent.atomic.AtomicInteger;\n-\n /**\n- * The internal data structure that stores the thread-local variables for Netty and all {@link FastThreadLocal}s.\n- * Note that this class is for internal use only and is subject to change at any time.  Use {@link FastThreadLocal}\n- * unless you know what you are doing.\n+ * @deprecated This class will be removed in the future.\n  */\n class UnpaddedInternalThreadLocalMap {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa7ea3956fd40a7b9bcd707a28d48444b796c6e9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MjEzMTQ4", "url": "https://github.com/netty/netty/pull/10872#pullrequestreview-555213148", "createdAt": "2020-12-18T07:06:10Z", "commit": {"oid": "fa7ea3956fd40a7b9bcd707a28d48444b796c6e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4873, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}