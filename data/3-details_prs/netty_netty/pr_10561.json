{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNDU4ODQw", "number": 10561, "title": "Added error handling for io_uring creation failure", "bodyText": "Motivation:\nwe should throw a  java runtime exception for io_uring creation failure to avoid a NullPointerException\nModifications:\n-Error handling for creation ring fd and mmap io_uring ring buffer\n-Cleanups\nResult:\nbetter error handling", "createdAt": "2020-09-10T07:00:24Z", "url": "https://github.com/netty/netty/pull/10561", "merged": true, "mergeCommit": {"oid": "d990b99a6b69311c7b032f197a39b4dad0befee3"}, "closed": true, "closedAt": "2020-09-10T14:25:18Z", "author": {"login": "1Jo1"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHbVYpAFqTQ4NTYzNzE1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHh8pggFqTQ4NjAxNTQ1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NjM3MTUz", "url": "https://github.com/netty/netty/pull/10561#pullrequestreview-485637153", "createdAt": "2020-09-10T07:04:38Z", "commit": {"oid": "ebe5149e3c088cbc67a5b7849454f75ad37c420f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNzowNDozOFrOHPl4Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNzowNToxM1rOHPl5Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExMTI2Ng==", "bodyText": "shouldn't that better include the errno ?", "url": "https://github.com/netty/netty/pull/10561#discussion_r486111266", "createdAt": "2020-09-10T07:04:38Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/c/netty_io_uring_native.c", "diffHunk": "@@ -276,28 +244,22 @@ static void netty_io_uring_ring_buffer_exit(JNIEnv *env, jclass class, jobject r\n \tclose(submissionQueueRingFd);\n }\n \n-static int nettyBlockingSocket(int domain, int type, int protocol) {\n-    return socket(domain, type, protocol);\n-}\n-\n static jobject netty_io_uring_setup(JNIEnv *env, jclass class1, jint entries, jobject submitCallback) {\n     struct io_uring_params p;\n     memset(&p, 0, sizeof(p));\n \n     int ring_fd = sys_io_uring_setup((int)entries, &p);\n \n-    //Todo\n     if (ring_fd < 0) {\n-      printf(\"RingFd error: %d\\n\", ring_fd);\n-      //throw Exception\n+     netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to create io_uring ring fd \", errno);\n       return NULL;\n     }\n     struct io_uring io_uring_ring;\n-    //Todo memset instead\n-    io_uring_ring.flags = 0;\n-    io_uring_ring.sq.sqe_tail = 0;\n-    io_uring_ring.sq.sqe_head = 0;\n-    setup_io_uring(ring_fd, &io_uring_ring, &p);\n+    int ret = setup_io_uring(ring_fd, &io_uring_ring, &p);\n+\n+    if (ret != 0) {\n+        netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to mmap io_uring ring buffer\", ret);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebe5149e3c088cbc67a5b7849454f75ad37c420f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExMTM5Nw==", "bodyText": "nit: \"missing space\"", "url": "https://github.com/netty/netty/pull/10561#discussion_r486111397", "createdAt": "2020-09-10T07:04:53Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/c/netty_io_uring_native.c", "diffHunk": "@@ -276,28 +244,22 @@ static void netty_io_uring_ring_buffer_exit(JNIEnv *env, jclass class, jobject r\n \tclose(submissionQueueRingFd);\n }\n \n-static int nettyBlockingSocket(int domain, int type, int protocol) {\n-    return socket(domain, type, protocol);\n-}\n-\n static jobject netty_io_uring_setup(JNIEnv *env, jclass class1, jint entries, jobject submitCallback) {\n     struct io_uring_params p;\n     memset(&p, 0, sizeof(p));\n \n     int ring_fd = sys_io_uring_setup((int)entries, &p);\n \n-    //Todo\n     if (ring_fd < 0) {\n-      printf(\"RingFd error: %d\\n\", ring_fd);\n-      //throw Exception\n+     netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to create io_uring ring fd \", errno);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebe5149e3c088cbc67a5b7849454f75ad37c420f"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExMTU3OA==", "bodyText": "why this change ?", "url": "https://github.com/netty/netty/pull/10561#discussion_r486111578", "createdAt": "2020-09-10T07:05:13Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/c/netty_io_uring.h", "diffHunk": "@@ -38,9 +38,6 @@ struct io_uring_sq {\n     unsigned *array;\n     struct io_uring_sqe *sqes;\n \n-    unsigned sqe_head;\n-    unsigned sqe_tail;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebe5149e3c088cbc67a5b7849454f75ad37c420f"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebe5149e3c088cbc67a5b7849454f75ad37c420f", "author": {"user": {"login": "1Jo1", "name": "Josef Grieb"}}, "url": "https://github.com/netty/netty/commit/ebe5149e3c088cbc67a5b7849454f75ad37c420f", "committedDate": "2020-09-10T06:51:24Z", "message": "Added error handling for io_uring creation failure\n\nMotivation:\n\nwe should throw a jvm runtime exception for io_uring creation failure to avoid a NullPointerException\n\nModifications:\n\n-error handling for creation ring fd and mmap io_uring ring buffer\n-some cleanups\n\nResult:\n\nbetter error handling"}, "afterCommit": {"oid": "d37966cf336302e53b4a198f9e5397d0fa9be728", "author": {"user": {"login": "1Jo1", "name": "Josef Grieb"}}, "url": "https://github.com/netty/netty/commit/d37966cf336302e53b4a198f9e5397d0fa9be728", "committedDate": "2020-09-10T09:49:59Z", "message": "Added error handling for io_uring creation failure\n\nMotivation:\n\nwe should throw a jvm runtime exception for io_uring creation failure to avoid a NullPointerException\n\nModifications:\n\n-error handling for creation ring fd and mmap io_uring ring buffer\n-some cleanups\n\nResult:\n\nbetter error handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODYzOTg4", "url": "https://github.com/netty/netty/pull/10561#pullrequestreview-485863988", "createdAt": "2020-09-10T12:11:46Z", "commit": {"oid": "d37966cf336302e53b4a198f9e5397d0fa9be728"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjoxMTo0NlrOHPwi4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMjoxMTo0NlrOHPwi4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI4NjA1MQ==", "bodyText": "you also need to add a return statement as the exception will be just put on the \"stack\" and picked up once the method returns. This works a bit different then throwing an exception from java layer :)\nif (ret != 0) {\n    netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to mmap io_uring ring buffer\", ret);\n    return NULL;\n}", "url": "https://github.com/netty/netty/pull/10561#discussion_r486286051", "createdAt": "2020-09-10T12:11:46Z", "author": {"login": "normanmaurer"}, "path": "transport-native-io_uring/src/main/c/netty_io_uring_native.c", "diffHunk": "@@ -276,28 +244,22 @@ static void netty_io_uring_ring_buffer_exit(JNIEnv *env, jclass class, jobject r\n \tclose(submissionQueueRingFd);\n }\n \n-static int nettyBlockingSocket(int domain, int type, int protocol) {\n-    return socket(domain, type, protocol);\n-}\n-\n static jobject netty_io_uring_setup(JNIEnv *env, jclass class1, jint entries, jobject submitCallback) {\n     struct io_uring_params p;\n     memset(&p, 0, sizeof(p));\n \n     int ring_fd = sys_io_uring_setup((int)entries, &p);\n \n-    //Todo\n     if (ring_fd < 0) {\n-      printf(\"RingFd error: %d\\n\", ring_fd);\n-      //throw Exception\n-      return NULL;\n+        netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to create io_uring ring fd \", errno);\n+        return NULL;\n     }\n     struct io_uring io_uring_ring;\n-    //Todo memset instead\n-    io_uring_ring.flags = 0;\n-    io_uring_ring.sq.sqe_tail = 0;\n-    io_uring_ring.sq.sqe_head = 0;\n-    setup_io_uring(ring_fd, &io_uring_ring, &p);\n+    int ret = setup_io_uring(ring_fd, &io_uring_ring, &p);\n+\n+    if (ret != 0) {\n+        netty_unix_errors_throwRuntimeExceptionErrorNo(env, \"failed to mmap io_uring ring buffer\", ret);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37966cf336302e53b4a198f9e5397d0fa9be728"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODY2OTk0", "url": "https://github.com/netty/netty/pull/10561#pullrequestreview-485866994", "createdAt": "2020-09-10T12:16:05Z", "commit": {"oid": "d37966cf336302e53b4a198f9e5397d0fa9be728"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f18304aff73a071bb0aaa34a22d3ea9b55f76fc", "author": {"user": {"login": "1Jo1", "name": "Josef Grieb"}}, "url": "https://github.com/netty/netty/commit/1f18304aff73a071bb0aaa34a22d3ea9b55f76fc", "committedDate": "2020-09-10T13:24:11Z", "message": "Added error handling for io_uring creation failure\n\nMotivation:\n\nwe should throw a jvm runtime exception for io_uring creation failure to avoid a NullPointerException\n\nModifications:\n\n-error handling for creation ring fd and mmap io_uring ring buffer\n-some cleanups\n\nResult:\n\nbetter error handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d37966cf336302e53b4a198f9e5397d0fa9be728", "author": {"user": {"login": "1Jo1", "name": "Josef Grieb"}}, "url": "https://github.com/netty/netty/commit/d37966cf336302e53b4a198f9e5397d0fa9be728", "committedDate": "2020-09-10T09:49:59Z", "message": "Added error handling for io_uring creation failure\n\nMotivation:\n\nwe should throw a jvm runtime exception for io_uring creation failure to avoid a NullPointerException\n\nModifications:\n\n-error handling for creation ring fd and mmap io_uring ring buffer\n-some cleanups\n\nResult:\n\nbetter error handling"}, "afterCommit": {"oid": "1f18304aff73a071bb0aaa34a22d3ea9b55f76fc", "author": {"user": {"login": "1Jo1", "name": "Josef Grieb"}}, "url": "https://github.com/netty/netty/commit/1f18304aff73a071bb0aaa34a22d3ea9b55f76fc", "committedDate": "2020-09-10T13:24:11Z", "message": "Added error handling for io_uring creation failure\n\nMotivation:\n\nwe should throw a jvm runtime exception for io_uring creation failure to avoid a NullPointerException\n\nModifications:\n\n-error handling for creation ring fd and mmap io_uring ring buffer\n-some cleanups\n\nResult:\n\nbetter error handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTkyMDgx", "url": "https://github.com/netty/netty/pull/10561#pullrequestreview-485992081", "createdAt": "2020-09-10T14:25:09Z", "commit": {"oid": "1f18304aff73a071bb0aaa34a22d3ea9b55f76fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDE1NDUw", "url": "https://github.com/netty/netty/pull/10561#pullrequestreview-486015450", "createdAt": "2020-09-10T14:47:49Z", "commit": {"oid": "1f18304aff73a071bb0aaa34a22d3ea9b55f76fc"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 40, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}