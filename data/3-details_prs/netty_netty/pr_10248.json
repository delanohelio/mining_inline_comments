{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNDIyMTk5", "number": 10248, "title": "Don't reuse ChannelPromise in WebSocketProtocolHandler", "bodyText": "Motivation:\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\nModifications:\n\nUse a new promise and chain it with the old one\nAdd unit test\n\nResult:\nFixes #10240", "createdAt": "2020-05-05T10:10:41Z", "url": "https://github.com/netty/netty/pull/10248", "merged": true, "mergeCommit": {"oid": "f00160bca36d9f795f015b78349f2be800674be0"}, "closed": true, "closedAt": "2020-05-07T06:11:34Z", "author": {"login": "normanmaurer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceRSNQgBqjMzMDM1NDIxNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceWZoVgFqTQwNTk0MDAwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81753f0680b3019ae2880e03decd1461e962b1e4", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/81753f0680b3019ae2880e03decd1461e962b1e4", "committedDate": "2020-05-05T10:08:44Z", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240"}, "afterCommit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/3aaea4874ce4659709dcd53b9a496502b8a37491", "committedDate": "2020-05-05T10:11:57Z", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTEyMDQ5", "url": "https://github.com/netty/netty/pull/10248#pullrequestreview-405912049", "createdAt": "2020-05-05T15:39:26Z", "commit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTozOToyN1rOGQvaXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTozOToyN1rOGQvaXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzE5Ng==", "bodyText": "do we need to unvoid..?", "url": "https://github.com/netty/netty/pull/10248#discussion_r420207196", "createdAt": "2020-05-05T15:39:27Z", "author": {"login": "johnou"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketProtocolHandler.java", "diffHunk": "@@ -110,13 +111,12 @@ public void write(final ChannelHandlerContext ctx, Object msg, ChannelPromise pr\n         if (closeSent != null) {\n             ReferenceCountUtil.release(msg);\n             promise.setFailure(new ClosedChannelException());\n-            return;\n-        }\n-        if (msg instanceof CloseWebSocketFrame) {\n-            promise = promise.unvoid();\n+        } else if (msg instanceof CloseWebSocketFrame) {\n             closeSent = promise;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTEzMzc0", "url": "https://github.com/netty/netty/pull/10248#pullrequestreview-405913374", "createdAt": "2020-05-05T15:40:51Z", "commit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTo0MDo1MVrOGQverQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTo0MDo1MVrOGQverQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwODMwMQ==", "bodyText": "@normanmaurer do we risk an NPE here? https://github.com/netty/netty/pull/10248/files#diff-1eb10f9889aa482b57792f4cb001aa2dL99", "url": "https://github.com/netty/netty/pull/10248#discussion_r420208301", "createdAt": "2020-05-05T15:40:51Z", "author": {"login": "johnou"}, "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketProtocolHandler.java", "diffHunk": "@@ -110,13 +111,12 @@ public void write(final ChannelHandlerContext ctx, Object msg, ChannelPromise pr\n         if (closeSent != null) {\n             ReferenceCountUtil.release(msg);\n             promise.setFailure(new ClosedChannelException());\n-            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "652df83821e4be57955769b3dbafedbc1a73b33b", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/652df83821e4be57955769b3dbafedbc1a73b33b", "committedDate": "2020-05-05T16:05:27Z", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/3aaea4874ce4659709dcd53b9a496502b8a37491", "committedDate": "2020-05-05T10:11:57Z", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240"}, "afterCommit": {"oid": "652df83821e4be57955769b3dbafedbc1a73b33b", "author": {"user": {"login": "normanmaurer", "name": "Norman Maurer"}}, "url": "https://github.com/netty/netty/commit/652df83821e4be57955769b3dbafedbc1a73b33b", "committedDate": "2020-05-05T16:05:27Z", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTQwMDAx", "url": "https://github.com/netty/netty/pull/10248#pullrequestreview-405940001", "createdAt": "2020-05-05T16:09:43Z", "commit": {"oid": "652df83821e4be57955769b3dbafedbc1a73b33b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 281, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}