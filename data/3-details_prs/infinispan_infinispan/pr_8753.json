{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzYyOTI3", "number": 8753, "title": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder", "bodyText": "https://issues.redhat.com/browse/ISPN-12396", "createdAt": "2020-10-07T16:10:01Z", "url": "https://github.com/infinispan/infinispan/pull/8753", "merged": true, "mergeCommit": {"oid": "92e291ce2f677a0d806dc3b4294326fd73040e57"}, "closed": true, "closedAt": "2021-03-24T07:59:52Z", "author": {"login": "gustavonalle"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQcV2hABqjM4NTM5MTQ3ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeEtFb2gBqjQ0ODMxMzU0MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3112c19c6c6d9c3845db6198733ab38d8d3d8f26", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/3112c19c6c6d9c3845db6198733ab38d8d3d8f26", "committedDate": "2020-10-07T16:08:57Z", "message": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder"}, "afterCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/2229f6ff3fb351838157a54bb7b62967442fe087", "committedDate": "2020-10-08T07:20:59Z", "message": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzU0ODQy", "url": "https://github.com/infinispan/infinispan/pull/8753#pullrequestreview-505754842", "createdAt": "2020-10-09T14:59:59Z", "commit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNDo1OTo1OVrOHfNmNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNzozMzozOFrOHfyWRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ5MDY3OA==", "bodyText": "I suggest \"will be removed in version 15.0\" or similar, here and in the other deprecated classes.\nIdeally a JIRA linked in ISPN-12158 as well.", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r502490678", "createdAt": "2020-10-09T14:59:59Z", "author": {"login": "danberindei"}, "path": "commons/all/src/main/java/org/infinispan/commons/dataconversion/Encoder.java", "diffHunk": "@@ -4,7 +4,9 @@\n  * Used to convert data between read/write format and storage format.\n  *\n  * @since 9.1\n+ * @deprecated Since 12.0, use {@link Transcoder} for all data conversions instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5MDk1OA==", "bodyText": "This sounds dangerous @gustavonalle. Since it supports application/x-java-object, users will expect it to work for their custom objects as well. But decompress always produces a String, so users won't be able to get back any object that's not a String.\nI suggest removing GzipTranscoder.", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r503090958", "createdAt": "2020-10-12T07:29:51Z", "author": {"login": "danberindei"}, "path": "core/src/test/java/org/infinispan/dataconversion/GzipTranscoder.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.infinispan.dataconversion;\n+\n+import static org.infinispan.commons.dataconversion.MediaType.APPLICATION_OBJECT;\n+import static org.infinispan.dataconversion.Gzip.compress;\n+import static org.infinispan.dataconversion.Gzip.decompress;\n+\n+import org.infinispan.commons.dataconversion.MediaType;\n+import org.infinispan.commons.dataconversion.OneToManyTranscoder;\n+\n+/**\n+ * @since 12.0\n+ */\n+public class GzipTranscoder extends OneToManyTranscoder {\n+   public static final String APPLICATION_GZIP_TYPE = \"application/gzip\";\n+   public static final MediaType APPLICATION_GZIP = MediaType.fromString(APPLICATION_GZIP_TYPE);\n+\n+   public GzipTranscoder() {\n+      super(APPLICATION_GZIP, APPLICATION_OBJECT);\n+   }\n+\n+   @Override\n+   public Object transcode(Object content, MediaType contentType, MediaType destinationType) {\n+      if (destinationType.match(APPLICATION_GZIP)) {\n+         return compress(content.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5MjA4NQ==", "bodyText": "The comment seems out of date", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r503092085", "createdAt": "2020-10-12T07:32:03Z", "author": {"login": "danberindei"}, "path": "integrationtests/endpoints-interop-it/src/test/java/org/infinispan/it/endpoints/ReplEmbeddedRestHotRodTest.java", "diffHunk": "@@ -61,7 +60,7 @@ public void testEmbeddedPutRestHotRodGet() {\n       final String key = \"2\";\n \n       // 1. Put with Embedded, bypassing all encodings\n-      Cache cache = cacheFactory2.getEmbeddedCache().getAdvancedCache().withEncoding(IdentityEncoder.class);\n+      Cache cache = cacheFactory2.getEmbeddedCache().getAdvancedCache();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5MjgwNw==", "bodyText": "This method is supposed to test the encoder itself, so I think it shouldn't change for now.", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r503092807", "createdAt": "2020-10-12T07:33:38Z", "author": {"login": "danberindei"}, "path": "jboss-marshalling/src/test/java/org/infinispan/jboss/marshalling/dataconversion/DataConversionTest.java", "diffHunk": "@@ -8,24 +9,20 @@\n \n import org.infinispan.AdvancedCache;\n import org.infinispan.Cache;\n+import org.infinispan.commons.dataconversion.MediaType;\n import org.infinispan.configuration.cache.ConfigurationBuilder;\n-import org.infinispan.factories.GlobalComponentRegistry;\n import org.infinispan.jboss.marshalling.commons.GenericJBossMarshaller;\n-import org.infinispan.marshall.core.EncoderRegistry;\n import org.infinispan.test.CacheManagerCallable;\n import org.infinispan.test.data.Person;\n import org.testng.annotations.Test;\n \n @Test(groups = \"functional\", testName = \"marshall.jboss.DataConversionTest\")\n public class DataConversionTest extends org.infinispan.dataconversion.DataConversionTest {\n+   private final GenericJBossMarshaller marshaller = new GenericJBossMarshaller();\n \n    @Test\n    public void testObjectEncoder() {\n-      GenericJbossMarshallerEncoder encoder = new GenericJbossMarshallerEncoder(org.infinispan.dataconversion.DataConversionTest.class.getClassLoader());\n-      withCacheManager(new CacheManagerCallable(\n-            createCacheManager(new ConfigurationBuilder())) {\n-\n-         GenericJBossMarshaller marshaller = new GenericJBossMarshaller();\n+      withCacheManager(new CacheManagerCallable(createCacheManager(new ConfigurationBuilder())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2229f6ff3fb351838157a54bb7b62967442fe087", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/2229f6ff3fb351838157a54bb7b62967442fe087", "committedDate": "2020-10-08T07:20:59Z", "message": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder"}, "afterCommit": {"oid": "0fc21627ed0b05f62ab2b0d74052fce758903af5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/0fc21627ed0b05f62ab2b0d74052fce758903af5", "committedDate": "2020-10-12T10:21:57Z", "message": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODEyNzE1", "url": "https://github.com/infinispan/infinispan/pull/8753#pullrequestreview-514812715", "createdAt": "2020-10-22T14:48:50Z", "commit": {"oid": "0fc21627ed0b05f62ab2b0d74052fce758903af5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo0ODo1MFrOHmlosg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDo1MzowOVrOHml2Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyNDU2Mg==", "bodyText": "Should we use withMediaType ? Also should we have a withMediaType(MediaType)  method? I noticed we only have the two argument one.", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r510224562", "createdAt": "2020-10-22T14:48:50Z", "author": {"login": "wburns"}, "path": "core/src/test/java/org/infinispan/dataconversion/DataConversionTest.java", "diffHunk": "@@ -174,7 +173,7 @@ public void call() {\n             Cache<String, Person> cache = cm.getCache();\n             cm.getClassAllowList().addClasses(Person.class);\n             // Obtain cache with custom valueEncoder\n-            Cache storeMarshalled = cache.getAdvancedCache().withEncoding(JavaSerializationEncoder.class);\n+            Cache storeMarshalled = cache.getAdvancedCache();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fc21627ed0b05f62ab2b0d74052fce758903af5"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyODAyNg==", "bodyText": "I must have missed this part. Why would we preclude someone doing this if they have a transcoder that would support it?", "url": "https://github.com/infinispan/infinispan/pull/8753#discussion_r510228026", "createdAt": "2020-10-22T14:53:09Z", "author": {"login": "wburns"}, "path": "documentation/src/main/asciidoc/topics/upgrading.adoc", "diffHunk": "@@ -2,9 +2,12 @@\n \n == Encoding\n \n-Conversions of cache data between `application/x-java-object` and `application/json` are deprecated and will be removed\n+* Conversions of cache data between `application/x-java-object` and `application/json` are deprecated and will be removed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fc21627ed0b05f62ab2b0d74052fce758903af5"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fc21627ed0b05f62ab2b0d74052fce758903af5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/0fc21627ed0b05f62ab2b0d74052fce758903af5", "committedDate": "2020-10-12T10:21:57Z", "message": "ISPN-12396 Deprecate org.infinispan.commons.dataconversion.Encoder"}, "afterCommit": {"oid": "32ca59fae7dde943e5df0833d0cd13ab62a80ef5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/32ca59fae7dde943e5df0833d0cd13ab62a80ef5", "committedDate": "2021-03-12T13:39:54Z", "message": "ISPN-12396 Deprecate Encoder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE2NTM4NTg1", "url": "https://github.com/infinispan/infinispan/pull/8753#pullrequestreview-616538585", "createdAt": "2021-03-19T15:41:09Z", "commit": {"oid": "32ca59fae7dde943e5df0833d0cd13ab62a80ef5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d27f751f34322c285fc933f4fce2c5c92eb98a1f", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/d27f751f34322c285fc933f4fce2c5c92eb98a1f", "committedDate": "2021-03-19T16:15:01Z", "message": "ISPN-12396 Deprecate Encoder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32ca59fae7dde943e5df0833d0cd13ab62a80ef5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/32ca59fae7dde943e5df0833d0cd13ab62a80ef5", "committedDate": "2021-03-12T13:39:54Z", "message": "ISPN-12396 Deprecate Encoder"}, "afterCommit": {"oid": "d27f751f34322c285fc933f4fce2c5c92eb98a1f", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/d27f751f34322c285fc933f4fce2c5c92eb98a1f", "committedDate": "2021-03-19T16:15:01Z", "message": "ISPN-12396 Deprecate Encoder"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 361, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}