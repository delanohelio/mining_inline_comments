{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTYzNzA0", "number": 8430, "title": "Server Testsuite changes for Native Image", "bodyText": "https://issues.redhat.com/browse/ISPN-11850\nhttps://issues.redhat.com/browse/ISPN-11936\nhttps://issues.redhat.com/browse/ISPN-11948\nISPN-11850 should remain open as there are still tests that won't work with the CONTAINER driver. These will be fixed at a later date.", "createdAt": "2020-06-04T16:47:44Z", "url": "https://github.com/infinispan/infinispan/pull/8430", "merged": true, "mergeCommit": {"oid": "b23ab3509ab93be12d820fdadc5be350fb772cca"}, "closed": true, "closedAt": "2020-06-09T13:55:53Z", "author": {"login": "ryanemerson"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoDZisAFqTQyNDc3MTE1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpisLMABqjM0MjQyNDEwMTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NzcxMTU4", "url": "https://github.com/infinispan/infinispan/pull/8430#pullrequestreview-424771158", "createdAt": "2020-06-04T19:40:40Z", "commit": {"oid": "c3e4422e0fea726ee83c0609f846c68f98321390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxOTo0MDo0MFrOGfVI_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxOTo0MDo0MFrOGfVI_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUwNTQwNw==", "bodyText": "Interesting. Makes me think we should support env and property replacement in batches", "url": "https://github.com/infinispan/infinispan/pull/8430#discussion_r435505407", "createdAt": "2020-06-04T19:40:40Z", "author": {"login": "tristantarrant"}, "path": "server/tests/src/test/java/org/infinispan/server/cli/CliIT.java", "diffHunk": "@@ -94,25 +101,46 @@ public void testCliInteractive() {\n    }\n \n    @Test\n-   public void testCliBatch() {\n-      AeshTestShell shell = new AeshTestShell();\n-      CLI.main(shell, new String[]{\"-f\", this.getClass().getResource(\"/cli/batch.cli\").getPath()});\n-      shell.assertContains(\"Hi CLI\");\n-      shell.assertContains(\"batch1\");\n+   public void testCliBatch() throws IOException {\n+      // Create batch file programmatically so that we can supply the correct server address for the connect command:\n+      Path testPath = Paths.get(CommonsTestingUtil.tmpDirectory(CliIT.class));\n+      testPath.toFile().mkdirs();\n+      try {\n+         Path batchFilePath = testPath.resolve(\"batch.cli\").toAbsolutePath();\n+         try (PrintWriter out = new PrintWriter(Files.newBufferedWriter(batchFilePath))) {\n+            out.println(\"echo Hi CLI\");\n+            out.printf(\"connect %s:11222\\n\", hostAddress());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3e4422e0fea726ee83c0609f846c68f98321390"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3e4422e0fea726ee83c0609f846c68f98321390", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/c3e4422e0fea726ee83c0609f846c68f98321390", "committedDate": "2020-06-04T16:45:12Z", "message": "ISPN-11948 Exclude infinispan-jboss-marshalling from server/testdriver"}, "afterCommit": {"oid": "d5087706d12871c2b67b70dd8b7912f8b92d4fd5", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/d5087706d12871c2b67b70dd8b7912f8b92d4fd5", "committedDate": "2020-06-05T12:00:49Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjM4MDU0", "url": "https://github.com/infinispan/infinispan/pull/8430#pullrequestreview-425238054", "createdAt": "2020-06-05T12:04:00Z", "commit": {"oid": "d5087706d12871c2b67b70dd8b7912f8b92d4fd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMjowNDowMFrOGfrwZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMjowNDowMFrOGfrwZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg3NTk0Mw==", "bodyText": "@tristantarrant I couldn't think of a better way of accomplishing this whilst keeping infinispan-jboss-marshalling on the classpath and making it so by default the tests utilise ProtoStream. In 12 we should probably remove the automatic configuration of GenericJbossMarshaller when infinispan-jboss-marshalling is present on the classpath.", "url": "https://github.com/infinispan/infinispan/pull/8430#discussion_r435875943", "createdAt": "2020-06-05T12:04:00Z", "author": {"login": "ryanemerson"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/api/HotRodTestClientDriver.java", "diffHunk": "@@ -31,18 +33,32 @@ public HotRodTestClientDriver(TestServer testServer, TestClient testClient) {\n          // Configure admin user by default\n          builder.security().authentication().username(TestUser.ADMIN.getUser()).password(TestUser.ADMIN.getPassword());\n       }\n-\n       this.clientConfiguration = builder;\n    }\n \n    /**\n-    * Provide a custom client configuration to connect to the server\n+    * Provide a custom client configuration to connect to the server. This method always overrides the configured marshaller\n+    * so if a marshaller other than the default {@link ProtoStreamMarshaller} is required, a subsequent call to\n+    * {@link #withMarshaller(Class)} is required.\n     *\n     * @param clientConfiguration\n     * @return the current {@link HotRodTestClientDriver} instance with the client configuration override\n     */\n    public HotRodTestClientDriver withClientConfiguration(ConfigurationBuilder clientConfiguration) {\n       this.clientConfiguration = clientConfiguration;\n+      // Explicitly configure the ProtoStreamMarshaller as the jboss-marshalling module is on the classpath\n+      this.clientConfiguration.marshaller(ProtoStreamMarshaller.class);\n+      return this;\n+   }\n+\n+   /**\n+    * The {@link Marshaller} to be used by the client.\n+    *\n+    * @param marshallerClass\n+    * @return the current {@link HotRodTestClientDriver} instance with the Marshaller configuration override\n+    */\n+   public HotRodTestClientDriver withMarshaller(Class<? extends Marshaller> marshallerClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5087706d12871c2b67b70dd8b7912f8b92d4fd5"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5087706d12871c2b67b70dd8b7912f8b92d4fd5", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/d5087706d12871c2b67b70dd8b7912f8b92d4fd5", "committedDate": "2020-06-05T12:00:49Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}, "afterCommit": {"oid": "cd05d3ac43d35fd025cb2394767f2b3c5678cb1c", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/cd05d3ac43d35fd025cb2394767f2b3c5678cb1c", "committedDate": "2020-06-05T13:15:43Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd05d3ac43d35fd025cb2394767f2b3c5678cb1c", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/cd05d3ac43d35fd025cb2394767f2b3c5678cb1c", "committedDate": "2020-06-05T13:15:43Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}, "afterCommit": {"oid": "9b411a91f7fd35414c86404afb579f97badbee42", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/9b411a91f7fd35414c86404afb579f97badbee42", "committedDate": "2020-06-05T16:18:19Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b411a91f7fd35414c86404afb579f97badbee42", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/9b411a91f7fd35414c86404afb579f97badbee42", "committedDate": "2020-06-05T16:18:19Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}, "afterCommit": {"oid": "6a3d8c1a38c5f24c02136a20986b51b92f69a632", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/6a3d8c1a38c5f24c02136a20986b51b92f69a632", "committedDate": "2020-06-08T09:12:37Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9538d3b959327e9fc310d18539401566a8f3b0a5", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/9538d3b959327e9fc310d18539401566a8f3b0a5", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11850 Server tests updated to work with the CONTAINER driver\n\nThe following tests still fail in CONTAINER mode:\n- RollingUpgradeIT\n- AuthenticationKerberosIT\n- AuthenticationKeyCloakIT\n- AuthorizationKerberosIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ff568af70ed2f2bcc7f87272efebbe2e52f1a6", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/f3ff568af70ed2f2bcc7f87272efebbe2e52f1a6", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11936 Allow configuration files to be copied from Jars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f67e8196e191b7c8ffacd8e4156037bae4c296af", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/f67e8196e191b7c8ffacd8e4156037bae4c296af", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11936 Don't assert on heap.init as not present in native build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0146cafc8c75e609a2344c804d476ad0c8970b0d", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/0146cafc8c75e609a2344c804d476ad0c8970b0d", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a3d8c1a38c5f24c02136a20986b51b92f69a632", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/6a3d8c1a38c5f24c02136a20986b51b92f69a632", "committedDate": "2020-06-08T09:12:37Z", "message": "ISPN-11948 server/tests HotRod clients should utilise the ProtoStreamMarshaller"}, "afterCommit": {"oid": "d9382e2fc2c7e367872bbb59c9f4b2a9979b6c47", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/d9382e2fc2c7e367872bbb59c9f4b2a9979b6c47", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11850 RollingUpgradeIT now works with the EMBEDDED and CONTAINER driver\n\nThreadLeaks removed from the tests as the RestClient instances are now\nclosed after the test has completed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30823b4c1454752c1ca7fbc50ad7895a246de3bb", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/30823b4c1454752c1ca7fbc50ad7895a246de3bb", "committedDate": "2020-06-09T10:41:50Z", "message": "ISPN-11850 RollingUpgradeIT now works with the EMBEDDED and CONTAINER driver\n\nThreadLeaks removed from the tests as the RestClient instances are now\nclosed after the test has completed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9382e2fc2c7e367872bbb59c9f4b2a9979b6c47", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/d9382e2fc2c7e367872bbb59c9f4b2a9979b6c47", "committedDate": "2020-06-09T09:48:21Z", "message": "ISPN-11850 RollingUpgradeIT now works with the EMBEDDED and CONTAINER driver\n\nThreadLeaks removed from the tests as the RestClient instances are now\nclosed after the test has completed."}, "afterCommit": {"oid": "30823b4c1454752c1ca7fbc50ad7895a246de3bb", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/30823b4c1454752c1ca7fbc50ad7895a246de3bb", "committedDate": "2020-06-09T10:41:50Z", "message": "ISPN-11850 RollingUpgradeIT now works with the EMBEDDED and CONTAINER driver\n\nThreadLeaks removed from the tests as the RestClient instances are now\nclosed after the test has completed."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 594, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}