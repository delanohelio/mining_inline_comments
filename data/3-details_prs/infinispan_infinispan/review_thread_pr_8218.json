{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MjEzNzI2", "number": 8218, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo1NTozMlrOD0E-ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzowNTozMVrOD2hVzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTM0MDUzOnYy", "diffSide": "RIGHT", "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo1NTozMlrOGI1mPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjoyMzoyMVrOGKmfRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ==", "bodyText": "It still need to read somehow the configured Index, since it is deprecated, not removed. Index.PRIMARY_OWNER should probably throw an exception since it is not a safe option for non-shared indexes,and we removed all shared index managers.  When configured, Index.NONE and Index.ALL should be respected over the automatic detection", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411919935", "createdAt": "2020-04-21T06:55:32Z", "author": {"login": "gustavonalle"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk0MzgzNQ==", "bodyText": "It still need to read somehow the configured Index, since it is deprecated, not removed. Index.PRIMARY_OWNER should probably throw an exception since it is not a safe option for non-shared indexes,and we removed all shared index managers. When configured, Index.NONE and Index.ALL should be respected over the automatic detection\n\nyes, I've commented about that -> #8204 (comment)", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411943835", "createdAt": "2020-04-21T07:34:19Z", "author": {"login": "anistor"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk0NjczNQ==", "bodyText": "I still insist on respecting the config:\n\nIndex.NONE -> don't index, log deprecated WARN\nIndex.PRIMARY_OWNER -> throw error\nIndex.ALL -> do nothing, log deprecated WARN", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411946735", "createdAt": "2020-04-21T07:38:37Z", "author": {"login": "gustavonalle"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk0OTgxMw==", "bodyText": "I'd be also OK with changing the current deprecation WARN logs to mention:  \"Index\" config is deprecated and ignored, please check the upgrade guide", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411949813", "createdAt": "2020-04-21T07:42:58Z", "author": {"login": "gustavonalle"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3Mjc0Ng==", "bodyText": "I'm perfectly fine respecting the config, but your \"ISPN-11241 Deprecate Indexing mode\"  basically obliterated that, and was not sure if it was a mistake or intentional :) And the later removals made it worse, turning some code into dead code. So we need to put something back there.", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411972746", "createdAt": "2020-04-21T08:16:14Z", "author": {"login": "anistor"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4NzI5Ng==", "bodyText": "It was my mistake. So why don't we settle for this PR + enriching the WARN that those config are ignored?", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r411987296", "createdAt": "2020-04-21T08:36:30Z", "author": {"login": "gustavonalle"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2OTU0Mw==", "bodyText": "I've done this, in first and second commit. And added several more commits that are ISPN-11241 floow-up", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r413769543", "createdAt": "2020-04-23T12:23:21Z", "author": {"login": "anistor"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -134,8 +133,7 @@ private void createQueryInterceptorIfNeeded(ComponentRegistry cr, Configuration\n       }\n \n       ConcurrentMap<GlobalTransaction, Map<Object, Object>> txOldValues = new ConcurrentHashMap<>();\n-      IndexModificationStrategy indexingStrategy = IndexModificationStrategy.configuredStrategy(searchIntegrator, cfg);\n-      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, indexingStrategy, txOldValues, cache);\n+      QueryInterceptor queryInterceptor = new QueryInterceptor(searchIntegrator, keyTransformationHandler, txOldValues, cache);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxOTkzNQ=="}, "originalCommit": {"oid": "5ee4c6e6eaa3dac7f6d2e30f8082122fb65cdb0f"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NDk1OTUxOnYy", "diffSide": "RIGHT", "path": "query/src/main/java/org/infinispan/query/backend/QueryInterceptor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzowNTozMVrOGMT5zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTo1MDo1NVrOGMalEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU2MjE5MA==", "bodyText": "Can we remove unused parameters from here @gustavonalle ?", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r415562190", "createdAt": "2020-04-27T07:05:31Z", "author": {"login": "anistor"}, "path": "query/src/main/java/org/infinispan/query/backend/QueryInterceptor.java", "diffHunk": "@@ -138,19 +135,18 @@ public void prepareForStopping() {\n       stopping.set(true);\n    }\n \n+   //todo [anistor] parameter 'value' is never used", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "566824ccabf36a8e0725982603731cc95ec1992c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3MTU3MQ==", "bodyText": "I'll remove that then and push an update now to have a new CI run while I work on the docs aspect of it.", "url": "https://github.com/infinispan/infinispan/pull/8218#discussion_r415671571", "createdAt": "2020-04-27T09:50:55Z", "author": {"login": "anistor"}, "path": "query/src/main/java/org/infinispan/query/backend/QueryInterceptor.java", "diffHunk": "@@ -138,19 +135,18 @@ public void prepareForStopping() {\n       stopping.set(true);\n    }\n \n+   //todo [anistor] parameter 'value' is never used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU2MjE5MA=="}, "originalCommit": {"oid": "566824ccabf36a8e0725982603731cc95ec1992c"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4286, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}