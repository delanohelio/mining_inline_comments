{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Mjg5NTMw", "number": 8922, "title": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses", "bodyText": "https://issues.redhat.com/browse/ISPN-12561\nCheck the response body contents.\nReading the body automatically closes the response.", "createdAt": "2020-12-08T08:53:12Z", "url": "https://github.com/infinispan/infinispan/pull/8922", "merged": true, "mergeCommit": {"oid": "5cdb015fd031e8afb6cb968bc97e0ed629e1ef6b"}, "closed": true, "closedAt": "2020-12-15T17:29:05Z", "author": {"login": "danberindei"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkNYkxgFqTU0NzQ0NzI3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlEFBGABqjQwOTkyNTYwMDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDQ3Mjc4", "url": "https://github.com/infinispan/infinispan/pull/8922#pullrequestreview-547447278", "createdAt": "2020-12-08T17:10:39Z", "commit": {"oid": "10b8d6579cc8c82871352c449fc172a2638557da"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNzoxMDozOVrOIBqe0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNzoxMjoyNFrOIBqlvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNTUwNg==", "bodyText": "Should we do an assertNotNull here? That way it won't throw a NPE later.", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538615506", "createdAt": "2020-12-08T17:10:39Z", "author": {"login": "wburns"}, "path": "server/rest/src/test/java/org/infinispan/rest/assertion/JsonAssertion.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.infinispan.rest.assertion;\n+\n+import static org.testng.AssertJUnit.assertEquals;\n+import static org.testng.AssertJUnit.assertNull;\n+\n+import org.infinispan.commons.dataconversion.internal.Json;\n+\n+/**\n+ * Assertions on JSON contents.\n+ *\n+ * @author Dan Berindei\n+ * @since 12\n+ */\n+public class JsonAssertion {\n+   private Json node;\n+\n+   public JsonAssertion(Json node) {\n+      this.node = node;\n+   }\n+\n+   public JsonAssertion hasProperty(String propertyName) {\n+      return new JsonAssertion(node.at(propertyName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10b8d6579cc8c82871352c449fc172a2638557da"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNjcyNg==", "bodyText": "This shouldn't be needed if we change hasProperty to check for not null.", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538616726", "createdAt": "2020-12-08T17:11:52Z", "author": {"login": "wburns"}, "path": "server/rest/src/test/java/org/infinispan/rest/assertion/JsonAssertion.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.infinispan.rest.assertion;\n+\n+import static org.testng.AssertJUnit.assertEquals;\n+import static org.testng.AssertJUnit.assertNull;\n+\n+import org.infinispan.commons.dataconversion.internal.Json;\n+\n+/**\n+ * Assertions on JSON contents.\n+ *\n+ * @author Dan Berindei\n+ * @since 12\n+ */\n+public class JsonAssertion {\n+   private Json node;\n+\n+   public JsonAssertion(Json node) {\n+      this.node = node;\n+   }\n+\n+   public JsonAssertion hasProperty(String propertyName) {\n+      return new JsonAssertion(node.at(propertyName));\n+   }\n+\n+   public JsonAssertion hasNoProperty(String propertyName) {\n+      assertNull(node.at(propertyName));\n+      return this;\n+   }\n+\n+   public void is(int value) {\n+      assertEquals(value, node.asInteger());\n+   }\n+\n+   public void is(String value) {\n+      assertEquals(value, node.asString());\n+   }\n+\n+   public void isNull() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10b8d6579cc8c82871352c449fc172a2638557da"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxNzI3OA==", "bodyText": "Use hasNoProperty instead?", "url": "https://github.com/infinispan/infinispan/pull/8922#discussion_r538617278", "createdAt": "2020-12-08T17:12:24Z", "author": {"login": "wburns"}, "path": "server/rest/src/test/java/org/infinispan/rest/assertion/ResponseAssertion.java", "diffHunk": "@@ -295,8 +295,12 @@ public ResponseAssertion expiresAfter(int expireDuration) {\n    }\n \n    public ResponseAssertion hasNoErrors() {\n-      Json node = Json.read(response.getBody());\n-      Assertions.assertThat(node.at(\"error\").isNull()).isTrue();\n+      hasJson().hasProperty(\"error\").isNull();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10b8d6579cc8c82871352c449fc172a2638557da"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10b8d6579cc8c82871352c449fc172a2638557da", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/10b8d6579cc8c82871352c449fc172a2638557da", "committedDate": "2020-12-08T08:51:19Z", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response."}, "afterCommit": {"oid": "91265f36ca8ccc9b47b853c4c4526dd35388ede8", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/91265f36ca8ccc9b47b853c4c4526dd35388ede8", "committedDate": "2020-12-11T06:22:04Z", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "committedDate": "2020-12-11T08:57:21Z", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91265f36ca8ccc9b47b853c4c4526dd35388ede8", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/91265f36ca8ccc9b47b853c4c4526dd35388ede8", "committedDate": "2020-12-11T06:22:04Z", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response."}, "afterCommit": {"oid": "4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/4ffdee7e9f97fcb1ccd26da1c678f1386703f66e", "committedDate": "2020-12-11T08:57:21Z", "message": "ISPN-12561 CacheV2ResourceTest does not close RestClient responses\n\nCheck the response body contents.\nReading the body automatically closes the response."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}