{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MDUwMjEy", "number": 7902, "title": "ISPN-11280 More ConditionFuture updates", "bodyText": "https://issues.redhat.com/browse/ISPN-11280\nApply #7853 feedback", "createdAt": "2020-02-17T10:12:09Z", "url": "https://github.com/infinispan/infinispan/pull/7902", "merged": true, "mergeCommit": {"oid": "4d1ce10c92b0f4e8c3d1dabae45c791d35154076"}, "closed": true, "closedAt": "2020-02-18T17:03:52Z", "author": {"login": "danberindei"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFLzx6gFqTM1OTY3MjcyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFf_VGABqjMwNDY3MDM2NjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjcyNzIy", "url": "https://github.com/infinispan/infinispan/pull/7902#pullrequestreview-359672722", "createdAt": "2020-02-17T11:38:05Z", "commit": {"oid": "8f7ef234f5ed4467a3d002eadeb82df69cd960b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTozODowNVrOFqhc0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTozODo1MlrOFqheKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzMjU2MQ==", "bodyText": "why not use new ArrayList<>(futures.values());", "url": "https://github.com/infinispan/infinispan/pull/7902#discussion_r380132561", "createdAt": "2020-02-17T11:38:05Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/util/concurrent/ConditionFuture.java", "diffHunk": "@@ -100,17 +100,19 @@ public void updateAsync(T value, Executor executor) {\n       try {\n          executor.execute(() -> checkConditions(value));\n       } catch (Throwable t) {\n-         List<CompletableFuture<?>> completed;\n-         synchronized (futures) {\n-            completed = new ArrayList<>(futures.size());\n-            for (Data data : futures.values()) {\n-               data.cancelFuture.cancel(false);\n-               completed.add(data);\n-            }\n-         }\n-         for (CompletableFuture<?> future : completed) {\n-            future.completeExceptionally(t);\n-         }\n+         completeAllExceptionally(t);\n+      }\n+   }\n+\n+   private void completeAllExceptionally(Throwable t) {\n+      List<Data> completed;\n+      synchronized (futures) {\n+         completed = new ArrayList<>(futures.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7ef234f5ed4467a3d002eadeb82df69cd960b1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzMjkwNA==", "bodyText": "unused import.", "url": "https://github.com/infinispan/infinispan/pull/7902#discussion_r380132904", "createdAt": "2020-02-17T11:38:52Z", "author": {"login": "pruivo"}, "path": "core/src/test/java/org/infinispan/test/Exceptions.java", "diffHunk": "@@ -1,6 +1,8 @@\n package org.infinispan.test;\n \n import java.util.concurrent.Callable;\n+import java.util.concurrent.CompletionException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7ef234f5ed4467a3d002eadeb82df69cd960b1"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f7ef234f5ed4467a3d002eadeb82df69cd960b1", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/8f7ef234f5ed4467a3d002eadeb82df69cd960b1", "committedDate": "2020-02-15T10:28:10Z", "message": "ISPN-11280 More ConditionFuture updates"}, "afterCommit": {"oid": "b3f537aebdbf3eb313c5dfa78df251d3c5dd3ef9", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/b3f537aebdbf3eb313c5dfa78df251d3c5dd3ef9", "committedDate": "2020-02-17T15:32:31Z", "message": "ISPN-11280 More ConditionFuture updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dd2907082e170625b2ff9ed7e1a815fd82a405a", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/5dd2907082e170625b2ff9ed7e1a815fd82a405a", "committedDate": "2020-02-18T11:08:49Z", "message": "ISPN-11280 More ConditionFuture updates"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3f537aebdbf3eb313c5dfa78df251d3c5dd3ef9", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/b3f537aebdbf3eb313c5dfa78df251d3c5dd3ef9", "committedDate": "2020-02-17T15:32:31Z", "message": "ISPN-11280 More ConditionFuture updates"}, "afterCommit": {"oid": "5dd2907082e170625b2ff9ed7e1a815fd82a405a", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/5dd2907082e170625b2ff9ed7e1a815fd82a405a", "committedDate": "2020-02-18T11:08:49Z", "message": "ISPN-11280 More ConditionFuture updates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1164, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}