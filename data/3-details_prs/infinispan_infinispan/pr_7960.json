{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNDQzOTEx", "number": 7960, "title": "ISPN-11386 Use blocking thread pool in Persistent preload", "bodyText": "https://issues.redhat.com/browse/ISPN-11386", "createdAt": "2020-02-26T18:46:18Z", "url": "https://github.com/infinispan/infinispan/pull/7960", "merged": true, "mergeCommit": {"oid": "fdfd108aa92b8df2cdafee4c111e0521126da20b"}, "closed": true, "closedAt": "2020-02-27T14:40:16Z", "author": {"login": "pruivo"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIMYq4gFqTM2NTIwMjc3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIXqJsABqjMwNzcwMDI5NTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjAyNzc1", "url": "https://github.com/infinispan/infinispan/pull/7960#pullrequestreview-365202775", "createdAt": "2020-02-26T20:03:16Z", "commit": {"oid": "598f0a8dc86f64675255d080c1cc7255091ac65f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMDowMzoxNlrOFu6SXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMDowMzoxNlrOFu6SXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDczMzc5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .observeOn(blockingScheduler)\n          \n          \n            \n                        .doOnNext(me -> preloadKey(flaggedCache, me))\n          \n          \n            \n                        .doOnNext(me -> preloadKey(flaggedCache, me))\n          \n          \n            \n                        .observeOn(nonBlockingScheduler)\n          \n      \n    \n    \n  \n\nWe already subscribe on the blockingScheduler below so there is no reason to invoke observeOn with the same value. We should really observe the completion on a non blocking thread since it is highly likely we may block on the completion in a blocking thread at some point.\nAnd technically it should do observeOn before hand if it isn't tx, but we can avoid that for now.\nWhile this change is fine with me, this really isn't a good idea to continue this on the blocking executor. This should really be done in a non blocking way if possible (ie. putAsync). I have logged https://issues.redhat.com/browse/ISPN-11387 to handle this better later when we can.", "url": "https://github.com/infinispan/infinispan/pull/7960#discussion_r384733791", "createdAt": "2020-02-26T20:03:16Z", "author": {"login": "wburns"}, "path": "core/src/main/java/org/infinispan/persistence/manager/PersistenceManagerImpl.java", "diffHunk": "@@ -376,7 +376,7 @@ public boolean isPreloaded() {\n       final AdvancedCache<Object, Object> flaggedCache = getCacheForStateInsertion();\n       return Flowable.fromPublisher(preloadCl.entryPublisher(null, true, true))\n             .take(maxEntries)\n-            .observeOn(nonBlockingScheduler)\n+            .observeOn(blockingScheduler)\n             .doOnNext(me -> preloadKey(flaggedCache, me))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "598f0a8dc86f64675255d080c1cc7255091ac65f"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "598f0a8dc86f64675255d080c1cc7255091ac65f", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/598f0a8dc86f64675255d080c1cc7255091ac65f", "committedDate": "2020-02-26T18:45:25Z", "message": "ISPN-11386 Use blocking thread pool in Persistent preload"}, "afterCommit": {"oid": "65f979cbdf85ee695f07fb10b9c9096434133a56", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/65f979cbdf85ee695f07fb10b9c9096434133a56", "committedDate": "2020-02-26T21:11:37Z", "message": "ISPN-11386 Use blocking thread pool in Persistent preload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45a61f6c84e702410a545a141cb86bc75b1f8ef6", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/45a61f6c84e702410a545a141cb86bc75b1f8ef6", "committedDate": "2020-02-27T09:11:09Z", "message": "ISPN-11386 Use blocking thread pool in Persistent preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65f979cbdf85ee695f07fb10b9c9096434133a56", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/65f979cbdf85ee695f07fb10b9c9096434133a56", "committedDate": "2020-02-26T21:11:37Z", "message": "ISPN-11386 Use blocking thread pool in Persistent preload"}, "afterCommit": {"oid": "45a61f6c84e702410a545a141cb86bc75b1f8ef6", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/45a61f6c84e702410a545a141cb86bc75b1f8ef6", "committedDate": "2020-02-27T09:11:09Z", "message": "ISPN-11386 Use blocking thread pool in Persistent preload"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1217, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}