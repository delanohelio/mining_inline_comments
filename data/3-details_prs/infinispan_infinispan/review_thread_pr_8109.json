{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MTE4NTM5", "number": 8109, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo0NToxNFrODsKvPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyNToyNFrODuepVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjM5ODcxOnYy", "diffSide": "RIGHT", "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo0NToxNFrOF87vGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoxNjozOVrOF9Ah1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQzNzU5Mg==", "bodyText": "we want this ?", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r399437592", "createdAt": "2020-03-27T17:45:14Z", "author": {"login": "karesti"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -318,6 +329,16 @@ public void kill(int server) {\n       Exceptions.unchecked(() -> containers.get(server).execInContainer(INFINISPAN_SERVER_HOME + \"/bin/kill.sh\"));\n    }\n \n+   // TODO should this just replace stop?\n+   public void sigterm(int server) {\n+      GenericContainer container = containers.get(server);\n+      CountdownLatchLoggingConsumer latch = new CountdownLatchLoggingConsumer(1, SHUTDOWN_MESSAGE_REGEX);\n+      container.withLogConsumer(latch);\n+      Container.ExecResult result = Exceptions.unchecked(() -> container.execInContainer(INFINISPAN_SERVER_HOME + \"/bin/term.sh\"));\n+      System.out.printf(\"[%d] TERM %s\\n\", server, result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6bfc402b475da30df73a2b700bf4573f9123545"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUxNjExOQ==", "bodyText": "It's what we do in the pause and resume methods. Adding a log statement doesn't result in any output in the test logs for some reason.", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r399516119", "createdAt": "2020-03-27T20:16:39Z", "author": {"login": "ryanemerson"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -318,6 +329,16 @@ public void kill(int server) {\n       Exceptions.unchecked(() -> containers.get(server).execInContainer(INFINISPAN_SERVER_HOME + \"/bin/kill.sh\"));\n    }\n \n+   // TODO should this just replace stop?\n+   public void sigterm(int server) {\n+      GenericContainer container = containers.get(server);\n+      CountdownLatchLoggingConsumer latch = new CountdownLatchLoggingConsumer(1, SHUTDOWN_MESSAGE_REGEX);\n+      container.withLogConsumer(latch);\n+      Container.ExecResult result = Exceptions.unchecked(() -> container.execInContainer(INFINISPAN_SERVER_HOME + \"/bin/term.sh\"));\n+      System.out.printf(\"[%d] TERM %s\\n\", server, result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQzNzU5Mg=="}, "originalCommit": {"oid": "d6bfc402b475da30df73a2b700bf4573f9123545"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDM3NDUzOnYy", "diffSide": "RIGHT", "path": "server/runtime/src/main/server/bin/server.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOTo1ODo1OVrOF_kAVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNjowMjozMFrOGAbyoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5NDUxOQ==", "bodyText": "You have lost the visualvm.display.name", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r402194519", "createdAt": "2020-04-02T09:58:59Z", "author": {"login": "tristantarrant"}, "path": "server/runtime/src/main/server/bin/server.sh", "diffHunk": "@@ -11,52 +11,43 @@ DIRNAME=`dirname \"$0\"`\n . \"$DIRNAME/common.sh\"\n \n while true; do\n-   if [ \"x$LAUNCH_ISPN_IN_BACKGROUND\" = \"x\" ]; then\n-      # Execute the JVM in the foreground\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Dvisualvm.display.name=$PROCESS_NAME \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\"\n-      ISPN_STATUS=$?\n-   else\n-      # Execute the JVM in the background\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\" \"&\"\n-      ISPN_PID=$!\n-      # Trap common signals and relay them to the server process\n-      trap \"kill -HUP  $ISPN_PID\" HUP\n-      trap \"kill -TERM $ISPN_PID\" INT\n-      trap \"kill -QUIT $ISPN_PID\" QUIT\n-      trap \"kill -PIPE $ISPN_PID\" PIPE\n-      trap \"kill -TERM $ISPN_PID\" TERM\n-      if [ \"x$ISPN_PIDFILE\" != \"x\" ]; then\n-        echo $ISPN_PID > $ISPN_PIDFILE\n+   # Execute the JVM in the background\n+   eval \\\"$JAVA\\\" $JAVA_OPTS \\\n+      -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07c75513354f987ec7b71cf2c0e677ac8d891b4a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjIzNDEzMg==", "bodyText": "It seems it was never set when launching in the background. Updated \ud83d\udc4d", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r402234132", "createdAt": "2020-04-02T11:13:22Z", "author": {"login": "ryanemerson"}, "path": "server/runtime/src/main/server/bin/server.sh", "diffHunk": "@@ -11,52 +11,43 @@ DIRNAME=`dirname \"$0\"`\n . \"$DIRNAME/common.sh\"\n \n while true; do\n-   if [ \"x$LAUNCH_ISPN_IN_BACKGROUND\" = \"x\" ]; then\n-      # Execute the JVM in the foreground\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Dvisualvm.display.name=$PROCESS_NAME \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\"\n-      ISPN_STATUS=$?\n-   else\n-      # Execute the JVM in the background\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\" \"&\"\n-      ISPN_PID=$!\n-      # Trap common signals and relay them to the server process\n-      trap \"kill -HUP  $ISPN_PID\" HUP\n-      trap \"kill -TERM $ISPN_PID\" INT\n-      trap \"kill -QUIT $ISPN_PID\" QUIT\n-      trap \"kill -PIPE $ISPN_PID\" PIPE\n-      trap \"kill -TERM $ISPN_PID\" TERM\n-      if [ \"x$ISPN_PIDFILE\" != \"x\" ]; then\n-        echo $ISPN_PID > $ISPN_PIDFILE\n+   # Execute the JVM in the background\n+   eval \\\"$JAVA\\\" $JAVA_OPTS \\\n+      -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5NDUxOQ=="}, "originalCommit": {"oid": "07c75513354f987ec7b71cf2c0e677ac8d891b4a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEwODUxMw==", "bodyText": "@tristantarrant just curious, is anyone else using visualvm.display.name except for VisualVM, or is it a de-facto standard?", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r403108513", "createdAt": "2020-04-03T16:02:30Z", "author": {"login": "danberindei"}, "path": "server/runtime/src/main/server/bin/server.sh", "diffHunk": "@@ -11,52 +11,43 @@ DIRNAME=`dirname \"$0\"`\n . \"$DIRNAME/common.sh\"\n \n while true; do\n-   if [ \"x$LAUNCH_ISPN_IN_BACKGROUND\" = \"x\" ]; then\n-      # Execute the JVM in the foreground\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Dvisualvm.display.name=$PROCESS_NAME \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\"\n-      ISPN_STATUS=$?\n-   else\n-      # Execute the JVM in the background\n-      eval \\\"$JAVA\\\" $JAVA_OPTS \\\n-         -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\\n-         -Dinfinispan.server.home.path=\\\"\"$ISPN_HOME\"\\\" \\\n-         -classpath \\\"\"$CLASSPATH\"\\\" \"$LOADER_CLASS\" \"$MAIN_CLASS\" \"$ARGUMENTS\" \"&\"\n-      ISPN_PID=$!\n-      # Trap common signals and relay them to the server process\n-      trap \"kill -HUP  $ISPN_PID\" HUP\n-      trap \"kill -TERM $ISPN_PID\" INT\n-      trap \"kill -QUIT $ISPN_PID\" QUIT\n-      trap \"kill -PIPE $ISPN_PID\" PIPE\n-      trap \"kill -TERM $ISPN_PID\" TERM\n-      if [ \"x$ISPN_PIDFILE\" != \"x\" ]; then\n-        echo $ISPN_PID > $ISPN_PIDFILE\n+   # Execute the JVM in the background\n+   eval \\\"$JAVA\\\" $JAVA_OPTS \\\n+      -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5NDUxOQ=="}, "originalCommit": {"oid": "07c75513354f987ec7b71cf2c0e677ac8d891b4a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDM5NzU4OnYy", "diffSide": "RIGHT", "path": "lock/src/main/java/org/infinispan/lock/impl/manager/EmbeddedClusteredLockManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMDowNTo0MVrOF_kPXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMDowNTo0MVrOF_kPXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5ODM2NQ==", "bodyText": "Nitpicking: I'd put @Inject on the same line when there's no component name, and remove the empty lines.", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r402198365", "createdAt": "2020-04-02T10:05:41Z", "author": {"login": "danberindei"}, "path": "lock/src/main/java/org/infinispan/lock/impl/manager/EmbeddedClusteredLockManager.java", "diffHunk": "@@ -48,56 +50,76 @@\n    public static final String IS_LOCKED = \"isLocked\";\n \n    private final ConcurrentHashMap<String, ClusteredLock> locks = new ConcurrentHashMap<>();\n-   private final CompletableFuture<CacheHolder> cacheHolderFuture;\n    private final ClusteredLockManagerConfiguration config;\n-   private ScheduledExecutorService scheduledExecutorService;\n-   private Executor executor;\n+   private volatile boolean started = false;\n+\n+   @Inject", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07c75513354f987ec7b71cf2c0e677ac8d891b4a"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NDQwMjA4OnYy", "diffSide": "RIGHT", "path": "lock/src/main/java/org/infinispan/lock/impl/manager/EmbeddedClusteredLockManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMDowNzowNlrOF_kSZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMDowNzowNlrOF_kSZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5OTE0MA==", "bodyText": "BasicComponentRegistryImpl already logs component start/stop at trace level", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r402199140", "createdAt": "2020-04-02T10:07:06Z", "author": {"login": "danberindei"}, "path": "lock/src/main/java/org/infinispan/lock/impl/manager/EmbeddedClusteredLockManager.java", "diffHunk": "@@ -48,56 +50,76 @@\n    public static final String IS_LOCKED = \"isLocked\";\n \n    private final ConcurrentHashMap<String, ClusteredLock> locks = new ConcurrentHashMap<>();\n-   private final CompletableFuture<CacheHolder> cacheHolderFuture;\n    private final ClusteredLockManagerConfiguration config;\n-   private ScheduledExecutorService scheduledExecutorService;\n-   private Executor executor;\n+   private volatile boolean started = false;\n+\n+   @Inject\n+   EmbeddedCacheManager cacheManager;\n+\n+   @Inject @ComponentName(KnownComponentNames.TIMEOUT_SCHEDULE_EXECUTOR)\n+   ScheduledExecutorService scheduledExecutorService;\n+\n+   @Inject @ComponentName(KnownComponentNames.BLOCKING_EXECUTOR)\n+   Executor executor;\n \n    private AdvancedCache<ClusteredLockKey, ClusteredLockValue> cache;\n \n-   public EmbeddedClusteredLockManager(CompletableFuture<CacheHolder> cacheHolderFuture, ClusteredLockManagerConfiguration config) {\n-      this.cacheHolderFuture = cacheHolderFuture;\n+   public EmbeddedClusteredLockManager(ClusteredLockManagerConfiguration config) {\n       this.config = config;\n    }\n \n-   @Inject\n-   public void injectDep(@ComponentName(KnownComponentNames.TIMEOUT_SCHEDULE_EXECUTOR) ScheduledExecutorService scheduledExecutorService,\n-                         @ComponentName(KnownComponentNames.BLOCKING_EXECUTOR) Executor executor) {\n-      this.scheduledExecutorService = scheduledExecutorService;\n-      this.executor = executor;\n+   @Start\n+   public void start() {\n+      if (trace)\n+         log.trace(\"Starting EmbeddedClusteredLockManager\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07c75513354f987ec7b71cf2c0e677ac8d891b4a"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDIwNDIyOnYy", "diffSide": "RIGHT", "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTo1OTo1NlrOGAbstA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTo1OTo1NlrOGAbstA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEwNjk5Ng==", "bodyText": "I feel like this warrants a comment, I wouldn't expect query to depend on clustered-lock", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r403106996", "createdAt": "2020-04-03T15:59:56Z", "author": {"login": "danberindei"}, "path": "query/src/main/java/org/infinispan/query/impl/LifecycleManager.java", "diffHunk": "@@ -86,7 +86,7 @@\n  *\n  * @author Sanne Grinovero &lt;sanne@hibernate.org&gt; (C) 2011 Red Hat Inc.\n  */\n-@InfinispanModule(name = \"query\", requiredModules = {\"core\", \"query-core\"}, optionalModules = \"lucene-directory\")\n+@InfinispanModule(name = \"query\", requiredModules = {\"core\", \"query-core\", \"clustered-lock\"}, optionalModules = \"lucene-directory\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96fa095b124155861a70050a84f8a7aadcfc30c7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDU1MTU0OnYy", "diffSide": "RIGHT", "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxMjo0MFrOGAe2_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoxMjo0MFrOGAe2_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE1ODc4Mw==", "bodyText": "Why prefer this to container.stop(), doesn't it also send a TERM signal?\nAlso, do we really need the kill.sh and term.sh scripts? Couldn't we replace them with execInContainer(String.format(\"kill -%d 1\", signal))?", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r403158783", "createdAt": "2020-04-03T17:12:40Z", "author": {"login": "danberindei"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -318,6 +328,16 @@ public void kill(int server) {\n       Exceptions.unchecked(() -> containers.get(server).execInContainer(INFINISPAN_SERVER_HOME + \"/bin/kill.sh\"));\n    }\n \n+   // TODO should this just replace stop?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96fa095b124155861a70050a84f8a7aadcfc30c7"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDYzMTg4OnYy", "diffSide": "RIGHT", "path": "server/tests/src/test/java/org/infinispan/server/resilience/StatefulSetRollingUpgradeIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyNToyNFrOGAfi8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNzoyNToyNFrOGAfi8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE3MDAzMg==", "bodyText": "Weird, I never thought about the possibility of JUnit executing the rules in the \"wrong\" order.\nI see there are a few other tests that use multiple rules, perhaps we should change them as well: HotRodListenerWithDslFilter, HotRodCacheQueries, LuceneTransformationTest. Or did you only use a RuleChain here because you needed the constructor parameter, and it wasn't available in the initializer?", "url": "https://github.com/infinispan/infinispan/pull/8109#discussion_r403170032", "createdAt": "2020-04-03T17:25:24Z", "author": {"login": "danberindei"}, "path": "server/tests/src/test/java/org/infinispan/server/resilience/StatefulSetRollingUpgradeIT.java", "diffHunk": "@@ -0,0 +1,85 @@\n+package org.infinispan.server.resilience;\n+\n+import static org.infinispan.server.security.Common.sync;\n+import static org.junit.Assert.assertEquals;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.IntStream;\n+\n+import org.infinispan.client.rest.RestClient;\n+import org.infinispan.client.rest.RestResponse;\n+import org.infinispan.server.test.core.ContainerInfinispanServerDriver;\n+import org.infinispan.server.test.core.ServerRunMode;\n+import org.infinispan.server.test.junit4.InfinispanServerRule;\n+import org.infinispan.server.test.junit4.InfinispanServerRuleBuilder;\n+import org.infinispan.server.test.junit4.InfinispanServerTestMethodRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.RuleChain;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+\n+/**\n+ * Start cluster (0..numServers) redeploy after upgrade. Rolling upgrades always occur in the order numServers...0 and\n+ * the node with index numServers - 1 does not restart until node numServers has completed successfully.\n+ *\n+ * @author Ryan Emerson\n+ * @since 11.0\n+ */\n+@RunWith(Parameterized.class)\n+public class StatefulSetRollingUpgradeIT {\n+\n+   private static final int NUM_ROLLING_UPGRADES = 4;\n+   private static final String CACHE_MANAGER = \"default\";\n+\n+   private final int numServers;\n+   private InfinispanServerRule serverRule;\n+   private InfinispanServerTestMethodRule methodRule;\n+\n+   @Parameterized.Parameters(name = \"{0}\")\n+   public static Collection<Object[]> data() {\n+      return Arrays.asList(new Object[][]{{2}, {3}, {4}, {5}});\n+   }\n+\n+   public StatefulSetRollingUpgradeIT(int numServers) {\n+      this.numServers = numServers;\n+   }\n+\n+   @Rule\n+   public RuleChain getRuleChain() {\n+      serverRule = InfinispanServerRuleBuilder.config(\"configuration/ClusteredServerTest.xml\")\n+            .numServers(numServers)\n+            .runMode(ServerRunMode.CONTAINER)\n+            .parallelStartup(false)\n+            .build();\n+\n+      methodRule = new InfinispanServerTestMethodRule(serverRule);\n+\n+      return RuleChain.outerRule(serverRule)\n+            .around(methodRule);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96fa095b124155861a70050a84f8a7aadcfc30c7"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4357, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}