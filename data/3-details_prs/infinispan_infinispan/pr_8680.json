{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNjcwOTM5", "number": 8680, "title": "ISPN-12177 Persist IRAC version during shutdown", "bodyText": "https://issues.redhat.com/browse/ISPN-12177", "createdAt": "2020-09-10T10:51:18Z", "url": "https://github.com/infinispan/infinispan/pull/8680", "merged": true, "mergeCommit": {"oid": "971632d97d691714b81c8a49fb9c8450bfa64881"}, "closed": true, "closedAt": "2020-10-23T15:38:37Z", "author": {"login": "pruivo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMTjbOgBqjM4MDcxNTYyNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVULjfABqjM5MTMzMDYyMjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5eaf923ce11dd59409f638af3bd9e130be40267", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/c5eaf923ce11dd59409f638af3bd9e130be40267", "committedDate": "2020-09-10T10:50:33Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}, "afterCommit": {"oid": "e63a257513603d59855252b7ca693d96eda70145", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/e63a257513603d59855252b7ca693d96eda70145", "committedDate": "2020-09-25T10:45:34Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e63a257513603d59855252b7ca693d96eda70145", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/e63a257513603d59855252b7ca693d96eda70145", "committedDate": "2020-09-25T10:45:34Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}, "afterCommit": {"oid": "e204caf8f62d43d23852efb32aa02a34d325707a", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/e204caf8f62d43d23852efb32aa02a34d325707a", "committedDate": "2020-09-28T12:56:17Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e204caf8f62d43d23852efb32aa02a34d325707a", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/e204caf8f62d43d23852efb32aa02a34d325707a", "committedDate": "2020-09-28T12:56:17Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}, "afterCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/4539874c28934d83ab4afadf531524c8925468e2", "committedDate": "2020-10-09T09:46:29Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODQ1NjY5", "url": "https://github.com/infinispan/infinispan/pull/8680#pullrequestreview-514845669", "createdAt": "2020-10-22T15:19:56Z", "commit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNToxOTo1NlrOHmnFtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1NToxMlrOHmouHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI0ODM3NA==", "bodyText": "Looks like topologyId can be removed as well?", "url": "https://github.com/infinispan/infinispan/pull/8680#discussion_r510248374", "createdAt": "2020-10-22T15:19:56Z", "author": {"login": "wburns"}, "path": "core/src/main/java/org/infinispan/commands/irac/IracMetadataRequestCommand.java", "diffHunk": "@@ -90,6 +92,7 @@ public String toString() {\n             \"cacheName=\" + cacheName +\n             \", segment=\" + segment +\n             \", topologyId=\" + topologyId +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3MDY4Mw==", "bodyText": "This seems awfully expensive to compile a new Pattern on every invocation. I would suggest to store the compiled pattern statically.", "url": "https://github.com/infinispan/infinispan/pull/8680#discussion_r510270683", "createdAt": "2020-10-22T15:49:20Z", "author": {"login": "wburns"}, "path": "core/src/main/java/org/infinispan/container/versioning/irac/TopologyIracVersion.java", "diffHunk": "@@ -36,6 +49,16 @@ public static TopologyIracVersion max(TopologyIracVersion v1, TopologyIracVersio\n       return v1.compareTo(v2) < 0 ? v2 : v1;\n    }\n \n+   public static TopologyIracVersion fromString(String s) {\n+      Matcher m = Pattern.compile(REGEX).matcher(s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3MjQwMw==", "bodyText": "Is there a reason this was changed? The prior appending is much faster and a bit easier to read imo.", "url": "https://github.com/infinispan/infinispan/pull/8680#discussion_r510272403", "createdAt": "2020-10-22T15:51:37Z", "author": {"login": "wburns"}, "path": "core/src/main/java/org/infinispan/container/versioning/irac/TopologyIracVersion.java", "diffHunk": "@@ -63,7 +86,7 @@ public int compareTo(TopologyIracVersion other) {\n \n    @Override\n    public String toString() {\n-      return '(' + Integer.toString(topologyId) + ':' + version + ')';\n+      return String.format(FMT, topologyId, version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTEwMA==", "bodyText": "Good catch \ud83d\udc4d", "url": "https://github.com/infinispan/infinispan/pull/8680#discussion_r510275100", "createdAt": "2020-10-22T15:55:12Z", "author": {"login": "wburns"}, "path": "core/src/main/java/org/infinispan/interceptors/impl/NonTxIracLocalSiteInterceptor.java", "diffHunk": "@@ -226,20 +225,21 @@ private void handleDataWriteCommand(InvocationContext ctx, DataWriteCommand comm\n    /**\n     * Visits th {@link WriteCommand} after executed and stores the {@link IracMetadata} if it was successful.\n     */\n+   @SuppressWarnings(\"unused\")\n    private void handleWriteCommand(InvocationContext ctx, WriteCommand command, Object rv, Throwable t) {\n       if (!command.isSuccessful()) {\n          return;\n       }\n       for (Object key : command.getAffectedKeys()) {\n-         if (skipEntryCommit(ctx, key)) {\n+         if (skipEntryCommit(ctx, command, key)) {\n             continue;\n          }\n          setMetadataToCacheEntry(ctx.lookupEntry(key), command.getInternalMetadata(key).iracMetadata());\n       }\n    }\n \n-   private boolean skipEntryCommit(InvocationContext ctx, Object key) {\n-      switch (getOwnership(key)) {\n+   private boolean skipEntryCommit(InvocationContext ctx, WriteCommand command, Object key) {\n+      switch (getOwnership(getSegment(command, key))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2"}, "originalPosition": 99}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4539874c28934d83ab4afadf531524c8925468e2", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/4539874c28934d83ab4afadf531524c8925468e2", "committedDate": "2020-10-09T09:46:29Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}, "afterCommit": {"oid": "d3c583b597c5c9736679b0034570cd6ff8e606e9", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/d3c583b597c5c9736679b0034570cd6ff8e606e9", "committedDate": "2020-10-22T18:02:48Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50a3e1c88abc2a1a32a119380228bbb6e8b6201b", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/50a3e1c88abc2a1a32a119380228bbb6e8b6201b", "committedDate": "2020-10-23T10:40:12Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3c583b597c5c9736679b0034570cd6ff8e606e9", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/d3c583b597c5c9736679b0034570cd6ff8e606e9", "committedDate": "2020-10-22T18:02:48Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}, "afterCommit": {"oid": "50a3e1c88abc2a1a32a119380228bbb6e8b6201b", "author": {"user": {"login": "pruivo", "name": "Pedro Ruivo"}}, "url": "https://github.com/infinispan/infinispan/commit/50a3e1c88abc2a1a32a119380228bbb6e8b6201b", "committedDate": "2020-10-23T10:40:12Z", "message": "ISPN-12177 Persist IRAC version during shutdown"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 460, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}