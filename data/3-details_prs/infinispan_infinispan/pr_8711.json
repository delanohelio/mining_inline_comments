{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMzI3NDkz", "number": 8711, "title": "ISPN-12221 Add zero-capacity-node support for Replicated caches ", "bodyText": "https://issues.redhat.com/browse/ISPN-12221\n\nExtend ZeroCapacityNodeTest to cover replicated\nand scattered caches\nAdd a list of members without state and a capacity\nfactors map to ReplicatedConsistentHash\nIgnore nodes with zero capacity when computing backups\nChange [Sync]ReplicatedConsistentHashFactory.\nupdateMembers() no not assign new members as backups", "createdAt": "2020-09-24T09:54:43Z", "url": "https://github.com/infinispan/infinispan/pull/8711", "merged": true, "mergeCommit": {"oid": "1d95fadda8797494e5f3af2c06c4f000341c8b08"}, "closed": true, "closedAt": "2020-09-24T14:12:47Z", "author": {"login": "danberindei"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL-IqtgH2gAyNDkyMzI3NDkzOmM2ZmY1ZjM0NGU1NmY3MjE3MTc0MTk0ZGE2ZjAxYjkxYzNjYjFiYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMANT-AFqTQ5NTUwODgyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6ff5f344e56f7217174194da6f01b91c3cb1ba6", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/c6ff5f344e56f7217174194da6f01b91c3cb1ba6", "committedDate": "2020-09-24T09:53:59Z", "message": "ISPN-12221 Add zero-capacity-node support for Replicated caches\n\n* Extend ZeroCapacityNodeTest to cover replicated\n  and scattered caches\n* Add a list of members without state and a capacity\n  factors map to ReplicatedConsistentHash\n* Ignore nodes with zero capacity when computing backups\n* Change [Sync]ReplicatedConsistentHashFactory.\n  updateMembers() no not assign new members as backups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af2fc8a252c0eaa7d787c7942ee24742c633ce99", "author": {"user": {"login": "danberindei", "name": "Dan Berindei"}}, "url": "https://github.com/infinispan/infinispan/commit/af2fc8a252c0eaa7d787c7942ee24742c633ce99", "committedDate": "2020-09-24T09:54:05Z", "message": "ISPN-12351 ImmutableListCopy makes too many copies\n\n* Make no-argument constructor create a valid instance\n* Avoid copying the elements array when possible\n* Use Arrays methods for copying\n* Mark fields final\n* Remove unnecessary type parameters and casts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTA4ODIx", "url": "https://github.com/infinispan/infinispan/pull/8711#pullrequestreview-495508821", "createdAt": "2020-09-24T12:18:51Z", "commit": {"oid": "af2fc8a252c0eaa7d787c7942ee24742c633ce99"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjoxODo1MVrOHXXtpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjoxODo1MVrOHXXtpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NzgxMw==", "bodyText": "@tristantarrant drink! \ud83c\udf7b", "url": "https://github.com/infinispan/infinispan/pull/8711#discussion_r494267813", "createdAt": "2020-09-24T12:18:51Z", "author": {"login": "alanfx"}, "path": "core/src/main/java/org/infinispan/distribution/ch/impl/ReplicatedConsistentHashFactory.java", "diffHunk": "@@ -50,6 +60,15 @@ public ReplicatedConsistentHash updateMembers(ReplicatedConsistentHash baseCH, L\n       if (newMembers.equals(baseCH.getMembers()))\n          return baseCH;\n \n+      return updateCH(baseCH, newMembers, actualCapacityFactors, false);\n+   }\n+\n+   private ReplicatedConsistentHash updateCH(ReplicatedConsistentHash baseCH, List<Address> newMembers,\n+                                             Map<Address, Float> actualCapacityFactors, boolean rebalance) {\n+      // New members missing from the old CH or with capacity factor 0 should not become primary or backup owners", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2fc8a252c0eaa7d787c7942ee24742c633ce99"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 326, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}