{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3ODY2NjUy", "number": 8056, "title": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifec\u2026", "bodyText": "\u2026ycle exception\nhttps://issues.redhat.com/browse/ISPN-11470", "createdAt": "2020-03-13T16:23:37Z", "url": "https://github.com/infinispan/infinispan/pull/8056", "merged": true, "mergeCommit": {"oid": "cab6faca9153e442177d3aac1a620bda9c0ad8a3"}, "closed": true, "closedAt": "2020-03-31T13:56:07Z", "author": {"login": "wburns"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNVGCfAFqTM3NDU0MzA3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRMqiVgBqjMxNjU0NDkzNTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NTQzMDcy", "url": "https://github.com/infinispan/infinispan/pull/8056#pullrequestreview-374543072", "createdAt": "2020-03-13T19:00:27Z", "commit": {"oid": "9d5a51774b81201c67acd4cbdd4823d2515ea8d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxOTowMDoyN1rOF2PKzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxOTowMDoyN1rOF2PKzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQxNTk0OQ==", "bodyText": "Shouldn't we throw an IllegalLifecycleStateException only if the executor has been shut down?", "url": "https://github.com/infinispan/infinispan/pull/8056#discussion_r392415949", "createdAt": "2020-03-13T19:00:27Z", "author": {"login": "danberindei"}, "path": "commons/src/main/java/org/infinispan/commons/util/concurrent/LifecycleRejectedExecutionHandler.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.infinispan.commons.util.concurrent;\n+\n+import java.util.concurrent.RejectedExecutionHandler;\n+import java.util.concurrent.ThreadPoolExecutor;\n+\n+import org.infinispan.commons.IllegalLifecycleStateException;\n+\n+/**\n+ * A handler for rejected tasks that always throws a {@link IllegalLifecycleStateException}.\n+ * @author wburns\n+ * @since 11.0\n+ */\n+public class LifecycleRejectedExecutionHandler implements RejectedExecutionHandler {\n+   private LifecycleRejectedExecutionHandler() { }\n+\n+   private static final LifecycleRejectedExecutionHandler INSTANCE = new LifecycleRejectedExecutionHandler();\n+\n+   public static LifecycleRejectedExecutionHandler getInstance() {\n+      return INSTANCE;\n+   }\n+\n+   @Override\n+   public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {\n+      throw new IllegalLifecycleStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d5a51774b81201c67acd4cbdd4823d2515ea8d7"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d5a51774b81201c67acd4cbdd4823d2515ea8d7", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/9d5a51774b81201c67acd4cbdd4823d2515ea8d7", "committedDate": "2020-03-13T16:18:29Z", "message": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifecycle exception"}, "afterCommit": {"oid": "4d0bd9591635ccf60d1d1fd32912f1bd93ea4435", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/4d0bd9591635ccf60d1d1fd32912f1bd93ea4435", "committedDate": "2020-03-16T15:05:08Z", "message": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifecycle exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzExNTg2", "url": "https://github.com/infinispan/infinispan/pull/8056#pullrequestreview-375311586", "createdAt": "2020-03-16T15:12:03Z", "commit": {"oid": "4d0bd9591635ccf60d1d1fd32912f1bd93ea4435"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxMjowM1rOF24zSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNTo1MzowM1rOF26lfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA5ODA1OQ==", "bodyText": "To me it seems better to document it in the class then at the call site. Somehow comments between method arguments always rub me the wrong way, even when they're not on the same line as the parameters :)", "url": "https://github.com/infinispan/infinispan/pull/8056#discussion_r393098059", "createdAt": "2020-03-16T15:12:03Z", "author": {"login": "danberindei"}, "path": "commons/src/main/java/org/infinispan/commons/util/concurrent/LifecycleRejectedExecutionHandler.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.infinispan.commons.util.concurrent;\n+\n+import java.util.concurrent.RejectedExecutionHandler;\n+import java.util.concurrent.ThreadPoolExecutor;\n+\n+import org.infinispan.commons.IllegalLifecycleStateException;\n+\n+/**\n+ * A handler for rejected tasks that always throws a {@link IllegalLifecycleStateException}.\n+ * @author wburns\n+ * @since 11.0\n+ */\n+public class LifecycleRejectedExecutionHandler implements RejectedExecutionHandler {\n+   private LifecycleRejectedExecutionHandler() { }\n+\n+   private static final LifecycleRejectedExecutionHandler INSTANCE = new LifecycleRejectedExecutionHandler();\n+\n+   public static LifecycleRejectedExecutionHandler getInstance() {\n+      return INSTANCE;\n+   }\n+\n+   @Override\n+   public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {\n+      throw new IllegalLifecycleStateException();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQxNTk0OQ=="}, "originalCommit": {"oid": "9d5a51774b81201c67acd4cbdd4823d2515ea8d7"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEyNzI5NQ==", "bodyText": "Don't need to explain what AbortPolicy does, the only surprising part for me is that it's safe to throw IllegalLifecycleStateException instead of RejectedExecutionException without checking that the executor is stopping.", "url": "https://github.com/infinispan/infinispan/pull/8056#discussion_r393127295", "createdAt": "2020-03-16T15:53:03Z", "author": {"login": "danberindei"}, "path": "commons/src/main/java/org/infinispan/commons/executors/ScheduledThreadPoolExecutorFactory.java", "diffHunk": "@@ -13,7 +15,11 @@\n \n    @Override\n    public ScheduledExecutorService createExecutor(ThreadFactory factory) {\n-      ScheduledThreadPoolExecutor result = new ScheduledThreadPoolExecutor(1, factory);\n+      ScheduledThreadPoolExecutor result = new ScheduledThreadPoolExecutor(1, factory,\n+            // Just use a rejection policy that always throws a lifecycle exception\n+            // ScheduledThreadPoolExecutor uses an unbounded queue and always throws a RejectedException for the default\n+            // rejection policy.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d0bd9591635ccf60d1d1fd32912f1bd93ea4435"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bb852d089c1828fd58c275063b778e2cf7f5f7d", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/0bb852d089c1828fd58c275063b778e2cf7f5f7d", "committedDate": "2020-03-25T19:26:18Z", "message": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifecycle exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d0bd9591635ccf60d1d1fd32912f1bd93ea4435", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/4d0bd9591635ccf60d1d1fd32912f1bd93ea4435", "committedDate": "2020-03-16T15:05:08Z", "message": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifecycle exception"}, "afterCommit": {"oid": "0bb852d089c1828fd58c275063b778e2cf7f5f7d", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/0bb852d089c1828fd58c275063b778e2cf7f5f7d", "committedDate": "2020-03-25T19:26:18Z", "message": "ISPN-11470 Scheduled thread pools rejection handle should throw Lifecycle exception"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1117, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}