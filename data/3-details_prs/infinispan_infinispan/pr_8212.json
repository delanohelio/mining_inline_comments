{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0NjM2NzQ1", "number": 8212, "title": "ISPN-10428 clarify path usage for single file stores", "bodyText": "https://issues.redhat.com/browse/ISPN-10428", "createdAt": "2020-04-16T19:21:35Z", "url": "https://github.com/infinispan/infinispan/pull/8212", "merged": true, "mergeCommit": {"oid": "a140c1e0300df9f533dea9141f0277c0fc82f144"}, "closed": true, "closedAt": "2020-04-23T12:04:58Z", "author": {"login": "oraNod"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYR0dYgFqTM5NDkzNDIxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcabGcHgBqjMyNjQ2MTAxNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0OTM0MjE1", "url": "https://github.com/infinispan/infinispan/pull/8212#pullrequestreview-394934215", "createdAt": "2020-04-16T19:25:57Z", "commit": {"oid": "0529c945aa155e0e3b9df9dd0bfe0f659afe0062"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyNTo1N1rOGGz-Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxOToyNTo1N1rOGGz-Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc5NjA5OA==", "bodyText": "@ryanemerson I'm curious about the programmatic configuration. docs provide this example:\nConfigurationBuilder b = new ConfigurationBuilder();\nb.persistence()\n    .addSingleFileStore()\n    .location(\"myDataStore\")\n    .maxEntries(5000);\n\nthis is for library right? is there a way to configure persistence via Hot Rod other than using XMLStringConfiguration to pass a cache definition that includes file-store?", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r409796098", "createdAt": "2020-04-16T19:25:57Z", "author": {"login": "oraNod"}, "path": "documentation/src/main/asciidoc/topics/ref_cache_store_sfs.adoc", "diffHunk": "@@ -19,9 +19,26 @@ defragmented.\n \n .Declarative configuration\n \n+* For embedded deployments, {brandname} stores data to the current working\n+directory. To store data in a different location, specify the absolute path to\n+that directory as the value, as in the following example:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<persistence>\n+\u00a0\u00a0 <file-store path=\"/path/to/myDataStore\" max-entries=\"5000\"/>\n+</persistence>\n+----\n+\n+* For server deployments, {brandname} stores data in `{server_home}/data`. You\n+should not specify a `path` for Single File cache stores with {brandname} \n+server.\n+\n [source,xml,options=\"nowrap\",subs=attributes+]\n ----\n-include::config_examples/persistence_file_store.xml[]\n+<persistence>\n+\u00a0\u00a0 <file-store max-entries=\"5000\"/>\n+</persistence>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0529c945aa155e0e3b9df9dd0bfe0f659afe0062"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjgzNzYw", "url": "https://github.com/infinispan/infinispan/pull/8212#pullrequestreview-396283760", "createdAt": "2020-04-20T09:23:58Z", "commit": {"oid": "0529c945aa155e0e3b9df9dd0bfe0f659afe0062"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOToyMzo1OFrOGILVNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOToyMzo1OFrOGILVNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIyNzQ0NA==", "bodyText": "This isn't correct on master anymore due to https://issues.redhat.com/browse/ISPN-11556. If the value of path is an absolute path, then that value must be a sub path of globalState.persistentLocation or an exception is thrown.\nFor example:\n// Global configuration\nglobalState().persistentLocation(`/tmp/example/`);\n...\n// Cache configuration\n1. config.addSingleFileStore().location('/tmp/example/file-store-absolute'`)\n2. config.addSingleFileStore().location('file-store-relative'`)\n3. config.addSingleFileStore().location('/example/`)\nExample 1 and 2 are valid and result in a file-store being created at /tmp/example/file-store-absolute and /tmp/example/file-store-relative.\nExample 3 is invalid as the root is different, i.e. /example != /tmp/example and so a CacheConfigurationException is thrown.", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r411227444", "createdAt": "2020-04-20T09:23:58Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/ref_cache_store_sfs.adoc", "diffHunk": "@@ -19,9 +19,26 @@ defragmented.\n \n .Declarative configuration\n \n+* For embedded deployments, {brandname} stores data to the current working\n+directory. To store data in a different location, specify the absolute path to\n+that directory as the value, as in the following example:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<persistence>\n+\u00a0\u00a0 <file-store path=\"/path/to/myDataStore\" max-entries=\"5000\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0529c945aa155e0e3b9df9dd0bfe0f659afe0062"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0529c945aa155e0e3b9df9dd0bfe0f659afe0062", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/0529c945aa155e0e3b9df9dd0bfe0f659afe0062", "committedDate": "2020-04-16T19:17:42Z", "message": "ISPN-10428 clarify path usage for single file stores"}, "afterCommit": {"oid": "c27bf9330995afed9c38388425202f1827be32d2", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/c27bf9330995afed9c38388425202f1827be32d2", "committedDate": "2020-04-22T10:16:30Z", "message": "ISPN-10428 SFS configuration docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c27bf9330995afed9c38388425202f1827be32d2", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/c27bf9330995afed9c38388425202f1827be32d2", "committedDate": "2020-04-22T10:16:30Z", "message": "ISPN-10428 SFS configuration docs"}, "afterCommit": {"oid": "5c7afd991ddde264e4a6ce5f3b289880a86534c5", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/5c7afd991ddde264e4a6ce5f3b289880a86534c5", "committedDate": "2020-04-22T10:16:58Z", "message": "ISPN-10428 clarify path usage for single file stores"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MDgxODc5", "url": "https://github.com/infinispan/infinispan/pull/8212#pullrequestreview-398081879", "createdAt": "2020-04-22T11:08:23Z", "commit": {"oid": "5c7afd991ddde264e4a6ce5f3b289880a86534c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowODoyM1rOGJwrZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowODoyM1rOGJwrZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NzkwOA==", "bodyText": "This is a bit strong. AFAIK in the server you can still change the location of globalstate.persistentLocation, also it would be possible to store in another subdir if desired. For example \"path=subDir\" will result in the store being located at `{server_home/data/subDir/.dat}.\nAlso, I'm not sure if the globalState.persistentLocation can be configured to exist outside of {server_home}. @tristantarrant Can you clarify?", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r412887908", "createdAt": "2020-04-22T11:08:23Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/ref_cache_store_sfs.adoc", "diffHunk": "@@ -19,18 +19,69 @@ defragmented.\n \n .Declarative configuration\n \n+* For embedded deployments, {brandname} stores data in the global persistent\n+location. Use the `path` attribute to specify a directory that is relative to\n+the global persistent location, as in the following example:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<persistence>\n+\u00a0\u00a0 <file-store path=\"path/to/myDataStore\" max-entries=\"5000\"/>\n+</persistence>\n+----\n+\n+{brandname} throws the following exception if you attempt to use a directory\n+outside the global persistent location:\n+\n+----\n+ISPN000558: \"The store location 'foo' is not a child of the global persistent location 'bar'\"\n+----\n+\n+For example, you configure your global persistent location as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"/tmp/example\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+To set an absolute path for the Single File store configuration, you must do so as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<persistence>\n+\u00a0\u00a0 <file-store path=\"/tmp/example/path/to/myDataStore\" max-entries=\"5000\"/>\n+</persistence>\n+----\n+\n+* For server deployments, {brandname} stores data in `{server_home}/data`. You\n+should not specify a `path` for Single File cache stores with {brandname}\n+server.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c7afd991ddde264e4a6ce5f3b289880a86534c5"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c7afd991ddde264e4a6ce5f3b289880a86534c5", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/5c7afd991ddde264e4a6ce5f3b289880a86534c5", "committedDate": "2020-04-22T10:16:58Z", "message": "ISPN-10428 clarify path usage for single file stores"}, "afterCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/3045a8eea2c3f456383a4a4a88833d5d5597685b", "committedDate": "2020-04-22T16:02:17Z", "message": "ISPN-10428 clarify path usage for single file stores"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTEyMTU0", "url": "https://github.com/infinispan/infinispan/pull/8212#pullrequestreview-398912154", "createdAt": "2020-04-23T09:16:40Z", "commit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToxNjo0MFrOGKfUdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwOToyNjo0NFrOGKfwAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1MjA4NA==", "bodyText": "This should be the file-store xml I think", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413652084", "createdAt": "2020-04-23T09:16:40Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/proc_setting_persistent_location.adoc", "diffHunk": "@@ -40,8 +37,33 @@ public GlobalStateConfigurationBuilder persistentLocation(String path, String re\n }\n ----\n \n-{brandname} logs the following message if you attempt to use a directory\n-outside the global persistent location with file-based cache stores:\n+.File-Based Cache Stores and Global Persistent Location\n+\n+When using file-based cache stores, you can optionally specify filesystem directories for storage. These paths are relative to the global persistent location.\n+\n+For example, you configure your global persistent location as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"/tmp/example\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+You then configure a Single File cache store that uses a path named\n+`myDataStore` as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"myDataStore\" relative-to=\"my.data\"/>\n+</global-state>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1MjMxNQ==", "bodyText": "It will be /tmp/example/myDataStore/<cache-name>.dat", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413652315", "createdAt": "2020-04-23T09:16:58Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/proc_setting_persistent_location.adoc", "diffHunk": "@@ -40,8 +37,33 @@ public GlobalStateConfigurationBuilder persistentLocation(String path, String re\n }\n ----\n \n-{brandname} logs the following message if you attempt to use a directory\n-outside the global persistent location with file-based cache stores:\n+.File-Based Cache Stores and Global Persistent Location\n+\n+When using file-based cache stores, you can optionally specify filesystem directories for storage. These paths are relative to the global persistent location.\n+\n+For example, you configure your global persistent location as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"/tmp/example\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+You then configure a Single File cache store that uses a path named\n+`myDataStore` as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"myDataStore\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+In this case, the configuration results in a Single File cache store in `/tmp/example/myDataStore/.dat`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1NjUzMQ==", "bodyText": "I think the use of the word \"relative\" is confusing here as it has different meanings when talking about paths:\nhttps://en.wikipedia.org/wiki/Path_(computing)#Absolute_and_relative_paths\nHow about:\n\"Specifies a filesystem directory for data. The value can be a relative or absolute path. Relative paths are created relative to the configured global persistent location. Whereas absolute paths must be a subdirectory of the global persistent location, otherwise an exception is thrown.\"", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413656531", "createdAt": "2020-04-23T09:23:06Z", "author": {"login": "ryanemerson"}, "path": "core/src/main/resources/schema/infinispan-config-11.0.xsd", "diffHunk": "@@ -1858,9 +1858,10 @@\n         <xs:attribute name=\"path\" type=\"xs:string\">\n           <xs:annotation>\n             <xs:documentation>\n-              Defines a location in the root path, specified in \"relative-to\",\n-              where the cache state is stored. Defaults to the name of the\n-              cache container.\n+              Specifies a filesystem directory for data. The value should\n+              always be relative to the global persistent location. If you set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1NzYxMQ==", "bodyText": "\"When using file-based cache stores, you can optionally specify filesystem directories for storage. Unless absolute paths are declared, these are always relative to the global persistent location.\" ?", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413657611", "createdAt": "2020-04-23T09:24:38Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/proc_setting_persistent_location.adoc", "diffHunk": "@@ -40,8 +37,33 @@ public GlobalStateConfigurationBuilder persistentLocation(String path, String re\n }\n ----\n \n-{brandname} logs the following message if you attempt to use a directory\n-outside the global persistent location with file-based cache stores:\n+.File-Based Cache Stores and Global Persistent Location\n+\n+When using file-based cache stores, you can optionally specify filesystem directories for storage. These paths are relative to the global persistent location.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1ODUyMw==", "bodyText": "\"an absolute path\"", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413658523", "createdAt": "2020-04-23T09:25:52Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/proc_setting_persistent_location.adoc", "diffHunk": "@@ -40,8 +37,33 @@ public GlobalStateConfigurationBuilder persistentLocation(String path, String re\n }\n ----\n \n-{brandname} logs the following message if you attempt to use a directory\n-outside the global persistent location with file-based cache stores:\n+.File-Based Cache Stores and Global Persistent Location\n+\n+When using file-based cache stores, you can optionally specify filesystem directories for storage. These paths are relative to the global persistent location.\n+\n+For example, you configure your global persistent location as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"/tmp/example\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+You then configure a Single File cache store that uses a path named\n+`myDataStore` as follows:\n+\n+[source,xml,options=\"nowrap\",subs=attributes+]\n+----\n+<global-state>\n+   <persistent-location path=\"myDataStore\" relative-to=\"my.data\"/>\n+</global-state>\n+----\n+\n+In this case, the configuration results in a Single File cache store in `/tmp/example/myDataStore/.dat`\n+\n+If you attempt to set a path that resides outside the global persistent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY1OTEzNw==", "bodyText": "This has the same issue as the xsd description.", "url": "https://github.com/infinispan/infinispan/pull/8212#discussion_r413659137", "createdAt": "2020-04-23T09:26:44Z", "author": {"login": "ryanemerson"}, "path": "documentation/src/main/asciidoc/topics/ref_cache_store_sfs.adoc", "diffHunk": "@@ -17,20 +17,35 @@ is used only if an entry can fit within it. Likewise, if you remove all entries\n from memory, the single file store does not decrease in size or become\n defragmented.\n \n+{brandname} stores data in the global persistent location. You can optionally\n+specify a filesystem directory with the `path` attribute but the value should\n+always be relative to the global persistent location.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3045a8eea2c3f456383a4a4a88833d5d5597685b", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/3045a8eea2c3f456383a4a4a88833d5d5597685b", "committedDate": "2020-04-22T16:02:17Z", "message": "ISPN-10428 clarify path usage for single file stores"}, "afterCommit": {"oid": "c9db6134b60eaee59c103e38ed7f44900ff83dd1", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/c9db6134b60eaee59c103e38ed7f44900ff83dd1", "committedDate": "2020-04-23T11:09:03Z", "message": "ISPN-10428 ryan emerson doc review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65abeb8dea1f530e965095659c74b15294967db3", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/65abeb8dea1f530e965095659c74b15294967db3", "committedDate": "2020-04-23T11:22:20Z", "message": "ISPN-10428 clarify path usage for single file stores"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9db6134b60eaee59c103e38ed7f44900ff83dd1", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/c9db6134b60eaee59c103e38ed7f44900ff83dd1", "committedDate": "2020-04-23T11:09:03Z", "message": "ISPN-10428 ryan emerson doc review"}, "afterCommit": {"oid": "65abeb8dea1f530e965095659c74b15294967db3", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/65abeb8dea1f530e965095659c74b15294967db3", "committedDate": "2020-04-23T11:22:20Z", "message": "ISPN-10428 clarify path usage for single file stores"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 868, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}