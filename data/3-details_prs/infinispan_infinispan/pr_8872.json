{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMzM4MTIz", "number": 8872, "title": "ISPN-12464 Update to Hibernate Search 6.0.0.CR1", "bodyText": "https://issues.redhat.com/browse/ISPN-12464", "createdAt": "2020-11-18T17:13:13Z", "url": "https://github.com/infinispan/infinispan/pull/8872", "merged": true, "mergeCommit": {"oid": "24feb14fd528cfcb59d7f88cedc8b5b5de2d1513"}, "closed": true, "closedAt": "2020-11-27T08:44:13Z", "author": {"login": "gustavonalle"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfQ6k6gFqTUzNjI0NzQ0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfp9npABqjQwMzI4NzM5MjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjQ3NDQ0", "url": "https://github.com/infinispan/infinispan/pull/8872#pullrequestreview-536247444", "createdAt": "2020-11-23T08:21:30Z", "commit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyMTozMFrOH4C6Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyODo0N1rOH4DIJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyOTkyNg==", "bodyText": "Are you sure about this? I think we discussed this at some point and the Search 6 defaults weren't acceptable for Infinispan. I.e. for each index 10 indexing queues, and for each cache about as many threads as the number of processor cores available to the JVM on startup.\nNote that having more indexing queues than threads is not useful.", "url": "https://github.com/infinispan/infinispan/pull/8872#discussion_r528529926", "createdAt": "2020-11-23T08:21:30Z", "author": {"login": "yrodiere"}, "path": "query/src/main/java/org/infinispan/search/mapper/mapping/impl/IndexProperties.java", "diffHunk": "@@ -31,25 +28,21 @@ public void setProperty(String key, Object value) {\n    }\n \n    public void setProperties(Map<String, Object> properties) {\n-      properties.entrySet().stream()\n-            .forEach(property -> setProperty(property.getKey(), property.getValue()) );\n+      properties.forEach(this::setProperty);\n    }\n \n    public ConfigurationPropertySource createPropertySource(ConfigurationPropertyChecker propertyChecker) {\n       ConfigurationPropertySource basePropertySource =\n             propertyChecker.wrap(ConfigurationPropertySource.fromMap(backendProperties))\n-                  .withPrefix(BACKEND_PROPERTIES_PREFIX);\n+                  .withPrefix(EngineSettings.BACKEND);\n       ConfigurationPropertySource propertySource =\n             basePropertySource.withOverride(ConfigurationPropertySource.fromMap(engineProperties));\n       defaultProperties();\n       return propertySource;\n    }\n \n    private void defaultProperties() {\n-      engineProperties.put(\"hibernate.search.default_backend\", INFINISPAN_BACKEND_NAME);\n       backendProperties.put(\"type\", \"lucene\");\n       backendProperties.put(\"analysis.configurer\", new DefaultAnalysisConfigurer());\n-      backendProperties.put(\"thread_pool.size\", \"1\");\n-      backendProperties.put(\"index_defaults.indexing.queue_count\", \"1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMjM1Nw==", "bodyText": "FWIW, NRT is enabled by default. This doesn't enable it, it just changes the commit interval from 1,000ms to 10,000ms.", "url": "https://github.com/infinispan/infinispan/pull/8872#discussion_r528532357", "createdAt": "2020-11-23T08:26:24Z", "author": {"login": "yrodiere"}, "path": "query/src/test/resources/nrt-performance-writer.xml", "diffHunk": "@@ -24,7 +24,7 @@\n                <indexed-entity>org.infinispan.query.test.Person</indexed-entity>\n             </indexed-entities>\n             <!-- Enabled fastest writer: NRT backend -->\n-            <property name=\"index_defaults.io.commit_interval\">10000</property>\n+            <property name=\"io.commit_interval\">10000</property>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMzE3MQ==", "bodyText": "Same comment about sharding: it will be driven by the segment IDs, not the document IDs.", "url": "https://github.com/infinispan/infinispan/pull/8872#discussion_r528533171", "createdAt": "2020-11-23T08:28:02Z", "author": {"login": "yrodiere"}, "path": "query/src/test/resources/nrt-performance-writer.xml", "diffHunk": "@@ -37,11 +37,11 @@\n             -->\n \n             <!-- Enable sharding on writers -->\n-            <property name=\"index_defaults.sharding.strategy\">hash</property>\n-            <property name=\"index_defaults.sharding.number_of_shards\">6</property>\n+            <property name=\"sharding.strategy\">hash</property>\n+            <property name=\"sharding.number_of_shards\">6</property>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMzU0MA==", "bodyText": "FYI, Hibernate Search uses the routing keys for sharding when they are provided, not the document IDs.\nInfinispan uses the segment IDs as routing keys.\nNot sure it changes anything, but I thought you would want to know.", "url": "https://github.com/infinispan/infinispan/pull/8872#discussion_r528533540", "createdAt": "2020-11-23T08:28:47Z", "author": {"login": "yrodiere"}, "path": "query/src/test/resources/nrt-performance-writer-infinispandirectory.xml", "diffHunk": "@@ -31,12 +31,12 @@\n             <!-- Write indexes in Infinispan -->\n             <property name=\"directory.type\">local-heap</property>\n             <!-- Enable sharding on writers -->\n-            <property name=\"index_defaults.sharding.strategy\">hash</property>\n-            <property name=\"index_defaults.sharding.number_of_shards\">6</property>\n+            <property name=\"sharding.strategy\">hash</property>\n+            <property name=\"sharding.number_of_shards\">6</property>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25c3d431e1428bbe363aa641a3b81b5670e98bc8", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/25c3d431e1428bbe363aa641a3b81b5670e98bc8", "committedDate": "2020-11-24T07:32:08Z", "message": "ISPN-12464 Update to Hibernate Search 6.0.0.CR1"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae952d808f48bc929bc1d5d06fef34b99bb2ab79", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/ae952d808f48bc929bc1d5d06fef34b99bb2ab79", "committedDate": "2020-11-18T17:12:13Z", "message": "ISPN-12464 Update to Hibernate Search 6.0.0.CR1"}, "afterCommit": {"oid": "47d4dae95b61e399277b7777a02ebc6bbfc07ab9", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/47d4dae95b61e399277b7777a02ebc6bbfc07ab9", "committedDate": "2020-11-24T07:32:08Z", "message": "ISPN-12464 Fix timeout test failure and clarify javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce7ac83e424d37a2fd4135689a17e78e2e936a3", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/dce7ac83e424d37a2fd4135689a17e78e2e936a3", "committedDate": "2020-11-24T13:42:01Z", "message": "ISPN-12464 Fix timeout test failure and clarify javadoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47d4dae95b61e399277b7777a02ebc6bbfc07ab9", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/47d4dae95b61e399277b7777a02ebc6bbfc07ab9", "committedDate": "2020-11-24T07:32:08Z", "message": "ISPN-12464 Fix timeout test failure and clarify javadoc"}, "afterCommit": {"oid": "dce7ac83e424d37a2fd4135689a17e78e2e936a3", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/dce7ac83e424d37a2fd4135689a17e78e2e936a3", "committedDate": "2020-11-24T13:42:01Z", "message": "ISPN-12464 Fix timeout test failure and clarify javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 303, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}