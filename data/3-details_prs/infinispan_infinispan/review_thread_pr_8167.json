{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MjExNTgz", "number": 8167, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMDowM1rODubT3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozNzozOFrODubgNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDA4NTQwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMDowM1rOGAahyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMDowM1rOGAahyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4NzgxOA==", "bodyText": "can you convert to long\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               private Long internalId;\n          \n          \n            \n               private long internalId;", "url": "https://github.com/infinispan/infinispan/pull/8167#discussion_r403087818", "createdAt": "2020-04-03T15:30:03Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "diffHunk": "@@ -22,28 +21,18 @@\n public class InDoubtTxInfoImpl implements RecoveryManager.InDoubtTxInfo {\n    private Xid xid;\n    private Long internalId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5c203b703af3df66f088a4ec76522413d9af29"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDA5MTg2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMTozMlrOGAal0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMTozMlrOGAal0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4ODg0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               public void addStatus(Integer status) {\n          \n          \n            \n               public void addStatus(int status) {", "url": "https://github.com/infinispan/infinispan/pull/8167#discussion_r403088848", "createdAt": "2020-04-03T15:31:32Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "diffHunk": "@@ -66,8 +55,8 @@ public Long getInternalId() {\n       return owners;\n    }\n \n-   public void addStatus(Set<Integer> statusSet) {\n-      status.addAll(statusSet);\n+   public void addStatus(Integer status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5c203b703af3df66f088a4ec76522413d9af29"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDA5NTUxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMjoyN1rOGAaoGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMjoyN1rOGAaoGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4OTQzMg==", "bodyText": "you can use ==", "url": "https://github.com/infinispan/infinispan/pull/8167#discussion_r403089432", "createdAt": "2020-04-03T15:32:27Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/InDoubtTxInfoImpl.java", "diffHunk": "@@ -115,26 +104,17 @@ public Integer getId() {\n    public boolean equals(Object o) {\n       if (this == o) return true;\n       if (o == null || getClass() != o.getClass()) return false;\n-\n       InDoubtTxInfoImpl that = (InDoubtTxInfoImpl) o;\n-\n-      if (isLocal != that.isLocal) return false;\n-      if (internalId != null ? !internalId.equals(that.internalId) : that.internalId != null) return false;\n-      if (owners != null ? !owners.equals(that.owners) : that.owners != null) return false;\n-      if (status != null ? !status.equals(that.status) : that.status != null) return false;\n-      if (xid != null ? !xid.equals(that.xid) : that.xid != null) return false;\n-\n-      return true;\n+      return status == that.status &&\n+            isLocal == that.isLocal &&\n+            Objects.equals(xid, that.xid) &&\n+            Objects.equals(internalId, that.internalId) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5c203b703af3df66f088a4ec76522413d9af29"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDEwMTcwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/RecoveryManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMzo0N1rOGAar7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozMzo0N1rOGAar7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA5MDQxMg==", "bodyText": "I think it can be removed. This is a private class/package.", "url": "https://github.com/infinispan/infinispan/pull/8167#discussion_r403090412", "createdAt": "2020-04-03T15:33:47Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/RecoveryManager.java", "diffHunk": "@@ -149,12 +150,23 @@\n        */\n       Long getInternalId();\n \n+      /**\n+       * The value represent transaction's state as described by the {@code status} field.\n+       * @return the {@link javax.transaction.Status} or -1 if not set.\n+       */\n+      int getTxStatus();\n+\n       /**\n        * The value represent transaction's state as described by the {@code status} field. Multiple values are returned\n        * as it is possible for an in-doubt transaction to be at the same time e.g. prepared on one node and committed on\n        * the other.\n+       * @deprecated will be removed in a future version.\n        */\n-      Set<Integer> getStatus();\n+      @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5c203b703af3df66f088a4ec76522413d9af29"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDExNzAyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/RecoveryAdminOperations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozNzozOFrOGAa12Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozNzozOFrOGAa12Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA5Mjk1Mw==", "bodyText": "nitpick: we can use org.infinispan.commons.tx.Util.transactionStatusToString() to get the status as string.\nif status != -1 :)", "url": "https://github.com/infinispan/infinispan/pull/8167#discussion_r403092953", "createdAt": "2020-04-03T15:37:38Z", "author": {"login": "pruivo"}, "path": "core/src/main/java/org/infinispan/transaction/xa/recovery/RecoveryAdminOperations.java", "diffHunk": "@@ -48,14 +48,13 @@ public String showInDoubtTransactions() {\n          result.append(\"xid = [\").append(i.getXid()).append(\"], \").append(SEPARATOR)\n                .append(\"internalId = \").append(i.getInternalId()).append(SEPARATOR);\n          result.append(\"status = [ \");\n-         for (Integer status : i.getStatus()) {\n-            if (status == Status.STATUS_PREPARED) {\n-               result.append(\"_PREPARED_\");\n-            } else if (status == Status.STATUS_COMMITTED) {\n-               result.append(\"_COMMITTED_\");\n-            } else if (status == Status.STATUS_ROLLEDBACK) {\n-               result.append(\"_ROLLEDBACK_\");\n-            }\n+         int status = i.getTxStatus();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5c203b703af3df66f088a4ec76522413d9af29"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4397, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}