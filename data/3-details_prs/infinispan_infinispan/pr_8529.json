{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDQ1ODY1", "number": 8529, "title": "ISPN-12036 Automatic registration of SerializationContextInitializers\u2026", "bodyText": "\u2026 only if none is manually configured\nhttps://issues.redhat.com/browse/ISPN-12036\nalso remove the deprecated ProtostreamSerializationContextInitializer :  https://issues.redhat.com/browse/ISPN-12167", "createdAt": "2020-07-03T12:59:30Z", "url": "https://github.com/infinispan/infinispan/pull/8529", "merged": true, "mergeCommit": {"oid": "0c49e3ceb4c34fb17963d1e508d51fe77c714b7a"}, "closed": true, "closedAt": "2020-10-02T10:54:07Z", "author": {"login": "anistor"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxUGQDAFqTQ0MjQzOTk3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOipP0ABqjM4MzMxNTQ5NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDM5OTc2", "url": "https://github.com/infinispan/infinispan/pull/8529#pullrequestreview-442439976", "createdAt": "2020-07-03T14:13:17Z", "commit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMzoxN1rOGsxp8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMzoxN1rOGsxp8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYwNDA4Mw==", "bodyText": "I'm still not convinced this limitation is necessary. What's the real benefit?\nConsider this scenario:\n\nx SCI's auto generated and services created as per the new protostream default behaviour\nA single \"manual\" SCI implementation is created by the user\n\nIn this scenario, with your changes, it's now necessary for the user to manually configure all x SCIs in addition to the manual one.", "url": "https://github.com/infinispan/infinispan/pull/8529#discussion_r449604083", "createdAt": "2020-07-03T14:13:17Z", "author": {"login": "ryanemerson"}, "path": "remote-query/remote-query-server/src/main/java/org/infinispan/query/remote/impl/ProtobufMetadataManagerImpl.java", "diffHunk": "@@ -95,16 +95,24 @@ void start() {\n             getProtobufMetadataCacheConfig(globalConfiguration).build(),\n             EnumSet.of(InternalCacheRegistry.Flag.USER, InternalCacheRegistry.Flag.PROTECTED, InternalCacheRegistry.Flag.PERSISTENT));\n \n-      processSerializationContextInitializer(ServiceFinder.load(SerializationContextInitializer.class, globalConfiguration.classLoader()));\n-      processSerializationContextInitializer(globalConfiguration.serialization().contextInitializers());\n+      Collection<SerializationContextInitializer> initializers = globalConfiguration.serialization().contextInitializers();\n+      if (initializers == null || initializers.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDQwMzA0", "url": "https://github.com/infinispan/infinispan/pull/8529#pullrequestreview-442440304", "createdAt": "2020-07-03T14:13:52Z", "commit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMzo1MlrOGsxq5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMzo1MlrOGsxq5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYwNDMyNg==", "bodyText": "Should the logs be info?", "url": "https://github.com/infinispan/infinispan/pull/8529#discussion_r449604326", "createdAt": "2020-07-03T14:13:52Z", "author": {"login": "ryanemerson"}, "path": "remote-query/remote-query-server/src/main/java/org/infinispan/query/remote/impl/ProtobufMetadataManagerImpl.java", "diffHunk": "@@ -95,16 +95,24 @@ void start() {\n             getProtobufMetadataCacheConfig(globalConfiguration).build(),\n             EnumSet.of(InternalCacheRegistry.Flag.USER, InternalCacheRegistry.Flag.PROTECTED, InternalCacheRegistry.Flag.PERSISTENT));\n \n-      processSerializationContextInitializer(ServiceFinder.load(SerializationContextInitializer.class, globalConfiguration.classLoader()));\n-      processSerializationContextInitializer(globalConfiguration.serialization().contextInitializers());\n+      Collection<SerializationContextInitializer> initializers = globalConfiguration.serialization().contextInitializers();\n+      if (initializers == null || initializers.isEmpty()) {\n+         initializers = ServiceFinder.load(SerializationContextInitializer.class, globalConfiguration.classLoader());\n+      }\n+      processSerializationContextInitializer(initializers);\n       processProtostreamSerializationContextInitializers(globalConfiguration.classLoader());\n    }\n \n+   /**\n+    * @deprecated Since 10.\n+    */\n+   @Deprecated\n    private void processProtostreamSerializationContextInitializers(ClassLoader classLoader) {\n       Collection<ProtostreamSerializationContextInitializer> initializers =\n             ServiceFinder.load(ProtostreamSerializationContextInitializer.class, classLoader);\n \n       for (ProtostreamSerializationContextInitializer psci : initializers) {\n+         log.debugf(\"Registering ProtostreamSerializationContextInitializer %s\", psci.getClass().getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTE5MjIy", "url": "https://github.com/infinispan/infinispan/pull/8529#pullrequestreview-442919222", "createdAt": "2020-07-06T09:31:30Z", "commit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTozMTozMVrOGtP6sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTozMTozMVrOGtP6sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA5OTg4OQ==", "bodyText": "This was deprecated in 10.x, I think we can remove this now along with ProtostreamSerializationContextInitializer", "url": "https://github.com/infinispan/infinispan/pull/8529#discussion_r450099889", "createdAt": "2020-07-06T09:31:31Z", "author": {"login": "ryanemerson"}, "path": "remote-query/remote-query-server/src/main/java/org/infinispan/query/remote/impl/ProtobufMetadataManagerImpl.java", "diffHunk": "@@ -95,16 +95,24 @@ void start() {\n             getProtobufMetadataCacheConfig(globalConfiguration).build(),\n             EnumSet.of(InternalCacheRegistry.Flag.USER, InternalCacheRegistry.Flag.PROTECTED, InternalCacheRegistry.Flag.PERSISTENT));\n \n-      processSerializationContextInitializer(ServiceFinder.load(SerializationContextInitializer.class, globalConfiguration.classLoader()));\n-      processSerializationContextInitializer(globalConfiguration.serialization().contextInitializers());\n+      Collection<SerializationContextInitializer> initializers = globalConfiguration.serialization().contextInitializers();\n+      if (initializers == null || initializers.isEmpty()) {\n+         initializers = ServiceFinder.load(SerializationContextInitializer.class, globalConfiguration.classLoader());\n+      }\n+      processSerializationContextInitializer(initializers);\n       processProtostreamSerializationContextInitializers(globalConfiguration.classLoader());\n    }\n \n+   /**\n+    * @deprecated Since 10.\n+    */\n+   @Deprecated\n    private void processProtostreamSerializationContextInitializers(ClassLoader classLoader) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyOTI0Mzgw", "url": "https://github.com/infinispan/infinispan/pull/8529#pullrequestreview-442924380", "createdAt": "2020-07-06T09:38:52Z", "commit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTozODo1MlrOGtQJ-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwOTozODo1MlrOGtQJ-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDEwMzgwMA==", "bodyText": "I have found a bigger problem (not introduced by this PR). We're currently not registering the loaded SCIs with the SerializationContextRegistry ISPN-12093", "url": "https://github.com/infinispan/infinispan/pull/8529#discussion_r450103800", "createdAt": "2020-07-06T09:38:52Z", "author": {"login": "ryanemerson"}, "path": "remote-query/remote-query-server/src/main/java/org/infinispan/query/remote/impl/ProtobufMetadataManagerImpl.java", "diffHunk": "@@ -116,6 +124,7 @@ private void processProtostreamSerializationContextInitializers(ClassLoader clas\n    private void processSerializationContextInitializer(Iterable<SerializationContextInitializer> initializers) {\n       if (initializers != null) {\n          for (SerializationContextInitializer sci : initializers) {\n+            log.debugf(\"Registering SerializationContextInitializer %s\", sci.getClass().getName());\n             try {\n                sci.registerSchema(serCtx);\n                sci.registerMarshallers(serCtx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "efffcee1318c53a3948826a3be580d7d1b98e731", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/efffcee1318c53a3948826a3be580d7d1b98e731", "committedDate": "2020-07-03T12:55:37Z", "message": "ISPN-12036 Automatic registration of SerializationContextInitializers only if none is manually configured"}, "afterCommit": {"oid": "f486d02b527b5a5478638a7339c69a6ec631fc9c", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f486d02b527b5a5478638a7339c69a6ec631fc9c", "committedDate": "2020-07-22T11:44:59Z", "message": "ISPN-12036 Automatic registration of SerializationContextInitializers only if none is manually configured"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f486d02b527b5a5478638a7339c69a6ec631fc9c", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f486d02b527b5a5478638a7339c69a6ec631fc9c", "committedDate": "2020-07-22T11:44:59Z", "message": "ISPN-12036 Automatic registration of SerializationContextInitializers only if none is manually configured"}, "afterCommit": {"oid": "cb1112874e654674b50b627899560f3ef939aafd", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/cb1112874e654674b50b627899560f3ef939aafd", "committedDate": "2020-07-26T11:03:29Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb1112874e654674b50b627899560f3ef939aafd", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/cb1112874e654674b50b627899560f3ef939aafd", "committedDate": "2020-07-26T11:03:29Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}, "afterCommit": {"oid": "0ea9cc1c33143294d0e3a70466363312d7fcda24", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/0ea9cc1c33143294d0e3a70466363312d7fcda24", "committedDate": "2020-07-27T12:37:34Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ea9cc1c33143294d0e3a70466363312d7fcda24", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/0ea9cc1c33143294d0e3a70466363312d7fcda24", "committedDate": "2020-07-27T12:37:34Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}, "afterCommit": {"oid": "f090887b8a801a3d5c1ada11819c4db2217a3963", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f090887b8a801a3d5c1ada11819c4db2217a3963", "committedDate": "2020-09-28T18:04:55Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMjU3MTM0", "url": "https://github.com/infinispan/infinispan/pull/8529#pullrequestreview-500257134", "createdAt": "2020-10-01T11:37:49Z", "commit": {"oid": "fc17928b651203be71e639bbf5af0a8a5adc5eed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc17928b651203be71e639bbf5af0a8a5adc5eed", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/fc17928b651203be71e639bbf5af0a8a5adc5eed", "committedDate": "2020-10-01T11:34:47Z", "message": "automatic SCI registration doc update"}, "afterCommit": {"oid": "06789908f15ad5a6be9f9df3f58ceb7b0c671d51", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/06789908f15ad5a6be9f9df3f58ceb7b0c671d51", "committedDate": "2020-10-01T12:01:37Z", "message": "wip xsd docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06789908f15ad5a6be9f9df3f58ceb7b0c671d51", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/06789908f15ad5a6be9f9df3f58ceb7b0c671d51", "committedDate": "2020-10-01T12:01:37Z", "message": "wip xsd docs"}, "afterCommit": {"oid": "2de36239ae643093546c9b0becec4b24204d1f94", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/2de36239ae643093546c9b0becec4b24204d1f94", "committedDate": "2020-10-01T12:03:52Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9575eca86727b37900bc60cc9628adead662f939", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/9575eca86727b37900bc60cc9628adead662f939", "committedDate": "2020-10-01T12:17:30Z", "message": "updating to be inline with Ryan's suggestion"}, "afterCommit": {"oid": "30ed9c63f0d4422ba22fe33e4e3bfb75cd5a1a14", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/30ed9c63f0d4422ba22fe33e4e3bfb75cd5a1a14", "committedDate": "2020-10-01T12:29:10Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ed9c63f0d4422ba22fe33e4e3bfb75cd5a1a14", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/30ed9c63f0d4422ba22fe33e4e3bfb75cd5a1a14", "committedDate": "2020-10-01T12:29:10Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}, "afterCommit": {"oid": "27fd7d4b565e47a4076ff400de6e8ef2c9eb67cf", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/27fd7d4b565e47a4076ff400de6e8ef2c9eb67cf", "committedDate": "2020-10-01T19:50:40Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "407d777f068a77fe1b300485ead3b612f25c2e96", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/407d777f068a77fe1b300485ead3b612f25c2e96", "committedDate": "2020-10-01T20:11:41Z", "message": "ISPN-12036 Automatic registration of SerializationContextInitializers only if none is manually configured\n\n* automatic registration of SerializationContextInitializers is handy but can be harmfull in some non-trivial\n  situations because it prevents separation between cache managers and also does not give you any chance\n  to resolve eventual schema conflicts. In such cases we need a way to turn it off. the simplest solution\n  is to ignore CP scanning if manual configuration of the SCI list is present."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a6a8d40eea2e1374fdb53be02c99c0742beb249", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/6a6a8d40eea2e1374fdb53be02c99c0742beb249", "committedDate": "2020-10-02T09:33:39Z", "message": "ISPN-12036 Automatic SCI registration doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81481e55751d0cd3d56fd969b5f8decadc1b4de", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/d81481e55751d0cd3d56fd969b5f8decadc1b4de", "committedDate": "2020-10-02T09:33:43Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27fd7d4b565e47a4076ff400de6e8ef2c9eb67cf", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/27fd7d4b565e47a4076ff400de6e8ef2c9eb67cf", "committedDate": "2020-10-01T19:50:40Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}, "afterCommit": {"oid": "d81481e55751d0cd3d56fd969b5f8decadc1b4de", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/d81481e55751d0cd3d56fd969b5f8decadc1b4de", "committedDate": "2020-10-02T09:33:43Z", "message": "ISPN-12167 Remove the already deprecated ProtostreamSerializationContextInitializer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 500, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}