{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NTg4Mjcy", "number": 8403, "title": "ISPN-11929 Add query boolean property", "bodyText": "https://issues.redhat.com/browse/ISPN-11929", "createdAt": "2020-05-28T16:07:52Z", "url": "https://github.com/infinispan/infinispan/pull/8403", "merged": true, "mergeCommit": {"oid": "e9b49ded9ec1e97e8a2c638d763ec6a59a9de19f"}, "closed": true, "closedAt": "2020-06-02T08:19:25Z", "author": {"login": "karesti"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclwRrdAFqTQyMDI3NDcxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnQifcgFqTQyMjQ1MTQ5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMjc0NzE1", "url": "https://github.com/infinispan/infinispan/pull/8403#pullrequestreview-420274715", "createdAt": "2020-05-28T16:13:00Z", "commit": {"oid": "462d9f18dbee297ec7d558c264bed2f7ff74cdfc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMzowMVrOGb8mKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxNTowN1rOGb8swg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NzU0Nw==", "bodyText": "Should test for both MediaType.APPLICATION_PROTOSTREAM and MediaType.APPLICATION_OBJECT\nInstead of == should use .match()\ncache.getCacheConfiguration().encoding().valueDataType() can be null if I'm not mistaken", "url": "https://github.com/infinispan/infinispan/pull/8403#discussion_r431957547", "createdAt": "2020-05-28T16:13:01Z", "author": {"login": "gustavonalle"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/CacheResourceV2.java", "diffHunk": "@@ -302,6 +303,9 @@ private RestResponse getDetailResponse(NettyRestResponse.Builder responseBuilder\n       InfinispanQueryStatisticsInfo.IndexStatistics indexStatistics = getIndexStatistics(cache);\n       boolean rehashInProgress = distributionManager != null && distributionManager.isRehashInProgress();\n       boolean indexingInProgress = indexStatistics != null && indexStatistics.getReindexing();\n+      boolean indexed =  configuration.indexing().enabled();\n+      boolean query = indexed ||\n+            cache.getCacheConfiguration().encoding().valueDataType().mediaType() == MediaType.APPLICATION_PROTOSTREAM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "462d9f18dbee297ec7d558c264bed2f7ff74cdfc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1OTIzNA==", "bodyText": "queryable would be better", "url": "https://github.com/infinispan/infinispan/pull/8403#discussion_r431959234", "createdAt": "2020-05-28T16:15:07Z", "author": {"login": "gustavonalle"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/CacheResourceV2.java", "diffHunk": "@@ -404,5 +409,6 @@ private RestResponse getDetailResponse(NettyRestResponse.Builder responseBuilder\n       public boolean hasRemoteBackup;\n       public boolean indexingInProgress;\n       public boolean statistics;\n+      public boolean query;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "462d9f18dbee297ec7d558c264bed2f7ff74cdfc"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "462d9f18dbee297ec7d558c264bed2f7ff74cdfc", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/462d9f18dbee297ec7d558c264bed2f7ff74cdfc", "committedDate": "2020-05-28T16:07:05Z", "message": "ISPN-11929 Add query boolean property"}, "afterCommit": {"oid": "332ad8b6112d7d6826a6f91a73e5ae4bd7a2f049", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/332ad8b6112d7d6826a6f91a73e5ae4bd7a2f049", "committedDate": "2020-05-28T20:52:44Z", "message": "ISPN-11929 Add query boolean property"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "332ad8b6112d7d6826a6f91a73e5ae4bd7a2f049", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/332ad8b6112d7d6826a6f91a73e5ae4bd7a2f049", "committedDate": "2020-05-28T20:52:44Z", "message": "ISPN-11929 Add query boolean property"}, "afterCommit": {"oid": "60c6215dad05603a0e3f54e047f1584f308854e5", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/60c6215dad05603a0e3f54e047f1584f308854e5", "committedDate": "2020-05-29T08:56:29Z", "message": "ISPN-11929 Add query boolean property"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60c6215dad05603a0e3f54e047f1584f308854e5", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/60c6215dad05603a0e3f54e047f1584f308854e5", "committedDate": "2020-05-29T08:56:29Z", "message": "ISPN-11929 Add query boolean property"}, "afterCommit": {"oid": "714efea0e49c486ff0a321a9216cc0ccc797584f", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/714efea0e49c486ff0a321a9216cc0ccc797584f", "committedDate": "2020-05-29T10:21:56Z", "message": "ISPN-11929 Add query boolean property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1", "committedDate": "2020-05-29T10:23:20Z", "message": "ISPN-11929 Add query boolean property"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "714efea0e49c486ff0a321a9216cc0ccc797584f", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/714efea0e49c486ff0a321a9216cc0ccc797584f", "committedDate": "2020-05-29T10:21:56Z", "message": "ISPN-11929 Add query boolean property"}, "afterCommit": {"oid": "1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1", "author": {"user": {"login": "karesti", "name": "Katia Aresti"}}, "url": "https://github.com/infinispan/infinispan/commit/1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1", "committedDate": "2020-05-29T10:23:20Z", "message": "ISPN-11929 Add query boolean property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwOTMzMDMy", "url": "https://github.com/infinispan/infinispan/pull/8403#pullrequestreview-420933032", "createdAt": "2020-05-29T13:07:10Z", "commit": {"oid": "1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNDUxNDk3", "url": "https://github.com/infinispan/infinispan/pull/8403#pullrequestreview-422451497", "createdAt": "2020-06-02T08:25:17Z", "commit": {"oid": "1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwODoyNToxN1rOGdnRqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwODoyNToxN1rOGdnRqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcwNTM4NA==", "bodyText": "It's wrong to assume a cache without an explicit encoding configuration is not queryable, because depending on the storage type it will either use APPLICATION_OBJECT or the user marshaller's media type (which is APPLICATION_PROTOSTREAM with the default serialization configuration).\nYou should use cache.getValueDataConversion().getStorageMediaType() to get the actual media type, but I'd much rather make this a method in query-core", "url": "https://github.com/infinispan/infinispan/pull/8403#discussion_r433705384", "createdAt": "2020-06-02T08:25:17Z", "author": {"login": "danberindei"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/CacheResourceV2.java", "diffHunk": "@@ -302,7 +303,11 @@ private RestResponse getDetailResponse(NettyRestResponse.Builder responseBuilder\n       InfinispanQueryStatisticsInfo.IndexStatistics indexStatistics = getIndexStatistics(cache);\n       boolean rehashInProgress = distributionManager != null && distributionManager.isRehashInProgress();\n       boolean indexingInProgress = indexStatistics != null && indexStatistics.getReindexing();\n-\n+      boolean indexed =  configuration.indexing().enabled();\n+      ContentTypeConfiguration valueDataType = cache.getCacheConfiguration().encoding().valueDataType();\n+      boolean queryable = indexed || (valueDataType != null && valueDataType.mediaType()!= null &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d758ad05f9308c2ef7c7a5da05e16d2b1b429f1"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 682, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}