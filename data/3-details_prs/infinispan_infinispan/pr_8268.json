{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMzM5MzY5", "number": 8268, "title": "ISPN-11756 Deprecate IndexingConfiguration.indexShareable() and remov\u2026", "bodyText": "\u2026e all its usages\n\n\nthis should always return false starting with 11\nhttps://issues.redhat.com/browse/ISPN-11756\n\n\nrebuild volatile index on store preload\nhttps://issues.redhat.com/browse/ISPN-11760\n\n\nTo validate ISPN-11670, modify locally IndexingConfiguration.isVolatile to always return false and then execute SharedCacheLoaderQueryIndexTest to see it fail", "createdAt": "2020-04-30T10:48:25Z", "url": "https://github.com/infinispan/infinispan/pull/8268", "merged": true, "mergeCommit": {"oid": "635a0afdefd850d77ddd80db550dbb9745477680"}, "closed": true, "closedAt": "2020-05-06T09:12:03Z", "author": {"login": "anistor"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcctDkJgBqjMyODkzNzI1ODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceByS1gBqjMzMDA2MDIzODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8208d25d255d7c17608191dfc7e9dad0e2aa2200", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/8208d25d255d7c17608191dfc7e9dad0e2aa2200", "committedDate": "2020-04-30T10:39:57Z", "message": "ISPN-11756 Deprecate IndexingConfiguration.indexShareable() and remove all its usages\n\n* this should always return false starting with 11"}, "afterCommit": {"oid": "86ca221f7497e33e959156687a1ee8e469b60cf0", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/86ca221f7497e33e959156687a1ee8e469b60cf0", "committedDate": "2020-04-30T13:25:17Z", "message": "ISPN-11757 Do not allow multiple indexing providers per cache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86ca221f7497e33e959156687a1ee8e469b60cf0", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/86ca221f7497e33e959156687a1ee8e469b60cf0", "committedDate": "2020-04-30T13:25:17Z", "message": "ISPN-11757 Do not allow multiple indexing providers per cache"}, "afterCommit": {"oid": "604228ab5e2cd8d575c4f6763b49218ce1b5b054", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/604228ab5e2cd8d575c4f6763b49218ce1b5b054", "committedDate": "2020-05-01T00:17:48Z", "message": "WIP reindex volatile"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "604228ab5e2cd8d575c4f6763b49218ce1b5b054", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/604228ab5e2cd8d575c4f6763b49218ce1b5b054", "committedDate": "2020-05-01T00:17:48Z", "message": "WIP reindex volatile"}, "afterCommit": {"oid": "8effb63fd69cf2fbd442c5bf92b6f447f2d95a1f", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/8effb63fd69cf2fbd442c5bf92b6f447f2d95a1f", "committedDate": "2020-05-01T07:58:17Z", "message": "WIP Reindex on preload if index provider is volatile"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8effb63fd69cf2fbd442c5bf92b6f447f2d95a1f", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/8effb63fd69cf2fbd442c5bf92b6f447f2d95a1f", "committedDate": "2020-05-01T07:58:17Z", "message": "WIP Reindex on preload if index provider is volatile"}, "afterCommit": {"oid": "6f42a5fdb41495e48b40d873934994f3322e88b1", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/6f42a5fdb41495e48b40d873934994f3322e88b1", "committedDate": "2020-05-01T08:25:32Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDcwMDYz", "url": "https://github.com/infinispan/infinispan/pull/8268#pullrequestreview-404070063", "createdAt": "2020-05-01T08:37:07Z", "commit": {"oid": "6f42a5fdb41495e48b40d873934994f3322e88b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODozNzowN1rOGPE89A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODozNzowN1rOGPE89A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2Mjk2NA==", "bodyText": "The current form of this boolean condition is based on its previous + the need to re-index if the indexing provider is volatile. The two put together ... look odd to me @gustavonalle", "url": "https://github.com/infinispan/infinispan/pull/8268#discussion_r418462964", "createdAt": "2020-05-01T08:37:07Z", "author": {"login": "anistor"}, "path": "core/src/main/java/org/infinispan/persistence/manager/PersistenceManagerImpl.java", "diffHunk": "@@ -1261,33 +1261,26 @@ private long getFlagsForStateInsertion() {\n             FlagBitSets.SKIP_LOCKING |\n             FlagBitSets.SKIP_XSITE_BACKUP;\n \n-      boolean hasShared = false;\n+      boolean hasSharedStore = false;\n       acquireReadLock();\n       try {\n          for (CacheWriter w : nonTxWriters) {\n             if (getStoreConfig(w).shared()) {\n-               hasShared = true;\n+               hasSharedStore = true;\n                break;\n             }\n          }\n       } finally {\n          releaseReadLock();\n       }\n \n-      if (hasShared) {\n-         if (indexShareable())\n-            flags = EnumUtil.mergeBitSets(flags, FlagBitSets.SKIP_INDEXING);\n-      } else {\n+      if (!hasSharedStore && !configuration.indexing().isVolatile()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f42a5fdb41495e48b40d873934994f3322e88b1"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f42a5fdb41495e48b40d873934994f3322e88b1", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/6f42a5fdb41495e48b40d873934994f3322e88b1", "committedDate": "2020-05-01T08:25:32Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "06027d588864930112e87d85c331eba4faf75f84", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/06027d588864930112e87d85c331eba4faf75f84", "committedDate": "2020-05-01T09:56:20Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06027d588864930112e87d85c331eba4faf75f84", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/06027d588864930112e87d85c331eba4faf75f84", "committedDate": "2020-05-01T09:56:20Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "75c6e79133720a6cd75ee2f1654ec90bf7b77589", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/75c6e79133720a6cd75ee2f1654ec90bf7b77589", "committedDate": "2020-05-01T10:15:43Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75c6e79133720a6cd75ee2f1654ec90bf7b77589", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/75c6e79133720a6cd75ee2f1654ec90bf7b77589", "committedDate": "2020-05-01T10:15:43Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "5ed6ff39f3e1c36c9af57ec5a9a54c0d6fff4826", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/5ed6ff39f3e1c36c9af57ec5a9a54c0d6fff4826", "committedDate": "2020-05-01T12:56:46Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ed6ff39f3e1c36c9af57ec5a9a54c0d6fff4826", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/5ed6ff39f3e1c36c9af57ec5a9a54c0d6fff4826", "committedDate": "2020-05-01T12:56:46Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "68ee3f8724b8e86142dca6bdd11ecd9b703b4069", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/68ee3f8724b8e86142dca6bdd11ecd9b703b4069", "committedDate": "2020-05-01T14:42:12Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTI4NzU2", "url": "https://github.com/infinispan/infinispan/pull/8268#pullrequestreview-404528756", "createdAt": "2020-05-02T13:32:43Z", "commit": {"oid": "68ee3f8724b8e86142dca6bdd11ecd9b703b4069"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68ee3f8724b8e86142dca6bdd11ecd9b703b4069", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/68ee3f8724b8e86142dca6bdd11ecd9b703b4069", "committedDate": "2020-05-01T14:42:12Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "e94355e9366ae1557ae84ac8a35a20c7f045ede7", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/e94355e9366ae1557ae84ac8a35a20c7f045ede7", "committedDate": "2020-05-03T08:13:10Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e94355e9366ae1557ae84ac8a35a20c7f045ede7", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/e94355e9366ae1557ae84ac8a35a20c7f045ede7", "committedDate": "2020-05-03T08:13:10Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "9610fac93e293feebe18fca393804eb66433eb42", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/9610fac93e293feebe18fca393804eb66433eb42", "committedDate": "2020-05-03T20:15:04Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9610fac93e293feebe18fca393804eb66433eb42", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/9610fac93e293feebe18fca393804eb66433eb42", "committedDate": "2020-05-03T20:15:04Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "f54c2367103630d8e236e4d89895acc293a0a45e", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f54c2367103630d8e236e4d89895acc293a0a45e", "committedDate": "2020-05-04T13:57:57Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0db279d44389101f6bfdd7d9063b08dc375cba9c", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/0db279d44389101f6bfdd7d9063b08dc375cba9c", "committedDate": "2020-05-04T16:05:55Z", "message": "ISPN-11756 Deprecate IndexingConfiguration.indexShareable() and remove all its usages\n\n* this should always return false starting with 11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f56b940f91bcbf529a0838c2ab101b878fa38ff9", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f56b940f91bcbf529a0838c2ab101b878fa38ff9", "committedDate": "2020-05-04T16:08:20Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f54c2367103630d8e236e4d89895acc293a0a45e", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f54c2367103630d8e236e4d89895acc293a0a45e", "committedDate": "2020-05-04T13:57:57Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}, "afterCommit": {"oid": "f56b940f91bcbf529a0838c2ab101b878fa38ff9", "author": {"user": {"login": "anistor", "name": "Adrian Nistor"}}, "url": "https://github.com/infinispan/infinispan/commit/f56b940f91bcbf529a0838c2ab101b878fa38ff9", "committedDate": "2020-05-04T16:08:20Z", "message": "ISPN-11760 Volatile indexes should be rebuilt on store preload"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 937, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}