{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NjQ3ODY0", "number": 8243, "title": "ISPN-11626 Server report", "bodyText": "https://issues.redhat.com/browse/ISPN-11626\n\n report generation\n REST endpoint\n CLI command\n documentation", "createdAt": "2020-04-24T16:26:18Z", "url": "https://github.com/infinispan/infinispan/pull/8243", "merged": true, "mergeCommit": {"oid": "6b7f2d8fb43d0d79807f6190ae741d97ad5d8842"}, "closed": true, "closedAt": "2020-05-19T14:35:14Z", "author": {"login": "tristantarrant"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbrjLpgFqTQwMDc1OTQ5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABciw1xYgFqTQxNDI1NDQ1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzU5NDkx", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-400759491", "createdAt": "2020-04-27T09:02:03Z", "commit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTowMjowM1rOGMYjiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTowNTo1M1rOGMYtuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYzODQwOQ==", "bodyText": "Better to define a constant MediaType.APPLICATION_GZIP", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r415638409", "createdAt": "2020-04-27T09:02:03Z", "author": {"login": "gustavonalle"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/ServerResource.java", "diffHunk": "@@ -122,6 +125,26 @@ public Invocations getInvocations() {\n             .build());\n    }\n \n+   private CompletionStage<RestResponse> report(RestRequest restRequest) {\n+      ServerManagement server = invocationHelper.getServer();\n+      NettyRestResponse.Builder responseBuilder = new NettyRestResponse.Builder();\n+      return server.getServerReport().handle((path, t) -> {\n+         if (t != null) {\n+            return responseBuilder.status(HttpResponseStatus.INTERNAL_SERVER_ERROR).build();\n+         } else {\n+            return responseBuilder\n+                  .contentType(MediaType.fromString(\"application/gzip\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYzOTQ3NA==", "bodyText": "What is this header for?", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r415639474", "createdAt": "2020-04-27T09:03:36Z", "author": {"login": "gustavonalle"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/ServerResource.java", "diffHunk": "@@ -122,6 +125,26 @@ public Invocations getInvocations() {\n             .build());\n    }\n \n+   private CompletionStage<RestResponse> report(RestRequest restRequest) {\n+      ServerManagement server = invocationHelper.getServer();\n+      NettyRestResponse.Builder responseBuilder = new NettyRestResponse.Builder();\n+      return server.getServerReport().handle((path, t) -> {\n+         if (t != null) {\n+            return responseBuilder.status(HttpResponseStatus.INTERNAL_SERVER_ERROR).build();\n+         } else {\n+            return responseBuilder\n+                  .contentType(MediaType.fromString(\"application/gzip\"))\n+                  .header(\"Content-Disposition\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY0MTAxOQ==", "bodyText": "Is Windows going to be handled? It probably needs to return 501 from the REST endpoint", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r415641019", "createdAt": "2020-04-27T09:05:53Z", "author": {"login": "gustavonalle"}, "path": "server/runtime/src/main/java/org/infinispan/server/Server.java", "diffHunk": "@@ -536,4 +545,24 @@ public ComponentStatus getStatus() {\n    public TaskManager getTaskManager() {\n       return taskManager;\n    }\n+\n+   @Override\n+   public CompletionStage<Path> getServerReport() {\n+      return CompletableFuture.supplyAsync(() -> {\n+         Path home = serverHome.toPath();\n+         ProcessBuilder builder = new ProcessBuilder(\"sh\", \"-c\", home.resolve(\"bin/report.sh\").toString(), home.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNjQ3MzQ1", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-401647345", "createdAt": "2020-04-28T09:14:15Z", "commit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxNDoxNVrOGNKmjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMDoxNjo1OVrOGNNBGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1ODM4Mg==", "bodyText": "will not work if two instances are running\npgrep -P 1234 5678\nwill return nothing RHEL7", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r416458382", "createdAt": "2020-04-28T09:14:15Z", "author": {"login": "wfink"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,36 @@\n+#!/bin/sh\n+\n+PROGNAME=`basename \"$0\"`\n+DIRNAME=`dirname \"$0\"`\n+\n+# Setup ISPN_HOME\n+if [ \"x$1\" = \"x\" ]; then\n+  ISPN_HOME=`cd \"$DIRNAME/..\" >/dev/null; pwd`\n+else\n+  ISPN_HOME=$1\n+fi\n+\n+\n+TMPDIR=`mktemp --tmpdir -d infinispan-server.XXXXXX`\n+PPID=`pgrep server.sh`\n+PID=`pgrep -P $PPID`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ2MDMyMw==", "bodyText": "tar will fail if there is no cache created at runtime, consider the caches might be configured only static\nalso collected files are not included\nchange line tar to\nISPN_CACHES=\"\"\n[ -e $ISPN_HOME/server/data/caches.xml ] && ISPN_CACHES=\"server/data/caches.xml\"\ntar czf $TMPDIR.tar.gz -C $TMPDIR os-release ip-address ip-route ip-maddress cpuinfo meminfo uname df ss-tcp ss-udp lsof thread-dump -C $ISPN_HOME server/conf server/log server/data/___global.state $ISPN_CACHES", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r416460323", "createdAt": "2020-04-28T09:17:11Z", "author": {"login": "wfink"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,36 @@\n+#!/bin/sh\n+\n+PROGNAME=`basename \"$0\"`\n+DIRNAME=`dirname \"$0\"`\n+\n+# Setup ISPN_HOME\n+if [ \"x$1\" = \"x\" ]; then\n+  ISPN_HOME=`cd \"$DIRNAME/..\" >/dev/null; pwd`\n+else\n+  ISPN_HOME=$1\n+fi\n+\n+\n+TMPDIR=`mktemp --tmpdir -d infinispan-server.XXXXXX`\n+PPID=`pgrep server.sh`\n+PID=`pgrep -P $PPID`\n+\n+# Gather information about the system\n+cp /etc/os-release $TMPDIR/os-release\n+ip address > $TMPDIR/ip-address\n+ip route > $TMPDIR/ip-route\n+ip maddress > $TMPDIR/ip-maddress\n+ip mroute > $TMPDIR/ip-maddress\n+cat /proc/cpuinfo > $TMPDIR/cpuinfo\n+cat /proc/meminfo > $TMPDIR/cpuinfo\n+uname -a > $TMPDIR/uname\n+df -h > $TMPDIR/df\n+ss -t -a > $TMPDIR/ss-tcp\n+ss -u -a > $TMPDIR/ss-udp\n+lsof / > $TMPDIR/lsof 2> /dev/null\n+jstack $PID > $TMPDIR/thread-dump\n+\n+tar czf $TMPDIR.tar.gz -C $TMPDIR . -C $ISPN_HOME server/conf server/log server/data/caches.xml server/data/___global.state", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3MzIwNA==", "bodyText": "$TMPDIR/meminfo !", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r416473204", "createdAt": "2020-04-28T09:37:10Z", "author": {"login": "wfink"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,36 @@\n+#!/bin/sh\n+\n+PROGNAME=`basename \"$0\"`\n+DIRNAME=`dirname \"$0\"`\n+\n+# Setup ISPN_HOME\n+if [ \"x$1\" = \"x\" ]; then\n+  ISPN_HOME=`cd \"$DIRNAME/..\" >/dev/null; pwd`\n+else\n+  ISPN_HOME=$1\n+fi\n+\n+\n+TMPDIR=`mktemp --tmpdir -d infinispan-server.XXXXXX`\n+PPID=`pgrep server.sh`\n+PID=`pgrep -P $PPID`\n+\n+# Gather information about the system\n+cp /etc/os-release $TMPDIR/os-release\n+ip address > $TMPDIR/ip-address\n+ip route > $TMPDIR/ip-route\n+ip maddress > $TMPDIR/ip-maddress\n+ip mroute > $TMPDIR/ip-maddress\n+cat /proc/cpuinfo > $TMPDIR/cpuinfo\n+cat /proc/meminfo > $TMPDIR/cpuinfo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ5NzEyMw==", "bodyText": "script will grab the log/conf from the instance where the script is located. Not from the instance the process is found\nI know path can be set but would be perfect if verified with the process as it can be very confusing when analyzing.\nMaybe adding the full path as information to the tar will help as a simple solution", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r416497123", "createdAt": "2020-04-28T10:15:43Z", "author": {"login": "wfink"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,36 @@\n+#!/bin/sh\n+\n+PROGNAME=`basename \"$0\"`\n+DIRNAME=`dirname \"$0\"`\n+\n+# Setup ISPN_HOME\n+if [ \"x$1\" = \"x\" ]; then\n+  ISPN_HOME=`cd \"$DIRNAME/..\" >/dev/null; pwd`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ5Nzk0Nw==", "bodyText": "Hardcoded 'server/*' will go wrong if the server has been started with \"-s \" option so the directory is wrong", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r416497947", "createdAt": "2020-04-28T10:16:59Z", "author": {"login": "wfink"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,36 @@\n+#!/bin/sh\n+\n+PROGNAME=`basename \"$0\"`\n+DIRNAME=`dirname \"$0\"`\n+\n+# Setup ISPN_HOME\n+if [ \"x$1\" = \"x\" ]; then\n+  ISPN_HOME=`cd \"$DIRNAME/..\" >/dev/null; pwd`\n+else\n+  ISPN_HOME=$1\n+fi\n+\n+\n+TMPDIR=`mktemp --tmpdir -d infinispan-server.XXXXXX`\n+PPID=`pgrep server.sh`\n+PID=`pgrep -P $PPID`\n+\n+# Gather information about the system\n+cp /etc/os-release $TMPDIR/os-release\n+ip address > $TMPDIR/ip-address\n+ip route > $TMPDIR/ip-route\n+ip maddress > $TMPDIR/ip-maddress\n+ip mroute > $TMPDIR/ip-maddress\n+cat /proc/cpuinfo > $TMPDIR/cpuinfo\n+cat /proc/meminfo > $TMPDIR/cpuinfo\n+uname -a > $TMPDIR/uname\n+df -h > $TMPDIR/df\n+ss -t -a > $TMPDIR/ss-tcp\n+ss -u -a > $TMPDIR/ss-udp\n+lsof / > $TMPDIR/lsof 2> /dev/null\n+jstack $PID > $TMPDIR/thread-dump\n+\n+tar czf $TMPDIR.tar.gz -C $TMPDIR . -C $ISPN_HOME server/conf server/log server/data/caches.xml server/data/___global.state", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ2MDMyMw=="}, "originalCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0987dd20f5aad618484fb1adbd5334314742a6c6", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/0987dd20f5aad618484fb1adbd5334314742a6c6", "committedDate": "2020-04-24T16:24:22Z", "message": "ISPN-11626 Server report"}, "afterCommit": {"oid": "a84bf1555f38e25aad96b8ace931770ad369da8e", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/a84bf1555f38e25aad96b8ace931770ad369da8e", "committedDate": "2020-05-07T13:47:15Z", "message": "ISPN-11626 Server report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a84bf1555f38e25aad96b8ace931770ad369da8e", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/a84bf1555f38e25aad96b8ace931770ad369da8e", "committedDate": "2020-05-07T13:47:15Z", "message": "ISPN-11626 Server report"}, "afterCommit": {"oid": "8c4372243fc866b0e44bcad8bc2a47a02b6bfa94", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/8c4372243fc866b0e44bcad8bc2a47a02b6bfa94", "committedDate": "2020-05-07T13:57:13Z", "message": "ISPN-11626 Server report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzA4NTQy", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-408308542", "createdAt": "2020-05-08T15:09:59Z", "commit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNToxMDowMFrOGSpAMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTozNzoyNlrOGSp5HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5OTM0NA==", "bodyText": "print help all the time?\nthe command > server alone isn't valid.", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422199344", "createdAt": "2020-05-08T15:10:00Z", "author": {"login": "pruivo"}, "path": "cli/cli-client/src/main/java/org/infinispan/cli/commands/Server.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package org.infinispan.cli.commands;\n+\n+import org.aesh.command.Command;\n+import org.aesh.command.CommandDefinition;\n+import org.aesh.command.CommandResult;\n+import org.aesh.command.GroupCommandDefinition;\n+import org.infinispan.cli.activators.ConnectionActivator;\n+import org.infinispan.cli.impl.ContextAwareCommandInvocation;\n+import org.kohsuke.MetaInfServices;\n+\n+/**\n+ * @author Tristan Tarrant &lt;tristan@infinispan.org&gt;\n+ * @since 11.0\n+ **/\n+@MetaInfServices(Command.class)\n+@GroupCommandDefinition(name = Server.CMD, description = \"Obtains information about the server\", activator = ConnectionActivator.class, groupCommands = {Server.Report.class})\n+public class Server extends CliCommand {\n+\n+   public static final String CMD = \"server\";\n+   public static final String TYPE = \"type\";\n+   public static final String NAME = \"name\";\n+\n+   @Override\n+   public CommandResult exec(ContextAwareCommandInvocation commandInvocation) {\n+      if (help) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwOTYwOA==", "bodyText": "nitpick: you don't need the ForkJoinPool.commonPool(). It is used by default.", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422209608", "createdAt": "2020-05-08T15:29:20Z", "author": {"login": "pruivo"}, "path": "server/runtime/src/main/java/org/infinispan/server/Server.java", "diffHunk": "@@ -536,4 +548,35 @@ public ComponentStatus getStatus() {\n    public TaskManager getTaskManager() {\n       return taskManager;\n    }\n+\n+   @Override\n+   public CompletionStage<Path> getServerReport() {\n+      long pid = ProcessInfo.getInstance().getPid();\n+      Path home = serverHome.toPath();\n+      Path root = serverRoot.toPath();\n+      ProcessBuilder builder = new ProcessBuilder();\n+      OS os = OS.getCurrentOs();\n+      switch (os) {\n+         case LINUX:\n+            builder.command(\"sh\", \"-c\", home.resolve(\"bin/report.sh\").toString(), Long.toString(pid), root.toString());\n+            break;\n+         default:\n+            return CompletableFutures.completedExceptionFuture(log.serverReportUnavailable(os));\n+      }\n+\n+      return CompletableFuture.supplyAsync(() -> {\n+         try {\n+            Process process = builder.start();\n+            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));\n+            Path path = Paths.get(reader.readLine());\n+            process.waitFor(1, TimeUnit.MINUTES);\n+            return path;\n+         } catch (IOException e) {\n+            throw new RuntimeException(e);\n+         } catch (InterruptedException e) {\n+            Thread.currentThread().interrupt();\n+            throw new RuntimeException(e);\n+         }\n+      }, ForkJoinPool.commonPool());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMDMxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  long pid = ProcessInfo.getInstance().getPid();\n          \n          \n            \n                  Path home = serverHome.toPath();\n          \n          \n            \n                  Path root = serverRoot.toPath();\n          \n          \n            \n                  ProcessBuilder builder = new ProcessBuilder();\n          \n          \n            \n                  OS os = OS.getCurrentOs();\n          \n          \n            \n                  switch (os) {\n          \n          \n            \n                     case LINUX:\n          \n          \n            \n                        builder.command(\"sh\", \"-c\", home.resolve(\"bin/report.sh\").toString(), Long.toString(pid), root.toString());\n          \n          \n            \n                        break;\n          \n          \n            \n                     default:\n          \n          \n            \n                        return CompletableFutures.completedExceptionFuture(log.serverReportUnavailable(os));\n          \n          \n            \n                  }\n          \n          \n            \n                  OS os = OS.getCurrentOs();\n          \n          \n            \n                  if (os != OS.LINUX) {\n          \n          \n            \n                     return CompletableFutures.completedExceptionFuture(log.serverReportUnavailable(os));\n          \n          \n            \n                  }\n          \n          \n            \n                  \n          \n          \n            \n                  long pid = ProcessInfo.getInstance().getPid();\n          \n          \n            \n                  Path home = serverHome.toPath();\n          \n          \n            \n                  Path root = serverRoot.toPath();\n          \n          \n            \n                  ProcessBuilder builder = new ProcessBuilder();\n          \n          \n            \n                  builder.command(\"sh\", \"-c\", home.resolve(\"bin/report.sh\").toString(), Long.toString(pid), root.toString());", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422210315", "createdAt": "2020-05-08T15:30:43Z", "author": {"login": "pruivo"}, "path": "server/runtime/src/main/java/org/infinispan/server/Server.java", "diffHunk": "@@ -536,4 +548,35 @@ public ComponentStatus getStatus() {\n    public TaskManager getTaskManager() {\n       return taskManager;\n    }\n+\n+   @Override\n+   public CompletionStage<Path> getServerReport() {\n+      long pid = ProcessInfo.getInstance().getPid();\n+      Path home = serverHome.toPath();\n+      Path root = serverRoot.toPath();\n+      ProcessBuilder builder = new ProcessBuilder();\n+      OS os = OS.getCurrentOs();\n+      switch (os) {\n+         case LINUX:\n+            builder.command(\"sh\", \"-c\", home.resolve(\"bin/report.sh\").toString(), Long.toString(pid), root.toString());\n+            break;\n+         default:\n+            return CompletableFutures.completedExceptionFuture(log.serverReportUnavailable(os));\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMTA1NQ==", "bodyText": "PPID is read-only", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422211055", "createdAt": "2020-05-08T15:32:01Z", "author": {"login": "pruivo"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,65 @@\n+#!/bin/sh\n+\n+PROGNAME=$(basename \"$0\")\n+DIRNAME=$(dirname \"$0\")\n+\n+count() { echo $#; }\n+\n+# Get the PID\n+if [ \"x$1\" = \"x\" ]; then\n+  # There may be more than one\n+  PPID=$(pgrep server.sh)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMTI5Mg==", "bodyText": "typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ip mroute > \"$TMPDIR/ip-maddress\"\n          \n          \n            \n            ip mroute > \"$TMPDIR/ip-mroute\"", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422211292", "createdAt": "2020-05-08T15:32:24Z", "author": {"login": "pruivo"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,65 @@\n+#!/bin/sh\n+\n+PROGNAME=$(basename \"$0\")\n+DIRNAME=$(dirname \"$0\")\n+\n+count() { echo $#; }\n+\n+# Get the PID\n+if [ \"x$1\" = \"x\" ]; then\n+  # There may be more than one\n+  PPID=$(pgrep server.sh)\n+  PPID_COUNT=$(count $PPID)\n+  if [ \"$PPID_COUNT\" -gt \"1\" ]; then\n+    printf \"Multiple processes detected. Specify one of the following PIDs as the first argument:\\n %s\" \"$PPID\"\n+    exit 1\n+  fi\n+  PID=$(pgrep -P $PPID)\n+else\n+  PID=$1\n+  shift\n+fi\n+\n+TMPDIR=$(mktemp --tmpdir -d infinispan-server.XXXXXX)\n+\n+# Gather information about the system\n+cp /etc/os-release \"$TMPDIR/os-release\"\n+ip address > \"$TMPDIR/ip-address\"\n+ip route > \"$TMPDIR/ip-route\"\n+ip maddress > \"$TMPDIR/ip-maddress\"\n+ip mroute > \"$TMPDIR/ip-maddress\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMjI5MA==", "bodyText": "old code?", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422212290", "createdAt": "2020-05-08T15:34:18Z", "author": {"login": "pruivo"}, "path": "server/runtime/src/main/server/bin/report.sh", "diffHunk": "@@ -0,0 +1,65 @@\n+#!/bin/sh\n+\n+PROGNAME=$(basename \"$0\")\n+DIRNAME=$(dirname \"$0\")\n+\n+count() { echo $#; }\n+\n+# Get the PID\n+if [ \"x$1\" = \"x\" ]; then\n+  # There may be more than one\n+  PPID=$(pgrep server.sh)\n+  PPID_COUNT=$(count $PPID)\n+  if [ \"$PPID_COUNT\" -gt \"1\" ]; then\n+    printf \"Multiple processes detected. Specify one of the following PIDs as the first argument:\\n %s\" \"$PPID\"\n+    exit 1\n+  fi\n+  PID=$(pgrep -P $PPID)\n+else\n+  PID=$1\n+  shift\n+fi\n+\n+TMPDIR=$(mktemp --tmpdir -d infinispan-server.XXXXXX)\n+\n+# Gather information about the system\n+cp /etc/os-release \"$TMPDIR/os-release\"\n+ip address > \"$TMPDIR/ip-address\"\n+ip route > \"$TMPDIR/ip-route\"\n+ip maddress > \"$TMPDIR/ip-maddress\"\n+ip mroute > \"$TMPDIR/ip-maddress\"\n+cat /proc/cpuinfo > \"$TMPDIR/cpuinfo\"\n+cat /proc/meminfo > \"$TMPDIR/meminfo\"\n+uname -a > \"$TMPDIR/uname\"\n+df -h > \"$TMPDIR/df\"\n+ss -t -a > \"$TMPDIR/ss-tcp\"\n+ss -u -a > \"$TMPDIR/ss-udp\"\n+lsof / > \"$TMPDIR/lsof\" 2> /dev/null\n+\n+# Setup ISPN_HOME\n+ISPN_HOME=$(cd \"$DIRNAME/..\" > /dev/null; pwd)\n+\n+# Setup ISPN_ROOT\n+if [ \"x$1\" = \"x\" ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMzkxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Downloaded report 'infinispan-<hostname>-<timestamp>-report.tar.gz'\n          \n          \n            \n            Downloaded report '{brandname}-<hostname>-<timestamp>-report.tar.gz'\n          \n      \n    \n    \n  \n\nif brandname is resolved.", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422213917", "createdAt": "2020-05-08T15:37:26Z", "author": {"login": "pruivo"}, "path": "documentation/src/main/asciidoc/topics/proc_cli_getting_server_reports.adoc", "diffHunk": "@@ -0,0 +1,26 @@\n+[id='server_reports-{context}']\n+= Getting Diagnostic Reports for {brandname} Servers\n+{brandname} servers provide aggregated reports in `tar.gz` archives that\n+contain diagnostic information about both the {brandname} server and the host.\n+The report provides details about CPU, memory, open files, network sockets and\n+routing, threads, in addition to configuration and log files.\n+\n+.Prerequisites\n+\n+* Open a CLI connection to {brandname}.\n+\n+.Procedure\n+\n+. Use the `server report` command to download a `tar.gz` archive:\n++\n+----\n+[//containers/default]> server report\n+Downloaded report 'infinispan-<hostname>-<timestamp>-report.tar.gz'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36930b9657389fc092009afa3f28b38f0910e475", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/36930b9657389fc092009afa3f28b38f0910e475", "committedDate": "2020-05-07T15:06:42Z", "message": "add troubleshooting chapter to server docs"}, "afterCommit": {"oid": "bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3", "committedDate": "2020-05-08T15:59:23Z", "message": "ISPN-11626 Server report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzY1OTg5", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-408365989", "createdAt": "2020-05-08T16:38:17Z", "commit": {"oid": "bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozODoxOFrOGSrzaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozODoxOFrOGSrzaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0NTIyNQ==", "bodyText": "@oraNod is there a way to resolve attributes inside code blocks as above?\nThis is not being resolved. The HTML shows ${brandname}", "url": "https://github.com/infinispan/infinispan/pull/8243#discussion_r422245225", "createdAt": "2020-05-08T16:38:18Z", "author": {"login": "pruivo"}, "path": "documentation/src/main/asciidoc/topics/proc_cli_getting_server_reports.adoc", "diffHunk": "@@ -0,0 +1,26 @@\n+[id='server_reports-{context}']\n+= Getting Diagnostic Reports for {brandname} Servers\n+{brandname} servers provide aggregated reports in `tar.gz` archives that\n+contain diagnostic information about both the {brandname} server and the host.\n+The report provides details about CPU, memory, open files, network sockets and\n+routing, threads, in addition to configuration and log files.\n+\n+.Prerequisites\n+\n+* Open a CLI connection to {brandname}.\n+\n+.Procedure\n+\n+. Use the `server report` command to download a `tar.gz` archive:\n++\n+----\n+[//containers/default]> server report\n+Downloaded report '${brandname}-<hostname>-<timestamp>-report.tar.gz'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzY2Nzkw", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-408366790", "createdAt": "2020-05-08T16:39:32Z", "commit": {"oid": "bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/bab8f8a8ff3a6f97184cf67f7158fa1c722f6cd3", "committedDate": "2020-05-08T15:59:23Z", "message": "ISPN-11626 Server report"}, "afterCommit": {"oid": "39a3185b5239644b4bc5e5319ed846b2f6c53f83", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/39a3185b5239644b4bc5e5319ed846b2f6c53f83", "committedDate": "2020-05-08T16:53:21Z", "message": "ISPN-11626 Server report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b66eb24f12555bc4be251ba57c84ce0acec2048", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/5b66eb24f12555bc4be251ba57c84ce0acec2048", "committedDate": "2020-05-08T17:04:35Z", "message": "Update proc_cli_getting_server_reports.adoc\n\nadding tags to code block to resolve variables. updating link."}, "afterCommit": {"oid": "ce1135c4a3204fcc2b7e458f49311d838c43d2d3", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/ce1135c4a3204fcc2b7e458f49311d838c43d2d3", "committedDate": "2020-05-09T13:47:57Z", "message": "ISPN-11626 Server report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTI1NDE1", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-411125415", "createdAt": "2020-05-13T17:02:35Z", "commit": {"oid": "8e7ba37e0bc6db3699cdab7547b18b3eefeb8821"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37adbf009b7fdacdc06e3faf54d485d5534bdc5", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/c37adbf009b7fdacdc06e3faf54d485d5534bdc5", "committedDate": "2020-05-19T08:07:41Z", "message": "ISPN-11626 Server report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e7ba37e0bc6db3699cdab7547b18b3eefeb8821", "author": {"user": {"login": "oraNod", "name": "Don Naro"}}, "url": "https://github.com/infinispan/infinispan/commit/8e7ba37e0bc6db3699cdab7547b18b3eefeb8821", "committedDate": "2020-05-11T18:41:32Z", "message": "Update proc_cli_getting_server_reports.adoc\n\nremove `{brandname}` attribute from tarball name"}, "afterCommit": {"oid": "c37adbf009b7fdacdc06e3faf54d485d5534bdc5", "author": {"user": {"login": "tristantarrant", "name": "Tristan Tarrant"}}, "url": "https://github.com/infinispan/infinispan/commit/c37adbf009b7fdacdc06e3faf54d485d5534bdc5", "committedDate": "2020-05-19T08:07:41Z", "message": "ISPN-11626 Server report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjU0NDUw", "url": "https://github.com/infinispan/infinispan/pull/8243#pullrequestreview-414254450", "createdAt": "2020-05-19T09:13:41Z", "commit": {"oid": "c37adbf009b7fdacdc06e3faf54d485d5534bdc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 917, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}