{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMjAxMTYx", "number": 8811, "title": "Server Integration Tests", "bodyText": "I don't think a JIRA is required. The goal is to add more tests upstream.\nWith the current implementation, all those tests can run with Wildfly, Tomcat, or Wildfly with Modules.\nBy default, CI will run with Wildfly the module third-party-server", "createdAt": "2020-10-26T17:45:23Z", "url": "https://github.com/infinispan/infinispan/pull/8811", "merged": true, "mergeCommit": {"oid": "557eb407caa317c88bff7aa2e97081a21f1197fb"}, "closed": true, "closedAt": "2021-01-20T13:00:50Z", "author": {"login": "diegolovison"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWYEtVABqjM5MjIwNDIzNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwEINLgBqjQyMDYxNjg1MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1c3603b3608f762bb22c6f7897c31acd15f9e4f", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/a1c3603b3608f762bb22c6f7897c31acd15f9e4f", "committedDate": "2020-10-26T17:43:45Z", "message": "Test Integration tests"}, "afterCommit": {"oid": "100a4f9e4642f42375302b33e7676d8969f5c643", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/100a4f9e4642f42375302b33e7676d8969f5c643", "committedDate": "2020-10-26T17:46:09Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "100a4f9e4642f42375302b33e7676d8969f5c643", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/100a4f9e4642f42375302b33e7676d8969f5c643", "committedDate": "2020-10-26T17:46:09Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "e94aaf49edaad538929a588f6ecb4775cd46570d", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/e94aaf49edaad538929a588f6ecb4775cd46570d", "committedDate": "2020-10-26T19:10:53Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e94aaf49edaad538929a588f6ecb4775cd46570d", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/e94aaf49edaad538929a588f6ecb4775cd46570d", "committedDate": "2020-10-26T19:10:53Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "76e3cc0d372840f02ddbc00cf97fd189c0d63070", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/76e3cc0d372840f02ddbc00cf97fd189c0d63070", "committedDate": "2020-10-27T14:28:42Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76e3cc0d372840f02ddbc00cf97fd189c0d63070", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/76e3cc0d372840f02ddbc00cf97fd189c0d63070", "committedDate": "2020-10-27T14:28:42Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "66739283b6ed35ca676f0863a7dbbcc936d01536", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/66739283b6ed35ca676f0863a7dbbcc936d01536", "committedDate": "2020-10-28T14:04:16Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66739283b6ed35ca676f0863a7dbbcc936d01536", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/66739283b6ed35ca676f0863a7dbbcc936d01536", "committedDate": "2020-10-28T14:04:16Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "110f167662a2dca1000520c3fa6a8368884991c9", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/110f167662a2dca1000520c3fa6a8368884991c9", "committedDate": "2020-10-28T17:02:03Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "110f167662a2dca1000520c3fa6a8368884991c9", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/110f167662a2dca1000520c3fa6a8368884991c9", "committedDate": "2020-10-28T17:02:03Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "a8c079c332909490d1170f0fe5bb3f3b33ee2807", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/a8c079c332909490d1170f0fe5bb3f3b33ee2807", "committedDate": "2020-10-30T11:33:38Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8c079c332909490d1170f0fe5bb3f3b33ee2807", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/a8c079c332909490d1170f0fe5bb3f3b33ee2807", "committedDate": "2020-10-30T11:33:38Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/c49b3ea982cbd508490e3e338b6c673bd418bc04", "committedDate": "2020-11-18T19:33:36Z", "message": "Server Integration Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MTU4Mjgy", "url": "https://github.com/infinispan/infinispan/pull/8811#pullrequestreview-568158282", "createdAt": "2021-01-14T11:46:09Z", "commit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMTo0NjowOVrOIThJNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxMTo0OTo0NFrOIThRFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzMzNjg4Ng==", "bodyText": "Never used.", "url": "https://github.com/infinispan/infinispan/pull/8811#discussion_r557336886", "createdAt": "2021-01-14T11:46:09Z", "author": {"login": "ryanemerson"}, "path": "integrationtests/server-integration/server-integration-commons/src/test/java/org/infinispan/test/integration/util/ITestUtils.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.infinispan.test.integration.util;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+public class ITestUtils {\n+\n+   public static void sleepForSecs(long numSecs) {\n+      // give the elements time to be evicted\n+      try {\n+         Thread.sleep(numSecs * 1000);\n+      } catch (InterruptedException e) {\n+      }\n+   }\n+\n+   public static void eventually(Condition ec, long timeout) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzMzNzAzNQ==", "bodyText": "public is redundant.", "url": "https://github.com/infinispan/infinispan/pull/8811#discussion_r557337035", "createdAt": "2021-01-14T11:46:27Z", "author": {"login": "ryanemerson"}, "path": "integrationtests/server-integration/server-integration-commons/src/test/java/org/infinispan/test/integration/util/ITestUtils.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.infinispan.test.integration.util;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+public class ITestUtils {\n+\n+   public static void sleepForSecs(long numSecs) {\n+      // give the elements time to be evicted\n+      try {\n+         Thread.sleep(numSecs * 1000);\n+      } catch (InterruptedException e) {\n+      }\n+   }\n+\n+   public static void eventually(Condition ec, long timeout) {\n+      eventually(ec, timeout, 10);\n+   }\n+\n+   public static void eventually(Condition ec, long timeout, int loops) {\n+      if (loops <= 0) {\n+         throw new IllegalArgumentException(\"Number of loops must be positive\");\n+      }\n+      long sleepDuration = timeout / loops;\n+      if (sleepDuration == 0) {\n+         sleepDuration = 1;\n+      }\n+      try {\n+         for (int i = 0; i < loops; i++) {\n+\n+            if (ec.isSatisfied())\n+               return;\n+            Thread.sleep(sleepDuration);\n+         }\n+         assertTrue(ec.isSatisfied());\n+      } catch (Exception e) {\n+         throw new RuntimeException(\"Unexpected!\", e);\n+      }\n+   }\n+\n+   public interface Condition {\n+      public boolean isSatisfied() throws Exception;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzMzODkwMA==", "bodyText": "Do we need the equivalent of this test for wildfly-modules?", "url": "https://github.com/infinispan/infinispan/pull/8811#discussion_r557338900", "createdAt": "2021-01-14T11:49:44Z", "author": {"login": "ryanemerson"}, "path": "integrationtests/server-integration/third-party-server/src/test/java/org/infinispan/test/integration/thirdparty/remote/MemcachedClientIT.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.infinispan.test.integration.thirdparty.remote;\n+\n+import static org.infinispan.test.integration.thirdparty.DeploymentHelper.addLibrary;\n+\n+import org.infinispan.test.integration.thirdparty.DeploymentHelper;\n+import org.infinispan.test.integration.remote.AbstractMemcacheClientIT;\n+import org.infinispan.test.integration.memcached.SimpleMemcachedClient;\n+import org.infinispan.test.integration.util.ITestUtils;\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.shrinkwrap.api.Archive;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.runner.RunWith;\n+\n+@RunWith(Arquillian.class)\n+public class MemcachedClientIT extends AbstractMemcacheClientIT {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6e2115b4e0f6ec6ef1094168a0aadc5c661114", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/4c6e2115b4e0f6ec6ef1094168a0aadc5c661114", "committedDate": "2021-01-14T13:07:22Z", "message": "Server Integration Tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c49b3ea982cbd508490e3e338b6c673bd418bc04", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/c49b3ea982cbd508490e3e338b6c673bd418bc04", "committedDate": "2020-11-18T19:33:36Z", "message": "Server Integration Tests"}, "afterCommit": {"oid": "4c6e2115b4e0f6ec6ef1094168a0aadc5c661114", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/4c6e2115b4e0f6ec6ef1094168a0aadc5c661114", "committedDate": "2021-01-14T13:07:22Z", "message": "Server Integration Tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 257, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}