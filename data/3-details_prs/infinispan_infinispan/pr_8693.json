{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDY2NTAy", "number": 8693, "title": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state", "bodyText": "https://issues.redhat.com/browse/ISPN-12309", "createdAt": "2020-09-16T15:22:06Z", "url": "https://github.com/infinispan/infinispan/pull/8693", "merged": true, "mergeCommit": {"oid": "cbd775c2b7763f5d842ad51ebe5d60c11c34eee3"}, "closed": true, "closedAt": "2020-10-01T09:47:04Z", "author": {"login": "gustavonalle"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKHgfTABqjM3ODMxOTU2NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOMomfgBqjM4MjgwNTY4Mzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d02bace48413cea041cfde2533e553e44f01d92c", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/d02bace48413cea041cfde2533e553e44f01d92c", "committedDate": "2020-09-18T15:40:06Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "committedDate": "2020-09-18T15:41:09Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/3d03e8aea5abd3669e5aa8ab3e9052d35373da06", "committedDate": "2020-09-18T15:41:09Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "f56aff8969e331bf8b2e0a56082330ab1b695083", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/f56aff8969e331bf8b2e0a56082330ab1b695083", "committedDate": "2020-09-28T16:29:33Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f56aff8969e331bf8b2e0a56082330ab1b695083", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/f56aff8969e331bf8b2e0a56082330ab1b695083", "committedDate": "2020-09-28T16:29:33Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "8f09b3817d96c81096303279cdfdc106754b3ded", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/8f09b3817d96c81096303279cdfdc106754b3ded", "committedDate": "2020-09-28T16:36:08Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f09b3817d96c81096303279cdfdc106754b3ded", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/8f09b3817d96c81096303279cdfdc106754b3ded", "committedDate": "2020-09-28T16:36:08Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "0d34b9029e90444415b8b5dc30e40d29f8772999", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/0d34b9029e90444415b8b5dc30e40d29f8772999", "committedDate": "2020-09-28T16:38:52Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d34b9029e90444415b8b5dc30e40d29f8772999", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/0d34b9029e90444415b8b5dc30e40d29f8772999", "committedDate": "2020-09-28T16:38:52Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "73628e0f6511d284ac92190c9164bcf233fc5e36", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/73628e0f6511d284ac92190c9164bcf233fc5e36", "committedDate": "2020-09-28T16:48:34Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73628e0f6511d284ac92190c9164bcf233fc5e36", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/73628e0f6511d284ac92190c9164bcf233fc5e36", "committedDate": "2020-09-28T16:48:34Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}, "afterCommit": {"oid": "6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "committedDate": "2020-09-29T11:40:37Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/6b0ee53b83e0b23f45bffb5bc27f1e205827b1b5", "committedDate": "2020-09-29T11:40:37Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "6e0a21174f8c2be7e57617e45e96d915a6f1442d", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/6e0a21174f8c2be7e57617e45e96d915a6f1442d", "committedDate": "2020-09-29T11:44:02Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e0a21174f8c2be7e57617e45e96d915a6f1442d", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/6e0a21174f8c2be7e57617e45e96d915a6f1442d", "committedDate": "2020-09-29T11:44:02Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "a913f602d45485714010a65f9799bea39512a1be", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/a913f602d45485714010a65f9799bea39512a1be", "committedDate": "2020-09-29T11:45:57Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a913f602d45485714010a65f9799bea39512a1be", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/a913f602d45485714010a65f9799bea39512a1be", "committedDate": "2020-09-29T11:45:57Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "f3463ddfdece546a95b82110214edce8add81ce2", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/f3463ddfdece546a95b82110214edce8add81ce2", "committedDate": "2020-09-29T13:24:42Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3463ddfdece546a95b82110214edce8add81ce2", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/f3463ddfdece546a95b82110214edce8add81ce2", "committedDate": "2020-09-29T13:24:42Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "78ec12bb79a905403e862283af09f3406f88bdd5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/78ec12bb79a905403e862283af09f3406f88bdd5", "committedDate": "2020-09-29T17:16:25Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78ec12bb79a905403e862283af09f3406f88bdd5", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/78ec12bb79a905403e862283af09f3406f88bdd5", "committedDate": "2020-09-29T17:16:25Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "c066700618b127d91257a2e472f51c67b35aeced", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/c066700618b127d91257a2e472f51c67b35aeced", "committedDate": "2020-09-29T17:19:22Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MjczODQy", "url": "https://github.com/infinispan/infinispan/pull/8693#pullrequestreview-499273842", "createdAt": "2020-09-30T10:03:07Z", "commit": {"oid": "c066700618b127d91257a2e472f51c67b35aeced"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMDowMzowN1rOHaWXtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMDowNDowOVrOHaWaow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MTU0MQ==", "bodyText": "use HealthStatus enum", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r497391541", "createdAt": "2020-09-30T10:03:07Z", "author": {"login": "karesti"}, "path": "server/rest/src/main/java/org/infinispan/rest/resources/CacheManagerResource.java", "diffHunk": "@@ -230,9 +231,12 @@ public Invocations getInvocations() {\n                if (ignoredCaches.contains(cacheName)) {\n                   cacheInfo.status = \"IGNORED\";\n                } else {\n-                  // This action will fail for ignored caches\n-                  Cache cache = restCacheManager.getCache(cacheName, request);\n-                  cacheInfo.status = cache.getStatus().toString();\n+                  if(cacheHealth != HealthStatus.FAILED) {\n+                     Cache cache = restCacheManager.getCache(cacheName, request);\n+                     cacheInfo.status = cache.getStatus().toString();\n+                  } else {\n+                     cacheInfo.status = \"FAILED\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c066700618b127d91257a2e472f51c67b35aeced"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM5MjI5MQ==", "bodyText": "would be better to use the enum on tests as well", "url": "https://github.com/infinispan/infinispan/pull/8693#discussion_r497392291", "createdAt": "2020-09-30T10:04:09Z", "author": {"login": "karesti"}, "path": "server/rest/src/test/java/org/infinispan/rest/resources/CacheManagerResourceTest.java", "diffHunk": "@@ -86,7 +86,8 @@ public void testHealth() {\n \n       Json jsonNode = Json.read(response.getBody());\n       Json clusterHealth = jsonNode.at(\"cluster_health\");\n-      assertEquals(clusterHealth.at(\"health_status\").asString(), \"HEALTHY\");\n+      // One of the caches is in FAILED state", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c066700618b127d91257a2e472f51c67b35aeced"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f21ddee03ca11045a88cbdc59b71509169b33a44", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/f21ddee03ca11045a88cbdc59b71509169b33a44", "committedDate": "2020-10-01T07:52:02Z", "message": "ISPN-12309 Reproducer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666afd770ad1d075061ded4fe36c1abf39c3af38", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/666afd770ad1d075061ded4fe36c1abf39c3af38", "committedDate": "2020-10-01T07:52:08Z", "message": "ISPN-12309 Creating cache with invalid configuration leaves inconsistent state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cf76878dc67866eeed3f14290984bd7d627a58a", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/1cf76878dc67866eeed3f14290984bd7d627a58a", "committedDate": "2020-10-01T07:52:10Z", "message": "ISPN-12309 Update documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c066700618b127d91257a2e472f51c67b35aeced", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/c066700618b127d91257a2e472f51c67b35aeced", "committedDate": "2020-09-29T17:19:22Z", "message": "ISPN-12309 Update documentation"}, "afterCommit": {"oid": "1cf76878dc67866eeed3f14290984bd7d627a58a", "author": {"user": {"login": "gustavonalle", "name": "Gustavo"}}, "url": "https://github.com/infinispan/infinispan/commit/1cf76878dc67866eeed3f14290984bd7d627a58a", "committedDate": "2020-10-01T07:52:10Z", "message": "ISPN-12309 Update documentation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 474, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}