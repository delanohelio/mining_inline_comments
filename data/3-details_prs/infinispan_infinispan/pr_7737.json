{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyOTc2ODAx", "number": 7737, "title": "ISPN-11020 Max Idle Test Fix", "bodyText": "https://issues.redhat.com/browse/ISPN-11020\nhttps://issues.redhat.com/browse/ISPN-11157", "createdAt": "2020-01-15T06:23:52Z", "url": "https://github.com/infinispan/infinispan/pull/7737", "merged": true, "mergeCommit": {"oid": "24ed43208950c7c5be17393418a3ca9446f4ffed"}, "closed": true, "closedAt": "2020-01-17T15:50:04Z", "author": {"login": "wburns"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6k8yfgFqTM0MzE4MjM1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6n7dngBqjI5NTE0MDk5ODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMTgyMzU1", "url": "https://github.com/infinispan/infinispan/pull/7737#pullrequestreview-343182355", "createdAt": "2020-01-15T12:25:13Z", "commit": {"oid": "40a67bb397299ab6655de3b90cb6e9f90daa9628"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMjoyNToxNFrOFd2o-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMjo0NTowOFrOFd3F7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0ODI0OQ==", "bodyText": "Please replace the comment with one or two actual examples so we'll know what to expect when debugging.\nAnd are you sure the TimeoutException is always the most nested suppressed throwable, or should we check if any of the suppressed exceptions is a TimeoutException?", "url": "https://github.com/infinispan/infinispan/pull/7737#discussion_r366848249", "createdAt": "2020-01-15T12:25:14Z", "author": {"login": "danberindei"}, "path": "core/src/main/java/org/infinispan/expiration/impl/ClusterExpirationManager.java", "diffHunk": "@@ -322,6 +318,24 @@ private boolean pollForCompletion(BlockingQueue<CompletableFuture<?>> queue, lon\n       return previousFuture;\n    }\n \n+   // Unfortunately a tx exception is part of a caused and suppressed - we need to make sure the real cause is available", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a67bb397299ab6655de3b90cb6e9f90daa9628"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg1NTY2MQ==", "bodyText": "Could return false and avoid the variable.", "url": "https://github.com/infinispan/infinispan/pull/7737#discussion_r366855661", "createdAt": "2020-01-15T12:45:08Z", "author": {"login": "danberindei"}, "path": "core/src/main/java/org/infinispan/commands/tx/PrepareCommand.java", "diffHunk": "@@ -189,7 +189,18 @@ public Object getKeyLockOwner() {\n \n    @Override\n    public boolean hasZeroLockAcquisition() {\n-      return false;\n+      if (modifications == null || modifications.length == 0) {\n+         return false;\n+      }\n+      boolean hasZeroLock = true;\n+      for (WriteCommand wc : modifications) {\n+         // If even a single command doesn't have the zero lock acquisition timeout flag, we can't use a zero timeout\n+         if (!wc.hasAnyFlag(FlagBitSets.ZERO_LOCK_ACQUISITION_TIMEOUT)) {\n+            hasZeroLock = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a67bb397299ab6655de3b90cb6e9f90daa9628"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c02c66ba30bb8400e288bae9fd832603ced2683", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/5c02c66ba30bb8400e288bae9fd832603ced2683", "committedDate": "2020-01-15T15:21:30Z", "message": "ISPN-11157 Optimistic Transaction ignores ZERO_LOCK_ACQUISITION flag"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40a67bb397299ab6655de3b90cb6e9f90daa9628", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/40a67bb397299ab6655de3b90cb6e9f90daa9628", "committedDate": "2020-01-15T05:46:12Z", "message": "ISPN-11020 Clustered Max Idle Take 2\n\n* Support tx exception with nested/suppressed TimeoutException"}, "afterCommit": {"oid": "22203d00bf752640494675494a7ae0cfa7398f53", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/22203d00bf752640494675494a7ae0cfa7398f53", "committedDate": "2020-01-15T15:21:30Z", "message": "ISPN-11020 Clustered Max Idle Take 2\n\n* Support tx exception with nested/suppressed TimeoutException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "556f37b88be08769d27f8289c478b462c21d18f9", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/556f37b88be08769d27f8289c478b462c21d18f9", "committedDate": "2020-01-15T16:13:24Z", "message": "ISPN-11020 Clustered Max Idle Take 2\n\n* Support tx exception with nested/suppressed TimeoutException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22203d00bf752640494675494a7ae0cfa7398f53", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/22203d00bf752640494675494a7ae0cfa7398f53", "committedDate": "2020-01-15T15:21:30Z", "message": "ISPN-11020 Clustered Max Idle Take 2\n\n* Support tx exception with nested/suppressed TimeoutException"}, "afterCommit": {"oid": "556f37b88be08769d27f8289c478b462c21d18f9", "author": {"user": {"login": "wburns", "name": "William Burns"}}, "url": "https://github.com/infinispan/infinispan/commit/556f37b88be08769d27f8289c478b462c21d18f9", "committedDate": "2020-01-15T16:13:24Z", "message": "ISPN-11020 Clustered Max Idle Take 2\n\n* Support tx exception with nested/suppressed TimeoutException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 182, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}