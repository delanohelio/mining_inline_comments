{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODc3Mzg3", "number": 8312, "title": "ISPN-11819 Prevent ContainerInfinispanServerDriver erroneous state with provided server directory", "bodyText": "https://issues.redhat.com/browse/ISPN-11819", "createdAt": "2020-05-12T17:50:49Z", "url": "https://github.com/infinispan/infinispan/pull/8312", "merged": true, "mergeCommit": {"oid": "7b4c8a7bb5c316328a67b4cb2f45f08dfcd8147f"}, "closed": true, "closedAt": "2020-05-20T09:25:54Z", "author": {"login": "diegolovison"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchhN4qgFqTQxMjU5NzQxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcieq2oABqjMzNDY5NzcxMDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNTk3NDEz", "url": "https://github.com/infinispan/infinispan/pull/8312#pullrequestreview-412597413", "createdAt": "2020-05-15T12:20:53Z", "commit": {"oid": "7e2569148ebe21f53fd744109de7bea0488bfca1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjoyMDo1M1rOGWChog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjoyNToyNlrOGWCqsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc2MzIzNA==", "bodyText": "We can replace this method with a call to org.infinispan.commons.Util#recursiveFileRemove", "url": "https://github.com/infinispan/infinispan/pull/8312#discussion_r425763234", "createdAt": "2020-05-15T12:20:53Z", "author": {"login": "ryanemerson"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -230,6 +230,32 @@ private void configureSite(List<String> args) {\n       args.add(\"-Djgroups.cluster.mcast_port=\" + configuration.siteDiscoveryPort());\n    }\n \n+   /*\n+    * Once you built the server, you can try to start it and it will create files under the data directory.\n+    * Later, you decided to run some tests and it will take ages to find out that the tests are broken because there\n+    * are files under the data directory.\n+    */\n+   private Path validateServerOutput(Path serverOutputPath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2569148ebe21f53fd744109de7bea0488bfca1"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc2NTU1Mw==", "bodyText": "We should cleanup the directories before the call to image and we should add a comment explaining why the delete is necessary:\n// Removing the `server/data` and `server/log` directories from the local server directory to prevent issues with the tests\nUtil.recursiveFileRemove(serverOutputPath.resolve(\"server\").resolve(\"data\").toString());\nUtil.recursiveFileRemove(serverOutputPath.resolve(\"server\").resolve(\"log\").toString());", "url": "https://github.com/infinispan/infinispan/pull/8312#discussion_r425765553", "createdAt": "2020-05-15T12:25:26Z", "author": {"login": "ryanemerson"}, "path": "server/testdriver/core/src/main/java/org/infinispan/server/test/core/ContainerInfinispanServerDriver.java", "diffHunk": "@@ -139,7 +139,7 @@ protected void start(String name, File rootDir, String configurationFile) {\n             image\n                   .withFileFromPath(\"target\", serverOutputPath.getParent())\n                   .withFileFromPath(\"src\", serverOutputPath.getParent().getParent().resolve(\"src\"))\n-                  .withFileFromPath(\"build\", serverOutputPath);\n+                  .withFileFromPath(\"build\", validateServerOutput(serverOutputPath));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2569148ebe21f53fd744109de7bea0488bfca1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b82b1e4602bf8d6004d0f1fc6099dc3178be58f", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/9b82b1e4602bf8d6004d0f1fc6099dc3178be58f", "committedDate": "2020-05-18T12:03:13Z", "message": "ISPN-11819 Prevent ContainerInfinispanServerDriver erroneous state with provided server directory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e2569148ebe21f53fd744109de7bea0488bfca1", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/7e2569148ebe21f53fd744109de7bea0488bfca1", "committedDate": "2020-05-12T17:50:02Z", "message": "ISPN-11819 Prevent wrong server state when running tests with ContainerInfinispanServerDriver"}, "afterCommit": {"oid": "9b82b1e4602bf8d6004d0f1fc6099dc3178be58f", "author": {"user": {"login": "diegolovison", "name": "Diego Lovison"}}, "url": "https://github.com/infinispan/infinispan/commit/9b82b1e4602bf8d6004d0f1fc6099dc3178be58f", "committedDate": "2020-05-18T12:03:13Z", "message": "ISPN-11819 Prevent ContainerInfinispanServerDriver erroneous state with provided server directory"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 752, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}