{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxOTEyNTk0", "number": 8517, "title": "ISPN-12065 Add the anchored-keys module to the server", "bodyText": "https://issues.redhat.com/browse/ISPN-12065\n@tristantarrant I had to set the run mode to CONTAINER ... for some reason with the default I get the following errors on the server:\norg.infinispan.client.hotrod.exceptions.HotRodClientException:Request for messageId=10 returned server error (status=0x85): java.lang.ClassCastException: class org.infinispan.remoting.transport.jgroups.JGroupsAddress cannot be cast to class [B (org.infinispan.remoting.transport.jgroups.JGroupsAddress is in unnamed module of loader 'app'; [B is in module java.base of loader 'bootstrap')", "createdAt": "2020-06-30T09:48:26Z", "url": "https://github.com/infinispan/infinispan/pull/8517", "merged": true, "mergeCommit": {"oid": "44a3c2c2cf6416063ee277f9f1c13425705b6cb0"}, "closed": true, "closedAt": "2020-06-30T17:03:45Z", "author": {"login": "ryanemerson"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwWjDpgH2gAyNDQxOTEyNTk0OjQ5ZDg0MjA3NjY4YWRjODZhYTgzYzEwNzdiYzMxYzBiNWY4NDNiNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwXZo0AFqTQ0MDEzNjA5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49d84207668adc86aa83c1077bc31c0b5f843b45", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/49d84207668adc86aa83c1077bc31c0b5f843b45", "committedDate": "2020-06-30T14:30:39Z", "message": "ISPN-12065 Add the anchored-keys module to the server\n\n- infinispan-anchored-keys added to bom\n- AnchoredKeysIT added"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aac6764f57b96e24e4d62cad39057e4bb9998aab", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/aac6764f57b96e24e4d62cad39057e4bb9998aab", "committedDate": "2020-06-30T09:47:13Z", "message": "ISPN-12065 Add the anchored-keys module to the server\n\n- infinispan-anchored-keys added to bom\n- AnchoredKeysIT added"}, "afterCommit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387", "committedDate": "2020-06-30T14:30:39Z", "message": "ISPN-12065 Add org.infinispan.feature.anchored-keys feature flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMDg2NTky", "url": "https://github.com/infinispan/infinispan/pull/8517#pullrequestreview-440086592", "createdAt": "2020-06-30T14:41:04Z", "commit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNDo0MTowNFrOGq_vHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNDo0MTozMFrOGq_waA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzczNzYyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  Features features = new Features(classLoader);\n          \n          \n            \n                  Features features = globalConfiguration.features();", "url": "https://github.com/infinispan/infinispan/pull/8517#discussion_r447737629", "createdAt": "2020-06-30T14:41:04Z", "author": {"login": "pruivo"}, "path": "anchored-keys/src/main/java/org/infinispan/anchored/AnchoredKeysModuleLifecycle.java", "diffHunk": "@@ -43,14 +49,19 @@ public void cacheManagerStarting(GlobalComponentRegistry gcr, GlobalConfiguratio\n \n    @Override\n    public void cacheStarting(ComponentRegistry cr, Configuration configuration, String cacheName) {\n-      AnchoredKeysConfiguration anchoredKeysConfiguration =\n-            configuration.module(AnchoredKeysConfiguration.class);\n+      AnchoredKeysConfiguration anchoredKeysConfiguration = configuration.module(AnchoredKeysConfiguration.class);\n       if (anchoredKeysConfiguration == null || !anchoredKeysConfiguration.enabled())\n          return;\n \n       assert configuration.clustering().cacheMode().isReplicated();\n       assert !configuration.clustering().stateTransfer().awaitInitialTransfer();\n \n+      ClassLoader classLoader = cr.getGlobalComponentRegistry().getGlobalConfiguration().classLoader();\n+      Features features = new Features(classLoader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzczNzk2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     throw LogFactory.getLog(MethodHandles.lookup().lookupClass()).featureDisabled(ANCHORED_KEYS_FEATURE);\n          \n          \n            \n                     throw Log.CONFIG.featureDisabled(ANCHORED_KEYS_FEATURE);", "url": "https://github.com/infinispan/infinispan/pull/8517#discussion_r447737960", "createdAt": "2020-06-30T14:41:30Z", "author": {"login": "pruivo"}, "path": "anchored-keys/src/main/java/org/infinispan/anchored/AnchoredKeysModuleLifecycle.java", "diffHunk": "@@ -43,14 +49,19 @@ public void cacheManagerStarting(GlobalComponentRegistry gcr, GlobalConfiguratio\n \n    @Override\n    public void cacheStarting(ComponentRegistry cr, Configuration configuration, String cacheName) {\n-      AnchoredKeysConfiguration anchoredKeysConfiguration =\n-            configuration.module(AnchoredKeysConfiguration.class);\n+      AnchoredKeysConfiguration anchoredKeysConfiguration = configuration.module(AnchoredKeysConfiguration.class);\n       if (anchoredKeysConfiguration == null || !anchoredKeysConfiguration.enabled())\n          return;\n \n       assert configuration.clustering().cacheMode().isReplicated();\n       assert !configuration.clustering().stateTransfer().awaitInitialTransfer();\n \n+      ClassLoader classLoader = cr.getGlobalComponentRegistry().getGlobalConfiguration().classLoader();\n+      Features features = new Features(classLoader);\n+      if (!features.isAvailable(ANCHORED_KEYS_FEATURE)) {\n+         throw LogFactory.getLog(MethodHandles.lookup().lookupClass()).featureDisabled(ANCHORED_KEYS_FEATURE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMDg4MjE5", "url": "https://github.com/infinispan/infinispan/pull/8517#pullrequestreview-440088219", "createdAt": "2020-06-30T14:42:38Z", "commit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNDo0MjozOVrOGq_zsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNDo0MjozOVrOGq_zsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzczODgwMQ==", "bodyText": "nitpick/offtopic: unused. just remove it.", "url": "https://github.com/infinispan/infinispan/pull/8517#discussion_r447738801", "createdAt": "2020-06-30T14:42:39Z", "author": {"login": "pruivo"}, "path": "anchored-keys/src/main/java/org/infinispan/anchored/AnchoredKeysModuleLifecycle.java", "diffHunk": "@@ -28,6 +32,8 @@\n @InfinispanModule(name = \"anchored-keys\", requiredModules = \"core\")\n public final class AnchoredKeysModuleLifecycle implements ModuleLifecycle, DynamicModuleMetadataProvider {\n \n+   public static final String ANCHORED_KEYS_FEATURE = \"anchored-keys\";\n+\n    private GlobalComponentRegistry gcr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3c3332a24e1a476237a4ebb0e358dbe0024f6fe", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/b3c3332a24e1a476237a4ebb0e358dbe0024f6fe", "committedDate": "2020-06-30T15:14:21Z", "message": "ISPN-12065 Add org.infinispan.feature.anchored-keys feature flag"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/9a3b8d2ae9b7ba62cea9e120cfd4c485a7cf8387", "committedDate": "2020-06-30T14:30:39Z", "message": "ISPN-12065 Add org.infinispan.feature.anchored-keys feature flag"}, "afterCommit": {"oid": "b3c3332a24e1a476237a4ebb0e358dbe0024f6fe", "author": {"user": {"login": "ryanemerson", "name": "Ryan Emerson"}}, "url": "https://github.com/infinispan/infinispan/commit/b3c3332a24e1a476237a4ebb0e358dbe0024f6fe", "committedDate": "2020-06-30T15:14:21Z", "message": "ISPN-12065 Add org.infinispan.feature.anchored-keys feature flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMTM2MDkw", "url": "https://github.com/infinispan/infinispan/pull/8517#pullrequestreview-440136090", "createdAt": "2020-06-30T15:30:16Z", "commit": {"oid": "b3c3332a24e1a476237a4ebb0e358dbe0024f6fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 484, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}