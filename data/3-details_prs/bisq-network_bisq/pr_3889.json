{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNjIzNzcx", "number": 3889, "title": "Refactor option handling", "bodyText": "This is the fourth and final PR in a series. It should ideally be merged immediately after PRs #3886, #3887 and #3888, in that order.\nIntroduction\nAs detailed in commit 614035f, this change replaces BisqEnvironment with a new Config class that unifies, simplifies and otherwise improves Bisq's option handling in a number of ways. Please read that commit message first to get proper context and rationale.\nGuidance for reviewers\nMany of the commits in this PR represent the step-by-step, option-by-option migration from BisqEnvironment to Config. I recommend carefully reviewing at least several of these commits to understand what this migration means and how things work in the new infrastructure, but carefully reviewing every one of them is probably overkill. Please note that every commit in this PR should compile and run without errors.\nHow these changes were tested\nThe majority of commits (and certainly the final one) were subjected to a complete Gradle build cycle including all tests, followed by bringing up a localnet environment using the Makefile introduced in PR #3718, e.g.:\n$ ./gradlew build && make clean-localnet deploy\n\nNote that the Bisq instances launched by make deploy make use of many Bisq command line options. So ensuring that these nodes came up error-free was an important part of making sure that the migration was working at every step.\nTesting was also performed on an ad-hoc basis against a non-localnet Bisq instance, ensuring that passing certain options works as expected, e.g.\n$ bitcoind # start my local Bitcoin node\n...\n$ ./gradlew build && ./bisq-desktop --appDataDir=$(mktemp -d) --ignoreLocalBtcNode\n\nThe option being tested above is --ignoreLocalBtcNode, and passing a newly created temp directory to --appDataDir was a technique I commonly used to avoid any possible interference with my real production Bisq installation. In this case, I would verify that --ignoreLocalBtcNode worked as expected by ensuring the local Bitcoin node popup did not appear in the Bisq client and that the default approach of connecting to Bisq's Bitcoin node federation took place as expected. I did not test each and every option in this way; after making a number of such migrations, I got quite confident in the process. If a migration deviated from the typical process in some way, then I usually manually tested that change.\nRefactorings not strictly related to option handling\n\n\nIntroduction of ConfigFileEditor to encapsulate the process of making automated updates to the bisq.properties config file. See commit 614035f.\n\n\nIntroduction of LocalBitcoinNode to encapsulate everything to do with detecting whether a local Bitcoin node is running. Of particular note here is the elimination of a dedicated thread for doing the actual detection. See commit 30bef16 for details.\n\n\nFunctional / user-facing / non-refactoring changes\n\n\nFrom commit 614035f:\nNote that while this change and those that follow it are principally a\nrefactoring effort, certain functional changes have been introduced. For\nexample, Bisq now supports a --configFile argument at the command line\nthat functions very similarly to Bitcoin Core's -conf option.\n\n\nCommit 799eb12 renames the numConnectionForBtc option to numConnectionsForBtc.\n\n\nOther notes\nPlease disregard the unrelated Kotlin, Git and gRPC proof of concept commits in this PR. They belong respectively to PRs #3886, #3887 and #3888 and will disappear here as each gets merged.", "createdAt": "2020-01-10T21:11:32Z", "url": "https://github.com/bisq-network/bisq/pull/3889", "merged": true, "mergeCommit": {"oid": "d4e566f6e7b49ea2a9b1f7f2ead1940ba165b769"}, "closed": true, "closedAt": "2020-01-21T16:08:10Z", "author": {"login": "cbeams"}, "timelineItems": {"totalCount": 102, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8gEF4gFqTM0NTQ3Nzc3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8jbh-AFqTM0NTk5NzU0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NDc3Nzc2", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345477776", "createdAt": "2020-01-20T18:29:16Z", "commit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxODoyOToxNlrOFfmgDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMDo1MDoyNVrOFf1wzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY4MDk3NA==", "bodyText": "This goes against our style of not using exceptions as a part of the expected execution flow.", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368680974", "createdAt": "2020-01-20T18:29:16Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/config/Config.java", "diffHunk": "@@ -0,0 +1,344 @@\n+package bisq.common.config;\n+\n+import bisq.common.util.Utilities;\n+\n+import joptsimple.AbstractOptionSpec;\n+import joptsimple.ArgumentAcceptingOptionSpec;\n+import joptsimple.OptionException;\n+import joptsimple.OptionParser;\n+import joptsimple.OptionSet;\n+import joptsimple.OptionSpec;\n+import joptsimple.util.PathConverter;\n+import joptsimple.util.PathProperties;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import java.io.File;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ch.qos.logback.classic.Level;\n+\n+import static java.lang.String.format;\n+import static java.util.stream.Collectors.toList;\n+\n+public class Config {\n+\n+    static final String DEFAULT_CONFIG_FILE_NAME = \"bisq.properties\";\n+    static final int DEFAULT_NODE_PORT = 9999;\n+\n+    public static File CURRENT_APP_DATA_DIR;\n+\n+    private final String defaultAppName;\n+    private final File defaultUserDataDir;\n+    private final File defaultAppDataDir;\n+    private final File defaultConfigFile;\n+\n+    private final File configFile;\n+    private final String appName;\n+    private final File userDataDir;\n+    private final File appDataDir;\n+    private final int nodePort;\n+    private final List<String> bannedBtcNodes;\n+    private final List<String> bannedPriceRelayNodes;\n+    private final List<String> bannedSeedNodes;\n+    private final BaseCurrencyNetwork baseCurrencyNetwork;\n+    private final boolean ignoreLocalBtcNode;\n+    private final String bitcoinRegtestHost;\n+    private final boolean daoActivated;\n+    private final boolean fullDaoNode;\n+    private final String logLevel;\n+    private final Path torrcFile;\n+\n+    // FIXME: Carryover from legacy BisqEnvironment; there should be no mutable state here\n+    private boolean localBitcoinNodeIsRunning = false;\n+\n+    public Config(String defaultAppName) throws HelpRequested {\n+        this(defaultAppName, new String[]{});\n+    }\n+\n+    public Config(String defaultAppName, String[] args) throws HelpRequested {\n+        this.defaultAppName = defaultAppName;\n+        this.defaultUserDataDir = getDefaultUserDataDir();\n+        this.defaultAppDataDir = new File(defaultUserDataDir, this.defaultAppName);\n+        this.defaultConfigFile = new File(defaultAppDataDir, DEFAULT_CONFIG_FILE_NAME);\n+\n+        OptionParser parser = new OptionParser();\n+        parser.allowsUnrecognizedOptions();\n+\n+        AbstractOptionSpec<Void> helpOpt =\n+                parser.accepts(\"help\", \"Print this help text\")\n+                        .forHelp();\n+\n+        ArgumentAcceptingOptionSpec<String> configFileOpt =\n+                parser.accepts(\"configFile\", \"Specify configuration file. \" +\n+                        \"Relative paths will be prefixed by appDataDir location.\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(DEFAULT_CONFIG_FILE_NAME);\n+\n+        ArgumentAcceptingOptionSpec<File> userDataDirOpt =\n+                parser.accepts(\"userDataDir\", \"User data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultUserDataDir);\n+\n+        ArgumentAcceptingOptionSpec<String> appNameOpt =\n+                parser.accepts(\"appName\", \"Application name\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(this.defaultAppName);\n+\n+        ArgumentAcceptingOptionSpec<File> appDataDirOpt =\n+                parser.accepts(\"appDataDir\", \"Application data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultAppDataDir);\n+\n+        ArgumentAcceptingOptionSpec<Integer> nodePortOpt =\n+                parser.accepts(\"nodePort\", \"Port to listen on\")\n+                        .withRequiredArg()\n+                        .ofType(Integer.class)\n+                        .defaultsTo(DEFAULT_NODE_PORT);\n+\n+        ArgumentAcceptingOptionSpec<String> bannedBtcNodesOpt =\n+                parser.accepts(\"bannedBtcNodes\", \"List Bitcoin nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedPriceRelayNodesOpt =\n+                parser.accepts(\"bannedPriceRelayNodes\", \"List Bisq price nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedSeedNodesOpt =\n+                parser.accepts(\"bannedSeedNodes\", \"List Bisq seed nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<Enum> baseCurrencyNetworkOpt =\n+                parser.accepts(\"baseCurrencyNetwork\", \"Base currency network\")\n+                        .withRequiredArg()\n+                        .ofType(BaseCurrencyNetwork.class)\n+                        .withValuesConvertedBy(new EnumValueConverter(BaseCurrencyNetwork.class))\n+                        .defaultsTo(BaseCurrencyNetwork.BTC_MAINNET);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> ignoreLocalBtcNodeOpt =\n+                parser.accepts(\"ignoreLocalBtcNode\", \"If set to true a Bitcoin Core node running locally will be ignored\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> bitcoinRegtestHostOpt =\n+                parser.accepts(\"bitcoinRegtestHost\", \"Bitcoin Core node when using BTC_REGTEST network\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"host[:port]\")\n+                        .defaultsTo(\"localhost\");\n+\n+        ArgumentAcceptingOptionSpec<Boolean> daoActivatedOpt =\n+                parser.accepts(\"daoActivated\", \"Developer flag. If true it enables dao phase 2 features.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(true);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> fullDaoNodeOpt =\n+                parser.accepts(\"fullDaoNode\", \"If set to true the node requests the blockchain data via RPC requests \" +\n+                        \"from Bitcoin Core and provide the validated BSQ txs to the network. It requires that the \" +\n+                        \"other RPC properties are set as well.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> logLevelOpt =\n+                parser.accepts(\"logLevel\", \"Set logging level\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE\")\n+                        .defaultsTo(Level.INFO.levelStr);\n+\n+        ArgumentAcceptingOptionSpec<Path> torrcFileOpt =\n+                parser.accepts(\"torrcFile\", \"An existing torrc-file to be sourced for Tor. Note that torrc-entries, \" +\n+                        \"which are critical to Bisq's correct operation, cannot be overwritten.\")\n+                        .withRequiredArg()\n+                        .withValuesConvertedBy(new PathConverter(PathProperties.FILE_EXISTING, PathProperties.READABLE));\n+\n+        try {\n+            OptionSet cliOpts = parser.parse(args);\n+\n+            if (cliOpts.has(helpOpt))\n+                throw new HelpRequested(parser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8"}, "originalPosition": 178}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkzMDA4NQ==", "bodyText": "Prefer braces...", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368930085", "createdAt": "2020-01-21T10:48:36Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/config/Config.java", "diffHunk": "@@ -0,0 +1,344 @@\n+package bisq.common.config;\n+\n+import bisq.common.util.Utilities;\n+\n+import joptsimple.AbstractOptionSpec;\n+import joptsimple.ArgumentAcceptingOptionSpec;\n+import joptsimple.OptionException;\n+import joptsimple.OptionParser;\n+import joptsimple.OptionSet;\n+import joptsimple.OptionSpec;\n+import joptsimple.util.PathConverter;\n+import joptsimple.util.PathProperties;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import java.io.File;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ch.qos.logback.classic.Level;\n+\n+import static java.lang.String.format;\n+import static java.util.stream.Collectors.toList;\n+\n+public class Config {\n+\n+    static final String DEFAULT_CONFIG_FILE_NAME = \"bisq.properties\";\n+    static final int DEFAULT_NODE_PORT = 9999;\n+\n+    public static File CURRENT_APP_DATA_DIR;\n+\n+    private final String defaultAppName;\n+    private final File defaultUserDataDir;\n+    private final File defaultAppDataDir;\n+    private final File defaultConfigFile;\n+\n+    private final File configFile;\n+    private final String appName;\n+    private final File userDataDir;\n+    private final File appDataDir;\n+    private final int nodePort;\n+    private final List<String> bannedBtcNodes;\n+    private final List<String> bannedPriceRelayNodes;\n+    private final List<String> bannedSeedNodes;\n+    private final BaseCurrencyNetwork baseCurrencyNetwork;\n+    private final boolean ignoreLocalBtcNode;\n+    private final String bitcoinRegtestHost;\n+    private final boolean daoActivated;\n+    private final boolean fullDaoNode;\n+    private final String logLevel;\n+    private final Path torrcFile;\n+\n+    // FIXME: Carryover from legacy BisqEnvironment; there should be no mutable state here\n+    private boolean localBitcoinNodeIsRunning = false;\n+\n+    public Config(String defaultAppName) throws HelpRequested {\n+        this(defaultAppName, new String[]{});\n+    }\n+\n+    public Config(String defaultAppName, String[] args) throws HelpRequested {\n+        this.defaultAppName = defaultAppName;\n+        this.defaultUserDataDir = getDefaultUserDataDir();\n+        this.defaultAppDataDir = new File(defaultUserDataDir, this.defaultAppName);\n+        this.defaultConfigFile = new File(defaultAppDataDir, DEFAULT_CONFIG_FILE_NAME);\n+\n+        OptionParser parser = new OptionParser();\n+        parser.allowsUnrecognizedOptions();\n+\n+        AbstractOptionSpec<Void> helpOpt =\n+                parser.accepts(\"help\", \"Print this help text\")\n+                        .forHelp();\n+\n+        ArgumentAcceptingOptionSpec<String> configFileOpt =\n+                parser.accepts(\"configFile\", \"Specify configuration file. \" +\n+                        \"Relative paths will be prefixed by appDataDir location.\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(DEFAULT_CONFIG_FILE_NAME);\n+\n+        ArgumentAcceptingOptionSpec<File> userDataDirOpt =\n+                parser.accepts(\"userDataDir\", \"User data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultUserDataDir);\n+\n+        ArgumentAcceptingOptionSpec<String> appNameOpt =\n+                parser.accepts(\"appName\", \"Application name\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(this.defaultAppName);\n+\n+        ArgumentAcceptingOptionSpec<File> appDataDirOpt =\n+                parser.accepts(\"appDataDir\", \"Application data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultAppDataDir);\n+\n+        ArgumentAcceptingOptionSpec<Integer> nodePortOpt =\n+                parser.accepts(\"nodePort\", \"Port to listen on\")\n+                        .withRequiredArg()\n+                        .ofType(Integer.class)\n+                        .defaultsTo(DEFAULT_NODE_PORT);\n+\n+        ArgumentAcceptingOptionSpec<String> bannedBtcNodesOpt =\n+                parser.accepts(\"bannedBtcNodes\", \"List Bitcoin nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedPriceRelayNodesOpt =\n+                parser.accepts(\"bannedPriceRelayNodes\", \"List Bisq price nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedSeedNodesOpt =\n+                parser.accepts(\"bannedSeedNodes\", \"List Bisq seed nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<Enum> baseCurrencyNetworkOpt =\n+                parser.accepts(\"baseCurrencyNetwork\", \"Base currency network\")\n+                        .withRequiredArg()\n+                        .ofType(BaseCurrencyNetwork.class)\n+                        .withValuesConvertedBy(new EnumValueConverter(BaseCurrencyNetwork.class))\n+                        .defaultsTo(BaseCurrencyNetwork.BTC_MAINNET);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> ignoreLocalBtcNodeOpt =\n+                parser.accepts(\"ignoreLocalBtcNode\", \"If set to true a Bitcoin Core node running locally will be ignored\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> bitcoinRegtestHostOpt =\n+                parser.accepts(\"bitcoinRegtestHost\", \"Bitcoin Core node when using BTC_REGTEST network\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"host[:port]\")\n+                        .defaultsTo(\"localhost\");\n+\n+        ArgumentAcceptingOptionSpec<Boolean> daoActivatedOpt =\n+                parser.accepts(\"daoActivated\", \"Developer flag. If true it enables dao phase 2 features.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(true);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> fullDaoNodeOpt =\n+                parser.accepts(\"fullDaoNode\", \"If set to true the node requests the blockchain data via RPC requests \" +\n+                        \"from Bitcoin Core and provide the validated BSQ txs to the network. It requires that the \" +\n+                        \"other RPC properties are set as well.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> logLevelOpt =\n+                parser.accepts(\"logLevel\", \"Set logging level\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE\")\n+                        .defaultsTo(Level.INFO.levelStr);\n+\n+        ArgumentAcceptingOptionSpec<Path> torrcFileOpt =\n+                parser.accepts(\"torrcFile\", \"An existing torrc-file to be sourced for Tor. Note that torrc-entries, \" +\n+                        \"which are critical to Bisq's correct operation, cannot be overwritten.\")\n+                        .withRequiredArg()\n+                        .withValuesConvertedBy(new PathConverter(PathProperties.FILE_EXISTING, PathProperties.READABLE));\n+\n+        try {\n+            OptionSet cliOpts = parser.parse(args);\n+\n+            if (cliOpts.has(helpOpt))\n+                throw new HelpRequested(parser);\n+\n+            CompositeOptionSet options = new CompositeOptionSet();\n+            options.addOptionSet(cliOpts);\n+\n+            File configFile = null;\n+            final boolean cliHasConfigFileOpt = cliOpts.has(configFileOpt);\n+            boolean configFileHasBeenProcessed = false;\n+            if (cliHasConfigFileOpt) {\n+                configFile = new File(cliOpts.valueOf(configFileOpt));\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                if (configFileOpts.isPresent()) {\n+                    options.addOptionSet(configFileOpts.get());\n+                    configFileHasBeenProcessed = true;\n+                }\n+            }\n+\n+            this.appName = options.valueOf(appNameOpt);\n+            this.userDataDir = options.valueOf(userDataDirOpt);\n+            this.appDataDir = options.has(appDataDirOpt) ?\n+                    options.valueOf(appDataDirOpt) :\n+                    new File(this.userDataDir, this.appName);\n+\n+            CURRENT_APP_DATA_DIR = appDataDir;\n+\n+            if (!configFileHasBeenProcessed) {\n+                configFile = cliHasConfigFileOpt && !configFile.isAbsolute() ?\n+                        new File(this.appDataDir, configFile.getPath()) : // TODO: test\n+                        new File(this.appDataDir, DEFAULT_CONFIG_FILE_NAME);\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                configFileOpts.ifPresent(options::addOptionSet);\n+            }\n+\n+            this.configFile = configFile;\n+            this.nodePort = options.valueOf(nodePortOpt);\n+            this.bannedBtcNodes = options.valuesOf(bannedBtcNodesOpt);\n+            this.bannedPriceRelayNodes = options.valuesOf(bannedPriceRelayNodesOpt);\n+            this.bannedSeedNodes = options.valuesOf(bannedSeedNodesOpt);\n+            this.baseCurrencyNetwork = (BaseCurrencyNetwork) options.valueOf(baseCurrencyNetworkOpt);\n+            BaseCurrencyNetwork.CURRENT_NETWORK = baseCurrencyNetwork;\n+            BaseCurrencyNetwork.CURRENT_PARAMETERS = baseCurrencyNetwork.getParameters();\n+            this.ignoreLocalBtcNode = options.valueOf(ignoreLocalBtcNodeOpt);\n+            this.bitcoinRegtestHost = options.valueOf(bitcoinRegtestHostOpt);\n+            this.daoActivated = options.valueOf(daoActivatedOpt) || !baseCurrencyNetwork.isMainnet();\n+            this.fullDaoNode = options.valueOf(fullDaoNodeOpt);\n+            this.logLevel = options.valueOf(logLevelOpt);\n+            this.torrcFile = options.valueOf(torrcFileOpt);\n+\n+        } catch (OptionException ex) {\n+            throw new ConfigException(format(\"problem parsing option '%s': %s\",\n+                    ex.options().get(0),\n+                    ex.getCause() != null ?\n+                            ex.getCause().getMessage() :\n+                            ex.getMessage()));\n+        }\n+    }\n+\n+    private Optional<OptionSet> parseOptionsFrom(File file, OptionParser parser, OptionSpec<?>... disallowedOpts) {\n+        if (!file.isAbsolute() || !file.exists())\n+            return Optional.empty();\n+\n+        ConfigFileReader configFileReader = new ConfigFileReader(file);\n+        String[] optionLines = configFileReader.getOptionLines().stream()\n+                .map(o -> \"--\" + o) // prepend dashes expected by jopt parser below\n+                .collect(toList())\n+                .toArray(new String[]{});\n+\n+        OptionSet configFileOpts = parser.parse(optionLines);\n+        for (OptionSpec<?> disallowedOpt : disallowedOpts)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkzMDIyNA==", "bodyText": "...for all blocks.", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368930224", "createdAt": "2020-01-21T10:48:49Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/config/Config.java", "diffHunk": "@@ -0,0 +1,344 @@\n+package bisq.common.config;\n+\n+import bisq.common.util.Utilities;\n+\n+import joptsimple.AbstractOptionSpec;\n+import joptsimple.ArgumentAcceptingOptionSpec;\n+import joptsimple.OptionException;\n+import joptsimple.OptionParser;\n+import joptsimple.OptionSet;\n+import joptsimple.OptionSpec;\n+import joptsimple.util.PathConverter;\n+import joptsimple.util.PathProperties;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import java.io.File;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ch.qos.logback.classic.Level;\n+\n+import static java.lang.String.format;\n+import static java.util.stream.Collectors.toList;\n+\n+public class Config {\n+\n+    static final String DEFAULT_CONFIG_FILE_NAME = \"bisq.properties\";\n+    static final int DEFAULT_NODE_PORT = 9999;\n+\n+    public static File CURRENT_APP_DATA_DIR;\n+\n+    private final String defaultAppName;\n+    private final File defaultUserDataDir;\n+    private final File defaultAppDataDir;\n+    private final File defaultConfigFile;\n+\n+    private final File configFile;\n+    private final String appName;\n+    private final File userDataDir;\n+    private final File appDataDir;\n+    private final int nodePort;\n+    private final List<String> bannedBtcNodes;\n+    private final List<String> bannedPriceRelayNodes;\n+    private final List<String> bannedSeedNodes;\n+    private final BaseCurrencyNetwork baseCurrencyNetwork;\n+    private final boolean ignoreLocalBtcNode;\n+    private final String bitcoinRegtestHost;\n+    private final boolean daoActivated;\n+    private final boolean fullDaoNode;\n+    private final String logLevel;\n+    private final Path torrcFile;\n+\n+    // FIXME: Carryover from legacy BisqEnvironment; there should be no mutable state here\n+    private boolean localBitcoinNodeIsRunning = false;\n+\n+    public Config(String defaultAppName) throws HelpRequested {\n+        this(defaultAppName, new String[]{});\n+    }\n+\n+    public Config(String defaultAppName, String[] args) throws HelpRequested {\n+        this.defaultAppName = defaultAppName;\n+        this.defaultUserDataDir = getDefaultUserDataDir();\n+        this.defaultAppDataDir = new File(defaultUserDataDir, this.defaultAppName);\n+        this.defaultConfigFile = new File(defaultAppDataDir, DEFAULT_CONFIG_FILE_NAME);\n+\n+        OptionParser parser = new OptionParser();\n+        parser.allowsUnrecognizedOptions();\n+\n+        AbstractOptionSpec<Void> helpOpt =\n+                parser.accepts(\"help\", \"Print this help text\")\n+                        .forHelp();\n+\n+        ArgumentAcceptingOptionSpec<String> configFileOpt =\n+                parser.accepts(\"configFile\", \"Specify configuration file. \" +\n+                        \"Relative paths will be prefixed by appDataDir location.\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(DEFAULT_CONFIG_FILE_NAME);\n+\n+        ArgumentAcceptingOptionSpec<File> userDataDirOpt =\n+                parser.accepts(\"userDataDir\", \"User data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultUserDataDir);\n+\n+        ArgumentAcceptingOptionSpec<String> appNameOpt =\n+                parser.accepts(\"appName\", \"Application name\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(this.defaultAppName);\n+\n+        ArgumentAcceptingOptionSpec<File> appDataDirOpt =\n+                parser.accepts(\"appDataDir\", \"Application data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultAppDataDir);\n+\n+        ArgumentAcceptingOptionSpec<Integer> nodePortOpt =\n+                parser.accepts(\"nodePort\", \"Port to listen on\")\n+                        .withRequiredArg()\n+                        .ofType(Integer.class)\n+                        .defaultsTo(DEFAULT_NODE_PORT);\n+\n+        ArgumentAcceptingOptionSpec<String> bannedBtcNodesOpt =\n+                parser.accepts(\"bannedBtcNodes\", \"List Bitcoin nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedPriceRelayNodesOpt =\n+                parser.accepts(\"bannedPriceRelayNodes\", \"List Bisq price nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedSeedNodesOpt =\n+                parser.accepts(\"bannedSeedNodes\", \"List Bisq seed nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<Enum> baseCurrencyNetworkOpt =\n+                parser.accepts(\"baseCurrencyNetwork\", \"Base currency network\")\n+                        .withRequiredArg()\n+                        .ofType(BaseCurrencyNetwork.class)\n+                        .withValuesConvertedBy(new EnumValueConverter(BaseCurrencyNetwork.class))\n+                        .defaultsTo(BaseCurrencyNetwork.BTC_MAINNET);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> ignoreLocalBtcNodeOpt =\n+                parser.accepts(\"ignoreLocalBtcNode\", \"If set to true a Bitcoin Core node running locally will be ignored\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> bitcoinRegtestHostOpt =\n+                parser.accepts(\"bitcoinRegtestHost\", \"Bitcoin Core node when using BTC_REGTEST network\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"host[:port]\")\n+                        .defaultsTo(\"localhost\");\n+\n+        ArgumentAcceptingOptionSpec<Boolean> daoActivatedOpt =\n+                parser.accepts(\"daoActivated\", \"Developer flag. If true it enables dao phase 2 features.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(true);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> fullDaoNodeOpt =\n+                parser.accepts(\"fullDaoNode\", \"If set to true the node requests the blockchain data via RPC requests \" +\n+                        \"from Bitcoin Core and provide the validated BSQ txs to the network. It requires that the \" +\n+                        \"other RPC properties are set as well.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> logLevelOpt =\n+                parser.accepts(\"logLevel\", \"Set logging level\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE\")\n+                        .defaultsTo(Level.INFO.levelStr);\n+\n+        ArgumentAcceptingOptionSpec<Path> torrcFileOpt =\n+                parser.accepts(\"torrcFile\", \"An existing torrc-file to be sourced for Tor. Note that torrc-entries, \" +\n+                        \"which are critical to Bisq's correct operation, cannot be overwritten.\")\n+                        .withRequiredArg()\n+                        .withValuesConvertedBy(new PathConverter(PathProperties.FILE_EXISTING, PathProperties.READABLE));\n+\n+        try {\n+            OptionSet cliOpts = parser.parse(args);\n+\n+            if (cliOpts.has(helpOpt))\n+                throw new HelpRequested(parser);\n+\n+            CompositeOptionSet options = new CompositeOptionSet();\n+            options.addOptionSet(cliOpts);\n+\n+            File configFile = null;\n+            final boolean cliHasConfigFileOpt = cliOpts.has(configFileOpt);\n+            boolean configFileHasBeenProcessed = false;\n+            if (cliHasConfigFileOpt) {\n+                configFile = new File(cliOpts.valueOf(configFileOpt));\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                if (configFileOpts.isPresent()) {\n+                    options.addOptionSet(configFileOpts.get());\n+                    configFileHasBeenProcessed = true;\n+                }\n+            }\n+\n+            this.appName = options.valueOf(appNameOpt);\n+            this.userDataDir = options.valueOf(userDataDirOpt);\n+            this.appDataDir = options.has(appDataDirOpt) ?\n+                    options.valueOf(appDataDirOpt) :\n+                    new File(this.userDataDir, this.appName);\n+\n+            CURRENT_APP_DATA_DIR = appDataDir;\n+\n+            if (!configFileHasBeenProcessed) {\n+                configFile = cliHasConfigFileOpt && !configFile.isAbsolute() ?\n+                        new File(this.appDataDir, configFile.getPath()) : // TODO: test\n+                        new File(this.appDataDir, DEFAULT_CONFIG_FILE_NAME);\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                configFileOpts.ifPresent(options::addOptionSet);\n+            }\n+\n+            this.configFile = configFile;\n+            this.nodePort = options.valueOf(nodePortOpt);\n+            this.bannedBtcNodes = options.valuesOf(bannedBtcNodesOpt);\n+            this.bannedPriceRelayNodes = options.valuesOf(bannedPriceRelayNodesOpt);\n+            this.bannedSeedNodes = options.valuesOf(bannedSeedNodesOpt);\n+            this.baseCurrencyNetwork = (BaseCurrencyNetwork) options.valueOf(baseCurrencyNetworkOpt);\n+            BaseCurrencyNetwork.CURRENT_NETWORK = baseCurrencyNetwork;\n+            BaseCurrencyNetwork.CURRENT_PARAMETERS = baseCurrencyNetwork.getParameters();\n+            this.ignoreLocalBtcNode = options.valueOf(ignoreLocalBtcNodeOpt);\n+            this.bitcoinRegtestHost = options.valueOf(bitcoinRegtestHostOpt);\n+            this.daoActivated = options.valueOf(daoActivatedOpt) || !baseCurrencyNetwork.isMainnet();\n+            this.fullDaoNode = options.valueOf(fullDaoNodeOpt);\n+            this.logLevel = options.valueOf(logLevelOpt);\n+            this.torrcFile = options.valueOf(torrcFileOpt);\n+\n+        } catch (OptionException ex) {\n+            throw new ConfigException(format(\"problem parsing option '%s': %s\",\n+                    ex.options().get(0),\n+                    ex.getCause() != null ?\n+                            ex.getCause().getMessage() :\n+                            ex.getMessage()));\n+        }\n+    }\n+\n+    private Optional<OptionSet> parseOptionsFrom(File file, OptionParser parser, OptionSpec<?>... disallowedOpts) {\n+        if (!file.isAbsolute() || !file.exists())\n+            return Optional.empty();\n+\n+        ConfigFileReader configFileReader = new ConfigFileReader(file);\n+        String[] optionLines = configFileReader.getOptionLines().stream()\n+                .map(o -> \"--\" + o) // prepend dashes expected by jopt parser below\n+                .collect(toList())\n+                .toArray(new String[]{});\n+\n+        OptionSet configFileOpts = parser.parse(optionLines);\n+        for (OptionSpec<?> disallowedOpt : disallowedOpts)\n+            if (configFileOpts.has(disallowedOpt))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8"}, "originalPosition": 247}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkzMTAyMA==", "bodyText": "Prefer braces even for single, unbroken line blocks, but I don't think we have completely agreed on that one.", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368931020", "createdAt": "2020-01-21T10:50:25Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/config/Config.java", "diffHunk": "@@ -0,0 +1,344 @@\n+package bisq.common.config;\n+\n+import bisq.common.util.Utilities;\n+\n+import joptsimple.AbstractOptionSpec;\n+import joptsimple.ArgumentAcceptingOptionSpec;\n+import joptsimple.OptionException;\n+import joptsimple.OptionParser;\n+import joptsimple.OptionSet;\n+import joptsimple.OptionSpec;\n+import joptsimple.util.PathConverter;\n+import joptsimple.util.PathProperties;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import java.io.File;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ch.qos.logback.classic.Level;\n+\n+import static java.lang.String.format;\n+import static java.util.stream.Collectors.toList;\n+\n+public class Config {\n+\n+    static final String DEFAULT_CONFIG_FILE_NAME = \"bisq.properties\";\n+    static final int DEFAULT_NODE_PORT = 9999;\n+\n+    public static File CURRENT_APP_DATA_DIR;\n+\n+    private final String defaultAppName;\n+    private final File defaultUserDataDir;\n+    private final File defaultAppDataDir;\n+    private final File defaultConfigFile;\n+\n+    private final File configFile;\n+    private final String appName;\n+    private final File userDataDir;\n+    private final File appDataDir;\n+    private final int nodePort;\n+    private final List<String> bannedBtcNodes;\n+    private final List<String> bannedPriceRelayNodes;\n+    private final List<String> bannedSeedNodes;\n+    private final BaseCurrencyNetwork baseCurrencyNetwork;\n+    private final boolean ignoreLocalBtcNode;\n+    private final String bitcoinRegtestHost;\n+    private final boolean daoActivated;\n+    private final boolean fullDaoNode;\n+    private final String logLevel;\n+    private final Path torrcFile;\n+\n+    // FIXME: Carryover from legacy BisqEnvironment; there should be no mutable state here\n+    private boolean localBitcoinNodeIsRunning = false;\n+\n+    public Config(String defaultAppName) throws HelpRequested {\n+        this(defaultAppName, new String[]{});\n+    }\n+\n+    public Config(String defaultAppName, String[] args) throws HelpRequested {\n+        this.defaultAppName = defaultAppName;\n+        this.defaultUserDataDir = getDefaultUserDataDir();\n+        this.defaultAppDataDir = new File(defaultUserDataDir, this.defaultAppName);\n+        this.defaultConfigFile = new File(defaultAppDataDir, DEFAULT_CONFIG_FILE_NAME);\n+\n+        OptionParser parser = new OptionParser();\n+        parser.allowsUnrecognizedOptions();\n+\n+        AbstractOptionSpec<Void> helpOpt =\n+                parser.accepts(\"help\", \"Print this help text\")\n+                        .forHelp();\n+\n+        ArgumentAcceptingOptionSpec<String> configFileOpt =\n+                parser.accepts(\"configFile\", \"Specify configuration file. \" +\n+                        \"Relative paths will be prefixed by appDataDir location.\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(DEFAULT_CONFIG_FILE_NAME);\n+\n+        ArgumentAcceptingOptionSpec<File> userDataDirOpt =\n+                parser.accepts(\"userDataDir\", \"User data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultUserDataDir);\n+\n+        ArgumentAcceptingOptionSpec<String> appNameOpt =\n+                parser.accepts(\"appName\", \"Application name\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .defaultsTo(this.defaultAppName);\n+\n+        ArgumentAcceptingOptionSpec<File> appDataDirOpt =\n+                parser.accepts(\"appDataDir\", \"Application data directory\")\n+                        .withRequiredArg()\n+                        .ofType(File.class)\n+                        .defaultsTo(defaultAppDataDir);\n+\n+        ArgumentAcceptingOptionSpec<Integer> nodePortOpt =\n+                parser.accepts(\"nodePort\", \"Port to listen on\")\n+                        .withRequiredArg()\n+                        .ofType(Integer.class)\n+                        .defaultsTo(DEFAULT_NODE_PORT);\n+\n+        ArgumentAcceptingOptionSpec<String> bannedBtcNodesOpt =\n+                parser.accepts(\"bannedBtcNodes\", \"List Bitcoin nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedPriceRelayNodesOpt =\n+                parser.accepts(\"bannedPriceRelayNodes\", \"List Bisq price nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<String> bannedSeedNodesOpt =\n+                parser.accepts(\"bannedSeedNodes\", \"List Bisq seed nodes to ban\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .withValuesSeparatedBy(',')\n+                        .describedAs(\"host:port[,...]\");\n+\n+        ArgumentAcceptingOptionSpec<Enum> baseCurrencyNetworkOpt =\n+                parser.accepts(\"baseCurrencyNetwork\", \"Base currency network\")\n+                        .withRequiredArg()\n+                        .ofType(BaseCurrencyNetwork.class)\n+                        .withValuesConvertedBy(new EnumValueConverter(BaseCurrencyNetwork.class))\n+                        .defaultsTo(BaseCurrencyNetwork.BTC_MAINNET);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> ignoreLocalBtcNodeOpt =\n+                parser.accepts(\"ignoreLocalBtcNode\", \"If set to true a Bitcoin Core node running locally will be ignored\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> bitcoinRegtestHostOpt =\n+                parser.accepts(\"bitcoinRegtestHost\", \"Bitcoin Core node when using BTC_REGTEST network\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"host[:port]\")\n+                        .defaultsTo(\"localhost\");\n+\n+        ArgumentAcceptingOptionSpec<Boolean> daoActivatedOpt =\n+                parser.accepts(\"daoActivated\", \"Developer flag. If true it enables dao phase 2 features.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(true);\n+\n+        ArgumentAcceptingOptionSpec<Boolean> fullDaoNodeOpt =\n+                parser.accepts(\"fullDaoNode\", \"If set to true the node requests the blockchain data via RPC requests \" +\n+                        \"from Bitcoin Core and provide the validated BSQ txs to the network. It requires that the \" +\n+                        \"other RPC properties are set as well.\")\n+                        .withRequiredArg()\n+                        .ofType(Boolean.class)\n+                        .defaultsTo(false);\n+\n+        ArgumentAcceptingOptionSpec<String> logLevelOpt =\n+                parser.accepts(\"logLevel\", \"Set logging level\")\n+                        .withRequiredArg()\n+                        .ofType(String.class)\n+                        .describedAs(\"OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE\")\n+                        .defaultsTo(Level.INFO.levelStr);\n+\n+        ArgumentAcceptingOptionSpec<Path> torrcFileOpt =\n+                parser.accepts(\"torrcFile\", \"An existing torrc-file to be sourced for Tor. Note that torrc-entries, \" +\n+                        \"which are critical to Bisq's correct operation, cannot be overwritten.\")\n+                        .withRequiredArg()\n+                        .withValuesConvertedBy(new PathConverter(PathProperties.FILE_EXISTING, PathProperties.READABLE));\n+\n+        try {\n+            OptionSet cliOpts = parser.parse(args);\n+\n+            if (cliOpts.has(helpOpt))\n+                throw new HelpRequested(parser);\n+\n+            CompositeOptionSet options = new CompositeOptionSet();\n+            options.addOptionSet(cliOpts);\n+\n+            File configFile = null;\n+            final boolean cliHasConfigFileOpt = cliOpts.has(configFileOpt);\n+            boolean configFileHasBeenProcessed = false;\n+            if (cliHasConfigFileOpt) {\n+                configFile = new File(cliOpts.valueOf(configFileOpt));\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                if (configFileOpts.isPresent()) {\n+                    options.addOptionSet(configFileOpts.get());\n+                    configFileHasBeenProcessed = true;\n+                }\n+            }\n+\n+            this.appName = options.valueOf(appNameOpt);\n+            this.userDataDir = options.valueOf(userDataDirOpt);\n+            this.appDataDir = options.has(appDataDirOpt) ?\n+                    options.valueOf(appDataDirOpt) :\n+                    new File(this.userDataDir, this.appName);\n+\n+            CURRENT_APP_DATA_DIR = appDataDir;\n+\n+            if (!configFileHasBeenProcessed) {\n+                configFile = cliHasConfigFileOpt && !configFile.isAbsolute() ?\n+                        new File(this.appDataDir, configFile.getPath()) : // TODO: test\n+                        new File(this.appDataDir, DEFAULT_CONFIG_FILE_NAME);\n+                Optional<OptionSet> configFileOpts = parseOptionsFrom(configFile, parser, helpOpt, configFileOpt);\n+                configFileOpts.ifPresent(options::addOptionSet);\n+            }\n+\n+            this.configFile = configFile;\n+            this.nodePort = options.valueOf(nodePortOpt);\n+            this.bannedBtcNodes = options.valuesOf(bannedBtcNodesOpt);\n+            this.bannedPriceRelayNodes = options.valuesOf(bannedPriceRelayNodesOpt);\n+            this.bannedSeedNodes = options.valuesOf(bannedSeedNodesOpt);\n+            this.baseCurrencyNetwork = (BaseCurrencyNetwork) options.valueOf(baseCurrencyNetworkOpt);\n+            BaseCurrencyNetwork.CURRENT_NETWORK = baseCurrencyNetwork;\n+            BaseCurrencyNetwork.CURRENT_PARAMETERS = baseCurrencyNetwork.getParameters();\n+            this.ignoreLocalBtcNode = options.valueOf(ignoreLocalBtcNodeOpt);\n+            this.bitcoinRegtestHost = options.valueOf(bitcoinRegtestHostOpt);\n+            this.daoActivated = options.valueOf(daoActivatedOpt) || !baseCurrencyNetwork.isMainnet();\n+            this.fullDaoNode = options.valueOf(fullDaoNodeOpt);\n+            this.logLevel = options.valueOf(logLevelOpt);\n+            this.torrcFile = options.valueOf(torrcFileOpt);\n+\n+        } catch (OptionException ex) {\n+            throw new ConfigException(format(\"problem parsing option '%s': %s\",\n+                    ex.options().get(0),\n+                    ex.getCause() != null ?\n+                            ex.getCause().getMessage() :\n+                            ex.getMessage()));\n+        }\n+    }\n+\n+    private Optional<OptionSet> parseOptionsFrom(File file, OptionParser parser, OptionSpec<?>... disallowedOpts) {\n+        if (!file.isAbsolute() || !file.exists())\n+            return Optional.empty();\n+\n+        ConfigFileReader configFileReader = new ConfigFileReader(file);\n+        String[] optionLines = configFileReader.getOptionLines().stream()\n+                .map(o -> \"--\" + o) // prepend dashes expected by jopt parser below\n+                .collect(toList())\n+                .toArray(new String[]{});\n+\n+        OptionSet configFileOpts = parser.parse(optionLines);\n+        for (OptionSpec<?> disallowedOpt : disallowedOpts)\n+            if (configFileOpts.has(disallowedOpt))\n+                throw new IllegalArgumentException(\n+                        format(\"The '%s' option is disallowed in config files\", disallowedOpt.options().get(0)));\n+\n+        return Optional.of(configFileOpts);\n+    }\n+\n+    public String getDefaultAppName() {\n+        return defaultAppName;\n+    }\n+\n+    public File getDefaultUserDataDir() {\n+        if (Utilities.isWindows())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8"}, "originalPosition": 259}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTk3NTQz", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345997543", "createdAt": "2020-01-21T16:07:08Z", "commit": {"oid": "dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTE0NjQx", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-344514641", "createdAt": "2020-01-17T11:18:58Z", "commit": {"oid": "83a2fc8c35be49812e60d552f59a07ea9534065e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTkwMzM3", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345190337", "createdAt": "2020-01-20T09:54:43Z", "commit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwOTo1NDo0M1rOFfYxkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwOTo1NDo0M1rOFfYxkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1NjA4MA==", "bodyText": "@cbeams As we decided to be as restrictive as possible with new dependencies: Could you please point out why they are necessary (especially for the non-google libs)? Although they are required for the GRPC API I think it is good practice to have some documentation (even if it is just a comment in the PR) every time we add new dependencies to the project.", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368456080", "createdAt": "2020-01-20T09:54:43Z", "author": {"login": "ripcurlx"}, "path": "gradle/witness/gradle-witness.gradle", "diffHunk": "@@ -46,34 +55,61 @@ dependencyVerification {\n         'com.nativelibs4java:bridj:101bcd9b6637e6bc16e56deb3daefba62b1f5e8e9e37e1b3e56e3b5860d659cf',\n         'com.squareup.okhttp:okhttp:b4c943138fcef2bcc9d2006b2250c4aabbedeafc5947ed7c0af7fd103ceb2707',\n         'com.squareup.okio:okio:114bdc1f47338a68bcbc95abf2f5cdc72beeec91812f2fcd7b521c1937876266',\n-        'commons-codec:commons-codec:ad19d2601c3abf0b946b5c3a4113e226a8c1e3305e395b90013b78dd94a723ce',\n+        'commons-codec:commons-codec:e599d5318e97aa48f42136a2927e6dfa4e8881dff0e6c8e3109ddbbff51d7b7d',\n         'commons-io:commons-io:cc6a41dc3eaacc9e440a6bd0d2890b20d36b4ee408fe2d67122f328bb6e01581',\n         'commons-logging:commons-logging:daddea1ea0be0f56978ab3006b8ac92834afeefbd9b7e4e6316fca57df0fa636',\n         'de.jensd:fontawesomefx-commons:5539bb3335ecb822dbf928546f57766eeb9f1516cc1417a064b5709629612149',\n         'de.jensd:fontawesomefx-materialdesignfont:dbad8dfdd1c85e298d5bbae25b2399aec9e85064db57b2427d10f3815aa98752',\n         'de.jensd:fontawesomefx:73bacc991a0a6f5cf0f911767c8db161e0949dbca61e8371eb4342e3da96887b',\n         'io.github.microutils:kotlin-logging:4992504fd3c6ecdf9ed10874b9508e758bb908af9e9d7af19a61e9afb6b7e27a',\n+        'io.grpc:grpc-alts:177aa1e578c10e274f8feedd6f555c2e7741c195a84f533f9a51fb82dbe8a596',\n+        'io.grpc:grpc-api:a269094009588213ab5386a6fb92426b8056a130b2653d3b4e59e971f2f1ef08',\n+        'io.grpc:grpc-auth:782ae07923d53b56f54326e7b32480b425eb3df71deb5a4a33bbfc6487e706a4',\n+        'io.grpc:grpc-context:f4c8f878c320f6fb56c1c14692618f6df8253314b556176e32727afbc5921a73',\n+        'io.grpc:grpc-core:d67fa113fd9cc45a02710f9c41dda9c15191448c14e9e96fcc21839a41345d4c',\n+        'io.grpc:grpc-grpclb:aaac0d6063204dfc52abc51af94f16b6cecfd582bb477ee1d232e42920bf49e3',\n+        'io.grpc:grpc-netty-shaded:9edfd45da473d2efbb5683fc3eaf1857e82d2148033d82dd558a7ac38731ea33',\n+        'io.grpc:grpc-netty:167e834788f6d4f7bd129bfb244d4e09d061a0e7165288378386ae871e3cfe51',\n+        'io.grpc:grpc-protobuf-lite:9ba9aaa3e6997a04c707793c25e3ec88c6bad86f8d6f6b8b7a1a0c33ea2429d8',\n+        'io.grpc:grpc-protobuf:454dae7e246dac25526ed5b795d97a5dafedd3cc2042cfc810f02051d7d3e3cb',\n+        'io.grpc:grpc-stub:1532e291c0e9fd8230a6416c8ebbd902d99c7e2760241ae638ea761aa3dd5f43',\n+        'io.netty:netty-buffer:7b0171a4e8bcd573e08d9f2bba053c67b557ab5012106a5982ccbae5743814c0',\n+        'io.netty:netty-codec-http2:8bac9625eb68635396eb0c13c9cc0b22bde7c83d0cd2dae3fe9b6f9cf929e372',\n+        'io.netty:netty-codec-http:eb349c0f1b249af7c7a8fbbd1c761d65d9bc230880cd8d37feab9e8278292625',\n+        'io.netty:netty-codec-socks:7f14b3a95ee9aa5a26f66af668690578a81a883683ac1c4ca9e9afdf4d4c7894',\n+        'io.netty:netty-codec:e96ced697fb7df589da7c20c995e01f75a9cb246be242bbc4cd3b4af424ff189',\n+        'io.netty:netty-common:3d0a918d78292eeca02a7bb2188daa4e5053b6e29b71e6308309033e121242b5',\n+        'io.netty:netty-handler-proxy:25f22da21c29ab0d3b6b889412351bcfc5f9ccd42e07d2d5513d5c4eb571f343',\n+        'io.netty:netty-handler:11eda86500c33b9d386719b5419f513fd9c097d13894f25dd0c75b610d636e03',\n+        'io.netty:netty-resolver:89768242b6b7cce9bd9f5945ad21d1b4bae515c6b1bf03a8af5d1899779cebc9',\n+        'io.netty:netty-tcnative-boringssl-static:0ea1a935a1023a88e99a4f9b1aba2e3ff2799d4d1994f4bff848f85b367d48ed',\n+        'io.netty:netty-transport:dfa817a156ea263aa9ad8364a2e226527665c9722aca40a7945f228c2c14f1da',\n+        'io.opencensus:opencensus-api:8e2cb0f6391d8eb0a1bcd01e7748883f0033b1941754f4ed3f19d2c3e4276fc8',\n+        'io.opencensus:opencensus-contrib-grpc-metrics:29fc79401082301542cab89d7054d2f0825f184492654c950020553ef4ff0ef8',\n+        'io.opencensus:opencensus-contrib-http-util:d62fd27175a842bde135f6f6b1d6f25d42e9bd59a87bc98709a4760fe399ee14',\n+        'io.perfmark:perfmark-api:b734ba2149712409a44eabdb799f64768578fee0defe1418bb108fe32ea43e1a',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjEyNjgy", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345212682", "createdAt": "2020-01-20T10:30:25Z", "commit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMDozMDoyNVrOFfZ31Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMDozMDoyNVrOFfZ31Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ3NDA2OQ==", "bodyText": "NIT: 0.12 should be at least 0.15 otherwise the security deposit is too low for our current setup", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368474069", "createdAt": "2020-01-20T10:30:25Z", "author": {"login": "ripcurlx"}, "path": "grpc/src/main/java/bisq/grpc/BisqGrpcClient.java", "diffHunk": "@@ -0,0 +1,297 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.grpc;\n+\n+import bisq.core.payment.PaymentAccount;\n+import bisq.core.proto.network.CoreNetworkProtoResolver;\n+import bisq.core.proto.persistable.CorePersistenceProtoResolver;\n+\n+import org.bitcoinj.core.Coin;\n+\n+import java.time.Clock;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Scanner;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+\n+import lombok.extern.slf4j.Slf4j;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+\n+\n+\n+import bisq.grpc.protobuf.GetBalanceGrpc;\n+import bisq.grpc.protobuf.GetBalanceRequest;\n+import bisq.grpc.protobuf.GetOffersGrpc;\n+import bisq.grpc.protobuf.GetOffersRequest;\n+import bisq.grpc.protobuf.GetPaymentAccountsGrpc;\n+import bisq.grpc.protobuf.GetPaymentAccountsRequest;\n+import bisq.grpc.protobuf.GetTradeStatisticsGrpc;\n+import bisq.grpc.protobuf.GetTradeStatisticsRequest;\n+import bisq.grpc.protobuf.GetVersionGrpc;\n+import bisq.grpc.protobuf.GetVersionRequest;\n+import bisq.grpc.protobuf.PlaceOfferGrpc;\n+import bisq.grpc.protobuf.PlaceOfferRequest;\n+import bisq.grpc.protobuf.StopServerGrpc;\n+import bisq.grpc.protobuf.StopServerRequest;\n+import io.grpc.ManagedChannel;\n+import io.grpc.ManagedChannelBuilder;\n+import io.grpc.StatusRuntimeException;\n+\n+/**\n+ * gRPC client.\n+ *\n+ * FIXME We get warning 'DEBUG io.grpc.netty.shaded.io.netty.util.internal.PlatformDependent0 - direct buffer constructor: unavailable\n+ * java.lang.UnsupportedOperationException: Reflective setAccessible(true) disabled' which is\n+ * related to Java 10 changes. Requests are working but we should find out why we get that warning\n+ */\n+@Slf4j\n+public class BisqGrpcClient {\n+    private static BisqGrpcClient instance;\n+\n+    private final ManagedChannel channel;\n+    private final GetVersionGrpc.GetVersionBlockingStub getVersionStub;\n+    private final GetBalanceGrpc.GetBalanceBlockingStub getBalanceStub;\n+    private final StopServerGrpc.StopServerBlockingStub stopServerStub;\n+    private final GetTradeStatisticsGrpc.GetTradeStatisticsBlockingStub getTradeStatisticsStub;\n+    private final GetOffersGrpc.GetOffersBlockingStub getOffersStub;\n+    private final GetPaymentAccountsGrpc.GetPaymentAccountsBlockingStub getPaymentAccountsStub;\n+    private final PlaceOfferGrpc.PlaceOfferBlockingStub placeOfferBlockingStub;\n+    private final CorePersistenceProtoResolver corePersistenceProtoResolver;\n+    private final CoreNetworkProtoResolver coreNetworkProtoResolver;\n+\n+    public static void main(String[] args) throws Exception {\n+        instance = new BisqGrpcClient(\"localhost\", 8888);\n+    }\n+\n+    private BisqGrpcClient(String host, int port) {\n+        this(ManagedChannelBuilder.forAddress(host, port)\n+                // Channels are secure by default (via SSL/TLS). For the example we disable TLS to avoid\n+                // needing certificates.\n+                .usePlaintext(true).build());\n+\n+        // Simple input scanner\n+        // TODO use some more sophisticated input processing with validation....\n+        try (Scanner scanner = new Scanner(System.in);) {\n+            while (true) {\n+                long startTs = System.currentTimeMillis();\n+\n+                String[] tokens = scanner.nextLine().split(\" \");\n+                if (tokens.length == 0) {\n+                    return;\n+                }\n+                String command = tokens[0];\n+                List<String> params = new ArrayList<>();\n+                if (tokens.length > 1) {\n+                    params.addAll(Arrays.asList(tokens));\n+                    params.remove(0);\n+                }\n+                String result = \"\";\n+\n+                switch (command) {\n+                    case \"getVersion\":\n+                        result = getVersion();\n+                        break;\n+                    case \"getBalance\":\n+                        result = Coin.valueOf(getBalance()).toFriendlyString();\n+                        break;\n+                    case \"getTradeStatistics\":\n+                        List<bisq.core.trade.statistics.TradeStatistics2> tradeStatistics = getTradeStatistics().stream()\n+                                .map(bisq.core.trade.statistics.TradeStatistics2::fromProto)\n+                                .collect(Collectors.toList());\n+\n+                        result = tradeStatistics.toString();\n+                        break;\n+                    case \"getOffers\":\n+                        List<bisq.core.offer.Offer> offers = getOffers().stream()\n+                                .map(bisq.core.offer.Offer::fromProto)\n+                                .collect(Collectors.toList());\n+                        result = offers.toString();\n+                        break;\n+                    case \"getPaymentAccounts\":\n+                        List<PaymentAccount> paymentAccounts = getPaymentAccounts().stream()\n+                                .map(proto -> PaymentAccount.fromProto(proto, corePersistenceProtoResolver))\n+                                .collect(Collectors.toList());\n+                        result = paymentAccounts.toString();\n+                        break;\n+                    case \"placeOffer\":\n+                        // test input: placeOffer CNY BUY 750000000 true -0.2251 1000000 500000 0.12 5a972121-c30a-4b0e-b519-b17b63795d16", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "originalPosition": 136}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjEzMDA1", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345213005", "createdAt": "2020-01-20T10:30:57Z", "commit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMDozMDo1OFrOFfZ4vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMDozMDo1OFrOFfZ4vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ3NDMwMw==", "bodyText": "Somehow this command didn't work for me.", "url": "https://github.com/bisq-network/bisq/pull/3889#discussion_r368474303", "createdAt": "2020-01-20T10:30:58Z", "author": {"login": "ripcurlx"}, "path": "grpc/src/main/java/bisq/grpc/BisqGrpcClient.java", "diffHunk": "@@ -0,0 +1,297 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.grpc;\n+\n+import bisq.core.payment.PaymentAccount;\n+import bisq.core.proto.network.CoreNetworkProtoResolver;\n+import bisq.core.proto.persistable.CorePersistenceProtoResolver;\n+\n+import org.bitcoinj.core.Coin;\n+\n+import java.time.Clock;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Scanner;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+\n+import lombok.extern.slf4j.Slf4j;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+\n+\n+\n+import bisq.grpc.protobuf.GetBalanceGrpc;\n+import bisq.grpc.protobuf.GetBalanceRequest;\n+import bisq.grpc.protobuf.GetOffersGrpc;\n+import bisq.grpc.protobuf.GetOffersRequest;\n+import bisq.grpc.protobuf.GetPaymentAccountsGrpc;\n+import bisq.grpc.protobuf.GetPaymentAccountsRequest;\n+import bisq.grpc.protobuf.GetTradeStatisticsGrpc;\n+import bisq.grpc.protobuf.GetTradeStatisticsRequest;\n+import bisq.grpc.protobuf.GetVersionGrpc;\n+import bisq.grpc.protobuf.GetVersionRequest;\n+import bisq.grpc.protobuf.PlaceOfferGrpc;\n+import bisq.grpc.protobuf.PlaceOfferRequest;\n+import bisq.grpc.protobuf.StopServerGrpc;\n+import bisq.grpc.protobuf.StopServerRequest;\n+import io.grpc.ManagedChannel;\n+import io.grpc.ManagedChannelBuilder;\n+import io.grpc.StatusRuntimeException;\n+\n+/**\n+ * gRPC client.\n+ *\n+ * FIXME We get warning 'DEBUG io.grpc.netty.shaded.io.netty.util.internal.PlatformDependent0 - direct buffer constructor: unavailable\n+ * java.lang.UnsupportedOperationException: Reflective setAccessible(true) disabled' which is\n+ * related to Java 10 changes. Requests are working but we should find out why we get that warning\n+ */\n+@Slf4j\n+public class BisqGrpcClient {\n+    private static BisqGrpcClient instance;\n+\n+    private final ManagedChannel channel;\n+    private final GetVersionGrpc.GetVersionBlockingStub getVersionStub;\n+    private final GetBalanceGrpc.GetBalanceBlockingStub getBalanceStub;\n+    private final StopServerGrpc.StopServerBlockingStub stopServerStub;\n+    private final GetTradeStatisticsGrpc.GetTradeStatisticsBlockingStub getTradeStatisticsStub;\n+    private final GetOffersGrpc.GetOffersBlockingStub getOffersStub;\n+    private final GetPaymentAccountsGrpc.GetPaymentAccountsBlockingStub getPaymentAccountsStub;\n+    private final PlaceOfferGrpc.PlaceOfferBlockingStub placeOfferBlockingStub;\n+    private final CorePersistenceProtoResolver corePersistenceProtoResolver;\n+    private final CoreNetworkProtoResolver coreNetworkProtoResolver;\n+\n+    public static void main(String[] args) throws Exception {\n+        instance = new BisqGrpcClient(\"localhost\", 8888);\n+    }\n+\n+    private BisqGrpcClient(String host, int port) {\n+        this(ManagedChannelBuilder.forAddress(host, port)\n+                // Channels are secure by default (via SSL/TLS). For the example we disable TLS to avoid\n+                // needing certificates.\n+                .usePlaintext(true).build());\n+\n+        // Simple input scanner\n+        // TODO use some more sophisticated input processing with validation....\n+        try (Scanner scanner = new Scanner(System.in);) {\n+            while (true) {\n+                long startTs = System.currentTimeMillis();\n+\n+                String[] tokens = scanner.nextLine().split(\" \");\n+                if (tokens.length == 0) {\n+                    return;\n+                }\n+                String command = tokens[0];\n+                List<String> params = new ArrayList<>();\n+                if (tokens.length > 1) {\n+                    params.addAll(Arrays.asList(tokens));\n+                    params.remove(0);\n+                }\n+                String result = \"\";\n+\n+                switch (command) {\n+                    case \"getVersion\":\n+                        result = getVersion();\n+                        break;\n+                    case \"getBalance\":\n+                        result = Coin.valueOf(getBalance()).toFriendlyString();\n+                        break;\n+                    case \"getTradeStatistics\":\n+                        List<bisq.core.trade.statistics.TradeStatistics2> tradeStatistics = getTradeStatistics().stream()\n+                                .map(bisq.core.trade.statistics.TradeStatistics2::fromProto)\n+                                .collect(Collectors.toList());\n+\n+                        result = tradeStatistics.toString();\n+                        break;\n+                    case \"getOffers\":\n+                        List<bisq.core.offer.Offer> offers = getOffers().stream()\n+                                .map(bisq.core.offer.Offer::fromProto)\n+                                .collect(Collectors.toList());\n+                        result = offers.toString();\n+                        break;\n+                    case \"getPaymentAccounts\":\n+                        List<PaymentAccount> paymentAccounts = getPaymentAccounts().stream()\n+                                .map(proto -> PaymentAccount.fromProto(proto, corePersistenceProtoResolver))\n+                                .collect(Collectors.toList());\n+                        result = paymentAccounts.toString();\n+                        break;\n+                    case \"placeOffer\":\n+                        // test input: placeOffer CNY BUY 750000000 true -0.2251 1000000 500000 0.12 5a972121-c30a-4b0e-b519-b17b63795d16\n+                        // payment accountId and currency need to be adopted\n+\n+                        // We expect 9 params\n+                        // TODO add basic input validation\n+                        try {\n+                            checkArgument(params.size() == 9);\n+                            String currencyCode = params.get(0);\n+                            String directionAsString = params.get(1);\n+                            long priceAsLong = Long.parseLong(params.get(2));\n+                            boolean useMarketBasedPrice = Boolean.parseBoolean(params.get(3));\n+                            double marketPriceMargin = Double.parseDouble(params.get(4));\n+                            long amountAsLong = Long.parseLong(params.get(5));\n+                            long minAmountAsLong = Long.parseLong(params.get(6));\n+                            double buyerSecurityDeposit = Double.parseDouble(params.get(7));\n+                            String paymentAccountId = params.get(8);\n+                            boolean success = placeOffer(currencyCode,\n+                                    directionAsString,\n+                                    priceAsLong,\n+                                    useMarketBasedPrice,\n+                                    marketPriceMargin,\n+                                    amountAsLong,\n+                                    minAmountAsLong,\n+                                    buyerSecurityDeposit,\n+                                    paymentAccountId);\n+                            result = String.valueOf(success);\n+                            break;\n+                        } catch (Throwable t) {\n+                            log.error(t.toString(), t);\n+                            break;\n+                        }\n+                    case \"stop\":\n+                        result = \"Shut down client\";\n+                        try {\n+                            shutdown();\n+                        } catch (InterruptedException e) {\n+                            log.error(e.toString(), e);\n+                        }\n+                        break;\n+                    case \"stopServer\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "originalPosition": 175}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjIwNzA4", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345220708", "createdAt": "2020-01-20T10:44:08Z", "commit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b34d59c0a930e436b0b542114c48005ff857d4c8", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/b34d59c0a930e436b0b542114c48005ff857d4c8", "committedDate": "2020-01-20T15:37:54Z", "message": "Introduce Config as replacement for BisqEnvironment\n\nPrior to this commit, BisqExecutable has been responsible for parsing\ncommand line and config file options and BisqEnvironment has been\nresponsible for assigning default values to those options and providing\naccess to option values to callers throughout the codebase.\n\nThis approach has worked, but at considerable costs in complexity,\nverbosity, and lack of any type-safety in option values. BisqEnvironment\nis based on the Spring Framework's Environment abstraction, which\nprovides a great deal of flexibility in handling command line options,\nenvironment variables, and more, but also operates on the assumption\nthat such inputs have String-based values.\n\nAfter having this infrastructure in place for years now, it has become\nevident that using Spring's Environment abstraction was both overkill\nfor what we needed and limited us from getting the kind of concision and\ntype saftey that we want. The Environment abstraction is by default\nactually too flexible. For example, Bisq does not want or need to have\nenvironment variables potentially overriding configuration file values,\nas this increases our attack surface and makes our threat model more\ncomplex. This is why we explicitly removed support for handling\nenvironment variables quite some time ago.\n\nThe BisqEnvironment class has also organically evolved toward becoming a\nkind of \"God object\", responsible for more than just option handling. It\nis also, for example, responsible for tracking the status of the user's\nlocal Bitcoin node, if any. It is also responsible for writing values to\nthe bisq.properties config file when certain ban filters arrive via the\np2p network. In the commits that follow, these unrelated functions will\nbe factored out appropriately in order to separate concerns.\n\nAs a solution to these problems, this commit begins the process of\neliminating BisqEnvironment in favor of a new, bespoke Config class\ncustom-tailored to Bisq's needs. Config removes the responsibility for\noption parsing from BisqExecutable, and in the end provides \"one-stop\nshopping\" for all option parsing and access needs.\n\nThe changes included in this commit represent a proof of concept for the\nConfig class, where handling of a number of options has been moved from\nBisqEnvironment and BisqExecutable over to Config. Because the migration\nis only partial, both Config and BisqEnvironment are injected\nside-by-side into calling code that needs access to options. As the\nmigration is completed, BisqEnvironment will be removed entirely, and\nonly the Config object will remain.\n\nAn additional benefit of the elimination of BisqEnvironment is that it\nwill allow us to remove our dependency on the Spring Framework (with the\nexception of the standalone pricenode application, which is Spring-based\nby design).\n\nNote that while this change and those that follow it are principally a\nrefactoring effort, certain functional changes have been introduced. For\nexample, Bisq now supports a `--configFile` argument at the command line\nthat functions very similarly to Bitcoin Core's `-conf` option."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdaa901a298841c5613fc60fb0d1d981565578d3", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/cdaa901a298841c5613fc60fb0d1d981565578d3", "committedDate": "2020-01-20T15:37:55Z", "message": "Move 'referralId' option handling from BisqEnvironment to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70bdccb258546611332d50871f9dd12084a1d59c", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/70bdccb258546611332d50871f9dd12084a1d59c", "committedDate": "2020-01-20T15:37:55Z", "message": "Move 'useDevMode' option handling from BisqEnvironment to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3e0b853db2f0d3dc39a3cf0201a2af27706415f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/f3e0b853db2f0d3dc39a3cf0201a2af27706415f", "committedDate": "2020-01-20T15:37:56Z", "message": "Move 'btcNetworkDir' and co from BisqEnvironment to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f029fea3866b4f6e2338077108615ab427abaa4f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/f029fea3866b4f6e2338077108615ab427abaa4f", "committedDate": "2020-01-20T15:39:29Z", "message": "Move 'useDevPrivilegeKeys' option handling from BisqEnvironment to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c1ef5921c415967f9c5211f05681aff84aadea2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/6c1ef5921c415967f9c5211f05681aff84aadea2", "committedDate": "2020-01-20T15:39:29Z", "message": "Remove BisqException parser calls for options already moved to Config\n\nSet OptionParser.allowsUnrecognizedOptions(true) to make sure\nBisqEnvironment doesn't fail while options are still being transferred\none-by-one to Config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2781c16c5e29dc3b87f47fc2945ec81281306e0", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e2781c16c5e29dc3b87f47fc2945ec81281306e0", "committedDate": "2020-01-20T15:39:29Z", "message": "Move 'dumpStatistics' option handling from BisqEnvironment to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceac8bb9e22351077d5a75bc9cbc68678b2dc816", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/ceac8bb9e22351077d5a75bc9cbc68678b2dc816", "committedDate": "2020-01-20T15:39:29Z", "message": "Finish moving baseCurrencyNetwork option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19410764689a6a59a283e6a8b8b50c805c8687f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/a19410764689a6a59a283e6a8b8b50c805c8687f", "committedDate": "2020-01-20T15:39:30Z", "message": "Finish moving 'appDataDir' option handling to Config\n\nNOTE: This removes entirely the old BisqExecutable.appDataDir method\nimplemented for the v0.5.3 hotfix that renames the data dir from 'bisq'\nto 'Bisq'. See a7f3d68cb for details."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0766af5d05772347cb5700243ad74651d15ab2b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e0766af5d05772347cb5700243ad74651d15ab2b", "committedDate": "2020-01-20T15:39:30Z", "message": "Finish moving 'userDataDir' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1842c47b2bf9934e288aa8ab74e3b6f1c728b630", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/1842c47b2bf9934e288aa8ab74e3b6f1c728b630", "committedDate": "2020-01-20T15:39:30Z", "message": "Remove long-unused core.btc.UserAgent class\n\nThis was added way back in 8f8866da and has since fallen out of use\nentirely.\n\nRemoving it now because it depends on BisqEnvironment.appName, which\nwill be moved to Config in the next commit."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a20013c77de7dbe4fc5233d3c95cc45f6409574", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/6a20013c77de7dbe4fc5233d3c95cc45f6409574", "committedDate": "2020-01-20T15:39:30Z", "message": "Finish moving 'appName' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "849bd7c286fe2f6e2aadc5835340dca19b50f9e3", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/849bd7c286fe2f6e2aadc5835340dca19b50f9e3", "committedDate": "2020-01-20T15:39:30Z", "message": "Move 'maxMemory' option handling to Config\n\nNote that the default value of 600 advertised in BisqExecutable's option\nhandling was incorrect. The actual value had since become 1200 MB. This\ncorrect default is now reflected in Config's option handling."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13db7672a6e1c674c90d51f288de765273d620d0", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/13db7672a6e1c674c90d51f288de765273d620d0", "committedDate": "2020-01-20T15:39:30Z", "message": "Remove unused 'desktopWithHttpApi' option handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051c53278e79e5f7ac0d73b975eed9ad5255e27b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/051c53278e79e5f7ac0d73b975eed9ad5255e27b", "committedDate": "2020-01-20T15:39:31Z", "message": "Move 'ignoreDevMsg' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a720475871fbc5c3daefbaecde8cfbc70fdf4bc3", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/a720475871fbc5c3daefbaecde8cfbc70fdf4bc3", "committedDate": "2020-01-20T15:39:31Z", "message": "Move 'providers' option handling to Config\n\nThis option should be renamed to 'priceNodes' or similar, but is out of\nscope here."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f5d5a77a8a2245ebd002eb0e6b3b28af89a3dc", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/a2f5d5a77a8a2245ebd002eb0e6b3b28af89a3dc", "committedDate": "2020-01-20T15:39:31Z", "message": "Remove now unused AppOptionKeys class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6319fe66f279dd72eac377072398fc8ae25997e", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/f6319fe66f279dd72eac377072398fc8ae25997e", "committedDate": "2020-01-20T15:39:31Z", "message": "Finish moving 'logLevel' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7be2ff19f844d8ae00684eaa5c25deb5acede8bb", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/7be2ff19f844d8ae00684eaa5c25deb5acede8bb", "committedDate": "2020-01-20T15:39:31Z", "message": "Remove now unused CommonOptionKeys class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e118165e9a05aaed99fdb023edd1d2fd799def6c", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e118165e9a05aaed99fdb023edd1d2fd799def6c", "committedDate": "2020-01-20T15:39:31Z", "message": "Move 'seedNode' option handling to Config\n\nAnd eliminate @Named injection in favor of calling config.getSeedNodes()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c56c06d939a21d8cbdb475a32ac55b9be0e27703", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/c56c06d939a21d8cbdb475a32ac55b9be0e27703", "committedDate": "2020-01-20T15:39:32Z", "message": "Move 'banList' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef7196ef8aca2a75561560fb9450d9baff8fee75", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/ef7196ef8aca2a75561560fb9450d9baff8fee75", "committedDate": "2020-01-20T15:39:32Z", "message": "Finish moving 'nodePort' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e48a3ef2c773540db5844b454bac5580e9e97ed", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/0e48a3ef2c773540db5844b454bac5580e9e97ed", "committedDate": "2020-01-20T15:39:32Z", "message": "Move 'useLocalhostForP2P' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d6dbad484499c296d65e413864bb7b8e53cea07", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/8d6dbad484499c296d65e413864bb7b8e53cea07", "committedDate": "2020-01-20T15:39:32Z", "message": "Move 'maxConnections' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c02b120438341cc8b110445abb3a34b886b4698", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/5c02b120438341cc8b110445abb3a34b886b4698", "committedDate": "2020-01-20T15:39:32Z", "message": "Move 'socks5ProxyBtcAddress' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a0683e9849b34e4dcd3c8835e7426f59be362ff", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/5a0683e9849b34e4dcd3c8835e7426f59be362ff", "committedDate": "2020-01-20T15:39:32Z", "message": "Move 'socks5ProxyHttpAddress' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fea3a641c0cfbb4731d9a1d41e8784b5bf54fa45", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/fea3a641c0cfbb4731d9a1d41e8784b5bf54fa45", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torrcFile' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923ec69966f8d6d1c83b6f6befff0b8cdf47bfe2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/923ec69966f8d6d1c83b6f6befff0b8cdf47bfe2", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torrcOptions' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d25ad0d266bb197eb53770b7a007893428d1c048", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/d25ad0d266bb197eb53770b7a007893428d1c048", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torControlPort' option handling to Config\n\nNote the introduction of Config.NULL_INT to avoid needing to inject\nnullable boxed Integers in cases like this."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5966d0ddcbc3e825252b2e325b34d8c3dcf9d7fd", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/5966d0ddcbc3e825252b2e325b34d8c3dcf9d7fd", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torControlPassword' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90b2566a94a7739c8b5e8e8391ac050bc0c871b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e90b2566a94a7739c8b5e8e8391ac050bc0c871b", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torControlCookieFile' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25604c1b296fd9090f93599d5ed8794e7ba6411b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/25604c1b296fd9090f93599d5ed8794e7ba6411b", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torControlUseSafeCookieAuth' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca3719a13963049d85620ed7132251188ef16108", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/ca3719a13963049d85620ed7132251188ef16108", "committedDate": "2020-01-20T15:39:33Z", "message": "Move 'torStreamIsolation' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbd72b358e1f600d8bdfbf7486414bc3673f447", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/2dbd72b358e1f600d8bdfbf7486414bc3673f447", "committedDate": "2020-01-20T15:39:34Z", "message": "Move message throttle option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3002b16776aaa29aa58ce18ab5070b242e98808e", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/3002b16776aaa29aa58ce18ab5070b242e98808e", "committedDate": "2020-01-20T15:39:34Z", "message": "Make defaultUserDataDir field a local variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e4107d80ad535facd9f3f9705852d839f56a19d", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/8e4107d80ad535facd9f3f9705852d839f56a19d", "committedDate": "2020-01-20T15:39:34Z", "message": "Remove obsolete NETWORK_ID option key\n\nNETWORK_ID has not been in use since commit de93a6fa1, except by\nthe DummySeedNode test class, where its use has been preserved as string\nliterals."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "326375e4e4bef5b8ff3dd6e346d9de8783ab8102", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/326375e4e4bef5b8ff3dd6e346d9de8783ab8102", "committedDate": "2020-01-20T15:39:34Z", "message": "Remove now unused NetworkOptionKeys class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be971904158afbaf0224196b39d2b0226a08bee3", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/be971904158afbaf0224196b39d2b0226a08bee3", "committedDate": "2020-01-20T15:39:34Z", "message": "Rename Config.{NULL_INT=>DEFAULT_INT} for clarity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "769c62b7b341354fe2e27e3d0f86026922ffb5dc", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/769c62b7b341354fe2e27e3d0f86026922ffb5dc", "committedDate": "2020-01-20T15:39:34Z", "message": "Finish moving 'bitcoinRegtestHost' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85285890d193f29b1f0a764bc1a06a25a906706c", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/85285890d193f29b1f0a764bc1a06a25a906706c", "committedDate": "2020-01-20T15:39:35Z", "message": "Move Config.log declaration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fb60a33ac7b6d46b197201fd7c614b6d9eaaa2a", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/4fb60a33ac7b6d46b197201fd7c614b6d9eaaa2a", "committedDate": "2020-01-20T15:39:35Z", "message": "Finish moving 'ignoreLocalBtcNode' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5271d4d574a199117925586e71611632c77b5c37", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/5271d4d574a199117925586e71611632c77b5c37", "committedDate": "2020-01-20T15:39:35Z", "message": "Move 'btcNodes' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90031543b9b9cdbf378dad55c8f0ebfa81a0843b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/90031543b9b9cdbf378dad55c8f0ebfa81a0843b", "committedDate": "2020-01-20T15:39:35Z", "message": "Move 'useTorForBtc' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7889dd994d86f18711950fdd532bf890ad7fb0d", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/b7889dd994d86f18711950fdd532bf890ad7fb0d", "committedDate": "2020-01-20T15:39:35Z", "message": "Move 'socks5DiscoverMode' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97cafaf61e9c2f47955d9ba7cef16698e8d72a1a", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/97cafaf61e9c2f47955d9ba7cef16698e8d72a1a", "committedDate": "2020-01-20T15:39:35Z", "message": "Move 'useAllProvidedNodes' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8d739ded5d3b5e72baec9f5ca74749a56bab8c1", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/c8d739ded5d3b5e72baec9f5ca74749a56bab8c1", "committedDate": "2020-01-20T15:39:36Z", "message": "Move 'userAgent' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99cf8c9596946fb19840fc0e66615c3d6d3ad037", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/99cf8c9596946fb19840fc0e66615c3d6d3ad037", "committedDate": "2020-01-20T15:40:29Z", "message": "Move 'numConnectionsForBtc' option handling to Config\n\nNote that this change makes the user-facing change of renaming\nthe 'numConnectionForBtc' (singular 'Connection') to\n'numConnectionsForBtc' (plural 'Connections'). It is presumed that not\nmany users are relying on this option for day-to-day operations, and the\nsingular version was pretty clearly a typo / oversight."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "919c58eefe2aeaa9aa369c217f54ec827bd1bcb4", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/919c58eefe2aeaa9aa369c217f54ec827bd1bcb4", "committedDate": "2020-01-20T15:40:29Z", "message": "Remove now unused BtcOptionKeys class\n\nIncludes cleaning up a couple unrelated unused imports in\nP2PNetworkLoad."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80754ed3d52bd8fb639a2740cd395c9405e08ba4", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/80754ed3d52bd8fb639a2740cd395c9405e08ba4", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcUser' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d4ca4fbe1d19a5763584a933c463aeb6b6e48b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/b4d4ca4fbe1d19a5763584a933c463aeb6b6e48b", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcPassword' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "182f47239488420786953a7e819a76424f4ea964", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/182f47239488420786953a7e819a76424f4ea964", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcHost' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86e1ae1008e07c130f0d3c81cd508ef22ab2d699", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/86e1ae1008e07c130f0d3c81cd508ef22ab2d699", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcPort' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3841e6b1ddaefdeb9628dafe1697d51c6fdba0ee", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/3841e6b1ddaefdeb9628dafe1697d51c6fdba0ee", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcBlockNotificationPort' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a7eedb250cdde636f4cb8e91568b91c2ce6daf5", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/9a7eedb250cdde636f4cb8e91568b91c2ce6daf5", "committedDate": "2020-01-20T15:40:30Z", "message": "Move 'rpcBlockNotificationHost' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2995bc27bd1c6ab2726dd00ea4dacd2b1e0f5f75", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/2995bc27bd1c6ab2726dd00ea4dacd2b1e0f5f75", "committedDate": "2020-01-20T15:40:31Z", "message": "Move 'dumpBlockchainData' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "519259b752999eb5cd3b4334499fe9b8cb90f6df", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/519259b752999eb5cd3b4334499fe9b8cb90f6df", "committedDate": "2020-01-20T15:40:31Z", "message": "Move 'fullDaoNode' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ea146444f9e9cb02d8cc55960ca7b96667b8235", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/6ea146444f9e9cb02d8cc55960ca7b96667b8235", "committedDate": "2020-01-20T15:40:31Z", "message": "Move 'genesisTxId' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca5b260806480ac5821cb04df2c0ff11da7048e2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/ca5b260806480ac5821cb04df2c0ff11da7048e2", "committedDate": "2020-01-20T15:40:31Z", "message": "Move 'genesisBlockHeight' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aadf7c76aa48c4050a280458784b298e6b78ed7b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/aadf7c76aa48c4050a280458784b298e6b78ed7b", "committedDate": "2020-01-20T15:40:31Z", "message": "Move 'genesisTotalSupply' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15c492b5b4c044d3c6a768d9764987681075f724", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/15c492b5b4c044d3c6a768d9764987681075f724", "committedDate": "2020-01-20T15:40:31Z", "message": "Finish moving 'daoActivated' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43fb85151444c1e2b5ac2dfc013f5bf7ef13ffd8", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/43fb85151444c1e2b5ac2dfc013f5bf7ef13ffd8", "committedDate": "2020-01-20T15:40:32Z", "message": "Remove now unused DaoOptionKeys class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ff6dd2c828b153d74333701d615ee9a3e0b89b2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/9ff6dd2c828b153d74333701d615ee9a3e0b89b2", "committedDate": "2020-01-20T15:40:32Z", "message": "Finish moving 'useDevPrivilegeKeys' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d042568a26dad2d3cde8ff685f65f77d9486f2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/c6d042568a26dad2d3cde8ff685f65f77d9486f2", "committedDate": "2020-01-20T15:40:32Z", "message": "Finish moving 'useDevMode' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1216ba2e2cf33bbb3f5d5ea087e696c66e7a188e", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/1216ba2e2cf33bbb3f5d5ea087e696c66e7a188e", "committedDate": "2020-01-20T15:40:32Z", "message": "Finish moving 'referralId' option handling to Config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a18547626170f5d88363ab01a151c83522c860", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/f5a18547626170f5d88363ab01a151c83522c860", "committedDate": "2020-01-20T15:41:19Z", "message": "Remove now unused BisqEnvironment class\n\nIn previous commits, BisqEnvironment functionality has been fully ported\nto the new, simpler and more type-safe Config class. This change removes\nBisqEnvironment and all dependencies on the Spring Framework Environment\ninterface that it implements.\n\nThe one exception is the pricenode module, which is separate and apart\nfrom the rest of the codebase in that it is a standalone, Spring-based\nHTTP service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c7829948ba4812dc2b6cade68e181c098890b20", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/2c7829948ba4812dc2b6cade68e181c098890b20", "committedDate": "2020-01-20T15:41:19Z", "message": "Replace uses of Spring CollectionUtils\n\nSee Javadoc in new bisq.common.util.CollectionUtils class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51a0e66ab63195256821f013ae35224a231dc57f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/51a0e66ab63195256821f013ae35224a231dc57f", "committedDate": "2020-01-20T15:41:19Z", "message": "Replace use of Spring's AnnotationUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "658df7968ed7bd0c2596544baeb7cfff7845f6f4", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/658df7968ed7bd0c2596544baeb7cfff7845f6f4", "committedDate": "2020-01-20T15:41:20Z", "message": "Replace use of Spring's ClassUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ab51de1af3913e92467fdf5276659d0a6e42c9", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/75ab51de1af3913e92467fdf5276659d0a6e42c9", "committedDate": "2020-01-20T15:41:20Z", "message": "Replace use of Spring's StringUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c968ddf034e85ce8df367a99e7e1e002447c8106", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/c968ddf034e85ce8df367a99e7e1e002447c8106", "committedDate": "2020-01-20T15:46:56Z", "message": "Eliminate dependency on Spring Framework\n\nIn conjuction with the previous commits, this change removes entirely\nBisq's dependency on the Spring Framework, with the exception of the\npricenode module, which is not a Bisq node per se, but a standalone\nSpring-based HTTP service.\n\nNote that the removal of the Gradle `exclude` directive for\ncommons-logging is because Apache HttpClient still depends on it and\nSpring had previously been providing it transitively. If this `exclude`\ndirective is not removed, NoClassDefFound errors get thrown at runtime\nfrom HttpClient code unable to load the commons-logging Logger class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d6d41b32908f4c176d1e00b031c77eb88d9fad9", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/6d6d41b32908f4c176d1e00b031c77eb88d9fad9", "committedDate": "2020-01-20T15:46:56Z", "message": "Broaden BisqExcutable exception handling\n\nPreviously, certain exceptions e.g. IllegalArgumentException would\nresult in the Bisq process exiting with an stack trace. This change\nbroadens exception handling during argument parsing such that all\nThrowable subclasses are caught and the Bisq process exits gracefully\nwith a simple error message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "022b5f190860240944a0ff98c4f052b361224167", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/022b5f190860240944a0ff98c4f052b361224167", "committedDate": "2020-01-20T15:46:56Z", "message": "Make ConfigException extend BisqException\n\nTo avoid the need to manually use String.format during construction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73823446182163e3fa53e650e4fa2b8cd7e747c1", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/73823446182163e3fa53e650e4fa2b8cd7e747c1", "committedDate": "2020-01-20T15:46:56Z", "message": "Catch ConfigException as contingency, Throwble as fault\n\nPreviously the code under bisq.common.config threw a mix of\nConfigException and IllegalArgumentException. It now throws\nConfigException consistently such that it may be caught and dealt with\nas an anticipated contingency, and such that any other Throwable may be\ncaught and dealt with as a fault, i.e. an unexpected error that probably\nrepresents a bug in the code.\n\nThe https://bisq.network/issues link presented to the user when a fault\noccurs is a redirect added to the website by PR\nhttps://github.com/bisq-network/bisq-website/pull/316.\n\nFor background on contingency vs. fault nomenclature, see:\nhttps://www.oracle.com/technical-resources/articles/enterprise-architecture/effective-exceptions-part3.html"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f605f873ff656b22108a9dc10aea5b265cfff3f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/3f605f873ff656b22108a9dc10aea5b265cfff3f", "committedDate": "2020-01-20T15:46:56Z", "message": "Remove now unused BisqExecutable option handling\n\nOption handling is now the responsibility of the Config class. JOpt's\nOptionParser is no longer passed down to BisqExecutable subclasses'\ndoExecute method, as they can now rely on the Config abstraction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5503a5aa412deb108eeb4bf0a473f786a435ef8", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/b5503a5aa412deb108eeb4bf0a473f786a435ef8", "committedDate": "2020-01-20T15:46:57Z", "message": "Replace HelpRequested exception with Config.isHelpRequested()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47794174a19dddd6a6e67b0622412cf7055b6148", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/47794174a19dddd6a6e67b0622412cf7055b6148", "committedDate": "2020-01-20T15:46:57Z", "message": "Remove ConnectionConfig console output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e67746b0a4b04dd72f35732065a29398caf39e11", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e67746b0a4b04dd72f35732065a29398caf39e11", "committedDate": "2020-01-20T15:46:57Z", "message": "Remove TestConfig in favor of reworked Config ctors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a02eea9410ddeb2cb0a58131d72ca06636a60644", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/a02eea9410ddeb2cb0a58131d72ca06636a60644", "committedDate": "2020-01-20T15:46:57Z", "message": "Extract Config.APP_DATA_DIR constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "174d2a98e6697dd8b17e74726c41518e57a50a15", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/174d2a98e6697dd8b17e74726c41518e57a50a15", "committedDate": "2020-01-20T15:46:57Z", "message": "Add comments to Config and reorder a few things\n\nThis adds a few basic comments to help understand the structure of the\nConfig class and also reorders several assignments and statements for\nclarity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a6b0ce9d886c3347b1182e7971d2075a1599c5a", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/3a6b0ce9d886c3347b1182e7971d2075a1599c5a", "committedDate": "2020-01-20T15:46:57Z", "message": "Normalize creation of appDataDir and subdirs\n\nPrior to this commit, the way that the appDataDir and its subdirectories\nwere created was a haphazard process that worked but in a fragile and\nnon-obvious way. When Config was instantiated, an attempt to call\nbtcNetworkDir.mkdir() was made, but if appDataDir did not already exist,\nthis call would always fail because mkdir() does not create parent\ndirectories. This problem was never detected, though, because the\nKeyStorage class happened to call mkdirs() on its 'keys' subdirectory,\nwhich, because of the plural mkdirs() call ended up creating the whole\n${appDataDir}/${btcNetworkDir}/keys hierarchy. Other btcNetworkDir\nsubdirectories such as tor/ and db/ then benefited from the hierarchy\nalready existing when they attempted to call mkdir() for their own dirs.\nSo the whole arrangement worked only because KeyStorage happened to make\na mkdirs() call and because that code in KeyStorage happened to get\ninvoked before the code that managed the other subdirectories.\n\nThis change ensures that appDataDir and all its subdirectories are\ncreated up front, such that they are guaranteed to exist by the time\nthey are injected into Storage, KeyStorage, WalletsSetup and TorSetup.\nThe hierarchy is unchanged, structured as it always has been:\n\n    ${appDataDir}\n    \u2514\u2500\u2500 btc_mainnet\n        \u251c\u2500\u2500 db\n        \u251c\u2500\u2500 keys\n        \u251c\u2500\u2500 wallet\n        \u2514\u2500\u2500 tor\n\nNote that the tor/ subdirectory actually gets deleted and re-created\nwithin the TorSetup infrastructure regardless of whether the directory\nexists beforehand."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42a037e19f6f568cfb62cb2a8a44e1e439500a80", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/42a037e19f6f568cfb62cb2a8a44e1e439500a80", "committedDate": "2020-01-20T15:46:58Z", "message": "Introduce and document static Config.baseCurrencyNetwork()\n\nPreviously this static property had been managed within\nBaseCurrencyNetwork itself and was accessed directly by callers. Now it\nis managed within Config, made private and accessed only via the\nnew and well-documented baseCurrencyNetwork() method. The same goes for\nbaseCurrencyNetworkParameters().\n\nIt is unfortunate that we must retain these mutable static fields and\naccessors, but after trying to eliminate them entirely, this approach is\nthe lesser of two evils; attempting to use a Config instance and\ninstance methods only ends up being quite cumbersome to implement,\nrequiring Config to be injected into many more classes than it currently\nis. Getting access to the BaseCurrencyNetwork is basically a special\ncase, and treating it specially as a static field is in the end the most\npragmatic approach."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ea329060840c0c51833042af32232fdb23703b3", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/4ea329060840c0c51833042af32232fdb23703b3", "committedDate": "2020-01-20T15:46:58Z", "message": "Introduce and document static Config.appDataDir()\n\nSee Javadoc added in this change and the previous commit message for\nfurther detail and context."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876b91e1be0002d2e214da294741d7d3d2baf20a", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/876b91e1be0002d2e214da294741d7d3d2baf20a", "committedDate": "2020-01-20T15:47:52Z", "message": "Introduce LocalBitcoinNode and tests\n\nThis new class encapsulates all functionality related to detecting a\nlocal Bitcoin node and reporting whether or not it was detected.\nPreviously this functionality was spread across the Config class\n(formerly BisqEnvironment) with its mutable static\nisLocalBitcoinNodeRunning property and the BisqSetup class with its\ncheckIfLocalHostNodeIsRunning method. All of this functionality now\nlives within the LocalBitcoinNode class, an instance of which is wired\nup via Guice and injected wherever necessary.\n\nNote that the code for detecting whether the node is running has been\nsimplified, in that it is no longer wrapped in its own dedicated Thread.\nThere appears to be no performance benefit from doing so, and leaving it\nin place would have made testing more difficult than necessary.\n\nSeveral methods in BisqSetup have also been refactored to accept\ncallbacks indicating which step should be run next. This has the effect\nof clarifying when the step2()-step5() methods will be called."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94603768cb10c786cd8e0ddad5f736f9eddb751b", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/94603768cb10c786cd8e0ddad5f736f9eddb751b", "committedDate": "2020-01-20T15:47:52Z", "message": "Move Config.getOsUserDataDir to BisqExecutable.osUserDataDir\n\nThis method is used only by BisqExecutable and so has been moved there,\nmade private and documented accordingly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1f54e95b12a9502002c136b202612b5e77c2465", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/e1f54e95b12a9502002c136b202612b5e77c2465", "committedDate": "2020-01-20T15:47:52Z", "message": "Rename and reorder test for nonexistent --configFile\n\nThis test is now named consintently and sorted next to other config file\ntests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d991e009a46765999c50baed0b04997d7f0e7ad", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/3d991e009a46765999c50baed0b04997d7f0e7ad", "committedDate": "2020-01-20T15:47:52Z", "message": "Qualify relative --configFile value with appDataDir\n\nThis behavior had already been implemented prior to this commit, but has\nnow been tested and improved with refactoring and logging messages.\n\nNote that this approach emulates Bitcoin Core's own behavior. When\nrunning, for example, `bitcoind -conf=rel/path/to/bitcoin.conf`, the\nrelative path is prefixed / fully qualified by the value of the\n`datadir` option. So if `datadir` equals `~/Library/Application\nSupport/Bitcoin`, then the `conf` option value above would be fully\nqualified as\n\n    ~/Library/Application Support/Bitcoin/rel/path/to/bitcoin.conf\n\nIf the argument to `-conf` is an absolute path, e.g.\n`/tmp/bitcoin.conf`, then that absolute path is used without further\nmodification or qualification. It is assumed that the rationale for this\nbehavior is to avoid accidentally running against the wrong conf file\nbecause `bitcoind` was invoked in a different directory than usual or\nbecause a malicious actor replaced the relative conf file with their own\nversion.\n\nBisq's new `--configFile` option works (and is now tested to work) in\nthe same way: relative paths get prefixed by the value of\nConfig.getAppDataDir(), and absolute paths are processed unmodified."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63489c13f25c48c6ad7110762d13349001d0c39f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/63489c13f25c48c6ad7110762d13349001d0c39f", "committedDate": "2020-01-20T15:47:53Z", "message": "Throw if --configFile value does not exist\n\nPreviously (as of the prior commit), a warning was issued if a\nnon-default config file path was specified at the command line, and then\nthe default config file path was used as a fallback. On review, however,\nit would be better to halt execution immediately if the config file does\nnot exist. There is no risk of breaking backward compatibility by doing\nthis as Bisq never had a --configFile option before the recent commits\nthat introduce it. Furthermore, there is no clear benefit to the\nfallback approach. If the user specifies a given config file and it does\nnot exist, they may not see the warning message in the log, and they may\nbe left with the impression that they are running against their custom\nconfig file when in fact they are running against the default (which may\nbe empty or non-existent itself). Thus throwing an exception as is now\ndone in this commit should make everything more explicit and clear."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe506098af055aa05596a552772afab17be89419", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/fe506098af055aa05596a552772afab17be89419", "committedDate": "2020-01-20T15:47:53Z", "message": "Introduce Config testing facilities\n\nPreviously ConfigTests constructed Config instances with string-based\noptions, e.g.:\n\n    Config config = new Config(\"--appName=My-Bisq\");\n\nThe advantage here is clarity, but the downside is repetition of the\noption names without any reference to their corresponding Config.*\nconstants.\n\nOne solution to the problem would be to format the option strings using\nconstants declared in the Config class, e.g.:\n\n    Config config = new Config(format(\"--%s=My-Bisq\", APP_NAME));\n\nbut this is verbose, cumbersome to read and write and requires repeating\nhe '--' and '=' option syntax.\n\nThis commit introduces the Opt class and the opt() and configWithOpts()\nmethods to ConfigTests to make testing easier while using constant\nreferences and preserving readability. e.g.:\n\n    Config config = configWithOpts(opt(APP_NAME, \"My-Bisq\"));\n\nIn the process of making these changes a bug was discovered in the\nmonitor submodule's P2PNetworkLoad class and that has been fixed here as\nwell.\n\nThis change also required introducing several option name constants that\nhad not previously been extracted in order to be referenced within\nConfigTests. For consistency and completeness, all additional option\nnames that did not previously have a contstant now have one."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5abc97b049b854a62dd5e957f80350b40569dab", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/d5abc97b049b854a62dd5e957f80350b40569dab", "committedDate": "2020-01-20T15:47:53Z", "message": "Document Config and related types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ac46e47178607c27405941c1eca7231441ff90f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/4ac46e47178607c27405941c1eca7231441ff90f", "committedDate": "2020-01-20T15:47:53Z", "message": "Reorder a few of the most important options\n\nThere is currently no explicit rule for how option-related elements are\nordered in the code, but it is important to understand that the order in\nwhich options are registered via parser.accept() calls is the order in\nwhich they appear in --help output.\n\nIt would be nice to group options together into sections and separate\nthem in the --help output with section headers similar to the way that\nBitcoin Core's help output does it, but this is not a built-in option\nwith the JOpt Simple library, and not worth trying to hack into place at\nthe moment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37b669c710888497c6b884d7bd747858131ef858", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/37b669c710888497c6b884d7bd747858131ef858", "committedDate": "2020-01-20T15:47:54Z", "message": "Make Config option fields public and inline accessors\n\nSee updated Config Javadoc for rationale."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efba97581359eba485d074b4b7a715d7851f1f82", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/efba97581359eba485d074b4b7a715d7851f1f82", "committedDate": "2020-01-20T15:47:54Z", "message": "Avoid race condition in LocalBitcoinNodeTests\n\nPreviously, Travis CI was failing non-deterministically due to a race\ncondition in which a thread was started in order to call the blocking\nServerSocket.accept() method, and sometimes the subsequent attempt by\nLocalBitcoinNode.detectAndRun() to connect to that socket's port would\noccur before the thread had actually called the accept() method.\n\nThis commit simplifies the approach by removing the thread entirely. As\nit turns out, calling accept() is not necessary; simply constructing a\nnew ServerSocket() binds to and listens on the given port, such that a\nsubsequent attempt to connect() will succeed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248", "committedDate": "2020-01-20T15:47:54Z", "message": "Fix code quality issues\n\nPer Codacy report at\nhttps://app.codacy.com/gh/bisq-network/bisq/pullRequest?prid=4835062\n\nNote that the items claiming that bisq.common.config.Config.* is an\nunused import are false positives. These imports are in fact used in\nevery case."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "918c6c1289243c4b35dcd98dfeb5796cd9fda7b1", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/918c6c1289243c4b35dcd98dfeb5796cd9fda7b1", "committedDate": "2020-01-17T11:52:28Z", "message": "Fix code quality issues\n\nPer Codacy report at\nhttps://app.codacy.com/gh/bisq-network/bisq/pullRequest?prid=4835062\n\nNote that the items claiming that bisq.common.config.Config.* is an\nunused import are false positives. These imports are in fact used in\nevery case."}, "afterCommit": {"oid": "dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248", "committedDate": "2020-01-20T15:47:54Z", "message": "Fix code quality issues\n\nPer Codacy report at\nhttps://app.codacy.com/gh/bisq-network/bisq/pullRequest?prid=4835062\n\nNote that the items claiming that bisq.common.config.Config.* is an\nunused import are false positives. These imports are in fact used in\nevery case."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1Nzk3MTc2", "url": "https://github.com/bisq-network/bisq/pull/3889#pullrequestreview-345797176", "createdAt": "2020-01-21T11:07:35Z", "commit": {"oid": "dd5690fe2ad24b1d5d2ddd80652fa3c2d35d3248"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3394, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}