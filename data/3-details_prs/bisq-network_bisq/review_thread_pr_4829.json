{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0OTM1NDg5", "number": 4829, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNjowODozM1rOE73rZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNjowODozM1rOE73rZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjEzNjcwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/bisq/core/app/BisqSetup.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNjowODozM1rOH3viHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNjowODozM1rOH3viHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIxMjUwOQ==", "bodyText": "Since this can't really be tested by downgrading from an older pkg, I hacked BisqSetup.java Line 531:\npublic static boolean hasDowngraded(String lastVersion) {\n\treturn true;\n    // return lastVersion != null && Version.isNewVersion(lastVersion, Version.VERSION);\n}\n\nIt worked as expected, showing me a shutdown message & button, but I got an NPE after clicking the shutdown button.  I am not sure this is avoidable or very important, but think you'd want to know.\nNov-21 13:28:17.176 [JavaFX Application Thread] ERROR bisq.core.app.BisqSetup: Downgrade from version 1.5.0 to version 1.5.0 is not supported \nNov-21 13:28:21.649 [Thread-3] INFO  bisq.core.app.BisqExecutable: Start graceful shutDown \nNov-21 13:28:21.659 [Thread-3] INFO  b.c.a.AvoidStandbyModeService: Stopped \nNov-21 13:28:21.659 [Thread-3] INFO  b.core.offer.OpenOfferManager: Remove open offers at shutDown. Number of open offers: 0 \nNov-21 13:28:21.660 [Thread-3] INFO  bisq.core.app.BisqExecutable: OpenOfferManager shutdown completed \nNov-21 13:28:21.660 [Thread-3] INFO  bisq.core.app.BisqExecutable: WalletsSetup shutdown completed \nNov-21 13:28:21.664 [JavaFX Application Thread] INFO  b.n.p2p.network.NetworkNode: Shutdown immediately because no connections are open. \nNov-21 13:28:21.666 [Thread-3] INFO  b.n.p2p.network.TorNetworkNode: Tor has not been created yet. We cancel the torStartupFuture. \nNov-21 13:28:21.666 [Thread-3] ERROR b.n.p2p.network.TorNetworkNode: Shutdown torNetworkNode failed with exception: null \njava.lang.NullPointerException\n\tat bisq.network.p2p.network.TorNetworkNode.torNetworkNodeShutDown(TorNetworkNode.java:187)\n\tat bisq.network.p2p.network.TorNetworkNode.shutDown(TorNetworkNode.java:154)\n\tat bisq.network.p2p.P2PService.doShutDown(P2PService.java:276)\n\tat bisq.network.p2p.peers.Broadcaster.doShutDown(Broadcaster.java:81)\n\tat bisq.network.p2p.peers.Broadcaster.shutDown(Broadcaster.java:68)\n\tat bisq.network.p2p.P2PService.shutDown(P2PService.java:244)\n\tat bisq.core.app.BisqExecutable.lambda$gracefulShutDown$4(BisqExecutable.java:245)\n\tat com.sun.javafx.binding.ExpressionHelper$SingleChange.fireValueChangedEvent(ExpressionHelper.java:181)\n\tat com.sun.javafx.binding.ExpressionHelper.fireValueChangedEvent(ExpressionHelper.java:80)\n\tat javafx.beans.property.BooleanPropertyBase.fireValueChangedEvent(BooleanPropertyBase.java:104)\n\tat javafx.beans.property.BooleanPropertyBase.markInvalid(BooleanPropertyBase.java:111)\n\tat javafx.beans.property.BooleanPropertyBase.set(BooleanPropertyBase.java:145)\n\tat bisq.core.btc.setup.WalletsSetup.shutDown(WalletsSetup.java:344)\n\tat bisq.core.app.BisqExecutable.lambda$gracefulShutDown$5(BisqExecutable.java:260)\n\tat bisq.core.offer.OpenOfferManager.shutDown(OpenOfferManager.java:232)\n\tat bisq.core.app.BisqExecutable.gracefulShutDown(BisqExecutable.java:234)\n\tat bisq.desktop.app.BisqApp.lambda$stop$1(BisqApp.java:148)\n\tat java.base/java.lang.Thread.run(Thread.java:834)\nNov-21 13:28:26.668 [JavaFX Application Thread] ERROR b.n.p2p.network.TorNetworkNode: A timeout occurred at shutDown", "url": "https://github.com/bisq-network/bisq/pull/4829#discussion_r528212509", "createdAt": "2020-11-21T16:08:33Z", "author": {"login": "ghubstan"}, "path": "core/src/main/java/bisq/core/app/BisqSetup.java", "diffHunk": "@@ -487,6 +502,68 @@ private void checkForInvalidMakerFeeTxs() {\n         });\n     }\n \n+    @Nullable\n+    public static String getLastBisqVersion() {\n+        File versionFile = getVersionFile();\n+        if (!versionFile.exists()) {\n+            return null;\n+        }\n+        try (Scanner scanner = new Scanner(versionFile)) {\n+            // We only expect 1 line\n+            if (scanner.hasNextLine()) {\n+                return scanner.nextLine();\n+            }\n+        } catch (FileNotFoundException e) {\n+            e.printStackTrace();\n+        }\n+        return null;\n+    }\n+\n+    private static File getVersionFile() {\n+        return new File(Config.appDataDir(), VERSION_FILE_NAME);\n+    }\n+\n+    public static boolean hasDowngraded() {\n+        return hasDowngraded(getLastBisqVersion());\n+    }\n+\n+    public static boolean hasDowngraded(String lastVersion) {\n+        return lastVersion != null && Version.isNewVersion(lastVersion, Version.VERSION);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9360e89ae8d1a07a758ab84713c46cfa4451a17d"}, "originalPosition": 95}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2721, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}