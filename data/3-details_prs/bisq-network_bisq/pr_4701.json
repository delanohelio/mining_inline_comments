{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NjQ3Mzc5", "number": 4701, "title": "Add getRole(tradeId) to core api", "bodyText": "API users will need to see their role as maker/taker when looking at trade details.\n\nAdd getRole(trade) to TradeUtil\nAdd getTradeRole(tradeId) to CoreApi, CoreTradesService\nAdd role field to TradeInfo proto its wrapper class\n\nPR #4700 should be reviewed & merged before this PR.", "createdAt": "2020-10-25T19:27:03Z", "url": "https://github.com/bisq-network/bisq/pull/4701", "merged": true, "mergeCommit": {"oid": "3c56268149a42b752b963a47ed8ab6eededf8b73"}, "closed": true, "closedAt": "2020-10-30T12:43:15Z", "author": {"login": "ghubstan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVYkYJAH2gAyNTA5NjQ3Mzc5OmNiNjVkZTZkMmUxNDk3ZWI4ZWFmODY0MDRmYzMyODU3MjlhYmE4N2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXmId2AFqTUyMDYyODA3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb65de6d2e1497eb8eaf86404fc3285729aba87c", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/cb65de6d2e1497eb8eaf86404fc3285729aba87c", "committedDate": "2020-10-23T15:47:06Z", "message": "Block on tx-fee-request in core TakeOfferModel init\n\nAdded license comment too."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab20225cd2d50003a8f7f45feca6227a2370a9fb", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/ab20225cd2d50003a8f7f45feca6227a2370a9fb", "committedDate": "2020-10-24T19:25:20Z", "message": "Add compiler warning suppression, remove comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63cf4369904855013ac5b8e37de43462c02e1551", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/63cf4369904855013ac5b8e37de43462c02e1551", "committedDate": "2020-10-24T19:27:03Z", "message": "Add fields to grpc TradeInfo proto & wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "296e4f98cb6231ed2226e72d95c1317981a9d008", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/296e4f98cb6231ed2226e72d95c1317981a9d008", "committedDate": "2020-10-24T20:26:10Z", "message": "Replace static TradeUtil with singleton TradeUtil\n\nThe API is going to need some desktop trade utilities, which should be\nshared between :desktop and :core.api."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccd3c99f2e5b9cf276e6b70bceb34e73fb0a6858", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/ccd3c99f2e5b9cf276e6b70bceb34e73fb0a6858", "committedDate": "2020-10-24T20:45:01Z", "message": "Fix comment typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24ba9215cd12f65605b23c2f5d53037258afd019", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/24ba9215cd12f65605b23c2f5d53037258afd019", "committedDate": "2020-10-25T13:41:19Z", "message": "Refactor PendingTradesViewModel methods -> TradeUtil & OfferUtil"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36ad1379496d29bf26d6d3c90c4cc50b8c74b928", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/36ad1379496d29bf26d6d3c90c4cc50b8c74b928", "committedDate": "2020-10-25T13:54:40Z", "message": "Remove trailing spaces for codacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95bcb1ef9c74c6fa48f946ebc29b9af55bd1ed70", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/95bcb1ef9c74c6fa48f946ebc29b9af55bd1ed70", "committedDate": "2020-10-25T14:27:30Z", "message": "Refactor PendingTradesDataModel methods -> TradeUtil\n\nScope of this refactoring is small;  more can be done, but the short\nterm goal is to share trade util logic with core api.\n\n- Removed unused method getCurrencyCode()\n- Made minor style changes\n- Removed duplicated code block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd7a31c88907e7c29ce473e5a71603f976ace21", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/bbd7a31c88907e7c29ce473e5a71603f976ace21", "committedDate": "2020-10-25T14:38:03Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/161dbade0d04dcd7439e3ed94929a4c4ce3fdab0", "committedDate": "2020-10-25T19:22:20Z", "message": "Add getRole(tradeId) to core api\n\nAPI users will need to see their role as maker/taker when looking at trade details.\n\n- Add getRole(trade) to TradeUtil.\n- Add getTradeRole(tradeId) to CoreApi, CoreTradesService.\n- Add role field to TradeInfo proto and its wrapper class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjI4MDcx", "url": "https://github.com/bisq-network/bisq/pull/4701#pullrequestreview-520628071", "createdAt": "2020-10-30T12:38:54Z", "commit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozODo1NFrOHrNR7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0Mjo0M1rOHrNZSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2ODM5Ng==", "bodyText": "Could consider renaming to getMyRole but perhaps that's rather implicit.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515068396", "createdAt": "2020-10-30T12:38:54Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2OTM4MQ==", "bodyText": "I don't get why currenycode should be needed to decide role", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515069381", "createdAt": "2020-10-30T12:40:51Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {\n+        Contract contract = trade.getContract();\n+        if (contract == null)\n+            throw new IllegalStateException(format(\"could not get role because no contract was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        Offer offer = trade.getOffer();\n+        if (offer == null)\n+            throw new IllegalStateException(format(\"could not get role because no offer was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        return getRole(contract.isBuyerMakerAndSellerTaker(),\n+                offer.isMyOffer(keyRing),\n+                offer.getCurrencyCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDI4Mw==", "bodyText": "Would be easier to just add new fields at the end, but I guess there is some system to it.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515070283", "createdAt": "2020-10-30T12:42:43Z", "author": {"login": "sqrrm"}, "path": "proto/src/main/proto/grpc.proto", "diffHunk": "@@ -218,25 +218,26 @@ message TradeInfo {\n     string tradeId = 2;\n     string shortId = 3;\n     uint64 date = 4;\n-    bool isCurrencyForTakerFeeBtc = 5;\n-    uint64 txFeeAsLong = 6;\n-    uint64 takerFeeAsLong = 7;\n-    string takerFeeTxId = 8;\n-    string depositTxId = 9;\n-    string payoutTxId = 10;\n-    uint64 tradeAmountAsLong = 11;\n-    uint64 tradePrice = 12;\n-    string tradingPeerNodeAddress = 13;\n-    string state = 14;\n-    string phase = 15;\n-    string tradePeriodState = 16;\n-    bool isDepositPublished = 17;\n-    bool isDepositConfirmed = 18;\n-    bool isFiatSent = 19;\n-    bool isFiatReceived = 20;\n-    bool isPayoutPublished = 21;\n-    bool isWithdrawn = 22;\n-    string contractAsJson = 23;\n+    string role = 5;\n+    bool isCurrencyForTakerFeeBtc = 6;\n+    uint64 txFeeAsLong = 7;\n+    uint64 takerFeeAsLong = 8;\n+    string takerFeeTxId = 9;\n+    string depositTxId = 10;\n+    string payoutTxId = 11;\n+    uint64 tradeAmountAsLong = 12;\n+    uint64 tradePrice = 13;\n+    string tradingPeerNodeAddress = 14;\n+    string state = 15;\n+    string phase = 16;\n+    string tradePeriodState = 17;\n+    bool isDepositPublished = 18;\n+    bool isDepositConfirmed = 19;\n+    bool isFiatSent = 20;\n+    bool isFiatReceived = 21;\n+    bool isPayoutPublished = 22;\n+    bool isWithdrawn = 23;\n+    string contractAsJson = 24;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3484, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}