{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0ODM3MjE3", "number": 4744, "title": "Cleanup signed witness", "bodyText": "Implements bisq-network/proposals#264\nPayment methods using only accountagewitness can trade the full amount immediately, both when buying and when selling.\nPayments methods with signing can trade the full amount immediately when selling, but has limits for buying according to the schedule described:\n\n0.01 BTC for unsigned and up to 30 days after signing\n0.125 BTC 30 days after signing\n0.25 BTC 60 days after signing", "createdAt": "2020-11-03T16:05:38Z", "url": "https://github.com/bisq-network/bisq/pull/4744", "merged": true, "mergeCommit": {"oid": "b8fbc74d6c3519a06d54e336d928906d5a51f103"}, "closed": true, "closedAt": "2020-11-05T08:42:46Z", "author": {"login": "sqrrm"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWDe-XgH2gAyNTE0ODM3MjE3OjU2YzhjZDE1MDcwY2MwMWIxMTZiM2Q4ZDY4ZThkMGJmZTZlMDVhZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZeSKeAFqTUyNDAzMTI4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56c8cd15070cc01b116b3d8d68e8d0bfe6e05ae3", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/56c8cd15070cc01b116b3d8d68e8d0bfe6e05ae3", "committedDate": "2020-10-25T17:47:07Z", "message": "Remove unused old activation date"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b64c816047a6a30284b9d27cf91f620bc34b4910", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/b64c816047a6a30284b9d27cf91f620bc34b4910", "committedDate": "2020-10-25T17:47:07Z", "message": "Refactor getTradeLimit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17745e3bee32585dc56997608592a2fc7c6543ca", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/17745e3bee32585dc56997608592a2fc7c6543ca", "committedDate": "2020-10-25T17:55:04Z", "message": "Clean up riskFactor methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f0b75c2ac7ae5d8a44db6f4f7f6a21b4eb101c4", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/0f0b75c2ac7ae5d8a44db6f4f7f6a21b4eb101c4", "committedDate": "2020-11-03T15:58:14Z", "message": "Change time dependent trade limits\n\nThis is in accordance with https://github.com/bisq-network/proposals/issues/264\n\nAny account type that doesn't need signing can now trade the full\namount immediately, same goes for signed type accounts that are\nselling.\n\nSigned type accounts that are buying now has minimum limit (0.01 BTC) up until\n30 days after getting signed, then the limit is increased to 0.5 times the max\nlimit (0.125 BTC) and after 60 days they get the full limits (0.25 BTC)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f734292f39c08d5972d27ba517ca3094440f81e", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/7f734292f39c08d5972d27ba517ca3094440f81e", "committedDate": "2020-11-03T15:59:15Z", "message": "Cleanup line breaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02e53304edd24453e58cc3a41882ce9b1c78c907", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/02e53304edd24453e58cc3a41882ce9b1c78c907", "committedDate": "2020-11-03T16:35:29Z", "message": "Cleanup unused argument"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDIyNDQx", "url": "https://github.com/bisq-network/bisq/pull/4744#pullrequestreview-524022441", "createdAt": "2020-11-05T08:30:44Z", "commit": {"oid": "b64c816047a6a30284b9d27cf91f620bc34b4910"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODozMDo0NFrOHt4T4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODozMDo0NFrOHt4T4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg3MDU2Mw==", "bodyText": "Nit: Just a little typo in the old code buying vs bying", "url": "https://github.com/bisq-network/bisq/pull/4744#discussion_r517870563", "createdAt": "2020-11-05T08:30:44Z", "author": {"login": "ripcurlx"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -365,58 +365,70 @@ private long getTradeLimit(Coin maxTradeLimit,\n                                AccountAge accountAgeCategory,\n                                OfferPayload.Direction direction,\n                                PaymentMethod paymentMethod) {\n-        if (CurrencyUtil.isFiatCurrency(currencyCode)) {\n-            double factor;\n-            boolean isRisky = PaymentMethod.hasChargebackRisk(paymentMethod, currencyCode);\n-            if (!isRisky || direction == OfferPayload.Direction.SELL) {\n-                // Get age of witness rather than time since signing for non risky payment methods and for selling\n-                accountAgeCategory = getAccountAgeCategory(getAccountAge(accountAgeWitness, new Date()));\n-            }\n-            long limit = OfferRestrictions.TOLERATED_SMALL_TRADE_AMOUNT.value;\n-            if (direction == OfferPayload.Direction.BUY && isRisky) {\n-                // Used only for bying of BTC with risky payment methods\n-                switch (accountAgeCategory) {\n-                    case TWO_MONTHS_OR_MORE:\n-                        factor = 1;\n-                        break;\n-                    case ONE_TO_TWO_MONTHS:\n-                        factor = 0.5;\n-                        break;\n-                    case LESS_ONE_MONTH:\n-                    case UNVERIFIED:\n-                    default:\n-                        factor = 0;\n-                }\n-            } else {\n-                // Used by non risky payment methods and for selling BTC with risky methods\n-                switch (accountAgeCategory) {\n-                    case TWO_MONTHS_OR_MORE:\n-                        factor = 1;\n-                        break;\n-                    case ONE_TO_TWO_MONTHS:\n-                        factor = 0.5;\n-                        break;\n-                    case LESS_ONE_MONTH:\n-                    case UNVERIFIED:\n-                        factor = 0.25;\n-                        break;\n-                    default:\n-                        factor = 0;\n-                }\n-            }\n-            if (factor > 0) {\n-                limit = MathUtils.roundDoubleToLong((double) maxTradeLimit.value * factor);\n-            }\n+        if (!CurrencyUtil.isFiatCurrency(currencyCode)) {\n+            return maxTradeLimit.value;\n+        }\n \n-            log.debug(\"accountAgeCategory={}, limit={}, factor={}, accountAgeWitnessHash={}\",\n-                    accountAgeCategory,\n-                    Coin.valueOf(limit).toFriendlyString(),\n-                    factor,\n-                    Utilities.bytesAsHexString(accountAgeWitness.getHash()));\n-            return limit;\n+        double factor;\n+        boolean isRisky = PaymentMethod.hasChargebackRisk(paymentMethod, currencyCode);\n+        if (!isRisky || direction == OfferPayload.Direction.SELL) {\n+            // Get age of witness rather than time since signing for non risky payment methods and for selling\n+            accountAgeCategory = getAccountAgeCategory(getAccountAge(accountAgeWitness, new Date()));\n+        }\n+        long limit = OfferRestrictions.TOLERATED_SMALL_TRADE_AMOUNT.value;\n+        if (direction == OfferPayload.Direction.BUY && isRisky) {\n+            // Used only for bying of BTC with risky payment methods", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b64c816047a6a30284b9d27cf91f620bc34b4910"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDMxMjg2", "url": "https://github.com/bisq-network/bisq/pull/4744#pullrequestreview-524031286", "createdAt": "2020-11-05T08:42:20Z", "commit": {"oid": "02e53304edd24453e58cc3a41882ce9b1c78c907"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3514, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}