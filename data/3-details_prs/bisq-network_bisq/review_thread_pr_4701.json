{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NjQ3Mzc5", "number": 4701, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozODo1NFrOEzxohg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0Mjo0M1rOEzxtKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzI2MDIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozODo1NFrOHrNR7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjozODo1NFrOHrNR7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2ODM5Ng==", "bodyText": "Could consider renaming to getMyRole but perhaps that's rather implicit.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515068396", "createdAt": "2020-10-30T12:38:54Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzI2NjQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0MDo1MVrOHrNVxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozMjozMFrOHrW3Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2OTM4MQ==", "bodyText": "I don't get why currenycode should be needed to decide role", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515069381", "createdAt": "2020-10-30T12:40:51Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {\n+        Contract contract = trade.getContract();\n+        if (contract == null)\n+            throw new IllegalStateException(format(\"could not get role because no contract was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        Offer offer = trade.getOffer();\n+        if (offer == null)\n+            throw new IllegalStateException(format(\"could not get role because no offer was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        return getRole(contract.isBuyerMakerAndSellerTaker(),\n+                offer.isMyOffer(keyRing),\n+                offer.getCurrencyCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0ODM5Mw==", "bodyText": "Below is an example of the console output for a CLI's gettrade id command, where the role = BTC buyer as taker, showing what is being bought or sold.\nID      My Role             Price in USD for 1 BTC  Amount(BTC)  Tx Fee(BTC)  Taker Fee(BTC)  Deposit Published  Deposit Confirmed  Fiat Sent  Fiat Received  Payout Published  Withdrawn  \nAGnSOw  BTC buyer as taker             13,263.6578   0.12500000   0.00068800      0.00037500  YES                NO                 NO         NO             NO                NO", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515148393", "createdAt": "2020-10-30T14:43:52Z", "author": {"login": "ghubstan"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {\n+        Contract contract = trade.getContract();\n+        if (contract == null)\n+            throw new IllegalStateException(format(\"could not get role because no contract was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        Offer offer = trade.getOffer();\n+        if (offer == null)\n+            throw new IllegalStateException(format(\"could not get role because no offer was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        return getRole(contract.isBuyerMakerAndSellerTaker(),\n+                offer.isMyOffer(keyRing),\n+                offer.getCurrencyCode());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2OTM4MQ=="}, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNTM2Ng==", "bodyText": "Ok, I get it, thanks.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515225366", "createdAt": "2020-10-30T16:32:30Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/trade/TradeUtil.java", "diffHunk": "@@ -173,6 +174,27 @@ public String getPaymentMethodNameWithCountryCode(Trade trade) {\n         return paymentMethodDescription;\n     }\n \n+    /**\n+     * Returns a string describing a trader's role for a given trade.\n+     * @param trade Trade\n+     * @return String describing a trader's role for a given trade\n+     */\n+    public String getRole(Trade trade) {\n+        Contract contract = trade.getContract();\n+        if (contract == null)\n+            throw new IllegalStateException(format(\"could not get role because no contract was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        Offer offer = trade.getOffer();\n+        if (offer == null)\n+            throw new IllegalStateException(format(\"could not get role because no offer was found for trade '%s'\",\n+                    trade.getShortId()));\n+\n+        return getRole(contract.isBuyerMakerAndSellerTaker(),\n+                offer.isMyOffer(keyRing),\n+                offer.getCurrencyCode());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA2OTM4MQ=="}, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzI3MjA5OnYy", "diffSide": "RIGHT", "path": "proto/src/main/proto/grpc.proto", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0Mjo0M1rOHrNZSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjozODo0NlrOHrXFUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDI4Mw==", "bodyText": "Would be easier to just add new fields at the end, but I guess there is some system to it.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515070283", "createdAt": "2020-10-30T12:42:43Z", "author": {"login": "sqrrm"}, "path": "proto/src/main/proto/grpc.proto", "diffHunk": "@@ -218,25 +218,26 @@ message TradeInfo {\n     string tradeId = 2;\n     string shortId = 3;\n     uint64 date = 4;\n-    bool isCurrencyForTakerFeeBtc = 5;\n-    uint64 txFeeAsLong = 6;\n-    uint64 takerFeeAsLong = 7;\n-    string takerFeeTxId = 8;\n-    string depositTxId = 9;\n-    string payoutTxId = 10;\n-    uint64 tradeAmountAsLong = 11;\n-    uint64 tradePrice = 12;\n-    string tradingPeerNodeAddress = 13;\n-    string state = 14;\n-    string phase = 15;\n-    string tradePeriodState = 16;\n-    bool isDepositPublished = 17;\n-    bool isDepositConfirmed = 18;\n-    bool isFiatSent = 19;\n-    bool isFiatReceived = 20;\n-    bool isPayoutPublished = 21;\n-    bool isWithdrawn = 22;\n-    string contractAsJson = 23;\n+    string role = 5;\n+    bool isCurrencyForTakerFeeBtc = 6;\n+    uint64 txFeeAsLong = 7;\n+    uint64 takerFeeAsLong = 8;\n+    string takerFeeTxId = 9;\n+    string depositTxId = 10;\n+    string payoutTxId = 11;\n+    uint64 tradeAmountAsLong = 12;\n+    uint64 tradePrice = 13;\n+    string tradingPeerNodeAddress = 14;\n+    string state = 15;\n+    string phase = 16;\n+    string tradePeriodState = 17;\n+    bool isDepositPublished = 18;\n+    bool isDepositConfirmed = 19;\n+    bool isFiatSent = 20;\n+    bool isFiatReceived = 21;\n+    bool isPayoutPublished = 22;\n+    bool isWithdrawn = 23;\n+    string contractAsJson = 24;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1MjkyNA==", "bodyText": "There is a system, but don't know what it's called yet.  I'm just trying to keep field 'types' grouped together as I add more -- protocol flags together, tx-ids together, price & amt together, json-contract always the last field,  ...\nI thought about backward compatibility problems being caused by doing this, but I think it's safe to assume the CLI and server will always be in sync until a single server can support multiple clients on remote hosts.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515152924", "createdAt": "2020-10-30T14:50:25Z", "author": {"login": "ghubstan"}, "path": "proto/src/main/proto/grpc.proto", "diffHunk": "@@ -218,25 +218,26 @@ message TradeInfo {\n     string tradeId = 2;\n     string shortId = 3;\n     uint64 date = 4;\n-    bool isCurrencyForTakerFeeBtc = 5;\n-    uint64 txFeeAsLong = 6;\n-    uint64 takerFeeAsLong = 7;\n-    string takerFeeTxId = 8;\n-    string depositTxId = 9;\n-    string payoutTxId = 10;\n-    uint64 tradeAmountAsLong = 11;\n-    uint64 tradePrice = 12;\n-    string tradingPeerNodeAddress = 13;\n-    string state = 14;\n-    string phase = 15;\n-    string tradePeriodState = 16;\n-    bool isDepositPublished = 17;\n-    bool isDepositConfirmed = 18;\n-    bool isFiatSent = 19;\n-    bool isFiatReceived = 20;\n-    bool isPayoutPublished = 21;\n-    bool isWithdrawn = 22;\n-    string contractAsJson = 23;\n+    string role = 5;\n+    bool isCurrencyForTakerFeeBtc = 6;\n+    uint64 txFeeAsLong = 7;\n+    uint64 takerFeeAsLong = 8;\n+    string takerFeeTxId = 9;\n+    string depositTxId = 10;\n+    string payoutTxId = 11;\n+    uint64 tradeAmountAsLong = 12;\n+    uint64 tradePrice = 13;\n+    string tradingPeerNodeAddress = 14;\n+    string state = 15;\n+    string phase = 16;\n+    string tradePeriodState = 17;\n+    bool isDepositPublished = 18;\n+    bool isDepositConfirmed = 19;\n+    bool isFiatSent = 20;\n+    bool isFiatReceived = 21;\n+    bool isPayoutPublished = 22;\n+    bool isWithdrawn = 23;\n+    string contractAsJson = 24;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDI4Mw=="}, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyNzE0Nw==", "bodyText": "I think you should not assume that CLI and server is in sync. Basically, once we announce the API publicly the protocol is fixed and should only be added to and old fields deprecated but not changed.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515227147", "createdAt": "2020-10-30T16:35:24Z", "author": {"login": "sqrrm"}, "path": "proto/src/main/proto/grpc.proto", "diffHunk": "@@ -218,25 +218,26 @@ message TradeInfo {\n     string tradeId = 2;\n     string shortId = 3;\n     uint64 date = 4;\n-    bool isCurrencyForTakerFeeBtc = 5;\n-    uint64 txFeeAsLong = 6;\n-    uint64 takerFeeAsLong = 7;\n-    string takerFeeTxId = 8;\n-    string depositTxId = 9;\n-    string payoutTxId = 10;\n-    uint64 tradeAmountAsLong = 11;\n-    uint64 tradePrice = 12;\n-    string tradingPeerNodeAddress = 13;\n-    string state = 14;\n-    string phase = 15;\n-    string tradePeriodState = 16;\n-    bool isDepositPublished = 17;\n-    bool isDepositConfirmed = 18;\n-    bool isFiatSent = 19;\n-    bool isFiatReceived = 20;\n-    bool isPayoutPublished = 21;\n-    bool isWithdrawn = 22;\n-    string contractAsJson = 23;\n+    string role = 5;\n+    bool isCurrencyForTakerFeeBtc = 6;\n+    uint64 txFeeAsLong = 7;\n+    uint64 takerFeeAsLong = 8;\n+    string takerFeeTxId = 9;\n+    string depositTxId = 10;\n+    string payoutTxId = 11;\n+    uint64 tradeAmountAsLong = 12;\n+    uint64 tradePrice = 13;\n+    string tradingPeerNodeAddress = 14;\n+    string state = 15;\n+    string phase = 16;\n+    string tradePeriodState = 17;\n+    bool isDepositPublished = 18;\n+    bool isDepositConfirmed = 19;\n+    bool isFiatSent = 20;\n+    bool isFiatReceived = 21;\n+    bool isPayoutPublished = 22;\n+    bool isWithdrawn = 23;\n+    string contractAsJson = 24;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDI4Mw=="}, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIyOTAxMA==", "bodyText": "OK, I will stop re-ordering fields like this before the public announcement.", "url": "https://github.com/bisq-network/bisq/pull/4701#discussion_r515229010", "createdAt": "2020-10-30T16:38:46Z", "author": {"login": "ghubstan"}, "path": "proto/src/main/proto/grpc.proto", "diffHunk": "@@ -218,25 +218,26 @@ message TradeInfo {\n     string tradeId = 2;\n     string shortId = 3;\n     uint64 date = 4;\n-    bool isCurrencyForTakerFeeBtc = 5;\n-    uint64 txFeeAsLong = 6;\n-    uint64 takerFeeAsLong = 7;\n-    string takerFeeTxId = 8;\n-    string depositTxId = 9;\n-    string payoutTxId = 10;\n-    uint64 tradeAmountAsLong = 11;\n-    uint64 tradePrice = 12;\n-    string tradingPeerNodeAddress = 13;\n-    string state = 14;\n-    string phase = 15;\n-    string tradePeriodState = 16;\n-    bool isDepositPublished = 17;\n-    bool isDepositConfirmed = 18;\n-    bool isFiatSent = 19;\n-    bool isFiatReceived = 20;\n-    bool isPayoutPublished = 21;\n-    bool isWithdrawn = 22;\n-    string contractAsJson = 23;\n+    string role = 5;\n+    bool isCurrencyForTakerFeeBtc = 6;\n+    uint64 txFeeAsLong = 7;\n+    uint64 takerFeeAsLong = 8;\n+    string takerFeeTxId = 9;\n+    string depositTxId = 10;\n+    string payoutTxId = 11;\n+    uint64 tradeAmountAsLong = 12;\n+    uint64 tradePrice = 13;\n+    string tradingPeerNodeAddress = 14;\n+    string state = 15;\n+    string phase = 16;\n+    string tradePeriodState = 17;\n+    bool isDepositPublished = 18;\n+    bool isDepositConfirmed = 19;\n+    bool isFiatSent = 20;\n+    bool isFiatReceived = 21;\n+    bool isPayoutPublished = 22;\n+    bool isWithdrawn = 23;\n+    string contractAsJson = 24;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MDI4Mw=="}, "originalCommit": {"oid": "161dbade0d04dcd7439e3ed94929a4c4ce3fdab0"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2670, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}