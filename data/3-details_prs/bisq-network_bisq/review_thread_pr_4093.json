{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMDM4MDcz", "number": 4093, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo0NTo1MFrODroNLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzoxNTowMFrODro59g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDc0MDkzOnYy", "diffSide": "RIGHT", "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo0NTo1MFrOF8FJYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQyMzozMDoyM1rOF9WIwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0MzIwMg==", "bodyText": "Better use a constant for values like the dust limit.", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r398543202", "createdAt": "2020-03-26T12:45:50Z", "author": {"login": "sqrrm"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -629,6 +631,17 @@ public void updateItem(final WithdrawalListItem item, boolean empty) {\n                     }\n                 });\n     }\n+\n+    private Coin getDust(Transaction tx) {\n+        Coin dust = Coin.ZERO;\n+        for (TransactionOutput txo: tx.getOutputs()) {\n+            if (txo.getValue().value < 546) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg3MDE0Ng==", "bodyText": "Changed to use Restrictions.getMinNonDustOutput() which equates to 546 sats", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r399870146", "createdAt": "2020-03-29T23:30:23Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -629,6 +631,17 @@ public void updateItem(final WithdrawalListItem item, boolean empty) {\n                     }\n                 });\n     }\n+\n+    private Coin getDust(Transaction tx) {\n+        Coin dust = Coin.ZERO;\n+        for (TransactionOutput txo: tx.getOutputs()) {\n+            if (txo.getValue().value < 546) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0MzIwMg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDg1MDI2OnYy", "diffSide": "RIGHT", "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzoxMzozN1rOF8GNjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMjoxOTo0MFrOF-C5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg==", "bodyText": "The added complexity of the dust on top of the fee makes this code really hard to read. It's not transparent to neither the developer nor the user what will happen here. The dust amount is so low that it's unlikely to cause monetary damage, but users expect a certain amount to be sent and when the dust is added it might cause confusion. (If I got it right,the dust is added as fee or sent amount depending on whether feeExcluded is set or not)\nI suggest making this code easier to follow, and adding a notice to the user that dust might be padded to the fee and make sure it's only padding the fee.", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r398560652", "createdAt": "2020-03-26T13:13:37Z", "author": {"login": "sqrrm"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxMzI0Mw==", "bodyText": "\ud83d\udc4d @sqrrm your suggestions sound great, I am working on implementing them!", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r399013243", "createdAt": "2020-03-27T03:18:05Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTczNTM3Nw==", "bodyText": "adding a notice to the user that dust might be padded to the fee\n\nI propose the following message in cases where dust is detected (shown in the following screenshot at the top of the popup):", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r399735377", "createdAt": "2020-03-29T02:33:44Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4MTk2Mw==", "bodyText": "@m52go could you have a look at the user facing language. We're trying to avoid confusion and I feel I might be too deep here to have a good judgement of what a normal user will find helpful and what's just adding to extra confusion.", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r400081963", "createdAt": "2020-03-30T10:20:58Z", "author": {"login": "sqrrm"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE5MTE4Nw==", "bodyText": "Seems straightforward to me overall.\n2 small things.\n\n\nsatoshi should be plural. It's already pluralized below in the 'required transaction fee' line\n\n\nmight be nice to change the 2 \"transaction fee\" mentions to \"mining fee\" to be more specific and match the text on the 'send funds' screen", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r400191187", "createdAt": "2020-03-30T13:29:29Z", "author": {"login": "m52go"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYwMzQ0MQ==", "bodyText": "@m52go @sqrrm your changes have been implemented.", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r400603441", "createdAt": "2020-03-31T02:19:40Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -330,8 +331,9 @@ private void onWithdraw() {\n                     feeEstimationTransaction = walletService.getFeeEstimationTransactionForMultipleAddresses(fromAddresses, sendersAmount);\n                 }\n                 checkNotNull(feeEstimationTransaction, \"feeEstimationTransaction must not be null\");\n-                Coin fee = feeEstimationTransaction.getFee();\n-                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin;\n+                Coin dust = getDust(feeEstimationTransaction);\n+                Coin fee = feeEstimationTransaction.getFee().add(dust);\n+                sendersAmount = feeExcluded ? amountAsCoin.add(fee) : amountAsCoin.add(dust);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MDY1Mg=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDg1NTU4OnYy", "diffSide": "RIGHT", "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzoxNTowMVrOF8GQ8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQwMjozNjowN1rOF9N68Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MTUyMw==", "bodyText": "As an avid log reader, a bit more context will really help understand what's going on here.", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r398561523", "createdAt": "2020-03-26T13:15:01Z", "author": {"login": "sqrrm"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -629,6 +631,17 @@ public void updateItem(final WithdrawalListItem item, boolean empty) {\n                     }\n                 });\n     }\n+\n+    private Coin getDust(Transaction tx) {\n+        Coin dust = Coin.ZERO;\n+        for (TransactionOutput txo: tx.getOutputs()) {\n+            if (txo.getValue().value < 546) {\n+                dust = dust.add(txo.getValue());\n+                log.info(\"dust TXO = {}\", txo.getValue().toFriendlyString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTczNTUzNw==", "bodyText": "Done:\nMar-28 21:25:47.953 [JavaFX Application Thread] INFO  b.d.m.f.w.WithdrawalView: dust TXO = TxOut of 0.000001 BTC to msskpXKKdJdQL82zB76VRU5o5qcoXu1aYf script:DUP HASH160 PUSHDATA(20)[8790aa8150dd74fe091af8253760a23772d2e62a] EQUALVERIFY CHECKSIG \nMar-28 21:25:47.953 [JavaFX Application Thread] INFO  b.d.m.f.w.WithdrawalView: Dust output (100 satoshi) was detected, the dust amount has been added to the fee (was 4068, now 4168)", "url": "https://github.com/bisq-network/bisq/pull/4093#discussion_r399735537", "createdAt": "2020-03-29T02:36:07Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/funds/withdrawal/WithdrawalView.java", "diffHunk": "@@ -629,6 +631,17 @@ public void updateItem(final WithdrawalListItem item, boolean empty) {\n                     }\n                 });\n     }\n+\n+    private Coin getDust(Transaction tx) {\n+        Coin dust = Coin.ZERO;\n+        for (TransactionOutput txo: tx.getOutputs()) {\n+            if (txo.getValue().value < 546) {\n+                dust = dust.add(txo.getValue());\n+                log.info(\"dust TXO = {}\", txo.getValue().toFriendlyString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2MTUyMw=="}, "originalCommit": {"oid": "057e2c5e7cbb7c13cfe3b36df2583338cbf2982c"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2570, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}