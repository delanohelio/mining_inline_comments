{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NzExMjM0", "number": 4259, "title": "Secondary sort order for offer book (rewrite)", "bodyText": "Supersedes #4168. This is a rewrite of that PR.\nAdds a secondary sort order to offers in market offer book by offer amount that goes from high to low. Also, replaces previous complicated implementation of primary sort.\nCo-authored-by: @freimair\nCo-authored-by: @cd2357", "createdAt": "2020-05-15T17:22:51Z", "url": "https://github.com/bisq-network/bisq/pull/4259", "merged": true, "mergeCommit": {"oid": "666571347b95786a5b99130802c67e71bba72ccc"}, "closed": true, "closedAt": "2020-05-25T14:04:47Z", "author": {"login": "dmos62"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchlVQIgH2gAyNDE4NzExMjM0OjJiNzk3ZGFmZWRmY2Y3YjEzMzQzMWE2ZWUwNmI5ZjhhZTAzZDI5OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABckwmTPAFqTQxNzczMDQzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992", "author": {"user": {"login": "dmos62", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/2b797dafedfcf7b133431a6ee06b9f8ae03d2992", "committedDate": "2020-05-15T17:15:17Z", "message": "Secondary sort order for offer book\n\nA rewrite of @freimair's PR\nhttps://github.com/bisq-network/bisq/pull/4168.\n\nAdds a secondary sort order of offers in market offer book by offer\namount that goes from high to low. Also, refactors-away overcomplicated\nprevious implementation of primary sort.\n\nCo-authored-by: Florian Reimair <office@florianreimair.at>\nCo-authored-by: cd2357 <15956136+cd2357@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTE2NDkw", "url": "https://github.com/bisq-network/bisq/pull/4259#pullrequestreview-413116490", "createdAt": "2020-05-16T23:58:44Z", "commit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDA5MTcy", "url": "https://github.com/bisq-network/bisq/pull/4259#pullrequestreview-417409172", "createdAt": "2020-05-25T00:42:54Z", "commit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwMDo0Mjo1NVrOGZyYTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwMDo0NDoxNFrOGZyY0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY5MzAwNg==", "bodyText": "boolean isCrypto = CurrencyUtil.isCryptoCurrency(getCurrencyCode());", "url": "https://github.com/bisq-network/bisq/pull/4259#discussion_r429693006", "createdAt": "2020-05-25T00:42:55Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/market/offerbook/OfferBookChartViewModel.java", "diffHunk": "@@ -276,22 +276,24 @@ private boolean isAnyPricePresent() {\n     }\n \n     private void updateChartData() {\n+\n+        // Offer price can be null (if price feed unavailable), thus a null-tolerant comparator is used.\n+        Comparator<Offer> offerPriceComparator = Comparator.comparing(Offer::getPrice, Comparator.nullsLast(Comparator.naturalOrder()));\n+        // Offer amounts are used for the secondary sort. They are sorted from high to low.\n+        Comparator<Offer> offerAmountComparator = Comparator.comparing(Offer::getAmount).reversed();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY5MzA3Mg==", "bodyText": "(isCrypto ? offerPriceComparator : offerPriceComparator.reversed()) // Buy offers, as opposed to sell offers, are primarily sorted from high price to low.", "url": "https://github.com/bisq-network/bisq/pull/4259#discussion_r429693072", "createdAt": "2020-05-25T00:43:31Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/market/offerbook/OfferBookChartViewModel.java", "diffHunk": "@@ -276,22 +276,24 @@ private boolean isAnyPricePresent() {\n     }\n \n     private void updateChartData() {\n+\n+        // Offer price can be null (if price feed unavailable), thus a null-tolerant comparator is used.\n+        Comparator<Offer> offerPriceComparator = Comparator.comparing(Offer::getPrice, Comparator.nullsLast(Comparator.naturalOrder()));\n+        // Offer amounts are used for the secondary sort. They are sorted from high to low.\n+        Comparator<Offer> offerAmountComparator = Comparator.comparing(Offer::getAmount).reversed();\n+\n+        var buyOfferSortComparator =\n+            offerPriceComparator.reversed() // Buy offers, as opposed to sell offers, are primarily sorted from high price to low.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY5MzEzOA==", "bodyText": "(isCrypto ? offerPriceComparator.reversed() : offerPriceComparator)", "url": "https://github.com/bisq-network/bisq/pull/4259#discussion_r429693138", "createdAt": "2020-05-25T00:44:14Z", "author": {"login": "jmacxx"}, "path": "desktop/src/main/java/bisq/desktop/main/market/offerbook/OfferBookChartViewModel.java", "diffHunk": "@@ -276,22 +276,24 @@ private boolean isAnyPricePresent() {\n     }\n \n     private void updateChartData() {\n+\n+        // Offer price can be null (if price feed unavailable), thus a null-tolerant comparator is used.\n+        Comparator<Offer> offerPriceComparator = Comparator.comparing(Offer::getPrice, Comparator.nullsLast(Comparator.naturalOrder()));\n+        // Offer amounts are used for the secondary sort. They are sorted from high to low.\n+        Comparator<Offer> offerAmountComparator = Comparator.comparing(Offer::getAmount).reversed();\n+\n+        var buyOfferSortComparator =\n+            offerPriceComparator.reversed() // Buy offers, as opposed to sell offers, are primarily sorted from high price to low.\n+            .thenComparing(offerAmountComparator);\n+        var sellOfferSortComparator =\n+            offerPriceComparator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b797dafedfcf7b133431a6ee06b9f8ae03d2992"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc13b6effcd4dd08be113828da28a6d07d6a830", "author": {"user": {"login": "dmos62", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/3dc13b6effcd4dd08be113828da28a6d07d6a830", "committedDate": "2020-05-25T09:37:30Z", "message": "Fix reversed ordering in altcoin market"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Njk3Mjg2", "url": "https://github.com/bisq-network/bisq/pull/4259#pullrequestreview-417697286", "createdAt": "2020-05-25T13:04:36Z", "commit": {"oid": "3dc13b6effcd4dd08be113828da28a6d07d6a830"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzMwNDMw", "url": "https://github.com/bisq-network/bisq/pull/4259#pullrequestreview-417730430", "createdAt": "2020-05-25T14:00:52Z", "commit": {"oid": "3dc13b6effcd4dd08be113828da28a6d07d6a830"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDowMDo1M1rOGaCGuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDowMDo1M1rOGaCGuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1MDY0OQ==", "bodyText": "Prefer no blank lines at the beginning of methods.", "url": "https://github.com/bisq-network/bisq/pull/4259#discussion_r429950649", "createdAt": "2020-05-25T14:00:53Z", "author": {"login": "sqrrm"}, "path": "desktop/src/main/java/bisq/desktop/main/market/offerbook/OfferBookChartViewModel.java", "diffHunk": "@@ -276,22 +276,32 @@ private boolean isAnyPricePresent() {\n     }\n \n     private void updateChartData() {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc13b6effcd4dd08be113828da28a6d07d6a830"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3310, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}