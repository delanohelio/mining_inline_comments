{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMzI5MDI0", "number": 4957, "title": "Sign single account", "bodyText": "This a proposed solution to bisq-network/growth#212\nThe user to get signed copies the account data and sends it over whichever channel, keybase for example. With this change the arbitrator can sign this account.\nStep 1, user copies account data (ctrl+c to copy AccountAgeWitness and PubKey to clipboard)\n\nStep 2, arbitrator imports data (under accounts view, open signing tab with ctrl+i, in signing tab, open specific account signing window with ctrl+p)\n\nStep 3, arbitrator signs with their private key (this could be helpful for devs that want to test signed accounts as well)\n\nStep 4, done\n\nI know this is very pretty, but please don't ask me to implement all the UI stuff due to this flash feature.", "createdAt": "2020-12-15T15:20:54Z", "url": "https://github.com/bisq-network/bisq/pull/4957", "merged": true, "mergeCommit": {"oid": "0789180bb091bdeda841c536923e55bcdeaaafdf"}, "closed": true, "closedAt": "2020-12-16T13:07:35Z", "author": {"login": "sqrrm"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmatezAH2gAyNTQwMzI5MDI0OmRlMjUxMDVmYTgxZjdhY2MxNDY4Y2VjYjFhMzVmNzYzZTk5ODkyMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmupb7gFqTU1MzY2NzA1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/de25105fa81f7acc1468cecb1a35f763e9989224", "committedDate": "2020-12-15T13:53:34Z", "message": "Copy account data to clipboard\n\nUse ctrl+c to copy accountagewitness and pubkey to clipboard in a format to\nbe used by arbitrator to sign the account"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c33f9c9992b308276055de420741bd45a5a4118", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/4c33f9c9992b308276055de420741bd45a5a4118", "committedDate": "2020-12-15T15:08:06Z", "message": "Sign imported AccountAgeWitness,PubKey\n\nChange the specific sign window to sign an imported account in the form\nof accountAgeWitnessString,pubKeyString. The SignSpecificWitness never\nworked due to missing pubKey data and this is a way to import the missing data."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzI4NTk2", "url": "https://github.com/bisq-network/bisq/pull/4957#pullrequestreview-552728596", "createdAt": "2020-12-15T18:04:26Z", "commit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "state": "DISMISSED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxODowNDoyNlrOIGYwoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxODoxNTo1N1rOIGZPPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw==", "bodyText": "Is that a debug util or is the \",\" concatenation used in normal cases?", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543568033", "createdAt": "2020-12-15T18:04:26Z", "author": {"login": "chimp1984"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -880,4 +880,10 @@ public boolean isSignWitnessTrade(Trade trade) {\n                 !peerHasSignedWitness(trade) &&\n                 tradeAmountIsSufficient(trade.getTradeAmount());\n     }\n+\n+    public String signInfoFromAccount(PaymentAccount paymentAccount) {\n+        var pubKey = keyRing.getSignatureKeyPair().getPublic();\n+        var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n+        return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODI5Ng==", "bodyText": "If debug tool better to rename method to make it more clear and add a comment...", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543568296", "createdAt": "2020-12-15T18:04:49Z", "author": {"login": "chimp1984"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -880,4 +880,10 @@ public boolean isSignWitnessTrade(Trade trade) {\n                 !peerHasSignedWitness(trade) &&\n                 tradeAmountIsSufficient(trade.getTradeAmount());\n     }\n+\n+    public String signInfoFromAccount(PaymentAccount paymentAccount) {\n+        var pubKey = keyRing.getSignatureKeyPair().getPublic();\n+        var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n+        return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw=="}, "originalCommit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ==", "bodyText": "Cmd+c is a very common key command, not sure if its better to use a more exotic one so that user do not trigger that accidentally. Prob. no harm by doing that, but confusing...", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543569089", "createdAt": "2020-12-15T18:06:02Z", "author": {"login": "chimp1984"}, "path": "desktop/src/main/java/bisq/desktop/main/account/content/PaymentAccountsView.java", "diffHunk": "@@ -62,6 +62,8 @@ public void initialize() {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logSigners();\n             } else if (Utilities.isCtrlShiftPressed(KeyCode.U, event)) {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logUnsignedSignerPubKeys();\n+            } else if (Utilities.isAltOrCtrlPressed(KeyCode.C, event)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTQ5MQ==", "bodyText": "As its only used for fiat, better move it to fiat class instead of base class", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543569491", "createdAt": "2020-12-15T18:06:35Z", "author": {"login": "chimp1984"}, "path": "desktop/src/main/java/bisq/desktop/main/account/content/PaymentAccountsView.java", "diffHunk": "@@ -62,6 +62,8 @@ public void initialize() {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logSigners();\n             } else if (Utilities.isCtrlShiftPressed(KeyCode.U, event)) {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logUnsignedSignerPubKeys();\n+            } else if (Utilities.isAltOrCtrlPressed(KeyCode.C, event)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, "originalCommit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MTIxOQ==", "bodyText": "Why not move return into the try block?\nreturn getWitnessByHash(accountAgeWitnessHash)\n                .map(ageWitness -> new Tuple2<>(ageWitness, pubKeyHash))\n                .orElse(null);", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543571219", "createdAt": "2020-12-15T18:09:11Z", "author": {"login": "chimp1984"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -886,4 +887,24 @@ public String signInfoFromAccount(PaymentAccount paymentAccount) {\n         var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n         return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());\n     }\n+\n+    public Tuple2<AccountAgeWitness, byte[]> signInfoFromString(String signInfo) {\n+        var parts = signInfo.split(\",\");\n+        if (parts.length != 2){\n+            return null;\n+        }\n+        byte[] pubKeyHash;\n+        Optional<AccountAgeWitness> accountAgeWitness;\n+        try {\n+            var accountAgeWitnessHash = Utilities.decodeFromHex(parts[0]);\n+            pubKeyHash = Utilities.decodeFromHex(parts[1]);\n+            accountAgeWitness = getWitnessByHash(accountAgeWitnessHash);\n+        } catch (Exception e) {\n+            return null;\n+        }\n+\n+        return accountAgeWitness", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c33f9c9992b308276055de420741bd45a5a4118"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MjcyOQ==", "bodyText": "So that use old arbitrators, right? there are none registered anymore. Wouldn't it be better to use mediators or refund agents?", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543572729", "createdAt": "2020-12-15T18:11:24Z", "author": {"login": "chimp1984"}, "path": "desktop/src/main/java/bisq/desktop/main/overlays/windows/SignSpecificWitnessWindow.java", "diffHunk": "@@ -194,15 +161,24 @@ private void addSuccessContent() {\n \n     @Override\n     protected void addButtons() {\n-        var buttonTuple = add2ButtonsAfterGroup(gridPane, ++rowIndex + 1,\n+        var buttonTuple = add2ButtonsAfterGroup(gridPane, ++rowIndex + 2,\n                 Res.get(\"popup.accountSigning.singleAccountSelect.headline\"), Res.get(\"shared.cancel\"));\n \n         actionButton = buttonTuple.first;\n         actionButton.setDisable(true);\n-        actionButton.setOnAction(e -> selectAccountAgeWitness());\n+        actionButton.setOnAction(e -> importAccountAgeWitness());\n \n         closeButton = (AutoTooltipButton) buttonTuple.second;\n         closeButton.setOnAction(e -> hide());\n+    }\n \n+    private ECKey checkedArbitratorKey() {\n+        var arbitratorKey = arbitratorManager.getRegistrationKey(privateKey.getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c33f9c9992b308276055de420741bd45a5a4118"}, "originalPosition": 202}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MzU1Nw==", "bodyText": "Ah now I see why u use \",\" for concatination....\nA pipe or a static field for it would make it a bit more intuitive... but no worry... being picky ;-)", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543573557", "createdAt": "2020-12-15T18:12:32Z", "author": {"login": "chimp1984"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -886,4 +887,24 @@ public String signInfoFromAccount(PaymentAccount paymentAccount) {\n         var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n         return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());\n     }\n+\n+    public Tuple2<AccountAgeWitness, byte[]> signInfoFromString(String signInfo) {\n+        var parts = signInfo.split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c33f9c9992b308276055de420741bd45a5a4118"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3NTg3MQ==", "bodyText": "After reviewing the rest I understand now better... I stil would recommend to rename the method so it is more clear its not a normal user method but a special tool... also i am old-school and prefer get prefix... here it could read as intent as well: sign infoFromAccount.... instead of: get signInfo from account", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543575871", "createdAt": "2020-12-15T18:15:57Z", "author": {"login": "chimp1984"}, "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -880,4 +880,10 @@ public boolean isSignWitnessTrade(Trade trade) {\n                 !peerHasSignedWitness(trade) &&\n                 tradeAmountIsSufficient(trade.getTradeAmount());\n     }\n+\n+    public String signInfoFromAccount(PaymentAccount paymentAccount) {\n+        var pubKey = keyRing.getSignatureKeyPair().getPublic();\n+        var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n+        return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw=="}, "originalCommit": {"oid": "de25105fa81f7acc1468cecb1a35f763e9989224"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0f4dc22e784bfc55c8439f645a583ce6531c232", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/e0f4dc22e784bfc55c8439f645a583ce6531c232", "committedDate": "2020-12-15T18:27:13Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26024bd6ec0155dca6b8f3bb484df789535866af", "author": {"user": {"login": "sqrrm", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/26024bd6ec0155dca6b8f3bb484df789535866af", "committedDate": "2020-12-15T18:35:49Z", "message": "Refactor: rename methods, move return statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzY5NDEy", "url": "https://github.com/bisq-network/bisq/pull/4957#pullrequestreview-552769412", "createdAt": "2020-12-15T18:53:37Z", "commit": {"oid": "26024bd6ec0155dca6b8f3bb484df789535866af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNjY3MDU4", "url": "https://github.com/bisq-network/bisq/pull/4957#pullrequestreview-553667058", "createdAt": "2020-12-16T13:07:15Z", "commit": {"oid": "26024bd6ec0155dca6b8f3bb484df789535866af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3476, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}