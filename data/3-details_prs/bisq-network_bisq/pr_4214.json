{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTk0MDI0", "number": 4214, "title": "Add rpc wallet protection endpoints", "bodyText": "Implemented lockwallet, unlockwallet, removewalletpassword, and setwalletpassword methods with basic error handling.\nAlso added basic error handling to the existing getbalance method, and removed unused BalancePresentation from CoreAPI.\nResolves #4198\nNotes\nI didn't spend time second-guessing maintainers about the ordering of rpc service defs & methods in grpc.proto and GrpcServer, so changes might need to be made in that regard.  It makes sense to group wallet protection related methods together, but that is inconsistent with other alphabetically ordered service and method names.\nThere is also a getbalance error handling bug that needs fixing:  Error: null is printed to the :cli console when the daemon  is losing peers (SOCKET_TIMEOUT).\nBats test cases for these methods are ready to push in a new PR after (if) 4209 is merged.", "createdAt": "2020-04-29T22:43:35Z", "url": "https://github.com/bisq-network/bisq/pull/4214", "merged": true, "mergeCommit": {"oid": "2e33c2c87adc829ba738a8ed83810c2e3eef223f"}, "closed": true, "closedAt": "2020-05-18T12:25:58Z", "author": {"login": "ghubstan"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccgLaDgH2gAyNDEwOTk0MDI0OmRlNTA2OTJkYWE4MjkxODIyNDdhNTM5ZWRlZjEyZDJiYWEwODMyOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcieyg3AH2gAyNDEwOTk0MDI0OjdmMDVmMzc5YWJlNGJlZmM4NzY1NmUyNTdhN2JlNWUwOGU2NWRhODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de50692daa829182247a539edef12d2baa083292", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/de50692daa829182247a539edef12d2baa083292", "committedDate": "2020-04-29T22:25:23Z", "message": "Add rpc wallet protection endpoints\n\nImplemented lockwallet, unlockwallet, removewalletpassword, and\nsetwalletpassword methods with basic error handling.\n\nAlso added basic error handling to existing getbalance method,\nand removed unused BalancePresentation from CoreAPI.\n\nTODO:  update help text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20962757220d5ca25258cf33f06f009eb0245d40", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/20962757220d5ca25258cf33f06f009eb0245d40", "committedDate": "2020-04-30T14:00:22Z", "message": "Handle unlockwallet parameter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca68d0567fbcee9f0c210e2fd9188b2a126e119e", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/ca68d0567fbcee9f0c210e2fd9188b2a126e119e", "committedDate": "2020-04-30T14:21:04Z", "message": "Add wallet protection methods to printHelp(opts)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5fcafb5f61c6834d73d00e76457cc6ea07e448c", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/c5fcafb5f61c6834d73d00e76457cc6ea07e448c", "committedDate": "2020-04-30T14:57:59Z", "message": "Renamed tempWalletPassword -> tempLockWalletPassword\n\nThis @Nullable class level variable's name needs to specifically\ndescribe the use case."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDk5ODIz", "url": "https://github.com/bisq-network/bisq/pull/4214#pullrequestreview-404099823", "createdAt": "2020-05-01T10:14:05Z", "commit": {"oid": "c5fcafb5f61c6834d73d00e76457cc6ea07e448c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a9d1f6d3460a9c951fe17a39b61153e5723696f", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/2a9d1f6d3460a9c951fe17a39b61153e5723696f", "committedDate": "2020-05-01T20:29:14Z", "message": "Improve gRPC error handling\n\nThis change removes non-idiomatic gRPC *Reply proto message fields.\nThe client should not receive success/fail values from server methods\nwith a void return type, nor an optional error_message from any server\nmethod.  This change improves error handling by wrapping an appropriate\ngRPC Status with a meaningful error description in a StatusRuntimeException,\nand placing it in the server's response StreamObserver.  User error\nmessages are mapped to general purpose gRPC Status codes in a new ApiStatus\nenum class.  (Maybe ApiStatus should be renamed to CoreApiStatus.)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a6c87bd168ae6cf26a49f51466c80939e74181", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/c7a6c87bd168ae6cf26a49f51466c80939e74181", "committedDate": "2020-05-03T13:46:41Z", "message": "Refactor grpc wallet service\n\nPreviously, each wallet-related method was implemented with its own grpc\nservice. There is no need to do this, as a grpc service may declare\nmultiple rpc methods. This commit refactors everything wallet-related\ninto a single GrpcWalletService and also extracts a CoreWalletService\nfrom CoreApi in order to avoid the latter becoming overly large.\nIdeally, there would be no need for an abstraction in bisq.grpc called\nCoreWalletService; we would ideally use such a service implemented in\nbisq.core. The closest we have is WalletsManager, but it is not designed\nto be used the way we are using it here in the grpc context. Rather than\nmaking changes directly to core (which can be very risky), we will\nrather make them here in this layer, designing exactly the \"core wallet\nservice\" we need, and can then later see about folding it into the\nactual core."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6334c5478cfd24cf9877e4a33b8ae07d12f2bee2", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/6334c5478cfd24cf9877e4a33b8ae07d12f2bee2", "committedDate": "2020-05-03T13:47:26Z", "message": "Generalize gRPC exception message cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39c868f5959679993b5c12691b34a308c94068c5", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/39c868f5959679993b5c12691b34a308c94068c5", "committedDate": "2020-05-02T09:26:10Z", "message": "Refactor grpc wallet service\n\nPreviously, each wallet-related method was implemented with its own grpc\nservice. There is no need to do this, as a grpc service may declare\nmultiple rpc methods. This commit refactors everything wallet-related\ninto a single GrpcWalletService and also extracts a CoreWalletService\nfrom CoreApi in order to avoid the latter becoming overly large.\nIdeally, there would be no need for an abstraction in bisq.grpc called\nCoreWalletService; we would ideally use such a service implemented in\nbisq.core. The closest we have is WalletsManager, but it is not designed\nto be used the way we are using it here in the grpc context. Rather than\nmaking changes directly to core (which can be very risky), we will\nrather make them here in this layer, designing exactly the \"core wallet\nservice\" we need, and can then later see about folding it into the\nactual core."}, "afterCommit": {"oid": "12d2de5e11a46af04aa089337f06ab701af90bb1", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/12d2de5e11a46af04aa089337f06ab701af90bb1", "committedDate": "2020-05-03T13:48:54Z", "message": "Change CoreWalletService#getAvailableBalance from Tuple2 to long\n\nAnd throw an IllegalStateException with an appropriate message if the\nwallet is not available or still locked.\n\nThis change also eliminates the NullPointerException that would\nsometimes be thrown when calling #getAvailableBalance after the wallet\nhas become available but before the balance has become available."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "163061ac757900642b0ce4ccd083e2c172a8fbca", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/163061ac757900642b0ce4ccd083e2c172a8fbca", "committedDate": "2020-05-03T14:15:49Z", "message": "Return long vs Tuple2 from CoreWalletService#getAvailableBalance\n\nAnd throw an IllegalStateException with an appropriate message if the\nwallet is not available or still locked.\n\nThis change also eliminates the NullPointerException that would\nsometimes be thrown when calling #getAvailableBalance after the wallet\nhas become available but before the balance has become available."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12d2de5e11a46af04aa089337f06ab701af90bb1", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/12d2de5e11a46af04aa089337f06ab701af90bb1", "committedDate": "2020-05-03T13:48:54Z", "message": "Change CoreWalletService#getAvailableBalance from Tuple2 to long\n\nAnd throw an IllegalStateException with an appropriate message if the\nwallet is not available or still locked.\n\nThis change also eliminates the NullPointerException that would\nsometimes be thrown when calling #getAvailableBalance after the wallet\nhas become available but before the balance has become available."}, "afterCommit": {"oid": "163061ac757900642b0ce4ccd083e2c172a8fbca", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/163061ac757900642b0ce4ccd083e2c172a8fbca", "committedDate": "2020-05-03T14:15:49Z", "message": "Return long vs Tuple2 from CoreWalletService#getAvailableBalance\n\nAnd throw an IllegalStateException with an appropriate message if the\nwallet is not available or still locked.\n\nThis change also eliminates the NullPointerException that would\nsometimes be thrown when calling #getAvailableBalance after the wallet\nhas become available but before the balance has become available."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "916457963f56747fae53b78de288a774c0865761", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/916457963f56747fae53b78de288a774c0865761", "committedDate": "2020-05-03T16:42:14Z", "message": "Return void vs Tuple2 from CoreWalletService#setWalletPassword\n\nLike the change in commit 163061a, setWalletPassword now throws an\nIllegalStateException with an appropriate message if the wallet password\ncannot be set.\n\nAlso deletes unused StatusApi enums."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feafd0c983527ef6fee71ad371a0623c7393e681", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/feafd0c983527ef6fee71ad371a0623c7393e681", "committedDate": "2020-05-03T16:51:56Z", "message": "Return void vs Tuple2 from CoreWalletService#removeWalletPassword\n\nLike the change in commits 163061a and 9164579, removeWalletPassword\nnow throws an IllegalStateException with an appropriate message if\nthe wallet password cannot be removed.\n\nAlso deletes unused StatusApi enums."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab17b672294011b766da3ab6e02a349c01c4f7e0", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/ab17b672294011b766da3ab6e02a349c01c4f7e0", "committedDate": "2020-05-03T16:54:01Z", "message": "Remove obsolete try/catch block in #setWalletPassword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec2ee45e584fee04206325ef210ae55f64851606", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/ec2ee45e584fee04206325ef210ae55f64851606", "committedDate": "2020-05-03T17:25:19Z", "message": "Return void vs Tuple2 from CoreWalletService#lockWallet\n\nAnd delete unused StatusApi enum."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ef7286465f4027d49f1a28c136a6dea2910a0c4", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/3ef7286465f4027d49f1a28c136a6dea2910a0c4", "committedDate": "2020-05-03T17:29:32Z", "message": "Return void vs Tuple2 from CoreWalletService#unlockWallet\n\nAlso remove unused StatusApi class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjQxMDQy", "url": "https://github.com/bisq-network/bisq/pull/4214#pullrequestreview-404641042", "createdAt": "2020-05-03T17:39:22Z", "commit": {"oid": "ec2ee45e584fee04206325ef210ae55f64851606"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNzozOToyMlrOGPt_ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNzozOToyMlrOGPt_ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEzNTM3MA==", "bodyText": "Whitespace. Doesn't matter as ApiStatus will be removed shortly enough, but it makes me wonder whether or not you're using Editorconfig as suggested at bisq-network/style#10?", "url": "https://github.com/bisq-network/bisq/pull/4214#discussion_r419135370", "createdAt": "2020-05-03T17:39:22Z", "author": {"login": "cbeams"}, "path": "core/src/main/java/bisq/core/grpc/ApiStatus.java", "diffHunk": "@@ -56,5 +53,5 @@ public String toString() {\n                 \", description='\" + description + '\\'' +\n                 '}';\n     }\n-}\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec2ee45e584fee04206325ef210ae55f64851606"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a4ca51a8e6c5926cd9c21bc4983f155bdb4ae6", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/f5a4ca51a8e6c5926cd9c21bc4983f155bdb4ae6", "committedDate": "2020-05-03T18:09:23Z", "message": "Add missing return statement in CoreWalletService#setWalletPassword\n\nWithout bugfix, method would try to encrypt the wallet using using the\nold password argument immediately after encrypting the wallet with\na new password."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0e5da8e2ea31736234fe469fa4fb355ef1f442f", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/b0e5da8e2ea31736234fe469fa4fb355ef1f442f", "committedDate": "2020-05-04T10:22:13Z", "message": "Refactor setwalletpassword handling to eliminate duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48f9eb6f0e4f0688b414d40809efb95ee3ce932", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/d48f9eb6f0e4f0688b414d40809efb95ee3ce932", "committedDate": "2020-05-04T11:58:46Z", "message": "Tighten up error handling\n\nThis commit factors out a run() method in CliMain that either returns\n(void) or throws an exception. This eliminates the need to call\nSystem.exit in so many places as were previously. Indeed, now there is\nonly one place where System.exit is called.\n\nIt also removes the duplication of printing \"Error: ...\" to stderr when\nsomething goes wrong by doing this once in the global catch clause in\nthe main method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b156b86ddfb16593b80dcae3398fd90257f892d", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/9b156b86ddfb16593b80dcae3398fd90257f892d", "committedDate": "2020-05-04T18:19:18Z", "message": "Remove unlockwallet timeout variable initializer\n\nThis variable no longer needs to be initialized to avoid a compiler error."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbb025adb1abfd653fb1aec0ccfa5e739c2640ce", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/fbb025adb1abfd653fb1aec0ccfa5e739c2640ce", "committedDate": "2020-05-06T15:30:59Z", "message": "Factor out two small duplcated code blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4262f294625ba3e3dc501e39a938af3374c37113", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/4262f294625ba3e3dc501e39a938af3374c37113", "committedDate": "2020-05-06T18:20:41Z", "message": "Cache temp key and crypter scrypt in unlockwallet\n\nCache the aesKey instead of the password in unlock wallet method,\navoiding extra overhead of deriving it from the temp password in the\nlock method.\n\nThe KeyCrypterScrypt used in the unlock method must also be cached for\nuse in the manual lock method.  Creating a new KeyCrypterScrypt instance\nin the manual lock method would have a different random salt value,\ninvalidating the password used in the unlock method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24248d43673cea54e1c75bf7bc578b1a0ff3588d", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/24248d43673cea54e1c75bf7bc578b1a0ff3588d", "committedDate": "2020-05-06T18:40:15Z", "message": "Backup wallets after each encrypt/decrypt operation\n\nThis is consistent with :desktop's PasswordView#onApplyPassword."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79ae57ef05967688979dfac48593abb14552862", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/a79ae57ef05967688979dfac48593abb14552862", "committedDate": "2020-05-07T17:21:51Z", "message": "Cache aesKey in unlockwallet, clear it in lockwallet\n\nThere is no need to decrypt and re-encrypt wallet files in the unlock\nand lock wallet methods.  The temporary aesKey saved in the unlock\nmethod will used for operations on an encrypted wallet.\n\nThere is also no need to cache a tempKeyCrypterScrypt;  this class\nlevel variable was removed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9178ad7a31908b88bb7df743e395233d52069852", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/9178ad7a31908b88bb7df743e395233d52069852", "committedDate": "2020-05-13T15:30:39Z", "message": "Fix unlockwallet timeout override bug\n\nThe CoreWalletService should never be running more than one wallet lock\nTimerTask at any given time, and the wallet should lock at the correct time\nafter a user overrides a prior timeout value.\n\nThe CoreWalletService now cancels any existing lock TimerTask thread\nbefore creating a new one, to prevent the wallet from re-locking at\nunexpected times.\n\nThis change prevents error conditions created in scenarios similar to\nthe following:\n\n  (1)  User unlocks wallet for 60s\n  (2)  User overrides unlock timeout by calling unlockwallet \"pwd\" 600s\n  (3)  After 60s, the 1st, uncanceled lock timeout expires, and wallet is\n       locked 4 minutes too soon."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53cc38fdece6b32ff8242239e8813006dac06f4", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/d53cc38fdece6b32ff8242239e8813006dac06f4", "committedDate": "2020-05-18T12:08:35Z", "message": "Wrap comments at 90 chars\n\nPer https://github.com/bisq-network/style/issues/5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f05f379abe4befc87656e257a7be5e08e65da88", "author": {"user": {"login": "cbeams", "name": "Chris Beams"}}, "url": "https://github.com/bisq-network/bisq/commit/7f05f379abe4befc87656e257a7be5e08e65da88", "committedDate": "2020-05-18T12:11:50Z", "message": "Remove unused import\n\nThis should have been done in commit c7a6c87b."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3275, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}