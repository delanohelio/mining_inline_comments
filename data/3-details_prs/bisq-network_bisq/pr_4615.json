{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMDM2MTI0", "number": 4615, "title": "Fix trade protocol check for refund agent ticket close", "bodyText": "When a refund agent closes a case we have checked that the trade protocol is the same between offer and refund agent.\nThis would fail once we update trade protocol version when we release segwit. So this fixes that as it only checks if the version is not the old version (1) where refund agents have not been part of the system.\nAlso checks for legacy arbitrator that it only can be used for version 1 cases. Not tested and not assumed that this code will be executed as old arbitrators would use the old app in case they need to still work on a old case.", "createdAt": "2020-10-10T20:56:12Z", "url": "https://github.com/bisq-network/bisq/pull/4615", "merged": true, "mergeCommit": {"oid": "50e2c89c06b073557de23e8354a49a0e3d56cd4b"}, "closed": true, "closedAt": "2020-10-20T07:54:32Z", "author": {"login": "chimp1984"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRRL4tgH2gAyNTAxMDM2MTI0OjYwODE2NmNlNjQ0MWE0ZjVjMTdiMDAzYzY5MWEzYmI2ODBlZGIxYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUUAj1AFqTUxMjQyNjczMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "608166ce6441a4f5c17b003c691a3bb680edb1aa", "author": {"user": {"login": "chimp1984", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/608166ce6441a4f5c17b003c691a3bb680edb1aa", "committedDate": "2020-10-10T20:55:19Z", "message": "When a refund agent closes a case we have checked that the trade protocol is the same between offer and refund agent.\nThis would fail once we update trade protocol version when we release segwit. So this fixes that as it only checks if the version is not the old version (1) where refund agents have not been part of the system.\nAlso checks for legacy arbitrator that it only can be used for version 1 cases. Not tested and not assumed that this code will be executed as old arbitrators would use the old app in case they need to still work on a old case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78dc0290aff359f8a46107beaea158bafee9fab7", "author": {"user": {"login": "chimp1984", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/78dc0290aff359f8a46107beaea158bafee9fab7", "committedDate": "2020-10-11T01:20:04Z", "message": "Move onCloseDispute to DisputeAgentView"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTIyOTA0", "url": "https://github.com/bisq-network/bisq/pull/4615#pullrequestreview-511522904", "createdAt": "2020-10-19T08:27:05Z", "commit": {"oid": "78dc0290aff359f8a46107beaea158bafee9fab7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwODoyNzowNVrOHkDL6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwODoyNzowNVrOHkDL6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU2Mjk4Ng==", "bodyText": "NIT: sill instead of still", "url": "https://github.com/bisq-network/bisq/pull/4615#discussion_r507562986", "createdAt": "2020-10-19T08:27:05Z", "author": {"login": "ripcurlx"}, "path": "desktop/src/main/java/bisq/desktop/main/support/dispute/agent/arbitration/ArbitratorView.java", "diffHunk": "@@ -84,4 +86,17 @@ protected SupportType getType() {\n     protected DisputeSession getConcreteDisputeChatSession(Dispute dispute) {\n         return new ArbitrationSession(dispute, disputeManager.isTrader(dispute));\n     }\n+\n+    @Override\n+    protected void onCloseDispute(Dispute dispute) {\n+        long protocolVersion = dispute.getContract().getOfferPayload().getProtocolVersion();\n+        // Only cases with protocolVersion 1 are candidates for legacy arbitration.\n+        // This code path is not tested and it is not assumed that it is still be used as old arbitrators would use\n+        // their old Bisq version if sill cases are pending.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dc0290aff359f8a46107beaea158bafee9fab7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTI0MTU2", "url": "https://github.com/bisq-network/bisq/pull/4615#pullrequestreview-511524156", "createdAt": "2020-10-19T08:28:35Z", "commit": {"oid": "78dc0290aff359f8a46107beaea158bafee9fab7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b41d8b205eea629c035a9854c7ec0c7403b0fb", "author": {"user": {"login": "chimp1984", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/f2b41d8b205eea629c035a9854c7ec0c7403b0fb", "committedDate": "2020-10-19T23:33:08Z", "message": "Fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNDI2NzMz", "url": "https://github.com/bisq-network/bisq/pull/4615#pullrequestreview-512426733", "createdAt": "2020-10-20T07:54:26Z", "commit": {"oid": "f2b41d8b205eea629c035a9854c7ec0c7403b0fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3117, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}