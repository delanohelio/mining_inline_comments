{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMDE4NDg2", "number": 4215, "title": "Reject expired data", "bodyText": "If a new received protectedStorageEntry is expired we do not store it\nand do not broadcast.\nIt is unclear why we receive expired data (some are very old), but a\nmanipulated node might produce that and as it only removed at each\nbatch process running each minute to clean out expired data it still\ncould propagate. Is an attack vector also to flood the network with\noutdated offers where the maker is likely not online.\nShould fix #4026", "createdAt": "2020-04-29T23:39:27Z", "url": "https://github.com/bisq-network/bisq/pull/4215", "merged": true, "mergeCommit": {"oid": "c57e73b867692e65d75c6301b7d90e5775a51c0a"}, "closed": true, "closedAt": "2020-04-30T11:43:15Z", "author": {"login": "chimp1984"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcchNmYgH2gAyNDExMDE4NDg2OmQ5NjI4ODAyY2JmMDYyMjQ5NmM5YTdjNWM5MjZkNDlhN2E0Yzc1ZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcco3KagFqTQwMzMxMDg1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9628802cbf0622496c9a7c5c926d49a7a4c75db", "author": {"user": {"login": "chimp1984", "name": null}}, "url": "https://github.com/bisq-network/bisq/commit/d9628802cbf0622496c9a7c5c926d49a7a4c75db", "committedDate": "2020-04-29T23:37:41Z", "message": "If a new received protectedStorageEntry is expired we do not store it\nand do not broadcast.\n\nIt is unclear why we receive expired data (some are very old), but a\nmanipulated node might produce that and as it only removed at each\nbatch process running each minute to clean out expired data it still\ncould propagate. Is an attack vector also to flood the network with\noutdated offers where the maker is likely not online.\n\nShould fix https://github.com/bisq-network/bisq/issues/4026"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMjc5OTEw", "url": "https://github.com/bisq-network/bisq/pull/4215#pullrequestreview-403279910", "createdAt": "2020-04-30T07:48:15Z", "commit": {"oid": "d9628802cbf0622496c9a7c5c926d49a7a4c75db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzo0ODoxNlrOGOdtTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzo0ODoxNlrOGOdtTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxOTk4MA==", "bodyText": "I guess you meant peer.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"We received an expired protectedStorageEntry from ppper {}. getCreationTimeStamp={}, protectedStorageEntry={}\",\n          \n          \n            \n                        log.warn(\"We received an expired protectedStorageEntry from peer {}. getCreationTimeStamp={}, protectedStorageEntry={}\",", "url": "https://github.com/bisq-network/bisq/pull/4215#discussion_r417819980", "createdAt": "2020-04-30T07:48:16Z", "author": {"login": "ripcurlx"}, "path": "p2p/src/main/java/bisq/network/p2p/storage/P2PDataStorage.java", "diffHunk": "@@ -580,6 +577,15 @@ private boolean addProtectedStorageEntry(ProtectedStorageEntry protectedStorageE\n             return false;\n         }\n \n+        // To avoid that expired data get stored and broadcast we check early for expire date.\n+        if (protectedStorageEntry.isExpired(clock)) {\n+            log.warn(\"We received an expired protectedStorageEntry from ppper {}. getCreationTimeStamp={}, protectedStorageEntry={}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9628802cbf0622496c9a7c5c926d49a7a4c75db"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c57e73b867692e65d75c6301b7d90e5775a51c0a", "author": {"user": {"login": "ripcurlx", "name": "Christoph Atteneder"}}, "url": "https://github.com/bisq-network/bisq/commit/c57e73b867692e65d75c6301b7d90e5775a51c0a", "committedDate": "2020-04-30T08:23:37Z", "message": "Fix typo in log statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzEwODUw", "url": "https://github.com/bisq-network/bisq/pull/4215#pullrequestreview-403310850", "createdAt": "2020-04-30T08:32:25Z", "commit": {"oid": "c57e73b867692e65d75c6301b7d90e5775a51c0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3278, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}