{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDk1Mjg4", "number": 4559, "title": "Build out 'createoffer' API method", "bodyText": "A 1st cut of the API CLI's createoffer method implementation, pushed too early to get feedback early.\n(This PR depends on 4554.)\nTo see it work, start supporting apps in regtest/dao mode:\n$./bisq-apitest --apiPassword=xyz --supportingApps=bitcoind,seednode,arbdaemon,alicedaemon  --shutdownAfterTests=false\n\nTail the alicedaemon log:\n$tail -n 2000 -f apitest/build/resources/main/bisq-BTC_REGTEST_Alice_dao/bisq.log\n\nUse the CLI to see the default payment accts (and get the payment-acct-id for createoffer):\n$./bisq-cli --password=xyz getpaymentaccts\n\nName                Currency  Payment Method  ID                                                    \nPerfectMoney dummy       EUR  PERFECT_MONEY   c1ca87a6-918f-4a57-960a-979596dee7f6                \nETH dummy                ETH  BLOCK_CHAINS    d55040c4-aff4-4ed4-a900-73df578f9d2a \n\nTo see createoffer argument list:\n$./bisq-cli --help\n\nCreate a BUY / USD offer:\n$./bisq-cli --password=xyz createoffer c1ca87a6-918f-4a57-960a-979596dee7f6 buy usd 0.0625 0.05 true 0.00 0.15\n\nBuy/Sell  Price in usd for 1 BTC  BTC(min - max)            usd(min - max)  Payment Method  Creation Date (UTC)   ID\nBUY                  10,264.6136  0.05000000 - 0.06250000        513 - 642  Perfect Money   2020-09-23T23:21:29Z  KnuOzBKi-4b9cd6b7-7c2c-493e-8744-3083e0fafb28-139\n\nView offers:\n$./bisq-cli --password=xyz getoffers buy usd", "createdAt": "2020-09-23T23:34:44Z", "url": "https://github.com/bisq-network/bisq/pull/4559", "merged": true, "mergeCommit": {"oid": "f051a03d2907cd96cecbac3b33c0e485fa348e24"}, "closed": true, "closedAt": "2020-10-03T15:04:12Z", "author": {"login": "ghubstan"}, "timelineItems": {"totalCount": 59, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLbrf2gH2gAyNDkyMDk1Mjg4OjkxMzI3MjJiYmYzOGE3ZGYwMTM2YjhmOGM1MDg3NTkzMTI1ZmUyZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdO79aPgFqTUwMTU1MjI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9132722bbf38a7df0136b8f8c5087593125fe2f4", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/9132722bbf38a7df0136b8f8c5087593125fe2f4", "committedDate": "2020-09-22T17:45:21Z", "message": "Replace hardcoded version with Version.java value\n\nBats version check tests now use a bash script for parsing\nthe value from the Bisq class file, and these test cases\nno longer need to be manually updated."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34cfe9532ffa1d77f4310787bccca754b3745420", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/34cfe9532ffa1d77f4310787bccca754b3745420", "committedDate": "2020-09-22T17:51:31Z", "message": "Remove comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8896372a0f34c5c253593aaadfccb904f82ee492", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/8896372a0f34c5c253593aaadfccb904f82ee492", "committedDate": "2020-09-22T18:31:38Z", "message": "Move test dispute agent type constants to core\n\nThe string constants deleted from the test case are re-defined as enums,\nbut the test harness still passes around strings (enum.name()) because\nthe handling of invalid dispute agent type string args needs to be\ntested.  (Reminder:  CLI does not accept any enum arguments.)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f307c8263b424b9b5c5960d21bd17815b5e5f75", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/1f307c8263b424b9b5c5960d21bd17815b5e5f75", "committedDate": "2020-09-22T19:31:31Z", "message": "Fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a5040228efaae72616f37896d15b51485d7b6c2", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/6a5040228efaae72616f37896d15b51485d7b6c2", "committedDate": "2020-09-22T21:05:09Z", "message": "Add simple create payment acct test\n\nAnd make test dispute agent registration work from static fixture\nsetup methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d88d2733019da4c6231d5fa4159b69cba2dbf44", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/1d88d2733019da4c6231d5fa4159b69cba2dbf44", "committedDate": "2020-09-22T21:11:55Z", "message": "Remove final modifiers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4dd041d97fbe5a100d9a56d763cf4b4b8ee7e16", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/c4dd041d97fbe5a100d9a56d763cf4b4b8ee7e16", "committedDate": "2020-09-22T21:20:23Z", "message": "Don't use static boilerplate helpers if not necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63a6c57718ab6c480dd77b024ed9710f32bb72c", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/e63a6c57718ab6c480dd77b024ed9710f32bb72c", "committedDate": "2020-09-22T21:45:50Z", "message": "Remove comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92f36ed03a4d054b7517f1ac1a8af7bf99b03b17", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/92f36ed03a4d054b7517f1ac1a8af7bf99b03b17", "committedDate": "2020-09-23T01:08:01Z", "message": "Add get default payment acct helper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b68e572738d31afcdf41327d670d3a1dd654b87", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/2b68e572738d31afcdf41327d670d3a1dd654b87", "committedDate": "2020-09-23T01:09:58Z", "message": "Stub out createoffer method in CLI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c0c443680a7eca723eb6efaf0b73a41b1781f9e", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/3c0c443680a7eca723eb6efaf0b73a41b1781f9e", "committedDate": "2020-09-23T01:13:42Z", "message": "Change API's createoffer return value from bool to Offer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e3be0032218d37e0fc8a22023a1995394d49ad", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/70e3be0032218d37e0fc8a22023a1995394d49ad", "committedDate": "2020-09-23T01:16:55Z", "message": "Add API CreateOfferTest case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc1f0bac60635e98bad75becfc7282567eb152d8", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/fc1f0bac60635e98bad75becfc7282567eb152d8", "committedDate": "2020-09-23T01:56:08Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d190d09e2bc21ab8aaf686ba3a81a0936a716904", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/d190d09e2bc21ab8aaf686ba3a81a0936a716904", "committedDate": "2020-09-23T01:58:32Z", "message": "Fix unnecessary use of fully qualified name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb175c21aed46d3f41da1d336bd9ecdfcdb2e4a", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/adb175c21aed46d3f41da1d336bd9ecdfcdb2e4a", "committedDate": "2020-09-23T22:50:04Z", "message": "Add options helper for handling negative number CLI params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1431a076b2c3dad0921c1ec0d623f4e82898b13a", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/1431a076b2c3dad0921c1ec0d623f4e82898b13a", "committedDate": "2020-09-23T22:51:40Z", "message": "Add license comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b8800ba4dcab2e4c3a024140141dbfd3704510", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/d5b8800ba4dcab2e4c3a024140141dbfd3704510", "committedDate": "2020-09-23T22:52:37Z", "message": "Add license comment and btc-string to satoshi converter\n\nThe converter is needed for CLI, which has no access to core or\ncommon utils."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a7fe4b97bf6c2f439507695c97c33501015c98", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/c8a7fe4b97bf6c2f439507695c97c33501015c98", "committedDate": "2020-09-23T22:57:22Z", "message": "Print createoffer's reply in the CLI's console"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6048a4f7dc7bd105899daea608f0dc5b223ed97", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/a6048a4f7dc7bd105899daea608f0dc5b223ed97", "committedDate": "2020-09-23T23:43:56Z", "message": "Add comment to empty catch block for codacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9c1b0f109f15edb41fac9ca400345e027dd472", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/ec9c1b0f109f15edb41fac9ca400345e027dd472", "committedDate": "2020-09-24T12:18:13Z", "message": "Uppercase direction & ccy-code CLI arguments in core\n\nDon't convert parameter case in CLI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9999c95a9efe8de8597acddc679deba5e5e47621", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/9999c95a9efe8de8597acddc679deba5e5e47621", "committedDate": "2020-09-24T16:48:50Z", "message": "Change 'createoffer' argument order\n\nAnd list the args in CLI --help outout."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942a6f22030326fd05c6648d6b0dfdfc059c8fa8", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/942a6f22030326fd05c6648d6b0dfdfc059c8fa8", "committedDate": "2020-09-24T17:56:27Z", "message": "Scale & convert (double) fixed price input to long"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cdbc137c1420fc850c0ca1646d5c90841f24bfe", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/6cdbc137c1420fc850c0ca1646d5c90841f24bfe", "committedDate": "2020-09-24T21:13:19Z", "message": "Move 'createoffer' price arg transform to server & test it\n\nThe CreateOfferRequest's price field type was changed from long to string,\nso a CLI param like 10000.0055 can be passed to the server as is, to be\nscaled and converted there.  In general, we want to keep validation logic\non the CLI as simple as possible, and use existing core logic to\nvalidate args and convert arg types when needed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96278b9babdac9276a4251fedb84e18006db0b1c", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/96278b9babdac9276a4251fedb84e18006db0b1c", "committedDate": "2020-09-25T15:33:51Z", "message": "Push currencyCode.toUpperCase conversion below CoreApi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "995af0dd210a732feee09a8898601d8d63eb8a75", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/995af0dd210a732feee09a8898601d8d63eb8a75", "committedDate": "2020-09-25T16:50:50Z", "message": "Convert mktPriceMargin to %, make createAndPlaceOffer private\n\nAnd move createAndPlaceOffer to bottom of class file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cf9bbbaa99b902ace35f74b04224698e34b2172", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/6cf9bbbaa99b902ace35f74b04224698e34b2172", "committedDate": "2020-09-25T16:58:32Z", "message": "Minor createoffer test changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b518249d41e3d2c3daf61a80fe2710ae61f14dc", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/3b518249d41e3d2c3daf61a80fe2710ae61f14dc", "committedDate": "2020-09-25T17:44:35Z", "message": "Do not reassign currencyCode parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82ce864fda806a1de55d4fa0af5ab2ae7b0cfa79", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/82ce864fda806a1de55d4fa0af5ab2ae7b0cfa79", "committedDate": "2020-09-25T18:19:10Z", "message": "Delete trailing spaces from blank line for codacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f3e3a31e19cf9d488da2a6b01e0d6f7227838cd", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/2f3e3a31e19cf9d488da2a6b01e0d6f7227838cd", "committedDate": "2020-09-25T23:48:26Z", "message": "Add simple mkt-price service & test calculated offer prices\n\nA gRPC price service was added, and api create-offer tests can check\nmkt based price margin calculations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18df1e2fd442af82c74c2e00b871fe30b1bda202", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/18df1e2fd442af82c74c2e00b871fe30b1bda202", "committedDate": "2020-09-25T23:53:45Z", "message": "Fix abs(dbl) comparison"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92042d70ad06e878a7959bee85cd3faaf3861dfa", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/92042d70ad06e878a7959bee85cd3faaf3861dfa", "committedDate": "2020-09-25T23:56:25Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de3105a62be05e0e21bb22cb39c648a46b2c7845", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/de3105a62be05e0e21bb22cb39c648a46b2c7845", "committedDate": "2020-09-25T23:56:48Z", "message": "Add license comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96abda4e2d1830e8d4b1ada46e5f97c96b144973", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/96abda4e2d1830e8d4b1ada46e5f97c96b144973", "committedDate": "2020-09-26T16:40:10Z", "message": "Tidy up create offer using mkt price margin % test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a77be7e433b16351c29549563c82b2bb70fee8", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/35a77be7e433b16351c29549563c82b2bb70fee8", "committedDate": "2020-09-27T18:23:19Z", "message": "Redefine DisputeAgentType REFUNDAGENT as REFUND_AGENT\n\nThe CLI needs to be able to register a REFUND_AGENT using the\n'refund_agent' or 'refundagent' parameter value (in any case),\nso an alt-name mapping was added to the enum def."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70531693f00985ded648e9bb198e318a0cd43f36", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/70531693f00985ded648e9bb198e318a0cd43f36", "committedDate": "2020-09-27T20:02:38Z", "message": "Fix asserts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82b7b79c5b4252fd6ecfcaac82b7cd4f5769c3b7", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/82b7b79c5b4252fd6ecfcaac82b7cd4f5769c3b7", "committedDate": "2020-09-27T20:06:08Z", "message": "Factor out duplicated OfferInfo wrapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d4b9f5e1084caae1562ffeeffd6fc25aa22f76", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/50d4b9f5e1084caae1562ffeeffd6fc25aa22f76", "committedDate": "2020-09-27T20:18:50Z", "message": "Fix 'switch statements should have a default label' codacy problem\n\nThis is an ugly, temporary fix.  Need to refactor again."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9ece9f5ba253f92719255a6e22c926717493269", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/d9ece9f5ba253f92719255a6e22c926717493269", "committedDate": "2020-09-27T20:25:44Z", "message": "Revert \"Fix 'switch statements should have a default label' codacy problem\"\n\nThis reverts commit 50d4b9f5e1084caae1562ffeeffd6fc25aa22f76.\nBack out codacy fix;  it did not work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3761530b541519ef23d8d8edc48f53e4a61282b", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/f3761530b541519ef23d8d8edc48f53e4a61282b", "committedDate": "2020-09-28T12:38:08Z", "message": "Codacy requires default label in switch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94996a5e25e0a141ad408250fb6b41838722f2c3", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/94996a5e25e0a141ad408250fb6b41838722f2c3", "committedDate": "2020-09-28T14:48:56Z", "message": "Fix tx result handling in GrpcOffersService\n\nSeparates offer placement from offer creation to fix tx result\nhandling problem in GrpcOffersService, and readies the core api\nfor a new CLI 'placeoffer' implementation.  Offer placement still\nhappens in the api's 'createoffer', but we may want to change it\nto show the created offer to a CLI user for review, prior to manual\nplacement via a new 'placeoffer offer-id' (of 'confirmoffer offer-id'?)\napi method."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjE0ODg4", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-497614888", "createdAt": "2020-09-28T14:54:28Z", "commit": {"oid": "94996a5e25e0a141ad408250fb6b41838722f2c3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa5c21c0b22fac731b0298995521838cee5914d7", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/fa5c21c0b22fac731b0298995521838cee5914d7", "committedDate": "2020-09-28T17:30:30Z", "message": "Fix BitcoinCli wrapper create bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc94b97a0046ac2588faf83561c2b6a6f1b5cf41", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/fc94b97a0046ac2588faf83561c2b6a6f1b5cf41", "committedDate": "2020-09-28T21:11:08Z", "message": "Throw exception to CLI if attempted offer placement fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfe22c3cec4b3b6b2a00ee142ac48c37f04b663d", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/cfe22c3cec4b3b6b2a00ee142ac48c37f04b663d", "committedDate": "2020-09-28T21:11:49Z", "message": "Make task handler's error msg CLI friendly (needs review)\n\nThis needs to be carefully reviewed to be sure it does not break the\ncreate/place offer error messaging in the UI, and should be\nreverted if offer validation will be refactored to work for both\nUI and gRPC CLI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzE3OTE1", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-500317915", "createdAt": "2020-10-01T12:57:53Z", "commit": {"oid": "adb175c21aed46d3f41da1d336bd9ecdfcdb2e4a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjo1Nzo1M1rOHbJIhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzoxMTowMFrOHbJptA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIyMzIzOA==", "bodyText": "Why put at i-1? Wouldn't it be more natural to use i?", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498223238", "createdAt": "2020-10-01T12:57:53Z", "author": {"login": "sqrrm"}, "path": "cli/src/main/java/bisq/cli/NegativeNumberOptions.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.cli;\n+\n+import java.math.BigDecimal;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Predicate;\n+\n+import static java.util.Arrays.stream;\n+\n+class NegativeNumberOptions {\n+\n+    private final Map<Integer, String> negativeNumberParams = new HashMap<>();\n+\n+    String[] removeNegativeNumberOptions(String[] args) {\n+        // Cache any negative number params that will be rejected by the parser.\n+        // This should be called before command line parsing.\n+        for (int i = 0; i < args.length; i++) {\n+            if (isNegativeNumber.test(args[i])) {\n+                String param = args[i];\n+                negativeNumberParams.put(i - 1, new BigDecimal(param).toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb175c21aed46d3f41da1d336bd9ecdfcdb2e4a"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIyNjA1NA==", "bodyText": "How about nonOptionArgsClone.set(idx, v);?", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498226054", "createdAt": "2020-10-01T13:02:14Z", "author": {"login": "sqrrm"}, "path": "cli/src/main/java/bisq/cli/NegativeNumberOptions.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.cli;\n+\n+import java.math.BigDecimal;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Predicate;\n+\n+import static java.util.Arrays.stream;\n+\n+class NegativeNumberOptions {\n+\n+    private final Map<Integer, String> negativeNumberParams = new HashMap<>();\n+\n+    String[] removeNegativeNumberOptions(String[] args) {\n+        // Cache any negative number params that will be rejected by the parser.\n+        // This should be called before command line parsing.\n+        for (int i = 0; i < args.length; i++) {\n+            if (isNegativeNumber.test(args[i])) {\n+                String param = args[i];\n+                negativeNumberParams.put(i - 1, new BigDecimal(param).toString());\n+                args[i] = \"0\";  // Substitute a zero so the options parser won't barf.\n+            }\n+        }\n+        return args;\n+    }\n+\n+    List<String> restoreNegativeNumberOptions(List<String> nonOptionArgs) {\n+        // Put cached negative number params into a clone of the nonOptionArgs list.\n+        // This should be called after command line parsing.\n+        if (!negativeNumberParams.isEmpty()) {\n+            List<String> nonOptionArgsClone = new ArrayList<>(nonOptionArgs);\n+            negativeNumberParams.forEach((k, v) -> {\n+                int idx = k;\n+                nonOptionArgsClone.remove(idx);\n+                nonOptionArgsClone.add(idx, v);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb175c21aed46d3f41da1d336bd9ecdfcdb2e4a"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIzMTczMg==", "bodyText": "Expected more than 8 options but only 8 expected options listed", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498231732", "createdAt": "2020-10-01T13:11:00Z", "author": {"login": "sqrrm"}, "path": "cli/src/main/java/bisq/cli/CliMain.java", "diffHunk": "@@ -169,8 +189,39 @@ public static void run(String[] args) {\n                     return;\n                 }\n                 case createoffer: {\n-                    // TODO\n-                    out.println(\"offer created\");\n+                    if (nonOptionArgs.size() < 9)\n+                        throw new IllegalArgumentException(\"incorrect parameter count,\"\n+                                + \" expecting buy | sell, payment acct id, currency code, amount, min amount,\"\n+                                + \" use-market-based-price, fixed-price | mkt-price-margin, security-deposit\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a7fe4b97bf6c2f439507695c97c33501015c98"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMDYwNDcw", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-501060470", "createdAt": "2020-10-02T11:35:50Z", "commit": {"oid": "f3761530b541519ef23d8d8edc48f53e4a61282b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMTozNTo1MFrOHbqY4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMTo0Mjo1OFrOHbqjkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc2ODA5Ng==", "bodyText": "I think we can ignore codacy on this one going forward as it's possible to merge even when it's complaining. Perhaps we could even configure codacy to ignore it.", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498768096", "createdAt": "2020-10-02T11:35:50Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/api/CoreDisputeAgentsService.java", "diffHunk": "@@ -100,6 +100,10 @@ void registerDisputeAgent(String disputeAgentTypeString, String registrationKey)\n                     signature = refundAgentManager.signStorageSignaturePubKey(Objects.requireNonNull(ecKey));\n                     registerRefundAgent(nodeAddress, languageCodes, ecKey, signature);\n                     return;\n+                default:\n+                    // Codacy requires default label in switch, Intellij does not.\n+                    //noinspection UnnecessaryReturnStatement\n+                    return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3761530b541519ef23d8d8edc48f53e4a61282b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc3MDU5MA==", "bodyText": "The UI might get a bit verbose on errors with this change.", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498770590", "createdAt": "2020-10-02T11:42:22Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/taskrunner/Task.java", "diffHunk": "@@ -65,7 +67,7 @@ protected void failed(String message) {\n \n     protected void failed(Throwable t) {\n         log.error(errorMessage, t);\n-        taskHandler.handleErrorMessage(errorMessage);\n+        taskHandler.handleErrorMessage(format(\"%s: %s\", errorMessage, t.getMessage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfe22c3cec4b3b6b2a00ee142ac48c37f04b663d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc3MDgzNA==", "bodyText": "I think this was fixed in a later commit", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r498770834", "createdAt": "2020-10-02T11:42:58Z", "author": {"login": "sqrrm"}, "path": "cli/src/main/java/bisq/cli/CliMain.java", "diffHunk": "@@ -169,8 +189,39 @@ public static void run(String[] args) {\n                     return;\n                 }\n                 case createoffer: {\n-                    // TODO\n-                    out.println(\"offer created\");\n+                    if (nonOptionArgs.size() < 9)\n+                        throw new IllegalArgumentException(\"incorrect parameter count,\"\n+                                + \" expecting buy | sell, payment acct id, currency code, amount, min amount,\"\n+                                + \" use-market-based-price, fixed-price | mkt-price-margin, security-deposit\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIzMTczMg=="}, "originalCommit": {"oid": "c8a7fe4b97bf6c2f439507695c97c33501015c98"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMDY0Nzc3", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-501064777", "createdAt": "2020-10-02T11:44:01Z", "commit": {"oid": "cfe22c3cec4b3b6b2a00ee142ac48c37f04b663d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23a677d3b8eb51c8d7abac397f628e9469feb506", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/23a677d3b8eb51c8d7abac397f628e9469feb506", "committedDate": "2020-10-02T17:24:22Z", "message": "Use list.set, not list.remove, list.add"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e09b821222f363df7d4ef69339fe05dfc4a5b11d", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/e09b821222f363df7d4ef69339fe05dfc4a5b11d", "committedDate": "2020-10-02T17:41:47Z", "message": "Explain use of args clone index (i-1)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "628c557a98b38a8ce5d821f0046742e85b6da669", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/628c557a98b38a8ce5d821f0046742e85b6da669", "committedDate": "2020-10-02T17:51:43Z", "message": "Revert \"Make task handler's error msg CLI friendly (needs review)\"\n\nThis reverts commit cfe22c3cec4b3b6b2a00ee142ac48c37f04b663d.\n\nThis will be Too verbose in UI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "631c3f4f12a5130bb2d16ba9b8f202da0c9ef096", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/631c3f4f12a5130bb2d16ba9b8f202da0c9ef096", "committedDate": "2020-10-02T18:02:37Z", "message": "Log provenance of Task error on server, but pass only exception msg to clients\n\nAdjusted create offer validation test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "033271189ff888c4f50b7269067c381e11412803", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/033271189ff888c4f50b7269067c381e11412803", "committedDate": "2020-10-02T18:10:13Z", "message": "Ignore codacy complaint about (dead) default switch labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1693a6cf4d1b7cb5f0380f63dad8d50cdc72157", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/f1693a6cf4d1b7cb5f0380f63dad8d50cdc72157", "committedDate": "2020-10-02T18:25:32Z", "message": "Add switch statement break to make codacy happy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDI3ODM4", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-501427838", "createdAt": "2020-10-02T20:28:23Z", "commit": {"oid": "f1693a6cf4d1b7cb5f0380f63dad8d50cdc72157"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDoyODoyNFrOHb6tqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDoyODoyNFrOHb6tqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAzNTU2MA==", "bodyText": "For symmetry I would probably have a return here, or break in the MEDIATOR case. Not serious, but it makes more sense when similar cases are handled the same way. In this case one has to wonder why there is a return in one case and break in the next.", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r499035560", "createdAt": "2020-10-02T20:28:24Z", "author": {"login": "sqrrm"}, "path": "core/src/main/java/bisq/core/api/CoreDisputeAgentsService.java", "diffHunk": "@@ -99,6 +99,7 @@ void registerDisputeAgent(String disputeAgentTypeString, String registrationKey)\n                     ecKey = refundAgentManager.getRegistrationKey(registrationKey);\n                     signature = refundAgentManager.signStorageSignaturePubKey(Objects.requireNonNull(ecKey));\n                     registerRefundAgent(nodeAddress, languageCodes, ecKey, signature);\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1693a6cf4d1b7cb5f0380f63dad8d50cdc72157"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c71ad8489c0a0e7ec89a9a0c1575b683f216548f", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/c71ad8489c0a0e7ec89a9a0c1575b683f216548f", "committedDate": "2020-10-02T20:57:31Z", "message": "Change 'break' to 'return' at end of switch."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "723fc8fc08ab25b471436b24eb42d62c1412caee", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/723fc8fc08ab25b471436b24eb42d62c1412caee", "committedDate": "2020-10-02T21:11:25Z", "message": "Skip over method name in args loop, start at i=1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTQxNzE2", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-501541716", "createdAt": "2020-10-03T12:08:49Z", "commit": {"oid": "631c3f4f12a5130bb2d16ba9b8f202da0c9ef096"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMjowODo1MFrOHcBPXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMjowODo1MFrOHcBPXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0MjQ5Mg==", "bodyText": "I would like to exclude this change from this PR. It would affect the UI notifications that depend on the errormessage being reasonable for display.\nGenerally refactoring is fine (although more care is needed now with the many big PRs coming in, to avoid conflicts) and behavioral changes are fine as long as the ramifications are taken into account, I feel that's lacking here.\nThat's the only issue I have left. The rest looks good.", "url": "https://github.com/bisq-network/bisq/pull/4559#discussion_r499142492", "createdAt": "2020-10-03T12:08:50Z", "author": {"login": "sqrrm"}, "path": "common/src/main/java/bisq/common/taskrunner/Task.java", "diffHunk": "@@ -65,7 +65,7 @@ protected void failed(String message) {\n \n     protected void failed(Throwable t) {\n         log.error(errorMessage, t);\n-        taskHandler.handleErrorMessage(errorMessage);\n+        taskHandler.handleErrorMessage(t.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "631c3f4f12a5130bb2d16ba9b8f202da0c9ef096"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d6d98666a6c86110f9a907488a4df54b257a0a", "author": {"user": {"login": "ghubstan", "name": "Stan"}}, "url": "https://github.com/bisq-network/bisq/commit/d3d6d98666a6c86110f9a907488a4df54b257a0a", "committedDate": "2020-10-03T14:55:58Z", "message": "Revert all changes since commit d55114e\n\nRevert Task.java back to the state it was in prior to\nmy attempts to make it work for passing error msgs to a\ngRPC CLI running 'placeoffer'.  Adjust the affected test\naccordingly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTUyMjU1", "url": "https://github.com/bisq-network/bisq/pull/4559#pullrequestreview-501552255", "createdAt": "2020-10-03T15:03:39Z", "commit": {"oid": "d3d6d98666a6c86110f9a907488a4df54b257a0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3058, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}