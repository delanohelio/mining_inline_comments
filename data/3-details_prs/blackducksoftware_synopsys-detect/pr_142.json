{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTMwMzM4", "number": 142, "title": "Sb sonarcloud issues", "bodyText": "Addressed the quality gate problems in clang and bazel", "createdAt": "2020-03-30T22:05:22Z", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142", "merged": true, "mergeCommit": {"oid": "0cad8d9ebff835cf43e60cdc9a3c699447389c36"}, "closed": true, "closedAt": "2020-03-31T19:22:20Z", "author": {"login": "stevebillings"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS1l3lgH2gAyMzk1OTMwMzM4OmNjNGU1OWM5MWNjYWJiNDk4MTQzYzNiMDIzZDg0OTZkNTA5MTNkZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTHnQ-AH2gAyMzk1OTMwMzM4OjY2ZGQzMGI4ZjNlYWM0NGVlOTUxYWFiNDIyNWQ2MWRlYjFiNjFjMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc4e59c91ccabb498143c3b023d8496d50913ded", "author": {"user": null}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/cc4e59c91ccabb498143c3b023d8496d50913ded", "committedDate": "2020-03-30T21:43:03Z", "message": "refactor: bazel: sonarqube issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e8b17b848443fd309dff2713df5d86cc1b5769", "author": {"user": null}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/30e8b17b848443fd309dff2713df5d86cc1b5769", "committedDate": "2020-03-30T21:43:39Z", "message": "refactor: clang: sonarcloud issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f2d0c848b2bca4974533f4c627d9cdbfa0aac9e", "author": {"user": null}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/7f2d0c848b2bca4974533f4c627d9cdbfa0aac9e", "committedDate": "2020-03-30T21:52:22Z", "message": "refactor: clang: sonarcloud issue (complexity)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547", "author": {"user": null}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/6868ccfe8746a34981739c3f5b3d94f990f1f547", "committedDate": "2020-03-30T21:52:50Z", "message": "refactor: whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mjg5Nzc3", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#pullrequestreview-384289777", "createdAt": "2020-03-30T22:55:23Z", "commit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjo1NToyM1rOF9_OSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjo1Njo1MlrOF9_Qbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0MzMwNg==", "bodyText": "I'd prefer we changed this as it reads strangely to me. So instead of \"isLastCharWasEscapeChar\" we could do \"wasLastCharEscapeChar\".", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#discussion_r400543306", "createdAt": "2020-03-30T22:55:23Z", "author": {"login": "taikuukaits"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/clang/compilecommand/CompileCommandParser.java", "diffHunk": "@@ -103,38 +104,74 @@ private String unEscapeDoubleQuotes(final String givenString) {\n \n     private String escapeQuotedWhitespace(final String givenString) {\n         final StringBuilder newString = new StringBuilder();\n-        boolean lastCharWasEscapeChar = false;\n-        boolean inQuotes = false;\n-        boolean quoteTypeIsDouble = false;\n+        final ParserState parserState = new ParserState();\n         for (int i = 0; i < givenString.length(); i++) {\n             final char c = givenString.charAt(i);\n-            if (!inQuotes) {\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = true;\n-                } else {\n-                    newString.append(c);\n-                }\n+            if (!parserState.isInQuotes()) {\n+                processNonQuotedChar(parserState, c, newString);\n             } else {\n-                // Currently inside a quoted substring\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR) && !quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR) && quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (c == SPACE_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n-                } else if (c == TAB_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n-                } else {\n-                    newString.append(c);\n-                }\n+                processQuotedChar(parserState, c, newString);\n             }\n-            lastCharWasEscapeChar = (c == ESCAPE_CHAR);\n+            parserState.setLastCharWasEscapeChar(c == ESCAPE_CHAR);\n         }\n         logger.trace(String.format(\"escapeQuotedWhitespace() changed %s to %s\", givenString, newString.toString()));\n         return newString.toString();\n     }\n+\n+    private void processQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        // Currently inside a quoted substring\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR) && !parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR) && parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (c == SPACE_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n+        } else if (c == TAB_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private void processNonQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(true);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private class ParserState {\n+        private boolean lastCharWasEscapeChar = false;\n+        private boolean inQuotes = false;\n+        private boolean quoteTypeIsDouble = false;\n+\n+        public boolean isLastCharWasEscapeChar() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0MzUwNQ==", "bodyText": "Or if we wanted to keep the \"is\" maybe \"isLastCharEscapeChar\".", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#discussion_r400543505", "createdAt": "2020-03-30T22:55:54Z", "author": {"login": "taikuukaits"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/clang/compilecommand/CompileCommandParser.java", "diffHunk": "@@ -103,38 +104,74 @@ private String unEscapeDoubleQuotes(final String givenString) {\n \n     private String escapeQuotedWhitespace(final String givenString) {\n         final StringBuilder newString = new StringBuilder();\n-        boolean lastCharWasEscapeChar = false;\n-        boolean inQuotes = false;\n-        boolean quoteTypeIsDouble = false;\n+        final ParserState parserState = new ParserState();\n         for (int i = 0; i < givenString.length(); i++) {\n             final char c = givenString.charAt(i);\n-            if (!inQuotes) {\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = true;\n-                } else {\n-                    newString.append(c);\n-                }\n+            if (!parserState.isInQuotes()) {\n+                processNonQuotedChar(parserState, c, newString);\n             } else {\n-                // Currently inside a quoted substring\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR) && !quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR) && quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (c == SPACE_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n-                } else if (c == TAB_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n-                } else {\n-                    newString.append(c);\n-                }\n+                processQuotedChar(parserState, c, newString);\n             }\n-            lastCharWasEscapeChar = (c == ESCAPE_CHAR);\n+            parserState.setLastCharWasEscapeChar(c == ESCAPE_CHAR);\n         }\n         logger.trace(String.format(\"escapeQuotedWhitespace() changed %s to %s\", givenString, newString.toString()));\n         return newString.toString();\n     }\n+\n+    private void processQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        // Currently inside a quoted substring\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR) && !parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR) && parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (c == SPACE_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n+        } else if (c == TAB_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private void processNonQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(true);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private class ParserState {\n+        private boolean lastCharWasEscapeChar = false;\n+        private boolean inQuotes = false;\n+        private boolean quoteTypeIsDouble = false;\n+\n+        public boolean isLastCharWasEscapeChar() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0MzMwNg=="}, "originalCommit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0Mzg1NQ==", "bodyText": "Similarly this reads strangely. Maybe \"isDoubleQuoteType\" instead.", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#discussion_r400543855", "createdAt": "2020-03-30T22:56:52Z", "author": {"login": "taikuukaits"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/clang/compilecommand/CompileCommandParser.java", "diffHunk": "@@ -103,38 +104,74 @@ private String unEscapeDoubleQuotes(final String givenString) {\n \n     private String escapeQuotedWhitespace(final String givenString) {\n         final StringBuilder newString = new StringBuilder();\n-        boolean lastCharWasEscapeChar = false;\n-        boolean inQuotes = false;\n-        boolean quoteTypeIsDouble = false;\n+        final ParserState parserState = new ParserState();\n         for (int i = 0; i < givenString.length(); i++) {\n             final char c = givenString.charAt(i);\n-            if (!inQuotes) {\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = true;\n-                } else {\n-                    newString.append(c);\n-                }\n+            if (!parserState.isInQuotes()) {\n+                processNonQuotedChar(parserState, c, newString);\n             } else {\n-                // Currently inside a quoted substring\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR) && !quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR) && quoteTypeIsDouble) {\n-                    inQuotes = false;\n-                } else if (c == SPACE_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n-                } else if (c == TAB_CHAR) {\n-                    newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n-                } else {\n-                    newString.append(c);\n-                }\n+                processQuotedChar(parserState, c, newString);\n             }\n-            lastCharWasEscapeChar = (c == ESCAPE_CHAR);\n+            parserState.setLastCharWasEscapeChar(c == ESCAPE_CHAR);\n         }\n         logger.trace(String.format(\"escapeQuotedWhitespace() changed %s to %s\", givenString, newString.toString()));\n         return newString.toString();\n     }\n+\n+    private void processQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        // Currently inside a quoted substring\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR) && !parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR) && parserState.isQuoteTypeIsDouble()) {\n+            parserState.setInQuotes(false);\n+        } else if (c == SPACE_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_SPACE_CHAR);\n+        } else if (c == TAB_CHAR) {\n+            newString.append(ESCAPE_SEQUENCE_FOR_TAB_CHAR);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private void processNonQuotedChar(final ParserState parserState, final char c, final StringBuilder newString) {\n+        if (!parserState.isLastCharWasEscapeChar() && (c == SINGLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(false);\n+        } else if (!parserState.isLastCharWasEscapeChar() && (c == DOUBLE_QUOTE_CHAR)) {\n+            parserState.setInQuotes(true);\n+            parserState.setQuoteTypeIsDouble(true);\n+        } else {\n+            newString.append(c);\n+        }\n+    }\n+\n+    private class ParserState {\n+        private boolean lastCharWasEscapeChar = false;\n+        private boolean inQuotes = false;\n+        private boolean quoteTypeIsDouble = false;\n+\n+        public boolean isLastCharWasEscapeChar() {\n+            return lastCharWasEscapeChar;\n+        }\n+\n+        public boolean isInQuotes() {\n+            return inQuotes;\n+        }\n+\n+        public boolean isQuoteTypeIsDouble() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTQ1MDcx", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#pullrequestreview-384945071", "createdAt": "2020-03-31T17:19:40Z", "commit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzoxOTo0MFrOF-gKZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzoxOTo0MFrOF-gKZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA4Mjk4Mg==", "bodyText": "Small nitpick, but could we swap the if so we aren't negating the statement? I think it makes it easier to read.", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#discussion_r401082982", "createdAt": "2020-03-31T17:19:40Z", "author": {"login": "JakeMathews"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/clang/compilecommand/CompileCommandParser.java", "diffHunk": "@@ -103,38 +104,74 @@ private String unEscapeDoubleQuotes(final String givenString) {\n \n     private String escapeQuotedWhitespace(final String givenString) {\n         final StringBuilder newString = new StringBuilder();\n-        boolean lastCharWasEscapeChar = false;\n-        boolean inQuotes = false;\n-        boolean quoteTypeIsDouble = false;\n+        final ParserState parserState = new ParserState();\n         for (int i = 0; i < givenString.length(); i++) {\n             final char c = givenString.charAt(i);\n-            if (!inQuotes) {\n-                if (!lastCharWasEscapeChar && (c == SINGLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = false;\n-                } else if (!lastCharWasEscapeChar && (c == DOUBLE_QUOTE_CHAR)) {\n-                    inQuotes = true;\n-                    quoteTypeIsDouble = true;\n-                } else {\n-                    newString.append(c);\n-                }\n+            if (!parserState.isInQuotes()) {\n+                processNonQuotedChar(parserState, c, newString);\n             } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTQ1NTA2", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/142#pullrequestreview-384945506", "createdAt": "2020-03-31T17:20:14Z", "commit": {"oid": "6868ccfe8746a34981739c3f5b3d94f990f1f547"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66dd30b8f3eac44ee951aab4225d61deb1b61c22", "author": {"user": null}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/66dd30b8f3eac44ee951aab4225d61deb1b61c22", "committedDate": "2020-03-31T18:42:52Z", "message": "refactor: updates for PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3295, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}