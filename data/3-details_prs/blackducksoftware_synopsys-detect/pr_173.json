{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMzEzNjA5", "number": 173, "title": "feat(go): GoMod extractor now retrieves and applies replacement data \u2026", "bodyText": "\u2026(IDETECT-1966)\nEditing goMod extraction to incorporate replace stipulations into dependency graph.\nThe command \"go mod graph\" does not reflect replacement data, so it is retrieved by parsing the output of \"go list -m -u -json all\", and using that to edit the output of \"go mod graph\".\nIDETECT-1966", "createdAt": "2020-05-26T16:26:28Z", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/173", "merged": true, "mergeCommit": {"oid": "94539cb461e931f7d498d09535612fe116bca457"}, "closed": true, "closedAt": "2020-06-15T20:04:50Z", "author": {"login": "crowleySynopsys"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclHLCIAH2gAyNDIzMzEzNjA5OjA3OWQ0YTZjZmQyYjEzMGI2ZGUyNGJiYWQyMjliOWEzZTZjOGNhZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrmVDkgH2gAyNDIzMzEzNjA5OjlkMjU0ZDMyNTYwMjliODZmNTI3YjJjNWRmYTY5YjMzNDkyZjBiZjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "079d4a6cfd2b130b6de24bbad229b9a3e6c8cafb", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/079d4a6cfd2b130b6de24bbad229b9a3e6c8cafb", "committedDate": "2020-05-26T16:22:40Z", "message": "feat(go): GoMod extractor now retrieves and applies replacement data (IDETECT-1966)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcc0d87a3fd2dd30cb044391dac2000098171cb2", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/dcc0d87a3fd2dd30cb044391dac2000098171cb2", "committedDate": "2020-06-12T18:55:21Z", "message": "fix: Removing debug statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5Mjk1MDQ2", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/173#pullrequestreview-419295046", "createdAt": "2020-05-27T14:48:30Z", "commit": {"oid": "079d4a6cfd2b130b6de24bbad229b9a3e6c8cafb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo0ODozMFrOGbOG-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxODoxNDo0NlrOGj9V4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5NTg5OA==", "bodyText": "I would change one of the versions in the list output. Then assert on that version so that we know the replacement is working.", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/173#discussion_r431195898", "createdAt": "2020-05-27T14:48:30Z", "author": {"login": "JakeMathews"}, "path": "detectable/src/test/java/com/synopsys/integration/detectable/detectables/go/functional/GoModDetectableTest.java", "diffHunk": "@@ -33,6 +33,24 @@ protected void setup() throws IOException {\n         );\n         addExecutableOutput(goListOutput, \"go\", \"list\", \"-m\");\n \n+        ExecutableOutput goListUJsonOutput = createStandardOutput(\n+            \"{\",\n+            \"\\t\\\"Path\\\": \\\"github.com/codegangsta/negroni\\\",\",\n+            \"\\t\\\"Version\\\": \\\"v1.0.0\\\"\",\n+            \"}\",\n+            \"\",\n+            \"{\",\n+            \"\\t\\\"Path\\\": \\\"github.com/sirupsen/logrus\\\",\",\n+            \"\\t\\\"Version\\\": \\\"v1.1.1\\\"\",\n+            \"}\",\n+            \"\",\n+            \"{\",\n+            \"\\t\\\"Path\\\": \\\"github.com/davecgh/go-spew\\\",\",\n+            \"\\t\\\"Version\\\": \\\"v1.1.1\\\"\",\n+            \"}\"\n+        );\n+        addExecutableOutput(goListUJsonOutput, \"go\", \"list\", \"-m\", \"-u\", \"-json\", \"all\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079d4a6cfd2b130b6de24bbad229b9a3e6c8cafb"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1ODM2OQ==", "bodyText": "Have you considered using a POJO here?", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/173#discussion_r440358369", "createdAt": "2020-06-15T18:14:46Z", "author": {"login": "JakeMathews"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/go/gomod/GoModCliExtractor.java", "diffHunk": "@@ -61,4 +72,45 @@ public Extraction extract(final File directory, final File goExe) {\n             throw new DetectableException(failureMessage + output.getReturnCode());\n         }\n     }\n+\n+    private List<String> modGraphOutputWithReplacements(File directory, File goExe, List<String> listUJsonOutput) throws ExecutableRunnerException, DetectableException {\n+        final List<String> modGraphOutput = execute(directory, goExe, \"Querying for the go mod graph failed:\", \"mod\", \"graph\");\n+        String jsonString = convertOutputToJsonString(listUJsonOutput);\n+        JsonObject json = gson.fromJson(jsonString, JsonObject.class);\n+\n+        for (final JsonElement jsonElement : json.getAsJsonArray(PATHS)) {\n+            JsonObject jsonObject = jsonElement.getAsJsonObject();\n+            JsonObject replace = jsonObject.getAsJsonObject(\"Replace\");\n+            if (replace != null) {\n+                String path = jsonObject.get(\"Path\").getAsString();\n+                String originalVersion = jsonObject.get(\"Version\").getAsString();\n+                String replaceVersion = replace.get(\"Version\").getAsString();\n+                replacementData.put(String.format(\"%s@%s\", path, originalVersion), String.format(\"%s@%s\", path, replaceVersion));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcc0d87a3fd2dd30cb044391dac2000098171cb2"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9c7792a799e6e4622126158c22f038872e061f1", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/d9c7792a799e6e4622126158c22f038872e061f1", "committedDate": "2020-06-15T19:10:48Z", "message": "feat(go): added battery test for go mod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6f9c7cc11ea036db97de4037f82199c1ae3832", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/3d6f9c7cc11ea036db97de4037f82199c1ae3832", "committedDate": "2020-06-15T19:25:57Z", "message": "feat: Edited go list -u -json input to test replacement functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28736e7af75e9ddc839efef437ce47f15bd4d952", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/28736e7af75e9ddc839efef437ce47f15bd4d952", "committedDate": "2020-06-15T19:42:15Z", "message": "feat: Use POJO instead of generic JsonElement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e59b0043c8d9a86f8aad362fcf6552206df6b2c0", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/e59b0043c8d9a86f8aad362fcf6552206df6b2c0", "committedDate": "2020-06-15T19:48:53Z", "message": "feat: Use TypeToken to avoid iterating over JsonArray"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwOTQ1ODM2", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/173#pullrequestreview-430945836", "createdAt": "2020-06-15T19:51:52Z", "commit": {"oid": "e59b0043c8d9a86f8aad362fcf6552206df6b2c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b209e17d180d27012331125f45745187d3fba26", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/5b209e17d180d27012331125f45745187d3fba26", "committedDate": "2020-06-15T19:59:02Z", "message": "Merge branch 'master' into goModReplace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d254d3256029b86f527b2c5dfa69b33492f0bf9", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/9d254d3256029b86f527b2c5dfa69b33492f0bf9", "committedDate": "2020-06-15T20:04:13Z", "message": "feat: Added release note"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3317, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}