{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2ODA1NjM3", "number": 226, "title": "fix(lerna): Lerna packages should no longer be reported as missing de\u2026", "bodyText": "\u2026pendencies. (Fixes IDETECT-2108)\nDescription\nWhen a there is a missing dependency during Yarn or NPM extraction, each Detector has its own mechanism for handling that scenario. In the case of Lerna, we want the ability to override that behavior with a check against known Lerna packages so as not to throw errors about missing dependencies when there are none.\nExample project:\nhttps://github.com/atlassian/lerna-semantic-release\nCurrent behavior:\n2020-07-08 09:33:25 ERROR [main] --- No dependency found for package: lerna-semantic-release-io\n2020-07-08 09:33:25 ERROR [main] --- No dependency found for package: lerna-semantic-release-perform\n2020-07-08 09:33:25 ERROR [main] --- No dependency found for package: lerna-semantic-release-post\n2020-07-08 09:33:25 ERROR [main] --- No dependency found for package: lerna-semantic-release-pre\n2020-07-08 09:33:25 ERROR [main] --- No dependency found for package: lerna-semantic-release-utils\n2020-07-08 09:33:25 DEBUG [main] --- Found 1 root dependencies.\n2020-07-08 09:33:25 DEBUG [main] --- Finished processing.\n2020-07-08 09:33:25 DEBUG [main] --- Extraction completed successfully on lerna-semantic-release:9.1.0 at /opt/hub-detect/lerna-repos/lerna-semantic-release/packages/lerna-semantic-release.\n\nNew behavior:\n2020-09-14 14:18:26 DEBUG [main] --- Processing project.\n2020-09-14 14:18:26 DEBUG [main] --- Found 43 dependencies in the lockfile.\n2020-09-14 14:18:26 DEBUG [main] --- Found 1 root dependencies.\n2020-09-14 14:18:26 DEBUG [main] --- Finished processing.\n2020-09-14 14:18:26 DEBUG [main] --- Extraction completed successfully on lerna-semantic-release:9.1.0 at /workspace/lerna-semantic-release/packages/lerna-semantic-release.", "createdAt": "2020-09-14T18:35:08Z", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/226", "merged": true, "mergeCommit": {"oid": "6f742f3e00c8d7a3127868d304606ea3f05ec320"}, "closed": true, "closedAt": "2020-09-14T19:50:38Z", "author": {"login": "JakeMathews"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI3ZtCgH2gAyNDg2ODA1NjM3OjcyZjdjMzNlNmNlZTE2YTc1NTlmNjFlZWYyYjQ4YWJmMTIyOGIwNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI4mCyAH2gAyNDg2ODA1NjM3OmQ2MjE5MDZjNGEyYmZmYmJkMjBkOWZjNDBkNGFiZmYyN2UwZWY2MGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "72f7c33e6cee16a7559f61eef2b48abf1228b071", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/72f7c33e6cee16a7559f61eef2b48abf1228b071", "committedDate": "2020-09-14T18:21:29Z", "message": "fix(lerna): Lerna packages should no longer be reported as missing dependencies. (Fixes IDETECT-2108)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c93c45d06d8db7b658c0a91407feac3750b9df62", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/c93c45d06d8db7b658c0a91407feac3750b9df62", "committedDate": "2020-09-14T18:34:28Z", "message": "Merge branch 'master' into lerna-missing-packages\n\n# Conflicts:\n#\tdocs/templates/content/90-releasenotes.ftl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDUwMTI2", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/226#pullrequestreview-488050126", "createdAt": "2020-09-14T18:49:00Z", "commit": {"oid": "c93c45d06d8db7b658c0a91407feac3750b9df62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxODo0OTowMFrOHRiNfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxODo0OTowMFrOHRiNfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE0ODM1MQ==", "bodyText": "This is definitely not worth delaying the code freeze for, but the noun-like method names caught my eye. Then I saw that they are kinda used like objects (method references), but even so... since they're doing real work, I think I'd lean toward something more verb-like (say, handleMissingXxxDependency())", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/226#discussion_r488148351", "createdAt": "2020-09-14T18:49:00Z", "author": {"login": "stevebillings"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/lerna/LernaMissingDependencyHandler.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.synopsys.integration.detectable.detectables.lerna;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.slf4j.Logger;\n+\n+import com.synopsys.integration.bdio.graph.builder.LazyExternalIdDependencyGraphBuilder;\n+import com.synopsys.integration.bdio.model.Forge;\n+import com.synopsys.integration.bdio.model.dependencyid.DependencyId;\n+import com.synopsys.integration.bdio.model.externalid.ExternalId;\n+import com.synopsys.integration.bdio.model.externalid.ExternalIdFactory;\n+import com.synopsys.integration.detectable.detectables.lerna.model.LernaPackage;\n+import com.synopsys.integration.detectable.detectables.npm.lockfile.model.NpmRequires;\n+import com.synopsys.integration.detectable.detectables.npm.lockfile.parse.NpmLockfilePackager;\n+import com.synopsys.integration.detectable.detectables.yarn.parse.YarnTransformer;\n+\n+public class LernaMissingDependencyHandler {\n+    private final List<LernaPackage> lernaPackages;\n+\n+    public LernaMissingDependencyHandler(List<LernaPackage> lernaPackages) {\n+        this.lernaPackages = lernaPackages;\n+    }\n+\n+    public void missingNpmDependencyHandler(Logger logger, NpmRequires missingDependency) {\n+        boolean isLernaPackage = lernaPackages.stream()\n+                                     .anyMatch(lernaPackage -> lernaPackage.getName().equalsIgnoreCase(missingDependency.getName()));\n+        if (!isLernaPackage) {\n+            NpmLockfilePackager.handleMissingDependency(logger, missingDependency);\n+        }\n+    }\n+\n+    public ExternalId missingYarnDependencyHandler(Logger logger, ExternalIdFactory externalIdFactory, DependencyId dependencyId, LazyExternalIdDependencyGraphBuilder.LazyDependencyInfo lazyDependencyInfo, String yarnLockFilePath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c93c45d06d8db7b658c0a91407feac3750b9df62"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDUxMTkz", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/226#pullrequestreview-488051193", "createdAt": "2020-09-14T18:50:37Z", "commit": {"oid": "c93c45d06d8db7b658c0a91407feac3750b9df62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5d0ff271d6758630af3dfca9810839c2de75f1f", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/b5d0ff271d6758630af3dfca9810839c2de75f1f", "committedDate": "2020-09-14T19:04:38Z", "message": "refactor(lerna): Fixing noun-like method names."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d76538c5dbf275b38157beff52742d744775322e", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/d76538c5dbf275b38157beff52742d744775322e", "committedDate": "2020-09-14T19:34:37Z", "message": "test-fix(lerna): Removed unfinished test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10cdc7d6ad369c660829021291364409768e7698", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/10cdc7d6ad369c660829021291364409768e7698", "committedDate": "2020-09-14T19:44:32Z", "message": "test-fix(yarn): Adding missing dependency to YarnTransformerTest."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d621906c4a2bffbbd20d9fc40d4abff27e0ef60d", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/d621906c4a2bffbbd20d9fc40d4abff27e0ef60d", "committedDate": "2020-09-14T19:44:52Z", "message": "style(license): Updated license headers."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3369, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}