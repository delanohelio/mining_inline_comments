{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDE1NzM1", "number": 147, "title": "Git parse", "bodyText": "This fixes IDETECT-1883 where Detect was failing to parse git files while in buildless mode if the git repository was a detached head.\nThere is also heavy refactoring for maintainability.\nGitConfigElement was renamed to GitConfigNode.\nGitConfig was a layer added between GitConfigNode and GitConfigExtractor to provide a better API.", "createdAt": "2020-04-08T18:46:10Z", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/147", "merged": true, "mergeCommit": {"oid": "a29c0d95d9141d9637469fd19ae1f6cbad8273c5"}, "closed": true, "closedAt": "2020-04-10T16:10:54Z", "author": {"login": "JakeMathews"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVqfUngH2gAyNDAxMDE1NzM1OmFjZTViMjQxZmVlZmM3YjNiNWUzNTJlODI3NDIxM2UxY2E4NjYzMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWCKkNAFqTM5MTA5NDE0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ace5b241feefc7b3b5e352e8274213e1ca86632d", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/ace5b241feefc7b3b5e352e8274213e1ca86632d", "committedDate": "2020-04-08T16:28:43Z", "message": "fix(git-parse): The GitFileTransformer now supports parsing git repositories with a detached head. (Fixes IDETECT-1883)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13d86f275fff325d4bbbdbf1b1f82a41993316a0", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/13d86f275fff325d4bbbdbf1b1f82a41993316a0", "committedDate": "2020-04-08T18:23:43Z", "message": "refactor(git-parse): Heavy refactoring of Git parsing classes for maintainability."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjM5NTM0", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/147#pullrequestreview-390239534", "createdAt": "2020-04-08T18:46:50Z", "commit": {"oid": "13d86f275fff325d4bbbdbf1b1f82a41993316a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxODo0Njo1MFrOGC8V_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxODo0Njo1MFrOGC8V_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTczOTAwNg==", "bodyText": "Should this go in it's own class? It's only 22 lines and it only relevant to GitConfig which is why I added it here.", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/147#discussion_r405739006", "createdAt": "2020-04-08T18:46:50Z", "author": {"login": "JakeMathews"}, "path": "detectable/src/main/java/com/synopsys/integration/detectable/detectables/git/parsing/model/GitConfig.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package com.synopsys.integration.detectable.detectables.git.parsing.model;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+// A List<GitConfigNode> is a rough parsing result. This class provides a better API.\n+public class GitConfig {\n+    // Only including remote and branch nodes since the core node is not being used.\n+    private final List<GitConfigRemote> gitConfigRemotes;\n+    private final List<GitConfigBranch> gitConfigBranches;\n+\n+    public static GitConfig fromGitConfigNodes(final List<GitConfigNode> gitConfigNodes) {\n+        final List<GitConfigRemote> gitConfigRemotes = gitConfigNodes.stream()\n+                                                           .filter(node -> node.getType().equals(\"remote\"))\n+                                                           .map(node -> {\n+                                                               String remoteNodeName = node.getName().orElseThrow(() -> new IllegalArgumentException(\"Expected remote node to have a name.\"));\n+                                                               String remoteNodeUrl = node.getProperty(\"url\").orElseThrow(() -> new IllegalArgumentException(\"Expected remote node to have a url field.\"));\n+                                                               String remoteNodeFetch = node.getProperty(\"fetch\").orElseThrow(() -> new IllegalArgumentException(\"Expected remote node to have a fetch field.\"));\n+                                                               return new GitConfigRemote(remoteNodeName, remoteNodeUrl, remoteNodeFetch);\n+                                                           })\n+                                                           .collect(Collectors.toList());\n+\n+        final List<GitConfigBranch> gitConfigBranches = gitConfigNodes.stream()\n+                                                            .filter(node -> node.getType().equals(\"branch\"))\n+                                                            .map(node -> {\n+                                                                String remoteNodeName = node.getName().orElseThrow(() -> new IllegalArgumentException(\"Expected branch node to have a name.\"));\n+                                                                String remoteNodeRemote = node.getProperty(\"remote\").orElseThrow(() -> new IllegalArgumentException(\"Expected branch node to have a remote field.\"));\n+                                                                String remoteNodeMerge = node.getProperty(\"merge\").orElseThrow(() -> new IllegalArgumentException(\"Expected branch node to have a fetch field.\"));\n+                                                                return new GitConfigBranch(remoteNodeName, remoteNodeRemote, remoteNodeMerge);\n+                                                            })\n+                                                            .collect(Collectors.toList());\n+\n+        return new GitConfig(gitConfigRemotes, gitConfigBranches);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13d86f275fff325d4bbbdbf1b1f82a41993316a0"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77d050c0835dc07078e35ecdfbe6b5c1f10f59f", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/c77d050c0835dc07078e35ecdfbe6b5c1f10f59f", "committedDate": "2020-04-08T19:04:11Z", "message": "Merge branch 'master' into git-parse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a95b488f3777d7520811201c3da65d6fa80aea0", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/9a95b488f3777d7520811201c3da65d6fa80aea0", "committedDate": "2020-04-09T16:22:01Z", "message": "Merge branch 'master' into git-parse\n\n# Conflicts:\n#\tdocs/templates/content/90-releasenotes.ftl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56e38b3c082d78a4fb1e34aef9014ee5afe7f8f0", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/56e38b3c082d78a4fb1e34aef9014ee5afe7f8f0", "committedDate": "2020-04-09T16:57:26Z", "message": "refactor(git-parse): Moved GitConfigNode transformation to GitConfig to GitConfigNodeTransformer. Added license headers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4746805e7c79519edefeb12590aeaa48f4ad6e2b", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/synopsys-detect/commit/4746805e7c79519edefeb12590aeaa48f4ad6e2b", "committedDate": "2020-04-09T17:18:13Z", "message": "refactor(git-parse): Renamed GitConfigExtractor -> GitConfigNameVersionTransformer."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTg1Mjk5", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/147#pullrequestreview-390985299", "createdAt": "2020-04-09T17:20:15Z", "commit": {"oid": "4746805e7c79519edefeb12590aeaa48f4ad6e2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDk0MTQ5", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/147#pullrequestreview-391094149", "createdAt": "2020-04-09T20:03:46Z", "commit": {"oid": "4746805e7c79519edefeb12590aeaa48f4ad6e2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3296, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}