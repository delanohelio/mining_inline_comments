{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTk2NzY0", "number": 170, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0MToyNlrOD3QiEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo1NzozNVrOD3hEvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MjY5MTM2OnYy", "diffSide": "RIGHT", "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0MToyNlrOGNag4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0OTozMVrOGNa5KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA==", "bodyText": "This warning looks confusing \ud83d\ude15", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416719074", "createdAt": "2020-04-28T15:41:26Z", "author": {"login": "rohanKanojia"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "diffHunk": "@@ -114,7 +97,14 @@ public void executeInternal() throws MojoExecutionException {\n         } catch (Exception ex) {\n             throw new MojoExecutionException(\"An error has occurred while while trying to watch the resources\", ex);\n         }\n+    }\n \n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMjEzMA==", "bodyText": "Any suggestion to make thinks clearer for the user?\nWhat's basically happening is that a user is performing a k8s:watch against an Kubernetes (\ud83d\ude13) OpenShift Cluster.\nIs \"OpenShift cluster detected while using kubernetes-maven-plugin\", \"Switch to...\"  clearer?", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416722130", "createdAt": "2020-04-28T15:45:27Z", "author": {"login": "manusa"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "diffHunk": "@@ -114,7 +97,14 @@ public void executeInternal() throws MojoExecutionException {\n         } catch (Exception ex) {\n             throw new MojoExecutionException(\"An error has occurred while while trying to watch the resources\", ex);\n         }\n+    }\n \n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA=="}, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyNTI4OA==", "bodyText": "Yeah \ud83d\udc4d\nOpenShift cluster detected, using Kubernetes manifests.\nSwitch to openshift-maven-plugin in case there are any problems.", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416725288", "createdAt": "2020-04-28T15:49:31Z", "author": {"login": "rohanKanojia"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "diffHunk": "@@ -114,7 +97,14 @@ public void executeInternal() throws MojoExecutionException {\n         } catch (Exception ex) {\n             throw new MojoExecutionException(\"An error has occurred while while trying to watch the resources\", ex);\n         }\n+    }\n \n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA=="}, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MjcwODY4OnYy", "diffSide": "RIGHT", "path": "openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0NDo1NlrOGNarVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0NDo1NlrOGNarVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc0OQ==", "bodyText": "nit, s/possible/possibly", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416721749", "createdAt": "2020-04-28T15:44:56Z", "author": {"login": "rohanKanojia"}, "path": "openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java", "diffHunk": "@@ -27,8 +41,60 @@\n @Mojo(name = \"undeploy\", requiresDependencyResolution = ResolutionScope.COMPILE, defaultPhase = LifecyclePhase.INSTALL)\n public class OpenshiftUndeployMojo extends UndeployMojo {\n \n+    /**\n+     * The S2I binary builder BuildConfig name suffix appended to the image name to avoid\n+     * clashing with the underlying BuildConfig for the Jenkins pipeline\n+     */\n+    @Parameter(property = \"jkube.s2i.buildNameSuffix\", defaultValue = \"-s2i\")\n+    protected String s2iBuildNameSuffix;\n+\n+    /**\n+     * The generated openshift YAML file\n+     */\n+    @Parameter(property = \"jkube.openshiftManifest\", defaultValue = DEFAULT_OPENSHIFT_MANIFEST)\n+    private File openshiftManifest;\n+\n+    @Parameter(property = \"jkube.openshiftImageStreamManifest\", defaultValue = \"${basedir}/target/${project.artifactId}-is.yml\")\n+    private File openshiftImageStreamManifest;\n+\n+    @Override\n+    protected void applyEntities(KubernetesClient kubernetes, String namespace, String fileName, Set<HasMetadata> entities) throws Exception {\n+        super.applyEntities(kubernetes, namespace, fileName, entities);\n+        final Set<HasMetadata> openShiftEntities = Stream.concat(entities.stream(), getImageStreamManifest().stream())\n+            .collect(Collectors.toSet());\n+        deleteOpenShiftEntities(kubernetes, namespace, openShiftEntities, s2iBuildNameSuffix, log);\n+    }\n+\n+    @Override\n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            return openshiftManifest;\n+        }\n+        return super.getManifest(kubernetesClient);\n+    }\n+\n     @Override\n     protected String getLogPrefix() {\n-        return DEFAULT_LOG_PREFIX;\n+        return Openshift.DEFAULT_LOG_PREFIX;\n+    }\n+\n+    /**\n+     * Loads the ImageStream manifest that was possible created during the oc:build phase of an empty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NTQwMTU4OnYy", "diffSide": "RIGHT", "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo1NzozNVrOGNzu8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo1OTowNFrOGNzyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjI3NQ==", "bodyText": "Umm, any specific reason you are writing openshift-maven-client instead of openshift-maven-plugin ?? This warning would be displayed to user who might not be aware of kubernetes/openshift client being used internally", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r417132275", "createdAt": "2020-04-29T07:57:35Z", "author": {"login": "rohanKanojia"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Copyright (c) 2019 Red Hat, Inc.\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at:\n+ *\n+ *     https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Red Hat, Inc. - initial API and implementation\n+ */\n+package org.eclipse.jkube.maven.plugin.mojo;\n+\n+import java.io.File;\n+\n+import org.eclipse.jkube.kit.common.util.OpenshiftHelper;\n+\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+\n+public interface ManifestProvider extends KitLoggerProvider{\n+\n+  File getKubernetesManifest();\n+\n+  default File getManifest(KubernetesClient kubernetesClient) {\n+    if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+      getKitLogger().warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n+      getKitLogger().warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5171511ad59df5718b7d27230791538b360970"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMzExMg==", "bodyText": "\ud83d\ude33 It's a typo, I was really tired yesterday.", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r417133112", "createdAt": "2020-04-29T07:59:04Z", "author": {"login": "manusa"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Copyright (c) 2019 Red Hat, Inc.\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at:\n+ *\n+ *     https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Red Hat, Inc. - initial API and implementation\n+ */\n+package org.eclipse.jkube.maven.plugin.mojo;\n+\n+import java.io.File;\n+\n+import org.eclipse.jkube.kit.common.util.OpenshiftHelper;\n+\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+\n+public interface ManifestProvider extends KitLoggerProvider{\n+\n+  File getKubernetesManifest();\n+\n+  default File getManifest(KubernetesClient kubernetesClient) {\n+    if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+      getKitLogger().warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n+      getKitLogger().warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjI3NQ=="}, "originalCommit": {"oid": "2b5171511ad59df5718b7d27230791538b360970"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1933, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}