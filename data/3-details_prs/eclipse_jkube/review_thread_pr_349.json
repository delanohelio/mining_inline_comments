{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NDMxNDYw", "number": 349, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo1NDoyMlrOEZCHXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo1NDoyMlrOEZCHXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njg0NTExOnYy", "diffSide": "RIGHT", "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo1NDoyMlrOHBngrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMDo0ODowNVrOHCN69A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Nzk2Nw==", "bodyText": "Do we always the guarantee that the 0th container is the app container? I think we should add a validation here to keep this logic robust.\nPlease correct me if I'm wrong.", "url": "https://github.com/eclipse/jkube/pull/349#discussion_r471457967", "createdAt": "2020-08-17T12:54:22Z", "author": {"login": "dev-gaur"}, "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "diffHunk": "@@ -650,76 +650,115 @@ public static String mergePodSpec(PodSpecBuilder builder, PodSpec defaultPodSpec\n         int size = defaultContainers.size();\n         if (size > 0) {\n             if (containers == null || containers.isEmpty()) {\n+                defaultApplicationContainerName = defaultContainers.get(0).getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a2ac870e33e79e88027c0df03d9e3b247ff858a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ5MzcyOA==", "bodyText": "I think you have a point here. During zero-configuration mode, JKube adds only one container(that's why I assumed it would always work). But if you use XML configuration for ImageConfig, you can add as many containers as you wish and there is no way to specify which one is main application container.", "url": "https://github.com/eclipse/jkube/pull/349#discussion_r471493728", "createdAt": "2020-08-17T13:52:40Z", "author": {"login": "rohanKanojia"}, "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "diffHunk": "@@ -650,76 +650,115 @@ public static String mergePodSpec(PodSpecBuilder builder, PodSpec defaultPodSpec\n         int size = defaultContainers.size();\n         if (size > 0) {\n             if (containers == null || containers.isEmpty()) {\n+                defaultApplicationContainerName = defaultContainers.get(0).getName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Nzk2Nw=="}, "originalCommit": {"oid": "5a2ac870e33e79e88027c0df03d9e3b247ff858a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4Njg5MQ==", "bodyText": "exactly", "url": "https://github.com/eclipse/jkube/pull/349#discussion_r471586891", "createdAt": "2020-08-17T16:12:05Z", "author": {"login": "dev-gaur"}, "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "diffHunk": "@@ -650,76 +650,115 @@ public static String mergePodSpec(PodSpecBuilder builder, PodSpec defaultPodSpec\n         int size = defaultContainers.size();\n         if (size > 0) {\n             if (containers == null || containers.isEmpty()) {\n+                defaultApplicationContainerName = defaultContainers.get(0).getName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Nzk2Nw=="}, "originalCommit": {"oid": "5a2ac870e33e79e88027c0df03d9e3b247ff858a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyMjM4Nw==", "bodyText": "With all the code changes, I just realized that this diverges a lot from the initial proposed solution (I thought that code was only moved around).\nCould we stick to the initial plan (implement simple solution and add the the tests)? This class needs a deep refactor, but with the 1.0 release ahead, it's not the right time to do this.", "url": "https://github.com/eclipse/jkube/pull/349#discussion_r471922387", "createdAt": "2020-08-18T05:27:06Z", "author": {"login": "manusa"}, "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "diffHunk": "@@ -650,76 +650,115 @@ public static String mergePodSpec(PodSpecBuilder builder, PodSpec defaultPodSpec\n         int size = defaultContainers.size();\n         if (size > 0) {\n             if (containers == null || containers.isEmpty()) {\n+                defaultApplicationContainerName = defaultContainers.get(0).getName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Nzk2Nw=="}, "originalCommit": {"oid": "5a2ac870e33e79e88027c0df03d9e3b247ff858a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4NzI4NA==", "bodyText": "After a deeper review, the string returned by this function is absolutely useless and only used as a flag in:\n\n  \n    \n      jkube/jkube-kit/enricher/generic/src/main/java/org/eclipse/jkube/enricher/generic/ControllerViaPluginConfigurationEnricher.java\n    \n    \n        Lines 123 to 128\n      in\n      89f3649\n    \n    \n    \n    \n\n        \n          \n           public void visit(PodSpecBuilder builder) { \n        \n\n        \n          \n               String defaultApplicationContainerName = KubernetesResourceUtil.mergePodSpec(builder, podSpec, name, getValueFromConfig(SIDECAR, false)); \n        \n\n        \n          \n               if(defaultApplicationContainerName != null) { \n        \n\n        \n          \n                   setProcessingInstruction(NEED_IMAGECHANGE_TRIGGERS, Collections.singletonList(defaultApplicationContainerName)); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nIt doesn't really matter if the name is the one for the first container, the second, or anything else \"random\".\nWe really need to refactor all of the related methods after the 1.0.0 release", "url": "https://github.com/eclipse/jkube/pull/349#discussion_r472087284", "createdAt": "2020-08-18T10:48:05Z", "author": {"login": "manusa"}, "path": "jkube-kit/enricher/api/src/main/java/org/eclipse/jkube/kit/enricher/api/util/KubernetesResourceUtil.java", "diffHunk": "@@ -650,76 +650,115 @@ public static String mergePodSpec(PodSpecBuilder builder, PodSpec defaultPodSpec\n         int size = defaultContainers.size();\n         if (size > 0) {\n             if (containers == null || containers.isEmpty()) {\n+                defaultApplicationContainerName = defaultContainers.get(0).getName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Nzk2Nw=="}, "originalCommit": {"oid": "5a2ac870e33e79e88027c0df03d9e3b247ff858a"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1877, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}