{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTk2NzY0", "number": 170, "title": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin", "bodyText": "Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nWill create an additional PR with documentation and updated Changelog.\nRelates to: #101", "createdAt": "2020-04-28T15:34:26Z", "url": "https://github.com/eclipse/jkube/pull/170", "merged": true, "mergeCommit": {"oid": "2b3b31d8df4d52402a77e9929bd10ee14e636d59"}, "closed": true, "closedAt": "2020-04-29T09:56:21Z", "author": {"login": "manusa"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccFv0VgBqjMyODA5MjExMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccTzK7gBqjMyODM0MzQyOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f79faeb934f7ba4ded63c7ef5b789203224daaf", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/1f79faeb934f7ba4ded63c7ef5b789203224daaf", "committedDate": "2020-04-28T15:31:50Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}, "afterCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/627ad65b67b7df99f39ae022c946e049e561a873", "committedDate": "2020-04-28T15:37:26Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxOTY3MDcw", "url": "https://github.com/eclipse/jkube/pull/170#pullrequestreview-401967070", "createdAt": "2020-04-28T15:41:26Z", "commit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0MToyNlrOGNag4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0MToyNlrOGNag4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA==", "bodyText": "This warning looks confusing \ud83d\ude15", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416719074", "createdAt": "2020-04-28T15:41:26Z", "author": {"login": "rohanKanojia"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "diffHunk": "@@ -114,7 +97,14 @@ public void executeInternal() throws MojoExecutionException {\n         } catch (Exception ex) {\n             throw new MojoExecutionException(\"An error has occurred while while trying to watch the resources\", ex);\n         }\n+    }\n \n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxOTcwNDQ4", "url": "https://github.com/eclipse/jkube/pull/170#pullrequestreview-401970448", "createdAt": "2020-04-28T15:44:56Z", "commit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0NDo1NlrOGNarVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTo0NDo1NlrOGNarVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc0OQ==", "bodyText": "nit, s/possible/possibly", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416721749", "createdAt": "2020-04-28T15:44:56Z", "author": {"login": "rohanKanojia"}, "path": "openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java", "diffHunk": "@@ -27,8 +41,60 @@\n @Mojo(name = \"undeploy\", requiresDependencyResolution = ResolutionScope.COMPILE, defaultPhase = LifecyclePhase.INSTALL)\n public class OpenshiftUndeployMojo extends UndeployMojo {\n \n+    /**\n+     * The S2I binary builder BuildConfig name suffix appended to the image name to avoid\n+     * clashing with the underlying BuildConfig for the Jenkins pipeline\n+     */\n+    @Parameter(property = \"jkube.s2i.buildNameSuffix\", defaultValue = \"-s2i\")\n+    protected String s2iBuildNameSuffix;\n+\n+    /**\n+     * The generated openshift YAML file\n+     */\n+    @Parameter(property = \"jkube.openshiftManifest\", defaultValue = DEFAULT_OPENSHIFT_MANIFEST)\n+    private File openshiftManifest;\n+\n+    @Parameter(property = \"jkube.openshiftImageStreamManifest\", defaultValue = \"${basedir}/target/${project.artifactId}-is.yml\")\n+    private File openshiftImageStreamManifest;\n+\n+    @Override\n+    protected void applyEntities(KubernetesClient kubernetes, String namespace, String fileName, Set<HasMetadata> entities) throws Exception {\n+        super.applyEntities(kubernetes, namespace, fileName, entities);\n+        final Set<HasMetadata> openShiftEntities = Stream.concat(entities.stream(), getImageStreamManifest().stream())\n+            .collect(Collectors.toSet());\n+        deleteOpenShiftEntities(kubernetes, namespace, openShiftEntities, s2iBuildNameSuffix, log);\n+    }\n+\n+    @Override\n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            return openshiftManifest;\n+        }\n+        return super.getManifest(kubernetesClient);\n+    }\n+\n     @Override\n     protected String getLogPrefix() {\n-        return DEFAULT_LOG_PREFIX;\n+        return Openshift.DEFAULT_LOG_PREFIX;\n+    }\n+\n+    /**\n+     * Loads the ImageStream manifest that was possible created during the oc:build phase of an empty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873"}, "originalPosition": 70}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "627ad65b67b7df99f39ae022c946e049e561a873", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/627ad65b67b7df99f39ae022c946e049e561a873", "committedDate": "2020-04-28T15:37:26Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}, "afterCommit": {"oid": "a4a5107e8661128e13a2e10ad95f77c76532c183", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/a4a5107e8661128e13a2e10ad95f77c76532c183", "committedDate": "2020-04-28T15:52:33Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4a5107e8661128e13a2e10ad95f77c76532c183", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/a4a5107e8661128e13a2e10ad95f77c76532c183", "committedDate": "2020-04-28T15:52:33Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}, "afterCommit": {"oid": "db42762e4682fdd2a24b7cbef80278fa1302e08a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/db42762e4682fdd2a24b7cbef80278fa1302e08a", "committedDate": "2020-04-29T05:36:33Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db42762e4682fdd2a24b7cbef80278fa1302e08a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/db42762e4682fdd2a24b7cbef80278fa1302e08a", "committedDate": "2020-04-29T05:36:33Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}, "afterCommit": {"oid": "2b5171511ad59df5718b7d27230791538b360970", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/2b5171511ad59df5718b7d27230791538b360970", "committedDate": "2020-04-29T07:55:04Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNDM5MDcy", "url": "https://github.com/eclipse/jkube/pull/170#pullrequestreview-402439072", "createdAt": "2020-04-29T07:57:35Z", "commit": {"oid": "2b5171511ad59df5718b7d27230791538b360970"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo1NzozNVrOGNzu8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNzo1NzozNVrOGNzu8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjI3NQ==", "bodyText": "Umm, any specific reason you are writing openshift-maven-client instead of openshift-maven-plugin ?? This warning would be displayed to user who might not be aware of kubernetes/openshift client being used internally", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r417132275", "createdAt": "2020-04-29T07:57:35Z", "author": {"login": "rohanKanojia"}, "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Copyright (c) 2019 Red Hat, Inc.\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at:\n+ *\n+ *     https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Red Hat, Inc. - initial API and implementation\n+ */\n+package org.eclipse.jkube.maven.plugin.mojo;\n+\n+import java.io.File;\n+\n+import org.eclipse.jkube.kit.common.util.OpenshiftHelper;\n+\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+\n+public interface ManifestProvider extends KitLoggerProvider{\n+\n+  File getKubernetesManifest();\n+\n+  default File getManifest(KubernetesClient kubernetesClient) {\n+    if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+      getKitLogger().warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n+      getKitLogger().warn(\"Switch to openshift-maven-client in case there are any problems\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5171511ad59df5718b7d27230791538b360970"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "774b4248a62691f53f9d57a625e8b35017b15f84", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/774b4248a62691f53f9d57a625e8b35017b15f84", "committedDate": "2020-04-29T07:59:44Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b5171511ad59df5718b7d27230791538b360970", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/2b5171511ad59df5718b7d27230791538b360970", "committedDate": "2020-04-29T07:55:04Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}, "afterCommit": {"oid": "774b4248a62691f53f9d57a625e8b35017b15f84", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/eclipse/jkube/commit/774b4248a62691f53f9d57a625e8b35017b15f84", "committedDate": "2020-04-29T07:59:44Z", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 262, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}