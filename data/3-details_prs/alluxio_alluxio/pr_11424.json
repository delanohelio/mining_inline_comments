{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2OTg2MDk3", "number": 11424, "title": "Add bootstrap build scripts to tweak bootstrap files", "bodyText": "build.sh will have logic to make custom changes to bootstrap files. For starters, the alluxio download url can be replaced", "createdAt": "2020-05-12T21:42:04Z", "url": "https://github.com/Alluxio/alluxio/pull/11424", "merged": true, "mergeCommit": {"oid": "9f7f04cae24220bfd0655ebdee4130ff473eb72f"}, "closed": true, "closedAt": "2020-05-13T02:29:33Z", "author": {"login": "tieujason330"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgrVH9gH2gAyNDE2OTg2MDk3OmQyNWVmNDk5NGNlZjZjM2I3OTM3NzJhNjY3N2EyMmM1ZjBmOGNhYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgugLFAH2gAyNDE2OTg2MDk3Ojk1YTAzZmYxYzdmMjk5MjdjZWIzODVlYmJmODgxZDVhOTdhYmM0YTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d25ef4994cef6c3b793772a6677a22c5f0f8cab4", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/d25ef4994cef6c3b793772a6677a22c5f0f8cab4", "committedDate": "2020-05-12T21:40:39Z", "message": "Add bootstrap build scripts to tweak bootstrap files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/02950631b0d191f5cc917376946e9b188536eab5", "committedDate": "2020-05-12T21:59:15Z", "message": "different os types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDY3Njk4", "url": "https://github.com/Alluxio/alluxio/pull/11424#pullrequestreview-410467698", "createdAt": "2020-05-12T22:29:13Z", "commit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDY4OTE1", "url": "https://github.com/Alluxio/alluxio/pull/11424#pullrequestreview-410468915", "createdAt": "2020-05-12T22:31:59Z", "commit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjozMTo1OVrOGUbQgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjozMTo1OVrOGUbQgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw==", "bodyText": "if the file is updated in the future in a way that results in this sed operation doing zero replacements, is there a way to detect and trigger failure? trying to avoid the scenario where things get refactored and silently fail", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424071297", "createdAt": "2020-05-12T22:31:59Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c4c25b8d7a4d05336ead4e9666b56934fa0367", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/82c4c25b8d7a4d05336ead4e9666b56934fa0367", "committedDate": "2020-05-12T23:20:59Z", "message": "create .generated dir with file copies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a0c7ca789995909face999f2103a09e74a47996", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/6a0c7ca789995909face999f2103a09e74a47996", "committedDate": "2020-05-12T23:21:31Z", "message": "eof newlines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "870f041dc6dca288ce1adf2e50a51cdb2d2fab7b", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/870f041dc6dca288ce1adf2e50a51cdb2d2fab7b", "committedDate": "2020-05-13T00:06:50Z", "message": "diff check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/d517eb54b7312ee4a852699c4cb6fd2b5c228aa5", "committedDate": "2020-05-13T00:22:44Z", "message": "change to grep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTEzNTc1", "url": "https://github.com/Alluxio/alluxio/pull/11424#pullrequestreview-410513575", "createdAt": "2020-05-13T00:39:54Z", "commit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDozOTo1NFrOGUdp7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDozOTo1NFrOGUdp7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMDU3NA==", "bodyText": "this doesn't account for the \"fail to find the string to replace\" scenario\nif i were refactoring the script and renamed ALLUXIO_DOWNLOAD_URL to ALLUXIO_DOWNLOAD_S3_URL, this script would not replace anything but pass.\nif alluxio download url is set {\n  if string to be replaced by (ex. readonly ALLUXIO_DOWNLOAD_URL=.*) isn't found by grep -> fail\n  replace string with perl cmd\n}\n\nit's fine to replace the same string; that's not much of a concern. i brought up the scenario as a counterexample to why using diff wouldn't be as dependable as using grep", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424110574", "createdAt": "2020-05-13T00:39:54Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTE0Mjk5", "url": "https://github.com/Alluxio/alluxio/pull/11424#pullrequestreview-410514299", "createdAt": "2020-05-13T00:42:23Z", "commit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDo0MjoyNFrOGUdseg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDo0MjoyNFrOGUdseg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMTIyNg==", "bodyText": "alluxio-emr.sh -> alluxio.sh\nprobably more convenient to make this a bash variable", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424111226", "createdAt": "2020-05-13T00:42:24Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then\n+    echo \"ERROR: ${ALLUXIO_DOWNLOAD_URL} is already set. No change was made to alluxio-emr.sh\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88798b081823729cb275cd85746a1cc6b1ae8294", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/88798b081823729cb275cd85746a1cc6b1ae8294", "committedDate": "2020-05-13T01:15:35Z", "message": "fix grep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTI0Mzkz", "url": "https://github.com/Alluxio/alluxio/pull/11424#pullrequestreview-410524393", "createdAt": "2020-05-13T01:16:48Z", "commit": {"oid": "88798b081823729cb275cd85746a1cc6b1ae8294"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95a03ff1c7f29927ceb385ebbf881d5a97abc4a9", "author": {"user": {"login": "tieujason330", "name": "Jason Tieu"}}, "url": "https://github.com/Alluxio/alluxio/commit/95a03ff1c7f29927ceb385ebbf881d5a97abc4a9", "committedDate": "2020-05-13T01:22:26Z", "message": "var cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4632, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}