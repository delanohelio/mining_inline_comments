{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMjIyMTY4", "number": 12081, "title": "Fix active sync manager error on secondary master", "bodyText": "There has been errors when an active sync enabled secondary master get promoted to primary. It is caused by active sync manager trying to access UFS when master is in secondary mode. UFS client are not initialized for mount points on secondary master so error occurs when active sync manager accesses it during snapshotting and server stopping process.\nThis fix updated active sync manager to avoid unnecessary access to UFS client on a secondary master.", "createdAt": "2020-09-08T18:28:57Z", "url": "https://github.com/Alluxio/alluxio/pull/12081", "merged": true, "mergeCommit": {"oid": "ded47c804cae139104278246e8a9e3a69614c1b6"}, "closed": true, "closedAt": "2020-09-09T17:44:42Z", "author": {"login": "bf8086"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFqNwtAH2gAyNDgyMjIyMTY4OjFiOWM0M2I4Y2NlZmFlMWFmMGNmN2M5ZGE2OWU4NmUyMWU1NmJkNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHOiRygFqTQ4NTE4MDU5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "committedDate": "2020-09-04T19:17:54Z", "message": "Fix active sync manager error on secondary master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDU5MzA5", "url": "https://github.com/Alluxio/alluxio/pull/12081#pullrequestreview-484459309", "createdAt": "2020-09-08T20:11:42Z", "commit": {"oid": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDoxMTo0MlrOHOsZAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDoxMjoyNVrOHOsaXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTQxMA==", "bodyText": "Where is this set to false?", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485169410", "createdAt": "2020-09-08T20:11:42Z", "author": {"login": "gpang"}, "path": "core/server/master/src/main/java/alluxio/master/file/activesync/ActiveSyncManager.java", "diffHunk": "@@ -164,6 +166,7 @@ public boolean isUnderSyncPoint(AlluxioURI path) {\n    * Start the polling threads.\n    */\n   public void start() throws IOException {\n+    mStarted = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTc1Nw==", "bodyText": "What is the difference from before? How does the new code avoid UFS access?", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485169757", "createdAt": "2020-09-08T20:12:25Z", "author": {"login": "gpang"}, "path": "core/server/master/src/main/java/alluxio/master/file/activesync/ActiveSyncManager.java", "diffHunk": "@@ -428,8 +431,9 @@ public boolean hasNext() {\n         while (mountId == -1) {\n           try {\n             syncPointPath = mEntry.getPath();\n-            MountTable.Resolution resolution = mMountTable.resolve(mEntry);\n-            mountId = resolution.getMountId();\n+            String mountPoint = mMountTable.getMountPoint(mEntry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "800dee27239c0cd073c7b4443f54184f1e122ac5", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/800dee27239c0cd073c7b4443f54184f1e122ac5", "committedDate": "2020-09-08T23:46:35Z", "message": "Fix state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTY4MDYy", "url": "https://github.com/Alluxio/alluxio/pull/12081#pullrequestreview-484568062", "createdAt": "2020-09-08T23:53:38Z", "commit": {"oid": "800dee27239c0cd073c7b4443f54184f1e122ac5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTgwNTkw", "url": "https://github.com/Alluxio/alluxio/pull/12081#pullrequestreview-485180590", "createdAt": "2020-09-09T16:10:49Z", "commit": {"oid": "800dee27239c0cd073c7b4443f54184f1e122ac5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3665, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}