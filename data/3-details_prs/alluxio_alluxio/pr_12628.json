{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3MzYyNTEy", "number": 12628, "title": "Add support for handling 'remove_table' journal entry", "bodyText": "The PR aims to fix the bug that when Alluxio master is restarted, it fails to recognize the remove_table journal entry during journal replaying, and stuck there forever.\nFixes #12627", "createdAt": "2020-12-11T20:21:56Z", "url": "https://github.com/Alluxio/alluxio/pull/12628", "merged": true, "mergeCommit": {"oid": "5b95dcd3fa435d6747d286ad2e57db6df40db10a"}, "closed": true, "closedAt": "2020-12-15T17:58:53Z", "author": {"login": "hycsam"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlNqIWgH2gAyNTM3MzYyNTEyOjUxN2ZhYzNlMTMxN2Q1ZGMzNWExNGU1NTRiOWRjODllZjMwYzAzMGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmeNSCgFqTU1MjcyMzA3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "517fac3e1317d5dc35a14e554b9dc89ef30c030a", "author": {"user": {"login": "hycsam", "name": "hycsam"}}, "url": "https://github.com/Alluxio/alluxio/commit/517fac3e1317d5dc35a14e554b9dc89ef30c030a", "committedDate": "2020-12-11T20:07:13Z", "message": "Add support for handling 'remove_table' journal entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjAyNzg3", "url": "https://github.com/Alluxio/alluxio/pull/12628#pullrequestreview-550602787", "createdAt": "2020-12-11T21:54:05Z", "commit": {"oid": "517fac3e1317d5dc35a14e554b9dc89ef30c030a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjA1Njg2", "url": "https://github.com/Alluxio/alluxio/pull/12628#pullrequestreview-550605686", "createdAt": "2020-12-11T21:59:42Z", "commit": {"oid": "517fac3e1317d5dc35a14e554b9dc89ef30c030a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49", "author": {"user": {"login": "hycsam", "name": "hycsam"}}, "url": "https://github.com/Alluxio/alluxio/commit/f0639144efe56cc6137a0c6cc47ed1730ffafa49", "committedDate": "2020-12-14T08:28:11Z", "message": "Add drop table operation to involve remove_table journal entry in the journal sync test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDgyMDIw", "url": "https://github.com/Alluxio/alluxio/pull/12628#pullrequestreview-552082020", "createdAt": "2020-12-15T03:40:11Z", "commit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzo0MDoxMVrOIF3baw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMzo0MDoxMVrOIF3baw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyMTkzMQ==", "bodyText": "This line resyncs the database.. that's why the test is passing without your change. @hycsam", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543021931", "createdAt": "2020-12-15T03:40:11Z", "author": {"login": "yuzhu"}, "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -117,7 +122,7 @@ public void journalSync() throws Exception {\n     checkDb(tableMasterRestart, DB_NAME, oldInfo);\n     tableMasterRestart.syncDatabase(DB_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDkwODQy", "url": "https://github.com/Alluxio/alluxio/pull/12628#pullrequestreview-552090842", "createdAt": "2020-12-15T04:08:24Z", "commit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDowODoyNFrOIF3-EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNDowODoyNFrOIF3-EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ==", "bodyText": "@yuzhu I was expecting the old code to throw an exception (Unrecognized journal entry something) during restart, which doesn't happen. Does it run asynchronously?", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543030801", "createdAt": "2020-12-15T04:08:24Z", "author": {"login": "hycsam"}, "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -109,6 +109,11 @@ public void journalSync() throws Exception {\n     tableMaster.syncDatabase(DB_NAME);\n     checkTable(tableMaster, DB_NAME, 2, 3);\n \n+    // Drop a table to create a 'remove_table' entry\n+    genTable(1, 3, true);\n+    tableMaster.syncDatabase(DB_NAME);\n+    checkTable(tableMaster, DB_NAME, 1, 3);\n+\n     restartMaster();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzIzMDcy", "url": "https://github.com/Alluxio/alluxio/pull/12628#pullrequestreview-552723072", "createdAt": "2020-12-15T17:57:46Z", "commit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNzo1Nzo0NlrOIGYeRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNzo1Nzo0NlrOIGYeRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2MzMzMg==", "bodyText": "Yeah, that is strange. I don't know why that error doesn't fail the test. In any case, we can change that part of it in a different PR.", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543563332", "createdAt": "2020-12-15T17:57:46Z", "author": {"login": "gpang"}, "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -109,6 +109,11 @@ public void journalSync() throws Exception {\n     tableMaster.syncDatabase(DB_NAME);\n     checkTable(tableMaster, DB_NAME, 2, 3);\n \n+    // Drop a table to create a 'remove_table' entry\n+    genTable(1, 3, true);\n+    tableMaster.syncDatabase(DB_NAME);\n+    checkTable(tableMaster, DB_NAME, 1, 3);\n+\n     restartMaster();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ=="}, "originalCommit": {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3339, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}