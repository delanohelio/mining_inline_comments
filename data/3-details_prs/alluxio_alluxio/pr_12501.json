{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMzcxNDQy", "number": 12501, "title": "Add UFS version validation task", "bodyText": "This new task helps expose some more information about available UFS versions to users. The cases for configuration and corresponding outputs are defined below.\n\nUFS version not configured: skip validation\nUFS version configured, but doesn't exist in list of valid versions: error with info and list of available versions\nUFS version configured, but list of versions empty: this indicates the UFS doesn't support versioning (i.e. non-HDFS), and directs the user to change configuration\nUFS version configured and exists in available version list: success", "createdAt": "2020-11-13T06:08:10Z", "url": "https://github.com/Alluxio/alluxio/pull/12501", "merged": true, "mergeCommit": {"oid": "53137d066139604c3871752ec041a4a1fa0bbf41"}, "closed": true, "closedAt": "2020-11-13T18:19:02Z", "author": {"login": "ZacBlanco"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcA044gH2gAyNTIwMzcxNDQyOmMxZTU0NTdmNmE3MGYwMjk4NDIwMjA4OTgyMWFjNTM3MTA0MTgxNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcLRNWAFqTUzMDI5NzgyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c1e5457f6a70f02984202089821ac53710418162", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/c1e5457f6a70f02984202089821ac53710418162", "committedDate": "2020-11-13T06:04:53Z", "message": "Add UFS version validation task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9abc89fedb8a4b16937717cdfc952f838da10348", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/9abc89fedb8a4b16937717cdfc952f838da10348", "committedDate": "2020-11-13T06:34:13Z", "message": "add license"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTAyNzk0", "url": "https://github.com/Alluxio/alluxio/pull/12501#pullrequestreview-530102794", "createdAt": "2020-11-13T14:24:50Z", "commit": {"oid": "c1e5457f6a70f02984202089821ac53710418162"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDoyNDo1MVrOHywRkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDoyNDo1MVrOHywRkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk4MTc3Nw==", "bodyText": "Do you think it's possible there's a case where the user should have configured the UNDERFS_VERSION but did not?", "url": "https://github.com/Alluxio/alluxio/pull/12501#discussion_r522981777", "createdAt": "2020-11-13T14:24:51Z", "author": {"login": "jiacheliu3"}, "path": "integration/tools/validation/src/main/java/alluxio/cli/UfsVersionValidationTask.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package alluxio.cli;\n+\n+import alluxio.conf.AlluxioConfiguration;\n+import alluxio.conf.PropertyKey;\n+import alluxio.underfs.UnderFileSystemConfiguration;\n+import alluxio.underfs.UnderFileSystemFactoryRegistry;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This validates the UFS configuration for a users configured UFS path. It ensures that the\n+ * version of the UFS library is available (if configured).\n+ */\n+@ApplicableUfsType(ApplicableUfsType.Type.ALL)\n+public class UfsVersionValidationTask extends AbstractValidationTask {\n+\n+  private final String mUfsPath;\n+  private final AlluxioConfiguration mConf;\n+\n+    /**\n+     * Create a new instance of {@link UfsVersionValidationTask}.\n+     *\n+     * @param ufsPath the UFS URI to test\n+     * @param ufsConf the configuration for the UFS URI\n+     */\n+  public UfsVersionValidationTask(String ufsPath, AlluxioConfiguration ufsConf) {\n+    mUfsPath = ufsPath;\n+    mConf = ufsConf;\n+  }\n+\n+  @Override\n+  protected ValidationTaskResult validateImpl(Map<String, String> optionMap) {\n+    UnderFileSystemConfiguration ufsConf =\n+          UnderFileSystemConfiguration.defaults(mConf).createMountSpecificConf(optionMap);\n+    String configuredVersion = mConf.get(PropertyKey.UNDERFS_VERSION);\n+    List<String> availableVersions =\n+        UnderFileSystemFactoryRegistry.getSupportedVersions(mUfsPath, ufsConf);\n+    ValidationTaskResult result = new ValidationTaskResult();\n+    result.setName(getName());\n+    result.setDesc(\"Validates that the configured UFS version exists as a library on the \"\n+        + \"system.\");\n+\n+    if (!mConf.isSetByUser(PropertyKey.UNDERFS_VERSION)) {\n+      result.setState(ValidationUtils.State.SKIPPED);\n+      result.setOutput(\"The UFS version was not configured by the user.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1e5457f6a70f02984202089821ac53710418162"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjc3MDIx", "url": "https://github.com/Alluxio/alluxio/pull/12501#pullrequestreview-530277021", "createdAt": "2020-11-13T17:45:33Z", "commit": {"oid": "9abc89fedb8a4b16937717cdfc952f838da10348"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjk3ODIx", "url": "https://github.com/Alluxio/alluxio/pull/12501#pullrequestreview-530297821", "createdAt": "2020-11-13T18:14:52Z", "commit": {"oid": "9abc89fedb8a4b16937717cdfc952f838da10348"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3439, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}