{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MjI5NDY2", "number": 12383, "title": "Fix memory leak in inode tree iterator", "bodyText": "Currently when a user iterate through the inode tree journal entries, a few threads are created to iterate through different directories. The threads will be closed when the iteration completes, but if an iteration is not fully completed, then the threads are leaked and never get properly shutdown.\nThis change modifies the JournalEntryIterable interface to return a closeable iterator of the journal entries, so the user of the iterator can explicitly shutdown the threads by calling the close() method or using the try-with-resource pattern.\nThe majority of the logic are in InodeTreeBufferedIterator class and CloseableIterator class.", "createdAt": "2020-10-23T21:40:02Z", "url": "https://github.com/Alluxio/alluxio/pull/12383", "merged": true, "mergeCommit": {"oid": "58c24eb80baca6c2f4efbb9fb7349fd80c1d3c0a"}, "closed": true, "closedAt": "2020-10-24T00:27:44Z", "author": {"login": "bf8086"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVdaiugH2gAyNTA5MjI5NDY2OjRmZmIzM2EzZWQ4YmEzODgxMGFlMmJkZjMxNTk4MjFhMzM3NDM0ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVehfvgFqTUxNjA0NzQwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/4ffb33a3ed8ba38810ae2bdf3159821a33743486", "committedDate": "2020-10-23T21:25:53Z", "message": "Fix memory leak in inode tree iterator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDQyMzQz", "url": "https://github.com/Alluxio/alluxio/pull/12383#pullrequestreview-516042343", "createdAt": "2020-10-23T22:26:28Z", "commit": {"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMjoyNjoyOFrOHngCJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMjoyNzozNlrOHngDWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTM0OQ==", "bodyText": "is this the correct order to shut them down?", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511181349", "createdAt": "2020-10-23T22:26:28Z", "author": {"login": "gpang"}, "path": "core/server/master/src/main/java/alluxio/master/file/meta/InodeTreeBufferedIterator.java", "diffHunk": "@@ -302,4 +319,11 @@ public boolean hasNext() {\n   public void remove() {\n     throw new UnsupportedOperationException(\"remove is not supported in inode tree iterator\");\n   }\n+\n+  @Override\n+  public void close() {\n+    LOG.debug(\"Closing {} inode tree iterators\", mActiveCrawlers.size());\n+    mCoordinatorExecutor.shutdownNow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTY1OA==", "bodyText": "Is this the only iterator that implements close() right now?", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511181658", "createdAt": "2020-10-23T22:27:36Z", "author": {"login": "gpang"}, "path": "core/server/master/src/main/java/alluxio/master/file/meta/InodeTreeBufferedIterator.java", "diffHunk": "@@ -44,12 +46,13 @@\n  * makes applying those entries later more efficient by guaranteeing that a parent of an inode is\n  * iterated before it.\n  */\n-public class InodeTreeBufferedIterator implements Iterator<Journal.JournalEntry> {\n+public class InodeTreeBufferedIterator implements Iterator<Journal.JournalEntry>, Closeable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDQ3NDA2", "url": "https://github.com/Alluxio/alluxio/pull/12383#pullrequestreview-516047406", "createdAt": "2020-10-23T22:43:23Z", "commit": {"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3484, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}