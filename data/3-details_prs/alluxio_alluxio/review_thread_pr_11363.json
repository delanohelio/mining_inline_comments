{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5OTI1ODc5", "number": 11363, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzo0Mzo0N1rOD4JLKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzo0Mzo0N1rOD4JLKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTk3MTYxOnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzo0Mzo0N1rOGOzxVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMDozODozOVrOGO5e8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MTQ2Mw==", "bodyText": "Can this also throw concurrent modification exception?", "url": "https://github.com/Alluxio/alluxio/pull/11363#discussion_r418181463", "createdAt": "2020-04-30T17:43:47Z", "author": {"login": "calvinjia"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -413,7 +413,12 @@ public static void reloadProperties() {\n       // property file.\n       AlluxioProperties properties = new AlluxioProperties();\n       InstancedConfiguration conf = new InstancedConfiguration(properties);\n-      properties.merge(System.getProperties(), Source.SYSTEM_PROPERTY);\n+      // Can't directly pass System.getProperties() because it is not thread-safe\n+      // This can cause a ConcurrentModificationException when merging.\n+      Properties sysProps = new Properties();\n+      System.getProperties().stringPropertyNames()\n+          .forEach(key -> sysProps.setProperty(key, System.getProperty(key)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa1e1c93e4942e2f9da4326c37a4da046d2d7dd"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4OTI2Mg==", "bodyText": "No, The set returned from stringPropertyNames is a copy of the keys at the time of calling:\nFrom: https://docs.oracle.com/javase/8/docs/api/java/util/Properties.html#stringPropertyNames--\n\nThe returned set is not backed by the Properties object. Changes to this Properties are not reflected in the set, or vice versa.\n\nhttps://hg.openjdk.java.net/jdk8u/jdk8u/jdk/file/f54e9b7c1036/src/share/classes/java/util/Properties.java#l1030", "url": "https://github.com/Alluxio/alluxio/pull/11363#discussion_r418189262", "createdAt": "2020-04-30T17:56:56Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -413,7 +413,12 @@ public static void reloadProperties() {\n       // property file.\n       AlluxioProperties properties = new AlluxioProperties();\n       InstancedConfiguration conf = new InstancedConfiguration(properties);\n-      properties.merge(System.getProperties(), Source.SYSTEM_PROPERTY);\n+      // Can't directly pass System.getProperties() because it is not thread-safe\n+      // This can cause a ConcurrentModificationException when merging.\n+      Properties sysProps = new Properties();\n+      System.getProperties().stringPropertyNames()\n+          .forEach(key -> sysProps.setProperty(key, System.getProperty(key)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MTQ2Mw=="}, "originalCommit": {"oid": "9aa1e1c93e4942e2f9da4326c37a4da046d2d7dd"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMzY3Mw==", "bodyText": "The implementation of stringPropertyNames uses an enumerator on the keys?", "url": "https://github.com/Alluxio/alluxio/pull/11363#discussion_r418223673", "createdAt": "2020-04-30T18:58:50Z", "author": {"login": "calvinjia"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -413,7 +413,12 @@ public static void reloadProperties() {\n       // property file.\n       AlluxioProperties properties = new AlluxioProperties();\n       InstancedConfiguration conf = new InstancedConfiguration(properties);\n-      properties.merge(System.getProperties(), Source.SYSTEM_PROPERTY);\n+      // Can't directly pass System.getProperties() because it is not thread-safe\n+      // This can cause a ConcurrentModificationException when merging.\n+      Properties sysProps = new Properties();\n+      System.getProperties().stringPropertyNames()\n+          .forEach(key -> sysProps.setProperty(key, System.getProperty(key)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MTQ2Mw=="}, "originalCommit": {"oid": "9aa1e1c93e4942e2f9da4326c37a4da046d2d7dd"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI3NTA1OA==", "bodyText": "The enumerator is safe against ConcurrentModificationException. Calling stringPropertyNames loops over the keys() method of the Hashtable\n\nkeys() is implemented via an internal Enumeration object\n\nIterating over all of the keys with the Enumerator is safe against ConcurrentModificationException so long as remove() and next() isn't called. Neither are called because the Properties implementation uses nextElement() rather than next()", "url": "https://github.com/Alluxio/alluxio/pull/11363#discussion_r418275058", "createdAt": "2020-04-30T20:38:39Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -413,7 +413,12 @@ public static void reloadProperties() {\n       // property file.\n       AlluxioProperties properties = new AlluxioProperties();\n       InstancedConfiguration conf = new InstancedConfiguration(properties);\n-      properties.merge(System.getProperties(), Source.SYSTEM_PROPERTY);\n+      // Can't directly pass System.getProperties() because it is not thread-safe\n+      // This can cause a ConcurrentModificationException when merging.\n+      Properties sysProps = new Properties();\n+      System.getProperties().stringPropertyNames()\n+          .forEach(key -> sysProps.setProperty(key, System.getProperty(key)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MTQ2Mw=="}, "originalCommit": {"oid": "9aa1e1c93e4942e2f9da4326c37a4da046d2d7dd"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1683, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}