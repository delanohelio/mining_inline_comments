{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODU5ODg5", "number": 11598, "title": "Fix bug in meta cache in MetadataCachingBaseFileSystem", "bodyText": "Fix #11765\nDescription:\nmeta data may be deleted in client cache although it is very hot.\nNow MetadataCache holds mStatus which stores the current file/dir status and mDirStatuses which stores the children status.\n  private class CachedItem {\n    private final URIStatus mStatus;\n    private final List<URIStatus> mDirStatuses;\n\n\nFor example, There is a path '/A/B/C'.\nWe run the listStatus request on the directory '/A/B'. After receiving result from alluxio master, it caches 'A/B' into the cache map which stores the children status for the path '/A/B' as mDirStatuses and its children '/A/B/C' into the cach map which stores the file/dir status as mStatus.\nThen we run the listStatus request on the directory '/A'. After receiving result from alluxio master, it caches '/A' into the cache map which stores the children status for the path '/A' as mDirStatuses  and its children '/A/B' into the cach map which stores the file/dir status as mStatus. It replaces the previous content with a new CachedItem for '/A/B'.\n\npublic void put(AlluxioURI dir, List<URIStatus> statuses) {\n    mCache.put(dir.getPath(), new CachedItem(statuses));\n    for (URIStatus status : statuses) {\n      mCache.put(status.getPath(), new CachedItem(status));\n    }\n\n\nIf you rerrun the listStatus request on the directory '/A/B', you could not get the result. Because although the path '/A/B' is in the cache, it holds the content with mStatus. And the CachedItem with mDirStatuses has been replaced in the step 3.\n\nFixes #11765", "createdAt": "2020-06-19T02:56:49Z", "url": "https://github.com/Alluxio/alluxio/pull/11598", "merged": true, "mergeCommit": {"oid": "0a3994c50642f115e9588981fec7479a31d69968"}, "closed": true, "closedAt": "2020-07-23T04:06:39Z", "author": {"login": "QianxiZhang"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsp8GPAH2gAyNDM2ODU5ODg5Ojg5OTQzZGZlNDY1ZTI1MDA2MGQyMjg4ZDlmMzRmN2M3MjRlNGJhYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3nZtpAFqTQ1MzgyNDM5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/89943dfe465e250060d2288d9f34f7c724e4bac2", "committedDate": "2020-06-19T02:50:30Z", "message": "fix bug in meta cache in MetadataCachingBaseFileSystem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODM2Njg4", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-436836688", "createdAt": "2020-06-24T16:58:48Z", "commit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1ODo0OVrOGobByQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzowNTowNVrOGobQmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzOTA0OQ==", "bodyText": "can we use lambda syntax here?\n() -> new CachedItem());\n\nedit: or simply CachedItem::new?", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445039049", "createdAt": "2020-06-24T16:58:49Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -118,9 +127,19 @@ public void put(String path, URIStatus status) {\n    * @param statuses the list status results\n    */\n   public void put(AlluxioURI dir, List<URIStatus> statuses) {\n-    mCache.put(dir.getPath(), new CachedItem(statuses));\n-    for (URIStatus status : statuses) {\n-      mCache.put(status.getPath(), new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(dir.getPath(), new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzOTQ3OQ==", "bodyText": "can we use lambda syntax here?\n() -> new CachedItem());\n\nedit: or better yet simply CachedItem::new?", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445039479", "createdAt": "2020-06-24T16:59:33Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -100,15 +99,25 @@ public URIStatus get(AlluxioURI path) {\n    * @param status the status to be cached\n    */\n   public void put(AlluxioURI path, URIStatus status) {\n-    mCache.put(path.getPath(), new CachedItem(status));\n+    put(path.getPath(), status);\n   }\n \n   /**\n    * @param path the Alluxio path\n    * @param status the status to be cached\n    */\n   public void put(String path, URIStatus status) {\n-    mCache.put(path, new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(path, new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzOTY3NA==", "bodyText": "can you undo the changes to this indentation?", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445039674", "createdAt": "2020-06-24T16:59:51Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -77,9 +76,9 @@ public URIStatus getStatus() {\n    */\n   public MetadataCache(int maxSize, long expirationTimeMs) {\n     mCache = CacheBuilder.newBuilder()\n-        .maximumSize(maxSize)\n-        .expireAfterWrite(expirationTimeMs, TimeUnit.MILLISECONDS)\n-        .build();\n+            .maximumSize(maxSize)\n+            .expireAfterWrite(expirationTimeMs, TimeUnit.MILLISECONDS)\n+            .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA0MTQ3Nw==", "bodyText": "We should be logging any exceptions here instead of calling printStackTrace\nExample:\nat the top of the class\nprivate static final Logger LOG = LoggerFactory.getLogger(MetadataCache.class);\nthen in here and the other try/catch\nLogUtils.warnWithException(LOG, \"Failed to cache metadata\", e)", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445041477", "createdAt": "2020-06-24T17:02:43Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -118,9 +127,19 @@ public void put(String path, URIStatus status) {\n    * @param statuses the list status results\n    */\n   public void put(AlluxioURI dir, List<URIStatus> statuses) {\n-    mCache.put(dir.getPath(), new CachedItem(statuses));\n-    for (URIStatus status : statuses) {\n-      mCache.put(status.getPath(), new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(dir.getPath(), new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });\n+      item.setDirStatuses(statuses);\n+      for (URIStatus status : statuses) {\n+        put(status.getPath(), status);\n+      }\n+    } catch (Exception e) {\n+      e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA0MjI5MA==", "bodyText": "same comments about logging and catching exceptions here.", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445042290", "createdAt": "2020-06-24T17:04:02Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -100,15 +99,25 @@ public URIStatus get(AlluxioURI path) {\n    * @param status the status to be cached\n    */\n   public void put(AlluxioURI path, URIStatus status) {\n-    mCache.put(path.getPath(), new CachedItem(status));\n+    put(path.getPath(), status);\n   }\n \n   /**\n    * @param path the Alluxio path\n    * @param status the status to be cached\n    */\n   public void put(String path, URIStatus status) {\n-    mCache.put(path, new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(path, new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });\n+      item.setStatus(status);\n+    } catch (Exception e) {\n+      e.printStackTrace();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA0Mjg0Mw==", "bodyText": "Generally, it's not a good practice to catch Exception - we should really only catch exceptions that we know can be thrown. Is there a list of exceptions you know could be thrown here?", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r445042843", "createdAt": "2020-06-24T17:05:05Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -118,9 +127,19 @@ public void put(String path, URIStatus status) {\n    * @param statuses the list status results\n    */\n   public void put(AlluxioURI dir, List<URIStatus> statuses) {\n-    mCache.put(dir.getPath(), new CachedItem(statuses));\n-    for (URIStatus status : statuses) {\n-      mCache.put(status.getPath(), new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(dir.getPath(), new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });\n+      item.setDirStatuses(statuses);\n+      for (URIStatus status : statuses) {\n+        put(status.getPath(), status);\n+      }\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjQ5NzMw", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-438649730", "createdAt": "2020-06-26T23:58:05Z", "commit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzo1ODowNlrOGpxf7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzo1ODowNlrOGpxf7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1NTc4OA==", "bodyText": "good to be explicit on which Exception we are catching here?", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r446455788", "createdAt": "2020-06-26T23:58:06Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -100,15 +99,25 @@ public URIStatus get(AlluxioURI path) {\n    * @param status the status to be cached\n    */\n   public void put(AlluxioURI path, URIStatus status) {\n-    mCache.put(path.getPath(), new CachedItem(status));\n+    put(path.getPath(), status);\n   }\n \n   /**\n    * @param path the Alluxio path\n    * @param status the status to be cached\n    */\n   public void put(String path, URIStatus status) {\n-    mCache.put(path, new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(path, new Callable<CachedItem>() {\n+        @Override\n+        public CachedItem call() throws Exception {\n+          return new CachedItem();\n+        }\n+      });\n+      item.setStatus(status);\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 99}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjUwNDE5", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-438650419", "createdAt": "2020-06-27T00:01:57Z", "commit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMDowMTo1N1rOGpxiVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMDowMTo1N1rOGpxiVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1NjQwNQ==", "bodyText": "Puts the status into cache. or the style checker will fail and complain", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r446456405", "createdAt": "2020-06-27T00:01:57Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -67,6 +48,24 @@ public URIStatus getStatus() {\n     public List<URIStatus> getDirStatuses() {\n       return mDirStatuses;\n     }\n+\n+    /**\n+     *  put the status into cache", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjUwNDQ0", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-438650444", "createdAt": "2020-06-27T00:02:08Z", "commit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMDowMjowOFrOGpxicA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMDowMjowOFrOGpxicA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1NjQzMg==", "bodyText": "ditto \ud83d\udc46", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r446456432", "createdAt": "2020-06-27T00:02:08Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -67,6 +48,24 @@ public URIStatus getStatus() {\n     public List<URIStatus> getDirStatuses() {\n       return mDirStatuses;\n     }\n+\n+    /**\n+     *  put the status into cache\n+     *\n+     *  @param status the metadata of the path\n+     */\n+    public void setStatus(URIStatus status) {\n+      mStatus = status;\n+    }\n+\n+    /**\n+     *  put the directory status into cache", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89943dfe465e250060d2288d9f34f7c724e4bac2"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f3f7cfddc88deaea6caa742f4bbcc6cea3d7b7b", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/3f3f7cfddc88deaea6caa742f4bbcc6cea3d7b7b", "committedDate": "2020-07-10T03:19:29Z", "message": "change Exception to ExecutionException and fix some format issues"}, "afterCommit": {"oid": "c4858d8adb417d29dc7bd996b05ee45847889050", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/c4858d8adb417d29dc7bd996b05ee45847889050", "committedDate": "2020-07-10T04:13:15Z", "message": "change Exception to ExecutionException and fix some format issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/a670c004f7a4cd96d9307feb08dd8c53496e6e55", "committedDate": "2020-07-10T04:14:51Z", "message": "change Exception to ExecutionException and fix some format issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4858d8adb417d29dc7bd996b05ee45847889050", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/c4858d8adb417d29dc7bd996b05ee45847889050", "committedDate": "2020-07-10T04:13:15Z", "message": "change Exception to ExecutionException and fix some format issues"}, "afterCommit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/a670c004f7a4cd96d9307feb08dd8c53496e6e55", "committedDate": "2020-07-10T04:14:51Z", "message": "change Exception to ExecutionException and fix some format issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTI4MTA5", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-446528109", "createdAt": "2020-07-10T16:15:13Z", "commit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjoxNToxM1rOGv9UPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjoxODoxN1rOGv9afw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MDg2MQ==", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  CachedItem item = mCache.get(dir.getPath(),()-> new CachedItem());\n          \n          \n            \n                  CachedItem item = mCache.get(dir.getPath(), () -> new CachedItem());", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r452940861", "createdAt": "2020-07-10T16:15:13Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -118,9 +126,15 @@ public void put(String path, URIStatus status) {\n    * @param statuses the list status results\n    */\n   public void put(AlluxioURI dir, List<URIStatus> statuses) {\n-    mCache.put(dir.getPath(), new CachedItem(statuses));\n-    for (URIStatus status : statuses) {\n-      mCache.put(status.getPath(), new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(dir.getPath(),()-> new CachedItem());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MTk5NQ==", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  CachedItem item = mCache.get(path, ()-> new CachedItem());\n          \n          \n            \n                  CachedItem item = mCache.get(path, () -> new CachedItem());", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r452941995", "createdAt": "2020-07-10T16:17:24Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -100,15 +103,20 @@ public URIStatus get(AlluxioURI path) {\n    * @param status the status to be cached\n    */\n   public void put(AlluxioURI path, URIStatus status) {\n-    mCache.put(path.getPath(), new CachedItem(status));\n+    put(path.getPath(), status);\n   }\n \n   /**\n    * @param path the Alluxio path\n    * @param status the status to be cached\n    */\n   public void put(String path, URIStatus status) {\n-    mCache.put(path, new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(path, ()-> new CachedItem());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MjQ2Mw==", "bodyText": "Can we slightly alter this exception message so we can differentiate it from the one above?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOG.error(\"Failed to put meta into client cache for \" + dir.getPath(),\n          \n          \n            \n                    LOG.error(\"Failed to put meta into client cache for dir \" + dir.getPath(),", "url": "https://github.com/Alluxio/alluxio/pull/11598#discussion_r452942463", "createdAt": "2020-07-10T16:18:17Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java", "diffHunk": "@@ -118,9 +126,15 @@ public void put(String path, URIStatus status) {\n    * @param statuses the list status results\n    */\n   public void put(AlluxioURI dir, List<URIStatus> statuses) {\n-    mCache.put(dir.getPath(), new CachedItem(statuses));\n-    for (URIStatus status : statuses) {\n-      mCache.put(status.getPath(), new CachedItem(status));\n+    try {\n+      CachedItem item = mCache.get(dir.getPath(),()-> new CachedItem());\n+      item.setDirStatuses(statuses);\n+      for (URIStatus status : statuses) {\n+        put(status.getPath(), status);\n+      }\n+    } catch (ExecutionException e) {\n+        LOG.error(\"Failed to put meta into client cache for \" + dir.getPath(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a670c004f7a4cd96d9307feb08dd8c53496e6e55"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a274dc39dabfe2f172d4855809257e8d82b8cd25", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/a274dc39dabfe2f172d4855809257e8d82b8cd25", "committedDate": "2020-07-10T22:34:48Z", "message": "Update core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java\n\nCo-authored-by: Zac Blanco <zac@alluxio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f51bf148328bdfbfd9d75f24b6bdc98f482fea4e", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/f51bf148328bdfbfd9d75f24b6bdc98f482fea4e", "committedDate": "2020-07-10T22:34:58Z", "message": "Update core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java\n\nCo-authored-by: Zac Blanco <zac@alluxio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d59c5a67a1a8057a3e2c2818c1c13312961bbef6", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/d59c5a67a1a8057a3e2c2818c1c13312961bbef6", "committedDate": "2020-07-10T22:35:16Z", "message": "Update core/client/fs/src/main/java/alluxio/client/file/MetadataCache.java\n\nCo-authored-by: Zac Blanco <zac@alluxio.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ae27519f923073d8ddb0f484313c4e863bd2b46", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/3ae27519f923073d8ddb0f484313c4e863bd2b46", "committedDate": "2020-07-10T22:42:46Z", "message": "Fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c9d2ad55158c1589c3dde27b60a16bd31fdd29", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/f0c9d2ad55158c1589c3dde27b60a16bd31fdd29", "committedDate": "2020-07-10T22:51:10Z", "message": "Use warn instead of error as this is best effort"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzM5ODM0", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-446739834", "createdAt": "2020-07-10T22:53:36Z", "commit": {"oid": "f0c9d2ad55158c1589c3dde27b60a16bd31fdd29"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b129a01bcc6b4738bf16644b633a78dd3af05f8f", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/b129a01bcc6b4738bf16644b633a78dd3af05f8f", "committedDate": "2020-07-11T00:51:35Z", "message": "Update MetadataCache.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45be5f24b53f9ab77c0cb6bf677bc239ca811e88", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/45be5f24b53f9ab77c0cb6bf677bc239ca811e88", "committedDate": "2020-07-11T01:20:30Z", "message": "Update MetadataCache.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fe914e313fdf7dc21a05c62d901c704be5c5c49", "author": {"user": {"login": "QianxiZhang", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/6fe914e313fdf7dc21a05c62d901c704be5c5c49", "committedDate": "2020-07-16T03:51:21Z", "message": "add unit test for MetadataCache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzc4NzY4", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-450378768", "createdAt": "2020-07-17T05:19:47Z", "commit": {"oid": "6fe914e313fdf7dc21a05c62d901c704be5c5c49"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODI0Mzk1", "url": "https://github.com/Alluxio/alluxio/pull/11598#pullrequestreview-453824395", "createdAt": "2020-07-23T04:06:18Z", "commit": {"oid": "6fe914e313fdf7dc21a05c62d901c704be5c5c49"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4355, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}