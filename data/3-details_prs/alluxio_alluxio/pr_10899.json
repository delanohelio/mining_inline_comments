{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NTA4MzEy", "number": 10899, "title": "Add Wasbs support to Wasb Underfs", "bodyText": "Azure Blob Storage over https is currently unsupported by the wasb underfile system; however, the version of azure-hadoop  used in the underfs supports the https scheme (wasbs).\nThis PR merely changes the accepted SCHEME from wasb:// to accepted SCHEMES including both wasb:// and wasbs://\nwasbs support was tested by running runUfsTests in a k8s installation. All tests were passed successfully.", "createdAt": "2020-02-12T20:11:19Z", "url": "https://github.com/Alluxio/alluxio/pull/10899", "merged": true, "mergeCommit": {"oid": "6bcfc0b23aec9f7afd126f636dfdf06815576917"}, "closed": true, "closedAt": "2020-02-13T22:00:28Z", "author": {"login": "imiller31"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDsI1wABqjMwMzIyODk5MzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEBi_NAFqTM1ODU1MjY4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e54e75a2c9e89af28d617ed3f540721c7826116", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/1e54e75a2c9e89af28d617ed3f540721c7826116", "committedDate": "2020-02-12T20:08:27Z", "message": "adding configuration changes for wasbs"}, "afterCommit": {"oid": "c3b04d4788a880f68c084d60e8219d327874a325", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/c3b04d4788a880f68c084d60e8219d327874a325", "committedDate": "2020-02-12T20:12:39Z", "message": "adding configuration changes for wasbs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3b04d4788a880f68c084d60e8219d327874a325", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/c3b04d4788a880f68c084d60e8219d327874a325", "committedDate": "2020-02-12T20:12:39Z", "message": "adding configuration changes for wasbs"}, "afterCommit": {"oid": "adbdd4e74457d009f73a7fd4cc7e6bae18791a13", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/adbdd4e74457d009f73a7fd4cc7e6bae18791a13", "committedDate": "2020-02-12T20:16:23Z", "message": "adding configuration changes for wasbs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69b394ffb22f5fbb583dd441b75f9ee0202151ee", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/69b394ffb22f5fbb583dd441b75f9ee0202151ee", "committedDate": "2020-02-12T20:23:36Z", "message": "Adding wasbs support to wasb underfs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f403e37e2721547c7e2b59e5305d7e834b7ad1", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/b9f403e37e2721547c7e2b59e5305d7e834b7ad1", "committedDate": "2020-02-12T20:23:52Z", "message": "Fix wasbs test typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e4afe6a707fe325abb60c0a6ed8dc86041453c", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/70e4afe6a707fe325abb60c0a6ed8dc86041453c", "committedDate": "2020-02-12T20:24:15Z", "message": "adding configuration changes for wasbs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adbdd4e74457d009f73a7fd4cc7e6bae18791a13", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/adbdd4e74457d009f73a7fd4cc7e6bae18791a13", "committedDate": "2020-02-12T20:16:23Z", "message": "adding configuration changes for wasbs"}, "afterCommit": {"oid": "70e4afe6a707fe325abb60c0a6ed8dc86041453c", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/70e4afe6a707fe325abb60c0a6ed8dc86041453c", "committedDate": "2020-02-12T20:24:15Z", "message": "adding configuration changes for wasbs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2432b2f246c94192c3066b66bde4fed67119fe47", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/2432b2f246c94192c3066b66bde4fed67119fe47", "committedDate": "2020-02-12T20:43:52Z", "message": "Fixing for checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODIwOTY4", "url": "https://github.com/Alluxio/alluxio/pull/10899#pullrequestreview-357820968", "createdAt": "2020-02-12T22:02:34Z", "commit": {"oid": "2432b2f246c94192c3066b66bde4fed67119fe47"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjowMjozNFrOFpAK9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjowMjozNFrOFpAK9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzODc0MQ==", "bodyText": "isWasb doesn't seem very clear to me. Do you think something like isSecure might be easier to understand? - If so, you'd also have to flip the logic for the conditional below", "url": "https://github.com/Alluxio/alluxio/pull/10899#discussion_r378538741", "createdAt": "2020-02-12T22:02:34Z", "author": {"login": "ZacBlanco"}, "path": "underfs/wasb/src/main/java/alluxio/underfs/wasb/WasbUnderFileSystem.java", "diffHunk": "@@ -36,15 +38,18 @@\n   private static final Logger LOG = LoggerFactory.getLogger(WasbUnderFileSystem.class);\n \n   /** Constant for the wasb URI scheme. */\n-  public static final String SCHEME = \"wasb://\";\n+  public static final List<String> SCHEMES = Stream.of(\"wasb://\", \"wasbs://\")\n+          .collect(Collectors.toList());\n \n   /**\n    * Prepares the configuration for this Wasb as an HDFS configuration.\n    *\n    * @param conf the configuration for this UFS\n+   * @param isWasb whether to use wasb configuration or not\n    * @return the created configuration\n    */\n-  public static Configuration createConfiguration(UnderFileSystemConfiguration conf) {\n+  public static Configuration createConfiguration(UnderFileSystemConfiguration conf,\n+          Boolean isWasb) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2432b2f246c94192c3066b66bde4fed67119fe47"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8064122f3ebabd7559e12cd1b365a168f31d4e67", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/8064122f3ebabd7559e12cd1b365a168f31d4e67", "committedDate": "2020-02-12T22:16:37Z", "message": "changing isWasb to isSecure for clarity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODUwODA3", "url": "https://github.com/Alluxio/alluxio/pull/10899#pullrequestreview-357850807", "createdAt": "2020-02-12T22:59:43Z", "commit": {"oid": "8064122f3ebabd7559e12cd1b365a168f31d4e67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg1MzM1", "url": "https://github.com/Alluxio/alluxio/pull/10899#pullrequestreview-358485335", "createdAt": "2020-02-13T19:20:31Z", "commit": {"oid": "8064122f3ebabd7559e12cd1b365a168f31d4e67"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyMDozMVrOFpgbbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyMjowNVrOFpgexA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NzI0Ng==", "bodyText": "Does this not have to be \"fs.AbstractFileSystem.wasbs.impl\"?", "url": "https://github.com/Alluxio/alluxio/pull/10899#discussion_r379067246", "createdAt": "2020-02-13T19:20:31Z", "author": {"login": "gpang"}, "path": "underfs/wasb/src/main/java/alluxio/underfs/wasb/WasbUnderFileSystem.java", "diffHunk": "@@ -53,8 +58,13 @@ public static Configuration createConfiguration(UnderFileSystemConfiguration con\n         wasbConf.set(key, value);\n       }\n     }\n-    wasbConf.set(\"fs.AbstractFileSystem.wasb.impl\", \"org.apache.hadoop.fs.azure.Wasb\");\n-    wasbConf.set(\"fs.wasb.impl\", \"org.apache.hadoop.fs.azure.NativeAzureFileSystem\");\n+    if (isSecure) {\n+      wasbConf.set(\"fs.AbstractFileSystem.wasb.impl\", \"org.apache.hadoop.fs.azure.Wasbs\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8064122f3ebabd7559e12cd1b365a168f31d4e67"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2ODEwMA==", "bodyText": "Shouldn't this be startsWith(\"wasbs://\")?\nInstead, can we have 2 other constants, like SCHEME_SECURE=\"wasbs://\", and SCHEME_INSECURE=\"wasb://\"?", "url": "https://github.com/Alluxio/alluxio/pull/10899#discussion_r379068100", "createdAt": "2020-02-13T19:22:05Z", "author": {"login": "gpang"}, "path": "underfs/wasb/src/main/java/alluxio/underfs/wasb/WasbUnderFileSystem.java", "diffHunk": "@@ -67,7 +77,7 @@ public static Configuration createConfiguration(UnderFileSystemConfiguration con\n    */\n   public static WasbUnderFileSystem createInstance(AlluxioURI uri,\n       UnderFileSystemConfiguration conf) {\n-    Configuration wasbConf = createConfiguration(conf);\n+    Configuration wasbConf = createConfiguration(conf, uri.getScheme().startsWith(\"wasb://\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8064122f3ebabd7559e12cd1b365a168f31d4e67"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6b37dfa0b50db82c594bf09acc3de756cf6735", "author": {"user": {"login": "imiller31", "name": "Israel Miller"}}, "url": "https://github.com/Alluxio/alluxio/commit/8b6b37dfa0b50db82c594bf09acc3de756cf6735", "committedDate": "2020-02-13T19:50:19Z", "message": "changing from streams to string constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTUyNjg4", "url": "https://github.com/Alluxio/alluxio/pull/10899#pullrequestreview-358552688", "createdAt": "2020-02-13T21:09:54Z", "commit": {"oid": "8b6b37dfa0b50db82c594bf09acc3de756cf6735"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4939, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}