{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDk3MzM5", "number": 10918, "title": "Improve collectInfo command", "bodyText": "Various improvements to collectInfo command:\n\nscp now doesn't hardcode \"localhost\". Specifying localhost works on Mac but not on a CentOS machine.\nIf the command is invalid like alluxio collectInfo bar /dir, early reject before distributing the command and find out it's invalid locally.\nCatch metrics collection errors when metrics are unavailable, instead of failing the command and subsequently skips collecting tarballs.\nMisc bash command fixes.", "createdAt": "2020-02-14T17:35:08Z", "url": "https://github.com/Alluxio/alluxio/pull/10918", "merged": true, "mergeCommit": {"oid": "23ca2e47640c71a4a910d9ab3afaac8df7bf2bf7"}, "closed": true, "closedAt": "2020-02-21T17:04:33Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcESsiXgH2gAyMzc1NDk3MzM5OjcwODcwODFkYzg5ZWJiYzc2OTFkZTcyZGRiYTFhOGJhNDgwZWRmN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGSsejAFqTM2MjI3MzUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7087081dc89ebbc7691de72ddba1a8ba480edf7c", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/7087081dc89ebbc7691de72ddba1a8ba480edf7c", "committedDate": "2020-02-14T17:08:43Z", "message": "misc improvements to collectInfo command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b8e42516aaadec26aac224a4b651a884500a6c2", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/4b8e42516aaadec26aac224a4b651a884500a6c2", "committedDate": "2020-02-14T17:31:39Z", "message": "metrics catch all exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c41c42834b916d6cf34d79bcbfdb31bcc39a8155", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/c41c42834b916d6cf34d79bcbfdb31bcc39a8155", "committedDate": "2020-02-14T17:36:01Z", "message": "ps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mjk1OTk5", "url": "https://github.com/Alluxio/alluxio/pull/10918#pullrequestreview-359295999", "createdAt": "2020-02-15T01:56:59Z", "commit": {"oid": "c41c42834b916d6cf34d79bcbfdb31bcc39a8155"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQwMTo1Njo1OVrOFqHn2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQwMTo1OTo1M1rOFqHohA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcwOTQwMQ==", "bodyText": "Why is this two lines?", "url": "https://github.com/Alluxio/alluxio/pull/10918#discussion_r379709401", "createdAt": "2020-02-15T01:56:59Z", "author": {"login": "ns1123"}, "path": "shell/src/main/java/alluxio/cli/bundler/command/CollectMetricsCommand.java", "diffHunk": "@@ -120,12 +128,15 @@ public String getDescription() {\n \n   /**\n    * Probes Alluxio metrics json sink.\n+   * If the HTTP request fails, return the error content\n+   * instead of throwing an exception.\n    *\n    * @param url URL that serves Alluxio metrics\n    * @return HTTP response in JSON string\n    */\n   public String getMetricsJson(String url) throws IOException {\n-    String responseJson = HttpUtils.get(url, COLLECT_METRICS_TIMEOUT);\n+    String responseJson;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c41c42834b916d6cf34d79bcbfdb31bcc39a8155"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcwOTU3Mg==", "bodyText": "checkstyle?", "url": "https://github.com/Alluxio/alluxio/pull/10918#discussion_r379709572", "createdAt": "2020-02-15T01:59:53Z", "author": {"login": "ns1123"}, "path": "shell/src/main/java/alluxio/cli/bundler/command/CollectEnvCommand.java", "diffHunk": "@@ -38,33 +38,33 @@ public CollectEnvCommand(FileSystemContext fsContext) {\n   @Override\n   protected void registerCommands() {\n     registerCommand(\"Alluxio ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep alluxio'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep alluxio\"}), null);\n     registerCommand(\"Spark ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep spark'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep spark\"}), null);\n     registerCommand(\"Yarn ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep yarn'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep yarn\"}), null);\n     registerCommand(\"Hdfs ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep hdfs'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep hdfs\"}), null);\n     registerCommand(\"Presto ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep presto'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep presto\"}), null);\n     registerCommand(\"env\",\n             new ShellCommand(new String[]{\"env\"}), null);\n     registerCommand(\"top\", new ShellCommand(new String[]{\"atop\", \"-b\", \"-n\", \"1\"}),\n             new ShellCommand(new String[]{\"top\", \"-b\", \"-n\", \"1\"}));\n     registerCommand(\"mount\", new ShellCommand(new String[]{\"mount\"}), null);\n     registerCommand(\"df\", new ShellCommand(new String[]{\"df\", \"-H\"}), null);\n-    registerCommand(\"ulimit\", new ShellCommand(new String[]{\"ulimit -Ha\"}), null);\n+    registerCommand(\"ulimit\", new ShellCommand(new String[]{\"ulimit\", \"-Ha\"}), null);\n     registerCommand(\"uname\", new ShellCommand(new String[]{\"uname\", \"-a\"}), null);\n     registerCommand(\"hostname\", new ShellCommand(new String[]{\"hostname\"}), null);\n     registerCommand(\"host ip\", new ShellCommand(new String[]{\"hostname\", \"-i\"}), null);\n     registerCommand(\"host fqdn\", new ShellCommand(new String[]{\"hostname\", \"-f\"}), null);\n     registerCommand(\"list Alluxio home\",\n-            new ShellCommand(new String[]{String.format(\"ls -al -R %s\",\n+            new ShellCommand(new String[]{String.format(\"ls\", \"-al -R %s\",\n                     mFsContext.getClusterConf().get(PropertyKey.HOME))}), null);\n-    registerCommand(\"dig\", new ShellCommand(new String[]{\"dig $(hostname -i)\"}), null);\n+    registerCommand(\"dig\", new ShellCommand(new String[]{\"dig\", \"$(hostname -i)\"}), null);\n     registerCommand(\"nslookup\", new ShellCommand(new String[]{\"nslookup\", \"$(hostname -i)\"}), null);\n-    // TODO(jiacheng): does this stop?\n-    registerCommand(\"dstat\", new ShellCommand(new String[]{\"dstat\", \"-cdgilmnprsty\"}), null);\n+    registerCommand(\"dstat\", new ShellCommand(\n+            new String[]{\"dstat\", \"-cdgilmnprsty\", \"1\", \"5\"}), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c41c42834b916d6cf34d79bcbfdb31bcc39a8155"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1535f5d5c87bdccd8bed1c0da8a598a1a4b2687", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b1535f5d5c87bdccd8bed1c0da8a598a1a4b2687", "committedDate": "2020-02-15T02:04:10Z", "message": "resolve comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjczNTM1", "url": "https://github.com/Alluxio/alluxio/pull/10918#pullrequestreview-362273535", "createdAt": "2020-02-20T22:14:54Z", "commit": {"oid": "b1535f5d5c87bdccd8bed1c0da8a598a1a4b2687"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjoxNDo1NFrOFslBjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjoxNDo1NFrOFslBjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4ODI3MQ==", "bodyText": "what's the logic for this split?", "url": "https://github.com/Alluxio/alluxio/pull/10918#discussion_r382288271", "createdAt": "2020-02-20T22:14:54Z", "author": {"login": "ns1123"}, "path": "shell/src/main/java/alluxio/cli/bundler/command/CollectEnvCommand.java", "diffHunk": "@@ -38,33 +38,33 @@ public CollectEnvCommand(FileSystemContext fsContext) {\n   @Override\n   protected void registerCommands() {\n     registerCommand(\"Alluxio ps\",\n-            new ShellCommand(new String[]{\"bash\", \"-c\", \"'ps -ef | grep alluxio'\"}), null);\n+            new ShellCommand(new String[]{\"bash\", \"-c\", \"ps\", \"-ef\", \"| grep alluxio\"}), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1535f5d5c87bdccd8bed1c0da8a598a1a4b2687"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4959, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}