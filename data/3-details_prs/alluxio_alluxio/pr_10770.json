{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MDUwNTAz", "number": 10770, "title": "Make FileOutStream an abstract class similar to FileInStream", "bodyText": "AbstractOutStream -> FileOutStream\nFileOutStream -> AlluxioFileOutStream\nThis makes it symmetrical with FileInStream", "createdAt": "2020-01-21T00:54:18Z", "url": "https://github.com/Alluxio/alluxio/pull/10770", "merged": true, "mergeCommit": {"oid": "cff921738ce81cda97008d63f70920db10a58a2d"}, "closed": true, "closedAt": "2020-01-21T08:00:45Z", "author": {"login": "calvinjia"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8WWocgH2gAyMzY1MDUwNTAzOjI4ZmUxNDI1ZjYzMTQ0ODViOTIxODkwMmM2YjA4NzVjMmRiNjFlZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8b-dvgH2gAyMzY1MDUwNTAzOjE5ZGM1YWEzNjE3ZDFmYjUyMDkxNGMyZGU1YWIyOTE3YmJiZDY3NGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/28fe1425f6314485b9218902c6b0875c2db61efa", "committedDate": "2020-01-21T00:53:01Z", "message": "Make FileOutStream an abstract class similar to FileInStream."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjY3MDcx", "url": "https://github.com/Alluxio/alluxio/pull/10770#pullrequestreview-345667071", "createdAt": "2020-01-21T07:04:10Z", "commit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzowNDoxMFrOFfwE_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzowNDoxMFrOFfwE_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODgzNzg4NA==", "bodyText": "should we keep this annotation @PublicApi?", "url": "https://github.com/Alluxio/alluxio/pull/10770#discussion_r368837884", "createdAt": "2020-01-21T07:04:10Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/FileOutStream.java", "diffHunk": "@@ -11,312 +11,40 @@\n \n package alluxio.client.file;\n \n-import alluxio.AlluxioURI;\n-import alluxio.Constants;\n-import alluxio.annotation.PublicApi;\n-import alluxio.client.AbstractOutStream;\n-import alluxio.client.AlluxioStorageType;\n-import alluxio.client.UnderStorageType;\n-import alluxio.client.block.AlluxioBlockStore;\n-import alluxio.client.block.policy.options.GetWorkerOptions;\n-import alluxio.client.block.stream.BlockOutStream;\n-import alluxio.client.block.stream.UnderFileSystemFileOutStream;\n-import alluxio.client.file.options.OutStreamOptions;\n-import alluxio.exception.ExceptionMessage;\n-import alluxio.exception.PreconditionMessage;\n-import alluxio.exception.status.UnavailableException;\n-import alluxio.grpc.CompleteFilePOptions;\n-import alluxio.metrics.ClientMetrics;\n-import alluxio.metrics.MetricsSystem;\n-import alluxio.resource.CloseableResource;\n-import alluxio.util.CommonUtils;\n-import alluxio.util.FileSystemOptions;\n-import alluxio.wire.BlockInfo;\n-import alluxio.wire.WorkerNetAddress;\n-\n-import com.codahale.metrics.Counter;\n-import com.google.common.base.Preconditions;\n-import com.google.common.io.Closer;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import alluxio.client.Cancelable;\n \n import java.io.IOException;\n-import java.util.ArrayList;\n-import java.util.List;\n+import java.io.OutputStream;\n \n import javax.annotation.concurrent.NotThreadSafe;\n-import javax.annotation.concurrent.ThreadSafe;\n \n /**\n- * Provides a streaming API to write a file. This class wraps the BlockOutStreams for each of the\n- * blocks in the file and abstracts the switching between streams. The backing streams can write to\n- * Alluxio space in the local machine or remote machines. If the {@link UnderStorageType} is\n- * {@link UnderStorageType#SYNC_PERSIST}, another stream will write the data to the under storage\n- * system.\n+ * An abstraction of the output stream API in Alluxio to write data to a file or a block. In\n+ * addition to extending abstract class {@link OutputStream} as the basics, it also keeps counting\n+ * the number of bytes written to the output stream, and extends {@link Cancelable} to abort the\n+ * writes.\n  */\n-@PublicApi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjY3MzY2", "url": "https://github.com/Alluxio/alluxio/pull/10770#pullrequestreview-345667366", "createdAt": "2020-01-21T07:05:15Z", "commit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzowNToxNVrOFfwF6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzowNToxNVrOFfwF6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODgzODEyMQ==", "bodyText": "should we still keep this annotation?", "url": "https://github.com/Alluxio/alluxio/pull/10770#discussion_r368838121", "createdAt": "2020-01-21T07:05:15Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/AlluxioFileOutStream.java", "diffHunk": "@@ -0,0 +1,321 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.client.file;\n+\n+import alluxio.AlluxioURI;\n+import alluxio.Constants;\n+import alluxio.annotation.PublicApi;\n+import alluxio.client.AlluxioStorageType;\n+import alluxio.client.UnderStorageType;\n+import alluxio.client.block.AlluxioBlockStore;\n+import alluxio.client.block.policy.options.GetWorkerOptions;\n+import alluxio.client.block.stream.BlockOutStream;\n+import alluxio.client.block.stream.UnderFileSystemFileOutStream;\n+import alluxio.client.file.options.OutStreamOptions;\n+import alluxio.exception.ExceptionMessage;\n+import alluxio.exception.PreconditionMessage;\n+import alluxio.exception.status.UnavailableException;\n+import alluxio.grpc.CompleteFilePOptions;\n+import alluxio.metrics.ClientMetrics;\n+import alluxio.metrics.MetricsSystem;\n+import alluxio.resource.CloseableResource;\n+import alluxio.util.CommonUtils;\n+import alluxio.util.FileSystemOptions;\n+import alluxio.wire.BlockInfo;\n+import alluxio.wire.WorkerNetAddress;\n+\n+import com.codahale.metrics.Counter;\n+import com.google.common.base.Preconditions;\n+import com.google.common.io.Closer;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javax.annotation.concurrent.NotThreadSafe;\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+/**\n+ * Provides a streaming API to write a file. This class wraps the BlockOutStreams for each of the\n+ * blocks in the file and abstracts the switching between streams. The backing streams can write to\n+ * Alluxio space in the local machine or remote machines. If the {@link UnderStorageType} is\n+ * {@link UnderStorageType#SYNC_PERSIST}, another stream will write the data to the under storage\n+ * system.\n+ */\n+@PublicApi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjY3NDk2", "url": "https://github.com/Alluxio/alluxio/pull/10770#pullrequestreview-345667496", "createdAt": "2020-01-21T07:05:39Z", "commit": {"oid": "28fe1425f6314485b9218902c6b0875c2db61efa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19dc5aa3617d1fb520914c2de5ab2917bbbd674a", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/19dc5aa3617d1fb520914c2de5ab2917bbbd674a", "committedDate": "2020-01-21T07:26:03Z", "message": "Update annotations."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3115, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}