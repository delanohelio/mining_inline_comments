{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1OTE1NDYw", "number": 11733, "title": "Fix edge case for ObjectUFS when looking at root path", "bodyText": "Path of s3://<bucket_name> currently doesn't work while s3://<bucket_name>/ does because\ns3://<bucket_name>/ gets currently replaced with the empty string when using it with the correct client while\ns3://<bucket_name> does not get replaced with the empty string.", "createdAt": "2020-07-08T03:46:41Z", "url": "https://github.com/Alluxio/alluxio/pull/11733", "merged": true, "mergeCommit": {"oid": "fcf0bbcd6278a4269239d3dd93b04a36d5948c2a"}, "closed": true, "closedAt": "2020-07-08T20:08:07Z", "author": {"login": "bradyoo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyyF0JAH2gAyNDQ1OTE1NDYwOjZiNGVhOWQ0OWVhMWZjMjhlODY3NWNhMWVmNjczMzhlYThiNzQ3ZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczAKljgFqTQ0NTA5MTg0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b4ea9d49ea1fc28e8675ca1ef67338ea8b747d9", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/6b4ea9d49ea1fc28e8675ca1ef67338ea8b747d9", "committedDate": "2020-07-08T03:43:54Z", "message": "Fix cases for ObjectUnderFileSystem when looking at root and doesn't end with path separator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0OTE5MjUz", "url": "https://github.com/Alluxio/alluxio/pull/11733#pullrequestreview-444919253", "createdAt": "2020-07-08T16:10:04Z", "commit": {"oid": "6b4ea9d49ea1fc28e8675ca1ef67338ea8b747d9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNjoxMDowNFrOGuvN1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNjoxMDowNFrOGuvN1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY2MTI3MQ==", "bodyText": "Can you add a unit tests for this?", "url": "https://github.com/Alluxio/alluxio/pull/11733#discussion_r451661271", "createdAt": "2020-07-08T16:10:04Z", "author": {"login": "gpang"}, "path": "core/common/src/main/java/alluxio/underfs/ObjectUnderFileSystem.java", "diffHunk": "@@ -1117,7 +1117,8 @@ protected boolean parentExists(String path) throws IOException {\n    * @return the path without the bucket prefix\n    */\n   protected String stripPrefixIfPresent(String path) {\n-    String stripedKey = CommonUtils.stripPrefixIfPresent(path,\n+    String stripedKey = CommonUtils.stripPrefixIfPresent(\n+        PathUtils.normalizePath(path, PATH_SEPARATOR),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b4ea9d49ea1fc28e8675ca1ef67338ea8b747d9"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c16b3f249fa4553d8513792e6b5f8dff9165802", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/8c16b3f249fa4553d8513792e6b5f8dff9165802", "committedDate": "2020-07-08T16:36:38Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "539215247e8d3bedd5e1c8fa17c33ab732042b53", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/539215247e8d3bedd5e1c8fa17c33ab732042b53", "committedDate": "2020-07-08T16:40:02Z", "message": "replace bucket_name with constant variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0OTUyNTEy", "url": "https://github.com/Alluxio/alluxio/pull/11733#pullrequestreview-444952512", "createdAt": "2020-07-08T16:49:43Z", "commit": {"oid": "539215247e8d3bedd5e1c8fa17c33ab732042b53"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNjo0OTo0M1rOGuwyKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNjo1MDozOVrOGuw0cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY4Njk1NA==", "bodyText": "What would the previous code have returned?", "url": "https://github.com/Alluxio/alluxio/pull/11733#discussion_r451686954", "createdAt": "2020-07-08T16:49:43Z", "author": {"login": "gpang"}, "path": "underfs/s3a/src/test/java/alluxio/underfs/s3a/S3AUnderFileSystemTest.java", "diffHunk": "@@ -239,4 +239,9 @@ public void getOperationMode() throws Exception {\n     Assert.assertEquals(UfsMode.READ_WRITE,\n         mS3UnderFileSystem.getOperationMode(physicalUfsState));\n   }\n+\n+  @Test\n+  public void stripPrefixIfPresent() throws Exception {\n+    Assert.assertEquals(\"\", mS3UnderFileSystem.stripPrefixIfPresent(\"s3a://\" + BUCKET_NAME));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "539215247e8d3bedd5e1c8fa17c33ab732042b53"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTY4NzUzOA==", "bodyText": "Could you add a few more tests cases to test the method stripPrefixIfPresent?", "url": "https://github.com/Alluxio/alluxio/pull/11733#discussion_r451687538", "createdAt": "2020-07-08T16:50:39Z", "author": {"login": "gpang"}, "path": "underfs/s3a/src/test/java/alluxio/underfs/s3a/S3AUnderFileSystemTest.java", "diffHunk": "@@ -239,4 +239,9 @@ public void getOperationMode() throws Exception {\n     Assert.assertEquals(UfsMode.READ_WRITE,\n         mS3UnderFileSystem.getOperationMode(physicalUfsState));\n   }\n+\n+  @Test\n+  public void stripPrefixIfPresent() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "539215247e8d3bedd5e1c8fa17c33ab732042b53"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92038f2c96877490e4b8dea8a8ed7667d27af68d", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/92038f2c96877490e4b8dea8a8ed7667d27af68d", "committedDate": "2020-07-08T17:00:43Z", "message": "add more test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dea3b052b3bcd8acb2a1d884dbef11a6034ff436", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/dea3b052b3bcd8acb2a1d884dbef11a6034ff436", "committedDate": "2020-07-08T17:27:31Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDEyOTE0", "url": "https://github.com/Alluxio/alluxio/pull/11733#pullrequestreview-445012914", "createdAt": "2020-07-08T18:10:00Z", "commit": {"oid": "dea3b052b3bcd8acb2a1d884dbef11a6034ff436"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMDowMVrOGuzrzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMDowMVrOGuzrzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTczNDQ3Nw==", "bodyText": "Should there be 1 additional case of something like \"s3a://\" + BUCKET_NAME + \"/path/\" ?", "url": "https://github.com/Alluxio/alluxio/pull/11733#discussion_r451734477", "createdAt": "2020-07-08T18:10:01Z", "author": {"login": "gpang"}, "path": "underfs/s3a/src/test/java/alluxio/underfs/s3a/S3AUnderFileSystemTest.java", "diffHunk": "@@ -239,4 +239,11 @@ public void getOperationMode() throws Exception {\n     Assert.assertEquals(UfsMode.READ_WRITE,\n         mS3UnderFileSystem.getOperationMode(physicalUfsState));\n   }\n+\n+  @Test\n+  public void stripPrefixIfPresent() throws Exception {\n+    Assert.assertEquals(\"\", mS3UnderFileSystem.stripPrefixIfPresent(\"s3a://\" + BUCKET_NAME));\n+    Assert.assertEquals(\"\", mS3UnderFileSystem.stripPrefixIfPresent(\"s3a://\" + BUCKET_NAME + \"/\"));\n+    Assert.assertEquals(\"test/\", mS3UnderFileSystem.stripPrefixIfPresent(\"test\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dea3b052b3bcd8acb2a1d884dbef11a6034ff436"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8248b994f27ee9a0dc6c9d65556bf312f20b63", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/9e8248b994f27ee9a0dc6c9d65556bf312f20b63", "committedDate": "2020-07-08T18:15:04Z", "message": "add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDkxODQ4", "url": "https://github.com/Alluxio/alluxio/pull/11733#pullrequestreview-445091848", "createdAt": "2020-07-08T20:07:47Z", "commit": {"oid": "9e8248b994f27ee9a0dc6c9d65556bf312f20b63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4258, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}