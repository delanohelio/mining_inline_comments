{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTY3NjQ0", "number": 12046, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMTowMDoxM1rOEd4xsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMTowMTozOFrOEd4y8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzc0Mzg1OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMTowMDoxM1rOHJUUkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMToyOToxM1rOHJU9iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjE3OQ==", "bodyText": "I'm not entirely sure we are allowed to remove this synchronized. However, I know we can remove the one with close(), since it just calls another method which is already synchronized. If we just remove the synchronized on the ConfigHashSync#close(), that should remove the deadlock cycle, right?\nI'm just concerned that synchronized might be required for heartbeat().", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479532179", "createdAt": "2020-08-28T21:00:13Z", "author": {"login": "gpang"}, "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0MjY2NQ==", "bodyText": "We have one thread that should be running heartbeat so there or not, it shouldn't really make a difference. I'll put it back.", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479542665", "createdAt": "2020-08-28T21:29:13Z", "author": {"login": "bradyoo"}, "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjE3OQ=="}, "originalCommit": {"oid": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5Nzc0NzA1OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMTowMTozOFrOHJUWoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMToyOTo0OVrOHJU-UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjcwNA==", "bodyText": "mClient is used in this method.. so what if another thread closes it before an operation on mClient?", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479532704", "createdAt": "2020-08-28T21:01:38Z", "author": {"login": "yuzhu"}, "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0Mjg2NA==", "bodyText": "mClient is also threadsafe by having its own synchronized methods.", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479542864", "createdAt": "2020-08-28T21:29:49Z", "author": {"login": "bradyoo"}, "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjcwNA=="}, "originalCommit": {"oid": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1232, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}