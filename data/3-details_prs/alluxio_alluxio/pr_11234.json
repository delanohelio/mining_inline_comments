{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NTI0NTcz", "number": 11234, "title": "Update alluxio-mount.sh for FreeBSD", "bodyText": "With the changes above, we can use alluxio with FreeBSD.", "createdAt": "2020-04-02T11:40:21Z", "url": "https://github.com/Alluxio/alluxio/pull/11234", "merged": true, "mergeCommit": {"oid": "4f0e38039259fcb94627768f6a6833f4af7cca2e"}, "closed": true, "closedAt": "2020-04-06T19:32:19Z", "author": {"login": "martenlindblad"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTqw4jgH2gAyMzk3NTI0NTczOmJlOGM5OWQ5ZGExMWVlMWRlNmRjY2VjYzRkNzZmMjc5ZTlhMjI5ZDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU5aLagFqTM4Nzk4Njc2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be8c99d9da11ee1de6dccecc4d76f279e9a229d4", "author": {"user": {"login": "martenlindblad", "name": "M\u00e5rten Lindblad"}}, "url": "https://github.com/Alluxio/alluxio/commit/be8c99d9da11ee1de6dccecc4d76f279e9a229d4", "committedDate": "2020-04-02T11:40:03Z", "message": "Update alluxio-mount.sh for FreeBSD\n\nWith the changes above, we can use alluxio with FreeBSD."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8", "author": {"user": {"login": "martenlindblad", "name": "M\u00e5rten Lindblad"}}, "url": "https://github.com/Alluxio/alluxio/commit/a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8", "committedDate": "2020-04-02T12:57:54Z", "message": "Update alluxio-mount.sh\n\nFixed unmount for FreeBSD"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzYwNDQy", "url": "https://github.com/Alluxio/alluxio/pull/11234#pullrequestreview-387360442", "createdAt": "2020-04-03T15:29:15Z", "commit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyOToxNVrOGAafsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyOToxNVrOGAafsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4NzI4MA==", "bodyText": "is tmpfs vs ramfs the only difference between this and the linux implementation?", "url": "https://github.com/Alluxio/alluxio/pull/11234#discussion_r403087280", "createdAt": "2020-04-03T15:29:15Z", "author": {"login": "ZacBlanco"}, "path": "bin/alluxio-mount.sh", "diffHunk": "@@ -87,6 +87,65 @@ function umount_ramfs_linux() {\n   fi\n }\n \n+function check_space_freebsd() {\n+  local total_mem=$(($(sysctl -h hw.usermem | awk 'NR==1{print $2}' | sed 's/,//g')))\n+  if [[ ${total_mem} -lt ${MEM_SIZE} ]]; then\n+    echo \"ERROR: Memory(${total_mem}) is less than requested ramdisk size(${MEM_SIZE}). Please\n+    reduce alluxio.worker.memory.size in alluxio-site.properties\" >&2\n+    exit 1\n+  fi\n+}\n+\n+function mount_ramfs_freebsd() {\n+  TIER_PATH=${1}\n+  echo \"Formatting RamFS: ${TIER_PATH} (${MEM_SIZE})\"\n+  if [[ ${USE_SUDO} == true ]]; then\n+    sudo mkdir -p ${TIER_PATH}\n+  else\n+    mkdir -p ${TIER_PATH}\n+  fi\n+  if [[ $? -ne 0 ]]; then\n+    echo \"ERROR: mkdir ${TIER_PATH} failed\" >&2\n+    exit 1\n+  fi\n+\n+  if [[ ${USE_SUDO} == true ]]; then\n+    sudo mount -t tmpfs -o size=${MEM_SIZE} tmpfs ${TIER_PATH}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzcyOTU1", "url": "https://github.com/Alluxio/alluxio/pull/11234#pullrequestreview-387772955", "createdAt": "2020-04-05T01:24:16Z", "commit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwMToyNDoxNlrOGA6_eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwMToyNjowMFrOGA7CHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzYxOTcwNg==", "bodyText": "Just trying to understand this command\n\nsysctl -h hw.usermem\n\nprints out the system memory in human-readable format because of the -h flag\n\nawk 'NR==1{print $2}\n\nThis will print out the 2nd column from the first line, where the column is defined by a  char. I'm assuming the 2nd column is the value for the hw.usermem\n\nsed 's/,//g'\n\nRemoves an commas from the resulting output.\nMy only question with this set of commands is the -h flag. It will print in human readable format, but does that mean it will convert bytes to kb, mb, gb, etc dynamically based on the actual value?\nIn our linux version we use /proc/meminfo which always prints in kb, and then multiply that value by 1024. If we leave off the -h will it just give us the raw value in bytes? I think that is what we want.\n(sorry I don't have a freebsd system available to test this myself)", "url": "https://github.com/Alluxio/alluxio/pull/11234#discussion_r403619706", "createdAt": "2020-04-05T01:24:16Z", "author": {"login": "ZacBlanco"}, "path": "bin/alluxio-mount.sh", "diffHunk": "@@ -87,6 +87,65 @@ function umount_ramfs_linux() {\n   fi\n }\n \n+function check_space_freebsd() {\n+  local total_mem=$(($(sysctl -h hw.usermem | awk 'NR==1{print $2}' | sed 's/,//g')))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzYyMDM4MQ==", "bodyText": "Thanks for the clarification!", "url": "https://github.com/Alluxio/alluxio/pull/11234#discussion_r403620381", "createdAt": "2020-04-05T01:26:00Z", "author": {"login": "ZacBlanco"}, "path": "bin/alluxio-mount.sh", "diffHunk": "@@ -87,6 +87,65 @@ function umount_ramfs_linux() {\n   fi\n }\n \n+function check_space_freebsd() {\n+  local total_mem=$(($(sysctl -h hw.usermem | awk 'NR==1{print $2}' | sed 's/,//g')))\n+  if [[ ${total_mem} -lt ${MEM_SIZE} ]]; then\n+    echo \"ERROR: Memory(${total_mem}) is less than requested ramdisk size(${MEM_SIZE}). Please\n+    reduce alluxio.worker.memory.size in alluxio-site.properties\" >&2\n+    exit 1\n+  fi\n+}\n+\n+function mount_ramfs_freebsd() {\n+  TIER_PATH=${1}\n+  echo \"Formatting RamFS: ${TIER_PATH} (${MEM_SIZE})\"\n+  if [[ ${USE_SUDO} == true ]]; then\n+    sudo mkdir -p ${TIER_PATH}\n+  else\n+    mkdir -p ${TIER_PATH}\n+  fi\n+  if [[ $? -ne 0 ]]; then\n+    echo \"ERROR: mkdir ${TIER_PATH} failed\" >&2\n+    exit 1\n+  fi\n+\n+  if [[ ${USE_SUDO} == true ]]; then\n+    sudo mount -t tmpfs -o size=${MEM_SIZE} tmpfs ${TIER_PATH}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4NzI4MA=="}, "originalCommit": {"oid": "a98d4f9bef7a12c2f89f1011101d4cbdbc72ecd8"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a432714d0c80c13a3978cc7d48f5669eb0e6330", "author": {"user": {"login": "martenlindblad", "name": "M\u00e5rten Lindblad"}}, "url": "https://github.com/Alluxio/alluxio/commit/6a432714d0c80c13a3978cc7d48f5669eb0e6330", "committedDate": "2020-04-05T10:30:04Z", "message": "Update alluxio-mount.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3OTg2NzY4", "url": "https://github.com/Alluxio/alluxio/pull/11234#pullrequestreview-387986768", "createdAt": "2020-04-06T07:17:45Z", "commit": {"oid": "6a432714d0c80c13a3978cc7d48f5669eb0e6330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4722, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}