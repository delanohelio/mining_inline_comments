{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzY2NTU1", "number": 11194, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo0MTo0MFrODtyvdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNjoyNDo0MVrODuczmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzQzODYzOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo0MTo0MFrOF_bDtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo0MTo0MFrOF_bDtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0NzkyNQ==", "bodyText": "I suggest not replacing the field here and instead using containerHost instead of host in https://github.com/Alluxio/alluxio/blob/master/core/common/src/main/java/alluxio/util/network/NetworkAddressUtils.java#L631\nThis is used across both read and write paths (GrpcDataReader and GrpcDataWriter) and will act as the single point of change", "url": "https://github.com/Alluxio/alluxio/pull/11194#discussion_r402047925", "createdAt": "2020-04-02T04:41:40Z", "author": {"login": "madanadit"}, "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "diffHunk": "@@ -214,6 +214,15 @@ public BlockInStream getInStream(BlockInfo info, InStreamOptions options,\n     }\n \n     try {\n+      // ALLUXIO-11172: If the worker is in a container, use the container hostname\n+      // to establish the connection.\n+      if (!dataSource.getContainerHost().equals(\"\")) {\n+        String containerName = dataSource.getContainerHost();\n+        LOG.debug(\"Worker is in a container. Replace host {} with container host {}\",\n+                dataSource.getHost(), containerName);\n+        dataSource.setHost(containerName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14bd1c8a9cad43e7f419b69a58be1583d721cb35"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzQzOTcxOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo0MjoyNlrOF_bEWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo0MjoyNlrOF_bEWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0ODA4OQ==", "bodyText": "this redundant translation can be avoided with the change in NetworkAddressUtils", "url": "https://github.com/Alluxio/alluxio/pull/11194#discussion_r402048089", "createdAt": "2020-04-02T04:42:26Z", "author": {"login": "madanadit"}, "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "diffHunk": "@@ -264,6 +273,15 @@ public BlockOutStream getOutStream(long blockId, long blockSize, WorkerNetAddres\n     }\n     LOG.debug(\"Create block outstream for {} of block size {} at address {}, using options: {}\",\n         blockId, blockSize, address, options);\n+\n+    // ALLUXIO-11172: If the worker is in a container, use the container hostname\n+    // to establish the connection.\n+    if (!address.getContainerHost().equals(\"\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14bd1c8a9cad43e7f419b69a58be1583d721cb35"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzQ1MjE0OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo1MDoyM1rOF_bLXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNDo1MDoyM1rOF_bLXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0OTg4NQ==", "bodyText": "same here, this block also ends up calling NetworkAddressUtils to create GrpcDataWriter", "url": "https://github.com/Alluxio/alluxio/pull/11194#discussion_r402049885", "createdAt": "2020-04-02T04:50:23Z", "author": {"login": "madanadit"}, "path": "core/client/fs/src/main/java/alluxio/client/block/AlluxioBlockStore.java", "diffHunk": "@@ -333,6 +351,17 @@ public BlockOutStream getOutStream(long blockId, long blockSize, OutStreamOption\n           \"Not enough workers for replications, %d workers selected but %d required\",\n           workerAddressList.size(), initialReplicas));\n     }\n+\n+    // ALLUXIO-11172: If the worker is in a container, use the container hostname\n+    // to establish the connection.\n+    for (WorkerNetAddress workerAddress : workerAddressList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14bd1c8a9cad43e7f419b69a58be1583d721cb35"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzM1NjgyOnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/wire/WorkerNetAddress.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDozMjozNlrOGABKYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMDozMjozNlrOGABKYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3MjIyNA==", "bodyText": "Update the javadoc?", "url": "https://github.com/Alluxio/alluxio/pull/11194#discussion_r402672224", "createdAt": "2020-04-03T00:32:36Z", "author": {"login": "bf8086"}, "path": "core/common/src/main/java/alluxio/wire/WorkerNetAddress.java", "diffHunk": "@@ -53,6 +54,14 @@ public String getHost() {\n     return mHost;\n   }\n \n+  /**\n+   * @return the host of the worker", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14bd1c8a9cad43e7f419b69a58be1583d721cb35"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMDMzMDQ5OnYy", "diffSide": "RIGHT", "path": "core/transport/src/main/proto/grpc/common.proto", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNjoyNDo0MVrOGAc2Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNjoyNDo0MVrOGAc2Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEyNTg0Nw==", "bodyText": "instead of changing al numbers, set containerHost = 7", "url": "https://github.com/Alluxio/alluxio/pull/11194#discussion_r403125847", "createdAt": "2020-04-03T16:24:41Z", "author": {"login": "madanadit"}, "path": "core/transport/src/main/proto/grpc/common.proto", "diffHunk": "@@ -116,11 +116,12 @@ message NetAddress {\n  */\n message WorkerNetAddress {\n   optional string host = 1;\n-  optional int32 rpcPort = 2;\n-  optional int32 dataPort = 3;\n-  optional int32 webPort = 4;\n-  optional string domainSocketPath = 5;\n-  optional TieredIdentity tieredIdentity = 6;\n+  optional string containerHost = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec39cd3d580fd45ed27a3dc119c289a69cd56859"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1789, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}