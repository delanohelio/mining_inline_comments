{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2OTg2MDk3", "number": 11424, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjozMTo1OVrOD72QjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDo0MjoyNFrOD73zSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDgxNTQ4OnYy", "diffSide": "RIGHT", "path": "integration/dataproc/build.sh", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjozMTo1OVrOGUbQgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDoxMDozM1rOGUdLgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw==", "bodyText": "if the file is updated in the future in a way that results in this sed operation doing zero replacements, is there a way to detect and trigger failure? trying to avoid the scenario where things get refactored and silently fail", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424071297", "createdAt": "2020-05-12T22:31:59Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5MTA1OQ==", "bodyText": "ping on this comment", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424091059", "createdAt": "2020-05-12T23:30:05Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw=="}, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NjUyMw==", "bodyText": "i'll diff the .generated files with the original to see if changes were made", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424096523", "createdAt": "2020-05-12T23:47:41Z", "author": {"login": "tieujason330"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw=="}, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMDEwNg==", "bodyText": "maybe a grep for the matching string before the sed is easier? you could replace the url with the same url that was there and result in no diff", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424100106", "createdAt": "2020-05-13T00:00:04Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw=="}, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMjc4Nw==", "bodyText": "ok sounds good", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424102787", "createdAt": "2020-05-13T00:10:33Z", "author": {"login": "tieujason330"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+if [[ -z ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+  echo \"Alluxio tarball URL cannot be empty\"\n+  exit 1\n+fi\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc files\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+\n+if [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n+  sed -i '' -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*\n+else\n+  sed -i -e \"s|^readonly ALLUXIO_DOWNLOAD_URL.*\\$|readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"|\" ${DIR}/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3MTI5Nw=="}, "originalCommit": {"oid": "02950631b0d191f5cc917376946e9b188536eab5"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTA2NDI5OnYy", "diffSide": "RIGHT", "path": "integration/dataproc/build.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDozOTo1NFrOGUdp7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDozOTo1NFrOGUdp7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMDU3NA==", "bodyText": "this doesn't account for the \"fail to find the string to replace\" scenario\nif i were refactoring the script and renamed ALLUXIO_DOWNLOAD_URL to ALLUXIO_DOWNLOAD_S3_URL, this script would not replace anything but pass.\nif alluxio download url is set {\n  if string to be replaced by (ex. readonly ALLUXIO_DOWNLOAD_URL=.*) isn't found by grep -> fail\n  replace string with perl cmd\n}\n\nit's fine to replace the same string; that's not much of a concern. i brought up the scenario as a counterexample to why using diff wouldn't be as dependable as using grep", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424110574", "createdAt": "2020-05-13T00:39:54Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTA2ODI3OnYy", "diffSide": "RIGHT", "path": "integration/dataproc/build.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDo0MjoyNFrOGUdseg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMToxNTo0MVrOGUeNVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMTIyNg==", "bodyText": "alluxio-emr.sh -> alluxio.sh\nprobably more convenient to make this a bash variable", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424111226", "createdAt": "2020-05-13T00:42:24Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then\n+    echo \"ERROR: ${ALLUXIO_DOWNLOAD_URL} is already set. No change was made to alluxio-emr.sh\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExNzE1Ng==", "bodyText": "it'll be difficult to use build.sh generically if i need to know the file names beforehand", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424117156", "createdAt": "2020-05-13T01:05:46Z", "author": {"login": "tieujason330"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then\n+    echo \"ERROR: ${ALLUXIO_DOWNLOAD_URL} is already set. No change was made to alluxio-emr.sh\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMTIyNg=="}, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExOTYzNg==", "bodyText": "i meant as a bash variable like readonly FILENAME=alluxio.sh, not an argument into the script", "url": "https://github.com/Alluxio/alluxio/pull/11424#discussion_r424119636", "createdAt": "2020-05-13T01:15:41Z", "author": {"login": "Xenorith"}, "path": "integration/dataproc/build.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# Running this script will create edited versions of the files in the .generated directory\n+set -e\n+\n+ALLUXIO_DOWNLOAD_URL=${1}\n+\n+DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" >/dev/null 2>&1 && pwd )\"\n+mkdir -p ${DIR}/.generated\n+cp ${DIR}/alluxio.sh ${DIR}/.generated\n+\n+# replace ALLUXIO_DOWNLOAD_URL in dataproc init script (alluxio.sh)\n+if [[ -n ${ALLUXIO_DOWNLOAD_URL} ]]; then\n+    if [[ -n $(grep \"readonly ALLUXIO_DOWNLOAD_URL=\\\"${ALLUXIO_DOWNLOAD_URL}\\\"\" \"${DIR}/alluxio.sh\") ]]; then\n+    echo \"ERROR: ${ALLUXIO_DOWNLOAD_URL} is already set. No change was made to alluxio-emr.sh\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExMTIyNg=="}, "originalCommit": {"oid": "d517eb54b7312ee4a852699c4cb6fd2b5c228aa5"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1740, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}