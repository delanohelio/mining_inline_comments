{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTEyNjA2", "number": 12100, "title": "Avoid taking snapshot during journal suspension", "bodyText": "When journal is suspended, snapshot should not be taken because some entries included up to the snapshot index might not have been applied by the suspended journal applier.", "createdAt": "2020-09-11T01:23:19Z", "url": "https://github.com/Alluxio/alluxio/pull/12100", "merged": true, "mergeCommit": {"oid": "1184131c8f6bbafa5ddcbcd10e742a11d3a59c57"}, "closed": true, "closedAt": "2020-09-14T21:19:55Z", "author": {"login": "bf8086"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHq_CHAH2gAyNDg0NTEyNjA2OjU2N2I1Njg3OGExMWFkYTQ2Y2NjY2FjN2JkNTMzNTM5YWE2OGZlMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI5kXEAFqTQ4ODEzMjU1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "567b56878a11ada46ccccac7bd533539aa68fe0f", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/567b56878a11ada46ccccac7bd533539aa68fe0f", "committedDate": "2020-09-11T01:19:34Z", "message": "Avoid taking snapshot during journal suspension"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODY5NzQ0", "url": "https://github.com/Alluxio/alluxio/pull/12100#pullrequestreview-487869744", "createdAt": "2020-09-14T15:06:45Z", "commit": {"oid": "567b56878a11ada46ccccac7bd533539aa68fe0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTowNjo0NVrOHRZiuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTowNjo0NVrOHRZiuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwNjMyOQ==", "bodyText": "why added restart follower here", "url": "https://github.com/Alluxio/alluxio/pull/12100#discussion_r488006329", "createdAt": "2020-09-14T15:06:45Z", "author": {"login": "LuQQiu"}, "path": "core/server/common/src/test/java/alluxio/master/journal/raft/RaftJournalTest.java", "diffHunk": "@@ -139,6 +139,50 @@ public void suspendCatchupResume() throws Exception {\n         () -> countingMaster.getApplyCount() == entryCount + 1, mWaitOptions);\n   }\n \n+  @Test\n+  public void suspendSnapshotRestart() throws Exception {\n+    // Create a counting master implementation that counts how many journal entries it processed.\n+    CountingDummyFileSystemMaster countingMaster = new CountingDummyFileSystemMaster();\n+    mFollowerJournalSystem.createJournal(countingMaster);\n+\n+    final int entryCount = 10;\n+    try (JournalContext journalContext =\n+             mLeaderJournalSystem.createJournal(new NoopMaster()).createJournalContext()) {\n+      for (int i = 0; i < entryCount; i++) {\n+        journalContext.append(\n+            alluxio.proto.journal.Journal.JournalEntry.newBuilder().setInodeLastModificationTime(\n+                File.InodeLastModificationTimeEntry.newBuilder().setId(i).build()).build());\n+      }\n+    }\n+\n+    // Suspend follower journal system.\n+    mFollowerJournalSystem.suspend();\n+\n+    // Write more entries which are not applied due to suspension.\n+    try (JournalContext journalContext =\n+             mLeaderJournalSystem.createJournal(new NoopMaster()).createJournalContext()) {\n+      journalContext\n+          .append(alluxio.proto.journal.Journal.JournalEntry.newBuilder()\n+              .setInodeLastModificationTime(\n+                  File.InodeLastModificationTimeEntry.newBuilder().setId(entryCount).build())\n+              .build());\n+    }\n+\n+    // Ask the follower to do a snapshot.\n+    mFollowerJournalSystem.checkpoint();\n+\n+    // Restart the follower.\n+    mFollowerJournalSystem.stop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "567b56878a11ada46ccccac7bd533539aa68fe0f"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDkzNDE0", "url": "https://github.com/Alluxio/alluxio/pull/12100#pullrequestreview-488093414", "createdAt": "2020-09-14T19:53:39Z", "commit": {"oid": "567b56878a11ada46ccccac7bd533539aa68fe0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MTMyNTU3", "url": "https://github.com/Alluxio/alluxio/pull/12100#pullrequestreview-488132557", "createdAt": "2020-09-14T20:52:56Z", "commit": {"oid": "567b56878a11ada46ccccac7bd533539aa68fe0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3572, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}