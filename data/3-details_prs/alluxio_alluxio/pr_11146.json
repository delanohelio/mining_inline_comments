{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NDExMjk1", "number": 11146, "title": "Add logging when RPC or Fuse calls too long", "bodyText": "by setting two new properties\nalluxio.user.logging.threshold=2ms\nalluxio.fuse.logging.threshold=2ms\n\nFuse or client-side RPC calls taking too long will be logged in WARN level like the following:\n2020-03-08 23:40:44,374 WARN  BlockMasterClient - GetBlockMasterInfo(fields=[USED_BYTES, FREE_BYTES, CAPACITY_BYTES]) returned BlockMasterInfo{capacityBytes=11453246122, capacityBytesOnTiers={}, freeBytes=11453237930, liveWorkerNum=0, lostWorkerNum=0, usedBytes=8192, usedBytesOnTiers={}} in 6 ms\n2020-03-08 23:40:44,374 WARN  AlluxioFuseFileSystem - statfs(path=/) returned 0 in 6 ms\n2020-03-08 23:40:44,381 WARN  BlockMasterClient - GetBlockMasterInfo(fields=[USED_BYTES, FREE_BYTES, CAPACITY_BYTES]) returned BlockMasterInfo{capacityBytes=11453246122, capacityBytesOnTiers={}, freeBytes=11453237930, liveWorkerNum=0, lostWorkerNum=0, usedBytes=8192, usedBytesOnTiers={}} in 6 ms\n2020-03-08 23:40:44,381 WARN  AlluxioFuseFileSystem - statfs(path=/) returned 0 in 6 ms", "createdAt": "2020-03-09T06:39:01Z", "url": "https://github.com/Alluxio/alluxio/pull/11146", "merged": true, "mergeCommit": {"oid": "0533b0f985d2e7b4756d53598e4f79d0916d952a"}, "closed": true, "closedAt": "2020-03-10T21:02:47Z", "author": {"login": "apc999"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL4D7_AH2gAyMzg1NDExMjk1OjdkM2ExNGRhZmIyOWVkMzJhNzhmYTQ3YTY0YTEwY2IxYjg4MzkyYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMVkVaAFqTM3MjE0Njc4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7d3a14dafb29ed32a78fa47a64a10cb1b88392c6", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/7d3a14dafb29ed32a78fa47a64a10cb1b88392c6", "committedDate": "2020-03-09T06:38:14Z", "message": "Add logging when RPC or Fuse calls too long"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3ca5bea1c1d9e6df5f90501260599d9f984010", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/8f3ca5bea1c1d9e6df5f90501260599d9f984010", "committedDate": "2020-03-09T18:38:36Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDkwNDI5", "url": "https://github.com/Alluxio/alluxio/pull/11146#pullrequestreview-371490429", "createdAt": "2020-03-09T20:05:19Z", "commit": {"oid": "8f3ca5bea1c1d9e6df5f90501260599d9f984010"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDowNToyMFrOFz3faw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMDowNToyMFrOFz3faw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkzMDg1OQ==", "bodyText": "Do we want to prevent double logging when log level = debug?", "url": "https://github.com/Alluxio/alluxio/pull/11146#discussion_r389930859", "createdAt": "2020-03-09T20:05:20Z", "author": {"login": "LuQQiu"}, "path": "core/common/src/main/java/alluxio/AbstractClient.java", "diffHunk": "@@ -363,13 +366,22 @@ public synchronized InetSocketAddress getConfAddress() throws UnavailableExcepti\n         MetricsSystem.counter(getQualifiedRetryMetricName(rpcName)).inc();\n         return null;\n       });\n-      logger.debug(\"Exit (OK): {}({}) in {} ms\",\n-          rpcName, debugDesc, System.currentTimeMillis() - startMs);\n+      long duration = System.currentTimeMillis() - startMs;\n+      logger.debug(\"Exit (OK): {}({}) in {} ms\", rpcName, debugDesc, duration);\n+      if (duration >= mRpcThreshold) {\n+        logger.warn(\"{}({}) returned {} in {} ms\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3ca5bea1c1d9e6df5f90501260599d9f984010"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f2892afa141bf5aba50bc3ad360937f454b1b8b", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/6f2892afa141bf5aba50bc3ad360937f454b1b8b", "committedDate": "2020-03-10T01:43:50Z", "message": "Fix output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTQ2Nzgz", "url": "https://github.com/Alluxio/alluxio/pull/11146#pullrequestreview-372146783", "createdAt": "2020-03-10T17:00:52Z", "commit": {"oid": "6f2892afa141bf5aba50bc3ad360937f454b1b8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4834, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}