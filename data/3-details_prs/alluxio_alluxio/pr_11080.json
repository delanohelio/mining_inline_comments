{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDQxNzk2", "number": 11080, "title": "Add readiness and liveness probe to Alluxio containers in K8s", "bodyText": "This addresses #11079", "createdAt": "2020-03-01T13:08:46Z", "url": "https://github.com/Alluxio/alluxio/pull/11080", "merged": true, "mergeCommit": {"oid": "ba18c3002371381d26d1e1e6fb0d462fc2351957"}, "closed": true, "closedAt": "2020-03-18T01:47:31Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKvlqYAFqTM2OTc4MTgyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOsm6igBqjMxMzk1NzAwMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzgxODI3", "url": "https://github.com/Alluxio/alluxio/pull/11080#pullrequestreview-369781827", "createdAt": "2020-03-05T17:46:27Z", "commit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo0NjoyN1rOFydjtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo1MTowMVrOFydtEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1NzM5Ng==", "bodyText": "the sooner we move this out to another repository the better", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388457396", "createdAt": "2020-03-05T17:46:27Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/alluxio-fuse.yaml.template", "diffHunk": "@@ -17,23 +17,23 @@ metadata:\n   name: alluxio-fuse\n   labels:\n     app: alluxio\n-    chart: alluxio-0.5.5\n+    chart: alluxio-0.5.6\n     release: alluxio\n     heritage: Tiller\n     role: alluxio-fuse\n spec:\n   selector:\n     matchLabels:\n       app: alluxio\n-      chart: alluxio-0.5.5\n+      chart: alluxio-0.5.6\n       release: alluxio\n       heritage: Tiller\n       role: alluxio-fuse\n   template:\n     metadata:\n       labels:\n         app: alluxio\n-        chart: alluxio-0.5.5\n+        chart: alluxio-0.5.6", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1ODc1OQ==", "bodyText": "What's the difference between readiness and liveness probes?\nCorrect me if I'm wrong, but from my interpretation\n\nreadiness is \"ready to serve\". Can be done via RPC.\nliveness is \"is the process/service up, but not necessarily ready to serve clients\". I don't think we have a good check for this.\n\nIt just seems odd we seem to be doing the same thing for two different probes", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388458759", "createdAt": "2020-03-05T17:49:08Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTc5Mw==", "bodyText": "Where exactly are these being executed from? Right now it assumed ${ALLUXIO_HOME} but is that always the case?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388459793", "createdAt": "2020-03-05T17:51:01Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+  initialDelaySeconds: 15\n+  periodSeconds: 30\n+  timeoutSeconds: 5\n+  failureThreshold: 2\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODEzNzk1", "url": "https://github.com/Alluxio/alluxio/pull/11080#pullrequestreview-370813795", "createdAt": "2020-03-08T08:43:39Z", "commit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0MzozOVrOFzT8JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NzowN1rOFzT9Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODM4OA==", "bodyText": "why is this not the job worker probe?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348388", "createdAt": "2020-03-08T08:43:39Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "diffHunk": "@@ -121,6 +123,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ template \"alluxio.fullname\" . }}-config\n+{{ include \"alluxio.worker.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODQyNQ==", "bodyText": "why is this not the job master probe?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348425", "createdAt": "2020-03-08T08:44:02Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -150,6 +152,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ $fullName }}-config\n+{{ include \"alluxio.master.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODY1NA==", "bodyText": "you can use the command as alluxio-monitor.sh directly as in the docker file we add bin to the path ENV PATH=\"/opt/alluxio/bin:${PATH}\"", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348654", "createdAt": "2020-03-08T08:47:07Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+  initialDelaySeconds: 15\n+  periodSeconds: 30\n+  timeoutSeconds: 5\n+  failureThreshold: 2\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTc5Mw=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODUwMTk1", "url": "https://github.com/Alluxio/alluxio/pull/11080#pullrequestreview-370850195", "createdAt": "2020-03-08T18:51:15Z", "commit": {"oid": "56b7beb5bc5183e06c9adfabc817520dc7917da8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d9b63daec9c0b20d19ccdf79e3fce4f1269d743", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/5d9b63daec9c0b20d19ccdf79e3fce4f1269d743", "committedDate": "2020-03-18T00:56:47Z", "message": "add readiness probe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33989f53bf0758899cf87810022af9f943556439", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/33989f53bf0758899cf87810022af9f943556439", "committedDate": "2020-03-18T00:59:03Z", "message": "add liveness probe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54508b84e695c6a1e08b2fd7ca0f7755d6e70bfe", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/54508b84e695c6a1e08b2fd7ca0f7755d6e70bfe", "committedDate": "2020-03-18T00:59:03Z", "message": "changed readiness probe to alluxio-monitor.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db82a38c83d54328eb41214d3bdd7d57c32f48e9", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/db82a38c83d54328eb41214d3bdd7d57c32f48e9", "committedDate": "2020-03-18T00:59:04Z", "message": "update cmd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d3c345d91d3125823f6a484ff4de26dd49fb474", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/0d3c345d91d3125823f6a484ff4de26dd49fb474", "committedDate": "2020-03-18T00:59:04Z", "message": "use job_master and job_worker probes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56b7beb5bc5183e06c9adfabc817520dc7917da8", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/56b7beb5bc5183e06c9adfabc817520dc7917da8", "committedDate": "2020-03-08T17:54:34Z", "message": "use job_master and job_worker probes"}, "afterCommit": {"oid": "0d3c345d91d3125823f6a484ff4de26dd49fb474", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/0d3c345d91d3125823f6a484ff4de26dd49fb474", "committedDate": "2020-03-18T00:59:04Z", "message": "use job_master and job_worker probes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4794, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}