{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzA4ODcy", "number": 11984, "title": "Trim java opts when applying them in the command line", "bodyText": "This affects running benchmarks because job master and command line processes spaces differently.\nIt can cause benchmark jobs to fail.", "createdAt": "2020-08-14T00:52:32Z", "url": "https://github.com/Alluxio/alluxio/pull/11984", "merged": true, "mergeCommit": {"oid": "d37dac484fc6206125014e58abf7b8ff9ac6d4b7"}, "closed": true, "closedAt": "2020-08-19T21:00:13Z", "author": {"login": "yuzhu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_6gxYAFqTQ2ODg4MzQwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAMcZngBqjM2Njc4NjU4Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODgzNDA5", "url": "https://github.com/Alluxio/alluxio/pull/11984#pullrequestreview-468883409", "createdAt": "2020-08-17T22:53:29Z", "commit": {"oid": "bbb8cac4e14ff67ada050995f993e3a09e6d1e10"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjo1MzoyOVrOHB9dgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjo1MzoyOVrOHB9dgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgxNzYwMg==", "bodyText": "The java opts are intentionally passed to the spawned tasks, so that the tasks can also be started with a larger mem size", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471817602", "createdAt": "2020-08-17T22:53:29Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,10 +87,12 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbb8cac4e14ff67ada050995f993e3a09e6d1e10"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64f65ef156a3177a6050bff9f0c2fa93b3520d50", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/64f65ef156a3177a6050bff9f0c2fa93b3520d50", "committedDate": "2020-08-18T02:03:22Z", "message": "fix minor space issue"}, "afterCommit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/508c24614f46ccef945b476561917697aeaa4a08", "committedDate": "2020-08-18T05:28:17Z", "message": "make passing jvm option easier in command line\n\nfix trim location\n\nremove java opt and prevent it from recursively passed to jobworker\n\nremove trim\n\nfix checkstyle\n\nfix minor space issue\n\nfix minor space issue\n\nfix minor space issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MDAyOTEw", "url": "https://github.com/Alluxio/alluxio/pull/11984#pullrequestreview-469002910", "createdAt": "2020-08-18T05:35:20Z", "commit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTozNToyMVrOHCEAnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTozNjoxOVrOHCEB1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNDg5Mg==", "bodyText": "when are the java opts used?", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471924892", "createdAt": "2020-08-18T05:35:21Z", "author": {"login": "yuzhu"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,10 +87,12 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgxNzYwMg=="}, "originalCommit": {"oid": "bbb8cac4e14ff67ada050995f993e3a09e6d1e10"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNTIwNA==", "bodyText": "the JavaOpts is applied to the job launch process here. are you saying there is another level of launching jobs within the job?", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471925204", "createdAt": "2020-08-18T05:36:19Z", "author": {"login": "yuzhu"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,12 +87,15 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts\n     List<String> commandArgs =\n-            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n-                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+            Arrays.stream(args).filter((s) -> !BaseParameters.JAVA_OPT_FLAG.equals(s)\n+                && !BaseParameters.CLUSTER_FLAG.equals(s)\n+                && !s.isEmpty()\n+                && !mBaseParameters.mJavaOpts.contains(s)).collect(Collectors.toList());\n \n-    commandArgs.addAll(mBaseParameters.mJavaOpts);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NjUzMzMw", "url": "https://github.com/Alluxio/alluxio/pull/11984#pullrequestreview-469653330", "createdAt": "2020-08-18T17:03:45Z", "commit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzowMzo0NVrOHCdz1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzowMzo0NVrOHCdz1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM0NzYwNg==", "bodyText": "basically, all job tasks on the workers also spawn processes, to make it look exactly like it would have if it was run locally (not in cluster mode). https://github.com/Alluxio/alluxio/blob/master/job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java#L114\nI just want to make sure if we set java opts for max mem, that it will affect local mode, as well as cluster mode, all in the same way.", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r472347606", "createdAt": "2020-08-18T17:03:45Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,12 +87,15 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts\n     List<String> commandArgs =\n-            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n-                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+            Arrays.stream(args).filter((s) -> !BaseParameters.JAVA_OPT_FLAG.equals(s)\n+                && !BaseParameters.CLUSTER_FLAG.equals(s)\n+                && !s.isEmpty()\n+                && !mBaseParameters.mJavaOpts.contains(s)).collect(Collectors.toList());\n \n-    commandArgs.addAll(mBaseParameters.mJavaOpts);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNTIwNA=="}, "originalCommit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dad94cf936bfcc0fcb3baf602fa325598f2749f5", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/dad94cf936bfcc0fcb3baf602fa325598f2749f5", "committedDate": "2020-08-18T19:46:50Z", "message": "make passing jvm option easier in command line\n\nfix trim location\n\nremove java opt and prevent it from recursively passed to jobworker\n\nremove trim\n\nfix checkstyle\n\nfix minor space issue\n\nfix minor space issue\n\nfix minor space issue\n\nretain javaopts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b0a26f5d71f24a668140ac67ded70a3bf7bdf1a", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/2b0a26f5d71f24a668140ac67ded70a3bf7bdf1a", "committedDate": "2020-08-18T19:45:42Z", "message": "retain javaopts"}, "afterCommit": {"oid": "dad94cf936bfcc0fcb3baf602fa325598f2749f5", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/dad94cf936bfcc0fcb3baf602fa325598f2749f5", "committedDate": "2020-08-18T19:46:50Z", "message": "make passing jvm option easier in command line\n\nfix trim location\n\nremove java opt and prevent it from recursively passed to jobworker\n\nremove trim\n\nfix checkstyle\n\nfix minor space issue\n\nfix minor space issue\n\nfix minor space issue\n\nretain javaopts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4139, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}