{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODM0ODAw", "number": 11422, "title": "Add a HDFS throughput testing tool", "bodyText": "This change adds a UFS I/O speed test tool using the new Benchmark framework.\n$ bin/alluxio runUfsIOTest --threads 8 --io-size 4G --path hdfs://<hdfs-node>:9000/alluxio/ --cluster-limit --cluster > io.json\n$ bin/alluxio runClass alluxio.stress.cli.report.GenerateReport --input io.json  --output ./io.html\n\nThe workflow above produces the I/O speed test result with graph like below\n\nA collected stats (UfsIOBench output) example is like below:\n{\n  \"points\" : [ {\n    \"mMode\" : \"WRITE\",\n    \"mDuration\" : 15.535,\n    \"mDataSizeMB\" : 256,\n    \"className\" : \"alluxio.stress.worker.IOTaskResult$Point\"\n  }, {\n    \"mMode\" : \"WRITE\",\n    \"mDuration\" : 15.582,\n    \"mDataSizeMB\" : 256,\n    \"className\" : \"alluxio.stress.worker.IOTaskResult$Point\"\n  }, {\n    \"mMode\" : \"WRITE\",\n    \"mDuration\" : 15.59,\n    \"mDataSizeMB\" : 256,\n    \"className\" : \"alluxio.stress.worker.IOTaskResult$Point\"\n  }, ... , {\n    \"mMode\" : \"READ\",\n    \"mDuration\" : 0.376,\n    \"mDataSizeMB\" : 256,\n    \"className\" : \"alluxio.stress.worker.IOTaskResult$Point\"\n  } ],\n  \"errors\" : [ ],\n  \"baseParameters\" : {\n    \"mCluster\" : false,\n    \"mId\" : \"HadoopSandbox-566-masters-1-1589901871455\",\n    \"mJavaOpts\" : [ ],\n    \"mDistributed\" : true,\n    \"mStartMs\" : 1589902562343,\n    \"mInProcess\" : true\n  },\n  \"readSpeedStat\" : {\n    \"totalDuration\" : \"3.017s\",\n    \"totalSize\" : \"2048MB\",\n    \"maxSpeed\" : \"815.2866242038217MB/s\",\n    \"minSpeed\" : \"632.0987654320987MB/s\",\n    \"avgSpeed\" : \"678.8200198873053MB/s\",\n    \"stdDev\" : 151.33247300467477\n  },\n  \"writeSpeedStat\" : {\n    \"totalDuration\" : \"124.41s\",\n    \"totalSize\" : \"2048MB\",\n    \"maxSpeed\" : \"16.504416220746567MB/s\",\n    \"minSpeed\" : \"16.42078255291854MB/s\",\n    \"avgSpeed\" : \"16.46169922031991MB/s\",\n    \"stdDev\" : 0.0889953940200876\n  },\n  \"parameters\" : {\n    \"mThreads\" : 8,\n    \"mDataSize\" : 256,\n    \"mPath\" : \"hdfs://HadoopSandbox-566-masters-1:9000/alluxio/\",\n    \"mWorkerNum\" : 1\n  },\n  \"className\" : \"alluxio.stress.worker.IOTaskSummary\"\n}", "createdAt": "2020-05-12T16:26:40Z", "url": "https://github.com/Alluxio/alluxio/pull/11422", "merged": true, "mergeCommit": {"oid": "63606ed6c815fc7f3b19ca36ca5046852c6e51cc"}, "closed": true, "closedAt": "2020-06-05T17:47:15Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 70, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgcNiLgH2gAyNDE2ODM0ODAwOmVjNzcxZDRlZDQ4Yzk5MDAxYWEzOTMwOTgwM2UwODM5MDYwNWM5YTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoVIZjAFqTQyNTQ0MzcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec771d4ed48c99001aa39309803e08390605c9a4", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ec771d4ed48c99001aa39309803e08390605c9a4", "committedDate": "2020-05-12T04:03:47Z", "message": "use new benchmark framework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e6fa01f8101b493fda23bccc663f6c4ec37c94e", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1e6fa01f8101b493fda23bccc663f6c4ec37c94e", "committedDate": "2020-05-12T15:20:33Z", "message": "nothings works but it compiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c668b965c4484a8441b98c912f2e1d7cb87efbf", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1c668b965c4484a8441b98c912f2e1d7cb87efbf", "committedDate": "2020-05-13T03:04:23Z", "message": "pre-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f46b27076424ba986e217cd19857ffc53f7c27", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/54f46b27076424ba986e217cd19857ffc53f7c27", "committedDate": "2020-05-14T14:05:15Z", "message": "adding unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c2d1466a4b3ad60da0f68d7ecb78418374ec6d5", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/9c2d1466a4b3ad60da0f68d7ecb78418374ec6d5", "committedDate": "2020-05-15T04:36:16Z", "message": "debug log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfbdac466105bd6f692b818895ae2fad1dff0277", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/cfbdac466105bd6f692b818895ae2fad1dff0277", "committedDate": "2020-05-15T04:47:46Z", "message": "debug log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6c4d88df0da003efd18358e09996d74fc578c9b", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/e6c4d88df0da003efd18358e09996d74fc578c9b", "committedDate": "2020-05-15T05:12:05Z", "message": "add main()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "756b78869c0a3b45d5e7969bde10cd9620cea091", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/756b78869c0a3b45d5e7969bde10cd9620cea091", "committedDate": "2020-05-15T05:32:38Z", "message": "ufs api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6810ad9cd34cdd0186192bb27634b38d84e1b896", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/6810ad9cd34cdd0186192bb27634b38d84e1b896", "committedDate": "2020-05-15T06:26:52Z", "message": "change to ufs path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67afdfcc388deea6195f7cbc832d9502482d8fde", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/67afdfcc388deea6195f7cbc832d9502482d8fde", "committedDate": "2020-05-16T12:55:51Z", "message": "add logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fa0e2e96cc217723d2911069d40531da54718fb", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1fa0e2e96cc217723d2911069d40531da54718fb", "committedDate": "2020-05-16T13:00:52Z", "message": "fix errs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "578cddf409afeaa1621d5628ea142048e803ee5f", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/578cddf409afeaa1621d5628ea142048e803ee5f", "committedDate": "2020-05-16T13:21:00Z", "message": "add logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab6325d338a06de2aadb0a798753e824168a578", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/2ab6325d338a06de2aadb0a798753e824168a578", "committedDate": "2020-05-16T13:29:51Z", "message": "err log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea9ccb0e6c75bf760c4b20320ca193205f9d7065", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ea9ccb0e6c75bf760c4b20320ca193205f9d7065", "committedDate": "2020-05-17T11:04:51Z", "message": "hdfs debug logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f6304b789026e2ca447e034323b251ffe9a1f92", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/9f6304b789026e2ca447e034323b251ffe9a1f92", "committedDate": "2020-05-17T11:40:33Z", "message": "is path format wrong?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43b68348c6875dd1608142ba1f4b4f6ea5758f06", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/43b68348c6875dd1608142ba1f4b4f6ea5758f06", "committedDate": "2020-05-17T11:45:26Z", "message": "grammar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "545de97f833b68a4dc0b827fa3fabd015e93e1b0", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/545de97f833b68a4dc0b827fa3fabd015e93e1b0", "committedDate": "2020-05-17T12:11:31Z", "message": "flushing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ecbf6cb23c4a3408cf3211e88c70c6514e8d4d8", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/4ecbf6cb23c4a3408cf3211e88c70c6514e8d4d8", "committedDate": "2020-05-17T12:26:59Z", "message": "read()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c14361878dd54a94682022a772dd9b41a60c5c6", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/9c14361878dd54a94682022a772dd9b41a60c5c6", "committedDate": "2020-05-17T12:39:02Z", "message": "read"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f6eb896bd18b32b8fc755e3c01ec6067dee8deb", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/2f6eb896bd18b32b8fc755e3c01ec6067dee8deb", "committedDate": "2020-05-18T05:01:37Z", "message": "remove READ WRITE mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3439a634b1390299edaf6f6562bc78437f31b058", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/3439a634b1390299edaf6f6562bc78437f31b058", "committedDate": "2020-05-18T05:22:46Z", "message": "update class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55550be1cdd6de2da055f03756690870a70fdf81", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/55550be1cdd6de2da055f03756690870a70fdf81", "committedDate": "2020-05-18T07:28:02Z", "message": "task summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "343d5d96efc2d0a26fa9c1d4ca5f6d6231662b96", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/343d5d96efc2d0a26fa9c1d4ca5f6d6231662b96", "committedDate": "2020-05-18T08:03:28Z", "message": "serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77f20d8f07cd44f978a321660d9485ced81a4aa", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/d77f20d8f07cd44f978a321660d9485ced81a4aa", "committedDate": "2020-05-18T08:14:02Z", "message": "add IODefinition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dcdebc646a2562d62c98e734c071f4c8e5bd547", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/6dcdebc646a2562d62c98e734c071f4c8e5bd547", "committedDate": "2020-05-18T08:27:27Z", "message": "parse job output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b5e9ab30d8eda4e3c26d9e19e5e83e5ce42d1eb", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/8b5e9ab30d8eda4e3c26d9e19e5e83e5ce42d1eb", "committedDate": "2020-05-18T10:18:22Z", "message": "better stats calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98758ffd75b3f9bad9ebe3b166601ddc50bc633a", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/98758ffd75b3f9bad9ebe3b166601ddc50bc633a", "committedDate": "2020-05-18T14:46:15Z", "message": "better stat formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10aec84f7ec8a13106e1431cd990da18edadf8cc", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/10aec84f7ec8a13106e1431cd990da18edadf8cc", "committedDate": "2020-05-19T07:51:11Z", "message": "add graph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23643495696dbe4af42ab404f55d0601f5eb06a", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/e23643495696dbe4af42ab404f55d0601f5eb06a", "committedDate": "2020-05-19T08:53:36Z", "message": "fix stat error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f1b78b2fd92653352595b4728e863bd8ba870d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/91f1b78b2fd92653352595b4728e863bd8ba870d", "committedDate": "2020-05-19T10:36:59Z", "message": "deserialize IOTaskSummary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a11eaec3a4c1f627b39a1df5c20f466fa233a092", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a11eaec3a4c1f627b39a1df5c20f466fa233a092", "committedDate": "2020-05-19T12:18:26Z", "message": "better graph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22b94e94a750d829a5368546c6195408bcbe248d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/22b94e94a750d829a5368546c6195408bcbe248d", "committedDate": "2020-05-19T13:52:03Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96db45cefbc4383ab6f7c7364639fa2bd6da5592", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/96db45cefbc4383ab6f7c7364639fa2bd6da5592", "committedDate": "2020-05-19T14:00:04Z", "message": "fix deserializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba1b1497ce2cb8171f95fd28fe2406ebd50d42cc", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ba1b1497ce2cb8171f95fd28fe2406ebd50d42cc", "committedDate": "2020-05-19T14:11:08Z", "message": "static deserializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ded15217e52f154ab8d35409041773d361beda73", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ded15217e52f154ab8d35409041773d361beda73", "committedDate": "2020-05-19T15:19:16Z", "message": "distinguish graph series"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjM3NDEw", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-417237410", "createdAt": "2020-05-23T01:09:54Z", "commit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMTowOTo1NFrOGZmocA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMjowNDowNlrOGZm4xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMDUyOA==", "bodyText": "never used?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429500528", "createdAt": "2020-05-23T01:09:54Z", "author": {"login": "madanadit"}, "path": "core/common/src/main/java/alluxio/util/CommonUtils.java", "diffHunk": "@@ -191,6 +191,16 @@ public static String getWorkerDataDirectory(String storageDir, AlluxioConfigurat\n     return src.toArray(ret);\n   }\n \n+  /**\n+   * Generates a random integer with the given bound.\n+   *\n+   * @param bound the upper bound\n+   * @return a random int\n+   */\n+  public static int randomInt(int bound) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMDkxNQ==", "bodyText": "why is this in a separate line and what is the value?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429500915", "createdAt": "2020-05-23T01:14:37Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTI0Mw==", "bodyText": "this seems to be almost the same as StressBenchDefinition, can we remove the redundancy?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501243", "createdAt": "2020-05-23T01:18:33Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());\n+    }\n+\n+    AtomicReference<IOException> error = new AtomicReference<>(null);\n+    List<IOTaskResult> results = taskResults.entrySet().stream().map(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTQxMQ==", "bodyText": "nit: combine in the if above as if (cnt-- <= 0)", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501411", "createdAt": "2020-05-23T01:20:31Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());\n+    }\n+\n+    AtomicReference<IOException> error = new AtomicReference<>(null);\n+    List<IOTaskResult> results = taskResults.entrySet().stream().map(\n+            entry -> {\n+              try {\n+                return JsonSerializable.fromJson(entry.getValue().trim(), new IOTaskResult[0]);\n+              } catch (IOException | ClassNotFoundException e) {\n+                error.set(new IOException(String\n+                        .format(\"Failed to parse task output from %s into result class\",\n+                                entry.getKey().getAddress().getHost()), e));\n+              }\n+              return null;\n+            }).collect(Collectors.toList());\n+\n+    if (error.get() != null) {\n+      throw error.get();\n+    }\n+\n+    return results.get(0).aggregator().aggregate(results).toJson();\n+  }\n+\n+  @Override\n+  public Set<Pair<WorkerInfo, ArrayList<String>>> selectExecutors(\n+          IOConfig config, List<WorkerInfo> jobWorkerInfoList,\n+          SelectExecutorsContext selectExecutorsContext) throws Exception {\n+    Set<Pair<WorkerInfo, ArrayList<String>>> result = Sets.newHashSet();\n+\n+    // Randomly select N workers\n+    Collections.shuffle(jobWorkerInfoList);\n+    int cnt = config.getWorkerNum();\n+    for (WorkerInfo worker : jobWorkerInfoList) {\n+      if (cnt <= 0) {\n+        break;\n+      }\n+      ArrayList<String> args = new ArrayList<>(2);\n+      // Add the worker hostname + worker id as the unique task id for each distributed task.\n+      // The worker id is used since there may be multiple workers on a single host.\n+      args.add(BaseParameters.ID_FLAG);\n+      args.add(worker.getAddress().getHost() + \"-\" + worker.getId());\n+      result.add(new Pair<>(worker, args));\n+      cnt--;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTQ4Nw==", "bodyText": "this is redundant again, a utility function?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501487", "createdAt": "2020-05-23T01:21:22Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());\n+    }\n+\n+    AtomicReference<IOException> error = new AtomicReference<>(null);\n+    List<IOTaskResult> results = taskResults.entrySet().stream().map(\n+            entry -> {\n+              try {\n+                return JsonSerializable.fromJson(entry.getValue().trim(), new IOTaskResult[0]);\n+              } catch (IOException | ClassNotFoundException e) {\n+                error.set(new IOException(String\n+                        .format(\"Failed to parse task output from %s into result class\",\n+                                entry.getKey().getAddress().getHost()), e));\n+              }\n+              return null;\n+            }).collect(Collectors.toList());\n+\n+    if (error.get() != null) {\n+      throw error.get();\n+    }\n+\n+    return results.get(0).aggregator().aggregate(results).toJson();\n+  }\n+\n+  @Override\n+  public Set<Pair<WorkerInfo, ArrayList<String>>> selectExecutors(\n+          IOConfig config, List<WorkerInfo> jobWorkerInfoList,\n+          SelectExecutorsContext selectExecutorsContext) throws Exception {\n+    Set<Pair<WorkerInfo, ArrayList<String>>> result = Sets.newHashSet();\n+\n+    // Randomly select N workers\n+    Collections.shuffle(jobWorkerInfoList);\n+    int cnt = config.getWorkerNum();\n+    for (WorkerInfo worker : jobWorkerInfoList) {\n+      if (cnt <= 0) {\n+        break;\n+      }\n+      ArrayList<String> args = new ArrayList<>(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTU3Mg==", "bodyText": "same redundancy here", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501572", "createdAt": "2020-05-23T01:22:16Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());\n+    }\n+\n+    AtomicReference<IOException> error = new AtomicReference<>(null);\n+    List<IOTaskResult> results = taskResults.entrySet().stream().map(\n+            entry -> {\n+              try {\n+                return JsonSerializable.fromJson(entry.getValue().trim(), new IOTaskResult[0]);\n+              } catch (IOException | ClassNotFoundException e) {\n+                error.set(new IOException(String\n+                        .format(\"Failed to parse task output from %s into result class\",\n+                                entry.getKey().getAddress().getHost()), e));\n+              }\n+              return null;\n+            }).collect(Collectors.toList());\n+\n+    if (error.get() != null) {\n+      throw error.get();\n+    }\n+\n+    return results.get(0).aggregator().aggregate(results).toJson();\n+  }\n+\n+  @Override\n+  public Set<Pair<WorkerInfo, ArrayList<String>>> selectExecutors(\n+          IOConfig config, List<WorkerInfo> jobWorkerInfoList,\n+          SelectExecutorsContext selectExecutorsContext) throws Exception {\n+    Set<Pair<WorkerInfo, ArrayList<String>>> result = Sets.newHashSet();\n+\n+    // Randomly select N workers\n+    Collections.shuffle(jobWorkerInfoList);\n+    int cnt = config.getWorkerNum();\n+    for (WorkerInfo worker : jobWorkerInfoList) {\n+      if (cnt <= 0) {\n+        break;\n+      }\n+      ArrayList<String> args = new ArrayList<>(2);\n+      // Add the worker hostname + worker id as the unique task id for each distributed task.\n+      // The worker id is used since there may be multiple workers on a single host.\n+      args.add(BaseParameters.ID_FLAG);\n+      args.add(worker.getAddress().getHost() + \"-\" + worker.getId());\n+      result.add(new Pair<>(worker, args));\n+      cnt--;\n+    }\n+    return result;\n+  }\n+\n+  @Override\n+  public String runTask(IOConfig config, ArrayList<String> args, RunTaskContext runTaskContext)\n+          throws Exception {\n+    LOG.info(\"args={}\", args);\n+\n+    List<String> command = new ArrayList<>(3 + config.getArgs().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTY0OQ==", "bodyText": "can we have a wrapper called alluxio runUfsIOTests over runClass+report?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501649", "createdAt": "2020-05-23T01:23:13Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+import com.google.common.collect.Sets;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {\n+  private static final Logger LOG = LoggerFactory.getLogger(IODefinition.class);\n+\n+  @Override\n+  public Class<IOConfig> getJobConfigClass() {\n+    return IOConfig.class;\n+  }\n+\n+  @Override\n+  public String join(IOConfig config, Map<WorkerInfo, String> taskResults) throws Exception {\n+    if (taskResults.isEmpty()) {\n+      throw new IOException(\"No results from any workers.\");\n+    }\n+    LOG.info(\"join()\");\n+    for(Map.Entry<WorkerInfo, String> entry : taskResults.entrySet()) {\n+      LOG.info(\"worker={}\", entry.getKey());\n+      LOG.info(\"{}\", entry.getValue());\n+    }\n+\n+    AtomicReference<IOException> error = new AtomicReference<>(null);\n+    List<IOTaskResult> results = taskResults.entrySet().stream().map(\n+            entry -> {\n+              try {\n+                return JsonSerializable.fromJson(entry.getValue().trim(), new IOTaskResult[0]);\n+              } catch (IOException | ClassNotFoundException e) {\n+                error.set(new IOException(String\n+                        .format(\"Failed to parse task output from %s into result class\",\n+                                entry.getKey().getAddress().getHost()), e));\n+              }\n+              return null;\n+            }).collect(Collectors.toList());\n+\n+    if (error.get() != null) {\n+      throw error.get();\n+    }\n+\n+    return results.get(0).aggregator().aggregate(results).toJson();\n+  }\n+\n+  @Override\n+  public Set<Pair<WorkerInfo, ArrayList<String>>> selectExecutors(\n+          IOConfig config, List<WorkerInfo> jobWorkerInfoList,\n+          SelectExecutorsContext selectExecutorsContext) throws Exception {\n+    Set<Pair<WorkerInfo, ArrayList<String>>> result = Sets.newHashSet();\n+\n+    // Randomly select N workers\n+    Collections.shuffle(jobWorkerInfoList);\n+    int cnt = config.getWorkerNum();\n+    for (WorkerInfo worker : jobWorkerInfoList) {\n+      if (cnt <= 0) {\n+        break;\n+      }\n+      ArrayList<String> args = new ArrayList<>(2);\n+      // Add the worker hostname + worker id as the unique task id for each distributed task.\n+      // The worker id is used since there may be multiple workers on a single host.\n+      args.add(BaseParameters.ID_FLAG);\n+      args.add(worker.getAddress().getHost() + \"-\" + worker.getId());\n+      result.add(new Pair<>(worker, args));\n+      cnt--;\n+    }\n+    return result;\n+  }\n+\n+  @Override\n+  public String runTask(IOConfig config, ArrayList<String> args, RunTaskContext runTaskContext)\n+          throws Exception {\n+    LOG.info(\"args={}\", args);\n+\n+    List<String> command = new ArrayList<>(3 + config.getArgs().size());\n+    command.add(ServerConfiguration.get(PropertyKey.HOME) + \"/bin/alluxio\");\n+    command.add(\"runClass\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTcyMA==", "bodyText": "nit: debug? the same for the other new logs in this file", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501720", "createdAt": "2020-05-23T01:24:05Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -68,13 +68,17 @@ public StressBenchDefinition() {\n       args.add(BaseParameters.ID_FLAG);\n       args.add(worker.getAddress().getHost() + \"-\" + worker.getId());\n       result.add(new Pair<>(worker, args));\n+      LOG.info(\"selectExecutors() args={}\", args);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTc4OQ==", "bodyText": "remove this and following our.println?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501789", "createdAt": "2020-05-23T01:25:07Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -68,13 +68,17 @@ public StressBenchDefinition() {\n       args.add(BaseParameters.ID_FLAG);\n       args.add(worker.getAddress().getHost() + \"-\" + worker.getId());\n       result.add(new Pair<>(worker, args));\n+      LOG.info(\"selectExecutors() args={}\", args);\n     }\n     return result;\n   }\n \n   @Override\n   public String runTask(StressBenchConfig config, ArrayList<String> args,\n       RunTaskContext runTaskContext) throws Exception {\n+    LOG.info(\"Args: {}\", args);\n+    System.out.println(\"Running here \"+ args);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTgwNw==", "bodyText": "debug?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429501807", "createdAt": "2020-05-23T01:25:22Z", "author": {"login": "madanadit"}, "path": "job/server/src/main/java/alluxio/master/job/JobMaster.java", "diffHunk": "@@ -241,6 +241,7 @@ public synchronized void run(JobConfig jobConfig, long jobId)\n     Context forkedCtx = Context.current().fork();\n     Context prevCtx = forkedCtx.attach();\n     try {\n+      LOG.info(\"jobConfig class {}\", jobConfig.getClass().getCanonicalName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDA3Mw==", "bodyText": "?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504073", "createdAt": "2020-05-23T01:55:29Z", "author": {"login": "madanadit"}, "path": "job/server/src/test/java/alluxio/job/plan/io/IODefinitionTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.AlluxioURI;\n+import alluxio.ClientContext;\n+import alluxio.client.block.AlluxioBlockStore;\n+import alluxio.client.file.FileSystem;\n+import alluxio.client.file.FileSystemContext;\n+import alluxio.collections.Pair;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.JobServerContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.load.LoadDefinition;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UfsManager;\n+import alluxio.wire.WorkerInfo;\n+import alluxio.wire.WorkerNetAddress;\n+import com.google.common.collect.ImmutableList;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mockito;\n+import org.powermock.api.mockito.PowerMockito;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Matchers.any;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, JobServerContext.class, FileSystemContext.class,\n+        AlluxioBlockStore.class})\n+public class IODefinitionTest {\n+    private static final List<WorkerInfo> JOB_WORKERS = new ImmutableList.Builder<WorkerInfo>()\n+            .add(new WorkerInfo().setId(0).setAddress(new WorkerNetAddress().setHost(\"host0\")))\n+            .add(new WorkerInfo().setId(1).setAddress(new WorkerNetAddress().setHost(\"host1\")))\n+            .add(new WorkerInfo().setId(2).setAddress(new WorkerNetAddress().setHost(\"host2\")))\n+            .add(new WorkerInfo().setId(3).setAddress(new WorkerNetAddress().setHost(\"host3\"))).build();\n+\n+    private JobServerContext mJobServerContext;\n+    private FileSystem mMockFileSystem;\n+    private AlluxioBlockStore mMockBlockStore;\n+    private FileSystemContext mMockFsContext;\n+\n+    @Before\n+    public void before() {\n+        mMockFileSystem = PowerMockito.mock(FileSystem.class);\n+        mMockBlockStore = PowerMockito.mock(AlluxioBlockStore.class);\n+        mMockFsContext = PowerMockito.mock(FileSystemContext.class);\n+        PowerMockito.mockStatic(AlluxioBlockStore.class);\n+        PowerMockito.when(AlluxioBlockStore.create(any(FileSystemContext.class)))\n+                .thenReturn(mMockBlockStore);\n+        PowerMockito.when(mMockFsContext.getClientContext())\n+                .thenReturn(ClientContext.create(ServerConfiguration.global()));\n+        // TODO(jiacheng): need to hijack this conf?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDA4Ng==", "bodyText": "?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504086", "createdAt": "2020-05-23T01:55:35Z", "author": {"login": "madanadit"}, "path": "job/server/src/test/java/alluxio/job/plan/io/IODefinitionTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.AlluxioURI;\n+import alluxio.ClientContext;\n+import alluxio.client.block.AlluxioBlockStore;\n+import alluxio.client.file.FileSystem;\n+import alluxio.client.file.FileSystemContext;\n+import alluxio.collections.Pair;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.JobServerContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.load.LoadDefinition;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UfsManager;\n+import alluxio.wire.WorkerInfo;\n+import alluxio.wire.WorkerNetAddress;\n+import com.google.common.collect.ImmutableList;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mockito;\n+import org.powermock.api.mockito.PowerMockito;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Matchers.any;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, JobServerContext.class, FileSystemContext.class,\n+        AlluxioBlockStore.class})\n+public class IODefinitionTest {\n+    private static final List<WorkerInfo> JOB_WORKERS = new ImmutableList.Builder<WorkerInfo>()\n+            .add(new WorkerInfo().setId(0).setAddress(new WorkerNetAddress().setHost(\"host0\")))\n+            .add(new WorkerInfo().setId(1).setAddress(new WorkerNetAddress().setHost(\"host1\")))\n+            .add(new WorkerInfo().setId(2).setAddress(new WorkerNetAddress().setHost(\"host2\")))\n+            .add(new WorkerInfo().setId(3).setAddress(new WorkerNetAddress().setHost(\"host3\"))).build();\n+\n+    private JobServerContext mJobServerContext;\n+    private FileSystem mMockFileSystem;\n+    private AlluxioBlockStore mMockBlockStore;\n+    private FileSystemContext mMockFsContext;\n+\n+    @Before\n+    public void before() {\n+        mMockFileSystem = PowerMockito.mock(FileSystem.class);\n+        mMockBlockStore = PowerMockito.mock(AlluxioBlockStore.class);\n+        mMockFsContext = PowerMockito.mock(FileSystemContext.class);\n+        PowerMockito.mockStatic(AlluxioBlockStore.class);\n+        PowerMockito.when(AlluxioBlockStore.create(any(FileSystemContext.class)))\n+                .thenReturn(mMockBlockStore);\n+        PowerMockito.when(mMockFsContext.getClientContext())\n+                .thenReturn(ClientContext.create(ServerConfiguration.global()));\n+        // TODO(jiacheng): need to hijack this conf?\n+        PowerMockito.when(mMockFsContext.getClusterConf()).thenReturn(ServerConfiguration.global());\n+        PowerMockito.when(mMockFsContext.getPathConf(any(AlluxioURI.class)))\n+                .thenReturn(ServerConfiguration.global());\n+        mJobServerContext = new JobServerContext(mMockFileSystem, mMockFsContext,\n+                Mockito.mock(UfsManager.class));\n+    }\n+\n+    @Test\n+    public void selectExecutor() throws Exception {\n+        Set<WorkerInfo> workerSet = new HashSet<>(JOB_WORKERS);\n+        IOConfig jobConfig = new IOConfig(IOConfig.class.getCanonicalName(),\n+                ImmutableList.of(),\n+                16,\n+                1024,\n+                1,\n+                \"hdfs://namenode:9000/alluxio\");\n+        Set<Pair<WorkerInfo, ArrayList<String>>> assignments =\n+                new IODefinition().selectExecutors(jobConfig,\n+                        new ArrayList<>(JOB_WORKERS),\n+                        new SelectExecutorsContext(1, mJobServerContext));\n+        System.out.println(assignments);\n+        assertEquals(assignments.size(), 1);\n+        for (Pair<WorkerInfo, ArrayList<String>> p : assignments) {\n+            WorkerInfo w = p.getFirst();\n+            assertTrue(workerSet.contains(w));\n+        }\n+    }\n+\n+    // Test join", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDEyOQ==", "bodyText": "i don't get the TODOs in this file", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504129", "createdAt": "2020-05-23T01:56:09Z", "author": {"login": "madanadit"}, "path": "job/server/src/test/java/alluxio/job/plan/io/IODefinitionTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package alluxio.job.plan.io;\n+\n+import alluxio.AlluxioURI;\n+import alluxio.ClientContext;\n+import alluxio.client.block.AlluxioBlockStore;\n+import alluxio.client.file.FileSystem;\n+import alluxio.client.file.FileSystemContext;\n+import alluxio.collections.Pair;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.JobServerContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.load.LoadDefinition;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UfsManager;\n+import alluxio.wire.WorkerInfo;\n+import alluxio.wire.WorkerNetAddress;\n+import com.google.common.collect.ImmutableList;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mockito;\n+import org.powermock.api.mockito.PowerMockito;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import java.lang.reflect.Array;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Matchers.any;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, JobServerContext.class, FileSystemContext.class,\n+        AlluxioBlockStore.class})\n+public class IODefinitionTest {\n+    private static final List<WorkerInfo> JOB_WORKERS = new ImmutableList.Builder<WorkerInfo>()\n+            .add(new WorkerInfo().setId(0).setAddress(new WorkerNetAddress().setHost(\"host0\")))\n+            .add(new WorkerInfo().setId(1).setAddress(new WorkerNetAddress().setHost(\"host1\")))\n+            .add(new WorkerInfo().setId(2).setAddress(new WorkerNetAddress().setHost(\"host2\")))\n+            .add(new WorkerInfo().setId(3).setAddress(new WorkerNetAddress().setHost(\"host3\"))).build();\n+\n+    private JobServerContext mJobServerContext;\n+    private FileSystem mMockFileSystem;\n+    private AlluxioBlockStore mMockBlockStore;\n+    private FileSystemContext mMockFsContext;\n+\n+    @Before\n+    public void before() {\n+        mMockFileSystem = PowerMockito.mock(FileSystem.class);\n+        mMockBlockStore = PowerMockito.mock(AlluxioBlockStore.class);\n+        mMockFsContext = PowerMockito.mock(FileSystemContext.class);\n+        PowerMockito.mockStatic(AlluxioBlockStore.class);\n+        PowerMockito.when(AlluxioBlockStore.create(any(FileSystemContext.class)))\n+                .thenReturn(mMockBlockStore);\n+        PowerMockito.when(mMockFsContext.getClientContext())\n+                .thenReturn(ClientContext.create(ServerConfiguration.global()));\n+        // TODO(jiacheng): need to hijack this conf?\n+        PowerMockito.when(mMockFsContext.getClusterConf()).thenReturn(ServerConfiguration.global());\n+        PowerMockito.when(mMockFsContext.getPathConf(any(AlluxioURI.class)))\n+                .thenReturn(ServerConfiguration.global());\n+        mJobServerContext = new JobServerContext(mMockFileSystem, mMockFsContext,\n+                Mockito.mock(UfsManager.class));\n+    }\n+\n+    @Test\n+    public void selectExecutor() throws Exception {\n+        Set<WorkerInfo> workerSet = new HashSet<>(JOB_WORKERS);\n+        IOConfig jobConfig = new IOConfig(IOConfig.class.getCanonicalName(),\n+                ImmutableList.of(),\n+                16,\n+                1024,\n+                1,\n+                \"hdfs://namenode:9000/alluxio\");\n+        Set<Pair<WorkerInfo, ArrayList<String>>> assignments =\n+                new IODefinition().selectExecutors(jobConfig,\n+                        new ArrayList<>(JOB_WORKERS),\n+                        new SelectExecutorsContext(1, mJobServerContext));\n+        System.out.println(assignments);\n+        assertEquals(assignments.size(), 1);\n+        for (Pair<WorkerInfo, ArrayList<String>> p : assignments) {\n+            WorkerInfo w = p.getFirst();\n+            assertTrue(workerSet.contains(w));\n+        }\n+    }\n+\n+    // Test join\n+\n+    // Test exec command\n+    @Test\n+    public void execCommand() {\n+        Set<WorkerInfo> workerSet = new HashSet<>(JOB_WORKERS);\n+        IOConfig jobConfig = new IOConfig(IOConfig.class.getCanonicalName(),\n+                ImmutableList.of(),\n+                16,\n+                1024,\n+                1,\n+                \"hdfs://namenode:9000/alluxio\");\n+        IODefinition def = new IODefinition();\n+        // TODO(jiacheng): catch ShellUtils?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDE2NQ==", "bodyText": "comment", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504165", "createdAt": "2020-05-23T01:56:49Z", "author": {"login": "madanadit"}, "path": "stress/common/src/main/java/alluxio/stress/job/IOConfig.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package alluxio.stress.job;\n+\n+import alluxio.stress.worker.WorkerBenchParameters;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import com.google.common.base.Objects;\n+\n+import java.util.List;\n+\n+/**\n+ * Configuration for the IO throughput test to the UFS.\n+ */\n+@JsonTypeName(IOConfig.NAME)\n+public class IOConfig extends StressBenchConfig {\n+  private static final long serialVersionUID = 7883915266950426998L;\n+  public static final String NAME = \"IO\";\n+  // The number of streams to write to the UFS concurrently\n+  private int mThreadNum;\n+  // Size of data to write in total\n+  // They will be read in the read performance test\n+  private int mDataSize;\n+  // Temp dir to generate test files in\n+  private String mPath;\n+  private int mWorkerNum;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDIxOQ==", "bodyText": "nit: combine w/ previous comment \"Size of data to write/read in total\"", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504219", "createdAt": "2020-05-23T01:57:34Z", "author": {"login": "madanadit"}, "path": "stress/common/src/main/java/alluxio/stress/job/IOConfig.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package alluxio.stress.job;\n+\n+import alluxio.stress.worker.WorkerBenchParameters;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonTypeName;\n+import com.google.common.base.Objects;\n+\n+import java.util.List;\n+\n+/**\n+ * Configuration for the IO throughput test to the UFS.\n+ */\n+@JsonTypeName(IOConfig.NAME)\n+public class IOConfig extends StressBenchConfig {\n+  private static final long serialVersionUID = 7883915266950426998L;\n+  public static final String NAME = \"IO\";\n+  // The number of streams to write to the UFS concurrently\n+  private int mThreadNum;\n+  // Size of data to write in total\n+  // They will be read in the read performance test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDM1OQ==", "bodyText": "complete the implementation?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504359", "createdAt": "2020-05-23T01:59:24Z", "author": {"login": "madanadit"}, "path": "stress/common/src/test/java/alluxio/stress/job/IOConfigTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package alluxio.stress.job;\n+\n+import alluxio.job.plan.replicate.EvictConfig;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableList;\n+import org.junit.Test;\n+\n+public class IOConfigTest {\n+    @Test\n+    public void json() throws Exception {\n+        IOConfig config = new IOConfig(IOConfig.class.getCanonicalName(),\n+                ImmutableList.of(),\n+        16,\n+        1024,\n+        1,\n+        \"hdfs://namenode:9000/alluxio\");\n+        ObjectMapper mapper = new ObjectMapper();\n+        String json = mapper.writeValueAsString(config);\n+        System.out.println(json);\n+        IOConfig other = mapper.readValue(json, IOConfig.class);\n+        // TODO(jiacheng): check equality", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDQwMg==", "bodyText": "?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504402", "createdAt": "2020-05-23T01:59:55Z", "author": {"login": "madanadit"}, "path": "stress/common/src/test/java/alluxio/stress/worker/IOTaskResultTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package alluxio.stress.worker;\n+\n+import alluxio.stress.job.IOConfig;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableList;\n+import org.junit.Test;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+public class IOTaskResultTest {\n+    @Test\n+    public void json() throws Exception {\n+        IOTaskResult result = new IOTaskResult();\n+        result.addPoint(new IOTaskResult.Point(IOConfig.IOMode.READ, 100L, 20));\n+        result.addPoint(new IOTaskResult.Point(IOConfig.IOMode.WRITE, 100L, 5));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String json = mapper.writeValueAsString(result);\n+        System.out.println(json);\n+        IOTaskResult other = mapper.readValue(json, IOTaskResult.class);\n+        // TODO(jiacheng): check equality", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNDcwOA==", "bodyText": "are these any new system requirements for plotting the graphs? or do we include everything we need in the server tarball", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r429504708", "createdAt": "2020-05-23T02:04:06Z", "author": {"login": "madanadit"}, "path": "stress/common/src/main/java/alluxio/stress/worker/IOTaskSummary.java", "diffHunk": "@@ -0,0 +1,360 @@\n+package alluxio.stress.worker;\n+\n+import alluxio.collections.Pair;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.Parameters;\n+import alluxio.stress.Summary;\n+import alluxio.stress.graph.BarGraph;\n+import alluxio.stress.graph.Graph;\n+import alluxio.stress.job.IOConfig;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.SerializerProvider;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+import com.fasterxml.jackson.databind.ser.std.StdSerializer;\n+import com.google.common.base.Splitter;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The summary for the UFS I/O throughput test.\n+ */\n+public class IOTaskSummary implements Summary {\n+  private static final Logger LOG = LoggerFactory.getLogger(IOTaskSummary.class);\n+  private List<IOTaskResult.Point> mPoints;\n+  private List<String> mErrors;\n+  private BaseParameters mBaseParameters;\n+  private WorkerBenchParameters mParameters;\n+  private SpeedStat mReadSpeedStat;\n+  private SpeedStat mWriteSpeedStat;\n+\n+  /**\n+   * Used for deserialization.\n+   * */\n+  @JsonCreator\n+  public IOTaskSummary() {}\n+\n+  /**\n+   * @param result the {@link IOTaskResult} to summarize\n+   * */\n+  public IOTaskSummary(IOTaskResult result) {\n+    mPoints = new ArrayList<>(result.getPoints());\n+    mErrors = new ArrayList<>(result.getErrors());\n+    mBaseParameters = result.getBaseParameters();\n+    mParameters = result.getParameters();\n+    calculateStats();\n+  }\n+\n+  /**\n+   * @return the points recorded\n+   * */\n+  public List<IOTaskResult.Point> getPoints() {\n+    return mPoints;\n+  }\n+\n+  /**\n+   * @param points the data points\n+   * */\n+  public void setPoints(List<IOTaskResult.Point> points) {\n+    mPoints = points;\n+  }\n+\n+  /**\n+   * @return the errors recorded\n+   * */\n+  public List<String> getErrors() {\n+    return mErrors;\n+  }\n+\n+  /**\n+   * @param errors the errors\n+   * */\n+  public void setErrors(List<String> errors) {\n+    mErrors = errors;\n+  }\n+\n+  /**\n+   * @return the {@link BaseParameters}\n+   * */\n+  public BaseParameters getBaseParameters() {\n+    return mBaseParameters;\n+  }\n+\n+  /**\n+   * @param baseParameters the {@link BaseParameters}\n+   * */\n+  public void setBaseParameters(BaseParameters baseParameters) {\n+    mBaseParameters = baseParameters;\n+  }\n+\n+  /**\n+   * @return the task specific {@link WorkerBenchParameters}\n+   * */\n+  public WorkerBenchParameters getParameters() {\n+    return mParameters;\n+  }\n+\n+  /**\n+   * @param parameters the {@link WorkerBenchParameters}\n+   * */\n+  public void setParameters(WorkerBenchParameters parameters) {\n+    mParameters = parameters;\n+  }\n+\n+  /**\n+   * @return the {@link SpeedStat} for read speed\n+   * */\n+  public SpeedStat getReadSpeedStat() {\n+    return mReadSpeedStat;\n+  }\n+\n+  /**\n+   * @param stat the {@link SpeedStat} for read stats\n+   * */\n+  public void setReadSpeedStat(SpeedStat stat) {\n+    mReadSpeedStat = stat;\n+  }\n+\n+  /**\n+   * @return the {@link SpeedStat} for write speed\n+   * */\n+  public SpeedStat getWriteSpeedStat() {\n+    return mWriteSpeedStat;\n+  }\n+\n+  /**\n+   * @param stat the {@link SpeedStat} for write stats\n+   * */\n+  public void setWriteSpeedStat(SpeedStat stat) {\n+    mWriteSpeedStat = stat;\n+  }\n+\n+  /**\n+   * An object representation of all the statistics we need\n+   * from this I/O test.\n+   * */\n+  @JsonSerialize(using = StatSerializer.class)\n+  @JsonDeserialize(using = StatDeserializer.class)\n+  public static class SpeedStat implements JsonSerializable {\n+    public double mTotalDuration; // in second\n+    public int mTotalSize; // in MB\n+    public double mMaxSpeed; // in MB/s\n+    public double mMinSpeed; // in MB/s\n+    public double mAvgSpeed; // in MB/s\n+    public double mStdDev; // in MB/s\n+\n+    /**\n+     * An empty constructor.\n+     * */\n+    public SpeedStat() {}\n+\n+    @Override\n+    public String toString() {\n+      return String.format(\"{totalDuration=%ss, totalSize=%sMB, maxSpeed=%sMB/s, \"\n+                      + \"minSpeed=%sMB/s, \" + \"avgSpeed=%sMB/s, stdDev=%s}\",\n+              mTotalDuration, mTotalSize, mMaxSpeed, mMinSpeed, mAvgSpeed, mStdDev);\n+    }\n+  }\n+\n+  /**\n+   * A customized serializer for {@link SpeedStat}.\n+   * All the fields are attached with the unit.\n+   * */\n+  public static class StatSerializer extends StdSerializer<SpeedStat> {\n+    /**\n+     * An empty constructor.\n+     * */\n+    public StatSerializer() {\n+      super(SpeedStat.class);\n+    }\n+\n+    @Override\n+    public void serialize(SpeedStat value, JsonGenerator jgen, SerializerProvider provider)\n+            throws IOException {\n+      jgen.writeStartObject();\n+      jgen.writeStringField(\"totalDuration\", value.mTotalDuration + \"s\");\n+      jgen.writeStringField(\"totalSize\", value.mTotalSize + \"MB\");\n+      jgen.writeStringField(\"maxSpeed\", value.mMaxSpeed + \"MB/s\");\n+      jgen.writeStringField(\"minSpeed\", value.mMinSpeed + \"MB/s\");\n+      jgen.writeStringField(\"avgSpeed\", value.mAvgSpeed + \"MB/s\");\n+      jgen.writeNumberField(\"stdDev\", value.mStdDev);\n+      jgen.writeEndObject();\n+    }\n+  }\n+\n+  /**\n+   * A customized deserializer for {@link SpeedStat}.\n+   * */\n+  public static class StatDeserializer extends StdDeserializer<SpeedStat> {\n+    /**\n+     * An empty constructor.\n+     * */\n+    public StatDeserializer() {\n+      super(SpeedStat.class);\n+    }\n+\n+    private double speedToNumber(String speed) {\n+      return Double.parseDouble(speed.substring(0, speed.length() - \"MB/s\".length()));\n+    }\n+\n+    private double timeToNumber(String time) {\n+      return Double.parseDouble(time.substring(0, time.length() - \"s\".length()));\n+    }\n+\n+    private int sizeToNumber(String size) {\n+      return Integer.parseInt(size.substring(0, size.length() - \"MB\".length()));\n+    }\n+\n+    @Override\n+    public SpeedStat deserialize(JsonParser jp, DeserializationContext ctxt)\n+            throws IOException {\n+      JsonNode node = jp.getCodec().readTree(jp);\n+      SpeedStat stat = new SpeedStat();\n+      stat.mTotalDuration = timeToNumber(node.get(\"totalDuration\").asText());\n+      stat.mTotalSize = sizeToNumber(node.get(\"totalSize\").asText());\n+      stat.mMaxSpeed = speedToNumber(node.get(\"maxSpeed\").asText());\n+      stat.mMinSpeed = speedToNumber(node.get(\"minSpeed\").asText());\n+      stat.mAvgSpeed = speedToNumber(node.get(\"avgSpeed\").asText());\n+      stat.mStdDev = node.get(\"stdDev\").asDouble();\n+\n+      return stat;\n+    }\n+  }\n+\n+  /**\n+   * The points must be valid (duration not equal to 0).\n+   */\n+  private static SpeedStat calculateStat(List<IOTaskResult.Point> points) {\n+    SpeedStat result = new SpeedStat();\n+    if (points.size() == 0) {\n+      return result;\n+    }\n+\n+    double totalDuration = 0.0;\n+    int totalSize = 0;\n+    double[] speeds = new double[points.size()];\n+    double maxSpeed = 0.0;\n+    double minSpeed = Double.MAX_VALUE;\n+    int i = 0;\n+    for (IOTaskResult.Point p : points) {\n+      totalDuration += p.mDuration;\n+      totalSize += p.mDataSizeMB;\n+      double speed = p.mDataSizeMB / p.mDuration;\n+      maxSpeed = Math.max(maxSpeed, speed);\n+      minSpeed = Math.min(minSpeed, speed);\n+      speeds[i++] = p.mDataSizeMB / p.mDuration;\n+    }\n+    double avgSpeed = totalSize / totalDuration;\n+    double var = 0;\n+    for (double s : speeds) {\n+      var += (s - avgSpeed) * (s - avgSpeed);\n+    }\n+\n+    result.mTotalDuration = totalDuration;\n+    result.mTotalSize = totalSize;\n+    result.mMaxSpeed = maxSpeed;\n+    result.mMinSpeed = Double.compare(minSpeed, Double.MAX_VALUE) == 0 ? 0.0 : minSpeed;\n+    result.mAvgSpeed = avgSpeed;\n+    result.mStdDev = Math.sqrt(var);\n+\n+    return result;\n+  }\n+\n+  private void calculateStats() {\n+    List<IOTaskResult.Point> readPoints = mPoints.stream().filter((p) ->\n+            p.mMode == IOConfig.IOMode.READ && p.mDuration > 0)\n+            .collect(Collectors.toList());\n+    mReadSpeedStat = calculateStat(readPoints);\n+\n+    List<IOTaskResult.Point> writePoints = mPoints.stream().filter((p) ->\n+            p.mMode == IOConfig.IOMode.WRITE && p.mDuration > 0)\n+            .collect(Collectors.toList());\n+    mWriteSpeedStat = calculateStat(writePoints);\n+  }\n+\n+  @Override\n+  public GraphGenerator graphGenerator() {\n+    return new GraphGenerator();\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return String.format(\"IOTaskSummary: {Points=%s, Errors=%s}%n\",\n+            mPoints, mErrors);\n+  }\n+\n+  /**\n+   * A graph generator for the statistics collected.\n+   * */\n+  public static final class GraphGenerator extends alluxio.stress.GraphGenerator {\n+    @Override\n+    public List<Graph> generate(List<? extends Summary> results) {\n+      List<Graph> graphs = new ArrayList<>();\n+      // only examine MaxThroughputSummary\n+      List<IOTaskSummary> summaries =\n+              results.stream().map(x -> (IOTaskSummary) x).collect(Collectors.toList());\n+\n+      if (summaries.isEmpty()) {\n+        LOG.info(\"No summaries\");\n+        return graphs;\n+      }\n+\n+      // TODO(jiacheng): how to include params in this?\n+      // first() is the list of common field names, second() is the list of unique field names\n+      Pair<List<String>, List<String>> fieldNames = Parameters.partitionFieldNames(\n+              summaries.stream().map(x -> x.mParameters).collect(Collectors.toList()));\n+      System.out.format(\"FieldNames: %s%n\", fieldNames);\n+\n+      // Split up common description into 100 character chunks, for the sub title\n+      List<String> subTitle = new ArrayList<>(Splitter.fixedLength(100).splitToList(\n+              summaries.get(0).mParameters.getDescription(fieldNames.getFirst())));\n+      System.out.format(\"subtitle: %s%n\", subTitle);\n+\n+      for (IOTaskSummary summary : summaries) {\n+        String series = summary.mParameters.getDescription(fieldNames.getSecond());\n+        subTitle.add(series);\n+      }\n+\n+      BarGraph speedGraph = new BarGraph(\"Read/Write speed\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ded15217e52f154ab8d35409041773d361beda73"}, "originalPosition": 330}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "755a5afe636068e0b1a93df869e43c9452244113", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/755a5afe636068e0b1a93df869e43c9452244113", "committedDate": "2020-05-29T06:27:39Z", "message": "resolve some comment and add help msg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c85e27cdfeb0e8cd025d9be551be717e12b155", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/09c85e27cdfeb0e8cd025d9be551be717e12b155", "committedDate": "2020-05-29T06:43:36Z", "message": "use command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3388fa83b83ab9baaab3f59a5a4443ad858b0db5", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/3388fa83b83ab9baaab3f59a5a4443ad858b0db5", "committedDate": "2020-05-29T07:17:09Z", "message": "use buffered io"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f78751df2f68ee4b790ad713eb8067ac86965457", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/f78751df2f68ee4b790ad713eb8067ac86965457", "committedDate": "2020-05-29T07:42:03Z", "message": "close buffered stream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f333913de653d6a7ee0178269b1cc8d52f05f61", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/4f333913de653d6a7ee0178269b1cc8d52f05f61", "committedDate": "2020-05-29T08:24:55Z", "message": "refactor to use util methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea596dc58ad53204c4e77e6d2d8f7177822cb73d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ea596dc58ad53204c4e77e6d2d8f7177822cb73d", "committedDate": "2020-05-29T08:50:25Z", "message": "resolve the rest of comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/bcc19580442c79da96a8aa7b9d7adab6efb11ecc", "committedDate": "2020-05-29T09:06:56Z", "message": "merging master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzgwNzM5", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-420780739", "createdAt": "2020-05-29T09:08:36Z", "commit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOTowODozNlrOGcU4qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOTowODozNlrOGcU4qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM1NTQ5OA==", "bodyText": "removed one extra space", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432355498", "createdAt": "2020-05-29T09:08:36Z", "author": {"login": "jiacheliu3"}, "path": "bin/alluxio", "diffHunk": "@@ -32,7 +32,9 @@ function printUsage {\n   echo -e \"                \\t NOTE: This command will stop the existing server and creates a new one!\"\n   echo -e \"  runMesosTest  \\t Test the Alluxio integration with Mesos. Try 'alluxio mesosTest -help' for more help.\"\n   echo -e \"                \\t NOTE: This command requires Mesos to be running and will stop any Alluxio servers that are currently running.\"\n-  echo -e \"  runUfsTests    \\t Test the integration between Alluxio and the target under filesystem. Try 'alluxio runUfsTests -help' for more help.\"\n+  echo -e \"  runUfsIOTest  \\t Test the Alluxio throughput to the UFS path. Try 'alluxio runUfsIOTest -help' for more help.\"\n+  echo -e \"                \\t NOTE: This command requrires a valid ufs path to write temporary files into.\"\n+  echo -e \"  runUfsTests   \\t Test the integration between Alluxio and the target under filesystem. Try 'alluxio runUfsTests -help' for more help.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzgxNzQ5", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-420781749", "createdAt": "2020-05-29T09:10:10Z", "commit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxMDoxMFrOGcU7ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxMDoxMFrOGcU7ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM1NjI1NA==", "bodyText": "Any HDFS conf that will affect the IO throughput and I should add it here?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432356254", "createdAt": "2020-05-29T09:10:10Z", "author": {"login": "jiacheliu3"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/UfsIOBench.java", "diffHunk": "@@ -0,0 +1,262 @@\n+package alluxio.stress.cli;\n+\n+import alluxio.client.job.JobGrpcClientUtils;\n+import alluxio.conf.AlluxioConfiguration;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+import alluxio.exception.status.UnimplementedException;\n+import alluxio.job.plan.PlanConfig;\n+import alluxio.job.wire.JobInfo;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.TaskResult;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.job.StressBenchConfig;\n+import alluxio.stress.master.MasterBenchParameters;\n+import alluxio.stress.master.MasterBenchTaskResult;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UfsDirectoryStatus;\n+import alluxio.underfs.UnderFileSystem;\n+import alluxio.underfs.UnderFileSystemConfiguration;\n+import alluxio.util.CommonUtils;\n+import alluxio.util.ConfigurationUtils;\n+import alluxio.util.FormatUtils;\n+import alluxio.util.ShellUtils;\n+import alluxio.util.executor.ExecutorServiceFactories;\n+import com.beust.jcommander.JCommander;\n+import com.beust.jcommander.ParametersDelegate;\n+import com.google.common.util.concurrent.RateLimiter;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FSDataInputStream;\n+import org.apache.hadoop.fs.FSDataOutputStream;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.util.Time;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.net.URI;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Paths;\n+import java.util.*;\n+import java.util.concurrent.*;\n+import java.util.stream.Collectors;\n+\n+public class UfsIOBench extends Benchmark<IOTaskResult> {\n+    private static final Logger LOG = LoggerFactory.getLogger(UfsIOBench.class);\n+    private static final int BUFFER_SIZE = 1024 * 1024;\n+\n+    @ParametersDelegate\n+    private WorkerBenchParameters mParameters = new WorkerBenchParameters();\n+\n+    private final InstancedConfiguration mConf = InstancedConfiguration.defaults();\n+    private final HashMap<String, String> mHdfsConf = new HashMap<>();\n+\n+    @Override\n+    public PlanConfig generateJobConfig(String[] args) {\n+        // remove the cluster flag\n+        List<String> commandArgs =\n+                Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n+                        .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+\n+        commandArgs.addAll(mBaseParameters.mJavaOpts);\n+        String className = this.getClass().getCanonicalName();\n+        return new IOConfig(className, commandArgs, mParameters);\n+    }\n+\n+    @Override\n+    public IOTaskResult runLocal() throws Exception {\n+        ExecutorService pool =\n+                ExecutorServiceFactories.fixedThreadPool(\"bench-io-thread\", mParameters.mThreads).create();\n+\n+        IOTaskResult result = runIOBench(pool);\n+\n+        pool.shutdownNow();\n+        pool.awaitTermination(30, TimeUnit.SECONDS);\n+\n+        // Aggregate the task results\n+        return result;\n+    }\n+\n+    @Override\n+    public void prepare() throws Exception {\n+        // TODO(jiacheng): any HDFS conf to add?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzgyMTcz", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-420782173", "createdAt": "2020-05-29T09:10:48Z", "commit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxMDo0OFrOGcU83w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxMDo0OFrOGcU83w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM1NjU3NQ==", "bodyText": "Moved into util method", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432356575", "createdAt": "2020-05-29T09:10:48Z", "author": {"login": "jiacheliu3"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -91,23 +99,16 @@ public String run(String[] args) throws Exception {\n \n     if (mBaseParameters.mCluster) {\n       // run on job service\n-\n-      // remove the cluster flag\n-      List<String> commandArgs =\n-          Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n-              .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n-\n-      commandArgs.addAll(mBaseParameters.mJavaOpts);\n-\n-      long jobId = JobGrpcClientUtils\n-          .run(new StressBenchConfig(className, commandArgs, 10000, mBaseParameters.mClusterLimit),\n-              0, conf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcc19580442c79da96a8aa7b9d7adab6efb11ecc"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bc8df9381880995a612da14139e177cd5b843c9", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/8bc8df9381880995a612da14139e177cd5b843c9", "committedDate": "2020-05-29T10:43:53Z", "message": "resolve changed interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c905dbea40fd3232375c40da92fa1e0d207abe1f", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/c905dbea40fd3232375c40da92fa1e0d207abe1f", "committedDate": "2020-05-29T11:05:33Z", "message": "checkstyl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/d6dae419ca2535dd678f2098d29de0f6272a0c34", "committedDate": "2020-05-29T13:15:56Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTY5NDAz", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-421169403", "createdAt": "2020-05-29T17:57:17Z", "commit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNzo1NzoxN1rOGcmu2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNzo1NzoxN1rOGcmu2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0Nzg5OA==", "bodyText": "consider making this a String and using FormatUtils to parse a byte instead. Then users can specify 1k, 4k, 10M, 10g, etc instead. I think it is more user friendly.", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432647898", "createdAt": "2020-05-29T17:57:17Z", "author": {"login": "ZacBlanco"}, "path": "stress/common/src/main/java/alluxio/stress/worker/WorkerBenchParameters.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.worker;\n+\n+import alluxio.stress.Parameters;\n+\n+import com.beust.jcommander.Parameter;\n+\n+/**\n+ * Parameters used in the UFS I/O throughput test.\n+ * */\n+public class WorkerBenchParameters extends Parameters {\n+  @Parameter(names = {\"--threads\"}, description = \"the number of threads to use\")\n+  public int mThreads = 16;\n+\n+  @Parameter(names = {\"--io-size\"},\n+          description = \"size of data to write or read in total, in MB\")\n+  public int mDataSize = 4096;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjcxMzkz", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-421271393", "createdAt": "2020-05-29T20:36:23Z", "commit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMDozNjoyNFrOGcrTpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQyMDo1NToxOFrOGcryGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcyMjg1Mg==", "bodyText": "was this intentional?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432722852", "createdAt": "2020-05-29T20:36:24Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -103,37 +93,13 @@ public String runTask(StressBenchConfig config, ArrayList<String> args,\n     }\n \n     command.addAll(args);\n-\n-    LOG.info(\"running command: \" + String.join(\" \", command));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcyNDc5OA==", "bodyText": "why can't this just reuse the stress definition? It looks similar?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432724798", "createdAt": "2020-05-29T20:41:02Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/io/IODefinition.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.io;\n+\n+import alluxio.collections.Pair;\n+import alluxio.conf.PropertyKey;\n+import alluxio.conf.ServerConfiguration;\n+import alluxio.job.RunTaskContext;\n+import alluxio.job.SelectExecutorsContext;\n+import alluxio.job.plan.PlanDefinition;\n+import alluxio.job.util.BenchmarkJobUtils;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.util.ShellUtils;\n+import alluxio.wire.WorkerInfo;\n+\n+import com.google.common.collect.Sets;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * The definition for the UFS I/O throughput job, which generates concurrent streams to the UFS.\n+ *\n+ * {@link IOConfig} is the configuration class, each task takes a List<String> as a list of\n+ * command-line arguments to the benchmark command, and each task returns the string output.\n+ * The output will be serialized and deserialized using JSON, collected and merged.\n+ */\n+public class IODefinition implements PlanDefinition<IOConfig, ArrayList<String>, String> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcyODAxMg==", "bodyText": "Why is this debug now?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432728012", "createdAt": "2020-05-29T20:48:37Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -126,8 +142,7 @@ public String run(String[] args) throws Exception {\n       command.addAll(Arrays.asList(args));\n       command.add(BaseParameters.IN_PROCESS_FLAG);\n       command.addAll(mBaseParameters.mJavaOpts);\n-\n-      LOG.info(\"running command: \" + String.join(\" \", command));\n+      LOG.debug(\"running command: \" + String.join(\" \", command));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczMDY0OA==", "bodyText": "this test couldn't re-use the existing definition? It someone defeats the purpose with only using a small portion of the existing stress benchmark?", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r432730648", "createdAt": "2020-05-29T20:55:18Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/UfsIOBench.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.cli;\n+\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.job.plan.PlanConfig;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.job.IOConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UnderFileSystem;\n+import alluxio.underfs.UnderFileSystemConfiguration;\n+import alluxio.util.CommonUtils;\n+import alluxio.util.executor.ExecutorServiceFactories;\n+\n+import com.beust.jcommander.ParametersDelegate;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Arrays;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * A benchmark tool measuring the IO to UFS.\n+ * */\n+public class UfsIOBench extends Benchmark<IOTaskResult> {\n+  private static final Logger LOG = LoggerFactory.getLogger(UfsIOBench.class);\n+  private static final int BUFFER_SIZE = 1024 * 1024;\n+\n+  @ParametersDelegate\n+  private WorkerBenchParameters mParameters = new WorkerBenchParameters();\n+\n+  private final InstancedConfiguration mConf = InstancedConfiguration.defaults();\n+  private final HashMap<String, String> mHdfsConf = new HashMap<>();\n+\n+  @Override\n+  public PlanConfig generateJobConfig(String[] args) {\n+    // remove the cluster flag\n+    List<String> commandArgs =\n+            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n+                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+\n+    commandArgs.addAll(mBaseParameters.mJavaOpts);\n+    String className = this.getClass().getCanonicalName();\n+    return new IOConfig(className, commandArgs, mParameters);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "694d2cdadd9b07e29a9327ff48c76d2a8aafd345", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/694d2cdadd9b07e29a9327ff48c76d2a8aafd345", "committedDate": "2020-06-02T14:26:34Z", "message": "use StressBenchDefinition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3d85ee3ea8ac854357abf40999847c7868b8a64", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b3d85ee3ea8ac854357abf40999847c7868b8a64", "committedDate": "2020-06-02T15:14:00Z", "message": "migrated to use StressBench job classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de80970270527721405c0c7fcf279173a1f564f2", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/de80970270527721405c0c7fcf279173a1f564f2", "committedDate": "2020-06-02T15:28:12Z", "message": "remove from job definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b36bdc51823db1df97cc57d504505bd973003bbf", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b36bdc51823db1df97cc57d504505bd973003bbf", "committedDate": "2020-06-02T15:50:40Z", "message": "resolve comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7c2e488c3b59081d92a4eba2ddf22f85290551b", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b7c2e488c3b59081d92a4eba2ddf22f85290551b", "committedDate": "2020-06-02T15:59:17Z", "message": "revert unnecessary changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODI5ODc0", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-422829874", "createdAt": "2020-06-02T16:00:36Z", "commit": {"oid": "b7c2e488c3b59081d92a4eba2ddf22f85290551b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjowMDozNlrOGd42QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjowMDozNlrOGd42QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk5MzI4MA==", "bodyText": "I think generics can help remove some boilerplate code here", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r433993280", "createdAt": "2020-06-02T16:00:36Z", "author": {"login": "jiacheliu3"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -132,22 +132,17 @@ private long computeLastEndMs() {\n     return new Aggregator();\n   }\n \n-  private static final class Aggregator implements TaskResult.Aggregator {\n+  private static final class Aggregator implements TaskResult.Aggregator<ClientIOTaskResult> {\n     @Override\n-    public ClientIOTaskResult aggregate(Iterable<TaskResult> results) throws Exception {\n-      Iterator<TaskResult> it = results.iterator();\n+    public ClientIOTaskResult aggregate(Iterable<ClientIOTaskResult> results) throws Exception {\n+      Iterator<ClientIOTaskResult> it = results.iterator();\n       if (it.hasNext()) {\n-        TaskResult taskResult = it.next();\n+        ClientIOTaskResult taskResult = it.next();\n         if (it.hasNext()) {\n           throw new IOException(\n               \"ClientIO is a single node test, so multiple task results cannot be aggregated.\");\n         }\n-        if (!(taskResult instanceof ClientIOTaskResult)) {\n-          throw new IOException(\n-              \"TaskResult is not of type ClientIOTaskResult. class: \" + taskResult.getClass()\n-                  .getName());\n-        }\n-        return (ClientIOTaskResult) taskResult;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7c2e488c3b59081d92a4eba2ddf22f85290551b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1174fe168dc37f12b728cc9eb4de302295718e9b", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1174fe168dc37f12b728cc9eb4de302295718e9b", "committedDate": "2020-06-02T16:02:01Z", "message": "whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8289e4bd954ff52d48b1225ff94d60eb6bb7dc", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/8d8289e4bd954ff52d48b1225ff94d60eb6bb7dc", "committedDate": "2020-06-02T16:03:58Z", "message": "whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a62658ff9d4bf25734acf786753074b1b18415b5", "committedDate": "2020-06-02T16:06:08Z", "message": "unnecessary annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTQxMzQy", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-423141342", "createdAt": "2020-06-03T00:24:04Z", "commit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMDoyNDowNFrOGeIKbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMDoyODoyMVrOGeIOtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0NDIwNw==", "bodyText": "I think Zac was saying to make this a string value, we can we specify like 4m. In the code, we can convert it to an int with FormatUtils.parseSpaceSize like https://github.com/Alluxio/alluxio/blob/master/stress/shell/src/main/java/alluxio/stress/cli/client/StressClientIOBench.java#L239", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r434244207", "createdAt": "2020-06-03T00:24:04Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/worker/WorkerBenchParameters.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.worker;\n+\n+import alluxio.stress.Parameters;\n+\n+import com.beust.jcommander.Parameter;\n+\n+/**\n+ * Parameters used in the UFS I/O throughput test.\n+ * */\n+public class WorkerBenchParameters extends Parameters {\n+  @Parameter(names = {\"--threads\"}, description = \"the number of threads to use\")\n+  public int mThreads = 16;\n+\n+  @Parameter(names = {\"--io-size\"},\n+          description = \"size of data to write or read in total, in MB\")\n+  public int mDataSize = 4096;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0Nzg5OA=="}, "originalCommit": {"oid": "d6dae419ca2535dd678f2098d29de0f6272a0c34"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0NDY0OQ==", "bodyText": "I think this should be renamed to something like UfsIOParameters? The ony test that uses this class is a test called UfsIOBench.", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r434244649", "createdAt": "2020-06-03T00:25:44Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/worker/WorkerBenchParameters.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.worker;\n+\n+import alluxio.stress.Parameters;\n+\n+import com.beust.jcommander.Parameter;\n+\n+/**\n+ * Parameters used in the UFS I/O throughput test.\n+ * */\n+public class WorkerBenchParameters extends Parameters {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0NTMwMw==", "bodyText": "Can you not reuse the clusterLimit parameter already available in base parameters? Also, the wait time should be non-zero, and probably be at least 5 or 10 seconds, so the distributed task can start on time.\nI feel like this generateJobConfig method doesn't need to be overridden.", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r434245303", "createdAt": "2020-06-03T00:28:21Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/UfsIOBench.java", "diffHunk": "@@ -0,0 +1,260 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.cli;\n+\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.job.plan.PlanConfig;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.job.StressBenchConfig;\n+import alluxio.stress.worker.IOTaskResult;\n+import alluxio.stress.worker.WorkerBenchParameters;\n+import alluxio.underfs.UnderFileSystem;\n+import alluxio.underfs.UnderFileSystemConfiguration;\n+import alluxio.util.CommonUtils;\n+import alluxio.util.executor.ExecutorServiceFactories;\n+\n+import com.beust.jcommander.ParametersDelegate;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Arrays;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * A benchmark tool measuring the IO to UFS.\n+ * */\n+public class UfsIOBench extends Benchmark<IOTaskResult> {\n+  private static final Logger LOG = LoggerFactory.getLogger(UfsIOBench.class);\n+  private static final int BUFFER_SIZE = 1024 * 1024;\n+\n+  @ParametersDelegate\n+  private WorkerBenchParameters mParameters = new WorkerBenchParameters();\n+\n+  private final InstancedConfiguration mConf = InstancedConfiguration.defaults();\n+  private final HashMap<String, String> mHdfsConf = new HashMap<>();\n+\n+  @Override\n+  public PlanConfig generateJobConfig(String[] args) {\n+    // remove the cluster flag\n+    List<String> commandArgs =\n+            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n+                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+\n+    commandArgs.addAll(mBaseParameters.mJavaOpts);\n+    String className = this.getClass().getCanonicalName();\n+    return new StressBenchConfig(className, commandArgs, 0, mParameters.mWorkerNum);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTI1MzQ0", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-423125344", "createdAt": "2020-06-02T23:34:24Z", "commit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzozNDoyNFrOGeHWCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzozNDoyNFrOGeHWCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIzMDc5Mg==", "bodyText": "nit: typo \"requrires\"", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r434230792", "createdAt": "2020-06-02T23:34:24Z", "author": {"login": "madanadit"}, "path": "bin/alluxio", "diffHunk": "@@ -32,7 +32,9 @@ function printUsage {\n   echo -e \"                \\t NOTE: This command will stop the existing server and creates a new one!\"\n   echo -e \"  runMesosTest  \\t Test the Alluxio integration with Mesos. Try 'alluxio mesosTest -help' for more help.\"\n   echo -e \"                \\t NOTE: This command requires Mesos to be running and will stop any Alluxio servers that are currently running.\"\n-  echo -e \"  runUfsTests    \\t Test the integration between Alluxio and the target under filesystem. Try 'alluxio runUfsTests -help' for more help.\"\n+  echo -e \"  runUfsIOTest  \\t Test the Alluxio throughput to the UFS path. Try 'alluxio runUfsIOTest -help' for more help.\"\n+  echo -e \"                \\t NOTE: This command requrires a valid ufs path to write temporary files into.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a62658ff9d4bf25734acf786753074b1b18415b5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d61bd151d42da93d90360770690f3f50597cbe51", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/d61bd151d42da93d90360770690f3f50597cbe51", "committedDate": "2020-06-03T18:42:16Z", "message": "resolve comments and spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a95d8921002960c76ed4957b1b2ffe8095fafc7", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1a95d8921002960c76ed4957b1b2ffe8095fafc7", "committedDate": "2020-06-03T18:58:16Z", "message": "update parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a855d31ab6c78431a77c938bc8514cc8a98022", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a1a855d31ab6c78431a77c938bc8514cc8a98022", "committedDate": "2020-06-03T19:03:51Z", "message": "better format on stat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb80c3c1cd2e026d411830d0033e9d1b6f535d3", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/bbb80c3c1cd2e026d411830d0033e9d1b6f535d3", "committedDate": "2020-06-03T19:09:00Z", "message": "remove extra comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjE0OTM5", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-424614939", "createdAt": "2020-06-04T16:16:03Z", "commit": {"oid": "bbb80c3c1cd2e026d411830d0033e9d1b6f535d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjoxNjowM1rOGfNovw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjoxNjowM1rOGfNovw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM4MjQ2Mw==", "bodyText": "Why do serializers and deserializers need to be used? Jackson can just ser/de the classes, with getters/setters, or with public fields, right? That is how all the other results and parameter classes work.", "url": "https://github.com/Alluxio/alluxio/pull/11422#discussion_r435382463", "createdAt": "2020-06-04T16:16:03Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/worker/IOTaskSummary.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress.worker;\n+\n+import alluxio.collections.Pair;\n+import alluxio.stress.BaseParameters;\n+import alluxio.stress.JsonSerializable;\n+import alluxio.stress.Parameters;\n+import alluxio.stress.Summary;\n+import alluxio.stress.graph.BarGraph;\n+import alluxio.stress.graph.Graph;\n+import alluxio.util.FormatUtils;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.SerializerProvider;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+import com.fasterxml.jackson.databind.ser.std.StdSerializer;\n+import com.google.common.base.Splitter;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * The summary for the UFS I/O throughput test.\n+ */\n+public class IOTaskSummary implements Summary {\n+  private static final Logger LOG = LoggerFactory.getLogger(IOTaskSummary.class);\n+  private List<IOTaskResult.Point> mPoints;\n+  private List<String> mErrors;\n+  private BaseParameters mBaseParameters;\n+  private UfsIOParameters mParameters;\n+  private SpeedStat mReadSpeedStat;\n+  private SpeedStat mWriteSpeedStat;\n+\n+  /**\n+   * Used for deserialization.\n+   * */\n+  @JsonCreator\n+  public IOTaskSummary() {}\n+\n+  /**\n+   * @param result the {@link IOTaskResult} to summarize\n+   * */\n+  public IOTaskSummary(IOTaskResult result) {\n+    mPoints = new ArrayList<>(result.getPoints());\n+    mErrors = new ArrayList<>(result.getErrors());\n+    mBaseParameters = result.getBaseParameters();\n+    mParameters = result.getParameters();\n+    calculateStats();\n+  }\n+\n+  /**\n+   * @return the points recorded\n+   * */\n+  public List<IOTaskResult.Point> getPoints() {\n+    return mPoints;\n+  }\n+\n+  /**\n+   * @param points the data points\n+   * */\n+  public void setPoints(List<IOTaskResult.Point> points) {\n+    mPoints = points;\n+  }\n+\n+  /**\n+   * @return the errors recorded\n+   * */\n+  public List<String> getErrors() {\n+    return mErrors;\n+  }\n+\n+  /**\n+   * @param errors the errors\n+   * */\n+  public void setErrors(List<String> errors) {\n+    mErrors = errors;\n+  }\n+\n+  /**\n+   * @return the {@link BaseParameters}\n+   * */\n+  public BaseParameters getBaseParameters() {\n+    return mBaseParameters;\n+  }\n+\n+  /**\n+   * @param baseParameters the {@link BaseParameters}\n+   * */\n+  public void setBaseParameters(BaseParameters baseParameters) {\n+    mBaseParameters = baseParameters;\n+  }\n+\n+  /**\n+   * @return the task specific {@link UfsIOParameters}\n+   * */\n+  public UfsIOParameters getParameters() {\n+    return mParameters;\n+  }\n+\n+  /**\n+   * @param parameters the {@link UfsIOParameters}\n+   * */\n+  public void setParameters(UfsIOParameters parameters) {\n+    mParameters = parameters;\n+  }\n+\n+  /**\n+   * @return the {@link SpeedStat} for read speed\n+   * */\n+  public SpeedStat getReadSpeedStat() {\n+    return mReadSpeedStat;\n+  }\n+\n+  /**\n+   * @param stat the {@link SpeedStat} for read stats\n+   * */\n+  public void setReadSpeedStat(SpeedStat stat) {\n+    mReadSpeedStat = stat;\n+  }\n+\n+  /**\n+   * @return the {@link SpeedStat} for write speed\n+   * */\n+  public SpeedStat getWriteSpeedStat() {\n+    return mWriteSpeedStat;\n+  }\n+\n+  /**\n+   * @param stat the {@link SpeedStat} for write stats\n+   * */\n+  public void setWriteSpeedStat(SpeedStat stat) {\n+    mWriteSpeedStat = stat;\n+  }\n+\n+  /**\n+   * An object representation of all the statistics we need\n+   * from this I/O test.\n+   * */\n+  @JsonSerialize(using = StatSerializer.class)\n+  @JsonDeserialize(using = StatDeserializer.class)\n+  public static class SpeedStat implements JsonSerializable {\n+    public double mTotalDuration; // in second\n+    public long mTotalSize; // in Bytes\n+    public double mMaxSpeed; // in MB/s\n+    public double mMinSpeed; // in MB/s\n+    public double mAvgSpeed; // in MB/s\n+    public double mStdDev; // in MB/s\n+\n+    /**\n+     * An empty constructor.\n+     * */\n+    public SpeedStat() {}\n+\n+    @Override\n+    public String toString() {\n+      return String.format(\"{totalDuration=%ss, totalSize=%s, maxSpeed=%sMB/s, \"\n+                      + \"minSpeed=%sMB/s, \" + \"avgSpeed=%sMB/s, stdDev=%s}\",\n+              mTotalDuration, FormatUtils.getSizeFromBytes(mTotalSize),\n+              mMaxSpeed, mMinSpeed, mAvgSpeed, mStdDev);\n+    }\n+  }\n+\n+  /**\n+   * A customized serializer for {@link SpeedStat}.\n+   * All the fields are attached with the unit.\n+   * */\n+  public static class StatSerializer extends StdSerializer<SpeedStat> {\n+    private static final long serialVersionUID = -5198319303173120740L;\n+\n+    /**\n+     * An empty constructor.\n+     * */\n+    public StatSerializer() {\n+      super(SpeedStat.class);\n+    }\n+\n+    @Override\n+    public void serialize(SpeedStat value, JsonGenerator jgen, SerializerProvider provider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbb80c3c1cd2e026d411830d0033e9d1b6f535d3"}, "originalPosition": 198}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NzExMTIx", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-424711121", "createdAt": "2020-06-04T18:17:27Z", "commit": {"oid": "bbb80c3c1cd2e026d411830d0033e9d1b6f535d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e6fdfdff56387440579a73994388f69de98e09d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/9e6fdfdff56387440579a73994388f69de98e09d", "committedDate": "2020-06-05T16:16:17Z", "message": "remove customized ser/de"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NDQzNzAy", "url": "https://github.com/Alluxio/alluxio/pull/11422#pullrequestreview-425443702", "createdAt": "2020-06-05T16:20:14Z", "commit": {"oid": "9e6fdfdff56387440579a73994388f69de98e09d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4629, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}