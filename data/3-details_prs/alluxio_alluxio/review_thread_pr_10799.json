{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDY0Mzcy", "number": 10799, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDozMTo1OVrODbEdKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDozMTo1OVrODbEdKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzExMTQ1OnYy", "diffSide": "RIGHT", "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDozMTo1OVrOFiWFpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNToyMjowNlrOFiZjVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw==", "bodyText": "Does this List need to be modifiable now?", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371557797", "createdAt": "2020-01-28T00:31:59Z", "author": {"login": "yuzhu"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MDgyMQ==", "bodyText": "No. it's only changed because we now need to convert the value set of the map to a list. It is equivalent to the old unmodifiable list in the sense that user of this API won't be able to change the underlying directory collection stored in this view.", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371560821", "createdAt": "2020-01-28T00:43:48Z", "author": {"login": "bf8086"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, "originalCommit": {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2NjQ0NA==", "bodyText": "but the user of this API will not get an error if they try to modify this list. In fact they will successfully modify the returned list right?", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371566444", "createdAt": "2020-01-28T01:06:30Z", "author": {"login": "yuzhu"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, "originalCommit": {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3MDU1NA==", "bodyText": "yeah I think the original purpose of wrapping the collection with unmodifiableList is to prevent mutation of the view rather than prevent the mutation of the return value after method returns. I don't feel it is necessary to add an unmodifiable wrapper on top of the list now that we already create a copy of the collection. Let me know if you think there is a strong reason for an additional wrapper otherwise.", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371570554", "createdAt": "2020-01-28T01:23:56Z", "author": {"login": "bf8086"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, "originalCommit": {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxNDU0OQ==", "bodyText": "sounds good", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371614549", "createdAt": "2020-01-28T05:22:06Z", "author": {"login": "yuzhu"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, "originalCommit": {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2104, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}