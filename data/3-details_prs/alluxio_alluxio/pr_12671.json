{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTUwMjQx", "number": 12671, "title": "Add maven plugin for proto lock", "bodyText": "#12596\nIntroduce https://github.com/salesforce/proto-backwards-compat-maven-plugin to help prevent proto changes which can break backwards compatibility.\nThis plugin can fail the build when some field in a proto file is removed. Such as:\ndiff --git a/core/transport/src/main/proto/grpc/table/layout/hive/hive.proto b/core/transport/src/main/proto/grpc/table/layout/hive/hive.proto\nindex 538fbe02a0..829ed6f023 100644\n--- a/core/transport/src/main/proto/grpc/table/layout/hive/hive.proto\n+++ b/core/transport/src/main/proto/grpc/table/layout/hive/hive.proto\n@@ -28,7 +28,6 @@ message SortingColumn {\nASCENDING = 0;\nDESCENDING = 1;\n}\nrequired SortingOrder order = 2;\n}\nThe plugin will trigger a build failure for notification:\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 27.064 s\n[INFO] Finished at: 2020-12-22T21:45:30+08:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal com.salesforce.servicelibs:proto-backwards-compatibility:1.0.5:backwards-compatibility-check (default) on project alluxio-core-transport: Backwards compatibility check failed! -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn -rf :alluxio-core-transport", "createdAt": "2020-12-22T14:14:04Z", "url": "https://github.com/Alluxio/alluxio/pull/12671", "merged": true, "mergeCommit": {"oid": "8d1f4559c3d029bfb7e3e6396a676be1c804d0f7"}, "closed": true, "closedAt": "2020-12-31T04:43:09Z", "author": {"login": "timmylicheng"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdorO3vABqjQxNDAzMjc0ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrcbKDgFqTU2MDI2MTY5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b56e686e6e9227f418912adf0a015f148c99cc2b", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/b56e686e6e9227f418912adf0a015f148c99cc2b", "committedDate": "2020-12-22T14:09:59Z", "message": "Add maven plugin for proto lock."}, "afterCommit": {"oid": "0f581c972c2ab3376c1326f82dad5d57ded465c8", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/0f581c972c2ab3376c1326f82dad5d57ded465c8", "committedDate": "2020-12-22T14:16:06Z", "message": "Add maven plugin for proto lock."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c5eb724c484151416d0239ea687f5c40908dc4", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/80c5eb724c484151416d0239ea687f5c40908dc4", "committedDate": "2020-12-22T14:20:05Z", "message": "Add maven plugin for proto lock."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f581c972c2ab3376c1326f82dad5d57ded465c8", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/0f581c972c2ab3376c1326f82dad5d57ded465c8", "committedDate": "2020-12-22T14:16:06Z", "message": "Add maven plugin for proto lock."}, "afterCommit": {"oid": "80c5eb724c484151416d0239ea687f5c40908dc4", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/80c5eb724c484151416d0239ea687f5c40908dc4", "committedDate": "2020-12-22T14:20:05Z", "message": "Add maven plugin for proto lock."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NTIwMTA1", "url": "https://github.com/Alluxio/alluxio/pull/12671#pullrequestreview-557520105", "createdAt": "2020-12-23T03:38:20Z", "commit": {"oid": "80c5eb724c484151416d0239ea687f5c40908dc4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwMzozODoyMVrOIKQLrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwMzozODoyMVrOIKQLrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzYyMTgwNQ==", "bodyText": "please add definition of this artifact dependency  to root/pom.xml under\n<dependencyManagement>\n\n  \n    \n      alluxio/pom.xml\n    \n    \n         Line 199\n      in\n      0d149a8\n    \n    \n    \n    \n\n        \n          \n           <dependencyManagement> \n        \n    \n  \n\n\nlike\n      <dependency>\n        <groupId>com.salesforce.servicelibs</groupId>\n        <artifactId>proto-backwards-compatibility</artifactId>\n        <version>1.0.5</version>\n      </dependency>\n\nThen in this core/transport/pom.xml, you only need to refer to the artifact without specifying the version\n      <plugin>\n        <groupId>com.salesforce.servicelibs</groupId>\n        <artifactId>proto-backwards-compatibility</artifactId>\n        <configuration>\n          <protoSourceRoot>${basedir}/target/classes/</protoSourceRoot>\n        </configuration>\n        <executions>\n          <execution>\n            <goals>\n              <goal>backwards-compatibility-check</goal>\n            </goals>\n          </execution>\n        </executions>\n      </plugin>", "url": "https://github.com/Alluxio/alluxio/pull/12671#discussion_r547621805", "createdAt": "2020-12-23T03:38:21Z", "author": {"login": "apc999"}, "path": "core/transport/pom.xml", "diffHunk": "@@ -133,6 +134,23 @@\n         </executions>\n       </plugin>\n \n+      <!-- Proto lock for preventing backwards compatibility issues -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80c5eb724c484151416d0239ea687f5c40908dc4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "100bb60f1d9de0b1eb349b1e94f6036ec3f436f8", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/100bb60f1d9de0b1eb349b1e94f6036ec3f436f8", "committedDate": "2020-12-23T14:18:50Z", "message": "Move plugin version to root pom."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5c1a1031f8a702a9d02a949d90bf75e30923168", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/f5c1a1031f8a702a9d02a949d90bf75e30923168", "committedDate": "2020-12-23T14:17:11Z", "message": "Move plugin version to root pom."}, "afterCommit": {"oid": "100bb60f1d9de0b1eb349b1e94f6036ec3f436f8", "author": {"user": {"login": "timmylicheng", "name": "Li Cheng"}}, "url": "https://github.com/Alluxio/alluxio/commit/100bb60f1d9de0b1eb349b1e94f6036ec3f436f8", "committedDate": "2020-12-23T14:18:50Z", "message": "Move plugin version to root pom."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70acdfcfb76d618f834203d093b02803327a11c2", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/70acdfcfb76d618f834203d093b02803327a11c2", "committedDate": "2020-12-23T21:52:22Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMjYxNjk5", "url": "https://github.com/Alluxio/alluxio/pull/12671#pullrequestreview-560261699", "createdAt": "2020-12-31T04:42:59Z", "commit": {"oid": "70acdfcfb76d618f834203d093b02803327a11c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3380, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}