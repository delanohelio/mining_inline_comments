{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODIwODIy", "number": 12653, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxMTo1NFrOFF4lZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MTo0MFrOFG2wBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNzE0Mjc5OnYy", "diffSide": "RIGHT", "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/Property.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxMTo1NFrOIGnHxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxMTo1NFrOIGnHxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgwMzMzNQ==", "bodyText": "This file is using the same code structure as alluxio/table/under/glue/Property.java", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r543803335", "createdAt": "2020-12-16T01:11:54Z", "author": {"login": "hycsam"}, "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/Property.java", "diffHunk": "@@ -11,12 +11,166 @@\n \n package alluxio.table.under.hive;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzMyMzkzOnYy", "diffSide": "RIGHT", "path": "docs/en/operation/User-CLI.md", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MDo1OFrOIID8RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNzo0NjozOVrOIXKRvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA==", "bodyText": "Can we make this property a general udb property, and not hive specific?", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545324100", "createdAt": "2020-12-17T18:50:58Z", "author": {"login": "gpang"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwNzgwMA==", "bodyText": "does glue allow partitions to be outside of the table path?  if it does not,  then this property probably does not make sense for glue?", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545407800", "createdAt": "2020-12-17T21:14:13Z", "author": {"login": "yuzhu"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1OTk2OA==", "bodyText": "hrmmm, good question, I'm not sure how that works in glue. If it is possible to edit the glue metadata directly, then maybe?", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545459968", "createdAt": "2020-12-17T23:01:04Z", "author": {"login": "gpang"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA4OTI1MQ==", "bodyText": "Both the Property.java files (Hive and Glue) now share the same code structure. I can move this builder code logic to their parent class, UdbProperty.java. We can decide later if necessary to add this property to Glue UDB.", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r546089251", "createdAt": "2020-12-18T21:02:47Z", "author": {"login": "hycsam"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjIzMjA3OQ==", "bodyText": "Tried abstracting the common code in UdbProperty.java but don't think that's a good idea, will leave as such. Also bumping this up, does this PR look OK for Hive UDB? I think we can decided whether to add that for Glue later.", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r552232079", "createdAt": "2021-01-05T22:17:02Z", "author": {"login": "hycsam"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjIxNDYyNQ==", "bodyText": "What challenges did you run into? I am concerned that we have two separate property classes and they will diverge further in the future.", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r556214625", "createdAt": "2021-01-13T02:01:17Z", "author": {"login": "yuzhu"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDcxOTIzNA==", "bodyText": "@yuzhu  Both the Builder pattern and the static property map (DEFAULT_KEYS_MAP variable in Property.java) are making it hard to abstract the code in the parent class. Don't want to make the code too complicated.", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r560719234", "createdAt": "2021-01-20T07:00:30Z", "author": {"login": "hycsam"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTE1NjU0MQ==", "bodyText": "got it @hycsam", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r561156541", "createdAt": "2021-01-20T17:46:39Z", "author": {"login": "yuzhu"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA=="}, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzMyODA3OnYy", "diffSide": "RIGHT", "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/HiveDatabase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MTo0MFrOIID-2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MTo0MFrOIID-2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDc2Mg==", "bodyText": "Can this be a general property, since the glue integration also has a similar check: https://github.com/Alluxio/alluxio/blob/master/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java#L263", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545324762", "createdAt": "2020-12-17T18:51:40Z", "author": {"login": "gpang"}, "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/HiveDatabase.java", "diffHunk": "@@ -162,8 +162,12 @@ private PathTranslator mountAlluxioPaths(Table table, List<Partition> partitions\n \n       for (Partition part : partitions) {\n         AlluxioURI partitionUri;\n-        if (part.getSd() != null && part.getSd().getLocation() != null\n-            && ufsUri.isAncestorOf(partitionUri = new AlluxioURI(part.getSd().getLocation()))) {\n+        if (part.getSd() != null && part.getSd().getLocation() != null) {\n+          partitionUri = new AlluxioURI(part.getSd().getLocation());\n+          if (!mConfiguration.getBoolean(Property.ALLOW_DIFF_PART_LOC_PREFIX)\n+              && !ufsUri.isAncestorOf(partitionUri)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 970, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}