{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODkzMDMx", "number": 10749, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMDoxMDo1NlrODYBxxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozOTowMlrODYCoPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTIxNTQyOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMDoxMDo1NlrOFdp0tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozNTowOFrOFdrFdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA==", "bodyText": "mPosition >= mStatus.getLength()?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366638260", "createdAt": "2020-01-15T00:10:56Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzOTU0Mg==", "bodyText": "how about updating positionedRead https://github.com/Alluxio/alluxio/pull/10749/files#diff-dda4e9db6a53b7319a9d5c19177847bcR173  @calvinjia ?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366639542", "createdAt": "2020-01-15T00:15:22Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MTE1Mg==", "bodyText": "Good catch, positioned read should be updated as well", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366651152", "createdAt": "2020-01-15T01:01:13Z", "author": {"login": "calvinjia"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NDY2Mw==", "bodyText": "how can mPosition > mStatus.getLength() be true?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366654663", "createdAt": "2020-01-15T01:15:56Z", "author": {"login": "bf8086"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NTA0OA==", "bodyText": "just to be safe and prevent hitting bugs elsewhere", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366655048", "createdAt": "2020-01-15T01:17:36Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1ODkzMw==", "bodyText": "Done.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366658933", "createdAt": "2020-01-15T01:35:08Z", "author": {"login": "bf8086"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {\n+      return 0;\n+    }\n+    if (mPosition == mStatus.getLength()) { // at end of file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzODI2MA=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTIzNTAwOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMDoyMToxNlrOFdqALA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozNTowMlrOFdrFXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY0MTE5Ng==", "bodyText": "please include numbers we are checking here in the error message, or it is hard to tell what's going wrong", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366641196", "createdAt": "2020-01-15T00:21:16Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -124,14 +130,17 @@ public int read(byte[] b, int off, int len) throws IOException {\n           mPosition += bytesLeftInPage;\n         } else { // cache miss\n           byte[] page = readExternalPage(mPosition);\n-          mCacheManager.put(pageId, page);\n-          System.arraycopy(page, currentPageOffset, b, off + bytesRead, bytesLeftInPage);\n-          bytesRead += bytesLeftInPage;\n-          mPosition += bytesLeftInPage;\n+          if (page.length > 0) {\n+            mCacheManager.put(pageId, page);\n+            System.arraycopy(page, currentPageOffset, b, off + bytesRead, bytesLeftInPage);\n+            bytesRead += bytesLeftInPage;\n+            mPosition += bytesLeftInPage;\n+          }\n         }\n       }\n     }\n-    Preconditions.checkState(bytesRead == len, \"Invalid number of bytes read\");\n+    Preconditions.checkState(bytesRead == len || (bytesRead < len && remaining() == 0),\n+        \"Invalid number of bytes read\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1ODkxMQ==", "bodyText": "Done.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366658911", "createdAt": "2020-01-15T01:35:02Z", "author": {"login": "bf8086"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -124,14 +130,17 @@ public int read(byte[] b, int off, int len) throws IOException {\n           mPosition += bytesLeftInPage;\n         } else { // cache miss\n           byte[] page = readExternalPage(mPosition);\n-          mCacheManager.put(pageId, page);\n-          System.arraycopy(page, currentPageOffset, b, off + bytesRead, bytesLeftInPage);\n-          bytesRead += bytesLeftInPage;\n-          mPosition += bytesLeftInPage;\n+          if (page.length > 0) {\n+            mCacheManager.put(pageId, page);\n+            System.arraycopy(page, currentPageOffset, b, off + bytesRead, bytesLeftInPage);\n+            bytesRead += bytesLeftInPage;\n+            mPosition += bytesLeftInPage;\n+          }\n         }\n       }\n     }\n-    Preconditions.checkState(bytesRead == len, \"Invalid number of bytes read\");\n+    Preconditions.checkState(bytesRead == len || (bytesRead < len && remaining() == 0),\n+        \"Invalid number of bytes read\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY0MTE5Ng=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMwNjg4OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/store/PageStoreOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTowNjoxMVrOFdqrmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTowNjoxMVrOFdqrmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MjMxNA==", "bodyText": "Since this is simple enough, I would suggest to move the body this function into factory method PageStore.create, inside which we can switch the creation of options based on PropertyKey.USER_CLIENT_CACHE_STORE_TYPE.  Having factory over factory seems just complicated to me and I would optimize for code simplicity.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366652314", "createdAt": "2020-01-15T01:06:11Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/store/PageStoreOptions.java", "diffHunk": "@@ -11,11 +11,39 @@\n \n package alluxio.client.file.cache.store;\n \n+import alluxio.conf.AlluxioConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n /**\n  * Options used to instantiate a {@link alluxio.client.file.cache.PageStore}.\n  */\n public abstract class PageStoreOptions {\n \n+  /**\n+   * Creates an instance of the {@link PageStoreOptions} based on configurations.\n+   * @param conf the Alluxio configuration\n+   * @return the created page store options\n+   */\n+  public static PageStoreOptions create(AlluxioConfiguration conf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMwNzg2OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/PageStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTowNjo1MFrOFdqsMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTowNjo1MFrOFdqsMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MjQ2NA==", "bodyText": "do we still want to keep create() then?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366652464", "createdAt": "2020-01-15T01:06:50Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/PageStore.java", "diffHunk": "@@ -52,6 +53,15 @@ static PageStore create() {\n     return create(new LocalPageStoreOptions());\n   }\n \n+  /**\n+   * Creates a new instance of {@link PageStore} based on configuration.\n+   * @param conf configuration\n+   * @return the {@link PageStore}\n+   */\n+  static PageStore create(AlluxioConfiguration conf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMxMTQyOnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTowOTowMlrOFdquXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozMzo1MlrOFdrEhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MzAyMw==", "bodyText": "specify a bit more here what is LOCAL and what is ROCKS?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366653023", "createdAt": "2020-01-15T01:09:02Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3120,6 +3120,19 @@ public String toString() {\n               + \"`alluxio.client.file.cache.LRUCacheEvictor`.\")\n           .setScope(Scope.CLIENT)\n           .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_DIR =\n+      new Builder(Name.USER_CLIENT_CACHE_DIR)\n+          .setDefaultValue(\"/tmp\")\n+          .setDescription(\"The directory where client-side cache is stored.\")\n+          .setScope(Scope.CLIENT)\n+          .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_STORE_TYPE =\n+      new Builder(Name.USER_CLIENT_CACHE_STORE_TYPE)\n+          .setDefaultValue(\"LOCAL\")\n+          .setDescription(\"The type of page store to use for client-side cache. Can be either \"\n+              + \"`LOCAL` or `ROCKS`.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1ODY5Mw==", "bodyText": "Done.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366658693", "createdAt": "2020-01-15T01:33:52Z", "author": {"login": "bf8086"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3120,6 +3120,19 @@ public String toString() {\n               + \"`alluxio.client.file.cache.LRUCacheEvictor`.\")\n           .setScope(Scope.CLIENT)\n           .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_DIR =\n+      new Builder(Name.USER_CLIENT_CACHE_DIR)\n+          .setDefaultValue(\"/tmp\")\n+          .setDescription(\"The directory where client-side cache is stored.\")\n+          .setScope(Scope.CLIENT)\n+          .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_STORE_TYPE =\n+      new Builder(Name.USER_CLIENT_CACHE_STORE_TYPE)\n+          .setDefaultValue(\"LOCAL\")\n+          .setDescription(\"The type of page store to use for client-side cache. Can be either \"\n+              + \"`LOCAL` or `ROCKS`.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MzAyMw=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMxNjE1OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxMjowMlrOFdqxPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozMzo0N1rOFdrEcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1Mzc1Ng==", "bodyText": "Add Preconditions.check  on len >= 0 and off >= 0?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366653756", "createdAt": "2020-01-15T01:12:02Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1ODY3NQ==", "bodyText": "Done.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366658675", "createdAt": "2020-01-15T01:33:47Z", "author": {"login": "bf8086"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheFileInStream.java", "diffHunk": "@@ -100,9 +100,15 @@ public int read(byte[] b) throws IOException {\n \n   @Override\n   public int read(byte[] b, int off, int len) throws IOException {\n+    if (len == 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1Mzc1Ng=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMxOTgzOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxNDo0OVrOFdqzrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxOToyOVrOFdq38Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NDM4MQ==", "bodyText": "will Math.floorMod handle overflow if pageId.getFileId() + pageId.getPageIndex() is larger than LONG.MAX_VALUE?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366654381", "createdAt": "2020-01-15T01:14:49Z", "author": {"login": "apc999"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheManager.java", "diffHunk": "@@ -103,7 +103,7 @@ public LocalCacheManager(FileSystemContext fsContext) {\n    * @return the corresponding page lock\n    */\n   private ReadWriteLock getPageLock(PageId pageId) {\n-    return mPageLocks[(int) (pageId.getFileId() + pageId.getPageIndex()) % LOCK_SIZE];\n+    return mPageLocks[Math.floorMod((int) (pageId.getFileId() + pageId.getPageIndex()), LOCK_SIZE)];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NTQ3Mw==", "bodyText": "We don't need it to handle - if the sum is overflow it will become negative, but the floorMod will always return non-negative when the second argument is positive.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366655473", "createdAt": "2020-01-15T01:19:29Z", "author": {"login": "bf8086"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheManager.java", "diffHunk": "@@ -103,7 +103,7 @@ public LocalCacheManager(FileSystemContext fsContext) {\n    * @return the corresponding page lock\n    */\n   private ReadWriteLock getPageLock(PageId pageId) {\n-    return mPageLocks[(int) (pageId.getFileId() + pageId.getPageIndex()) % LOCK_SIZE];\n+    return mPageLocks[Math.floorMod((int) (pageId.getFileId() + pageId.getPageIndex()), LOCK_SIZE)];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NDM4MQ=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTMyMTc5OnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxNjowMlrOFdq02w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozMzoyNVrOFdrEJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NDY4Mw==", "bodyText": "maybe something like /tmp/alluxio_cache to avoid creating too many dirs under /tmp directly?", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366654683", "createdAt": "2020-01-15T01:16:02Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3120,6 +3120,19 @@ public String toString() {\n               + \"`alluxio.client.file.cache.LRUCacheEvictor`.\")\n           .setScope(Scope.CLIENT)\n           .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_DIR =\n+      new Builder(Name.USER_CLIENT_CACHE_DIR)\n+          .setDefaultValue(\"/tmp\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1ODU5Nw==", "bodyText": "Done.", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366658597", "createdAt": "2020-01-15T01:33:25Z", "author": {"login": "bf8086"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3120,6 +3120,19 @@ public String toString() {\n               + \"`alluxio.client.file.cache.LRUCacheEvictor`.\")\n           .setScope(Scope.CLIENT)\n           .build();\n+  public static final PropertyKey USER_CLIENT_CACHE_DIR =\n+      new Builder(Name.USER_CLIENT_CACHE_DIR)\n+          .setDefaultValue(\"/tmp\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1NDY4Mw=="}, "originalCommit": {"oid": "6b537ceb62c1172eab53735c15e165014338945b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NTM1NDg2OnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/test/java/alluxio/client/file/cache/LocalCacheFileInStreamTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozOTowM1rOFdrIzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMTozOTowM1rOFdrIzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1OTc4OQ==", "bodyText": "Good catch", "url": "https://github.com/Alluxio/alluxio/pull/10749#discussion_r366659789", "createdAt": "2020-01-15T01:39:03Z", "author": {"login": "calvinjia"}, "path": "core/client/fs/src/test/java/alluxio/client/file/cache/LocalCacheFileInStreamTest.java", "diffHunk": "@@ -300,7 +325,7 @@ public ReadableByteChannel get(PageId pageId, int pageOffset) {\n       }\n       mPagesServed++;\n       return Channels.newChannel(new ByteArrayInputStream(\n-          Arrays.copyOfRange(mPages.get(pageId), pageOffset, PAGE_SIZE - pageOffset)));\n+          Arrays.copyOfRange(mPages.get(pageId), pageOffset, PAGE_SIZE)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7dad948e5feda5ea544458694c80d50b6c4db02"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2244, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}