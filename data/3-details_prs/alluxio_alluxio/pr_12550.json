{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyOTIzOTQz", "number": 12550, "title": "Fix speed test issues", "bodyText": "", "createdAt": "2020-11-18T05:29:38Z", "url": "https://github.com/Alluxio/alluxio/pull/12550", "merged": true, "mergeCommit": {"oid": "718debcf45944995e7825d48928ebd9dfb9497ba"}, "closed": true, "closedAt": "2020-11-18T05:56:17Z", "author": {"login": "yuzhu"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddnTtiAH2gAyNTIyOTIzOTQzOmRhYmI4NjdmNDkzY2MwYzFlNDc2Y2UzNzcyODZlZmU2MDk2MDVlZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd75N2AFqTUzNDA4ODg5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dabb867f493cc0c1e476ce377286efe609605ef0", "author": {"user": {"login": "yuzhu", "name": "David Zhu"}}, "url": "https://github.com/Alluxio/alluxio/commit/dabb867f493cc0c1e476ce377286efe609605ef0", "committedDate": "2020-11-18T05:28:52Z", "message": "Fix speed test issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDg4ODky", "url": "https://github.com/Alluxio/alluxio/pull/12550#pullrequestreview-534088892", "createdAt": "2020-11-19T05:19:23Z", "commit": {"oid": "dabb867f493cc0c1e476ce377286efe609605ef0"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNToxOToyM1rOH2NJaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNToyNjowMFrOH2NQ0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwMDU1Mg==", "bodyText": "Do you think we can add more comments to this part explaining what arguments you keep and what you throw away?", "url": "https://github.com/Alluxio/alluxio/pull/12550#discussion_r526600552", "createdAt": "2020-11-19T05:19:23Z", "author": {"login": "jiacheliu3"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -123,20 +122,36 @@ public String runTask(StressBenchConfig config, ArrayList<String> args,\n     command.add(BaseParameters.DISTRIBUTED_FLAG);\n     command.add(BaseParameters.IN_PROCESS_FLAG);\n \n-    List<String> commandArgs = config.getArgs().stream().filter((s) ->\n-        !BaseParameters.CLUSTER_FLAG.equals(s) && !s.isEmpty())\n-        .collect(Collectors.toList());\n-\n+    List<String> commandArgs = config.getArgs();\n+    List<String> newArgs = new ArrayList<>();\n     if (commandArgs.stream().anyMatch(\n-        (s) -> s.equalsIgnoreCase(UfsIOParameters.USE_MOUNT_CONF))) {\n-      // get ufs Uri from --path=blah://blah\n-      String ufsUri = commandArgs.stream().filter(s -> !s.startsWith(UfsIOParameters.PATH))\n-          .findFirst().map(param -> param.substring(\"--path\".length())).orElse(\"\");\n-      commandArgs = commandArgs.stream().filter((s) -> !UfsIOParameters.USE_MOUNT_CONF.equals(s)\n-              && !s.startsWith(UfsIOParameters.CONF)).collect(Collectors.toList());\n+        (s) -> s.equals(UfsIOParameters.USE_MOUNT_CONF))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dabb867f493cc0c1e476ce377286efe609605ef0"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwMjI3Mg==", "bodyText": "Is it possible that I have mount points hdfs://a and hdfs://a/b and they have different configurations (maybe access control or UGI)?", "url": "https://github.com/Alluxio/alluxio/pull/12550#discussion_r526602272", "createdAt": "2020-11-19T05:25:20Z", "author": {"login": "jiacheliu3"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -101,7 +100,7 @@ public StressBenchDefinition() {\n       throws Exception {\n     Map<String, MountPointInfo> mountTable = runTaskContext.getFileSystem().getMountTable();\n     for (Map.Entry<String, MountPointInfo> entry : mountTable.entrySet()) {\n-      if (PathUtils.hasPrefix(ufsUri, entry.getKey())) {\n+      if (ufsUri.startsWith(entry.getValue().getUfsUri())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dabb867f493cc0c1e476ce377286efe609605ef0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwMjQ1MQ==", "bodyText": "Is it possible we have more parameters after PATH?", "url": "https://github.com/Alluxio/alluxio/pull/12550#discussion_r526602451", "createdAt": "2020-11-19T05:26:00Z", "author": {"login": "jiacheliu3"}, "path": "job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java", "diffHunk": "@@ -123,20 +122,36 @@ public String runTask(StressBenchConfig config, ArrayList<String> args,\n     command.add(BaseParameters.DISTRIBUTED_FLAG);\n     command.add(BaseParameters.IN_PROCESS_FLAG);\n \n-    List<String> commandArgs = config.getArgs().stream().filter((s) ->\n-        !BaseParameters.CLUSTER_FLAG.equals(s) && !s.isEmpty())\n-        .collect(Collectors.toList());\n-\n+    List<String> commandArgs = config.getArgs();\n+    List<String> newArgs = new ArrayList<>();\n     if (commandArgs.stream().anyMatch(\n-        (s) -> s.equalsIgnoreCase(UfsIOParameters.USE_MOUNT_CONF))) {\n-      // get ufs Uri from --path=blah://blah\n-      String ufsUri = commandArgs.stream().filter(s -> !s.startsWith(UfsIOParameters.PATH))\n-          .findFirst().map(param -> param.substring(\"--path\".length())).orElse(\"\");\n-      commandArgs = commandArgs.stream().filter((s) -> !UfsIOParameters.USE_MOUNT_CONF.equals(s)\n-              && !s.startsWith(UfsIOParameters.CONF)).collect(Collectors.toList());\n+        (s) -> s.equals(UfsIOParameters.USE_MOUNT_CONF))) {\n+      boolean nextElem = false;\n+      boolean removeNext = false;\n+      String ufsUri = \"\";\n+      for (String elem : commandArgs) {\n+        if (elem.equals(UfsIOParameters.CONF)) {\n+          removeNext = true;\n+        } else {\n+          if (!removeNext) {\n+            newArgs.add(elem);\n+          }\n+          removeNext = false;\n+        }\n+        if (elem.equals(UfsIOParameters.PATH)) {\n+          nextElem = true;\n+        } else {\n+          if (nextElem) {\n+            ufsUri = elem;\n+            break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dabb867f493cc0c1e476ce377286efe609605ef0"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3456, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}