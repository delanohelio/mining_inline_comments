{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODIwODIy", "number": 12653, "title": "Add 'attachdb' option for mounting diff prefix partitions", "bodyText": "This PR aims to add an Hive UDB option in table attachdb command, to allow mounting partitions in Hive tables that don't share the same location prefix with that of the table.\nFixes #12651", "createdAt": "2020-12-16T01:10:21Z", "url": "https://github.com/Alluxio/alluxio/pull/12653", "merged": true, "mergeCommit": {"oid": "fdba11b399e1039bc86fde93b1a8fe29634de834"}, "closed": true, "closedAt": "2021-01-25T22:56:17Z", "author": {"login": "hycsam"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmkQqCAH2gAyNTQwODIwODIyOjkyMDIxMjUzMDZiN2NmNzZjNTkwNDA2OWQzZDMwZmE1NmQ2OTcxZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyDoQWAFqTU3MjQ3NzE3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9202125306b7cf76c5904069d3d30fa56d6971d7", "author": {"user": {"login": "hycsam", "name": "hycsam"}}, "url": "https://github.com/Alluxio/alluxio/commit/9202125306b7cf76c5904069d3d30fa56d6971d7", "committedDate": "2020-12-16T01:01:08Z", "message": "Add option to allow mounting partitions with diff location prefix than table location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e", "author": {"user": {"login": "hycsam", "name": "hycsam"}}, "url": "https://github.com/Alluxio/alluxio/commit/990be09870d46a22d940250f47a29ad33bb73f2e", "committedDate": "2020-12-16T01:06:10Z", "message": "Lint fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMjMxNjIw", "url": "https://github.com/Alluxio/alluxio/pull/12653#pullrequestreview-553231620", "createdAt": "2020-12-16T01:11:53Z", "commit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxMTo1NFrOIGnHxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxMTo1NFrOIGnHxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgwMzMzNQ==", "bodyText": "This file is using the same code structure as alluxio/table/under/glue/Property.java", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r543803335", "createdAt": "2020-12-16T01:11:54Z", "author": {"login": "hycsam"}, "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/Property.java", "diffHunk": "@@ -11,12 +11,166 @@\n \n package alluxio.table.under.hive;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODkzMjI4", "url": "https://github.com/Alluxio/alluxio/pull/12653#pullrequestreview-554893228", "createdAt": "2020-12-17T18:50:58Z", "commit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MDo1OFrOIID8RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo1MTo0MFrOIID-2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDEwMA==", "bodyText": "Can we make this property a general udb property, and not hive specific?", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545324100", "createdAt": "2020-12-17T18:50:58Z", "author": {"login": "gpang"}, "path": "docs/en/operation/User-CLI.md", "diffHunk": "@@ -1315,6 +1315,13 @@ This command will attach the database `hive_db_name` (of type `hive`) from the U\n When paths are mounted for `s3a://bucket1`, the mount option `aws.accessKeyId=abc` will be used,\n and when paths are mounted for `s3a://bucket2`, the mount option `aws.accessKeyId=123` will be used.\n \n+Besides mount options, there are some additional properties with the `-o` options:\n+  * `udb-hive.<UDB_PROPERTY>`: specify the UDB options for the Hive UDB. The options\n+  are as follows\n+    * `allow.diff.partition.location.prefix`: Whether to mount partitions that do not share", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDc2Mg==", "bodyText": "Can this be a general property, since the glue integration also has a similar check: https://github.com/Alluxio/alluxio/blob/master/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java#L263", "url": "https://github.com/Alluxio/alluxio/pull/12653#discussion_r545324762", "createdAt": "2020-12-17T18:51:40Z", "author": {"login": "gpang"}, "path": "table/server/underdb/hive/src/main/java/alluxio/table/under/hive/HiveDatabase.java", "diffHunk": "@@ -162,8 +162,12 @@ private PathTranslator mountAlluxioPaths(Table table, List<Partition> partitions\n \n       for (Partition part : partitions) {\n         AlluxioURI partitionUri;\n-        if (part.getSd() != null && part.getSd().getLocation() != null\n-            && ufsUri.isAncestorOf(partitionUri = new AlluxioURI(part.getSd().getLocation()))) {\n+        if (part.getSd() != null && part.getSd().getLocation() != null) {\n+          partitionUri = new AlluxioURI(part.getSd().getLocation());\n+          if (!mConfiguration.getBoolean(Property.ALLOW_DIFF_PART_LOC_PREFIX)\n+              && !ufsUri.isAncestorOf(partitionUri)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNDc3MTcw", "url": "https://github.com/Alluxio/alluxio/pull/12653#pullrequestreview-572477170", "createdAt": "2021-01-20T17:47:08Z", "commit": {"oid": "990be09870d46a22d940250f47a29ad33bb73f2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3359, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}