{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjgzNzUz", "number": 11924, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzo0OTowMlrOEWB1lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzo0OTowMlrOEWB1lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTM0MjI4OnYy", "diffSide": "LEFT", "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzo0OTowMlrOG9H1JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwMToyOToyMlrOG9sdlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw==", "bodyText": "If this test assumed that logout twice is a no-op, is there any place in the code that uses it which makes the same assumption?", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r466744613", "createdAt": "2020-08-06T23:49:02Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE1OTg1OA==", "bodyText": "no ... we don't even use logout", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467159858", "createdAt": "2020-08-07T16:59:48Z", "author": {"login": "LuQQiu"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4Mjk0Mw==", "bodyText": "@bf8086  could you take a look at this and confirm that we don't assume logout is idempotent anywhere in our code?", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467182943", "createdAt": "2020-08-07T17:46:50Z", "author": {"login": "yuzhu"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1MjI0Mg==", "bodyText": "It looks like we do it on EE for relogins. It is also likely this is indirectly called from JDK or Hadoop. Maybe we can disable it only for Java 11 to ensure it doesn't regress on Java 8?", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467252242", "createdAt": "2020-08-07T20:24:03Z", "author": {"login": "bf8086"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2NTg2Mw==", "bodyText": "@bf8086 is there a test we can write to ensure our relogins on EE will work under java 11? do we need special handling for java 11? if so, there is a function available for it here. \n  \n    \n      alluxio/core/common/src/main/java/alluxio/util/CommonUtils.java\n    \n    \n         Line 127\n      in\n      5ce8371\n    \n    \n    \n    \n\n        \n          \n           public static int getJavaVersion() {", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467265863", "createdAt": "2020-08-07T20:58:34Z", "author": {"login": "yuzhu"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMxMjkyMA==", "bodyText": "We do have a relogin test in Autobots. Not sure what is the impact from Java 11. I don't think we should specialize in our production code. If it doesn't work in Java 11 due to the idempotent issue then we should make it not assume that regardless of the java version.\nWe should still specialize the test here for java 11 to make sure it doesn't break the promise for other callers(i.e. in case Java 8 itself calls logout internally multiple times).", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467312920", "createdAt": "2020-08-07T22:30:13Z", "author": {"login": "bf8086"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM0NDc4OQ==", "bodyText": "@LuQQiu do you mind updating the PR to only test calling twice on Java 8?", "url": "https://github.com/Alluxio/alluxio/pull/11924#discussion_r467344789", "createdAt": "2020-08-08T01:29:22Z", "author": {"login": "yuzhu"}, "path": "core/common/src/test/java/alluxio/security/login/LoginModuleTest.java", "diffHunk": "@@ -62,10 +62,6 @@ public void simpleLogin() throws Exception {\n     // logout and verify the user is removed\n     loginContext.logout();\n     assertTrue(subject.getPrincipals(User.class).isEmpty());\n-\n-    // logout twice should be no-op.\n-    loginContext.logout();\n-    assertTrue(subject.getPrincipals(User.class).isEmpty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NDYxMw=="}, "originalCommit": {"oid": "01bb4aef55cc8fd36460c5d2494422429953e5bb"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1384, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}