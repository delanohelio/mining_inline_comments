{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMTM3ODQy", "number": 12288, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozMzo1M1rOEtnHnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDowMTowM1rOEtuhAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjYyMzAzOnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozMzo1M1rOHhf_yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMzo0MzoyMFrOHhrWqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg4OTI5MQ==", "bodyText": "Please fix the comment way", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r504889291", "createdAt": "2020-10-14T18:33:53Z", "author": {"login": "LuQQiu"}, "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16dd2ffd1f55d3f94caf09680b8ef5904900097c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NTM2OQ==", "bodyText": "OK, sorry for this", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505075369", "createdAt": "2020-10-14T23:43:20Z", "author": {"login": "maobaolong"}, "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg4OTI5MQ=="}, "originalCommit": {"oid": "16dd2ffd1f55d3f94caf09680b8ef5904900097c"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjYzNzIwOnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNzo0OVrOHhgIoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMzo0MjozNFrOHhrUfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MTU1Mw==", "bodyText": "Why need two mockito mock?\ncan the path be strings other than ssdPath and hdd path?", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r504891553", "createdAt": "2020-10-14T18:37:49Z", "author": {"login": "LuQQiu"}, "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize\n+    PowerMockito.mockStatic(StorageDir.class);\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        anyString(),\n+        anyString())).thenCallRealMethod();\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        or(startsWith(ssdPath), startsWith(hddPath)),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16dd2ffd1f55d3f94caf09680b8ef5904900097c"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NDgxNA==", "bodyText": "Yeah, the mem tier path is another path, we need to call real method when the path is mem path.", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505074814", "createdAt": "2020-10-14T23:42:34Z", "author": {"login": "maobaolong"}, "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize\n+    PowerMockito.mockStatic(StorageDir.class);\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        anyString(),\n+        anyString())).thenCallRealMethod();\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        or(startsWith(ssdPath), startsWith(hddPath)),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MTU1Mw=="}, "originalCommit": {"oid": "16dd2ffd1f55d3f94caf09680b8ef5904900097c"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzgzNDkwOnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDowMTowM1rOHhsFRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDowMTowM1rOHhsFRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA4NzMwMw==", "bodyText": "is this because StorageDir is final?\nIn case yes, lets change public final class StorageDir to be public class StorageDir.\nIn general, we should avoid using PowerMock which has a lot limitation", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505087303", "createdAt": "2020-10-15T00:01:03Z", "author": {"login": "apc999"}, "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -38,6 +53,9 @@\n /**\n  * Tests for getting worker lost storage information.\n  */\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({StorageDir.class})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "483e5392d3ad598852e6e93cc4e337c8b741dfc2"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1151, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}