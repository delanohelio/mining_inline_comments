{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMwOTk1NjQw", "number": 11527, "title": "Add a root/nonroot switch to helm chart", "bodyText": "This resolves #11526", "createdAt": "2020-06-08T09:33:38Z", "url": "https://github.com/Alluxio/alluxio/pull/11527", "merged": true, "mergeCommit": {"oid": "658fd3132d3323304467b46073b551a6f6268af6"}, "closed": true, "closedAt": "2020-06-10T01:18:51Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpND2ggH2gAyNDMwOTk1NjQwOjQzNTZlZjdjMmZmOTc1NTNlZWIwMThhNjgzMmY1ZDZkMWUwM2U5Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpvMFhgFqTQyNzY0NzI1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/4356ef7c2ff97553eeb018a6832f5d6d1e03e927", "committedDate": "2020-06-08T09:29:57Z", "message": "add root option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDY0Mzc5", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-426064379", "createdAt": "2020-06-08T09:36:33Z", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNjozNFrOGgWOIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNjozNFrOGgWOIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3MTY4MQ==", "bodyText": "Use the specified .Values.master.hostNetwork if specified, otherwise infer based on whether the user is root.\nFYI for boolean values the {{ .Values.master.hostNetwork | default $isRoot}} grammar doesn't work, because a false value for .Values.master.hostNetwork will also go to the default branch.", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436571681", "createdAt": "2020-06-08T09:36:34Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -50,8 +50,8 @@ spec:\n         heritage: {{ .Release.Service }}\n         role: alluxio-master\n     spec:\n-      hostNetwork: {{ .Values.master.hostNetwork }}\n-      dnsPolicy: {{ .Values.master.dnsPolicy }}\n+      hostNetwork: {{ hasKey .Values.master \"hostNetwork\" | ternary .Values.master.hostNetwork $isRoot }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDY0NzEw", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-426064710", "createdAt": "2020-06-08T09:37:02Z", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNzowM1rOGgWPHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNzowM1rOGgWPHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3MTkzNA==", "bodyText": "I don't think we still want to consider emptyDir, do we?", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436571934", "createdAt": "2020-06-08T09:37:03Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -194,8 +194,23 @@ spec:\n             claimName: \"{{ .name }}\"\n           {{- end }}\n         {{- end }}\n+  {{- if $isRoot }}\n+  volumes:\n+    {{- if $needJournalVolume }}\n+    - name: alluxio-journal\n+      hostPath:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDY1MjU5", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-426065259", "createdAt": "2020-06-08T09:37:47Z", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNzo0N1rOGgWQww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNzo0N1rOGgWQww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3MjM1NQ==", "bodyText": "This field is obsoleted. Removing it is irrelevant to the change.", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436572355", "createdAt": "2020-06-08T09:37:47Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -73,15 +73,13 @@ master:\n   # JVM options specific to the master container\n   jvmOptions:\n   nodeSelector: {}\n-  hostNetwork: false\n-  dnsPolicy: ClusterFirst\n   # Example: use ROCKS DB instead of Heap\n   # metastore:\n   #   size: 1Gi\n-  #   mountPath: /metastore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDY1ODY3", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-426065867", "createdAt": "2020-06-08T09:38:41Z", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozODo0MVrOGgWSsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozODo0MVrOGgWSsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3Mjg0OQ==", "bodyText": "Removed these two by default and use inference. However they can still be set to override, especially when we want to use some dnsPolicy other than ClusterFirst and ClusterFirstWithHostNet", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436572849", "createdAt": "2020-06-08T09:38:41Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -73,15 +73,13 @@ master:\n   # JVM options specific to the master container\n   jvmOptions:\n   nodeSelector: {}\n-  hostNetwork: false\n-  dnsPolicy: ClusterFirst", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjE3MjIx", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-426617221", "createdAt": "2020-06-08T21:00:27Z", "commit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowMDoyN1rOGgwPIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowMzozMlrOGgwVPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5NzkyMA==", "bodyText": "no", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436997920", "createdAt": "2020-06-08T21:00:27Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -194,8 +194,23 @@ spec:\n             claimName: \"{{ .name }}\"\n           {{- end }}\n         {{- end }}\n+  {{- if $isRoot }}\n+  volumes:\n+    {{- if $needJournalVolume }}\n+    - name: alluxio-journal\n+      hostPath:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3MTkzNA=="}, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5OTAxMA==", "bodyText": "instead of removing this, i would comment it out and explain the order of precedence", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436999010", "createdAt": "2020-06-08T21:02:33Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -73,15 +73,13 @@ master:\n   # JVM options specific to the master container\n   jvmOptions:\n   nodeSelector: {}\n-  hostNetwork: false\n-  dnsPolicy: ClusterFirst", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3Mjg0OQ=="}, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5OTM3Mw==", "bodyText": "add comment defining when this property is used", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436999373", "createdAt": "2020-06-08T21:03:18Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -119,6 +117,7 @@ journal:\n   type: \"UFS\" # \"UFS\" or \"EMBEDDED\"\n   ufsType: \"local\" # Ignored if type is \"EMBEDDED\". \"local\" or \"HDFS\"\n   folder: \"/journal\" # Master journal folder\n+  hostPath: \"/tmp/journal\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5OTQ4NA==", "bodyText": "same here, comment", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r436999484", "createdAt": "2020-06-08T21:03:32Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -229,6 +226,7 @@ shortCircuit:\n     - ReadWriteOnce\n   pvcSize: 1Mi\n   pvcStorageClass: standard\n+  hostPath: \"/tmp/alluxio-domain\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4356ef7c2ff97553eeb018a6832f5d6d1e03e927"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5acfb4ec7c8df4040f902890c7f938cc2f55a39", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b5acfb4ec7c8df4040f902890c7f938cc2f55a39", "committedDate": "2020-06-09T12:16:39Z", "message": "resolve comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "567c2b727a505565bf49d7389541b6197d674337", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/567c2b727a505565bf49d7389541b6197d674337", "committedDate": "2020-06-09T15:08:12Z", "message": "dup key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff51ee6a1821208199550c9b8ae5bfb3843bacc3", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/ff51ee6a1821208199550c9b8ae5bfb3843bacc3", "committedDate": "2020-06-09T15:14:59Z", "message": "use random str for hostpath"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1933108f38cf6c1c635a94d877f6c7ac3d36550b", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/1933108f38cf6c1c635a94d877f6c7ac3d36550b", "committedDate": "2020-06-09T15:33:08Z", "message": "give up random id for hostpath dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c25dbb09a1514e976ecb1722f66245af263c5b52", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/c25dbb09a1514e976ecb1722f66245af263c5b52", "committedDate": "2020-06-09T15:35:47Z", "message": "remove hostpath for journal and metastore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjkyNTE0", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-427292514", "createdAt": "2020-06-09T15:39:54Z", "commit": {"oid": "1933108f38cf6c1c635a94d877f6c7ac3d36550b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTozOTo1NlrOGhQsWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTozOTo1NlrOGhQsWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyOTY5MQ==", "bodyText": "@madanadit I realized during testing that using hostPath is really hard when we deploy as StatefulSet, as each master should be using different paths. Current w/o internal logic in Alluxio (for example write to <journal-path>/<master-id>/ when given the journal path) I don't think it will work. Currently in a non-k8s env, we don't really support deploying multiple masters on one machine right?", "url": "https://github.com/Alluxio/alluxio/pull/11527#discussion_r437529691", "createdAt": "2020-06-09T15:39:56Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -194,22 +194,8 @@ spec:\n             claimName: \"{{ .name }}\"\n           {{- end }}\n         {{- end }}\n-  {{- if $isRoot }}\n-    {{- if $needJournalVolume }}\n-        - name: alluxio-journal\n-          hostPath:\n-            path: {{ printf \"%v/%v\" .Values.journal.hostPath (randAlphaNum 16) }}\n-            type: DirectoryOrCreate\n-    {{- end }}\n-    {{- if .Values.master.metastore }}\n-        - name: alluxio-metastore\n-          hostPath:\n-            path: {{ printf \"%v/%v\" .Values.master.metastore.hostPath (randAlphaNum 16) }}\n-            type: DirectoryOrCreate\n-    {{- end }}\n-  {{- else }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1933108f38cf6c1c635a94d877f6c7ac3d36550b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d644721024134dfd80d575bd79b24e4a00e0d5", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/f7d644721024134dfd80d575bd79b24e4a00e0d5", "committedDate": "2020-06-09T15:48:13Z", "message": "bump version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjQ3MjU4", "url": "https://github.com/Alluxio/alluxio/pull/11527#pullrequestreview-427647258", "createdAt": "2020-06-10T01:15:43Z", "commit": {"oid": "f7d644721024134dfd80d575bd79b24e4a00e0d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4480, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}