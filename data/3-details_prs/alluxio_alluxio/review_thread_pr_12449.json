{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MzQ0MDg2", "number": 12449, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo0ODowOFrOE0oYCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo1MTozNlrOE0oayg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjIyOTIzOnYy", "diffSide": "RIGHT", "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo0ODowOFrOHsd0XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjozMzowN1rOHtC2Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw==", "bodyText": "Is there any value in making this configurable?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516387933", "createdAt": "2020-11-03T01:48:08Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4NjMxNQ==", "bodyText": "Yeah, I was torn about this. My concern was that there could be too many logging thresholds to configure, which could be confusing.\nOn the other hand, the hardcoded threshold may not be correct or reasonable.\nI guess we could combine the read and write threshold into something like \"worker.remote.read.slow.io.threshold\"? That could handle both the read and write case?\nWhat do you think?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516886315", "createdAt": "2020-11-03T18:53:27Z", "author": {"login": "gpang"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1OTQxMA==", "bodyText": "I added a config parameter.", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516959410", "createdAt": "2020-11-03T21:14:47Z", "author": {"login": "gpang"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk5NDYxOA==", "bodyText": "Yeah, I think one threshold param would be sufficient.", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516994618", "createdAt": "2020-11-03T22:33:07Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjIzNjI2OnYy", "diffSide": "RIGHT", "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo1MTozNlrOHsd4Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMjozMzoyNVrOHtC2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4ODkwMg==", "bodyText": "For the sampling logger, is it possible to retain a count of how many were skipped due to sampling?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516388902", "createdAt": "2020-11-03T01:51:36Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "diffHunk": "@@ -58,6 +60,8 @@\n   private static final Logger LOG = LoggerFactory.getLogger(BlockReadHandler.class);\n   private static final long UFS_BLOCK_OPEN_TIMEOUT_MS =\n       ServerConfiguration.getMs(PropertyKey.WORKER_UFS_BLOCK_OPEN_TIMEOUT_MS);\n+  private static final Logger SLOW_BUFFER_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MDM5MQ==", "bodyText": "It would be possible, but I think that functionality should go into a separate PR.", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516880391", "createdAt": "2020-11-03T18:42:56Z", "author": {"login": "gpang"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "diffHunk": "@@ -58,6 +60,8 @@\n   private static final Logger LOG = LoggerFactory.getLogger(BlockReadHandler.class);\n   private static final long UFS_BLOCK_OPEN_TIMEOUT_MS =\n       ServerConfiguration.getMs(PropertyKey.WORKER_UFS_BLOCK_OPEN_TIMEOUT_MS);\n+  private static final Logger SLOW_BUFFER_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4ODkwMg=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk5NDc1Mg==", "bodyText": "Makes sense", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516994752", "createdAt": "2020-11-03T22:33:25Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "diffHunk": "@@ -58,6 +60,8 @@\n   private static final Logger LOG = LoggerFactory.getLogger(BlockReadHandler.class);\n   private static final long UFS_BLOCK_OPEN_TIMEOUT_MS =\n       ServerConfiguration.getMs(PropertyKey.WORKER_UFS_BLOCK_OPEN_TIMEOUT_MS);\n+  private static final Logger SLOW_BUFFER_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4ODkwMg=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 995, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}