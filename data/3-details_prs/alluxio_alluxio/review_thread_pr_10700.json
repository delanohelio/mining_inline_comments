{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTg2MjE5", "number": 10700, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzozMTo1NlrODWCVCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMjo0Njo1MlrODXAYew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDMzNDE5OnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzozMTo1NlrOFakDwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzozMTo1NlrOFakDwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM5ODA4MA==", "bodyText": "Is this specific to transform/format or should this be more general to any job needing a \"Path\"?\nAlso, the name is a bit misleading, since the cache is not caching a path, but the fs client. Maybe rename to something like \"JobPath\"?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r363398080", "createdAt": "2020-01-06T17:31:56Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class CachedPath extends Path {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5508b0774bb79a8193238a093bf56a22a0fc7c9"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDMzOTk5OnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzozNDozMlrOFakHnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxODozMzoxNlrOFalhvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM5OTA2OA==", "bodyText": "Are these the only user config we are interested in? Could there be issues for reusing a client when other user config values differ?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r363399068", "createdAt": "2020-01-06T17:34:32Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class CachedPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5508b0774bb79a8193238a093bf56a22a0fc7c9"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQyMjE0Mw==", "bodyText": "There definitely can be new user configs in the future that we may care that we currently don't. It's going to be impossible to have this be always up-to-date. For example, one that I can currently think of Replication.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r363422143", "createdAt": "2020-01-06T18:33:16Z", "author": {"login": "bradyoo"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class CachedPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM5OTA2OA=="}, "originalCommit": {"oid": "c5508b0774bb79a8193238a093bf56a22a0fc7c9"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDM0NjMwOnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzozNzoyOVrOFakLtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxODozNToyNlrOFallQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQwMDExOA==", "bodyText": "How does this conf get set/created for the job?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r363400118", "createdAt": "2020-01-06T17:37:29Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class CachedPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;\n+    final WriteType mWriteType;\n+\n+    public FileSystemKey(CachedPath path, Configuration conf) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5508b0774bb79a8193238a093bf56a22a0fc7c9"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQyMzA0Mw==", "bodyText": "This is part of the Path.getFileSystem call.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r363423043", "createdAt": "2020-01-06T18:35:26Z", "author": {"login": "bradyoo"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/CachedPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class CachedPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;\n+    final WriteType mWriteType;\n+\n+    public FileSystemKey(CachedPath path, Configuration conf) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQwMDExOA=="}, "originalCommit": {"oid": "c5508b0774bb79a8193238a093bf56a22a0fc7c9"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0OTY1MzgwOnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzozNzo1MFrOFbXE2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMTo0ODoxNVrOFbk22w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIzMzk0Nw==", "bodyText": "Can we add a unittest for this, to verify the cache behavior?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364233947", "createdAt": "2020-01-08T13:37:50Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class JobPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;\n+    final WriteType mWriteType;\n+\n+    public FileSystemKey(JobPath path, Configuration conf) throws IOException {\n+      URI uri = path.toUri();\n+      mScheme = uri.getScheme() == null ? \"\" : uri.getScheme().toLowerCase();\n+      mAuthority = uri.getAuthority() == null ? \"\" : uri.getScheme().toLowerCase();\n+      mUgi = UserGroupInformation.getCurrentUser();\n+      mReadType = conf.getEnum(PropertyKey.USER_FILE_READ_TYPE_DEFAULT.getName(),\n+          InstancedConfiguration.defaults().getEnum(\n+              PropertyKey.USER_FILE_READ_TYPE_DEFAULT, ReadType.class));\n+      mWriteType = conf.getEnum(PropertyKey.USER_FILE_WRITE_TYPE_DEFAULT.getName(),\n+          InstancedConfiguration.defaults().getEnum(\n+              PropertyKey.USER_FILE_WRITE_TYPE_DEFAULT, WriteType.class));\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+      return Objects.hashCode(mScheme, mAuthority, mUgi, mReadType, mWriteType);\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+      if (o == null) {\n+        return false;\n+      }\n+      if (this == o) {\n+        return true;\n+      }\n+      if (!(o instanceof FileSystemKey)) {\n+        return false;\n+      }\n+      FileSystemKey that = (FileSystemKey) o;\n+      return Objects.equal(mScheme, that.mScheme)\n+          && Objects.equal(mAuthority, that.mAuthority)\n+          && Objects.equal(mUgi, that.mUgi)\n+          && Objects.equal(mReadType, that.mReadType)\n+          && Objects.equal(mWriteType, that.mWriteType);\n+    }\n+  }\n+\n+  /**\n+   * Copy of the constructor in {@link Path}.\n+   * @param scheme the scheme\n+   * @param authority the authority\n+   * @param path the path\n+   */\n+  public JobPath(String scheme, String authority, String path) {\n+    super(scheme, authority, path);\n+  }\n+\n+  @Override\n+  public FileSystem getFileSystem(Configuration conf) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56592815151754962bc0615a041fd307bc61ffe2"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1OTczOQ==", "bodyText": "Will add test.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364459739", "createdAt": "2020-01-08T21:48:15Z", "author": {"login": "bradyoo"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class JobPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =\n+      new ConcurrentHashMap<>();\n+\n+  private static class FileSystemKey {\n+\n+    final String mScheme;\n+    final String mAuthority;\n+    final UserGroupInformation mUgi;\n+    final ReadType mReadType;\n+    final WriteType mWriteType;\n+\n+    public FileSystemKey(JobPath path, Configuration conf) throws IOException {\n+      URI uri = path.toUri();\n+      mScheme = uri.getScheme() == null ? \"\" : uri.getScheme().toLowerCase();\n+      mAuthority = uri.getAuthority() == null ? \"\" : uri.getScheme().toLowerCase();\n+      mUgi = UserGroupInformation.getCurrentUser();\n+      mReadType = conf.getEnum(PropertyKey.USER_FILE_READ_TYPE_DEFAULT.getName(),\n+          InstancedConfiguration.defaults().getEnum(\n+              PropertyKey.USER_FILE_READ_TYPE_DEFAULT, ReadType.class));\n+      mWriteType = conf.getEnum(PropertyKey.USER_FILE_WRITE_TYPE_DEFAULT.getName(),\n+          InstancedConfiguration.defaults().getEnum(\n+              PropertyKey.USER_FILE_WRITE_TYPE_DEFAULT, WriteType.class));\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+      return Objects.hashCode(mScheme, mAuthority, mUgi, mReadType, mWriteType);\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+      if (o == null) {\n+        return false;\n+      }\n+      if (this == o) {\n+        return true;\n+      }\n+      if (!(o instanceof FileSystemKey)) {\n+        return false;\n+      }\n+      FileSystemKey that = (FileSystemKey) o;\n+      return Objects.equal(mScheme, that.mScheme)\n+          && Objects.equal(mAuthority, that.mAuthority)\n+          && Objects.equal(mUgi, that.mUgi)\n+          && Objects.equal(mReadType, that.mReadType)\n+          && Objects.equal(mWriteType, that.mWriteType);\n+    }\n+  }\n+\n+  /**\n+   * Copy of the constructor in {@link Path}.\n+   * @param scheme the scheme\n+   * @param authority the authority\n+   * @param path the path\n+   */\n+  public JobPath(String scheme, String authority, String path) {\n+    super(scheme, authority, path);\n+  }\n+\n+  @Override\n+  public FileSystem getFileSystem(Configuration conf) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIzMzk0Nw=="}, "originalCommit": {"oid": "56592815151754962bc0615a041fd307bc61ffe2"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0OTY2MTE0OnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMzo0MDowM1rOFbXJAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQyMTo0ODowOFrOFbk2qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIzNTAwOA==", "bodyText": "should we use a guava CacheBuilder with a maximum size, to limit the unlimited growth?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364235008", "createdAt": "2020-01-08T13:40:03Z", "author": {"login": "gpang"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class JobPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56592815151754962bc0615a041fd307bc61ffe2"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1OTY4OQ==", "bodyText": "For now, this is not much of a concern. mScheme, mAuthority, and mUgi are all basically always gonna be constant and even mReadType and mWriteType is very limited.\nWhat's going to get really annoying once we limit size is I don't know which cache is going to need to close the FileSystem on removal.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364459689", "createdAt": "2020-01-08T21:48:08Z", "author": {"login": "bradyoo"}, "path": "job/server/src/main/java/alluxio/job/plan/transform/format/JobPath.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import alluxio.client.ReadType;\n+import alluxio.client.WriteType;\n+import alluxio.conf.InstancedConfiguration;\n+import alluxio.conf.PropertyKey;\n+\n+import com.google.common.base.Objects;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.security.UserGroupInformation;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Implementation of {@link Path} that has a cache for getting file system.\n+ */\n+public class JobPath extends Path {\n+\n+  private static final ConcurrentHashMap<FileSystemKey, FileSystem> CACHE =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIzNTAwOA=="}, "originalCommit": {"oid": "56592815151754962bc0615a041fd307bc61ffe2"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MzQwMjM0OnYy", "diffSide": "RIGHT", "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNTo1ODo0MVrOFb626w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxOTo0NDo1NVrOFcBY2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDIwMw==", "bodyText": "I'm not sure how this test works. Shouldn't there be some verification that the same JobPath scheme and auth and conf get the same client back, and also, when, scheme, and/or auth, and/or conf is different, we get a different client back? We should also test that if a non-inspected conf is changed, it still returns a cached client.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364820203", "createdAt": "2020-01-09T15:58:41Z", "author": {"login": "gpang"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efcabab44713211eeb2412ecd370cff6228ed191"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg3MDkwMQ==", "bodyText": "The main reason I did it this way is because I had to mock FileSystem so instead of checking what I get back. I instead check the number of calls to the FileSystem.get", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364870901", "createdAt": "2020-01-09T17:34:44Z", "author": {"login": "bradyoo"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDIwMw=="}, "originalCommit": {"oid": "efcabab44713211eeb2412ecd370cff6228ed191"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg3Mzk2OQ==", "bodyText": "We also do test that is a non-inspected conf is changed, it doesn't call the underlying FileSystem.get which is the same thing.", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364873969", "createdAt": "2020-01-09T17:42:12Z", "author": {"login": "bradyoo"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDIwMw=="}, "originalCommit": {"oid": "efcabab44713211eeb2412ecd370cff6228ed191"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkyNzE5NQ==", "bodyText": "Got it. Can you also add a case where there is a new JobPath instance, with the same path (fs should be cached), and a new JobPath instance with different path (fs should not be cached)", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364927195", "createdAt": "2020-01-09T19:44:55Z", "author": {"login": "gpang"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDIwMw=="}, "originalCommit": {"oid": "efcabab44713211eeb2412ecd370cff6228ed191"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MzQwNDI0OnYy", "diffSide": "RIGHT", "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNTo1OToxMVrOFb64GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNTo1OToxMVrOFb64GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDUwNA==", "bodyText": "does the test not work unless the fs is mocked?", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364820504", "createdAt": "2020-01-09T15:59:11Z", "author": {"login": "gpang"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");\n+\n+    FileSystem mockFileSystem = mock(FileSystem.class);\n+\n+    when(FileSystem.get(eq(jobPath.toUri()), any())).thenReturn(mockFileSystem);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efcabab44713211eeb2412ecd370cff6228ed191"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NDUwMTA3OnYy", "diffSide": "RIGHT", "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMjo0Njo1MlrOFcFrLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQyMjo0Njo1MlrOFcFrLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk5NzQyMw==", "bodyText": "can we add one more case with new JobPath(\"foo2\", \"bar\", \"/baz\");", "url": "https://github.com/Alluxio/alluxio/pull/10700#discussion_r364997423", "createdAt": "2020-01-09T22:46:52Z", "author": {"login": "gpang"}, "path": "job/server/src/test/java/alluxio/job/plan/transform/format/JobPathTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.job.plan.transform.format;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.verifyStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+\n+import alluxio.client.ReadType;\n+import alluxio.conf.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({FileSystem.class, UserGroupInformation.class})\n+public class JobPathTest {\n+\n+  @Before\n+  public void before() throws Exception {\n+    mockStatic(UserGroupInformation.class);\n+\n+    when(UserGroupInformation.getCurrentUser()).thenReturn(null);\n+  }\n+\n+  @Test\n+  public void testCache() throws Exception {\n+    mockStatic(FileSystem.class);\n+\n+    Configuration conf = new Configuration();\n+    JobPath jobPath = new JobPath(\"foo\", \"bar\", \"/baz\");\n+\n+    when(FileSystem.get(any(), any())).thenAnswer((p) -> mock(FileSystem.class));\n+\n+    FileSystem fileSystem = jobPath.getFileSystem(conf);\n+\n+    verifyStatic(times(1));\n+    FileSystem.get(any(), any());\n+\n+    assertEquals(fileSystem, jobPath.getFileSystem(conf));\n+    verifyStatic(times(1));\n+    FileSystem.get(any(), any());\n+\n+    conf.set(PropertyKey.USER_FILE_READ_TYPE_DEFAULT.toString(), ReadType.NO_CACHE.toString());\n+    FileSystem newFileSystem = jobPath.getFileSystem(conf);\n+    assertNotEquals(fileSystem, newFileSystem);\n+    verifyStatic(times(2));\n+    FileSystem.get(any(), any());\n+\n+    conf.set(\"foo\", \"bar\");\n+    assertEquals(newFileSystem, jobPath.getFileSystem(conf));\n+    verifyStatic(times(2));\n+    FileSystem.get(any(), any());\n+\n+    jobPath = new JobPath(\"foo\", \"bar\", \"/bar\");\n+    assertEquals(newFileSystem, jobPath.getFileSystem(conf));\n+    verifyStatic(times(2));\n+    FileSystem.get(any(), any());\n+\n+    jobPath = new JobPath(\"foo\", \"baz\", \"/bar\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5ce5a181cec4e3b5d4d40979edcfe5bbf346d9d"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2190, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}