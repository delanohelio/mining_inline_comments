{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NjkwMTE0", "number": 11171, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNjo0NlrODoHN5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo1Nzo0MFrODoJFzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzg3ODc4OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNjo0NlrOF2eqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNjo0NlrOF2eqIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTcyOA==", "bodyText": "Better indentation", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669728", "createdAt": "2020-03-15T12:36:46Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -160,17 +160,18 @@ resources:\n {{- define \"alluxio.worker.tieredstoreVolumeMounts\" -}}\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n+      {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n       {{- if .mediumtype }}\n+        {{- /* Mount each part */}}\n         {{- if contains \",\" .mediumtype }}\n-{{- $type := .type }}\n-{{- $path := .path }}\n-{{- $split := split \",\" .mediumtype }}\n+          {{- $type := .type }}\n+          {{- $path := .path }}\n+          {{- $split := split \",\" .mediumtype }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzg3ODk5OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNzozNFrOF2eqSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNzozNFrOF2eqSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTc2OA==", "bodyText": "This is a bug. Before only hostPath is added to Volume mounts when the mediumtype has multiple parts.", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669768", "createdAt": "2020-03-15T12:37:34Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -160,17 +160,18 @@ resources:\n {{- define \"alluxio.worker.tieredstoreVolumeMounts\" -}}\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n+      {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n       {{- if .mediumtype }}\n+        {{- /* Mount each part */}}\n         {{- if contains \",\" .mediumtype }}\n-{{- $type := .type }}\n-{{- $path := .path }}\n-{{- $split := split \",\" .mediumtype }}\n+          {{- $type := .type }}\n+          {{- $path := .path }}\n+          {{- $split := split \",\" .mediumtype }}\n           {{- range $key, $val := $split }}\n-            {{- if eq $type \"hostPath\"}}\n-            - mountPath:  {{ index ($path | split \",\") $key }}\n-              name: {{ $val | lower }}-{{ $key | replace \"_\" \"\" }}\n-            {{- end}}\n+            - mountPath: {{ index ($path | split \",\") $key }}\n+              name: {{ $val | lower }}-{{ replace $key \"_\" \"\" }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzg3OTM1OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozODoxMFrOF2eqeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo1NjoxMlrOF2hOmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTgxOA==", "bodyText": "Added a few examples here", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669818", "createdAt": "2020-03-15T12:38:10Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd\n+#    path: /dev/ssd\n+#    quota: 10G\n+#\n+# multi-part mediumtype example\n+#  - level: 1\n+#    mediumtype: SSD,HDD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd,alluxio-hdd\n+#    path: /dev/ssd,/dev/hdd\n+#    quota: 10G,10G", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMTgzNA==", "bodyText": "@jiacheliu3 please also update the docs section \"Example: Alluxio Storage Management\"", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392711834", "createdAt": "2020-03-15T20:56:12Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd\n+#    path: /dev/ssd\n+#    quota: 10G\n+#\n+# multi-part mediumtype example\n+#  - level: 1\n+#    mediumtype: SSD,HDD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd,alluxio-hdd\n+#    path: /dev/ssd,/dev/hdd\n+#    quota: 10G,10G", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTgxOA=="}, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNDE3MDA1OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDozMzowM1rOF2hG8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODoyNjoyNlrOF3R_jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwOTg3NQ==", "bodyText": "nit: add comment with example of what mediumName resolves to", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392709875", "createdAt": "2020-03-15T20:33:03Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -191,33 +192,47 @@ resources:\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n       {{- if .mediumtype }}\n+        {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n         {{- if contains \",\" .mediumtype }}\n           {{- $split := split \",\" .mediumtype }}\n           {{- $type := .type }}\n           {{- $path := .path }}\n+          {{- $volumeName := .name }}\n+          {{- /* A volume will be generated for each part */}}\n           {{- range $key, $val := $split }}\n+            {{- $mediumName := printf \"%v-%v\" (lower $val) (replace $key \"_\" \"\") }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUxMDc5OA==", "bodyText": "Good advice!", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r393510798", "createdAt": "2020-03-17T08:26:26Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -191,33 +192,47 @@ resources:\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n       {{- if .mediumtype }}\n+        {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n         {{- if contains \",\" .mediumtype }}\n           {{- $split := split \",\" .mediumtype }}\n           {{- $type := .type }}\n           {{- $path := .path }}\n+          {{- $volumeName := .name }}\n+          {{- /* A volume will be generated for each part */}}\n           {{- range $key, $val := $split }}\n+            {{- $mediumName := printf \"%v-%v\" (lower $val) (replace $key \"_\" \"\") }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwOTg3NQ=="}, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNDE3NDY1OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo0MDowN1rOF2hJUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo0MDowN1rOF2hJUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMDQ4Mw==", "bodyText": "nit: add comment with example of what claimName resolves to", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392710483", "createdAt": "2020-03-15T20:40:07Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -191,33 +192,47 @@ resources:\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n       {{- if .mediumtype }}\n+        {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n         {{- if contains \",\" .mediumtype }}\n           {{- $split := split \",\" .mediumtype }}\n           {{- $type := .type }}\n           {{- $path := .path }}\n+          {{- $volumeName := .name }}\n+          {{- /* A volume will be generated for each part */}}\n           {{- range $key, $val := $split }}\n+            {{- $mediumName := printf \"%v-%v\" (lower $val) (replace $key \"_\" \"\") }}\n             {{- if eq $type \"hostPath\"}}\n         - hostPath:\n             path: {{ index ($path | split \",\") $key }}\n             type: DirectoryOrCreate\n-          name: {{ $val | lower }}-{{ $key | replace \"_\" \"\" }}\n+          name: {{ $mediumName }}\n+            {{- else if eq $type \"persistentVolumeClaim\" }}\n+        - name: {{ $mediumName }}\n+          persistentVolumeClaim:\n+            claimName: {{ index ($volumeName | split \",\") $key }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNDE4NTc0OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo1Nzo0MFrOF2hPAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODoyMDoyNFrOF3Rz6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMTkzOQ==", "bodyText": "is mediumtype MEM possible with pv? If not please explicitly state that in the doc page and why", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392711939", "createdAt": "2020-03-15T20:57:40Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUwNzgxNg==", "bodyText": "What this PVC's mediumtype should be really depends on what PV it binds to. So it can actually be MEM as hostPath and emptyDir. I put a level 1 SSD here just trying to illustrate it can have level > 0 like being a SSD or HDD.\nIs there a particular scenario you are thinking about? Or how do you think this can be illustrated more clearly?", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r393507816", "createdAt": "2020-03-17T08:20:24Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMTkzOQ=="}, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1774, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}