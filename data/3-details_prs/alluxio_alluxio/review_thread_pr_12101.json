{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NzQ2ODQ1", "number": 12101, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTo0NzowNFrOEimMCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzowMjoyNFrOElwi5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzEyNzEzOnYy", "diffSide": "RIGHT", "path": "integration/docker/entrypoint.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTo0NzowNFrOHQkP3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMjoyMjoxOVrOHU_LIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEzMzE0OA==", "bodyText": "this value may also contain a comma-delimited list of directories. We should handle that case too.", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r487133148", "createdAt": "2020-09-11T15:47:04Z", "author": {"login": "ZacBlanco"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc2ODYwOQ==", "bodyText": "@ZacBlanco, hi, I updated this script to support comma-delimited list of directories. thanks for your advice!", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r491768609", "createdAt": "2020-09-21T02:22:19Z", "author": {"login": "iluoeli"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEzMzE0OA=="}, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDIzMzg2OnYy", "diffSide": "RIGHT", "path": "integration/docker/entrypoint.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0OToxN1rOHVZ1oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODo0MjowOVrOHWd5wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNTQ3Mg==", "bodyText": "is there a reason the argument was changes from ${ARGS} here to $*?", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r492205472", "createdAt": "2020-09-21T16:49:17Z", "author": {"login": "ZacBlanco"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\\n+          xargs -I {} chmod -R 777 {}\n+      fi\n+      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh $*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMyMDY0MQ==", "bodyText": "We need to judge whether it's a worker or not. So, $* make it easier to do so.", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r493320641", "createdAt": "2020-09-23T08:42:09Z", "author": {"login": "iluoeli"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\\n+          xargs -I {} chmod -R 777 {}\n+      fi\n+      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh $*\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNTQ3Mg=="}, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDI4MTM1OnYy", "diffSide": "RIGHT", "path": "integration/docker/entrypoint.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzowMjoyNFrOHVaTag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMTozNTozMVrOHVnu9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMzA5OA==", "bodyText": "I tested the script and it still doesn't seem to work\nI created directores a1 and a2 in my working directory, the same place I ran this command.\n#!/usr/bin/env bash\nset -x\ntvar=\"-Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\"\n\necho \"$tvar\" | tr ' ' '\\n' | \\\ngrep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\ncut -d '=' -f 2 | \\\ngrep -Ev \"^$\" | \\\nxargs -I {} chmod -R 777 {}\n\noutput:\n+ tvar=-Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\n+ echo -Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\n+ tr ' ' '\\n'\n+ grep 'alluxio.worker.tieredstore.level[0-9].dirs.path'\n+ cut -d = -f 2\n+ grep -Ev '^$'\n+ xargs -I '{}' chmod -R 777 '{}'\nchmod: cannot access 'a1,a2': No such file or directory", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r492213098", "createdAt": "2020-09-21T17:02:24Z", "author": {"login": "ZacBlanco"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\\n+          xargs -I {} chmod -R 777 {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzMzE0MA==", "bodyText": "Are you testing on the latest version?\nI tried and it is working fine.\nscript:\n#!/usr/bin/env bash\nset -x\ntvar=\"-Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\"\necho \"${tvar}\" | \\\n  tr ' ' '\\n' | \\\n  grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n  cut -d '=' -f 2 | \\\n  tr ',' '\\n' | \\\n  grep -Ev \"^$\" | \\\n  xargs -I {} chmod -R 777 {}\noutput:\n+ tvar=-Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\n+ echo -Dalluxio.worker.tieredstore.level0.dirs.path=a1,a2\n+ tr ' ' '\\n'\n+ grep 'alluxio.worker.tieredstore.level[0-9].dirs.path'\n+ cut -d = -f 2\n+ tr , '\\n'\n+ grep -Ev '^$'\n+ xargs -I '{}' chmod -R 777 '{}'\nchmod: a1: No such file or directory\nchmod: a2: No such file or directory", "url": "https://github.com/Alluxio/alluxio/pull/12101#discussion_r492433140", "createdAt": "2020-09-22T01:35:31Z", "author": {"login": "iluoeli"}, "path": "integration/docker/entrypoint.sh", "diffHunk": "@@ -159,7 +159,16 @@ function setup_for_dynamic_non_root {\n       mkdir -p /journal\n       chown -R ${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt/* /journal\n       chmod -R g=u /opt/* /journal\n-      exec su ${ALLUXIO_USERNAME} -c \"/entrypoint.sh ${ARGS}\"\n+      # Chmod the dirs of tiered stores for alluxio worker\n+      # to ensure write permission for non-root user.\n+      if [[ \"$1\" == \"worker\" || \"$1\" == \"worker-only\" ]]; then\n+        echo \"$ALLUXIO_JAVA_OPTS\" | tr ' ' '\\n' | \\\n+          grep \"alluxio.worker.tieredstore.level[0-9].dirs.path\" | \\\n+          cut -d '=' -f 2 | \\\n+          grep -Ev \"^$\" | \\\n+          xargs -I {} chmod -R 777 {}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMzA5OA=="}, "originalCommit": {"oid": "568689d99aad707fbf72eefef19c5f0385cecc50"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1178, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}