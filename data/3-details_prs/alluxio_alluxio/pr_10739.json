{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMzk2MjY5", "number": 10739, "title": "Specify the Alluxio file system type with a class instead of a boolean", "bodyText": "This makes it cleaner to augment the filesystem with different functionality like metadata caching.\nAlso ran confDocGen so some unrelated docs are updated.", "createdAt": "2020-01-14T01:08:36Z", "url": "https://github.com/Alluxio/alluxio/pull/10739", "merged": true, "mergeCommit": {"oid": "4cb6310ee46c7b644a498668aa5d8271b7a9db60"}, "closed": true, "closedAt": "2020-01-14T21:58:56Z", "author": {"login": "calvinjia"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6GND7AH2gAyMzYyMzk2MjY5OjM4MzdhM2FhODQyYWJjMzhlNWI4ZmIwMjIyNGU5ZjYzZmU1NThiOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6YDeLgH2gAyMzYyMzk2MjY5Ojk5YmQxZTZmNjE4YzQ4ZDU0YzAxMjMyN2E0MjhkZWJhZTFkNjQ2MGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3837a3aa842abc38e5b8fb02224e9f63fe558b97", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/3837a3aa842abc38e5b8fb02224e9f63fe558b97", "committedDate": "2020-01-14T00:56:14Z", "message": "Specify the Alluxio file system type with a class instead of a boolean."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/ef946d8af275e22948c50a6d722612aee85a8ae2", "committedDate": "2020-01-14T01:05:35Z", "message": "Checkstyle."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjQyMzk5", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342242399", "createdAt": "2020-01-14T01:19:53Z", "commit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMToxOTo1M1rOFdJsqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMToyNToyNVrOFdJyIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMTkxNQ==", "bodyText": "Do you think we should list out the different options this can be configured with?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366111915", "createdAt": "2020-01-14T01:19:53Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,9 +3368,9 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =\n+      new Builder(Name.USER_FILESYSTEM_CLASS)\n+          .setDefaultValue(\"alluxio.client.file.BaseFileSystem\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMzMxMw==", "bodyText": "I'm not a huge fan of creating the classes this way because it creates an implicit rather than explicit contract on all implementations to use the exact same constructor. I don't think it's the best approach.\nBecause we don't have many FS implementations I think I'm okay leaving it for now, but we might want to consider a factory-based pattern or something similar if we end up extending this more in the future.", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366113313", "createdAt": "2020-01-14T01:25:25Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/FileSystem.java", "diffHunk": "@@ -148,10 +149,10 @@ private static FileSystem create(FileSystemContext context, boolean cachingEnabl\n           LOG.debug(\"{}={} ({})\", key.getName(), value, source);\n         }\n       }\n-      if (context.getClusterConf().getBoolean(PropertyKey.USER_METADATA_CACHE_ENABLED)) {\n-        return new CachingFileSystem(context, cachingEnabled);\n-      }\n-      return BaseFileSystem.create(context, cachingEnabled);\n+      Class fsClass = context.getClusterConf().getClass(PropertyKey.USER_FILESYSTEM_CLASS);\n+      Class[] ctorArgClasses = new Class[] {FileSystemContext.class, boolean.class};\n+      Object[] ctorArgs = new Object[] {context, cachingEnabled};\n+      return (FileSystem) CommonUtils.createNewClassInstance(fsClass, ctorArgClasses, ctorArgs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/cf9502529f167c08a2ab39d57dd0ee56bdeb5626", "committedDate": "2020-01-14T01:59:52Z", "message": "Address comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjYyMjg2", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342262286", "createdAt": "2020-01-14T02:36:30Z", "commit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjgyODc2", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342282876", "createdAt": "2020-01-14T04:12:45Z", "commit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo0NVrOFdLvbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo0NVrOFdLvbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE0NTM5MQ==", "bodyText": "nit: can you put this property in alphabetical order?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366145391", "createdAt": "2020-01-14T04:12:45Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,29 +3368,29 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjgyODk4", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342282898", "createdAt": "2020-01-14T04:12:53Z", "commit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo1M1rOFdLvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo1M1rOFdLvfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE0NTQwNw==", "bodyText": "nit: can you put this property in alphabetical order?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366145407", "createdAt": "2020-01-14T04:12:53Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -4539,8 +4539,7 @@ private static String javadocLink(String fullyQualifiedClassname) {\n         \"alluxio.user.short.circuit.preferred\";\n     public static final String USER_WORKER_LIST_REFRESH_INTERVAL =\n         \"alluxio.user.worker.list.refresh.interval\";\n-    public static final String USER_METADATA_CACHE_ENABLED =\n-        \"alluxio.user.metadata.cache.enabled\";\n+    public static final String USER_FILESYSTEM_CLASS = \"alluxio.user.filesystem.class\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjgzMDU1", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342283055", "createdAt": "2020-01-14T04:13:41Z", "commit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c70812234cdf78e158e2bc9f3f4202785064ff8", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/6c70812234cdf78e158e2bc9f3f4202785064ff8", "committedDate": "2020-01-14T19:20:35Z", "message": "Order property keys."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODE0NzYy", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342814762", "createdAt": "2020-01-14T20:23:17Z", "commit": {"oid": "6c70812234cdf78e158e2bc9f3f4202785064ff8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/09beea21c9917e61984c09dc6dd8e6283a037c80", "committedDate": "2020-01-14T21:26:48Z", "message": "Resolve conflicts."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODUxMzA4", "url": "https://github.com/Alluxio/alluxio/pull/10739#pullrequestreview-342851308", "createdAt": "2020-01-14T21:30:14Z", "commit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoxNVrOFdmZtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoyMVrOFdmZ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MjE5OA==", "bodyText": "update", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366582198", "createdAt": "2020-01-14T21:30:15Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3152,36 +3169,19 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_LOCAL_CACHE_ENABLED =\n-      new Builder(Name.USER_LOCAL_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, data will be cached on Alluxio client.\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n   public static final PropertyKey USER_METADATA_CACHE_MAX_SIZE =\n       new Builder(Name.USER_METADATA_CACHE_MAX_SIZE)\n           .setDefaultValue(100000)\n-          .setDescription(\"Maximum number of paths with cached metadata.\")\n+          .setDescription(\"Maximum number of paths with cached metadata. Only valid if the \"\n+              + \"filesystem is alluxio.client.file.CachingFileSystem.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MjI0Mg==", "bodyText": "update", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366582242", "createdAt": "2020-01-14T21:30:21Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3152,36 +3169,19 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_LOCAL_CACHE_ENABLED =\n-      new Builder(Name.USER_LOCAL_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, data will be cached on Alluxio client.\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n   public static final PropertyKey USER_METADATA_CACHE_MAX_SIZE =\n       new Builder(Name.USER_METADATA_CACHE_MAX_SIZE)\n           .setDefaultValue(100000)\n-          .setDescription(\"Maximum number of paths with cached metadata.\")\n+          .setDescription(\"Maximum number of paths with cached metadata. Only valid if the \"\n+              + \"filesystem is alluxio.client.file.CachingFileSystem.\")\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n   public static final PropertyKey USER_METADATA_CACHE_EXPIRATION_TIME =\n       new Builder(Name.USER_METADATA_CACHE_EXPIRATION_TIME)\n           .setDefaultValue(\"10min\")\n           .setDescription(\"Metadata will expire and be evicted after being cached for this time \"\n-              + \"period.\")\n+              + \"period. Only valid if the filesystem is alluxio.client.file.CachingFileSystem.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99bd1e6f618c48d54c012327a428debae1d6460f", "author": {"user": {"login": "calvinjia", "name": "Calvin Jia"}}, "url": "https://github.com/Alluxio/alluxio/commit/99bd1e6f618c48d54c012327a428debae1d6460f", "committedDate": "2020-01-14T21:44:03Z", "message": "Update class name."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3291, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}