{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzA4ODcy", "number": 11984, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjo1MzoyOVrOEZP7Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTozNjoxOVrOEZUYWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0OTEwODExOnYy", "diffSide": "RIGHT", "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjo1MzoyOVrOHB9dgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTozNToyMVrOHCEAnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgxNzYwMg==", "bodyText": "The java opts are intentionally passed to the spawned tasks, so that the tasks can also be started with a larger mem size", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471817602", "createdAt": "2020-08-17T22:53:29Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,10 +87,12 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbb8cac4e14ff67ada050995f993e3a09e6d1e10"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNDg5Mg==", "bodyText": "when are the java opts used?", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471924892", "createdAt": "2020-08-18T05:35:21Z", "author": {"login": "yuzhu"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,10 +87,12 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgxNzYwMg=="}, "originalCommit": {"oid": "bbb8cac4e14ff67ada050995f993e3a09e6d1e10"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0OTgzNzcwOnYy", "diffSide": "LEFT", "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTozNjoxOVrOHCEB1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzowMzo0NVrOHCdz1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNTIwNA==", "bodyText": "the JavaOpts is applied to the job launch process here. are you saying there is another level of launching jobs within the job?", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r471925204", "createdAt": "2020-08-18T05:36:19Z", "author": {"login": "yuzhu"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,12 +87,15 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts\n     List<String> commandArgs =\n-            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n-                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+            Arrays.stream(args).filter((s) -> !BaseParameters.JAVA_OPT_FLAG.equals(s)\n+                && !BaseParameters.CLUSTER_FLAG.equals(s)\n+                && !s.isEmpty()\n+                && !mBaseParameters.mJavaOpts.contains(s)).collect(Collectors.toList());\n \n-    commandArgs.addAll(mBaseParameters.mJavaOpts);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM0NzYwNg==", "bodyText": "basically, all job tasks on the workers also spawn processes, to make it look exactly like it would have if it was run locally (not in cluster mode). https://github.com/Alluxio/alluxio/blob/master/job/server/src/main/java/alluxio/job/plan/stress/StressBenchDefinition.java#L114\nI just want to make sure if we set java opts for max mem, that it will affect local mode, as well as cluster mode, all in the same way.", "url": "https://github.com/Alluxio/alluxio/pull/11984#discussion_r472347606", "createdAt": "2020-08-18T17:03:45Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/Benchmark.java", "diffHunk": "@@ -87,12 +87,15 @@ protected static void mainInternal(String[] args, Benchmark benchmark) {\n    * @return the JobConfig\n    * */\n   public PlanConfig generateJobConfig(String[] args) {\n-    // remove the cluster flag\n+    // remove the cluster flag and java opts\n     List<String> commandArgs =\n-            Arrays.stream(args).filter((s) -> !BaseParameters.CLUSTER_FLAG.equals(s))\n-                    .filter((s) -> !s.isEmpty()).collect(Collectors.toList());\n+            Arrays.stream(args).filter((s) -> !BaseParameters.JAVA_OPT_FLAG.equals(s)\n+                && !BaseParameters.CLUSTER_FLAG.equals(s)\n+                && !s.isEmpty()\n+                && !mBaseParameters.mJavaOpts.contains(s)).collect(Collectors.toList());\n \n-    commandArgs.addAll(mBaseParameters.mJavaOpts);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNTIwNA=="}, "originalCommit": {"oid": "508c24614f46ccef945b476561917697aeaa4a08"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1310, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}