{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NTgxMTQ0", "number": 10900, "title": "Enable configuration of ignored tables", "bodyText": "This allows ignoring a certain set of tables when attaching a database.", "createdAt": "2020-02-12T22:54:58Z", "url": "https://github.com/Alluxio/alluxio/pull/10900", "merged": true, "mergeCommit": {"oid": "acaa4db4496665ca5d3205c4c883759f69116743"}, "closed": true, "closedAt": "2020-02-13T21:42:17Z", "author": {"login": "gpang"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDubanAH2gAyMzc0NTgxMTQ0OmE4MjFhMDc4ZjQwMDUwZDRjMjNiYmNlNDA5MjIxNTQxMjcyZDRmMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEB_RwAFqTM1ODU3MTE4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a821a078f40050d4c23bbce409221541272d4f28", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/a821a078f40050d4c23bbce409221541272d4f28", "committedDate": "2020-02-12T22:53:26Z", "message": "Enable configuration of ignored tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODUyNzQ3", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-357852747", "createdAt": "2020-02-12T23:04:03Z", "commit": {"oid": "a821a078f40050d4c23bbce409221541272d4f28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMzowNDowM1rOFpBuDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMzowNDowM1rOFpBuDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU2NDEwOA==", "bodyText": "This looks like the same implementation from InstancedConfiguration, but maybe we can extract this into a function in FormatUtils or CommonUtils so we don't have the code in both places?", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378564108", "createdAt": "2020-02-12T23:04:03Z", "author": {"login": "ZacBlanco"}, "path": "table/server/master/src/main/java/alluxio/master/table/Database.java", "diffHunk": "@@ -58,20 +60,23 @@\n   private final String mName;\n   private final Map<String, Table> mTables;\n   private final UnderDatabase mUdb;\n-  private final Map<String, String> mConfig;\n+  private final CatalogConfiguration mConfig;\n+  private final Set<String> mIgnoreTables;\n   private final long mUdbSyncTimeoutMs =\n       ServerConfiguration.getMs(PropertyKey.TABLE_CATALOG_UDB_SYNC_TIMEOUT);\n \n   private DatabaseInfo mDatabaseInfo;\n \n   private Database(CatalogContext context, String type, String name, UnderDatabase udb,\n-      Map<String, String> configMap) {\n+      CatalogConfiguration config) {\n     mContext = context;\n     mType = type;\n     mName = name;\n     mTables = new ConcurrentHashMap<>();\n     mUdb = udb;\n-    mConfig = configMap;\n+    mConfig = config;\n+    mIgnoreTables = Sets.newHashSet(Splitter.on(\",\").trimResults().omitEmptyStrings()\n+        .split(mConfig.get(CatalogProperty.DB_IGNORE_TABLES)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a821a078f40050d4c23bbce409221541272d4f28"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/609d86cf23325f4725e849cb5835d6a67334bb91", "committedDate": "2020-02-12T23:18:33Z", "message": "Refactor list parsing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODU5MDMx", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-357859031", "createdAt": "2020-02-12T23:19:20Z", "commit": {"oid": "a821a078f40050d4c23bbce409221541272d4f28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMzoxOToyMVrOFpCCdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMzoxOToyMVrOFpCCdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU2OTMzNA==", "bodyText": "I extract that part.", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378569334", "createdAt": "2020-02-12T23:19:21Z", "author": {"login": "gpang"}, "path": "table/server/master/src/main/java/alluxio/master/table/Database.java", "diffHunk": "@@ -58,20 +60,23 @@\n   private final String mName;\n   private final Map<String, Table> mTables;\n   private final UnderDatabase mUdb;\n-  private final Map<String, String> mConfig;\n+  private final CatalogConfiguration mConfig;\n+  private final Set<String> mIgnoreTables;\n   private final long mUdbSyncTimeoutMs =\n       ServerConfiguration.getMs(PropertyKey.TABLE_CATALOG_UDB_SYNC_TIMEOUT);\n \n   private DatabaseInfo mDatabaseInfo;\n \n   private Database(CatalogContext context, String type, String name, UnderDatabase udb,\n-      Map<String, String> configMap) {\n+      CatalogConfiguration config) {\n     mContext = context;\n     mType = type;\n     mName = name;\n     mTables = new ConcurrentHashMap<>();\n     mUdb = udb;\n-    mConfig = configMap;\n+    mConfig = config;\n+    mIgnoreTables = Sets.newHashSet(Splitter.on(\",\").trimResults().omitEmptyStrings()\n+        .split(mConfig.get(CatalogProperty.DB_IGNORE_TABLES)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU2NDEwOA=="}, "originalCommit": {"oid": "a821a078f40050d4c23bbce409221541272d4f28"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODc2MDg3", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-357876087", "createdAt": "2020-02-13T00:06:14Z", "commit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMDowNjoxNFrOFpC5vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMDowNjo0M1rOFpC6OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MzQ4NQ==", "bodyText": "Can we add a case for a,,b to make sure empty strings are omitted?", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378583485", "createdAt": "2020-02-13T00:06:14Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/test/java/alluxio/util/ConfigurationUtilsTest.java", "diffHunk": "@@ -142,6 +143,15 @@ public void testMasterNotConfiguredMessage() {\n         ConfigurationUtils.getJobMasterHostNotConfiguredMessage(\"test service 2\"));\n   }\n \n+  @Test\n+  public void parseAsList() {\n+    assertEquals(Lists.newArrayList(\"a\"), ConfigurationUtils.parseAsList(\"a\", \",\"));\n+    assertEquals(Lists.newArrayList(\"a\", \"b\", \"c\"), ConfigurationUtils.parseAsList(\"a,b,c\", \",\"));\n+    assertEquals(Lists.newArrayList(\"a\", \"b\", \"c\"),\n+        ConfigurationUtils.parseAsList(\" a , b , c \", \",\"));\n+    assertEquals(Lists.newArrayList(\"a,b,c\"), ConfigurationUtils.parseAsList(\"a,b,c\", \";\"));\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MzYwOA==", "bodyText": "Not sure if you updated all this by hand or automatically formatted, but I think the old version of this is easier to read", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378583608", "createdAt": "2020-02-13T00:06:43Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -358,10 +357,8 @@ public static boolean isHaMode(AlluxioConfiguration conf) {\n \n     List<ConfigProperty> configs = new ArrayList<>();\n     List<PropertyKey> selectedKeys =\n-        conf.keySet().stream()\n-            .filter(key -> GrpcUtils.contains(key.getScope(), scope))\n-            .filter(key -> key.isValid(key.getName()))\n-            .collect(toList());\n+        conf.keySet().stream().filter(key -> GrpcUtils.contains(key.getScope(), scope))\n+            .filter(key -> key.isValid(key.getName())).collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf2c8d9d714623e4a3fbb8a30246601ac4910b6e", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/bf2c8d9d714623e4a3fbb8a30246601ac4910b6e", "committedDate": "2020-02-13T03:28:48Z", "message": "Revert auto-formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a13d4b4b627ca9b73c203eca1f88480ba28b7b", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/17a13d4b4b627ca9b73c203eca1f88480ba28b7b", "committedDate": "2020-02-13T03:29:04Z", "message": "Add test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTMyODQ5", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-357932849", "createdAt": "2020-02-13T03:22:18Z", "commit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMzoyMjoxOFrOFpF7Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMzoyOToyOFrOFpGAzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYzMjk4Mw==", "bodyText": "Good call. Added.", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378632983", "createdAt": "2020-02-13T03:22:18Z", "author": {"login": "gpang"}, "path": "core/common/src/test/java/alluxio/util/ConfigurationUtilsTest.java", "diffHunk": "@@ -142,6 +143,15 @@ public void testMasterNotConfiguredMessage() {\n         ConfigurationUtils.getJobMasterHostNotConfiguredMessage(\"test service 2\"));\n   }\n \n+  @Test\n+  public void parseAsList() {\n+    assertEquals(Lists.newArrayList(\"a\"), ConfigurationUtils.parseAsList(\"a\", \",\"));\n+    assertEquals(Lists.newArrayList(\"a\", \"b\", \"c\"), ConfigurationUtils.parseAsList(\"a,b,c\", \",\"));\n+    assertEquals(Lists.newArrayList(\"a\", \"b\", \"c\"),\n+        ConfigurationUtils.parseAsList(\" a , b , c \", \",\"));\n+    assertEquals(Lists.newArrayList(\"a,b,c\"), ConfigurationUtils.parseAsList(\"a,b,c\", \";\"));\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MzQ4NQ=="}, "originalCommit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYzNDQ0NQ==", "bodyText": "It was auto-formatted. I reverted back.", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r378634445", "createdAt": "2020-02-13T03:29:28Z", "author": {"login": "gpang"}, "path": "core/common/src/main/java/alluxio/util/ConfigurationUtils.java", "diffHunk": "@@ -358,10 +357,8 @@ public static boolean isHaMode(AlluxioConfiguration conf) {\n \n     List<ConfigProperty> configs = new ArrayList<>();\n     List<PropertyKey> selectedKeys =\n-        conf.keySet().stream()\n-            .filter(key -> GrpcUtils.contains(key.getScope(), scope))\n-            .filter(key -> key.isValid(key.getName()))\n-            .collect(toList());\n+        conf.keySet().stream().filter(key -> GrpcUtils.contains(key.getScope(), scope))\n+            .filter(key -> key.isValid(key.getName())).collect(toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4MzYwOA=="}, "originalCommit": {"oid": "609d86cf23325f4725e849cb5835d6a67334bb91"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bf592428eed1ed8ae64f7ea69ca87ca1d465bb3", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/5bf592428eed1ed8ae64f7ea69ca87ca1d465bb3", "committedDate": "2020-02-13T03:45:07Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MDY3NDE5", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-358067419", "createdAt": "2020-02-13T09:31:22Z", "commit": {"oid": "5bf592428eed1ed8ae64f7ea69ca87ca1d465bb3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34d5defdae734f927e1d40359a68c7b36a2fa7a3", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/34d5defdae734f927e1d40359a68c7b36a2fa7a3", "committedDate": "2020-02-13T16:20:40Z", "message": "Merge remote-tracking branch 'upstream/master' into attach-ignore-tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/7b2a84e7a7e073e8447087700f745b9119759e0a", "committedDate": "2020-02-13T18:55:13Z", "message": "Track ignored tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDkzNTk1", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-358493595", "createdAt": "2020-02-13T19:32:43Z", "commit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOTozMjo0M1rOFpg2Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOTo0MTowMFrOFphGYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3NDE1MA==", "bodyText": "why delete this? do we not need it for GLUE?", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r379074150", "createdAt": "2020-02-13T19:32:43Z", "author": {"login": "yuzhu"}, "path": "table/server/master/src/main/java/alluxio/master/table/CatalogProperty.java", "diffHunk": "@@ -26,6 +26,7 @@ private CatalogProperty(String name, String description, String defaultValue) {\n     super(name, description, defaultValue);\n   }\n \n-  public static final CatalogProperty DB_TYPE =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3ODI0Mw==", "bodyText": "does this option affect deletion? should we have a comment about that?", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r379078243", "createdAt": "2020-02-13T19:41:00Z", "author": {"login": "yuzhu"}, "path": "table/server/master/src/main/java/alluxio/master/table/CatalogProperty.java", "diffHunk": "@@ -26,6 +26,7 @@ private CatalogProperty(String name, String description, String defaultValue) {\n     super(name, description, defaultValue);\n   }\n \n-  public static final CatalogProperty DB_TYPE =\n-      new CatalogProperty(\"db.type\", \"The type of database. Possible values are: hive\", \"\");\n+  public static final CatalogProperty DB_IGNORE_TABLES =\n+      new CatalogProperty(\"catalog.db.ignore.tables\",\n+          \"The comma-separated list of table names to ignore from the UDB.\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c9e6ac56f7e39fe544b4fad93f4edca13c89686", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/3c9e6ac56f7e39fe544b4fad93f4edca13c89686", "committedDate": "2020-02-13T20:18:33Z", "message": "Update property name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTA2MTcy", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-358506172", "createdAt": "2020-02-13T19:52:25Z", "commit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOTo1MjoyNVrOFphc8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDoxOToxMVrOFpiNfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA4NDAxOA==", "bodyText": "Yeah, this was unused. We passed in the type in a different way.", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r379084018", "createdAt": "2020-02-13T19:52:25Z", "author": {"login": "gpang"}, "path": "table/server/master/src/main/java/alluxio/master/table/CatalogProperty.java", "diffHunk": "@@ -26,6 +26,7 @@ private CatalogProperty(String name, String description, String defaultValue) {\n     super(name, description, defaultValue);\n   }\n \n-  public static final CatalogProperty DB_TYPE =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3NDE1MA=="}, "originalCommit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NjQ0NQ==", "bodyText": "For now, it is only related to getting tables from udb via udb sync.", "url": "https://github.com/Alluxio/alluxio/pull/10900#discussion_r379096445", "createdAt": "2020-02-13T20:19:11Z", "author": {"login": "gpang"}, "path": "table/server/master/src/main/java/alluxio/master/table/CatalogProperty.java", "diffHunk": "@@ -26,6 +26,7 @@ private CatalogProperty(String name, String description, String defaultValue) {\n     super(name, description, defaultValue);\n   }\n \n-  public static final CatalogProperty DB_TYPE =\n-      new CatalogProperty(\"db.type\", \"The type of database. Possible values are: hive\", \"\");\n+  public static final CatalogProperty DB_IGNORE_TABLES =\n+      new CatalogProperty(\"catalog.db.ignore.tables\",\n+          \"The comma-separated list of table names to ignore from the UDB.\", \"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3ODI0Mw=="}, "originalCommit": {"oid": "7b2a84e7a7e073e8447087700f745b9119759e0a"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTcxMTgw", "url": "https://github.com/Alluxio/alluxio/pull/10900#pullrequestreview-358571180", "createdAt": "2020-02-13T21:40:48Z", "commit": {"oid": "3c9e6ac56f7e39fe544b4fad93f4edca13c89686"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4943, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}