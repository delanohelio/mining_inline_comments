{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MjI1NjM4", "number": 11966, "title": "Remove JvmPauseMonitorTest#interruptOnStop test", "bodyText": "Mockito was recently upgraded which includes a new feature that allows us to mock final methods and classes. I rewrote the test to be simpler using one of Mockito's Spy classes.", "createdAt": "2020-08-11T16:44:36Z", "url": "https://github.com/Alluxio/alluxio/pull/11966", "merged": true, "mergeCommit": {"oid": "2fb8ff7cc768ad31dca04325db41bbbc97e975bd"}, "closed": true, "closedAt": "2020-08-17T19:34:27Z", "author": {"login": "ZacBlanco"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc95n4qgH2gAyNDY2MjI1NjM4OmE1ZWY2OWUzNWRiNTcxY2FmMWU3ZjFkYzFhOTAzNDk1MzliNjdmMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_3flHgFqTQ2ODc2OTk4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/a5ef69e35db571caf1e7f1dc1a90349539b67f35", "committedDate": "2020-08-11T16:43:37Z", "message": "Fix JvmPauseMonitorTest#interruptOnStop test\n\nMockito was recently upgraded which includes a new feature that allows us to mock final methods and classes. I rewrote the test to be simpler using one of Mockito's Spy classes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjQ2ODk4", "url": "https://github.com/Alluxio/alluxio/pull/11966#pullrequestreview-465246898", "createdAt": "2020-08-11T16:45:24Z", "commit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo0NToyNVrOG_Aa-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo0NTozNVrOG_AbWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMDM3Ng==", "bodyText": "In reference to why this is needed: https://github.com/mockito/mockito/wiki/What%27s-new-in-Mockito-2#mock-the-unmockable-opt-in-mocking-of-final-classesmethods", "url": "https://github.com/Alluxio/alluxio/pull/11966#discussion_r468720376", "createdAt": "2020-08-11T16:45:25Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker", "diffHunk": "@@ -0,0 +1 @@\n+mock-maker-inline", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMDQ3Mg==", "bodyText": "Thread#join is final", "url": "https://github.com/Alluxio/alluxio/pull/11966#discussion_r468720472", "createdAt": "2020-08-11T16:45:35Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/test/java/alluxio/util/JvmPauseMonitorTest.java", "diffHunk": "@@ -49,28 +49,16 @@ public void pauseMonitorStartStopTest() {\n \n   @Test\n   public void interruptOnStop() throws Exception {\n-    JvmPauseMonitor mon = Mockito.spy(new JvmPauseMonitor(10000, 900000, 90000));\n-    CyclicBarrier barrier = new CyclicBarrier(2);\n-    doAnswer((Answer<Void>) invocation -> {\n-      barrier.await();\n-      invocation.callRealMethod();\n-      return null;\n-    }).when(mon).sleepMillis(any(Long.class));\n-    Thread current = Thread.currentThread();\n-    Thread t1 = new Thread(() -> {\n-      try {\n-        barrier.await();\n-        current.interrupt();\n-      } catch (InterruptedException | BrokenBarrierException e) {\n-        fail(\"Failed to await on barrier\");\n-      }\n-    });\n-    t1.start();\n+    JvmPauseMonitor mon = Mockito.spy(new JvmPauseMonitor(1000, 900000, 90000));\n     mon.start();\n-    barrier.await();\n+    Thread pmThread = Whitebox.getInternalState(mon, \"mJvmMonitorThread\");\n+    Thread spied = Mockito.spy(pmThread);\n+    doThrow(InterruptedException.class).when(spied).join();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjQ3NjQ5", "url": "https://github.com/Alluxio/alluxio/pull/11966#pullrequestreview-465247649", "createdAt": "2020-08-11T16:46:16Z", "commit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo0NjoxNlrOG_AdDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo0NjoxNlrOG_AdDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMDkwOQ==", "bodyText": "org.mockito.Matchers is now deprecated, so I moved to the newer class", "url": "https://github.com/Alluxio/alluxio/pull/11966#discussion_r468720909", "createdAt": "2020-08-11T16:46:16Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/test/java/alluxio/util/JvmPauseMonitorTest.java", "diffHunk": "@@ -14,9 +14,9 @@\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertTrue;\n-import static org.junit.Assert.fail;\n-import static org.mockito.Matchers.any;\n+import static org.mockito.ArgumentMatchers.any;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5ef69e35db571caf1e7f1dc1a90349539b67f35"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "321c1964e07bf40421b2801591650e13000e1fc3", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/321c1964e07bf40421b2801591650e13000e1fc3", "committedDate": "2020-08-11T21:21:57Z", "message": "Fix static mocks"}, "afterCommit": {"oid": "746b904b310cd32f3765b5887dc7c50b3ee66ea0", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/746b904b310cd32f3765b5887dc7c50b3ee66ea0", "committedDate": "2020-08-11T22:50:35Z", "message": "Fix static mocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbb5e84e4adc3f8e6b1ee5f7433bf30b6a1a528d", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/cbb5e84e4adc3f8e6b1ee5f7433bf30b6a1a528d", "committedDate": "2020-08-11T22:52:22Z", "message": "Fix static mocks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "746b904b310cd32f3765b5887dc7c50b3ee66ea0", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/746b904b310cd32f3765b5887dc7c50b3ee66ea0", "committedDate": "2020-08-11T22:50:35Z", "message": "Fix static mocks"}, "afterCommit": {"oid": "cbb5e84e4adc3f8e6b1ee5f7433bf30b6a1a528d", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/cbb5e84e4adc3f8e6b1ee5f7433bf30b6a1a528d", "committedDate": "2020-08-11T22:52:22Z", "message": "Fix static mocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ce5e0b9264524280edf7c78f544e2a64b3ecdfa", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/0ce5e0b9264524280edf7c78f544e2a64b3ecdfa", "committedDate": "2020-08-15T00:12:40Z", "message": "Exclude mockito extension from test jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73aafa3a6d3db43a541d49fed938328862741019", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/73aafa3a6d3db43a541d49fed938328862741019", "committedDate": "2020-08-17T16:46:10Z", "message": "Revert \"Exclude mockito extension from test jar\"\n\nThis reverts commit 0ce5e0b9264524280edf7c78f544e2a64b3ecdfa."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd2b7f78d47e2e24cf0044bfe585f2b8fde1c5be", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/cd2b7f78d47e2e24cf0044bfe585f2b8fde1c5be", "committedDate": "2020-08-17T16:46:24Z", "message": "Revert \"Fix static mocks\"\n\nThis reverts commit cbb5e84e4adc3f8e6b1ee5f7433bf30b6a1a528d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8ea8f27efee382b808448504f3d62752759c9c6", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/b8ea8f27efee382b808448504f3d62752759c9c6", "committedDate": "2020-08-17T16:46:44Z", "message": "Revert \"Fix JvmPauseMonitorTest#interruptOnStop test\"\n\nThis reverts commit a5ef69e35db571caf1e7f1dc1a90349539b67f35."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36834e31258e9c34726ec790f48f4ecebb0d0ca9", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/36834e31258e9c34726ec790f48f4ecebb0d0ca9", "committedDate": "2020-08-17T16:58:48Z", "message": "Remove test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NzY5OTg5", "url": "https://github.com/Alluxio/alluxio/pull/11966#pullrequestreview-468769989", "createdAt": "2020-08-17T19:22:35Z", "commit": {"oid": "36834e31258e9c34726ec790f48f4ecebb0d0ca9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4122, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}