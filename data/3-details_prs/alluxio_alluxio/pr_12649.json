{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNzMxOTk1", "number": 12649, "title": "Add clearer ratis flush exception logging", "bodyText": "Add the debug logging since the actual flush failure will be overwritten by the last meaningless failure like ratis.protocol.AlreadyClosedException or NoMoreRetriesException.\nThe actual flush failure will sometimes give us helpful information or annoying meaningless logs, that's why i mark it as debug for now. Will be better to have an exception duplication-checking and only log the no-duplicate exceptions. And also link the exception to meaningful configuration suggestions.", "createdAt": "2020-12-15T21:30:50Z", "url": "https://github.com/Alluxio/alluxio/pull/12649", "merged": true, "mergeCommit": {"oid": "1351717c556053fcf76abbaca4f031e356c8c192"}, "closed": true, "closedAt": "2020-12-16T21:36:57Z", "author": {"login": "LuQQiu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmOThUgH2gAyNTQwNzMxOTk1OjJmNGVhNjRjMDg0ZWUzMTQ3NTkyZWQ4NzExOWIzODBlNGZkMDI1ZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm10ChAFqTU1NDA5ODYxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f4ea64c084ee3147592ed87119b380e4fd025e3", "author": {"user": {"login": "LuQQiu", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/2f4ea64c084ee3147592ed87119b380e4fd025e3", "committedDate": "2020-12-14T23:26:21Z", "message": "Add rais logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMTc3ODc5", "url": "https://github.com/Alluxio/alluxio/pull/12649#pullrequestreview-553177879", "createdAt": "2020-12-16T00:32:25Z", "commit": {"oid": "2f4ea64c084ee3147592ed87119b380e4fd025e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDozMjoyNVrOIGmNPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDozMjoyNVrOIGmNPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4ODM1MQ==", "bodyText": "(nit) consider using SamplingLogger if the error happens too frequently.", "url": "https://github.com/Alluxio/alluxio/pull/12649#discussion_r543788351", "createdAt": "2020-12-16T00:32:25Z", "author": {"login": "bf8086"}, "path": "core/server/common/src/main/java/alluxio/master/journal/AsyncJournalWriter.java", "diffHunk": "@@ -308,6 +312,10 @@ private void doFlush() {\n           }\n         }\n       } catch (IOException | JournalClosedException exc) {\n+        // Add the error logging here since the actual flush error may be overwritten\n+        // by the future meaningless ratis.protocol.AlreadyClosedException\n+        // use debug level logging because the exception may be annoying in some cases\n+        LOG.debug(\"Failed to flush journal entry\", exc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4ea64c084ee3147592ed87119b380e4fd025e3"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "628c223132014441ca93b64348bce77fd9b2a84f", "author": {"user": {"login": "LuQQiu", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/628c223132014441ca93b64348bce77fd9b2a84f", "committedDate": "2020-12-16T20:15:33Z", "message": "Change to warn and SamplingLogger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDUxOTcw", "url": "https://github.com/Alluxio/alluxio/pull/12649#pullrequestreview-554051970", "createdAt": "2020-12-16T20:19:23Z", "commit": {"oid": "628c223132014441ca93b64348bce77fd9b2a84f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMDoxOToyM1rOIHXgZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMDoxOToyM1rOIHXgZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU5NjA2OQ==", "bodyText": "NIT: the sampling logger works by treating every log template as a separate error. I don't know if this will be useful, but if we use the template SAMPLING_LOG.warn(\"Failed to flush journal entry: \" + exc.getMessage(), exc); , we would get to see the warning log of each cause, once every 30s. This may help if there are potentially different causes of journal flush errors, and we would still not miss any cause.", "url": "https://github.com/Alluxio/alluxio/pull/12649#discussion_r544596069", "createdAt": "2020-12-16T20:19:23Z", "author": {"login": "gpang"}, "path": "core/server/common/src/main/java/alluxio/master/journal/AsyncJournalWriter.java", "diffHunk": "@@ -308,6 +316,9 @@ private void doFlush() {\n           }\n         }\n       } catch (IOException | JournalClosedException exc) {\n+        // Add the error logging here since the actual flush error may be overwritten\n+        // by the future meaningless ratis.protocol.AlreadyClosedException\n+        SAMPLING_LOG.warn(\"Failed to flush journal entry\", exc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "628c223132014441ca93b64348bce77fd9b2a84f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a207f45ee01491e99e45f6c26054544127721168", "author": {"user": {"login": "LuQQiu", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/a207f45ee01491e99e45f6c26054544127721168", "committedDate": "2020-12-16T21:18:38Z", "message": "Make sure different raft logs get printed out"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDk4NjE2", "url": "https://github.com/Alluxio/alluxio/pull/12649#pullrequestreview-554098616", "createdAt": "2020-12-16T21:28:10Z", "commit": {"oid": "a207f45ee01491e99e45f6c26054544127721168"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3350, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}