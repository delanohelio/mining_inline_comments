{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMTc0NTc0", "number": 10706, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQwMTozMjo0N1rODXTm0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQwMTozMjo0N1rODXTm0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NzY1MDc1OnYy", "diffSide": "RIGHT", "path": "core/server/common/src/main/java/alluxio/master/journal/raft/RaftJournalSystem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQwMTozMjo0N1rOFcjoGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMjo0ODo0NFrOFdHLZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ4ODE1Mw==", "bodyText": "Consider creating the GrpcMessagingTransport here? Then we won't have to do as many null checks here and in GrpcMessagingTransport since we can assume the proxy is only set if necessary.", "url": "https://github.com/Alluxio/alluxio/pull/10706#discussion_r365488153", "createdAt": "2020-01-11T01:32:47Z", "author": {"login": "calvinjia"}, "path": "core/server/common/src/main/java/alluxio/master/journal/raft/RaftJournalSystem.java", "diffHunk": "@@ -238,14 +239,21 @@ private synchronized void initServer() {\n       mStateMachine.close();\n     }\n     mStateMachine = new JournalStateMachine(mJournals, () -> this.getJournalSinks(null));\n+    // Read external proxy configuration.\n+    GrpcMessagingProxy serverProxy = null;\n+    if (mConf.getProxyAddress() != null) {\n+      serverProxy = new GrpcMessagingProxy();\n+      serverProxy.addProxy(getLocalAddress(mConf), new Address(mConf.getProxyAddress()));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ea41b7ffa53653649fd5c93c997d5d3b8ccd68"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA3MDYzMQ==", "bodyText": "I was able to strip some null checks by enforcing valid proxy reference.", "url": "https://github.com/Alluxio/alluxio/pull/10706#discussion_r366070631", "createdAt": "2020-01-13T22:48:44Z", "author": {"login": "ggezer"}, "path": "core/server/common/src/main/java/alluxio/master/journal/raft/RaftJournalSystem.java", "diffHunk": "@@ -238,14 +239,21 @@ private synchronized void initServer() {\n       mStateMachine.close();\n     }\n     mStateMachine = new JournalStateMachine(mJournals, () -> this.getJournalSinks(null));\n+    // Read external proxy configuration.\n+    GrpcMessagingProxy serverProxy = null;\n+    if (mConf.getProxyAddress() != null) {\n+      serverProxy = new GrpcMessagingProxy();\n+      serverProxy.addProxy(getLocalAddress(mConf), new Address(mConf.getProxyAddress()));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ4ODE1Mw=="}, "originalCommit": {"oid": "08ea41b7ffa53653649fd5c93c997d5d3b8ccd68"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2196, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}