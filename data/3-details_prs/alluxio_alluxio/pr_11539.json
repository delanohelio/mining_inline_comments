{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMjM2NDA3", "number": 11539, "title": "Add api counts graph for client-io stress test", "bodyText": "", "createdAt": "2020-06-10T06:40:24Z", "url": "https://github.com/Alluxio/alluxio/pull/11539", "merged": true, "mergeCommit": {"oid": "83924201e9c40123fc1e26509e07035e1a4c2dbb"}, "closed": true, "closedAt": "2020-06-11T00:47:27Z", "author": {"login": "HelloHorizon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpzo98gH2gAyNDMyMjM2NDA3OjVlY2UxNGQ2YjQ1YTc3MGZmNzFhNTkyNWRkYTNjYWM4MGIwMTBlNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqCfsoAFqTQyODUwMDk5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/5ece14d6b45a770ff71a5925dda3cac80b010e67", "committedDate": "2020-06-10T06:26:53Z", "message": "Add number of success graph"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjkwMjAw", "url": "https://github.com/Alluxio/alluxio/pull/11539#pullrequestreview-428290200", "createdAt": "2020-06-10T17:45:14Z", "commit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzo0NToxNFrOGh_2AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzo1MDoyMlrOGiABvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMwMjIwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            subTitle, \"# Threads\", \"Number of Success (MB/s)\");\n          \n          \n            \n                            subTitle, \"# Threads\", \"# API calls\");", "url": "https://github.com/Alluxio/alluxio/pull/11539#discussion_r438302209", "createdAt": "2020-06-10T17:45:14Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -256,6 +278,12 @@ public ClientIOTaskResult aggregate(Iterable<ClientIOTaskResult> results) throws\n                         Collections.singletonList(ClientIOParameters.FIELD_READ_RANDOM))),\n                 subTitle, \"# Threads\", \"Throughput (MB/s)\");\n \n+            LineGraph numSuccessGraph = new LineGraph(String\n+                .format(\"%s - %s - Number of Successes\", operation,\n+                    opSummaries.get(0).mParameters.getDescription(\n+                        Collections.singletonList(ClientIOParameters.FIELD_READ_RANDOM))),\n+                subTitle, \"# Threads\", \"Number of Success (MB/s)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMwMjM0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .format(\"%s - %s - Number of Successes\", operation,\n          \n          \n            \n                            .format(\"%s - %s - API Calls\", operation,", "url": "https://github.com/Alluxio/alluxio/pull/11539#discussion_r438302346", "createdAt": "2020-06-10T17:45:27Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -256,6 +278,12 @@ public ClientIOTaskResult aggregate(Iterable<ClientIOTaskResult> results) throws\n                         Collections.singletonList(ClientIOParameters.FIELD_READ_RANDOM))),\n                 subTitle, \"# Threads\", \"Throughput (MB/s)\");\n \n+            LineGraph numSuccessGraph = new LineGraph(String\n+                .format(\"%s - %s - Number of Successes\", operation,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMwNDc0OA==", "bodyText": "Can this just be a Map<Integer, Map<String, SummaryStatistics>>, so it is num_threads -> (method -> stats)?", "url": "https://github.com/Alluxio/alluxio/pull/11539#discussion_r438304748", "createdAt": "2020-06-10T17:49:35Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -45,7 +45,7 @@\n   private BaseParameters mBaseParameters;\n   private ClientIOParameters mParameters;\n \n-  private Map<Integer, SummaryStatistics> mTimeToFirstByte;\n+  private Map<String, SummaryStatistics> mTimeToFirstByte;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMwNTIxNQ==", "bodyText": "If the data structure was different, we wouldn't have to manually split strings.", "url": "https://github.com/Alluxio/alluxio/pull/11539#discussion_r438305215", "createdAt": "2020-06-10T17:50:22Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -172,10 +173,31 @@ private long computeLastEndMs() {\n     return data;\n   }\n \n+  private void getNumSuccessData(String series, LineGraph lineGraph) {\n+    Map<String, LineGraph.Data> data = new HashMap<>();\n+\n+    for (Map.Entry<String, SummaryStatistics>\n+             threadMethodEntry : mTimeToFirstByte.entrySet()) {\n+      String[] threadMethod = threadMethodEntry.getKey().split(\",\", 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ece14d6b45a770ff71a5925dda3cac80b010e67"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49fd51129c5d591f6268104e210b5d4d6d265d9f", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/49fd51129c5d591f6268104e210b5d4d6d265d9f", "committedDate": "2020-06-10T20:03:55Z", "message": "Change data structure for summary statistics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDEyNzEw", "url": "https://github.com/Alluxio/alluxio/pull/11539#pullrequestreview-428412710", "createdAt": "2020-06-10T20:42:40Z", "commit": {"oid": "49fd51129c5d591f6268104e210b5d4d6d265d9f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0Mjo0MFrOGiFmmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDo0Mjo0MFrOGiFmmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5NjU3MA==", "bodyText": "can we just have this take 3 parameters: threads, method, statistics, and then we don't have to create a new class to just store a map?", "url": "https://github.com/Alluxio/alluxio/pull/11539#discussion_r438396570", "createdAt": "2020-06-10T20:42:40Z", "author": {"login": "gpang"}, "path": "stress/common/src/main/java/alluxio/stress/client/ClientIOTaskResult.java", "diffHunk": "@@ -101,23 +101,24 @@ public void setRecordStartMs(long recordStartMs) {\n   /**\n    * @return client IO statistics per method\n    */\n-  public Map<Integer, SummaryStatistics> getTimeToFirstBytePerThread() {\n+  public Map<Integer, TimeToFirstByteStatistics> getTimeToFirstBytePerThread() {\n     return mTimeToFirstByte;\n   }\n \n   /**\n    * @param timeToFirstByte time to first statistics\n    */\n-  public void setTimeToFirstBytePerThread(Map<Integer, SummaryStatistics> timeToFirstByte) {\n+  public void setTimeToFirstBytePerThread(Map<Integer, TimeToFirstByteStatistics> timeToFirstByte) {\n     mTimeToFirstByte = timeToFirstByte;\n   }\n \n   /**\n-   * @param threadCount thread count\n+   * @param numThreads thread count\n    * @param statistics ClientIOTaskResultStatistics\n    */\n-  public void putTimeToFirstBytePerThread(int threadCount, SummaryStatistics statistics) {\n-    mTimeToFirstByte.put(threadCount, statistics);\n+  public void putTimeToFirstBytePerThread(Integer numThreads,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49fd51129c5d591f6268104e210b5d4d6d265d9f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cffdb20a25cc78a15a8b9dc0cd1fe9424db8427", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/0cffdb20a25cc78a15a8b9dc0cd1fe9424db8427", "committedDate": "2020-06-10T22:39:33Z", "message": "Change to single map map to store summary statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd72310806bd6941265eae240e76a99269171753", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/bd72310806bd6941265eae240e76a99269171753", "committedDate": "2020-06-10T22:41:46Z", "message": "Remove redudant code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NTAwOTk3", "url": "https://github.com/Alluxio/alluxio/pull/11539#pullrequestreview-428500997", "createdAt": "2020-06-10T23:45:20Z", "commit": {"oid": "bd72310806bd6941265eae240e76a99269171753"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4493, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}