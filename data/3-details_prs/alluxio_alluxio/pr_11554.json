{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNDU3MzAx", "number": 11554, "title": "Support emptyDir for volumes and infer dnsPolicy from hostNetwork", "bodyText": "This resolves:\n\nFeature request #11555\nComments under feature request #11526 (comment)", "createdAt": "2020-06-12T04:30:28Z", "url": "https://github.com/Alluxio/alluxio/pull/11554", "merged": true, "mergeCommit": {"oid": "49b01d0fb0e5572ee47414fe7955dcd039ee0329"}, "closed": true, "closedAt": "2020-06-18T01:35:17Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqbI4FAH2gAyNDMzNDU3MzAxOjM3MDUwYjlhMTVlYzU2MDI1YjNiNDM2ZTI3ZDYxYjhmOWVhYzdmNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsUQV1AFqTQzMjg4MTY1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/37050b9a15ec56025b3b436e27d61b8f9eac7f5c", "committedDate": "2020-06-12T04:28:02Z", "message": "dnsPolicy inference and emptyDir support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDk5NTgx", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-429499581", "createdAt": "2020-06-12T06:47:25Z", "commit": {"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjo0NzoyNVrOGi48Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjo0NzoyNVrOGi48Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNzcwMg==", "bodyText": "I think empty dir for alluxio-domain is not helpful. The reason is that empty dir is only shared in the same pod, not across different pods. So it's not visible to Fuse pod or other client pod.", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439237702", "createdAt": "2020-06-12T06:47:25Z", "author": {"login": "cheyang"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -257,6 +257,24 @@ resources:\n   {{- end }}\n {{- end -}}\n \n+{{- define \"alluxio.worker.shortCircuit.volume\" -}}\n+  {{- if eq .Values.shortCircuit.volumeType \"hostPath\" }}\n+        - name: alluxio-domain\n+          hostPath:\n+            path: {{ .Values.shortCircuit.hostPath }}\n+            type: DirectoryOrCreate\n+  {{- else if eq .Values.shortCircuit.volumeType \"persistentVolumeClaim\" }}\n+        - name: alluxio-domain\n+          persistentVolumeClaim:\n+            claimName: \"{{ .Values.shortCircuit.pvcName }}\"\n+  {{- else }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "763d42169b5a9b525e489bc2560ff06aca279d48", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/763d42169b5a9b525e489bc2560ff06aca279d48", "committedDate": "2020-06-12T07:00:27Z", "message": "remove domain socket emptyDir and set values to default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b577ec0fb2af66e73b9a69af83ba54e47601c2fe", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/b577ec0fb2af66e73b9a69af83ba54e47601c2fe", "committedDate": "2020-06-12T07:06:29Z", "message": "propagate change to fuse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/6162f10b8fdcdb94670e75728c78d9083744c8ad", "committedDate": "2020-06-12T07:42:33Z", "message": "fuse issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Njg0NDk1", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-429684495", "createdAt": "2020-06-12T12:01:50Z", "commit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowMTo1MVrOGjBeNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowMTo1MVrOGjBeNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NzQ2Mg==", "bodyText": "Fixed one typo", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439377462", "createdAt": "2020-06-12T12:01:51Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml", "diffHunk": "@@ -92,7 +94,7 @@ spec:\n               fieldRef:\n                 fieldPath: status.hostIP\n           - name: ALLUXIO_CLIENT_JAVA_OPTS\n-            value: \" -Dalluxio.user.hostname=$(ALLUXIO_CLIENT_HOSTNAME) \"\n+            value: \" -Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME} \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Njg1NjA0", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-429685604", "createdAt": "2020-06-12T12:04:01Z", "commit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowNDowMlrOGjBhog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowNDowMlrOGjBhog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3ODMzOA==", "bodyText": "Per #11526 (comment), inferring dnsPolicy from hostNetwork, but not inferring hostNetwork from whether it's root.", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439378338", "createdAt": "2020-06-12T12:04:02Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -70,18 +70,14 @@ master:\n     embedded: 19200\n     rpc: 19998\n     web: 19999\n-  # You can specify hostNetwork and dnsPolicy here to override the default\n-  # hostNetwork: false\n+  hostNetwork: false\n+  # dnsPolicy will be ClusterFirstWithHostNet if hostNetwork: true\n+  # and ClusterFirst if hostNetwork: false\n+  # You can specify dnsPolicy here to override this inference", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NzUyNjc0", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-429752674", "createdAt": "2020-06-12T13:45:54Z", "commit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NzU0ODA1", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-429754805", "createdAt": "2020-06-12T13:48:33Z", "commit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMzo0ODozM1rOGjEoBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMzo0ODozM1rOGjEoBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw==", "bodyText": "Please note this and any other renames in changelog. A rename will break back compatibility, avoid if not absolutely necessary", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439429127", "createdAt": "2020-06-12T13:48:33Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -230,14 +247,20 @@ shortCircuit:\n   # local means the cache directory is in the same mount namespace,\n   # uuid means interact with domain socket\n   policy: uuid\n-  # Attributes if the domain socket volume is PVC\n+  # volumeType controls the type of shortCircuit volume.\n+  # It can be \"persistentVolumeClaim\" or \"hostPath\"\n+  volumeType: persistentVolumeClaim\n+  size: 1Mi\n+  # Attributes to use if the domain socket volume is PVC\n   pvcName: alluxio-worker-domain-socket\n-  pvcAccessModes:\n+  accessModes:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e8c4a2ce01621148370e4198c862c320f522b41", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/5e8c4a2ce01621148370e4198c862c320f522b41", "committedDate": "2020-06-16T12:19:12Z", "message": "try to keep backward compatibility and add to changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fefbd7797420b6554ad67a03308cebec1b14ec60", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/fefbd7797420b6554ad67a03308cebec1b14ec60", "committedDate": "2020-06-16T12:46:35Z", "message": "update domain socket pvc fields to match with doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7212532028c2714a6390d0fd4c0ef32401f41b84", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/7212532028c2714a6390d0fd4c0ef32401f41b84", "committedDate": "2020-06-17T06:34:38Z", "message": "remove emptyDir option for domain socket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea9979ad50692a5d9ed27e727b004c98a10e049", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/0ea9979ad50692a5d9ed27e727b004c98a10e049", "committedDate": "2020-06-17T06:41:48Z", "message": "disable metastore for the tarball"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d45debf71971d7cffb78ec3ea1a449ad98c908f", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/0d45debf71971d7cffb78ec3ea1a449ad98c908f", "committedDate": "2020-06-17T07:08:11Z", "message": "domain socket doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6dc14dec85f3d0c5924a45bbcb134ef18278fca", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/f6dc14dec85f3d0c5924a45bbcb134ef18278fca", "committedDate": "2020-06-17T17:30:25Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyODgxNjU2", "url": "https://github.com/Alluxio/alluxio/pull/11554#pullrequestreview-432881656", "createdAt": "2020-06-18T01:34:42Z", "commit": {"oid": "f6dc14dec85f3d0c5924a45bbcb134ef18278fca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4508, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}