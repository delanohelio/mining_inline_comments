{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NzgwMjE3", "number": 10821, "title": "Skip logging error on worker tmp folder", "bodyText": "Filter out tmp blocks dir so worker doesn't throw error on start", "createdAt": "2020-01-31T21:34:06Z", "url": "https://github.com/Alluxio/alluxio/pull/10821", "merged": true, "mergeCommit": {"oid": "6e55f192b77c9fd9eacdef7d1324990b9ed7e574"}, "closed": true, "closedAt": "2020-02-07T03:10:56Z", "author": {"login": "ns1123"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_1uNcAH2gAyMzY5NzgwMjE3OjY1MDZhMTk3YTNiZmIxYzAzMTI0YTg0Mzc0ZDNiYTBjZWJmMDgyN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB1gO_gFqTM1NDg5MTg3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c", "author": {"user": {"login": "ns1123", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/6506a197a3bfb1c03124a84374d3ba0cebf0827c", "committedDate": "2020-01-31T21:07:36Z", "message": "Skip ERROR on tmp folder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzMzMDYy", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-353333062", "createdAt": "2020-02-04T22:00:58Z", "commit": {"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzQyOTQ4", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-353342948", "createdAt": "2020-02-04T22:19:13Z", "commit": {"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMjoxOToxM1rOFlldnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMjoxOToxM1rOFlldnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw==", "bodyText": "Is the intention to only filter out this tmp folder, or any blocks within it? Because as it, won't this only filter out just that single folder?", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374955423", "createdAt": "2020-02-04T22:19:13Z", "author": {"login": "ZacBlanco"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageDir.java", "diffHunk": "@@ -125,7 +125,9 @@ private void initializeMeta() throws BlockAlreadyExistsException, IOException,\n     }\n     for (File path : paths) {\n       if (!path.isFile()) {\n-        LOG.error(\"{} in StorageDir is not a file\", path.getAbsolutePath());\n+        if (!path.getName().equals(ServerConfiguration.get(PropertyKey.WORKER_DATA_TMP_FOLDER))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzY4MDE5", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-353368019", "createdAt": "2020-02-04T23:09:21Z", "commit": {"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8b0d3504977e77173bc01797d1c6b7710d9582a", "author": {"user": {"login": "ns1123", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/b8b0d3504977e77173bc01797d1c6b7710d9582a", "committedDate": "2020-02-07T00:32:08Z", "message": "Handle multi-level tmp dir"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODg1OTUy", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-354885952", "createdAt": "2020-02-07T01:38:07Z", "commit": {"oid": "b8b0d3504977e77173bc01797d1c6b7710d9582a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTozODowN1rOFmv56g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTozODowN1rOFmv56g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3NTA4Mg==", "bodyText": "can we use a method from PathUtils instead?", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r376175082", "createdAt": "2020-02-07T01:38:07Z", "author": {"login": "ZacBlanco"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageDir.java", "diffHunk": "@@ -109,11 +111,11 @@ public static StorageDir newStorageDir(StorageTier tier, int dirIndex, long capa\n    * @throws WorkerOutOfSpaceException when metadata can not be added due to limited left space\n    */\n   private void initializeMeta() throws BlockAlreadyExistsException, IOException,\n-      WorkerOutOfSpaceException {\n+      WorkerOutOfSpaceException, InvalidPathException {\n     // Create the storage directory path\n     boolean isDirectoryNewlyCreated = FileUtils.createStorageDirPath(mDirPath,\n         ServerConfiguration.get(PropertyKey.WORKER_DATA_FOLDER_PERMISSIONS));\n-\n+    String tmpDir = ServerConfiguration.get(PropertyKey.WORKER_DATA_TMP_FOLDER).split(\"/\")[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8b0d3504977e77173bc01797d1c6b7710d9582a"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba082d1acbd78eb858a49857614dda513a78c84", "author": {"user": {"login": "ns1123", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/4ba082d1acbd78eb858a49857614dda513a78c84", "committedDate": "2020-02-07T01:56:27Z", "message": "Modified to use Paths instead of String.split"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODkxNjkz", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-354891693", "createdAt": "2020-02-07T01:59:31Z", "commit": {"oid": "4ba082d1acbd78eb858a49857614dda513a78c84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTo1OTozMVrOFmwNUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTo1OTozMVrOFmwNUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE4MDA1MQ==", "bodyText": "is this still necessary? it is", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r376180051", "createdAt": "2020-02-07T01:59:31Z", "author": {"login": "ZacBlanco"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTier.java", "diffHunk": "@@ -100,7 +100,7 @@ private void initStorageTier()\n             dirMedium[mediumTypeindex]);\n         totalCapacity += capacity;\n         mDirs.put(i, dir);\n-      } catch (IOException e) {\n+      } catch (IOException | InvalidPathException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba082d1acbd78eb858a49857614dda513a78c84"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODkxODcx", "url": "https://github.com/Alluxio/alluxio/pull/10821#pullrequestreview-354891871", "createdAt": "2020-02-07T02:00:11Z", "commit": {"oid": "4ba082d1acbd78eb858a49857614dda513a78c84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3153, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}