{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMDg1NTM2", "number": 12283, "title": "Do not configure alluxio catalog for older versions of presto in emr", "bodyText": "in emr 5.25, which we refer to in our docs, the presto version is 0.220. the connector we bundle with the tarball only works with 0.227+. if we configure the alluxio catalog that uses our bundled connector and the presto version is incompatible, presto will fail to start.\nthis change checks for the emr version and ensures that it is >= 5.28, which is the first version that uses presto 0.227. here we are assuming that presto will be backwards compatible\ni have tested this with both emr 5.25 and 5.28 to ensure the catalog is configured as described", "createdAt": "2020-10-14T03:45:31Z", "url": "https://github.com/Alluxio/alluxio/pull/12283", "merged": true, "mergeCommit": {"oid": "393f4357d7a502591451c7c2dcde86c7637bb57b"}, "closed": true, "closedAt": "2020-10-14T04:11:42Z", "author": {"login": "Xenorith"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSUzR1gH2gAyNTAzMDg1NTM2OjIwMGQ0YWViMmZmMmRlMGFjZDRkZTUzMWI2MDVhMmMwMDhkYjVkMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSVHezgFqTUwNzk3OTExNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19", "author": {"user": {"login": "alluxio-bot", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/200d4aeb2ff2de0acd4de531b605a2c008db5d19", "committedDate": "2020-10-14T03:41:59Z", "message": "Do not configure alluxio catalog for older versions of presto in emr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTc3MjI4", "url": "https://github.com/Alluxio/alluxio/pull/12283#pullrequestreview-507977228", "createdAt": "2020-10-14T03:57:24Z", "commit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1NzoyNFrOHhBTFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1NzoyNFrOHhBTFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM4NjMyNA==", "bodyText": "that's complicated hahaha @yuzhu does 5.28 support?", "url": "https://github.com/Alluxio/alluxio/pull/12283#discussion_r504386324", "createdAt": "2020-10-14T03:57:24Z", "author": {"login": "LuQQiu"}, "path": "integration/emr/alluxio-emr.sh", "diffHunk": "@@ -662,19 +662,26 @@ IN\n   # set user provided properties\n   set_custom_alluxio_properties \"${delimited_properties}\"\n \n-  # Create a symbolic link in presto plugin directory pointing to our connector if alluxio version is above 2.2\n-  for plugindir in \"${ALLUXIO_HOME}\"/client/presto/plugins/prestodb*; do\n-    # guard against using an older version by checking for alluxio connector's existence\n-    if [ -d \"$plugindir\" ]; then\n-      doas alluxio \"ln -s $plugindir ${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\"\n-      sudo ln -s \"${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\" /usr/lib/presto/plugin/hive-alluxio\n-      sudo mkdir -p /etc/presto/conf/catalog\n-      echo \"connector.name=hive-alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore=alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore.alluxio.master.address=${master}:19998\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      break\n-    fi\n-  done\n+  # Create a symbolic link in presto plugin directory pointing to our connector if:\n+  # - emr version is >= 5.28 -> prestodb >= 0.227\n+  # - alluxio version is above 2.2\n+  local -r emr_version=$(jq \".releaseLabel\" /mnt/var/lib/info/extraInstanceData.json  | sed -e 's/^\"emr-//' -e 's/\"$//')\n+  local -r emr_major=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\1/')\n+  local -r emr_minor=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\2/')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTc3OTc5", "url": "https://github.com/Alluxio/alluxio/pull/12283#pullrequestreview-507977979", "createdAt": "2020-10-14T04:00:02Z", "commit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTc5MTE0", "url": "https://github.com/Alluxio/alluxio/pull/12283#pullrequestreview-507979114", "createdAt": "2020-10-14T04:04:03Z", "commit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3546, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}