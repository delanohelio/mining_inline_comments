{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NTUyOTY0", "number": 11746, "title": "Simplify UfsStatus handling in loadMetadata", "bodyText": "This reverts a change from #11704 while also removing redundant UFS calls. The ufs.exists in loadMetadata is no longer necessary because every call to loadMetadata goes through call site place which will always set the UfsStatus in the LoadMetadataContext. The attempt to retrieve the UfsStatus from the UfsStatusCache will always pull the status from the internal map, or reach out to the UFS. If the status couldn't be retrieved on the call to fetchStatusIfAbsent then it does not exist in the UFS.", "createdAt": "2020-07-10T17:17:29Z", "url": "https://github.com/Alluxio/alluxio/pull/11746", "merged": true, "mergeCommit": {"oid": "f6f265cdc41013b0c2617bdaba67a6ae6eeb572b"}, "closed": true, "closedAt": "2020-07-11T00:45:28Z", "author": {"login": "ZacBlanco"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcznbrcgBqjM1MzQ4NTk0NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczshJhgH2gAyNDQ3NTUyOTY0OmRkMGI0MTBjZjQyNGRhOGU1MDhiMTgyNmY4ZWYzYzc2YTJjM2JhZTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "131cc475ff5f21203d654bc98c5eaecf3df24f0c", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/131cc475ff5f21203d654bc98c5eaecf3df24f0c", "committedDate": "2020-07-10T16:51:18Z", "message": "attempt 2"}, "afterCommit": {"oid": "30e8bf81689ba9ebc5c3504cea36532884f25c6c", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/30e8bf81689ba9ebc5c3504cea36532884f25c6c", "committedDate": "2020-07-10T17:19:51Z", "message": "attempt 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30e8bf81689ba9ebc5c3504cea36532884f25c6c", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/30e8bf81689ba9ebc5c3504cea36532884f25c6c", "committedDate": "2020-07-10T17:19:51Z", "message": "attempt 2"}, "afterCommit": {"oid": "fe47767c1c0e291bd00c32c7de0772e7dead852f", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/fe47767c1c0e291bd00c32c7de0772e7dead852f", "committedDate": "2020-07-10T18:43:57Z", "message": "attempt 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "920dfa320b1817a8baa01d97bad3ce626df0a59e", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/920dfa320b1817a8baa01d97bad3ce626df0a59e", "committedDate": "2020-07-10T19:57:06Z", "message": "Try to improve SSCW perf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00240680873d305a9a153118c575072f0f5140b9", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/00240680873d305a9a153118c575072f0f5140b9", "committedDate": "2020-07-10T19:57:06Z", "message": "attempt 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe47767c1c0e291bd00c32c7de0772e7dead852f", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/fe47767c1c0e291bd00c32c7de0772e7dead852f", "committedDate": "2020-07-10T18:43:57Z", "message": "attempt 2"}, "afterCommit": {"oid": "00240680873d305a9a153118c575072f0f5140b9", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/00240680873d305a9a153118c575072f0f5140b9", "committedDate": "2020-07-10T19:57:06Z", "message": "attempt 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzQxMjg3", "url": "https://github.com/Alluxio/alluxio/pull/11746#pullrequestreview-446741287", "createdAt": "2020-07-10T22:59:15Z", "commit": {"oid": "00240680873d305a9a153118c575072f0f5140b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjo1OToxNVrOGwHzCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjo1OToxNVrOGwHzCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzExMjU4NA==", "bodyText": "This means for load metadata, this context.getUfsStatus() must always be prepopulated with the UFS status? Something earlier in the call stack will be populating everything? What is the difference between this context.getUfsStatus() and the status cache?\nThis also implies this method itself will never call UFS?\nCan we add this to the method javadoc?", "url": "https://github.com/Alluxio/alluxio/pull/11746#discussion_r453112584", "createdAt": "2020-07-10T22:59:15Z", "author": {"login": "gpang"}, "path": "core/server/master/src/main/java/alluxio/master/file/InodeSyncStream.java", "diffHunk": "@@ -639,10 +639,8 @@ private void loadMetadata(LockedInodePath inodePath, LoadMetadataContext context\n       FileDoesNotExistException, InvalidFileSizeException, InvalidPathException, IOException {\n     AlluxioURI path = inodePath.getUri();\n     MountTable.Resolution resolution = mMountTable.resolve(path);\n-    AlluxioURI ufsUri = resolution.getUri();\n-    try (CloseableResource<UnderFileSystem> ufsResource = resolution.acquireUfsResource()) {\n-      UnderFileSystem ufs = ufsResource.get();\n-      if (context.getUfsStatus() == null && !ufs.exists(ufsUri.toString())) {\n+    try {\n+      if (context.getUfsStatus() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00240680873d305a9a153118c575072f0f5140b9"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0005e829c3b6f12cf519512544788e55b1484410", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/0005e829c3b6f12cf519512544788e55b1484410", "committedDate": "2020-07-10T23:27:55Z", "message": "Add javadoc to loadMetadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzQ5Njk5", "url": "https://github.com/Alluxio/alluxio/pull/11746#pullrequestreview-446749699", "createdAt": "2020-07-10T23:31:40Z", "commit": {"oid": "0005e829c3b6f12cf519512544788e55b1484410"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd0b410cf424da8e508b1826f8ef3c76a2c3bae6", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/dd0b410cf424da8e508b1826f8ef3c76a2c3bae6", "committedDate": "2020-07-10T23:48:15Z", "message": "Fix style"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4274, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}