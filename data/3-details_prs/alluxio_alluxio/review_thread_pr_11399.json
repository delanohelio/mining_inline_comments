{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDQwNDgx", "number": 11399, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxMDoxNlrOD7Adxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxNjozNFrOD7AgFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwMTk5OnYy", "diffSide": "RIGHT", "path": "shell/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxMDoxNlrOGTGT7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTo0NzoxMFrOGTYzBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTUzNA==", "bodyText": "please fix the spacing on this dependency", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422679534", "createdAt": "2020-05-10T18:10:16Z", "author": {"login": "ZacBlanco"}, "path": "shell/pom.xml", "diffHunk": "@@ -51,14 +51,18 @@\n       <groupId>commons-io</groupId>\n       <artifactId>commons-io</artifactId>\n     </dependency>\n-   <dependency>\n-     <groupId>org.apache.httpcomponents</groupId>\n-     <artifactId>httpclient</artifactId>\n-   </dependency>\n-   <dependency>\n+    <dependency>\n+      <groupId>org.apache.httpcomponents</groupId>\n+      <artifactId>httpclient</artifactId>\n+    </dependency>\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4MjQwNA==", "bodyText": "I added the spaces just because these lines were incorrectly aligned. Please compare with the lines above and below.", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422982404", "createdAt": "2020-05-11T11:47:10Z", "author": {"login": "jiacheliu3"}, "path": "shell/pom.xml", "diffHunk": "@@ -51,14 +51,18 @@\n       <groupId>commons-io</groupId>\n       <artifactId>commons-io</artifactId>\n     </dependency>\n-   <dependency>\n-     <groupId>org.apache.httpcomponents</groupId>\n-     <artifactId>httpclient</artifactId>\n-   </dependency>\n-   <dependency>\n+    <dependency>\n+      <groupId>org.apache.httpcomponents</groupId>\n+      <artifactId>httpclient</artifactId>\n+    </dependency>\n+    <dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTUzNA=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwMjM2OnYy", "diffSide": "RIGHT", "path": "shell/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxMDozN1rOGTGUGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTo0NzoyOFrOGTYzhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTU3Nw==", "bodyText": "please revert if there is no change here", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422679577", "createdAt": "2020-05-10T18:10:37Z", "author": {"login": "ZacBlanco"}, "path": "shell/pom.xml", "diffHunk": "@@ -82,8 +86,8 @@\n       <version>${project.version}</version>\n     </dependency>\n     <dependency>\n-        <groupId>org.apache.commons</groupId>\n-        <artifactId>commons-compress</artifactId>\n+      <groupId>org.apache.commons</groupId>\n+      <artifactId>commons-compress</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4MjUzNA==", "bodyText": "See comment above", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422982534", "createdAt": "2020-05-11T11:47:28Z", "author": {"login": "jiacheliu3"}, "path": "shell/pom.xml", "diffHunk": "@@ -82,8 +86,8 @@\n       <version>${project.version}</version>\n     </dependency>\n     <dependency>\n-        <groupId>org.apache.commons</groupId>\n-        <artifactId>commons-compress</artifactId>\n+      <groupId>org.apache.commons</groupId>\n+      <artifactId>commons-compress</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTU3Nw=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwNDMxOnYy", "diffSide": "LEFT", "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxMjo1NFrOGTGVFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTo1MjoxMFrOGTY8gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTgzMQ==", "bodyText": "why remove this?", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422679831", "createdAt": "2020-05-10T18:12:54Z", "author": {"login": "ZacBlanco"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4NDgzMg==", "bodyText": "Reverted. I made a mistake thinking these are all Methods. Tks for the catch.", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422984832", "createdAt": "2020-05-11T11:52:10Z", "author": {"login": "jiacheliu3"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3OTgzMQ=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwNTg0OnYy", "diffSide": "RIGHT", "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxNDoyNVrOGTGV2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjowMDo0N1rOGTZNAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDAyNQ==", "bodyText": "we should avoid catch-all here. Is there a reason to use Exception over InvocationTargetException?", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422680025", "createdAt": "2020-05-10T18:14:25Z", "author": {"login": "ZacBlanco"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4OTA1OA==", "bodyText": "I think it makes sense to let all the tests complete, instead of letting one ufs operation err out and aborts the runUfsTests.", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422989058", "createdAt": "2020-05-11T12:00:47Z", "author": {"login": "jiacheliu3"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDAyNQ=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwNzQwOnYy", "diffSide": "LEFT", "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxNjowOFrOGTGWqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTo1NToxNlrOGTZCQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDIzMw==", "bodyText": "should we not put cleanupUfs even on failure?", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422680233", "createdAt": "2020-05-10T18:16:08Z", "author": {"login": "ZacBlanco"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {\n             if (mUfs.getUnderFSType().equals(S3_IDENTIFIER)) {\n               logRelatedS3Operations(test);\n             }\n-            throw new IOException(e.getTargetException());\n+            System.err.format(\"Test %s.%s aborted%n%s\", test.getClass(), test.getName(), e);\n+          } finally {\n+            RunTestUtils.printPassInfo(passed);\n+            if (!passed) {\n+              failedTestCnt++;\n+            }\n           }\n-          System.out.println(\"Test Passed!\");\n-          cleanupUfs(testDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4NjMwNQ==", "bodyText": "Moved cleanupUfs() up into the finally block.", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422986305", "createdAt": "2020-05-11T11:55:16Z", "author": {"login": "jiacheliu3"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {\n             if (mUfs.getUnderFSType().equals(S3_IDENTIFIER)) {\n               logRelatedS3Operations(test);\n             }\n-            throw new IOException(e.getTargetException());\n+            System.err.format(\"Test %s.%s aborted%n%s\", test.getClass(), test.getName(), e);\n+          } finally {\n+            RunTestUtils.printPassInfo(passed);\n+            if (!passed) {\n+              failedTestCnt++;\n+            }\n           }\n-          System.out.println(\"Test Passed!\");\n-          cleanupUfs(testDir);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDIzMw=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjAwNzkwOnYy", "diffSide": "RIGHT", "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODoxNjozNVrOGTGW4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMTo1OToyMFrOGTZKCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDI5MA==", "bodyText": "does this print something different based on whether passed is true or false?", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422680290", "createdAt": "2020-05-10T18:16:35Z", "author": {"login": "ZacBlanco"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {\n             if (mUfs.getUnderFSType().equals(S3_IDENTIFIER)) {\n               logRelatedS3Operations(test);\n             }\n-            throw new IOException(e.getTargetException());\n+            System.err.format(\"Test %s.%s aborted%n%s\", test.getClass(), test.getName(), e);\n+          } finally {\n+            RunTestUtils.printPassInfo(passed);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk4ODI5OQ==", "bodyText": "I renamed CliUtils to RunTestUtils, as CliUtils contains only util methods local to runUfsTests, instead of general to all other cli classes.\nRunTestUtils.printPassInfo() corresponds to\n\n  \n    \n      alluxio/examples/src/main/java/alluxio/cli/CliUtils.java\n    \n    \n         Line 34\n      in\n      c4eba47\n    \n    \n    \n    \n\n        \n          \n           public static void printPassInfo(boolean pass) {", "url": "https://github.com/Alluxio/alluxio/pull/11399#discussion_r422988299", "createdAt": "2020-05-11T11:59:20Z", "author": {"login": "jiacheliu3"}, "path": "shell/src/main/java/alluxio/cli/UnderFileSystemContractTest.java", "diffHunk": "@@ -111,42 +106,47 @@ private void runS3Operations() throws Exception {\n     mUfs = UnderFileSystem.Factory.create(mUfsPath, getUfsConf());\n \n     String testDir = createTestDirectory();\n-    loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n+    return loadAndRunTests(new S3ASpecificOperations(testDir, mUfs, mConf), testDir);\n   }\n \n   /**\n    * Loads and runs the tests in the target operations class.\n    *\n    * @param operations the class that contains the tests to run\n    * @param testDir the test directory to run tests against\n+   * @return the number of failed tests\n    */\n-  private void loadAndRunTests(Object operations, String testDir) throws Exception {\n+  private int loadAndRunTests(Object operations, String testDir) throws Exception {\n+    int failedTestCnt = 0;\n     try {\n       Class classToRun = operations.getClass();\n-      Field[] fields = classToRun.getDeclaredFields();\n-      for (Field field : fields) {\n-        field.setAccessible(true);\n-      }\n       Method[] tests = classToRun.getDeclaredMethods();\n       for (Method test : tests) {\n         String testName = test.getName();\n         if (testName.endsWith(\"Test\")) {\n           System.out.printf(\"Running test: %s...\", testName);\n+          boolean passed = false;\n           try {\n             test.invoke(operations);\n-          } catch (InvocationTargetException e) {\n+            passed = true;\n+            cleanupUfs(testDir);\n+          } catch (Exception e) {\n             if (mUfs.getUnderFSType().equals(S3_IDENTIFIER)) {\n               logRelatedS3Operations(test);\n             }\n-            throw new IOException(e.getTargetException());\n+            System.err.format(\"Test %s.%s aborted%n%s\", test.getClass(), test.getName(), e);\n+          } finally {\n+            RunTestUtils.printPassInfo(passed);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MDI5MA=="}, "originalCommit": {"oid": "bef6ff9a362fead4ce5a04f0d22b9b9e5dfb68c6"}, "originalPosition": 94}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1721, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}