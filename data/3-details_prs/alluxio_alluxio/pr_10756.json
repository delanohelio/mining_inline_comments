{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzg1NzQ2", "number": 10756, "title": "Fail nested jobs correctly in all of the jobs for JobMaster failures", "bodyText": "For errors like ResourceExhaustedException and JobDoesNotExistException, the WorkflowTracker will only stamp Status.FAILED from a level above.\nReproduction: (see Test)\nmJobMaster.run(new Composite..([new Composite(new DummyJob....\nExpected:\nName: Composite\n..\nStatus: FAILED\nMessage: The job definition for config bleh does not exist\nTask 0\nName: Composite\n...\nStatus: FAILED\nMessage: The job definition for config bleh does not exist\nActual:\nName: Composite\n..\nStatus: FAILED\nMessage: The job definition for config bleh does not exist\nTask 0\nName: Composite\n...\nStatus: RUNNING", "createdAt": "2020-01-16T18:30:27Z", "url": "https://github.com/Alluxio/alluxio/pull/10756", "merged": true, "mergeCommit": {"oid": "5a4dfb3b02c46e930886620159634ea726cd3bb7"}, "closed": true, "closedAt": "2020-01-20T19:21:15Z", "author": {"login": "bradyoo"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6-Yx5gH2gAyMzYzNzg1NzQ2OmFiYWQ3YTZlMmFlMmJhNGFkMDdlYTA4YmU3MmViODY4YThiMWIyNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8RmpXgFqTM0NTQ5NjUyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272", "committedDate": "2020-01-16T18:23:43Z", "message": "Fix bug where missingJob/ResourceExhausted is stamping Status.FAILED in not enough jobs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0ODU0MjYy", "url": "https://github.com/Alluxio/alluxio/pull/10756#pullrequestreview-344854262", "createdAt": "2020-01-17T21:35:46Z", "commit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNTo0NlrOFfF2yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNTo0NlrOFfF2yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjEyMw==", "bodyText": "Should this logic be in the stop call? Does the bug happen for workflows which fail through PlanTracker#onPlanStatusChange?", "url": "https://github.com/Alluxio/alluxio/pull/10756#discussion_r368146123", "createdAt": "2020-01-17T21:35:46Z", "author": {"login": "calvinjia"}, "path": "job/server/src/main/java/alluxio/master/job/workflow/WorkflowTracker.java", "diffHunk": "@@ -250,6 +250,7 @@ private synchronized void next(long jobId) {\n         mJobMaster.run(childJobConfig, childJobId);\n       } catch (JobDoesNotExistException | ResourceExhaustedException e) {\n         LOG.warn(e.getMessage());\n+        workflowExecution.stop(Status.FAILED, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NDk2NTIw", "url": "https://github.com/Alluxio/alluxio/pull/10756#pullrequestreview-345496520", "createdAt": "2020-01-20T19:20:59Z", "commit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3304, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}