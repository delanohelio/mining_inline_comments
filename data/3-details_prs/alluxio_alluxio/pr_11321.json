{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NDc4OTg5", "number": 11321, "title": "Put helm template generation into generate-tarball", "bodyText": "This addresses #11318\nWe move Helm template generation into generate-tarball and remove the need to manually update them.", "createdAt": "2020-04-21T06:59:46Z", "url": "https://github.com/Alluxio/alluxio/pull/11321", "merged": true, "mergeCommit": {"oid": "d9933118447643b1ab8fd9841504ffb17e52c879"}, "closed": true, "closedAt": "2020-04-24T16:41:33Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZt68dAH2gAyNDA2NDc4OTg5OjI3NTc3YTBkZjE0ODQwY2NmZTkyMjY0NTgwNDY0NGM4MzU3MjU2YWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcapmfoAFqTM5OTYyODM3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27577a0df14840ccfe922645804644c8357256aa", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/27577a0df14840ccfe922645804644c8357256aa", "committedDate": "2020-04-21T06:44:18Z", "message": "put helm generate into generate tarballs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/3ea30d5bb88059dcfe32cb513c5847f2b3af9617", "committedDate": "2020-04-21T11:48:09Z", "message": "remove templates and generate them"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4530b0bf8da66cc39720f60a67dc4e7899b5f0c", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a4530b0bf8da66cc39720f60a67dc4e7899b5f0c", "committedDate": "2020-04-21T12:08:34Z", "message": "Add release tarball flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MjczOTE3", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397273917", "createdAt": "2020-04-21T12:21:14Z", "commit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMToxNFrOGJCvmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMToxNFrOGJCvmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzNTMyMw==", "bodyText": "The annoying hard-coded list is removed", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412135323", "createdAt": "2020-04-21T12:21:14Z", "author": {"login": "jiacheliu3"}, "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-tarball.go", "diffHunk": "@@ -194,38 +196,6 @@ func addAdditionalFiles(srcPath, dstPath string, hadoopVersion version, version\n \t\t\"integration/docker/conf/alluxio-site.properties.template\",\n \t\t\"integration/docker/conf/alluxio-env.sh.template\",\n \t\t\"integration/fuse/bin/alluxio-fuse\",\n-\t\t\"integration/kubernetes/alluxio-fuse.yaml.template\",\n-\t\t\"integration/kubernetes/alluxio-fuse-client.yaml.template\",\n-\t\t\"integration/kubernetes/helm-generate.sh\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/.helmignore\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/Chart.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/values.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/config/alluxio-conf.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/fuse/client-daemonset.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/master/service.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml\",\n-\t\t\"integration/kubernetes/helm-chart/alluxio/templates/worker/domain-socket-pvc.yaml\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/alluxio-configmap.yaml.template\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/config.yaml\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/master/alluxio-master-service.yaml.template\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/master/alluxio-master-statefulset.yaml.template\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/worker/alluxio-worker-daemonset.yaml.template\",\n-\t\t\"integration/kubernetes/multiMaster-embeddedJournal/worker/alluxio-worker-pvc.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/alluxio-configmap.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/config.yaml\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/master/alluxio-master-service.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/master/alluxio-master-statefulset.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/worker/alluxio-worker-daemonset.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-hdfsJournal/worker/alluxio-worker-pvc.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/alluxio-configmap.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/config.yaml\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/master/alluxio-master-service.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/master/alluxio-master-statefulset.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/worker/alluxio-worker-daemonset.yaml.template\",\n-\t\t\"integration/kubernetes/singleMaster-localJournal/worker/alluxio-worker-pvc.yaml.template\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Mjc0MjEw", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397274210", "createdAt": "2020-04-21T12:21:37Z", "commit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMTozN1rOGJCwrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMTozN1rOGJCwrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzNTU5Nw==", "bodyText": "We generate the template in the destination dir instead of copying them over", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412135597", "createdAt": "2020-04-21T12:21:37Z", "author": {"login": "jiacheliu3"}, "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-tarball.go", "diffHunk": "@@ -347,6 +320,15 @@ func generateTarball(hadoopClients []string) error {\n \trun(\"adding Alluxio FUSE jar\", \"mv\", fmt.Sprintf(\"integration/fuse/target/alluxio-integration-fuse-%v-jar-with-dependencies.jar\", version), filepath.Join(dstPath, \"integration\", \"fuse\", fmt.Sprintf(\"alluxio-fuse-%v.jar\", version)))\n \trun(\"adding Alluxio checker jar\", \"mv\", fmt.Sprintf(\"integration/checker/target/alluxio-checker-%v-jar-with-dependencies.jar\", version), filepath.Join(dstPath, \"integration\", \"checker\", fmt.Sprintf(\"alluxio-checker-%v.jar\", version)))\n \n+\t// Generate Helm templates in the dstPath\n+\trun(\"adding Helm chart\", \"cp\", \"-r\", filepath.Join(srcPath, \"integration/kubernetes/helm-chart\"), filepath.Join(dstPath, \"integration/kubernetes/helm-chart\"))\n+\trun(\"adding YAML generator script\", \"cp\", filepath.Join(srcPath, \"integration/kubernetes/helm-generate.sh\"), filepath.Join(dstPath, \"integration/kubernetes/helm-generate.sh\"))\n+\tif !skipHelmFlag {\n+\t\tchdir(filepath.Join(dstPath, \"integration/kubernetes/\"))\n+\t\trun(\"generate Helm templates\", \"bash\", \"helm-generate.sh\", \"all\")\n+\t\tchdir(srcPath)\n+\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "originalPosition": 86}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Mjc0NTU5", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397274559", "createdAt": "2020-04-21T12:22:07Z", "commit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMjowN1rOGJCyBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMjoyMjowN1rOGJCyBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzNTk0MQ==", "bodyText": "In automated generation there's no config.yaml anymore. We have to provide one.", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412135941", "createdAt": "2020-04-21T12:22:07Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-generate.sh", "diffHunk": "@@ -27,12 +27,26 @@ function printUsage {\n \n function generateTemplates {\n   echo \"Generating templates into $dir\"\n+  # Prepare target directories\n+  if [[ ! -d \"${dir}/master\" ]]; then\n+    mkdir -p ${dir}/master\n+  fi\n+  if [[ ! -d \"${dir}/worker\" ]]; then\n+    mkdir -p ${dir}/worker\n+  fi\n+\n   config=./$dir/config.yaml\n   if [[ ! -f \"$config\" ]]; then\n     echo \"A config file $config is needed in $dir!\"\n     echo \"See https://docs.alluxio.io/os/user/edge/en/deploy/Running-Alluxio-On-Kubernetes.html#example-hdfs-as-the-under-store\"\n     echo \"for the format of config.yaml.\"\n-    exit 1\n+\n+    touch $config\n+    echo \"Using default config\"\n+    echo \"${defaultConfig}\"\n+    cat << EOF >> $config\n+${defaultConfig}\n+EOF", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ea30d5bb88059dcfe32cb513c5847f2b3af9617"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzE0MTk0", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397314194", "createdAt": "2020-04-21T13:11:37Z", "commit": {"oid": "a4530b0bf8da66cc39720f60a67dc4e7899b5f0c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMzoxMTozN1rOGJE7uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMzoxMTozN1rOGJE7uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3MTE5Mg==", "bodyText": "It might be controversial to default to true, which skips Helm templating. My argument is by skipping the helm step, we don't introduce a new dependency on helm for those who builds Alluxio tarballs using the generate-tarball script. What do you think @madanadit @Xenorith", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412171192", "createdAt": "2020-04-21T13:11:37Z", "author": {"login": "jiacheliu3"}, "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-tarball.go", "diffHunk": "@@ -41,6 +42,7 @@ func Single(args []string) error {\n \tsingleCmd.StringVar(&hadoopDistributionFlag, \"hadoop-distribution\", defaultHadoopClient, \"the hadoop distribution to build this Alluxio distribution tarball\")\n \tsingleCmd.BoolVar(&skipUIFlag, \"skip-ui\", false, fmt.Sprintf(\"set this flag to skip building the webui. This will speed up the build times \"+\n \t\t\"but the generated tarball will have no Alluxio WebUI although REST services will still be available.\"))\n+\tsingleCmd.BoolVar(&skipHelmFlag, \"skip-helm\", true, fmt.Sprintf(\"set this flag to skip using Helm to generate YAML templates for K8s deployment scenarios\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4530b0bf8da66cc39720f60a67dc4e7899b5f0c"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f77dc6aeaee6645e2ca1451062f069a8e1adf18d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/f77dc6aeaee6645e2ca1451062f069a8e1adf18d", "committedDate": "2020-04-21T13:16:09Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzE5MzIz", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397319323", "createdAt": "2020-04-21T13:17:28Z", "commit": {"oid": "f77dc6aeaee6645e2ca1451062f069a8e1adf18d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMzoxNzoyOFrOGJFM9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMzoxNzoyOFrOGJFM9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3NTYwNw==", "bodyText": "This is the only place I can think of, that this change affects.", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412175607", "createdAt": "2020-04-21T13:17:28Z", "author": {"login": "jiacheliu3"}, "path": "docs/en/deploy/Running-Alluxio-On-Kubernetes.md", "diffHunk": "@@ -384,6 +384,9 @@ Each Alluxio master writes journal to its own journal volume requested by `volum\n set of workers.\n The journal is in a shared UFS location. In this template we use HDFS as the UFS.\n \n+> Note: Please make sure your Alluxio tarball contains these sample templates. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f77dc6aeaee6645e2ca1451062f069a8e1adf18d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTMxNTYy", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-397531562", "createdAt": "2020-04-21T17:42:05Z", "commit": {"oid": "f77dc6aeaee6645e2ca1451062f069a8e1adf18d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo0MjowNVrOGJQe7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo0MjowNVrOGJQe7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2MDQyOA==", "bodyText": "why add these 2 args to generateTarball and is skipUIFlag flag ignored now? i would remove the extra args and rely on flags alone. also, skipHelm should be true here anyways?", "url": "https://github.com/Alluxio/alluxio/pull/11321#discussion_r412360428", "createdAt": "2020-04-21T17:42:05Z", "author": {"login": "madanadit"}, "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-release-tarballs.go", "diffHunk": "@@ -56,7 +56,8 @@ func Release(args []string) error {\n \n func generateTarballs() error {\n \tfmt.Printf(\"Generating tarball %v\\n\", fmt.Sprintf(\"alluxio-%v-bin.tar.gz\", versionMarker))\n-\tif err := generateTarball(strings.Split(hadoopDistributionsFlag, \",\")); err != nil {\n+\t// Do not skip UI and Helm\n+\tif err := generateTarball(strings.Split(hadoopDistributionsFlag, \",\"), false, false); err != nil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f77dc6aeaee6645e2ca1451062f069a8e1adf18d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2425ac8bc00f67bf12b88125ccb66f7555d5aea0", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/2425ac8bc00f67bf12b88125ccb66f7555d5aea0", "committedDate": "2020-04-22T14:50:22Z", "message": "resolve doc comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5587c70c757a54c57ef6faab2f993ddbdd2aac1", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/c5587c70c757a54c57ef6faab2f993ddbdd2aac1", "committedDate": "2020-04-22T14:52:00Z", "message": "whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjI1MDUw", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-399625050", "createdAt": "2020-04-24T04:03:53Z", "commit": {"oid": "c5587c70c757a54c57ef6faab2f993ddbdd2aac1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjI4Mzcy", "url": "https://github.com/Alluxio/alluxio/pull/11321#pullrequestreview-399628372", "createdAt": "2020-04-24T04:16:16Z", "commit": {"oid": "c5587c70c757a54c57ef6faab2f993ddbdd2aac1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4547, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}