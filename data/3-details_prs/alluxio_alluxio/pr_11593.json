{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzE5NzM5", "number": 11593, "title": "Fix Fuse crash in kubernetes in helmchart", "bodyText": "Fix fuse crash issue. It's because the ALLUXIO_FUSE_OPTS are not in /opt/alluxio/conf/alluxio_env.sh, so it translates to ALLUXIO_FUSE_OPTS=\" '-Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME}' \"\n\n\n\nMake pod can access itself through service\n\n\nUpdate change log", "createdAt": "2020-06-18T08:40:00Z", "url": "https://github.com/Alluxio/alluxio/pull/11593", "merged": true, "mergeCommit": {"oid": "f7ca69928d78873aac0efad4a73b5c4bc1f298b0"}, "closed": true, "closedAt": "2020-06-19T17:11:33Z", "author": {"login": "cheyang"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsaHO_gH2gAyNDM2MzE5NzM5OmFiYTNmZmE0MjY0NzA5YmE5NWI1M2M3MjIyNjM5NDVlN2ZmYmFiY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs2QB-AFqTQzNDIyOTI3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aba3ffa4264709ba95b53c722263945e7ffbabce", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/aba3ffa4264709ba95b53c722263945e7ffbabce", "committedDate": "2020-06-18T08:24:11Z", "message": "Fix fuse crash, to #28879036"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b7bab2e7ce827ec6ebffd9929dc11f3fbd6e49e", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/2b7bab2e7ce827ec6ebffd9929dc11f3fbd6e49e", "committedDate": "2020-06-18T08:29:26Z", "message": "Make pod access itself throw service, to #28879036"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "committedDate": "2020-06-18T08:31:33Z", "message": "Update change log, to #28879036"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzg0Mzc0", "url": "https://github.com/Alluxio/alluxio/pull/11593#pullrequestreview-433384374", "createdAt": "2020-06-18T15:12:04Z", "commit": {"oid": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToxMjowNVrOGlz9ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToxODo0MFrOGl0Pag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwMTg5MQ==", "bodyText": "I suggest changing this line to \"Change master service to headless from NodePort\"", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442301891", "createdAt": "2020-06-18T15:12:05Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/CHANGELOG.md", "diffHunk": "@@ -99,4 +99,6 @@\n - Moved metastore configuration properties to the root level, to be the same as journal\n - Removed inferring hostNetwork, dnsPolicy and domain socket from whether user is root\n - Added inferring dnsPolicy from hostNetwork\n-- Fixed one typo in ALLUXIO_CLIENT_JAVA_OPTS for FUSE   \n+- Fixed one typo in ALLUXIO_CLIENT_JAVA_OPTS for FUSE\n+- Fixed Fuse crash issue\n+- Fixed the pod can't access itself through service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjQxMA==", "bodyText": "@madanadit I'm not too sure about what java opts Fuse wants. But it can be related to this ALLUXIO_CLIENT_JAVA_OPTS not being used \n  \n    \n      alluxio/integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml\n    \n    \n         Line 96\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           - name: ALLUXIO_CLIENT_JAVA_OPTS \n        \n    \n  \n\n\nLooking at \n  \n    \n      alluxio/integration/docker/entrypoint.sh\n    \n    \n         Line 30\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           ALLUXIO_USER_JAVA_OPTS \n        \n    \n  \n\n, I think it should be ALLUXIO_USER_JAVA_OPTS instead of ALLUXIO_CLIENT_JAVA_OPTS? So by changing \n  \n    \n      alluxio/integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml\n    \n    \n         Line 96\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           - name: ALLUXIO_CLIENT_JAVA_OPTS \n        \n    \n  \n\n from ALLUXIO_CLIENT_JAVA_OPTS to ALLUXIO_USER_JAVA_OPTS, we can fix this issue without adding \"-Dalluxio.worker.hostname=${ALLUXIO_CLIENT_HOSTNAME}\"", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442306410", "createdAt": "2020-06-18T15:18:40Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/config/alluxio-conf.yaml", "diffHunk": "@@ -26,6 +26,10 @@\n {{- if $isSingleMaster }}\n   {{- $alluxioJavaOpts = printf \"-Dalluxio.master.hostname=%v-%v\" $fullName $defaultMasterName | append $alluxioJavaOpts }}\n {{- end }}\n+{{ if .Values.fuse.enabled -}}\n+{{- $alluxioJavaOpts = print \"-Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME}\" | append $alluxioJavaOpts }}\n+{{- $alluxioJavaOpts = printf \"-Dalluxio.worker.hostname=${ALLUXIO_CLIENT_HOSTNAME}\" | append $alluxioJavaOpts }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a04d819a567bc5a81401c808870fffa3b443f2", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/78a04d819a567bc5a81401c808870fffa3b443f2", "committedDate": "2020-06-18T22:54:06Z", "message": "Update changelog, to #28465442"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec6390e49997c9aa24281e4a983c60107ae9915d", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/ec6390e49997c9aa24281e4a983c60107ae9915d", "committedDate": "2020-06-19T11:27:06Z", "message": "Make the master access itself, to #28465442"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb", "author": {"user": {"login": "cheyang", "name": "cheyang"}}, "url": "https://github.com/Alluxio/alluxio/commit/14fc0adf0250a1fee46c8bef6b061e7bf65391eb", "committedDate": "2020-06-19T14:00:18Z", "message": "Update version to 0.6.4, to #28465442"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTg2Njkz", "url": "https://github.com/Alluxio/alluxio/pull/11593#pullrequestreview-434186693", "createdAt": "2020-06-19T15:59:42Z", "commit": {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTg3NDg0", "url": "https://github.com/Alluxio/alluxio/pull/11593#pullrequestreview-434187484", "createdAt": "2020-06-19T16:00:29Z", "commit": {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNjowMDoyOVrOGmZ1pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNjowMDoyOVrOGmZ1pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMjQwNg==", "bodyText": "Please add this to the change log.", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442922406", "createdAt": "2020-06-19T16:00:29Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -92,6 +92,12 @@ spec:\n             valueFrom:\n               fieldRef:\n                 fieldPath: metadata.name\n+          {{- else if $isSingleMaster }}\n+          env:\n+          - name: ALLUXIO_MASTER_HOSTNAME\n+            valueFrom:\n+              fieldRef:\n+                fieldPath: status.podIP", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjI5Mjc2", "url": "https://github.com/Alluxio/alluxio/pull/11593#pullrequestreview-434229276", "createdAt": "2020-06-19T17:11:08Z", "commit": {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4347, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}