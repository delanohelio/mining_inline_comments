{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMDg1NTM2", "number": 12283, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1NzoyNFrOEtTi6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1NzoyNFrOEtTi6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1OTQxNjEwOnYy", "diffSide": "RIGHT", "path": "integration/emr/alluxio-emr.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1NzoyNFrOHhBTFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzo1OTo1MFrOHhBVVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM4NjMyNA==", "bodyText": "that's complicated hahaha @yuzhu does 5.28 support?", "url": "https://github.com/Alluxio/alluxio/pull/12283#discussion_r504386324", "createdAt": "2020-10-14T03:57:24Z", "author": {"login": "LuQQiu"}, "path": "integration/emr/alluxio-emr.sh", "diffHunk": "@@ -662,19 +662,26 @@ IN\n   # set user provided properties\n   set_custom_alluxio_properties \"${delimited_properties}\"\n \n-  # Create a symbolic link in presto plugin directory pointing to our connector if alluxio version is above 2.2\n-  for plugindir in \"${ALLUXIO_HOME}\"/client/presto/plugins/prestodb*; do\n-    # guard against using an older version by checking for alluxio connector's existence\n-    if [ -d \"$plugindir\" ]; then\n-      doas alluxio \"ln -s $plugindir ${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\"\n-      sudo ln -s \"${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\" /usr/lib/presto/plugin/hive-alluxio\n-      sudo mkdir -p /etc/presto/conf/catalog\n-      echo \"connector.name=hive-alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore=alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore.alluxio.master.address=${master}:19998\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      break\n-    fi\n-  done\n+  # Create a symbolic link in presto plugin directory pointing to our connector if:\n+  # - emr version is >= 5.28 -> prestodb >= 0.227\n+  # - alluxio version is above 2.2\n+  local -r emr_version=$(jq \".releaseLabel\" /mnt/var/lib/info/extraInstanceData.json  | sed -e 's/^\"emr-//' -e 's/\"$//')\n+  local -r emr_major=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\1/')\n+  local -r emr_minor=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\2/')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM4NjkwMw==", "bodyText": "yes", "url": "https://github.com/Alluxio/alluxio/pull/12283#discussion_r504386903", "createdAt": "2020-10-14T03:59:50Z", "author": {"login": "yuzhu"}, "path": "integration/emr/alluxio-emr.sh", "diffHunk": "@@ -662,19 +662,26 @@ IN\n   # set user provided properties\n   set_custom_alluxio_properties \"${delimited_properties}\"\n \n-  # Create a symbolic link in presto plugin directory pointing to our connector if alluxio version is above 2.2\n-  for plugindir in \"${ALLUXIO_HOME}\"/client/presto/plugins/prestodb*; do\n-    # guard against using an older version by checking for alluxio connector's existence\n-    if [ -d \"$plugindir\" ]; then\n-      doas alluxio \"ln -s $plugindir ${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\"\n-      sudo ln -s \"${ALLUXIO_HOME}/client/presto/plugins/prestodb_connector\" /usr/lib/presto/plugin/hive-alluxio\n-      sudo mkdir -p /etc/presto/conf/catalog\n-      echo \"connector.name=hive-alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore=alluxio\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      echo \"hive.metastore.alluxio.master.address=${master}:19998\" | sudo tee -a /etc/presto/conf/catalog/catalog_alluxio.properties\n-      break\n-    fi\n-  done\n+  # Create a symbolic link in presto plugin directory pointing to our connector if:\n+  # - emr version is >= 5.28 -> prestodb >= 0.227\n+  # - alluxio version is above 2.2\n+  local -r emr_version=$(jq \".releaseLabel\" /mnt/var/lib/info/extraInstanceData.json  | sed -e 's/^\"emr-//' -e 's/\"$//')\n+  local -r emr_major=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\1/')\n+  local -r emr_minor=$(echo \"${emr_version}\" | sed -s 's/\\([[:digit:]]\\+\\)\\.\\([[:digit:]]\\+\\)\\.[[:digit:]]\\+/\\2/')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM4NjMyNA=="}, "originalCommit": {"oid": "200d4aeb2ff2de0acd4de531b605a2c008db5d19"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1148, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}