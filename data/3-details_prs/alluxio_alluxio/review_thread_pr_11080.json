{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDQxNzk2", "number": 11080, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo0NjoyN1rODlhWCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NDowMlrODmFIiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjcwMjE3OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/alluxio-fuse.yaml.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo0NjoyN1rOFydjtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo0NjoyN1rOFydjtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1NzM5Ng==", "bodyText": "the sooner we move this out to another repository the better", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388457396", "createdAt": "2020-03-05T17:46:27Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/alluxio-fuse.yaml.template", "diffHunk": "@@ -17,23 +17,23 @@ metadata:\n   name: alluxio-fuse\n   labels:\n     app: alluxio\n-    chart: alluxio-0.5.5\n+    chart: alluxio-0.5.6\n     release: alluxio\n     heritage: Tiller\n     role: alluxio-fuse\n spec:\n   selector:\n     matchLabels:\n       app: alluxio\n-      chart: alluxio-0.5.5\n+      chart: alluxio-0.5.6\n       release: alluxio\n       heritage: Tiller\n       role: alluxio-fuse\n   template:\n     metadata:\n       labels:\n         app: alluxio\n-        chart: alluxio-0.5.5\n+        chart: alluxio-0.5.6", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjcxMDY2OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo0OTowOFrOFydpBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjo1NDo1MVrOFy3vtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1ODc1OQ==", "bodyText": "What's the difference between readiness and liveness probes?\nCorrect me if I'm wrong, but from my interpretation\n\nreadiness is \"ready to serve\". Can be done via RPC.\nliveness is \"is the process/service up, but not necessarily ready to serve clients\". I don't think we have a good check for this.\n\nIt just seems odd we seem to be doing the same thing for two different probes", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388458759", "createdAt": "2020-03-05T17:49:08Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg4NjQ1Mg==", "bodyText": "You are right on readiness.\nFor liveness I think it's \"is the process/service up, but not necessarily ready to serve clients\" plus \"if it's not alive it can/should possibly be restarted, trying to recover\". If a liveness probe fails (for a specific number of times), K8s will restart it. That's why I think fsadmin report is not a good liveness probe, because oftentimes it's not a recoverable state.", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388886452", "createdAt": "2020-03-06T12:54:51Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1ODc1OQ=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjcxNzA2OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzo1MTowMVrOFydtEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NzowN1rOFzT9Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTc5Mw==", "bodyText": "Where exactly are these being executed from? Right now it assumed ${ALLUXIO_HOME} but is that always the case?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388459793", "createdAt": "2020-03-05T17:51:01Z", "author": {"login": "ZacBlanco"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+  initialDelaySeconds: 15\n+  periodSeconds: 30\n+  timeoutSeconds: 5\n+  failureThreshold: 2\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg4ODQ1Nw==", "bodyText": "It's from the working dir which is specified by WORKDIR /opt/alluxio in the docker file.\nActually maybe it's better be command: [\"${ALLUXIO_HOME}/bin/alluxio-monitor.sh\", \"worker\"]", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r388888457", "createdAt": "2020-03-06T12:59:34Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+  initialDelaySeconds: 15\n+  periodSeconds: 30\n+  timeoutSeconds: 5\n+  failureThreshold: 2\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTc5Mw=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODY1NA==", "bodyText": "you can use the command as alluxio-monitor.sh directly as in the docker file we add bin to the path ENV PATH=\"/opt/alluxio/bin:${PATH}\"", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348654", "createdAt": "2020-03-08T08:47:07Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -238,3 +238,35 @@ resources:\n             defaultMode: 256\n   {{- end }}\n {{- end -}}\n+\n+{{- define \"alluxio.master.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.readinessProbe\" -}}\n+readinessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]\n+{{- end -}}\n+\n+{{- define \"alluxio.master.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"master\"]\n+  initialDelaySeconds: 15\n+  periodSeconds: 30\n+  timeoutSeconds: 5\n+  failureThreshold: 2\n+{{- end -}}\n+\n+{{- define \"alluxio.worker.livenessProbe\" -}}\n+livenessProbe:\n+  exec:\n+    command: [\"bin/alluxio-monitor.sh\", \"worker\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1OTc5Mw=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMjU2NTU3OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0MzozOVrOFzT8JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxNzo1NjoyMlrOFzWkWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODM4OA==", "bodyText": "why is this not the job worker probe?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348388", "createdAt": "2020-03-08T08:43:39Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "diffHunk": "@@ -121,6 +123,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ template \"alluxio.fullname\" . }}-config\n+{{ include \"alluxio.worker.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1NjI5MA==", "bodyText": "I think the criteria for readiness is the same for worker and job-worker now so i chose to use the same probes for them both. And thus the \"worker\" has the same meaning with the directory \"worker/\", meaning the worker pod.\nI can of course define the probes for worker and job-worker separately. But I don't think what we use for the probe will change, at least in the near future? What do you think? @madanadit", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389356290", "createdAt": "2020-03-08T10:36:38Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "diffHunk": "@@ -121,6 +123,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ template \"alluxio.fullname\" . }}-config\n+{{ include \"alluxio.worker.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODM4OA=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM4MzI0Mg==", "bodyText": "@jiacheliu3 I don't get it. why is the criteria the same? the readiness / liveness probe is a per container concept not per pod. the probe for job worker should use alluxio-monitor.sh with arg job_worker to ping the job worker rpc?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389383242", "createdAt": "2020-03-08T16:09:50Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "diffHunk": "@@ -121,6 +123,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ template \"alluxio.fullname\" . }}-config\n+{{ include \"alluxio.worker.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODM4OA=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM5MTQ0OA==", "bodyText": "Sorry I was mistaken. The probes should be different for worker and job-worker, namely alluxio-monitor.sh worker and alluxio-monitor.sh job_worker. This has been corrected.", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389391448", "createdAt": "2020-03-08T17:56:22Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/worker/daemonset.yaml", "diffHunk": "@@ -121,6 +123,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ template \"alluxio.fullname\" . }}-config\n+{{ include \"alluxio.worker.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODM4OA=="}, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMjU2NTg3OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NDowMlrOFzT8SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODo0NDowMlrOFzT8SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0ODQyNQ==", "bodyText": "why is this not the job master probe?", "url": "https://github.com/Alluxio/alluxio/pull/11080#discussion_r389348425", "createdAt": "2020-03-08T08:44:02Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -150,6 +152,8 @@ spec:\n           envFrom:\n           - configMapRef:\n               name: {{ $fullName }}-config\n+{{ include \"alluxio.master.readinessProbe\" . | indent 10 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601e05de6ff658ee4d0a1d5f6f9db0ee5b64ffb8"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1890, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}