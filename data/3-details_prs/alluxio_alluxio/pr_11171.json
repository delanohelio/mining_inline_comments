{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NjkwMTE0", "number": 11171, "title": "Support PVC for worker tiered store in K8s", "bodyText": "This resolves worker tiered storage using PVC, as point 4 in #10253\nThe PVC will be satisfied by either hostPath or local under the hood to provide local storage to the worker.", "createdAt": "2020-03-15T12:36:27Z", "url": "https://github.com/Alluxio/alluxio/pull/11171", "merged": true, "mergeCommit": {"oid": "988059fa3b815af34b1cad93eb8fe2aee5a4cc0f"}, "closed": true, "closedAt": "2020-03-17T20:01:11Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcN4uhqAH2gAyMzg4NjkwMTE0OmE5NjNhNWQyNDk5ZmI1OGJhODlkOGZmM2E2ZDNjNTZjODYwYzIwMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOfgNyAH2gAyMzg4NjkwMTE0OmEwOGM5ZTY0ZmEyZmIwNDhiNmFmMWIyOGEyMTI2ZDcyZjJiODM1Zjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a963a5d2499fb58ba89d8ff3a6d3c56c860c2036", "committedDate": "2020-03-15T12:32:36Z", "message": "support PVC for tiered store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzk1NTI2", "url": "https://github.com/Alluxio/alluxio/pull/11171#pullrequestreview-374795526", "createdAt": "2020-03-15T12:36:46Z", "commit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNjo0NlrOF2eqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNjo0NlrOF2eqIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTcyOA==", "bodyText": "Better indentation", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669728", "createdAt": "2020-03-15T12:36:46Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -160,17 +160,18 @@ resources:\n {{- define \"alluxio.worker.tieredstoreVolumeMounts\" -}}\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n+      {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n       {{- if .mediumtype }}\n+        {{- /* Mount each part */}}\n         {{- if contains \",\" .mediumtype }}\n-{{- $type := .type }}\n-{{- $path := .path }}\n-{{- $split := split \",\" .mediumtype }}\n+          {{- $type := .type }}\n+          {{- $path := .path }}\n+          {{- $split := split \",\" .mediumtype }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzk1NTgz", "url": "https://github.com/Alluxio/alluxio/pull/11171#pullrequestreview-374795583", "createdAt": "2020-03-15T12:37:33Z", "commit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNzozNFrOF2eqSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozNzozNFrOF2eqSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTc2OA==", "bodyText": "This is a bug. Before only hostPath is added to Volume mounts when the mediumtype has multiple parts.", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669768", "createdAt": "2020-03-15T12:37:34Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -160,17 +160,18 @@ resources:\n {{- define \"alluxio.worker.tieredstoreVolumeMounts\" -}}\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n+      {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n       {{- if .mediumtype }}\n+        {{- /* Mount each part */}}\n         {{- if contains \",\" .mediumtype }}\n-{{- $type := .type }}\n-{{- $path := .path }}\n-{{- $split := split \",\" .mediumtype }}\n+          {{- $type := .type }}\n+          {{- $path := .path }}\n+          {{- $split := split \",\" .mediumtype }}\n           {{- range $key, $val := $split }}\n-            {{- if eq $type \"hostPath\"}}\n-            - mountPath:  {{ index ($path | split \",\") $key }}\n-              name: {{ $val | lower }}-{{ $key | replace \"_\" \"\" }}\n-            {{- end}}\n+            - mountPath: {{ index ($path | split \",\") $key }}\n+              name: {{ $val | lower }}-{{ replace $key \"_\" \"\" }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzk1NjI4", "url": "https://github.com/Alluxio/alluxio/pull/11171#pullrequestreview-374795628", "createdAt": "2020-03-15T12:38:10Z", "commit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozODoxMFrOF2eqeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjozODoxMFrOF2eqeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTgxOA==", "bodyText": "Added a few examples here", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392669818", "createdAt": "2020-03-15T12:38:10Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd\n+#    path: /dev/ssd\n+#    quota: 10G\n+#\n+# multi-part mediumtype example\n+#  - level: 1\n+#    mediumtype: SSD,HDD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd,alluxio-hdd\n+#    path: /dev/ssd,/dev/hdd\n+#    quota: 10G,10G", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODMxMjg5", "url": "https://github.com/Alluxio/alluxio/pull/11171#pullrequestreview-374831289", "createdAt": "2020-03-15T20:33:03Z", "commit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDozMzowM1rOF2hG8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMDo1Nzo0MFrOF2hPAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwOTg3NQ==", "bodyText": "nit: add comment with example of what mediumName resolves to", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392709875", "createdAt": "2020-03-15T20:33:03Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -191,33 +192,47 @@ resources:\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n       {{- if .mediumtype }}\n+        {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n         {{- if contains \",\" .mediumtype }}\n           {{- $split := split \",\" .mediumtype }}\n           {{- $type := .type }}\n           {{- $path := .path }}\n+          {{- $volumeName := .name }}\n+          {{- /* A volume will be generated for each part */}}\n           {{- range $key, $val := $split }}\n+            {{- $mediumName := printf \"%v-%v\" (lower $val) (replace $key \"_\" \"\") }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMDQ4Mw==", "bodyText": "nit: add comment with example of what claimName resolves to", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392710483", "createdAt": "2020-03-15T20:40:07Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -191,33 +192,47 @@ resources:\n   {{- if .Values.tieredstore.levels }}\n     {{- range .Values.tieredstore.levels }}\n       {{- if .mediumtype }}\n+        {{- /* The mediumtype can have multiple parts like MEM,SSD */}}\n         {{- if contains \",\" .mediumtype }}\n           {{- $split := split \",\" .mediumtype }}\n           {{- $type := .type }}\n           {{- $path := .path }}\n+          {{- $volumeName := .name }}\n+          {{- /* A volume will be generated for each part */}}\n           {{- range $key, $val := $split }}\n+            {{- $mediumName := printf \"%v-%v\" (lower $val) (replace $key \"_\" \"\") }}\n             {{- if eq $type \"hostPath\"}}\n         - hostPath:\n             path: {{ index ($path | split \",\") $key }}\n             type: DirectoryOrCreate\n-          name: {{ $val | lower }}-{{ $key | replace \"_\" \"\" }}\n+          name: {{ $mediumName }}\n+            {{- else if eq $type \"persistentVolumeClaim\" }}\n+        - name: {{ $mediumName }}\n+          persistentVolumeClaim:\n+            claimName: {{ index ($volumeName | split \",\") $key }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMTgzNA==", "bodyText": "@jiacheliu3 please also update the docs section \"Example: Alluxio Storage Management\"", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392711834", "createdAt": "2020-03-15T20:56:12Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd\n+#    path: /dev/ssd\n+#    quota: 10G\n+#\n+# multi-part mediumtype example\n+#  - level: 1\n+#    mediumtype: SSD,HDD\n+#    type: persistentVolumeClaim\n+#    name: alluxio-ssd,alluxio-hdd\n+#    path: /dev/ssd,/dev/hdd\n+#    quota: 10G,10G", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2OTgxOA=="}, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcxMTkzOQ==", "bodyText": "is mediumtype MEM possible with pv? If not please explicitly state that in the doc page and why", "url": "https://github.com/Alluxio/alluxio/pull/11171#discussion_r392711939", "createdAt": "2020-03-15T20:57:40Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -131,6 +131,35 @@ journal:\n ## Worker ##\n \n # Tiered Storage\n+# emptyDir example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: emptyDir\n+#    quota: 1G\n+#\n+# hostPath example\n+#  - level: 0\n+#    mediumtype: MEM\n+#    path: /dev/shm\n+#    type: hostPath\n+#    quota: 1G\n+#\n+# persistentVolumeClaim example\n+#  - level: 1\n+#    mediumtype: SSD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a963a5d2499fb58ba89d8ff3a6d3c56c860c2036"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9542257b9d25b376599c4dcd80b963c31801051", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/e9542257b9d25b376599c4dcd80b963c31801051", "committedDate": "2020-03-17T09:05:40Z", "message": "update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a08c9e64fa2fb048b6af1b28a2126d72f2b835f9", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/a08c9e64fa2fb048b6af1b28a2126d72f2b835f9", "committedDate": "2020-03-17T09:43:16Z", "message": "resolve comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4665, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}