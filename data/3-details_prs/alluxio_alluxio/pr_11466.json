{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxODIzODU3", "number": 11466, "title": "Return stats from each block management task", "bodyText": "This PR lays out the essential infrastructure for each management task to return stats in terms of how many block operations are executed/failed/backed-off.", "createdAt": "2020-05-22T09:46:02Z", "url": "https://github.com/Alluxio/alluxio/pull/11466", "merged": true, "mergeCommit": {"oid": "2b48214ebd10dc62aeda3c0c8baf19707410f9fc"}, "closed": true, "closedAt": "2020-05-27T16:43:48Z", "author": {"login": "ggezer"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjvDtIgH2gAyNDIxODIzODU3OjA2MGNhYTEzOTMwYjY5YWY2OTdjZGI1N2Q4NDExMGJmMjlkMThhNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclcEfyAFqTQxOTQxNTY0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55", "author": {"user": {"login": "ggezer", "name": "G\u00f6kt\u00fcrk Gezer"}}, "url": "https://github.com/Alluxio/alluxio/commit/060caa13930b69af697cdb57d84110bf29d18a55", "committedDate": "2020-05-22T09:43:01Z", "message": "Return a report from each management task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2ODA3NTQw", "url": "https://github.com/Alluxio/alluxio/pull/11466#pullrequestreview-416807540", "createdAt": "2020-05-22T10:26:02Z", "commit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxMDoyNjowM1rOGZST4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxMDoyNjowM1rOGZST4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2NzU4Ng==", "bodyText": "@calvinjia\nWhat do you think about making this log INFO level?\nIt would only print when a management task actually ran.\nAt the worst this would print every 10 seconds when;\n\nBackoffStrategy is DIRECTORY\nTiers don't align\nAlignTask can't make progress (due to failures or heavy load)\n\nI prefer this over crafting an admin report because the latter can't provide information for a full range without persistence at worker/master. I think this would be sufficient until at least we stabilize worker management infra.", "url": "https://github.com/Alluxio/alluxio/pull/11466#discussion_r429167586", "createdAt": "2020-05-22T10:26:03Z", "author": {"login": "ggezer"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/management/ManagementTaskCoordinator.java", "diffHunk": "@@ -181,12 +181,19 @@ private void runManagement() {\n         LOG.debug(\"Running task of type:{}\", currentTask.getClass().getSimpleName());\n         // Run the current task on coordinator thread.\n         try {\n-          currentTask.run();\n+          BlockManagementTaskResult result = currentTask.run();\n+          LOG.debug(\"Management task: {} finished with result: {}\",\n+              currentTask.getClass().getSimpleName(), result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTg3NzQ1", "url": "https://github.com/Alluxio/alluxio/pull/11466#pullrequestreview-417187745", "createdAt": "2020-05-22T21:19:25Z", "commit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMToxOToyNVrOGZj3TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMToyNDoxMVrOGZj8Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ1NTE4MQ==", "bodyText": "Use a map here?", "url": "https://github.com/Alluxio/alluxio/pull/11466#discussion_r429455181", "createdAt": "2020-05-22T21:19:25Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/management/BlockManagementTaskResult.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.worker.block.management;\n+\n+import com.google.common.base.MoreObjects;\n+\n+import java.util.Hashtable;\n+import java.util.Map;\n+\n+/**\n+ * Holds results of a {@link BlockManagementTask}.\n+ *\n+ * It contains sub-results for each {@link BlockOperationType} that is issued\n+ * by the magement task.\n+ */\n+public class BlockManagementTaskResult {\n+  /** Map of block-operation results. */\n+  private Hashtable<BlockOperationType, BlockOperationResult> mBlockOpResults;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ1NTI4NA==", "bodyText": "Add @NotThreadSafe?", "url": "https://github.com/Alluxio/alluxio/pull/11466#discussion_r429455284", "createdAt": "2020-05-22T21:19:52Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/management/BlockManagementTaskResult.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.worker.block.management;\n+\n+import com.google.common.base.MoreObjects;\n+\n+import java.util.Hashtable;\n+import java.util.Map;\n+\n+/**\n+ * Holds results of a {@link BlockManagementTask}.\n+ *\n+ * It contains sub-results for each {@link BlockOperationType} that is issued\n+ * by the magement task.\n+ */\n+public class BlockManagementTaskResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ1NjQwNg==", "bodyText": "I think that's fine, we can also add a template to raise the log level of this class if it is too noisy.", "url": "https://github.com/Alluxio/alluxio/pull/11466#discussion_r429456406", "createdAt": "2020-05-22T21:24:11Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/management/ManagementTaskCoordinator.java", "diffHunk": "@@ -181,12 +181,19 @@ private void runManagement() {\n         LOG.debug(\"Running task of type:{}\", currentTask.getClass().getSimpleName());\n         // Run the current task on coordinator thread.\n         try {\n-          currentTask.run();\n+          BlockManagementTaskResult result = currentTask.run();\n+          LOG.debug(\"Management task: {} finished with result: {}\",\n+              currentTask.getClass().getSimpleName(), result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2NzU4Ng=="}, "originalCommit": {"oid": "060caa13930b69af697cdb57d84110bf29d18a55"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9fe6b35f869ca6a64799845bdcca54906b91d41", "author": {"user": {"login": "ggezer", "name": "G\u00f6kt\u00fcrk Gezer"}}, "url": "https://github.com/Alluxio/alluxio/commit/b9fe6b35f869ca6a64799845bdcca54906b91d41", "committedDate": "2020-05-23T09:58:40Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494cc56c6b090f4e3b704582266a6160d71550f2", "author": {"user": {"login": "ggezer", "name": "G\u00f6kt\u00fcrk Gezer"}}, "url": "https://github.com/Alluxio/alluxio/commit/494cc56c6b090f4e3b704582266a6160d71550f2", "committedDate": "2020-05-24T01:01:54Z", "message": "Merge branch 'master' into tm-job-stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjM2NTUz", "url": "https://github.com/Alluxio/alluxio/pull/11466#pullrequestreview-418636553", "createdAt": "2020-05-26T20:00:52Z", "commit": {"oid": "494cc56c6b090f4e3b704582266a6160d71550f2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDowMDo1MlrOGauSKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDowMDo1MlrOGauSKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3NDQ3Mw==", "bodyText": "Any reason we want to use HashTable here?", "url": "https://github.com/Alluxio/alluxio/pull/11466#discussion_r430674473", "createdAt": "2020-05-26T20:00:52Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/block/management/BlockManagementTaskResult.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.worker.block.management;\n+\n+import com.google.common.base.MoreObjects;\n+import net.jcip.annotations.NotThreadSafe;\n+\n+import java.util.Hashtable;\n+import java.util.Map;\n+\n+/**\n+ * Holds results of a {@link BlockManagementTask}.\n+ *\n+ * It contains sub-results for each {@link BlockOperationType} that is issued\n+ * by the magement task.\n+ */\n+@NotThreadSafe\n+public class BlockManagementTaskResult {\n+  /** Map of block-operation results. */\n+  private Map<BlockOperationType, BlockOperationResult> mBlockOpResults;\n+\n+  /**\n+   * Creates a new empty task result.\n+   */\n+  public BlockManagementTaskResult() {\n+    mBlockOpResults = new Hashtable<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "494cc56c6b090f4e3b704582266a6160d71550f2"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "719d373c17879c3096cdcb4fde3d09c1c777566e", "author": {"user": {"login": "ggezer", "name": "G\u00f6kt\u00fcrk Gezer"}}, "url": "https://github.com/Alluxio/alluxio/commit/719d373c17879c3096cdcb4fde3d09c1c777566e", "committedDate": "2020-05-26T21:58:20Z", "message": "Fix auto-complete accident"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDE1NjQ2", "url": "https://github.com/Alluxio/alluxio/pull/11466#pullrequestreview-419415646", "createdAt": "2020-05-27T16:43:32Z", "commit": {"oid": "719d373c17879c3096cdcb4fde3d09c1c777566e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4420, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}