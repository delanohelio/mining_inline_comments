{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTI3NTk5", "number": 12670, "title": "Disable authority check", "bodyText": "This change offers an option to make the Alluxio client NOT throw an exception when the given AlluxioURI is incorrect. Rather, it finds the correct cluster address from the configuration and connects correctly.\nSome client has some stale code invoking Alluxio like this:\n// The cluster just gone through an upgrade, the master address changed\n// master1:19998 -> master1:19998,master2:19998,master3:19998\nFileSystem fs = FileSystem.Factory.get();\n// This path is hard coded in the code\nAlluxioURI path = new AlluxioURI(\"alluxio://master1:19998/path\");\n// This fails because of BaseFileSystem.checkUri()\nfs.listStatus(path);\n\nIt's very hard to dig all the client code and update them one by one. In the upgrade, the design intention is, the admin configures this alluxio.user.skip.authority.check=true on all nodes in the cluster, then the client code will not throw an error.\nThis property enables users to do below:\n# The admin updates the configuration\n$ cat /opt/alluxio/conf/alluxio-site.properties\nalluxio.master.rpc.addresses=masters-1:19998,masters-2:19998,masters-3:19998\nalluxio.user.skip.authority.check=true\n\n# The user runs legacy code, the stale URL is ignored without throwing exception, connecting to the real cluster address\nscala> import alluxio.client._\nimport alluxio.client._\nscala> val fs = alluxio.client.file.FileSystem.Factory.get()\nfs: alluxio.client.file.FileSystem = alluxio.client.file.FileSystemCache$InstanceCachingFileSystem@653a5a\nscala> import alluxio.AlluxioURI\nimport alluxio.AlluxioURI\n// wrong_address:1234 is ignored\nscala> val uri = new alluxio.AlluxioURI(\u201calluxio://wrong_address:1234/default_tests_files\u201d)\nuri: alluxio.AlluxioURI = alluxio://zk:19998/default_tests_files\nscala> fs.listStatus(uri)\nres0: java.util.List[alluxio.client.file.URIStatus] = [FileInfo{fileId=16995319807, fileIdentifier=null, name=BASIC_NON_BYTE_BUFFER_CACHE_CACHE_THROUGH, path=/default_tests_files/BASIC_NON_BYTE_BUFFER_CACHE_CACHE_THROUGH, ufsPath=/tmp/alluxioB/underFSStorage/default_tests_files/BASIC_NON_BYTE_BUFFER_CACHE_CACHE_THROUGH, length=84, blockSizeBytes=67108864, creationTimeMs=1608692450270, completed=true, folder=false, pinned=false, pinnedlocation=[], cacheable=true, persisted=true, blockIds=[16978542592], inMemoryPercentage=100, lastModificationTimesMs=1608692450291, ttl=-1, lastAccessTimesMs=1608692450291, ttlAction=DELETE, owner=ec2-user, group=ec2-user, mode=420, persistenceState=PERSISTED, mountPoint=false, replicationMax=-1, replicationMin=0, fileBlockInfos=[FileBlockInfo{blockInfo=Blo...", "createdAt": "2020-12-22T13:35:22Z", "url": "https://github.com/Alluxio/alluxio/pull/12670", "merged": true, "mergeCommit": {"oid": "0a745ccd8ba2f2efada9e6dd1a48d0afe65eee7c"}, "closed": true, "closedAt": "2020-12-23T05:20:58Z", "author": {"login": "jiacheliu3"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoqmxVAH2gAyNTQ0MTI3NTk5OmMzYTExZTkwM2VkZDU5ZmY1YjQ5NWViOTUyMTdmOTFiYjJhZmU5MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdo3E7XAFqTU1NzU1OTYxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c3a11e903edd59ff5b495eb95217f91bb2afe934", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/c3a11e903edd59ff5b495eb95217f91bb2afe934", "committedDate": "2020-12-22T13:32:34Z", "message": "disable authority check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6c67f125dec530e58522cb44d1044ca9c4e353d", "author": {"user": {"login": "jiacheliu3", "name": "Jiacheng Liu"}}, "url": "https://github.com/Alluxio/alluxio/commit/e6c67f125dec530e58522cb44d1044ca9c4e353d", "committedDate": "2020-12-22T14:57:25Z", "message": "fix format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NTUzNTM3", "url": "https://github.com/Alluxio/alluxio/pull/12670#pullrequestreview-557553537", "createdAt": "2020-12-23T04:00:33Z", "commit": {"oid": "e6c67f125dec530e58522cb44d1044ca9c4e353d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNDowMDozM1rOIKQfGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNDowMDozM1rOIKQfGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzYyNjc3Nw==", "bodyText": "I believe this property is better made hidden, to avoid confusing. This should ONLY be used to work around thorny legacy code that is too hard to update the URL. This should be used sparingly only under our recommendation.", "url": "https://github.com/Alluxio/alluxio/pull/12670#discussion_r547626777", "createdAt": "2020-12-23T04:00:33Z", "author": {"login": "jiacheliu3"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3922,6 +3922,21 @@ public String toString() {\n               + \"aggregated, so different applications must set their own ids or leave this value \"\n               + \"unset to use a randomly generated id.\")\n           .build();\n+  public static final PropertyKey USER_SKIP_AUTHORITY_CHECK =\n+      new Builder(Name.USER_SKIP_AUTHORITY_CHECK)\n+          .setScope(Scope.CLIENT)\n+          .setDefaultValue(false)\n+          .setIsHidden(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6c67f125dec530e58522cb44d1044ca9c4e353d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NTU5NjE2", "url": "https://github.com/Alluxio/alluxio/pull/12670#pullrequestreview-557559616", "createdAt": "2020-12-23T04:04:22Z", "commit": {"oid": "e6c67f125dec530e58522cb44d1044ca9c4e353d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3377, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}