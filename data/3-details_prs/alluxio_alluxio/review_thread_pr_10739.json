{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMzk2MjY5", "number": 10739, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMToxOTo1M1rODXtSNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoyMVrODX_n-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MTg1NzgzOnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMToxOTo1M1rOFdJsqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMTo1NDoxMVrOFdKKNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMTkxNQ==", "bodyText": "Do you think we should list out the different options this can be configured with?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366111915", "createdAt": "2020-01-14T01:19:53Z", "author": {"login": "ZacBlanco"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,9 +3368,9 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =\n+      new Builder(Name.USER_FILESYSTEM_CLASS)\n+          .setDefaultValue(\"alluxio.client.file.BaseFileSystem\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExOTQ3Nw==", "bodyText": "Good catch, I forgot the change the description.", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366119477", "createdAt": "2020-01-14T01:54:11Z", "author": {"login": "calvinjia"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,9 +3368,9 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =\n+      new Builder(Name.USER_FILESYSTEM_CLASS)\n+          .setDefaultValue(\"alluxio.client.file.BaseFileSystem\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMTkxNQ=="}, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MTg2NzczOnYy", "diffSide": "RIGHT", "path": "core/client/fs/src/main/java/alluxio/client/file/FileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMToyNToyNVrOFdJyIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMTo1Mzo1MFrOFdKJ7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMzMxMw==", "bodyText": "I'm not a huge fan of creating the classes this way because it creates an implicit rather than explicit contract on all implementations to use the exact same constructor. I don't think it's the best approach.\nBecause we don't have many FS implementations I think I'm okay leaving it for now, but we might want to consider a factory-based pattern or something similar if we end up extending this more in the future.", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366113313", "createdAt": "2020-01-14T01:25:25Z", "author": {"login": "ZacBlanco"}, "path": "core/client/fs/src/main/java/alluxio/client/file/FileSystem.java", "diffHunk": "@@ -148,10 +149,10 @@ private static FileSystem create(FileSystemContext context, boolean cachingEnabl\n           LOG.debug(\"{}={} ({})\", key.getName(), value, source);\n         }\n       }\n-      if (context.getClusterConf().getBoolean(PropertyKey.USER_METADATA_CACHE_ENABLED)) {\n-        return new CachingFileSystem(context, cachingEnabled);\n-      }\n-      return BaseFileSystem.create(context, cachingEnabled);\n+      Class fsClass = context.getClusterConf().getClass(PropertyKey.USER_FILESYSTEM_CLASS);\n+      Class[] ctorArgClasses = new Class[] {FileSystemContext.class, boolean.class};\n+      Object[] ctorArgs = new Object[] {context, cachingEnabled};\n+      return (FileSystem) CommonUtils.createNewClassInstance(fsClass, ctorArgClasses, ctorArgs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExOTQwNQ==", "bodyText": "I agree, even in our current code we don't have a standard way of creating the file system", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366119405", "createdAt": "2020-01-14T01:53:50Z", "author": {"login": "calvinjia"}, "path": "core/client/fs/src/main/java/alluxio/client/file/FileSystem.java", "diffHunk": "@@ -148,10 +149,10 @@ private static FileSystem create(FileSystemContext context, boolean cachingEnabl\n           LOG.debug(\"{}={} ({})\", key.getName(), value, source);\n         }\n       }\n-      if (context.getClusterConf().getBoolean(PropertyKey.USER_METADATA_CACHE_ENABLED)) {\n-        return new CachingFileSystem(context, cachingEnabled);\n-      }\n-      return BaseFileSystem.create(context, cachingEnabled);\n+      Class fsClass = context.getClusterConf().getClass(PropertyKey.USER_FILESYSTEM_CLASS);\n+      Class[] ctorArgClasses = new Class[] {FileSystemContext.class, boolean.class};\n+      Object[] ctorArgs = new Object[] {context, cachingEnabled};\n+      return (FileSystem) CommonUtils.createNewClassInstance(fsClass, ctorArgClasses, ctorArgs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjExMzMxMw=="}, "originalCommit": {"oid": "ef946d8af275e22948c50a6d722612aee85a8ae2"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjA3NDY2OnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo0NVrOFdLvbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxOToyMDoxNlrOFdi86w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE0NTM5MQ==", "bodyText": "nit: can you put this property in alphabetical order?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366145391", "createdAt": "2020-01-14T04:12:45Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,29 +3368,29 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUyNTY3NQ==", "bodyText": "updated, thanks. There are other keys which are not in order, but I won't address that in this PR.", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366525675", "createdAt": "2020-01-14T19:20:16Z", "author": {"login": "calvinjia"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3368,29 +3368,29 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n+  public static final PropertyKey USER_FILESYSTEM_CLASS =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE0NTM5MQ=="}, "originalCommit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjA3NDc4OnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo1M1rOFdLvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwNDoxMjo1M1rOFdLvfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE0NTQwNw==", "bodyText": "nit: can you put this property in alphabetical order?", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366145407", "createdAt": "2020-01-14T04:12:53Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -4539,8 +4539,7 @@ private static String javadocLink(String fullyQualifiedClassname) {\n         \"alluxio.user.short.circuit.preferred\";\n     public static final String USER_WORKER_LIST_REFRESH_INTERVAL =\n         \"alluxio.user.worker.list.refresh.interval\";\n-    public static final String USER_METADATA_CACHE_ENABLED =\n-        \"alluxio.user.metadata.cache.enabled\";\n+    public static final String USER_FILESYSTEM_CLASS = \"alluxio.user.filesystem.class\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf9502529f167c08a2ab39d57dd0ee56bdeb5626"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDg2MjM4OnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoxNVrOFdmZtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoxNVrOFdmZtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MjE5OA==", "bodyText": "update", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366582198", "createdAt": "2020-01-14T21:30:15Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3152,36 +3169,19 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_LOCAL_CACHE_ENABLED =\n-      new Builder(Name.USER_LOCAL_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, data will be cached on Alluxio client.\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n   public static final PropertyKey USER_METADATA_CACHE_MAX_SIZE =\n       new Builder(Name.USER_METADATA_CACHE_MAX_SIZE)\n           .setDefaultValue(100000)\n-          .setDescription(\"Maximum number of paths with cached metadata.\")\n+          .setDescription(\"Maximum number of paths with cached metadata. Only valid if the \"\n+              + \"filesystem is alluxio.client.file.CachingFileSystem.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDg2MjY3OnYy", "diffSide": "RIGHT", "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoyMVrOFdmZ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTozMDoyMVrOFdmZ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MjI0Mg==", "bodyText": "update", "url": "https://github.com/Alluxio/alluxio/pull/10739#discussion_r366582242", "createdAt": "2020-01-14T21:30:21Z", "author": {"login": "apc999"}, "path": "core/common/src/main/java/alluxio/conf/PropertyKey.java", "diffHunk": "@@ -3152,36 +3169,19 @@ public String toString() {\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n-  public static final PropertyKey USER_LOCAL_CACHE_ENABLED =\n-      new Builder(Name.USER_LOCAL_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, data will be cached on Alluxio client.\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n-  public static final PropertyKey USER_METADATA_CACHE_ENABLED =\n-      new Builder(Name.USER_METADATA_CACHE_ENABLED)\n-          .setDefaultValue(false)\n-          .setDescription(\"If this is enabled, metadata of paths will be cached. \"\n-              + \"The cached metadata will be evicted when it expires after \"\n-              + Name.USER_METADATA_CACHE_EXPIRATION_TIME\n-              + \" or the cache size is over the limit of \"\n-              + Name.USER_METADATA_CACHE_MAX_SIZE + \".\")\n-          .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n-          .setScope(Scope.CLIENT)\n-          .build();\n   public static final PropertyKey USER_METADATA_CACHE_MAX_SIZE =\n       new Builder(Name.USER_METADATA_CACHE_MAX_SIZE)\n           .setDefaultValue(100000)\n-          .setDescription(\"Maximum number of paths with cached metadata.\")\n+          .setDescription(\"Maximum number of paths with cached metadata. Only valid if the \"\n+              + \"filesystem is alluxio.client.file.CachingFileSystem.\")\n           .setConsistencyCheckLevel(ConsistencyCheckLevel.WARN)\n           .setScope(Scope.CLIENT)\n           .build();\n   public static final PropertyKey USER_METADATA_CACHE_EXPIRATION_TIME =\n       new Builder(Name.USER_METADATA_CACHE_EXPIRATION_TIME)\n           .setDefaultValue(\"10min\")\n           .setDescription(\"Metadata will expire and be evicted after being cached for this time \"\n-              + \"period.\")\n+              + \"period. Only valid if the filesystem is alluxio.client.file.CachingFileSystem.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09beea21c9917e61984c09dc6dd8e6283a037c80"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2232, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}