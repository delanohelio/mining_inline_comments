{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MTg2Nzk2", "number": 10813, "title": "Add a script to update versions for releases", "bodyText": "This removes all manual components for a release manager needing to\nupdate versions throughout the codebase. In the future, any part of the\ncodebase which relies on the version be up-to-date should add a\nsection in this script that allows the developer to update the section\nautomatically.", "createdAt": "2020-01-30T17:03:51Z", "url": "https://github.com/Alluxio/alluxio/pull/10813", "merged": true, "mergeCommit": {"oid": "363ecd56cc33c2c7cdeef500d53ece6f667bd007"}, "closed": true, "closedAt": "2020-03-02T21:12:39Z", "author": {"login": "ZacBlanco"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_eYxXAFqTM1MTAxODc1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJz_i3AFqTM2NzUxNDQzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDE4NzU1", "url": "https://github.com/Alluxio/alluxio/pull/10813#pullrequestreview-351018755", "createdAt": "2020-01-30T17:46:57Z", "commit": {"oid": "34bcaa6504d4f3280d99005a3f735be6bcabd19e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNzo0Njo1N1rOFj0EMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNzo1NTo1MVrOFj0VkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA5NzUyMQ==", "bodyText": "NIT: newline at end", "url": "https://github.com/Alluxio/alluxio/pull/10813#discussion_r373097521", "createdAt": "2020-01-30T17:46:57Z", "author": {"login": "gpang"}, "path": "dev/scripts/update-versions.sh", "diffHunk": "@@ -0,0 +1,119 @@\n+#!/usr/bin/env bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# This script is designed so that someone can update all versions for releases\n+# using a single command.\n+\n+# Debugging\n+# set -x\n+set -e # exit if a command fails\n+set -u # unbound variable is an error\n+\n+HELP=$(cat <<EOF\n+Usage: update-version.sh [-s] <old version> <new version>\n+\n+    <old version>    The version to replace throughout the codebase\n+    <new version>    The new version in the codebase\n+\n+    -s               Skips updating maven pom versions. This should mainly be\n+                     used when cutting a final release where pom versions are\n+                     updated by the maven release plugin.\n+\n+\n+EOF\n+)\n+\n+# Arguments:\n+#  $1: old version\n+#  $2: new version\n+function update_poms() {\n+    find . -name pom.xml | xargs -t -n 1 perl -pi -e \"s/${1}/${2}/g\"\n+}\n+\n+# Arguments:\n+#  $1: old version\n+#  $2: new version\n+function update_libexec() {\n+    perl -pi -e \"s/${1}/${2}/g\" libexec/alluxio-config.sh\n+}\n+\n+# Arguments:\n+#  $1: old version\n+#  $2: new version\n+function update_docs() {\n+\n+    local current_branch=\"$(git rev-parse --abbrev-ref HEAD)\"\n+    perl -pi -e \"s/${1}/${2}/g\" docs/_config.yml\n+\n+    if [[ \"${current_branch}\" != \"master\" ]]; then\n+        local major_version_regex=\"([0-9]+\\.[0-9]+)\\.\"\n+        # regex is unquoted on purpose\n+        if [[ \"${2}\" =~ ${major_version_regex} ]]; then\n+            local match=\"${BASH_REMATCH[1]}\"\n+            # .* matches everything after it on that line\n+            perl -pi -e \\\n+            \"s/ALLUXIO_MAJOR_VERSION.*/ALLUXIO_MAJOR_VERSION: ${match}/g\" \\\n+                docs/_config.yml\n+\n+        fi\n+    fi\n+}\n+\n+# Arguments:\n+#  $1: old version\n+#  $2: new version\n+function update_k8s() {\n+    perl -pi -e \"s/${1}/${2}/g\" \\\n+        integration/kubernetes/helm-chart/alluxio/values.yaml\n+    pushd integration/kubernetes\n+    ./helm-generate.sh all\n+    popd\n+}\n+\n+\n+function main() {\n+    local skip_maven=\"false\"\n+\n+    while getopts \"sh\" o; do\n+        case \"${o}\" in\n+            s)\n+                skip_maven=\"true\"\n+                shift\n+                ;;\n+            h)\n+                echo \"${HELP}\"\n+                exit 0\n+                ;;\n+        esac\n+    done\n+\n+    if [[ \"$#\" -lt 2 ]]; then\n+        echo \"Arguments '<old version>' and '<new version>' must be provided.\"\n+        echo \"${HELP}\"\n+        exit 1\n+    fi\n+\n+    local _old=\"${1}\"\n+    local _new=\"${2}\"\n+\n+    if [[ \"${skip_maven}\" == \"false\" ]]; then\n+        update_poms \"$_old\" \"$_new\"\n+    fi\n+\n+    update_libexec \"$_old\" \"$_new\"\n+    update_docs \"$_old\" \"$_new\"\n+    update_k8s \"$_old\" \"$_new\"\n+\n+    exit 0\n+}\n+\n+main \"$@\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34bcaa6504d4f3280d99005a3f735be6bcabd19e"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwMTk2OQ==", "bodyText": "is perl ok to assume? Is that more common than sed?", "url": "https://github.com/Alluxio/alluxio/pull/10813#discussion_r373101969", "createdAt": "2020-01-30T17:55:51Z", "author": {"login": "gpang"}, "path": "dev/scripts/update-versions.sh", "diffHunk": "@@ -0,0 +1,119 @@\n+#!/usr/bin/env bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# This script is designed so that someone can update all versions for releases\n+# using a single command.\n+\n+# Debugging\n+# set -x\n+set -e # exit if a command fails\n+set -u # unbound variable is an error\n+\n+HELP=$(cat <<EOF\n+Usage: update-version.sh [-s] <old version> <new version>\n+\n+    <old version>    The version to replace throughout the codebase\n+    <new version>    The new version in the codebase\n+\n+    -s               Skips updating maven pom versions. This should mainly be\n+                     used when cutting a final release where pom versions are\n+                     updated by the maven release plugin.\n+\n+\n+EOF\n+)\n+\n+# Arguments:\n+#  $1: old version\n+#  $2: new version\n+function update_poms() {\n+    find . -name pom.xml | xargs -t -n 1 perl -pi -e \"s/${1}/${2}/g\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34bcaa6504d4f3280d99005a3f735be6bcabd19e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk2MDk5", "url": "https://github.com/Alluxio/alluxio/pull/10813#pullrequestreview-351796099", "createdAt": "2020-01-31T21:44:51Z", "commit": {"oid": "cefd7303c29266e57b128ac2c2b26475522d2cf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b190b094392a85678bc8c30cac8256990d5b32", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/32b190b094392a85678bc8c30cac8256990d5b32", "committedDate": "2020-02-27T22:06:25Z", "message": "Add a script to update versions for releases\n\nThis removes all manual components for a release manager needing to\nupdate versions throughout the codebase. In the future, any part of the\ncodebase which relies on the version be up-to-date should add a\nsection in this script that allows a user to update the section\nautomatically."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bf4d25d6b5c52fcbb18035704a6ceb8f07ee21f", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/1bf4d25d6b5c52fcbb18035704a6ceb8f07ee21f", "committedDate": "2020-02-27T22:06:26Z", "message": "Add license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90d535d4c0ed208a5c6fcb7d722316a6b9fc695a", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/90d535d4c0ed208a5c6fcb7d722316a6b9fc695a", "committedDate": "2020-02-27T22:06:26Z", "message": "Add newline at EOF"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ec843e3aff2a79f1dfb1281c8f4073d34b67c6", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/53ec843e3aff2a79f1dfb1281c8f4073d34b67c6", "committedDate": "2020-02-27T22:06:27Z", "message": "temp commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8749c32a96c7cbc7551c514510b519878a14c23", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/b8749c32a96c7cbc7551c514510b519878a14c23", "committedDate": "2020-02-27T22:06:28Z", "message": "add dockerfiles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cefd7303c29266e57b128ac2c2b26475522d2cf8", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/cefd7303c29266e57b128ac2c2b26475522d2cf8", "committedDate": "2020-01-30T18:23:00Z", "message": "Add newline at EOF"}, "afterCommit": {"oid": "b8749c32a96c7cbc7551c514510b519878a14c23", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/b8749c32a96c7cbc7551c514510b519878a14c23", "committedDate": "2020-02-27T22:06:28Z", "message": "add dockerfiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjE0Nzc3", "url": "https://github.com/Alluxio/alluxio/pull/10813#pullrequestreview-366614777", "createdAt": "2020-02-28T18:57:17Z", "commit": {"oid": "b8749c32a96c7cbc7551c514510b519878a14c23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxODo1NzoxN1rOFv_adw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxODo1NzoxN1rOFv_adw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg2NjM1OQ==", "bodyText": "can you provide an example version string?", "url": "https://github.com/Alluxio/alluxio/pull/10813#discussion_r385866359", "createdAt": "2020-02-28T18:57:17Z", "author": {"login": "gpang"}, "path": "dev/scripts/update-versions.sh", "diffHunk": "@@ -0,0 +1,125 @@\n+#!/usr/bin/env bash\n+#\n+# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+# (the \"License\"). You may not use this work except in compliance with the License, which is\n+# available at www.apache.org/licenses/LICENSE-2.0\n+#\n+# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+# either express or implied, as more fully set forth in the License.\n+#\n+# See the NOTICE file distributed with this work for information regarding copyright ownership.\n+#\n+\n+# This script is designed so that someone can update all versions for releases\n+# using a single command.\n+\n+# Debugging\n+# set -x\n+set -e # exit if a command fails\n+set -u # unbound variable is an error\n+\n+HELP=$(cat <<EOF\n+Usage: update-version.sh [-s] <old version> <new version>\n+\n+    <old version>    The version to replace throughout the codebase", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8749c32a96c7cbc7551c514510b519878a14c23"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a456351103e37f353b89ad2446f33f0bbb518d", "author": {"user": {"login": "ZacBlanco", "name": "Zac Blanco"}}, "url": "https://github.com/Alluxio/alluxio/commit/27a456351103e37f353b89ad2446f33f0bbb518d", "committedDate": "2020-03-02T19:06:47Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTE0NDM4", "url": "https://github.com/Alluxio/alluxio/pull/10813#pullrequestreview-367514438", "createdAt": "2020-03-02T20:45:58Z", "commit": {"oid": "27a456351103e37f353b89ad2446f33f0bbb518d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3148, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}