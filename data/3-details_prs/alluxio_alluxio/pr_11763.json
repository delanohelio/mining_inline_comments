{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NjEwMzU2", "number": 11763, "title": "Add null checks for glueUDB", "bodyText": "", "createdAt": "2020-07-14T02:51:12Z", "url": "https://github.com/Alluxio/alluxio/pull/11763", "merged": true, "mergeCommit": {"oid": "406ffa156d4b6311b313f33101637cd9fc4c9d54"}, "closed": true, "closedAt": "2020-07-14T17:34:05Z", "author": {"login": "HelloHorizon"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0sqSCgH2gAyNDQ4NjEwMzU2OjM3Nzc3YzI0YzViY2Q2OTljNDYyMjg5YjQwNGE0NjUxODgwMDJkYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc05jtMAFqTQ0ODMxOTczNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37777c24c5bcd699c462289b404a465188002dc5", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/37777c24c5bcd699c462289b404a465188002dc5", "committedDate": "2020-07-14T02:32:09Z", "message": "Add check null for glueDb, fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c0c8a4ab33afb5bb0dd574ff832b39a26184216", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/2c0c8a4ab33afb5bb0dd574ff832b39a26184216", "committedDate": "2020-07-14T02:40:17Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ecab2085a83d8ead5456165ab5f1169baae6ac7", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/0ecab2085a83d8ead5456165ab5f1169baae6ac7", "committedDate": "2020-07-14T02:50:06Z", "message": "Fix style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NzYwMDk0", "url": "https://github.com/Alluxio/alluxio/pull/11763#pullrequestreview-447760094", "createdAt": "2020-07-14T03:31:22Z", "commit": {"oid": "0ecab2085a83d8ead5456165ab5f1169baae6ac7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMzozMToyMlrOGxCsvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMzozNTo0MFrOGxCxIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA3NzYzMA==", "bodyText": "Is this the only use of statsMap? We may be able to just get rid of this variable and here, we could just use Collections.emptyList().", "url": "https://github.com/Alluxio/alluxio/pull/11763#discussion_r454077630", "createdAt": "2020-07-14T03:31:22Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -346,28 +340,29 @@ public UdbTable getTable(String tableName) throws IOException {\n       List<UdbPartition> udbPartitions = new ArrayList<>();\n       if (partitionColumns.isEmpty()) {\n         PartitionInfo.Builder partitionInfoBuilder = PartitionInfo.newBuilder()\n-            .setDbName(getUdbContext().getDbName())\n+            .setDbName(mGlueDbName)\n             .setTableName(tableName)\n             .addAllDataCols(GlueUtils.toProto(table.getStorageDescriptor().getColumns()))\n             .setStorage(GlueUtils.toProto(table.getStorageDescriptor(), pathTranslator))\n             .setPartitionName(tableName)\n-            .putAllParameters(table.getParameters());\n+            .putAllParameters(tableParameters);\n         udbPartitions.add(new GluePartition(\n             new HiveLayout(partitionInfoBuilder.build(), Collections.emptyList())));\n       } else {\n         for (Partition partition : partitions) {\n           String partName = GlueUtils.makePartitionName(partitionColumns, partition.getValues());\n-          PartitionInfo.Builder pib = PartitionInfo.newBuilder()\n-              .setDbName(getUdbContext().getDbName())\n+          PartitionInfo.Builder partitionInfoBuilder = PartitionInfo.newBuilder()\n+              .setDbName(mGlueDbName)\n               .setTableName(tableName)\n               .addAllDataCols(GlueUtils.toProto(partition.getStorageDescriptor().getColumns()))\n               .setStorage(GlueUtils.toProto(partition.getStorageDescriptor(), pathTranslator))\n               .setPartitionName(partName)\n-              .putAllParameters(partition.getParameters());\n+              .putAllParameters(partition.getParameters() == null\n+                  ? Collections.emptyMap() : partition.getParameters());\n           if (partition.getValues() != null) {\n-            pib.addAllValues(partition.getValues());\n+            partitionInfoBuilder.addAllValues(partition.getValues());\n           }\n-          udbPartitions.add(new GluePartition(new HiveLayout(pib.build(),\n+          udbPartitions.add(new GluePartition(new HiveLayout(partitionInfoBuilder.build(),\n               statsMap.getOrDefault(partName, Collections.emptyList()))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ecab2085a83d8ead5456165ab5f1169baae6ac7"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA3ODc1NQ==", "bodyText": "I feel like the previous code was better, since we still create a new map for our own internal data structure. What does the new code fix?\nWe could change this code a little bit to be something like:\nif (parameters != null) {\n  glueParameters.putAll(parameters);\n}", "url": "https://github.com/Alluxio/alluxio/pull/11763#discussion_r454078755", "createdAt": "2020-07-14T03:35:40Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -123,13 +122,8 @@ public DatabaseInfo getDatabaseInfo() throws IOException {\n           ? \"\" : glueDatabase.getLocationUri();\n       String glueDbDescription = glueDatabase.getDescription() == null\n           ? \"\" : glueDatabase.getDescription();\n-      Map<String, String> glueParameters = new HashMap<>();\n-      Map<String, String> parameters = glueDatabase.getParameters();\n-      if (parameters != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ecab2085a83d8ead5456165ab5f1169baae6ac7"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23a6b9f83f1dd209bfe4b5f2958a4e2937b05f00", "author": {"user": {"login": "HelloHorizon", "name": "Shouwei Chen"}}, "url": "https://github.com/Alluxio/alluxio/commit/23a6b9f83f1dd209bfe4b5f2958a4e2937b05f00", "committedDate": "2020-07-14T04:47:39Z", "message": "Add minor changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzE5NzM3", "url": "https://github.com/Alluxio/alluxio/pull/11763#pullrequestreview-448319737", "createdAt": "2020-07-14T17:33:44Z", "commit": {"oid": "23a6b9f83f1dd209bfe4b5f2958a4e2937b05f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4279, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}