{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMjMxNzc4", "number": 11112, "title": "Turn transform definition into configuration style", "bodyText": "Definitions now must be parseable using Properties.load() after the semicolons have been replaced with new lines.", "createdAt": "2020-03-03T22:46:21Z", "url": "https://github.com/Alluxio/alluxio/pull/11112", "merged": true, "mergeCommit": {"oid": "e808154e58efbed2c0dbeb1a690577fddee52376"}, "closed": true, "closedAt": "2020-03-12T18:51:28Z", "author": {"login": "bradyoo"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKKTCPAH2gAyMzgzMjMxNzc4OjJlYmY1ODBlMjNiNDBlMWM2OGQzY2YzNmRkNTg3YmI1ZmZlYmYzYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMZB-9AFqTM3MjMyMDA5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ebf580e23b40e1c68d3cf36dd587bb5ffebf3b6", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/2ebf580e23b40e1c68d3cf36dd587bb5ffebf3b6", "committedDate": "2020-03-03T22:45:10Z", "message": "[DO NOT MERGE] Turn transform definition into configuration style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bba6068f60fd36909fac8b6c86a2e2ff2a38f29", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/7bba6068f60fd36909fac8b6c86a2e2ff2a38f29", "committedDate": "2020-03-04T17:57:58Z", "message": "checkstyle and changed TransformPlan"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cbacf348cd2ba22a5a9e4af273c6db0039b35bb", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/5cbacf348cd2ba22a5a9e4af273c6db0039b35bb", "committedDate": "2020-03-04T18:00:06Z", "message": "findbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32a3eed0481964c6ad09f4fb73e874d9f341fd9a", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/32a3eed0481964c6ad09f4fb73e874d9f341fd9a", "committedDate": "2020-03-04T18:57:38Z", "message": "checkstyle, default transformation, and rename some CompactAction properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a7de414ea9189893e95cb762e53c2433b7cb02d", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/6a7de414ea9189893e95cb762e53c2433b7cb02d", "committedDate": "2020-03-04T22:24:41Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9d3219085048f4f5c284cb39c6616f494c52064", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/d9d3219085048f4f5c284cb39c6616f494c52064", "committedDate": "2020-03-04T22:51:37Z", "message": "fix test. Remove unnecessary exception messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f4ceae326afc7cc26a385f146bdc9edb58b0b09", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/0f4ceae326afc7cc26a385f146bdc9edb58b0b09", "committedDate": "2020-03-04T23:02:02Z", "message": "Merge remote-tracking branch 'upstream/master' into transform_definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76023d466e6324849965032646f2a16e09114c54", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/76023d466e6324849965032646f2a16e09114c54", "committedDate": "2020-03-04T23:12:58Z", "message": "Delete unnecessary test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe124eaa9e76a2e5e56e692881f4ab422060992", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/9fe124eaa9e76a2e5e56e692881f4ab422060992", "committedDate": "2020-03-04T23:46:49Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941d240b112c33c5b9e7f1a73607717e5a12caf3", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/941d240b112c33c5b9e7f1a73607717e5a12caf3", "committedDate": "2020-03-05T16:58:05Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41747ec06ea276c3c1e71f4f43f6a3f6d3567d87", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/41747ec06ea276c3c1e71f4f43f6a3f6d3567d87", "committedDate": "2020-03-05T16:59:41Z", "message": "remove redundant trim"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672579f5de85adc4bc63e9f6712cd94c8b0e4c62", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/672579f5de85adc4bc63e9f6712cd94c8b0e4c62", "committedDate": "2020-03-05T17:11:07Z", "message": "Merge remote-tracking branch 'upstream/master' into transform_definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f7cc97ce1c65a059174c224280b288bcf09613", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/74f7cc97ce1c65a059174c224280b288bcf09613", "committedDate": "2020-03-05T17:50:17Z", "message": "resolve the rest properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20afb96836623c70554766778150420945230f2a", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/20afb96836623c70554766778150420945230f2a", "committedDate": "2020-03-05T18:06:13Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNTczMzY5", "url": "https://github.com/Alluxio/alluxio/pull/11112#pullrequestreview-370573369", "createdAt": "2020-03-06T19:31:33Z", "commit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTozMTozNFrOFzEuhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTozNzowM1rOFzIN_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA5OTE0MA==", "bodyText": "Do we have to get rid of this?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389099140", "createdAt": "2020-03-06T19:31:34Z", "author": {"login": "gpang"}, "path": "job/common/src/main/java/alluxio/job/plan/transform/CompactConfig.java", "diffHunk": "@@ -44,10 +44,6 @@\n    * Compacted files are stored under this directory.\n    */\n   private final String mOutput;\n-  /**\n-   * The type of database to write the compacted table to.\n-   */\n-  private final String mDatabaseType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMDA0NQ==", "bodyText": "NIT: update the javadoc", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389100045", "createdAt": "2020-03-06T19:33:32Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/CompactAction.java", "diffHunk": "@@ -18,24 +18,20 @@\n \n import com.google.common.base.Preconditions;\n import org.apache.commons.io.FileUtils;\n+import org.apache.commons.lang.StringUtils;\n \n-import java.util.List;\n-import java.util.Map;\n+import java.util.Properties;\n \n /**\n  * The definition of the write action.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMDk1NA==", "bodyText": "what happens with actions with the same number?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389100954", "createdAt": "2020-03-06T19:35:33Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionFactory.java", "diffHunk": "@@ -11,24 +11,28 @@\n \n package alluxio.table.common.transform.action;\n \n-import java.util.List;\n-import java.util.Map;\n+import javax.annotation.Nullable;\n+import java.util.Properties;\n \n /**\n  * The action factory interface.\n  */\n public interface TransformActionFactory {\n \n   /**\n-   * @return the name of the action\n+   * Returns the order of the transform action. Transform actions with a lower number\n+   * will be executed before transform actions with a higher number.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMzQyNQ==", "bodyText": "Could name still be useful? Or does class name provide the same functionality as name?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389103425", "createdAt": "2020-03-06T19:39:16Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionFactory.java", "diffHunk": "@@ -11,24 +11,28 @@\n \n package alluxio.table.common.transform.action;\n \n-import java.util.List;\n-import java.util.Map;\n+import javax.annotation.Nullable;\n+import java.util.Properties;\n \n /**\n  * The action factory interface.\n  */\n public interface TransformActionFactory {\n \n   /**\n-   * @return the name of the action\n+   * Returns the order of the transform action. Transform actions with a lower number\n+   * will be executed before transform actions with a higher number.\n+   *\n+   * @return integer representing order number\n    */\n-  String getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwNzQxNw==", "bodyText": "do we have a test for ordering?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389107417", "createdAt": "2020-03-06T19:43:49Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionFactory.java", "diffHunk": "@@ -11,24 +11,28 @@\n \n package alluxio.table.common.transform.action;\n \n-import java.util.List;\n-import java.util.Map;\n+import javax.annotation.Nullable;\n+import java.util.Properties;\n \n /**\n  * The action factory interface.\n  */\n public interface TransformActionFactory {\n \n   /**\n-   * @return the name of the action\n+   * Returns the order of the transform action. Transform actions with a lower number\n+   * will be executed before transform actions with a higher number.\n+   *\n+   * @return integer representing order number\n    */\n-  String getName();\n+  default int getOrder() {\n+    return 100;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNjgzMw==", "bodyText": "is there a way to avoid this traversal, and look it up somehow?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389126833", "createdAt": "2020-03-06T20:25:54Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -37,19 +39,17 @@ private TransformActionRegistry() {} // prevent instantiation\n    * Creates a new instance of a {@link TransformAction}.\n    *\n    * @param definition the raw definition of the action\n-   * @param name the name of the transform action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  public static TransformAction create(String definition, String name, List<String> args,\n-      Map<String, String> options) {\n-    TransformActionFactory factory = FACTORIES.get(name);\n-    if (factory == null) {\n-      throw new IllegalStateException(\n-          String.format(\"TransformActionFactory for name '%s' does not exist.\", name));\n+  public static List<TransformAction> create(Properties definition) {\n+    final ArrayList<TransformAction> actions = new ArrayList<>();\n+    for (TransformActionFactory factory : FACTORIES) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNzA0NA==", "bodyText": "if it is null, how does the error handling work?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389127044", "createdAt": "2020-03-06T20:26:21Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -37,19 +39,17 @@ private TransformActionRegistry() {} // prevent instantiation\n    * Creates a new instance of a {@link TransformAction}.\n    *\n    * @param definition the raw definition of the action\n-   * @param name the name of the transform action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  public static TransformAction create(String definition, String name, List<String> args,\n-      Map<String, String> options) {\n-    TransformActionFactory factory = FACTORIES.get(name);\n-    if (factory == null) {\n-      throw new IllegalStateException(\n-          String.format(\"TransformActionFactory for name '%s' does not exist.\", name));\n+  public static List<TransformAction> create(Properties definition) {\n+    final ArrayList<TransformAction> actions = new ArrayList<>();\n+    for (TransformActionFactory factory : FACTORIES) {\n+      final TransformAction transformAction = factory.create(definition);\n+      if (transformAction != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNzM5NA==", "bodyText": "Why does this return a list of actions? Can you update javadoc description and return comment.", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389127394", "createdAt": "2020-03-06T20:27:10Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -37,19 +39,17 @@ private TransformActionRegistry() {} // prevent instantiation\n    * Creates a new instance of a {@link TransformAction}.\n    *\n    * @param definition the raw definition of the action\n-   * @param name the name of the transform action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  public static TransformAction create(String definition, String name, List<String> args,\n-      Map<String, String> options) {\n-    TransformActionFactory factory = FACTORIES.get(name);\n-    if (factory == null) {\n-      throw new IllegalStateException(\n-          String.format(\"TransformActionFactory for name '%s' does not exist.\", name));\n+  public static List<TransformAction> create(Properties definition) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNzcyNQ==", "bodyText": "Do you have an example of this string? What does it print if it no longer has a name?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389127725", "createdAt": "2020-03-06T20:27:53Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -59,14 +59,9 @@ private static void refresh() {\n     FACTORIES.clear();\n     for (TransformActionFactory factory : ServiceLoader\n         .load(TransformActionFactory.class, TransformActionFactory.class.getClassLoader())) {\n-      TransformActionFactory existingFactory = FACTORIES.get(factory.getName());\n-      if (existingFactory != null) {\n-        LOG.warn(\n-            \"Ignoring duplicate transform action '{}' found in factory {}. Existing factory: {}\",\n-            factory.getName(), factory.getClass(), existingFactory.getClass());\n-      }\n-      FACTORIES.put(factory.getName(), factory);\n+      FACTORIES.add(factory);\n     }\n-    LOG.info(\"Registered Transform actions: \" + String.join(\",\", FACTORIES.keySet()));\n+    FACTORIES.sort(Comparator.comparingInt((factory) -> factory.getOrder()));\n+    LOG.info(\"Registered Transform actions: \" + StringUtils.join(FACTORIES, \",\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1NTI4OA==", "bodyText": "What is this for?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389155288", "createdAt": "2020-03-06T21:34:22Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/TransformPlan.java", "diffHunk": "@@ -44,23 +42,29 @@\n    * @param definition the transformation definition\n    */\n   public TransformPlan(Layout baseLayout, Layout transformedLayout,\n-      TransformDefinition definition) {\n+                       TransformDefinition definition) {\n     mBaseLayout = baseLayout;\n     mTransformedLayout = transformedLayout;\n     mJobConfigs = computeJobConfigs(definition);\n   }\n \n   private ArrayList<JobConfig> computeJobConfigs(TransformDefinition definition) {\n-    final List<TransformAction> actions = definition.getActions();\n+    ArrayList<JobConfig> actions = new ArrayList<>();\n+    Layout baseLayout = mBaseLayout;\n+    boolean deleteSrc = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1NTY1NA==", "bodyText": "is this allowed to return null as a return value?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389155654", "createdAt": "2020-03-06T21:35:20Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/CompactAction.java", "diffHunk": "@@ -48,42 +44,49 @@\n   /**\n    * Factory to create an instance.\n    */\n-  public static class WriteActionFactory implements TransformActionFactory {\n+  public static class CompactActionFactory implements TransformActionFactory {\n+\n     @Override\n-    public String getName() {\n-      return NAME;\n+    public int getOrder() {\n+      return 0;\n     }\n \n     @Override\n-    public TransformAction create(String definition, List<String> args,\n-        Map<String, String> options) {\n-      Preconditions.checkArgument(args.size() == 1,\n-          ExceptionMessage.TRANSFORM_WRITE_ACTION_INVALID_ARGS.toString());\n-      String type = args.get(0);\n-      int numFiles = options.containsKey(NUM_FILES_OPTION)\n-          ? Integer.parseInt(options.get(NUM_FILES_OPTION))\n-          : DEFAULT_NUM_FILES;\n-      long fileSize = options.containsKey(FILE_SIZE_OPTION)\n-          ? Long.parseLong(options.get(FILE_SIZE_OPTION))\n-          : DEFAULT_FILE_SIZE;\n-      Preconditions.checkArgument(numFiles >= 0,\n-          ExceptionMessage.TRANSFORM_WRITE_ACTION_INVALID_NUM_FILES);\n-      return new WriteAction(type, numFiles, fileSize);\n+    public TransformAction create(Properties properties) {\n+      final String numFilesString = properties.getProperty(NUM_FILES_OPTION);\n+\n+      final String fileSizeString = properties.getProperty(FILE_SIZE_OPTION);\n+\n+      if (StringUtils.isEmpty(numFilesString) && StringUtils.isEmpty(fileSizeString)) {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1NjM1MA==", "bodyText": "Is there a test that tests for normalization of transformation definitions?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r389156350", "createdAt": "2020-03-06T21:37:03Z", "author": {"login": "gpang"}, "path": "table/server/common/src/test/java/alluxio/table/common/transform/TransformDefinitionTest.java", "diffHunk": "@@ -24,44 +25,46 @@\n   @Test\n   public void parse() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e35109743181ee97851853d1564a77a562a546d2", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/e35109743181ee97851853d1564a77a562a546d2", "committedDate": "2020-03-09T21:14:27Z", "message": "Feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029bb90f5d9678d73d32522da82fa62ae8ed3994", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/029bb90f5d9678d73d32522da82fa62ae8ed3994", "committedDate": "2020-03-09T22:42:25Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMDkxNjg3", "url": "https://github.com/Alluxio/alluxio/pull/11112#pullrequestreview-372091687", "createdAt": "2020-03-10T15:58:43Z", "commit": {"oid": "029bb90f5d9678d73d32522da82fa62ae8ed3994"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTo1ODo0NFrOF0Vmyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjowMjozM1rOF0Vx7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNDI2Nw==", "bodyText": "it doesnt have to be defined now, but at least the javadoc should state that the behavior is undefined.", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390424267", "createdAt": "2020-03-10T15:58:44Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionFactory.java", "diffHunk": "@@ -11,24 +11,28 @@\n \n package alluxio.table.common.transform.action;\n \n-import java.util.List;\n-import java.util.Map;\n+import javax.annotation.Nullable;\n+import java.util.Properties;\n \n /**\n  * The action factory interface.\n  */\n public interface TransformActionFactory {\n \n   /**\n-   * @return the name of the action\n+   * Returns the order of the transform action. Transform actions with a lower number\n+   * will be executed before transform actions with a higher number.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMDk1NA=="}, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNTA1NQ==", "bodyText": "I see, then can we add a TODO mentioning that possible improvement for the future?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390425055", "createdAt": "2020-03-10T15:59:48Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -37,19 +39,17 @@ private TransformActionRegistry() {} // prevent instantiation\n    * Creates a new instance of a {@link TransformAction}.\n    *\n    * @param definition the raw definition of the action\n-   * @param name the name of the transform action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  public static TransformAction create(String definition, String name, List<String> args,\n-      Map<String, String> options) {\n-    TransformActionFactory factory = FACTORIES.get(name);\n-    if (factory == null) {\n-      throw new IllegalStateException(\n-          String.format(\"TransformActionFactory for name '%s' does not exist.\", name));\n+  public static List<TransformAction> create(Properties definition) {\n+    final ArrayList<TransformAction> actions = new ArrayList<>();\n+    for (TransformActionFactory factory : FACTORIES) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNjgzMw=="}, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNTYyMg==", "bodyText": "can you add to the javadoc on what a null return value is supposed to represent?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390425622", "createdAt": "2020-03-10T16:00:33Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionFactory.java", "diffHunk": "@@ -11,24 +11,28 @@\n \n package alluxio.table.common.transform.action;\n \n-import java.util.List;\n-import java.util.Map;\n+import javax.annotation.Nullable;\n+import java.util.Properties;\n \n /**\n  * The action factory interface.\n  */\n public interface TransformActionFactory {\n \n   /**\n-   * @return the name of the action\n+   * Returns the order of the transform action. Transform actions with a lower number\n+   * will be executed before transform actions with a higher number.\n+   *\n+   * @return integer representing order number\n    */\n-  String getName();\n+  default int getOrder() {\n+    return 100;\n+  }\n \n   /**\n    * @param definition the raw definition of the action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  TransformAction create(String definition, List<String> args, Map<String, String> options);\n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "029bb90f5d9678d73d32522da82fa62ae8ed3994"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNjM2Mg==", "bodyText": "Can you update the javadoc with the return description and method description? (why is it a list?)", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390426362", "createdAt": "2020-03-10T16:01:33Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -37,19 +39,17 @@ private TransformActionRegistry() {} // prevent instantiation\n    * Creates a new instance of a {@link TransformAction}.\n    *\n    * @param definition the raw definition of the action\n-   * @param name the name of the transform action\n-   * @param args a list of string args\n-   * @param options a string-string map of options\n    * @return a new instance of an action\n    */\n-  public static TransformAction create(String definition, String name, List<String> args,\n-      Map<String, String> options) {\n-    TransformActionFactory factory = FACTORIES.get(name);\n-    if (factory == null) {\n-      throw new IllegalStateException(\n-          String.format(\"TransformActionFactory for name '%s' does not exist.\", name));\n+  public static List<TransformAction> create(Properties definition) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNzM5NA=="}, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNzAwMw==", "bodyText": "please add a newline at the end of the file", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390427003", "createdAt": "2020-03-10T16:02:22Z", "author": {"login": "gpang"}, "path": "table/server/common/src/test/resources/META-INF/services/alluxio.table.common.transform.action.TransformActionFactory", "diffHunk": "@@ -0,0 +1,2 @@\n+alluxio.table.common.transform.action.EarlyActionFactory\n+alluxio.table.common.transform.action.LateActionFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "029bb90f5d9678d73d32522da82fa62ae8ed3994"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyNzExOA==", "bodyText": "Can you comment on what this would look like?", "url": "https://github.com/Alluxio/alluxio/pull/11112#discussion_r390427118", "createdAt": "2020-03-10T16:02:33Z", "author": {"login": "gpang"}, "path": "table/server/common/src/main/java/alluxio/table/common/transform/action/TransformActionRegistry.java", "diffHunk": "@@ -59,14 +59,9 @@ private static void refresh() {\n     FACTORIES.clear();\n     for (TransformActionFactory factory : ServiceLoader\n         .load(TransformActionFactory.class, TransformActionFactory.class.getClassLoader())) {\n-      TransformActionFactory existingFactory = FACTORIES.get(factory.getName());\n-      if (existingFactory != null) {\n-        LOG.warn(\n-            \"Ignoring duplicate transform action '{}' found in factory {}. Existing factory: {}\",\n-            factory.getName(), factory.getClass(), existingFactory.getClass());\n-      }\n-      FACTORIES.put(factory.getName(), factory);\n+      FACTORIES.add(factory);\n     }\n-    LOG.info(\"Registered Transform actions: \" + String.join(\",\", FACTORIES.keySet()));\n+    FACTORIES.sort(Comparator.comparingInt((factory) -> factory.getOrder()));\n+    LOG.info(\"Registered Transform actions: \" + StringUtils.join(FACTORIES, \",\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyNzcyNQ=="}, "originalCommit": {"oid": "20afb96836623c70554766778150420945230f2a"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bd1fac4862eb9d3f15610e8fb2a6ba6860e95b5", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/1bd1fac4862eb9d3f15610e8fb2a6ba6860e95b5", "committedDate": "2020-03-10T17:19:40Z", "message": "review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f557ee89f64bf8a1349b1251250f250ec5ace94f", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/f557ee89f64bf8a1349b1251250f250ec5ace94f", "committedDate": "2020-03-10T17:35:44Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzIwMDk2", "url": "https://github.com/Alluxio/alluxio/pull/11112#pullrequestreview-372320096", "createdAt": "2020-03-10T21:02:58Z", "commit": {"oid": "f557ee89f64bf8a1349b1251250f250ec5ace94f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4809, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}