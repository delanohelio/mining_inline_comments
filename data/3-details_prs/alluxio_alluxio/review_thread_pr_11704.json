{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMDUyNTkw", "number": 11704, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMjowNjoyMFrOELhMWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyODozOVrOELx4XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTEzNjI0OnYy", "diffSide": "RIGHT", "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMjowNjoyMFrOGtG2hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNDoxNFrOGtgg3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MTM2NQ==", "bodyText": "is this retried on caller site?", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r449951365", "createdAt": "2020-07-06T02:06:20Z", "author": {"login": "ggezer"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);\n       }\n       ufsStatus.setName(path.getName());\n       addStatus(path, ufsStatus);\n       return ufsStatus;\n     } catch (IllegalArgumentException | IOException e) {\n       LogUtils.warnWithException(LOG, \"Failed to fetch status for {}\", path, e);\n     }\n-    return null;\n+    throw new FileNotFoundException(\"Failed to fetch status of \" + ufsUri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3MTgwNg==", "bodyText": "no", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r450371806", "createdAt": "2020-07-06T17:24:14Z", "author": {"login": "ZacBlanco"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);\n       }\n       ufsStatus.setName(path.getName());\n       addStatus(path, ufsStatus);\n       return ufsStatus;\n     } catch (IllegalArgumentException | IOException e) {\n       LogUtils.warnWithException(LOG, \"Failed to fetch status for {}\", path, e);\n     }\n-    return null;\n+    throw new FileNotFoundException(\"Failed to fetch status of \" + ufsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MTM2NQ=="}, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTEzNjk2OnYy", "diffSide": "RIGHT", "path": "core/server/master/src/test/java/alluxio/underfs/UfsStatusCacheTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMjowNjo1MlrOGtG26Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozNToxMFrOGtg3Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MTQ2NQ==", "bodyText": "Can you replace these withExpectedException rule?", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r449951465", "createdAt": "2020-07-06T02:06:52Z", "author": {"login": "ggezer"}, "path": "core/server/master/src/test/java/alluxio/underfs/UfsStatusCacheTest.java", "diffHunk": "@@ -371,18 +372,26 @@ public void testFetchExistingSingleStatus() throws Exception {\n   @Test\n   public void testFetchSingleStatusNonExistingPath() throws Exception {\n     spyUfs();\n-    UfsStatus fetched = mCache.fetchStatusIfAbsent(new AlluxioURI(\"/testFile\"), mMountTable);\n+    try {\n+      UfsStatus fetched = mCache.fetchStatusIfAbsent(new AlluxioURI(\"/testFile\"), mMountTable);\n+      fail(\"Should have thrown FileNotFoundException\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NzUxNQ==", "bodyText": "Using the ExpectedException rule I can't use Mockito.verify afterwards", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r450377515", "createdAt": "2020-07-06T17:35:10Z", "author": {"login": "ZacBlanco"}, "path": "core/server/master/src/test/java/alluxio/underfs/UfsStatusCacheTest.java", "diffHunk": "@@ -371,18 +372,26 @@ public void testFetchExistingSingleStatus() throws Exception {\n   @Test\n   public void testFetchSingleStatusNonExistingPath() throws Exception {\n     spyUfs();\n-    UfsStatus fetched = mCache.fetchStatusIfAbsent(new AlluxioURI(\"/testFile\"), mMountTable);\n+    try {\n+      UfsStatus fetched = mCache.fetchStatusIfAbsent(new AlluxioURI(\"/testFile\"), mMountTable);\n+      fail(\"Should have thrown FileNotFoundException\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MTQ2NQ=="}, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3MDM3OnYy", "diffSide": "RIGHT", "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyODozOVrOGtgpzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1NToxMlrOGuJhUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDA5NQ==", "bodyText": "Will this exception be thrown to the client? If so we should make it more explanatory (ie. what does null status mean?)", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r450374095", "createdAt": "2020-07-06T17:28:39Z", "author": {"login": "calvinjia"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NTgyMw==", "bodyText": "No, this is not returned to the client", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r450375823", "createdAt": "2020-07-06T17:31:50Z", "author": {"login": "ZacBlanco"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDA5NQ=="}, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAwNzA4MA==", "bodyText": "Just want to double check, I don't see FileNotFoundException being caught by the callers? ie. processSyncPath\nIs it handled in InodeSyncStream#loadMetadata (~line 695)?", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r451007080", "createdAt": "2020-07-07T16:52:22Z", "author": {"login": "calvinjia"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDA5NQ=="}, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0MzY2NQ==", "bodyText": "FileNotFoundException extends from IOException which is in the method definition of the caller loadMetadataForPath as a part of it's throws declarations.\nIOException is then caught by the try-catch block on line 422 in processSyncPath or if the root path is missing, then it is caught in the handler on line 300", "url": "https://github.com/Alluxio/alluxio/pull/11704#discussion_r451043665", "createdAt": "2020-07-07T17:55:12Z", "author": {"login": "ZacBlanco"}, "path": "core/server/master/src/main/java/alluxio/underfs/UfsStatusCache.java", "diffHunk": "@@ -152,15 +153,15 @@ public UfsStatus fetchStatusIfAbsent(AlluxioURI path, MountTable mountTable)\n       UnderFileSystem ufs = ufsResource.get();\n       UfsStatus ufsStatus = ufs.getStatus(ufsUri.toString());\n       if (ufsStatus == null) {\n-        return null;\n+        throw new FileNotFoundException(\"fetched status is null for: \" + ufsUri);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDA5NQ=="}, "originalCommit": {"oid": "e03a6fefc5395521cb1d3beedb834a176ad9e692"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1394, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}