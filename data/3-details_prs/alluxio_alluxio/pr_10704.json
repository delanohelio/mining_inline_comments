{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMTU3ODY0", "number": 10704, "title": "Fix Distributed Load Retry Logic", "bodyText": "Hypothetical Environment:\n3 nodes, each with a job worker and a worker.\nSuppose a file x.txt has 10 blocks to load but one of its blocks (Block 1) is in the middle of being read on (Worker A), Attempting to load this file creates 10 tasks and the task to load Block 1 is assigned to be in Worker A.\nPrevious behavior:\nThe task in an attempt to load Block 1 in Worker A fails. This fails the job but the other 9 tasks are still continuing. The client notices the failure and triggers a retry. Retry notices that none of the 10 blocks are still loaded yet and shuffles the location of where they are getting loaded.\nNew behavior:\nThe task in an attempt to load Block 1 in Worker A fails. This fails the job but the other 9 tasks are still continuing. The client waits for all of its 10 tasks to finish despite knowing that the job has already failed. After all the tasks are complete/failed, it reruns the job again. This time, the server knows that 9 of its blocks are already loaded and only one more needs to get loaded.", "createdAt": "2020-01-07T20:25:18Z", "url": "https://github.com/Alluxio/alluxio/pull/10704", "merged": true, "mergeCommit": {"oid": "8641f298c2cac3d6cbbe3f8623775783829609c9"}, "closed": true, "closedAt": "2020-01-09T00:14:58Z", "author": {"login": "bradyoo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4Gs3-AH2gAyMzYwMTU3ODY0OjcwMzc5ZmNlMjFlOWIxMWQyNDEwZTkxMzA1OTMxNTBmMTIzZDQwNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4enQTgFqTM0MDIyNTQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70379fce21e9b11d2410e9130593150f123d4078", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/70379fce21e9b11d2410e9130593150f123d4078", "committedDate": "2020-01-07T20:23:08Z", "message": "attempt to improve performance on load retries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ddf434af3c29a459720216f02abc2cdacdd780", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/26ddf434af3c29a459720216f02abc2cdacdd780", "committedDate": "2020-01-07T22:09:55Z", "message": "Fix print add another print"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/16b8151bcc4e9ed76a40ef9da5c108e806db8806", "committedDate": "2020-01-07T22:12:03Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTkwMzQw", "url": "https://github.com/Alluxio/alluxio/pull/10704#pullrequestreview-339590340", "createdAt": "2020-01-08T00:31:44Z", "commit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDozMTo0NFrOFbJ1LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDozMTo0NFrOFbJ1LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAxNjk0MA==", "bodyText": "Print number of retries?", "url": "https://github.com/Alluxio/alluxio/pull/10704#discussion_r364016940", "createdAt": "2020-01-08T00:31:44Z", "author": {"login": "calvinjia"}, "path": "shell/src/main/java/alluxio/cli/fs/command/DistributedLoadCommand.java", "diffHunk": "@@ -89,7 +88,8 @@ private boolean run() {\n         }\n         return true;\n       }\n-      LOG.warn(\"Failed to complete job after retries: {}\", mJobConfig);\n+      System.out.println(String.format(\"Failed to complete loading %s after retries.\",\n+          mJobConfig.getFilePath()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTkxMDIz", "url": "https://github.com/Alluxio/alluxio/pull/10704#pullrequestreview-339591023", "createdAt": "2020-01-08T00:34:11Z", "commit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDozNDoxMVrOFbJ3XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDozNDoxMVrOFbJ3XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAxNzUwMQ==", "bodyText": "Perhaps word this a bit differently, Successfully loaded path %s after %d attempts? Also, is it possible for this to become spammy if a large number of files is to be loaded?", "url": "https://github.com/Alluxio/alluxio/pull/10704#discussion_r364017501", "createdAt": "2020-01-08T00:34:11Z", "author": {"login": "calvinjia"}, "path": "shell/src/main/java/alluxio/cli/fs/command/DistributedLoadCommand.java", "diffHunk": "@@ -111,7 +111,27 @@ private Status check() {\n         return Status.FAILED;\n       }\n \n-      return jobInfo.getStatus();\n+      // This make an assumption that this job tree only goes 1 level deep\n+      boolean finished = true;\n+      for (JobInfo child : jobInfo.getChildren()) {\n+        if (!child.getStatus().isFinished()) {\n+          finished = false;\n+          break;\n+        }\n+      }\n+\n+      if (finished) {\n+        if (jobInfo.getStatus().equals(Status.FAILED)) {\n+          System.out.println(String.format(\"Attempt %s to load %s failed because: %s\",\n+              mRetryPolicy.getAttemptCount(), mJobConfig.getFilePath(),\n+              jobInfo.getErrorMessage()));\n+        } else if (jobInfo.getStatus().equals(Status.COMPLETED)) {\n+          System.out.println(String.format(\"Attempt %s to load %s completed\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTkxMTM1", "url": "https://github.com/Alluxio/alluxio/pull/10704#pullrequestreview-339591135", "createdAt": "2020-01-08T00:34:34Z", "commit": {"oid": "16b8151bcc4e9ed76a40ef9da5c108e806db8806"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da1084b160a485795be73c0675ec396f8ce3f3eb", "author": {"user": {"login": "bradyoo", "name": "Bradley Yoo"}}, "url": "https://github.com/Alluxio/alluxio/commit/da1084b160a485795be73c0675ec396f8ce3f3eb", "committedDate": "2020-01-08T21:34:56Z", "message": "feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMjI1NDA3", "url": "https://github.com/Alluxio/alluxio/pull/10704#pullrequestreview-340225407", "createdAt": "2020-01-09T00:14:43Z", "commit": {"oid": "da1084b160a485795be73c0675ec396f8ce3f3eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3245, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}