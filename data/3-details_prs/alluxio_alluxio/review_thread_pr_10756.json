{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzg1NzQ2", "number": 10756, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNTo0NlrODY8b6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNTo0NlrODY8b6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDgyNjAxOnYy", "diffSide": "RIGHT", "path": "job/server/src/main/java/alluxio/master/job/workflow/WorkflowTracker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMTozNTo0NlrOFfF2yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNzowOToxNlrOFfk4ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjEyMw==", "bodyText": "Should this logic be in the stop call? Does the bug happen for workflows which fail through PlanTracker#onPlanStatusChange?", "url": "https://github.com/Alluxio/alluxio/pull/10756#discussion_r368146123", "createdAt": "2020-01-17T21:35:46Z", "author": {"login": "calvinjia"}, "path": "job/server/src/main/java/alluxio/master/job/workflow/WorkflowTracker.java", "diffHunk": "@@ -250,6 +250,7 @@ private synchronized void next(long jobId) {\n         mJobMaster.run(childJobConfig, childJobId);\n       } catch (JobDoesNotExistException | ResourceExhaustedException e) {\n         LOG.warn(e.getMessage());\n+        workflowExecution.stop(Status.FAILED, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY1NDQ1OQ==", "bodyText": "No the bug doesn't happen for workflows which fail through PlanTracker#onPlanStatusChange because all logic that goes through onPlanStatusChange are not workflows and are Plans which are handled by the PlanTracker. This is also the reason why the stop logic looks at the parent. onPlanStatusChange is the normal case and this JobDoesNotExist + ResourceExhausted is the edge case.", "url": "https://github.com/Alluxio/alluxio/pull/10756#discussion_r368654459", "createdAt": "2020-01-20T17:09:16Z", "author": {"login": "bradyoo"}, "path": "job/server/src/main/java/alluxio/master/job/workflow/WorkflowTracker.java", "diffHunk": "@@ -250,6 +250,7 @@ private synchronized void next(long jobId) {\n         mJobMaster.run(childJobConfig, childJobId);\n       } catch (JobDoesNotExistException | ResourceExhaustedException e) {\n         LOG.warn(e.getMessage());\n+        workflowExecution.stop(Status.FAILED, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjEyMw=="}, "originalCommit": {"oid": "abad7a6e2ae2ba4ad07ea08be72eb868a8b1b272"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2247, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}