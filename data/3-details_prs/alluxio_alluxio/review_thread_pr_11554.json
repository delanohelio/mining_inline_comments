{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNDU3MzAx", "number": 11554, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjo0NzoyNVrOEE82UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMzo0ODozM1rOEFEKfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNjI2NzA1OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjo0NzoyNVrOGi48Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNzowNzoyNlrOGi5ZnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNzcwMg==", "bodyText": "I think empty dir for alluxio-domain is not helpful. The reason is that empty dir is only shared in the same pod, not across different pods. So it's not visible to Fuse pod or other client pod.", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439237702", "createdAt": "2020-06-12T06:47:25Z", "author": {"login": "cheyang"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -257,6 +257,24 @@ resources:\n   {{- end }}\n {{- end -}}\n \n+{{- define \"alluxio.worker.shortCircuit.volume\" -}}\n+  {{- if eq .Values.shortCircuit.volumeType \"hostPath\" }}\n+        - name: alluxio-domain\n+          hostPath:\n+            path: {{ .Values.shortCircuit.hostPath }}\n+            type: DirectoryOrCreate\n+  {{- else if eq .Values.shortCircuit.volumeType \"persistentVolumeClaim\" }}\n+        - name: alluxio-domain\n+          persistentVolumeClaim:\n+            claimName: \"{{ .Values.shortCircuit.pvcName }}\"\n+  {{- else }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI0NTIxMg==", "bodyText": "Makes sense to me. Removed emptyDir for domain socket and keeping only PVC and hostPath", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439245212", "createdAt": "2020-06-12T07:07:26Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -257,6 +257,24 @@ resources:\n   {{- end }}\n {{- end -}}\n \n+{{- define \"alluxio.worker.shortCircuit.volume\" -}}\n+  {{- if eq .Values.shortCircuit.volumeType \"hostPath\" }}\n+        - name: alluxio-domain\n+          hostPath:\n+            path: {{ .Values.shortCircuit.hostPath }}\n+            type: DirectoryOrCreate\n+  {{- else if eq .Values.shortCircuit.volumeType \"persistentVolumeClaim\" }}\n+        - name: alluxio-domain\n+          persistentVolumeClaim:\n+            claimName: \"{{ .Values.shortCircuit.pvcName }}\"\n+  {{- else }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNzcwMg=="}, "originalCommit": {"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzE0MTYyOnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowMTo1MVrOGjBeNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowMTo1MVrOGjBeNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NzQ2Mg==", "bodyText": "Fixed one typo", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439377462", "createdAt": "2020-06-12T12:01:51Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml", "diffHunk": "@@ -92,7 +94,7 @@ spec:\n               fieldRef:\n                 fieldPath: status.hostIP\n           - name: ALLUXIO_CLIENT_JAVA_OPTS\n-            value: \" -Dalluxio.user.hostname=$(ALLUXIO_CLIENT_HOSTNAME) \"\n+            value: \" -Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME} \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzE0NzE1OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowNDowMlrOGjBhog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjowNDowMlrOGjBhog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3ODMzOA==", "bodyText": "Per #11526 (comment), inferring dnsPolicy from hostNetwork, but not inferring hostNetwork from whether it's root.", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439378338", "createdAt": "2020-06-12T12:04:02Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -70,18 +70,14 @@ master:\n     embedded: 19200\n     rpc: 19998\n     web: 19999\n-  # You can specify hostNetwork and dnsPolicy here to override the default\n-  # hostNetwork: false\n+  hostNetwork: false\n+  # dnsPolicy will be ClusterFirstWithHostNet if hostNetwork: true\n+  # and ClusterFirst if hostNetwork: false\n+  # You can specify dnsPolicy here to override this inference", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzQ2NTU3OnYy", "diffSide": "RIGHT", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMzo0ODozM1rOGjEoBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMTozNDoxM1rOGlcn_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw==", "bodyText": "Please note this and any other renames in changelog. A rename will break back compatibility, avoid if not absolutely necessary", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439429127", "createdAt": "2020-06-12T13:48:33Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -230,14 +247,20 @@ shortCircuit:\n   # local means the cache directory is in the same mount namespace,\n   # uuid means interact with domain socket\n   policy: uuid\n-  # Attributes if the domain socket volume is PVC\n+  # volumeType controls the type of shortCircuit volume.\n+  # It can be \"persistentVolumeClaim\" or \"hostPath\"\n+  volumeType: persistentVolumeClaim\n+  size: 1Mi\n+  # Attributes to use if the domain socket volume is PVC\n   pvcName: alluxio-worker-domain-socket\n-  pvcAccessModes:\n+  accessModes:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMzIxMg==", "bodyText": "Actually i found this accessModes i'm changing to is the one used in the docs. I realized this is changed to pvcAccessModes sometime in 2.3 snapshot. So I think it's okay.", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r441913212", "createdAt": "2020-06-18T01:08:28Z", "author": {"login": "jiacheliu3"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -230,14 +247,20 @@ shortCircuit:\n   # local means the cache directory is in the same mount namespace,\n   # uuid means interact with domain socket\n   policy: uuid\n-  # Attributes if the domain socket volume is PVC\n+  # volumeType controls the type of shortCircuit volume.\n+  # It can be \"persistentVolumeClaim\" or \"hostPath\"\n+  volumeType: persistentVolumeClaim\n+  size: 1Mi\n+  # Attributes to use if the domain socket volume is PVC\n   pvcName: alluxio-worker-domain-socket\n-  pvcAccessModes:\n+  accessModes:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw=="}, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxOTQ4Ng==", "bodyText": "yep", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r441919486", "createdAt": "2020-06-18T01:34:13Z", "author": {"login": "madanadit"}, "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -230,14 +247,20 @@ shortCircuit:\n   # local means the cache directory is in the same mount namespace,\n   # uuid means interact with domain socket\n   policy: uuid\n-  # Attributes if the domain socket volume is PVC\n+  # volumeType controls the type of shortCircuit volume.\n+  # It can be \"persistentVolumeClaim\" or \"hostPath\"\n+  volumeType: persistentVolumeClaim\n+  size: 1Mi\n+  # Attributes to use if the domain socket volume is PVC\n   pvcName: alluxio-worker-domain-socket\n-  pvcAccessModes:\n+  accessModes:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw=="}, "originalCommit": {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1626, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}