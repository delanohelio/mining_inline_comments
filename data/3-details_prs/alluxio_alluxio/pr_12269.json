{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNzY1NTk3", "number": 12269, "title": "Fix backup worker crashing master on interruption", "bodyText": "When a backup is interrupted, there is a chance that the resume callback cannot be canceled and thus happens after the server is already resumed by the journal reload process. While it makes sense for backup to crash the master if resume fails to complete and master cannot accept new journal entries, it is completely fine for master to continue if backup tries to resume an already resumed journal. This change updates the journal to not throw if someone attempts to resume after the journal is already resumed.", "createdAt": "2020-10-13T19:55:42Z", "url": "https://github.com/Alluxio/alluxio/pull/12269", "merged": true, "mergeCommit": {"oid": "f698cd4c090db24df84f855c226f2738ce1e0440"}, "closed": true, "closedAt": "2020-10-14T17:24:10Z", "author": {"login": "bf8086"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSMqZ5gH2gAyNTAyNzY1NTk3OjJhMWU2MDcxOGVhMmI4ODNjZDkzMmNjMTU2ZTJjMzI1NjM4MmIzMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSUknXAFqTUwNzk2ODEyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2a1e60718ea2b883cd932cc156e2c3256382b321", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/2a1e60718ea2b883cd932cc156e2c3256382b321", "committedDate": "2020-10-13T18:13:03Z", "message": "Fix backup worker crashing master on interruption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01bd099287d26945b2e282e96edb3a9793e36c8", "author": {"user": {"login": "bf8086", "name": null}}, "url": "https://github.com/Alluxio/alluxio/commit/e01bd099287d26945b2e282e96edb3a9793e36c8", "committedDate": "2020-10-13T21:37:53Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODg5NTQx", "url": "https://github.com/Alluxio/alluxio/pull/12269#pullrequestreview-507889541", "createdAt": "2020-10-13T23:07:44Z", "commit": {"oid": "e01bd099287d26945b2e282e96edb3a9793e36c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMzowNzo0NVrOHg8jjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMzowNzo0NVrOHg8jjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwODYyMA==", "bodyText": "@bf8086 Can you provide a timeline for the double resume case?", "url": "https://github.com/Alluxio/alluxio/pull/12269#discussion_r504308620", "createdAt": "2020-10-13T23:07:45Z", "author": {"login": "LuQQiu"}, "path": "core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java", "diffHunk": "@@ -537,8 +537,12 @@ public synchronized void suspend(Runnable interruptCallback) throws IOException\n   public synchronized void resume() throws IOException {\n     LOG.info(\"Resuming raft state machine\");\n     mInterruptCallback = null;\n-    mJournalApplier.resume();\n-    LOG.info(\"Raft state machine resumed\");\n+    if (mJournalApplier.isSuspended()) {\n+      mJournalApplier.resume();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e01bd099287d26945b2e282e96edb3a9793e36c8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTY4MTI1", "url": "https://github.com/Alluxio/alluxio/pull/12269#pullrequestreview-507968125", "createdAt": "2020-10-14T03:25:58Z", "commit": {"oid": "e01bd099287d26945b2e282e96edb3a9793e36c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3538, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}