{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MzQ0MDg2", "number": 12449, "title": "Log slow remote reads and writes", "bodyText": "For worker remote reads and writes, if a particular read or write takes longer than expected, we log (via the sampling logger) a message to give a sense of the delays.", "createdAt": "2020-11-02T21:46:20Z", "url": "https://github.com/Alluxio/alluxio/pull/12449", "merged": true, "mergeCommit": {"oid": "d8193189a3de15cc01cfb315cb9c981b08b13e3e"}, "closed": true, "closedAt": "2020-11-03T22:57:15Z", "author": {"login": "gpang"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYrsM-gH2gAyNTE0MzQ0MDg2OjI1MzdiNTljMjE5NGEyNGY2OWUxYmU0ZWIyNzg5MmFiMWU0ZGFmYTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZA-sMgFqTUyMjkyMzIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2537b59c2194a24f69e1be4eb27892ab1e4dafa2", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/2537b59c2194a24f69e1be4eb27892ab1e4dafa2", "committedDate": "2020-11-02T21:45:37Z", "message": "Log slow remote reads and writes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "368314d8494ee12e84a97b4874729e9df5296189", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/368314d8494ee12e84a97b4874729e9df5296189", "committedDate": "2020-11-02T22:32:19Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/f6cd18ec2663295a308db0126ee29fd7c876cb84", "committedDate": "2020-11-02T23:25:04Z", "message": "Fix naming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTQ2OTg4", "url": "https://github.com/Alluxio/alluxio/pull/12449#pullrequestreview-522146988", "createdAt": "2020-11-03T01:48:08Z", "commit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo0ODowOFrOHsd0XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTo1MTozNlrOHsd4Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw==", "bodyText": "Is there any value in making this configurable?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516387933", "createdAt": "2020-11-03T01:48:08Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4ODkwMg==", "bodyText": "For the sampling logger, is it possible to retain a count of how many were skipped due to sampling?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516388902", "createdAt": "2020-11-03T01:51:36Z", "author": {"login": "calvinjia"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "diffHunk": "@@ -58,6 +60,8 @@\n   private static final Logger LOG = LoggerFactory.getLogger(BlockReadHandler.class);\n   private static final long UFS_BLOCK_OPEN_TIMEOUT_MS =\n       ServerConfiguration.getMs(PropertyKey.WORKER_UFS_BLOCK_OPEN_TIMEOUT_MS);\n+  private static final Logger SLOW_BUFFER_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNzgwMzkx", "url": "https://github.com/Alluxio/alluxio/pull/12449#pullrequestreview-522780391", "createdAt": "2020-11-03T18:42:56Z", "commit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxODo0Mjo1NlrOHs74Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxODo1MzoyN1rOHs8PKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4MDM5MQ==", "bodyText": "It would be possible, but I think that functionality should go into a separate PR.", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516880391", "createdAt": "2020-11-03T18:42:56Z", "author": {"login": "gpang"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/BlockReadHandler.java", "diffHunk": "@@ -58,6 +60,8 @@\n   private static final Logger LOG = LoggerFactory.getLogger(BlockReadHandler.class);\n   private static final long UFS_BLOCK_OPEN_TIMEOUT_MS =\n       ServerConfiguration.getMs(PropertyKey.WORKER_UFS_BLOCK_OPEN_TIMEOUT_MS);\n+  private static final Logger SLOW_BUFFER_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4ODkwMg=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg4NjMxNQ==", "bodyText": "Yeah, I was torn about this. My concern was that there could be too many logging thresholds to configure, which could be confusing.\nOn the other hand, the hardcoded threshold may not be correct or reasonable.\nI guess we could combine the read and write threshold into something like \"worker.remote.read.slow.io.threshold\"? That could handle both the read and write case?\nWhat do you think?", "url": "https://github.com/Alluxio/alluxio/pull/12449#discussion_r516886315", "createdAt": "2020-11-03T18:53:27Z", "author": {"login": "gpang"}, "path": "core/server/worker/src/main/java/alluxio/worker/grpc/AbstractWriteHandler.java", "diffHunk": "@@ -59,6 +61,8 @@\n @NotThreadSafe\n abstract class AbstractWriteHandler<T extends WriteRequestContext<?>> {\n   private static final Logger LOG = LoggerFactory.getLogger(AbstractWriteHandler.class);\n+  private static final Logger SLOW_WRITE_LOG = new SamplingLogger(LOG, 5 * Constants.MINUTE_MS);\n+  private static final long SLOW_WRITE_MS = 10 * Constants.SECOND_MS;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM4NzkzMw=="}, "originalCommit": {"oid": "f6cd18ec2663295a308db0126ee29fd7c876cb84"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ab7889ef807f269f7fa8f2c0729d933cb9da43", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/f1ab7889ef807f269f7fa8f2c0729d933cb9da43", "committedDate": "2020-11-03T21:14:12Z", "message": "Create a configuration slow threshold"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e69025fe01662d068d8901fce8ff4fbf24d4d5", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/77e69025fe01662d068d8901fce8ff4fbf24d4d5", "committedDate": "2020-11-03T22:00:48Z", "message": "Merge remote-tracking branch 'upstream/master' into dee-logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2d261afb883e8a1ef286518d6504bbeee09795", "author": {"user": {"login": "gpang", "name": "Gene Pang"}}, "url": "https://github.com/Alluxio/alluxio/commit/bd2d261afb883e8a1ef286518d6504bbeee09795", "committedDate": "2020-11-03T22:05:19Z", "message": "Fix compile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTIzMjAx", "url": "https://github.com/Alluxio/alluxio/pull/12449#pullrequestreview-522923201", "createdAt": "2020-11-03T22:33:49Z", "commit": {"oid": "bd2d261afb883e8a1ef286518d6504bbeee09795"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3389, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}