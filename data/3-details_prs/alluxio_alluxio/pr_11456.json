{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDI1MjQ4", "number": 11456, "title": "Clean up state on failed PUT", "bodyText": "When LocalPageStore failed to put a page due to reasons like disk full, the state was not cleaned in LocalCacheManager. This PR addes\n\nLogic to clean up the state on failed page put in meta store\nLogic to clean up a page on failed page get\nTests", "createdAt": "2020-05-20T21:19:24Z", "url": "https://github.com/Alluxio/alluxio/pull/11456", "merged": true, "mergeCommit": {"oid": "421b86669bd5f1969e11f3a9a8f763fddcf68a26"}, "closed": true, "closedAt": "2020-05-21T01:45:22Z", "author": {"login": "apc999"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjP0EkgH2gAyNDIxMDI1MjQ4OjQ5ZmE1ZjAwMmZhYjdhMGQyZmJjMDk0YzJiZTRiMDFhMjQxYjZhMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjP8ncgFqTQxNTcyNzE3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49fa5f002fab7a0d2fbc094c2be4b01a241b6a39", "author": {"user": {"login": "apc999", "name": "Bin Fan"}}, "url": "https://github.com/Alluxio/alluxio/commit/49fa5f002fab7a0d2fbc094c2be4b01a241b6a39", "committedDate": "2020-05-20T21:18:53Z", "message": "Clean up state on failed PUT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzI0OTEy", "url": "https://github.com/Alluxio/alluxio/pull/11456#pullrequestreview-415724912", "createdAt": "2020-05-20T21:24:24Z", "commit": {"oid": "49fa5f002fab7a0d2fbc094c2be4b01a241b6a39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMToyNDoyNFrOGYeT2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMToyNDoyNFrOGYeT2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMxNTYxMQ==", "bodyText": "Consider putting this logic into a method?", "url": "https://github.com/Alluxio/alluxio/pull/11456#discussion_r428315611", "createdAt": "2020-05-20T21:24:24Z", "author": {"login": "calvinjia"}, "path": "core/client/fs/src/main/java/alluxio/client/file/cache/LocalCacheManager.java", "diffHunk": "@@ -343,6 +359,14 @@ public ReadableByteChannel get(PageId pageId, int pageOffset) {\n         return null;\n       }\n       ReadableByteChannel ret = getPage(pageId, pageOffset);\n+      if (ret == null) {\n+        // something is wrong to read this page, let's remove it from meta store\n+        try (LockResource r2 = new LockResource(mMetaLock.writeLock())) {\n+          mMetaStore.removePage(pageId);\n+        } catch (PageNotFoundException e) {\n+          // best effort to remove this page from meta store and ignore the exception\n+        }\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49fa5f002fab7a0d2fbc094c2be4b01a241b6a39"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzI3MTc0", "url": "https://github.com/Alluxio/alluxio/pull/11456#pullrequestreview-415727174", "createdAt": "2020-05-20T21:28:13Z", "commit": {"oid": "49fa5f002fab7a0d2fbc094c2be4b01a241b6a39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4662, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}