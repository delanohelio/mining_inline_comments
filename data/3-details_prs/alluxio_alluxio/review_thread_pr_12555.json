{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNjMzODM1", "number": 12555, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzoyMjowOVrOE7KT2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozMDowMVrOE7KgtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDcwMzYwOnYy", "diffSide": "RIGHT", "path": "stress/shell/src/main/java/alluxio/stress/cli/report/GenerateReport.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzoyMjowOVrOH2pb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODowMzozOFrOH2rGYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NDA1Nw==", "bodyText": "Want to add @VisibleForTesting?", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527064057", "createdAt": "2020-11-19T17:22:09Z", "author": {"login": "bradyoo"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/report/GenerateReport.java", "diffHunk": "@@ -57,10 +57,18 @@ public static void main(String[] args) {\n     new GenerateReport().run(args);\n   }\n \n-  GenerateReport() {\n+  /**\n+   * Creates an instance.\n+   */\n+  public GenerateReport() {\n   }\n \n-  private void run(String[] args) {\n+  /**\n+   * Runs the report generation tool.\n+   *\n+   * @param args the args\n+   */\n+  public void run(String[] args) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5MTI5Ng==", "bodyText": "Done", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527091296", "createdAt": "2020-11-19T18:03:38Z", "author": {"login": "gpang"}, "path": "stress/shell/src/main/java/alluxio/stress/cli/report/GenerateReport.java", "diffHunk": "@@ -57,10 +57,18 @@ public static void main(String[] args) {\n     new GenerateReport().run(args);\n   }\n \n-  GenerateReport() {\n+  /**\n+   * Creates an instance.\n+   */\n+  public GenerateReport() {\n   }\n \n-  private void run(String[] args) {\n+  /**\n+   * Runs the report generation tool.\n+   *\n+   * @param args the args\n+   */\n+  public void run(String[] args) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NDA1Nw=="}, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDcxNjE5OnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/alluxio/stress/StressClientIOBenchIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzoyNToxMlrOH2pj6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoyNTowMFrOH2r7IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NjA4OQ==", "bodyText": "I think we should be using different name then output since output is used multiple times here to mean different things.", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527066089", "createdAt": "2020-11-19T17:25:12Z", "author": {"login": "bradyoo"}, "path": "tests/src/test/java/alluxio/stress/StressClientIOBenchIntegrationTest.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import alluxio.stress.cli.client.StressClientIOBench;\n+import alluxio.stress.cli.report.GenerateReport;\n+import alluxio.testutils.BaseIntegrationTest;\n+import alluxio.testutils.LocalAlluxioClusterResource;\n+\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestRule;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/**\n+ * Tests {@link StressClientIOBench}.\n+ */\n+public class StressClientIOBenchIntegrationTest extends BaseIntegrationTest {\n+  @ClassRule\n+  public static LocalAlluxioClusterResource sLocalAlluxioClusterResource =\n+      new LocalAlluxioClusterResource.Builder().build();\n+\n+  @Rule\n+  public TestRule mResetRule = sLocalAlluxioClusterResource.getResetResource();\n+\n+  @Rule\n+  public TemporaryFolder mFolder = new TemporaryFolder();\n+\n+  @Test\n+  public void readArray() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output1 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--tag\", \"ReadArray-NOT_RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"ReadArray\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    String output2 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--read-random\",\n+        \"--tag\", \"ReadArray-RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"ReadArray\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+    generateAndVerifyReport(Arrays.asList(\"ReadArray-NOT_RANDOM\", \"ReadArray-RANDOM\"), output1,\n+        output2);\n+  }\n+\n+  @Test\n+  public void posRead() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output1 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--tag\", \"PosRead-NOT_RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"PosRead\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    String output2 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--read-random\",\n+        \"--tag\", \"PosRead-RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"PosRead\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+    generateAndVerifyReport(Arrays.asList(\"PosRead-NOT_RANDOM\", \"PosRead-RANDOM\"), output1,\n+        output2);\n+  }\n+\n+  private void generateAndVerifyReport(List<String> expectedGraphNames, String... outputJson)\n+      throws Exception {\n+    List<String> args = new ArrayList<>();\n+\n+    // write out the jsons outputs to files (for the input of generate)\n+    for (String output : outputJson) {\n+      File input = mFolder.newFile();\n+      try (FileWriter writer = new FileWriter(input)) {\n+        writer.write(output);\n+      }\n+      args.add(\"--input\");\n+      args.add(input.getAbsolutePath());\n+    }\n+\n+    // generate the output\n+    File output = mFolder.newFile(\"report.html\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwNDgwMQ==", "bodyText": "Renamed", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527104801", "createdAt": "2020-11-19T18:25:00Z", "author": {"login": "gpang"}, "path": "tests/src/test/java/alluxio/stress/StressClientIOBenchIntegrationTest.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import alluxio.stress.cli.client.StressClientIOBench;\n+import alluxio.stress.cli.report.GenerateReport;\n+import alluxio.testutils.BaseIntegrationTest;\n+import alluxio.testutils.LocalAlluxioClusterResource;\n+\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestRule;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/**\n+ * Tests {@link StressClientIOBench}.\n+ */\n+public class StressClientIOBenchIntegrationTest extends BaseIntegrationTest {\n+  @ClassRule\n+  public static LocalAlluxioClusterResource sLocalAlluxioClusterResource =\n+      new LocalAlluxioClusterResource.Builder().build();\n+\n+  @Rule\n+  public TestRule mResetRule = sLocalAlluxioClusterResource.getResetResource();\n+\n+  @Rule\n+  public TemporaryFolder mFolder = new TemporaryFolder();\n+\n+  @Test\n+  public void readArray() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output1 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--tag\", \"ReadArray-NOT_RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"ReadArray\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    String output2 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--read-random\",\n+        \"--tag\", \"ReadArray-RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"ReadArray\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+    generateAndVerifyReport(Arrays.asList(\"ReadArray-NOT_RANDOM\", \"ReadArray-RANDOM\"), output1,\n+        output2);\n+  }\n+\n+  @Test\n+  public void posRead() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output1 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--tag\", \"PosRead-NOT_RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"PosRead\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    String output2 = new StressClientIOBench().run(new String[] {\n+        \"--in-process\",\n+        \"--read-random\",\n+        \"--tag\", \"PosRead-RANDOM\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/\",\n+        \"--operation\", \"PosRead\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+    generateAndVerifyReport(Arrays.asList(\"PosRead-NOT_RANDOM\", \"PosRead-RANDOM\"), output1,\n+        output2);\n+  }\n+\n+  private void generateAndVerifyReport(List<String> expectedGraphNames, String... outputJson)\n+      throws Exception {\n+    List<String> args = new ArrayList<>();\n+\n+    // write out the jsons outputs to files (for the input of generate)\n+    for (String output : outputJson) {\n+      File input = mFolder.newFile();\n+      try (FileWriter writer = new FileWriter(input)) {\n+        writer.write(output);\n+      }\n+      args.add(\"--input\");\n+      args.add(input.getAbsolutePath());\n+    }\n+\n+    // generate the output\n+    File output = mFolder.newFile(\"report.html\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2NjA4OQ=="}, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDczNjUyOnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/alluxio/stress/StressWorkerBenchIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozMDowMVrOH2pwzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoyNToyNlrOH2r8IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2OTM5MQ==", "bodyText": "generateAndVerifyReport looks exactly the same between all 3 of these integration tests and probably would benefit from having a common super class.", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527069391", "createdAt": "2020-11-19T17:30:01Z", "author": {"login": "bradyoo"}, "path": "tests/src/test/java/alluxio/stress/StressWorkerBenchIntegrationTest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import alluxio.stress.cli.report.GenerateReport;\n+import alluxio.stress.cli.worker.StressWorkerBench;\n+import alluxio.testutils.BaseIntegrationTest;\n+import alluxio.testutils.LocalAlluxioClusterResource;\n+\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestRule;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Tests {@link StressWorkerBench}.\n+ */\n+public class StressWorkerBenchIntegrationTest extends BaseIntegrationTest {\n+  @ClassRule\n+  public static LocalAlluxioClusterResource sLocalAlluxioClusterResource =\n+      new LocalAlluxioClusterResource.Builder().build();\n+\n+  @Rule\n+  public TestRule mResetRule = sLocalAlluxioClusterResource.getResetResource();\n+\n+  @Rule\n+  public TemporaryFolder mFolder = new TemporaryFolder();\n+\n+  @Test\n+  public void readArray() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output = new StressWorkerBench().run(new String[] {\n+        \"--in-process\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/stress-worker-base/\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    generateAndVerifyReport(Collections.singletonList(\"Worker Throughput\"), output);\n+  }\n+\n+  private void generateAndVerifyReport(List<String> expectedGraphNames, String... outputJson)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwNTA1Ng==", "bodyText": "Thanks! I forgot to refactor this out... I fixed it now.", "url": "https://github.com/Alluxio/alluxio/pull/12555#discussion_r527105056", "createdAt": "2020-11-19T18:25:26Z", "author": {"login": "gpang"}, "path": "tests/src/test/java/alluxio/stress/StressWorkerBenchIntegrationTest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.stress;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import alluxio.stress.cli.report.GenerateReport;\n+import alluxio.stress.cli.worker.StressWorkerBench;\n+import alluxio.testutils.BaseIntegrationTest;\n+import alluxio.testutils.LocalAlluxioClusterResource;\n+\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestRule;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Tests {@link StressWorkerBench}.\n+ */\n+public class StressWorkerBenchIntegrationTest extends BaseIntegrationTest {\n+  @ClassRule\n+  public static LocalAlluxioClusterResource sLocalAlluxioClusterResource =\n+      new LocalAlluxioClusterResource.Builder().build();\n+\n+  @Rule\n+  public TestRule mResetRule = sLocalAlluxioClusterResource.getResetResource();\n+\n+  @Rule\n+  public TemporaryFolder mFolder = new TemporaryFolder();\n+\n+  @Test\n+  public void readArray() throws Exception {\n+    // Only in-process will work for unit testing.\n+    String output = new StressWorkerBench().run(new String[] {\n+        \"--in-process\",\n+        \"--start-ms\", Long.toString(System.currentTimeMillis() + 1000),\n+        \"--base\", sLocalAlluxioClusterResource.get().getMasterURI() + \"/stress-worker-base/\",\n+        \"--threads\", \"2\",\n+        \"--file-size\", \"1m\",\n+        \"--block-size\", \"128k\",\n+        \"--warmup\", \"0s\", \"--duration\", \"1s\",\n+    });\n+\n+    generateAndVerifyReport(Collections.singletonList(\"Worker Throughput\"), output);\n+  }\n+\n+  private void generateAndVerifyReport(List<String> expectedGraphNames, String... outputJson)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2OTM5MQ=="}, "originalCommit": {"oid": "7c7925925eb12d4fa9b407b18b07bd0e2aef1879"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1060, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}