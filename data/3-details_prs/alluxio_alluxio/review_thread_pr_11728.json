{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzYyNDgw", "number": 11728, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzozODo1NlrOEMR3HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo0MjowNFrOEMR5aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzExMDA1OnYy", "diffSide": "RIGHT", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzozODo1NlrOGuTMrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyMjoxOFrOGuU2ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjIyMA==", "bodyText": "Instead of creating a new object, we can use Collections.emptyMap()", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202220", "createdAt": "2020-07-07T23:38:56Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTM0Mg==", "bodyText": "Changed.", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229342", "createdAt": "2020-07-08T01:22:18Z", "author": {"login": "HelloHorizon"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjIyMA=="}, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzExMzEyOnYy", "diffSide": "RIGHT", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo0MDozMlrOGuTOgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyMjoyNVrOGuU2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjY5MA==", "bodyText": "Why is this defined so far from when it is used?", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202690", "createdAt": "2020-07-07T23:40:32Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();\n     try {\n+      List<Column> partitionColumns;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTM3Ng==", "bodyText": "Changed.", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229376", "createdAt": "2020-07-08T01:22:25Z", "author": {"login": "HelloHorizon"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();\n     try {\n+      List<Column> partitionColumns;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjY5MA=="}, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzExMzgwOnYy", "diffSide": "RIGHT", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo0MDo1NFrOGuTO2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyMjozMFrOGuU23g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjc3OQ==", "bodyText": "Instead of creating a new object, we can just use Collections.emptyList().", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202779", "createdAt": "2020-07-07T23:40:54Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQwNg==", "bodyText": "Changed.", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229406", "createdAt": "2020-07-08T01:22:30Z", "author": {"login": "HelloHorizon"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjc3OQ=="}, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzExNDk1OnYy", "diffSide": "RIGHT", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo0MTozNFrOGuTPoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyMjozNVrOGuU29g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjk3Ng==", "bodyText": "If tableParameters does not need to be mutable, then we can just use Collections.emptyMap()", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202976", "createdAt": "2020-07-07T23:41:34Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQzMA==", "bodyText": "Changed.", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229430", "createdAt": "2020-07-08T01:22:35Z", "author": {"login": "HelloHorizon"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjk3Ng=="}, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzExNTkzOnYy", "diffSide": "RIGHT", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo0MjowNFrOGuTQPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMToyMjozOVrOGuU3Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMzEzNA==", "bodyText": "Instead of creating a new instance, we can use Collections.emptyList()", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451203134", "createdAt": "2020-07-07T23:42:04Z", "author": {"login": "gpang"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n+          // Database name is not required for glue table, use mGlueDbName\n           .setDbName(mGlueDbName)\n           .setTableName(tableName)\n           .addAllDataCols(GlueUtils.toProto(table.getStorageDescriptor().getColumns()))\n           .setStorage(GlueUtils.toProto(table.getStorageDescriptor(), pathTranslator))\n-          .putAllParameters(table.getParameters())\n+          .putAllParameters(tableParameters)\n           .build();\n \n       Layout layout = Layout.newBuilder()\n           .setLayoutType(HiveLayout.TYPE)\n           .setLayoutData(partitionInfo.toByteString())\n           .build();\n \n-      List<Column> partitionColumns = table.getPartitionKeys();\n+      if (table.getPartitionKeys() == null) {\n+        partitionColumns = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQ0Nw==", "bodyText": "Changed.", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229447", "createdAt": "2020-07-08T01:22:39Z", "author": {"login": "HelloHorizon"}, "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n+          // Database name is not required for glue table, use mGlueDbName\n           .setDbName(mGlueDbName)\n           .setTableName(tableName)\n           .addAllDataCols(GlueUtils.toProto(table.getStorageDescriptor().getColumns()))\n           .setStorage(GlueUtils.toProto(table.getStorageDescriptor(), pathTranslator))\n-          .putAllParameters(table.getParameters())\n+          .putAllParameters(tableParameters)\n           .build();\n \n       Layout layout = Layout.newBuilder()\n           .setLayoutType(HiveLayout.TYPE)\n           .setLayoutData(partitionInfo.toByteString())\n           .build();\n \n-      List<Column> partitionColumns = table.getPartitionKeys();\n+      if (table.getPartitionKeys() == null) {\n+        partitionColumns = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMzEzNA=="}, "originalCommit": {"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1407, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}