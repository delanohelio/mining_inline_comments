{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MjEyMTI1", "number": 6709, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDoyODoyNVrODcMaRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDoyODoyNVrODcMaRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwODkwMDUzOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/forms/login/freemarker/model/TotpBean.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDoyODoyNVrOFkHOgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxODowNDowOVrOFkTXvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMTQ1OA==", "bodyText": "Is it possible to keep the \"this.enabled = session.userCredentialManager().isConfiguredFor(realm, user, OTPCredentialModel.TYPE);\" ? Using of \"userCredentialManager\" instead of directly using OTPProvider is preferred way due the case when userStorage is used - some details in https://issues.redhat.com/browse/KEYCLOAK-12386", "url": "https://github.com/keycloak/keycloak/pull/6709#discussion_r373411458", "createdAt": "2020-01-31T10:28:25Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/forms/login/freemarker/model/TotpBean.java", "diffHunk": "@@ -39,11 +44,17 @@\n     private final String totpSecretQrCode;\n     private final boolean enabled;\n     private UriBuilder uriBuilder;\n+    private final List<CredentialModel> otpCredentials;\n \n     public TotpBean(KeycloakSession session, RealmModel realm, UserModel user, UriBuilder uriBuilder) {\n         this.realm = realm;\n         this.uriBuilder = uriBuilder;\n-        this.enabled = session.userCredentialManager().isConfiguredFor(realm, user, OTPCredentialModel.TYPE);\n+        this.enabled = ((OTPCredentialProvider)session.getProvider(CredentialProvider.class, \"keycloak-otp\")).isConfiguredFor(realm, user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfcf3764cc0287743a552134aa982f6b091407d0"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxOTU3MQ==", "bodyText": "Sure, thanks for catching this! Will change to the previous form (tested the result of both variants previously, and it seemed to be identical (maybe just in my particular testing case?), so changed it to the form it has had in the initial MFA change, KEYCLOAK-11745 one on some related place). But will change it to the original form too.", "url": "https://github.com/keycloak/keycloak/pull/6709#discussion_r373419571", "createdAt": "2020-01-31T10:47:46Z", "author": {"login": "iankko"}, "path": "services/src/main/java/org/keycloak/forms/login/freemarker/model/TotpBean.java", "diffHunk": "@@ -39,11 +44,17 @@\n     private final String totpSecretQrCode;\n     private final boolean enabled;\n     private UriBuilder uriBuilder;\n+    private final List<CredentialModel> otpCredentials;\n \n     public TotpBean(KeycloakSession session, RealmModel realm, UserModel user, UriBuilder uriBuilder) {\n         this.realm = realm;\n         this.uriBuilder = uriBuilder;\n-        this.enabled = session.userCredentialManager().isConfiguredFor(realm, user, OTPCredentialModel.TYPE);\n+        this.enabled = ((OTPCredentialProvider)session.getProvider(CredentialProvider.class, \"keycloak-otp\")).isConfiguredFor(realm, user);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMTQ1OA=="}, "originalCommit": {"oid": "dfcf3764cc0287743a552134aa982f6b091407d0"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxMDQzMQ==", "bodyText": "@mposolda\nFixed in the 2nd commit (intentionally kept it separate, so the changes from the original version are better visible). Will squash them into one, once the change is OK.", "url": "https://github.com/keycloak/keycloak/pull/6709#discussion_r373610431", "createdAt": "2020-01-31T18:04:09Z", "author": {"login": "iankko"}, "path": "services/src/main/java/org/keycloak/forms/login/freemarker/model/TotpBean.java", "diffHunk": "@@ -39,11 +44,17 @@\n     private final String totpSecretQrCode;\n     private final boolean enabled;\n     private UriBuilder uriBuilder;\n+    private final List<CredentialModel> otpCredentials;\n \n     public TotpBean(KeycloakSession session, RealmModel realm, UserModel user, UriBuilder uriBuilder) {\n         this.realm = realm;\n         this.uriBuilder = uriBuilder;\n-        this.enabled = session.userCredentialManager().isConfiguredFor(realm, user, OTPCredentialModel.TYPE);\n+        this.enabled = ((OTPCredentialProvider)session.getProvider(CredentialProvider.class, \"keycloak-otp\")).isConfiguredFor(realm, user);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMTQ1OA=="}, "originalCommit": {"oid": "dfcf3764cc0287743a552134aa982f6b091407d0"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3849, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}