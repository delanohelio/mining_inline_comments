{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMTY4MzAx", "number": 7656, "title": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy", "bodyText": "When using X509 Client Certificate authentication, sometimes you need to enforce that the X509 certificate presented to Keycloak has some specific values in the \"Certificate Policy\" extension field (for example, all Italian National CNS/CIE smart cards have one of two specific policy values).\nThis pull request adds a parameter to allow the user to specify any required Certificate Policy OID and another parameter to choose whether they are all required (ALL) or if having only one of them is enough (ANY). Default is ALL.\n\nIf no Certificate Policy is specified then no additional validation happens.", "createdAt": "2020-12-02T17:18:34Z", "url": "https://github.com/keycloak/keycloak/pull/7656", "merged": true, "mergeCommit": {"oid": "9838a47662101783976265c03235601ccc7451e8"}, "closed": true, "closedAt": "2021-09-30T14:36:06Z", "author": {"login": "lscorcia"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiSy2zABqjQwNjM3ODIxNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABfAMVb8gFqTc1ODU0MzkwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc19d13e33128cdf1337ac75e26718da7b5cbab2", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/dc19d13e33128cdf1337ac75e26718da7b5cbab2", "committedDate": "2020-12-02T17:15:09Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "24f6d5f1d63c4508f1666d380c1c48034bd09c38", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/24f6d5f1d63c4508f1666d380c1c48034bd09c38", "committedDate": "2020-12-02T18:22:36Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24f6d5f1d63c4508f1666d380c1c48034bd09c38", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/24f6d5f1d63c4508f1666d380c1c48034bd09c38", "committedDate": "2020-12-02T18:22:36Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "88b7ee8d0069abcd14d106574835977040c7c6fd", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/88b7ee8d0069abcd14d106574835977040c7c6fd", "committedDate": "2020-12-03T15:07:32Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88b7ee8d0069abcd14d106574835977040c7c6fd", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/88b7ee8d0069abcd14d106574835977040c7c6fd", "committedDate": "2020-12-03T15:07:32Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "7db39fadc928a34bbc058a7fd98ff9325c045c6e", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/7db39fadc928a34bbc058a7fd98ff9325c045c6e", "committedDate": "2020-12-03T16:24:08Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7db39fadc928a34bbc058a7fd98ff9325c045c6e", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/7db39fadc928a34bbc058a7fd98ff9325c045c6e", "committedDate": "2020-12-03T16:24:08Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "b8a76e38455437b1dc10ef90f8ec00e2254ddaad", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/b8a76e38455437b1dc10ef90f8ec00e2254ddaad", "committedDate": "2021-01-13T14:22:47Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4Mjg3NjIw", "url": "https://github.com/keycloak/keycloak/pull/7656#pullrequestreview-568287620", "createdAt": "2021-01-14T14:32:05Z", "commit": {"oid": "b8a76e38455437b1dc10ef90f8ec00e2254ddaad"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6f657fe5566a5f1c4163ce965f0ed028fc504d2", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/d6f657fe5566a5f1c4163ce965f0ed028fc504d2", "committedDate": "2021-06-23T06:59:08Z", "message": "Merge branch 'master' into KEYCLOAK-16520"}, "afterCommit": {"oid": "98d9b60fa7f072a09dc7cf2ddab97bba41cdf0d4", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/98d9b60fa7f072a09dc7cf2ddab97bba41cdf0d4", "committedDate": "2021-06-23T07:12:35Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98d9b60fa7f072a09dc7cf2ddab97bba41cdf0d4", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/98d9b60fa7f072a09dc7cf2ddab97bba41cdf0d4", "committedDate": "2021-06-23T07:12:35Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "ecfc0b9cb61a93979979a65a6ec3c0143de29d15", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/ecfc0b9cb61a93979979a65a6ec3c0143de29d15", "committedDate": "2021-09-13T14:02:02Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOAKnDVc4tCPsn", "url": "https://github.com/keycloak/keycloak/pull/7656#pullrequestreview-755563303", "createdAt": "2021-09-15T19:56:15Z", "commit": {"oid": "ecfc0b9cb61a93979979a65a6ec3c0143de29d15"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNVQxOTo1NjoxNVrOKkqMrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0xNVQxOTo1Njo0MVrOKkqNsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "PRRC_kwDOAKnDVc4qSoyt", "bodyText": "Perhaps we should mention here the possibility to provide a comma-separated list of OIDs?", "url": "https://github.com/keycloak/keycloak/pull/7656#discussion_r709528749", "createdAt": "2021-09-15T19:56:15Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/authentication/authenticators/x509/AbstractX509ClientCertificateAuthenticatorFactory.java", "diffHunk": "@@ -201,6 +206,22 @@\n         extendedKeyUsage.setLabel(\"Validate Extended Key Usage\");\n         extendedKeyUsage.setHelpText(\"Validates the extended purposes of the certificate's key using certificate's Extended Key Usage extension. Leaving the field blank will disable Extended Key Usage validation. See RFC 5280 for a detailed definition of X509 Extended Key Usage extension.\");\n \n+        ProviderConfigProperty certificatePolicy = new ProviderConfigProperty();\n+        certificatePolicy.setType(STRING_TYPE);\n+        certificatePolicy.setName(CERTIFICATE_POLICY);\n+        certificatePolicy.setLabel(\"Validate Certificate Policy\");\n+        certificatePolicy.setHelpText(\"Validates the certificate policies of the certificate's key using certificate's Policy extension. Leaving the field blank will disable Certificate Policies validation. See RFC 5280 for a detailed definition of X509 Certificate Policy extension.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecfc0b9cb61a93979979a65a6ec3c0143de29d15"}, "originalPosition": 20}, {"id": "PRRC_kwDOAKnDVc4qSo2w", "bodyText": "Could you please use upper-case in constant names as you did for others?", "url": "https://github.com/keycloak/keycloak/pull/7656#discussion_r709529008", "createdAt": "2021-09-15T19:56:41Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/authentication/authenticators/x509/AbstractX509ClientCertificateAuthenticatorFactory.java", "diffHunk": "@@ -87,6 +87,11 @@\n             USERNAME_EMAIL_MAPPER\n     };\n \n+    private static final String[] certificatePolicyModes = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecfc0b9cb61a93979979a65a6ec3c0143de29d15"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ecfc0b9cb61a93979979a65a6ec3c0143de29d15", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/ecfc0b9cb61a93979979a65a6ec3c0143de29d15", "committedDate": "2021-09-13T14:02:02Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "3477bc47573c6702c3ef3436834a936da75a461c", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/3477bc47573c6702c3ef3436834a936da75a461c", "committedDate": "2021-09-20T11:50:59Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "098bc7556b46e0b20f0e0ebf919716c560f07ff9", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/098bc7556b46e0b20f0e0ebf919716c560f07ff9", "committedDate": "2021-09-20T11:55:52Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3477bc47573c6702c3ef3436834a936da75a461c", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/3477bc47573c6702c3ef3436834a936da75a461c", "committedDate": "2021-09-20T11:50:59Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}, "afterCommit": {"oid": "098bc7556b46e0b20f0e0ebf919716c560f07ff9", "author": {"user": {"login": "lscorcia", "name": "Luca Leonardo Scorcia"}}, "url": "https://github.com/keycloak/keycloak/commit/098bc7556b46e0b20f0e0ebf919716c560f07ff9", "committedDate": "2021-09-20T11:55:52Z", "message": "KEYCLOAK-16520 X509 Auth: Add option to verify certificate policy"}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOAKnDVc4tNnYg", "url": "https://github.com/keycloak/keycloak/pull/7656#pullrequestreview-758543904", "createdAt": "2021-09-20T12:01:49Z", "commit": {"oid": "098bc7556b46e0b20f0e0ebf919716c560f07ff9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3295, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}