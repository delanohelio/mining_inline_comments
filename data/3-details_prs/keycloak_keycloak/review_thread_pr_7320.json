{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzgzMzk0", "number": 7320, "reviewThreads": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoxMzozNFrOEV0oCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0OToxOFrOEwHfNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzE3NzcxOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_ca.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoxMzozNFrOG8y6RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjowNToyM1rOHFr8Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQwMTg2MQ==", "bodyText": "Do we need the lines at all ? The same goes for changes in other property files.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r466401861", "createdAt": "2020-08-06T13:13:34Z", "author": {"login": "pedroigor"}, "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_ca.properties", "diffHunk": "@@ -62,6 +62,9 @@ i18n-enabled=Internacionalitzaci\\u00F3 activa\n supported-locales=Idiomes suportats\n supported-locales.placeholder=Indica l''idioma i prem Intro\n default-locale=Idioma per defecte\n+#localization-upload-file=Upload localization JSON file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e94ce71af120772cda3c7573880880362fc34bda"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyNDg5NA==", "bodyText": "I thought it might be helpful for someone who will translate missing localization keys. If there are in the file, he / she does not need to search for the keys in the English version.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r475724894", "createdAt": "2020-08-24T16:05:23Z", "author": {"login": "leischt"}, "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_ca.properties", "diffHunk": "@@ -62,6 +62,9 @@ i18n-enabled=Internacionalitzaci\\u00F3 activa\n supported-locales=Idiomes suportats\n supported-locales.placeholder=Indica l''idioma i prem Intro\n default-locale=Idioma per defecte\n+#localization-upload-file=Upload localization JSON file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQwMTg2MQ=="}, "originalCommit": {"oid": "e94ce71af120772cda3c7573880880362fc34bda"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzIwNTg2OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmLocalizationResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyMDoyM1rOG8zLNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjowNTo1NlrOHFr9wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQwNjE5OA==", "bodyText": "In other places, where users upload files, we don't deal with the input stream directly and do not propagate it to downstream layers.\nI'm wondering if is not the case of expecting a Map already populated from the JSON payload.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r466406198", "createdAt": "2020-08-06T13:20:23Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmLocalizationResource.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.services.resources.admin;\n+\n+import org.jboss.resteasy.plugins.providers.multipart.InputPart;\n+import org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataInput;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.ModelDuplicateException;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.cache.CacheRealmProvider;\n+import org.keycloak.services.resources.admin.permissions.AdminPermissionEvaluator;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.Map;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.PATCH;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+\n+public class RealmLocalizationResource {\n+    private final RealmModel realm;\n+    private final AdminPermissionEvaluator auth;\n+\n+    @Context\n+    protected KeycloakSession session;\n+\n+    public RealmLocalizationResource(RealmModel realm, AdminPermissionEvaluator auth) {\n+        this.realm = realm;\n+        this.auth = auth;\n+    }\n+\n+    @Path(\"{locale}/{key}\")\n+    @POST\n+    @Consumes(MediaType.TEXT_PLAIN)\n+    public void addRealmLocalizationText(@PathParam(\"locale\") String locale, @PathParam(\"key\") String key,\n+            String text) {\n+        this.auth.realm().requireManageRealm();\n+        try {\n+            session.realmLocalizationProvider().saveLocalizationText(realm.getId(), locale, key, text);\n+        } catch (ModelDuplicateException e) {\n+            throw new BadRequestException(\n+                    String.format(\"Localization text %s for the locale %s and realm %s already exists.\",\n+                            key, locale, realm.getId()));\n+        }\n+    }\n+\n+\n+    /**\n+     * Import localization from uploaded JSON file\n+     */\n+    @POST\n+    @Path(\"{locale}\")\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public void importRealmLocalizationTextsFromFile(@PathParam(\"locale\") String locale, MultipartFormDataInput input)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e94ce71af120772cda3c7573880880362fc34bda"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyNTI0OQ==", "bodyText": "Changed it :)", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r475725249", "createdAt": "2020-08-24T16:05:56Z", "author": {"login": "leischt"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmLocalizationResource.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.services.resources.admin;\n+\n+import org.jboss.resteasy.plugins.providers.multipart.InputPart;\n+import org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataInput;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.ModelDuplicateException;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.cache.CacheRealmProvider;\n+import org.keycloak.services.resources.admin.permissions.AdminPermissionEvaluator;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.Map;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.PATCH;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+\n+public class RealmLocalizationResource {\n+    private final RealmModel realm;\n+    private final AdminPermissionEvaluator auth;\n+\n+    @Context\n+    protected KeycloakSession session;\n+\n+    public RealmLocalizationResource(RealmModel realm, AdminPermissionEvaluator auth) {\n+        this.realm = realm;\n+        this.auth = auth;\n+    }\n+\n+    @Path(\"{locale}/{key}\")\n+    @POST\n+    @Consumes(MediaType.TEXT_PLAIN)\n+    public void addRealmLocalizationText(@PathParam(\"locale\") String locale, @PathParam(\"key\") String key,\n+            String text) {\n+        this.auth.realm().requireManageRealm();\n+        try {\n+            session.realmLocalizationProvider().saveLocalizationText(realm.getId(), locale, key, text);\n+        } catch (ModelDuplicateException e) {\n+            throw new BadRequestException(\n+                    String.format(\"Localization text %s for the locale %s and realm %s already exists.\",\n+                            key, locale, realm.getId()));\n+        }\n+    }\n+\n+\n+    /**\n+     * Import localization from uploaded JSON file\n+     */\n+    @POST\n+    @Path(\"{locale}\")\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public void importRealmLocalizationTextsFromFile(@PathParam(\"locale\") String locale, MultipartFormDataInput input)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQwNjE5OA=="}, "originalCommit": {"oid": "e94ce71af120772cda3c7573880880362fc34bda"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzI0MTA2OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyODoyMVrOG8zgqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyODoyMVrOG8zgqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMTY4OQ==", "bodyText": "I would avoid having the localization from the basic realm representation but use the new endpoint to obtain them, if necessary.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r466411689", "createdAt": "2020-08-06T13:28:21Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "diffHunk": "@@ -92,10 +93,13 @@ public RealmsAdminResource(AdminAuth auth, TokenManager tokenManager) {\n     @NoCache\n     @Produces(MediaType.APPLICATION_JSON)\n     public List<RealmRepresentation> getRealms() {\n+        Map<String, String> realmLocalization;\n+        String userLocale = auth.getToken().getLocale();\n         List<RealmRepresentation> reps = new ArrayList<RealmRepresentation>();\n         List<RealmModel> realms = session.realms().getRealms();\n         for (RealmModel realm : realms) {\n-            addRealmRep(reps, realm);\n+            realmLocalization = session.realms().getRealmLocalizationByLocale(realm.getId(), userLocale);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e94ce71af120772cda3c7573880880362fc34bda"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTM1OTExOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_de.properties", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNjo0ODo0NlrOHK_mWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMzo0Mjo0M1rOHNOCxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4OTgxOA==", "bodyText": "Are changes like this intentional?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r481289818", "createdAt": "2020-09-01T16:48:46Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_de.properties", "diffHunk": "@@ -706,16 +711,16 @@ group.assigned-roles.tooltip=Realm-Rollen die zur Gruppe zugeordnet sind\n #group.effective-roles-client.tooltip=Role mappings for this client. Some roles here might be inherited from a mapped composite role.\n \n group.move.success=Gruppe verschoben.\n-group.remove.confirm.title=Gruppe l\ufffdschen\n-group.remove.confirm.message=Sind Sie sicher, dass Sie die Gruppe \\u201E{{name}}\\u201C l\ufffdschen m\ufffdchten?\n-group.remove.success=Die Gruppe wurde gel\ufffdscht.\n+group.remove.confirm.title=Gruppe l\ufffdschen\n+group.remove.confirm.message=Sind Sie sicher, dass Sie die Gruppe \\u201E{{name}}\\u201C l\ufffdschen m\ufffdchten?\n+group.remove.success=Die Gruppe wurde gel\ufffdscht.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ff3c392e8c19a4980b23ec5ac978b2b3678887"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzYyMzYyMQ==", "bodyText": "Sorry it seemed to be an encoding problem on my side. Should be fixed now.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r483623621", "createdAt": "2020-09-04T13:42:43Z", "author": {"login": "leischt"}, "path": "themes/src/main/resources-community/theme/base/admin/messages/admin-messages_de.properties", "diffHunk": "@@ -706,16 +711,16 @@ group.assigned-roles.tooltip=Realm-Rollen die zur Gruppe zugeordnet sind\n #group.effective-roles-client.tooltip=Role mappings for this client. Some roles here might be inherited from a mapped composite role.\n \n group.move.success=Gruppe verschoben.\n-group.remove.confirm.title=Gruppe l\ufffdschen\n-group.remove.confirm.message=Sind Sie sicher, dass Sie die Gruppe \\u201E{{name}}\\u201C l\ufffdschen m\ufffdchten?\n-group.remove.success=Die Gruppe wurde gel\ufffdscht.\n+group.remove.confirm.title=Gruppe l\ufffdschen\n+group.remove.confirm.message=Sind Sie sicher, dass Sie die Gruppe \\u201E{{name}}\\u201C l\ufffdschen m\ufffdchten?\n+group.remove.success=Die Gruppe wurde gel\ufffdscht.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4OTgxOA=="}, "originalCommit": {"oid": "c7ff3c392e8c19a4980b23ec5ac978b2b3678887"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzE5Njc5OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxODo1OTo1MFrOHUYlOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxODo1OTo1MFrOHUYlOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTEzNjMxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(Current.realm != null && currentRealm != Current.realm.id) {\n          \n          \n            \n                    if(Current.realm !== null && currentRealm !== Current.realm.id) {", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491136314", "createdAt": "2020-09-18T18:59:50Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -97,6 +97,18 @@ module.controller('GlobalCtrl', function($scope, $http, Auth, Current, $location\n         $scope.fragment = $location.path();\n         $scope.path = $location.path().substring(1).split(\"/\");\n     });\n+\n+    $scope.$watch(function() {\n+        return Current.realm;\n+    }, function() {\n+        if(Current.realm != null && currentRealm != Current.realm.id) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIxNTM4OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNjo0MlrOHUYxQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNjo0MlrOHUYxQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTEzOTM5NQ==", "bodyText": "I think we should remove this.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491139395", "createdAt": "2020-09-18T19:06:42Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");\n+            return;\n+        }\n+        //$files: an array of files selected, each file has name, size, and type.\n+        for (var i = 0; i < $scope.files.length; i++) {\n+            var $file = $scope.files[i];\n+            $scope.upload = $upload.upload({\n+                url: authUrl + '/admin/realms/' + realm.realm + '/localization/' + $scope.locale,\n+                file: $file\n+            }).progress(function(evt) {\n+                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIxODM5OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNzo1MFrOHUYzPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNzo1MFrOHUYzPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTEzOTkwMw==", "bodyText": "Localize.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491139903", "createdAt": "2020-09-18T19:07:50Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");\n+            return;\n+        }\n+        //$files: an array of files selected, each file has name, size, and type.\n+        for (var i = 0; i < $scope.files.length; i++) {\n+            var $file = $scope.files[i];\n+            $scope.upload = $upload.upload({\n+                url: authUrl + '/admin/realms/' + realm.realm + '/localization/' + $scope.locale,\n+                file: $file\n+            }).progress(function(evt) {\n+                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\n+            }).then(function(response) {\n+                $scope.reset();\n+                Notifications.success(\"The localization data has been loaded from file.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIxODcyOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNzo1OFrOHUYzcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowNzo1OFrOHUYzcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTEzOTk1NQ==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491139955", "createdAt": "2020-09-18T19:07:58Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");\n+            return;\n+        }\n+        //$files: an array of files selected, each file has name, size, and type.\n+        for (var i = 0; i < $scope.files.length; i++) {\n+            var $file = $scope.files[i];\n+            $scope.upload = $upload.upload({\n+                url: authUrl + '/admin/realms/' + realm.realm + '/localization/' + $scope.locale,\n+                file: $file\n+            }).progress(function(evt) {\n+                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\n+            }).then(function(response) {\n+                $scope.reset();\n+                Notifications.success(\"The localization data has been loaded from file.\");\n+            }).catch(function() {\n+                Notifications.error(\"The file can not be uploaded. Please verify the file.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIxOTczOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowODoyNlrOHUY0LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowODoyNlrOHUY0LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MDE0MA==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491140140", "createdAt": "2020-09-18T19:08:26Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIyMDEwOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowODozM1rOHUY0Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowODozM1rOHUY0Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MDE5MQ==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491140191", "createdAt": "2020-09-18T19:08:33Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIyMjk1OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowOTozOVrOHUY2Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTowOTozOVrOHUY2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MDY2Mg==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491140662", "createdAt": "2020-09-18T19:09:39Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIyNDYxOnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMDoxMlrOHUY3OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMDoxMlrOHUY3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MDkyMQ==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491140921", "createdAt": "2020-09-18T19:10:12Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIyNTE4OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMDoyNVrOHUY3ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMDoyNVrOHUY3ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MTAyMg==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491141022", "createdAt": "2020-09-18T19:10:25Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");\n+            return;\n+        }\n+        //$files: an array of files selected, each file has name, size, and type.\n+        for (var i = 0; i < $scope.files.length; i++) {\n+            var $file = $scope.files[i];\n+            $scope.upload = $upload.upload({\n+                url: authUrl + '/admin/realms/' + realm.realm + '/localization/' + $scope.locale,\n+                file: $file\n+            }).progress(function(evt) {\n+                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\n+            }).then(function(response) {\n+                $scope.reset();\n+                Notifications.success(\"The localization data has been loaded from file.\");\n+            }).catch(function() {\n+                Notifications.error(\"The file can not be uploaded. Please verify the file.\");\n+            });\n+        }\n+    };\n+\n+});\n+\n+module.controller('RealmLocalizationDetailCtrl', function($scope, Current, $location, Realm, realm, Notifications, locale, key, RealmSpecificLocalizationText, localizationText){\n+    $scope.realm = realm;\n+    $scope.locale = locale;\n+    $scope.key = key;\n+    $scope.value = ((localizationText)? localizationText.content : null);\n+\n+    $scope.create = !key;\n+\n+    $scope.save = function() {\n+        if ($scope.create) {\n+            RealmSpecificLocalizationText.save({\n+                realm: realm.realm,\n+                locale: $scope.locale,\n+                key: $scope.key\n+            }, $scope.value, function (data, headers) {\n+                $location.url(\"/realms/\" + realm.realm + \"/localization/\" + $scope.locale + \"/\" + $scope.key);\n+                Notifications.success(\"The localization text has been created.\");\n+            });\n+        } else {\n+            RealmSpecificLocalizationText.update({\n+                realm: realm.realm,\n+                locale: $scope.locale,\n+                key: $scope.key\n+            }, $scope.value, function (data, headers) {\n+                Notifications.success(\"The localization text has been created.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzIyNzI4OnYy", "diffSide": "RIGHT", "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMToxOVrOHUY48w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToxMToxOVrOHUY48w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0MTM2Mw==", "bodyText": "Localize", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r491141363", "createdAt": "2020-09-18T19:11:19Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/base/admin/resources/js/controllers/realm.js", "diffHunk": "@@ -499,6 +511,132 @@ module.controller('RealmThemeCtrl', function($scope, Current, Realm, realm, serv\n     $scope.$watch('realm.internationalizationEnabled', updateSupported);\n });\n \n+module.controller('RealmLocalizationCtrl', function($scope, Current, Realm, realm, serverInfo, Notifications, RealmSpecificLocales, realmSpecificLocales, RealmSpecificLocalizationTexts, RealmSpecificLocalizationText, Dialog){\n+    $scope.realm = realm;\n+    $scope.realmSpecificLocales = realmSpecificLocales;\n+    $scope.newLocale = null;\n+    $scope.selectedRealmSpecificLocales = null;\n+    $scope.localizationTexts = null;\n+\n+    $scope.createLocale = function() {\n+        if(!$scope.newLocale) {\n+            Notifications.error(\"Missing locale.\");\n+            return;\n+        }\n+        $scope.realmSpecificLocales.push($scope.newLocale)\n+        $scope.selectedRealmSpecificLocales = $scope.newLocale;\n+        $scope.newLocale = null;\n+        Notifications.success(\"Locale was created.\");\n+    }\n+\n+    $scope.$watch(function() {\n+        return $scope.selectedRealmSpecificLocales;\n+    }, function() {\n+        if($scope.selectedRealmSpecificLocales != null) {\n+            $scope.updateRealmSpecificLocalizationTexts();\n+        }\n+    })\n+\n+    $scope.updateRealmSpecificLocales = function() {\n+        RealmSpecificLocales.get({id: realm.realm}, function (updated) {\n+            $scope.realmSpecificLocales = updated;\n+        })\n+    }\n+\n+    $scope.updateRealmSpecificLocalizationTexts = function() {\n+        RealmSpecificLocalizationTexts.get({id: realm.realm, locale: $scope.selectedRealmSpecificLocales }, function (updated) {\n+            $scope.localizationTexts = updated;\n+        })\n+    }\n+\n+    $scope.removeLocalizationText = function(key) {\n+        Dialog.confirmDelete(key, 'localization text', function() {\n+            RealmSpecificLocalizationText.remove({\n+                realm: realm.realm,\n+                locale: $scope.selectedRealmSpecificLocales,\n+                key: key\n+            }, function () {\n+                $scope.updateRealmSpecificLocalizationTexts();\n+                Notifications.success(\"Localization text removed.\");\n+            });\n+        });\n+    }\n+});\n+\n+module.controller('RealmLocalizationUploadCtrl', function($scope, Current, Realm, realm, serverInfo, $http, $route, Dialog, Notifications, $upload){\n+    $scope.realm = realm;\n+    $scope.locale = null;\n+    $scope.files = [];\n+\n+    $scope.onFileSelect = function($files) {\n+        $scope.files = $files;\n+    };\n+\n+    $scope.reset = function() {\n+        $scope.locale = null;\n+        $scope.files = null;\n+    };\n+\n+    $scope.save = function() {\n+\n+        if(!$scope.files || $scope.files.length === 0) {\n+            Notifications.error(\"Missing file. Please select a file to upload.\");\n+            return;\n+        }\n+        //$files: an array of files selected, each file has name, size, and type.\n+        for (var i = 0; i < $scope.files.length; i++) {\n+            var $file = $scope.files[i];\n+            $scope.upload = $upload.upload({\n+                url: authUrl + '/admin/realms/' + realm.realm + '/localization/' + $scope.locale,\n+                file: $file\n+            }).progress(function(evt) {\n+                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\n+            }).then(function(response) {\n+                $scope.reset();\n+                Notifications.success(\"The localization data has been loaded from file.\");\n+            }).catch(function() {\n+                Notifications.error(\"The file can not be uploaded. Please verify the file.\");\n+            });\n+        }\n+    };\n+\n+});\n+\n+module.controller('RealmLocalizationDetailCtrl', function($scope, Current, $location, Realm, realm, Notifications, locale, key, RealmSpecificLocalizationText, localizationText){\n+    $scope.realm = realm;\n+    $scope.locale = locale;\n+    $scope.key = key;\n+    $scope.value = ((localizationText)? localizationText.content : null);\n+\n+    $scope.create = !key;\n+\n+    $scope.save = function() {\n+        if ($scope.create) {\n+            RealmSpecificLocalizationText.save({\n+                realm: realm.realm,\n+                locale: $scope.locale,\n+                key: $scope.key\n+            }, $scope.value, function (data, headers) {\n+                $location.url(\"/realms/\" + realm.realm + \"/localization/\" + $scope.locale + \"/\" + $scope.key);\n+                Notifications.success(\"The localization text has been created.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3OTY5NjQ2OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaRealmLocalizationProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDo1OToxM1rOHVUh-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDo1OToxM1rOHVUh-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjExODUyMQ==", "bodyText": "This provider has many calls to em.flush(). These calls should be called only exceptionally, since they disrupt transaction processing. Are those really necessary?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r492118521", "createdAt": "2020-09-21T14:59:13Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaRealmLocalizationProvider.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.models.jpa;\n+\n+import org.keycloak.models.RealmLocalizationProvider;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.jpa.entities.RealmLocalizationTextEntity;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import javax.persistence.EntityManager;\n+import javax.persistence.TypedQuery;\n+import javax.persistence.criteria.CriteriaBuilder;\n+import javax.persistence.criteria.CriteriaDelete;\n+import javax.persistence.criteria.Root;\n+\n+public class JpaRealmLocalizationProvider implements RealmLocalizationProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e328c4e9ae2a01a009efde83097b9e661fa6c43"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE2NjU2OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo0NFrOHbnZnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo0NFrOHbnZnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxOTEzMw==", "bodyText": "Is this change necessary?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498719133", "createdAt": "2020-10-02T09:38:44Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "diffHunk": "@@ -92,6 +93,8 @@ public RealmsAdminResource(AdminAuth auth, TokenManager tokenManager) {\n     @NoCache\n     @Produces(MediaType.APPLICATION_JSON)\n     public List<RealmRepresentation> getRealms() {\n+        Map<String, String> realmLocalization;\n+        String userLocale = auth.getToken().getLocale();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE2NzA0OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo1MVrOHbnZ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo1MVrOHbnZ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxOTIwMg==", "bodyText": "Is this change necessary?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498719202", "createdAt": "2020-10-02T09:38:51Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "diffHunk": "@@ -107,7 +110,8 @@ public RealmsAdminResource(AdminAuth auth, TokenManager tokenManager) {\n \n     protected void addRealmRep(List<RealmRepresentation> reps, RealmModel realm) {\n         if (AdminPermissions.realms(session, auth).canView(realm)) {\n-            reps.add(ModelToRepresentation.toRepresentation(realm, false));\n+            RealmRepresentation rep = ModelToRepresentation.toRepresentation(realm, false);\n+            reps.add(rep);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE2NzIwOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo1NVrOHbnZ-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozODo1NVrOHbnZ-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxOTIyNg==", "bodyText": "Is this change necessary?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498719226", "createdAt": "2020-10-02T09:38:55Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmsAdminResource.java", "diffHunk": "@@ -51,6 +51,7 @@\n import java.net.URI;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Map;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE2ODQyOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/DefaultKeycloakSession.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozOToyMVrOHbnavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozOToyMVrOHbnavQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxOTQyMQ==", "bodyText": "Are changes in this file necessary?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498719421", "createdAt": "2020-10-02T09:39:21Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/DefaultKeycloakSession.java", "diffHunk": "@@ -203,6 +203,7 @@ public RoleProvider roleLocalStorage() {\n         return getProvider(RoleProvider.class);\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE3NTE4OnYy", "diffSide": "RIGHT", "path": "server-spi/src/main/java/org/keycloak/models/RealmProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0MTo0NFrOHbnfFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0MTo0NFrOHbnfFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMDUzNQ==", "bodyText": "Please keep RealmModel / realmId as the first parameter of the added methods (applies to all of the added methods).\nIs there a reason why there is sometimes String realmId and RealmModel other times? Could this be done consistently with the rest of the methods in this class?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498720535", "createdAt": "2020-10-02T09:41:44Z", "author": {"login": "hmlnarik"}, "path": "server-spi/src/main/java/org/keycloak/models/RealmProvider.java", "diffHunk": "@@ -85,6 +86,18 @@ default GroupModel createGroup(RealmModel realm, String name, GroupModel toParen\n     void removeExpiredClientInitialAccess();\n     void decreaseRemainingCount(RealmModel realm, ClientInitialAccessModel clientInitialAccess); // Separate provider method to ensure we decrease remainingCount atomically instead of doing classic update\n \n+    void saveLocalizationText(String realmId, String locale, String key, String text);\n+\n+    void saveLocalizationTexts(String locale, Map<String, String> localizationTexts, RealmModel realm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE3ODIwOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/services/org.keycloak.models.LocalizationProviderFactory", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0Mjo1MVrOHbng_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0Mjo1MVrOHbng_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMTAyMg==", "bodyText": "Is this file still relevant?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498721022", "createdAt": "2020-10-02T09:42:51Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/services/org.keycloak.models.LocalizationProviderFactory", "diffHunk": "@@ -0,0 +1,18 @@\n+#\n+# Copyright 2016 Red Hat, Inc. and/or its affiliates\n+# and other contributors as indicated by the @author tags.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+# http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+org.keycloak.models.jpa.JpaLocalizationProviderFactory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE4MjI5OnYy", "diffSide": "RIGHT", "path": "server-spi/src/main/java/org/keycloak/models/RealmModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0NDoyNVrOHbnjlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0NDoyNVrOHbnjlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMTY4NQ==", "bodyText": "Please add JavaDoc that describes the algorithm of patching. Is it plain replace or some sort of combination of existing and new items, are any items removed e.g. when a value is null or empty etc.?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498721685", "createdAt": "2020-10-02T09:44:25Z", "author": {"login": "hmlnarik"}, "path": "server-spi/src/main/java/org/keycloak/models/RealmModel.java", "diffHunk": "@@ -558,4 +558,8 @@ default GroupModel createGroup(String name, GroupModel toParent) {\n     void removeDefaultClientScope(ClientScopeModel clientScope);\n     List<ClientScopeModel> getDefaultClientScopes(boolean defaultScope);\n \n+    void patchRealmLocalizationTexts(String locale, Map<String, String> localizationTexts);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE4NTU2OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0NToxOVrOHbnlcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0ODoxMFrOHlenpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMjE2MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <column name=\"REALM_ID\" type=\"VARCHAR(36)\">\n          \n          \n            \n                        <column name=\"REALM_ID\" type=\"VARCHAR(255)\">", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498722161", "createdAt": "2020-10-02T09:45:19Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "diffHunk": "@@ -0,0 +1,36 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+  ~ * and other contributors as indicated by the @author tags.\n+  ~ *\n+  ~ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ * you may not use this file except in compliance with the License.\n+  ~ * You may obtain a copy of the License at\n+  ~ *\n+  ~ * http://www.apache.org/licenses/LICENSE-2.0\n+  ~ *\n+  ~ * Unless required by applicable law or agreed to in writing, software\n+  ~ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ * See the License for the specific language governing permissions and\n+  ~ * limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet author=\"keycloak\" id=\"11.1.0-add-realm-localization-table\">\n+        <createTable tableName=\"REALM_LOCALIZATIONS\">\n+            <column name=\"TEXTS\" type=\"CLOB\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"LOCALE\" type=\"VARCHAR(10)\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"REALM_ID\" type=\"VARCHAR(36)\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTAyOA==", "bodyText": "This requirement needs to be addressed.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r509061028", "createdAt": "2020-10-21T07:48:10Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "diffHunk": "@@ -0,0 +1,36 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+  ~ * and other contributors as indicated by the @author tags.\n+  ~ *\n+  ~ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ * you may not use this file except in compliance with the License.\n+  ~ * You may obtain a copy of the License at\n+  ~ *\n+  ~ * http://www.apache.org/licenses/LICENSE-2.0\n+  ~ *\n+  ~ * Unless required by applicable law or agreed to in writing, software\n+  ~ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ * See the License for the specific language governing permissions and\n+  ~ * limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet author=\"keycloak\" id=\"11.1.0-add-realm-localization-table\">\n+        <createTable tableName=\"REALM_LOCALIZATIONS\">\n+            <column name=\"TEXTS\" type=\"CLOB\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"LOCALE\" type=\"VARCHAR(10)\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"REALM_ID\" type=\"VARCHAR(36)\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMjE2MQ=="}, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE5MTM3OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/converter/MapStringConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0NzoxM1rOHbnpAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTo0NzoxM1rOHbnpAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyMzA3NQ==", "bodyText": "Can org.keycloak.util.JsonSerialization.mapper be used instead of this object?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498723075", "createdAt": "2020-10-02T09:47:13Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/converter/MapStringConverter.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.models.jpa.converter;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import java.util.Map;\n+import javax.persistence.AttributeConverter;\n+import org.jboss.logging.Logger;\n+\n+public class MapStringConverter implements AttributeConverter<Map<String, String>, String> {\n+    private static final ObjectMapper mapper = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjI0Nzc2OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDowNzowOFrOHboMaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDowNzowOFrOHboMaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjEzNg==", "bodyText": "Can the order of the columns be consistent with the other tables, ie. key first (realm_id, locale), and only then the clob?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498732136", "createdAt": "2020-10-02T10:07:08Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "diffHunk": "@@ -0,0 +1,36 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+  ~ * and other contributors as indicated by the @author tags.\n+  ~ *\n+  ~ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ * you may not use this file except in compliance with the License.\n+  ~ * You may obtain a copy of the License at\n+  ~ *\n+  ~ * http://www.apache.org/licenses/LICENSE-2.0\n+  ~ *\n+  ~ * Unless required by applicable law or agreed to in writing, software\n+  ~ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ * See the License for the specific language governing permissions and\n+  ~ * limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet author=\"keycloak\" id=\"11.1.0-add-realm-localization-table\">\n+        <createTable tableName=\"REALM_LOCALIZATIONS\">\n+            <column name=\"TEXTS\" type=\"CLOB\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjI0ODIxOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDowNzoxN1rOHboMtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDowNzoxN1rOHboMtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjIxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <column name=\"LOCALE\" type=\"VARCHAR(10)\">\n          \n          \n            \n                        <column name=\"LOCALE\" type=\"VARCHAR(255)\">", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498732213", "createdAt": "2020-10-02T10:07:17Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-11.1.0.xml", "diffHunk": "@@ -0,0 +1,36 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+  ~ * and other contributors as indicated by the @author tags.\n+  ~ *\n+  ~ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ * you may not use this file except in compliance with the License.\n+  ~ * You may obtain a copy of the License at\n+  ~ *\n+  ~ * http://www.apache.org/licenses/LICENSE-2.0\n+  ~ *\n+  ~ * Unless required by applicable law or agreed to in writing, software\n+  ~ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ * See the License for the specific language governing permissions and\n+  ~ * limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet author=\"keycloak\" id=\"11.1.0-add-realm-localization-table\">\n+        <createTable tableName=\"REALM_LOCALIZATIONS\">\n+            <column name=\"TEXTS\" type=\"CLOB\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"LOCALE\" type=\"VARCHAR(10)\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjI2MjI2OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/entities/RealmEntity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDoxMjowN1rOHboVMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDoxMjowN1rOHboVMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczNDM4Ng==", "bodyText": "RealmAdapter would benefit from this being a Map. Could this be a Map<String, RealmLocalizationTextsEntity> rather than a Collection? Is there a reason for it being a Collection?", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498734386", "createdAt": "2020-10-02T10:12:07Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/entities/RealmEntity.java", "diffHunk": "@@ -243,6 +243,9 @@\n     @Column(name=\"ALLOW_USER_MANAGED_ACCESS\")\n     private boolean allowUserManagedAccess;\n \n+    @OneToMany(cascade ={CascadeType.REMOVE}, orphanRemoval = true, mappedBy = \"realmId\")\n+    Collection<RealmLocalizationTextsEntity> realmLocalizationTexts;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjUwNDA1OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmLocalizationResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMTo0NzozMVrOHbqqWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMTo0NzozMVrOHbqqWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc3MjU2OA==", "bodyText": "The inputstream should be in try-with-resources block to be closed properly.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498772568", "createdAt": "2020-10-02T11:47:31Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/RealmLocalizationResource.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.services.resources.admin;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import java.util.HashMap;\n+import java.util.Set;\n+\n+import org.jboss.resteasy.plugins.providers.multipart.InputPart;\n+import org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataInput;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.ModelDuplicateException;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.services.resources.admin.permissions.AdminPermissionEvaluator;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.Map;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.PATCH;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import org.keycloak.util.JsonSerialization;\n+\n+public class RealmLocalizationResource {\n+    private final RealmModel realm;\n+    private final AdminPermissionEvaluator auth;\n+\n+    @Context\n+    protected KeycloakSession session;\n+\n+    public RealmLocalizationResource(RealmModel realm, AdminPermissionEvaluator auth) {\n+        this.realm = realm;\n+        this.auth = auth;\n+    }\n+\n+    @Path(\"{locale}/{key}\")\n+    @PUT\n+    @Consumes(MediaType.TEXT_PLAIN)\n+    public void saveRealmLocalizationText(@PathParam(\"locale\") String locale, @PathParam(\"key\") String key,\n+            String text) {\n+        this.auth.realm().requireManageRealm();\n+        try {\n+            session.realms().saveLocalizationText(realm.getId(), locale, key, text);\n+        } catch (ModelDuplicateException e) {\n+            throw new BadRequestException(\n+                    String.format(\"Localization text %s for the locale %s and realm %s already exists.\",\n+                            key, locale, realm.getId()));\n+        }\n+    }\n+\n+\n+    /**\n+     * Import localization from uploaded JSON file\n+     */\n+    @POST\n+    @Path(\"{locale}\")\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public void patchRealmLocalizationTextsFromFile(@PathParam(\"locale\") String locale, MultipartFormDataInput input)\n+            throws IOException {\n+        this.auth.realm().requireManageRealm();\n+\n+        Map<String, List<InputPart>> formDataMap = input.getFormDataMap();\n+        if (!formDataMap.containsKey(\"file\")) {\n+            throw new BadRequestException();\n+        }\n+        InputPart file = formDataMap.get(\"file\").get(0);\n+        InputStream inputStream = file.getBody(InputStream.class, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjU0MTk3OnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/RealmAdapter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMjowMjoyNFrOHbrB_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMjowMjoyNFrOHbrB_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc3ODYyMQ==", "bodyText": "Since there is no Hibernate cache, any request to getRealmLocalizationTextsByLocale would read the getRealmLocalizationTexts() in full (all locale), then potentially find one and discard all the rest.\nCould this be done in a way that would either only read one localization bundle or always cache all? The latter may affect infinispan layer as well. This is related to the comment in RealmEntity.", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r498778621", "createdAt": "2020-10-02T12:02:24Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/RealmAdapter.java", "diffHunk": "@@ -2345,6 +2345,56 @@ private ComponentEntity getComponentEntity(String id) {\n         return c;\n     }\n \n+    @Override\n+    public void patchRealmLocalizationTexts(String locale, Map<String, String> localizationTexts) {\n+        Collection<RealmLocalizationTextsEntity> currentLocalizationTexts = realm.getRealmLocalizationTexts();\n+        Optional<RealmLocalizationTextsEntity> localizationTextsEntityOptional = currentLocalizationTexts.stream().filter(t -> locale.equals(t.getLocale())).findAny();\n+        if(localizationTextsEntityOptional.isPresent()) {\n+            RealmLocalizationTextsEntity localizationTextsEntity = localizationTextsEntityOptional.get();\n+            localizationTextsEntity.getTexts().putAll(localizationTexts);\n+\n+            em.persist(localizationTextsEntity);\n+        }\n+        else {\n+            RealmLocalizationTextsEntity realmLocalizationTextsEntity = new RealmLocalizationTextsEntity();\n+            realmLocalizationTextsEntity.setRealmId(realm.getId());\n+            realmLocalizationTextsEntity.setLocale(locale);\n+            realmLocalizationTextsEntity.setTexts(localizationTexts);\n+\n+            em.persist(realmLocalizationTextsEntity);\n+        }\n+    }\n+\n+    @Override\n+    public boolean removeRealmLocalizationTexts(String locale) {\n+        if (locale == null) return false;\n+        Optional<RealmLocalizationTextsEntity> localizationTextsEntity = realm.getRealmLocalizationTexts().stream().filter(t -> locale.equals(t.getLocale())).findAny();\n+        if (localizationTextsEntity.isPresent())\n+        {\n+            em.remove(localizationTextsEntity.get());\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public Map<String, Map<String, String>> getRealmLocalizationTexts() {\n+        Map<String, Map<String, String>> localizationTexts = new HashMap<>();\n+        realm.getRealmLocalizationTexts().forEach(localizationTextsEntity -> {\n+            localizationTexts.put(localizationTextsEntity.getLocale(), localizationTextsEntity.getTexts());\n+        });\n+        return localizationTexts;\n+    }\n+\n+    @Override\n+    public Map<String, String> getRealmLocalizationTextsByLocale(String locale) {\n+        Optional<RealmLocalizationTextsEntity> localizationTextsEntity = realm.getRealmLocalizationTexts().stream().filter(l -> locale.equals(l.getLocale())).findAny();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd9cc3a9260ce97fb0b26ce47ceb42c1421620b"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODg5NjExOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-12.1.0.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0ODo0OVrOHlepRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0ODo0OVrOHlepRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTQ0NQ==", "bodyText": "Move this changeset to META-INF/jpa-changelog-12.0.0.xml", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r509061445", "createdAt": "2020-10-21T07:48:49Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-12.1.0.xml", "diffHunk": "@@ -0,0 +1,36 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+<!--\n+  ~ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+  ~ * and other contributors as indicated by the @author tags.\n+  ~ *\n+  ~ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ * you may not use this file except in compliance with the License.\n+  ~ * You may obtain a copy of the License at\n+  ~ *\n+  ~ * http://www.apache.org/licenses/LICENSE-2.0\n+  ~ *\n+  ~ * Unless required by applicable law or agreed to in writing, software\n+  ~ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ * See the License for the specific language governing permissions and\n+  ~ * limitations under the License.\n+  -->\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet author=\"keycloak\" id=\"12.1.0-add-realm-localization-table\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46df137cdf72f95105ad9993bd13a905828f08d4"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODg5NzgzOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-master.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0OToxOFrOHleqTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo0OToxOFrOHleqTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTcxMA==", "bodyText": "Please keep it at 12.0.0 and remove this line", "url": "https://github.com/keycloak/keycloak/pull/7320#discussion_r509061710", "createdAt": "2020-10-21T07:49:18Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/resources/META-INF/jpa-changelog-master.xml", "diffHunk": "@@ -68,5 +68,6 @@\n     <include file=\"META-INF/jpa-changelog-9.0.1.xml\"/>\n     <include file=\"META-INF/jpa-changelog-11.0.0.xml\"/>\n     <include file=\"META-INF/jpa-changelog-12.0.0.xml\"/>\n+    <include file=\"META-INF/jpa-changelog-12.1.0.xml\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46df137cdf72f95105ad9993bd13a905828f08d4"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3515, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}