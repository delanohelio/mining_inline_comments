{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTAxNTAz", "number": 7579, "title": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions", "bodyText": "", "createdAt": "2020-11-04T16:33:29Z", "url": "https://github.com/keycloak/keycloak/pull/7579", "merged": true, "mergeCommit": {"oid": "7b5fdc9c0d81ba7d05498e5aa9accb2918e90406"}, "closed": true, "closedAt": "2020-11-05T08:06:28Z", "author": {"login": "martin-kanis"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZTE7JgFqTUyMzY3NzgzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZdxHPAFqTUyNDAwNTQwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjc3ODM4", "url": "https://github.com/keycloak/keycloak/pull/7579#pullrequestreview-523677838", "createdAt": "2020-11-04T19:38:55Z", "commit": {"oid": "3f6e54680fa82a8f1fa810c31c48b074cb210048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTozODo1NVrOHtm9Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTozODo1NVrOHtm9Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU4NjIyMw==", "bodyText": "I believe the two stages can be put together:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  - name: Run crossdc-server tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                  - name: Run crossdc-adapter tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                  - name: Run crossdc-server tests\n          \n          \n            \n                    if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n          \n          \n            \n                    run: mvn install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}", "url": "https://github.com/keycloak/keycloak/pull/7579#discussion_r517586223", "createdAt": "2020-11-04T19:38:55Z", "author": {"login": "hmlnarik"}, "path": ".github/workflows/ci.yml", "diffHunk": "@@ -67,6 +67,38 @@ jobs:\n       - name: Run base tests\n         run: mvn install -B -Pauth-server-wildfly -f testsuite/integration-arquillian/tests/base/pom.xml | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n \n+  test-crossdc:\n+    name: Crossdc Tests\n+    needs: build\n+    runs-on: ubuntu-latest\n+    env:\n+      MAVEN_OPTS: -Xmx1024m\n+    steps:\n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Download Maven Repo\n+        uses: actions/download-artifact@v1\n+        with:\n+          name: maven-repo\n+          path: .\n+      - name: Extract Maven Repo\n+        shell: bash\n+        run: tar -xzvf maven-repo.tgz -C ~\n+      - name: Build testsuite\n+        run: mvn clean install -B -nsu -Pauth-servers-crossdc-jboss,auth-server-wildfly,cache-server-infinispan,app-server-wildfly -DskipTests\n+      - name: Run git diff\n+        run: echo \"GIT_DIFF=$( git diff --name-only HEAD^ | egrep -ic 'crossdc|infinispan' )\" >> $GITHUB_ENV;\n+      - name: Run crossdc-server tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n+      - name: Run crossdc-adapter tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly,app-server-wildfly \"-Dtest=org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f6e54680fa82a8f1fa810c31c48b074cb210048"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f6e54680fa82a8f1fa810c31c48b074cb210048", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/3f6e54680fa82a8f1fa810c31c48b074cb210048", "committedDate": "2020-11-04T16:32:25Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}, "afterCommit": {"oid": "09acb88246472d1bc1e21768baaed353ee84f0a1", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/09acb88246472d1bc1e21768baaed353ee84f0a1", "committedDate": "2020-11-04T19:44:40Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09acb88246472d1bc1e21768baaed353ee84f0a1", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/09acb88246472d1bc1e21768baaed353ee84f0a1", "committedDate": "2020-11-04T19:44:40Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}, "afterCommit": {"oid": "f1573afff1043b0dfdf0baa17d2e26d45404d761", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/f1573afff1043b0dfdf0baa17d2e26d45404d761", "committedDate": "2020-11-04T19:46:16Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTUyOTI5", "url": "https://github.com/keycloak/keycloak/pull/7579#pullrequestreview-523952929", "createdAt": "2020-11-05T06:19:36Z", "commit": {"oid": "f1573afff1043b0dfdf0baa17d2e26d45404d761"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoxOTozNlrOHt066w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoxOTozNlrOHt066w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNTAxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n          \n            \n                    run: mvn clean install -B -f testsuite/integration-arquillian/tests/base/pom.xml -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n          \n      \n    \n    \n  \n\nOtherwise it would fail: https://github.com/hmlnarik/keycloak/runs/1356728122?check_suite_focus=true", "url": "https://github.com/keycloak/keycloak/pull/7579#discussion_r517815019", "createdAt": "2020-11-05T06:19:36Z", "author": {"login": "hmlnarik"}, "path": ".github/workflows/ci.yml", "diffHunk": "@@ -67,6 +67,35 @@ jobs:\n       - name: Run base tests\n         run: mvn install -B -Pauth-server-wildfly -f testsuite/integration-arquillian/tests/base/pom.xml | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}\n \n+  test-crossdc:\n+    name: CrossDC Tests\n+    needs: build\n+    runs-on: ubuntu-latest\n+    env:\n+      MAVEN_OPTS: -Xmx1024m\n+    steps:\n+      - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 2\n+      - uses: actions/setup-java@v1\n+        with:\n+          java-version: 1.8\n+      - name: Download Maven Repo\n+        uses: actions/download-artifact@v1\n+        with:\n+          name: maven-repo\n+          path: .\n+      - name: Extract Maven Repo\n+        shell: bash\n+        run: tar -xzvf maven-repo.tgz -C ~\n+      - name: Build testsuite\n+        run: mvn clean install -B -nsu -Pauth-servers-crossdc-jboss,auth-server-wildfly,cache-server-infinispan,app-server-wildfly -DskipTests\n+      - name: Run git diff\n+        run: echo \"GIT_DIFF=$( git diff --name-only HEAD^ | egrep -ic 'crossdc|infinispan' )\" >> $GITHUB_ENV;\n+      - name: Run crossdc-server and crossdc-adapter tests\n+        if: ${{ github.event_name != 'pull_request' || env.GIT_DIFF != 0 }}\n+        run: mvn clean install -B -nsu -Pcache-server-infinispan,auth-servers-crossdc-jboss,auth-server-wildfly \"-Dtest=org.keycloak.testsuite.crossdc.**.*,org.keycloak.testsuite.adapter.**.crossdc.**.*\" | misc/log/trimmer.sh; exit ${PIPESTATUS[0]}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1573afff1043b0dfdf0baa17d2e26d45404d761"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ba9b276705b355042504ed0031dde4383fd4a4a", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/0ba9b276705b355042504ed0031dde4383fd4a4a", "committedDate": "2020-11-05T06:29:13Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1573afff1043b0dfdf0baa17d2e26d45404d761", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/f1573afff1043b0dfdf0baa17d2e26d45404d761", "committedDate": "2020-11-04T19:46:16Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}, "afterCommit": {"oid": "0ba9b276705b355042504ed0031dde4383fd4a4a", "author": {"user": {"login": "martin-kanis", "name": "Martin Kanis"}}, "url": "https://github.com/keycloak/keycloak/commit/0ba9b276705b355042504ed0031dde4383fd4a4a", "committedDate": "2020-11-05T06:29:13Z", "message": "KEYCLOAK-16147 KEYCLOAK-16148 Add crossdc tests to GitHub Actions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDA1NDA0", "url": "https://github.com/keycloak/keycloak/pull/7579#pullrequestreview-524005404", "createdAt": "2020-11-05T08:06:14Z", "commit": {"oid": "0ba9b276705b355042504ed0031dde4383fd4a4a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3409, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}