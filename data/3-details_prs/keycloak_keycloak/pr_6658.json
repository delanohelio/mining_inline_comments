{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMDUzNDEx", "number": 6658, "title": "KEYCLOAK-12125 Introduce SameSite attribute in cookies", "bodyText": "", "createdAt": "2020-01-15T10:04:31Z", "url": "https://github.com/keycloak/keycloak/pull/6658", "merged": true, "mergeCommit": {"oid": "03306b87e8602d3b2d63ce60cb7c57746fa50efd"}, "closed": true, "closedAt": "2020-01-17T11:36:54Z", "author": {"login": "vmuzikar"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb65nMSABqjI5NTQ0MDcyNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7NEIEAFqTM0NDUxOTg5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "366f588b4ebdd75d856acd2ebb997af75be1acdb", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/366f588b4ebdd75d856acd2ebb997af75be1acdb", "committedDate": "2020-01-16T12:39:28Z", "message": "Extend CookieTest"}, "afterCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/16302ca08fa20eeb2f739907db306196b0156fd2", "committedDate": "2020-01-16T12:48:01Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTAxMzM3", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-343901337", "createdAt": "2020-01-16T13:15:17Z", "commit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzoxNToxOFrOFeY6zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzoxNToxOFrOFeY6zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQwOTg3MQ==", "bodyText": "There is no need to re-assign cookie here, instead the result of getCookieByName('KEYCLOAK_SESSION_LEGACY') can be returned immediately.", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367409871", "createdAt": "2020-01-16T13:15:18Z", "author": {"login": "jonkoops"}, "path": "adapters/oidc/js/src/main/resources/login-status-iframe.html", "diffHunk": "@@ -81,7 +81,16 @@\n \n     function getCookie()\n     {\n-        var name = 'KEYCLOAK_SESSION=';\n+        var cookie = getCookieByName('KEYCLOAK_SESSION');\n+        if (cookie === null) {\n+            cookie = getCookieByName('KEYCLOAK_SESSION_LEGACY');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTM5MTQ2", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-343939146", "createdAt": "2020-01-16T14:12:22Z", "commit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoxMjoyMlrOFeao8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoxMjoyMlrOFeao8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzODA2Ng==", "bodyText": "If we only support NONE at the moment, I'd rather to make it a constant and not advertise LAX or STRICT in the code.", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367438066", "createdAt": "2020-01-16T14:12:22Z", "author": {"login": "abstractj"}, "path": "common/src/main/java/org/keycloak/common/util/ServerCookie.java", "diffHunk": "@@ -32,6 +32,22 @@\n     private static final String tspecials = \",; \";\n     private static final String tspecials2 = \"()<>@,;:\\\\\\\"/[]?={} \\t\";\n \n+    public enum SameSiteAttributeValue {\n+        NONE(\"None\"), // we currently support only SameSite=None; this might change in the future\n+        STRICT(\"Strict\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/16302ca08fa20eeb2f739907db306196b0156fd2", "committedDate": "2020-01-16T12:48:01Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}, "afterCommit": {"oid": "492c5c1348102ce04bd6ee83ec22e261bf629893", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/492c5c1348102ce04bd6ee83ec22e261bf629893", "committedDate": "2020-01-16T14:16:22Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTQ5NzA1", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-343949705", "createdAt": "2020-01-16T14:26:40Z", "commit": {"oid": "492c5c1348102ce04bd6ee83ec22e261bf629893"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNjo0MVrOFebHpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNjo0MVrOFebHpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NTkyNg==", "bodyText": "A minor nitpick, but StringBuilder is faster than StringBuffer, plus it seems that's our preferred choice into the codebase.", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367445926", "createdAt": "2020-01-16T14:26:41Z", "author": {"login": "abstractj"}, "path": "common/src/main/java/org/keycloak/common/util/ServerCookie.java", "diffHunk": "@@ -173,7 +187,8 @@ public static void appendCookieValue(StringBuffer headerBuf,\n                                          String comment,\n                                          int maxAge,\n                                          boolean isSecure,\n-                                         boolean httpOnly) {\n+                                         boolean httpOnly,\n+                                         SameSiteAttributeValue sameSite) {\n         StringBuffer buf = new StringBuffer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "492c5c1348102ce04bd6ee83ec22e261bf629893"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTI2MjMw", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-343926230", "createdAt": "2020-01-16T13:54:00Z", "commit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzo1NDowMVrOFeaDcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzo1NToxM1rOFeaF1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyODQ2Ng==", "bodyText": "Where does this value end up being used? Are we sure this separator doesn't accidentally break other code that depends on the structure of the value somewhere else?", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367428466", "createdAt": "2020-01-16T13:54:01Z", "author": {"login": "jonkoops"}, "path": "adapters/oidc/js/src/main/resources/login-status-iframe.html", "diffHunk": "@@ -81,7 +81,16 @@\n \n     function getCookie()\n     {\n-        var name = 'KEYCLOAK_SESSION=';\n+        var cookie = getCookieByName('KEYCLOAK_SESSION');\n+        if (cookie === null) {\n+            cookie = getCookieByName('KEYCLOAK_SESSION_LEGACY');\n+        }\n+        return cookie;\n+    }\n+\n+    function getCookieByName(name)\n+    {\n+        name = name + '=';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyOTA3OA==", "bodyText": "Yes, that I understand. I meant that this code could be written as follows:\nvar cookie = getCookieByName('KEYCLOAK_SESSION');\n\nif (cookie === null) {\n  return getCookieByName('KEYCLOAK_SESSION_LEGACY');\n}\n\nreturn cookie;", "url": "https://github.com/keycloak/keycloak/pull/6658#discussion_r367429078", "createdAt": "2020-01-16T13:55:13Z", "author": {"login": "jonkoops"}, "path": "adapters/oidc/js/src/main/resources/login-status-iframe.html", "diffHunk": "@@ -81,7 +81,16 @@\n \n     function getCookie()\n     {\n-        var name = 'KEYCLOAK_SESSION=';\n+        var cookie = getCookieByName('KEYCLOAK_SESSION');\n+        if (cookie === null) {\n+            cookie = getCookieByName('KEYCLOAK_SESSION_LEGACY');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQwOTg3MQ=="}, "originalCommit": {"oid": "16302ca08fa20eeb2f739907db306196b0156fd2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/6b658283da86f5f1cf53b555fca649ade2b9a789", "committedDate": "2020-01-16T15:15:03Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "492c5c1348102ce04bd6ee83ec22e261bf629893", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/492c5c1348102ce04bd6ee83ec22e261bf629893", "committedDate": "2020-01-16T14:16:22Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}, "afterCommit": {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/6b658283da86f5f1cf53b555fca649ade2b9a789", "committedDate": "2020-01-16T15:15:03Z", "message": "KEYCLOAK-12125 Introduce SameSite attribute in cookies\n\nCo-authored-by: mhajas <mhajas@redhat.com>\nCo-authored-by: Peter Skopek <pskopek@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDc2NTMx", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-344476531", "createdAt": "2020-01-17T10:07:57Z", "commit": {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTE2MzY2", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-344516366", "createdAt": "2020-01-17T11:22:29Z", "commit": {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTE5ODk2", "url": "https://github.com/keycloak/keycloak/pull/6658#pullrequestreview-344519896", "createdAt": "2020-01-17T11:29:44Z", "commit": {"oid": "6b658283da86f5f1cf53b555fca649ade2b9a789"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2707, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}