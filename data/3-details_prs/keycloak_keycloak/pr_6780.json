{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0ODI2MTEy", "number": 6780, "title": "KEYCLOAK-12958 Preview feature profile for WebAuthn", "bodyText": "JIRA: KEYCLOAK-12958", "createdAt": "2020-02-13T11:52:36Z", "url": "https://github.com/keycloak/keycloak/pull/6780", "merged": true, "mergeCommit": {"oid": "eaaff6e55578501256c8b55617213fafa2be3d3e"}, "closed": true, "closedAt": "2020-02-26T07:45:27Z", "author": {"login": "mabartos"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD554eABqjMwMzQ2MTA3NDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIB0ibAFqTM2NDY3NjQwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62bd65e28c3aed5fa5ce082674c62647c71783f0", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/62bd65e28c3aed5fa5ce082674c62647c71783f0", "committedDate": "2020-02-13T11:49:53Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}, "afterCommit": {"oid": "c3775a1e35a0f373d58887e708438263067c61e3", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/c3775a1e35a0f373d58887e708438263067c61e3", "committedDate": "2020-02-13T12:14:46Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3775a1e35a0f373d58887e708438263067c61e3", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/c3775a1e35a0f373d58887e708438263067c61e3", "committedDate": "2020-02-13T12:14:46Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}, "afterCommit": {"oid": "db3be2cfb8456e4656e3662c8e577f33fcf823a0", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/db3be2cfb8456e4656e3662c8e577f33fcf823a0", "committedDate": "2020-02-13T12:58:46Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db3be2cfb8456e4656e3662c8e577f33fcf823a0", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/db3be2cfb8456e4656e3662c8e577f33fcf823a0", "committedDate": "2020-02-13T12:58:46Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}, "afterCommit": {"oid": "8bb5f4bca0e707ab4de4694b0806f5f461bd7b02", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/8bb5f4bca0e707ab4de4694b0806f5f461bd7b02", "committedDate": "2020-02-13T14:55:29Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjg4NTA2", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-360288506", "createdAt": "2020-02-18T12:12:13Z", "commit": {"oid": "8bb5f4bca0e707ab4de4694b0806f5f461bd7b02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bb5f4bca0e707ab4de4694b0806f5f461bd7b02", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/8bb5f4bca0e707ab4de4694b0806f5f461bd7b02", "committedDate": "2020-02-13T14:55:29Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}, "afterCommit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70", "author": {"user": {"login": "mposolda", "name": "Marek Posolda"}}, "url": "https://github.com/keycloak/keycloak/commit/26a78a1eb61b4e2b293bcf98d06fe78713492b70", "committedDate": "2020-02-24T06:58:50Z", "message": "KEYCLOAK-12958 Ability to enable features having EnvironmentDependent providers without restart server"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMjI2ODI1", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-363226825", "createdAt": "2020-02-24T08:40:55Z", "commit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMjQxMjc1", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-363241275", "createdAt": "2020-02-24T09:09:25Z", "commit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwOTowOToyNVrOFtZTzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwOToxMDo0NVrOFtZWPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE0NDkwOQ==", "bodyText": "I believe we don't need to enable WebAuthn for the whole test class. This affects only:\n\n  \n    \n      keycloak/testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java\n    \n    \n        Lines 246 to 254\n      in\n      26a78a1\n    \n    \n    \n    \n\n        \n          \n           @Test \n        \n\n        \n          \n           public void twoFactorWebAuthnTest() { \n        \n\n        \n          \n               testWebAuthn(false); \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           @Test \n        \n\n        \n          \n           public void passwordlessWebAuthnTest() { \n        \n\n        \n          \n               testWebAuthn(true); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nIf I understand it correctly, the annotation should work for test methods as well, shouldn't it?", "url": "https://github.com/keycloak/keycloak/pull/6780#discussion_r383144909", "createdAt": "2020-02-24T09:09:25Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java", "diffHunk": "@@ -62,6 +64,9 @@\n /**\n  * @author Vaclav Muzikar <vmuzikar@redhat.com>\n  */\n+@EnableFeature(value = Profile.Feature.ACCOUNT2, skipRestart = true)\n+@EnableFeature(value = Profile.Feature.ACCOUNT_API, skipRestart = true)\n+@EnableFeature(value = Profile.Feature.WEB_AUTHN, skipRestart = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzE0NTUzMw==", "bodyText": "Is there any reason why to put here the account profile features? Seems a bit redundant, there are already present in the parent class.", "url": "https://github.com/keycloak/keycloak/pull/6780#discussion_r383145533", "createdAt": "2020-02-24T09:10:45Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/SigningInTest.java", "diffHunk": "@@ -62,6 +64,9 @@\n /**\n  * @author Vaclav Muzikar <vmuzikar@redhat.com>\n  */\n+@EnableFeature(value = Profile.Feature.ACCOUNT2, skipRestart = true)\n+@EnableFeature(value = Profile.Feature.ACCOUNT_API, skipRestart = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMzMwMzkz", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-363330393", "createdAt": "2020-02-24T11:42:37Z", "commit": {"oid": "26a78a1eb61b4e2b293bcf98d06fe78713492b70"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjk2ODU0", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-363696854", "createdAt": "2020-02-24T21:00:21Z", "commit": {"oid": "516cf5dc8b1f4749cbf21101572780a4eb11e1a7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTowMDoyMVrOFtvqxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTowOToyNlrOFtv7XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUxMTIzNw==", "bodyText": "Is it possible to remove field \"defaultType\" and methods \"setDefaultType\" and \"getType\" from the Feature enum? AFAIK the mutable enums is the antipattern - see for example https://rules.sonarsource.com/java/RSPEC-3066 . Hopefully all occurences of \"f.getType()\" in the further code can be replaced simply with the \"type\", which was retrieved on line 122? For exampe:\nswitch (type) {\n\ninstead of:\nswitch (f.getType()) {\n\netc", "url": "https://github.com/keycloak/keycloak/pull/6780#discussion_r383511237", "createdAt": "2020-02-24T21:00:21Z", "author": {"login": "mposolda"}, "path": "common/src/main/java/org/keycloak/common/Profile.java", "diffHunk": "@@ -95,6 +119,8 @@ private Profile() {\n \n         for (Feature f : Feature.values()) {\n             Boolean enabled = config.getConfig(f);\n+            Type type = product.equals(ProductValue.RHSSO) ? f.getTypeProduct() : f.getTypeProject();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "516cf5dc8b1f4749cbf21101572780a4eb11e1a7"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUxNTQ4NA==", "bodyText": "I see there are failing tests on travis. Maybe the check for \"Profile.getName().equals(\"product\")\" should be removed from this line and the check should be always disabled to have the tests passing?", "url": "https://github.com/keycloak/keycloak/pull/6780#discussion_r383515484", "createdAt": "2020-02-24T21:09:26Z", "author": {"login": "mposolda"}, "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/arquillian/containers/KeycloakContainerFeaturesController.java", "diffHunk": "@@ -86,20 +86,32 @@ public UpdateFeature(Profile.Feature feature, boolean skipRestart, FeatureAction\n          *\n          */\n         private void assertValid() {\n+            if (shouldSkipValidation())\n+                return;\n+\n             assertThat(\"An annotation requested to \" + action.name()\n                             + \" feature \" + feature.name() + \" however it was already in that state\" ,\n                     ProfileAssume.isFeatureEnabled(feature),\n                     is(!(action == FeatureAction.ENABLE)));\n         }\n \n         private void assertPerformed() {\n+            if (shouldSkipValidation())\n+                return;\n+\n             assertThat(\"An annotation requested to \" + action.name() +\n                             \" feature \" + feature.name() + \", however after performing this operation \" +\n                             \"the feature is not in desired state\" ,\n                     ProfileAssume.isFeatureEnabled(feature),\n                     is(action == FeatureAction.ENABLE));\n         }\n \n+        private boolean shouldSkipValidation() {\n+            // KEYCLOAK-12895 - Some features might be in product disabled and in project enabled.\n+            // In this case, the current state of the feature can be different.\n+            return feature.hasDifferentProductType() && Profile.getName().equals(\"product\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "516cf5dc8b1f4749cbf21101572780a4eb11e1a7"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "516cf5dc8b1f4749cbf21101572780a4eb11e1a7", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/516cf5dc8b1f4749cbf21101572780a4eb11e1a7", "committedDate": "2020-02-24T19:42:48Z", "message": "KEYCLOAK-12958 WebAuthn profile product/project"}, "afterCommit": {"oid": "b08438f95879e2a9f06b0b0c9c3b05526df37413", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/b08438f95879e2a9f06b0b0c9c3b05526df37413", "committedDate": "2020-02-25T13:52:08Z", "message": "KEYCLOAK-12958 WebAuthn profile product/project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d698198790525199f7cfd80aadb22cf7f8c859", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/f4d698198790525199f7cfd80aadb22cf7f8c859", "committedDate": "2020-02-25T16:15:43Z", "message": "KEYCLOAK-12958 Preview feature profile for WebAuthn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b298a71701781cd8dc4b585785dc06d8ac371b6", "author": {"user": {"login": "mposolda", "name": "Marek Posolda"}}, "url": "https://github.com/keycloak/keycloak/commit/8b298a71701781cd8dc4b585785dc06d8ac371b6", "committedDate": "2020-02-25T16:15:43Z", "message": "KEYCLOAK-12958 Ability to enable features having EnvironmentDependent providers without restart server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e7275801dcd5f4fcbc51e8d1aa41a3d371e6384", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/1e7275801dcd5f4fcbc51e8d1aa41a3d371e6384", "committedDate": "2020-02-25T16:15:43Z", "message": "KEYCLOAK-12958 WebAuthn profile product/project"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b08438f95879e2a9f06b0b0c9c3b05526df37413", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/b08438f95879e2a9f06b0b0c9c3b05526df37413", "committedDate": "2020-02-25T13:52:08Z", "message": "KEYCLOAK-12958 WebAuthn profile product/project"}, "afterCommit": {"oid": "1e7275801dcd5f4fcbc51e8d1aa41a3d371e6384", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/1e7275801dcd5f4fcbc51e8d1aa41a3d371e6384", "committedDate": "2020-02-25T16:15:43Z", "message": "KEYCLOAK-12958 WebAuthn profile product/project"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Njc2NDA0", "url": "https://github.com/keycloak/keycloak/pull/6780#pullrequestreview-364676404", "createdAt": "2020-02-26T07:44:46Z", "commit": {"oid": "1e7275801dcd5f4fcbc51e8d1aa41a3d371e6384"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2666, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}