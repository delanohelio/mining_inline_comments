{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MTgxMzc2", "number": 7267, "title": "KEYCLOAK-14547: Make New Account Console the default.", "bodyText": "This PR makes the following changes:\n\nNew Account Console enabled by default\nDefault themes are now \"keycloak.v2\" and \"rh-sso.v2\"\nOriginal \"keycloak\" is theme still available\nAccount REST API enabled by default (done in another PR)\nYou can still disable New Account Console and Account REST API if you want\nAt build time, the default theme is driven by new property \"product.default-theme\"\nOld tests need to still assume old account console.  So AbstractKeycloak test disables new account console.  If you want a test to use new account console you can use @EnableFeature(value=Profile.Feature.ACCOUNT2).  Or you can extend from MainAbstractKeycloakTest instead of AbstractKeycloakTest.\n\n@ssilvert adding the test fixes that @vmuzikar implemented here, so we don't miss it:\n\nDepends on: ssilvert#10", "createdAt": "2020-07-15T00:43:41Z", "url": "https://github.com/keycloak/keycloak/pull/7267", "merged": true, "mergeCommit": {"oid": "e56bd9d8b8cbaf4600e6bcc5e28c962eb561d74c"}, "closed": true, "closedAt": "2020-11-23T19:56:07Z", "author": {"login": "ssilvert"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1OCFcgBqjM1NDk1NjUzNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfXqxEgFqTUzNjYzNzI0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2025dbb695e4dcd1b5a144db27204ce73f45f35f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/2025dbb695e4dcd1b5a144db27204ce73f45f35f", "committedDate": "2020-07-15T00:41:25Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "a0abaf288cf5cf849ebed513b70b7aa67fbdd3af", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/a0abaf288cf5cf849ebed513b70b7aa67fbdd3af", "committedDate": "2020-07-15T17:24:31Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0abaf288cf5cf849ebed513b70b7aa67fbdd3af", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/a0abaf288cf5cf849ebed513b70b7aa67fbdd3af", "committedDate": "2020-07-15T17:24:31Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "491c880915ae2c56b55c47f5327c0827fa368129", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/491c880915ae2c56b55c47f5327c0827fa368129", "committedDate": "2020-07-17T20:36:21Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "491c880915ae2c56b55c47f5327c0827fa368129", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/491c880915ae2c56b55c47f5327c0827fa368129", "committedDate": "2020-07-17T20:36:21Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "462a552093a7aa5ef9b3853c245dbb7f5081a1d4", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/462a552093a7aa5ef9b3853c245dbb7f5081a1d4", "committedDate": "2020-07-17T20:39:53Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "462a552093a7aa5ef9b3853c245dbb7f5081a1d4", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/462a552093a7aa5ef9b3853c245dbb7f5081a1d4", "committedDate": "2020-07-17T20:39:53Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "db1a69dd92706dc5db4eaf1d197709920467785b", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/db1a69dd92706dc5db4eaf1d197709920467785b", "committedDate": "2020-07-18T16:32:45Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db1a69dd92706dc5db4eaf1d197709920467785b", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/db1a69dd92706dc5db4eaf1d197709920467785b", "committedDate": "2020-07-18T16:32:45Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "6026d86f122df59d22add90478c290e881a864ed", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/6026d86f122df59d22add90478c290e881a864ed", "committedDate": "2020-07-19T16:38:45Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6026d86f122df59d22add90478c290e881a864ed", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/6026d86f122df59d22add90478c290e881a864ed", "committedDate": "2020-07-19T16:38:45Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "3f27201f83962b6ab1db3568d4c9524b2e7b9191", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/3f27201f83962b6ab1db3568d4c9524b2e7b9191", "committedDate": "2020-07-19T17:20:16Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f27201f83962b6ab1db3568d4c9524b2e7b9191", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/3f27201f83962b6ab1db3568d4c9524b2e7b9191", "committedDate": "2020-07-19T17:20:16Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/d8e95dc5c44531101142b0895890215e2041191d", "committedDate": "2020-07-20T16:44:49Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMjcwMzIw", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-452270320", "createdAt": "2020-07-21T09:10:56Z", "commit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwOToxMDo1NlrOG0vKhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMDo0MToyMFrOG0yRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk1MTg3OQ==", "bodyText": "Just a nitpick. These imports are not used.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r457951879", "createdAt": "2020-07-21T09:10:56Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/ProfileAssume.java", "diffHunk": "@@ -27,6 +27,8 @@\n import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n+import org.keycloak.admin.client.resource.ServerInfoResource;\n+import org.keycloak.representations.info.ServerInfoRepresentation;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk5MDAxMA==", "bodyText": "I have to admit I don't like the approach with renaming and creating new abstract classes. The naming is quite confusing \u2013 AbstractKeycloakTest vs MainAbstractKeycloakTest. But more importantly, it breaks the class hierarchy which results in duplicate code e.g. in AbstractUiTest.\nThe way I see it we have two options.\n\nMove the abstract class that disables the new console much, much lower in the hierarchy. So that the abstract classes could be used by the new console tests and code duplication wouldn't be necessary.\nDisable the new console in the first abstract class and then re-enable it only in the tests that need it. The number of tests for the new console is really just a fraction of what we have, so maybe that would be a cleaner approach.\n\nIn any case, this change should be as small as possible because it's only temporary. Sooner or later the old console will be deprecated and we'll have to fix all the tests that rely on it.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r457990010", "createdAt": "2020-07-21T10:17:06Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AbstractKeycloakTest.java", "diffHunk": "@@ -16,640 +16,16 @@\n  */\n package org.keycloak.testsuite;\n \n-import io.appium.java_client.AppiumDriver;\n-import org.apache.commons.configuration.ConfigurationException;\n-import org.apache.commons.configuration.PropertiesConfiguration;\n-import org.jboss.arquillian.container.test.api.RunAsClient;\n-import org.jboss.arquillian.drone.api.annotation.Drone;\n-import org.jboss.arquillian.graphene.page.Page;\n-import org.jboss.arquillian.test.api.ArquillianResource;\n-import org.jboss.logging.Logger;\n-import org.junit.After;\n-import org.junit.Before;\n-import org.junit.runner.RunWith;\n-import org.keycloak.admin.client.Keycloak;\n-import org.keycloak.admin.client.resource.AuthenticationManagementResource;\n-import org.keycloak.admin.client.resource.RealmsResource;\n-import org.keycloak.admin.client.resource.UserResource;\n-import org.keycloak.admin.client.resource.UsersResource;\n-import org.keycloak.common.util.KeycloakUriBuilder;\n-import org.keycloak.common.util.Time;\n-import org.keycloak.representations.idm.ClientRepresentation;\n-import org.keycloak.representations.idm.RealmRepresentation;\n-import org.keycloak.representations.idm.RequiredActionProviderRepresentation;\n-import org.keycloak.representations.idm.UserRepresentation;\n-import org.keycloak.services.resources.account.AccountFormService;\n-import org.keycloak.testsuite.admin.ApiUtil;\n-import org.keycloak.testsuite.arquillian.AuthServerTestEnricher;\n-import org.keycloak.testsuite.arquillian.KcArquillian;\n-import org.keycloak.testsuite.arquillian.SuiteContext;\n-import org.keycloak.testsuite.arquillian.TestContext;\n-import org.keycloak.testsuite.auth.page.AuthRealm;\n-import org.keycloak.testsuite.auth.page.AuthServer;\n-import org.keycloak.testsuite.auth.page.AuthServerContextRoot;\n-import org.keycloak.testsuite.auth.page.WelcomePage;\n-import org.keycloak.testsuite.auth.page.account.Account;\n-import org.keycloak.testsuite.auth.page.login.OIDCLogin;\n-import org.keycloak.testsuite.auth.page.login.UpdatePassword;\n-import org.keycloak.testsuite.client.KeycloakTestingClient;\n-import org.keycloak.testsuite.pages.LoginPasswordUpdatePage;\n-import org.keycloak.testsuite.util.DroneUtils;\n-import org.keycloak.testsuite.util.OAuthClient;\n-import org.keycloak.testsuite.util.TestCleanup;\n-import org.keycloak.testsuite.util.TestEventsLogger;\n-import org.openqa.selenium.WebDriver;\n-\n-import javax.ws.rs.NotFoundException;\n-import javax.ws.rs.core.UriBuilder;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.PipedInputStream;\n-import java.io.PipedOutputStream;\n-import java.io.PrintWriter;\n-import java.net.URI;\n-import java.net.URISyntaxException;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.Calendar;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Scanner;\n-\n-import static org.hamcrest.Matchers.equalTo;\n-import static org.hamcrest.Matchers.is;\n-import static org.junit.Assert.assertThat;\n-import static org.keycloak.testsuite.admin.Users.setPasswordFor;\n-import static org.keycloak.testsuite.util.ServerURLs.AUTH_SERVER_HOST;\n-import static org.keycloak.testsuite.util.ServerURLs.AUTH_SERVER_PORT;\n-import static org.keycloak.testsuite.util.ServerURLs.AUTH_SERVER_SCHEME;\n-import static org.keycloak.testsuite.util.ServerURLs.AUTH_SERVER_SSL_REQUIRED;\n-import static org.keycloak.testsuite.auth.page.AuthRealm.MASTER;\n-import static org.keycloak.testsuite.util.URLUtils.navigateToUri;\n-import static org.keycloak.testsuite.util.ServerURLs.removeDefaultPorts;\n+import org.keycloak.common.Profile;\n+import org.keycloak.testsuite.arquillian.annotation.DisableFeature;\n \n /**\n- *\n- * @author tkyjovsk\n+ * Old tests that use AbstractKeycloakTest assume that we are using the old\n+ * account console.\n+ * \n+ * @author Stan Silvert\n  */\n-@RunWith(KcArquillian.class)\n-@RunAsClient\n-public abstract class AbstractKeycloakTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk5MTQ3OQ==", "bodyText": "Should we assert the \"normal\" URL instead? This way I think we're not checking the URL at all.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r457991479", "createdAt": "2020-07-21T10:19:45Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/ApplicationsTest.java", "diffHunk": "@@ -99,24 +99,23 @@ public void toggleApplicationDetailsTest() throws Exception {\n         assertFalse(applications.isEmpty());\n         Map<String, ApplicationsPage.ClientRepresentation> apps = applications.stream().collect(Collectors.toMap(x -> x.getClientId(), x -> x));\n         assertThat(apps.keySet(), containsInAnyOrder(\"always-display-client\", \"account-console\"));\n-        assertClientRep(apps.get(\"account-console\"), \"Account Console\", false, true, getAuthServerRoot() + \"realms/test/account/\", true);\n-        assertClientRep(apps.get(\"always-display-client\"), \"Always Display Client\", false, false, getAuthServerRoot() + \"realms/master/app/always-display-client\", false);\n+        assertClientRep(apps.get(\"account-console\"), \"Account Console\", false, true, true);\n+        assertClientRep(apps.get(\"always-display-client\"), \"Always Display Client\", false, false, false);\n \n         applicationsPage.toggleApplicationDetails(\"account-console\");\n         applications = applicationsPage.getApplications();\n         assertFalse(applications.isEmpty());\n         apps = applications.stream().collect(Collectors.toMap(x -> x.getClientId(), x -> x));\n         assertThat(apps.keySet(), containsInAnyOrder(\"always-display-client\", \"account-console\"));\n-        assertClientRep(apps.get(\"account-console\"), \"Account Console\", false, true, getAuthServerRoot() + \"realms/test/account/\", false);\n-        assertClientRep(apps.get(\"always-display-client\"), \"Always Display Client\", false, false, getAuthServerRoot() + \"realms/master/app/always-display-client\", false);\n+        assertClientRep(apps.get(\"account-console\"), \"Account Console\", false, true, false);\n+        assertClientRep(apps.get(\"always-display-client\"), \"Always Display Client\", false, false, false);\n     }\n \n-    private void assertClientRep(ApplicationsPage.ClientRepresentation clientRep, String name, boolean userConsentRequired, boolean inUse, String effectiveUrl, boolean applicationDetailsVisible) {\n+    private void assertClientRep(ApplicationsPage.ClientRepresentation clientRep, String name, boolean userConsentRequired, boolean inUse, boolean applicationDetailsVisible) {\n         assertNotNull(clientRep);\n         assertEquals(name, clientRep.getClientName());\n         assertEquals(userConsentRequired, clientRep.isUserConsentRequired());\n         assertEquals(inUse, clientRep.isInUse());\n-        assertEquals(effectiveUrl, clientRep.getEffectiveUrl());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAwMjg4MQ==", "bodyText": "I'm not sure if it isn't confusing that all themes (even the old ones) use v2 with the old keycloak still available. The problem I see is that keycloak and keycloak.v2 are technically same themes (except account console) but the v2 could make the impression something's new in all themes.\nBut I'm ok with this if @stianst is.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r458002881", "createdAt": "2020-07-21T10:41:20Z", "author": {"login": "vmuzikar"}, "path": "services/src/main/java/org/keycloak/theme/DefaultThemeManager.java", "diffHunk": "@@ -72,7 +73,7 @@ public Theme getTheme(String name, Theme.Type type) {\n         if (theme == null) {\n             theme = loadTheme(name, type);\n             if (theme == null) {\n-                theme = loadTheme(\"keycloak\", type);\n+                theme = loadTheme(\"keycloak.v2\", type);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8e95dc5c44531101142b0895890215e2041191d", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/d8e95dc5c44531101142b0895890215e2041191d", "committedDate": "2020-07-20T16:44:49Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "47fdc695436accab991251e83fa926acb4cddeea", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/47fdc695436accab991251e83fa926acb4cddeea", "committedDate": "2020-07-22T21:46:37Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjY1MTU4", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-462265158", "createdAt": "2020-08-06T07:46:13Z", "commit": {"oid": "47fdc695436accab991251e83fa926acb4cddeea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NDM0Nzgz", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-468434783", "createdAt": "2020-08-17T12:53:54Z", "commit": {"oid": "c50757d2e0fc005e4bc4d1d03822c90aeb6ff6d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c50757d2e0fc005e4bc4d1d03822c90aeb6ff6d3", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/c50757d2e0fc005e4bc4d1d03822c90aeb6ff6d3", "committedDate": "2020-08-08T15:58:21Z", "message": "Fix remote tests"}, "afterCommit": {"oid": "9562dae577fc40e2079a853e7897aae78368c4c2", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/9562dae577fc40e2079a853e7897aae78368c4c2", "committedDate": "2020-08-17T19:15:27Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9562dae577fc40e2079a853e7897aae78368c4c2", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/9562dae577fc40e2079a853e7897aae78368c4c2", "committedDate": "2020-08-17T19:15:27Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "c89272199ad1d9f15b97096b9ccfe59d04912032", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/c89272199ad1d9f15b97096b9ccfe59d04912032", "committedDate": "2020-08-17T20:02:13Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c89272199ad1d9f15b97096b9ccfe59d04912032", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/c89272199ad1d9f15b97096b9ccfe59d04912032", "committedDate": "2020-08-17T20:02:13Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "dd7e29e4299ab359d4d7596856e8e9ea59f14478", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/dd7e29e4299ab359d4d7596856e8e9ea59f14478", "committedDate": "2020-08-21T16:03:38Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd7e29e4299ab359d4d7596856e8e9ea59f14478", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/dd7e29e4299ab359d4d7596856e8e9ea59f14478", "committedDate": "2020-08-21T16:03:38Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "432c9aec551b467b33ab87902ccb902ade68930f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/432c9aec551b467b33ab87902ccb902ade68930f", "committedDate": "2020-10-04T17:29:47Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "432c9aec551b467b33ab87902ccb902ade68930f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/432c9aec551b467b33ab87902ccb902ade68930f", "committedDate": "2020-10-04T17:29:47Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "91aff69d8ef9bfe97996a878cea9b9798e23c453", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/91aff69d8ef9bfe97996a878cea9b9798e23c453", "committedDate": "2020-10-21T20:31:28Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTE2NjQw", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-523116640", "createdAt": "2020-11-04T08:03:17Z", "commit": {"oid": "91aff69d8ef9bfe97996a878cea9b9798e23c453"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTE3MzA0", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-523117304", "createdAt": "2020-11-04T08:04:26Z", "commit": {"oid": "91aff69d8ef9bfe97996a878cea9b9798e23c453"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91aff69d8ef9bfe97996a878cea9b9798e23c453", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/91aff69d8ef9bfe97996a878cea9b9798e23c453", "committedDate": "2020-10-21T20:31:28Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "7ccdede18d72763d272a14905a3338332531899f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/7ccdede18d72763d272a14905a3338332531899f", "committedDate": "2020-11-13T12:52:56Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ccdede18d72763d272a14905a3338332531899f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/7ccdede18d72763d272a14905a3338332531899f", "committedDate": "2020-11-13T12:52:56Z", "message": "KEYCLOAK-14547: Make New Account Console the default"}, "afterCommit": {"oid": "8d143f138feffe053cbc8a5ec0a0cda50b298f12", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/8d143f138feffe053cbc8a5ec0a0cda50b298f12", "committedDate": "2020-11-13T13:03:12Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d143f138feffe053cbc8a5ec0a0cda50b298f12", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/8d143f138feffe053cbc8a5ec0a0cda50b298f12", "committedDate": "2020-11-13T13:03:12Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/734ffb8f4212a947297935b0542f9a16fd02098f", "committedDate": "2020-11-13T13:07:55Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTc5NjQ0", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-530179644", "createdAt": "2020-11-13T15:53:58Z", "commit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Mzo1OVrOHyz0tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzoyMDozMVrOHy3qHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAzOTkyNw==", "bodyText": "This doesn't seem to be used anywhere.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523039927", "createdAt": "2020-11-13T15:53:59Z", "author": {"login": "vmuzikar"}, "path": "common/src/main/java/org/keycloak/common/Version.java", "diffHunk": "@@ -35,6 +35,7 @@\n     public static String RESOURCES_VERSION;\n     public static String BUILD_TIME;\n     public static String DEFAULT_PROFILE;\n+    public static String DEFAULT_THEME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0NDQzOQ==", "bodyText": "I think we shouldn't hardcode this here. Cannot we have some property for this is Theme.Type, perhaps?", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523044439", "createdAt": "2020-11-13T16:00:54Z", "author": {"login": "vmuzikar"}, "path": "services/src/main/java/org/keycloak/theme/DefaultThemeManager.java", "diffHunk": "@@ -62,6 +64,14 @@ public Theme getTheme(Theme.Type type) {\n         return getTheme(name, type);\n     }\n \n+    private String typeBasedDefault(Theme.Type type) {\n+        if ((type == Theme.Type.ACCOUNT) && isAccount2Enabled) {\n+            return \"keycloak.v2\";\n+        }\n+        \n+        return \"keycloak\";\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0NDgwMw==", "bodyText": "I haven't deeply investigated this, but it seems to me a bit suspicious. Why is it even necessary? Don't we set the correct theme here?\n\n  \n    \n      keycloak/services/src/main/java/org/keycloak/theme/DefaultThemeManager.java\n    \n    \n         Line 85\n      in\n      734ffb8\n    \n    \n    \n    \n\n        \n          \n           theme = loadTheme(typeBasedDefault(type), type);", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523044803", "createdAt": "2020-11-13T16:01:31Z", "author": {"login": "vmuzikar"}, "path": "services/src/main/java/org/keycloak/theme/DefaultThemeManager.java", "diffHunk": "@@ -81,9 +91,18 @@ public Theme getTheme(String name, Theme.Type type) {\n                 theme = factory.addCachedTheme(name, type, theme);\n             }\n         }\n+        \n+        if (!isAccount2Enabled && theme.getName().equals(\"keycloak.v2\")) {\n+            theme = loadTheme(\"keycloak\", type);\n+        }\n+        \n+        if (!isAccount2Enabled && theme.getName().equals(\"rhsso.v2\")) {\n+            theme = loadTheme(\"rhsso\", type);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1NDgwNw==", "bodyText": "Again, I'm not sure this is the right place to hardcode this. What if we have more v2 themes in the future? Cannot we have some property for this is Theme.Type, perhaps?", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523054807", "createdAt": "2020-11-13T16:17:40Z", "author": {"login": "vmuzikar"}, "path": "services/src/main/java/org/keycloak/theme/DefaultThemeSelectorProvider.java", "diffHunk": "@@ -47,6 +49,9 @@ public String getThemeName(Theme.Type type) {\n \n         if (name == null || name.isEmpty()) {\n             name = Config.scope(\"theme\").get(\"default\", Version.NAME.toLowerCase());\n+            if ((type == Theme.Type.ACCOUNT) && isAccount2Enabled) {\n+                name = name.concat(\".v2\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA3ODY2MA==", "bodyText": "IMHO this logic deserves a test.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523078660", "createdAt": "2020-11-13T16:54:43Z", "author": {"login": "vmuzikar"}, "path": "services/src/main/java/org/keycloak/theme/DefaultThemeManager.java", "diffHunk": "@@ -62,6 +64,14 @@ public Theme getTheme(Theme.Type type) {\n         return getTheme(name, type);\n     }\n \n+    private String typeBasedDefault(Theme.Type type) {\n+        if ((type == Theme.Type.ACCOUNT) && isAccount2Enabled) {\n+            return \"keycloak.v2\";\n+        }\n+        \n+        return \"keycloak\";\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEwMjc0OA==", "bodyText": "This comment is unrelated to this line.\nThere seems to be something wrong with the dist. It's ~50MB larger. I think the resources filtering doesn't work anymore.", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r523102748", "createdAt": "2020-11-13T17:20:31Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/keycloak.v2/account/src/package.json", "diffHunk": "@@ -1,7 +1,7 @@\n {\n-  \"name\": \"keycloak-preview\",\n+  \"name\": \"keycloak.v2\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f"}, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "734ffb8f4212a947297935b0542f9a16fd02098f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/734ffb8f4212a947297935b0542f9a16fd02098f", "committedDate": "2020-11-13T13:07:55Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "80197abe35f0f2bd764fc010b7fed7775d070a2a", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/80197abe35f0f2bd764fc010b7fed7775d070a2a", "committedDate": "2020-11-14T18:30:46Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMDExNTQ0", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-531011544", "createdAt": "2020-11-16T07:54:17Z", "commit": {"oid": "80197abe35f0f2bd764fc010b7fed7775d070a2a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fcc5937cbe0851144b52e573c66845039552d6e", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/5fcc5937cbe0851144b52e573c66845039552d6e", "committedDate": "2020-11-16T14:03:34Z", "message": "Merge branch 'master' into kc14547-make-nac-default-2"}, "afterCommit": {"oid": "5e4c514e57504218aa41982b52832a59b018c5e8", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/5e4c514e57504218aa41982b52832a59b018c5e8", "committedDate": "2020-11-16T14:23:16Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e4c514e57504218aa41982b52832a59b018c5e8", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/5e4c514e57504218aa41982b52832a59b018c5e8", "committedDate": "2020-11-16T14:23:16Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "20bc962a6e5266c74574f2204eefbb708edef20f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/20bc962a6e5266c74574f2204eefbb708edef20f", "committedDate": "2020-11-16T15:05:58Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMzEzMjA2", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-533313206", "createdAt": "2020-11-18T10:40:10Z", "commit": {"oid": "20bc962a6e5266c74574f2204eefbb708edef20f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMDo0MDoxMFrOH1nhZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMDo0MDoxMFrOH1nhZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDEwMw==", "bodyText": "I don't know what happened but my test fixes from ssilvert#10 were somehow merged wrong. This line definitely shouldn't be here... @ssilvert Did you do some rebase of my changes or something?\nCould you please fix it and re-run both pipelines?", "url": "https://github.com/keycloak/keycloak/pull/7267#discussion_r525984103", "createdAt": "2020-11-18T10:40:10Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AbstractKeycloakTest.java", "diffHunk": "@@ -96,6 +98,7 @@\n  */\n @RunWith(KcArquillian.class)\n @RunAsClient\n+@DisableFeature(value = Profile.Feature.ACCOUNT2, skipRestart = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc962a6e5266c74574f2204eefbb708edef20f"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20bc962a6e5266c74574f2204eefbb708edef20f", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/20bc962a6e5266c74574f2204eefbb708edef20f", "committedDate": "2020-11-16T15:05:58Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "f1079d09bf42ed3cb97c7b094685a924cb16d299", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/f1079d09bf42ed3cb97c7b094685a924cb16d299", "committedDate": "2020-11-18T12:44:54Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MzY3MzYx", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-536367361", "createdAt": "2020-11-23T11:03:35Z", "commit": {"oid": "05b768dbb076fa97ef697e205ea48a5684ce7491"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f836a0447421e95f1e5839fc11f0fa6bee1adb72", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/f836a0447421e95f1e5839fc11f0fa6bee1adb72", "committedDate": "2020-11-23T14:10:40Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05b768dbb076fa97ef697e205ea48a5684ce7491", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/05b768dbb076fa97ef697e205ea48a5684ce7491", "committedDate": "2020-11-19T18:26:24Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}, "afterCommit": {"oid": "f836a0447421e95f1e5839fc11f0fa6bee1adb72", "author": {"user": {"login": "ssilvert", "name": "Stan Silvert"}}, "url": "https://github.com/keycloak/keycloak/commit/f836a0447421e95f1e5839fc11f0fa6bee1adb72", "committedDate": "2020-11-23T14:10:40Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df897ab7c4c6323af07942c2f5975937d179a0a3", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/df897ab7c4c6323af07942c2f5975937d179a0a3", "committedDate": "2020-11-23T14:33:31Z", "message": "KEYCLOAK-14547: Make New Account Console the default."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NjM3MjQz", "url": "https://github.com/keycloak/keycloak/pull/7267#pullrequestreview-536637243", "createdAt": "2020-11-23T16:23:25Z", "commit": {"oid": "df897ab7c4c6323af07942c2f5975937d179a0a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2854, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}