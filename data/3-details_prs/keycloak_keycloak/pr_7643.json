{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MDEwODAy", "number": 7643, "title": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter", "bodyText": "", "createdAt": "2020-11-26T11:22:10Z", "url": "https://github.com/keycloak/keycloak/pull/7643", "merged": true, "mergeCommit": {"oid": "ca81e6ae8c5036581c21bbe5c4923d1af8fed55e"}, "closed": true, "closedAt": "2021-03-23T11:37:51Z", "author": {"login": "Xiangjiaox"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdvjYp8gFqTU2Njc3NDcwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeF7fTaAFqTYxODQ4NDcwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2Nzc0NzA5", "url": "https://github.com/keycloak/keycloak/pull/7643#pullrequestreview-566774709", "createdAt": "2021-01-12T23:05:17Z", "commit": {"oid": "81c8c3ee49a58be2c3dfdb9c056429c3e309938b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg2OTM0Nzgz", "url": "https://github.com/keycloak/keycloak/pull/7643#pullrequestreview-586934783", "createdAt": "2021-02-09T19:38:05Z", "commit": {"oid": "e951172f656cb0d926e1a32a67f59fc19271c30d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQxOTozODowNVrOIioSkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQxOTo0Nzo0MVrOIioqOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzE4MjYxMA==", "bodyText": "This should be better orElseGet(Collections::emptyList).", "url": "https://github.com/keycloak/keycloak/pull/7643#discussion_r573182610", "createdAt": "2021-02-09T19:38:05Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/keys/JavaKeystoreKeyProvider.java", "diffHunk": "@@ -62,7 +59,12 @@ protected KeyWrapper loadKey(RealmModel realm, ComponentModel model) {\n                 certificate = CertificateUtils.generateV1SelfSignedCertificate(keyPair, realm.getName());\n             }\n \n-            return createKeyWrapper(keyPair, certificate);\n+            final List<X509Certificate> certificateChain = Optional.ofNullable(keyStore.getCertificateChain(model.get(JavaKeystoreKeyProviderFactory.KEY_ALIAS_KEY)))\n+                    .map(certificates -> (X509Certificate[]) certificates)\n+                    .map(Arrays::asList)\n+                    .orElseGet(ArrayList::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e951172f656cb0d926e1a32a67f59fc19271c30d"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzE4ODY2NQ==", "bodyText": "Use Collections.emptyList().", "url": "https://github.com/keycloak/keycloak/pull/7643#discussion_r573188665", "createdAt": "2021-02-09T19:47:41Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/keys/AbstractRsaKeyProvider.java", "diffHunk": "@@ -66,6 +62,10 @@ public AbstractRsaKeyProvider(RealmModel realm, ComponentModel model) {\n     }\n \n     protected KeyWrapper createKeyWrapper(KeyPair keyPair, X509Certificate certificate) {\n+        return createKeyWrapper(keyPair, certificate, new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e951172f656cb0d926e1a32a67f59fc19271c30d"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce1c08b52c5a3cf18138c99deeb793835e4c02c6", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/ce1c08b52c5a3cf18138c99deeb793835e4c02c6", "committedDate": "2021-02-28T22:25:24Z", "message": "KEYCLOAK-15015 Add server certificate to chain if missing and implement chain verification\n\nKEYCLOAK-15015 Implement PR suggestions and update attribute description\n\nKEYCLOAK-15015 Implement certificate chain loading\n\nKEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter."}, "afterCommit": {"oid": "e951172f656cb0d926e1a32a67f59fc19271c30d", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/e951172f656cb0d926e1a32a67f59fc19271c30d", "committedDate": "2021-02-04T12:27:18Z", "message": "KEYCLOAK-15015 Implement certificate chain loading"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94191f83bfe09668ea5535a2e373d305ec1f61ff", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/94191f83bfe09668ea5535a2e373d305ec1f61ff", "committedDate": "2021-03-01T16:03:09Z", "message": "KEYCLOAK-15015 Extend column to enable storing 5 pem encoded certificates for certificate chain"}, "afterCommit": {"oid": "3ea19c1980a3882c1cb5d709f62c44eabb8cd5fb", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/3ea19c1980a3882c1cb5d709f62c44eabb8cd5fb", "committedDate": "2021-03-01T16:18:31Z", "message": "KEYCLOAK-15015 Extend column to enable storing 5 pem encoded certificates for certificate chain"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ea19c1980a3882c1cb5d709f62c44eabb8cd5fb", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/3ea19c1980a3882c1cb5d709f62c44eabb8cd5fb", "committedDate": "2021-03-01T16:18:31Z", "message": "KEYCLOAK-15015 Extend column to enable storing 5 pem encoded certificates for certificate chain"}, "afterCommit": {"oid": "6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "committedDate": "2021-03-17T14:10:43Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "committedDate": "2021-03-17T14:10:43Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}, "afterCommit": {"oid": "0898e08436f10e6241e5688396aefa826525ca2a", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/0898e08436f10e6241e5688396aefa826525ca2a", "committedDate": "2021-03-22T11:25:51Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0898e08436f10e6241e5688396aefa826525ca2a", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/0898e08436f10e6241e5688396aefa826525ca2a", "committedDate": "2021-03-22T11:25:51Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}, "afterCommit": {"oid": "6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "committedDate": "2021-03-17T14:10:43Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/6a7b9983032fa73fc4d03bfb0ea688913cab8bee", "committedDate": "2021-03-17T14:10:43Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}, "afterCommit": {"oid": "d7741b5c7692ccca1756a663c743bcc7168eccf9", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/d7741b5c7692ccca1756a663c743bcc7168eccf9", "committedDate": "2021-03-22T15:06:31Z", "message": "[KEYCLOAK-15015] - Publishing the x5c for JWK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "555509fb1248f741f2c708024c97f47cbe0f4183", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/555509fb1248f741f2c708024c97f47cbe0f4183", "committedDate": "2021-03-22T15:24:54Z", "message": "KEYCLOAK-15015 Extend KeyWrapper to add whole certificate chain in x5c parameter and validate certificate chain against truststore."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d41178c89c8aac3592ba9cbabbf090a6cdc533e1", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/d41178c89c8aac3592ba9cbabbf090a6cdc533e1", "committedDate": "2021-03-22T15:25:23Z", "message": "[KEYCLOAK-15015] - Publishing the x5c for JWK"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7741b5c7692ccca1756a663c743bcc7168eccf9", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/d7741b5c7692ccca1756a663c743bcc7168eccf9", "committedDate": "2021-03-22T15:06:31Z", "message": "[KEYCLOAK-15015] - Publishing the x5c for JWK"}, "afterCommit": {"oid": "d41178c89c8aac3592ba9cbabbf090a6cdc533e1", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/d41178c89c8aac3592ba9cbabbf090a6cdc533e1", "committedDate": "2021-03-22T15:25:23Z", "message": "[KEYCLOAK-15015] - Publishing the x5c for JWK"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE4NDg0NzA1", "url": "https://github.com/keycloak/keycloak/pull/7643#pullrequestreview-618484705", "createdAt": "2021-03-23T11:36:36Z", "commit": {"oid": "d41178c89c8aac3592ba9cbabbf090a6cdc533e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3272, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}