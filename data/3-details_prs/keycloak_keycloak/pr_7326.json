{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MTc3MDYw", "number": 7326, "title": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "bodyText": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "createdAt": "2020-08-09T17:07:54Z", "url": "https://github.com/keycloak/keycloak/pull/7326", "merged": true, "mergeCommit": {"oid": "f486e97c182425bf7a2178f2d93bc4b308ca3bd6"}, "closed": true, "closedAt": "2020-08-20T11:49:52Z", "author": {"login": "pratiksomangoudar"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9SPGlgBqjM2MzY2OTE1NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAu0C9gFqTQ3MTUxNTczOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f44a5195285feb47be1b7eefe000b9d2e14cc6fa", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/f44a5195285feb47be1b7eefe000b9d2e14cc6fa", "committedDate": "2020-08-09T16:56:50Z", "message": "refactoring realm create"}, "afterCommit": {"oid": "165fe9ae3b0047a380d569a33d55e37fceff216c", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/165fe9ae3b0047a380d569a33d55e37fceff216c", "committedDate": "2020-08-09T18:50:02Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "165fe9ae3b0047a380d569a33d55e37fceff216c", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/165fe9ae3b0047a380d569a33d55e37fceff216c", "committedDate": "2020-08-09T18:50:02Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}, "afterCommit": {"oid": "03352bea50b97b48bcd1e26271206f9a3dfa40e1", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/03352bea50b97b48bcd1e26271206f9a3dfa40e1", "committedDate": "2020-08-09T19:03:38Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NzI3NDgy", "url": "https://github.com/keycloak/keycloak/pull/7326#pullrequestreview-466727482", "createdAt": "2020-08-13T12:48:32Z", "commit": {"oid": "03352bea50b97b48bcd1e26271206f9a3dfa40e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMjo0ODozMlrOHAJ-Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMjo0ODozMlrOHAJ-Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTkyNTQwNw==", "bodyText": "Isn't better computIfAbsent? I mean, the way you did you still have the call to newRealm.getClientById.", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r469925407", "createdAt": "2020-08-13T12:48:32Z", "author": {"login": "pedroigor"}, "path": "server-spi-private/src/main/java/org/keycloak/models/utils/RepresentationToModel.java", "diffHunk": "@@ -342,20 +343,19 @@ public static void importRealm(KeycloakSession session, RealmRepresentation rep,\n         if (rep.getClients() != null) {\n             for (ClientRepresentation resourceRep : rep.getClients()) {\n                 if (resourceRep.getDefaultRoles() != null) {\n-                    ClientModel clientModel = newRealm.getClientByClientId(resourceRep.getClientId());\n+                    ClientModel clientModel = createdClients.getOrDefault(resourceRep.getClientId(), newRealm.getClientByClientId(resourceRep.getClientId()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03352bea50b97b48bcd1e26271206f9a3dfa40e1"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03352bea50b97b48bcd1e26271206f9a3dfa40e1", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/03352bea50b97b48bcd1e26271206f9a3dfa40e1", "committedDate": "2020-08-09T19:03:38Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}, "afterCommit": {"oid": "42c874ac86d7b52408672dbc78d1bec01d26d2bc", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/42c874ac86d7b52408672dbc78d1bec01d26d2bc", "committedDate": "2020-08-13T22:16:03Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42c874ac86d7b52408672dbc78d1bec01d26d2bc", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/42c874ac86d7b52408672dbc78d1bec01d26d2bc", "committedDate": "2020-08-13T22:16:03Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}, "afterCommit": {"oid": "c0aa920253697c98de6583690ea3f3f19ee1c81e", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/c0aa920253697c98de6583690ea3f3f19ee1c81e", "committedDate": "2020-08-14T12:57:36Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0aa920253697c98de6583690ea3f3f19ee1c81e", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/c0aa920253697c98de6583690ea3f3f19ee1c81e", "committedDate": "2020-08-14T12:57:36Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}, "afterCommit": {"oid": "c1e22c6833af0aad559fd324ccc988683014a22e", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/c1e22c6833af0aad559fd324ccc988683014a22e", "committedDate": "2020-08-14T12:59:28Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDQwNzkx", "url": "https://github.com/keycloak/keycloak/pull/7326#pullrequestreview-469440791", "createdAt": "2020-08-18T13:12:51Z", "commit": {"oid": "c1e22c6833af0aad559fd324ccc988683014a22e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMzoxMjo1MlrOHCTmXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMzoxMjo1MlrOHCTmXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE4MDMxNg==", "bodyText": "I think you can use here Function.identity() to avoid the roleModel -> roleModel.", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r472180316", "createdAt": "2020-08-18T13:12:52Z", "author": {"login": "pedroigor"}, "path": "server-spi-private/src/main/java/org/keycloak/models/utils/RepresentationToModel.java", "diffHunk": "@@ -364,17 +363,19 @@ public static void importRealm(KeycloakSession session, RealmRepresentation rep,\n         }\n \n         if (rep.getScopeMappings() != null) {\n+            Map<String, RoleModel> roleModelMap = newRealm.getRolesStream().collect(Collectors.toMap(RoleModel::getId, roleModel -> roleModel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1e22c6833af0aad559fd324ccc988683014a22e"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffbd1086cda0f0218d0918783ab394a0e0191d96", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/ffbd1086cda0f0218d0918783ab394a0e0191d96", "committedDate": "2020-08-19T00:02:09Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1e22c6833af0aad559fd324ccc988683014a22e", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/c1e22c6833af0aad559fd324ccc988683014a22e", "committedDate": "2020-08-14T12:59:28Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}, "afterCommit": {"oid": "ffbd1086cda0f0218d0918783ab394a0e0191d96", "author": {"user": null}, "url": "https://github.com/keycloak/keycloak/commit/ffbd1086cda0f0218d0918783ab394a0e0191d96", "committedDate": "2020-08-19T00:02:09Z", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTE1NzM4", "url": "https://github.com/keycloak/keycloak/pull/7326#pullrequestreview-471515738", "createdAt": "2020-08-20T11:49:43Z", "commit": {"oid": "ffbd1086cda0f0218d0918783ab394a0e0191d96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2915, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}