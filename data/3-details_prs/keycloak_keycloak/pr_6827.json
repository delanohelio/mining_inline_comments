{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MjczMzcx", "number": 6827, "title": "[KEYCLOAK-12980] Username not updated when \"Email as username\" is ena\u2026", "bodyText": "\u2026bled", "createdAt": "2020-02-24T22:56:06Z", "url": "https://github.com/keycloak/keycloak/pull/6827", "merged": true, "mergeCommit": {"oid": "dfb67c3aa419674230bb8e345c3583e0282138d8"}, "closed": true, "closedAt": "2020-03-03T09:26:37Z", "author": {"login": "douglaspalmer"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIYalTAFqTM2NTU1MTY4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ-33UAFqTM2NzgxNzM0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTUxNjg1", "url": "https://github.com/keycloak/keycloak/pull/6827#pullrequestreview-365551685", "createdAt": "2020-02-27T10:03:27Z", "commit": {"oid": "4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMDowMzoyN1rOFvMEAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMDowMzo1NVrOFvMFKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyNTAyNw==", "bodyText": "Should this be userRep.getUsername()?", "url": "https://github.com/keycloak/keycloak/pull/6827#discussion_r385025027", "createdAt": "2020-02-27T10:03:27Z", "author": {"login": "stianst"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "diffHunk": "@@ -458,6 +458,18 @@ public void createUserWithoutUsername() {\n         response.close();\n     }\n \n+    @Test\n+    public void createUserWithEmailAsUsername() {\n+        switchRegistrationEmailAsUsername(true);\n+\n+        String id = createUser();\n+        UserResource user = realm.users().get(id);\n+        UserRepresentation userRep = user.toRepresentation();\n+        assertEquals(\"user1@localhost\", userRep.getEmail());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyNTI4Ng==", "bodyText": "Should this be userRep.getUsername()?", "url": "https://github.com/keycloak/keycloak/pull/6827#discussion_r385025286", "createdAt": "2020-02-27T10:03:51Z", "author": {"login": "stianst"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "diffHunk": "@@ -1458,6 +1470,25 @@ public void updateUserWithoutUsername() {\n         switchEditUsernameAllowedOn(false);\n     }\n \n+    @Test\n+    public void updateUserWithEmailAsUsername() {\n+        switchRegistrationEmailAsUsername(true);\n+\n+        String id = createUser();\n+\n+        UserResource user = realm.users().get(id);\n+        UserRepresentation userRep = user.toRepresentation();\n+        assertEquals(\"user1@localhost\", userRep.getEmail());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyNTMyMA==", "bodyText": "Should this be userRep.getUsername()?", "url": "https://github.com/keycloak/keycloak/pull/6827#discussion_r385025320", "createdAt": "2020-02-27T10:03:55Z", "author": {"login": "stianst"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "diffHunk": "@@ -1458,6 +1470,25 @@ public void updateUserWithoutUsername() {\n         switchEditUsernameAllowedOn(false);\n     }\n \n+    @Test\n+    public void updateUserWithEmailAsUsername() {\n+        switchRegistrationEmailAsUsername(true);\n+\n+        String id = createUser();\n+\n+        UserResource user = realm.users().get(id);\n+        UserRepresentation userRep = user.toRepresentation();\n+        assertEquals(\"user1@localhost\", userRep.getEmail());\n+\n+        userRep.setEmail(\"user11@localhost\");\n+        updateUser(user, userRep);\n+\n+        userRep = realm.users().get(id).toRepresentation();\n+        assertEquals(\"user11@localhost\", userRep.getEmail());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cecdf867c87e428f16a36ffe5db9a72f51eb7732", "author": {"user": {"login": "douglaspalmer", "name": "Douglas Palmer"}}, "url": "https://github.com/keycloak/keycloak/commit/cecdf867c87e428f16a36ffe5db9a72f51eb7732", "committedDate": "2020-02-27T18:51:23Z", "message": "[KEYCLOAK-12980] Username not updated when \"Email as username\" is enabled"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0", "author": {"user": {"login": "douglaspalmer", "name": "Douglas Palmer"}}, "url": "https://github.com/keycloak/keycloak/commit/4c99d9645c44b49c26c6c3b5d61c8d78509f3ff0", "committedDate": "2020-02-24T22:55:36Z", "message": "[KEYCLOAK-12980] Username not updated when \"Email as username\" is enabled"}, "afterCommit": {"oid": "cecdf867c87e428f16a36ffe5db9a72f51eb7732", "author": {"user": {"login": "douglaspalmer", "name": "Douglas Palmer"}}, "url": "https://github.com/keycloak/keycloak/commit/cecdf867c87e428f16a36ffe5db9a72f51eb7732", "committedDate": "2020-02-27T18:51:23Z", "message": "[KEYCLOAK-12980] Username not updated when \"Email as username\" is enabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODE3MzQ3", "url": "https://github.com/keycloak/keycloak/pull/6827#pullrequestreview-367817347", "createdAt": "2020-03-03T09:26:32Z", "commit": {"oid": "cecdf867c87e428f16a36ffe5db9a72f51eb7732"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2534, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}