{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNjg4MzE4", "number": 7319, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDo0NDo0OFrOElsdhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDo0NDo0OFrOElsdhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3OTYxMjIxOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaUserProvider.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNDo0NDo0OFrOHVTsmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNDowMzozOFrOHWwIqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwNDg1OA==", "bodyText": "This introduction of if-then-else introduces a separate branch of the search. Is there a reason for not treating UserModel.IDP_ALIAS and UserModel.IDP_USER_ID the same way as the other attributes? Could it be part of the switch instead?", "url": "https://github.com/keycloak/keycloak/pull/7319#discussion_r492104858", "createdAt": "2020-09-21T14:44:48Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaUserProvider.java", "diffHunk": "@@ -841,42 +841,60 @@ public int getUsersCount(Map<String, String> params, RealmModel realm, Set<Strin\n             predicates.add(root.get(\"serviceAccountClientLink\").isNull());\n         }\n \n-        for (Map.Entry<String, String> entry : attributes.entrySet()) {\n-            String key = entry.getKey();\n-            String value = entry.getValue();\n+        final String idpAlias = attributes.get(UserModel.IDP_ALIAS);\n+        final String idpUserId = attributes.get(UserModel.IDP_USER_ID);\n+        if (idpAlias != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8823a3e79ae0807ffa677a7ca221988e217a160b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEyMzc4Ng==", "bodyText": "My colleagues and I thought that it would be better to have the idp-search separated from the search for other attributes. One reason was that we decided that the idp-parameters have to be always searched for exactly - this is different from the other attributes for which a contains-search is provided.\nBut I can also understand the advantage of combining the idp-search with other attributes - the search would be more powerful.", "url": "https://github.com/keycloak/keycloak/pull/7319#discussion_r492123786", "createdAt": "2020-09-21T15:03:57Z", "author": {"login": "danielFesenmeyer"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaUserProvider.java", "diffHunk": "@@ -841,42 +841,60 @@ public int getUsersCount(Map<String, String> params, RealmModel realm, Set<Strin\n             predicates.add(root.get(\"serviceAccountClientLink\").isNull());\n         }\n \n-        for (Map.Entry<String, String> entry : attributes.entrySet()) {\n-            String key = entry.getKey();\n-            String value = entry.getValue();\n+        final String idpAlias = attributes.get(UserModel.IDP_ALIAS);\n+        final String idpUserId = attributes.get(UserModel.IDP_USER_ID);\n+        if (idpAlias != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwNDg1OA=="}, "originalCommit": {"oid": "8823a3e79ae0807ffa677a7ca221988e217a160b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxOTM3MQ==", "bodyText": "One reason was that we decided that the idp-parameters have to be always searched for exactly - this is different from the other attributes for which a contains-search is provided.\n\nThis limitation is a reasonable one, since it would be strange to search for an identity provider alias / username via a substring search. Still, JPA storage search would benefit from allowing for combining the predicates, so that it would be possible to search for e.g. enabled users coming from the given idp.", "url": "https://github.com/keycloak/keycloak/pull/7319#discussion_r493619371", "createdAt": "2020-09-23T14:03:38Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/JpaUserProvider.java", "diffHunk": "@@ -841,42 +841,60 @@ public int getUsersCount(Map<String, String> params, RealmModel realm, Set<Strin\n             predicates.add(root.get(\"serviceAccountClientLink\").isNull());\n         }\n \n-        for (Map.Entry<String, String> entry : attributes.entrySet()) {\n-            String key = entry.getKey();\n-            String value = entry.getValue();\n+        final String idpAlias = attributes.get(UserModel.IDP_ALIAS);\n+        final String idpUserId = attributes.get(UserModel.IDP_USER_ID);\n+        if (idpAlias != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwNDg1OA=="}, "originalCommit": {"oid": "8823a3e79ae0807ffa677a7ca221988e217a160b"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3510, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}