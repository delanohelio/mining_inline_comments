{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMDAyNTMz", "number": 7438, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNjo0NToyN1rOEmZJDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNjo0NToyN1rOEmZJDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjkzMjYxOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNjo0NToyN1rOHWYpKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNDozN1rOHWp4_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw==", "bodyText": "Not sure I understand the reason behind this change", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493234473", "createdAt": "2020-09-23T06:45:27Z", "author": {"login": "stianst"}, "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMTAyOQ==", "bodyText": "Only reverted the change I did in the previous PR.", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493421029", "createdAt": "2020-09-23T10:25:53Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, "originalCommit": {"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQzNDY2MA==", "bodyText": "Seems like the change you made here was valid, but not sure tbh, as this stuff really is a bit odd.", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493434660", "createdAt": "2020-09-23T10:40:42Z", "author": {"login": "stianst"}, "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, "originalCommit": {"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ0MjcwOA==", "bodyText": "Yes, but I would prefer reverting it as it was before. It was not really related to the original issue.", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493442708", "createdAt": "2020-09-23T10:49:37Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, "originalCommit": {"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNzA1Mg==", "bodyText": "I agree that this is strange workaround, however it seems as the safest what can be done IMO.\nThe problem is one bigger issue that UserInfoTokenMapper class accepts \"AccessToken\" as an argument for some reason. This doesn't makes sense to me as it should instead accept \"UserInfo\" representation as an argument. This will allow to cleanup these workarounds and the strange code in UserInfoEndpoint, which need to manually convert token into the \"claims\" map. I've created JIRA for this few days ago https://issues.redhat.com/browse/KEYCLOAK-15537 . I suggest to address that one as a follow-up to remove workarounds. For now, I am just accepting the PR as it seems as the safest way for the backport to z-stream.", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493517052", "createdAt": "2020-09-23T12:14:37Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, "originalCommit": {"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3346, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}