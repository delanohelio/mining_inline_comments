{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MTY4OTQ4", "number": 6806, "title": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials", "bodyText": "", "createdAt": "2020-02-19T13:27:03Z", "url": "https://github.com/keycloak/keycloak/pull/6806", "merged": true, "mergeCommit": {"oid": "49b1dbba68af0b387d8d5101847d17321605a1cf"}, "closed": true, "closedAt": "2020-03-03T05:48:03Z", "author": {"login": "pedroigor"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF2isGAFqTM2MTEwNzM1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ7vq0AFqTM2NzcxNTkyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTA3MzU4", "url": "https://github.com/keycloak/keycloak/pull/6806#pullrequestreview-361107358", "createdAt": "2020-02-19T13:28:28Z", "commit": {"oid": "56d336cdb2b8f1ef7323207256b53ae3c45486fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMzoyODoyOFrOFrn_lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMzoyODoyOFrOFrn_lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI4ODM0Mg==", "bodyText": "It may look weird a 409 response here. But I didn't want to change the scope of this PR and review how the endpoint is mapping errors to the proper status.", "url": "https://github.com/keycloak/keycloak/pull/6806#discussion_r381288342", "createdAt": "2020-02-19T13:28:28Z", "author": {"login": "pedroigor"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/oauth/ServiceAccountTest.java", "diffHunk": "@@ -281,6 +291,25 @@ public void clientCredentialsAuthRequest_ClientES256_RealmPS256() throws Excepti\n     \tconductClientCredentialsAuthRequest(Algorithm.HS256, Algorithm.ES256, Algorithm.PS256);\n     }\n \n+    @Test\n+    public void failManagePassword() {\n+        UserResource serviceAccount = adminClient.realm(\"test\").users().get(userId);\n+        UserRepresentation representation = serviceAccount.toRepresentation();\n+\n+        CredentialRepresentation password = new CredentialRepresentation();\n+        password.setValue(\"password\");\n+        password.setType(CredentialRepresentation.PASSWORD);\n+        password.setTemporary(false);\n+\n+        representation.setCredentials(Arrays.asList(password));\n+\n+        this.expectedException.expect(Matchers.allOf(Matchers.instanceOf(ClientErrorException.class), \n+                Matchers.hasProperty(\"response\", Matchers.hasProperty(\"status\", Matchers.is(409)))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56d336cdb2b8f1ef7323207256b53ae3c45486fa"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjg4NDA1", "url": "https://github.com/keycloak/keycloak/pull/6806#pullrequestreview-361288405", "createdAt": "2020-02-19T17:27:18Z", "commit": {"oid": "56d336cdb2b8f1ef7323207256b53ae3c45486fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzoyNzoxOFrOFrwgoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzoyNzoxOFrOFrwgoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyNzg3Mg==", "bodyText": "Is it really necessary to add this check here? Doesn't the AuthenticationProcessor prevent the login request from reaching this point?", "url": "https://github.com/keycloak/keycloak/pull/6806#discussion_r381427872", "createdAt": "2020-02-19T17:27:18Z", "author": {"login": "sguilhen"}, "path": "services/src/main/java/org/keycloak/authentication/authenticators/browser/AbstractUsernameFormAuthenticator.java", "diffHunk": "@@ -101,7 +101,7 @@ protected void dummyHash(AuthenticationFlowContext context) {\n     }\n \n     public void testInvalidUser(AuthenticationFlowContext context, UserModel user) {\n-        if (user == null) {\n+        if (user == null || user.getServiceAccountClientLink() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56d336cdb2b8f1ef7323207256b53ae3c45486fa"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56d336cdb2b8f1ef7323207256b53ae3c45486fa", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/56d336cdb2b8f1ef7323207256b53ae3c45486fa", "committedDate": "2020-02-19T13:25:01Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}, "afterCommit": {"oid": "63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "committedDate": "2020-02-19T17:27:15Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODcwNzY1", "url": "https://github.com/keycloak/keycloak/pull/6806#pullrequestreview-361870765", "createdAt": "2020-02-20T12:44:12Z", "commit": {"oid": "63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDU4ODUx", "url": "https://github.com/keycloak/keycloak/pull/6806#pullrequestreview-365458851", "createdAt": "2020-02-27T07:23:39Z", "commit": {"oid": "63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/63ccd3b6fd4c2796f48ce49ba8a54ed663d7ff15", "committedDate": "2020-02-19T17:27:15Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}, "afterCommit": {"oid": "97e345fca29fc4615622ebeaaf9478aa61037a56", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/97e345fca29fc4615622ebeaaf9478aa61037a56", "committedDate": "2020-02-27T22:02:55Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bd58ca258bc10a604031b621b83343d2b78ed3a", "author": {"user": {"login": "sguilhen", "name": "Stefan Guilhen"}}, "url": "https://github.com/keycloak/keycloak/commit/0bd58ca258bc10a604031b621b83343d2b78ed3a", "committedDate": "2020-02-27T22:05:45Z", "message": "[KEYCLOAK-12612][KEYCLOAK-12944] Fix validation of SAML destination URLs\n - no longer compare them to the server absolutePath; instead use the base URI to build the validation URL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c3fcd68c43521d90ea77ac75108f251d0229024", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/8c3fcd68c43521d90ea77ac75108f251d0229024", "committedDate": "2020-02-27T22:07:03Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97e345fca29fc4615622ebeaaf9478aa61037a56", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/97e345fca29fc4615622ebeaaf9478aa61037a56", "committedDate": "2020-02-27T22:02:55Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}, "afterCommit": {"oid": "8c3fcd68c43521d90ea77ac75108f251d0229024", "author": {"user": {"login": "pedroigor", "name": "Pedro Igor"}}, "url": "https://github.com/keycloak/keycloak/commit/8c3fcd68c43521d90ea77ac75108f251d0229024", "committedDate": "2020-02-27T22:07:03Z", "message": "[KEYCLOAK-11804] - Block service accounts to authenticate or manage credentials"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NzE1OTI2", "url": "https://github.com/keycloak/keycloak/pull/6806#pullrequestreview-367715926", "createdAt": "2020-03-03T05:47:52Z", "commit": {"oid": "8c3fcd68c43521d90ea77ac75108f251d0229024"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2514, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}