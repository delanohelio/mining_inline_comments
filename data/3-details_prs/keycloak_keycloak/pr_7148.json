{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMTI0NDA2", "number": 7148, "title": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP", "bodyText": "Since this PR slightly touches adapter tests as well, I run the tests here: https://keycloak-jenkins.com/job/universal-test-pipeline-adapters/1440/", "createdAt": "2020-06-08T13:11:16Z", "url": "https://github.com/keycloak/keycloak/pull/7148", "merged": true, "mergeCommit": {"oid": "d71e81ed5e0f2eba5bd7c45da1a1e983c7bf9e90"}, "closed": true, "closedAt": "2020-06-17T12:13:01Z", "author": {"login": "vmuzikar"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpQRS8gBqjM0MTk5OTEzNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsIyPaAFqTQzMjMzNzI4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff99152f514190ba9495bcf8f68f31a29e152fa2", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/ff99152f514190ba9495bcf8f68f31a29e152fa2", "committedDate": "2020-06-08T13:10:54Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935", "committedDate": "2020-06-08T13:14:09Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjIwNzg3", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-426220787", "createdAt": "2020-06-08T13:14:37Z", "commit": {"oid": "ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoxNDozN1rOGgdVAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoxNDozN1rOGgdVAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4ODEzMA==", "bodyText": "I'm not sure if this is intended behavior. @mposolda Could you please double check this?", "url": "https://github.com/keycloak/keycloak/pull/7148#discussion_r436688130", "createdAt": "2020-06-08T13:14:37Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/broker/AbstractFirstBrokerLoginTest.java", "diffHunk": "@@ -286,14 +288,19 @@ public void testLinkAccountByLogInAsUserUsingBrowserButtons() {\n         // Click browser 'back' and then 'forward' and then continue\n         driver.navigate().back();\n         assertTrue(driver.getPageSource().contains(\"You are already logged in.\"));\n-        driver.navigate().forward();\n+        driver.navigate().forward(); // here a new execution ID is added to the URL using JS, see below\n         idpConfirmLinkPage.assertCurrent();\n \n         // Click browser 'back' on review profile page\n         idpConfirmLinkPage.clickReviewProfile();\n         waitForPage(driver, \"update account information\", false);\n         updateAccountInformationPage.assertCurrent();\n         driver.navigate().back();\n+        // JS-capable browsers (i.e. all except HtmlUnit) add a new execution ID to the URL which then causes the login expire page to appear (because the old ID and new ID don't match)\n+        if (!(driver instanceof HtmlUnitDriver)) {\n+            loginExpiredPage.assertCurrent();\n+            loginExpiredPage.clickLoginContinueLink();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935"}, "originalPosition": 99}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/ee6d153c819fe2b5bbb1858d3b82c1c29b7a7935", "committedDate": "2020-06-08T13:14:09Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "4d6757b305a3ed2147f192fa5bb8b7170c459bce", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/4d6757b305a3ed2147f192fa5bb8b7170c459bce", "committedDate": "2020-06-08T13:57:21Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d6757b305a3ed2147f192fa5bb8b7170c459bce", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/4d6757b305a3ed2147f192fa5bb8b7170c459bce", "committedDate": "2020-06-08T13:57:21Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "be97910ceb1aab529ab1e2d360ba4a4912815353", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/be97910ceb1aab529ab1e2d360ba4a4912815353", "committedDate": "2020-06-09T14:08:50Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be97910ceb1aab529ab1e2d360ba4a4912815353", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/be97910ceb1aab529ab1e2d360ba4a4912815353", "committedDate": "2020-06-09T14:08:50Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "c52a7d0d268b4b40d20ee238a26d23fd8ed27f3e", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/c52a7d0d268b4b40d20ee238a26d23fd8ed27f3e", "committedDate": "2020-06-09T14:13:19Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c52a7d0d268b4b40d20ee238a26d23fd8ed27f3e", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/c52a7d0d268b4b40d20ee238a26d23fd8ed27f3e", "committedDate": "2020-06-09T14:13:19Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "edef4443ae54e6eaf03e17edd9bf0b25affaca18", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/edef4443ae54e6eaf03e17edd9bf0b25affaca18", "committedDate": "2020-06-10T13:48:56Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDM1MzY2", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-430435366", "createdAt": "2020-06-15T08:40:06Z", "commit": {"oid": "edef4443ae54e6eaf03e17edd9bf0b25affaca18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODo0MDowNlrOGjokig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODo0MDowNlrOGjokig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAxODA1OA==", "bodyText": "By default with this profile, firefox is running in headless mode. Could you please add some info about firefoxHeadless property here?", "url": "https://github.com/keycloak/keycloak/pull/7148#discussion_r440018058", "createdAt": "2020-06-15T08:40:06Z", "author": {"login": "mhajas"}, "path": "testsuite/integration-arquillian/HOW-TO-RUN.md", "diffHunk": "@@ -925,3 +925,19 @@ Then, just run tests using the `auth-server-quarkus` profile:\n \n     mvn -f testsuite/integration-arquillian/tests/base/pom.xml clean install -Pauth-server-quarkus\n \n+## Cookies testing\n+In order to reproduce some specific cookies behaviour in browsers (like SameSite policies or 3rd party cookie blocking),\n+some subset of tests needs to be ran with different hosts for auth server and app/IdP server in order to simulate third\n+party contexts. Those hosts must be different from localhost as that host has some special treatment from browsers. At\n+the same time both hosts must use different domains to be considered cross-origin, e.g. `127.0.0.1.nip.io` and\n+`127.0.0.1.xip.io`. NOT `app1.127.0.0.1.nip.io` and `app2.127.0.0.1.nip.io`!!\n+\n+Also, those new cookies policies are currently not yet enabled by default (which will change in the near future). To test\n+those policies, you need the latest stable Firefox and use `firefox-strict-cookies` profile.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edef4443ae54e6eaf03e17edd9bf0b25affaca18"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edef4443ae54e6eaf03e17edd9bf0b25affaca18", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/edef4443ae54e6eaf03e17edd9bf0b25affaca18", "committedDate": "2020-06-10T13:48:56Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "ff5b4875dbbae8a22415eadc3ab98446839f9b67", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/ff5b4875dbbae8a22415eadc3ab98446839f9b67", "committedDate": "2020-06-15T09:44:40Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNTMwMDk3", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-430530097", "createdAt": "2020-06-15T10:49:50Z", "commit": {"oid": "ff5b4875dbbae8a22415eadc3ab98446839f9b67"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff5b4875dbbae8a22415eadc3ab98446839f9b67", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/ff5b4875dbbae8a22415eadc3ab98446839f9b67", "committedDate": "2020-06-15T09:44:40Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "f96929efa116cf63b39c2e0f2fdab87a4e99673d", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/f96929efa116cf63b39c2e0f2fdab87a4e99673d", "committedDate": "2020-06-15T16:15:36Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzAxMzUx", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-431701351", "createdAt": "2020-06-16T16:46:07Z", "commit": {"oid": "f96929efa116cf63b39c2e0f2fdab87a4e99673d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDcyMDE4", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-432072018", "createdAt": "2020-06-17T05:38:58Z", "commit": {"oid": "f96929efa116cf63b39c2e0f2fdab87a4e99673d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDcyMjc0", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-432072274", "createdAt": "2020-06-17T05:39:39Z", "commit": {"oid": "f96929efa116cf63b39c2e0f2fdab87a4e99673d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d7fef3977930ef649e7d6e72f473e9c57333fd2", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/8d7fef3977930ef649e7d6e72f473e9c57333fd2", "committedDate": "2020-06-17T07:00:12Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f96929efa116cf63b39c2e0f2fdab87a4e99673d", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/f96929efa116cf63b39c2e0f2fdab87a4e99673d", "committedDate": "2020-06-15T16:15:36Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}, "afterCommit": {"oid": "8d7fef3977930ef649e7d6e72f473e9c57333fd2", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/8d7fef3977930ef649e7d6e72f473e9c57333fd2", "committedDate": "2020-06-17T07:00:12Z", "message": "KEYCLOAK-14235 Support for running broker tests with different hostnames for auth server and IdP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjkwNDc1", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-432290475", "createdAt": "2020-06-17T11:01:53Z", "commit": {"oid": "8d7fef3977930ef649e7d6e72f473e9c57333fd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzM3Mjgz", "url": "https://github.com/keycloak/keycloak/pull/7148#pullrequestreview-432337283", "createdAt": "2020-06-17T12:12:52Z", "commit": {"oid": "8d7fef3977930ef649e7d6e72f473e9c57333fd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2938, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}