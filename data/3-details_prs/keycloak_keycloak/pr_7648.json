{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NDQ3NTQ0", "number": 7648, "title": "KEYCLOAK-15264 Import realm IGNORE_EXISTING causes NPE", "bodyText": "Full-name: Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId\nJIRA: KEYCLOAK-15264", "createdAt": "2020-11-30T10:25:35Z", "url": "https://github.com/keycloak/keycloak/pull/7648", "merged": true, "mergeCommit": {"oid": "873a69305f55e2c55242bbdc5c5849abebb761fe"}, "closed": true, "closedAt": "2020-12-08T10:28:08Z", "author": {"login": "mabartos"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhjwftgBqjQwNTE0ODQyNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkHkjNAFqTU0NzA0NDkzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71b8dcc55a3fa71bc5cce47c93a5dcf6d0383b1f", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/71b8dcc55a3fa71bc5cce47c93a5dcf6d0383b1f", "committedDate": "2020-11-30T09:58:12Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}, "afterCommit": {"oid": "ebcd3152858961f5ee6f3206704b52c7eb3536da", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ebcd3152858961f5ee6f3206704b52c7eb3536da", "committedDate": "2020-11-30T11:36:00Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebcd3152858961f5ee6f3206704b52c7eb3536da", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ebcd3152858961f5ee6f3206704b52c7eb3536da", "committedDate": "2020-11-30T11:36:00Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}, "afterCommit": {"oid": "ef97ad3d85008652ebd950e5766971904ae7531b", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ef97ad3d85008652ebd950e5766971904ae7531b", "committedDate": "2020-12-07T20:22:08Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef97ad3d85008652ebd950e5766971904ae7531b", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ef97ad3d85008652ebd950e5766971904ae7531b", "committedDate": "2020-12-07T20:22:08Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}, "afterCommit": {"oid": "ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b", "committedDate": "2020-12-07T20:23:28Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2ODAwMzQ0", "url": "https://github.com/keycloak/keycloak/pull/7648#pullrequestreview-546800344", "createdAt": "2020-12-08T07:07:26Z", "commit": {"oid": "ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNzowNzoyNlrOIBKKeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwNzowNzoyNlrOIBKKeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4NjAwOQ==", "bodyText": "Prefer orElseGet, otherwise the lookup by getClientByClientId is always performed, even when client can be found by id.", "url": "https://github.com/keycloak/keycloak/pull/7648#discussion_r538086009", "createdAt": "2020-12-08T07:07:26Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/services/managers/RealmManager.java", "diffHunk": "@@ -719,7 +720,15 @@ public void setupClientServiceAccountsAndAuthorizationOnImport(RealmRepresentati\n             ClientManager clientManager = new ClientManager(this);\n \n             for (ClientRepresentation client : clients) {\n-                ClientModel clientModel = this.getRealmByName(rep.getRealm()).getClientById(client.getId());\n+                RealmModel realmModel = this.getRealmByName(rep.getRealm());\n+\n+                ClientModel clientModel = Optional.ofNullable(client.getId())\n+                        .map(realmModel::getClientById)\n+                        .orElse(realmModel.getClientByClientId(client.getClientId()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7e80acead53f71396b9585bf295da930979c989", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/d7e80acead53f71396b9585bf295da930979c989", "committedDate": "2020-12-08T07:23:22Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/ea53e5fee3e03691ffc8912ce52cf4d95ee42d7b", "committedDate": "2020-12-07T20:23:28Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}, "afterCommit": {"oid": "d7e80acead53f71396b9585bf295da930979c989", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/d7e80acead53f71396b9585bf295da930979c989", "committedDate": "2020-12-08T07:23:22Z", "message": "KEYCLOAK-15264 Import realm using directory provider twice with IGNORE_EXISTING will cause NPE for clientId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MDQ0OTMy", "url": "https://github.com/keycloak/keycloak/pull/7648#pullrequestreview-547044932", "createdAt": "2020-12-08T10:27:46Z", "commit": {"oid": "d7e80acead53f71396b9585bf295da930979c989"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3282, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}