{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTU4Njk3", "number": 6897, "title": "KEYCLOAK-12916 add name or username in toolbar", "bodyText": "", "createdAt": "2020-03-16T11:10:31Z", "url": "https://github.com/keycloak/keycloak/pull/6897", "merged": true, "mergeCommit": {"oid": "1f462a2ae2cb14548e62624738df373453748620"}, "closed": true, "closedAt": "2020-05-04T18:58:29Z", "author": {"login": "edewit"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPNlgqgBqjMxNDYwNDI3NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceENoPgFqTQwNTI2MTA0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e49e300445122cb504e87711407c548179658c8", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/0e49e300445122cb504e87711407c548179658c8", "committedDate": "2020-03-16T11:09:58Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "35f6209ec6a4370953b4c98cd86f85cec778b5f8", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/35f6209ec6a4370953b4c98cd86f85cec778b5f8", "committedDate": "2020-03-19T15:24:10Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzQ4MzA4", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-378348308", "createdAt": "2020-03-20T09:54:34Z", "commit": {"oid": "35f6209ec6a4370953b4c98cd86f85cec778b5f8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35f6209ec6a4370953b4c98cd86f85cec778b5f8", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/35f6209ec6a4370953b4c98cd86f85cec778b5f8", "committedDate": "2020-03-19T15:24:10Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "f2715025b344d37411701efec2df07376836979e", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/f2715025b344d37411701efec2df07376836979e", "committedDate": "2020-03-20T11:20:41Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MjAzNTk4", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-388203598", "createdAt": "2020-04-06T12:33:38Z", "commit": {"oid": "f2715025b344d37411701efec2df07376836979e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMjozMzozOFrOGBViTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMjozODoyMVrOGBVs1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NDYwNQ==", "bodyText": "I don't think we necessarily need to make a separate test for this. It could \"piggyback\" on some other test class, e.g. PersonalInfoTest. (I think you had it like that at some point.)\nBut if you decide it should have its own test class (which is also ok), please don't base it on BaseAccountPageTest as it contains some features specific for a page test (like a navigation test, e.g.). You can use AbstractAccountTest instead as a much more suitable option.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404054605", "createdAt": "2020-04-06T12:33:38Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/LoggedInPageHeaderTest.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2018 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.testsuite.ui.account2;\n+\n+import org.jboss.arquillian.graphene.page.Page;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.keycloak.representations.idm.RealmRepresentation;\n+import org.keycloak.representations.idm.UserRepresentation;\n+import org.keycloak.testsuite.admin.ApiUtil;\n+import org.keycloak.testsuite.ui.account2.page.AbstractLoggedInPage;\n+import org.keycloak.testsuite.ui.account2.page.LoggedInPageHeaderPage;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+public class LoggedInPageHeaderTest extends BaseAccountPageTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2715025b344d37411701efec2df07376836979e"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NjU1Ng==", "bodyText": "Please don't make a separate Page Class for this. It's not a page, it's part of a page header. Please move its content to AbstractHeader (if the username will be displayed on Welcome Screen as well) or LoggedInPageHeader.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404056556", "createdAt": "2020-04-06T12:37:05Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/LoggedInPageHeaderPage.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.testsuite.ui.account2.page;\n+\n+import org.keycloak.representations.idm.UserRepresentation;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+\n+import static org.keycloak.testsuite.util.UIAssert.assertElementDisabled;\n+import static org.keycloak.testsuite.util.UIAssert.assertInputElementValid;\n+import static org.keycloak.testsuite.util.UIUtils.getTextInputValue;\n+import static org.keycloak.testsuite.util.UIUtils.setTextInputValue;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+public class LoggedInPageHeaderPage extends AbstractLoggedInPage {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2715025b344d37411701efec2df07376836979e"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA1NzMwMg==", "bodyText": "I think we should display the logged in user on Welcome Screen as well. This way it's not consistent.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404057302", "createdAt": "2020-04-06T12:38:21Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/App.tsx", "diffHunk": "@@ -63,11 +63,17 @@ export class App extends React.Component<AppProps> {\n         // globally set up locale for date formatting\n         moment.locale(locale);\n \n+        const avatar = (\n+            <div className=\"pf-l-toolbar__group\" style={{marginLeft: '10px'}}>\n+                <span id=\"loggedInUser\">{this.kcSvc.userName}</span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2715025b344d37411701efec2df07376836979e"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2715025b344d37411701efec2df07376836979e", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/f2715025b344d37411701efec2df07376836979e", "committedDate": "2020-03-20T11:20:41Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "a35350af9cba5c9140e52c553ad3b0e82df6480a", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/a35350af9cba5c9140e52c553ad3b0e82df6480a", "committedDate": "2020-04-07T09:11:50Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a35350af9cba5c9140e52c553ad3b0e82df6480a", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/a35350af9cba5c9140e52c553ad3b0e82df6480a", "committedDate": "2020-04-07T09:11:50Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/f90c756aa22fc78304d2ffac7b9143fd2bb39728", "committedDate": "2020-04-07T09:32:56Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTUzODcx", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-388953871", "createdAt": "2020-04-07T09:43:38Z", "commit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo0MzozOFrOGB7i-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo0NDoxNFrOGB7klA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzM3MQ==", "bodyText": "Please make sure the test is thorough enough and possibly covers all the possibilities (user doesn't have first and last name, user has only first or last name, user has preferred username, ...).\nAnd possibly add a test for Welcome Screen as well.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404677371", "createdAt": "2020-04-07T09:43:38Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/PersonalInfoTest.java", "diffHunk": "@@ -154,6 +155,11 @@ public void disabledEditUsername() {\n         personalInfoPage.valuesEqual(testUser2);\n     }\n \n+    @Test\n+    public void testNameInToolbar() {\n+        assertEquals(\"test user\", personalInfoPage.header().getToolbarLoggedInUser().getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3Nzc4MA==", "bodyText": "Does this mean Welcome Page doesn't display first and last name of a user?", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r404677780", "createdAt": "2020-04-07T09:44:14Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -109,6 +109,7 @@\n                 } else {\n                     document.getElementById(\"landingSignOutButton\").style.display='inline';\n                     document.getElementById(\"landingSignOutLink\").style.display='inline';\n+                    document.getElementById(\"loggedInUser\").innerHTML = keycloak.tokenParsed.preferred_username;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/f90c756aa22fc78304d2ffac7b9143fd2bb39728", "committedDate": "2020-04-07T09:32:56Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "committedDate": "2020-04-07T13:10:31Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/923ce8502482ba0af4b44abcbc5a8ed1cca7e41b", "committedDate": "2020-04-07T13:10:31Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}, "afterCommit": {"oid": "897d2394e4ed5d807e6d113b7ec508721f916105", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/897d2394e4ed5d807e6d113b7ec508721f916105", "committedDate": "2020-04-07T14:39:16Z", "message": "KEYCLOAK-12916 add name or username in toolbar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODYzMTU2", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-389863156", "createdAt": "2020-04-08T10:52:03Z", "commit": {"oid": "897d2394e4ed5d807e6d113b7ec508721f916105"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMDo1MjowM1rOGCpyZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMDo1Njo0NFrOGCp72g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQzNDk4MQ==", "bodyText": "Looks good, thanks. Could you please add something similar for welcome screen as well? It doesn't share the implementation with React pages, so it's worth to have a separate test for that too.\nAlso, on welcome screen please test that the user is not displayed at all if not logged in. We have to make sure we don't have gaps in test coverage. :)", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r405434981", "createdAt": "2020-04-08T10:52:03Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/PersonalInfoTest.java", "diffHunk": "@@ -154,6 +155,11 @@ public void disabledEditUsername() {\n         personalInfoPage.valuesEqual(testUser2);\n     }\n \n+    @Test\n+    public void testNameInToolbar() {\n+        assertEquals(\"test user\", personalInfoPage.header().getToolbarLoggedInUser().getText());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzM3MQ=="}, "originalCommit": {"oid": "f90c756aa22fc78304d2ffac7b9143fd2bb39728"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQzNzQwMg==", "bodyText": "Please return String from this element using getTextFromElement as it includes some hacks (and more might be added in the future).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public WebElement getToolbarLoggedInUser() {\n          \n          \n            \n                    return toolbarLoggedInUser;\n          \n          \n            \n                public String getToolbarLoggedInUser() {\n          \n          \n            \n                    return getTextFromElement(toolbarLoggedInUser);", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r405437402", "createdAt": "2020-04-08T10:56:44Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java", "diffHunk": "@@ -73,4 +76,8 @@ protected WebElement getLogoutBtn() {\n     protected WebElement getReferrerLink() {\n         return isMobileLayout() ? referrerLinkMobile : referrerLink;\n     }\n+\n+    public WebElement getToolbarLoggedInUser() {\n+        return toolbarLoggedInUser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "897d2394e4ed5d807e6d113b7ec508721f916105"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ec6731a5b0528093cbfb27750f3bae7274e259d", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/1ec6731a5b0528093cbfb27750f3bae7274e259d", "committedDate": "2020-04-08T12:28:29Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}, "afterCommit": {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/60702df6066330c5f0dce3a5d7bc751580ce0ece", "committedDate": "2020-04-08T12:59:26Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzM2MDE1", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-392336015", "createdAt": "2020-04-13T18:25:22Z", "commit": {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODoyNToyMlrOGEwGFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODoyOToyNFrOGEwOyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNTQ3Nw==", "bodyText": "@edewit This needs to be localized.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407635477", "createdAt": "2020-04-13T18:25:22Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/keycloak-service/keycloak.service.ts", "diffHunk": "@@ -84,6 +84,21 @@ export class KeycloakService {\n         return KeycloakService.keycloakAuth.realm;\n     }\n \n+    public get userName(): string {\n+        let userName = 'Anonymous';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYzNzcwNQ==", "bodyText": "This needs to be localized as well.  Many cultures don't do givenName + ' ' + familyName.  So these should be passed in as params to a message bundle instead.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r407637705", "createdAt": "2020-04-13T18:29:24Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/resources/app/keycloak-service/keycloak.service.ts", "diffHunk": "@@ -84,6 +84,21 @@ export class KeycloakService {\n         return KeycloakService.keycloakAuth.realm;\n     }\n \n+    public get userName(): string {\n+        let userName = 'Anonymous';\n+        if (KeycloakService.keycloakAuth.tokenParsed) {\n+            const givenName = (KeycloakService.keycloakAuth.tokenParsed as {given_name: string}).given_name;\n+            const familyName = (KeycloakService.keycloakAuth.tokenParsed as {family_name: string}).family_name;\n+            const preferredUsername = (KeycloakService.keycloakAuth.tokenParsed as {preferred_username: string}).preferred_username;\n+            if (givenName && familyName) {\n+                userName = givenName + ' ' + familyName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60702df6066330c5f0dce3a5d7bc751580ce0ece", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/60702df6066330c5f0dce3a5d7bc751580ce0ece", "committedDate": "2020-04-08T12:59:26Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}, "afterCommit": {"oid": "2f32c06ca10b75781d68700532bb14c8e2288fa7", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/2f32c06ca10b75781d68700532bb14c8e2288fa7", "committedDate": "2020-04-14T07:49:51Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f32c06ca10b75781d68700532bb14c8e2288fa7", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/2f32c06ca10b75781d68700532bb14c8e2288fa7", "committedDate": "2020-04-14T07:49:51Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}, "afterCommit": {"oid": "39b49b903cce6ce9e4f3863811a6b072a5704710", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/39b49b903cce6ce9e4f3863811a6b072a5704710", "committedDate": "2020-04-14T08:56:17Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39b49b903cce6ce9e4f3863811a6b072a5704710", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/39b49b903cce6ce9e4f3863811a6b072a5704710", "committedDate": "2020-04-14T08:56:17Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}, "afterCommit": {"oid": "85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "committedDate": "2020-04-14T08:59:42Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/85d32ccf3240f0df8f98d340c3dd966cfdb1c090", "committedDate": "2020-04-14T08:59:42Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}, "afterCommit": {"oid": "a2ba89c0a905152f06b0ab414259cf6a2558dc80", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/a2ba89c0a905152f06b0ab414259cf6a2558dc80", "committedDate": "2020-04-14T11:08:51Z", "message": "Update testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjU3Nzcw", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-393657770", "createdAt": "2020-04-15T10:42:33Z", "commit": {"oid": "0e3d01ec0a5dadb62154dc9d0cedd7a5b438328c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjYxMDcw", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-393661070", "createdAt": "2020-04-15T10:47:59Z", "commit": {"oid": "0e3d01ec0a5dadb62154dc9d0cedd7a5b438328c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0Nzo1OVrOGF0KWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0Nzo1OVrOGF0KWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1MDY4Mg==", "bodyText": "I've noticed we use the same ID both at Welcome Screen and at React pages. The Welcome Screen is technically always present in the DOM, just hidden when a React page is loaded. I'm no HTML expert, so correct me if I'm wrong, but I think it's not valid to have duplicit IDs in HTML and it could theoretically cause some problems. One thing I can think of is testing \u2013\u00a0it could be a bit nondeterministic as we don't know which of the elements with this ID was selected.\nAt the Welcome Screen we usually use landing prefix for IDs to prevent this kind of issues.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r408750682", "createdAt": "2020-04-15T10:47:59Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -160,6 +178,10 @@\n               <button id=\"landingSignOutButton\" tabindex=\"0\" style=\"display:none\" onclick=\"keycloak.logout();\" class=\"pf-c-button pf-m-primary\" type=\"button\">${msg(\"doSignOut\")}</button>\n             </div>\n \n+            <div class=\"pf-l-toolbar__group\" style=\"margin-left: 10px;\">\n+                <span id=\"loggedInUser\"></span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e3d01ec0a5dadb62154dc9d0cedd7a5b438328c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjU4NTYz", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-398258563", "createdAt": "2020-04-22T14:37:10Z", "commit": {"oid": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDozNzoxMVrOGJ579Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDozNzoxMVrOGJ579Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzOTYwNQ==", "bodyText": "This change is not necessary.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r413039605", "createdAt": "2020-04-22T14:37:11Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/PersonalInfoPage.java", "diffHunk": "@@ -26,6 +26,8 @@\n import static org.keycloak.testsuite.util.UIUtils.getTextInputValue;\n import static org.keycloak.testsuite.util.UIUtils.setTextInputValue;\n \n+import static org.junit.Assert.assertEquals;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDQzNjU3", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-399443657", "createdAt": "2020-04-23T20:17:04Z", "commit": {"oid": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMDoxNzowNFrOGK6WGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMDoxNzowNFrOGK6WGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5NDg3NQ==", "bodyText": "@edewit Can you move this function to WelcomePageScripts.js?  index.ftl is too big and hard to manage already.", "url": "https://github.com/keycloak/keycloak/pull/6897#discussion_r414094875", "createdAt": "2020-04-23T20:17:04Z", "author": {"login": "ssilvert"}, "path": "themes/src/main/resources/theme/keycloak-preview/account/index.ftl", "diffHunk": "@@ -121,6 +122,23 @@\n             }).error(function() {\n                 alert('failed to initialize keycloak');\n             });\n+\n+            function loggedInUserName() {\n+                let userName = '${msg(\"unknownUser\")}';\n+                if (keycloak.tokenParsed) {\n+                    const givenName = keycloak.tokenParsed.given_name;\n+                    const familyName = keycloak.tokenParsed.family_name;\n+                    const preferredUsername = keycloak.tokenParsed.preferred_username;\n+                    if (givenName && familyName) {\n+                        userName = [givenName, familyName].reduce((acc, value, index) =>\n+                            acc.replace('{'+ index + '}', value), '${msg(\"fullName\")}'\n+                        );\n+                    } else {\n+                        userName = (givenName || familyName) || preferredUsername || userName;\n+                    }\n+                }\n+                return userName;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92ae05ae890b058a5bae667bc5a1ae9d0e0d4e1"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4d874f4ec7d01db3c6363dcb1f8d7ec18e98b1f", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/f4d874f4ec7d01db3c6363dcb1f8d7ec18e98b1f", "committedDate": "2020-04-27T07:00:25Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}, "afterCommit": {"oid": "09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "committedDate": "2020-04-27T13:18:11Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTUwMTM1", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-400950135", "createdAt": "2020-04-27T13:27:36Z", "commit": {"oid": "09d2977c4818a41ffad15d4fa2a7686cf4b0528c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/09d2977c4818a41ffad15d4fa2a7686cf4b0528c", "committedDate": "2020-04-27T13:18:11Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}, "afterCommit": {"oid": "817f21f0682b9d1fc5ffff86999ba02a86b48369", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/817f21f0682b9d1fc5ffff86999ba02a86b48369", "committedDate": "2020-04-28T06:40:19Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "817f21f0682b9d1fc5ffff86999ba02a86b48369", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/817f21f0682b9d1fc5ffff86999ba02a86b48369", "committedDate": "2020-04-28T06:40:19Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}, "afterCommit": {"oid": "91e4e9668419e10f12184a205db3279dd136051f", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/91e4e9668419e10f12184a205db3279dd136051f", "committedDate": "2020-05-04T06:32:32Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "committedDate": "2020-05-04T11:39:49Z", "message": "KEYCLOAK-12916 add name or username in toolbar\n\nUpdate testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>\n\nMoved concatenation to messages_en.properties\n\nfix: renamed loggedInUser to landingLoggedInUser\n\nfor the welcome page\n\nmoved `loggedInUserName` to WelcomePageScrips"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91e4e9668419e10f12184a205db3279dd136051f", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/91e4e9668419e10f12184a205db3279dd136051f", "committedDate": "2020-05-04T06:32:32Z", "message": "moved `loggedInUserName` to WelcomePageScrips"}, "afterCommit": {"oid": "c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "author": {"user": {"login": "edewit", "name": "Erik Jan de Wit"}}, "url": "https://github.com/keycloak/keycloak/commit/c86c27c88fbe45b93cf199b8c19354a4f3d89f25", "committedDate": "2020-05-04T11:39:49Z", "message": "KEYCLOAK-12916 add name or username in toolbar\n\nUpdate testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/fragment/LoggedInPageHeader.java\n\nCo-Authored-By: V\u00e1clav Muzik\u00e1\u0159 <vaclav@muzikari.cz>\n\nMoved concatenation to messages_en.properties\n\nfix: renamed loggedInUser to landingLoggedInUser\n\nfor the welcome page\n\nmoved `loggedInUserName` to WelcomePageScrips"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MjYxMDQz", "url": "https://github.com/keycloak/keycloak/pull/6897#pullrequestreview-405261043", "createdAt": "2020-05-04T18:58:19Z", "commit": {"oid": "c86c27c88fbe45b93cf199b8c19354a4f3d89f25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2584, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}