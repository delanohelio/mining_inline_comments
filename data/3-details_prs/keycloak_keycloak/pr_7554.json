{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyODczODAw", "number": 7554, "title": "KEYCLOAK-15841 Upgrade rest of the minor forms to PF4", "bodyText": "JIRA: KEYCLOAK-15841", "createdAt": "2020-10-30T09:38:57Z", "url": "https://github.com/keycloak/keycloak/pull/7554", "merged": true, "mergeCommit": {"oid": "7522d5ac74963fe6632f048a0616e39d87165ed9"}, "closed": true, "closedAt": "2020-11-05T16:58:42Z", "author": {"login": "mabartos"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZL8MrgFqTUyMzIwNzM2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZlYYyAFqTUyNDQ2OTc0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMjA3MzY5", "url": "https://github.com/keycloak/keycloak/pull/7554#pullrequestreview-523207369", "createdAt": "2020-11-04T10:01:09Z", "commit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMDowMToxMFrOHtRAlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMToxNTozMlrOHtTsZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIyNjY0NA==", "bodyText": "Why to make this change in this PR? Shouldn't it belong to #7516 which addresses migration of this file?", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517226644", "createdAt": "2020-11-04T10:01:10Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/base/login/login-otp.ftl", "diffHunk": "@@ -1,5 +1,5 @@\n <#import \"template.ftl\" as layout>\n-    <@layout.registrationLayout; section>\n+    <@layout.registrationLayout displayMessage=!messagesPerField.existsError('totp'); section>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI0MzUwMw==", "bodyText": "This PO represents a page in the old Account Console, not the login page. It shouldn't be modified.", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517243503", "createdAt": "2020-11-04T10:28:29Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/AccountUpdateProfilePage.java", "diffHunk": "@@ -180,8 +184,16 @@ public String getSuccess(){\n         return successMessage.getText();\n     }\n \n-    public String getError() {\n-        return errorMessage.getText();\n+    public String getAlertError() {\n+        try {\n+            return errorMessage.getText();\n+        } catch (NoSuchElementException e) {\n+            return null;\n+        }\n+    }\n+\n+    public UpdateProfileErrors getInputErrors() {\n+        return errorsPage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI0NzA5OQ==", "bodyText": "Why to make this change in this PR? Shouldn't it belong to #7516 which addresses migration of this file?", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517247099", "createdAt": "2020-11-04T10:34:17Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/LoginTotpPage.java", "diffHunk": "@@ -45,15 +45,30 @@\n     @FindBy(className = \"alert-error\")\n     private WebElement loginErrorMessage;\n \n+    @FindBy(id = \"input-error-otp-code\")\n+    private WebElement totpInputCodeError;\n+\n     public void login(String totp) {\n         otpInput.clear();\n         if (totp != null) otpInput.sendKeys(totp);\n \n         submitButton.click();\n     }\n \n-    public String getError() {\n-        return loginErrorMessage != null ? loginErrorMessage.getText() : null;\n+    public String getAlertError() {\n+        try {\n+            return UIUtils.getTextFromElement(loginErrorMessage);\n+        } catch (NoSuchElementException e) {\n+            return null;\n+        }\n+    }\n+\n+    public String getInputError(){\n+        try {\n+            return UIUtils.getTextFromElement(totpInputCodeError);\n+        } catch (NoSuchElementException e) {\n+            return null;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI0OTI0Ng==", "bodyText": "Why to have this as a separate PO (or in fact a page fragment)? I believe it won't be used anywhere but in LoginUpdateProfilePage, correct?", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517249246", "createdAt": "2020-11-04T10:37:46Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/main/java/org/keycloak/testsuite/pages/UpdateProfileErrors.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.testsuite.pages;\n+\n+import org.openqa.selenium.NoSuchElementException;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+\n+import static org.keycloak.testsuite.util.UIUtils.getTextFromElement;\n+\n+/**\n+ * @author <a href=\"mailto:mabartos@redhat.com\">Martin Bartos</a>\n+ */\n+public class UpdateProfileErrors {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI1MDEwMQ==", "bodyText": "This is an old Account Console test. It shouldn't be modified at all.", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517250101", "createdAt": "2020-11-04T10:39:16Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/account/AccountFormServiceTest.java", "diffHunk": "@@ -265,11 +265,11 @@ public void changePassword() {\n         String userId = event.getUserId();\n \n         changePasswordPage.changePassword(\"\", \"new-password\", \"new-password\");\n-        Assert.assertEquals(\"Please specify password.\", profilePage.getError());\n+        Assert.assertEquals(\"Please specify password.\", profilePage.getAlertError());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI1NDg1NQ==", "bodyText": "Did you try to run the SSSD tests? I believe they are excluded by default.", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517254855", "createdAt": "2020-11-04T10:47:18Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/other/sssd/src/test/java/org/keycloak/testsuite/sssd/SSSDTest.java", "diffHunk": "@@ -188,7 +185,7 @@ public void changeReadOnlyProfile() throws Exception {\n \n         profilePage.updateProfile(\"New first\", \"New last\", \"new@email.com\");\n \n-        Assert.assertEquals(\"You can't update your account as it is read-only.\", profilePage.getError());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI3MDYzMQ==", "bodyText": "This is a general comment, not related only to this particular line. In the IE the exclamation mark is missing when a field is invalid. This probably affects all the related PRs and @Pepo48 already mentioned it in some other PR, so it doesn't need to be fixed in this particular PR.", "url": "https://github.com/keycloak/keycloak/pull/7554#discussion_r517270631", "createdAt": "2020-11-04T11:15:32Z", "author": {"login": "vmuzikar"}, "path": "themes/src/main/resources/theme/base/login/login-update-profile.ftl", "diffHunk": "@@ -1,43 +1,79 @@\n <#import \"template.ftl\" as layout>\n-<@layout.registrationLayout; section>\n+<@layout.registrationLayout displayMessage=!messagesPerField.existsError('username','email','firstName','lastName'); section>\n     <#if section = \"header\">\n         ${msg(\"loginProfileTitle\")}\n     <#elseif section = \"form\">\n         <form id=\"kc-update-profile-form\" class=\"${properties.kcFormClass!}\" action=\"${url.loginAction}\" method=\"post\">\n             <#if user.editUsernameAllowed>\n-                <div class=\"${properties.kcFormGroupClass!} ${messagesPerField.printIfExists('username',properties.kcFormGroupErrorClass!)}\">\n+                <div class=\"${properties.kcFormGroupClass!}\">\n                     <div class=\"${properties.kcLabelWrapperClass!}\">\n                         <label for=\"username\" class=\"${properties.kcLabelClass!}\">${msg(\"username\")}</label>\n                     </div>\n                     <div class=\"${properties.kcInputWrapperClass!}\">\n-                        <input type=\"text\" id=\"username\" name=\"username\" value=\"${(user.username!'')}\" class=\"${properties.kcInputClass!}\"/>\n+                        <input type=\"text\" id=\"username\" name=\"username\" value=\"${(user.username!'')}\"\n+                               class=\"${properties.kcInputClass!}\"\n+                               aria-invalid=\"<#if messagesPerField.existsError('username')>true</#if>\"\n+                        />\n+\n+                        <#if messagesPerField.existsError('username')>\n+                            <span id=\"input-error-username\" class=\"${properties.kcInputErrorMessageClass!}\" aria-live=\"polite\">\n+                                ${kcSanitize(messagesPerField.get('username'))?no_esc}\n+                            </span>\n+                        </#if>\n                     </div>\n                 </div>\n             </#if>\n-            <div class=\"${properties.kcFormGroupClass!} ${messagesPerField.printIfExists('email',properties.kcFormGroupErrorClass!)}\">\n+            <div class=\"${properties.kcFormGroupClass!}\">\n                 <div class=\"${properties.kcLabelWrapperClass!}\">\n                     <label for=\"email\" class=\"${properties.kcLabelClass!}\">${msg(\"email\")}</label>\n                 </div>\n                 <div class=\"${properties.kcInputWrapperClass!}\">\n-                    <input type=\"text\" id=\"email\" name=\"email\" value=\"${(user.email!'')}\" class=\"${properties.kcInputClass!}\" />\n+                    <input type=\"text\" id=\"email\" name=\"email\" value=\"${(user.email!'')}\"\n+                           class=\"${properties.kcInputClass!}\"\n+                           aria-invalid=\"<#if messagesPerField.existsError('email')>true</#if>\"\n+                    />\n+\n+                    <#if messagesPerField.existsError('email')>\n+                        <span id=\"input-error-email\" class=\"${properties.kcInputErrorMessageClass!}\" aria-live=\"polite\">\n+                            ${kcSanitize(messagesPerField.get('email'))?no_esc}\n+                        </span>\n+                    </#if>\n                 </div>\n             </div>\n \n-            <div class=\"${properties.kcFormGroupClass!} ${messagesPerField.printIfExists('firstName',properties.kcFormGroupErrorClass!)}\">\n+            <div class=\"${properties.kcFormGroupClass!}\">\n                 <div class=\"${properties.kcLabelWrapperClass!}\">\n                     <label for=\"firstName\" class=\"${properties.kcLabelClass!}\">${msg(\"firstName\")}</label>\n                 </div>\n                 <div class=\"${properties.kcInputWrapperClass!}\">\n-                    <input type=\"text\" id=\"firstName\" name=\"firstName\" value=\"${(user.firstName!'')}\" class=\"${properties.kcInputClass!}\" />\n+                    <input type=\"text\" id=\"firstName\" name=\"firstName\" value=\"${(user.firstName!'')}\"\n+                           class=\"${properties.kcInputClass!}\"\n+                           aria-invalid=\"<#if messagesPerField.existsError('firstName')>true</#if>\"\n+                    />\n+\n+                    <#if messagesPerField.existsError('firstName')>\n+                        <span id=\"input-error-firstname\" class=\"${properties.kcInputErrorMessageClass!}\" aria-live=\"polite\">\n+                            ${kcSanitize(messagesPerField.get('firstName'))?no_esc}\n+                        </span>\n+                    </#if>\n                 </div>\n             </div>\n \n-            <div class=\"${properties.kcFormGroupClass!} ${messagesPerField.printIfExists('lastName',properties.kcFormGroupErrorClass!)}\">\n+            <div class=\"${properties.kcFormGroupClass!}\">\n                 <div class=\"${properties.kcLabelWrapperClass!}\">\n                     <label for=\"lastName\" class=\"${properties.kcLabelClass!}\">${msg(\"lastName\")}</label>\n                 </div>\n                 <div class=\"${properties.kcInputWrapperClass!}\">\n-                    <input type=\"text\" id=\"lastName\" name=\"lastName\" value=\"${(user.lastName!'')}\" class=\"${properties.kcInputClass!}\" />\n+                    <input type=\"text\" id=\"lastName\" name=\"lastName\" value=\"${(user.lastName!'')}\"\n+                           class=\"${properties.kcInputClass!}\"\n+                           aria-invalid=\"<#if messagesPerField.existsError('lastName')>true</#if>\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886"}, "originalPosition": 78}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ad14856e4c8b43cbb0122d40dd6993fb94bd886", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/9ad14856e4c8b43cbb0122d40dd6993fb94bd886", "committedDate": "2020-10-30T09:33:15Z", "message": "KEYCLOAK-15841 Upgrade rest of the minor forms to PF4"}, "afterCommit": {"oid": "2e2f584b2695e4bc1791b8eb55e5d566374549c8", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/2e2f584b2695e4bc1791b8eb55e5d566374549c8", "committedDate": "2020-11-04T15:59:40Z", "message": "Remove separate error class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDc1NTMx", "url": "https://github.com/keycloak/keycloak/pull/7554#pullrequestreview-524075531", "createdAt": "2020-11-05T09:32:29Z", "commit": {"oid": "2e2f584b2695e4bc1791b8eb55e5d566374549c8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e32fb16b1c9a401f685ac5a11f2336cec5e227c5", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/e32fb16b1c9a401f685ac5a11f2336cec5e227c5", "committedDate": "2020-11-05T10:23:25Z", "message": "KEYCLOAK-15841 Upgrade rest of the minor forms to PF4"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e2f584b2695e4bc1791b8eb55e5d566374549c8", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/2e2f584b2695e4bc1791b8eb55e5d566374549c8", "committedDate": "2020-11-04T15:59:40Z", "message": "Remove separate error class"}, "afterCommit": {"oid": "e32fb16b1c9a401f685ac5a11f2336cec5e227c5", "author": {"user": {"login": "mabartos", "name": "Martin Barto\u0161"}}, "url": "https://github.com/keycloak/keycloak/commit/e32fb16b1c9a401f685ac5a11f2336cec5e227c5", "committedDate": "2020-11-05T10:23:25Z", "message": "KEYCLOAK-15841 Upgrade rest of the minor forms to PF4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0Mjg0Mzg1", "url": "https://github.com/keycloak/keycloak/pull/7554#pullrequestreview-524284385", "createdAt": "2020-11-05T13:57:32Z", "commit": {"oid": "e32fb16b1c9a401f685ac5a11f2336cec5e227c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NDY5NzQz", "url": "https://github.com/keycloak/keycloak/pull/7554#pullrequestreview-524469743", "createdAt": "2020-11-05T16:58:28Z", "commit": {"oid": "e32fb16b1c9a401f685ac5a11f2336cec5e227c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3403, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}