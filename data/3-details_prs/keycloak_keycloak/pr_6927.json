{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMTgzNDE4", "number": 6927, "title": "KEYCLOAK-8100 Expose sub claim in OIDC IdentityBroker Mappers", "bodyText": "We now expose the claim \"sub\" along side other claims for use in Identity Broker mappers.\nPreviously claims directly mapped to JsonWebToken fields (like sub) were not accessible for mappings.", "createdAt": "2020-03-24T18:24:34Z", "url": "https://github.com/keycloak/keycloak/pull/6927", "merged": true, "mergeCommit": {"oid": "92ab9c08ae8594f531efb7ee4d6ca54ea7ed3ac9"}, "closed": true, "closedAt": "2020-06-17T15:56:09Z", "author": {"login": "thomasdarimont"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr6rg_gFqTQzMTgzNDU1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsL-kjgFqTQzMjU0NTYzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODM0NTU1", "url": "https://github.com/keycloak/keycloak/pull/6927#pullrequestreview-431834555", "createdAt": "2020-06-16T19:40:54Z", "commit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0MDo1NFrOGkqeFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0MTo0NFrOGkqfvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5Nzc1MA==", "bodyText": "Could you please leave the format as is? The reason is that it makes a review more extensive if we start accepting code formatting changes. Yeah, we don't have a code style, but we're working on it :)", "url": "https://github.com/keycloak/keycloak/pull/6927#discussion_r441097750", "createdAt": "2020-06-16T19:40:54Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/broker/oidc/mappers/AbstractClaimMapper.java", "diffHunk": "@@ -50,7 +58,7 @@ public static Object getClaimValue(JsonWebToken token, String claim) {\n             } else {\n                 Object val = jsonObject.get(component);\n                 if (!(val instanceof Map)) return null;\n-                jsonObject = (Map<String, Object>)val;\n+                jsonObject = (Map<String, Object>) val;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5Nzk5NQ==", "bodyText": "Same here, please remove changes formatting the code.", "url": "https://github.com/keycloak/keycloak/pull/6927#discussion_r441097995", "createdAt": "2020-06-16T19:41:26Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/broker/oidc/mappers/AbstractClaimMapper.java", "diffHunk": "@@ -63,15 +71,15 @@ public static Object getClaimValue(IdentityProviderMapperModel mapperModel, Brok\n \n     public static Object getClaimValue(BrokeredIdentityContext context, String claim) {\n         {  // search access token\n-            JsonWebToken token = (JsonWebToken)context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ACCESS_TOKEN);\n+            JsonWebToken token = (JsonWebToken) context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ACCESS_TOKEN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5ODA4OQ==", "bodyText": "Same here, please remove changes formatting the code.", "url": "https://github.com/keycloak/keycloak/pull/6927#discussion_r441098089", "createdAt": "2020-06-16T19:41:37Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/broker/oidc/mappers/AbstractClaimMapper.java", "diffHunk": "@@ -63,15 +71,15 @@ public static Object getClaimValue(IdentityProviderMapperModel mapperModel, Brok\n \n     public static Object getClaimValue(BrokeredIdentityContext context, String claim) {\n         {  // search access token\n-            JsonWebToken token = (JsonWebToken)context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ACCESS_TOKEN);\n+            JsonWebToken token = (JsonWebToken) context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ACCESS_TOKEN);\n             if (token != null) {\n                 Object value = getClaimValue(token, claim);\n                 if (value != null) return value;\n             }\n \n         }\n         {  // search ID Token\n-            JsonWebToken token = (JsonWebToken)context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ID_TOKEN);\n+            JsonWebToken token = (JsonWebToken) context.getContextData().get(KeycloakOIDCIdentityProvider.VALIDATED_ID_TOKEN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5ODE3Mg==", "bodyText": "Same here, please remove changes formatting the code.", "url": "https://github.com/keycloak/keycloak/pull/6927#discussion_r441098172", "createdAt": "2020-06-16T19:41:44Z", "author": {"login": "pedroigor"}, "path": "services/src/main/java/org/keycloak/broker/oidc/mappers/AbstractClaimMapper.java", "diffHunk": "@@ -116,7 +124,7 @@ public boolean valueEquals(String desiredValue, Object value) {\n \n             }\n         } else if (value instanceof List) {\n-            List list = (List)value;\n+            List list = (List) value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3b026d85bac605ce031d232c9f373b6f1697a88", "author": {"user": {"login": "thomasdarimont", "name": "Thomas Darimont"}}, "url": "https://github.com/keycloak/keycloak/commit/d3b026d85bac605ce031d232c9f373b6f1697a88", "committedDate": "2020-03-24T18:23:18Z", "message": "KEYCLOAK-8100 Improve handling of available claims in IdentityBroker Mappers\n\nWe now expose the claims \"jti\", \"exp\", \"nbf\", \"iat\", \"iss\", \"aud\",\n\"sub\", \"typ\", \"azp\" along side other claims for use in Identity Broker mappers.\nPreviously claims directly mapped to `JsonWebToken` fields were not\naccessible for mappings."}, "afterCommit": {"oid": "f70828c92ce8ae9445f72c436444ac76229719c5", "author": {"user": {"login": "thomasdarimont", "name": "Thomas Darimont"}}, "url": "https://github.com/keycloak/keycloak/commit/f70828c92ce8ae9445f72c436444ac76229719c5", "committedDate": "2020-06-17T08:47:17Z", "message": "KEYCLOAK-8100 Improve handling of available claims in IdentityBroker Mappers\n\nWe now expose the claims \"jti\", \"exp\", \"nbf\", \"iat\", \"iss\", \"aud\",\n\"sub\", \"typ\", \"azp\" along side other claims for use in Identity Broker mappers.\nPreviously claims directly mapped to `JsonWebToken` fields were not\naccessible for mappings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6496d495b439e07163b3929829e3e082523a2c9", "author": {"user": {"login": "thomasdarimont", "name": "Thomas Darimont"}}, "url": "https://github.com/keycloak/keycloak/commit/f6496d495b439e07163b3929829e3e082523a2c9", "committedDate": "2020-06-17T08:49:28Z", "message": "KEYCLOAK-8100 Expose sub claim in OIDC IdentityBroker Mappers\n\nWe now expose the claims \"sub\" for use in Identity Broker mappers.\nPreviously claims directly mapped to `JsonWebToken` fields were not\naccessible for mappings."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f70828c92ce8ae9445f72c436444ac76229719c5", "author": {"user": {"login": "thomasdarimont", "name": "Thomas Darimont"}}, "url": "https://github.com/keycloak/keycloak/commit/f70828c92ce8ae9445f72c436444ac76229719c5", "committedDate": "2020-06-17T08:47:17Z", "message": "KEYCLOAK-8100 Improve handling of available claims in IdentityBroker Mappers\n\nWe now expose the claims \"jti\", \"exp\", \"nbf\", \"iat\", \"iss\", \"aud\",\n\"sub\", \"typ\", \"azp\" along side other claims for use in Identity Broker mappers.\nPreviously claims directly mapped to `JsonWebToken` fields were not\naccessible for mappings."}, "afterCommit": {"oid": "f6496d495b439e07163b3929829e3e082523a2c9", "author": {"user": {"login": "thomasdarimont", "name": "Thomas Darimont"}}, "url": "https://github.com/keycloak/keycloak/commit/f6496d495b439e07163b3929829e3e082523a2c9", "committedDate": "2020-06-17T08:49:28Z", "message": "KEYCLOAK-8100 Expose sub claim in OIDC IdentityBroker Mappers\n\nWe now expose the claims \"sub\" for use in Identity Broker mappers.\nPreviously claims directly mapped to `JsonWebToken` fields were not\naccessible for mappings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTQ1NjMy", "url": "https://github.com/keycloak/keycloak/pull/6927#pullrequestreview-432545632", "createdAt": "2020-06-17T15:56:03Z", "commit": {"oid": "f6496d495b439e07163b3929829e3e082523a2c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3209, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}