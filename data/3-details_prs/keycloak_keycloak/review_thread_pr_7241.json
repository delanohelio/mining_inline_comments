{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MDM0MDc2", "number": 7241, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDo0MTozMVrOEMpbzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToxNDo0OFrOEPFY2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjk3MjMwOnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/ServletTestUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDo0MTozMVrOGu4e3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDo0MTozMVrOGu4e3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgxMzA4Ng==", "bodyText": "This TODO becomes irrelevant after these changes, right?", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r451813086", "createdAt": "2020-07-08T20:41:31Z", "author": {"login": "vramik"}, "path": "testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/ServletTestUtils.java", "diffHunk": "@@ -17,40 +17,33 @@\n \n package org.keycloak.testsuite.adapter.servlet;\n \n-import javax.servlet.http.HttpServletRequest;\n-\n-import org.keycloak.common.util.UriUtils;\n+import static java.lang.Integer.parseInt;\n \n /**\n  * @author <a href=\"mailto:mposolda@redhat.com\">Marek Posolda</a>\n  */\n public class ServletTestUtils {\n \n+    public static final boolean AUTH_SERVER_SSL_REQUIRED = Boolean.parseBoolean(System.getProperty(\"auth.server.ssl.required\", \"true\"));\n+    public static final String AUTH_SERVER_PORT = AUTH_SERVER_SSL_REQUIRED ? System.getProperty(\"auth.server.https.port\", \"8543\") : System.getProperty(\"auth.server.http.port\", \"8180\");\n+    public static final String AUTH_SERVER_SCHEME = AUTH_SERVER_SSL_REQUIRED ? \"https\" : \"http\";\n+    public static final String AUTH_SERVER_HOST = System.getProperty(\"auth.server.host\", \"localhost\");\n+\n+    public static final boolean APP_SERVER_SSL_REQUIRED = Boolean.parseBoolean(System.getProperty(\"app.server.ssl.required\", \"false\"));\n+    public static final String APP_SERVER_PORT = APP_SERVER_SSL_REQUIRED ? System.getProperty(\"app.server.https.port\", \"8643\") : System.getProperty(\"app.server.http.port\", \"8280\");\n+    public static final String APP_SERVER_SCHEME = APP_SERVER_SSL_REQUIRED ? \"https\" : \"http\";\n+    public static final String APP_SERVER_HOST = System.getProperty(\"app.server.host\", \"localhost\");\n+\n     // TODO: Couldn't just always read urlBase from req.getRequestURI() ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb874d8c0adc8ca5a05f4f602a3359707eb193b1"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDI0Mzg2OnYy", "diffSide": "LEFT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/example/cors/CorsExampleAdapterTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjowMjo0MlrOGvX0Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToyMToxOVrOGymimg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMyNjQ3MA==", "bodyText": "Just to double check. Is this change intentional? Seems a bit suspicious to me. :)", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r452326470", "createdAt": "2020-07-09T16:02:42Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/example/cors/CorsExampleAdapterTest.java", "diffHunk": "@@ -190,7 +184,6 @@ private String getAuthServerVersion() {\n                 \"/auth/admin/master/console/#/server-info\");\n         jsDriverTestRealmLoginPage.form().login(\"admin\", \"admin\");\n \n-        WaitUtils.waitUntilElement(By.tagName(\"body\")).is().visible();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MDE2NQ==", "bodyText": "I removed it because the login method is using clickLink() function to log in, so any wait after this should not be necessary. But I can revert it if you want.", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r454970165", "createdAt": "2020-07-15T11:04:33Z", "author": {"login": "mhajas"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/example/cors/CorsExampleAdapterTest.java", "diffHunk": "@@ -190,7 +184,6 @@ private String getAuthServerVersion() {\n                 \"/auth/admin/master/console/#/server-info\");\n         jsDriverTestRealmLoginPage.form().login(\"admin\", \"admin\");\n \n-        WaitUtils.waitUntilElement(By.tagName(\"body\")).is().visible();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMyNjQ3MA=="}, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcxMzQzNA==", "bodyText": "Thanks for the explanation. No need to revert. ;)", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r455713434", "createdAt": "2020-07-16T11:21:19Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/example/cors/CorsExampleAdapterTest.java", "diffHunk": "@@ -190,7 +184,6 @@ private String getAuthServerVersion() {\n                 \"/auth/admin/master/console/#/server-info\");\n         jsDriverTestRealmLoginPage.form().login(\"admin\", \"admin\");\n \n-        WaitUtils.waitUntilElement(By.tagName(\"body\")).is().visible();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMyNjQ3MA=="}, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDI4NTQxOnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLSameSiteTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoxMzo1NVrOGvYPAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxMzowNVrOGx5bZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzMxMg==", "bodyText": "I think we can remove this test completely now that we we run all SAML tests with different hostnames + SSL.", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r452333312", "createdAt": "2020-07-09T16:13:55Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLSameSiteTest.java", "diffHunk": "@@ -38,9 +39,10 @@\n @AppServerContainer(ContainerConstants.APP_SERVER_TOMCAT9)\n @AuthServerContainerExclude(AuthServerContainerExclude.AuthServer.REMOTE)\n public class SAMLSameSiteTest extends AbstractSAMLServletAdapterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NDMwOA==", "bodyText": "I was thinking about this, but I was not sure. This test is running with different host even in the case when no app.server.host is configured. But you are probably right in this case, it is not useful at all, as in pipeline this test will be running with htmlunit, not chrome, and the auth server is running on localhost. So I will remove it.", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r454974308", "createdAt": "2020-07-15T11:13:05Z", "author": {"login": "mhajas"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLSameSiteTest.java", "diffHunk": "@@ -38,9 +39,10 @@\n @AppServerContainer(ContainerConstants.APP_SERVER_TOMCAT9)\n @AuthServerContainerExclude(AuthServerContainerExclude.AuthServer.REMOTE)\n public class SAMLSameSiteTest extends AbstractSAMLServletAdapterTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMzMxMg=="}, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDMwMTI5OnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/AbstractAdapterClusteredTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoxNzozNlrOGvYYlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoxNzozNlrOGvYYlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTc2NA==", "bodyText": "Just a nitpick. :) Should we use ServletTestUtils.APP_SERVER_HOST instead?", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r452335764", "createdAt": "2020-07-09T16:17:36Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/AbstractAdapterClusteredTest.java", "diffHunk": "@@ -84,14 +86,15 @@ public static void checkPropertiesSet() {\n         Assume.assumeThat(PORT_OFFSET_NODE_1, not(is(-1)));\n         Assume.assumeThat(PORT_OFFSET_NODE_2, not(is(-1)));\n         Assume.assumeThat(PORT_OFFSET_NODE_REVPROXY, not(is(-1)));\n+        ContainerAssume.assumeNotAppServerSSL();\n     }\n \n     @Before\n     public void prepareReverseProxy() throws Exception {\n         loadBalancerToNodes = new LoadBalancingProxyClient().addHost(NODE_1_URI, NODE_1_NAME).setConnectionsPerThread(10);\n         int maxTime = 3600000; // 1 hour for proxy request timeout, so we can debug the backend keycloak servers\n         reverseProxyToNodes = Undertow.builder()\n-          .addHttpListener(HTTP_PORT_NODE_REVPROXY, \"localhost\")\n+          .addHttpListener(HTTP_PORT_NODE_REVPROXY, System.getProperty(\"app.server.host\", \"localhost\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd6fc8220c0b633c5ee48b1598372c53885f4cc"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MjUyMzc3OnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToxNDo0OFrOGymWeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToxNDo0OFrOGymWeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcxMDMyOA==", "bodyText": "@mhajas, can you please clear for me why this change is important?", "url": "https://github.com/keycloak/keycloak/pull/7241#discussion_r455710328", "createdAt": "2020-07-16T11:14:48Z", "author": {"login": "vramik"}, "path": "testsuite/integration-arquillian/tests/base/pom.xml", "diffHunk": "@@ -982,7 +982,7 @@\n                                     <configuration>\n                                         <keystore>${app.server.keystore}</keystore>\n                                         <storepass>${app.server.keystore.password}</storepass>\n-                                        <alias>localhost</alias>\n+                                        <alias>localhost3</alias>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0e04064d4fde3d98ad136c13a3be24e2d1ff8a5"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3464, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}