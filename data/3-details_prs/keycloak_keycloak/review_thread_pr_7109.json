{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMjc0MjIx", "number": 7109, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDo0ODowNVrOEAW6pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo1MDozMlrOECAlbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODEwOTE3OnYy", "diffSide": "RIGHT", "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDo0ODowNVrOGblgMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozOTo1MFrOGdTxdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTE4Ng==", "bodyText": "Please don't change return type to \"Response\" .\nIn case that it was \"void\" as in current master and some exception happen on server, then the client will receive the exception as well. Which is usually good thing that client is notified about some failure through the exception. However when you change the return type on the admin-client to \"Response\", then the client call won't receive the exception at all. Instead of receiving exception, client  needs to explicitly check the status of the response etc. This means that client needs to explicitly close the \"Response\" (which is often forgotten) and I think this can be also the reason of broken tests.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431579186", "createdAt": "2020-05-28T04:48:05Z", "author": {"login": "mposolda"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -106,7 +111,7 @@\n     @Path(\"/flows/{flowAlias}/executions\")\n     @PUT\n     @Consumes(MediaType.APPLICATION_JSON)\n-    void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, AuthenticationExecutionInfoRepresentation rep);\n+    Response updateExecutions(@PathParam(\"flowAlias\") String flowAlias, AuthenticationExecutionInfoRepresentation rep);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NTg0Ng==", "bodyText": "Edited", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433385846", "createdAt": "2020-06-01T17:39:50Z", "author": {"login": "drichtarik"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -106,7 +111,7 @@\n     @Path(\"/flows/{flowAlias}/executions\")\n     @PUT\n     @Consumes(MediaType.APPLICATION_JSON)\n-    void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, AuthenticationExecutionInfoRepresentation rep);\n+    Response updateExecutions(@PathParam(\"flowAlias\") String flowAlias, AuthenticationExecutionInfoRepresentation rep);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTE4Ng=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODExMjY3OnYy", "diffSide": "RIGHT", "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDo1MDoyNlrOGbliUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozOTo1NVrOGdTxpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTczMA==", "bodyText": "I suggest to use \"void\" as return type. See the other comment below. In general, using \"Response\" as return type in the admin-client method signature is quite error-prone and it will be ideal to avoid if possible.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431579730", "createdAt": "2020-05-28T04:50:26Z", "author": {"login": "mposolda"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -88,6 +88,11 @@\n     @Consumes(MediaType.APPLICATION_JSON)\n     Response copy(@PathParam(\"flowAlias\") String flowAlias, Map<String, String> data);\n \n+    @Path(\"/flows/{id}\")\n+    @PUT\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    Response updateFlow(@PathParam(\"id\") String id, AuthenticationFlowRepresentation flow);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE1NjY3Ng==", "bodyText": "I can edit the return type of updateExecutions method which I changed to Response: drichtarik@ebc057e#diff-024264f56f48bd47bd9f783559f2bf85R602, but updateFlows method has already had a return type Response, that's why I created this resource as a Response too. I can edit this to void type but then I'd have to redo this: drichtarik@ebc057e#diff-024264f56f48bd47bd9f783559f2bf85R258 too along with several tests. Do you want me to keep this one or redo the original code too?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433156676", "createdAt": "2020-06-01T10:26:30Z", "author": {"login": "drichtarik"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -88,6 +88,11 @@\n     @Consumes(MediaType.APPLICATION_JSON)\n     Response copy(@PathParam(\"flowAlias\") String flowAlias, Map<String, String> data);\n \n+    @Path(\"/flows/{id}\")\n+    @PUT\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    Response updateFlow(@PathParam(\"id\") String id, AuthenticationFlowRepresentation flow);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTczMA=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4NzAwNQ==", "bodyText": "@drichtarik The methods on the server (in class org.keycloak.services.resources.admin.AuthenticationManagementResource) and on the admin client (in class org.keycloak.admin.client.resource.AuthenticationManagementResource) don't need to have same signatures. Their only contract is through HTTP/REST, they don't have any contract like Java interface etc.\nFeel free to use the \"Response\" as return type on the server (in org.keycloak.services.resources.admin.AuthenticationManagementResource), but on the client, it is not good to use \"Response\" at all due the missing automatic error handling, requirement to manually close responses etc. So I suggest to return \"void\" from the org.keycloak.admin.client.resource.AuthenticationManagementResource.updateFlow and org.keycloak.admin.client.resource.AuthenticationManagementResource.updateExecutions and update the tests accordingly.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433187005", "createdAt": "2020-06-01T11:42:51Z", "author": {"login": "mposolda"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -88,6 +88,11 @@\n     @Consumes(MediaType.APPLICATION_JSON)\n     Response copy(@PathParam(\"flowAlias\") String flowAlias, Map<String, String> data);\n \n+    @Path(\"/flows/{id}\")\n+    @PUT\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    Response updateFlow(@PathParam(\"id\") String id, AuthenticationFlowRepresentation flow);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTczMA=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NTg5Mw==", "bodyText": "Edited", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433385893", "createdAt": "2020-06-01T17:39:55Z", "author": {"login": "drichtarik"}, "path": "integration/admin-client/src/main/java/org/keycloak/admin/client/resource/AuthenticationManagementResource.java", "diffHunk": "@@ -88,6 +88,11 @@\n     @Consumes(MediaType.APPLICATION_JSON)\n     Response copy(@PathParam(\"flowAlias\") String flowAlias, Map<String, String> data);\n \n+    @Path(\"/flows/{id}\")\n+    @PUT\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    Response updateFlow(@PathParam(\"id\") String id, AuthenticationFlowRepresentation flow);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTczMA=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODExNDQ1OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDo1MToyOFrOGbljVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozOTozNFrOGdTw6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTk5MQ==", "bodyText": "Is this change needed? If @produces is required, then it will be maybe good to keep the @consumes as well?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431579991", "createdAt": "2020-05-28T04:51:28Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -254,7 +254,7 @@ public AuthenticationFlowRepresentation getFlow(@PathParam(\"id\") String id) {\n     @Path(\"/flows/{id}\")\n     @PUT\n     @NoCache\n-    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces(MediaType.APPLICATION_JSON)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NTcwNw==", "bodyText": "Kept both. It was failing without @produces", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433385707", "createdAt": "2020-06-01T17:39:34Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -254,7 +254,7 @@ public AuthenticationFlowRepresentation getFlow(@PathParam(\"id\") String id) {\n     @Path(\"/flows/{id}\")\n     @PUT\n     @NoCache\n-    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces(MediaType.APPLICATION_JSON)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3OTk5MQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODExNzM1OnYy", "diffSide": "LEFT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/PermissionsTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDo1MzowN1rOGblk-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzo0MDoxN1rOGdTyig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MDQxMQ==", "bodyText": "I think this test failed because you changed the return type in admin client to \"Response\" . If you change it back, the test will probably start passing again. So it will be ideal to revert this change and make sure that PermissionsTest is still tested.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431580411", "createdAt": "2020-05-28T04:53:07Z", "author": {"login": "mposolda"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/PermissionsTest.java", "diffHunk": "@@ -1138,11 +1138,6 @@ public void invoke(RealmResource realm) {\n                 realm.flows().getExecutions(\"nosuch\");\n             }\n         }, Resource.REALM, false);\n-        invoke(new Invocation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NjEyMg==", "bodyText": "Yes. It fixed the issue and I reverted the delete", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433386122", "createdAt": "2020-06-01T17:40:17Z", "author": {"login": "drichtarik"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/PermissionsTest.java", "diffHunk": "@@ -1138,11 +1138,6 @@ public void invoke(RealmResource realm) {\n                 realm.flows().getExecutions(\"nosuch\");\n             }\n         }, Resource.REALM, false);\n-        invoke(new Invocation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MDQxMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODEyNzgxOnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNTowMDozNFrOGblrsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzo0Mzo1M1rOGdT6RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjEzMQ==", "bodyText": "This won't need try/finally block if \"response\" won't be the return type of the \"updateFlow\" method as I suggested earlier.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431582131", "createdAt": "2020-05-28T05:00:34Z", "author": {"login": "mposolda"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "diffHunk": "@@ -275,4 +275,150 @@ public void addExecutionFlow() {\n         assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"parent\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n     }\n \n+    @Test\n+    //KEYCLOAK-12741\n+    public void editFlowTest() {\n+        List<AuthenticationFlowRepresentation> flows;\n+\n+        //copy one first\n+        HashMap<String, String> params = new HashMap<>();\n+        params.put(\"newName\", \"Copy of browser\");\n+        Response response = authMgmtResource.copy(\"browser\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authCopyFlowPath(\"browser\"), params, ResourceType.AUTH_FLOW);\n+        try {\n+            Assert.assertEquals(\"Copy flow\", 201, response.getStatus());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Set a new unique name. Should succeed\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation testFlow = findFlowByAlias(\"Copy of browser\", flows);\n+        testFlow.setAlias(\"Copy of browser2\");\n+        response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(testFlow.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Create new flow and edit the old one to have the new ones name\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"New Flow\", \"Test description\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+        // check that new flow is returned in a children list\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation found = findFlowByAlias(\"New Flow\", flows);\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4ODEwMQ==", "bodyText": "Edited", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433388101", "createdAt": "2020-06-01T17:43:53Z", "author": {"login": "drichtarik"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "diffHunk": "@@ -275,4 +275,150 @@ public void addExecutionFlow() {\n         assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"parent\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n     }\n \n+    @Test\n+    //KEYCLOAK-12741\n+    public void editFlowTest() {\n+        List<AuthenticationFlowRepresentation> flows;\n+\n+        //copy one first\n+        HashMap<String, String> params = new HashMap<>();\n+        params.put(\"newName\", \"Copy of browser\");\n+        Response response = authMgmtResource.copy(\"browser\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authCopyFlowPath(\"browser\"), params, ResourceType.AUTH_FLOW);\n+        try {\n+            Assert.assertEquals(\"Copy flow\", 201, response.getStatus());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Set a new unique name. Should succeed\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation testFlow = findFlowByAlias(\"Copy of browser\", flows);\n+        testFlow.setAlias(\"Copy of browser2\");\n+        response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(testFlow.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Create new flow and edit the old one to have the new ones name\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"New Flow\", \"Test description\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+        // check that new flow is returned in a children list\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation found = findFlowByAlias(\"New Flow\", flows);\n+        try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjEzMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODEyOTE4OnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNTowMToyOFrOGblsgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzo0MzoxMlrOGdT40g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjMzOQ==", "bodyText": "This will need to catch exception instead of checking the response status. Which is in general better approach.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431582339", "createdAt": "2020-05-28T05:01:28Z", "author": {"login": "mposolda"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "diffHunk": "@@ -275,4 +275,150 @@ public void addExecutionFlow() {\n         assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"parent\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n     }\n \n+    @Test\n+    //KEYCLOAK-12741\n+    public void editFlowTest() {\n+        List<AuthenticationFlowRepresentation> flows;\n+\n+        //copy one first\n+        HashMap<String, String> params = new HashMap<>();\n+        params.put(\"newName\", \"Copy of browser\");\n+        Response response = authMgmtResource.copy(\"browser\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authCopyFlowPath(\"browser\"), params, ResourceType.AUTH_FLOW);\n+        try {\n+            Assert.assertEquals(\"Copy flow\", 201, response.getStatus());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Set a new unique name. Should succeed\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation testFlow = findFlowByAlias(\"Copy of browser\", flows);\n+        testFlow.setAlias(\"Copy of browser2\");\n+        response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(testFlow.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Create new flow and edit the old one to have the new ones name\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"New Flow\", \"Test description\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+        // check that new flow is returned in a children list\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation found = findFlowByAlias(\"New Flow\", flows);\n+        try {\n+            Assert.assertNotNull(\"created flow visible in parent\", found);\n+            compareFlows(newFlow, found);\n+\n+            testFlow.setAlias(\"New Flow\");\n+            response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+            Assert.assertEquals(\"updateFlow using the alias of existing flow should fail\", 409, response.getStatus());\n+            flows = authMgmtResource.getFlows();\n+\n+            //name should be the same for the old Flow\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Only update the description\n+        found.setDescription(\"New description\");\n+        response = authMgmtResource.updateFlow(found.getId(), found);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"New description\", findFlowByAlias(\"New Flow\", flows).getDescription());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(found.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Update name and description\n+        found.setAlias(\"New Flow2\");\n+        found.setDescription(\"New description2\");\n+        response = authMgmtResource.updateFlow(found.getId(), found);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"New Flow2\", findFlowByAlias(\"New Flow2\", flows).getAlias());\n+            Assert.assertEquals(\"New description2\", findFlowByAlias(\"New Flow2\", flows).getDescription());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(found.getId()), ResourceType.AUTH_FLOW);\n+            Assert.assertNull(findFlowByAlias(\"New Flow\", flows));\n+        } finally {\n+            response.close();\n+        }\n+        authMgmtResource.deleteFlow(testFlow.getId());\n+    }\n+\n+    @Test\n+    public void editExecutionFlowTest() {\n+        HashMap<String, String> params = new HashMap<>();\n+        List<AuthenticationExecutionInfoRepresentation> executionReps;\n+        //create new parent flow\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"Parent-Flow\", \"This is a parent flow\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+\n+        //create a child sub flow\n+        params.put(\"alias\", \"Child-Flow\");\n+        params.put(\"description\", \"This is a child flow\");\n+        params.put(\"provider\", \"registration-page-form\");\n+        params.put(\"type\", \"basic-flow\");\n+\n+        authMgmtResource.addExecutionFlow(\"Parent-Flow\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"Parent-Flow\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n+\n+        //create another\n+        executionReps = authMgmtResource.getExecutions(\"Parent-Flow\");\n+\n+        params = new HashMap<>();\n+        params.put(\"alias\", \"Child-Flow\");\n+        params.put(\"description\", \"This is another child flow\");\n+        params.put(\"provider\", \"registration-page-form\");\n+        params.put(\"type\", \"basic-flow\");\n+\n+        try {\n+            authMgmtResource.addExecutionFlow(\"Parent-Flow\", params);\n+            Assert.fail(\"addExecutionFlow the alias already exist\");\n+        } catch (Exception expected) {\n+            // Expected\n+        }\n+\n+        AuthenticationExecutionInfoRepresentation found = executionReps.get(0);\n+        found.setDisplayName(\"Parent-Flow\");\n+\n+        Response response = authMgmtResource.updateExecutions(\"Parent-Flow\", found);\n+        try {\n+            Assert.assertEquals(\"updateFlow using the alias of existing flow should fail\", 409, response.getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NzczMA==", "bodyText": "Edited", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433387730", "createdAt": "2020-06-01T17:43:12Z", "author": {"login": "drichtarik"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/authentication/FlowTest.java", "diffHunk": "@@ -275,4 +275,150 @@ public void addExecutionFlow() {\n         assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"parent\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n     }\n \n+    @Test\n+    //KEYCLOAK-12741\n+    public void editFlowTest() {\n+        List<AuthenticationFlowRepresentation> flows;\n+\n+        //copy one first\n+        HashMap<String, String> params = new HashMap<>();\n+        params.put(\"newName\", \"Copy of browser\");\n+        Response response = authMgmtResource.copy(\"browser\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authCopyFlowPath(\"browser\"), params, ResourceType.AUTH_FLOW);\n+        try {\n+            Assert.assertEquals(\"Copy flow\", 201, response.getStatus());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Set a new unique name. Should succeed\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation testFlow = findFlowByAlias(\"Copy of browser\", flows);\n+        testFlow.setAlias(\"Copy of browser2\");\n+        response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(testFlow.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Create new flow and edit the old one to have the new ones name\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"New Flow\", \"Test description\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+        // check that new flow is returned in a children list\n+        flows = authMgmtResource.getFlows();\n+        AuthenticationFlowRepresentation found = findFlowByAlias(\"New Flow\", flows);\n+        try {\n+            Assert.assertNotNull(\"created flow visible in parent\", found);\n+            compareFlows(newFlow, found);\n+\n+            testFlow.setAlias(\"New Flow\");\n+            response = authMgmtResource.updateFlow(testFlow.getId(), testFlow);\n+            Assert.assertEquals(\"updateFlow using the alias of existing flow should fail\", 409, response.getStatus());\n+            flows = authMgmtResource.getFlows();\n+\n+            //name should be the same for the old Flow\n+            Assert.assertEquals(\"Copy of browser2\", findFlowByAlias(\"Copy of browser2\", flows).getAlias());\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Only update the description\n+        found.setDescription(\"New description\");\n+        response = authMgmtResource.updateFlow(found.getId(), found);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"New description\", findFlowByAlias(\"New Flow\", flows).getDescription());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(found.getId()), ResourceType.AUTH_FLOW);\n+        } finally {\n+            response.close();\n+        }\n+\n+        //Update name and description\n+        found.setAlias(\"New Flow2\");\n+        found.setDescription(\"New description2\");\n+        response = authMgmtResource.updateFlow(found.getId(), found);\n+        flows = authMgmtResource.getFlows();\n+        try {\n+            Assert.assertEquals(\"New Flow2\", findFlowByAlias(\"New Flow2\", flows).getAlias());\n+            Assert.assertEquals(\"New description2\", findFlowByAlias(\"New Flow2\", flows).getDescription());\n+            assertAdminEvents.assertEvent(REALM_NAME, OperationType.UPDATE, AdminEventPaths.authEditFlowPath(found.getId()), ResourceType.AUTH_FLOW);\n+            Assert.assertNull(findFlowByAlias(\"New Flow\", flows));\n+        } finally {\n+            response.close();\n+        }\n+        authMgmtResource.deleteFlow(testFlow.getId());\n+    }\n+\n+    @Test\n+    public void editExecutionFlowTest() {\n+        HashMap<String, String> params = new HashMap<>();\n+        List<AuthenticationExecutionInfoRepresentation> executionReps;\n+        //create new parent flow\n+        AuthenticationFlowRepresentation newFlow = newFlow(\"Parent-Flow\", \"This is a parent flow\", \"basic-flow\", true, false);\n+        createFlow(newFlow);\n+\n+        //create a child sub flow\n+        params.put(\"alias\", \"Child-Flow\");\n+        params.put(\"description\", \"This is a child flow\");\n+        params.put(\"provider\", \"registration-page-form\");\n+        params.put(\"type\", \"basic-flow\");\n+\n+        authMgmtResource.addExecutionFlow(\"Parent-Flow\", params);\n+        assertAdminEvents.assertEvent(REALM_NAME, OperationType.CREATE, AdminEventPaths.authAddExecutionFlowPath(\"Parent-Flow\"), params, ResourceType.AUTH_EXECUTION_FLOW);\n+\n+        //create another\n+        executionReps = authMgmtResource.getExecutions(\"Parent-Flow\");\n+\n+        params = new HashMap<>();\n+        params.put(\"alias\", \"Child-Flow\");\n+        params.put(\"description\", \"This is another child flow\");\n+        params.put(\"provider\", \"registration-page-form\");\n+        params.put(\"type\", \"basic-flow\");\n+\n+        try {\n+            authMgmtResource.addExecutionFlow(\"Parent-Flow\", params);\n+            Assert.fail(\"addExecutionFlow the alias already exist\");\n+        } catch (Exception expected) {\n+            // Expected\n+        }\n+\n+        AuthenticationExecutionInfoRepresentation found = executionReps.get(0);\n+        found.setDisplayName(\"Parent-Flow\");\n+\n+        Response response = authMgmtResource.updateExecutions(\"Parent-Flow\", found);\n+        try {\n+            Assert.assertEquals(\"updateFlow using the alias of existing flow should fail\", 409, response.getStatus());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjMzOQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 158}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODEzMTI3OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNTowMzowMVrOGblt7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDoxNjowN1rOGdz3XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjcwMQ==", "bodyText": "It seems the NPE can happen on this line. This is probably the reason of some more failing tests. Probably some null check is needed here?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r431582701", "createdAt": "2020-05-28T05:03:01Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +618,34 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            return Response.accepted(flow).build();\n         }\n+\n+        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());\n+\n+        //check if a flow with the same name already exist\n+        if (checkFlow != null) {\n+            //if only the description changed, the IDs of old and new are going to be the same\n+            if (!checkFlow.getDescription().equals(rep.getDescription()) && checkFlow.getId().equals(rep.getFlowId())) {\n+                checkFlow.setDescription(rep.getDescription());\n+                realm.updateAuthenticationFlow(checkFlow);\n+            } else {\n+                //Flow with that name already exists\n+                return ErrorResponse.exists(\"Flow alias name already exists\");\n+            }\n+        } else {\n+            //if the name changed\n+            checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+            checkFlow.setAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4Njg1Ng==", "bodyText": "Fixed by throwing NotFoundException. Is that ok?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433386856", "createdAt": "2020-06-01T17:41:39Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +618,34 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            return Response.accepted(flow).build();\n         }\n+\n+        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());\n+\n+        //check if a flow with the same name already exist\n+        if (checkFlow != null) {\n+            //if only the description changed, the IDs of old and new are going to be the same\n+            if (!checkFlow.getDescription().equals(rep.getDescription()) && checkFlow.getId().equals(rep.getFlowId())) {\n+                checkFlow.setDescription(rep.getDescription());\n+                realm.updateAuthenticationFlow(checkFlow);\n+            } else {\n+                //Flow with that name already exists\n+                return ErrorResponse.exists(\"Flow alias name already exists\");\n+            }\n+        } else {\n+            //if the name changed\n+            checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+            checkFlow.setAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjcwMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQxMjI5Ng==", "bodyText": "It seems it is not ok. There are still failing tests in travis (for example RequiredActionTotpSetupTest) and I think that the reason is exactly this.\nThe execution doesn't necessarily need to have \"flowId\" filled. The AuthenticationExecutions, which point to the Authenticator implementations, don't have the \"flowId\" filled at all. I think you can just return from the method in case that checkFlow doesn't exists. Maybe something like this:\n            if (checkFlow == null) {\n                return;\n            }", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433412296", "createdAt": "2020-06-01T18:29:52Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +618,34 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            return Response.accepted(flow).build();\n         }\n+\n+        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());\n+\n+        //check if a flow with the same name already exist\n+        if (checkFlow != null) {\n+            //if only the description changed, the IDs of old and new are going to be the same\n+            if (!checkFlow.getDescription().equals(rep.getDescription()) && checkFlow.getId().equals(rep.getFlowId())) {\n+                checkFlow.setDescription(rep.getDescription());\n+                realm.updateAuthenticationFlow(checkFlow);\n+            } else {\n+                //Flow with that name already exists\n+                return ErrorResponse.exists(\"Flow alias name already exists\");\n+            }\n+        } else {\n+            //if the name changed\n+            checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+            checkFlow.setAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjcwMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQyMzg5Ng==", "bodyText": "I've added a check if its a flow or an execution that is being updated. Let's see the tests results", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433423896", "createdAt": "2020-06-01T18:51:42Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +618,34 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            return Response.accepted(flow).build();\n         }\n+\n+        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());\n+\n+        //check if a flow with the same name already exist\n+        if (checkFlow != null) {\n+            //if only the description changed, the IDs of old and new are going to be the same\n+            if (!checkFlow.getDescription().equals(rep.getDescription()) && checkFlow.getId().equals(rep.getFlowId())) {\n+                checkFlow.setDescription(rep.getDescription());\n+                realm.updateAuthenticationFlow(checkFlow);\n+            } else {\n+                //Flow with that name already exists\n+                return ErrorResponse.exists(\"Flow alias name already exists\");\n+            }\n+        } else {\n+            //if the name changed\n+            checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+            checkFlow.setAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjcwMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkxMTY0NA==", "bodyText": "I've done a rework of the endpoints and left the old code commented out. Please let me know what you think. Is the new approach better than the previous one? The tests have passed. If you agree let me delete the commented code afterwards to have it all clean.", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r433911644", "createdAt": "2020-06-02T14:16:07Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +618,34 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            return Response.accepted(flow).build();\n         }\n+\n+        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());\n+\n+        //check if a flow with the same name already exist\n+        if (checkFlow != null) {\n+            //if only the description changed, the IDs of old and new are going to be the same\n+            if (!checkFlow.getDescription().equals(rep.getDescription()) && checkFlow.getId().equals(rep.getFlowId())) {\n+                checkFlow.setDescription(rep.getDescription());\n+                realm.updateAuthenticationFlow(checkFlow);\n+            } else {\n+                //Flow with that name already exists\n+                return ErrorResponse.exists(\"Flow alias name already exists\");\n+            }\n+        } else {\n+            //if the name changed\n+            checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+            checkFlow.setAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4MjcwMQ=="}, "originalCommit": {"oid": "ebc057e55e31c8d16a91bbbd2f708c399030ca56"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNTQyMTI5OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo1MDowOVrOGeM7gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDozNDo1MlrOGee1ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjMwNw==", "bodyText": "Maybe remove this comment?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434322307", "createdAt": "2020-06-03T05:50:09Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxNTY3NQ==", "bodyText": "I left it there deliberately. It is now removed", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434615675", "createdAt": "2020-06-03T14:34:52Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjMwNw=="}, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNTQyMTU4OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo1MDoxOVrOGeM7sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDozOTo1MVrOGefELw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjM1Mg==", "bodyText": "Maybe remove this comment?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434322352", "createdAt": "2020-06-03T05:50:19Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;\n+            return Response.accepted(flow).build();\n+        }\n+\n+        //executions can't have name and description updated\n+        if (rep.getAuthenticationFlow() == null) { return Response.accepted(flow).build();}\n+\n+        //check if updating a correct flow\n+        AuthenticationFlowModel checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+        if (checkFlow == null) {\n+            session.getTransactionManager().setRollbackOnly();\n+            throw new NotFoundException(\"Illegal execution\");\n+        }\n+\n+        //if a different flow with the same name does already exist, throw an exception\n+        if (realm.getFlowByAlias(rep.getDisplayName()) != null && !checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            return ErrorResponse.exists(\"Flow alias name already exists\");\n+            //throw new BadRequestException(\"Name already exists\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxOTQzOQ==", "bodyText": "removed", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434619439", "createdAt": "2020-06-03T14:39:51Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;\n+            return Response.accepted(flow).build();\n+        }\n+\n+        //executions can't have name and description updated\n+        if (rep.getAuthenticationFlow() == null) { return Response.accepted(flow).build();}\n+\n+        //check if updating a correct flow\n+        AuthenticationFlowModel checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+        if (checkFlow == null) {\n+            session.getTransactionManager().setRollbackOnly();\n+            throw new NotFoundException(\"Illegal execution\");\n+        }\n+\n+        //if a different flow with the same name does already exist, throw an exception\n+        if (realm.getFlowByAlias(rep.getDisplayName()) != null && !checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            return ErrorResponse.exists(\"Flow alias name already exists\");\n+            //throw new BadRequestException(\"Name already exists\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjM1Mg=="}, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNTQyMTkwOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo1MDozMlrOGeM72g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDozNDo0NFrOGee1Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjM5NA==", "bodyText": "Maybe remove this comment?", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434322394", "createdAt": "2020-06-03T05:50:32Z", "author": {"login": "mposolda"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;\n+            return Response.accepted(flow).build();\n+        }\n+\n+        //executions can't have name and description updated\n+        if (rep.getAuthenticationFlow() == null) { return Response.accepted(flow).build();}\n+\n+        //check if updating a correct flow\n+        AuthenticationFlowModel checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+        if (checkFlow == null) {\n+            session.getTransactionManager().setRollbackOnly();\n+            throw new NotFoundException(\"Illegal execution\");\n+        }\n+\n+        //if a different flow with the same name does already exist, throw an exception\n+        if (realm.getFlowByAlias(rep.getDisplayName()) != null && !checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            return ErrorResponse.exists(\"Flow alias name already exists\");\n+            //throw new BadRequestException(\"Name already exists\");\n+        }\n+\n+        //if the name changed\n+        if (!checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            checkFlow.setAlias(rep.getDisplayName());\n+        }\n+\n+        //check if the description changed\n+        if (!checkFlow.getDescription().equals(rep.getDescription())) {\n+            checkFlow.setDescription(rep.getDescription());\n+        }\n+\n+        //update the flow\n+        realm.updateAuthenticationFlow(checkFlow);\n+        adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+        return Response.accepted(flow).build();\n+\n+/*        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxNTU2Nw==", "bodyText": "I left it there deliberately. It is now removed", "url": "https://github.com/keycloak/keycloak/pull/7109#discussion_r434615567", "createdAt": "2020-06-03T14:34:44Z", "author": {"login": "drichtarik"}, "path": "services/src/main/java/org/keycloak/services/resources/admin/AuthenticationManagementResource.java", "diffHunk": "@@ -599,7 +648,70 @@ public void updateExecutions(@PathParam(\"flowAlias\") String flowAlias, Authentic\n             model.setRequirement(AuthenticationExecutionModel.Requirement.valueOf(rep.getRequirement()));\n             realm.updateAuthenticatorExecution(model);\n             adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+            //return;\n+            return Response.accepted(flow).build();\n+        }\n+\n+        //executions can't have name and description updated\n+        if (rep.getAuthenticationFlow() == null) { return Response.accepted(flow).build();}\n+\n+        //check if updating a correct flow\n+        AuthenticationFlowModel checkFlow = realm.getAuthenticationFlowById(rep.getFlowId());\n+        if (checkFlow == null) {\n+            session.getTransactionManager().setRollbackOnly();\n+            throw new NotFoundException(\"Illegal execution\");\n+        }\n+\n+        //if a different flow with the same name does already exist, throw an exception\n+        if (realm.getFlowByAlias(rep.getDisplayName()) != null && !checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            return ErrorResponse.exists(\"Flow alias name already exists\");\n+            //throw new BadRequestException(\"Name already exists\");\n+        }\n+\n+        //if the name changed\n+        if (!checkFlow.getAlias().equals(rep.getDisplayName())) {\n+            checkFlow.setAlias(rep.getDisplayName());\n+        }\n+\n+        //check if the description changed\n+        if (!checkFlow.getDescription().equals(rep.getDescription())) {\n+            checkFlow.setDescription(rep.getDescription());\n+        }\n+\n+        //update the flow\n+        realm.updateAuthenticationFlow(checkFlow);\n+        adminEvent.operation(OperationType.UPDATE).resource(ResourceType.AUTH_EXECUTION).resourcePath(session.getContext().getUri()).representation(rep).success();\n+        return Response.accepted(flow).build();\n+\n+/*        AuthenticationFlowModel checkFlow = realm.getFlowByAlias(rep.getDisplayName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjM5NA=="}, "originalCommit": {"oid": "2fa4788c15732c043c42b05dd85b828d75138e2c"}, "originalPosition": 136}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3671, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}