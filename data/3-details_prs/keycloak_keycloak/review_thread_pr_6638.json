{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTc5OTY4", "number": 6638, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxNTo0MlrODWRw8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxOTowOVrODWR1jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0Njg2MzIxOnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxNTo0MlrOFa8XMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxNTo0MlrOFa8XMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc5NjI3NQ==", "bodyText": "nit: assertThat(users, hasSize(1));", "url": "https://github.com/keycloak/keycloak/pull/6638#discussion_r363796275", "createdAt": "2020-01-07T15:15:42Z", "author": {"login": "hmlnarik"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "diffHunk": "@@ -716,6 +718,19 @@ public void attributes() {\n         assertNull(user1.getAttributes());\n     }\n \n+    @Test\n+    public void testImportUserWithNullAttribute() {\n+        RealmRepresentation rep = loadJson(getClass().getResourceAsStream(\"/import/testrealm-user-null-attr.json\"), RealmRepresentation.class);\n+\n+        try (Creator<RealmResource> c = Creator.create(adminClient, rep)) {\n+            List<UserRepresentation> users = c.resource().users().list();\n+            // there should be only one user\n+            assertThat(users.size(), equalTo(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2588db4cc48a4fb153362594155c34144188e2ee"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0Njg2NDEyOnYy", "diffSide": "RIGHT", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxNTo1OFrOFa8Xvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxNTo1OFrOFa8Xvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc5NjQxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // test there are only 2 attibutes imported from json file, attribute \"key3\" : [ null ] shoudn't be imported\n          \n          \n            \n                        // test there are only 2 attributes imported from json file, attribute \"key3\" : [ null ] shoudn't be imported", "url": "https://github.com/keycloak/keycloak/pull/6638#discussion_r363796414", "createdAt": "2020-01-07T15:15:58Z", "author": {"login": "hmlnarik"}, "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/UserTest.java", "diffHunk": "@@ -716,6 +718,19 @@ public void attributes() {\n         assertNull(user1.getAttributes());\n     }\n \n+    @Test\n+    public void testImportUserWithNullAttribute() {\n+        RealmRepresentation rep = loadJson(getClass().getResourceAsStream(\"/import/testrealm-user-null-attr.json\"), RealmRepresentation.class);\n+\n+        try (Creator<RealmResource> c = Creator.create(adminClient, rep)) {\n+            List<UserRepresentation> users = c.resource().users().list();\n+            // there should be only one user\n+            assertThat(users.size(), equalTo(1));\n+            // test there are only 2 attibutes imported from json file, attribute \"key3\" : [ null ] shoudn't be imported", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2588db4cc48a4fb153362594155c34144188e2ee"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0Njg3NTAzOnYy", "diffSide": "RIGHT", "path": "model/jpa/src/main/java/org/keycloak/models/jpa/UserAdapter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxOTowOVrOFa8eSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxNToxOTowOVrOFa8eSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc5ODA5MA==", "bodyText": "No need to realize this list into memory via .collect. you can either obtain a stream iterator() or use Stream.forEach().", "url": "https://github.com/keycloak/keycloak/pull/6638#discussion_r363798090", "createdAt": "2020-01-07T15:19:09Z", "author": {"login": "hmlnarik"}, "path": "model/jpa/src/main/java/org/keycloak/models/jpa/UserAdapter.java", "diffHunk": "@@ -147,8 +152,9 @@ public void setAttribute(String name, List<String> values) {\n         // Remove all existing\n         removeAttribute(name);\n \n-        // Put all new\n-        for (String value : values) {\n+        List<String> nonNullValues = values.stream().filter(Objects::nonNull).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2588db4cc48a4fb153362594155c34144188e2ee"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3919, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}