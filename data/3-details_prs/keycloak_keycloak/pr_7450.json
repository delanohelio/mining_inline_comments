{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMjE4NzA4", "number": 7450, "title": "KEYCLOAK-15631 Disable clustering for 'dev' profile. Remove cluster.x\u2026", "bodyText": "@pedroigor @stianst Do you have a chance to review please?\nSummary of the changes in this PR:\n\n\nRemoved file \"cluster.xml\" from the distribution/server-x. Instead the existing infinispan configuration files from the \"quarkus/runtime\" module are copied to the server-x distribution during build. This allows us to remove one of duplicated infinispan configuration files. We still have quite a lot of them in whole workspace, so still there is a need for many changes if you want to update some property in the infinispan config, however at least we have one less :)\n\n\nAdded versions to our 3 quarkus modules in the \"dependencyManagement\" in the main pom.xml. AFAIK this is still good maven practice and it allowed to remove some of the versions from other pom.xml files in the codebase\n\n\nAdded boolean property \"--cluster-enabled\", which maps to the \"clustered\" property of DefaultInfinispanConnectionProvider. IMO enable or disable clustering can be quite common operation? Hence I introduced \"1st level\" property of it, so people don't need to specify quite a long \"--spi-connections-infinispan-default-clustered=true\" .\n\n\n@pedroigor NOTE: ConfigurationTest is failing for me, but I have suspicion that it is not regression of my PR. If it pass for you in your laptop, then please don't merge this PR as it is a chance that failing test is a regression of this PR then...", "createdAt": "2020-09-25T16:52:17Z", "url": "https://github.com/keycloak/keycloak/pull/7450", "merged": true, "mergeCommit": {"oid": "10859ebfc39255a3b7ae74c2b034ea1601a725e9"}, "closed": true, "closedAt": "2020-09-29T12:13:30Z", "author": {"login": "mposolda"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMYizqAH2gAyNDkzMjE4NzA4OmMxMWQ5ZGZlODU3NTE3N2NkNTU4MjhmNTkxZTAxZTQ3ODkzOWIwYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNnIFrgFqTQ5ODQwMTcyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c11d9dfe8575177cd55828f591e01e478939b0b2", "author": {"user": {"login": "mposolda", "name": "Marek Posolda"}}, "url": "https://github.com/keycloak/keycloak/commit/c11d9dfe8575177cd55828f591e01e478939b0b2", "committedDate": "2020-09-25T16:40:04Z", "message": "KEYCLOAK-15631 Disable clustering for 'dev' profile. Remove cluster.xml file from quarkus distribution packaging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTkyMjIw", "url": "https://github.com/keycloak/keycloak/pull/7450#pullrequestreview-496592220", "createdAt": "2020-09-25T16:57:34Z", "commit": {"oid": "c11d9dfe8575177cd55828f591e01e478939b0b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjo1NzozNFrOHYLfNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjo1NzozNFrOHYLfNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTExNjA4NQ==", "bodyText": "@pedroigor I needed to use \"placeholder\" for the defaultValue as the transformer function is not executed in case that value is null. If we want to remove the workaround with \"placeholder\", we may need to change this line and remove the need to have non-null defaultValue - https://github.com/keycloak/keycloak/blob/master/quarkus/runtime/src/main/java/org/keycloak/configuration/PropertyMapper.java#L137 .\nThen it will be possible to run transformer function even if \"value\" is null - which I am not 100% sure we want to support? WDYT?", "url": "https://github.com/keycloak/keycloak/pull/7450#discussion_r495116085", "createdAt": "2020-09-25T16:57:34Z", "author": {"login": "mposolda"}, "path": "quarkus/runtime/src/main/java/org/keycloak/configuration/PropertyMappers.java", "diffHunk": "@@ -133,6 +131,19 @@ private static void configureDatabasePropertyMappers() {\n         createWithDefault(\"db.pool.max-size\", \"quarkus.datasource.jdbc.max-size\", String.valueOf(100), \"The maximum size of the connection pool.\");\n     }\n \n+    private static void configureClustering() {\n+        createWithDefault(\"cluster.enabled\", \"kc.spi.connections-infinispan.default.clustered\", \"placeholder\", (value, context) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c11d9dfe8575177cd55828f591e01e478939b0b2"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDAxNzI3", "url": "https://github.com/keycloak/keycloak/pull/7450#pullrequestreview-498401727", "createdAt": "2020-09-29T12:13:23Z", "commit": {"oid": "c11d9dfe8575177cd55828f591e01e478939b0b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3442, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}