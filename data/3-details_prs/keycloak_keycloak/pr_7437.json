{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwOTEwOTg1", "number": 7437, "title": "KEYCLOAK-14231 - validate supported locales", "bodyText": "@hmlnarik Please, can you make a review? Thanks.", "createdAt": "2020-09-22T12:39:40Z", "url": "https://github.com/keycloak/keycloak/pull/7437", "merged": true, "mergeCommit": {"oid": "7f916ad20c0b4ff2343d536ac7f1f37d448c9ce0"}, "closed": true, "closedAt": "2020-12-07T18:56:33Z", "author": {"login": "lhanusov"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLmpU2ABqjM3OTY0NjQwMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj6PnUAFqTU0NjQ0MTgzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b835b6dbdf78c5a611ae47049ad0406c28f0773", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/0b835b6dbdf78c5a611ae47049ad0406c28f0773", "committedDate": "2020-09-22T12:38:51Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "a056e64dbb7eaedfeee963ae37abfcc352271d5f", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/a056e64dbb7eaedfeee963ae37abfcc352271d5f", "committedDate": "2020-09-23T06:31:39Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a056e64dbb7eaedfeee963ae37abfcc352271d5f", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/a056e64dbb7eaedfeee963ae37abfcc352271d5f", "committedDate": "2020-09-23T06:31:39Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "52c924dda25fa5e2bbca8a55467164fbb04271c9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/52c924dda25fa5e2bbca8a55467164fbb04271c9", "committedDate": "2020-09-24T11:49:17Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52c924dda25fa5e2bbca8a55467164fbb04271c9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/52c924dda25fa5e2bbca8a55467164fbb04271c9", "committedDate": "2020-09-24T11:49:17Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "055263071cf06da7d86a911e8c89c9ba22194290", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/055263071cf06da7d86a911e8c89c9ba22194290", "committedDate": "2020-09-24T11:52:29Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "055263071cf06da7d86a911e8c89c9ba22194290", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/055263071cf06da7d86a911e8c89c9ba22194290", "committedDate": "2020-09-24T11:52:29Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "57b2c62cc6d3d14047eff882a4260ae78db0be96", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/57b2c62cc6d3d14047eff882a4260ae78db0be96", "committedDate": "2020-09-24T11:53:13Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57b2c62cc6d3d14047eff882a4260ae78db0be96", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/57b2c62cc6d3d14047eff882a4260ae78db0be96", "committedDate": "2020-09-24T11:53:13Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "eb089b7808a44dd570695bbbc68a5f8b89eb3d15", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/eb089b7808a44dd570695bbbc68a5f8b89eb3d15", "committedDate": "2020-09-24T19:25:37Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb089b7808a44dd570695bbbc68a5f8b89eb3d15", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/eb089b7808a44dd570695bbbc68a5f8b89eb3d15", "committedDate": "2020-09-24T19:25:37Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "abe0a06d203d559e811a4727d0912ac3482db7a2", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/abe0a06d203d559e811a4727d0912ac3482db7a2", "committedDate": "2020-09-29T15:35:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abe0a06d203d559e811a4727d0912ac3482db7a2", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/abe0a06d203d559e811a4727d0912ac3482db7a2", "committedDate": "2020-09-29T15:35:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "58e3678f841eec9c4268d9a57bc1fade73bbce9e", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/58e3678f841eec9c4268d9a57bc1fade73bbce9e", "committedDate": "2020-09-30T08:21:16Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58e3678f841eec9c4268d9a57bc1fade73bbce9e", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/58e3678f841eec9c4268d9a57bc1fade73bbce9e", "committedDate": "2020-09-30T08:21:16Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "f0d3fd9b3555f0c6663cebe0c4179d5f8197222f", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/f0d3fd9b3555f0c6663cebe0c4179d5f8197222f", "committedDate": "2020-09-30T12:59:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0d3fd9b3555f0c6663cebe0c4179d5f8197222f", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/f0d3fd9b3555f0c6663cebe0c4179d5f8197222f", "committedDate": "2020-09-30T12:59:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "cfe119bd026f52147d8fdf554d9fd392e0c4c35d", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/cfe119bd026f52147d8fdf554d9fd392e0c4c35d", "committedDate": "2020-09-30T13:00:44Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfe119bd026f52147d8fdf554d9fd392e0c4c35d", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/cfe119bd026f52147d8fdf554d9fd392e0c4c35d", "committedDate": "2020-09-30T13:00:44Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "c3fd6fe2b02f45c763cfa5aaa42fe0a04fbf90ee", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/c3fd6fe2b02f45c763cfa5aaa42fe0a04fbf90ee", "committedDate": "2020-09-30T13:02:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3fd6fe2b02f45c763cfa5aaa42fe0a04fbf90ee", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/c3fd6fe2b02f45c763cfa5aaa42fe0a04fbf90ee", "committedDate": "2020-09-30T13:02:47Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "8e0c641a238b91999e6537ac849bb82e12a38a99", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/8e0c641a238b91999e6537ac849bb82e12a38a99", "committedDate": "2020-09-30T15:55:40Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e0c641a238b91999e6537ac849bb82e12a38a99", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/8e0c641a238b91999e6537ac849bb82e12a38a99", "committedDate": "2020-09-30T15:55:40Z", "message": "KEYCLOAK-14231 - supported locales, validate reserved chars"}, "afterCommit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/ddcbb0f6532893512aa9ac236ee6c644dccc49d5", "committedDate": "2020-10-01T11:39:27Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTI1NjYz", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-500925663", "createdAt": "2020-10-02T07:51:59Z", "commit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzo1MTo1OVrOHbkM3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzo1MTo1OVrOHbkM3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2NjcxOQ==", "bodyText": "This is not in line with https://tools.ietf.org/html/rfc3986#section-2.2 anymore. Is this intended? If so, needs to be justified in the comment above", "url": "https://github.com/keycloak/keycloak/pull/7437#discussion_r498666719", "createdAt": "2020-10-02T07:51:59Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/utils/ReservedCharValidator.java", "diffHunk": "@@ -19,17 +19,20 @@\n import javax.ws.rs.BadRequestException;\n import org.jboss.logging.Logger;\n \n+import java.util.Set;\n+\n /**\n  *\n  * @author Stan Silvert\n+ * @author Lukas Hanusovsky lhanusov@redhat.com\n  */\n public class ReservedCharValidator {\n     protected static final Logger logger = Logger.getLogger(ReservedCharValidator.class);\n     \n     // https://tools.ietf.org/html/rfc3986#section-2.2\n-    private static final String[] RESERVED_CHARS = { \":\", \"/\", \"?\", \"#\", \"[\", \"@\", \"!\", \"$\", \n+    private static final String[] RESERVED_CHARS = { \":\", \"/\", \"?\", \"#\", \"@\", \"!\", \"$\",\n                                                    \"&\", \"(\", \")\", \"*\", \"+\", \",\", \";\", \"=\", \n-                                                   \"]\", \"[\", \"\\\\\" };\n+                                                   \"]\", \"[\", \"\\\\\", \"{\", \"}\", \"%\" };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTI2MTYz", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-500926163", "createdAt": "2020-10-02T07:52:48Z", "commit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzo1Mjo0OFrOHbkOiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzo1Mjo0OFrOHbkOiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2NzE0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void validate(Set<String> strSet) throws ReservedCharException {\n          \n          \n            \n                public static void validate(Iterable<String> strSet) throws ReservedCharException {", "url": "https://github.com/keycloak/keycloak/pull/7437#discussion_r498667147", "createdAt": "2020-10-02T07:52:48Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/utils/ReservedCharValidator.java", "diffHunk": "@@ -44,6 +47,14 @@ public static void validate(String str) throws ReservedCharException {\n             } \n         }\n     }\n+\n+    public static void validate(Set<String> strSet) throws ReservedCharException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddcbb0f6532893512aa9ac236ee6c644dccc49d5", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/ddcbb0f6532893512aa9ac236ee6c644dccc49d5", "committedDate": "2020-10-01T11:39:27Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "3bdb57de09cef9127f24528f4a2555a91b8865a3", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/3bdb57de09cef9127f24528f4a2555a91b8865a3", "committedDate": "2020-10-02T08:37:26Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzIzMDY2", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-501323066", "createdAt": "2020-10-02T17:35:00Z", "commit": {"oid": "3bdb57de09cef9127f24528f4a2555a91b8865a3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDU1MTc2", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-504455176", "createdAt": "2020-10-08T06:13:05Z", "commit": {"oid": "3bdb57de09cef9127f24528f4a2555a91b8865a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNjoxMzowNlrOHePVNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwNjoxMzowNlrOHePVNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3MDUxNg==", "bodyText": "@ssilvert I changed the ReservedChars array and added there 3 new chars. Also Hynek proposed to refactor the whole class and change the for-each loop into regex validation. What do you think?", "url": "https://github.com/keycloak/keycloak/pull/7437#discussion_r501470516", "createdAt": "2020-10-08T06:13:06Z", "author": {"login": "lhanusov"}, "path": "services/src/main/java/org/keycloak/utils/ReservedCharValidator.java", "diffHunk": "@@ -22,14 +22,16 @@\n /**\n  *\n  * @author Stan Silvert\n+ * @author Lukas Hanusovsky lhanusov@redhat.com\n  */\n public class ReservedCharValidator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bdb57de09cef9127f24528f4a2555a91b8865a3"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bdb57de09cef9127f24528f4a2555a91b8865a3", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/3bdb57de09cef9127f24528f4a2555a91b8865a3", "committedDate": "2020-10-02T08:37:26Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "c97985c47c02a8be298b0b335123dfaa565cfa4b", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/c97985c47c02a8be298b0b335123dfaa565cfa4b", "committedDate": "2020-11-09T11:11:21Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MTU0NDU5", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-526154459", "createdAt": "2020-11-09T11:19:41Z", "commit": {"oid": "c97985c47c02a8be298b0b335123dfaa565cfa4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToxOTo0MVrOHvqBiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToxOTo0NFrOHvqBpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczMzY0Mw==", "bodyText": "Missing\n        if (str == null) return;", "url": "https://github.com/keycloak/keycloak/pull/7437#discussion_r519733643", "createdAt": "2020-11-09T11:19:41Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/utils/ReservedCharValidator.java", "diffHunk": "@@ -19,29 +19,46 @@\n import javax.ws.rs.BadRequestException;\n import org.jboss.logging.Logger;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n /**\n  *\n  * @author Stan Silvert\n+ * @author Lukas Hanusovsky lhanusov@redhat.com\n  */\n public class ReservedCharValidator {\n     protected static final Logger logger = Logger.getLogger(ReservedCharValidator.class);\n     \n     // https://tools.ietf.org/html/rfc3986#section-2.2\n-    private static final String[] RESERVED_CHARS = { \":\", \"/\", \"?\", \"#\", \"[\", \"@\", \"!\", \"$\", \n-                                                   \"&\", \"(\", \")\", \"*\", \"+\", \",\", \";\", \"=\", \n-                                                   \"]\", \"[\", \"\\\\\" };\n+    private static final Pattern RESERVED_CHARS_PATTERN = Pattern.compile(\"[:/?#@!$&()*+,;=\\\\[\\\\]\\\\\\\\]\");\n+\n+    // KEYCLOAK-14231 - Supported Locales: Three new characters were added on top of this RFC: \"{\", \"}\", \"%\"\n+    private static final Pattern RESERVED_CHARS_LOCALES_PATTERN = Pattern.compile(\"[:/?#@!$&()*+,;=\\\\[\\\\]\\\\\\\\{}%]\");\n+\n     private ReservedCharValidator() {}\n-    \n-    public static void validate(String str) throws ReservedCharException {\n+\n+    public static void validate(String str, Pattern pattern) throws ReservedCharException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97985c47c02a8be298b0b335123dfaa565cfa4b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczMzY3MQ==", "bodyText": "This is weird and I understand that this is based on the original code. Please replace with\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ReservedCharException e = new ReservedCharException(message);\n          \n          \n            \n                        logger.warn(message, e);\n          \n          \n            \n                        throw e;\n          \n          \n            \n                        logger.warn(message);\n          \n          \n            \n                        throw new ReservedCharException(message);", "url": "https://github.com/keycloak/keycloak/pull/7437#discussion_r519733671", "createdAt": "2020-11-09T11:19:44Z", "author": {"login": "hmlnarik"}, "path": "services/src/main/java/org/keycloak/utils/ReservedCharValidator.java", "diffHunk": "@@ -19,29 +19,46 @@\n import javax.ws.rs.BadRequestException;\n import org.jboss.logging.Logger;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n /**\n  *\n  * @author Stan Silvert\n+ * @author Lukas Hanusovsky lhanusov@redhat.com\n  */\n public class ReservedCharValidator {\n     protected static final Logger logger = Logger.getLogger(ReservedCharValidator.class);\n     \n     // https://tools.ietf.org/html/rfc3986#section-2.2\n-    private static final String[] RESERVED_CHARS = { \":\", \"/\", \"?\", \"#\", \"[\", \"@\", \"!\", \"$\", \n-                                                   \"&\", \"(\", \")\", \"*\", \"+\", \",\", \";\", \"=\", \n-                                                   \"]\", \"[\", \"\\\\\" };\n+    private static final Pattern RESERVED_CHARS_PATTERN = Pattern.compile(\"[:/?#@!$&()*+,;=\\\\[\\\\]\\\\\\\\]\");\n+\n+    // KEYCLOAK-14231 - Supported Locales: Three new characters were added on top of this RFC: \"{\", \"}\", \"%\"\n+    private static final Pattern RESERVED_CHARS_LOCALES_PATTERN = Pattern.compile(\"[:/?#@!$&()*+,;=\\\\[\\\\]\\\\\\\\{}%]\");\n+\n     private ReservedCharValidator() {}\n-    \n-    public static void validate(String str) throws ReservedCharException {\n+\n+    public static void validate(String str, Pattern pattern) throws ReservedCharException {\n+        Matcher matcher = pattern.matcher(str);\n+        if (matcher.find()) {\n+            String message = \"Character '\" + matcher.group() + \"' not allowed.\";\n+            ReservedCharException e = new ReservedCharException(message);\n+            logger.warn(message, e);\n+            throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97985c47c02a8be298b0b335123dfaa565cfa4b"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c97985c47c02a8be298b0b335123dfaa565cfa4b", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/c97985c47c02a8be298b0b335123dfaa565cfa4b", "committedDate": "2020-11-09T11:11:21Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "b9e0c0d647b64691646b4cc6082a3b6d78293ee9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/b9e0c0d647b64691646b4cc6082a3b6d78293ee9", "committedDate": "2020-11-09T12:02:50Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9e0c0d647b64691646b4cc6082a3b6d78293ee9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/b9e0c0d647b64691646b4cc6082a3b6d78293ee9", "committedDate": "2020-11-09T12:02:50Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "47f1e54f25503484d206eea5b95407e714dbdff9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/47f1e54f25503484d206eea5b95407e714dbdff9", "committedDate": "2020-11-24T15:33:44Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47f1e54f25503484d206eea5b95407e714dbdff9", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/47f1e54f25503484d206eea5b95407e714dbdff9", "committedDate": "2020-11-24T15:33:44Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "55b6294b4beb5e859a01312a9b342b40d3ebb23c", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/55b6294b4beb5e859a01312a9b342b40d3ebb23c", "committedDate": "2020-11-30T09:17:31Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acef07832f4c7a2adb57ab20539ed502b5a9e037", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/acef07832f4c7a2adb57ab20539ed502b5a9e037", "committedDate": "2020-12-02T07:47:29Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55b6294b4beb5e859a01312a9b342b40d3ebb23c", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/55b6294b4beb5e859a01312a9b342b40d3ebb23c", "committedDate": "2020-11-30T09:17:31Z", "message": "KEYCLOAK-14231 - validate supported locales"}, "afterCommit": {"oid": "acef07832f4c7a2adb57ab20539ed502b5a9e037", "author": {"user": {"login": "lhanusov", "name": "Lukas Hanusovsky"}}, "url": "https://github.com/keycloak/keycloak/commit/acef07832f4c7a2adb57ab20539ed502b5a9e037", "committedDate": "2020-12-02T07:47:29Z", "message": "KEYCLOAK-14231 - validate supported locales"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDQxODM1", "url": "https://github.com/keycloak/keycloak/pull/7437#pullrequestreview-546441835", "createdAt": "2020-12-07T18:56:08Z", "commit": {"oid": "acef07832f4c7a2adb57ab20539ed502b5a9e037"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3417, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}