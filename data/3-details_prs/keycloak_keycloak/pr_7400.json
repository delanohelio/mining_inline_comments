{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMDQ2NzI1", "number": 7400, "title": "KEYCLOAK-15270 Account REST API doesn't verify audience", "bodyText": "Test pipeline runs:\nhttps://keycloak-jenkins.com/job/universal-test-pipeline-server/2124/\nhttps://keycloak-jenkins.com/job/universal-test-pipeline-adapters/1714/\nThe failures are unrelated to this change except for AccountFormServiceTest. The test is now fixed, the fix was very simple, so I didn't re-run the whole pipelines just for that. You should be able to see it passed in Travis below.", "createdAt": "2020-09-08T13:33:13Z", "url": "https://github.com/keycloak/keycloak/pull/7400", "merged": true, "mergeCommit": {"oid": "a9a719b88c67bb8575dca3b980582f9610b12257"}, "closed": true, "closedAt": "2020-09-14T11:43:10Z", "author": {"login": "vmuzikar"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGyS73gH2gAyNDgyMDQ2NzI1OjJjNmZkMzcwMWI1N2EwZTAxMGJkODljMTk4N2U1NjkzNWQ2ZjYwNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHy7KngFqTQ4NjY5NDEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c6fd3701b57a0e010bd89c1987e56935d6f6056", "author": {"user": {"login": "vmuzikar", "name": "V\u00e1clav Muzik\u00e1\u0159"}}, "url": "https://github.com/keycloak/keycloak/commit/2c6fd3701b57a0e010bd89c1987e56935d6f6056", "committedDate": "2020-09-08T07:16:43Z", "message": "KEYCLOAK-15270 Account REST API doesn't verify audience"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MTUxMzA2", "url": "https://github.com/keycloak/keycloak/pull/7400#pullrequestreview-484151306", "createdAt": "2020-09-08T13:41:03Z", "commit": {"oid": "2c6fd3701b57a0e010bd89c1987e56935d6f6056"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMzo0MTowM1rOHOdurQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMzo0MTowM1rOHOdurQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkyOTE5Nw==", "bodyText": "The hardcoded audiences have to be here to properly test permissions. Without this, the client has only \"audience resolve\" mapper which adds audience only when user has a role from given client. E.g. if we want to test that user cannot access some endpoint without some role, we need the hardcoded audience because without it the aud claim would be completely missing and the access would be denied not because of the lack of required role but because of the missing aud claim.", "url": "https://github.com/keycloak/keycloak/pull/7400#discussion_r484929197", "createdAt": "2020-09-08T13:41:03Z", "author": {"login": "vmuzikar"}, "path": "testsuite/integration-arquillian/tests/base/src/test/resources/testrealm.json", "diffHunk": "@@ -414,7 +414,77 @@\n       \"enabled\": true,\n       \"directAccessGrantsEnabled\": true,\n       \"secret\": \"password\",\n-      \"webOrigins\": [ \"http://localtest.me:8180\" ]\n+      \"webOrigins\": [ \"http://localtest.me:8180\" ],\n+      \"protocolMappers\": [\n+        {\n+          \"name\": \"aud-account\",\n+          \"protocol\": \"openid-connect\",\n+          \"protocolMapper\": \"oidc-audience-mapper\",\n+          \"config\": {\n+            \"included.client.audience\": \"account\",\n+            \"id.token.claim\": \"true\",\n+            \"access.token.claim\": \"true\"\n+          }\n+        },\n+        {\n+          \"name\": \"aud-admin\",\n+          \"protocol\": \"openid-connect\",\n+          \"protocolMapper\": \"oidc-audience-mapper\",\n+          \"config\": {\n+            \"included.client.audience\": \"security-admin-console\",\n+            \"id.token.claim\": \"true\",\n+            \"access.token.claim\": \"true\"\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c6fd3701b57a0e010bd89c1987e56935d6f6056"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Njk0MTIz", "url": "https://github.com/keycloak/keycloak/pull/7400#pullrequestreview-486694123", "createdAt": "2020-09-11T10:34:35Z", "commit": {"oid": "2c6fd3701b57a0e010bd89c1987e56935d6f6056"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2797, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}