{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MTY1MzYw", "number": 1912, "title": "Container startup issue fixed.", "bodyText": "Signed-off-by: Tomas Langer tomas.langer@oracle.com\nResolves #1446", "createdAt": "2020-06-01T19:18:21Z", "url": "https://github.com/oracle/helidon/pull/1912", "merged": true, "mergeCommit": {"oid": "348aa5a9446692632c09f9c7b14d331bdd637dd3"}, "closed": true, "closedAt": "2020-06-02T10:13:51Z", "author": {"login": "tomas-langer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnFRc9gH2gAyNDI2MTY1MzYwOmY4MTIzMDY2NTM4YzdlNWQ4NzUyZTUzMTRjMzM0YzNhYjIxNjYzZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnNgsIAFqTQyMjM0MDk3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f8123066538c7e5d8752e5314c334c3ab21663da", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/f8123066538c7e5d8752e5314c334c3ab21663da", "committedDate": "2020-06-01T19:17:43Z", "message": "Container startup issue fixed.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMTUyODQ0", "url": "https://github.com/oracle/helidon/pull/1912#pullrequestreview-422152844", "createdAt": "2020-06-01T20:20:59Z", "commit": {"oid": "f8123066538c7e5d8752e5314c334c3ab21663da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDoyMDo1OVrOGdYw4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDoyMDo1OVrOGdYw4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ2NzYxNw==", "bodyText": "This logic sets IN_PROGRESS_OR_RUNNING to false only if it was true at the start of the method. Could there be a race condition here in which an (incorrect) second attempt to start the server concurrently occurred after isRunning is assigned false (and that parallel start-up would set IN_PROGRESS_OR_RUNNING to true), the doStop actually does the shutdown, but because isRunning is not true then IN_PROGRESS_OR_RUNNING is not set to false? So the server would be stopped but IN_PROGRESS_OR_RUNNING incorrectly says true.\nMaybe this cannot happen in practice because of other reasons?", "url": "https://github.com/oracle/helidon/pull/1912#discussion_r433467617", "createdAt": "2020-06-01T20:20:59Z", "author": {"login": "tjquinno"}, "path": "microprofile/server/src/main/java/io/helidon/microprofile/server/ServerCdiExtension.java", "diffHunk": "@@ -216,6 +228,17 @@ private void registerClasspathStaticContent(Config config) {\n     }\n \n     private void stopServer(@Observes @Priority(PLATFORM_BEFORE) @BeforeDestroyed(ApplicationScoped.class) Object event) {\n+        boolean isRunning = IN_PROGRESS_OR_RUNNING.get();\n+        try {\n+            doStop(event);\n+        } finally {\n+            if (isRunning) {\n+                IN_PROGRESS_OR_RUNNING.set(false);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8123066538c7e5d8752e5314c334c3ab21663da"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25157d5bfd8940faa2762326947ca5d46b538a24", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/25157d5bfd8940faa2762326947ca5d46b538a24", "committedDate": "2020-06-01T22:59:27Z", "message": "Making the shutdown/startup checking more robust.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjQwMTEz", "url": "https://github.com/oracle/helidon/pull/1912#pullrequestreview-422240113", "createdAt": "2020-06-01T23:10:22Z", "commit": {"oid": "25157d5bfd8940faa2762326947ca5d46b538a24"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1e39f5e21e3d822d2426d5bb963c816bfebebc", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/3b1e39f5e21e3d822d2426d5bb963c816bfebebc", "committedDate": "2020-06-01T23:29:16Z", "message": "Making the shutdown/startup checking more robust 2.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMzQwOTcz", "url": "https://github.com/oracle/helidon/pull/1912#pullrequestreview-422340973", "createdAt": "2020-06-02T04:53:36Z", "commit": {"oid": "3b1e39f5e21e3d822d2426d5bb963c816bfebebc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 664, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}