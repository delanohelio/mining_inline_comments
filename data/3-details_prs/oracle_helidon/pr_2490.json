{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMzAxMjg1", "number": 2490, "title": "Methods contentLength and transferEncoding added", "bodyText": "Fixes #2209", "createdAt": "2020-10-29T14:06:17Z", "url": "https://github.com/oracle/helidon/pull/2490", "merged": true, "mergeCommit": {"oid": "3811a5bef6c3bca8810bfa8c225ae78763951d5f"}, "closed": true, "closedAt": "2020-11-11T13:08:45Z", "author": {"login": "Verdent"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZAhhAgFqTUyMjkwNjQ5OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbM-3XgFqTUyNzQ0OTk3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTA2NDk5", "url": "https://github.com/oracle/helidon/pull/2490#pullrequestreview-522906499", "createdAt": "2020-11-03T22:01:57Z", "commit": {"oid": "99144361eb093f519146204f0909514267121194"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4bb39cee506f6141b10c9bf2426caf6b210752", "author": {"user": {"login": "Verdent", "name": "David Kr\u00e1l"}}, "url": "https://github.com/oracle/helidon/commit/db4bb39cee506f6141b10c9bf2426caf6b210752", "committedDate": "2020-11-06T21:44:20Z", "message": "contentLength and transferEncoding methods added to response headers\n\nSigned-off-by: David Kral <david.k.kral@oracle.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99144361eb093f519146204f0909514267121194", "author": {"user": {"login": "Verdent", "name": "David Kr\u00e1l"}}, "url": "https://github.com/oracle/helidon/commit/99144361eb093f519146204f0909514267121194", "committedDate": "2020-10-29T14:05:24Z", "message": "Methods contentLength and transferEncoding added to the WebClientResponse\n\nSigned-off-by: David Kral <david.k.kral@oracle.com>"}, "afterCommit": {"oid": "db4bb39cee506f6141b10c9bf2426caf6b210752", "author": {"user": {"login": "Verdent", "name": "David Kr\u00e1l"}}, "url": "https://github.com/oracle/helidon/commit/db4bb39cee506f6141b10c9bf2426caf6b210752", "committedDate": "2020-11-06T21:44:20Z", "message": "contentLength and transferEncoding methods added to response headers\n\nSigned-off-by: David Kral <david.k.kral@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NDM3ODYz", "url": "https://github.com/oracle/helidon/pull/2490#pullrequestreview-526437863", "createdAt": "2020-11-09T16:36:07Z", "commit": {"oid": "db4bb39cee506f6141b10c9bf2426caf6b210752"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjozNjowOFrOHv3Ncw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjozNjowOFrOHv3Ncw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk0OTY4Mw==", "bodyText": "I think just checking for isEmpty is not sufficient. Transfer encoding can have the following values:\nTransfer-Encoding: chunked\nTransfer-Encoding: compress\nTransfer-Encoding: deflate\nTransfer-Encoding: gzip\nTransfer-Encoding: identity", "url": "https://github.com/oracle/helidon/pull/2490#discussion_r519949683", "createdAt": "2020-11-09T16:36:08Z", "author": {"login": "tomas-langer"}, "path": "webclient/webclient/src/main/java/io/helidon/webclient/NettyClientHandler.java", "diffHunk": "@@ -197,12 +197,13 @@ private boolean shouldResponseAutomaticallyClose(WebClientResponse clientRespons\n     }\n \n     private boolean noContentLength(WebClientResponseHeaders headers) {\n-        return headers.first(Http.Header.CONTENT_LENGTH).isEmpty()\n-                || headers.first(Http.Header.CONTENT_LENGTH).get().equals(\"0\");\n+        return headers.contentLength()\n+                .map(value -> value == 0)\n+                .orElse(true);\n     }\n \n     private boolean notChunked(WebClientResponseHeaders headers) {\n-        return headers.first(Http.Header.TRANSFER_ENCODING).isEmpty();\n+        return headers.transferEncoding().isEmpty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db4bb39cee506f6141b10c9bf2426caf6b210752"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d15beb7957e8acd28e12467183a79bb456795fde", "author": {"user": {"login": "Verdent", "name": "David Kr\u00e1l"}}, "url": "https://github.com/oracle/helidon/commit/d15beb7957e8acd28e12467183a79bb456795fde", "committedDate": "2020-11-10T09:16:43Z", "message": "condition updated\n\nSigned-off-by: David Kral <david.k.kral@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NDQ5OTcx", "url": "https://github.com/oracle/helidon/pull/2490#pullrequestreview-527449971", "createdAt": "2020-11-10T17:40:43Z", "commit": {"oid": "d15beb7957e8acd28e12467183a79bb456795fde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 348, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}