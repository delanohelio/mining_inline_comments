{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjMxMjE3", "number": 1568, "title": "[Reactive] Workaround for an RS 1.0.3 TCK bug", "bodyText": "Cross cancellation from an onError/onComplete method is not correctly verified by the Reactive Streams TCK. There is a patch waiting to be included but it could take an arbitrary amount of time to get it in a released form.\nIn addition, the original workaround of using the ForkJoinPool sometimes doesn't work because the FJP executes the task on the caller thread, thus triggering the TCK bug again.\nThis PR adds a workaround in the form of a configurable ExecutorService which is set to a single-threaded one for the duration of the TCK.", "createdAt": "2020-03-23T20:47:26Z", "url": "https://github.com/oracle/helidon/pull/1568", "merged": true, "mergeCommit": {"oid": "3099935543e06d6a336e0b381f2db54b3d20de83"}, "closed": true, "closedAt": "2020-03-24T08:54:48Z", "author": {"login": "akarnokd"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQkjhRgH2gAyMzkyNjMxMjE3OmFlOGRhNzE5N2NmMzAyN2JmZTFkMWUwYzExY2M4ZDIxMzUyMzM5NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQu_H1gFqTM4MDEwNDc4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae8da7197cf3027bfe1d1e0c11cc8d2135233970", "author": {"user": {"login": "akarnokd", "name": "David Karnok"}}, "url": "https://github.com/oracle/helidon/commit/ae8da7197cf3027bfe1d1e0c11cc8d2135233970", "committedDate": "2020-03-23T20:44:15Z", "message": "[Reactive] Workaround for an RS 1.0.3 TCK bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79f0020f11cb4da48f0fd8426c3849b3b0886993", "author": {"user": {"login": "akarnokd", "name": "David Karnok"}}, "url": "https://github.com/oracle/helidon/commit/79f0020f11cb4da48f0fd8426c3849b3b0886993", "committedDate": "2020-03-23T20:51:04Z", "message": "Rename the static field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b415165da6ff745683fc56a966dc38156e9a54b1", "author": {"user": {"login": "akarnokd", "name": "David Karnok"}}, "url": "https://github.com/oracle/helidon/commit/b415165da6ff745683fc56a966dc38156e9a54b1", "committedDate": "2020-03-23T22:08:19Z", "message": "Use execute()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b021656fdfb039545e4675ab36552e96fa22e7", "author": {"user": {"login": "akarnokd", "name": "David Karnok"}}, "url": "https://github.com/oracle/helidon/commit/f1b021656fdfb039545e4675ab36552e96fa22e7", "committedDate": "2020-03-23T22:58:25Z", "message": "Fix compile errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDk3MTk5", "url": "https://github.com/oracle/helidon/pull/1568#pullrequestreview-380097199", "createdAt": "2020-03-24T08:42:51Z", "commit": {"oid": "f1b021656fdfb039545e4675ab36552e96fa22e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0Mjo1MVrOF6l5sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0Mjo1MVrOF6l5sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MjcwNw==", "bodyText": "For future reference TCK fix: reactive-streams/reactive-streams-jvm#483", "url": "https://github.com/oracle/helidon/pull/1568#discussion_r396982707", "createdAt": "2020-03-24T08:42:51Z", "author": {"login": "danielkec"}, "path": "microprofile/reactive-streams/src/main/java/io/helidon/microprofile/reactive/HelidonReactiveStreamsEngine.java", "diffHunk": "@@ -526,18 +527,32 @@ static Object build(Iterable<Stage> graph, Mode mode) throws UnsupportedStageExc\n     }\n \n     static void complete(CompletableFuture<Object> cf) {\n-        ForkJoinPool.commonPool().submit(() -> {\n+        coupledExecutor.execute(() -> {\n             cf.complete(null);\n-            return null;\n         });\n     }\n \n     static void fail(CompletableFuture<Object> cf, Throwable ex) {\n-        ForkJoinPool.commonPool().submit(() -> {\n+        coupledExecutor.execute(() -> {\n             cf.completeExceptionally(ex);\n-            return null;\n         });\n     }\n+\n+    // Workaround for a TCK bug when calling cancel() from any method named onComplete().\n+    private static volatile ExecutorService coupledExecutor = ForkJoinPool.commonPool();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b021656fdfb039545e4675ab36552e96fa22e7"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTA0Nzg3", "url": "https://github.com/oracle/helidon/pull/1568#pullrequestreview-380104787", "createdAt": "2020-03-24T08:53:27Z", "commit": {"oid": "f1b021656fdfb039545e4675ab36552e96fa22e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 799, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}