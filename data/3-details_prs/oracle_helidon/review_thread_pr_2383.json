{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwOTgwNDYx", "number": 2383, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxMzoyMlrOEmfs3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyNDowOFrOEmgESA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODAwNzM1OnYy", "diffSide": "RIGHT", "path": "dbclient/dbclient/src/main/java/io/helidon/dbclient/DbClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxMzoyMlrOHWjVKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDo0NToyMVrOHWlH6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwOTU3Nw==", "bodyText": "used in database health checks", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493409577", "createdAt": "2020-09-23T10:13:22Z", "author": {"login": "tomas-langer"}, "path": "dbclient/dbclient/src/main/java/io/helidon/dbclient/DbClient.java", "diffHunk": "@@ -57,8 +57,14 @@\n      */\n     <U, T extends Subscribable<U>> T execute(Function<DbExecute, T> executor);\n \n+    /**\n+     * Name of the named statement used in database ping.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQzODk1NQ==", "bodyText": "fixed", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493438955", "createdAt": "2020-09-23T10:45:21Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/dbclient/src/main/java/io/helidon/dbclient/DbClient.java", "diffHunk": "@@ -57,8 +57,14 @@\n      */\n     <U, T extends Subscribable<U>> T execute(Function<DbExecute, T> executor);\n \n+    /**\n+     * Name of the named statement used in database ping.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwOTU3Nw=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODAzMDM2OnYy", "diffSide": "RIGHT", "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxNzozN1rOHWjkEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowNTo1NlrOHWmOGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMzM5Mw==", "bodyText": "Please do not do this, use\nLogger.FINER(() -> String.format(\"...\") or equivalent method with a lambda - it achieves the same thing without additional if statement in the code", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493413393", "createdAt": "2020-09-23T10:17:37Z", "author": {"login": "tomas-langer"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1NjkyMA==", "bodyText": "fixed", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493456920", "createdAt": "2020-09-23T11:05:56Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMzM5Mw=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODAzMTYwOnYy", "diffSide": "RIGHT", "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxNzo1NVrOHWjk1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowMjo1NFrOHWmD6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMzU5MA==", "bodyText": "LOGGER.finest instead", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493413590", "createdAt": "2020-09-23T10:17:55Z", "author": {"login": "tomas-langer"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1NDMxMw==", "bodyText": "fixed", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493454313", "createdAt": "2020-09-23T11:02:54Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMzU5MA=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODAzNjQyOnYy", "diffSide": "RIGHT", "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxODo1MFrOHWjn6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowMjo0NFrOHWmDRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNDM3Nw==", "bodyText": "Please do not put Javadoc on private fields, use either single line or multi line comment instead.", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493414377", "createdAt": "2020-09-23T10:18:50Z", "author": {"login": "tomas-langer"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");\n+        }\n+\n+        @Override\n+        protected Awaitable<Void> execPing() {\n+            return dbClient().ping();\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedDml} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedDml extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1NDE0OQ==", "bodyText": "Changed all those somments to /* ... */", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493454149", "createdAt": "2020-09-23T11:02:44Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");\n+        }\n+\n+        @Override\n+        protected Awaitable<Void> execPing() {\n+            return dbClient().ping();\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedDml} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedDml extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNDM3Nw=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODA0NTU2OnYy", "diffSide": "RIGHT", "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyMDoxOFrOHWjtsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowNDowMFrOHWmHNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNTg1OA==", "bodyText": "Maybe a multiline comment would be a better fit?", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493415858", "createdAt": "2020-09-23T10:20:18Z", "author": {"login": "tomas-langer"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");\n+        }\n+\n+        @Override\n+        protected Awaitable<Void> execPing() {\n+            return dbClient().ping();\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedDml} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedDml extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */\n+        private final String statementName;\n+\n+        private DbClientHealthCheckAsNamedDml(Builder builder) {\n+            super(builder);\n+            this.statementName = builder.statementName;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsNamedDml\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient().execute(exec -> exec.namedDml(statementName));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code dml} method.\n+     */\n+    private static final class DbClientHealthCheckAsDml extends DbClientHealthCheck {\n+\n+        /** Custom statement. */\n+        private final String statement;\n+\n+        private DbClientHealthCheckAsDml(Builder builder) {\n+            super(builder);\n+            this.statement = builder.statement;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsDml\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient().execute(exec -> exec.dml(statement));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedQuery} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedQuery extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */\n+        private final String statementName;\n+\n+        private DbClientHealthCheckAsNamedQuery(Builder builder) {\n+            super(builder);\n+            this.statementName = builder.statementName;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsNamedQuery\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient()\n+                    .execute(exec -> exec.namedQuery(statementName).forEach(it -> {}));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code query} method.\n+     */\n+    private static final class DbClientHealthCheckAsQuery extends DbClientHealthCheck {\n+\n+        /** Custom statement. */\n+        private final String statement;\n+\n+        private DbClientHealthCheckAsQuery(Builder builder) {\n+            super(builder);\n+            this.statement = builder.statement;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsQuery\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient()\n+                    .execute(exec -> exec.query(statement).forEach(it -> {}));\n+        }\n+\n+    }\n+\n     /**\n      * Fluent API builder for {@link DbClientHealthCheck}.\n+     * Default health check setup will call named DML statement with name {@code ping}.\n+     * This named DML statement shall be configured in {@code statements} section\n+     * of the DBClient configuration file.\n      */\n     public static final class Builder implements io.helidon.common.Builder<DbClientHealthCheck> {\n+\n+        /** Helidon database client. */\n         private final DbClient database;\n+        /** Health check name. */\n         private String name;\n+        /** Health check timeout in seconds (to wait for statement execution response). */\n+        private int timeoutSeconds;\n+\n+        // Those two boolean variables define 4 ways of query execution:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 201}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1NTE1OQ==", "bodyText": "timeoutSeconds was replaced with timeoutDuration/timeoutUnit and comments updated.", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493455159", "createdAt": "2020-09-23T11:04:00Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -58,39 +72,204 @@ public static Builder builder(DbClient dbClient) {\n         return new Builder(dbClient);\n     }\n \n+    /**\n+     * Execute the ping statement.\n+     *\n+     * @return {@code Awaitable} instance to wait for\n+     */\n+    protected abstract Awaitable<?> execPing();\n+\n     @Override\n     public HealthCheckResponse call() {\n-        HealthCheckResponseBuilder builder = HealthCheckResponse.builder()\n-                .name(name);\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.builder().name(name);\n \n         try {\n-            dbClient.ping().await(10, TimeUnit.SECONDS);\n+            execPing().await(timeoutSeconds, TimeUnit.SECONDS);\n             builder.up();\n         } catch (Throwable e) {\n             builder.down();\n             builder.withData(\"ErrorMessage\", e.getMessage());\n             builder.withData(\"ErrorClass\", e.getClass().getName());\n-            e.printStackTrace();\n+            // Do not process logging arguments until it makes sense.\n+            if (LOGGER.isLoggable(Level.FINER)) {\n+                LOGGER.log(Level.FINER, String.format(\n+                        \"Database %s is not responding: %s\", dbClient.dbType(), e.getMessage()), e);\n+            }\n         }\n \n         return builder.build();\n     }\n \n+    protected DbClient dbClient() {\n+        return dbClient;\n+    }\n+\n+    /**\n+     * Database health check which calls default DBClient's {@code ping} method.\n+     */\n+    private static final class DbClientHealthCheckAsPing extends DbClientHealthCheck {\n+\n+        private DbClientHealthCheckAsPing(Builder builder) {\n+            super(builder);\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsPing\");\n+        }\n+\n+        @Override\n+        protected Awaitable<Void> execPing() {\n+            return dbClient().ping();\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedDml} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedDml extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */\n+        private final String statementName;\n+\n+        private DbClientHealthCheckAsNamedDml(Builder builder) {\n+            super(builder);\n+            this.statementName = builder.statementName;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsNamedDml\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient().execute(exec -> exec.namedDml(statementName));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code dml} method.\n+     */\n+    private static final class DbClientHealthCheckAsDml extends DbClientHealthCheck {\n+\n+        /** Custom statement. */\n+        private final String statement;\n+\n+        private DbClientHealthCheckAsDml(Builder builder) {\n+            super(builder);\n+            this.statement = builder.statement;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsDml\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient().execute(exec -> exec.dml(statement));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code namedQuery} method.\n+     */\n+    private static final class DbClientHealthCheckAsNamedQuery extends DbClientHealthCheck {\n+\n+        /** Name of the statement. */\n+        private final String statementName;\n+\n+        private DbClientHealthCheckAsNamedQuery(Builder builder) {\n+            super(builder);\n+            this.statementName = builder.statementName;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsNamedQuery\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient()\n+                    .execute(exec -> exec.namedQuery(statementName).forEach(it -> {}));\n+        }\n+\n+    }\n+\n+    /**\n+     * Database health check which calls DBClient's {@code query} method.\n+     */\n+    private static final class DbClientHealthCheckAsQuery extends DbClientHealthCheck {\n+\n+        /** Custom statement. */\n+        private final String statement;\n+\n+        private DbClientHealthCheckAsQuery(Builder builder) {\n+            super(builder);\n+            this.statement = builder.statement;\n+            LOGGER.log(Level.FINEST, \"Created an instance of DbClientHealthCheckAsQuery\");\n+        }\n+\n+        @Override\n+        protected Awaitable<?> execPing() {\n+            return dbClient()\n+                    .execute(exec -> exec.query(statement).forEach(it -> {}));\n+        }\n+\n+    }\n+\n     /**\n      * Fluent API builder for {@link DbClientHealthCheck}.\n+     * Default health check setup will call named DML statement with name {@code ping}.\n+     * This named DML statement shall be configured in {@code statements} section\n+     * of the DBClient configuration file.\n      */\n     public static final class Builder implements io.helidon.common.Builder<DbClientHealthCheck> {\n+\n+        /** Helidon database client. */\n         private final DbClient database;\n+        /** Health check name. */\n         private String name;\n+        /** Health check timeout in seconds (to wait for statement execution response). */\n+        private int timeoutSeconds;\n+\n+        // Those two boolean variables define 4 ways of query execution:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNTg1OA=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 201}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODA2MjA4OnYy", "diffSide": "RIGHT", "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyMzoxM1rOHWj4Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowNDo0OFrOHWmKBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxODUxOQ==", "bodyText": "When configuring timeout in code, please use\ntimeout(long duration, TimeUnit timeUnit)\nor you need to name the method to be clear (e.g. timeoutSeconds) - in this case I would prefer the first one\nIf there is support for it in config, the configurable value must be timeout-seconds or timeout-millis and the code that converts it calls the method with TimeUnit)", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493418519", "createdAt": "2020-09-23T10:23:13Z", "author": {"login": "tomas-langer"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -104,6 +283,64 @@ public Builder name(String name) {\n             this.name = name;\n             return this;\n         }\n+\n+        /**\n+         * Set health check statement type to query.\n+         * Default health check statement type is DML.\n+         *\n+         * @return updated builder instance\n+         */\n+        public Builder query() {\n+            this.isDML = false;\n+            this.isNamedstatement = true;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom statement name.\n+         * Default statement name value is {@code ping}.\n+         *\n+         * @param name custom statement name.\n+         * @return updated builder instance\n+         */\n+        public Builder statementName(String name) {\n+            if (statement != null) {\n+                throw new UnsupportedOperationException(\n+                        \"Can't use both statementName and statement methods in a single builder instance!\");\n+            }\n+            this.isNamedstatement = true;\n+            this.statementName = name;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom statement.\n+         *\n+         * @param statement custom statement name.\n+         * @return updated builder instance\n+         */\n+        public Builder statement(String statement) {\n+            if (statementName != null) {\n+                throw new UnsupportedOperationException(\n+                        \"Can't use both statementName and statement methods in a single builder instance!\");\n+            }\n+            this.isNamedstatement = false;\n+            this.statement = statement;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom timeout to wait for statement execution response.\n+         * Default value is {@code 10} seconds.\n+         *\n+         * @param seconds number of seconds to wait for statement execution response\n+         * @return updated builder instance\n+         */\n+        public Builder timeout(int seconds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 310}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1NTg3Ng==", "bodyText": "changed to public Builder timeout(long duration, TimeUnit timeUnit).", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493455876", "createdAt": "2020-09-23T11:04:48Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/health/src/main/java/io/helidon/dbclient/health/DbClientHealthCheck.java", "diffHunk": "@@ -104,6 +283,64 @@ public Builder name(String name) {\n             this.name = name;\n             return this;\n         }\n+\n+        /**\n+         * Set health check statement type to query.\n+         * Default health check statement type is DML.\n+         *\n+         * @return updated builder instance\n+         */\n+        public Builder query() {\n+            this.isDML = false;\n+            this.isNamedstatement = true;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom statement name.\n+         * Default statement name value is {@code ping}.\n+         *\n+         * @param name custom statement name.\n+         * @return updated builder instance\n+         */\n+        public Builder statementName(String name) {\n+            if (statement != null) {\n+                throw new UnsupportedOperationException(\n+                        \"Can't use both statementName and statement methods in a single builder instance!\");\n+            }\n+            this.isNamedstatement = true;\n+            this.statementName = name;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom statement.\n+         *\n+         * @param statement custom statement name.\n+         * @return updated builder instance\n+         */\n+        public Builder statement(String statement) {\n+            if (statementName != null) {\n+                throw new UnsupportedOperationException(\n+                        \"Can't use both statementName and statement methods in a single builder instance!\");\n+            }\n+            this.isNamedstatement = false;\n+            this.statement = statement;\n+            return this;\n+        }\n+\n+        /**\n+         * Set custom timeout to wait for statement execution response.\n+         * Default value is {@code 10} seconds.\n+         *\n+         * @param seconds number of seconds to wait for statement execution response\n+         * @return updated builder instance\n+         */\n+        public Builder timeout(int seconds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxODUxOQ=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 310}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODA2NzI4OnYy", "diffSide": "RIGHT", "path": "dbclient/jdbc/src/main/java/io/helidon/dbclient/jdbc/JdbcDbClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyNDowOFrOHWj7kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTowNzo1NlrOHWmU7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxOTQxMA==", "bodyText": "This method should probably be deprecated, as the health check may be either DML or Query.", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493419410", "createdAt": "2020-09-23T10:24:08Z", "author": {"login": "tomas-langer"}, "path": "dbclient/jdbc/src/main/java/io/helidon/dbclient/jdbc/JdbcDbClient.java", "diffHunk": "@@ -209,7 +209,7 @@ public T apply(Throwable t) {\n \n     @Override\n     public Single<Void> ping() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ1ODY2OA==", "bodyText": "Yes, this ping looks like some workaround or shortcut. User should use health check buillder/API to call proper statement.", "url": "https://github.com/oracle/helidon/pull/2383#discussion_r493458668", "createdAt": "2020-09-23T11:07:56Z", "author": {"login": "Tomas-Kraus"}, "path": "dbclient/jdbc/src/main/java/io/helidon/dbclient/jdbc/JdbcDbClient.java", "diffHunk": "@@ -209,7 +209,7 @@ public T apply(Throwable t) {\n \n     @Override\n     public Single<Void> ping() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxOTQxMA=="}, "originalCommit": {"oid": "d50bd7645b5f1621309a355ab4869cab85126a9d"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 422, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}