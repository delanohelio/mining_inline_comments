{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Njc2OTI1", "number": 1924, "title": "ReadableByteChannelPublisher executor leak", "bodyText": "And related fixes.\nResolves #1835", "createdAt": "2020-06-02T15:52:12Z", "url": "https://github.com/oracle/helidon/pull/1924", "merged": true, "mergeCommit": {"oid": "afd3920ecb334c1d91d94b010bc2759977e04bcc"}, "closed": true, "closedAt": "2020-06-05T08:52:05Z", "author": {"login": "tomas-langer"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnjEuZAFqTQyMzIzOTY4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoAS6xgFqTQyNDYwNDA4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjM5Njgy", "url": "https://github.com/oracle/helidon/pull/1924#pullrequestreview-423239682", "createdAt": "2020-06-03T06:00:58Z", "commit": {"oid": "da71ba3e5af35e6f07e62a638fe1c61626ba1175"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb703c0b21bc4f2c13a1865919996479e12090e", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/1fb703c0b21bc4f2c13a1865919996479e12090e", "committedDate": "2020-06-04T08:46:19Z", "message": "LazyValue now has a method to check if it was loaded and has an optimized constructor when pre-loaded.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "825812c0b283dda20b5382a191a68762eb6e891e", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/825812c0b283dda20b5382a191a68762eb6e891e", "committedDate": "2020-06-04T08:46:19Z", "message": "ReadableByteChannelPublisher now correctly closes executor.\nUsing a builder and static factory methods\nDeprecated public constructor\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "242bb9174f1c5daf761846a265f0d597f3455649", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/242bb9174f1c5daf761846a265f0d597f3455649", "committedDate": "2020-06-04T08:46:19Z", "message": "Checkstyle fix.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e79c7fbde6a9c206625b00310d18b192f3448134", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/e79c7fbde6a9c206625b00310d18b192f3448134", "committedDate": "2020-06-04T08:46:47Z", "message": "Copyright fix.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245c061fa7782f840b34b397923447ebdc452e83", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/245c061fa7782f840b34b397923447ebdc452e83", "committedDate": "2020-06-04T08:46:47Z", "message": "Remove usage of deprecated constructor.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "979daedf536ed0f421e5d900f11e1e6fc6519f3b", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/979daedf536ed0f421e5d900f11e1e6fc6519f3b", "committedDate": "2020-06-04T08:46:47Z", "message": "Tmp\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e348aba2df302cd6526aa11c3cad46ed03fa3987", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/e348aba2df302cd6526aa11c3cad46ed03fa3987", "committedDate": "2020-06-04T08:46:47Z", "message": "- Byte channel publisher now part of IoMulti\n- renamed methods in IoMulti\n- RetrySchema now sent around only when customized\n- Deprecated old methods and classes\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c07d02541ec75301e4794893643a06787e98ad1", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/8c07d02541ec75301e4794893643a06787e98ad1", "committedDate": "2020-06-04T08:46:47Z", "message": "Private constructor in Builder.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d7872b3cd3b9f8a066df95116ca98237f543b90", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/5d7872b3cd3b9f8a066df95116ca98237f543b90", "committedDate": "2020-06-04T08:46:47Z", "message": "Renamed class to align builder, method and class name.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5352f00262a5f3f6fc7b11f21af128d2411706a", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/e5352f00262a5f3f6fc7b11f21af128d2411706a", "committedDate": "2020-06-03T13:47:58Z", "message": "Renamed class to align builder, method and class name.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}, "afterCommit": {"oid": "5d7872b3cd3b9f8a066df95116ca98237f543b90", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/5d7872b3cd3b9f8a066df95116ca98237f543b90", "committedDate": "2020-06-04T08:46:47Z", "message": "Renamed class to align builder, method and class name.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eab338a10d04769011748708649cb82a683dc5a", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/2eab338a10d04769011748708649cb82a683dc5a", "committedDate": "2020-06-04T11:24:15Z", "message": "Reverting to public.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459f5956cf5ce789da7d1deeeab1dc51f2beb6a4", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/459f5956cf5ce789da7d1deeeab1dc51f2beb6a4", "committedDate": "2020-06-04T12:38:07Z", "message": "Added test for MultiFromByteChannel.\nFixed compilation issue caused by refactoring.\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTQ5MDY5", "url": "https://github.com/oracle/helidon/pull/1924#pullrequestreview-424549069", "createdAt": "2020-06-04T15:08:47Z", "commit": {"oid": "459f5956cf5ce789da7d1deeeab1dc51f2beb6a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTowODo0N1rOGfKoPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTowODo0N1rOGfKoPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMzMzE4MQ==", "bodyText": "{@link ReadableByteChannel}", "url": "https://github.com/oracle/helidon/pull/1924#discussion_r435333181", "createdAt": "2020-06-04T15:08:47Z", "author": {"login": "danielkec"}, "path": "common/reactive/src/main/java/io/helidon/common/reactive/IoMulti.java", "diffHunk": "@@ -67,23 +103,175 @@ static OutputStreamMultiBuilder builderOutputStream() {\n      * @param inputStream the Stream to publish\n      * @return Multi\n      * @throws NullPointerException if {@code stream} is {@code null}\n+     * @deprecated please use {@link #multiFromStream(java.io.InputStream)}\n      */\n+    @Deprecated(since = \"2.0.0\", forRemoval = true)\n     static Multi<ByteBuffer> createInputStream(final InputStream inputStream) {\n         return IoMulti.builderInputStream(inputStream)\n                 .build();\n     }\n \n+    /**\n+     * Create a {@link Multi} instance that publishes {@link ByteBuffer}s from\n+     * the given {@link InputStream}.\n+     * <p>\n+     * {@link InputStream} is trusted not to block on read operations, in case\n+     * it can't be assured use builder to specify executor for asynchronous waiting\n+     * for blocking reads. {@code IoMulti.builder(is).executor(executorService).build()}.\n+     *\n+     * @param inputStream the Stream to publish\n+     * @return Multi\n+     */\n+    static Multi<ByteBuffer> multiFromStream(final InputStream inputStream) {\n+        return IoMulti.builderInputStream(inputStream)\n+                .build();\n+    }\n+\n     /**\n      * Creates a builder of the {@link Multi} from supplied {@link java.io.InputStream}.\n      *\n      * @param inputStream the Stream to publish\n      * @return the builder\n+     * @deprecated Please use {@link #multiFromStreamBuilder(java.io.InputStream)}\n      */\n+    @Deprecated(since = \"2.0.0\", forRemoval = true)\n     static MultiFromInputStreamBuilder builderInputStream(final InputStream inputStream) {\n         Objects.requireNonNull(inputStream);\n         return new MultiFromInputStreamBuilder(inputStream);\n     }\n \n+    /**\n+     * Creates a builder of the {@link Multi} from supplied {@link java.io.InputStream}.\n+     *\n+     * @param inputStream the Stream to publish\n+     * @return the builder\n+     */\n+    static MultiFromInputStreamBuilder multiFromStreamBuilder(final InputStream inputStream) {\n+        Objects.requireNonNull(inputStream);\n+        return new MultiFromInputStreamBuilder(inputStream);\n+    }\n+\n+    /**\n+     * Creates a multi that reads data from the provided byte channel.\n+     * The multi uses an executor service to process asynchronous reads.\n+     * You can provide a custom executor service using\n+     * {@link #multiFromByteChannelBuilder(java.nio.channels.ReadableByteChannel)}.\n+     *\n+     * @param byteChannel readable byte channel with data\n+     * @return publisher of data from the provided channel\n+     */\n+    static Multi<ByteBuffer> multiFromByteChannel(ReadableByteChannel byteChannel) {\n+        return multiFromByteChannelBuilder(byteChannel).build();\n+    }\n+\n+    /**\n+     * Creates a builder of {@link Multi} from provided {@link java.nio.channels.ReadableByteChannel}.\n+     *\n+     * @param byteChannel readable byte channel with data\n+     * @return fluent API builder to configure additional details\n+     */\n+    static MultiFromByteChannelBuilder multiFromByteChannelBuilder(ReadableByteChannel byteChannel) {\n+        return new MultiFromByteChannelBuilder(Objects.requireNonNull(byteChannel));\n+    }\n+\n+    /**\n+     * Fluent API builder for creating a {@link io.helidon.common.reactive.Multi} from an\n+     * {@link java.io.InputStream}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "459f5956cf5ce789da7d1deeeab1dc51f2beb6a4"}, "originalPosition": 162}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTU1NTEz", "url": "https://github.com/oracle/helidon/pull/1924#pullrequestreview-424555513", "createdAt": "2020-06-04T15:15:29Z", "commit": {"oid": "459f5956cf5ce789da7d1deeeab1dc51f2beb6a4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55eadc5650288fbed765d4c97b5c8506655183fb", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/55eadc5650288fbed765d4c97b5c8506655183fb", "committedDate": "2020-06-04T15:57:10Z", "message": "Javadoc fix\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjA0MDg1", "url": "https://github.com/oracle/helidon/pull/1924#pullrequestreview-424604085", "createdAt": "2020-06-04T16:03:43Z", "commit": {"oid": "55eadc5650288fbed765d4c97b5c8506655183fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 676, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}