{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MzUzMDQy", "number": 2245, "title": "Add support for MP Metrics 2.3", "bodyText": "Resolves #2140\nREST.request overview\nQuite a few of the changes below support the REST.request optional feature, in which each JAX-RS endpoint is automatically measured by a distinct SimpleTimer metric. Here's the overview of how that's implemented:\n\nThe CDI extension adds a \"synthetic\" annotation (used only internally) to each JAX-RS endpoint.\nThe extension also registers the correct SimpleTimer metric for each endpoint.\nAt invocation-time the interceptor looks up the appropriate SimpleTimer instance and uses it to measure the work done in the intercepted method.\n\nSummary of changes by module\nmetrics/metrics\nAdd HelidonSimpleTimer impl of new SimpleTimer metric\nUpdate Registry with SimpleTimer-related methods\nNew tests for SimpleTimer\nmicroprofile/metrics\nAdd infrastructure for @SimplyTimed in various classes\nAdd internal @SyntheticSimplyTimed; marker interface so CDI will trigger interception.\nAdd interceptor for above that looks up or creates the matching SimpleTimer to update.\nUpdate CDI extension:\n\nTell CDI about the synthetic annotation and its interceptor. (This allows the normal CDI mechanisms to take care of setting up the interceptor where needed.)\nDynamically add synthetic @SyntheticSimplyTimed to each JAX-RS endpoint method so CDI will automatically invoke the corresponding interceptor.\nRecord (during @ProcessAnnotatedType) and then register (during @AfterDeploymentValidation) the SimpleTimer metrics for each method with @SyntheticSimplyTimed\n\nAdd tests\ntck/tck-metrics\nAdd dependency to include optional tests\nBecause MP metrics 2.3.2 uses non-standard constructs, add an ArrayParamConverter and its provider to CDI\nAdd CDI extension to register the converter provider\nAdd UrlResourceProvider as in several other TCK projects; TCK fetches deployment URI\nexamples/archetypes\nAdd config setting enabling REST.request behavior in MP quickstart example and archetype.\nAdd explicit config setting to disable REST.request in other examples as a reminder that the feature is there without turning it on.\ndocs\nMP metrics guide\nUpdate example output because REST.request metrics now appear\nAdd brief section describing config control of the feature\nAdd brief discussion of SimpleTimer and @SimplyTimed\nSE metrics guide\nAdd brief discussion of SimpleTimer", "createdAt": "2020-08-11T21:01:15Z", "url": "https://github.com/oracle/helidon/pull/2245", "merged": true, "mergeCommit": {"oid": "a554d67a5781187f25840b6e7ef3e54c995d8875"}, "closed": true, "closedAt": "2020-08-12T20:50:35Z", "author": {"login": "tjquinno"}, "timelineItems": {"totalCount": 57, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczA05kAH2gAyNDY2MzUzMDQyOmIzN2JjNGE4YmI5MDA4MGQxM2QxODBjMTUyOTI0MzNhZjk0MzZmN2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-RvbxgFqTQ2NjI2NjU0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b37bc4a8bb90080d13d180c15292433af9436f7e", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/b37bc4a8bb90080d13d180c15292433af9436f7e", "committedDate": "2020-07-08T20:54:00Z", "message": "First impl of and tests for HelidonSimpleTimer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9c4a1a701093d5ee3ca102afbed17a17b1b9490", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/d9c4a1a701093d5ee3ca102afbed17a17b1b9490", "committedDate": "2020-07-09T23:19:02Z", "message": "MP changes for metrics 2.3.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac7f14a541f05c2449e72bec1d18d342ba265cdc", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/ac7f14a541f05c2449e72bec1d18d342ba265cdc", "committedDate": "2020-07-10T15:21:40Z", "message": "Fix incorrect JSON keys; add a few missing additions of new simple timer to data structures\n\nSigned-off-by: tim.quinn@oracle.com <tim.quinn@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae1f734b760c1f93125c6776b732b24e9508b2a0", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/ae1f734b760c1f93125c6776b732b24e9508b2a0", "committedDate": "2020-07-10T20:35:12Z", "message": "Slight changes to fix omissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de43855921409eeca2a6e6c089108f63105901a8", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/de43855921409eeca2a6e6c089108f63105901a8", "committedDate": "2020-07-17T15:35:37Z", "message": "Remove FinalRegistry and its use for the base registry; part of moving to MP metrics 2.3\n\nSigned-off-by: tim.quinn@oracle.com <tim.quinn@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b1d387f8eaeb64d4638df0cf2b33cf00e7d58a3", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/5b1d387f8eaeb64d4638df0cf2b33cf00e7d58a3", "committedDate": "2020-07-17T16:10:40Z", "message": "First impl of and tests for HelidonSimpleTimer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa18e73783b95ce8a24061adce58afd77c90c24", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/cfa18e73783b95ce8a24061adce58afd77c90c24", "committedDate": "2020-07-17T16:10:40Z", "message": "MP changes for metrics 2.3.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d0e593706d8812ccc8c37e1b5092eb5b87053a6", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/8d0e593706d8812ccc8c37e1b5092eb5b87053a6", "committedDate": "2020-07-17T16:10:41Z", "message": "Fix incorrect JSON keys; add a few missing additions of new simple timer to data structures\n\nSigned-off-by: tim.quinn@oracle.com <tim.quinn@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2297a0711b2d1763699fe68de89d4aa8532463f1", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/2297a0711b2d1763699fe68de89d4aa8532463f1", "committedDate": "2020-07-17T16:10:41Z", "message": "Slight changes to fix omissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9cb71ed6d88be14897a9f1ebcf0e2264033207", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/db9cb71ed6d88be14897a9f1ebcf0e2264033207", "committedDate": "2020-07-17T16:11:04Z", "message": "Merge branch 'metrics-2.3' of github.com:tjquinno/helidon into metrics-2.3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ce3b8e845d2c08193f28525ed7415741ba9546", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/01ce3b8e845d2c08193f28525ed7415741ba9546", "committedDate": "2020-07-18T22:15:00Z", "message": "Work-in-progress for triggering interceptor behavior for synthetically-annotated methods; not yet working"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c5f7feb9975708aab74643f496b688e5a4f3c0a", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/2c5f7feb9975708aab74643f496b688e5a4f3c0a", "committedDate": "2020-07-21T19:06:33Z", "message": "Concurrent changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "108f9aa275f4772430abcf544cb8095fe526259c", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/108f9aa275f4772430abcf544cb8095fe526259c", "committedDate": "2020-07-24T19:51:20Z", "message": "Changes to implement REST.request inferred metric on JAX-RS endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d82e90e9b4064e1ded4d36442cdb4e440e6d5286", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/d82e90e9b4064e1ded4d36442cdb4e440e6d5286", "committedDate": "2020-07-26T20:37:53Z", "message": "Simplify logic for creating and updating synthetic REST.request SimpleTimer metric for each JAX-RS method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86bff51d390d78d4070f8215184da33bdb9ce49f", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/86bff51d390d78d4070f8215184da33bdb9ce49f", "committedDate": "2020-07-27T04:03:04Z", "message": "Fix synthetic simple metric name to include parameter types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b09aafeab060b9a2c2661ef0b3a1d6aab76fd7d2", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/b09aafeab060b9a2c2661ef0b3a1d6aab76fd7d2", "committedDate": "2020-07-27T22:17:53Z", "message": "Clarify synthetic, dynamically-added annotation added to JAX-RS endpoints to trigger REST.request SimpleTimer updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23ff3016eb540eaf89f5a72272e7b222070a2b68", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/23ff3016eb540eaf89f5a72272e7b222070a2b68", "committedDate": "2020-07-28T14:38:55Z", "message": "A few improvements and comment changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2026a82cfd1c0e6a4a4a78047ff73646397fa79", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/f2026a82cfd1c0e6a4a4a78047ff73646397fa79", "committedDate": "2020-07-29T01:20:30Z", "message": "Add config control over synthetic SimplyTimed annos on JAX-RS endpoints; defaults to false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a08d9c3ca2afd0ca95064e5a8182a8a7a992a6c8", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/a08d9c3ca2afd0ca95064e5a8182a8a7a992a6c8", "committedDate": "2020-07-29T02:37:06Z", "message": "Some clean-up\n\nSigned-off-by: tim.quinn@oracle.com <tim.quinn@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c8af5df730c815ad6c0697763a8481498c7884a", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/1c8af5df730c815ad6c0697763a8481498c7884a", "committedDate": "2020-07-29T21:04:14Z", "message": "Update the TCK pom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af2430c2cc8fe9d9507638578ef6514498a1579", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/1af2430c2cc8fe9d9507638578ef6514498a1579", "committedDate": "2020-07-29T21:05:48Z", "message": "Slight revision in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cabd20226410c7dfe4142ed031a5e36b81612281", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/cabd20226410c7dfe4142ed031a5e36b81612281", "committedDate": "2020-08-05T15:40:00Z", "message": "Concurrent changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "340b642c5eb0ddc4b81b3cc703d9033c381c3cc0", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/340b642c5eb0ddc4b81b3cc703d9033c381c3cc0", "committedDate": "2020-08-06T20:26:12Z", "message": "Add non-public method to retrieve MetricID/HelidonMetric pairs given a name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14c2c3c83e3c3a62c4a45d9792a6c12a053b23c1", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/14c2c3c83e3c3a62c4a45d9792a6c12a053b23c1", "committedDate": "2020-08-06T20:27:27Z", "message": "Make sure TYPE is emitted to Prometheus/OpenMetrics output only when requested"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d79fc7b6e410b90c4598e869db3672dcec29b308", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/d79fc7b6e410b90c4598e869db3672dcec29b308", "committedDate": "2020-08-06T20:28:28Z", "message": "Fix behavior of /metrics/registryName/metricName to report all matching metrics\n\nSigned-off-by: tim.quinn@oracle.com <tim.quinn@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cc67062b4168f3fcabc5377f1e5e88b92773dab", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/5cc67062b4168f3fcabc5377f1e5e88b92773dab", "committedDate": "2020-08-07T19:22:57Z", "message": "Significant further steps in passing the 2.3 TCK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de312fd47c9612aeee0751c1d55d04d9a42b4783", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/de312fd47c9612aeee0751c1d55d04d9a42b4783", "committedDate": "2020-08-07T19:27:11Z", "message": "Undo temp change in module-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3901384030fc18c321baed4e47a1bf11e578e2d1", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/3901384030fc18c321baed4e47a1bf11e578e2d1", "committedDate": "2020-08-07T19:29:07Z", "message": "Restore earlier blank in module-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ff8bc8c18ff19f790e5c47f753a6ddcfd3fb46", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/54ff8bc8c18ff19f790e5c47f753a6ddcfd3fb46", "committedDate": "2020-08-07T20:01:06Z", "message": "Concurrent changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25af2c9932de7f01c06aa3cec74d5f9f2f533437", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/25af2c9932de7f01c06aa3cec74d5f9f2f533437", "committedDate": "2020-08-07T22:53:10Z", "message": "Move custom param converter and related logic from microprofile/metrics to microprofile/tests/tck/tck-metrics so it cannot even accidentally be used by developers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c1ab43818e7414357784a560f6c8b4fc160656", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/46c1ab43818e7414357784a560f6c8b4fc160656", "committedDate": "2020-08-10T23:25:04Z", "message": "Expose a way to retrieve the current Helidon flavor from features"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "043dcb9b11b1bf9b51570ac3ba955405e7957a1d", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/043dcb9b11b1bf9b51570ac3ba955405e7957a1d", "committedDate": "2020-08-10T23:32:45Z", "message": "Add support for optional MP REST.request metrics from SE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ab874f5f6f70e1d37762f4a529ffc30327b5c96", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/8ab874f5f6f70e1d37762f4a529ffc30327b5c96", "committedDate": "2020-08-10T23:34:49Z", "message": "Change config key used for controlling REST.request feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea9e8ce468c2ec0989a1163e7d0026df2b9ff81d", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/ea9e8ce468c2ec0989a1163e7d0026df2b9ff81d", "committedDate": "2020-08-10T23:35:39Z", "message": "Reflect change in config key controlling REST.request behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e3f9e2981abf7bf4d501d700942c5709468239a", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/4e3f9e2981abf7bf4d501d700942c5709468239a", "committedDate": "2020-08-10T23:36:25Z", "message": "Update QuickStart examples for REST.request support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22e2f49b9fa140b2ddc6f9edffaf4a6867e333e6", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/22e2f49b9fa140b2ddc6f9edffaf4a6867e333e6", "committedDate": "2020-08-10T23:57:36Z", "message": "Fix typo in comments about which registry REST.request metrics appear in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "991884611213243ef8114d2491a2b4cd3bd2c7ad", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/991884611213243ef8114d2491a2b4cd3bd2c7ad", "committedDate": "2020-08-10T23:58:06Z", "message": "Enable REST.request metrics in hello-world implicit and explicit examples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2ea732e73032cd01a987c4414e259016b6fa5fb", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/e2ea732e73032cd01a987c4414e259016b6fa5fb", "committedDate": "2020-08-11T16:41:16Z", "message": "Update doc pages to reflect SimpleTimer and, for MP, SimplyTimed and REST.request metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f7c56ffdd84cfafc4f74e249188316e1b5c3ce", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/b7f7c56ffdd84cfafc4f74e249188316e1b5c3ce", "committedDate": "2020-08-11T16:44:05Z", "message": "Turn on REST.request support in MP quickstart archetype; remove SE quickstart uses of REST.request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05b1916be7c080f321673f9573d21de451b21889", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/05b1916be7c080f321673f9573d21de451b21889", "committedDate": "2020-08-11T16:52:36Z", "message": "Remove changes supporting SE implementation of REST.request convenience methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f9039ee5891cb338eab512cd10cc7a4cdba129", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/e5f9039ee5891cb338eab512cd10cc7a4cdba129", "committedDate": "2020-08-11T16:54:24Z", "message": "Resolve deployment URI for Arquillian in optional TCK tests for REST.request tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6247ab017ba89c9bdb654dbe1d8d6b816731e9e0", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/6247ab017ba89c9bdb654dbe1d8d6b816731e9e0", "committedDate": "2020-08-11T17:18:04Z", "message": "Fix incorrect change to HelidonFeatures; meant to remove the new method returning the current flavor but instead removed the method that sets the flavor -- which is essential"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c527abaedbeddc793c914bab88bc337a80990d9", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/5c527abaedbeddc793c914bab88bc337a80990d9", "committedDate": "2020-08-11T17:27:47Z", "message": "Remove now-unused setting for SE REST.request enable setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ac7790b69c0c7d8eecf0ff9cc8ce2e854cf6384", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/3ac7790b69c0c7d8eecf0ff9cc8ce2e854cf6384", "committedDate": "2020-08-11T17:32:32Z", "message": "Restore accidentally-removed exclusion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58a19d6607160dee4be2fac1f5223a3ccbcded40", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/58a19d6607160dee4be2fac1f5223a3ccbcded40", "committedDate": "2020-08-11T18:04:41Z", "message": "Fix typo in earlier correction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc4dc099ac04eba9aaf0340742ed16d948c95859", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/fc4dc099ac04eba9aaf0340742ed16d948c95859", "committedDate": "2020-08-11T18:12:21Z", "message": "Explicitly disable REST.request support in MP examples and the MP bare archetype to emphasize that the feature is there without turning it on."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "433d336d8a5a131200adb13fa755be60e8e1535c", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/433d336d8a5a131200adb13fa755be60e8e1535c", "committedDate": "2020-08-11T18:56:22Z", "message": "Some clean-up: remove unused code, etc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd8b365c1398a10a6abac898a4d6d6cdf3083897", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/dd8b365c1398a10a6abac898a4d6d6cdf3083897", "committedDate": "2020-08-11T19:35:00Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b08e3f8227db2f6679bbc4e0be54961aa7d4232", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/5b08e3f8227db2f6679bbc4e0be54961aa7d4232", "committedDate": "2020-08-11T20:18:16Z", "message": "Fix typo in name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a32e1613fc1aba008ff211686b09d9e0bc7a648", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/2a32e1613fc1aba008ff211686b09d9e0bc7a648", "committedDate": "2020-08-11T21:42:04Z", "message": "Fix missing blank line at end of file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c2db843037dffc8261e2c8f20bbc888ed794161", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/6c2db843037dffc8261e2c8f20bbc888ed794161", "committedDate": "2020-08-11T21:50:30Z", "message": "Fix copyright errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NDM0Mzgx", "url": "https://github.com/oracle/helidon/pull/2245#pullrequestreview-465434381", "createdAt": "2020-08-11T21:15:32Z", "commit": {"oid": "5b08e3f8227db2f6679bbc4e0be54961aa7d4232"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMToxNTozMlrOG_JgUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMTo1MjoxMVrOG_KgkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2OTIwMA==", "bodyText": "Maybe a link here?", "url": "https://github.com/oracle/helidon/pull/2245#discussion_r468869200", "createdAt": "2020-08-11T21:15:32Z", "author": {"login": "ljnelson"}, "path": "docs/mp/guides/05_metrics.adoc", "diffHunk": "@@ -166,6 +184,19 @@ curl -H \"Accept: application/json\"  http://localhost:8080/metrics/vendor/grpc.re\n \n NOTE: You cannot get the individual fields of a metric. For example, you cannot target http://localhost:8080/metrics/vendor/grpc.requests.meter.count.\n \n+==== Controlling `REST.request` metrics\n+Helidon implements the optional family of metrics, all with the name `REST.request`, as described in the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b08e3f8227db2f6679bbc4e0be54961aa7d4232"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg3MTA2NA==", "bodyText": "Dim recollection here that this is quite expensive to invoke with every call; I seem to recall some other class that can be cached statically to give you a new builder.", "url": "https://github.com/oracle/helidon/pull/2245#discussion_r468871064", "createdAt": "2020-08-11T21:19:29Z", "author": {"login": "ljnelson"}, "path": "metrics/metrics/src/main/java/io/helidon/metrics/HelidonSimpleTimer.java", "diffHunk": "@@ -0,0 +1,257 @@\n+/*\n+ * Copyright (c) 2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+package io.helidon.metrics;\n+\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import javax.json.JsonObjectBuilder;\n+\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Metadata;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricType;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+\n+/**\n+ * Implementation of {@link SimpleTimer}.\n+ */\n+final class HelidonSimpleTimer extends MetricImpl implements SimpleTimer {\n+    private final SimpleTimer delegate;\n+\n+    private HelidonSimpleTimer(String type, Metadata metadata, SimpleTimer delegate) {\n+        super(type, metadata);\n+        this.delegate = delegate;\n+    }\n+\n+    static HelidonSimpleTimer create(String repoType, Metadata metadata) {\n+        return create(repoType, metadata, Clock.system());\n+    }\n+\n+    static HelidonSimpleTimer create(String repoType, Metadata metadata, Clock clock) {\n+        return create(repoType, metadata, new SimpleTimerImpl(repoType, metadata.getName(), clock));\n+    }\n+\n+    static HelidonSimpleTimer create(String repoType, Metadata metadata, SimpleTimer metric) {\n+        return new HelidonSimpleTimer(repoType, metadata, metric);\n+    }\n+\n+    @Override\n+    public void update(Duration duration) {\n+        delegate.update(duration);\n+    }\n+\n+    @Override\n+    public <T> T time(Callable<T> event) throws Exception {\n+        return delegate.time(event);\n+    }\n+\n+    @Override\n+    public void time(Runnable event) {\n+        delegate.time(event);\n+    }\n+\n+    @Override\n+    public Context time() {\n+        return delegate.time();\n+    }\n+\n+    @Override\n+    public long getCount() {\n+        return delegate.getCount();\n+    }\n+\n+    @Override\n+    public Duration getElapsedTime() {\n+        return delegate.getElapsedTime();\n+    }\n+\n+    @Override\n+    public void prometheusData(StringBuilder sb, MetricID metricID, boolean withHelpType) {\n+        String promName;\n+        String name = metricID.getName();\n+        String tags = prometheusTags(metricID.getTags());\n+        promName = prometheusName(name) + \"_total\";\n+        if (withHelpType) {\n+            prometheusType(sb, promName, \"counter\");\n+            prometheusHelp(sb, promName);\n+        }\n+        sb.append(promName)\n+                .append(tags)\n+                .append(\" \")\n+                .append(getCount())\n+                .append(\"\\n\");\n+\n+        promName = prometheusNameWithUnits(name + \"_elapsedTime\", Optional.of(MetricUnits.SECONDS));\n+        if (withHelpType) {\n+            prometheusType(sb, promName, \"gauge\");\n+            // By spec, no help for the elapsedTime part of SimpleTimer.\n+        }\n+        sb.append(promName)\n+                .append(tags)\n+                .append(\" \")\n+                .append(elapsedTimeInSeconds())\n+                .append(\"\\n\");\n+    }\n+\n+    @Override\n+    public String prometheusValue() {\n+        throw new UnsupportedOperationException(\"Not supported.\");\n+    }\n+\n+    @Override\n+    public void jsonData(JsonObjectBuilder builder, MetricID metricID) {\n+        JsonObjectBuilder myBuilder = JSON.createObjectBuilder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b08e3f8227db2f6679bbc4e0be54961aa7d4232"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg4NTY0OQ==", "bodyText": "This is probably good enough.  Note that strictly speaking a JAX-RS annotation is one that is, in turn, annotated with HttpMethod.  I'd probably leave this line alone anyway.", "url": "https://github.com/oracle/helidon/pull/2245#discussion_r468885649", "createdAt": "2020-08-11T21:52:11Z", "author": {"login": "ljnelson"}, "path": "microprofile/metrics/src/main/java/io/helidon/microprofile/metrics/MetricsCdiExtension.java", "diffHunk": "@@ -91,14 +102,35 @@\n     private static final Logger LOGGER = Logger.getLogger(MetricsCdiExtension.class.getName());\n \n     private static final List<Class<? extends Annotation>> METRIC_ANNOTATIONS\n-            = Arrays.asList(Counted.class, Metered.class, Timed.class, Gauge.class, ConcurrentGauge.class);\n+            = Arrays.asList(Counted.class, Metered.class, Timed.class, Gauge.class, ConcurrentGauge.class,\n+                            SimplyTimed.class);\n+\n+    private static final List<Class<? extends Annotation>> JAX_RS_ANNOTATIONS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a32e1613fc1aba008ff211686b09d9e0bc7a648"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41f4604809740699d097ff03bc2c53b29c0a3ffb", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/41f4604809740699d097ff03bc2c53b29c0a3ffb", "committedDate": "2020-08-11T22:27:20Z", "message": "Add link to the metrics spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NDc2NDk2", "url": "https://github.com/oracle/helidon/pull/2245#pullrequestreview-465476496", "createdAt": "2020-08-11T22:40:31Z", "commit": {"oid": "41f4604809740699d097ff03bc2c53b29c0a3ffb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5620d85766941ecf726f47fbbc2bd5faa80e290", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/e5620d85766941ecf726f47fbbc2bd5faa80e290", "committedDate": "2020-08-12T13:13:09Z", "message": "Open microprofile/metrics to io.helidon.microprofile.cdi also"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8be8ca2ec8f98b2237886de9ad6f32e27d94a85b", "author": {"user": {"login": "tjquinno", "name": "Tim Quinn"}}, "url": "https://github.com/oracle/helidon/commit/8be8ca2ec8f98b2237886de9ad6f32e27d94a85b", "committedDate": "2020-08-12T18:50:12Z", "message": "Fix module opens for integration tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MjY2NTQw", "url": "https://github.com/oracle/helidon/pull/2245#pullrequestreview-466266540", "createdAt": "2020-08-12T20:49:36Z", "commit": {"oid": "8be8ca2ec8f98b2237886de9ad6f32e27d94a85b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 533, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}