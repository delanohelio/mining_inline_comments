{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MTUzMjI3", "number": 1314, "title": "Fixed issues with IDCS and OIDC provider - 1.x", "bodyText": "Cookie now configured to prevent infinite redirects.\nWebServer security for scopes works as it should.\nMP integration with WebServer security works as it should.\nExamples are clearly separated between SE and MP.\nSigned-off-by: Tomas Langer tomas.langer@oracle.com\nSolves #1302 for helidon-1.x branch", "createdAt": "2020-01-17T13:56:54Z", "url": "https://github.com/oracle/helidon/pull/1314", "merged": true, "mergeCommit": {"oid": "d977cb1a8b931c5ab52dfbcd8e16bf5dab6f0de6"}, "closed": true, "closedAt": "2020-01-21T15:26:12Z", "author": {"login": "tomas-langer"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7PO64ABqjI5NTgyNDQ5Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8gda-gFqTM0NTg0NTc1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1075cf6e2211711bb3ea1bb5ae4d674ef0eac973", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/1075cf6e2211711bb3ea1bb5ae4d674ef0eac973", "committedDate": "2020-01-17T13:55:31Z", "message": "IDCS and OIDC fixes."}, "afterCommit": {"oid": "6b399c7722085155a350ccfa3bc16bca9f18f699", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/6b399c7722085155a350ccfa3bc16bca9f18f699", "committedDate": "2020-01-17T14:01:00Z", "message": "IDCS and OIDC fixes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b399c7722085155a350ccfa3bc16bca9f18f699", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/6b399c7722085155a350ccfa3bc16bca9f18f699", "committedDate": "2020-01-17T14:01:00Z", "message": "IDCS and OIDC fixes."}, "afterCommit": {"oid": "a710d4c012c18bdd2d99bf71de859f46856650fb", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/a710d4c012c18bdd2d99bf71de859f46856650fb", "committedDate": "2020-01-17T14:42:49Z", "message": "IDCS and OIDC fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a610012ed197177781791ba17d129bac91453a03", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/a610012ed197177781791ba17d129bac91453a03", "committedDate": "2020-01-17T15:04:15Z", "message": "IDCS and OIDC fixes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a710d4c012c18bdd2d99bf71de859f46856650fb", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/a710d4c012c18bdd2d99bf71de859f46856650fb", "committedDate": "2020-01-17T14:42:49Z", "message": "IDCS and OIDC fixes."}, "afterCommit": {"oid": "a610012ed197177781791ba17d129bac91453a03", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/a610012ed197177781791ba17d129bac91453a03", "committedDate": "2020-01-17T15:04:15Z", "message": "IDCS and OIDC fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTM3Mzcz", "url": "https://github.com/oracle/helidon/pull/1314#pullrequestreview-344937373", "createdAt": "2020-01-18T10:35:47Z", "commit": {"oid": "a610012ed197177781791ba17d129bac91453a03"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxMDozNTo0OFrOFfKXbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxMDo0MDo1OFrOFfKYLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyMDAxMg==", "bodyText": "I think this is a very important feature, especially when the app will run from Kubernetes and might get an override config seeded. Probably you should feature this more prominently in other places as well and you might also change the default from a user home example to a more Kubernetes-ish one.", "url": "https://github.com/oracle/helidon/pull/1314#discussion_r368220012", "createdAt": "2020-01-18T10:35:48Z", "author": {"login": "FWiesner"}, "path": "examples/microprofile/idcs/src/main/java/io/helidon/examples/microprofile/security/idcs/IdcsMain.java", "diffHunk": "@@ -35,13 +38,29 @@ private IdcsMain() {\n      * @throws IOException when logging configuration fails\n      */\n     public static void main(String[] args) throws IOException {\n-        LogManager.getLogManager().readConfiguration(IdcsMain.class.getResourceAsStream(\"/logging.properties\"));\n-        Server.create().start();\n+        Server.builder()\n+                .config(buildConfig())\n+                .build()\n+                .start();\n \n         System.out.println(\"Endpoints:\");\n         System.out.println(\"Login\");\n         System.out.println(\"  http://localhost:7987/rest/login\");\n         System.out.println(\"Full security with scopes and roles (see IdcsResource.java)\");\n         System.out.println(\"  http://localhost:7987/rest/scopes\");\n+        System.out.println(\"A protected reactive service (see application.yaml - security.web-server)\");\n+        System.out.println(\"  http://localhost:7987/reactive\");\n+        System.out.println(\"A protected static resource (see application.yaml - security.web-server\");\n+        System.out.println(\"  http://localhost:7987/web/resource.html\");\n+    }\n+\n+    private static Config buildConfig() {\n+        return Config.builder()\n+                .sources(\n+                        // you can use this file to override the defaults that are built-in\n+                        file(System.getProperty(\"user.home\") + \"/helidon/conf/examples.yaml\").optional(),\n+                        // in jar file (see src/main/resources/application.yaml)\n+                        classpath(\"application.yaml\"))\n+                .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a610012ed197177781791ba17d129bac91453a03"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyMDA1Nw==", "bodyText": "does the empty abac key do something? If so, please add a comment. Otherwise probably remove it", "url": "https://github.com/oracle/helidon/pull/1314#discussion_r368220057", "createdAt": "2020-01-18T10:37:08Z", "author": {"login": "FWiesner"}, "path": "examples/microprofile/idcs/src/main/resources/application.yaml", "diffHunk": "@@ -34,18 +34,27 @@ security:\n     frontend-uri: \"http://localhost:7987\"\n     proxy-host: \"if you need proxy\"\n   providers:\n-  - abac:\n-  - oidc:\n-      client-id: \"${ALIAS=security.properties.idcs-client-id}\"\n-      client-secret: \"${ALIAS=security.properties.idcs-client-secret}\"\n-      identity-uri: \"${ALIAS=security.properties.idcs-uri}\"\n-      # A prefix used for custom scopes\n-      scope-audience: \"http://localhost:7987/test-application\"\n-      proxy-host: \"${ALIAS=security.properties.proxy-host}\"\n-      frontend-uri: \"${ALIAS=security.properties.frontend-uri}\"\n-      # Retrieve roles\n-      idcs-roles: true\n+    - abac:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a610012ed197177781791ba17d129bac91453a03"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyMDEzNA==", "bodyText": "no idea whether this is defined by MicroProfile or native Helidon, but why don't you accept an array of paths here to use the same configuration multiple times?", "url": "https://github.com/oracle/helidon/pull/1314#discussion_r368220134", "createdAt": "2020-01-18T10:39:08Z", "author": {"login": "FWiesner"}, "path": "examples/security/idcs-login/src/main/resources/application.yaml", "diffHunk": "@@ -46,11 +46,13 @@ security:\n         client-id: \"${ALIAS=security.properties.idcs-client-id}\"\n         client-secret: \"${ALIAS=security.properties.idcs-client-secret}\"\n         identity-uri: \"${ALIAS=security.properties.idcs-uri}\"\n-      cache-config:\n-        cache-timeout-millis: 100000\n   web-server:\n     # protected paths on the web server - do not include paths served by Jersey, as those are protected directly\n     paths:\n-    - path: \"/rest/profile\"\n-      methods: [\"get\"]\n-      authenticate: true\n+      - path: \"/rest/profile\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a610012ed197177781791ba17d129bac91453a03"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyMDIwNQ==", "bodyText": "same as on the other PR... I wonder whether there should be an orElse to warn the developer", "url": "https://github.com/oracle/helidon/pull/1314#discussion_r368220205", "createdAt": "2020-01-18T10:40:58Z", "author": {"login": "FWiesner"}, "path": "security/providers/abac/src/main/java/io/helidon/security/providers/abac/AbacProvider.java", "diffHunk": "@@ -224,39 +234,53 @@ private void validateCustom(EndpointConfig epConfig, Errors.Collector collector)\n     }\n \n     private void validateConfig(EndpointConfig config, Errors.Collector collector) {\n-        config.config(\"abac\")\n-                .ifPresent(abacConfig -> abacConfig.asMap()\n-                        .ifPresent(theMap -> {\n-                            int attributes = 0;\n-                            int unsupported = 0;\n-                            List<String> unsupportedKeys = new LinkedList<>();\n-\n-                            for (String key : theMap.keySet()) {\n-                                attributes++;\n-                                if (!supportedConfigKeys.contains(key)) {\n-                                    unsupported++;\n-                                    unsupportedKeys.add(key);\n-                                }\n-                            }\n+        config.config(CONFIG_KEY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a610012ed197177781791ba17d129bac91453a03"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6063e3ea6c341eb2fbcb3c5d89524d2c83418df", "author": {"user": {"login": "tomas-langer", "name": "Tomas Langer"}}, "url": "https://github.com/oracle/helidon/commit/b6063e3ea6c341eb2fbcb3c5d89524d2c83418df", "committedDate": "2020-01-20T10:34:48Z", "message": "Review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODQ1NzUy", "url": "https://github.com/oracle/helidon/pull/1314#pullrequestreview-345845752", "createdAt": "2020-01-21T12:39:29Z", "commit": {"oid": "b6063e3ea6c341eb2fbcb3c5d89524d2c83418df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 889, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}