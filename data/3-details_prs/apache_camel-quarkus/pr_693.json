{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNTUzODky", "number": 693, "title": "Add olingo4 extension", "bodyText": "fixes #692", "createdAt": "2020-02-11T09:35:49Z", "url": "https://github.com/apache/camel-quarkus/pull/693", "merged": true, "mergeCommit": {"oid": "68f9774e5a0d047f2c077a8be102dbe4a747972f"}, "closed": true, "closedAt": "2020-02-11T15:17:14Z", "author": {"login": "jamesnetherton"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDQHoIAFqTM1NjU4MzU5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDR2tgAFqTM1NjY1OTA4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTgzNTkx", "url": "https://github.com/apache/camel-quarkus/pull/693#pullrequestreview-356583591", "createdAt": "2020-02-11T11:28:45Z", "commit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMToyODo0NVrOFoFkdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMTozMjo1NlrOFoFruw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3ODYxNQ==", "bodyText": "Do you happen to know if this is necessary also on Camel master? If not, a comment would be handy that it can be removed after Camel 3.1. Otherwise, a Camel issue would be nice requiring to fix what is necessary in Camel.", "url": "https://github.com/apache/camel-quarkus/pull/693#discussion_r377578615", "createdAt": "2020-02-11T11:28:45Z", "author": {"login": "ppalaga"}, "path": "extensions/olingo4/deployment/src/main/java/org/apache/camel/quarkus/component/olingo4/deployment/Olingo4Processor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.quarkus.component.olingo4.deployment;\n+\n+import io.quarkus.deployment.annotations.BuildProducer;\n+import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.builditem.AdditionalApplicationArchiveMarkerBuildItem;\n+import io.quarkus.deployment.builditem.CombinedIndexBuildItem;\n+import io.quarkus.deployment.builditem.FeatureBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import org.apache.camel.component.olingo4.Olingo4AppEndpointConfiguration;\n+import org.apache.camel.quarkus.core.deployment.UnbannedReflectiveBuildItem;\n+import org.apache.olingo.server.core.ODataImpl;\n+import org.jboss.jandex.DotName;\n+import org.jboss.jandex.IndexView;\n+\n+class Olingo4Processor {\n+\n+    private static final String FEATURE = \"camel-olingo4\";\n+    private static final DotName JSON_DESERIALIZE_DOT_NAME = DotName\n+            .createSimple(\"com.fasterxml.jackson.databind.annotation.JsonDeserialize\");\n+\n+    @BuildStep\n+    FeatureBuildItem feature() {\n+        return new FeatureBuildItem(FEATURE);\n+    }\n+\n+    @BuildStep\n+    UnbannedReflectiveBuildItem whitelistOlingo4AppEndpointConfiguration() {\n+        return new UnbannedReflectiveBuildItem(Olingo4AppEndpointConfiguration.class.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3OTI5Mg==", "bodyText": "I think this done by Quarkus Jackson extension. If that's really the case, we should perhaps prefer depending on them.", "url": "https://github.com/apache/camel-quarkus/pull/693#discussion_r377579292", "createdAt": "2020-02-11T11:30:10Z", "author": {"login": "ppalaga"}, "path": "extensions/olingo4/deployment/src/main/java/org/apache/camel/quarkus/component/olingo4/deployment/Olingo4Processor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.quarkus.component.olingo4.deployment;\n+\n+import io.quarkus.deployment.annotations.BuildProducer;\n+import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.builditem.AdditionalApplicationArchiveMarkerBuildItem;\n+import io.quarkus.deployment.builditem.CombinedIndexBuildItem;\n+import io.quarkus.deployment.builditem.FeatureBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import org.apache.camel.component.olingo4.Olingo4AppEndpointConfiguration;\n+import org.apache.camel.quarkus.core.deployment.UnbannedReflectiveBuildItem;\n+import org.apache.olingo.server.core.ODataImpl;\n+import org.jboss.jandex.DotName;\n+import org.jboss.jandex.IndexView;\n+\n+class Olingo4Processor {\n+\n+    private static final String FEATURE = \"camel-olingo4\";\n+    private static final DotName JSON_DESERIALIZE_DOT_NAME = DotName\n+            .createSimple(\"com.fasterxml.jackson.databind.annotation.JsonDeserialize\");\n+\n+    @BuildStep\n+    FeatureBuildItem feature() {\n+        return new FeatureBuildItem(FEATURE);\n+    }\n+\n+    @BuildStep\n+    UnbannedReflectiveBuildItem whitelistOlingo4AppEndpointConfiguration() {\n+        return new UnbannedReflectiveBuildItem(Olingo4AppEndpointConfiguration.class.getName());\n+    }\n+\n+    @BuildStep\n+    AdditionalApplicationArchiveMarkerBuildItem olingoArchiveMarker() {\n+        return new AdditionalApplicationArchiveMarkerBuildItem(\"org/apache/olingo\");\n+    }\n+\n+    @BuildStep\n+    void registerForReflection(BuildProducer<ReflectiveClassBuildItem> reflectiveClass, CombinedIndexBuildItem combinedIndex) {\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, false, ODataImpl.class));\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, true, Olingo4AppEndpointConfiguration.class));\n+\n+        // Register Olingo Deserializer classes for reflection\n+        IndexView index = combinedIndex.getIndex();\n+        index.getAnnotations(JSON_DESERIALIZE_DOT_NAME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3OTk0OA==", "bodyText": "Hm... why is this filter actually required?", "url": "https://github.com/apache/camel-quarkus/pull/693#discussion_r377579948", "createdAt": "2020-02-11T11:31:44Z", "author": {"login": "ppalaga"}, "path": "extensions/olingo4/deployment/src/main/java/org/apache/camel/quarkus/component/olingo4/deployment/Olingo4Processor.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.quarkus.component.olingo4.deployment;\n+\n+import io.quarkus.deployment.annotations.BuildProducer;\n+import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.builditem.AdditionalApplicationArchiveMarkerBuildItem;\n+import io.quarkus.deployment.builditem.CombinedIndexBuildItem;\n+import io.quarkus.deployment.builditem.FeatureBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import org.apache.camel.component.olingo4.Olingo4AppEndpointConfiguration;\n+import org.apache.camel.quarkus.core.deployment.UnbannedReflectiveBuildItem;\n+import org.apache.olingo.server.core.ODataImpl;\n+import org.jboss.jandex.DotName;\n+import org.jboss.jandex.IndexView;\n+\n+class Olingo4Processor {\n+\n+    private static final String FEATURE = \"camel-olingo4\";\n+    private static final DotName JSON_DESERIALIZE_DOT_NAME = DotName\n+            .createSimple(\"com.fasterxml.jackson.databind.annotation.JsonDeserialize\");\n+\n+    @BuildStep\n+    FeatureBuildItem feature() {\n+        return new FeatureBuildItem(FEATURE);\n+    }\n+\n+    @BuildStep\n+    UnbannedReflectiveBuildItem whitelistOlingo4AppEndpointConfiguration() {\n+        return new UnbannedReflectiveBuildItem(Olingo4AppEndpointConfiguration.class.getName());\n+    }\n+\n+    @BuildStep\n+    AdditionalApplicationArchiveMarkerBuildItem olingoArchiveMarker() {\n+        return new AdditionalApplicationArchiveMarkerBuildItem(\"org/apache/olingo\");\n+    }\n+\n+    @BuildStep\n+    void registerForReflection(BuildProducer<ReflectiveClassBuildItem> reflectiveClass, CombinedIndexBuildItem combinedIndex) {\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, false, ODataImpl.class));\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(true, true, Olingo4AppEndpointConfiguration.class));\n+\n+        // Register Olingo Deserializer classes for reflection\n+        IndexView index = combinedIndex.getIndex();\n+        index.getAnnotations(JSON_DESERIALIZE_DOT_NAME)\n+                .stream()\n+                .map(annotation -> annotation.value(\"using\").asClass().name().toString())\n+                .filter(className -> className.startsWith(\"org.apache.olingo\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU4MDQ3NQ==", "bodyText": "I appreciate the comment!", "url": "https://github.com/apache/camel-quarkus/pull/693#discussion_r377580475", "createdAt": "2020-02-11T11:32:56Z", "author": {"login": "ppalaga"}, "path": "extensions/support/httpclient/deployment/src/main/java/org/apache/camel/quarkus/support/httpclient/deployment/HttpClientProcessor.java", "diffHunk": "@@ -45,4 +46,10 @@ void registerForReflection(\n             reflectiveClasses.produce(new ReflectiveClassBuildItem(true, false, info.name().toString()));\n         }\n     }\n+\n+    @BuildStep\n+    NativeImageResourceBuildItem suffixListResource() {\n+        // Required by org.apache.http.conn.util.PublicSuffixMatcher", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NjU1Nzgw", "url": "https://github.com/apache/camel-quarkus/pull/693#pullrequestreview-356655780", "createdAt": "2020-02-11T13:31:16Z", "commit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07fc9c75a3925b535e219c7b22c2042507f09558", "author": {"user": {"login": "jamesnetherton", "name": "James Netherton"}}, "url": "https://github.com/apache/camel-quarkus/commit/07fc9c75a3925b535e219c7b22c2042507f09558", "committedDate": "2020-02-11T13:34:46Z", "message": "Add olingo4 extension\n\nfixes #692"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85b293f43e94ba460539987933b72f25e6caed33", "author": {"user": {"login": "jamesnetherton", "name": "James Netherton"}}, "url": "https://github.com/apache/camel-quarkus/commit/85b293f43e94ba460539987933b72f25e6caed33", "committedDate": "2020-02-11T09:31:40Z", "message": "Add olingo4 extension\n\nfixes #692"}, "afterCommit": {"oid": "07fc9c75a3925b535e219c7b22c2042507f09558", "author": {"user": {"login": "jamesnetherton", "name": "James Netherton"}}, "url": "https://github.com/apache/camel-quarkus/commit/07fc9c75a3925b535e219c7b22c2042507f09558", "committedDate": "2020-02-11T13:34:46Z", "message": "Add olingo4 extension\n\nfixes #692"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NjU5MDg0", "url": "https://github.com/apache/camel-quarkus/pull/693#pullrequestreview-356659084", "createdAt": "2020-02-11T13:36:00Z", "commit": {"oid": "07fc9c75a3925b535e219c7b22c2042507f09558"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2622, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}