{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODcxMDMy", "number": 1818, "title": "Improve mock backend logging", "bodyText": "This PR is follow up to @ppalaga work in #1782.", "createdAt": "2020-09-22T11:24:11Z", "url": "https://github.com/apache/camel-quarkus/pull/1818", "merged": true, "mergeCommit": {"oid": "8d7691d31d93f237909123377087e3d2f938e594"}, "closed": true, "closedAt": "2020-09-30T10:10:17Z", "author": {"login": "llowinge"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL92DTgBqjM4MDIyOTY0OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN4FzCABqjM4MjMxNzIwMTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a81b2d3b4ed77d95f725a71efa305d75e8680c9", "author": {"user": {"login": "llowinge", "name": null}}, "url": "https://github.com/apache/camel-quarkus/commit/0a81b2d3b4ed77d95f725a71efa305d75e8680c9", "committedDate": "2020-09-22T11:22:31Z", "message": "Log info about mock vs real service in integration test for Telegram via QuarkusTestBeforeAllCallback usage"}, "afterCommit": {"oid": "d56295c5380b597081d849aed74b597ebd1ba462", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/d56295c5380b597081d849aed74b597ebd1ba462", "committedDate": "2020-09-24T09:32:03Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzkwMDE4", "url": "https://github.com/apache/camel-quarkus/pull/1818#pullrequestreview-495390018", "createdAt": "2020-09-24T09:34:27Z", "commit": {"oid": "d56295c5380b597081d849aed74b597ebd1ba462"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwOTozNDoyN1rOHXSBxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwOTozNDoyN1rOHXSBxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NDY2MQ==", "bodyText": "@ppalaga This is a typo ? CAMEL_QUARKUS_FALLBACK_MOCK ?", "url": "https://github.com/apache/camel-quarkus/pull/1818#discussion_r494174661", "createdAt": "2020-09-24T09:34:27Z", "author": {"login": "llowinge"}, "path": "integration-tests/telegram/src/main/java/org/apache/camel/quarkus/component/telegram/it/TelegramRoutes.java", "diffHunk": "@@ -21,37 +21,80 @@\n import java.io.InputStream;\n import java.util.stream.Stream;\n \n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Named;\n+\n+import io.quarkus.arc.Unremovable;\n import org.apache.camel.Exchange;\n import org.apache.camel.builder.RouteBuilder;\n+import org.apache.camel.component.telegram.TelegramComponent;\n+import org.apache.camel.quarkus.test.mock.backend.MockBackendUtils;\n import org.apache.camel.support.ResourceHelper;\n import org.apache.camel.util.IOHelper;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n \n+@ApplicationScoped\n public class TelegramRoutes extends RouteBuilder {\n \n+    @ConfigProperty(name = \"telegram.authorization-token\", defaultValue = \"default-dummy-token\")\n+    String authToken;\n+\n+    @ConfigProperty(name = \"quarkus.http.test-port\")\n+    int httpTestPort;\n+    @ConfigProperty(name = \"quarkus.http.port\")\n+    int httpPort;\n+\n+    private String getBaseUri() {\n+        final boolean isNativeMode = \"executable\".equals(System.getProperty(\"org.graalvm.nativeimage.kind\"));\n+        return \"default-dummy-token\".equals(authToken)\n+                ? \"http://localhost:\" + (isNativeMode ? httpPort : httpTestPort)\n+                : \"https://api.telegram.org\";\n+    }\n+\n+    /**\n+     * We need to implement some conditional configuration of the {@link TelegramComponent} thus we create it\n+     * programmatically and publish via CDI.\n+     *\n+     * @return a configured {@link TelegramComponent}\n+     */\n+    @Produces\n+    @ApplicationScoped\n+    @Unremovable\n+    @Named\n+    TelegramComponent telegram() {\n+        final TelegramComponent result = new TelegramComponent();\n+        result.setCamelContext(getContext());\n+        result.setBaseUri(getBaseUri());\n+        result.setAuthorizationToken(authToken);\n+        return result;\n+    }\n+\n     @Override\n     public void configure() throws Exception {\n+        if (MockBackendUtils.startMockBackend(true)) {\n+            /* Start the mock Telegram API unless the user did export CAMEL_QUARKUS_FALLBACK_MOCK=false */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d56295c5380b597081d849aed74b597ebd1ba462"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d56295c5380b597081d849aed74b597ebd1ba462", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/d56295c5380b597081d849aed74b597ebd1ba462", "committedDate": "2020-09-24T09:32:03Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}, "afterCommit": {"oid": "648244e651a34c9e68ccc7ba4723c9442a71114d", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/648244e651a34c9e68ccc7ba4723c9442a71114d", "committedDate": "2020-09-30T07:48:32Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "648244e651a34c9e68ccc7ba4723c9442a71114d", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/648244e651a34c9e68ccc7ba4723c9442a71114d", "committedDate": "2020-09-30T07:48:32Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}, "afterCommit": {"oid": "7acc20c770e44c12817358c1815f4e4e17a9f2c1", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/7acc20c770e44c12817358c1815f4e4e17a9f2c1", "committedDate": "2020-09-30T07:49:13Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f160ad40568634d1cc3b956dbc2ecb9173b71b", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/60f160ad40568634d1cc3b956dbc2ecb9173b71b", "committedDate": "2020-09-30T07:59:07Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7acc20c770e44c12817358c1815f4e4e17a9f2c1", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/7acc20c770e44c12817358c1815f4e4e17a9f2c1", "committedDate": "2020-09-30T07:49:13Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}, "afterCommit": {"oid": "60f160ad40568634d1cc3b956dbc2ecb9173b71b", "author": {"user": {"login": "ppalaga", "name": "Peter Palaga"}}, "url": "https://github.com/apache/camel-quarkus/commit/60f160ad40568634d1cc3b956dbc2ecb9173b71b", "committedDate": "2020-09-30T07:59:07Z", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2777, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}