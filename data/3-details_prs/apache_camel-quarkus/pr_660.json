{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MzE5NTQ1", "number": 660, "title": "The MicroProfile test fails if message history is turned off", "bodyText": "Fixes #650", "createdAt": "2020-01-23T11:43:02Z", "url": "https://github.com/apache/camel-quarkus/pull/660", "merged": true, "mergeCommit": {"oid": "011b79fcb8a1370e4c53fe4f2fef697911d0dcca"}, "closed": true, "closedAt": "2020-01-23T13:57:11Z", "author": {"login": "lburgazzoli"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9I5HSAFqTM0NzIzNjQ0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9KeyHgFqTM0NzI5OTM2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjM2NDQ5", "url": "https://github.com/apache/camel-quarkus/pull/660#pullrequestreview-347236449", "createdAt": "2020-01-23T11:45:56Z", "commit": {"oid": "b30cdda2552191f0fb40990e052428d14d0cbb9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjQ0OTQ2", "url": "https://github.com/apache/camel-quarkus/pull/660#pullrequestreview-347244946", "createdAt": "2020-01-23T12:02:02Z", "commit": {"oid": "b30cdda2552191f0fb40990e052428d14d0cbb9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMjowMjowM1rOFg7zJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMjowMjowM1rOFg7zJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3ODUwMQ==", "bodyText": "I wonder if we can simplify this to just:\ncamelContext.setMessageHistory(true);\ncamelContext.setMessageHistoryFactory(new MicroProfileMetricsMessageHistoryFactory());\n\nAnd not bother with the other checks?\nIn 3.1.0, when you add the MessageHistoryFactory, message history is auto enabled on the CamelContext anyway.", "url": "https://github.com/apache/camel-quarkus/pull/660#discussion_r370078501", "createdAt": "2020-01-23T12:02:03Z", "author": {"login": "jamesnetherton"}, "path": "extensions/microprofile-metrics/runtime/src/main/java/org/apache/camel/quarkus/component/microprofile/metrics/runtime/CamelMicroProfileMetricsRecorder.java", "diffHunk": "@@ -61,4 +63,24 @@ public void configureCamelContext(CamelMicroProfileMetricsConfig config,\n             managementStrategy.addEventNotifier(new MicroProfileMetricsCamelContextEventNotifier());\n         }\n     }\n+\n+    private static class MicroProfileMetricsContextConfigurerListener extends MainListenerSupport {\n+        private static final Logger LOGGER = Logger.getLogger(MicroProfileMetricsContextConfigurerListener.class);\n+        private final CamelMicroProfileMetricsConfig config;\n+\n+        public MicroProfileMetricsContextConfigurerListener(CamelMicroProfileMetricsConfig config) {\n+            this.config = config;\n+        }\n+\n+        @Override\n+        public void configure(CamelContext camelContext) {\n+            if (camelContext.isMessageHistory() && config.enableMessageHistory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b30cdda2552191f0fb40990e052428d14d0cbb9b"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ba2e815a3fa6cfb28f3a72ca3e71f169886c902", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel-quarkus/commit/0ba2e815a3fa6cfb28f3a72ca3e71f169886c902", "committedDate": "2020-01-23T12:40:26Z", "message": "The MicroProfile test fails if message history is turned off #650"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b30cdda2552191f0fb40990e052428d14d0cbb9b", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel-quarkus/commit/b30cdda2552191f0fb40990e052428d14d0cbb9b", "committedDate": "2020-01-23T11:42:43Z", "message": "The MicroProfile test fails if message history is turned off #650"}, "afterCommit": {"oid": "0ba2e815a3fa6cfb28f3a72ca3e71f169886c902", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel-quarkus/commit/0ba2e815a3fa6cfb28f3a72ca3e71f169886c902", "committedDate": "2020-01-23T12:40:26Z", "message": "The MicroProfile test fails if message history is turned off #650"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjY3NjU5", "url": "https://github.com/apache/camel-quarkus/pull/660#pullrequestreview-347267659", "createdAt": "2020-01-23T12:44:29Z", "commit": {"oid": "0ba2e815a3fa6cfb28f3a72ca3e71f169886c902"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3Mjk5MzY2", "url": "https://github.com/apache/camel-quarkus/pull/660#pullrequestreview-347299366", "createdAt": "2020-01-23T13:36:59Z", "commit": {"oid": "0ba2e815a3fa6cfb28f3a72ca3e71f169886c902"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2610, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}