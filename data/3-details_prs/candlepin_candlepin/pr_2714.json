{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDI4ODA5", "number": 2714, "title": "[M] 1840850: Fixed parameter overflow in bulk entitlement deletion (ENT-2437)", "bodyText": "Fixed an issue during entitlement deletion that could cause a\nquery to be generated that attempts to use more parameters than\nthe backend database supports\nFlagged the bulkSQLDelete method as deprecated, as it lacks\nprotection for the database parameter limit", "createdAt": "2020-05-27T18:10:23Z", "url": "https://github.com/candlepin/candlepin/pull/2714", "merged": true, "mergeCommit": {"oid": "87cfd0ea3fe5892606f016335a918b30c19fae57"}, "closed": true, "closedAt": "2020-05-29T06:39:11Z", "author": {"login": "Ceiu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclsjOtgFqTQyMDAzMzQ3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl8nsAAFqTQyMDY4Nzc4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDMzNDcw", "url": "https://github.com/candlepin/candlepin/pull/2714#pullrequestreview-420033470", "createdAt": "2020-05-28T11:55:34Z", "commit": {"oid": "c7c7b8db53906aa8d64d00ee5508aba9dc04fc8a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1NTozNVrOGbxwHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1NTozNVrOGbxwHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3OTg3MA==", "bodyText": "Could you add a unit-test for this change? I think it would be helpful to know that we do not re-introduce the issue in case we need to make changes in the future.", "url": "https://github.com/candlepin/candlepin/pull/2714#discussion_r431779870", "createdAt": "2020-05-28T11:55:35Z", "author": {"login": "Januson"}, "path": "server/src/main/java/org/candlepin/model/EntitlementCurator.java", "diffHunk": "@@ -796,11 +796,25 @@ public void batchDelete(Collection<Entitlement> entitlements) {\n      * preferably by calling {@link #unlinkEntitlements} first.\n      *\n      * @param entitlementIds The collection of ids of the entitlements to be deleted.\n+     *\n+     * @return\n+     *  the number of entitlements deleted as a result of this operation\n      */\n-    public void batchDeleteByIds(Collection<String> entitlementIds) {\n-        Map<String, Object> criteria = new HashMap<>();\n-        criteria.put(\"id\", entitlementIds);\n-        this.bulkSQLDelete(Entitlement.DB_TABLE, criteria);\n+    public int batchDeleteByIds(Collection<String> entitlementIds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7c7b8db53906aa8d64d00ee5508aba9dc04fc8a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ebf56de789d61d96c6ff51f03db13979c22b3d4", "author": {"user": {"login": "Ceiu", "name": "Chris \"Ceiu\" Rog"}}, "url": "https://github.com/candlepin/candlepin/commit/2ebf56de789d61d96c6ff51f03db13979c22b3d4", "committedDate": "2020-05-28T16:10:40Z", "message": "1840850: Fixed parameter overflow in bulk entitlement deletion\n\n- Fixed an issue during entitlement deletion that could cause a\n  query to be generated that attempts to use more parameters than\n  the backend database supports\n- Flagged the bulkSQLDelete method as deprecated, as it lacks\n  protection for the database parameter limit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7c7b8db53906aa8d64d00ee5508aba9dc04fc8a", "author": {"user": {"login": "Ceiu", "name": "Chris \"Ceiu\" Rog"}}, "url": "https://github.com/candlepin/candlepin/commit/c7c7b8db53906aa8d64d00ee5508aba9dc04fc8a", "committedDate": "2020-05-27T17:38:07Z", "message": "1840850: Fixed parameter overflow in bulk entitlement deletion\n\n- Fixed an issue during entitlement deletion that could cause a\n  query to be generated that attempts to use more parameters than\n  the backend database supports\n- Flagged the bulkSQLDelete method as deprecated, as it lacks\n  protection for the database parameter limit"}, "afterCommit": {"oid": "2ebf56de789d61d96c6ff51f03db13979c22b3d4", "author": {"user": {"login": "Ceiu", "name": "Chris \"Ceiu\" Rog"}}, "url": "https://github.com/candlepin/candlepin/commit/2ebf56de789d61d96c6ff51f03db13979c22b3d4", "committedDate": "2020-05-28T16:10:40Z", "message": "1840850: Fixed parameter overflow in bulk entitlement deletion\n\n- Fixed an issue during entitlement deletion that could cause a\n  query to be generated that attempts to use more parameters than\n  the backend database supports\n- Flagged the bulkSQLDelete method as deprecated, as it lacks\n  protection for the database parameter limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjg3Nzgx", "url": "https://github.com/candlepin/candlepin/pull/2714#pullrequestreview-420687781", "createdAt": "2020-05-29T06:38:56Z", "commit": {"oid": "2ebf56de789d61d96c6ff51f03db13979c22b3d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2413, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}