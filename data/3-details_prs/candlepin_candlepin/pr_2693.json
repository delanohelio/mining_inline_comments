{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMTg5Mzg2", "number": 2693, "title": "ENT-1885: Port RoleResource to spec-first", "bodyText": "Updated candlepin.yaml schema file with API definition.\nUpdated RoleResouce file with API implementation.", "createdAt": "2020-04-30T06:47:21Z", "url": "https://github.com/candlepin/candlepin/pull/2693", "merged": true, "mergeCommit": {"oid": "79c5ca64b684828fbd87fe4f20accf8f87e41bd4"}, "closed": true, "closedAt": "2020-05-11T06:54:46Z", "author": {"login": "wolfdale"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccqAseAFqTQwMzM1NzcxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfJzaPABqjMzMTU0ODkyODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzU3NzEx", "url": "https://github.com/candlepin/candlepin/pull/2693#pullrequestreview-403357711", "createdAt": "2020-04-30T09:35:58Z", "commit": {"oid": "02f115d098a694539a83a1ac3d2eee3e6d66de52"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTozNTo1OFrOGOhgXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTo0OTo1NFrOGOh_7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MjIwNA==", "bodyText": "Not part of your changes but ownerCurator and permissionCurator are not used anymore so we could get rid of them.", "url": "https://github.com/candlepin/candlepin/pull/2693#discussion_r417882204", "createdAt": "2020-04-30T09:35:58Z", "author": {"login": "Januson"}, "path": "server/src/main/java/org/candlepin/resource/RoleResource.java", "diffHunk": "@@ -30,38 +30,16 @@\n \n import com.google.inject.Inject;\n \n-import io.swagger.annotations.Api;\n-import io.swagger.annotations.ApiOperation;\n-import io.swagger.annotations.ApiParam;\n-import io.swagger.annotations.ApiResponse;\n-import io.swagger.annotations.ApiResponses;\n-import io.swagger.annotations.Authorization;\n-\n-import org.jboss.resteasy.annotations.providers.jaxb.Wrapped;\n import org.jboss.resteasy.spi.BadRequestException;\n import org.xnap.commons.i18n.I18n;\n \n import java.util.Collection;\n-import java.util.stream.Stream;\n-\n-import javax.ws.rs.Consumes;\n-import javax.ws.rs.DELETE;\n-import javax.ws.rs.GET;\n-import javax.ws.rs.POST;\n-import javax.ws.rs.PUT;\n-import javax.ws.rs.Path;\n-import javax.ws.rs.PathParam;\n-import javax.ws.rs.Produces;\n-import javax.ws.rs.core.MediaType;\n-\n-\n+import java.util.stream.Collectors;\n \n /**\n- *\n+ * API implementation for Role operations\n  */\n-@Path(\"/roles\")\n-@Api(value = \"roles\", authorizations = { @Authorization(\"basic\") })\n-public class RoleResource {\n+public class RoleResource implements RolesApi {\n \n     private UserServiceAdapter userService;\n     private OwnerCurator ownerCurator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f115d098a694539a83a1ac3d2eee3e6d66de52"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5MDI4Nw==", "bodyText": "We should return 204 as we are not returning any data.", "url": "https://github.com/candlepin/candlepin/pull/2693#discussion_r417890287", "createdAt": "2020-04-30T09:49:54Z", "author": {"login": "Januson"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1124,6 +1124,390 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /roles:\n+    get:\n+      description: Retrieves a list of Roles\n+      tags:\n+        - Roles\n+      operationId: getRoles\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      security: []\n+      responses:\n+        200:\n+          description: A list of roles\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/RoleDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      tags:\n+        - Roles\n+      description: Creates a Role\n+      operationId: createRole\n+      security: []\n+      requestBody:\n+        description: A role to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/RoleDTO'\n+      responses:\n+        200:\n+          description: Role successfully created.\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role is null or empty or role name not specified\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role is null or empty or role name not specified\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        409:\n+          description: Role already exists\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role already exists\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /roles/{role_name}:\n+    get:\n+      description: Retrieves a single role by its name.\n+      tags:\n+        - Roles\n+      operationId: getRoleByName\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Returns a role\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role name is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role name is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: Updates Role. To avoid race conditions, we do not support updating the user or permission\n+        collections. Currently this call will only update the role name. See the specific nested POST/DELETE\n+        calls for modifying users and permissions.\n+      tags:\n+        - Roles\n+      operationId: updateRole\n+      security: []\n+      parameters:\n+        - name: role_name\n+          in: path\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Role\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/RoleDTO'\n+      responses:\n+        200:\n+          description: Returns updated role\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role name is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role name is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes a Role\n+      tags:\n+        - Roles\n+      operationId: deleteRoleByName\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f115d098a694539a83a1ac3d2eee3e6d66de52"}, "originalPosition": 173}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02f115d098a694539a83a1ac3d2eee3e6d66de52", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/02f115d098a694539a83a1ac3d2eee3e6d66de52", "committedDate": "2020-04-30T06:19:25Z", "message": "ENT-1885: Port RoleResource to spec-first"}, "afterCommit": {"oid": "72fecd242196b5604766e956629a2c92909d191e", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/72fecd242196b5604766e956629a2c92909d191e", "committedDate": "2020-04-30T10:25:25Z", "message": "ENT-1885: Port RoleResource to spec-first"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTA3MDA2", "url": "https://github.com/candlepin/candlepin/pull/2693#pullrequestreview-407507006", "createdAt": "2020-05-07T14:06:42Z", "commit": {"oid": "72fecd242196b5604766e956629a2c92909d191e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDowNjo0M1rOGSAQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDoxNToyMFrOGSApwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTUzMTcyMw==", "bodyText": "There is one more reason that this could return a 400: when the role_name is null or empty, so this could be: Access type NONE not supported, or role name is null or empty", "url": "https://github.com/candlepin/candlepin/pull/2693#discussion_r421531723", "createdAt": "2020-05-07T14:06:43Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1124,6 +1124,390 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /roles:\n+    get:\n+      description: Retrieves a list of Roles\n+      tags:\n+        - Roles\n+      operationId: getRoles\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      security: []\n+      responses:\n+        200:\n+          description: A list of roles\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/RoleDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      tags:\n+        - Roles\n+      description: Creates a Role\n+      operationId: createRole\n+      security: []\n+      requestBody:\n+        description: A role to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/RoleDTO'\n+      responses:\n+        200:\n+          description: Role successfully created.\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role is null or empty or role name not specified\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role is null or empty or role name not specified\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        409:\n+          description: Role already exists\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role already exists\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /roles/{role_name}:\n+    get:\n+      description: Retrieves a single role by its name.\n+      tags:\n+        - Roles\n+      operationId: getRoleByName\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Returns a role\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role name is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role name is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: Updates Role. To avoid race conditions, we do not support updating the user or permission\n+        collections. Currently this call will only update the role name. See the specific nested POST/DELETE\n+        calls for modifying users and permissions.\n+      tags:\n+        - Roles\n+      operationId: updateRole\n+      security: []\n+      parameters:\n+        - name: role_name\n+          in: path\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Role\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/RoleDTO'\n+      responses:\n+        200:\n+          description: Returns updated role\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Role name is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role name is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes a Role\n+      tags:\n+        - Roles\n+      operationId: deleteRoleByName\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Role successfully deleted.\n+        400:\n+          description: Role name is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role name is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /roles/{role_name}/users/{username}:\n+    post:\n+      tags:\n+        - Roles\n+      description: Adds a User to a Role\n+      operationId: addUserToRole\n+      security: []\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+        - in: path\n+          name: username\n+          description: User name\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: User added to the role\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Either role or username is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Either role or username is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role or Username not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role or Username not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes a User from a Role\n+      tags:\n+        - Roles\n+      operationId: deleteUserFromRole\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+        - in: path\n+          name: username\n+          description: User name\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: User from a role is removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Either role or username is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Either role or username is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Role or Username not found\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Role or Username not found\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /roles/{role_name}/permissions:\n+    post:\n+      tags:\n+        - Roles\n+      description: Adds a Permission to a Role\n+      operationId: addRolePermission\n+      security: []\n+      parameters:\n+        - in: path\n+          name: role_name\n+          description: Role name\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Permission Blueprint\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/PermissionBlueprintDTO'\n+      responses:\n+        200:\n+          description: Permission to a Role is added\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/RoleDTO'\n+        400:\n+          description: Access type NONE not supported", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72fecd242196b5604766e956629a2c92909d191e"}, "originalPosition": 320}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTUzODI0MQ==", "bodyText": "There's no reason to change this into returning a Set. We can still return a Stream here, by the x-java-response: type: to java.util.stream.Stream from Iterable (check other examples in the spec file)", "url": "https://github.com/candlepin/candlepin/pull/2693#discussion_r421538241", "createdAt": "2020-05-07T14:15:20Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/resource/RoleResource.java", "diffHunk": "@@ -283,14 +239,15 @@ public RoleDTO deleteUserFromRole(@PathParam(\"role_name\") String roleName,\n         return this.modelTranslator.translate(role, RoleDTO.class);\n     }\n \n-    @ApiOperation(notes = \"Retrieves a list of Roles\", value = \"getRoles\")\n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Wrapped(element = \"roles\")\n-    public Stream<RoleDTO> getRoles() {\n+    /**\n+     * {@InheritDoc}\n+     */\n+    @Override\n+    public Iterable<RoleDTO> getRoles() {\n         // TODO: Add in filter options\n \n         Collection<? extends RoleInfo> roles = this.userService.listRoles();\n-        return roles.stream().map(this.modelTranslator.getStreamMapper(RoleInfo.class, RoleDTO.class));\n+        return roles.stream().map(this.modelTranslator.getStreamMapper(RoleInfo.class, RoleDTO.class))\n+            .collect(Collectors.toSet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72fecd242196b5604766e956629a2c92909d191e"}, "originalPosition": 225}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d15b7065d6d519147feb58b6359a70ee7aaa689", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/8d15b7065d6d519147feb58b6359a70ee7aaa689", "committedDate": "2020-05-08T03:41:12Z", "message": "ENT-1885: Port RoleResource to spec-first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72fecd242196b5604766e956629a2c92909d191e", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/72fecd242196b5604766e956629a2c92909d191e", "committedDate": "2020-04-30T10:25:25Z", "message": "ENT-1885: Port RoleResource to spec-first"}, "afterCommit": {"oid": "8d15b7065d6d519147feb58b6359a70ee7aaa689", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/8d15b7065d6d519147feb58b6359a70ee7aaa689", "committedDate": "2020-05-08T03:41:12Z", "message": "ENT-1885: Port RoleResource to spec-first"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2391, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}