{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NzQwMzEw", "number": 2732, "title": "ENT-1856: Port ConsumerDTO to openapi spec", "bodyText": "Udpated specifications for CapabilityDTO, ConsumerDTO,\nConsumerInstalledProductDTO, HypervisorIdDTO\nAdded ConsumerDTOArrayElement to exclude the properties\nmentioned as HateoasArrayExclude\nUpdated the ConsumerTypeDeserializer to get appropriate\nconsumer type based on incoming object/string", "createdAt": "2020-06-25T07:11:20Z", "url": "https://github.com/candlepin/candlepin/pull/2732", "merged": true, "mergeCommit": {"oid": "b97acb16d2d20594cbe992a8fd2a5d541cf7a9d8"}, "closed": true, "closedAt": "2020-07-02T12:09:52Z", "author": {"login": "sonalidhome"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcupbwAgBqjM0ODA4MTk3ODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw82eRgBqjM1MDY1ODY1ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "712a9cab3f77d1998e039c16511f7dd09aa84f51", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/712a9cab3f77d1998e039c16511f7dd09aa84f51", "committedDate": "2020-06-25T06:22:46Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}, "afterCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/720066db86da9c0529832498453d2b8c57286288", "committedDate": "2020-06-25T07:22:17Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzIxNjgy", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-438321682", "createdAt": "2020-06-26T14:02:10Z", "commit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDowMjoxMFrOGpiGOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDowMjoxMFrOGpiGOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzQ1MA==", "bodyText": "Since this will be recognized as a getter, will this show up as an additional field to the serialized DTOs?", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446203450", "createdAt": "2020-06-26T14:02:10Z", "author": {"login": "Ceiu"}, "path": "buildSrc/src/main/resources/templates/pojo.mustache", "diffHunk": "@@ -86,6 +86,14 @@ public class {{classname}} {{#parent}}extends {{{parent}}}{{/parent}} {{#seriali\n \n     return this;\n   }\n+\n+  public {{items.datatypeWithEnum}} get{{nameInCamelCase}}Value({{{items.datatypeWithEnum}}} {{name}}Key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NTk0MDk0", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-437594094", "createdAt": "2020-06-25T15:11:43Z", "commit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNToxMTo0M1rOGo_T-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo1MDo0NFrOGpj0zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzMzUzMQ==", "bodyText": "There are a few more API endpoints where ConsumerDTO is being returned in a list/array:\nConsumerResource.getGuests\nOwnerResource.listConsumers\nOwnerResource.getHypervisors\nThey should all be changed to return ConsumerDTOArrayElement instead", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445633531", "createdAt": "2020-06-25T15:11:43Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/resource/ConsumerResource.java", "diffHunk": "@@ -408,7 +409,7 @@ public void sanitizeConsumerFacts(Consumer consumer) {\n     @Produces(MediaType.APPLICATION_JSON)\n     @Wrapped(element = \"consumers\")\n     @SuppressWarnings(\"checkstyle:indentation\")\n-    public CandlepinQuery<ConsumerDTO> list(@QueryParam(\"username\") String userName,\n+    public CandlepinQuery<ConsumerDTOArrayElement> list(@QueryParam(\"username\") String userName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODc4MQ==", "bodyText": "Since this class no longer extends the TimestampedEntityTranslator, we should manually set the created and updated fields here.", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445638781", "createdAt": "2020-06-25T15:19:03Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/ConsumerInstalledProductTranslator.java", "diffHunk": "@@ -58,16 +59,22 @@ public ConsumerInstalledProductDTO populate(ConsumerInstalledProduct source,\n     public ConsumerInstalledProductDTO populate(ModelTranslator translator, ConsumerInstalledProduct source,\n         ConsumerInstalledProductDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setProductId(source.getProductId());\n-        dest.setProductName(source.getProductName());\n-        dest.setVersion(source.getVersion());\n-        dest.setArch(source.getArch());\n-        dest.setStatus(source.getStatus());\n-        dest.setStartDate(source.getStartDate());\n-        dest.setEndDate(source.getEndDate());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n+\n+        dest.id(source.getId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzOTM0NA==", "bodyText": "Since this class no longer extends the TimestampedEntityTranslator, we should manually set the created and updated fields here.", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445639344", "createdAt": "2020-06-25T15:19:52Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/HypervisorIdTranslator.java", "diffHunk": "@@ -55,13 +55,17 @@ public HypervisorIdDTO populate(HypervisorId source, HypervisorIdDTO dest) {\n     public HypervisorIdDTO populate(ModelTranslator translator, HypervisorId source,\n         HypervisorIdDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId() != null ? source.getId().toString() : null);\n-        dest.setHypervisorId(source.getHypervisorId());\n-        dest.setReporterId(source.getReporterId());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        return dest;\n+        return dest.id(source.getId() != null ? source.getId().toString() : null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMTQyMQ==", "bodyText": "I believe, since this GuestIdDTO is within a list, we should instead use the GuestIdDTOArrayElement here.\nI am not 100% sure though, so before doing that, you could check what current master does (e.g. does a GET /consumer/{consumer_uuid} for a consumer that has guest ids that themselves have attributes return the attributes too?)", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446221421", "createdAt": "2020-06-26T14:33:10Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMzA3Ng==", "bodyText": "should be something like Represents a reduced view of a consumer (excluding data like facts and identify certificate)", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446223076", "createdAt": "2020-06-26T14:36:02Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a consumer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyNDAzMg==", "bodyText": "was allOf added here by accident?", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446224032", "createdAt": "2020-06-26T14:37:41Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMTc1OA==", "bodyText": "Why are we substituting the fieldName variable in all of these strings? It's a static variable with the value 'label' that never gets reassigned as far as I can see, so there's not point. Specifically about the exception messages, we should try to keep them the same (or similar) to before, since 'Unexpected consumer type format:' is much clearer than 'The field label is missing from: '", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446231758", "createdAt": "2020-06-26T14:50:44Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/jackson/ConsumerTypeDeserializer.java", "diffHunk": "@@ -16,77 +16,69 @@\n \n import org.candlepin.common.exceptions.CandlepinJsonProcessingException;\n import org.candlepin.dto.api.v1.ConsumerTypeDTO;\n-import org.candlepin.model.ConsumerType.ConsumerTypeEnum;\n \n import com.fasterxml.jackson.core.JsonParser;\n-import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.core.TreeNode;\n import com.fasterxml.jackson.databind.DeserializationContext;\n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.io.IOException;\n \n-\n-\n /**\n- * The ConsumerTypeDeserializer handles deserialization of consumer types defined as strings or\n- * objects on existing objects.\n+ * Handles the deserialization of the \"label\" field by wrapping it in a {@link ConsumerTypeDTO} object,\n+ * by handling both of the following formats: <pre> {@code \"type\":\"value\" } </pre> and\n+ * <pre> {@code \"type\":{\"label \":\"value\", \"manifest\":\"value\"} } </pre>.\n  */\n-public class ConsumerTypeDeserializer extends StdDeserializer<ConsumerTypeDTO> {\n-    private static Logger log = LoggerFactory.getLogger(ConsumerTypeDeserializer.class);\n+public class ConsumerTypeDeserializer extends JsonDeserializer<ConsumerTypeDTO> {\n \n-    public ConsumerTypeDeserializer() {\n-        this(null);\n-    }\n+    private static Logger log = LoggerFactory.getLogger(ConsumerTypeDeserializer.class);\n \n-    public ConsumerTypeDeserializer(Class<?> valueClass) {\n-        super(valueClass);\n-    }\n+    private static String fieldName = \"label\";\n \n     @Override\n     public ConsumerTypeDTO deserialize(JsonParser parser, DeserializationContext context)\n-        throws IOException, JsonProcessingException {\n+        throws IOException {\n \n-        // We're expecting an object or a string\n-        switch (parser.currentToken()) {\n-            case START_OBJECT:\n-                return this.parseTypeFromObject(parser);\n+        TreeNode node = parser.readValueAsTree();\n \n-            case VALUE_STRING:\n-                return this.parseTypeFromString(parser);\n+        if (node.isValueNode()) {\n+            log.debug(\"Processing {} as a value node.\", fieldName);\n \n-            default:\n-                throw new CandlepinJsonProcessingException(\"Unexpected consumer type format: \" +\n-                    parser.readValueAsTree(), parser.getCurrentLocation());\n+            return parseValueNode(node);\n+        }\n+        else if (node.isObject()) {\n+            log.debug(\"Processing {} as a containing object node.\", fieldName);\n+\n+            TreeNode valueNode = node.path(fieldName);\n+            if (valueNode.isMissingNode()) {\n+                throw new CandlepinJsonProcessingException(\n+                    \"The field \" + fieldName + \" is missing from: \" + node.asToken(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288"}, "originalPosition": 69}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "720066db86da9c0529832498453d2b8c57286288", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/720066db86da9c0529832498453d2b8c57286288", "committedDate": "2020-06-25T07:22:17Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}, "afterCommit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/830c3e90d60fc2b9eecf0fb082f3e11145431463", "committedDate": "2020-06-29T12:18:07Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODE2MDE2", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-440816016", "createdAt": "2020-07-01T12:19:27Z", "commit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxOToyN1rOGrjfoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzo1OTowMVrOGrnHCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMzQ4OA==", "bodyText": "this field should be added in the required: list, and also have the minLength: 1 property added since ConsumerDTO is currently throwing an exception when it's null or empty", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448323488", "createdAt": "2020-07-01T12:19:27Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a reduced view of a consumer (excluding data like facts and identify certificate)\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            uuid:\n+              type: string\n+            name:\n+              type: string\n+            username:\n+              type: string\n+            entitlementStatus:\n+              type: string\n+            serviceLevel:\n+              type: string\n+            role:\n+              type: string\n+            usage:\n+              type: string\n+            addOns:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            systemPurposeStatus:\n+              type: string\n+            releaseVer:\n+              $ref: '#/components/schemas/ReleaseVerDTO'\n+            owner:\n+              $ref: '#/components/schemas/NestedOwnerDTO'\n+            environment:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+            entitlementCount:\n+              type: integer\n+              format: int64\n+            lastCheckin:\n+              type: string\n+              format: date-time\n+            installedProducts:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+            canActivate:\n+              type: boolean\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/CapabilityDTO'\n+            hypervisorId:\n+              $ref: '#/components/schemas/HypervisorIdDTO'\n+            contentTags:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            autoheal:\n+              type: boolean\n+            annotations:\n+              type: string\n+            contentAccessMode:\n+              type: string\n+            type:\n+              $ref: '#/components/schemas/ConsumerTypeDTO'\n+            guestIds:\n+              type: array\n+              items:\n+                $ref: '#/components/schemas/GuestIdDTOArrayElement'\n+            href:\n+              type: string\n+\n+    ConsumerInstalledProductDTO:\n+      description: Represents consumer installed product details\n+      allOf:\n+          - $ref: '#/components/schemas/TimestampedEntity'\n+          - type: object\n+            properties:\n+              id:\n+                type: string\n+              productId:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNDUxMw==", "bodyText": "this field should be added in the required: list, and also have the minLength: 1 property added, since ConsumerDTO is currently throwing an exception when it's null or empty", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448324513", "createdAt": "2020-07-01T12:21:22Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjczMA==", "bodyText": "Since ConsumerDTO is currently throwing an exception when the GuestIdDTO.guestId field is null, we should add that field in the required: list in  GuestIdDTO and GuestIdDTOArrayElement specifications.", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448382730", "createdAt": "2020-07-01T13:59:01Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463"}, "originalPosition": 89}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/830c3e90d60fc2b9eecf0fb082f3e11145431463", "committedDate": "2020-06-29T12:18:07Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}, "afterCommit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "committedDate": "2020-07-02T08:46:15Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTAzNTU2", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-441503556", "createdAt": "2020-07-02T09:23:13Z", "commit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyMzoxM1rOGsExng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyMzoxM1rOGsExng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2ODc2Ng==", "bodyText": "One more thing: the required: property is not recognized in this place, it has to be under the allOf: property (at the same level as properties:) for the annotations to be generated", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448868766", "createdAt": "2020-07-02T09:23:13Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,201 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      required:\n+        - name\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+          minLength: 1\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a reduced view of a consumer (excluding data like facts and identify certificate)\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            uuid:\n+              type: string\n+            name:\n+              type: string\n+            username:\n+              type: string\n+            entitlementStatus:\n+              type: string\n+            serviceLevel:\n+              type: string\n+            role:\n+              type: string\n+            usage:\n+              type: string\n+            addOns:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            systemPurposeStatus:\n+              type: string\n+            releaseVer:\n+              $ref: '#/components/schemas/ReleaseVerDTO'\n+            owner:\n+              $ref: '#/components/schemas/NestedOwnerDTO'\n+            environment:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+            entitlementCount:\n+              type: integer\n+              format: int64\n+            lastCheckin:\n+              type: string\n+              format: date-time\n+            installedProducts:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+            canActivate:\n+              type: boolean\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/CapabilityDTO'\n+            hypervisorId:\n+              $ref: '#/components/schemas/HypervisorIdDTO'\n+            contentTags:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            autoheal:\n+              type: boolean\n+            annotations:\n+              type: string\n+            contentAccessMode:\n+              type: string\n+            type:\n+              $ref: '#/components/schemas/ConsumerTypeDTO'\n+            guestIds:\n+              type: array\n+              items:\n+                $ref: '#/components/schemas/GuestIdDTOArrayElement'\n+            href:\n+              type: string\n+\n+    ConsumerInstalledProductDTO:\n+      description: Represents consumer installed product details\n+      required:\n+        - productId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "originalPosition": 174}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTA0MjI1", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-441504225", "createdAt": "2020-07-02T09:24:06Z", "commit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyNDowN1rOGsEziA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyNDowN1rOGsEziA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTI1Ng==", "bodyText": "Same here, required: needs to be at the same level as properties: is", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448869256", "createdAt": "2020-07-02T09:24:07Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -4202,6 +4397,8 @@ components:\n \n     GuestIdDTO:\n       description: Represents a guest ID running on a virt host consumer\n+      required:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "originalPosition": 206}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTA0Mzc0", "url": "https://github.com/candlepin/candlepin/pull/2732#pullrequestreview-441504374", "createdAt": "2020-07-02T09:24:16Z", "commit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyNDoxNlrOGsEz8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOToyNDoxNlrOGsEz8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTM2MA==", "bodyText": "Same here, required: needs to be at the same level as properties: is", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448869360", "createdAt": "2020-07-02T09:24:16Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -4217,6 +4414,8 @@ components:\n \n     GuestIdDTOArrayElement:\n       description: Represents a guest ID running on a virt host consumer. Does not include the attributes field\n+      required:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be"}, "originalPosition": 215}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b72770793a1bc00acf504eae757bae8aec6244d6", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/b72770793a1bc00acf504eae757bae8aec6244d6", "committedDate": "2020-07-02T11:07:22Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "committedDate": "2020-07-02T08:46:15Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}, "afterCommit": {"oid": "b72770793a1bc00acf504eae757bae8aec6244d6", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/b72770793a1bc00acf504eae757bae8aec6244d6", "committedDate": "2020-07-02T11:07:22Z", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2434, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}