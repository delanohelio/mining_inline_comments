{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NDQ1NDgz", "number": 2715, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjo0MDowMFrOEAfT0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzo0NTo1OVrOEAg7Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTQ4NDM0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjo0MDowMFrOGbzMpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzozNzo1NlrOGb1c2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMzU1Ng==", "bodyText": "We should write these to the log and probably rethrow the exception as well.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431803556", "createdAt": "2020-05-28T12:40:00Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +229,20 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0MDQ3NQ==", "bodyText": "Done.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431840475", "createdAt": "2020-05-28T13:37:56Z", "author": {"login": "Januson"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +229,20 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                e.printStackTrace();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMzU1Ng=="}, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTQ4OTM2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjo0MToyOFrOGbzP0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzozNzo0NVrOGb1cXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwNDM3MA==", "bodyText": "IseException is a REST exception. We should throw something like a ConfigurationException here instead.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431804370", "createdAt": "2020-05-28T12:41:28Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -382,4 +401,15 @@ private void insertValidationEventListeners(Injector injector) {\n         registry.getEventListenerGroup(EventType.PRE_UPDATE).appendListener(listenerProvider.get());\n         registry.getEventListenerGroup(EventType.PRE_DELETE).appendListener(listenerProvider.get());\n     }\n+\n+\n+    private String getCrlFilePath() {\n+        String filePath = config.getString(ConfigProperties.CRL_FILE_PATH);\n+\n+        if (filePath == null) {\n+            throw new IseException(\"CRL file path not defined in config file\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0MDM0OQ==", "bodyText": "Done.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431840349", "createdAt": "2020-05-28T13:37:45Z", "author": {"login": "Januson"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -382,4 +401,15 @@ private void insertValidationEventListeners(Injector injector) {\n         registry.getEventListenerGroup(EventType.PRE_UPDATE).appendListener(listenerProvider.get());\n         registry.getEventListenerGroup(EventType.PRE_DELETE).appendListener(listenerProvider.get());\n     }\n+\n+\n+    private String getCrlFilePath() {\n+        String filePath = config.getString(ConfigProperties.CRL_FILE_PATH);\n+\n+        if (filePath == null) {\n+            throw new IseException(\"CRL file path not defined in config file\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwNDM3MA=="}, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTc0OTIyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzo0NTo1OVrOGb10kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNDozMFrOGb2rHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NjU0NA==", "bodyText": "This one should stay as an IOException, just rethrown.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431846544", "createdAt": "2020-05-28T13:45:59Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +228,21 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                log.error(\"Error occurred during initialization of CRL file!\", e);\n+                throw new ConfigurationException(\"Error occurred during initialization of CRL file!\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MDUxMQ==", "bodyText": "Done.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431860511", "createdAt": "2020-05-28T14:04:30Z", "author": {"login": "Januson"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +228,21 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                log.error(\"Error occurred during initialization of CRL file!\", e);\n+                throw new ConfigurationException(\"Error occurred during initialization of CRL file!\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NjU0NA=="}, "originalCommit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4201, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}