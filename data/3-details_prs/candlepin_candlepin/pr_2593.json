{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4OTIxNTAx", "number": 2593, "title": "ENT-1849: Port AsyncJobStatusDTO to openapi spec", "bodyText": "Added specifications in yaml file\nRemoved existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\nUpdated the populate method of translator\nUpdated JUnit tests", "createdAt": "2020-01-30T07:15:02Z", "url": "https://github.com/candlepin/candlepin/pull/2593", "merged": true, "mergeCommit": {"oid": "89a47b85ca999e3087410a524c4ebf299b46e0bb"}, "closed": true, "closedAt": "2020-01-31T13:15:55Z", "author": {"login": "sonalidhome"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_VSNLgBqjI5OTIyMjU2NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_jq78AFqTM1MTIyNDkwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0042a32cb6cd18ddea519edd14f7e9e846134bf3", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/0042a32cb6cd18ddea519edd14f7e9e846134bf3", "committedDate": "2020-01-30T07:13:13Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}, "afterCommit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/4a8be66e069d050cc7967c8f505301183f2ad8d4", "committedDate": "2020-01-30T07:19:34Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjcyNzgy", "url": "https://github.com/candlepin/candlepin/pull/2593#pullrequestreview-350672782", "createdAt": "2020-01-30T09:15:22Z", "commit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwOToxNToyMlrOFjj6hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwOToyNjo0MlrOFjkPvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzMjkwMg==", "bodyText": "We should be more cautious here, checking for null, and using format instead of concatenation: source.getId() != null ? String.format(\"/jobs/%s\", source.getId()) : null", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372832902", "createdAt": "2020-01-30T09:15:22Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/AsyncJobStatusTranslator.java", "diffHunk": "@@ -58,27 +60,45 @@ public AsyncJobStatusDTO populate(AsyncJobStatus source, AsyncJobStatusDTO desti\n     public AsyncJobStatusDTO populate(ModelTranslator translator, AsyncJobStatus source,\n         AsyncJobStatusDTO destination) {\n \n-        destination = super.populate(translator, source, destination);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (destination == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n+\n+        Date created = source.getCreated();\n+        destination.setCreated(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        destination.setUpdated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);\n \n         destination.setId(source.getId());\n-        destination.setJobKey(source.getJobKey());\n+        destination.setKey(source.getJobKey());\n         destination.setName(source.getName());\n         destination.setGroup(source.getGroup());\n         destination.setOrigin(source.getOrigin());\n         destination.setExecutor(source.getExecutor());\n         destination.setPrincipal(source.getPrincipalName());\n-        destination.setStartTime(source.getStartTime());\n-        destination.setEndTime(source.getEndTime());\n-        destination.setAttempts(source.getAttempts());\n-        destination.setMaxAttempts(source.getMaxAttempts());\n-        destination.setResult(source.getJobResult());\n \n         JobState state = source.getState();\n         destination.setState(state != null ? state.name() : null);\n \n         JobState pstate = source.getPreviousState();\n         destination.setPreviousState(pstate != null ? pstate.name() : null);\n \n+        Date startTime = source.getStartTime();\n+        destination.setStartTime(startTime != null ? startTime.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date endTime = source.getEndTime();\n+        destination.setEndTime(endTime != null ? endTime.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        destination.setAttempts(source.getAttempts());\n+        destination.setMaxAttempts(source.getMaxAttempts());\n+        destination.setStatusPath(\"/jobs/\" + source.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzODMzMg==", "bodyText": "Is this needed? From what I recall there is a conversation in another PR between @abhiskum and @Ceiu that we should not use discriminator.", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372838332", "createdAt": "2020-01-30T09:26:42Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -232,6 +232,61 @@ components:\n             manifest:\n               type: boolean\n \n+    AsyncJobStatusDTO:\n+      description: DTO representing an async job status\n+      discriminator:\n+        propertyName: type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjIxMzk3", "url": "https://github.com/candlepin/candlepin/pull/2593#pullrequestreview-350621397", "createdAt": "2020-01-30T07:25:54Z", "commit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzoyNTo1NFrOFjhazw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzoyNTo1NFrOFjhazw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc5MjAxNQ==", "bodyText": "@sonalidhome Here you can use self-reference setter methods.\ndestination.id(...).key(..).name('..') ...", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372792015", "createdAt": "2020-01-30T07:25:54Z", "author": {"login": "abhiskum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/AsyncJobStatusTranslator.java", "diffHunk": "@@ -58,27 +60,45 @@ public AsyncJobStatusDTO populate(AsyncJobStatus source, AsyncJobStatusDTO desti\n     public AsyncJobStatusDTO populate(ModelTranslator translator, AsyncJobStatus source,\n         AsyncJobStatusDTO destination) {\n \n-        destination = super.populate(translator, source, destination);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (destination == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n+\n+        Date created = source.getCreated();\n+        destination.setCreated(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        destination.setUpdated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);\n \n         destination.setId(source.getId());\n-        destination.setJobKey(source.getJobKey());\n+        destination.setKey(source.getJobKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/4a8be66e069d050cc7967c8f505301183f2ad8d4", "committedDate": "2020-01-30T07:19:34Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}, "afterCommit": {"oid": "9db856d17ce9a85d083dc2f4760331701d09aad3", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/9db856d17ce9a85d083dc2f4760331701d09aad3", "committedDate": "2020-01-30T11:17:49Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "committedDate": "2020-01-30T11:27:00Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9db856d17ce9a85d083dc2f4760331701d09aad3", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/9db856d17ce9a85d083dc2f4760331701d09aad3", "committedDate": "2020-01-30T11:17:49Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}, "afterCommit": {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "committedDate": "2020-01-30T11:27:00Z", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNzc1NTc4", "url": "https://github.com/candlepin/candlepin/pull/2593#pullrequestreview-350775578", "createdAt": "2020-01-30T12:08:18Z", "commit": {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjI0OTA2", "url": "https://github.com/candlepin/candlepin/pull/2593#pullrequestreview-351224906", "createdAt": "2020-01-31T00:05:44Z", "commit": {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2484, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}