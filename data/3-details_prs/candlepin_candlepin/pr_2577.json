{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzQwNDQ1", "number": 2577, "title": "[F] Convert DeletedConsumerResource to the OpenAPI specification (ENT-1871)", "bodyText": "Created new specifications for the deleted consumer resource and deleted consumer DTO\nUpdated DeletedConsumerResource to implement the generated API specification\nDeleted the existing API DeletedConsumerDTO\nDeleted DeletedConsumerDTOTest test\nUpdated DeletedConsumerTranslator as per generated DTO", "createdAt": "2020-01-22T09:08:36Z", "url": "https://github.com/candlepin/candlepin/pull/2577", "merged": true, "mergeCommit": {"oid": "e23a612ce2c5b411a6ddfd4ac14a590aca14f790"}, "closed": true, "closedAt": "2020-02-06T16:59:47Z", "author": {"login": "abhiskum"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8yDSpABqjI5NjkyMjI3OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBtwlUAFqTM1NDYxNDkzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e61ce0cf738284d13074427db6a7eb7a2b780a37", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/e61ce0cf738284d13074427db6a7eb7a2b780a37", "committedDate": "2020-01-22T09:02:16Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DRO"}, "afterCommit": {"oid": "dc7370b0682abfc42af735e2dbe377613b7c49e9", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/dc7370b0682abfc42af735e2dbe377613b7c49e9", "committedDate": "2020-01-22T09:08:56Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc7370b0682abfc42af735e2dbe377613b7c49e9", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/dc7370b0682abfc42af735e2dbe377613b7c49e9", "committedDate": "2020-01-22T09:08:56Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "8c31c4c9f5ef349deccd76f18c63e35d39e54187", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/8c31c4c9f5ef349deccd76f18c63e35d39e54187", "committedDate": "2020-01-22T10:30:34Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c31c4c9f5ef349deccd76f18c63e35d39e54187", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/8c31c4c9f5ef349deccd76f18c63e35d39e54187", "committedDate": "2020-01-22T10:30:34Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "a05f984a53754b8eb8f674d7abec596fcc5058d9", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/a05f984a53754b8eb8f674d7abec596fcc5058d9", "committedDate": "2020-01-23T10:48:15Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzkzNTY4", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-347393568", "createdAt": "2020-01-23T15:36:32Z", "commit": {"oid": "a05f984a53754b8eb8f674d7abec596fcc5058d9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTozNjozM1rOFhCsWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTozNjozM1rOFhCsWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE5MTQ0OA==", "bodyText": "This doesn't actually work in all cases. Since the processing of the stream occurs later, the connection backing the CPQ can close and it'll trigger an exception instead of returning the result.\nFor now, just return the CandlepinQuery object as normal, and set the container type to \"Iterable\" in the yaml.", "url": "https://github.com/candlepin/candlepin/pull/2577#discussion_r370191448", "createdAt": "2020-01-23T15:36:33Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/resource/DeletedConsumerResource.java", "diffHunk": "@@ -51,17 +40,11 @@ public DeletedConsumerResource(DeletedConsumerCurator deletedConsumerCurator,\n         this.translator = translator;\n     }\n \n-    @ApiOperation(\n-        notes = \"Retrieves a list of Deleted Consumers By deletion date or all. \" +\n-        \"List returned is the deleted Consumers.\",\n-        value = \"listByDate\", response = DeletedConsumerDTO.class, responseContainer = \"list\")\n-    @ApiResponses({ @ApiResponse(code = 400, message = \"\"), @ApiResponse(code = 404, message = \"\") })\n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    public CandlepinQuery<DeletedConsumerDTO> listByDate(@QueryParam(\"date\") String dateStr) {\n-        return this.translator.translateQuery(dateStr != null ?\n+    @Override\n+    public Stream<DeletedConsumerDTO> listByDate(String dateStr) {\n+        CandlepinQuery<DeletedConsumerDTO> query = this.translator.translateQuery(dateStr != null ?\n             this.deletedConsumerCurator.findByDate(ResourceDateParser.parseDateString(dateStr)) :\n-            this.deletedConsumerCurator.listAll(),\n-            DeletedConsumerDTO.class);\n+            this.deletedConsumerCurator.listAll(), DeletedConsumerDTO.class);\n+        return StreamSupport.stream(query.spliterator(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05f984a53754b8eb8f674d7abec596fcc5058d9"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a05f984a53754b8eb8f674d7abec596fcc5058d9", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/a05f984a53754b8eb8f674d7abec596fcc5058d9", "committedDate": "2020-01-23T10:48:15Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "5db093f06a4753aa43596594a373087f3aa92d15", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/5db093f06a4753aa43596594a373087f3aa92d15", "committedDate": "2020-01-24T06:35:52Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3OTQ4MTQ0", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-347948144", "createdAt": "2020-01-24T13:22:21Z", "commit": {"oid": "5db093f06a4753aa43596594a373087f3aa92d15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMzoyMjoyMlrOFhddKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMzoyMjoyMlrOFhddKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyOTkzMA==", "bodyText": "Is this the trend we're following to solve the problem of \"DeletedConsumerDTO is not within its bound; should extend org.candlepin.dto.TimestampedCandlepinDTO\"? Turning the extends TimestampedEntityTranslator to implements ObjectTranslator?\n@abhiskum @Ceiu @kahowell", "url": "https://github.com/candlepin/candlepin/pull/2577#discussion_r370629930", "createdAt": "2020-01-24T13:22:22Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/DeletedConsumerTranslator.java", "diffHunk": "@@ -15,14 +15,16 @@\n package org.candlepin.dto.api.v1;\n \n import org.candlepin.dto.ModelTranslator;\n-import org.candlepin.dto.TimestampedEntityTranslator;\n+import org.candlepin.dto.ObjectTranslator;\n import org.candlepin.model.DeletedConsumer;\n \n+import java.time.ZoneOffset;\n+import java.util.Date;\n+\n /**\n  * This translator provides translation from DeletedConsumer model objects to DeletedConsumerDTOs\n  */\n-public class DeletedConsumerTranslator extends\n-    TimestampedEntityTranslator<DeletedConsumer, DeletedConsumerDTO> {\n+public class DeletedConsumerTranslator implements ObjectTranslator<DeletedConsumer, DeletedConsumerDTO> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5db093f06a4753aa43596594a373087f3aa92d15"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5db093f06a4753aa43596594a373087f3aa92d15", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/5db093f06a4753aa43596594a373087f3aa92d15", "committedDate": "2020-01-24T06:35:52Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "c216ff56a63b16616e2346cb7d474516b9544d57", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/c216ff56a63b16616e2346cb7d474516b9544d57", "committedDate": "2020-01-26T11:26:12Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c216ff56a63b16616e2346cb7d474516b9544d57", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/c216ff56a63b16616e2346cb7d474516b9544d57", "committedDate": "2020-01-26T11:26:12Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "66fae1764e8955ecdbe3a4b5ce754597eb6c753b", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/66fae1764e8955ecdbe3a4b5ce754597eb6c753b", "committedDate": "2020-01-29T00:01:25Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjEwNTk0", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-350210594", "createdAt": "2020-01-29T15:46:14Z", "commit": {"oid": "66fae1764e8955ecdbe3a4b5ce754597eb6c753b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzM2Njkx", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-350336691", "createdAt": "2020-01-29T18:41:04Z", "commit": {"oid": "66fae1764e8955ecdbe3a4b5ce754597eb6c753b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66fae1764e8955ecdbe3a4b5ce754597eb6c753b", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/66fae1764e8955ecdbe3a4b5ce754597eb6c753b", "committedDate": "2020-01-29T00:01:25Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426", "committedDate": "2020-02-03T05:40:12Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMzY4MTM0", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-352368134", "createdAt": "2020-02-03T16:04:14Z", "commit": {"oid": "9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNjowNDoxNVrOFk2tFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNjowNDoxNVrOFk2tFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4OTMzNA==", "bodyText": "Maybe something like \"filter deleted consumers to those on or after this date\"?", "url": "https://github.com/candlepin/candlepin/pull/2577#discussion_r374189334", "createdAt": "2020-02-03T16:04:15Z", "author": {"login": "kahowell"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -193,6 +193,50 @@ paths:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n \n+  /deleted_consumers:\n+    get:\n+      description: Retrieves a list of Deleted Consumers By deletion date or all. List returned is the deleted Consumers.\n+      tags:\n+        - Consumer\n+        - DeletedConsumer\n+      operationId: listByDate\n+      parameters:\n+        - in: query\n+          name: date\n+          schema:\n+            type: string\n+          description: ''", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c5280b34cc615c9ceba2bbd87510a48e98265d", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/21c5280b34cc615c9ceba2bbd87510a48e98265d", "committedDate": "2020-02-04T03:55:51Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/9c0b95f0c0daea6ca3e3cc26427bbf3fde3bf426", "committedDate": "2020-02-03T05:40:12Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}, "afterCommit": {"oid": "21c5280b34cc615c9ceba2bbd87510a48e98265d", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/21c5280b34cc615c9ceba2bbd87510a48e98265d", "committedDate": "2020-02-04T03:55:51Z", "message": "Convert DeletedConsumerResource to the OpenAPI specification\n - Created new specifications for the deleted consumer resource and deleted consumer DTO\n - Updated DeletedConsumerResource to implement the generated API specification\n - Deleted the existing API DeletedConsumerDTO\n - Deleted DeletedConsumerDTOTest test\n - Updated DeletedConsumerTranslator as per generated DTO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDk2NDIx", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-354496421", "createdAt": "2020-02-06T14:36:18Z", "commit": {"oid": "21c5280b34cc615c9ceba2bbd87510a48e98265d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjE0OTM1", "url": "https://github.com/candlepin/candlepin/pull/2577#pullrequestreview-354614935", "createdAt": "2020-02-06T16:58:48Z", "commit": {"oid": "21c5280b34cc615c9ceba2bbd87510a48e98265d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2465, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}