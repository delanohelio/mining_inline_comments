{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MDIyMDkx", "number": 2682, "title": "ENT-1859: Port EnvironmentDTO to openapi spec", "bodyText": "Updated candlepin YAML file.\nRemoved EnvironmentDTO & EnvironmentDTOTest files.\nUpdated EnvironmentTranslator & other related tests.", "createdAt": "2020-04-17T09:24:03Z", "url": "https://github.com/candlepin/candlepin/pull/2682", "merged": true, "mergeCommit": {"oid": "450dd91d29ad4b57a794f20b0df4fb35d065bd60"}, "closed": true, "closedAt": "2020-04-20T09:15:24Z", "author": {"login": "wolfdale"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYgjZCgFqTM5NTQwNDYwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZYGWngBqjMyNTAxMDc1NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDA0NjA3", "url": "https://github.com/candlepin/candlepin/pull/2682#pullrequestreview-395404607", "createdAt": "2020-04-17T12:20:43Z", "commit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoyMDo0M1rOGHLufg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoyMDo0M1rOGHLufg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg==", "bodyText": "I hope this will not change the API schema defination. Previously it was not unique.", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410185342", "createdAt": "2020-04-17T12:20:43Z", "author": {"login": "sonalidhome"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1265,6 +1265,35 @@ components:\n           type: string\n           minLength: 1\n \n+    EnvironmentDTO:\n+      description: DTO representing an environment\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+            description:\n+              type: string\n+            owner:\n+              $ref: \"#/components/schemas/NestedOwnerDTO\"\n+            environmentContent:\n+              type: array\n+              uniqueItems: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDQxMjUz", "url": "https://github.com/candlepin/candlepin/pull/2682#pullrequestreview-395441253", "createdAt": "2020-04-17T13:13:47Z", "commit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMzoxMzo0N1rOGHNatg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMzoyNjoxNVrOGHN3zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxMzA0Ng==", "bodyText": "It should be fine, because even thougn now it is a Collection<>, before the DTO was created we were using the Environment.java model entity, which uses a Set, so we should be fine", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410213046", "createdAt": "2020-04-17T13:13:47Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1265,6 +1265,35 @@ components:\n           type: string\n           minLength: 1\n \n+    EnvironmentDTO:\n+      description: DTO representing an environment\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+            description:\n+              type: string\n+            owner:\n+              $ref: \"#/components/schemas/NestedOwnerDTO\"\n+            environmentContent:\n+              type: array\n+              uniqueItems: true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg=="}, "originalCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxNDYxNg==", "bodyText": "Since we're trying to have this spec also be a good source of documentation, we should provide better descriptions.\nA good guideline for all descriptions is: Try to use information from the model entity's class javadoc comment (in this case Environment.java), instead of from the DTO, because our DTOs don't have useful documentation (it's always something like \"A DTO representation of X entity\"). Then, take that and try to distill it to not have any implementation details, and be concise. In this case it could be something like: \"Represents an environment within an org used to enable/disable/promote content in specific places\"", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410214616", "createdAt": "2020-04-17T13:16:30Z", "author": {"login": "nikosmoum"}, "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1265,6 +1265,35 @@ components:\n           type: string\n           minLength: 1\n \n+    EnvironmentDTO:\n+      description: DTO representing an environment", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyMDQ5Mg==", "bodyText": "Nitpick: No need for Arrays.asList here if only 1 element is being added, you can create empty HashSet and then add it", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410220492", "createdAt": "2020-04-17T13:26:15Z", "author": {"login": "nikosmoum"}, "path": "server/src/test/java/org/candlepin/dto/api/v1/ConsumerDTOTest.java", "diffHunk": "@@ -92,6 +92,22 @@ public ConsumerDTOTest() {\n \n         NestedOwnerDTO owner = new NestedOwnerDTO().id(\"OwnerId\").displayName(\"Name\").key(\"12345\");\n \n+        ContentDTO cDTO = new ContentDTO()\n+            .id(\"ContentId\")\n+            .name(\"ContentName\")\n+            .modifiedProductIds(new HashSet<>(Arrays.asList(\"ID1\", \"ID2\")));\n+\n+        Set<EnvironmentContentDTO> envContentDTO = new HashSet<>(Arrays.asList(new EnvironmentContentDTO()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDc5NTI2", "url": "https://github.com/candlepin/candlepin/pull/2682#pullrequestreview-395479526", "createdAt": "2020-04-17T14:00:17Z", "commit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNDowMDoxN1rOGHPNiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNDowMDoxN1rOGHPNiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0MjQ0MQ==", "bodyText": "One more minor change, that we could apply in general from now on: Use org.candlepin.util.Util.toDateTime() to as a utility converter from Date to OffsetDateTime", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410242441", "createdAt": "2020-04-17T14:00:17Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/dto/api/v1/EnvironmentTranslator.java", "diffHunk": "@@ -64,35 +62,48 @@ public EnvironmentDTO populate(Environment source, EnvironmentDTO dest) {\n     public EnvironmentDTO populate(ModelTranslator translator, Environment source,\n         EnvironmentDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDescription(source.getDescription());\n+        Date created = source.getCreated();\n+        dest.created(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        dest.updated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a00a36345c1ccb67d1428190ee783b61d83c6511", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/a00a36345c1ccb67d1428190ee783b61d83c6511", "committedDate": "2020-04-20T05:17:18Z", "message": "ENT-1859: Port EnvironmentDTO to openapi spec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a90f0addd888d84307c8edc083b076b62f8ab325", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/a90f0addd888d84307c8edc083b076b62f8ab325", "committedDate": "2020-04-17T09:08:33Z", "message": "ENT-1859: Port EnvironmentDTO to openapi spec"}, "afterCommit": {"oid": "a00a36345c1ccb67d1428190ee783b61d83c6511", "author": {"user": {"login": "wolfdale", "name": "Prakhar Gupta"}}, "url": "https://github.com/candlepin/candlepin/commit/a00a36345c1ccb67d1428190ee783b61d83c6511", "committedDate": "2020-04-20T05:17:18Z", "message": "ENT-1859: Port EnvironmentDTO to openapi spec"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2375, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}