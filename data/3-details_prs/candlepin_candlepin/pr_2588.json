{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4Mzk0NDQ5", "number": 2588, "title": "[F] Fetch provided products from pool.product (ENT-2026)", "bodyText": "Updated Product.java to cache provided products\nUpdated Pool.java to populate providedProductDtos from product.providedProducts\nUpdated code to fetch provided products from pool.product.providedProducts\nUpdated Junit and rspec based on these changes", "createdAt": "2020-01-29T06:30:20Z", "url": "https://github.com/candlepin/candlepin/pull/2588", "merged": true, "mergeCommit": {"oid": "f8850967c6fd4149dd9474c220024957fd9a733f"}, "closed": true, "closedAt": "2020-01-31T10:42:31Z", "author": {"login": "abhiskum"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_AA1QABqjI5ODgzMzA5Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_sxzpgFqTM1MTQyMjM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "843ba50e12f2c5c548049e84bd25433451b765e9", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/843ba50e12f2c5c548049e84bd25433451b765e9", "committedDate": "2020-01-29T06:27:29Z", "message": "Fetch provided products from pool.product"}, "afterCommit": {"oid": "4d14d199daba2ede8bb1483b140d8df865093c3c", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/4d14d199daba2ede8bb1483b140d8df865093c3c", "committedDate": "2020-01-29T06:32:42Z", "message": "Fetch provided products from pool.product"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d14d199daba2ede8bb1483b140d8df865093c3c", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/4d14d199daba2ede8bb1483b140d8df865093c3c", "committedDate": "2020-01-29T06:32:42Z", "message": "Fetch provided products from pool.product"}, "afterCommit": {"oid": "80fb6c10d64bc362bed457f42bf137de8b91d099", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/80fb6c10d64bc362bed457f42bf137de8b91d099", "committedDate": "2020-01-29T10:54:32Z", "message": "Fetch provided products from pool.product"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTIwMjE1", "url": "https://github.com/candlepin/candlepin/pull/2588#pullrequestreview-349920215", "createdAt": "2020-01-29T08:07:35Z", "commit": {"oid": "4d14d199daba2ede8bb1483b140d8df865093c3c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwODowNzozNlrOFi_jsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNDozNzo1M1rOFjKpAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIzNzIzMw==", "bodyText": "There should probably be a newline at the end of the file here", "url": "https://github.com/candlepin/candlepin/pull/2588#discussion_r372237233", "createdAt": "2020-01-29T08:07:36Z", "author": {"login": "nikosmoum"}, "path": "server/spec/sku_level_enable_override_spec.rb", "diffHunk": "@@ -165,4 +175,4 @@\n     extensions_hash = Hash[x509.extensions.collect { |ext| [ext.oid, ext.value] }]\n     extensions_hash[\"1.3.6.1.4.1.2312.9.2.#{@content3['id']}.1.8\"].should == '..1'\n   end\n-end\n+end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d14d199daba2ede8bb1483b140d8df865093c3c"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQxODgxOA==", "bodyText": "I'm trying to find out if this change is enough or not. From what I can find out, the code in the productCurator.getPoolProvidedProductsCached() method was added in a0986b4 as an attempt for better performance by caching provided products in JCache, and to use these methods on the curator instead of the pool.getProvidedProducts/derivedProvidedProducts getters. This was later changed by @barnabycourt to use Hibernate L2 cache in 404af50.\nMy assumption is that the original mechanism with the productCurator methods is no longer needed, because Product is already immutable and cachable in hibernate L2, and the only thing we'd need to do is mark the providedProducts collection on Product with @Cachable and @Cache(usage = CacheConcurrencyStrategy.READ_ONLY), just like the other collections, and caching will work implicitly (without using the productCurator workarounds).\n@Ceiu @barnabycourt Are my assumptions correct, or am I missing something?", "url": "https://github.com/candlepin/candlepin/pull/2588#discussion_r372418818", "createdAt": "2020-01-29T14:37:53Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/service/impl/DefaultEntitlementCertServiceAdapter.java", "diffHunk": "@@ -461,7 +461,7 @@ public String cleanUpPrefix(String contentPrefix) throws IOException {\n                 ent.getQuantity(),\n                 ent.getId());\n \n-            Set<Product> products = new HashSet<>(productCurator.getPoolProvidedProductsCached(pool));\n+            Set<Product> products = new HashSet<>(pool.getProduct().getProvidedProducts());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80fb6c10d64bc362bed457f42bf137de8b91d099"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "committedDate": "2020-01-30T10:45:05Z", "message": "Fetch provided products from pool.product\n  - Updated Product.java to cache provided products\n  - Updated Pool.java to populate providedProductDtos from product.providedProducts\n  - Updated code to fetch provided products from pool.product.providedProducts\n  - Updated Junit and rspec based on these changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80fb6c10d64bc362bed457f42bf137de8b91d099", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/80fb6c10d64bc362bed457f42bf137de8b91d099", "committedDate": "2020-01-29T10:54:32Z", "message": "Fetch provided products from pool.product"}, "afterCommit": {"oid": "f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "author": {"user": {"login": "abhiskum", "name": "Abhishek Kumar"}}, "url": "https://github.com/candlepin/candlepin/commit/f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "committedDate": "2020-01-30T10:45:05Z", "message": "Fetch provided products from pool.product\n  - Updated Product.java to cache provided products\n  - Updated Pool.java to populate providedProductDtos from product.providedProducts\n  - Updated code to fetch provided products from pool.product.providedProducts\n  - Updated Junit and rspec based on these changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDIyMzY4", "url": "https://github.com/candlepin/candlepin/pull/2588#pullrequestreview-351422368", "createdAt": "2020-01-31T10:42:23Z", "commit": {"oid": "f1d5a968af42cfbeb5d5af8271c138ba604fd32d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2474, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}