{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNzI2NTQ1", "number": 2707, "title": "1836973 - Listing pools available for an activation_key lists pools", "bodyText": "already in the key.\n\nFixed the condition to add pool into filtered pools\nAdded a spec test to validate the activation key filter is working", "createdAt": "2020-05-22T05:41:25Z", "url": "https://github.com/candlepin/candlepin/pull/2707", "merged": true, "mergeCommit": {"oid": "ff15e9d6b87a495900a4c2dc8227fe40b4f4bfca"}, "closed": true, "closedAt": "2020-05-22T12:25:35Z", "author": {"login": "sonalidhome"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjvBxHAFqTQxNjc4MTIyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjwUXPgBqjMzNjQyODg5MDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzgxMjI2", "url": "https://github.com/candlepin/candlepin/pull/2707#pullrequestreview-416781226", "createdAt": "2020-05-22T09:40:20Z", "commit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0MDoyMFrOGZRFFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0MDoyMFrOGZRFFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0NzQxNA==", "bodyText": "The issue here was that a new piece of data (errorKeys) was added to ValidationResult in addition to errors, which is not taken into account by the isSuccessful method. This will work, but I think to future-proof the use of the isSuccessful method (which is used elsewhere, and in the future when we move more code from rules.js to Java, the same bug will appear there too), we should leave this check as it was and simply alter ValidationResult.isSuccessful to more correctly check both errors and errorKeys as such: return !hasErrors() && !hasErrorKeys();", "url": "https://github.com/candlepin/candlepin/pull/2707#discussion_r429147414", "createdAt": "2020-05-22T09:40:20Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "diffHunk": "@@ -2605,7 +2605,7 @@ public void updatePoolsFromStackWithoutDeletingStack(Consumer consumer, List<Poo\n         List<Pool> filteredPools = new LinkedList<>();\n         for (Pool p : pools) {\n             ValidationResult result = activationKeyRules.runPoolValidationForActivationKey(key, p, null);\n-            if (result.isSuccessful() && (!result.hasWarnings() || includeWarnings)) {\n+            if (!result.hasErrorKeys() && (!result.hasWarnings() || includeWarnings)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1f8295aaca48890d724b76fb4cd9cb24e5e0d34", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/f1f8295aaca48890d724b76fb4cd9cb24e5e0d34", "committedDate": "2020-05-22T10:24:15Z", "message": "1836973 - Listing pools available for an activation_key lists\npools already in the key\n - Fixed the isSuccesful() condition to add pool into filtered pools\n - Added a spec test to validate the activation key filter is working"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/ea08f7c66a5621b8ad28bd2bb898c5855f34d04c", "committedDate": "2020-05-22T05:40:35Z", "message": "1836973 - Listing pools available for an activation_key lists\npools already in the key\n - Fixed the condition to add pool into filtered pools\n - Added a spec test to validate the activation key filter is working"}, "afterCommit": {"oid": "f1f8295aaca48890d724b76fb4cd9cb24e5e0d34", "author": {"user": {"login": "sonalidhome", "name": "Sonali Dhome"}}, "url": "https://github.com/candlepin/candlepin/commit/f1f8295aaca48890d724b76fb4cd9cb24e5e0d34", "committedDate": "2020-05-22T10:24:15Z", "message": "1836973 - Listing pools available for an activation_key lists\npools already in the key\n - Fixed the isSuccesful() condition to add pool into filtered pools\n - Added a spec test to validate the activation key filter is working"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2409, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}