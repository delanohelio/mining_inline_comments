{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NDQ1NDgz", "number": 2715, "title": "1834762: crl file candlepin-crl.crl is not found on the candlepin server", "bodyText": "Added a check to initialize the CRL file if it is missing during the Candlepin startup", "createdAt": "2020-05-28T12:13:05Z", "url": "https://github.com/candlepin/candlepin/pull/2715", "merged": true, "mergeCommit": {"oid": "580550841a32e070cb819707c41d659be57dfa4b"}, "closed": true, "closedAt": "2020-05-28T20:14:13Z", "author": {"login": "Januson"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcltNwZAFqTQyMDA2NDk5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclzrppgFqTQyMDQ1NzgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDY0OTk4", "url": "https://github.com/candlepin/candlepin/pull/2715#pullrequestreview-420064998", "createdAt": "2020-05-28T12:40:00Z", "commit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjo0MDowMFrOGbzMpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjo0MToyOFrOGbzP0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMzU1Ng==", "bodyText": "We should write these to the log and probably rethrow the exception as well.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431803556", "createdAt": "2020-05-28T12:40:00Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +229,20 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwNDM3MA==", "bodyText": "IseException is a REST exception. We should throw something like a ConfigurationException here instead.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431804370", "createdAt": "2020-05-28T12:41:28Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -382,4 +401,15 @@ private void insertValidationEventListeners(Injector injector) {\n         registry.getEventListenerGroup(EventType.PRE_UPDATE).appendListener(listenerProvider.get());\n         registry.getEventListenerGroup(EventType.PRE_DELETE).appendListener(listenerProvider.get());\n     }\n+\n+\n+    private String getCrlFilePath() {\n+        String filePath = config.getString(ConfigProperties.CRL_FILE_PATH);\n+\n+        if (filePath == null) {\n+            throw new IseException(\"CRL file path not defined in config file\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d"}, "originalPosition": 75}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d", "committedDate": "2020-05-28T12:07:12Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}, "afterCommit": {"oid": "9cfbb59683afbf8786f43026a04b43a59e277b7b", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/9cfbb59683afbf8786f43026a04b43a59e277b7b", "committedDate": "2020-05-28T13:29:57Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cfbb59683afbf8786f43026a04b43a59e277b7b", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/9cfbb59683afbf8786f43026a04b43a59e277b7b", "committedDate": "2020-05-28T13:29:57Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}, "afterCommit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "committedDate": "2020-05-28T13:41:33Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMTIyNTA2", "url": "https://github.com/candlepin/candlepin/pull/2715#pullrequestreview-420122506", "createdAt": "2020-05-28T13:45:59Z", "commit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzo0NTo1OVrOGb10kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzo0NTo1OVrOGb10kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NjU0NA==", "bodyText": "This one should stay as an IOException, just rethrown.", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431846544", "createdAt": "2020-05-28T13:45:59Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +228,21 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                log.error(\"Error occurred during initialization of CRL file!\", e);\n+                throw new ConfigurationException(\"Error occurred during initialization of CRL file!\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cb771cf66a28dd1d0ab43156e634233c0038055", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/2cb771cf66a28dd1d0ab43156e634233c0038055", "committedDate": "2020-05-28T14:03:37Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "committedDate": "2020-05-28T13:41:33Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}, "afterCommit": {"oid": "2cb771cf66a28dd1d0ab43156e634233c0038055", "author": {"user": {"login": "Januson", "name": null}}, "url": "https://github.com/candlepin/candlepin/commit/2cb771cf66a28dd1d0ab43156e634233c0038055", "committedDate": "2020-05-28T14:03:37Z", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDU3ODI1", "url": "https://github.com/candlepin/candlepin/pull/2715#pullrequestreview-420457825", "createdAt": "2020-05-28T20:14:07Z", "commit": {"oid": "2cb771cf66a28dd1d0ab43156e634233c0038055"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2416, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}