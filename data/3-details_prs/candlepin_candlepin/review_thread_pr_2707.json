{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNzI2NTQ1", "number": 2707, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0MDoyMFrOD-5B4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0MDoyMFrOD-5B4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MjcyNjcyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0MDoyMFrOGZRFFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjowOTowMVrOGaPz2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0NzQxNA==", "bodyText": "The issue here was that a new piece of data (errorKeys) was added to ValidationResult in addition to errors, which is not taken into account by the isSuccessful method. This will work, but I think to future-proof the use of the isSuccessful method (which is used elsewhere, and in the future when we move more code from rules.js to Java, the same bug will appear there too), we should leave this check as it was and simply alter ValidationResult.isSuccessful to more correctly check both errors and errorKeys as such: return !hasErrors() && !hasErrorKeys();", "url": "https://github.com/candlepin/candlepin/pull/2707#discussion_r429147414", "createdAt": "2020-05-22T09:40:20Z", "author": {"login": "nikosmoum"}, "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "diffHunk": "@@ -2605,7 +2605,7 @@ public void updatePoolsFromStackWithoutDeletingStack(Consumer consumer, List<Poo\n         List<Pool> filteredPools = new LinkedList<>();\n         for (Pool p : pools) {\n             ValidationResult result = activationKeyRules.runPoolValidationForActivationKey(key, p, null);\n-            if (result.isSuccessful() && (!result.hasWarnings() || includeWarnings)) {\n+            if (!result.hasErrorKeys() && (!result.hasWarnings() || includeWarnings)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE4NjI5MA==", "bodyText": "Done.", "url": "https://github.com/candlepin/candlepin/pull/2707#discussion_r429186290", "createdAt": "2020-05-22T11:11:28Z", "author": {"login": "sonalidhome"}, "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "diffHunk": "@@ -2605,7 +2605,7 @@ public void updatePoolsFromStackWithoutDeletingStack(Consumer consumer, List<Poo\n         List<Pool> filteredPools = new LinkedList<>();\n         for (Pool p : pools) {\n             ValidationResult result = activationKeyRules.runPoolValidationForActivationKey(key, p, null);\n-            if (result.isSuccessful() && (!result.hasWarnings() || includeWarnings)) {\n+            if (!result.hasErrorKeys() && (!result.hasWarnings() || includeWarnings)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0NzQxNA=="}, "originalCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMzExNA==", "bodyText": "Is there a reason we don't just fix isSuccessful and any places that break as a consequence of that fix? Seems like a trap to leave a method like that around that doesn't check what its name implies.", "url": "https://github.com/candlepin/candlepin/pull/2707#discussion_r429433114", "createdAt": "2020-05-22T20:06:46Z", "author": {"login": "Ceiu"}, "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "diffHunk": "@@ -2605,7 +2605,7 @@ public void updatePoolsFromStackWithoutDeletingStack(Consumer consumer, List<Poo\n         List<Pool> filteredPools = new LinkedList<>();\n         for (Pool p : pools) {\n             ValidationResult result = activationKeyRules.runPoolValidationForActivationKey(key, p, null);\n-            if (result.isSuccessful() && (!result.hasWarnings() || includeWarnings)) {\n+            if (!result.hasErrorKeys() && (!result.hasWarnings() || includeWarnings)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0NzQxNA=="}, "originalCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3NTE5Mg==", "bodyText": "The method isSuccessful() is being updated with return !hasErrors() && !hasErrorKeys();. Also the above change in CandlepinPoolManager.java is reverted. Is there anything else that needs to be done?", "url": "https://github.com/candlepin/candlepin/pull/2707#discussion_r430175192", "createdAt": "2020-05-26T06:09:01Z", "author": {"login": "sonalidhome"}, "path": "server/src/main/java/org/candlepin/controller/CandlepinPoolManager.java", "diffHunk": "@@ -2605,7 +2605,7 @@ public void updatePoolsFromStackWithoutDeletingStack(Consumer consumer, List<Poo\n         List<Pool> filteredPools = new LinkedList<>();\n         for (Pool p : pools) {\n             ValidationResult result = activationKeyRules.runPoolValidationForActivationKey(key, p, null);\n-            if (result.isSuccessful() && (!result.hasWarnings() || includeWarnings)) {\n+            if (!result.hasErrorKeys() && (!result.hasWarnings() || includeWarnings)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0NzQxNA=="}, "originalCommit": {"oid": "ea08f7c66a5621b8ad28bd2bb898c5855f34d04c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4191, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}