{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMjg0NDAw", "number": 1465, "title": "Ignore non-literal arg names in LogsafeArgName", "bodyText": "Before this PR\nThe LogsafeArgName check would fail if using a compile time constant identifier (static final variables) for args names.\nThis fails with the following exception:\njava.lang.AssertionError: An unhandled exception was thrown by the Error Prone static analysis plugin.\n     Please report this at https://github.com/google/error-prone/issues/new and include the following:\n  \n     error-prone version: 2.4.0\n     BugPattern: LogsafeArgName\n     Stack Trace:\n     java.lang.ClassCastException: class com.sun.tools.javac.tree.JCTree$JCIdent cannot be cast to class com.sun.tools.javac.tree.JCTree$JCLiteral (com.sun.tools.javac.tree.JCTree$JCIdent and com.sun.tools.javac.tree.JCTree$JCLiteral are in module jdk.compiler of loader 'app')\n  \tat com.palantir.baseline.errorprone.LogsafeArgName.matchMethodInvocation(LogsafeArgName.java:77)\n  \tat com.google.errorprone.scanner.ErrorProneScanner.processMatchers(ErrorProneScanner.java:451)\n\nAfter this PR\nThe LogsafeArgName ignores arg names that are not literals.", "createdAt": "2020-08-03T16:45:40Z", "url": "https://github.com/palantir/gradle-baseline/pull/1465", "merged": true, "mergeCommit": {"oid": "8524f81b9b8c35dce6474ebe34b515d1d791a116"}, "closed": true, "closedAt": "2020-08-03T17:01:12Z", "author": {"login": "pkoenig10"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7U0lUgH2gAyNDYyMjg0NDAwOmM1NTllOGY4ZTUyYmYwNmE4MTZkNzQyMjk2NTVkOWU1M2ZmODAwMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7VATUgFqTQ2MDE4NjY1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c559e8f8e52bf06a816d74229655d9e53ff80033", "author": {"user": {"login": "pkoenig10", "name": "Patrick Koenig"}}, "url": "https://github.com/palantir/gradle-baseline/commit/c559e8f8e52bf06a816d74229655d9e53ff80033", "committedDate": "2020-08-03T16:43:09Z", "message": "Ignore non-literal arg names in LogsafeArgName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82bfb2815b3c1de891b032bd504e7735b154f1db", "author": {"user": {"login": "pkoenig10", "name": "Patrick Koenig"}}, "url": "https://github.com/palantir/gradle-baseline/commit/82bfb2815b3c1de891b032bd504e7735b154f1db", "committedDate": "2020-08-03T16:43:09Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMTgxMzc2", "url": "https://github.com/palantir/gradle-baseline/pull/1465#pullrequestreview-460181376", "createdAt": "2020-08-03T16:47:54Z", "commit": {"oid": "82bfb2815b3c1de891b032bd504e7735b154f1db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo0Nzo1NFrOG7A61A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNjo0Nzo1NFrOG7A61A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNDIyOA==", "bodyText": "nit: we might as well combine these two conditional expressions.", "url": "https://github.com/palantir/gradle-baseline/pull/1465#discussion_r464534228", "createdAt": "2020-08-03T16:47:54Z", "author": {"login": "carterkozak"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/LogsafeArgName.java", "diffHunk": "@@ -73,15 +73,17 @@ public Description matchMethodInvocation(MethodInvocationTree tree, VisitorState\n         List<? extends ExpressionTree> args = tree.getArguments();\n         ExpressionTree argNameExpression = args.get(0);\n         if (compileTimeConstExpressionMatcher.matches(argNameExpression, state)) {\n-            String argName = (String) ((JCTree.JCLiteral) argNameExpression).getValue();\n-            if (unsafeParamNames.stream().anyMatch(unsafeArgName -> unsafeArgName.equalsIgnoreCase(argName))) {\n-                SuggestedFix.Builder builder = SuggestedFix.builder();\n-                String unsafeArg = SuggestedFixes.qualifyType(state, builder, \"com.palantir.logsafe.UnsafeArg\");\n-                return buildDescription(tree)\n-                        .setMessage(\"Arguments with name '\" + argName + \"' must be marked as unsafe.\")\n-                        .addFix(builder.replace(tree.getMethodSelect(), unsafeArg + \".of\")\n-                                .build())\n-                        .build();\n+            if (argNameExpression instanceof JCTree.JCLiteral) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82bfb2815b3c1de891b032bd504e7735b154f1db"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0aa047d5f2d313e27482df7b94780a7227d13d0", "author": {"user": {"login": "pkoenig10", "name": "Patrick Koenig"}}, "url": "https://github.com/palantir/gradle-baseline/commit/e0aa047d5f2d313e27482df7b94780a7227d13d0", "committedDate": "2020-08-03T16:51:37Z", "message": "Combine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24ee9061c8139a0f0eb993e1016a97f273ad7f2d", "author": {"user": {"login": "pkoenig10", "name": "Patrick Koenig"}}, "url": "https://github.com/palantir/gradle-baseline/commit/24ee9061c8139a0f0eb993e1016a97f273ad7f2d", "committedDate": "2020-08-03T16:54:20Z", "message": "Clean up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMTg2NjU0", "url": "https://github.com/palantir/gradle-baseline/pull/1465#pullrequestreview-460186654", "createdAt": "2020-08-03T16:55:57Z", "commit": {"oid": "24ee9061c8139a0f0eb993e1016a97f273ad7f2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2077, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}