{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODM1MDQy", "number": 1487, "title": "Fix baseline-exact-dependencies with new GCV", "bodyText": "Before this PR\ncom.palantir.baseline-exact-dependencies tries to copy over constraints from <source-set>CompileClasspath, in order to pick up versions.lock constraints generated by GCV.\nHowever, after palantir/gradle-consistent-versions#557, these are no longer implemented as explicit constraints inherited by that configuration (which would have shown up in compileClasspath.getAllDependencyConstraints()), but instead GCV uses a dependency to a configuration on the root project, which itself holds these constraints in a single centralized place.\nThis means that the configuration resolved by tasks like checkUnusedDependenciesMain etc now lacks versions.lock constraints, leading to weird outcomes including flakes.\nAfter this PR\n==COMMIT_MSG==\nFix com.palantir.baseline-exact-dependencies to work with GCV 1.26.0+.\n==COMMIT_MSG==\nPossible downsides?", "createdAt": "2020-09-02T13:50:02Z", "url": "https://github.com/palantir/gradle-baseline/pull/1487", "merged": true, "mergeCommit": {"oid": "cc5217a66cf74ea7199934585d37469d0e944579"}, "closed": true, "closedAt": "2020-09-02T17:02:14Z", "author": {"login": "dansanduleac"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE8MV3gH2gAyNDc3ODM1MDQyOjg2OTFiZWZkYTI1YTAxMjEyMTg0NWQyODBkYjg0ZmI4NDY3ZmE2ZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE-tdZAFqTQ4MTAwMjEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8691befda25a012121845d280db84fb8467fa6fe", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/8691befda25a012121845d280db84fb8467fa6fe", "committedDate": "2020-09-02T13:40:43Z", "message": "Fix baseline-exact-dependencies with new GCV"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f9b59fa6f2f96154cf40c6b1e3844e9fb50ba8b", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/9f9b59fa6f2f96154cf40c6b1e3844e9fb50ba8b", "committedDate": "2020-09-02T13:52:07Z", "message": "qualify picking up gcv locks on whether gcv is applied"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9142595781bd5428fa491761f78849f0757f630", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/c9142595781bd5428fa491761f78849f0757f630", "committedDate": "2020-09-02T13:52:07Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDAyMTI4", "url": "https://github.com/palantir/gradle-baseline/pull/1487#pullrequestreview-481002128", "createdAt": "2020-09-02T16:36:41Z", "commit": {"oid": "c9142595781bd5428fa491761f78849f0757f630"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjozNjo0MlrOHL3sAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjozNjo0MlrOHL3sAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIwODc3MA==", "bodyText": "Feels quite weird to have this direct knowledge of GCV here? Will this still work with old GCV?", "url": "https://github.com/palantir/gradle-baseline/pull/1487#discussion_r482208770", "createdAt": "2020-09-02T16:36:42Z", "author": {"login": "CRogers"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineExactDependencies.java", "diffHunk": "@@ -153,9 +153,13 @@ private static void configureSourceSet(\n         });\n \n         explicitCompile.withDependencies(deps -> {\n-            // Mirror the transitive constraints form compileClasspath in order to pick up GCV locks.\n-            // We should really do this with an addAllLater but that would require Gradle 6, or a hacky workaround.\n-            explicitCompile.getDependencyConstraints().addAll(compileClasspath.getAllDependencyConstraints());\n+            // Pick up GCV locks. We're making an internal assumption that this configuration exists,\n+            // but we can rely on this since we control GCV.\n+            // Alternatively, we could tell GCV to lock this configuration, at the cost of a slightly more\n+            // expensive 'unifiedClasspath' resolution during lock computation.\n+            if (project.getRootProject().getPluginManager().hasPlugin(\"com.palantir.versions-lock\")) {\n+                explicitCompile.extendsFrom(project.getConfigurations().getByName(\"lockConstraints\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9142595781bd5428fa491761f78849f0757f630"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2079, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}