{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MzgxODg5", "number": 1565, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTozODo0NFrOE9MGvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0MDo1OVrOE9MKFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTk2OTI1OnYy", "diffSide": "LEFT", "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/plugins/BaselineEnablePreviewFlagTest.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTozODo0NFrOH5vgDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTozODo0NFrOH5vgDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMwOTEzNQ==", "bodyText": ":compileJava was failing here with (ref):\nerror: cannot find symbol\n|            public record Coordinate(int x, int y) {}\n|                   ^\n|        symbol:   class record\n\nwhich makes sense to me as we are running with sourceCompatibility = 8. I think the output has changed from java 14 to java 15 and no longer contains the use --enable-preview to enable records line.\nChanged the test to explicitly print the compiler args and check that --enable-preview is not set when running with sourceCompatibility=8.", "url": "https://github.com/palantir/gradle-baseline/pull/1565#discussion_r530309135", "createdAt": "2020-11-25T11:38:44Z", "author": {"login": "fawind"}, "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/plugins/BaselineEnablePreviewFlagTest.groovy", "diffHunk": "@@ -156,19 +156,38 @@ class BaselineEnablePreviewFlagTest extends IntegrationSpec {\n \n     def 'does not always apply'() {\n         when:\n-        File java8Dir = addSubproject('my-java-8-api', \"sourceCompatibility = 8\")\n+        File java8Dir = addSubproject('my-java-8-api', \"\"\"\n+        sourceCompatibility = 8\n+\n+        tasks.withType(JavaCompile) {\n+           doFirst {\n+              println \"Args for for \\$name are \\$options.allCompilerArgs\"\n+           }\n+        } \n+        \"\"\".stripIndent())\n+\n         buildFile << '''\n         subprojects {\n             apply plugin: 'java-library'\n             apply plugin: 'com.palantir.baseline-enable-preview-flag'\n         }\n         '''\n-        writeSourceFileContainingRecord(java8Dir)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNTk3NzgwOnYy", "diffSide": "RIGHT", "path": "baseline-error-prone/src/test/java/com/palantir/baseline/errorprone/UnnecessaryParenthesesTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0MDo1OVrOH5vlTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzoxMDowM1rOH5yv8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMDQ3OA==", "bodyText": "This is to fix this error (ref):\ninvalid source release 14 with --enable-preview\n    (preview language features are only supported for release 15)\n\nI think that's a restriction by the java-compiler that enable-preview has to be used with the latest release but could not find good documentation on this.", "url": "https://github.com/palantir/gradle-baseline/pull/1565#discussion_r530310478", "createdAt": "2020-11-25T11:40:59Z", "author": {"login": "fawind"}, "path": "baseline-error-prone/src/test/java/com/palantir/baseline/errorprone/UnnecessaryParenthesesTest.java", "diffHunk": "@@ -29,7 +29,7 @@\n     public void testSwitchExpression() {\n         CompilationTestHelper compilationHelper = CompilationTestHelper.newInstance(\n                         UnnecessaryParentheses.class, getClass())\n-                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"14\"));\n+                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"15\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM2MjM1Mw==", "bodyText": "Yep I stumbled across this restriction too when writing #1549\n\njavac in JDK $N accepts the --enable-preview flag only in combination with --release $N or -source $N. (For brevity, only --release is mentioned in the rest of this JEP.)\n\nhttps://openjdk.java.net/jeps/12", "url": "https://github.com/palantir/gradle-baseline/pull/1565#discussion_r530362353", "createdAt": "2020-11-25T13:10:03Z", "author": {"login": "iamdanfox"}, "path": "baseline-error-prone/src/test/java/com/palantir/baseline/errorprone/UnnecessaryParenthesesTest.java", "diffHunk": "@@ -29,7 +29,7 @@\n     public void testSwitchExpression() {\n         CompilationTestHelper compilationHelper = CompilationTestHelper.newInstance(\n                         UnnecessaryParentheses.class, getClass())\n-                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"14\"));\n+                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"15\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMDQ3OA=="}, "originalCommit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2153, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}