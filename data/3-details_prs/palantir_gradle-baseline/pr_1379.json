{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2ODEzODQ0", "number": 1379, "title": "Improvement: Add error-prone check that forbids extending java.lang.Error", "bodyText": "Before this PR\nWe would allow extending Error. While there are niche cases where this is useful in vast majority of cases it can lead to more confusing and bugs than value.\nAfter this PR\n==COMMIT_MSG==\nAdd error-prone check that forbids extending java.lang.Error (reports ERROR). Provides a fix to replace extends Error with extends RuntimeException for clearer contract to the consumers.\n==COMMIT_MSG==\nPossible downsides?\nThe refactoring will get applied automatically but it might require human attention to merge. Cases where people would } catch (Error e) { are what we want to fix so those who do that might require to adjust their catch clauses after libraries pick up this check.", "createdAt": "2020-06-02T20:30:58Z", "url": "https://github.com/palantir/gradle-baseline/pull/1379", "merged": true, "mergeCommit": {"oid": "fe48109be1a18885a957e7cfa55af132db265ec2"}, "closed": true, "closedAt": "2020-06-03T18:18:46Z", "author": {"login": "robert3005"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnav8vAH2gAyNDI2ODEzODQ0OmVmMGM0MWNhODcyMWM2OTI0MmI2NDIxYTg0MDcxZTg2NmMzMzVmZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcntgzOgFqTQyMzgwODE3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef0c41ca8721c69242b6421a84071e866c335ff6", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/ef0c41ca8721c69242b6421a84071e866c335ff6", "committedDate": "2020-06-02T20:19:02Z", "message": "Improvement: Add error-prone check that forbids extending\njava.lang.Error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b25d914cadf3e485e4db96a140a23102538edd8d", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/b25d914cadf3e485e4db96a140a23102538edd8d", "committedDate": "2020-06-02T20:28:28Z", "message": "Fix fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/9c0b21629fba43364dfc3496d9b6ec49e159c757", "committedDate": "2020-06-02T20:28:28Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDU4NTQ3", "url": "https://github.com/palantir/gradle-baseline/pull/1379#pullrequestreview-423058547", "createdAt": "2020-06-02T21:07:58Z", "commit": {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTowNzo1OFrOGeEA1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTowNzo1OFrOGeEA1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjIxNA==", "bodyText": "I'm not sure we want to suggest a replacement for classes that extend specific error implementations, just those which extend Error. We could fail without a suggested fix in the case of specific error types.", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434176214", "createdAt": "2020-06-02T21:07:58Z", "author": {"login": "carterkozak"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsError.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsError\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend java.lang.Error. While allowed by java it can lead to surprising behaviour\"\n+                + \" if users end up catching Error.\")\n+public final class ExtendsError extends BugChecker implements BugChecker.ClassTreeMatcher {\n+    private static final Matcher<ClassTree> ERROR_MATCHER = Matchers.isSubtypeOf(Error.class);\n+\n+    @Override\n+    public Description matchClass(ClassTree tree, VisitorState state) {\n+        if (tree.getKind() != Tree.Kind.CLASS) {\n+            // Don't apply to out interfaces and enums\n+            return Description.NO_MATCH;\n+        }\n+\n+        if (!ERROR_MATCHER.matches(tree, state)) {\n+            return Description.NO_MATCH;\n+        }\n+\n+        return buildDescription(tree).addFix(buildFix(tree, state)).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDU4Njg2", "url": "https://github.com/palantir/gradle-baseline/pull/1379#pullrequestreview-423058686", "createdAt": "2020-06-02T21:08:12Z", "commit": {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTowODoxMlrOGeEBRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTowODoxMlrOGeEBRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE3NjMyNg==", "bodyText": "What if I extend Throwable?", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434176326", "createdAt": "2020-06-02T21:08:12Z", "author": {"login": "carterkozak"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsError.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsError\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend java.lang.Error. While allowed by java it can lead to surprising behaviour\"\n+                + \" if users end up catching Error.\")\n+public final class ExtendsError extends BugChecker implements BugChecker.ClassTreeMatcher {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c0b21629fba43364dfc3496d9b6ec49e159c757"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91566efafa683ae10a252b683ea9746dbdbb4b9a", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/91566efafa683ae10a252b683ea9746dbdbb4b9a", "committedDate": "2020-06-02T22:29:42Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/2c130fd7b80e517481808b8d4d530cc8a0bac4c6", "committedDate": "2020-06-02T22:47:30Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODA1NzU1", "url": "https://github.com/palantir/gradle-baseline/pull/1379#pullrequestreview-423805755", "createdAt": "2020-06-03T18:07:13Z", "commit": {"oid": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxODowNzoxM1rOGenifA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxODowNzoxM1rOGenifA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc1ODI2OA==", "bodyText": "I think you have to add this to the list that gets applied by default in the errorprone plugin", "url": "https://github.com/palantir/gradle-baseline/pull/1379#discussion_r434758268", "createdAt": "2020-06-03T18:07:13Z", "author": {"login": "ferozco"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ExtendsErrorOrThrowable.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.fixes.SuggestedFixes;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.google.errorprone.suppliers.Suppliers;\n+import com.sun.source.tree.ClassTree;\n+import com.sun.source.tree.Tree;\n+import com.sun.tools.javac.code.Type;\n+import java.util.Optional;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ExtendsErrorOrThrowable\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = BugPattern.LinkType.CUSTOM,\n+        providesFix = BugPattern.ProvidesFix.REQUIRES_HUMAN_ATTENTION,\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Class should not extend Error or Throwable directly. While allowed by java \"\n+                + \"it can lead to surprising behaviour if users end up catching Error or Throwable.\")\n+public final class ExtendsErrorOrThrowable extends BugChecker implements BugChecker.ClassTreeMatcher {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4c7fde45d24b27e2babd312f8a0ac5e9f3f363", "author": {"user": null}, "url": "https://github.com/palantir/gradle-baseline/commit/fa4c7fde45d24b27e2babd312f8a0ac5e9f3f363", "committedDate": "2020-06-03T18:09:15Z", "message": "add to list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODA4MTc5", "url": "https://github.com/palantir/gradle-baseline/pull/1379#pullrequestreview-423808179", "createdAt": "2020-06-03T18:10:41Z", "commit": {"oid": "2c130fd7b80e517481808b8d4d530cc8a0bac4c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2129, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}