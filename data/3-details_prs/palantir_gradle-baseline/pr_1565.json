{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MzgxODg5", "number": 1565, "title": "Fix unit tests on java 15", "bodyText": "Before this PR\nWe switched testing on java 14 to testing on java 15 in 02c9f15 which broke some tests on java 15 and automerged before we could fix the tests.\nFailures: https://app.circleci.com/pipelines/github/palantir/gradle-baseline/1492/workflows/f8aaf40f-f7fb-4a28-8860-80f00df4532d/jobs/21807\nAfter this PR\nFix unit tests when running with java 15.\n==COMMIT_MSG==\nFix unit tests on java 15\n==COMMIT_MSG==", "createdAt": "2020-11-25T11:36:06Z", "url": "https://github.com/palantir/gradle-baseline/pull/1565", "merged": true, "mergeCommit": {"oid": "61d29a58946e94454cf98749243f1dac570ccd81"}, "closed": true, "closedAt": "2020-11-25T13:12:11Z", "author": {"login": "fawind"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf8QfMAH2gAyNTI3MzgxODg5OjYxYjMwMDlkMGIwMjc4Y2UxODAzYTM1NDQ2MjMxN2ViMzI5YzM0MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdf-IWFgFqTUzODQ3OTk3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61b3009d0b0278ce1803a354462317eb329c3415", "author": {"user": {"login": "fawind", "name": "Fabian Windheuser"}}, "url": "https://github.com/palantir/gradle-baseline/commit/61b3009d0b0278ce1803a354462317eb329c3415", "committedDate": "2020-11-25T11:01:12Z", "message": "Increase release version in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716", "author": {"user": {"login": "fawind", "name": "Fabian Windheuser"}}, "url": "https://github.com/palantir/gradle-baseline/commit/3b234d37aa83cb4135ed9614b9f82c83cf1a5716", "committedDate": "2020-11-25T11:29:32Z", "message": "Fix enable preview test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDA5ODg1", "url": "https://github.com/palantir/gradle-baseline/pull/1565#pullrequestreview-538409885", "createdAt": "2020-11-25T11:38:44Z", "commit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTozODo0NFrOH5vgDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTozODo0NFrOH5vgDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMwOTEzNQ==", "bodyText": ":compileJava was failing here with (ref):\nerror: cannot find symbol\n|            public record Coordinate(int x, int y) {}\n|                   ^\n|        symbol:   class record\n\nwhich makes sense to me as we are running with sourceCompatibility = 8. I think the output has changed from java 14 to java 15 and no longer contains the use --enable-preview to enable records line.\nChanged the test to explicitly print the compiler args and check that --enable-preview is not set when running with sourceCompatibility=8.", "url": "https://github.com/palantir/gradle-baseline/pull/1565#discussion_r530309135", "createdAt": "2020-11-25T11:38:44Z", "author": {"login": "fawind"}, "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/plugins/BaselineEnablePreviewFlagTest.groovy", "diffHunk": "@@ -156,19 +156,38 @@ class BaselineEnablePreviewFlagTest extends IntegrationSpec {\n \n     def 'does not always apply'() {\n         when:\n-        File java8Dir = addSubproject('my-java-8-api', \"sourceCompatibility = 8\")\n+        File java8Dir = addSubproject('my-java-8-api', \"\"\"\n+        sourceCompatibility = 8\n+\n+        tasks.withType(JavaCompile) {\n+           doFirst {\n+              println \"Args for for \\$name are \\$options.allCompilerArgs\"\n+           }\n+        } \n+        \"\"\".stripIndent())\n+\n         buildFile << '''\n         subprojects {\n             apply plugin: 'java-library'\n             apply plugin: 'com.palantir.baseline-enable-preview-flag'\n         }\n         '''\n-        writeSourceFileContainingRecord(java8Dir)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDExNDI2", "url": "https://github.com/palantir/gradle-baseline/pull/1565#pullrequestreview-538411426", "createdAt": "2020-11-25T11:40:59Z", "commit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0MDo1OVrOH5vlTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMTo0MDo1OVrOH5vlTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMDQ3OA==", "bodyText": "This is to fix this error (ref):\ninvalid source release 14 with --enable-preview\n    (preview language features are only supported for release 15)\n\nI think that's a restriction by the java-compiler that enable-preview has to be used with the latest release but could not find good documentation on this.", "url": "https://github.com/palantir/gradle-baseline/pull/1565#discussion_r530310478", "createdAt": "2020-11-25T11:40:59Z", "author": {"login": "fawind"}, "path": "baseline-error-prone/src/test/java/com/palantir/baseline/errorprone/UnnecessaryParenthesesTest.java", "diffHunk": "@@ -29,7 +29,7 @@\n     public void testSwitchExpression() {\n         CompilationTestHelper compilationHelper = CompilationTestHelper.newInstance(\n                         UnnecessaryParentheses.class, getClass())\n-                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"14\"));\n+                .setArgs(ImmutableList.of(\"--enable-preview\", \"--release\", \"15\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDc5OTcz", "url": "https://github.com/palantir/gradle-baseline/pull/1565#pullrequestreview-538479973", "createdAt": "2020-11-25T13:12:07Z", "commit": {"oid": "3b234d37aa83cb4135ed9614b9f82c83cf1a5716"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2008, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}