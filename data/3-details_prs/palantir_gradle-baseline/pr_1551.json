{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNTY1NjM0", "number": 1551, "title": "Fix regression in ./gradlew idea introduced in baseline 3.51.0", "bodyText": "Before this PR\n@dtobin reported in #dev-foundry-infra that upgrading from baseline 3.50.0 -> 3.51.0 broke ./gradlew idea.\ngroovy.lang.MissingPropertyException: No such property: DEFAULT_CHECKSTYLE_VERSION for class: com.palantir.baseline.plugins.BaselineCheckstyle\n\tat groovy.lang.MetaClassImpl.invokeStaticMissingProperty(MetaClassImpl.java:1021)\n\tat groovy.lang.MetaClassImpl.getProperty(MetaClassImpl.java:1866)\n\tat groovy.lang.MetaClassImpl.getProperty(MetaClassImpl.java:1842)\n\nClearly I goofed my original PR here: #1546\nAfter this PR\n==COMMIT_MSG==\nFix regression in ./gradlew idea introduced in baseline 3.51.0\n==COMMIT_MSG==\nI also did a publishToMavenLocal and a manual verification of this, cos I don't really trust our tests for this plugin!\nPossible downsides?", "createdAt": "2020-11-17T17:06:39Z", "url": "https://github.com/palantir/gradle-baseline/pull/1551", "merged": true, "mergeCommit": {"oid": "03ebbce7d98905f9c50bc0465b99e176c900ac7d"}, "closed": true, "closedAt": "2020-11-17T17:29:30Z", "author": {"login": "iamdanfox"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddcPcbgH2gAyNTIyNTY1NjM0OmNiOTJmYTU2MTRjMmQ5MjBjOTQ2ZmMxYTcxMThiYjczMTJlYjFiNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddcyZvAFqTUzMjYwMjExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb92fa5614c2d920c946fc1a7118bb7312eb1b46", "author": {"user": {"login": "iamdanfox", "name": null}}, "url": "https://github.com/palantir/gradle-baseline/commit/cb92fa5614c2d920c946fc1a7118bb7312eb1b46", "committedDate": "2020-11-17T16:35:15Z", "message": "Fix BaselineIdea accessing the checkstyle version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ca508bb8d43e62c33eb55cd3b78e2dc323dc9cf", "author": {"user": {"login": "iamdanfox", "name": null}}, "url": "https://github.com/palantir/gradle-baseline/commit/2ca508bb8d43e62c33eb55cd3b78e2dc323dc9cf", "committedDate": "2020-11-17T17:03:42Z", "message": "Give it a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fa1594dde4e9a777d9f7e72fee5c4bfd137e8ec", "author": {"user": {"login": "iamdanfox", "name": null}}, "url": "https://github.com/palantir/gradle-baseline/commit/8fa1594dde4e9a777d9f7e72fee5c4bfd137e8ec", "committedDate": "2020-11-17T17:03:42Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819", "author": {"user": {"login": "iamdanfox", "name": null}}, "url": "https://github.com/palantir/gradle-baseline/commit/aa3051ecd4acb7e7f97ce6ea9d76086cb9743819", "committedDate": "2020-11-17T17:03:42Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTk3NzAy", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532597702", "createdAt": "2020-11-17T17:08:54Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowODo1NFrOH0_4-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowODo1NFrOH0_4-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNDc3OQ==", "bodyText": "Nice, I'm actually surprised we got this far without this test.", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525334779", "createdAt": "2020-11-17T17:08:54Z", "author": {"login": "CRogers"}, "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/BaselineIdeaIntegrationTest.groovy", "diffHunk": "@@ -49,7 +49,23 @@ class BaselineIdeaIntegrationTest extends AbstractPluginTest {\n         buildFile << standardBuildFile\n \n         then:\n-        with('idea').build()\n+        BuildResult result = with('idea').build()\n+        assert result.task(':idea').outcome == TaskOutcome.SUCCESS ?: result.output\n+    }\n+\n+    def 'Works with checkstyle and IntelliJ import'() {\n+        when:\n+        buildFile << standardBuildFile\n+        buildFile << \"\"\" \n+        allprojects { \n+            apply plugin: 'com.palantir.baseline-checkstyle'\n+        }\n+        \"\"\"\n+\n+        then:\n+        BuildResult result = with('idea', '-Didea.active=true', '-is').build()\n+        assert file(\".idea/checkstyle-idea.xml\").exists() ?: result.output\n+        assert result.task(':idea').outcome == TaskOutcome.SUCCESS ?: result.output", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTk3OTE2", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532597916", "createdAt": "2020-11-17T17:09:08Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowOTowOFrOH0_5kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowOTowOFrOH0_5kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNDkzMA==", "bodyText": "a lot of these changes were motivated by @CompileStatic, but I couldn't fully lock it in because of all our xml manipulation. Figured it was better to just get closer \ud83e\udd37", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525334930", "createdAt": "2020-11-17T17:09:08Z", "author": {"login": "iamdanfox"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -179,14 +182,14 @@ class BaselineIdea extends AbstractBaselinePlugin {\n     /**\n      * Extracts copyright headers from Baseline directory and adds them to Idea project XML node.\n      */\n-    private void addCopyright(node) {\n-        def copyrightManager = node.component.find { it.'@name' == 'CopyrightManager' }\n+    private void addCopyright(Node node) {\n+        Node copyrightManager = node.component.find {it.'@name' == 'CopyrightManager'}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTk4MDY5", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532598069", "createdAt": "2020-11-17T17:09:17Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowOToxN1rOH0_59A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzowOToxN1rOH0_59A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNTAyOA==", "bodyText": "One of my fav idea features.", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525335028", "createdAt": "2020-11-17T17:09:17Z", "author": {"login": "CRogers"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -345,6 +351,7 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             return\n         }\n \n+        // language=xml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 209}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTk5MDQ0", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532599044", "createdAt": "2020-11-17T17:10:15Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMDoxNVrOH0_8oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMDoxNVrOH0_8oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNTcxMw==", "bodyText": "these whitespace changes are intellij helpfully reformatting things. Given that we don't have a palantir-groovy-format (\ud83d\ude02), I couldn't be bothered to revert em all piece by piece", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525335713", "createdAt": "2020-11-17T17:10:15Z", "author": {"login": "iamdanfox"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -179,14 +182,14 @@ class BaselineIdea extends AbstractBaselinePlugin {\n     /**\n      * Extracts copyright headers from Baseline directory and adds them to Idea project XML node.\n      */\n-    private void addCopyright(node) {\n-        def copyrightManager = node.component.find { it.'@name' == 'CopyrightManager' }\n+    private void addCopyright(Node node) {\n+        Node copyrightManager = node.component.find {it.'@name' == 'CopyrightManager'}\n         def copyrightDir = Paths.get(\"${configDir}/copyright/\")\n         def copyrightFiles = getCopyrightFiles(copyrightDir)\n-        copyrightFiles.each { File file ->\n+        copyrightFiles.each {File file ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 104}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjAwNDA3", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532600407", "createdAt": "2020-11-17T17:11:42Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMTo0MlrOH1AAww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMTo0MlrOH1AAww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNjc3MQ==", "bodyText": "i stumbled across this trick further down this file, turns out IntelliJ can give you language-specific code highlighting for snippets!!!", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525336771", "createdAt": "2020-11-17T17:11:42Z", "author": {"login": "iamdanfox"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -353,6 +360,7 @@ class BaselineIdea extends AbstractBaselinePlugin {\n     }\n \n     private static void addInspectionProjectProfile(node) {\n+        // language=xml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 217}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjAwOTYz", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532600963", "createdAt": "2020-11-17T17:12:20Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMjoyMFrOH1ACdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxMjoyMFrOH1ACdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNzIwNg==", "bodyText": "this assertion would always pass. the result contained an outcome of either success/fail, but we never checked it. \ud83e\udd26", "url": "https://github.com/palantir/gradle-baseline/pull/1551#discussion_r525337206", "createdAt": "2020-11-17T17:12:20Z", "author": {"login": "iamdanfox"}, "path": "gradle-baseline-java/src/test/groovy/com/palantir/baseline/BaselineIdeaIntegrationTest.groovy", "diffHunk": "@@ -49,7 +49,23 @@ class BaselineIdeaIntegrationTest extends AbstractPluginTest {\n         buildFile << standardBuildFile\n \n         then:\n-        with('idea').build()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjAyMTE1", "url": "https://github.com/palantir/gradle-baseline/pull/1551#pullrequestreview-532602115", "createdAt": "2020-11-17T17:13:26Z", "commit": {"oid": "aa3051ecd4acb7e7f97ce6ea9d76086cb9743819"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1997, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}