{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMzI4MzE1", "number": 1396, "title": "Add errorprone check for immutables style collisions", "bodyText": "Fix for #1395", "createdAt": "2020-06-08T18:48:35Z", "url": "https://github.com/palantir/gradle-baseline/pull/1396", "merged": true, "mergeCommit": {"oid": "c87ba3bfd2b6c24c828e56b7aef0254ae02b220a"}, "closed": true, "closedAt": "2020-06-08T19:47:57Z", "author": {"login": "a10y"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpUylmAH2gAyNDMxMzI4MzE1OjJlYmU4ZDAzNzNhZjVlMTNjNjRiYjc3ZTJmN2ZlODA1YmFmOWFjZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpVxunAH2gAyNDMxMzI4MzE1OmQzYTZiNGUzMTZkZWQzZGY2MGVlMjliNzM5NzljMTExM2RjMWRlMDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ebe8d0373af5e13c64bb77e2f7fe805baf9acd2", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/2ebe8d0373af5e13c64bb77e2f7fe805baf9acd2", "committedDate": "2020-06-08T18:30:20Z", "message": "Save"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b3c97c461fac522e0c91deea8bf16b5c4b852cb", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/3b3c97c461fac522e0c91deea8bf16b5c4b852cb", "committedDate": "2020-06-08T19:18:54Z", "message": "Add inline/meta-annotation style collision errorprone"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe06f311af3888d05c95bc8624f70240da162234", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/fe06f311af3888d05c95bc8624f70240da162234", "committedDate": "2020-06-08T19:15:30Z", "message": "Add inline/meta-annotation style collision errorprone"}, "afterCommit": {"oid": "3b3c97c461fac522e0c91deea8bf16b5c4b852cb", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/3b3c97c461fac522e0c91deea8bf16b5c4b852cb", "committedDate": "2020-06-08T19:18:54Z", "message": "Add inline/meta-annotation style collision errorprone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90398e5fec87d13ca5cc05fab45c9c4eb6a936a8", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/90398e5fec87d13ca5cc05fab45c9c4eb6a936a8", "committedDate": "2020-06-08T19:23:26Z", "message": "small cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTUyODkz", "url": "https://github.com/palantir/gradle-baseline/pull/1396#pullrequestreview-426552893", "createdAt": "2020-06-08T19:25:27Z", "commit": {"oid": "90398e5fec87d13ca5cc05fab45c9c4eb6a936a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyNToyOFrOGgtMqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyNToyOFrOGgtMqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk0ODEzNw==", "bodyText": "I think we can use describeMatch instead which inherits the summary message from the class-level BugPattern annotation.", "url": "https://github.com/palantir/gradle-baseline/pull/1396#discussion_r436948137", "createdAt": "2020-06-08T19:25:28Z", "author": {"login": "carterkozak"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ImmutablesStyleCollision.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.BugPattern.LinkType;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.matchers.ChildMultiMatcher;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.sun.source.tree.ClassTree;\n+import org.immutables.value.Value;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ImmutablesStyleCollision\",\n+        linkType = LinkType.CUSTOM,\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        severity = BugPattern.SeverityLevel.ERROR,\n+        summary = \"Immutables @Value.Style inline annotation should not be present alongside a Style \"\n+                + \"meta-annotation, as there is no Style merging. You should either modify the \"\n+                + \"meta-annotation, or add the meta-annotation's fields to your inline @Value.Style \"\n+                + \"declaration.\")\n+public final class ImmutablesStyleCollision extends BugChecker implements BugChecker.ClassTreeMatcher {\n+    private static final Matcher<ClassTree> INLINE_STYLE_ANNOTATION = Matchers.hasAnnotation(Value.Style.class);\n+    private static final Matcher<ClassTree> STYLE_META_ANNOTATION =\n+            Matchers.annotations(ChildMultiMatcher.MatchType.AT_LEAST_ONE, Matchers.hasAnnotation(Value.Style.class));\n+    private static final Matcher<ClassTree> MATCHER = Matchers.allOf(INLINE_STYLE_ANNOTATION, STYLE_META_ANNOTATION);\n+\n+    @Override\n+    public Description matchClass(ClassTree tree, VisitorState state) {\n+        if (MATCHER.matches(tree, state)) {\n+            return buildDescription(tree)\n+                    .setMessage(\"Immutable type cannot have both inline @Value.Style and meta-annotation applied\")\n+                    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90398e5fec87d13ca5cc05fab45c9c4eb6a936a8"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTUzNTA2", "url": "https://github.com/palantir/gradle-baseline/pull/1396#pullrequestreview-426553506", "createdAt": "2020-06-08T19:26:21Z", "commit": {"oid": "90398e5fec87d13ca5cc05fab45c9c4eb6a936a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyNjoyMVrOGgtOjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyNjoyMVrOGgtOjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk0ODYyMw==", "bodyText": "Please document this alongside the other baseline error-prone checks in the readme!", "url": "https://github.com/palantir/gradle-baseline/pull/1396#discussion_r436948623", "createdAt": "2020-06-08T19:26:21Z", "author": {"login": "carterkozak"}, "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/ImmutablesStyleCollision.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.BugPattern.LinkType;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.matchers.ChildMultiMatcher;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.Matchers;\n+import com.sun.source.tree.ClassTree;\n+import org.immutables.value.Value;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"ImmutablesStyleCollision\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90398e5fec87d13ca5cc05fab45c9c4eb6a936a8"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa5fa938f52299f359d349d869f1d5aee60e73c", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/4fa5fa938f52299f359d349d869f1d5aee60e73c", "committedDate": "2020-06-08T19:27:27Z", "message": "describeMatch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19da6288e8335531a7620b89b9247bfc3c2c1b6", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/f19da6288e8335531a7620b89b9247bfc3c2c1b6", "committedDate": "2020-06-08T19:28:43Z", "message": "Add README section for check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c175387ab53ff06488547c35227cb5432758dbae", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/c175387ab53ff06488547c35227cb5432758dbae", "committedDate": "2020-06-08T19:28:43Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTU2MTEz", "url": "https://github.com/palantir/gradle-baseline/pull/1396#pullrequestreview-426556113", "createdAt": "2020-06-08T19:30:09Z", "commit": {"oid": "f19da6288e8335531a7620b89b9247bfc3c2c1b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d811fe7d009563387fc16d563b2e2e2d14c242", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/d1d811fe7d009563387fc16d563b2e2e2d14c242", "committedDate": "2020-06-08T19:31:17Z", "message": "fix match text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3a6b4e316ded3df60ee29b73979c1113dc1de04", "author": {"user": {"login": "a10y", "name": "Andrew Duffy"}}, "url": "https://github.com/palantir/gradle-baseline/commit/d3a6b4e316ded3df60ee29b73979c1113dc1de04", "committedDate": "2020-06-08T19:39:18Z", "message": "compile"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2141, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}