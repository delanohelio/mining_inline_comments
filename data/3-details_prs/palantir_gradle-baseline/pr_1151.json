{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNTg0NTY0", "number": 1151, "title": "IntelliJ: Format on save when using PJF", "bodyText": "Before this PR\nA common complaint we've seen with Palantir Java Format is that it's quite opinionated in what your code should look like, so people often forget to format, then get red checks on CI.\nAfter this PR\n==COMMIT_MSG==\nWhen palantir-java-format is applied to a repo, configure the intellij project to auto-format on save.\n==COMMIT_MSG==\nPossible downsides?", "createdAt": "2020-01-08T17:58:20Z", "url": "https://github.com/palantir/gradle-baseline/pull/1151", "merged": true, "mergeCommit": {"oid": "1f4910ab9c77454c78b8e3f5cfaaac142d63c32a"}, "closed": true, "closedAt": "2020-01-09T14:47:42Z", "author": {"login": "dansanduleac"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4XBHBgH2gAyMzYwNTg0NTY0Ojg4ZDYxNDg0YjE2ZDE1NzIwMDkwMTM4MjM2YjNkMjYyYjdiOTcyZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4rEguAFqTM0MDU3MDA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88d61484b16d15720090138236b3d262b7b972d5", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/88d61484b16d15720090138236b3d262b7b972d5", "committedDate": "2020-01-08T15:23:43Z", "message": "Suggest and preconfigure save-actions if PJF is enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01f17a39c1e5e895377103eb23808ca86f5f165", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/b01f17a39c1e5e895377103eb23808ca86f5f165", "committedDate": "2020-01-08T15:28:28Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9058c1bf889829901d42a3a9765e233702f79e51", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/9058c1bf889829901d42a3a9765e233702f79e51", "committedDate": "2020-01-08T15:33:23Z", "message": "Separate groovy and java because sigh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6859e2529297c7b8174e34a6c44814cd9c6565d1", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/6859e2529297c7b8174e34a6c44814cd9c6565d1", "committedDate": "2020-01-08T15:36:31Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8461cdb5c21aed1ec6357678a67a95a085ab9f7", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/f8461cdb5c21aed1ec6357678a67a95a085ab9f7", "committedDate": "2020-01-08T15:58:04Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a5618d9643a9f88ec4765004aff80b3e34fba38", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/9a5618d9643a9f88ec4765004aff80b3e34fba38", "committedDate": "2020-01-08T15:58:23Z", "message": "verify that IPR is configured"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092f321eb0e4bfe7fafd0a89419275ca95623904", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/092f321eb0e4bfe7fafd0a89419275ca95623904", "committedDate": "2020-01-08T16:01:15Z", "message": "add no-op test as well, rename for clarity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eaae0a4799a85480e1f372bf4f39b2e84231d49", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/7eaae0a4799a85480e1f372bf4f39b2e84231d49", "committedDate": "2020-01-08T17:15:14Z", "message": "Move stuff to BaselineIdea and only apply on root!!!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce47937a3f3c0fac42ae9c5be261bfbe5fb6a3f7", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/ce47937a3f3c0fac42ae9c5be261bfbe5fb6a3f7", "committedDate": "2020-01-08T17:39:06Z", "message": "use the right id... WOT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "905a038734b12beee23fb4d57fff291737250b67", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/905a038734b12beee23fb4d57fff291737250b67", "committedDate": "2020-01-08T17:38:41Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMDQ2ODI0", "url": "https://github.com/palantir/gradle-baseline/pull/1151#pullrequestreview-340046824", "createdAt": "2020-01-08T18:09:19Z", "commit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxODowOToxOVrOFbfV-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxODoyNDo0MFrOFbfuug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM2OTQwMQ==", "bodyText": "nice", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364369401", "createdAt": "2020-01-08T18:09:19Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -311,4 +329,31 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             module.dependencies.addAll(projectRefs)\n         }\n     }\n+\n+    /**\n+     * Configures some defaults on the save-actions plugin, but only if it hasn't been configured before.\n+     */\n+    private static void configureSaveActions(Node rootNode) {\n+        GroovyXmlUtils.matchOrCreateChild(rootNode, 'component', [name: 'SaveActionSettings'], [:]) {\n+            // Configure defaults if this plugin is configured for the first time only\n+            appendNode('option', [name: 'actions']).appendNode('set').with {\n+                appendNode('option', [value: 'activate'])\n+                appendNode('option', [value: 'noActionIfCompileErrors'])\n+                appendNode('option', [value: 'organizeImports'])\n+                appendNode('option', [value: 'reformat'])\n+            }\n+            appendNode('option', [name: 'configurationPath', value: ''])\n+            appendNode('inclusions').appendNode('set').with {\n+                appendNode('option', [value: 'src/.*\\\\.java'])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM3Mjc5NQ==", "bodyText": "spacing on this is weird", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364372795", "createdAt": "2020-01-08T18:17:44Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/GroovyXmlUtils.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.plugins\n+\n+final class GroovyXmlUtils {\n+    static Node matchOrCreateChild(Node base, String name, Map attributes = [:], Map defaults = [:],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM3Mzg2NQ==", "bodyText": "we already have the ideaRootModel above", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364373865", "createdAt": "2020-01-08T18:20:16Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -68,6 +68,21 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             moveProjectReferencesToEnd(ideaModuleModel)\n         }\n \n+        // Suggest and configure the \"save actions\" plugin if Palantir Java Format is turned on.\n+        if (project == project.rootProject) {\n+            IdeaModel ideaRootModel = project.extensions.findByType(IdeaModel)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM3NTA3Ng==", "bodyText": "it seems like nearly the whole plugin should be a no-op if not applied to the root. perhaps we can restructure this so its a little more clear", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364375076", "createdAt": "2020-01-08T18:23:03Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -68,6 +68,21 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             moveProjectReferencesToEnd(ideaModuleModel)\n         }\n \n+        // Suggest and configure the \"save actions\" plugin if Palantir Java Format is turned on.\n+        if (project == project.rootProject) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM3NTQwNQ==", "bodyText": "is this to allow users to override the configuration?", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364375405", "createdAt": "2020-01-08T18:23:51Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -311,4 +329,31 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             module.dependencies.addAll(projectRefs)\n         }\n     }\n+\n+    /**\n+     * Configures some defaults on the save-actions plugin, but only if it hasn't been configured before.\n+     */\n+    private static void configureSaveActions(Node rootNode) {\n+        GroovyXmlUtils.matchOrCreateChild(rootNode, 'component', [name: 'SaveActionSettings'], [:]) {\n+            // Configure defaults if this plugin is configured for the first time only", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM3NTczOA==", "bodyText": "might want to pull out the version so its more visible/easier to upgrade", "url": "https://github.com/palantir/gradle-baseline/pull/1151#discussion_r364375738", "createdAt": "2020-01-08T18:24:40Z", "author": {"login": "ferozco"}, "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineIdea.groovy", "diffHunk": "@@ -311,4 +329,31 @@ class BaselineIdea extends AbstractBaselinePlugin {\n             module.dependencies.addAll(projectRefs)\n         }\n     }\n+\n+    /**\n+     * Configures some defaults on the save-actions plugin, but only if it hasn't been configured before.\n+     */\n+    private static void configureSaveActions(Node rootNode) {\n+        GroovyXmlUtils.matchOrCreateChild(rootNode, 'component', [name: 'SaveActionSettings'], [:]) {\n+            // Configure defaults if this plugin is configured for the first time only\n+            appendNode('option', [name: 'actions']).appendNode('set').with {\n+                appendNode('option', [value: 'activate'])\n+                appendNode('option', [value: 'noActionIfCompileErrors'])\n+                appendNode('option', [value: 'organizeImports'])\n+                appendNode('option', [value: 'reformat'])\n+            }\n+            appendNode('option', [name: 'configurationPath', value: ''])\n+            appendNode('inclusions').appendNode('set').with {\n+                appendNode('option', [value: 'src/.*\\\\.java'])\n+            }\n+        }\n+    }\n+\n+    private static void configureExternalDependencies(Node rootNode) {\n+        def externalDependencies = GroovyXmlUtils.matchOrCreateChild(rootNode, 'component', [name: 'ExternalDependencies'])\n+        // I kid you not, this is the id for the save actions plugin:\n+        // https://github.com/dubreuia/intellij-plugin-save-actions/blob/v1.9.0/src/main/resources/META-INF/plugin.xml#L5\n+        // https://plugins.jetbrains.com/plugin/7642-save-actions/\n+        GroovyXmlUtils.matchOrCreateChild(externalDependencies, 'plugin', [id: 'com.dubreuia'], ['min-version': '1.9.0'])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "905a038734b12beee23fb4d57fff291737250b67"}, "originalPosition": 129}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cfdc273f003e57d1694eefff64de580c5d91126", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/3cfdc273f003e57d1694eefff64de580c5d91126", "committedDate": "2020-01-09T14:20:56Z", "message": "fix root project configuration being applied for each subproject"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40d6bb861cc043f4514bb69c087a398146fee6b4", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/40d6bb861cc043f4514bb69c087a398146fee6b4", "committedDate": "2020-01-09T14:20:56Z", "message": "be more defensive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aaef47d5b2d62e84bf8175d3e1e00096cb66762", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/1aaef47d5b2d62e84bf8175d3e1e00096cb66762", "committedDate": "2020-01-09T14:26:09Z", "message": "chomp down arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06581c9f481ed0f246e8a110d0e19144927719e3", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/06581c9f481ed0f246e8a110d0e19144927719e3", "committedDate": "2020-01-09T14:27:05Z", "message": "lol"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43e13378e7a75e1fca51fcd67acccf31a252fc1c", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/43e13378e7a75e1fca51fcd67acccf31a252fc1c", "committedDate": "2020-01-09T14:35:18Z", "message": "fix style, pull out constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab105c2da7b2c5de03ef4d1b7b8d0379426b81e6", "author": {"user": {"login": "dansanduleac", "name": "Dan S\u0103nduleac"}}, "url": "https://github.com/palantir/gradle-baseline/commit/ab105c2da7b2c5de03ef4d1b7b8d0379426b81e6", "committedDate": "2020-01-09T14:40:10Z", "message": "workspace stuff still needs to be in afterEvaluate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTcwMDUx", "url": "https://github.com/palantir/gradle-baseline/pull/1151#pullrequestreview-340570051", "createdAt": "2020-01-09T14:45:32Z", "commit": {"oid": "ab105c2da7b2c5de03ef4d1b7b8d0379426b81e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2183, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}