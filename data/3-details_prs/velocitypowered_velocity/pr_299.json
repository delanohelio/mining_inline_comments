{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MTU3NzQw", "number": 299, "title": "Add event for commands", "bodyText": "", "createdAt": "2020-04-26T21:05:42Z", "url": "https://github.com/VelocityPowered/Velocity/pull/299", "merged": true, "mergeCommit": {"oid": "e759668f5398b707c4fa7005c466c823f612ddca"}, "closed": true, "closedAt": "2020-04-29T16:51:48Z", "author": {"login": "Leymooo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbhOAOAH2gAyNDA5MTU3NzQwOjY1NTVlMGUzMzdhZGQ1YzJmYzY2YWQ4MzY3YTk1YTFjMGM0OGVjZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccbZ7RgFqTQwMjg1NTYwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6555e0e337add5c2fc66ad8367a95a1c0c48ecfc", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/6555e0e337add5c2fc66ad8367a95a1c0c48ecfc", "committedDate": "2020-04-26T21:04:12Z", "message": "Add CommandExecuteEvent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb382e0f6b4fcb7c2100cabe0a284ce01862e89", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/1fb382e0f6b4fcb7c2100cabe0a284ce01862e89", "committedDate": "2020-04-26T21:09:25Z", "message": "fix logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb64333813699b4f1ade5c9a0646f8d4f7460713", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/fb64333813699b4f1ade5c9a0646f8d4f7460713", "committedDate": "2020-04-26T21:11:49Z", "message": "pass eventLoop to thenApplyAsync"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNTQ5NTU3", "url": "https://github.com/VelocityPowered/Velocity/pull/299#pullrequestreview-400549557", "createdAt": "2020-04-26T21:10:39Z", "commit": {"oid": "1fb382e0f6b4fcb7c2100cabe0a284ce01862e89"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQyMToxMDozOVrOGMKHbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQyMToxMDozOVrOGMKHbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQwMTgzNw==", "bodyText": "This is the biggest problem I have with this. I am not a big fan of exposing a method like this. Could we do a bit better?\nOn an additional note, I think we should probably deprecate execute and friends and just outright replace them with *async variants. We'll clean up the API mess later on.", "url": "https://github.com/VelocityPowered/Velocity/pull/299#discussion_r415401837", "createdAt": "2020-04-26T21:10:39Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/command/CommandManager.java", "diffHunk": "@@ -35,10 +35,21 @@\n \n   /**\n    * Attempts to execute a command from the specified {@code cmdLine}.\n+   * CommandExecuteEvent will not called\n    *\n    * @param source the command's source\n    * @param cmdLine the command to run\n    * @return true if the command was found and executed, false if it was not\n    */\n   boolean execute(CommandSource source, String cmdLine);\n+\n+  /**\n+   * Attempts to execute a command from the specified {@code cmdLine}.\n+   *\n+   * @param source the command's source\n+   * @param cmdLine the command to run\n+   * @param callEvent will CommandExecuteEvent called or not\n+   * @return true if the command was found and executed, false if it was not\n+   */\n+  boolean execute(CommandSource source, String cmdLine, boolean callEvent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fb382e0f6b4fcb7c2100cabe0a284ce01862e89"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/c0b8e9d646cf94877c89f0b6d631ebb484f58ca2", "committedDate": "2020-04-26T22:05:57Z", "message": "add async methods, also add separate methods which will call event and which will not call event"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNTU3MTE5", "url": "https://github.com/VelocityPowered/Velocity/pull/299#pullrequestreview-400557119", "createdAt": "2020-04-26T22:38:31Z", "commit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQyMjozODozMVrOGMLEyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQyMjo0MTo0N1rOGMLHNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQxNzU0Nw==", "bodyText": "CommandExecuteEvent", "url": "https://github.com/VelocityPowered/Velocity/pull/299#discussion_r415417547", "createdAt": "2020-04-26T22:38:31Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/event/command/CommandExecuteEvent.java", "diffHunk": "@@ -0,0 +1,143 @@\n+package com.velocitypowered.api.event.command;\n+\n+import com.google.common.base.Preconditions;\n+import com.velocitypowered.api.command.CommandSource;\n+import com.velocitypowered.api.event.ResultedEvent;\n+import com.velocitypowered.api.event.command.CommandExecuteEvent.CommandResult;\n+import java.util.Optional;\n+import org.checkerframework.checker.nullness.qual.NonNull;\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+\n+/**\n+ * This event is fired when a player types in a chat message.\n+ */\n+public final class CommandExecuteEvent implements ResultedEvent<CommandResult> {\n+\n+  private final CommandSource commandSource;\n+  private final String command;\n+  private CommandResult result;\n+\n+  /**\n+   * Constructs a PlayerChatEvent.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQxNzg2MA==", "bodyText": "source, not invoker\n(This is a typo in the original code. Whoops!)", "url": "https://github.com/VelocityPowered/Velocity/pull/299#discussion_r415417860", "createdAt": "2020-04-26T22:40:18Z", "author": {"login": "astei"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/command/VelocityCommandManager.java", "diffHunk": "@@ -47,11 +57,38 @@ public void unregister(final String alias) {\n     this.commands.remove(alias.toLowerCase(Locale.ENGLISH));\n   }\n \n+  /**\n+   * Calls CommandExecuteEvent.\n+   * @param source the command's source\n+   * @param cmd the command\n+   * @return CompletableFuture of event\n+   */\n+  public CompletableFuture<CommandExecuteEvent> callCommandEvent(CommandSource source, String cmd) {\n+    Preconditions.checkNotNull(source, \"invoker\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQxNzk5Mw==", "bodyText": "I'd like to add @Deprecated here", "url": "https://github.com/VelocityPowered/Velocity/pull/299#discussion_r415417993", "createdAt": "2020-04-26T22:41:01Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/command/CommandManager.java", "diffHunk": "@@ -34,11 +36,42 @@\n   void unregister(String alias);\n \n   /**\n-   * Attempts to execute a command from the specified {@code cmdLine}.\n+   * Calls CommandExecuteEvent and attempts to execute a command from the specified {@code cmdLine}\n+   * sync.\n    *\n    * @param source the command's source\n    * @param cmdLine the command to run\n    * @return true if the command was found and executed, false if it was not\n    */\n   boolean execute(CommandSource source, String cmdLine);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQxODE2Nw==", "bodyText": "Velocity has no concept of sync. More accurately this could say Attempts to execute a command using the specified {@code cmdLine} in a blocking fashion.", "url": "https://github.com/VelocityPowered/Velocity/pull/299#discussion_r415418167", "createdAt": "2020-04-26T22:41:47Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/command/CommandManager.java", "diffHunk": "@@ -34,11 +36,42 @@\n   void unregister(String alias);\n \n   /**\n-   * Attempts to execute a command from the specified {@code cmdLine}.\n+   * Calls CommandExecuteEvent and attempts to execute a command from the specified {@code cmdLine}\n+   * sync.\n    *\n    * @param source the command's source\n    * @param cmdLine the command to run\n    * @return true if the command was found and executed, false if it was not\n    */\n   boolean execute(CommandSource source, String cmdLine);\n+\n+  /**\n+   * Attempts to execute a command from the specified {@code cmdLine} sync", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b8e9d646cf94877c89f0b6d631ebb484f58ca2"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26bf94f08f3c4c25304ad023392f348c1bf85170", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/26bf94f08f3c4c25304ad023392f348c1bf85170", "committedDate": "2020-04-27T10:09:04Z", "message": "fix typos, update javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6689f64aefafdcbc0c96c30ec3cc93d1a77283", "author": {"user": {"login": "Leymooo", "name": "Vjat\u0161eslav Maspanov"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/9d6689f64aefafdcbc0c96c30ec3cc93d1a77283", "committedDate": "2020-04-27T10:12:03Z", "message": "forgot annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODU1NjAz", "url": "https://github.com/VelocityPowered/Velocity/pull/299#pullrequestreview-402855603", "createdAt": "2020-04-29T16:51:43Z", "commit": {"oid": "9d6689f64aefafdcbc0c96c30ec3cc93d1a77283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 690, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}