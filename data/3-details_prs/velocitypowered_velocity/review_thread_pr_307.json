{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0OTc5MDU1", "number": 307, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTowMjoyN1rOD6rClg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzo0MlrOD6uqqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODQ5MTc0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTowMjoyN1rOGSovew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTozNjo0NFrOGSp3vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5NTA2Nw==", "bodyText": "Mind adding the same description here?", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422195067", "createdAt": "2020-05-08T15:02:27Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,13 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMzU2NA==", "bodyText": "Oops", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422213564", "createdAt": "2020-05-08T15:36:44Z", "author": {"login": "mikroskeem"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,13 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * TODO", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5NTA2Nw=="}, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODUxMjUxOnYy", "diffSide": "RIGHT", "path": "proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTowODoxNVrOGSo8OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNzowMjozM1rOGSslkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5ODMyOQ==", "bodyText": "Previous code always passed the IP param, should this be true instead?", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422198329", "createdAt": "2020-05-08T15:08:15Z", "author": {"login": "hugmanrique"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java", "diffHunk": "@@ -54,6 +54,14 @@\n   @ConfigKey(\"online-mode\")\n   private boolean onlineMode = true;\n \n+  @Comment({\n+      \"If client's ISP/AS sent from this proxy is different from the one from Mojang's\",\n+      \"authentication server, the player is kicked. Effectively disallows players from\",\n+      \"using proxies or VPNs when enabled.\"\n+  })\n+  @ConfigKey(\"prevent-client-proxy-connections\")\n+  private boolean preventClientProxyConnections = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIxMzUxOQ==", "bodyText": "Vanilla has this off by default, so I went with false.", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422213519", "createdAt": "2020-05-08T15:36:38Z", "author": {"login": "mikroskeem"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java", "diffHunk": "@@ -54,6 +54,14 @@\n   @ConfigKey(\"online-mode\")\n   private boolean onlineMode = true;\n \n+  @Comment({\n+      \"If client's ISP/AS sent from this proxy is different from the one from Mojang's\",\n+      \"authentication server, the player is kicked. Effectively disallows players from\",\n+      \"using proxies or VPNs when enabled.\"\n+  })\n+  @ConfigKey(\"prevent-client-proxy-connections\")\n+  private boolean preventClientProxyConnections = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5ODMyOQ=="}, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI1ODA2NQ==", "bodyText": "I'm inclined to say we should leave this off, as prevent-proxy-connections is a rather weak form of protection that can be easily bypassed.", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422258065", "createdAt": "2020-05-08T17:02:33Z", "author": {"login": "astei"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java", "diffHunk": "@@ -54,6 +54,14 @@\n   @ConfigKey(\"online-mode\")\n   private boolean onlineMode = true;\n \n+  @Comment({\n+      \"If client's ISP/AS sent from this proxy is different from the one from Mojang's\",\n+      \"authentication server, the player is kicked. Effectively disallows players from\",\n+      \"using proxies or VPNs when enabled.\"\n+  })\n+  @ConfigKey(\"prevent-client-proxy-connections\")\n+  private boolean preventClientProxyConnections = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5ODMyOQ=="}, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyOTA4MDAxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNTozMlrOGSueqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzozMlrOGSuiVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTA2NQ==", "bodyText": "Errant \"", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289065", "createdAt": "2020-05-08T18:05:32Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI5MDAwNg==", "bodyText": "Yeah copied from the configuration class, oops.", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422290006", "createdAt": "2020-05-08T18:07:32Z", "author": {"login": "mikroskeem"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTA2NQ=="}, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyOTA4MDc4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNTo0NlrOGSufKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNTo0NlrOGSufKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTE5Mg==", "bodyText": "Make this a little bit more explanatory", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289192", "createdAt": "2020-05-08T18:05:46Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"\n+   * authentication server, the player is kicked. Effectively disallows players from\n+   * using proxies or VPNs when enabled.\n+   *\n+   * @return prevent client proxy connections", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyOTA4MjU3OnYy", "diffSide": "RIGHT", "path": "proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNjoyNVrOGSugSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNjoyNVrOGSugSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTQ4Mw==", "bodyText": "Not sure if we need to escape the &ip= here. We probably should escape the IP but that's it.", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289483", "createdAt": "2020-05-08T18:06:25Z", "author": {"login": "astei"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java", "diffHunk": "@@ -96,8 +96,11 @@ public boolean handle(EncryptionResponse packet) {\n \n       String playerIp = ((InetSocketAddress) mcConnection.getRemoteAddress()).getHostString();\n       String url = String.format(MOJANG_HASJOINED_URL,\n-          urlFormParameterEscaper().escape(login.getUsername()), serverId,\n-          urlFormParameterEscaper().escape(playerIp));\n+          urlFormParameterEscaper().escape(login.getUsername()), serverId);\n+\n+      if (server.getConfiguration().shouldPreventClientProxyConnections()) {\n+        url += urlFormParameterEscaper().escape(\"&ip=\" + playerIp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyOTA4NTg3OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzo0MlrOGSuilw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzo0MlrOGSuilw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI5MDA3MQ==", "bodyText": "\"Effectively\" is too strong. I'd do \"This disallows some VPN and proxy connections but is a weak form of protection.\"", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422290071", "createdAt": "2020-05-08T18:07:42Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"\n+   * authentication server, the player is kicked. Effectively disallows players from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2743, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}