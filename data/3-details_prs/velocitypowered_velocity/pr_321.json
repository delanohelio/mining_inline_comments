{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMTUwNTI3", "number": 321, "title": "adventure API integration into Velocity", "bodyText": "There's a lot going on at a glance, so I want to open this up for review for the community at large.\nVelocity has historically used the text library for dealing with Minecraft chat components. Now with the release of Minecraft 1.16, the opportunity was taken to evolve text into a more encompassing library, called adventure. This PR is an initial draft and not all functionality in the new APIs are supported (as of now, only the functionality that was available in Velocity 1.0.x is available), which will be implemented in the future, as I am only focused on gathering API feedback at this stage.\nThe changes made to the API are as follows:\n\nProxyServer, CommandSource (and by extension Player), and RegisteredServer now implement Audience\n\nProxyServer applies actions to everyone on the proxy, including the console\nRegisteredServer applies to everyone connected to a specific server on the proxy\n\n\nEvery API that took (or returned) net.kyori.text.Component has been deprecated and a replacement API taking the adventure equivalent (net.kyori.adventure.text.Component) was added\nAll Velocity boss bar and title APIs were deprecated - these are replaced by adventure equivalents.\nThe proxy now works internally with adventure Components\n\nWith that being said, I am opening this issue for comment on the changes to the API so far.", "createdAt": "2020-06-29T01:37:06Z", "url": "https://github.com/VelocityPowered/Velocity/pull/321", "merged": true, "mergeCommit": {"oid": "f841d7590a17ae5236da1fc30ad8ee6b2a0b54d7"}, "closed": true, "closedAt": "2020-07-12T16:06:08Z", "author": {"login": "astei"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv2rmQgH2gAyNDQxMTUwNTI3OjJlN2E1OTg5MTZjNDk5MTc5NzlmZWNhN2RiN2RlY2UwYzZhYmQ4NGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0O-iDgH2gAyNDQxMTUwNTI3OmY4NDFkNzU5MGExN2FlNTIzNmRhMWZjMzBhZDhlZTZiMmEwYjU0ZDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e7a598916c49917979feca7db7dece0c6abd84e", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/2e7a598916c49917979feca7db7dece0c6abd84e", "committedDate": "2020-06-29T01:23:01Z", "message": "Initial commit of adventure-adapted Velocity API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70a989e955babd427681465681fa66db60873d9d", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/70a989e955babd427681465681fa66db60873d9d", "committedDate": "2020-06-29T01:29:25Z", "message": "Minor cleanup and add some missing Deprecated tags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODQxMDYx", "url": "https://github.com/VelocityPowered/Velocity/pull/321#pullrequestreview-438841061", "createdAt": "2020-06-29T01:41:44Z", "commit": {"oid": "70a989e955babd427681465681fa66db60873d9d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMTo0MTo0NFrOGqCQeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMTo0MTo0NFrOGqCQeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjczMDM2MA==", "bodyText": "Should be deprecated since it is going away.", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446730360", "createdAt": "2020-06-29T01:41:44Z", "author": {"login": "kashike"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/ProxyAudience.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.velocitypowered.api.proxy;\n+\n+import net.kyori.adventure.audience.Audience;\n+import net.kyori.adventure.bossbar.BossBar;\n+import net.kyori.adventure.inventory.Book;\n+import net.kyori.adventure.sound.Sound;\n+import net.kyori.adventure.sound.SoundStop;\n+import net.kyori.adventure.text.Component;\n+import net.kyori.adventure.title.Title;\n+import org.checkerframework.checker.nullness.qual.NonNull;\n+\n+/**\n+ * Indicates an {@link Audience} that is on the proxy. This interface contains no-op default methods\n+ * that are used to bridge compatibility issues with the new adventure API. This interface will go\n+ * away in Velocity 2.0.0.\n+ */\n+public interface ProxyAudience extends Audience {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70a989e955babd427681465681fa66db60873d9d"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef2835a47577c2ce7b0dfc61d0cbd835a99281f", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/8ef2835a47577c2ce7b0dfc61d0cbd835a99281f", "committedDate": "2020-06-29T01:44:44Z", "message": "Fix API breaking change, deprecate ProxyAudience"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c02d6b00764638516e9cc64ba6b0bb208ede886", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/5c02d6b00764638516e9cc64ba6b0bb208ede886", "committedDate": "2020-06-29T02:01:45Z", "message": "RegisteredServer and ProxyServer now implement MultiAudience"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODU2ODMz", "url": "https://github.com/VelocityPowered/Velocity/pull/321#pullrequestreview-438856833", "createdAt": "2020-06-29T02:52:13Z", "commit": {"oid": "5c02d6b00764638516e9cc64ba6b0bb208ede886"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMjo1MjoxM1rOGqDJOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMjo1MjoxM1rOGqDJOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc0NDg4OQ==", "bodyText": "Changes list says ProxyServer applies actions to all players including console, does this not just give the player audiences?", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446744889", "createdAt": "2020-06-29T02:52:13Z", "author": {"login": "Crypnotic"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/VelocityServer.java", "diffHunk": "@@ -605,11 +606,8 @@ public InetSocketAddress getBoundAddress() {\n   }\n \n   @Override\n-  public void sendMessage(net.kyori.adventure.text.@NonNull Component message) {\n-    Preconditions.checkNotNull(message, \"message\");\n-    for (ConnectedPlayer player : connectionsByUuid.values()) {\n-      player.sendMessage(message);\n-    }\n+  public @NonNull Iterable<? extends Audience> audiences() {\n+    return this.getAllPlayers();\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c02d6b00764638516e9cc64ba6b0bb208ede886"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4f143a2bc1d245b7a8d44a0630ac05e24520924", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/c4f143a2bc1d245b7a8d44a0630ac05e24520924", "committedDate": "2020-06-29T02:52:46Z", "message": "Implement adventure title APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c6039a773d3c7bf3c68e91ea4446483bda9dd83", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/0c6039a773d3c7bf3c68e91ea4446483bda9dd83", "committedDate": "2020-06-29T02:57:28Z", "message": "Make sure console is included in the ProxyServer audience"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2edd82b16660ab75210fb5caabf09d56bd73b28", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/c2edd82b16660ab75210fb5caabf09d56bd73b28", "committedDate": "2020-06-29T03:13:57Z", "message": "Use more idiomatic adventure text serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70698246bf20c669ed030d4d1a6e57cc9249d7a3", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/70698246bf20c669ed030d4d1a6e57cc9249d7a3", "committedDate": "2020-06-29T03:20:46Z", "message": "Get everything compiling and Checkstyle clean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/22afd1cf41b0249f842b890f07ad920fd152a719", "committedDate": "2020-06-29T03:25:09Z", "message": "Since we're deprecating stuff, mark toml4j as deprecated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4OTgyNzI3", "url": "https://github.com/VelocityPowered/Velocity/pull/321#pullrequestreview-438982727", "createdAt": "2020-06-29T08:19:44Z", "commit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwODoxOTo0NFrOGqJroA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwODo0Mjo0NFrOGqKgKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1MjAwMA==", "bodyText": "This should be deprecated", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446852000", "createdAt": "2020-06-29T08:19:44Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/event/ResultedEvent.java", "diffHunk": "@@ -92,7 +93,11 @@ public boolean isAllowed() {\n       return status;\n     }\n \n-    public Optional<Component> getReason() {\n+    public Optional<net.kyori.text.Component> getReason() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1Mjk4NQ==", "bodyText": "Is the @Nullable annotation removal both here and in the new constructor intentional?\nIf so, the constructor is missing the non-null precondition.", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446852985", "createdAt": "2020-06-29T08:21:35Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/event/player/KickedFromServerEvent.java", "diffHunk": "@@ -20,7 +21,7 @@\n \n   private final Player player;\n   private final RegisteredServer server;\n-  private final @Nullable Component originalReason;\n+  private final net.kyori.adventure.text.Component originalReason;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1NTUwOQ==", "bodyText": "Mark message as @Nullable", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446855509", "createdAt": "2020-06-29T08:25:56Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/event/player/KickedFromServerEvent.java", "diffHunk": "@@ -147,10 +186,10 @@ public static DisconnectPlayer create(Component reason) {\n    */\n   public static final class RedirectPlayer implements ServerKickResult {\n \n-    private final Component message;\n+    private final net.kyori.adventure.text.Component message;\n     private final RegisteredServer server;\n \n-    private RedirectPlayer(RegisteredServer server, @Nullable Component message) {\n+    private RedirectPlayer(RegisteredServer server, net.kyori.adventure.text.Component message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1Njc4Nw==", "bodyText": "This is using the new Component and is private, shouldn't be deprecated", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446856787", "createdAt": "2020-06-29T08:27:54Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/event/player/KickedFromServerEvent.java", "diffHunk": "@@ -191,9 +250,10 @@ public static ServerKickResult create(RegisteredServer server) {\n    */\n   public static final class Notify implements ServerKickResult {\n \n-    private final Component message;\n+    private final net.kyori.adventure.text.Component message;\n \n-    private Notify(Component message) {\n+    @Deprecated\n+    private Notify(net.kyori.adventure.text.Component message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 195}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2MzIwMg==", "bodyText": "Minor nit: It's a shame this method cannot be named consistently. Open to change in 2.0 once the other gets removed?", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446863202", "createdAt": "2020-06-29T08:39:01Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -44,8 +43,17 @@\n    * Get the MOTD component shown in the tab list.\n    *\n    * @return the motd component\n+   * @deprecated Use {@link #getMotd()} instead\n    */\n-  Component getMotdComponent();\n+  @Deprecated\n+  net.kyori.text.Component getMotdComponent();\n+\n+  /**\n+   * Get the MOTD component shown in the tab list.\n+   *\n+   * @return the motd component\n+   */\n+  net.kyori.adventure.text.Component getMotd();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2NTQ1MQ==", "bodyText": "Superfluous @NonNull annotation", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r446865451", "createdAt": "2020-06-29T08:42:44Z", "author": {"login": "hugmanrique"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/server/VelocityRegisteredServer.java", "diffHunk": "@@ -145,4 +148,9 @@ public boolean sendPluginMessage(ChannelIdentifier identifier, ByteBuf data) {\n   public String toString() {\n     return \"registered server: \" + serverInfo;\n   }\n+\n+  @Override\n+  public @NonNull Iterable<? extends Audience> audiences() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22afd1cf41b0249f842b890f07ad920fd152a719"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b9dbb74c9963a765f6963cfedc22104f1196909", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/5b9dbb74c9963a765f6963cfedc22104f1196909", "committedDate": "2020-06-29T14:42:01Z", "message": "Fix up some annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5285a3c155b3404a45e52a2d4d1ae88dcc0e2b3d", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/5285a3c155b3404a45e52a2d4d1ae88dcc0e2b3d", "committedDate": "2020-06-30T03:34:59Z", "message": "Remove AdventureCompact in favor of the text 3.x serializer added in KyoriPowered/adventure-platform#23"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Njk3NTQ3", "url": "https://github.com/VelocityPowered/Velocity/pull/321#pullrequestreview-439697547", "createdAt": "2020-06-30T06:12:58Z", "commit": {"oid": "5285a3c155b3404a45e52a2d4d1ae88dcc0e2b3d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjoxMjo1OFrOGqtJ5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjoxMjo1OFrOGqtJ5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMzE5MQ==", "bodyText": "I would recommend extending the more generic Audience in the api interfaces, then using MultiAudience in the implementation (for ProxyServer and co.) That way you don't expose audiences() in the spec.", "url": "https://github.com/VelocityPowered/Velocity/pull/321#discussion_r447433191", "createdAt": "2020-06-30T06:12:58Z", "author": {"login": "Electroid"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/ProxyServer.java", "diffHunk": "@@ -17,13 +17,14 @@\n import java.util.Collection;\n import java.util.Optional;\n import java.util.UUID;\n-import net.kyori.text.Component;\n+import net.kyori.adventure.audience.MultiAudience;\n+import net.kyori.adventure.text.Component;\n import org.checkerframework.checker.nullness.qual.NonNull;\n \n /**\n  * Provides an interface to a Minecraft server proxy.\n  */\n-public interface ProxyServer {\n+public interface ProxyServer extends MultiAudience {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5285a3c155b3404a45e52a2d4d1ae88dcc0e2b3d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b8955a76bbdfc37c9b6509b8cd3193f0407e633", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/1b8955a76bbdfc37c9b6509b8cd3193f0407e633", "committedDate": "2020-07-01T02:33:07Z", "message": "Add initial adventure boss bar support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47560442cae41e35076904ec667f55caa9681d32", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/47560442cae41e35076904ec667f55caa9681d32", "committedDate": "2020-07-01T02:46:21Z", "message": "Remove SyncMap for now, use more obvious and correct MapMaker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07da606abd4e45a6ba552c522818b24c53043343", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/07da606abd4e45a6ba552c522818b24c53043343", "committedDate": "2020-07-01T02:54:49Z", "message": "Add OnceTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "209291e702c483892280ec4e066e9b5592c584e8", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/209291e702c483892280ec4e066e9b5592c584e8", "committedDate": "2020-07-01T04:36:12Z", "message": "Improve the test a little"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86259f788fce7dfe9dfa9044640006e9d70f5c89", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/86259f788fce7dfe9dfa9044640006e9d70f5c89", "committedDate": "2020-07-11T16:00:54Z", "message": "Adjust for recent adventure API changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e84261166e0c7976d149368e109b0c6fc04d096", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/6e84261166e0c7976d149368e109b0c6fc04d096", "committedDate": "2020-07-12T05:49:08Z", "message": "Merge branch 'dev/1.1.0' into adventure-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47462c60691654910f165ef1810240bac5adc97", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/d47462c60691654910f165ef1810240bac5adc97", "committedDate": "2020-07-12T15:42:44Z", "message": "Fix accidential deprecation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21bc050f9cdc0263e0cc14b0672b83dff432f4bd", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/21bc050f9cdc0263e0cc14b0672b83dff432f4bd", "committedDate": "2020-07-12T15:56:50Z", "message": "Fix Checkstyle issues again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f841d7590a17ae5236da1fc30ad8ee6b2a0b54d7", "author": {"user": {"login": "astei", "name": "Andrew Steinborn"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/f841d7590a17ae5236da1fc30ad8ee6b2a0b54d7", "committedDate": "2020-07-12T15:57:07Z", "message": "Remove unused parameter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 711, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}