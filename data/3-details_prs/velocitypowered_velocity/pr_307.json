{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0OTc5MDU1", "number": 307, "title": "Add prevent-proxy-connections option", "bodyText": "Addresses #296\nThis PR is basically ready, but I couldn't come up with decent description for the option as there isn't that much information available for this in my opinion.\nPerhaps option name could be different too?", "createdAt": "2020-05-08T00:06:36Z", "url": "https://github.com/VelocityPowered/Velocity/pull/307", "merged": true, "mergeCommit": {"oid": "2418cc271af279b5d3c5f390ca232e8040facad3"}, "closed": true, "closedAt": "2020-05-08T18:57:21Z", "author": {"login": "mikroskeem"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfTU4GAFqTQwODMwMzE1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfWmGuAFqTQwODQ1Mjg2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzAzMTU5", "url": "https://github.com/VelocityPowered/Velocity/pull/307#pullrequestreview-408303159", "createdAt": "2020-05-08T15:02:27Z", "commit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTowMjoyN1rOGSovew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTowODoxNVrOGSo8OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5NTA2Nw==", "bodyText": "Mind adding the same description here?", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422195067", "createdAt": "2020-05-08T15:02:27Z", "author": {"login": "hugmanrique"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,13 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5ODMyOQ==", "bodyText": "Previous code always passed the IP param, should this be true instead?", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422198329", "createdAt": "2020-05-08T15:08:15Z", "author": {"login": "hugmanrique"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java", "diffHunk": "@@ -54,6 +54,14 @@\n   @ConfigKey(\"online-mode\")\n   private boolean onlineMode = true;\n \n+  @Comment({\n+      \"If client's ISP/AS sent from this proxy is different from the one from Mojang's\",\n+      \"authentication server, the player is kicked. Effectively disallows players from\",\n+      \"using proxies or VPNs when enabled.\"\n+  })\n+  @ConfigKey(\"prevent-client-proxy-connections\")\n+  private boolean preventClientProxyConnections = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01fc1776864df8327efa988da6330bb5ec080b25"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NDIwOTA5", "url": "https://github.com/VelocityPowered/Velocity/pull/307#pullrequestreview-408420909", "createdAt": "2020-05-08T18:05:31Z", "commit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNTozMlrOGSueqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNjoyNVrOGSugSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTA2NQ==", "bodyText": "Errant \"", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289065", "createdAt": "2020-05-08T18:05:32Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTE5Mg==", "bodyText": "Make this a little bit more explanatory", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289192", "createdAt": "2020-05-08T18:05:46Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"\n+   * authentication server, the player is kicked. Effectively disallows players from\n+   * using proxies or VPNs when enabled.\n+   *\n+   * @return prevent client proxy connections", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4OTQ4Mw==", "bodyText": "Not sure if we need to escape the &ip= here. We probably should escape the IP but that's it.", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422289483", "createdAt": "2020-05-08T18:06:25Z", "author": {"login": "astei"}, "path": "proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java", "diffHunk": "@@ -96,8 +96,11 @@ public boolean handle(EncryptionResponse packet) {\n \n       String playerIp = ((InetSocketAddress) mcConnection.getRemoteAddress()).getHostString();\n       String url = String.format(MOJANG_HASJOINED_URL,\n-          urlFormParameterEscaper().escape(login.getUsername()), serverId,\n-          urlFormParameterEscaper().escape(playerIp));\n+          urlFormParameterEscaper().escape(login.getUsername()), serverId);\n+\n+      if (server.getConfiguration().shouldPreventClientProxyConnections()) {\n+        url += urlFormParameterEscaper().escape(\"&ip=\" + playerIp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NDIyMjQx", "url": "https://github.com/VelocityPowered/Velocity/pull/307#pullrequestreview-408422241", "createdAt": "2020-05-08T18:07:42Z", "commit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzo0MlrOGSuilw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxODowNzo0MlrOGSuilw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI5MDA3MQ==", "bodyText": "\"Effectively\" is too strong. I'd do \"This disallows some VPN and proxy connections but is a weak form of protection.\"", "url": "https://github.com/VelocityPowered/Velocity/pull/307#discussion_r422290071", "createdAt": "2020-05-08T18:07:42Z", "author": {"login": "astei"}, "path": "api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java", "diffHunk": "@@ -62,6 +62,15 @@\n    */\n   boolean isOnlineMode();\n \n+  /**\n+   * If client's ISP/AS sent from this proxy is different from the one from Mojang's\"\n+   * authentication server, the player is kicked. Effectively disallows players from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5faa561ead6e9d1ef28482fca667425fda5d62d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f03d5d504ad0e1e222acbeb311875e7857d70b", "author": {"user": {"login": "mikroskeem", "name": "Mark Vainomaa"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/21f03d5d504ad0e1e222acbeb311875e7857d70b", "committedDate": "2020-05-08T18:16:12Z", "message": "Add prevent-proxy-connections option to make sending client IP to Mojang toggleable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aec40d77b795c7f04b5fe6065aada838b24bbdae", "author": {"user": {"login": "mikroskeem", "name": "Mark Vainomaa"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/aec40d77b795c7f04b5fe6065aada838b24bbdae", "committedDate": "2020-05-08T18:15:11Z", "message": "Also improve configuration comment"}, "afterCommit": {"oid": "21f03d5d504ad0e1e222acbeb311875e7857d70b", "author": {"user": {"login": "mikroskeem", "name": "Mark Vainomaa"}}, "url": "https://github.com/VelocityPowered/Velocity/commit/21f03d5d504ad0e1e222acbeb311875e7857d70b", "committedDate": "2020-05-08T18:16:12Z", "message": "Add prevent-proxy-connections option to make sending client IP to Mojang toggleable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NDUyODYx", "url": "https://github.com/VelocityPowered/Velocity/pull/307#pullrequestreview-408452861", "createdAt": "2020-05-08T18:57:16Z", "commit": {"oid": "21f03d5d504ad0e1e222acbeb311875e7857d70b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 698, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}