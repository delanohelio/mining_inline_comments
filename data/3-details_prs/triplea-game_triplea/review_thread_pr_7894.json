{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTI4MTQz", "number": 7894, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMjoyMjoxM1rOEs1z2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMjoyMjoxM1rOEs1z2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NDU0NDI2OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMjoyMjoxM1rOHgTGsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMjoyMjoxM1rOHgTGsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYyOTQ4OQ==", "bodyText": "Avoid too many return statements within this method.", "url": "https://github.com/triplea-game/triplea/pull/7894#discussion_r503629489", "createdAt": "2020-10-13T02:22:13Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -61,62 +62,70 @@ private GameDataManager() {}\n    *     closing this stream; it will not be closed when this method returns.\n    * @return The loaded game data, or an empty optional if an error occurs.\n    */\n-  @SuppressWarnings(\"deprecation\")\n   public static Optional<GameData> loadGame(final InputStream is) {\n     try (ObjectInputStream input = new ObjectInputStream(new GZIPInputStream(is))) {\n       final Object version = input.readObject();\n \n-      if (version instanceof games.strategy.util.Version) {\n-        log.warn(\n-            String.format(\n-                \"Incompatible engine versions. We are: %s<br>\"\n-                    + \"Trying to load incompatible save game version: %s<br>\"\n-                    + \"To download an older version of TripleA,<br>\"\n-                    + \"please visit: <a href=\\\"%s\\\">%s</a>\",\n-                ClientContext.engineVersion(),\n-                ((games.strategy.util.Version) version).getExactVersion(),\n-                UrlConstants.OLD_DOWNLOADS_WEBSITE,\n-                UrlConstants.OLD_DOWNLOADS_WEBSITE));\n-        return Optional.empty();\n-      } else if (!(version instanceof Version)) {\n-        log.warn(\n-            \"Incompatible engine version with save game, \"\n-                + \"unable to determine version of the save game\");\n-        return Optional.empty();\n-      } else if (ClientContext.engineVersion().getMajor() != ((Version) version).getMajor()) {\n-        log.warn(\n-            String.format(\n-                \"Incompatible engine versions. We are: %s<br>\"\n-                    + \"Trying to load game created with: %s<br>\"\n-                    + \"To download the latest version of TripleA,<br>\"\n-                    + \"please visit: <a href=\\\"%s\\\">%s</a>\",\n-                ClientContext.engineVersion(),\n-                version,\n-                UrlConstants.DOWNLOAD_WEBSITE,\n-                UrlConstants.DOWNLOAD_WEBSITE));\n-        return Optional.empty();\n-      } else if (!HeadlessGameServer.headless()\n-          && ((Version) version).getMinor() > ClientContext.engineVersion().getMinor()) {\n-        // Prompt the user to upgrade\n-        log.warn(\n-            \"This save was made by a newer version of TripleA.<br>\"\n-                + \"To load this save, download the latest version of TripleA: \"\n-                + \"<a href=\\\"{}\\\">{}</a>\",\n-            UrlConstants.DOWNLOAD_WEBSITE,\n-            UrlConstants.DOWNLOAD_WEBSITE);\n-        return Optional.empty();\n-      } else {\n+      if (isCompatibleVersion(version) || !ClientSetting.saveGameCompatibilityCheck.getSetting()) {\n         final GameData data = (GameData) input.readObject();\n         data.postDeSerialize();\n         loadDelegates(input, data);\n         return Optional.of(data);\n+      } else {\n+        return Optional.empty();\n       }\n     } catch (final ClassNotFoundException | IOException e) {\n       log.error(\"Error loading game data\", e);\n       return Optional.empty();\n     }\n   }\n \n+  @SuppressWarnings(\"deprecation\")\n+  private static boolean isCompatibleVersion(final Object version) {\n+    if (version instanceof games.strategy.util.Version) {\n+      log.warn(\n+          String.format(\n+              \"Incompatible engine versions. We are: %s<br>\"\n+                  + \"Trying to load incompatible save game version: %s<br>\"\n+                  + \"To download an older version of TripleA,<br>\"\n+                  + \"please visit: <a href=\\\"%s\\\">%s</a>\",\n+              ClientContext.engineVersion(),\n+              ((games.strategy.util.Version) version).getExactVersion(),\n+              UrlConstants.OLD_DOWNLOADS_WEBSITE,\n+              UrlConstants.OLD_DOWNLOADS_WEBSITE));\n+      return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0c629d88be96d28e35da78f71b29bb57a4ac07d"}, "originalPosition": 84}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2757, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}