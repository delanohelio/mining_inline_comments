{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjI0Njgz", "number": 5822, "title": "Change bcrypt dependency", "bodyText": "Follow-up to #5804\nIt looks like our jbcrypt library is no longer actively maintained.\nThat's why I decided to migrate to a what seems to be modern variant of the library https://github.com/patrickfav/bcrypt with good documentation and a modern approach to this task.\nI'm about 99% sure that I chose the correct \"default settings\", we should consider increasing the amount of rounds (currently 10), or moving to a new hashing algorithm like argon2 when we're already at it anyways. See https://medium.com/@mpreziuso/password-hashing-pbkdf2-scrypt-bcrypt-and-argon2-e25aaf41598e\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[] Manual testing done", "createdAt": "2020-01-04T15:59:58Z", "url": "https://github.com/triplea-game/triplea/pull/5822", "merged": true, "mergeCommit": {"oid": "f9f4cb1d3eaac6f24a5e29d28349bb0e7bf554d9"}, "closed": true, "closedAt": "2020-01-10T14:10:08Z", "author": {"login": "RoiEXLab"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3HXFlgFqTMzODM2Mzg2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4-_MzAFqTM0MTE3NzA4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzYzODYw", "url": "https://github.com/triplea-game/triplea/pull/5822#pullrequestreview-338363860", "createdAt": "2020-01-04T18:15:13Z", "commit": {"oid": "374c121f17070a87b51d3b29210ef2c23ab6d48e"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxODoxNToxNFrOFaOrwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxODoyNjozN1rOFaOtmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA0Nzg3Mw==", "bodyText": "Looks like someone went to the trouble to sort this list lexicographically; might want to move this entry up.", "url": "https://github.com/triplea-game/triplea/pull/5822#discussion_r363047873", "createdAt": "2020-01-04T18:15:14Z", "author": {"login": "ssoloff"}, "path": "build.gradle", "diffHunk": "@@ -95,7 +95,7 @@ subprojects {\n         jaxbApiVersion = '2.3.1'\n         jaxbCoreVersion = '2.3.0.1'\n         jaxbImplVersion = '2.3.2'\n-        jbcryptVersion = '0.4'\n+        bcryptVersion = '0.9.0'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "374c121f17070a87b51d3b29210ef2c23ab6d48e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA0ODM0NA==", "bodyText": "I don't see any other changes in the game-core project.  Is this dependency still needed?", "url": "https://github.com/triplea-game/triplea/pull/5822#discussion_r363048344", "createdAt": "2020-01-04T18:26:37Z", "author": {"login": "ssoloff"}, "path": "game-core/build.gradle", "diffHunk": "@@ -16,7 +14,7 @@ dependencies {\n     implementation \"org.apache.commons:commons-math3:$commonsMathVersion\"\n     implementation \"org.apache.httpcomponents:httpclient:$apacheHttpComponentsVersion\"\n     implementation \"org.apache.httpcomponents:httpmime:$apacheHttpComponentsVersion\"\n-    implementation \"org.mindrot:jbcrypt:$jbcryptVersion\"\n+    implementation \"at.favre.lib:bcrypt:$bcryptVersion\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "374c121f17070a87b51d3b29210ef2c23ab6d48e"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NDIzMjcx", "url": "https://github.com/triplea-game/triplea/pull/5822#pullrequestreview-338423271", "createdAt": "2020-01-05T21:50:02Z", "commit": {"oid": "9329544f4ee318020fd712379e412d0e595bedd8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMTo1MDowMlrOFaTDFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMTo1Njo0NlrOFaTEpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExOTM4Mw==", "bodyText": "The level of abstraction is perhaps inconsistent here, would you agree @RoiEXLab ?\nNotably, we have a high level call PasswordBCrypter.hashPasswordWithSalt, which abstracts away parameters and configuration, then we have a more low level call to verify.\nSecond, the params to verifyer seem to be chosen for specific reasons, but it's not immediately clear (missing context) what those reasons were.\nI think you could resolve both concerns by moving the verifyer call to a similar static method. That method could then be documented to note why the parameters are chosen as they are, and we'd have a consistent abstraction in this method. For example:\nfinal String hashedPassword = PasswordBCrypter.hashPasswordWithSalt(password);\nreturn BcryptedPasswordVerifyer.verify(hashedPassword);\n\nWDYT @RoiEXLab ?\n(A third benefit, we would not need to repeat the verifyer parameters in test, DRY)", "url": "https://github.com/triplea-game/triplea/pull/5822#discussion_r363119383", "createdAt": "2020-01-05T21:50:02Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/server/user/account/login/authorizer/BCryptHashVerifier.java", "diffHunk": "@@ -1,14 +1,17 @@\n package org.triplea.server.user.account.login.authorizer;\n \n+import at.favre.lib.crypto.bcrypt.BCrypt;\n+import at.favre.lib.crypto.bcrypt.LongPasswordStrategies;\n import java.util.function.BiPredicate;\n-import org.mindrot.jbcrypt.BCrypt;\n import org.triplea.server.user.account.PasswordBCrypter;\n \n public class BCryptHashVerifier implements BiPredicate<String, String> {\n   @Override\n   public boolean test(final String password, final String databaseBcrypted) {\n     // TODO: Md5-Deprecation Move SHA512 hashing to client side\n     final String hashedPassword = PasswordBCrypter.hashPasswordWithSalt(password);\n-    return BCrypt.checkpw(hashedPassword, databaseBcrypted);\n+    return BCrypt.verifyer(null, LongPasswordStrategies.none())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9329544f4ee318020fd712379e412d0e595bedd8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExOTY2NA==", "bodyText": "Really similar to my other comment, I think we may benefit to create a utility method around this hasing method:\n\nprovides a good place to document decisions/parameters:\n\nwhy '10'?\nwhy 'LongPasswordStrategies.none()'?\n\n\nAvoids repetition between source code and test (DRY)", "url": "https://github.com/triplea-game/triplea/pull/5822#discussion_r363119664", "createdAt": "2020-01-05T21:54:46Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/server/user/account/PasswordBCrypter.java", "diffHunk": "@@ -18,7 +19,7 @@\n   public String apply(final String password) {\n     // TODO: Md5-Deprecation remove hashing here, move to client-side\n     final String hashed = hashPasswordWithSalt(password);\n-    return BCrypt.hashpw(hashed, BCrypt.gensalt());\n+    return BCrypt.with(LongPasswordStrategies.none()).hashToString(10, hashed.toCharArray());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9329544f4ee318020fd712379e412d0e595bedd8"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzExOTc4MA==", "bodyText": "Are we still using a bcrypt salt anywhere?\nIf not, for this PR or a fast-follow, we can clean up the configuration that was intended to inject a salt:\n\nhttps://github.com/triplea-game/triplea/blob/master/http-server/src/main/java/org/triplea/server/http/AppConfig.java#L57\nhttps://github.com/triplea-game/triplea/blob/master/http-server/configuration.yml#L12\nhttps://github.com/triplea-game/triplea/blob/master/infrastructure/ansible/roles/http_server/templates/configuration.yml.j2#L8\nhttps://github.com/triplea-game/triplea/blob/master/infrastructure/ansible/roles/http_server/defaults/main.yml#L20", "url": "https://github.com/triplea-game/triplea/pull/5822#discussion_r363119780", "createdAt": "2020-01-05T21:56:46Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/server/user/account/PasswordBCrypter.java", "diffHunk": "@@ -18,7 +19,7 @@\n   public String apply(final String password) {\n     // TODO: Md5-Deprecation remove hashing here, move to client-side\n     final String hashed = hashPasswordWithSalt(password);\n-    return BCrypt.hashpw(hashed, BCrypt.gensalt());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9329544f4ee318020fd712379e412d0e595bedd8"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4db9fc711df759e191c34a36a6b2bf2b9e2f6fdf", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/4db9fc711df759e191c34a36a6b2bf2b9e2f6fdf", "committedDate": "2020-01-06T15:27:40Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "606c74552422cab95008c9c088f25fbcdabb8d3a", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/606c74552422cab95008c9c088f25fbcdabb8d3a", "committedDate": "2020-01-06T15:27:40Z", "message": "Migrate to modern implementation of jBcrypt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d49af03e31faff67c0caac905b8a028f01fc8d2", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/6d49af03e31faff67c0caac905b8a028f01fc8d2", "committedDate": "2020-01-06T15:27:40Z", "message": "Fix password overflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48eb23aaeb1b33fcd93371461ef7f2fd355b5cff", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/48eb23aaeb1b33fcd93371461ef7f2fd355b5cff", "committedDate": "2020-01-06T15:27:40Z", "message": "Rely on default version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2be919bc1787545692b51d252fdd84c67034d03", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/e2be919bc1787545692b51d252fdd84c67034d03", "committedDate": "2020-01-06T15:27:40Z", "message": "Remove bcrypt dependency from game-core"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4631bfb1ecea67b747fba6b98cec1236c800f0b", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/a4631bfb1ecea67b747fba6b98cec1236c800f0b", "committedDate": "2020-01-06T15:28:24Z", "message": "Restore lexicographical ordering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6e192250ff4fc103dc4a6aeae6cca30a3812db", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/bb6e192250ff4fc103dc4a6aeae6cca30a3812db", "committedDate": "2020-01-06T15:28:24Z", "message": "Extract bcrypt methods to class and add documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e9b5e4db937812a1e2880d0e4c9f0faa42afccc", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/2e9b5e4db937812a1e2880d0e4c9f0faa42afccc", "committedDate": "2020-01-06T15:27:08Z", "message": "Extract bcrypt methods to class and add documentation"}, "afterCommit": {"oid": "bb6e192250ff4fc103dc4a6aeae6cca30a3812db", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/bb6e192250ff4fc103dc4a6aeae6cca30a3812db", "committedDate": "2020-01-06T15:28:24Z", "message": "Extract bcrypt methods to class and add documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMTc3MDg5", "url": "https://github.com/triplea-game/triplea/pull/5822#pullrequestreview-341177089", "createdAt": "2020-01-10T13:57:50Z", "commit": {"oid": "bb6e192250ff4fc103dc4a6aeae6cca30a3812db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3748, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}