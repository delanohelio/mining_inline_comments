{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2ODkyMzg3", "number": 7264, "title": "Maps db", "bodyText": "Summary\n\nadd maps-db subproject\nadd docker and support files to launch a maps-db (on port 5433)\nupdate infrastructure to deploy a maps-db schema\nupdate infrastructure flyway role to run multiple migrations parameterized by schema\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix\n[] Other:   \nTesting\ncd infrastructure\nvagrant up\n./run_ansible_vagrant -t \"database,flyway\" -e using_latest=true\nssh vagrant\nsudo -u postgres psql\n\\l\n\nThe last command is to list databases and verified that the maps-db schema existed\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-07-27T04:40:01Z", "url": "https://github.com/triplea-game/triplea/pull/7264", "merged": true, "mergeCommit": {"oid": "e4774388c611aad3307b2df3b0ca17f00fc932f0"}, "closed": true, "closedAt": "2020-07-27T23:33:25Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc45WpbAH2gAyNDU2ODkyMzg3OmM4NDcxMDA2MWJkMzBmZjMwNDY4ZWYyOTAwNDU4YWY2NTRkMzFmNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5KfmgAFqTQ1NjIwNDE0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c84710061bd30ff30468ef2900458af654d31f4e", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c84710061bd30ff30468ef2900458af654d31f4e", "committedDate": "2020-07-27T03:35:10Z", "message": "Add a build.gradle file to run flyway migrations for maps database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c87d8a92bd368a1d092d817cf0efccef6c7f1e8", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/6c87d8a92bd368a1d092d817cf0efccef6c7f1e8", "committedDate": "2020-07-27T03:47:23Z", "message": "Add maps-db as a subproject"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2edf0f367c2816265ab82b19bf58557aa80ae779", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/2edf0f367c2816265ab82b19bf58557aa80ae779", "committedDate": "2020-07-27T03:47:23Z", "message": "add a run-flyway script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd4422f39fd0451b3b0cf3bece43cf7db8707bd2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/dd4422f39fd0451b3b0cf3bece43cf7db8707bd2", "committedDate": "2020-07-27T03:47:23Z", "message": "Add an initial migrations file to add a comment on the maps_db"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6402e49b8e281239194a6bdb1c6f9ec4e64fcca6", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/6402e49b8e281239194a6bdb1c6f9ec4e64fcca6", "committedDate": "2020-07-27T03:47:54Z", "message": "Add docker to run maps DB on port 5433"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d26584e27f17238b87dc579865c780e6085016e", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/0d26584e27f17238b87dc579865c780e6085016e", "committedDate": "2020-07-27T03:49:04Z", "message": "Add a helper script 'connect_to_db' to connect to the new maps_db (docker container)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80cdaff167dd62ce3c9d14fdd4c0e1d8d895e17c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/80cdaff167dd62ce3c9d14fdd4c0e1d8d895e17c", "committedDate": "2020-07-27T03:51:51Z", "message": "Add utility script 'drop_db' to drop maps_db data and recreate the database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb20795ac413185146f65da1204a3981e201beb", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/5cb20795ac413185146f65da1204a3981e201beb", "committedDate": "2020-07-27T04:00:30Z", "message": "Infrastructure: add maps_db schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/97c36ed781d984745e3dc054eb7365a5e4224c61", "committedDate": "2020-07-27T04:29:45Z", "message": "Infrastructure: update flyway to run multiple migrations, parameterized by database"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NDY3MTUw", "url": "https://github.com/triplea-game/triplea/pull/7264#pullrequestreview-455467150", "createdAt": "2020-07-27T04:41:13Z", "commit": {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDo0MToxM1rOG3Ta6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDo0MToxM1rOG3Ta6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0MzA0OA==", "bodyText": "Note, small simplification where this if statement was removed. If the target file DNE then we'll proceed to run gradle. Before we checked as well if the gradle output existed to skip the gradle run, instead now we'll just run gradle anyways.", "url": "https://github.com/triplea-game/triplea/pull/7264#discussion_r460643048", "createdAt": "2020-07-27T04:41:13Z", "author": {"login": "DanVanAtta"}, "path": "infrastructure/run_ansible_vagrant", "diffHunk": "@@ -46,16 +46,15 @@ function buildJars() {\n \n function buildMigrations() {\n   local targetFolder=./ansible/roles/database/flyway/files/\n-  local zipFile=migrations.zip\n-  if [ ! -e $targetFolder/$zipFile ]; then\n-    if [ ! -e ../lobby-db/build/distributions/$zipFile ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NDY3MjY5", "url": "https://github.com/triplea-game/triplea/pull/7264#pullrequestreview-455467269", "createdAt": "2020-07-27T04:41:43Z", "commit": {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDo0MTo0NFrOG3TbXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDo0MTo0NFrOG3TbXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0MzE2NQ==", "bodyText": "Declare and assign separately to avoid masking return values.", "url": "https://github.com/triplea-game/triplea/pull/7264#discussion_r460643165", "createdAt": "2020-07-27T04:41:44Z", "author": {"login": "codeclimate"}, "path": "maps-db/run_docker", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+\n+# Launches a local docker container that will have a PSQL DB on it.\n+# Note, it takes a few seconds for database to initialize after running\n+# this script. Once initializated then 'run_flyway' can be run to install\n+# schema and tables.\n+\n+function stop_container() {\n+  echo \"Stopping docker...\"\n+  local runningContainerId=$(docker container ls | grep triplea-lobby-db | cut -f 1 -d ' ')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "041ce4099cdc3fcf699a4f3fefd5031c29ef8f33", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/041ce4099cdc3fcf699a4f3fefd5031c29ef8f33", "committedDate": "2020-07-27T05:41:31Z", "message": "Update maps-db build to parameterize the DB port number"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "562e56bcc54732e3eb8f9c3a6396cc21a28c3bf8", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/562e56bcc54732e3eb8f9c3a6396cc21a28c3bf8", "committedDate": "2020-07-27T05:41:50Z", "message": "Update travis build to create maps_db database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20bf51e74e2426c758a5dd91c6e358e00ca9ea58", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/20bf51e74e2426c758a5dd91c6e358e00ca9ea58", "committedDate": "2020-07-27T05:47:54Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33039f604e7d148896a6821d8a3dab5515045b1f", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/33039f604e7d148896a6821d8a3dab5515045b1f", "committedDate": "2020-07-27T05:51:27Z", "message": "Fix shellscript (shellcheck) declare and then assign value to avoid masking return value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjA0MTQ0", "url": "https://github.com/triplea-game/triplea/pull/7264#pullrequestreview-456204144", "createdAt": "2020-07-27T23:33:20Z", "commit": {"oid": "33039f604e7d148896a6821d8a3dab5515045b1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3248, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}