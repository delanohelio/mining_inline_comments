{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1ODE2Nzg1", "number": 7631, "title": "Add Support for (most) 1.8 maps", "bodyText": "commit cca0406\nAdd: Support XML tag aliases, support \"attatchment\" mispelling\n\nThis initial round of updates allows for basic support of 1.8 maps,\nthey will load after this update.\n\ncommit 56e0ce4\nAdd support to load (most) 1.8 maps\n\n- Add conversion code to match attachments spelled either as 'attatchment' or as 'attachment\n\n- Add annotation @RenameOnNextMajorRelease to help us know which items we can rename\n and to what when save game compatibility can be broken.\n\n- Add ignore for properties: \"takeUnitControl\" and \"giveUnitControl\"\n\nAdd conversion logic for:\n- isParatroop -> isAirTransportable\n- isInfantry & isMechanized -> isLandTransportable\n- Battleship|Units repair at beginning|end of round -> Units Repair at beginning|end of round\n- 'occupiedTerrOf' -> 'originalOwner'\n- 'victoryCity=false' -> 'victoryCity=0'\n- 'isImpassible' -> 'isImpassable'\n- 'turns' -> 'rounds'\n\n\nTesting\n\nBeyond the automated testing, I downloaded a number of 1.8 maps from sourceforge and verified that they could be loaded.\nI verified the a number of linked commits in: #1033, that those updates were included in the conversion logic\n\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nThe list of  the 1.8 to 1.9 changes is in: #1033\nRelease Note\n\nFEATURE|Build in support to be able to load (most) 1.8 maps. 1.8 \"variant\" maps will not work, though most others should now load without issue.", "createdAt": "2020-09-12T08:13:20Z", "url": "https://github.com/triplea-game/triplea/pull/7631", "merged": true, "mergeCommit": {"oid": "9c05bae7c6d12695978c35f4faac63885ff395b8"}, "closed": true, "closedAt": "2020-09-13T01:46:21Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIDxMwgH2gAyNDg1ODE2Nzg1OmNjYTA0MDY0MGQxNjEzNjVkOTNkMzA5MDI2YTA5NTBlNjE3ZGRkYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI08-xAFqTQ4Nzg4MDk3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cca040640d161365d93d309026a0950e617ddda3", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/cca040640d161365d93d309026a0950e617ddda3", "committedDate": "2020-09-12T06:12:05Z", "message": "Add: Support XML tag aliases, support \"attatchment\" mispelling\n\nThis initial round of updates allows for basic support of 1.8 maps,\nthey will load after this update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b", "committedDate": "2020-09-12T08:10:41Z", "message": "Add support to load (most) 1.8 maps\n\n- Add conversion code to match attachments spelled either as 'attatchment' or as 'attachment\n\n- Add annotation @RenameOnNextMajorRelease to help us know which items we can rename\n and to what when save game compatibility can be broken.\n\n- Add ignore for properties: \"takeUnitControl\" and \"giveUnitControl\"\n\nAdd conversion logic for:\n- isParatroop -> isAirTransportable\n- isInfantry & isMechanized -> isLandTransportable\n- Battleship|Units repair at beginning|end of round -> Units Repair at beginning|end of round\n- 'occupiedTerrOf' -> 'originalOwner'\n- 'victoryCity=false' -> 'victoryCity=0'\n- 'isImpassible' -> 'isImpassable'\n- 'turns' -> 'rounds'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjE0MTA2", "url": "https://github.com/triplea-game/triplea/pull/7631#pullrequestreview-487214106", "createdAt": "2020-09-12T08:15:53Z", "commit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxNTo1NFrOHQzlAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxNTo1NFrOHQzlBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NDMyMg==", "bodyText": "Method mapXmlToObject has 68 lines of code (exceeds 50 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r487384322", "createdAt": "2020-09-12T08:15:54Z", "author": {"login": "codeclimate"}, "path": "xml-reader/src/main/java/org/triplea/generic/xml/reader/XmlMapper.java", "diffHunk": "@@ -28,6 +33,11 @@ public XmlMapper(final InputStream inputStream) throws XmlParsingException {\n   }\n \n   public <T> T mapXmlToObject(final Class<T> pojo) throws XmlParsingException {\n+    return mapXmlToObject(pojo, pojo.getSimpleName());\n+  }\n+\n+  public <T> T mapXmlToObject(final Class<T> pojo, final String tagName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NDMyMw==", "bodyText": "Avoid too many return statements within this method.", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r487384323", "createdAt": "2020-09-12T08:15:54Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/LegacyPropertyMapper.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package games.strategy.engine.data.gameparser;\n+\n+import games.strategy.triplea.Constants;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * This converts property names and values that were used in older map XMLs and updates those values\n+ * to their newer versions. This is useful to allow the game code to only use the newer names and\n+ * values while still being able to load older maps.\n+ */\n+@UtilityClass\n+class LegacyPropertyMapper {\n+\n+  static String mapLegacyOptionName(final String optionName) {\n+    if (optionName.equalsIgnoreCase(\"isParatroop\")) {\n+      return \"isAirTransportable\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NDMyNA==", "bodyText": "Avoid too many return statements within this method.", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r487384324", "createdAt": "2020-09-12T08:15:54Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/LegacyPropertyMapper.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package games.strategy.engine.data.gameparser;\n+\n+import games.strategy.triplea.Constants;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * This converts property names and values that were used in older map XMLs and updates those values\n+ * to their newer versions. This is useful to allow the game code to only use the newer names and\n+ * values while still being able to load older maps.\n+ */\n+@UtilityClass\n+class LegacyPropertyMapper {\n+\n+  static String mapLegacyOptionName(final String optionName) {\n+    if (optionName.equalsIgnoreCase(\"isParatroop\")) {\n+      return \"isAirTransportable\";\n+    } else if (optionName.equalsIgnoreCase(\"isInfantry\")\n+        || optionName.equalsIgnoreCase(\"isMechanized\")) {\n+      return \"isLandTransportable\";\n+    } else if (optionName.equalsIgnoreCase(\"occupiedTerrOf\")) {\n+      return Constants.ORIGINAL_OWNER;\n+    } else if (optionName.equalsIgnoreCase(\"isImpassible\")) {\n+      return \"isImpassable\";\n+    } else if (optionName.equalsIgnoreCase(\"turns\")) {\n+      return \"rounds\";\n+    }\n+    return optionName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjE0MjU4", "url": "https://github.com/triplea-game/triplea/pull/7631#pullrequestreview-487214258", "createdAt": "2020-09-12T08:18:17Z", "commit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxODoxN1rOHQzlxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxODoxN1rOHQzlxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NDUxOA==", "bodyText": "Codacy found an issue: Avoid really long methods.", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r487384518", "createdAt": "2020-09-12T08:18:17Z", "author": {"login": "DanVanAtta"}, "path": "xml-reader/src/main/java/org/triplea/generic/xml/reader/XmlMapper.java", "diffHunk": "@@ -28,6 +33,11 @@ public XmlMapper(final InputStream inputStream) throws XmlParsingException {\n   }\n \n   public <T> T mapXmlToObject(final Class<T> pojo) throws XmlParsingException {\n+    return mapXmlToObject(pojo, pojo.getSimpleName());\n+  }\n+\n+  public <T> T mapXmlToObject(final Class<T> pojo, final String tagName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjE0MjU5", "url": "https://github.com/triplea-game/triplea/pull/7631#pullrequestreview-487214259", "createdAt": "2020-09-12T08:18:18Z", "commit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxODoxOFrOHQzlxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoxODoxOFrOHQzlxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NDUxOQ==", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r487384519", "createdAt": "2020-09-12T08:18:18Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/attachments/TriggerAttachment.java", "diffHunk": "@@ -908,11 +908,13 @@ private void resetPlayers() {\n     players = new ArrayList<>();\n   }\n \n-  private void setPlayerAttachmentName(final String name) throws GameParseException {\n-    if (name == null) {\n-      playerAttachmentName = null;\n+  private void setPlayerAttachmentName(final String playerAttachmentName)\n+      throws GameParseException {\n+    if (playerAttachmentName == null) {\n+      this.playerAttachmentName = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODgwOTcy", "url": "https://github.com/triplea-game/triplea/pull/7631#pullrequestreview-487880972", "createdAt": "2020-09-14T15:18:29Z", "commit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNToxODoyOVrOHRaF_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNToyODozNVrOHRamjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAxNTM1Ng==", "bodyText": "I mean we all know why this exists, but it would be nice documenting it here in the code nevertheless", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r488015356", "createdAt": "2020-09-14T15:18:29Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/data/ChangeAttachmentChange.java", "diffHunk": "@@ -59,13 +58,16 @@ public ChangeAttachmentChange(\n       final Object newValue,\n       final Object oldValue,\n       final String property,\n-      final boolean resetFirst) {\n-    this.attachmentName = attachmentName;\n+      final boolean clearFirst) {\n+    this.attachmentName =\n+        Optional.ofNullable(attachmentName)\n+            .map(name -> name.replaceAll(\"ttatch\", \"ttach\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAxNTc5Mw==", "bodyText": "Same on other places", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r488015793", "createdAt": "2020-09-14T15:19:04Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/data/ChangeAttachmentChange.java", "diffHunk": "@@ -59,13 +58,16 @@ public ChangeAttachmentChange(\n       final Object newValue,\n       final Object oldValue,\n       final String property,\n-      final boolean resetFirst) {\n-    this.attachmentName = attachmentName;\n+      final boolean clearFirst) {\n+    this.attachmentName =\n+        Optional.ofNullable(attachmentName)\n+            .map(name -> name.replaceAll(\"ttatch\", \"ttach\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAxNTM1Ng=="}, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAxOTYwNg==", "bodyText": "Not sure if this change is working as intended.\nThe reason why the code was like this in the first place is because there is some ambiguity regarding the naming of attachments. \"twoIfBySea\" has a different namespace unfortunately.\nSee https://forums.triplea-game.org/topic/595/short-attachment-names for more information", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r488019606", "createdAt": "2020-09-14T15:24:14Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/XmlGameElementMapper.java", "diffHunk": "@@ -175,8 +175,7 @@ private static void handleMissingObject(final String objectTypeName, final Strin\n       final GameData gameData) {\n     checkNotNull(typeName);\n \n-    final String normalizedTypeName =\n-        typeName.replaceAll(\"^games\\\\.strategy\\\\.triplea\\\\.attachments\\\\.\", \"\");\n+    final String normalizedTypeName = typeName.replaceAll(\"^.*\\\\.\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyMzY5Mg==", "bodyText": "Off-Topic: I don't think we have a nice error message for \"too few default colors\" yet, so that might be something to consider here", "url": "https://github.com/triplea-game/triplea/pull/7631#discussion_r488023692", "createdAt": "2020-09-14T15:28:35Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/MapData.java", "diffHunk": "@@ -500,8 +500,10 @@ public Color getPlayerColor(final String playerName) {\n \n   /** returns the color for impassable territories. */\n   public Color impassableColor() {\n-    // just use getPlayerColor, since it parses the properties\n-    return getPlayerColor(Constants.PLAYER_NAME_IMPASSABLE);\n+    return Optional.ofNullable(\n+            getColorProperty(PROPERTY_COLOR_PREFIX + Constants.PLAYER_NAME_IMPASSABLE))\n+        .or(() -> Optional.ofNullable(getColorProperty(PROPERTY_COLOR_PREFIX + \"Impassible\")))\n+        .orElseGet(defaultColors::nextColor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e0ce48ebcecb83ceea4ce2fc0daa53d0400b4b"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3911, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}