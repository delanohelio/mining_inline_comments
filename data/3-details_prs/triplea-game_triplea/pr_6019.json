{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTk5MjMw", "number": 6019, "title": "Avoid using JFileChooser in preference for FileDialog", "bodyText": "FileDialog uses a native native file chooser. This has some benefits:\n\nlooks better\nless error prone, removing the option to type a file name means a user\ncan't specify a file that does not exist\nremoves OS specific code meaning we can test this code once and not\nN times per OS.\nUsing native file chooser dialog aligns with JavaFX, in essence\nit's a modernizing approach to avoid JFileChooser\n\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nVerified that the AWT dialog gives a file-overwrite warning\n\n\n\nScreens Shots\nBefore\n\nAfter\n\n\nAdditional Review Notes\nThe only changes in this PR is to delete the OS specific if conditional and delete the 'else' branch that used JFileChooser.\nScope of this update is:\n\nto remove OS specific file dialog selection and always favor FileDialog\n\nOut of scope is removing all usages of JFileChooser or updating FileDialog API usages", "createdAt": "2020-03-07T22:16:24Z", "url": "https://github.com/triplea-game/triplea/pull/6019", "merged": true, "mergeCommit": {"oid": "84217cefc86b35f23fcf1e3439f376ecd033e575"}, "closed": true, "closedAt": "2020-03-07T22:44:29Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLcP-_gH2gAyMzg1MTk5MjMwOmZhYjgwMzFlYzg3MTY0ZTVjZTIwOWRiYzhjZmE2MjQ5NzI0ZjE5NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLcgV3gFqTM3MDc5MjQ4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fab8031ec87164e5ce209dbc8cfa6249724f1952", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/fab8031ec87164e5ce209dbc8cfa6249724f1952", "committedDate": "2020-03-07T22:14:03Z", "message": "Avoid using JFileChooser in preference for FileDialog\n\nFileDialog uses a native native file chooser. This has some benefits:\n- looks better\n- less error prone, removing the option to type a file name means a user\n  can't specify a file that does not exist\n- removes OS specific code meaning we can test this code once and not\n  N times per OS.\n- Using native file chooser dialog aligns with JavaFX, in essence\n  it's a modernizing approach to avoid JFileChooser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzkyNDg1", "url": "https://github.com/triplea-game/triplea/pull/6019#pullrequestreview-370792485", "createdAt": "2020-03-07T22:30:15Z", "commit": {"oid": "fab8031ec87164e5ce209dbc8cfa6249724f1952"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QyMjozMDoxNVrOFzSBTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QyMjozMToyNVrOFzSBng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNjk0Mw==", "bodyText": "Hmm I think we should have that warning on all systems", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389316943", "createdAt": "2020-03-07T22:30:15Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/TripleAMenuBar.java", "diffHunk": "@@ -60,60 +56,19 @@ private void createLobbyMenu(final InGameLobbyWatcherWrapper watcher) {\n    *     cancelled the operation.\n    */\n   public static File getSaveGameLocation(final Frame frame) {\n-    // For some strange reason, the only way to get a Mac OS X native-style file dialog\n-    // is to use an AWT FileDialog instead of a Swing JDialog\n-    if (SystemProperties.isMac()) {\n-      final FileDialog fileDialog = new FileDialog(frame);\n-      fileDialog.setMode(FileDialog.SAVE);\n-      fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n-      fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n-      fileDialog.setVisible(true);\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setVisible(true);\n \n-      final String fileName = fileDialog.getFile();\n-      if (fileName == null) {\n-        return null;\n-      }\n-\n-      // If the user selects a filename that already exists,\n-      // the AWT Dialog on Mac OS X will ask the user for confirmation\n-      return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n-    }\n-\n-    // Non-Mac platforms should use the normal Swing JFileChooser\n-    final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n-    final int selectedOption = fileChooser.showSaveDialog(frame);\n-    if (selectedOption != JFileChooser.APPROVE_OPTION) {\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n       return null;\n     }\n-    File f = fileChooser.getSelectedFile();\n-    // disallow sub directories to be entered (in the form directory/name) for Windows boxes\n-    if (SystemProperties.isWindows()) {\n-      final int slashIndex = Math.min(f.getPath().lastIndexOf(\"\\\\\"), f.getPath().length());\n-      final String filePath = f.getPath().substring(0, slashIndex);\n-      if (!fileChooser.getCurrentDirectory().toString().equals(filePath)) {\n-        JOptionPane.showConfirmDialog(\n-            frame,\n-            \"Sub directories are not allowed in the file name.  Please rename it.\",\n-            \"Cancel?\",\n-            JOptionPane.DEFAULT_OPTION,\n-            JOptionPane.WARNING_MESSAGE);\n-        return null;\n-      }\n-    }\n-    f = new File(f.getParent(), GameDataFileUtils.addExtensionIfAbsent(f.getName()));\n-    // A small warning so users will not over-write a file\n-    if (f.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fab8031ec87164e5ce209dbc8cfa6249724f1952"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzAyMg==", "bodyText": "Ok, this is a super weird thing I have never seen before.", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389317022", "createdAt": "2020-03-07T22:31:25Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/TripleAMenuBar.java", "diffHunk": "@@ -60,60 +56,19 @@ private void createLobbyMenu(final InGameLobbyWatcherWrapper watcher) {\n    *     cancelled the operation.\n    */\n   public static File getSaveGameLocation(final Frame frame) {\n-    // For some strange reason, the only way to get a Mac OS X native-style file dialog\n-    // is to use an AWT FileDialog instead of a Swing JDialog\n-    if (SystemProperties.isMac()) {\n-      final FileDialog fileDialog = new FileDialog(frame);\n-      fileDialog.setMode(FileDialog.SAVE);\n-      fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n-      fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n-      fileDialog.setVisible(true);\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setVisible(true);\n \n-      final String fileName = fileDialog.getFile();\n-      if (fileName == null) {\n-        return null;\n-      }\n-\n-      // If the user selects a filename that already exists,\n-      // the AWT Dialog on Mac OS X will ask the user for confirmation\n-      return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n-    }\n-\n-    // Non-Mac platforms should use the normal Swing JFileChooser\n-    final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n-    final int selectedOption = fileChooser.showSaveDialog(frame);\n-    if (selectedOption != JFileChooser.APPROVE_OPTION) {\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n       return null;\n     }\n-    File f = fileChooser.getSelectedFile();\n-    // disallow sub directories to be entered (in the form directory/name) for Windows boxes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fab8031ec87164e5ce209dbc8cfa6249724f1952"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3725, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}