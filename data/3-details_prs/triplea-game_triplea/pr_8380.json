{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MTA4MzMw", "number": 8380, "title": "Add tests for UnitUtils#translateAttributesToOtherUnits", "bodyText": "Testing\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-12-08T04:21:29Z", "url": "https://github.com/triplea-game/triplea/pull/8380", "merged": true, "mergeCommit": {"oid": "01f2ed4af98e3754205446e63fe56cb6e580d513"}, "closed": true, "closedAt": "2020-12-09T00:56:48Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkCU04AH2gAyNTM0MTA4MzMwOjhmOWUyOTc1NzFkZDViNTBkNTRkNGNhYzhjYjI3ODU3MmM4MjViMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkUAFRAFqTU0Nzc1NTQ4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f9e297571dd5b50d54d4cac8cb278572c825b0e", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/8f9e297571dd5b50d54d4cac8cb278572c825b0e", "committedDate": "2020-12-08T04:21:04Z", "message": "Add tests for UnitUtils#translateAttributesToOtherUnits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NzU1NDgw", "url": "https://github.com/triplea-game/triplea/pull/8380#pullrequestreview-547755480", "createdAt": "2020-12-09T00:56:35Z", "commit": {"oid": "8f9e297571dd5b50d54d4cac8cb278572c825b0e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMDo1NjozNlrOIB9OYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMDo1NjozNlrOIB9OYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyMjU5NQ==", "bodyText": "\ud83d\udc4d\nLike the comment on the assertion, I was wondering why the 100 was translated to 20, this comment answered that perfectly.", "url": "https://github.com/triplea-game/triplea/pull/8380#discussion_r538922595", "createdAt": "2020-12-09T00:56:36Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/triplea/UnitUtilsTest.java", "diffHunk": "@@ -0,0 +1,129 @@\n+package games.strategy.triplea;\n+\n+import static games.strategy.triplea.delegate.GameDataTestUtil.germans;\n+import static games.strategy.triplea.delegate.GameDataTestUtil.territory;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+import games.strategy.engine.data.Change;\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.triplea.delegate.GameDataTestUtil;\n+import games.strategy.triplea.xml.TestMapGameData;\n+import java.util.Collection;\n+import java.util.List;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+@ExtendWith(MockitoExtension.class)\n+class UnitUtilsTest {\n+\n+  private final GameData gameData = TestMapGameData.WW2V3_1942.getGameData();\n+  private final GamePlayer player = germans(gameData);\n+  private final Territory seaZone = territory(\"13 Sea Zone\", gameData);\n+  private final Territory landZone = territory(\"Germany\", gameData);\n+  private final UnitType battleship = GameDataTestUtil.battleship(gameData);\n+  private final UnitType factory = GameDataTestUtil.factory(gameData);\n+\n+  @Nested\n+  class TranslateAttributesToOtherUnits {\n+\n+    @Test\n+    void noChangesIfNothingToTransfer() {\n+      final Unit oldUnit = battleship.create(1, player).get(0);\n+      final Collection<Unit> newUnits = battleship.create(1, player);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, seaZone);\n+\n+      assertThat(changes.isEmpty(), is(true));\n+    }\n+\n+    @Test\n+    void hitsAreTransferred() {\n+      final Unit oldUnit = battleship.create(1, player).get(0);\n+      final List<Unit> newUnits = battleship.create(1, player);\n+      oldUnit.setHits(1);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, seaZone);\n+      gameData.performChange(changes);\n+\n+      assertThat(newUnits.get(0).getHits(), is(1));\n+    }\n+\n+    @Test\n+    void hitsAreTransferredToAllUnits() {\n+      final Unit oldUnit = battleship.create(1, player).get(0);\n+      final List<Unit> newUnits = battleship.create(2, player);\n+      oldUnit.setHits(1);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, seaZone);\n+      gameData.performChange(changes);\n+\n+      assertThat(newUnits.get(0).getHits(), is(1));\n+      assertThat(newUnits.get(1).getHits(), is(1));\n+    }\n+\n+    @Test\n+    void newUnitHasAtLeast1HP() {\n+      final Unit oldUnit = battleship.create(1, player).get(0);\n+      final List<Unit> newUnits = battleship.create(1, player);\n+      oldUnit.setHits(2);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, seaZone);\n+      gameData.performChange(changes);\n+\n+      assertThat(\n+          \"The new unit will always have at least 1 HP, even if the number of hits to transfer \"\n+              + \"would have set it to 0 HP.\",\n+          newUnits.get(0).getHits(),\n+          is(1));\n+    }\n+\n+    @Test\n+    void bombingDamageIsTransferred() {\n+      final Unit oldUnit = factory.create(1, player).get(0);\n+      final List<Unit> newUnits = factory.create(1, player);\n+      oldUnit.setUnitDamage(5);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, landZone);\n+      gameData.performChange(changes);\n+\n+      assertThat(newUnits.get(0).getUnitDamage(), is(5));\n+    }\n+\n+    @Test\n+    void bombingDamageIsLimited() {\n+      final Unit oldUnit = factory.create(1, player).get(0);\n+      final List<Unit> newUnits = factory.create(1, player);\n+      // force a really large amount of damage\n+      oldUnit.setUnitDamage(100);\n+\n+      final Change changes = UnitUtils.translateAttributesToOtherUnits(oldUnit, newUnits, landZone);\n+      gameData.performChange(changes);\n+\n+      assertThat(\n+          \"Factory can only have 20 damage in Germany\", newUnits.get(0).getUnitDamage(), is(20));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f9e297571dd5b50d54d4cac8cb278572c825b0e"}, "originalPosition": 110}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3810, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}