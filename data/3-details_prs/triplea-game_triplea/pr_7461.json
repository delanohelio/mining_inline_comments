{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyOTM5MTc5", "number": 7461, "title": "Simplify, Standardize & Document Docker Database scripts", "bodyText": "Consolidates documentation to /docs/development/database\nStandardizes the scripts between maps-db and lobby-db\nCreates top-level utility script \"start-docker-databases\"\nMerges loading of sample data and waiting for database start\ninto the database start script\n\nAt the end the four standard DB scripts will be:\n\nbuild_docker_db, eg: ./maps-db/build_docker_db\nstart_docker_db\nconnect_to_docker_db\nreset_docker_db", "createdAt": "2020-08-25T05:03:18Z", "url": "https://github.com/triplea-game/triplea/pull/7461", "merged": true, "mergeCommit": {"oid": "3b6a86b32ad811ac4868190d2d27cd612e01dafb"}, "closed": true, "closedAt": "2020-08-27T00:25:48Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCP9ovgH2gAyNDcyOTM5MTc5OjAzZjQ4NTg5MzUwMWYwODM0OTM2YTIwNjdlYzA5NGZlYjI3YjQxMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC1A6dgFqTQ3NjE4MjIyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03f485893501f0834936a2067ec094feb27b4100", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/03f485893501f0834936a2067ec094feb27b4100", "committedDate": "2020-08-25T05:00:59Z", "message": "Simplify, Standardize & Document Docker Database scripts\n\n- Consolidates documentation to /docs/development/database\n- Standardizes the scripts between maps-db and lobby-db\n- Creates top-level utility script \"start-docker-databases\"\n- Merges loading of sample data and waiting for database start\n  into the database start script\n\nAt the end the four standard DB scripts will be:\n- build_docker_db\n- start_docker_db\n- connect_to_docker_db\n- reset_docker_db"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MTM3MTU0", "url": "https://github.com/triplea-game/triplea/pull/7461#pullrequestreview-474137154", "createdAt": "2020-08-25T05:05:26Z", "commit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNTowNToyNlrOHGHtGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNTowNToyOFrOHGHtLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTczOA==", "bodyText": "Useless cat. Consider 'cmd < file | ..' or 'cmd file | ..' instead.", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179738", "createdAt": "2020-08-25T05:05:26Z", "author": {"login": "codeclimate"}, "path": "lobby-db/reset_docker_db", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+\n+set -u\n+\n+database_port=5433\n+database_name=maps_db\n+database_user=maps_user\n+\n+# Check if we can connect to database\n+if ! echo 'select 1' \\\n+       | psql -h localhost -p \"$database_port\" -U \"$database_user\" \"$database_name\" 2> /dev/null \\\n+       | grep -q '1 row';\n+then\n+ echo \"ERROR: docker not running, start the database first\"\n+ exit 1\n+fi\n+\n+PSQL=\"psql -h localhost -U $database_user -p $database_port -w -d postgres\"\n+\n+echo \"Force killing open connections to database\"\n+echo \"select pg_terminate_backend(pid) from pg_stat_activity where datname='$database_name';\" | $PSQL\n+echo \"drop database $database_name\" | $PSQL\n+echo \"create database $database_name\" | $PSQL\n+\n+echo \"Deploying schema\"\n+\"$(dirname \"$0\")/../gradlew\" flywayMigrate\n+\n+echo \"Loading sample data\"\n+cat \"$(dirname \"$0\")/sample_data.sql\" | psql -h localhost -U lobby_user lobby_db", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTczOQ==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179739", "createdAt": "2020-08-25T05:05:26Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```\n+./lobby-db/build_docker_db\n+```\n+\n+### Start Docker\n+\n+Next, start the docker database with:\n+```\n+./lobby-db/start_docker_db\n+```\n+The start script will run flyway to apply migrations files\n+and will insert example data.\n+\n+### Connect to Database on Docker\n+\n+You can then connect to your local docker database with:\n+```\n+./lobby-db/connect_to_docker_db\n+```\n+Note: You can view the connect script to obtain  connection parameters\n+such as port number and credentials.\n+\n+### Reset Database Docker\n+\n+If you are in development and wish to have a clean database (for example\n+you are modifying flyway migration files), to recreate a running\n+database, run:\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0MA==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179740", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```\n+./lobby-db/build_docker_db\n+```\n+\n+### Start Docker\n+\n+Next, start the docker database with:\n+```\n+./lobby-db/start_docker_db\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0MQ==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179741", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```\n+./lobby-db/build_docker_db\n+```\n+\n+### Start Docker\n+\n+Next, start the docker database with:\n+```\n+./lobby-db/start_docker_db\n+```\n+The start script will run flyway to apply migrations files\n+and will insert example data.\n+\n+### Connect to Database on Docker\n+\n+You can then connect to your local docker database with:\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0Mw==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179743", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```\n+./lobby-db/build_docker_db\n+```\n+\n+### Start Docker\n+\n+Next, start the docker database with:\n+```\n+./lobby-db/start_docker_db\n+```\n+The start script will run flyway to apply migrations files\n+and will insert example data.\n+\n+### Connect to Database on Docker\n+\n+You can then connect to your local docker database with:\n+```\n+./lobby-db/connect_to_docker_db\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0Ng==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179746", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```\n+./lobby-db/build_docker_db\n+```\n+\n+### Start Docker\n+\n+Next, start the docker database with:\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0Nw==", "bodyText": "Line length", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179747", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway will halt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc0OQ==", "bodyText": "Line length", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179749", "createdAt": "2020-08-25T05:05:27Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway will halt\n+  if an already applied migration has been modified).\n+- Group related database changes together to a single migration file and keep the\n+  migrations roughly single-purpose. For example, if adding indexes to existing tables,\n+  create one migration file for that and another for adding new tables.\n+\n+An example migration file could be named: `V1.09.00__add_some_table.sql`\n+\n+The structure of the migration file is:\n+```\n+V< compatibility > . < feature > . < patch >__< desciption >.sql\n+```\n+\n+Increment the `compatibility` number when for example an application must be updated to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc1MQ==", "bodyText": "Line length", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179751", "createdAt": "2020-08-25T05:05:28Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway will halt\n+  if an already applied migration has been modified).\n+- Group related database changes together to a single migration file and keep the\n+  migrations roughly single-purpose. For example, if adding indexes to existing tables,\n+  create one migration file for that and another for adding new tables.\n+\n+An example migration file could be named: `V1.09.00__add_some_table.sql`\n+\n+The structure of the migration file is:\n+```\n+V< compatibility > . < feature > . < patch >__< desciption >.sql\n+```\n+\n+Increment the `compatibility` number when for example an application must be updated to\n+be able to continue reading the existing database (for example a table is dropped).\n+\n+Increment the `feature` number when introducing a new set of database features. Typically\n+most work will start by increasing this. While an application might need to be updated to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc1NA==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179754", "createdAt": "2020-08-25T05:05:28Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,37 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway will halt\n+  if an already applied migration has been modified).\n+- Group related database changes together to a single migration file and keep the\n+  migrations roughly single-purpose. For example, if adding indexes to existing tables,\n+  create one migration file for that and another for adding new tables.\n+\n+An example migration file could be named: `V1.09.00__add_some_table.sql`\n+\n+The structure of the migration file is:\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE3OTc1Ng==", "bodyText": "Fenced code blocks should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476179756", "createdAt": "2020-08-25T05:05:28Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/local-development.md", "diffHunk": "@@ -0,0 +1,53 @@\n+# Local Database Development\n+\n+- You need a local database to run the integration tests\n+- You need a local database to run the application servers\n+- Local database is run on docker containers\n+\n+Databases are kept in subprojects suffixed with `db` and have\n+standard scripts to make things easier.\n+\n+## Quick-Start\n+\n+- Install docker on your system\n+- Run the `build_docker_db` script in each of the `*-db` projects\n+- Run `./start-docker-databases`\n+\n+## Working with Local Databases\n+\n+We will use `lobby-db` as an example.\n+\n+### Build Docker\n+\n+First (one-time) build your docker container with:\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f485893501f0834936a2067ec094feb27b4100"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c733b0a9bea45c69567cee52494b88149d7f2ede", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c733b0a9bea45c69567cee52494b88149d7f2ede", "committedDate": "2020-08-25T07:19:24Z", "message": "Fix useless cat in shell script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c71353d879db6980101341da4399cd64537a6843", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c71353d879db6980101341da4399cd64537a6843", "committedDate": "2020-08-25T07:22:10Z", "message": "Fix documentation formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MjMzNTM0", "url": "https://github.com/triplea-game/triplea/pull/7461#pullrequestreview-474233534", "createdAt": "2020-08-25T08:04:15Z", "commit": {"oid": "c71353d879db6980101341da4399cd64537a6843"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODowNDoxNlrOHGMV5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODowNDoxNlrOHGMV7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1NTcxNg==", "bodyText": "Lists should be surrounded by blank lines", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476255716", "createdAt": "2020-08-25T08:04:16Z", "author": {"login": "codeclimate"}, "path": "lobby-db/README.md", "diffHunk": "@@ -1,50 +1,15 @@\n-# lobby-db\n+# Maps-DB\n \n-TODO: rename this project to lobby-db-schema and ensure production migration scripts still work\n+Supports the lobby-server and stores:\n+  - users", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c71353d879db6980101341da4399cd64537a6843"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1NTcyMw==", "bodyText": "Line length", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476255723", "createdAt": "2020-08-25T08:04:16Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,38 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway\n+  will halt if an already applied migration has been modified).\n+- Group related database changes together to a single migration file and keep the\n+  migrations roughly single-purpose. For example, if adding indexes to existing tables,\n+  create one migration file for that and another for adding new tables.\n+\n+An example migration file could be named: `V1.09.00__add_some_table.sql`\n+\n+The structure of the migration file is:\n+\n+```\n+V< compatibility > . < feature > . < patch >__< desciption >.sql\n+```\n+\n+Increment the `compatibility` number when for example an application must be updated\n+to be able to continue reading the existing database (for example a table is dropped).\n+\n+Increment the `feature` number when introducing a new set of database features.\n+Typically most work will start by increasing this. While an application might need to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c71353d879db6980101341da4399cd64537a6843"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1NTcyNQ==", "bodyText": "Line length", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r476255725", "createdAt": "2020-08-25T08:04:16Z", "author": {"login": "codeclimate"}, "path": "docs/development/database/deploying-database-changes.md", "diffHunk": "@@ -0,0 +1,38 @@\n+# Deploying Database Changes\n+\n+## Overview\n+\n+- Database changes are executed through migration files.\n+- [Flyway](https://flywaydb.org/) is used to run new migration files.\n+- Migrations files live in the `*-db` subprojects, in: `src/main/resources/db`\n+- New migration files only need to checked in and merged to master to\n+  be executed in prerelease and then eventually production.\n+- Execution of flyway to 'prerelease' is automatic after each merge.\n+- Execution of flyway to 'production' is automatic on production deployments.\n+\n+## Migration File Versioning\n+\n+- Versioning will follow [semver](https://semver.org/)\n+- Do not modify files that have already been run against prerelease (Flyway\n+  will halt if an already applied migration has been modified).\n+- Group related database changes together to a single migration file and keep the\n+  migrations roughly single-purpose. For example, if adding indexes to existing tables,\n+  create one migration file for that and another for adding new tables.\n+\n+An example migration file could be named: `V1.09.00__add_some_table.sql`\n+\n+The structure of the migration file is:\n+\n+```\n+V< compatibility > . < feature > . < patch >__< desciption >.sql\n+```\n+\n+Increment the `compatibility` number when for example an application must be updated\n+to be able to continue reading the existing database (for example a table is dropped).\n+\n+Increment the `feature` number when introducing a new set of database features.\n+Typically most work will start by increasing this. While an application might need to\n+be updated to pick up the changes, existing applications should still be able to run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c71353d879db6980101341da4399cd64537a6843"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/baf2f3d91be90ebca3b9de03c916b128ac5fe8c2", "committedDate": "2020-08-27T00:07:11Z", "message": "Fix formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTgyMTcx", "url": "https://github.com/triplea-game/triplea/pull/7461#pullrequestreview-476182171", "createdAt": "2020-08-27T00:11:01Z", "commit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowMVrOHHm3ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowMVrOHHm3ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzczODkxMA==", "bodyText": "Codacy found an issue: [list-item-bullet-indent] Incorrect indentation before bullet: remove 2 spaces", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r477738910", "createdAt": "2020-08-27T00:11:01Z", "author": {"login": "DanVanAtta"}, "path": "lobby-db/README.md", "diffHunk": "@@ -1,50 +1,15 @@\n-# lobby-db\n+# Maps-DB\n \n-TODO: rename this project to lobby-db-schema and ensure production migration scripts still work\n+Supports the lobby-server and stores:\n+  - users\n+  - lobby chat history\n+  - user ban information\n+  - moderator audit logs\n+  - bug report history and rate limits", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTgyMjAy", "url": "https://github.com/triplea-game/triplea/pull/7461#pullrequestreview-476182202", "createdAt": "2020-08-27T00:11:02Z", "commit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowMlrOHHm3wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowMlrOHHm3wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzczODk0Ng==", "bodyText": "Codacy found an issue: [list-item-bullet-indent] Incorrect indentation before bullet: remove 2 spaces", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r477738946", "createdAt": "2020-08-27T00:11:02Z", "author": {"login": "DanVanAtta"}, "path": "lobby-db/README.md", "diffHunk": "@@ -1,50 +1,15 @@\n-# lobby-db\n+# Maps-DB\n \n-TODO: rename this project to lobby-db-schema and ensure production migration scripts still work\n+Supports the lobby-server and stores:\n+  - users", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTgyMjI4", "url": "https://github.com/triplea-game/triplea/pull/7461#pullrequestreview-476182228", "createdAt": "2020-08-27T00:11:03Z", "commit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowM1rOHHm37g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDoxMTowM1rOHHm37g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzczODk5MA==", "bodyText": "Codacy found an issue: [list-item-bullet-indent] Incorrect indentation before bullet: remove 2 spaces", "url": "https://github.com/triplea-game/triplea/pull/7461#discussion_r477738990", "createdAt": "2020-08-27T00:11:03Z", "author": {"login": "DanVanAtta"}, "path": "lobby-db/README.md", "diffHunk": "@@ -1,50 +1,15 @@\n-# lobby-db\n+# Maps-DB\n \n-TODO: rename this project to lobby-db-schema and ensure production migration scripts still work\n+Supports the lobby-server and stores:\n+  - users\n+  - lobby chat history\n+  - user ban information\n+  - moderator audit logs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baf2f3d91be90ebca3b9de03c916b128ac5fe8c2"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3964, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}