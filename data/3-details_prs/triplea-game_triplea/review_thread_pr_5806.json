{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NDU5ODE1", "number": 5806, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjowODowNVrODV3L7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoyMzo0OFrODV3OaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUwODYwOnYy", "diffSide": "LEFT", "path": "game-core/src/test/java/org/triplea/live/servers/ServerYamlParserTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjowODowNVrOFaTG9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxMDoxN1rOFaTHYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDM3Mw==", "bodyText": "The supplier was important before, I forget the exact reasoning why :(\nI think the issue is that the read contents are cached. It was a deceptive situation previously where tests passed but they were reading stale input and a re-ordering of tests caused a failure. The other issue might have been input stream being re-read/exhausted. Again, can't really recall what the subtle point was (should have documented it), it's worth taking a double check here.", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120373", "createdAt": "2020-01-05T22:08:05Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/org/triplea/live/servers/ServerYamlParserTest.java", "diffHunk": "@@ -12,19 +12,19 @@\n import java.io.InputStream;\n import java.net.URI;\n import java.util.List;\n-import java.util.function.Supplier;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.MethodSource;\n import org.triplea.util.Version;\n \n class ServerYamlParserTest {\n \n-  private static final Supplier<InputStream> SAMPLE_FILE_INPUT =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDQ4MQ==", "bodyText": "Well I haven't converted it to a constant (because I assume that would've read the file too early potentially?), just made it a method so we should be fine", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120481", "createdAt": "2020-01-05T22:10:17Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/org/triplea/live/servers/ServerYamlParserTest.java", "diffHunk": "@@ -12,19 +12,19 @@\n import java.io.InputStream;\n import java.net.URI;\n import java.util.List;\n-import java.util.function.Supplier;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.MethodSource;\n import org.triplea.util.Version;\n \n class ServerYamlParserTest {\n \n-  private static final Supplier<InputStream> SAMPLE_FILE_INPUT =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDM3Mw=="}, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUwODkzOnYy", "diffSide": "RIGHT", "path": "http-clients/src/test/java/org/triplea/http/client/SystemIdHeaderTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjowOTowNFrOFaTHJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMzoyMTowNlrOFaTXgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDQyMA==", "bodyText": "The method name seems out of date, perhaps we would just as well inline the supplier where it's needed?", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120420", "createdAt": "2020-01-05T22:09:04Z", "author": {"login": "DanVanAtta"}, "path": "http-clients/src/test/java/org/triplea/http/client/SystemIdHeaderTest.java", "diffHunk": "@@ -14,18 +13,23 @@\n @ExtendWith(MockitoExtension.class)\n class SystemIdHeaderTest {\n   private static final String SYSTEM_ID = \"system-id\";\n-  private static final Supplier<SystemId> SYSTEM_ID_SUPPLIER = () -> SystemId.of(SYSTEM_ID);\n+\n+  private static SystemId systemIdSupplier() {\n+    return SystemId.of(SYSTEM_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyNDYxMA==", "bodyText": "Resolved with: bbabe3f", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363124610", "createdAt": "2020-01-05T23:21:06Z", "author": {"login": "DanVanAtta"}, "path": "http-clients/src/test/java/org/triplea/http/client/SystemIdHeaderTest.java", "diffHunk": "@@ -14,18 +13,23 @@\n @ExtendWith(MockitoExtension.class)\n class SystemIdHeaderTest {\n   private static final String SYSTEM_ID = \"system-id\";\n-  private static final Supplier<SystemId> SYSTEM_ID_SUPPLIER = () -> SystemId.of(SYSTEM_ID);\n+\n+  private static SystemId systemIdSupplier() {\n+    return SystemId.of(SYSTEM_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDQyMA=="}, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUxMDY3OnYy", "diffSide": "LEFT", "path": "http-server/src/test/java/org/triplea/server/lobby/CacheUtilsTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxMzoxNFrOFaTIDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxMzoxNFrOFaTIDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDY1NA==", "bodyText": "I think we might be losing the purpose of this test. We are checking that a refresh will put the value back into the cache again. refresh could be implemented as a no-op and this test would still pass. If using a live cache, we could try to test the same thing by waiting for a cache key to almost be expired. I gave that a try as a first implementation when writing this test but found it to be brittle. EG:\nT0: write key that expires at T10\nT5: refresh key, extends expiry to T15\nT12: verify key value still exists, verifies that key was refreshed and did not expire at T10 \n\nThe mock object route version is more deterministic and hence the preference for it in this test.", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120654", "createdAt": "2020-01-05T22:13:14Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/test/java/org/triplea/server/lobby/CacheUtilsTest.java", "diffHunk": "@@ -83,12 +79,13 @@ void refreshTrueWhenFoundInCache() {\n \n     @Test\n     void refreshedItemsAreWrittenBackIntoTheCache() {\n-      when(mockCache.getIfPresent(KEY)).thenReturn(VALUE);\n+      final Cache<String, Integer> cache = CacheBuilder.newBuilder().build();\n+      cache.put(KEY, VALUE);\n \n-      final boolean result = CacheUtils.refresh(mockCache, KEY);\n+      final boolean result = CacheUtils.refresh(cache, KEY);\n \n       assertThat(result, is(true));\n-      verify(mockCache).put(KEY, VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUxMTY0OnYy", "diffSide": "RIGHT", "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxNToyNlrOFaTIjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxNToyNlrOFaTIjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDc4Mw==", "bodyText": "nit, I think it's perhaps more conventional to have the hamcrest 'actual' value be as \"naked\" as possible (so the cast would be moved to the expected value). In this case though, we should probably just use the right matcher to achieve that, eg: assertThat(result, IsCollectionWithSize.hasSize(cache.size())", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120783", "createdAt": "2020-01-05T22:15:26Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "diffHunk": "@@ -77,16 +76,13 @@ void setup() {\n     /** Basic case, no games added, expect none to be returned. */\n     @Test\n     void getGames() {\n-      final Map<GameId, LobbyGame> games = new HashMap<>();\n-      games.put(ID_0, lobbyGame0);\n-      games.put(new GameId(API_KEY_0, GAME_ID_1), lobbyGame1);\n-      games.put(new GameId(API_KEY_1, GAME_ID_2), lobbyGame2);\n-\n-      when(cache.asMap()).thenReturn(new ConcurrentHashMap<>(games));\n+      cache.put(ID_0, lobbyGame0);\n+      cache.put(new GameId(API_KEY_0, GAME_ID_1), lobbyGame1);\n+      cache.put(new GameId(API_KEY_1, GAME_ID_2), lobbyGame2);\n \n       final List<LobbyGameListing> result = gameListing.getGames();\n \n-      assertThat(result.size(), is(games.size()));\n+      assertThat((long) result.size(), is(cache.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUxMjQ5OnYy", "diffSide": "RIGHT", "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxNjo0NVrOFaTI9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoxNjo0NVrOFaTI9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMDg4NQ==", "bodyText": "Nit: Can use the empty map matcher here to be more explicit about the match criteria.", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363120885", "createdAt": "2020-01-05T22:16:45Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "diffHunk": "@@ -108,48 +104,42 @@ void getGames() {\n   final class KeepAlive {\n     @Test\n     void noGamesPresent() {\n-      when(cache.getIfPresent(ID_0)).thenReturn(null);\n-\n       final boolean result = gameListing.keepAlive(API_KEY_0, GAME_ID_0);\n       assertThat(\"Game not found, keep alive should return false\", result, is(false));\n \n-      verify(cache, never()).put(any(), any());\n+      assertThat(cache.asMap(), is(Map.of()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUxMzg5OnYy", "diffSide": "RIGHT", "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoyMDo0MFrOFaTJrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoyMDo0MFrOFaTJrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMTA2OA==", "bodyText": "I'm not sure if this assertion is testing very much, seems like it should be true based on the library spec of the cache we are using and not anything related to the keepAlive. The call to put is important for keepAlive so that it extends the cache expiration.\nI suspect in order to maintain the same level of test, we either need a mock of the cache, or we will need to extract the cache implementation behind an API (and then inject+mock that).\nThis same comment/concern follows for the rest of the examples in this test", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363121068", "createdAt": "2020-01-05T22:20:40Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/test/java/org/triplea/server/lobby/game/listing/GameListingTest.java", "diffHunk": "@@ -108,48 +104,42 @@ void getGames() {\n   final class KeepAlive {\n     @Test\n     void noGamesPresent() {\n-      when(cache.getIfPresent(ID_0)).thenReturn(null);\n-\n       final boolean result = gameListing.keepAlive(API_KEY_0, GAME_ID_0);\n       assertThat(\"Game not found, keep alive should return false\", result, is(false));\n \n-      verify(cache, never()).put(any(), any());\n+      assertThat(cache.asMap(), is(Map.of()));\n     }\n \n     @Test\n     void gameExists() {\n-      when(cache.getIfPresent(ID_0)).thenReturn(lobbyGame0);\n+      cache.put(ID_0, lobbyGame0);\n \n       final boolean result = gameListing.keepAlive(API_KEY_0, GAME_ID_0);\n \n       assertThat(\"Game found, keep alive should return true\", result, is(true));\n-      verify(cache).put(ID_0, lobbyGame0);\n+      assertThat(cache.asMap(), is(Map.of(ID_0, lobbyGame0)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MjUxNDk2OnYy", "diffSide": "RIGHT", "path": "swing-lib/src/test/java/org/triplea/swing/SwingActionTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoyMzo0OFrOFaTKRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNVQyMjoyMzo0OFrOFaTKRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEyMTIyMQ==", "bodyText": "Any thoughts to inline this directly? I think that might be a bit more direct.", "url": "https://github.com/triplea-game/triplea/pull/5806#discussion_r363121221", "createdAt": "2020-01-05T22:23:48Z", "author": {"login": "DanVanAtta"}, "path": "swing-lib/src/test/java/org/triplea/swing/SwingActionTest.java", "diffHunk": "@@ -28,15 +27,10 @@\n class SwingActionTest {\n   private static final Object VALUE = new Object();\n \n-  private static final Runnable RUNNABLE_THROWING_EXCEPTION =\n-      () -> {\n-        throw new IllegalStateException();\n-      };\n+  private static Object throwException() {\n+    throw new IllegalStateException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "062ac0534b8b15c2bfef93ee14aed79451bc4eaa"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2538, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}