{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2OTU4NDQz", "number": 8262, "title": "Create BombingUnitDamageChange that uses primitives", "bodyText": "The old BombingUnitDamageChange is marked as deprecated and will stay\naround solely for loading old saves.\nThe new BombingUnitDamageChange also has been modified to accept the\nterritory that needs to be notified, instead of looping through all the\ngame territories during the change process.\n\nTesting\n\nConducted a strategic bombing run in WW2 Global 1940.  Verified the change was correctly built.  Verified that it \"performed\" correctly.  Played till the attacked player could repair the damaged units and verified that the change was correctly built.\nScreens Shots\n\nAdditional Notes to Reviewer\n\nI created a new Change object and marked the other as deprecated.  I think this might be cleaner since the new change object can have a new name and it doesn't need to hold the non-primitive objects.  This definitely breaks forward compatibility but the compatibility check should prevent users from trying to load saves with this new change object in an older version.\nRelease Note", "createdAt": "2020-11-25T01:49:25Z", "url": "https://github.com/triplea-game/triplea/pull/8262", "merged": true, "mergeCommit": {"oid": "d9ed7288adcff22d74a73505a56508ebe39a20e5"}, "closed": true, "closedAt": "2020-11-27T05:07:03Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfwl3AgH2gAyNTI2OTU4NDQzOjFhMDQ4NGUyZGU5NWY4YjYwYjE0ODNmODdmODY2NGQ4MzQyYjI3NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdggYvkAFqTUzOTcxMDUwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a0484e2de95f8b60b1483f87f8664d8342b2774", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/1a0484e2de95f8b60b1483f87f8664d8342b2774", "committedDate": "2020-11-24T21:25:41Z", "message": "Create BombingUnitDamageChange that uses primitives\n\nThe old BombingUnitDamageChange is marked as deprecated and will stay\naround solely for loading old saves.\n\nThe new BombingUnitDamageChange also has been modified to accept the\nterritory that needs to be notified, instead of looping through all the\ngame territories during the change process."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTU4OTc3", "url": "https://github.com/triplea-game/triplea/pull/8262#pullrequestreview-538958977", "createdAt": "2020-11-26T02:47:17Z", "commit": {"oid": "1a0484e2de95f8b60b1483f87f8664d8342b2774"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjo0NzoxN1rOH6KAJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMjo1MDowOVrOH6KCsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc0MzMzMw==", "bodyText": "What is undo hits representing?", "url": "https://github.com/triplea-game/triplea/pull/8262#discussion_r530743333", "createdAt": "2020-11-26T02:47:17Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/data/changefactory/units/BombingUnitDamageChange.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package games.strategy.engine.data.changefactory.units;\n+\n+import games.strategy.engine.data.Change;\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/**\n+ * A game data change that captures the damage caused to a collection of units by a bombing attack.\n+ */\n+public class BombingUnitDamageChange extends Change {\n+  private static final long serialVersionUID = 7093658184880237574L;\n+  private final IntegerMap<String> hits;\n+  private final IntegerMap<String> undoHits;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a0484e2de95f8b60b1483f87f8664d8342b2774"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc0MzQ3OA==", "bodyText": "Any thoughts to use an @AllArgsConstructor(visibility = AccessLevel.PRIVATE) here to avoid the manually written out constructor?", "url": "https://github.com/triplea-game/triplea/pull/8262#discussion_r530743478", "createdAt": "2020-11-26T02:47:56Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/data/changefactory/units/BombingUnitDamageChange.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package games.strategy.engine.data.changefactory.units;\n+\n+import games.strategy.engine.data.Change;\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/**\n+ * A game data change that captures the damage caused to a collection of units by a bombing attack.\n+ */\n+public class BombingUnitDamageChange extends Change {\n+  private static final long serialVersionUID = 7093658184880237574L;\n+  private final IntegerMap<String> hits;\n+  private final IntegerMap<String> undoHits;\n+  private final Collection<String> territoriesToNotify;\n+\n+  private BombingUnitDamageChange(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a0484e2de95f8b60b1483f87f8664d8342b2774"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc0Mzk4Ng==", "bodyText": "Is the 'toString' required? Is it used anywhere to print text for users? If not, is it helpful?", "url": "https://github.com/triplea-game/triplea/pull/8262#discussion_r530743986", "createdAt": "2020-11-26T02:50:09Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/data/changefactory/units/BombingUnitDamageChange.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package games.strategy.engine.data.changefactory.units;\n+\n+import games.strategy.engine.data.Change;\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/**\n+ * A game data change that captures the damage caused to a collection of units by a bombing attack.\n+ */\n+public class BombingUnitDamageChange extends Change {\n+  private static final long serialVersionUID = 7093658184880237574L;\n+  private final IntegerMap<String> hits;\n+  private final IntegerMap<String> undoHits;\n+  private final Collection<String> territoriesToNotify;\n+\n+  private BombingUnitDamageChange(\n+      final IntegerMap<String> hits,\n+      final IntegerMap<String> undoHits,\n+      final Collection<String> territoriesToNotify) {\n+    this.hits = hits;\n+    this.undoHits = undoHits;\n+    this.territoriesToNotify = territoriesToNotify;\n+  }\n+\n+  public BombingUnitDamageChange(\n+      final IntegerMap<Unit> hits, final Collection<Territory> territoriesToNotify) {\n+    this.hits = new IntegerMap<>();\n+    this.undoHits = new IntegerMap<>();\n+    hits.entrySet()\n+        .forEach(\n+            entry -> {\n+              this.hits.put(entry.getKey().getId().toString(), entry.getValue());\n+              this.undoHits.put(entry.getKey().getId().toString(), entry.getKey().getUnitDamage());\n+            });\n+    this.territoriesToNotify =\n+        territoriesToNotify.stream().map(Territory::getName).collect(Collectors.toList());\n+  }\n+\n+  @Override\n+  protected void perform(final GameData data) {\n+    hits.keySet()\n+        .forEach(\n+            unitId -> {\n+              data.getUnits().get(UUID.fromString(unitId)).setUnitDamage(hits.getInt(unitId));\n+            });\n+    this.territoriesToNotify.forEach(\n+        territory -> {\n+          data.getMap().getTerritory(territory).notifyChanged();\n+        });\n+  }\n+\n+  @Override\n+  public Change invert() {\n+    return new BombingUnitDamageChange(undoHits, hits, territoriesToNotify);\n+  }\n+\n+  @Override\n+  public String toString() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a0484e2de95f8b60b1483f87f8664d8342b2774"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b804681bb4325aaaa8ba889f1a025181aef7428", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/8b804681bb4325aaaa8ba889f1a025181aef7428", "committedDate": "2020-11-26T02:59:51Z", "message": "Use AllArgsConstructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cebc132129b38b8aa65d4547e1822526fe7ade02", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/cebc132129b38b8aa65d4547e1822526fe7ade02", "committedDate": "2020-11-26T18:13:53Z", "message": "Rename variables and add comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NzEwNTA0", "url": "https://github.com/triplea-game/triplea/pull/8262#pullrequestreview-539710504", "createdAt": "2020-11-27T05:06:48Z", "commit": {"oid": "cebc132129b38b8aa65d4547e1822526fe7ade02"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3854, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}