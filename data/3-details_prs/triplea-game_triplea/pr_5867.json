{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjE5Nzg3", "number": 5867, "title": "Improve unit support tooltip", "bodyText": "Address feature request: https://forums.triplea-game.org/topic/1741/tooltip-info-gets-worse-by-the-unit-feature-request\n100 max character width, 10 space indent for new lines, and 25 limit to number of unit types.\nFunctional Changes\n\n[] New map or map update\n[x] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[x] Manual testing done\n\nManually tested several maps including dragon war and TWW to see unit help and unit tooltip for support.\n\nScreens Shots", "createdAt": "2020-01-22T01:30:53Z", "url": "https://github.com/triplea-game/triplea/pull/5867", "merged": true, "mergeCommit": {"oid": "58b95e57082a7a3ec73fbe0d98be84fa86dea3a6"}, "closed": true, "closedAt": "2020-01-28T20:12:28Z", "author": {"login": "ron-murhammer"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8rbmbgH2gAyMzY1NjE5Nzg3OjZjM2YzMWNhYWJjMzg2OWVlNTZlNDAyZDU1NzBmOWEzMjBjZmE0OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-2sp-gH2gAyMzY1NjE5Nzg3OjkzNTg3NGQwMDJhNTFjZWQ1YWFiOTAwMDAzZDliZWM1NmQ5YWZmNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c3f31caabc3869ee56e402d5570f9a320cfa48c", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/6c3f31caabc3869ee56e402d5570f9a320cfa48c", "committedDate": "2020-01-22T01:26:27Z", "message": "Add new formatting method to add line breaks and indents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a860d3857b13ced9d55dc847c0afa5dee188a7f0", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/a860d3857b13ced9d55dc847c0afa5dee188a7f0", "committedDate": "2020-01-22T01:26:57Z", "message": "Update unit tooltip to use new line break method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/283859034bb14a0a25f9e05215a4bb14248e1936", "committedDate": "2020-01-22T01:27:26Z", "message": "Refactor a few method calls to reduce parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzAwMTIx", "url": "https://github.com/triplea-game/triplea/pull/5867#pullrequestreview-346300121", "createdAt": "2020-01-22T01:31:38Z", "commit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMTozOVrOFgOM3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMTozOVrOFgOM3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTQyMQ==", "bodyText": "Increase unit type cap to 25.", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331421", "createdAt": "2020-01-22T01:31:39Z", "author": {"login": "ron-murhammer"}, "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -3267,9 +3267,9 @@ public String toStringShortAndOnlyImportantDifferences(final GamePlayer player)\n                 + (support.getAllied() && support.getEnemy()\n                     ? \" Allied & Enemy \"\n                     : (support.getAllied() ? \" Allied \" : \" Enemy \"))\n-                + (support.getUnitType().size() > 4\n+                + (support.getUnitType().size() > 25", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzAwMjE0", "url": "https://github.com/triplea-game/triplea/pull/5867#pullrequestreview-346300214", "createdAt": "2020-01-22T01:32:03Z", "commit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMjowM1rOFgONNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMjowM1rOFgONNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTUwOA==", "bodyText": "Change unit delimiter to comma instead of slash as it works better with line breaks.", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331508", "createdAt": "2020-01-22T01:32:03Z", "author": {"login": "ron-murhammer"}, "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -3267,9 +3267,9 @@ public String toStringShortAndOnlyImportantDifferences(final GamePlayer player)\n                 + (support.getAllied() && support.getEnemy()\n                     ? \" Allied & Enemy \"\n                     : (support.getAllied() ? \" Allied \" : \" Enemy \"))\n-                + (support.getUnitType().size() > 4\n+                + (support.getUnitType().size() > 25\n                     ? \"Units\"\n-                    : MyFormatter.defaultNamedToTextList(support.getUnitType(), \"/\", false));\n+                    : MyFormatter.defaultNamedToTextList(support.getUnitType()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzAwMzgy", "url": "https://github.com/triplea-game/triplea/pull/5867#pullrequestreview-346300382", "createdAt": "2020-01-22T01:32:40Z", "commit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMjo0MVrOFgONuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMjo0MVrOFgONuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTY0Mw==", "bodyText": "Remove unnecessary parameters.", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331643", "createdAt": "2020-01-22T01:32:41Z", "author": {"login": "ron-murhammer"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/EndRoundDelegate.java", "diffHunk": "@@ -303,9 +303,7 @@ public void signalGameOver(\n       // end round delegate)\n       final String title =\n           \"Victory Achieved\"\n-              + (winners.isEmpty()\n-                  ? \"\"\n-                  : \" by \" + MyFormatter.defaultNamedToTextList(winners, \", \", false));\n+              + (winners.isEmpty() ? \"\" : \" by \" + MyFormatter.defaultNamedToTextList(winners));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzAwNTAz", "url": "https://github.com/triplea-game/triplea/pull/5867#pullrequestreview-346300503", "createdAt": "2020-01-22T01:33:04Z", "commit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMzowNFrOFgOOGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMTozMzowNFrOFgOOGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTczOQ==", "bodyText": "Change to use default delimiter and method call.", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331739", "createdAt": "2020-01-22T01:33:04Z", "author": {"login": "ron-murhammer"}, "path": "game-core/src/main/java/games/strategy/triplea/TripleAPlayer.java", "diffHunk": "@@ -694,7 +694,7 @@ public Territory selectTerritoryForAirToLand(\n   public boolean confirmMoveInFaceOfAa(final Collection<Territory> aaFiringTerritories) {\n     final String question =\n         \"Your units will be fired on in: \"\n-            + MyFormatter.defaultNamedToTextList(aaFiringTerritories, \" and \", false)\n+            + MyFormatter.defaultNamedToTextList(aaFiringTerritories)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e38f1549dd0fbdf966b207d7f28ba324ff0430", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/74e38f1549dd0fbdf966b207d7f28ba324ff0430", "committedDate": "2020-01-22T01:38:08Z", "message": "Add javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDI5ODg1", "url": "https://github.com/triplea-game/triplea/pull/5867#pullrequestreview-346429885", "createdAt": "2020-01-22T09:04:11Z", "commit": {"oid": "74e38f1549dd0fbdf966b207d7f28ba324ff0430"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwOTowNDoxMVrOFgUsQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwOTowNDoxMVrOFgUsQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzc2Mg==", "bodyText": "I really have no clue what exact rules the logic here follows.\nThe Javadoc helps a bit, but the word wrapping makes stuff a little confusing.\nWould you mind adding a few unit tests that test the behavior of this method an test edge cases with very long words?", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369437762", "createdAt": "2020-01-22T09:04:11Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/formatter/MyFormatter.java", "diffHunk": "@@ -407,4 +408,38 @@ public static String integerUnitMapToString(\n     }\n     return buf.toString().replaceFirst(separator, \"\");\n   }\n+\n+  /**\n+   * Adds HTML line breaks and indentation to a string so it wraps for things like long tooltips.\n+   *\n+   * <pre>\n+   * string part 1\n+   *           string part 2\n+   *           ...\n+   *           string part X\n+   * </pre>\n+   */\n+  public static String addHtmlBreaksAndIndents(\n+      final String target, final int firstLineMaxLength, final int maxLength) {\n+    final StringBuilder sb = new StringBuilder();\n+    final BreakIterator breakIterator = BreakIterator.getLineInstance();\n+    breakIterator.setText(target);\n+    int start = breakIterator.first();\n+    int end = breakIterator.next();\n+    int lineLength = 0;\n+    int currentMaxLength = firstLineMaxLength;\n+    while (end != BreakIterator.DONE) {\n+      final String word = target.substring(start, end);\n+      lineLength = lineLength + word.length();\n+      if (lineLength >= currentMaxLength) {\n+        sb.append(\"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\");\n+        lineLength = word.length() + 5; // Add 5 for the indent\n+        currentMaxLength = maxLength;\n+      }\n+      sb.append(word);\n+      start = end;\n+      end = breakIterator.next();\n+    }\n+    return sb.toString();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74e38f1549dd0fbdf966b207d7f28ba324ff0430"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb869b8a32ef8a28bfa8778b2b349dbe748e7b5e", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/bb869b8a32ef8a28bfa8778b2b349dbe748e7b5e", "committedDate": "2020-01-23T03:56:37Z", "message": "Add unit tests for new formatting method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "935874d002a51ced5aab900003d9bec56d9aff47", "author": {"user": {"login": "ron-murhammer", "name": "Ron"}}, "url": "https://github.com/triplea-game/triplea/commit/935874d002a51ced5aab900003d9bec56d9aff47", "committedDate": "2020-01-28T19:41:53Z", "message": "Wrap long lines"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3763, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}