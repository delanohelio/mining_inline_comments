{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MzA5NDk2", "number": 6143, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzowMzoyM1rODvjQOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzoxOToyOFrODvjrTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMTg3MjU4OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzowMzoyM1rOGCCehQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMTowODoxNVrOGCWMbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5MDkxNw==", "bodyText": "Thoughts about using https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html#ISO_LOCAL_DATE for date formatting?", "url": "https://github.com/triplea-game/triplea/pull/6143#discussion_r404790917", "createdAt": "2020-04-07T13:03:23Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "diffHunk": "@@ -1,48 +1,56 @@\n package games.strategy.engine.framework.ui;\n \n+import games.strategy.engine.data.GameData;\n import games.strategy.engine.framework.GameDataFileUtils;\n import games.strategy.triplea.settings.ClientSetting;\n+import java.awt.FileDialog;\n+import java.awt.Frame;\n import java.io.File;\n+import java.time.ZonedDateTime;\n+import java.util.StringJoiner;\n import javax.swing.JFileChooser;\n-import javax.swing.filechooser.FileFilter;\n \n /** A file chooser for save games. Defaults to the user's configured save game folder. */\n public final class SaveGameFileChooser extends JFileChooser {\n   private static final long serialVersionUID = 1548668790891292106L;\n \n-  private static SaveGameFileChooser instance;\n-\n-  private SaveGameFileChooser() {\n-    setFileFilter(newGameDataFileFilter());\n-    final File saveGamesFolder = ClientSetting.saveGamesFolderPath.getValueOrThrow().toFile();\n-    ensureDirectoryExists(saveGamesFolder);\n-    setCurrentDirectory(saveGamesFolder);\n-  }\n-\n-  public static SaveGameFileChooser getInstance() {\n-    if (instance == null) {\n-      instance = new SaveGameFileChooser();\n+  /**\n+   * Displays a file chooser dialog for the user to select the file to which the current game should\n+   * be saved.\n+   *\n+   * @param frame The owner of the file chooser dialog; may be {@code null}.\n+   * @return The file to which the current game should be saved or {@code null} if the user\n+   *     cancelled the operation.\n+   */\n+  public static File getSaveGameLocation(final Frame frame, final GameData gameData) {\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setFile(getSaveGameName(gameData));\n+\n+    fileDialog.setVisible(true);\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n+      return null;\n     }\n-    return instance;\n-  }\n \n-  private static void ensureDirectoryExists(final File f) {\n-    if (!f.mkdirs() && !f.exists()) {\n-      throw new IllegalStateException(\"Unable to create save game folder: \" + f.getAbsolutePath());\n-    }\n+    // If the user selects a filename that already exists,\n+    // the AWT Dialog will ask the user for confirmation\n+    return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n   }\n \n-  private static FileFilter newGameDataFileFilter() {\n-    return new FileFilter() {\n-      @Override\n-      public boolean accept(final File file) {\n-        return file.isDirectory() || GameDataFileUtils.isCandidateFileName(file.getName());\n-      }\n+  private static String getSaveGameName(final GameData gameData) {\n+    return gameData.getSaveGameFileName().orElse(formatGameName(gameData.getGameName()));\n+  }\n \n-      @Override\n-      public String getDescription() {\n-        return \"Saved Games, *\" + GameDataFileUtils.getExtension();\n-      }\n-    };\n+  private static String formatGameName(final String gameName) {\n+    final ZonedDateTime now = ZonedDateTime.now();\n+    return new StringJoiner(\"-\")\n+        .add(String.valueOf(now.getYear()))\n+        .add(String.valueOf(now.getMonthValue()))\n+        .add(String.valueOf(now.getDayOfMonth()))\n+        .add(gameName.replaceAll(\" \", \"-\") + GameDataFileUtils.getExtension())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bee76ed6a6b6369dc62a0f5e19de7adc0f381be"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTExMzk2NA==", "bodyText": "It's better to use built-in items in general, but primitive and simple has it's virtue as well. IMO it's a wash here, there is nothing difficult to understand about this code. Meanwhile there is a format code that ties the year to the calendar week, which causes Dec-31 to flip to Jan-1, so there is some subtlety/caution to be used there.", "url": "https://github.com/triplea-game/triplea/pull/6143#discussion_r405113964", "createdAt": "2020-04-07T21:08:15Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "diffHunk": "@@ -1,48 +1,56 @@\n package games.strategy.engine.framework.ui;\n \n+import games.strategy.engine.data.GameData;\n import games.strategy.engine.framework.GameDataFileUtils;\n import games.strategy.triplea.settings.ClientSetting;\n+import java.awt.FileDialog;\n+import java.awt.Frame;\n import java.io.File;\n+import java.time.ZonedDateTime;\n+import java.util.StringJoiner;\n import javax.swing.JFileChooser;\n-import javax.swing.filechooser.FileFilter;\n \n /** A file chooser for save games. Defaults to the user's configured save game folder. */\n public final class SaveGameFileChooser extends JFileChooser {\n   private static final long serialVersionUID = 1548668790891292106L;\n \n-  private static SaveGameFileChooser instance;\n-\n-  private SaveGameFileChooser() {\n-    setFileFilter(newGameDataFileFilter());\n-    final File saveGamesFolder = ClientSetting.saveGamesFolderPath.getValueOrThrow().toFile();\n-    ensureDirectoryExists(saveGamesFolder);\n-    setCurrentDirectory(saveGamesFolder);\n-  }\n-\n-  public static SaveGameFileChooser getInstance() {\n-    if (instance == null) {\n-      instance = new SaveGameFileChooser();\n+  /**\n+   * Displays a file chooser dialog for the user to select the file to which the current game should\n+   * be saved.\n+   *\n+   * @param frame The owner of the file chooser dialog; may be {@code null}.\n+   * @return The file to which the current game should be saved or {@code null} if the user\n+   *     cancelled the operation.\n+   */\n+  public static File getSaveGameLocation(final Frame frame, final GameData gameData) {\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setFile(getSaveGameName(gameData));\n+\n+    fileDialog.setVisible(true);\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n+      return null;\n     }\n-    return instance;\n-  }\n \n-  private static void ensureDirectoryExists(final File f) {\n-    if (!f.mkdirs() && !f.exists()) {\n-      throw new IllegalStateException(\"Unable to create save game folder: \" + f.getAbsolutePath());\n-    }\n+    // If the user selects a filename that already exists,\n+    // the AWT Dialog will ask the user for confirmation\n+    return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n   }\n \n-  private static FileFilter newGameDataFileFilter() {\n-    return new FileFilter() {\n-      @Override\n-      public boolean accept(final File file) {\n-        return file.isDirectory() || GameDataFileUtils.isCandidateFileName(file.getName());\n-      }\n+  private static String getSaveGameName(final GameData gameData) {\n+    return gameData.getSaveGameFileName().orElse(formatGameName(gameData.getGameName()));\n+  }\n \n-      @Override\n-      public String getDescription() {\n-        return \"Saved Games, *\" + GameDataFileUtils.getExtension();\n-      }\n-    };\n+  private static String formatGameName(final String gameName) {\n+    final ZonedDateTime now = ZonedDateTime.now();\n+    return new StringJoiner(\"-\")\n+        .add(String.valueOf(now.getYear()))\n+        .add(String.valueOf(now.getMonthValue()))\n+        .add(String.valueOf(now.getDayOfMonth()))\n+        .add(gameName.replaceAll(\" \", \"-\") + GameDataFileUtils.getExtension())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5MDkxNw=="}, "originalCommit": {"oid": "5bee76ed6a6b6369dc62a0f5e19de7adc0f381be"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMTk0MTg4OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzoxOToyOFrOGCDJPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMTowOToyM1rOGCWO9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgwMTg1NA==", "bodyText": "Remember our discussion about whether to use\nArrays.stream(fileDialog.getFiles()).findAny().orElseThrow()\n?\nBecause of the extension thingy it would be a little bit impractical to use this approach here, but without this detail it would save a couple lines of code.", "url": "https://github.com/triplea-game/triplea/pull/6143#discussion_r404801854", "createdAt": "2020-04-07T13:19:28Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "diffHunk": "@@ -1,48 +1,56 @@\n package games.strategy.engine.framework.ui;\n \n+import games.strategy.engine.data.GameData;\n import games.strategy.engine.framework.GameDataFileUtils;\n import games.strategy.triplea.settings.ClientSetting;\n+import java.awt.FileDialog;\n+import java.awt.Frame;\n import java.io.File;\n+import java.time.ZonedDateTime;\n+import java.util.StringJoiner;\n import javax.swing.JFileChooser;\n-import javax.swing.filechooser.FileFilter;\n \n /** A file chooser for save games. Defaults to the user's configured save game folder. */\n public final class SaveGameFileChooser extends JFileChooser {\n   private static final long serialVersionUID = 1548668790891292106L;\n \n-  private static SaveGameFileChooser instance;\n-\n-  private SaveGameFileChooser() {\n-    setFileFilter(newGameDataFileFilter());\n-    final File saveGamesFolder = ClientSetting.saveGamesFolderPath.getValueOrThrow().toFile();\n-    ensureDirectoryExists(saveGamesFolder);\n-    setCurrentDirectory(saveGamesFolder);\n-  }\n-\n-  public static SaveGameFileChooser getInstance() {\n-    if (instance == null) {\n-      instance = new SaveGameFileChooser();\n+  /**\n+   * Displays a file chooser dialog for the user to select the file to which the current game should\n+   * be saved.\n+   *\n+   * @param frame The owner of the file chooser dialog; may be {@code null}.\n+   * @return The file to which the current game should be saved or {@code null} if the user\n+   *     cancelled the operation.\n+   */\n+  public static File getSaveGameLocation(final Frame frame, final GameData gameData) {\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setFile(getSaveGameName(gameData));\n+\n+    fileDialog.setVisible(true);\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n+      return null;\n     }\n-    return instance;\n-  }\n \n-  private static void ensureDirectoryExists(final File f) {\n-    if (!f.mkdirs() && !f.exists()) {\n-      throw new IllegalStateException(\"Unable to create save game folder: \" + f.getAbsolutePath());\n-    }\n+    // If the user selects a filename that already exists,\n+    // the AWT Dialog will ask the user for confirmation\n+    return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bee76ed6a6b6369dc62a0f5e19de7adc0f381be"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTExNDYxMg==", "bodyText": "I don't recall that discussion. It seems we are maybe picking on moved code. If there is a reasonable improvement, IMO follow-up with it.", "url": "https://github.com/triplea-game/triplea/pull/6143#discussion_r405114612", "createdAt": "2020-04-07T21:09:23Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/SaveGameFileChooser.java", "diffHunk": "@@ -1,48 +1,56 @@\n package games.strategy.engine.framework.ui;\n \n+import games.strategy.engine.data.GameData;\n import games.strategy.engine.framework.GameDataFileUtils;\n import games.strategy.triplea.settings.ClientSetting;\n+import java.awt.FileDialog;\n+import java.awt.Frame;\n import java.io.File;\n+import java.time.ZonedDateTime;\n+import java.util.StringJoiner;\n import javax.swing.JFileChooser;\n-import javax.swing.filechooser.FileFilter;\n \n /** A file chooser for save games. Defaults to the user's configured save game folder. */\n public final class SaveGameFileChooser extends JFileChooser {\n   private static final long serialVersionUID = 1548668790891292106L;\n \n-  private static SaveGameFileChooser instance;\n-\n-  private SaveGameFileChooser() {\n-    setFileFilter(newGameDataFileFilter());\n-    final File saveGamesFolder = ClientSetting.saveGamesFolderPath.getValueOrThrow().toFile();\n-    ensureDirectoryExists(saveGamesFolder);\n-    setCurrentDirectory(saveGamesFolder);\n-  }\n-\n-  public static SaveGameFileChooser getInstance() {\n-    if (instance == null) {\n-      instance = new SaveGameFileChooser();\n+  /**\n+   * Displays a file chooser dialog for the user to select the file to which the current game should\n+   * be saved.\n+   *\n+   * @param frame The owner of the file chooser dialog; may be {@code null}.\n+   * @return The file to which the current game should be saved or {@code null} if the user\n+   *     cancelled the operation.\n+   */\n+  public static File getSaveGameLocation(final Frame frame, final GameData gameData) {\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setFile(getSaveGameName(gameData));\n+\n+    fileDialog.setVisible(true);\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n+      return null;\n     }\n-    return instance;\n-  }\n \n-  private static void ensureDirectoryExists(final File f) {\n-    if (!f.mkdirs() && !f.exists()) {\n-      throw new IllegalStateException(\"Unable to create save game folder: \" + f.getAbsolutePath());\n-    }\n+    // If the user selects a filename that already exists,\n+    // the AWT Dialog will ask the user for confirmation\n+    return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgwMTg1NA=="}, "originalCommit": {"oid": "5bee76ed6a6b6369dc62a0f5e19de7adc0f381be"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2413, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}