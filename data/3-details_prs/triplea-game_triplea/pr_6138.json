{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTk0ODUx", "number": 6138, "title": "Simplify endpoint", "bodyText": "Some things I noticed when working on #6137\nNote that there are small changes in behaviour: Sometimes where an exception would be thrown now a no-op is done instead.\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nI verified I could start a local networked game", "createdAt": "2020-04-05T18:30:26Z", "url": "https://github.com/triplea-game/triplea/pull/6138", "merged": true, "mergeCommit": {"oid": "016147a0c05bf08e5eabf3a42152bd4db79ea3e2"}, "closed": true, "closedAt": "2020-04-06T01:06:46Z", "author": {"login": "RoiEXLab"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUs7PlAH2gAyMzk5MTk0ODUxOjYyMTcxZTRkOGI3N2Q3YTZjODA4OTNmYWZjYmQ0YjU4YzE2Mzc3MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU0GcQAFqTM4Nzg4NjQxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62171e4d8b77d7a6c80893fafcbd4b58c1637724", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/62171e4d8b77d7a6c80893fafcbd4b58c1637724", "committedDate": "2020-04-05T16:45:06Z", "message": "Use concurrent data structure instead of mutex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c821b598d7fc73c120ff7f3ae943a345f72f09bf", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/c821b598d7fc73c120ff7f3ae943a345f72f09bf", "committedDate": "2020-04-05T16:45:32Z", "message": "Clarify method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3b23deab159ae10929bfacf2f13192a9fc6e404", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/a3b23deab159ae10929bfacf2f13192a9fc6e404", "committedDate": "2020-04-05T16:54:43Z", "message": "Unify count implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/6316656bd81a7c6aa71e544ae6229d0086339d3a", "committedDate": "2020-04-05T20:52:11Z", "message": "Fix compile error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODYxNDgw", "url": "https://github.com/triplea-game/triplea/pull/6138#pullrequestreview-387861480", "createdAt": "2020-04-05T21:10:23Z", "commit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMToxMDoyNFrOGBDZPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMToxNDoxM1rOGBDasw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1NzM3NA==", "bodyText": "nit, I'd assign this to Collection. I've found that in cases where we pass Set to places that want a List parameter but could be a collection, we incur a collection copy unnecessarily.\nEG:\nfoo(List.of(set));\nvoid foo(List thisDoesNotHaveToBeList);\n\nvs:\n\nfoo(setPassedAsCollection)\nvoid foo(Collection anyCollectionWillDo);", "url": "https://github.com/triplea-game/triplea/pull/6138#discussion_r403757374", "createdAt": "2020-04-05T21:10:24Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/message/unifiedmessenger/EndPoint.java", "diffHunk": "@@ -24,10 +26,9 @@\n   // the next number we can run\n   private long currentRunnableNumber = 0;\n   private final Object numberMutex = new Object();\n-  private final Object implementorsMutex = new Object();\n   private final String name;\n   private final Class<?> remoteClass;\n-  private final List<Object> implementors = new ArrayList<>();\n+  private final Set<Object> implementors = new CopyOnWriteArraySet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1NzUxOQ==", "bodyText": "Side-comment (as this is existing behavior):\nI've questioned a bit why the original code throws on this case.\nPerhaps because we're trying to detect a bug where we did not remove an implementor and we got the name wrong?\nIf that is the motivation, then adding a remove listener is probably a better way to go, or having a 'removeAll' hook maybe.", "url": "https://github.com/triplea-game/triplea/pull/6138#discussion_r403757519", "createdAt": "2020-04-05T21:12:04Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/message/unifiedmessenger/EndPoint.java", "diffHunk": "@@ -91,19 +91,16 @@ public int getLocalImplementorCount() {\n    * @return we have no more implementors.\n    */\n   boolean removeImplementor(final Object implementor) {\n-    synchronized (implementorsMutex) {\n-      if (!implementors.remove(implementor)) {\n-        throw new IllegalStateException(\n-            \"Not removed, impl:\" + implementor + \" have \" + implementors);\n-      }\n-      return implementors.isEmpty();\n+    if (!implementors.remove(implementor)) {\n+      throw new IllegalStateException(\"Not removed, impl:\" + implementor + \" have \" + implementors);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1Nzc0Nw==", "bodyText": "Important, is there any chance we will invoke this method while implementors are being removed? If so we could hit a concurrent modification exception. Have you considered creating an implementor collection copy? Since we are copying references of a couple dozen objects, it should be a negligibly cheap operation.", "url": "https://github.com/triplea-game/triplea/pull/6138#discussion_r403757747", "createdAt": "2020-04-05T21:14:13Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/message/unifiedmessenger/EndPoint.java", "diffHunk": "@@ -119,16 +116,9 @@ boolean removeImplementor(final Object implementor) {\n \n   private List<RemoteMethodCallResults> invokeMultiple(\n       final RemoteMethodCall call, final INode messageOriginator) {\n-    // copy the implementors\n-    final List<Object> implementorsCopy;\n-    synchronized (implementorsMutex) {\n-      implementorsCopy = new ArrayList<>(implementors);\n-    }\n-    final List<RemoteMethodCallResults> results = new ArrayList<>(implementorsCopy.size());\n-    for (final Object implementor : implementorsCopy) {\n-      results.add(invokeSingle(call, implementor, messageOriginator));\n-    }\n-    return results;\n+    return implementors.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODg2NDEy", "url": "https://github.com/triplea-game/triplea/pull/6138#pullrequestreview-387886412", "createdAt": "2020-04-06T01:06:40Z", "commit": {"oid": "6316656bd81a7c6aa71e544ae6229d0086339d3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3631, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}