{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NzIwNTkw", "number": 5874, "title": "Refactor and hover listener consolidate", "bodyText": "Series of refactors around MapPanel, recommend to review commit-by-commit.\nA big update here is applying DRY principle to 'hover units'. Both TripleAFrame and MapPanel kept track of the units that are current mouse hovered. TripleAFrame did this to for 'i' key info purposes and MapPanel for unit highlight. The update removes the state tracking of current hovered units from TripleAFrame and instead TripleAFrame accesses this data from MapPanel.\nOtherwise, MapPanel is moved to its own class and there are a series of changes to better encapsulate MapPanel data.\nUltimately this update tries to get a start on addressing some of the technical debt in MapPanel and TripleAFrame, working with unit highlight lead quickly to many debt problems..\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[x] Manual testing done", "createdAt": "2020-01-24T08:01:08Z", "url": "https://github.com/triplea-game/triplea/pull/5874", "merged": true, "mergeCommit": {"oid": "fdafd6c2c4d7f977eee32c2a6fc215ac87e9a7e9"}, "closed": true, "closedAt": "2020-01-25T02:25:39Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9ZU7sAH2gAyMzY2NzIwNTkwOjU5YjE0NDIxN2E0NDc3ZDBlMDMzYzgwZGVlMGQ3NTdkMDBmNGNjMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9mrzmgFqTM0ODI1NTk1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59b144217a4477d0e033c80dee0d757d00f4cc03", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/59b144217a4477d0e033c80dee0d757d00f4cc03", "committedDate": "2020-01-24T06:54:48Z", "message": "Move MapPanel and closely related classes to their own package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4a1e01365f234fac71c69a2d66df0ca7fd5d4da", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c4a1e01365f234fac71c69a2d66df0ca7fd5d4da", "committedDate": "2020-01-24T06:54:53Z", "message": "Replace MapPanelSmallView with parent class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6358998f53caec12b1fb86ab43e42b9aa7014203", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/6358998f53caec12b1fb86ab43e42b9aa7014203", "committedDate": "2020-01-24T07:18:44Z", "message": "Consolidate storage of current hover units\n\nWas previously stored both in TripleAFrame and MapPanel, this update\nfetches the data from just one place, MapPanel."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a88a05a8b9dff41ed94df9703aefb844f95e7a6", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/5a88a05a8b9dff41ed94df9703aefb844f95e7a6", "committedDate": "2020-01-24T07:43:25Z", "message": "Move method \"getEditMode\" to MapPanel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4c2fa73ec245556d65eef29a5b7abffb3719c3c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/d4c2fa73ec245556d65eef29a5b7abffb3719c3c", "committedDate": "2020-01-24T07:56:15Z", "message": "Replace local getter access with direct variable access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ace87c8b22de340ba6e56797c62560d068c02d", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/e7ace87c8b22de340ba6e56797c62560d068c02d", "committedDate": "2020-01-24T07:57:35Z", "message": "Run spotlessApply"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzkzOTY0", "url": "https://github.com/triplea-game/triplea/pull/5874#pullrequestreview-347793964", "createdAt": "2020-01-24T08:02:23Z", "commit": {"oid": "e7ace87c8b22de340ba6e56797c62560d068c02d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODowMjoyM1rOFhWHTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODowMjoyNFrOFhWHUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwOTY0NQ==", "bodyText": "Method setMouseShadowUnits has 62 lines of code (exceeds 25 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370509645", "createdAt": "2020-01-24T08:02:23Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanel.java", "diffHunk": "@@ -846,18 +867,18 @@ public void setScale(final double newScale) {\n     repaint();\n   }\n \n-  void initSmallMap() {\n+  public void initSmallMap() {\n     for (final Territory territory : gameData.getMap().getTerritories()) {\n       smallMapImageManager.updateTerritoryOwner(territory, gameData, uiContext.getMapData());\n     }\n     smallMapImageManager.update(uiContext.getMapData());\n   }\n \n-  void changeSmallMapOffscreenMap() {\n+  public void changeSmallMapOffscreenMap() {\n     smallMapImageManager.updateOffscreenImage(uiContext.getMapImage().getSmallMapImage());\n   }\n \n-  void setMouseShadowUnits(final Collection<Unit> units) {\n+  public void setMouseShadowUnits(final Collection<Unit> units) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7ace87c8b22de340ba6e56797c62560d068c02d"}, "originalPosition": 212}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwOTY0Ng==", "bodyText": "File MapPanel.java has 882 lines of code (exceeds 250 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370509646", "createdAt": "2020-01-24T08:02:23Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanel.java", "diffHunk": "@@ -1,4 +1,4 @@\n-package games.strategy.triplea.ui;\n+package games.strategy.triplea.ui.panels.map;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7ace87c8b22de340ba6e56797c62560d068c02d"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwOTY0OQ==", "bodyText": "File MapRouteDrawer.java has 311 lines of code (exceeds 250 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370509649", "createdAt": "2020-01-24T08:02:24Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapRouteDrawer.java", "diffHunk": "@@ -1,4 +1,4 @@\n-package games.strategy.triplea.ui;\n+package games.strategy.triplea.ui.panels.map;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7ace87c8b22de340ba6e56797c62560d068c02d"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb4a85a36c364b5c84f76e34aad46dde9e5ca628", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/bb4a85a36c364b5c84f76e34aad46dde9e5ca628", "committedDate": "2020-01-24T08:29:36Z", "message": "Move tests to mirror new location of corresponding source files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjU1OTU4", "url": "https://github.com/triplea-game/triplea/pull/5874#pullrequestreview-348255958", "createdAt": "2020-01-24T22:15:59Z", "commit": {"oid": "c4a1e01365f234fac71c69a2d66df0ca7fd5d4da"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjoxNjowMFrOFhr5-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMjoyNzowOFrOFhsG8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NjY4MQ==", "bodyText": "Ok, this change came unexpected \ud83d\ude2e", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370866681", "createdAt": "2020-01-24T22:16:00Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanelSmallView.java", "diffHunk": "@@ -1,14 +0,0 @@\n-package games.strategy.triplea.ui.panels.map;\n-\n-import games.strategy.triplea.ui.mapdata.MapData;\n-import games.strategy.ui.ImageScrollModel;\n-import games.strategy.ui.ImageScrollerSmallView;\n-import java.awt.Image;\n-\n-public class MapPanelSmallView extends ImageScrollerSmallView {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a1e01365f234fac71c69a2d66df0ca7fd5d4da"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2Nzg5OQ==", "bodyText": "Why not just pass units to getUnitInfo()?\nThis way there's no need to expose a getter, or am I missing something?", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370867899", "createdAt": "2020-01-24T22:19:58Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/TripleAFrame.java", "diffHunk": "@@ -481,10 +480,7 @@ public void windowGainedFocus(final WindowEvent e) {\n     tooltipManager = new MapUnitTooltipManager(mapPanel);\n     mapPanel.addMapSelectionListener(mapSelectionListener);\n     mapPanel.addMouseOverUnitListener(\n-        (units, territory) -> {\n-          unitsBeingMousedOver = units;\n-          tooltipManager.updateTooltip(getUnitInfo());\n-        });\n+        (units, territory) -> tooltipManager.updateTooltip(getUnitInfo()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6358998f53caec12b1fb86ab43e42b9aa7014203"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2OTQxMA==", "bodyText": "I guess this comment does no longer make 100% sense (if it ever did).\nOne thing that I think is weird with this change in general:\nEven if the method itself seems to delegate 50% of it's method to the MapPanel class, the only usages are part of TripleAFrame which seems counter-intuitive to me \ud83e\udd14", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370869410", "createdAt": "2020-01-24T22:25:05Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanel.java", "diffHunk": "@@ -341,6 +342,18 @@ public GameData getData() {\n     return gameData;\n   }\n \n+  public boolean getEditMode() {\n+    final boolean isEditMode;\n+    // use GameData from mapPanel since it will follow current history node", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a88a05a8b9dff41ed94df9703aefb844f95e7a6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2OTU4Nw==", "bodyText": "Just a small thing I noticed, there's no need to have an extra variable for this, this line can return the result directly.", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370869587", "createdAt": "2020-01-24T22:25:38Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanel.java", "diffHunk": "@@ -341,6 +342,18 @@ public GameData getData() {\n     return gameData;\n   }\n \n+  public boolean getEditMode() {\n+    final boolean isEditMode;\n+    // use GameData from mapPanel since it will follow current history node\n+    gameData.acquireReadLock();\n+    try {\n+      isEditMode = BaseEditDelegate.getEditMode(gameData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a88a05a8b9dff41ed94df9703aefb844f95e7a6"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg3MDAwMA==", "bodyText": "This is actually a thing I wonder which \"style\" to prefer, maybe something we should mention in our code guidelines", "url": "https://github.com/triplea-game/triplea/pull/5874#discussion_r370870000", "createdAt": "2020-01-24T22:27:08Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/panels/map/MapPanel.java", "diffHunk": "@@ -140,7 +140,7 @@ public void gameDataChanged(final Change change) {\n             tileManager.resetTiles(gameData, uiContext.getMapData());\n             SwingUtilities.invokeLater(\n                 () -> {\n-                  recreateTiles(getData(), uiContext);\n+                  recreateTiles(gameData, uiContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4c2fa73ec245556d65eef29a5b7abffb3719c3c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3767, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}