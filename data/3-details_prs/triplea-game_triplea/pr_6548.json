{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTM3MjUw", "number": 6548, "title": "Fix link checker", "bodyText": "This update fixes the link checker script to work with websites that don't offer HTTP 2.\nGoing to self merge so #6546 and  #6547 can be built.\n@djensen47 Update to my question in #6546 (comment) :\nLooks like our script had a bug. Any chance there was a downgrade to HTTP/1.1 from HTTP/2 recently for https://www.axisandallies.org/forums?\nBecause it sure looks like it, otherwise I don't have an explanation for this.\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[x] Problem fix:  \n[] Other:   \nTesting\n\nManually verified the regular expressions work as expected", "createdAt": "2020-05-30T23:44:09Z", "url": "https://github.com/triplea-game/triplea/pull/6548", "merged": true, "mergeCommit": {"oid": "c8b59b9d9d5b511a7cee6d8bbc2e94328d6e1224"}, "closed": true, "closedAt": "2020-06-06T19:56:08Z", "author": {"login": "RoiEXLab"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcm2jLTAFqTQyMTU1OTg1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcosznLgFqTQyNTc2NDgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTU5ODU0", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-421559854", "createdAt": "2020-06-01T02:08:29Z", "commit": {"oid": "1d353a503f3d4f1850900983df12642fb4c9e32c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwMjowODoyOVrOGc9HEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwMjowODoyOVrOGc9HEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAxNDU0Ng==", "bodyText": "I think positive confirmation would be helpful to know what we are checking and are seeing. I'd also recommend we try and keep it simple. Perhaps there is no need to even check the HTTP type, just status code and the optional last word.\nWDYT of something like this?\n  echo -n \"$uri -- \"  \n  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n  echo \"$curlResult\"\n  echo \"$curlResult\" | grep -qE \"200( OK)?|302( Found)?\" \\\n    || reportBrokenUri \"$uri\"", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433014546", "createdAt": "2020-06-01T02:08:29Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,7 +15,7 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  curl -s --head \"$uri\" | head -n 1  | grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n+  curl -s --head \"$uri\" | head -n 1  | grep -qE \"HTTP/(2 200|1.1 (200 OK|302 Found))\" \\\n     || reportBrokenUri \"$uri\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d353a503f3d4f1850900983df12642fb4c9e32c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aa47bfb2c9632cd9a360600f5fb445f007e74d9", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/2aa47bfb2c9632cd9a360600f5fb445f007e74d9", "committedDate": "2020-06-01T16:56:57Z", "message": "Fix link checker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1d399358824df2e091d9e8d2ae783f64e45a5d5", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/f1d399358824df2e091d9e8d2ae783f64e45a5d5", "committedDate": "2020-06-01T16:56:57Z", "message": "Add fallback mechanism"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7325c668e90ff556401376c6b20e4292b253a4f", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/b7325c668e90ff556401376c6b20e4292b253a4f", "committedDate": "2020-06-01T16:56:57Z", "message": "Make RegEx more accurate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a9b497e0471b11a9dbeead91beb0302e20b071e", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/7a9b497e0471b11a9dbeead91beb0302e20b071e", "committedDate": "2020-06-01T16:56:57Z", "message": "Make OK keyword optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5faba71158c32d8d1d38edc433a79cfea7518784", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/5faba71158c32d8d1d38edc433a79cfea7518784", "committedDate": "2020-06-01T16:56:57Z", "message": "Clarify format differences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "786fc5094f07565d046e30551ac539c2279de7cb", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/786fc5094f07565d046e30551ac539c2279de7cb", "committedDate": "2020-06-01T16:56:57Z", "message": "Use cURL mechanics to make script more robust"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "098db2126d41f4aa1c50ea1b9ec0f02a9233a4e8", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/098db2126d41f4aa1c50ea1b9ec0f02a9233a4e8", "committedDate": "2020-06-01T16:56:57Z", "message": "Different formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "371eb35d5b5f720dcc59226a01557658d9f5e5df", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/371eb35d5b5f720dcc59226a01557658d9f5e5df", "committedDate": "2020-06-01T16:56:57Z", "message": "Add ignore mechanism"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d353a503f3d4f1850900983df12642fb4c9e32c", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/1d353a503f3d4f1850900983df12642fb4c9e32c", "committedDate": "2020-05-31T00:39:35Z", "message": "Clarify format differences"}, "afterCommit": {"oid": "371eb35d5b5f720dcc59226a01557658d9f5e5df", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/371eb35d5b5f720dcc59226a01557658d9f5e5df", "committedDate": "2020-06-01T16:56:57Z", "message": "Add ignore mechanism"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/4a1155857fcab5f9e7511182c0dfa2d2e9c3e100", "committedDate": "2020-06-01T17:21:12Z", "message": "Ignore A&A Forum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDM5MTY5", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-422039169", "createdAt": "2020-06-01T17:29:05Z", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzoyOTowNlrOGdTbEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzoyOTowNlrOGdTbEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MDExNA==", "bodyText": "Interesting: If IGNORE_LIST is empty, this line throws an error on bash 4.3 and prior.\nFrom the changelog:\n\na.  Using ${a[@]} or ${a[*]} with an array without any assigned elements when\nthe nounset option is enabled no longer throws an unbound variable error.\n\nWhich is the reason this build failed: https://travis-ci.com/github/triplea-game/triplea/jobs/342279779", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433380114", "createdAt": "2020-06-01T17:29:06Z", "author": {"login": "RoiEXLab"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +17,31 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local output\n+  if ! output=\"$FAILURE_PREFIX$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\")\"; then\n+    reportBrokenUri \"$uri\" \"$output\"\n+    FAILURE=1\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'\n-  echo -en \"${end}\"\n+  local -r error_reason=${2//${FAILURE_PREFIX}000/Connection Failure!}\n+  echo -e \"Error: ${red}${1}${end} ${blue}${error_reason}${end}\"\n+}\n+\n+function checkIsOnIgnoreList() {\n+  for ignored_uri in \"${IGNORE_LIST[@]}\"; do", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDQxNzg3", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-422041787", "createdAt": "2020-06-01T17:32:37Z", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozMjozN1rOGdTimQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozMjozN1rOGdTimQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjA0MQ==", "bodyText": "What surprised me here is that $uri is not actually the parameter passed to this function, (which was unused before my change), but instead the global variable that is defined below at while read -r uri; do.\nI tried limiting the scope of this loop, but without success, so $uri could still  be used here.\nI wonder if it's better to use the global uri everywhere, or just ignore it an pass it everywhere explicitly \ud83e\udd14", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433382041", "createdAt": "2020-06-01T17:32:37Z", "author": {"login": "RoiEXLab"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +17,31 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local output\n+  if ! output=\"$FAILURE_PREFIX$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\")\"; then\n+    reportBrokenUri \"$uri\" \"$output\"\n+    FAILURE=1\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDQyNDQ1", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-422042445", "createdAt": "2020-06-01T17:33:31Z", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozMzozMVrOGdTknQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzozMzozMVrOGdTknQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4MjU1Nw==", "bodyText": "This replacement expression replaces Failed With Code: 000 with Connection Failure, which would be printed otherwise if curl was unable to reach the server at all", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433382557", "createdAt": "2020-06-01T17:33:31Z", "author": {"login": "RoiEXLab"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +17,31 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local output\n+  if ! output=\"$FAILURE_PREFIX$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\")\"; then\n+    reportBrokenUri \"$uri\" \"$output\"\n+    FAILURE=1\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'\n-  echo -en \"${end}\"\n+  local -r error_reason=${2//${FAILURE_PREFIX}000/Connection Failure!}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDQ3NDY2", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-422047466", "createdAt": "2020-06-01T17:40:36Z", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzo0MDozNlrOGdTzMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzo0MDozNlrOGdTzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM4NjI5MQ==", "bodyText": "I think this is a lot more robust than the code we had before.\nThe command prints the actual HTTP status code purely for logging purposes.\n-L makes sure to follow redirects.\n-f makes curl return with non-zero exit codes in case the status code is 4xx or 5xx or something like that, whatever it considers to be an error\n-o /dev/null just redirects the HTTP body i.e. the HTML to void so it won't land in stdout\n-w \"%{http_code}\" makes curl print the status code in stdout if it exists, or \"000\" otherwise", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433386291", "createdAt": "2020-06-01T17:40:36Z", "author": {"login": "RoiEXLab"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +17,31 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local output\n+  if ! output=\"$FAILURE_PREFIX$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\")\"; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjY2MjM1", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-422266235", "createdAt": "2020-06-02T00:29:36Z", "commit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMDoyOTozNlrOGdeRdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMDoyOTozNlrOGdeRdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU1Nzg3Ng==", "bodyText": "Would really love more insight about why A&A.org is failing from travis, have you been able to do any more research/investigation into this? Having a full status code and perhaps full output from curl, if not manually done, then printed by the script would seem helpful.\nIt's hard to know if the previous failure message was accurate and was not masking something a bit more benign.", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r433557876", "createdAt": "2020-06-02T00:29:36Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -5,6 +5,8 @@ set -eu\n URI_FILE=$(find . -type f -path \"*/src/main/java/*\" -name \"UrlConstants.java\")\n green=\"\\e[32m\"\n end=\"\\e[0m\"\n+FAILURE_PREFIX=\"Failed with Code: \"\n+IGNORE_LIST=(\"https://www.axisandallies.org/forums\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a1155857fcab5f9e7511182c0dfa2d2e9c3e100"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "851a4628495c19053a0af0f1294c59cb4d234298", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/851a4628495c19053a0af0f1294c59cb4d234298", "committedDate": "2020-06-06T13:06:41Z", "message": "Use ternary expression instead of replacement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5", "author": {"user": {"login": "RoiEXLab", "name": "RoiEX"}}, "url": "https://github.com/triplea-game/triplea/commit/e093f03479478bff1952fe5667e2cb7bc21b4ba5", "committedDate": "2020-06-06T13:11:02Z", "message": "Add positive return statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzY0NzEz", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-425764713", "createdAt": "2020-06-06T19:53:12Z", "commit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1MzoxMlrOGgFZjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1MzoxMlrOGgFZjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5NjA3Nw==", "bodyText": "Nit, the other scripts have a convention to assign parameters to variables in functions. Thus any parameter passed to a function receives a name, you see off-the-bat as well how many parameters are expected to be passed to a function. It also means that a variable like $1 is only ever referenced once in a function and that is only to assign it to another variable that then gives it a name.\nThis was undocumented, I added a note about this convention here: https://github.com/triplea-game/triplea/wiki/Shell-Script-Conventions", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r436296077", "createdAt": "2020-06-06T19:53:12Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +16,37 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local code\n+  if ! code=$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\"); then\n+    reportBrokenUri \"$uri\" \"$code\"\n+    FAILURE=1\n+  else\n+    echo \"Successfully checked '$uri', returned $code\"\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'\n-  echo -en \"${end}\"\n+  local -r error_reason=$([[ $2 -ne 0 ]] && echo \"Failed with Code: $2\" || echo \"Connection Failure!\")\n+  echo -e \"Error: ${red}${1}${end} ${blue}${error_reason}${end}\"\n+}\n+\n+function checkIsOnIgnoreList() {\n+  for ignored_uri in \"${IGNORE_LIST[@]}\"; do\n+    if [[ \"$1\" = \"$ignored_uri\" ]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzY0Nzk0", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-425764794", "createdAt": "2020-06-06T19:54:43Z", "commit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1NDo0M1rOGgFZ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1NDo0M1rOGgFZ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5NjE0OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r436296148", "createdAt": "2020-06-06T19:54:43Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +16,37 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local code\n+  if ! code=$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\"); then\n+    reportBrokenUri \"$uri\" \"$code\"\n+    FAILURE=1\n+  else\n+    echo \"Successfully checked '$uri', returned $code\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzY0ODA1", "url": "https://github.com/triplea-game/triplea/pull/6548#pullrequestreview-425764805", "createdAt": "2020-06-06T19:54:51Z", "commit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1NDo1MVrOGgFZ3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxOTo1NDo1N1rOGgFZ4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5NjE1OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r436296158", "createdAt": "2020-06-06T19:54:51Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +16,37 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local code\n+  if ! code=$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\"); then\n+    reportBrokenUri \"$uri\" \"$code\"\n+    FAILURE=1\n+  else\n+    echo \"Successfully checked '$uri', returned $code\"\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'\n-  echo -en \"${end}\"\n+  local -r error_reason=$([[ $2 -ne 0 ]] && echo \"Failed with Code: $2\" || echo \"Connection Failure!\")\n+  echo -e \"Error: ${red}${1}${end} ${blue}${error_reason}${end}\"\n+}\n+\n+function checkIsOnIgnoreList() {\n+  for ignored_uri in \"${IGNORE_LIST[@]}\"; do\n+    if [[ \"$1\" = \"$ignored_uri\" ]]\n+    then\n+      echo \"Ignoring '$1'\"\n+      return 0\n+    fi\n+  done\n+  return 1\n }\n \n FAILURE=0\n \n while read -r uri; do\n-  checkUri \"$uri\";\n+  checkIsOnIgnoreList \"$uri\" || checkUri \"$uri\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5NjE2Mw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/triplea-game/triplea/pull/6548#discussion_r436296163", "createdAt": "2020-06-06T19:54:57Z", "author": {"login": "DanVanAtta"}, "path": ".travis/stages/verify/check-links-and-yaml-syntax/check-links", "diffHunk": "@@ -15,28 +16,37 @@ fi\n \n function checkUri() {\n   local -r uri=\"$1\"\n-  \n-  local -r curlResult=$(curl -s --head \"$uri\" | head -n 1)\n-  echo \"$uri -- $curlResult\"  \n-  # Temporarily disabled. We're unable to connect to A&A.org from Travis.\n-\n-  # echo $curlResult |  grep -qE  \"HTTP/2 200|(200|302) (OK|Found)\" \\\n-  #  || reportBrokenUri \"$uri\"\n+  local code\n+  if ! code=$(curl -Lsf -o /dev/null -w \"%{http_code}\" \"$uri\"); then\n+    reportBrokenUri \"$uri\" \"$code\"\n+    FAILURE=1\n+  else\n+    echo \"Successfully checked '$uri', returned $code\"\n+  fi\n }\n \n function reportBrokenUri() {\n-  FAILURE=1 \n   local -r red=\"\\e[38;5;196m\"\n   local -r blue=\"\\e[38;5;75m\"\n-  echo -en \"Error: ${red}$uri${end} ${blue}\"\n-  curl -s --head \"$uri\" | head -n 1 | sed 's|HTTP/[12][.01]?||'\n-  echo -en \"${end}\"\n+  local -r error_reason=$([[ $2 -ne 0 ]] && echo \"Failed with Code: $2\" || echo \"Connection Failure!\")\n+  echo -e \"Error: ${red}${1}${end} ${blue}${error_reason}${end}\"\n+}\n+\n+function checkIsOnIgnoreList() {\n+  for ignored_uri in \"${IGNORE_LIST[@]}\"; do\n+    if [[ \"$1\" = \"$ignored_uri\" ]]\n+    then\n+      echo \"Ignoring '$1'\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e093f03479478bff1952fe5667e2cb7bc21b4ba5"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3465, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}