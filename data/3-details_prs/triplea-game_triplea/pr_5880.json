{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTEyNTE5", "number": 5880, "title": "MapData - find islands refactor", "bodyText": "Extract, test and refactor island finding algorithm\nSimplify usage of island data in AutoPlacementFinder, better encapsulate island data in MapData.\n\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[] Manual testing done\n\n\n\n\nAdditional Review Notes\nLot of small refactoring steps, sequence of refactoring can be reviewed commit-by-commit.", "createdAt": "2020-01-25T12:10:07Z", "url": "https://github.com/triplea-game/triplea/pull/5880", "merged": true, "mergeCommit": {"oid": "f31a997d6741cbf7e8d61b8f12c40434c0739d48"}, "closed": true, "closedAt": "2020-01-25T21:24:35Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9voovAH2gAyMzY3MTEyNTE5OjgxNTQyYjliZjJjOTRjYTNiMGEzNmYxMGM2YjA4NGVjNzc3YWZkYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb96Nj-gH2gAyMzY3MTEyNTE5OjMwZGIxY2Y5YmJiNWFiY2RhZTY4YjAwY2M2MjgzZjY1YzEzZmI5ZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81542b9bf2c94ca3b0a36f10c6b084ec777afdb4", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/81542b9bf2c94ca3b0a36f10c6b084ec777afdb4", "committedDate": "2020-01-25T08:54:14Z", "message": "Move 'initializeContains' method (breaking)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89b227bb1b4b893113000fa6f6b2eac0a5689099", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/89b227bb1b4b893113000fa6f6b2eac0a5689099", "committedDate": "2020-01-25T09:07:10Z", "message": "Fix 'initializeContains' and inject dependencies (fixing)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e101dd02f4ec2fbb3487c8d0f96ac7fbc276da03", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/e101dd02f4ec2fbb3487c8d0f96ac7fbc276da03", "committedDate": "2020-01-25T09:16:07Z", "message": "Rename method: initializeContains -> findIslands, and add javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "327ecdb31762f81056c8a70bd79aa94788e9eb98", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/327ecdb31762f81056c8a70bd79aa94788e9eb98", "committedDate": "2020-01-25T09:24:13Z", "message": "Rename class: TerritoryContainsTerritoryAnalyzer->IslandTerritoryFinder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a75256b4b2f7f0ddca8946cadc1db4f813bddea1", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/a75256b4b2f7f0ddca8946cadc1db4f813bddea1", "committedDate": "2020-01-25T09:27:35Z", "message": "Improve mapData encapsulation, change \"hasContainedTerritory(territory)\" to return polygons of contained territories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753a7576c39b19710ead410fb1feb356a1f58543", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/753a7576c39b19710ead410fb1feb356a1f58543", "committedDate": "2020-01-25T09:29:27Z", "message": "Move common if/else operation to outside of if/else branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ec9aed1a2f49298388d2cea9f5c413da03f6d2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/26ec9aed1a2f49298388d2cea9f5c413da03f6d2", "committedDate": "2020-01-25T09:30:27Z", "message": "Replace assignment to \"points\" variable with ternary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff6abd8b7564617e56710716fe7d1d0cc9458c34", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/ff6abd8b7564617e56710716fe7d1d0cc9458c34", "committedDate": "2020-01-25T10:36:39Z", "message": "Add a Unit test for IslandTerritoryFinder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc90a0b8c4840bf08adce9687eecc4c99a2aa894", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/bc90a0b8c4840bf08adce9687eecc4c99a2aa894", "committedDate": "2020-01-25T11:46:11Z", "message": "Return Set of territories instead of List, extract sea and land territory computation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85873618ddc580cdb2a3ca7362aec836f6878600", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/85873618ddc580cdb2a3ca7362aec836f6878600", "committedDate": "2020-01-25T11:46:11Z", "message": "Extract inner for loop, findIsland, to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "797b9bd49e814f80df10a020271e034bc38f6e6d", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/797b9bd49e814f80df10a020271e034bc38f6e6d", "committedDate": "2020-01-25T11:46:11Z", "message": "Convert extracted method for loop to a stream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb71cc80a7e15bf96e18500b2f697eff90cc091", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/2eb71cc80a7e15bf96e18500b2f697eff90cc091", "committedDate": "2020-01-25T11:46:11Z", "message": "Convert predicate to an extracted method and add javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcf987b4b92c33701144437fef76d685765c8ed", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/ebcf987b4b92c33701144437fef76d685765c8ed", "committedDate": "2020-01-25T11:46:11Z", "message": "Rename variable \"contained\" -> \"islands\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3595058fd36f9b23ea8f1e2013d8c582211fade", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/b3595058fd36f9b23ea8f1e2013d8c582211fade", "committedDate": "2020-01-25T11:46:11Z", "message": "Use named helper methods to do territory filtering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5254cd8a5b725c42a22f0f45eaf40ef1d4f24c08", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/5254cd8a5b725c42a22f0f45eaf40ef1d4f24c08", "committedDate": "2020-01-25T11:46:11Z", "message": "Replace null indicating no islands with empty list, remove null check."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0fd924cee4c74b2e0c869f5e4dc87dc660088b9", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/f0fd924cee4c74b2e0c869f5e4dc87dc660088b9", "committedDate": "2020-01-25T11:46:11Z", "message": "Rewrite mapping for loop to a stream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02b70a10a99500fd3f167fb4cc04bb07fc36a54c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/02b70a10a99500fd3f167fb4cc04bb07fc36a54c", "committedDate": "2020-01-25T11:46:11Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/cdc4d2a908e617d501daa6c7cd1166c8d27b2550", "committedDate": "2020-01-25T12:06:02Z", "message": "Last refactor, push polygon function deeper into the call stack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzI3MjE2", "url": "https://github.com/triplea-game/triplea/pull/5880#pullrequestreview-348327216", "createdAt": "2020-01-25T13:59:10Z", "commit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQxMzo1OToxMFrOFhwE2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQxNDo1MTozMVrOFhwN_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkzNTAwMA==", "bodyText": "I think it's worth explicitly clarifying that the land must be contained within a single sea territory and not just within 2 joined sea territories.\nIt does make sense from a code perspective, but from a real-world perspective this might be confusing.", "url": "https://github.com/triplea-game/triplea/pull/5880#discussion_r370935000", "createdAt": "2020-01-25T13:59:10Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/IslandTerritoryFinder.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package games.strategy.triplea.ui.mapdata;\n+\n+import games.strategy.ui.Util;\n+import java.awt.Polygon;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+\n+@UtilityClass\n+class IslandTerritoryFinder {\n+\n+  /**\n+   * Finds all island territories given a set of territory names and their corresponding polygons.\n+   * An island is defined as a land territory that is contained within a sea territory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkzNTE4NQ==", "bodyText": "Would Function.identity() work here?", "url": "https://github.com/triplea-game/triplea/pull/5880#discussion_r370935185", "createdAt": "2020-01-25T14:02:39Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/IslandTerritoryFinder.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package games.strategy.triplea.ui.mapdata;\n+\n+import games.strategy.ui.Util;\n+import java.awt.Polygon;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+\n+@UtilityClass\n+class IslandTerritoryFinder {\n+\n+  /**\n+   * Finds all island territories given a set of territory names and their corresponding polygons.\n+   * An island is defined as a land territory that is contained within a sea territory.\n+   *\n+   * <p>Warning: territories may consist of multiple polygons, only the first polygon is checked.\n+   *\n+   * @param polygons Mapping of territory names to the polygons representing that territories.\n+   * @return A mapping of sea territory names to the name of land territories that are islands\n+   *     contained by each corresponding sea territory.\n+   */\n+  static Map<String, Set<String>> findIslands(final Map<String, List<Polygon>> polygons) {\n+    final Set<String> seaTerritories = filterSeaTerritories(polygons.keySet());\n+    final Set<String> landTerritories = filterNotSeaTerritories(polygons.keySet());\n+\n+    // map sea territories to: sea territory name -> islands contained by that sea territory\n+    return seaTerritories.stream()\n+        .collect(\n+            Collectors.toMap(sea -> sea, findIslandsForSeaTerritory(landTerritories, polygons)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkzNjU3MA==", "bodyText": "2 things:\n\nThis is a map of lists, so instead of using list.iterator().next(), you could as well use list.get(0) directly\nDoes it make sense to check the size of the list before? If the lists was empty for some reason, this would result in an exception. If there are more than 1 polygon (which is mentioned somewhere in the javadocs) this would be silently ignore all the other polygons", "url": "https://github.com/triplea-game/triplea/pull/5880#discussion_r370936570", "createdAt": "2020-01-25T14:35:19Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/IslandTerritoryFinder.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package games.strategy.triplea.ui.mapdata;\n+\n+import games.strategy.ui.Util;\n+import java.awt.Polygon;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+\n+@UtilityClass\n+class IslandTerritoryFinder {\n+\n+  /**\n+   * Finds all island territories given a set of territory names and their corresponding polygons.\n+   * An island is defined as a land territory that is contained within a sea territory.\n+   *\n+   * <p>Warning: territories may consist of multiple polygons, only the first polygon is checked.\n+   *\n+   * @param polygons Mapping of territory names to the polygons representing that territories.\n+   * @return A mapping of sea territory names to the name of land territories that are islands\n+   *     contained by each corresponding sea territory.\n+   */\n+  static Map<String, Set<String>> findIslands(final Map<String, List<Polygon>> polygons) {\n+    final Set<String> seaTerritories = filterSeaTerritories(polygons.keySet());\n+    final Set<String> landTerritories = filterNotSeaTerritories(polygons.keySet());\n+\n+    // map sea territories to: sea territory name -> islands contained by that sea territory\n+    return seaTerritories.stream()\n+        .collect(\n+            Collectors.toMap(sea -> sea, findIslandsForSeaTerritory(landTerritories, polygons)));\n+  }\n+\n+  private static Set<String> filterSeaTerritories(final Set<String> territoryNames) {\n+    return filterTerritories(territoryNames, Util::isTerritoryNameIndicatingWater);\n+  }\n+\n+  private static Set<String> filterNotSeaTerritories(final Set<String> territoryNames) {\n+    return filterTerritories(territoryNames, Predicate.not(Util::isTerritoryNameIndicatingWater));\n+  }\n+\n+  /** Returns a subset of territories matching a given filter. */\n+  private static Set<String> filterTerritories(\n+      final Set<String> territoryNames, final Predicate<String> territoryFilter) {\n+    return territoryNames.stream().filter(territoryFilter).collect(Collectors.toSet());\n+  }\n+\n+  /** Find all land territories contained by a given sea territory. */\n+  private static Function<String, Set<String>> findIslandsForSeaTerritory(\n+      final Set<String> landTerritories, final Map<String, List<Polygon>> polygons) {\n+\n+    return seaTerritory ->\n+        landTerritories.stream()\n+            .filter(landIsContainedBySeaTerritory(seaTerritory, polygons))\n+            .collect(Collectors.toSet());\n+  }\n+\n+  /** Checks that a given land territory would be contained by a given sea territory. */\n+  private Predicate<String> landIsContainedBySeaTerritory(\n+      final String seaTerritory, final Map<String, List<Polygon>> polygons) {\n+\n+    // Function where given a territory name, give us a polygon for that territory\n+    final Function<String, Polygon> polygonLookup =\n+        territoryName -> polygons.get(territoryName).iterator().next();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkzNzM0MQ==", "bodyText": "Another quick thought:\nWhat about making this class non-static and make the polygon map an actual field?\nThis way a lot of lambdas could be turned into private methods and there would be no need to pass this map to almost every method.", "url": "https://github.com/triplea-game/triplea/pull/5880#discussion_r370937341", "createdAt": "2020-01-25T14:51:31Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/IslandTerritoryFinder.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package games.strategy.triplea.ui.mapdata;\n+\n+import games.strategy.ui.Util;\n+import java.awt.Polygon;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+\n+@UtilityClass\n+class IslandTerritoryFinder {\n+\n+  /**\n+   * Finds all island territories given a set of territory names and their corresponding polygons.\n+   * An island is defined as a land territory that is contained within a sea territory.\n+   *\n+   * <p>Warning: territories may consist of multiple polygons, only the first polygon is checked.\n+   *\n+   * @param polygons Mapping of territory names to the polygons representing that territories.\n+   * @return A mapping of sea territory names to the name of land territories that are islands\n+   *     contained by each corresponding sea territory.\n+   */\n+  static Map<String, Set<String>> findIslands(final Map<String, List<Polygon>> polygons) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdc4d2a908e617d501daa6c7cd1166c8d27b2550"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99fc238388954393f21e5bf4566f299171efadb9", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/99fc238388954393f21e5bf4566f299171efadb9", "committedDate": "2020-01-25T20:54:57Z", "message": "Add javadoc clarification on sea to island relationship"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30db1cf9bbb5abcdae68b00cc6283f65c13fb9fb", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/30db1cf9bbb5abcdae68b00cc6283f65c13fb9fb", "committedDate": "2020-01-25T21:13:37Z", "message": "Use function.identity"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3773, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}