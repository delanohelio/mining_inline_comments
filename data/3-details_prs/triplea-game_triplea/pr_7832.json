{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3Mjk0MzQ2", "number": 7832, "title": "Improve AA Battle UI text", "bodyText": "This is a piece of #7823.\nI noticed during testing that the string shown in the battle ui when you need to select AA fire casualties was really strange.  It says \"Select X casualties from aa fire in Y select X casualties.\".  I tracked down where the redundant \"select X casualties\" and found that during the casualty selection, if the battle id is not null, it will always append \"select X casualties\".\nSo, I changed AaCasualtySelector#getAaCasualties to take a text string and then modified the callers to build a better string for their use case.  AaInMoveUtil keeps the old string because it has a battle id of null.  The other two callers (FireAa and StrategicBombingRaidBattle) now specify which aa type is firing and their string works with the auto-appended \"select X casualties\".  I basically followed how callers of CasualtySelector#selectCasualties construct the string.\nTesting\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-10-03T15:34:48Z", "url": "https://github.com/triplea-game/triplea/pull/7832", "merged": true, "mergeCommit": {"oid": "57662a73109584c24e9446af88825d62be4a23e6"}, "closed": true, "closedAt": "2020-10-04T03:49:35Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdO82gigH2gAyNDk3Mjk0MzQ2OjhlMzFiYTI1ZjhmZDk2ZDg2NDMxMTI5OGU0OGEzMGIyODkyYTJjYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPAFOCAFqTUwMTU3MDI2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/8e31ba25f8fd96d864311298e48a30b2892a2ca3", "committedDate": "2020-10-03T16:06:01Z", "message": "Improve AA Battle UI text"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84fafb24bd63a5c40d7907b719b256df7054bae4", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/84fafb24bd63a5c40d7907b719b256df7054bae4", "committedDate": "2020-10-03T15:27:58Z", "message": "Improve AA Battle UI text"}, "afterCommit": {"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/8e31ba25f8fd96d864311298e48a30b2892a2ca3", "committedDate": "2020-10-03T16:06:01Z", "message": "Improve AA Battle UI text"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTcwMjY0", "url": "https://github.com/triplea-game/triplea/pull/7832#pullrequestreview-501570264", "createdAt": "2020-10-03T19:51:44Z", "commit": {"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxOTo1MTo0NFrOHcDV4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxOTo1MTo0NFrOHcDV4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ==", "bodyText": "I don't know if pushing this complexity to the caller is a good move. The caller will have to know the full implementation details of this method to know how this text is being used.\nI think for example one smell is the value of parameter is a composition of other parameters:\n            \"Select \"\n                + dice.getHits()\n                + \" casualties from \"\n                + currentTypeAa\n                + \" fire in \"\n                + territory.getName(),\n\n\nPerhaps we can fix this cleanly with a configuration flag?\n\nTo another extent, the root cause seems to be the overall structure here and arguably a lack of abstractions altogether. I think this is a good example of a \"routine\", in other words a procedural method. The deeper fix here is likely to be quite the rabbit hole.", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499176929", "createdAt": "2020-10-03T19:51:44Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/casualty/AaCasualtySelector.java", "diffHunk": "@@ -37,6 +37,7 @@ public static CasualtyDetails getAaCasualties(\n       final Collection<Unit> allFriendlyUnits,\n       final Collection<Unit> defendingAa,\n       final Collection<Unit> allEnemyUnits,\n+      final String text,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3867, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}