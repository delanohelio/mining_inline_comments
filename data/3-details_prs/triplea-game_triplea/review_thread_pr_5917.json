{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzY2MjE2", "number": 5917, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMjo0Mzo1NVrODePaWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowMToxN1rODhTKbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDM2Mzc4OnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMjo0Mzo1NVrOFnSVlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMjo0Mzo1NVrOFnSVlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjczOTIyMg==", "bodyText": "Method onShow has 45 lines of code (exceeds 25 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r376739222", "createdAt": "2020-02-08T22:43:55Z", "author": {"login": "codeclimate"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.properties.NumberProperty;\n+import games.strategy.engine.framework.startup.launcher.LocalLauncher;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import games.strategy.triplea.Constants;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import lombok.extern.java.Log;\n+import org.triplea.game.client.ui.javafx.screen.ControlledScreen;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+@Log\n+public class RoleSelection implements ControlledScreen<ScreenController<FxmlManager>> {\n+\n+  static final String SELECTED_MAP_KEY = \"selectedMap\";\n+  private static final String DISABLE_TEXT = \"Disable\";\n+\n+  private final Map<GamePlayer, ComboBox<String>> roleForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> incomeForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> pusForPlayers = new HashMap<>();\n+\n+  @FXML private ComboBox<String> allSelectorCheckbox;\n+\n+  @FXML private GridPane factionGrid;\n+\n+  @FXML private VBox root;\n+\n+  @FXML private CheckBox resourceModifierCheckbox;\n+\n+  private ScreenController<FxmlManager> screenController;\n+  private GameData gameData;\n+\n+  @Override\n+  public void connect(final ScreenController<FxmlManager> screenController) {\n+    this.screenController = screenController;\n+  }\n+\n+  @Override\n+  public Node getNode() {\n+    return root;\n+  }\n+\n+  @FXML\n+  void initialize() {\n+    allSelectorCheckbox.getItems().setAll(PlayerType.playerTypes());\n+  }\n+\n+  @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af8afd52c5590b2092e98d39cc1fc3e7a17c206"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDM2Mzc5OnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMjo0Mzo1NlrOFnSVlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMjo0Mzo1NlrOFnSVlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjczOTIyMw==", "bodyText": "Method startGame has 26 lines of code (exceeds 25 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r376739223", "createdAt": "2020-02-08T22:43:56Z", "author": {"login": "codeclimate"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.properties.NumberProperty;\n+import games.strategy.engine.framework.startup.launcher.LocalLauncher;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import games.strategy.triplea.Constants;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import lombok.extern.java.Log;\n+import org.triplea.game.client.ui.javafx.screen.ControlledScreen;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+@Log\n+public class RoleSelection implements ControlledScreen<ScreenController<FxmlManager>> {\n+\n+  static final String SELECTED_MAP_KEY = \"selectedMap\";\n+  private static final String DISABLE_TEXT = \"Disable\";\n+\n+  private final Map<GamePlayer, ComboBox<String>> roleForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> incomeForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> pusForPlayers = new HashMap<>();\n+\n+  @FXML private ComboBox<String> allSelectorCheckbox;\n+\n+  @FXML private GridPane factionGrid;\n+\n+  @FXML private VBox root;\n+\n+  @FXML private CheckBox resourceModifierCheckbox;\n+\n+  private ScreenController<FxmlManager> screenController;\n+  private GameData gameData;\n+\n+  @Override\n+  public void connect(final ScreenController<FxmlManager> screenController) {\n+    this.screenController = screenController;\n+  }\n+\n+  @Override\n+  public Node getNode() {\n+    return root;\n+  }\n+\n+  @FXML\n+  void initialize() {\n+    allSelectorCheckbox.getItems().setAll(PlayerType.playerTypes());\n+  }\n+\n+  @Override\n+  public void onShow(final Map<String, Object> data) {\n+    roleForPlayers.clear();\n+    factionGrid\n+        .getChildren()\n+        .removeIf(\n+            node -> {\n+              final Integer row = GridPane.getRowIndex(node);\n+              return row != null && row > 0;\n+            });\n+    gameData =\n+        (GameData)\n+            Optional.ofNullable(data.get(SELECTED_MAP_KEY))\n+                .orElseThrow(\n+                    () -> new IllegalStateException(\"Missing GameData when calling screen\"));\n+    final List<String> availablePlayers = List.of(PlayerType.playerTypes());\n+    for (final GamePlayer playerId : gameData.getPlayerList()) {\n+      final var name = new Label(playerId.getName());\n+      final ComboBox<String> controllingPlayer =\n+          new ComboBox<>(FXCollections.observableArrayList(availablePlayers));\n+      controllingPlayer.getSelectionModel().select(0);\n+      if (playerId.getCanBeDisabled()) {\n+        controllingPlayer.getItems().add(DISABLE_TEXT);\n+      }\n+      roleForPlayers.put(playerId, controllingPlayer);\n+      final Collection<String> playerAlliances =\n+          gameData.getAllianceTracker().getAlliancesPlayerIsIn(playerId);\n+      final var faction = new Button(playerAlliances.toString());\n+      faction.setOnAction(\n+          e -> {\n+            final int targetIndex = controllingPlayer.getSelectionModel().getSelectedIndex();\n+            playerAlliances.stream()\n+                .map(gameData.getAllianceTracker()::getPlayersInAlliance)\n+                .flatMap(Collection::stream)\n+                .map(roleForPlayers::get)\n+                .filter(stringComboBox -> stringComboBox.getItems().size() > targetIndex)\n+                .map(ComboBox::getSelectionModel)\n+                .forEach(selectionModel -> selectionModel.select(targetIndex));\n+          });\n+      final var income = new Spinner<Integer>(0, 100, 100);\n+      income.setDisable(true);\n+      incomeForPlayers.put(playerId, income);\n+      final var pus = new Spinner<Integer>(0, 100, 0);\n+      pus.setDisable(true);\n+      pusForPlayers.put(playerId, pus);\n+      factionGrid.addRow(factionGrid.getRowCount(), name, controllingPlayer, faction, income, pus);\n+    }\n+  }\n+\n+  @Override\n+  public Map<String, Class<?>> getValidTypes() {\n+    return Map.of(SELECTED_MAP_KEY, GameData.class);\n+  }\n+\n+  @FXML\n+  void setAllTo() {\n+    factionGrid.getChildren().stream()\n+        .filter(ComboBox.class::isInstance)\n+        .map(node -> (ComboBox<?>) node)\n+        .forEach(\n+            comboBox ->\n+                comboBox\n+                    .getSelectionModel()\n+                    .select(allSelectorCheckbox.getSelectionModel().getSelectedIndex()));\n+  }\n+\n+  @FXML\n+  void cancelMapSelection() {\n+    screenController.switchScreen(FxmlManager.MAP_SELECTION);\n+  }\n+\n+  @FXML", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af8afd52c5590b2092e98d39cc1fc3e7a17c206"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjUyNDQ5OnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/java/org/triplea/game/client/parser/DefaultGameLoader.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwNToyMzo1MFrOFpr6ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMTowMjo0OVrOFqQkJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI1NTQwMg==", "bodyText": "How do we know that GameParseException implies a missing file here? Would it be more clear if the exception perhaps be GameFileMissing or something else?\nSecond, do we need the checked exception (GameParseException is checked right?), what's the purpose behind it?\nSide-note, I'm thinking we may want to remove the exception name from the user display message and only show the exception message. I'm getting to be very skeptical about the \"best-practice\" of throwing custom exceptions and avoiding built-in's , particularly Runtime (eg: https://stackify.com/java-custom-exceptions/).", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379255402", "createdAt": "2020-02-14T05:23:50Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/java/org/triplea/game/client/parser/DefaultGameLoader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package org.triplea.game.client.parser;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GameParseException;\n+import games.strategy.engine.framework.ui.GameChooserEntry;\n+import java.util.function.Consumer;\n+import javafx.concurrent.Service;\n+import javafx.concurrent.Task;\n+\n+public class DefaultGameLoader extends Service<GameData> implements GameLoader {\n+  private GameChooserEntry gameChooserEntry;\n+\n+  @Override\n+  public void loadGame(\n+      final GameChooserEntry gameChooserEntry,\n+      final Consumer<GameData> onLoad,\n+      final Consumer<Throwable> errorHandler) {\n+    this.gameChooserEntry = gameChooserEntry;\n+    reset();\n+    start();\n+    setOnSucceeded(value -> onLoad.accept(getValue()));\n+    setOnFailed(value -> errorHandler.accept(getException()));\n+  }\n+\n+  @Override\n+  protected Task<GameData> createTask() {\n+    return new Task<>() {\n+      @Override\n+      protected GameData call() throws GameParseException {\n+        return gameChooserEntry\n+            .getCompleteGameData()\n+            .orElseThrow(() -> new GameParseException(\"Missing file!\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NDg5MQ==", "bodyText": "I can't remember the exact details but I think the reason I chose GameParseException here is so that the exception type is consistent.\nI thought that I had a try catch block somewhere where this would make sense, but we just have a generic error handler, so yeah any exception would do.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379854891", "createdAt": "2020-02-15T20:41:40Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/java/org/triplea/game/client/parser/DefaultGameLoader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package org.triplea.game.client.parser;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GameParseException;\n+import games.strategy.engine.framework.ui.GameChooserEntry;\n+import java.util.function.Consumer;\n+import javafx.concurrent.Service;\n+import javafx.concurrent.Task;\n+\n+public class DefaultGameLoader extends Service<GameData> implements GameLoader {\n+  private GameChooserEntry gameChooserEntry;\n+\n+  @Override\n+  public void loadGame(\n+      final GameChooserEntry gameChooserEntry,\n+      final Consumer<GameData> onLoad,\n+      final Consumer<Throwable> errorHandler) {\n+    this.gameChooserEntry = gameChooserEntry;\n+    reset();\n+    start();\n+    setOnSucceeded(value -> onLoad.accept(getValue()));\n+    setOnFailed(value -> errorHandler.accept(getException()));\n+  }\n+\n+  @Override\n+  protected Task<GameData> createTask() {\n+    return new Task<>() {\n+      @Override\n+      protected GameData call() throws GameParseException {\n+        return gameChooserEntry\n+            .getCompleteGameData()\n+            .orElseThrow(() -> new GameParseException(\"Missing file!\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI1NTQwMg=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NTkxMA==", "bodyText": "How about changing to FileNotFound or a IllegalState? GameParseException AFAIK is more about invalid syntax rather than missing game file.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379855910", "createdAt": "2020-02-15T21:02:49Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/java/org/triplea/game/client/parser/DefaultGameLoader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package org.triplea.game.client.parser;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GameParseException;\n+import games.strategy.engine.framework.ui.GameChooserEntry;\n+import java.util.function.Consumer;\n+import javafx.concurrent.Service;\n+import javafx.concurrent.Task;\n+\n+public class DefaultGameLoader extends Service<GameData> implements GameLoader {\n+  private GameChooserEntry gameChooserEntry;\n+\n+  @Override\n+  public void loadGame(\n+      final GameChooserEntry gameChooserEntry,\n+      final Consumer<GameData> onLoad,\n+      final Consumer<Throwable> errorHandler) {\n+    this.gameChooserEntry = gameChooserEntry;\n+    reset();\n+    start();\n+    setOnSucceeded(value -> onLoad.accept(getValue()));\n+    setOnFailed(value -> errorHandler.accept(getException()));\n+  }\n+\n+  @Override\n+  protected Task<GameData> createTask() {\n+    return new Task<>() {\n+      @Override\n+      protected GameData call() throws GameParseException {\n+        return gameChooserEntry\n+            .getCompleteGameData()\n+            .orElseThrow(() -> new GameParseException(\"Missing file!\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI1NTQwMg=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYyODA5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOToyMjozNVrOFqQPvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMTowNTozNFrOFqQkoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDY4Nw==", "bodyText": "Is it worthwhile to create constructor over-loads to avoid the null args? We might be able to put more of the construction work in PlayerListing constructor as well to further simplify here.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379850687", "createdAt": "2020-02-15T19:22:35Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());\n+    final PlayerListing playerListing =\n+        new PlayerListing(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NTQzNw==", "bodyText": "I don't know if you noticed, but I changed the way how users disable nations in the new UI:\nInstead of unchecking a checkbox to disable a player, there is a \"Disable\" option when choosing who controls the specific nation, which feels more natural IMO.\nHowever PlayerListing is used to this checkbox based scheme so I have to convert the data representation so it matches the \"old\"/current scheme.\nSo I could add an overload constructor, but I think this would ultimately lead down a rabbit hole of potential improvements for the data scheme in general.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379855437", "createdAt": "2020-02-15T20:53:15Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());\n+    final PlayerListing playerListing =\n+        new PlayerListing(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDY4Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NjAzMw==", "bodyText": "I did not quite notice that, there is quite a bit going on in this update and I'm afraid to say time is too limited to spend enough time to really properly review everything without further pointers/guidance to call important elements out.\nAn overload of PlayerListing is pretty limited, why would that lead to a rabbit hole? Just add only the overload, then the class here in question does not have to pass unused/null values.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379856033", "createdAt": "2020-02-15T21:05:34Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());\n+    final PlayerListing playerListing =\n+        new PlayerListing(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDY4Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYyODU0OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOToyMzozNlrOFqQP-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMjoyMzo0NVrOFqQ0Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDc0NQ==", "bodyText": "The parameter coming in seems to be a logical negation - can we sanely change that to isEnabled?\nSecond, Is this lamba a place where we can use the Predicates.not(..)?", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379850745", "createdAt": "2020-02-15T19:23:36Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NzUxOA==", "bodyText": "We could, but I'm pretty sure this would make the code longer and doesn't add to readability IMO", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379857518", "createdAt": "2020-02-15T21:33:59Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDc0NQ=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg2MDAzNA==", "bodyText": "Okay, it is a bit odd though as is, because:\n\nenabled = !disabled\nthe predicate is not super clear, it's indirect, not clear why we would have a predicate or what the predicate really represents.\n\nPerhaps confusing item (2) can be helped with naming. Instead of enabledPredicate, some (poor) suggestions, perhaps something like: componentIsEnabled, componentIsNotDisabled", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379860034", "createdAt": "2020-02-15T22:23:45Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/LocalLauncher.java", "diffHunk": "@@ -118,4 +123,33 @@ public static LocalLauncher create(\n             null);\n     return new LocalLauncher(gameSelectorModel, new PlainRandomSource(), pl, parent, launchAction);\n   }\n+\n+  public static LocalLauncher create(\n+      final List<Entry<String, String>> roleMapping,\n+      final Predicate<String> isDisabled,\n+      final GameData gameData) {\n+    final Predicate<Entry<String, String>> enabledPredicate =\n+        entry -> !isDisabled.test(entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDc0NQ=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzMDEyOnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOToyNzo1NVrOFqQQ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMjoyMDowMVrOFqQzlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDk2OA==", "bodyText": "It looks like we have a decent amount of logic in the FXML class here. I was looking at the function reference \"DISABLE_TEXT::equals\", thinking that was logic in the XML class, but going up further, the startGame method itself has logic. This looks like a place where we are mixing display with back-end logic.\nI think we could have a really good fit for view-model, model-controller pattern here. If we had one class to represent the FXML components, I think we could decouple quite nicely and also make the logic test-able.\nEG:\nroleSelectionViewModel.setResourceModifierSelected(resourceModifierCheckbox.isSelected());\nroleSelectionViewModel.setPlayerRoles(roleForPlayers);\nroleSelectionViewModel.startGame();\n\nHave you considered using a view-model, any thoughts?", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379850968", "createdAt": "2020-02-15T19:27:55Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.properties.NumberProperty;\n+import games.strategy.engine.framework.startup.launcher.LocalLauncher;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import games.strategy.triplea.Constants;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import org.triplea.game.client.ui.javafx.screen.ControlledScreen;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+public class RoleSelection implements ControlledScreen<ScreenController<FxmlManager>> {\n+\n+  static final String SELECTED_MAP_KEY = \"selectedMap\";\n+  private static final String DISABLE_TEXT = \"Disable\";\n+\n+  private final Map<GamePlayer, ComboBox<String>> roleForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> incomeForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> pusForPlayers = new HashMap<>();\n+\n+  @FXML private ComboBox<String> allSelectorCheckbox;\n+\n+  @FXML private GridPane factionGrid;\n+\n+  @FXML private VBox root;\n+\n+  @FXML private CheckBox resourceModifierCheckbox;\n+\n+  private ScreenController<FxmlManager> screenController;\n+  private GameData gameData;\n+\n+  @Override\n+  public void connect(final ScreenController<FxmlManager> screenController) {\n+    this.screenController = screenController;\n+  }\n+\n+  @Override\n+  public Node getNode() {\n+    return root;\n+  }\n+\n+  @FXML\n+  void initialize() {\n+    allSelectorCheckbox.getItems().setAll(PlayerType.playerTypes());\n+  }\n+\n+  @Override\n+  public void onShow(final Map<String, Object> data) {\n+    roleForPlayers.clear();\n+    factionGrid\n+        .getChildren()\n+        .removeIf(\n+            node -> {\n+              final Integer row = GridPane.getRowIndex(node);\n+              return row != null && row > 0;\n+            });\n+    gameData =\n+        (GameData)\n+            Optional.ofNullable(data.get(SELECTED_MAP_KEY))\n+                .orElseThrow(\n+                    () -> new IllegalStateException(\"Missing GameData when calling screen\"));\n+    final List<String> availablePlayers = List.of(PlayerType.playerTypes());\n+    for (final GamePlayer gamePlayer : gameData.getPlayerList()) {\n+      setupPlayerControl(availablePlayers, gamePlayer);\n+    }\n+  }\n+\n+  private void setupPlayerControl(\n+      final List<String> availablePlayers, final GamePlayer gamePlayer) {\n+    final var name = new Label(gamePlayer.getName());\n+    final ComboBox<String> controllingPlayer =\n+        new ComboBox<>(FXCollections.observableArrayList(availablePlayers));\n+    controllingPlayer.getSelectionModel().select(0);\n+    if (gamePlayer.getCanBeDisabled()) {\n+      controllingPlayer.getItems().add(DISABLE_TEXT);\n+    }\n+    final Button faction = newFactionButton(gamePlayer, controllingPlayer);\n+    roleForPlayers.put(gamePlayer, controllingPlayer);\n+    final var income = new Spinner<Integer>(0, 100, 100);\n+    income.setDisable(true);\n+    incomeForPlayers.put(gamePlayer, income);\n+    final var pus = new Spinner<Integer>(0, 100, 0);\n+    pus.setDisable(true);\n+    pusForPlayers.put(gamePlayer, pus);\n+    factionGrid.addRow(factionGrid.getRowCount(), name, controllingPlayer, faction, income, pus);\n+  }\n+\n+  private Button newFactionButton(\n+      final GamePlayer gamePlayer, final ComboBox<String> controllingPlayer) {\n+    final Collection<String> playerAlliances =\n+        gameData.getAllianceTracker().getAlliancesPlayerIsIn(gamePlayer);\n+    final var faction = new Button(playerAlliances.toString());\n+    faction.setOnAction(\n+        e -> {\n+          final int targetIndex = controllingPlayer.getSelectionModel().getSelectedIndex();\n+          playerAlliances.stream()\n+              .map(gameData.getAllianceTracker()::getPlayersInAlliance)\n+              .flatMap(Collection::stream)\n+              .map(roleForPlayers::get)\n+              .filter(stringComboBox -> stringComboBox.getItems().size() > targetIndex)\n+              .map(ComboBox::getSelectionModel)\n+              .forEach(selectionModel -> selectionModel.select(targetIndex));\n+        });\n+    return faction;\n+  }\n+\n+  @Override\n+  public Map<String, Class<?>> getValidTypes() {\n+    return Map.of(SELECTED_MAP_KEY, GameData.class);\n+  }\n+\n+  @FXML\n+  void setAllTo() {\n+    factionGrid.getChildren().stream()\n+        .filter(ComboBox.class::isInstance)\n+        .map(node -> (ComboBox<?>) node)\n+        .forEach(\n+            comboBox ->\n+                comboBox\n+                    .getSelectionModel()\n+                    .select(allSelectorCheckbox.getSelectionModel().getSelectedIndex()));\n+  }\n+\n+  @FXML\n+  void cancelMapSelection() {\n+    screenController.switchScreen(FxmlManager.MAP_SELECTION);\n+  }\n+\n+  @FXML\n+  void startGame() {\n+    if (resourceModifierCheckbox.isSelected()) {\n+      setupPuIncome();\n+    }\n+    final List<Entry<String, String>> flatMapping =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NzMxNQ==", "bodyText": "I feel like the line between what should be UI-only and what is logic is really blurry here.\nYour suggestion sounds intruiging, but I'm not quite sure how that would look like for the cases where the view has to query the model for information, for example when pressing on any alliance button next to the control-type selection (AI/Human/Disabled).\nAlso I'm not quite happy with the disable text thingy either, I simply haven't found a good way to store the intermediate selection state and synchronize it with the UI, so I just try to convert the UI back to an \"internal\" repreentation we can work with.\nMaybe that's just me and this isn't a problem at all, but if you can show me a good pattern that works both ways (from view to model and vice-versa) then I'd happily apply it everywhere.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379857315", "createdAt": "2020-02-15T21:30:11Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.properties.NumberProperty;\n+import games.strategy.engine.framework.startup.launcher.LocalLauncher;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import games.strategy.triplea.Constants;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import org.triplea.game.client.ui.javafx.screen.ControlledScreen;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+public class RoleSelection implements ControlledScreen<ScreenController<FxmlManager>> {\n+\n+  static final String SELECTED_MAP_KEY = \"selectedMap\";\n+  private static final String DISABLE_TEXT = \"Disable\";\n+\n+  private final Map<GamePlayer, ComboBox<String>> roleForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> incomeForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> pusForPlayers = new HashMap<>();\n+\n+  @FXML private ComboBox<String> allSelectorCheckbox;\n+\n+  @FXML private GridPane factionGrid;\n+\n+  @FXML private VBox root;\n+\n+  @FXML private CheckBox resourceModifierCheckbox;\n+\n+  private ScreenController<FxmlManager> screenController;\n+  private GameData gameData;\n+\n+  @Override\n+  public void connect(final ScreenController<FxmlManager> screenController) {\n+    this.screenController = screenController;\n+  }\n+\n+  @Override\n+  public Node getNode() {\n+    return root;\n+  }\n+\n+  @FXML\n+  void initialize() {\n+    allSelectorCheckbox.getItems().setAll(PlayerType.playerTypes());\n+  }\n+\n+  @Override\n+  public void onShow(final Map<String, Object> data) {\n+    roleForPlayers.clear();\n+    factionGrid\n+        .getChildren()\n+        .removeIf(\n+            node -> {\n+              final Integer row = GridPane.getRowIndex(node);\n+              return row != null && row > 0;\n+            });\n+    gameData =\n+        (GameData)\n+            Optional.ofNullable(data.get(SELECTED_MAP_KEY))\n+                .orElseThrow(\n+                    () -> new IllegalStateException(\"Missing GameData when calling screen\"));\n+    final List<String> availablePlayers = List.of(PlayerType.playerTypes());\n+    for (final GamePlayer gamePlayer : gameData.getPlayerList()) {\n+      setupPlayerControl(availablePlayers, gamePlayer);\n+    }\n+  }\n+\n+  private void setupPlayerControl(\n+      final List<String> availablePlayers, final GamePlayer gamePlayer) {\n+    final var name = new Label(gamePlayer.getName());\n+    final ComboBox<String> controllingPlayer =\n+        new ComboBox<>(FXCollections.observableArrayList(availablePlayers));\n+    controllingPlayer.getSelectionModel().select(0);\n+    if (gamePlayer.getCanBeDisabled()) {\n+      controllingPlayer.getItems().add(DISABLE_TEXT);\n+    }\n+    final Button faction = newFactionButton(gamePlayer, controllingPlayer);\n+    roleForPlayers.put(gamePlayer, controllingPlayer);\n+    final var income = new Spinner<Integer>(0, 100, 100);\n+    income.setDisable(true);\n+    incomeForPlayers.put(gamePlayer, income);\n+    final var pus = new Spinner<Integer>(0, 100, 0);\n+    pus.setDisable(true);\n+    pusForPlayers.put(gamePlayer, pus);\n+    factionGrid.addRow(factionGrid.getRowCount(), name, controllingPlayer, faction, income, pus);\n+  }\n+\n+  private Button newFactionButton(\n+      final GamePlayer gamePlayer, final ComboBox<String> controllingPlayer) {\n+    final Collection<String> playerAlliances =\n+        gameData.getAllianceTracker().getAlliancesPlayerIsIn(gamePlayer);\n+    final var faction = new Button(playerAlliances.toString());\n+    faction.setOnAction(\n+        e -> {\n+          final int targetIndex = controllingPlayer.getSelectionModel().getSelectedIndex();\n+          playerAlliances.stream()\n+              .map(gameData.getAllianceTracker()::getPlayersInAlliance)\n+              .flatMap(Collection::stream)\n+              .map(roleForPlayers::get)\n+              .filter(stringComboBox -> stringComboBox.getItems().size() > targetIndex)\n+              .map(ComboBox::getSelectionModel)\n+              .forEach(selectionModel -> selectionModel.select(targetIndex));\n+        });\n+    return faction;\n+  }\n+\n+  @Override\n+  public Map<String, Class<?>> getValidTypes() {\n+    return Map.of(SELECTED_MAP_KEY, GameData.class);\n+  }\n+\n+  @FXML\n+  void setAllTo() {\n+    factionGrid.getChildren().stream()\n+        .filter(ComboBox.class::isInstance)\n+        .map(node -> (ComboBox<?>) node)\n+        .forEach(\n+            comboBox ->\n+                comboBox\n+                    .getSelectionModel()\n+                    .select(allSelectorCheckbox.getSelectionModel().getSelectedIndex()));\n+  }\n+\n+  @FXML\n+  void cancelMapSelection() {\n+    screenController.switchScreen(FxmlManager.MAP_SELECTION);\n+  }\n+\n+  @FXML\n+  void startGame() {\n+    if (resourceModifierCheckbox.isSelected()) {\n+      setupPuIncome();\n+    }\n+    final List<Entry<String, String>> flatMapping =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDk2OA=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1OTg2Mw==", "bodyText": "Typically model interactions are mediated by the view model (afaik). Let's keep thinking about this, both read up on view-model pattern a bit. view-model is also agnostic about UI layer, which makes it really great for decoupling swing and potentially allowing more migration of UI. In essence it also allows for UI code to be far more pure, and hence better decoupling. I think there are some examples in the forum poster code where I'll try a view-model, it should give an example of the pattern as well, so let's keep this on our radar.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379859863", "createdAt": "2020-02-15T22:20:01Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screens/RoleSelection.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.properties.NumberProperty;\n+import games.strategy.engine.framework.startup.launcher.LocalLauncher;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import games.strategy.triplea.Constants;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Spinner;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import org.triplea.game.client.ui.javafx.screen.ControlledScreen;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+public class RoleSelection implements ControlledScreen<ScreenController<FxmlManager>> {\n+\n+  static final String SELECTED_MAP_KEY = \"selectedMap\";\n+  private static final String DISABLE_TEXT = \"Disable\";\n+\n+  private final Map<GamePlayer, ComboBox<String>> roleForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> incomeForPlayers = new HashMap<>();\n+  private final Map<GamePlayer, Spinner<Integer>> pusForPlayers = new HashMap<>();\n+\n+  @FXML private ComboBox<String> allSelectorCheckbox;\n+\n+  @FXML private GridPane factionGrid;\n+\n+  @FXML private VBox root;\n+\n+  @FXML private CheckBox resourceModifierCheckbox;\n+\n+  private ScreenController<FxmlManager> screenController;\n+  private GameData gameData;\n+\n+  @Override\n+  public void connect(final ScreenController<FxmlManager> screenController) {\n+    this.screenController = screenController;\n+  }\n+\n+  @Override\n+  public Node getNode() {\n+    return root;\n+  }\n+\n+  @FXML\n+  void initialize() {\n+    allSelectorCheckbox.getItems().setAll(PlayerType.playerTypes());\n+  }\n+\n+  @Override\n+  public void onShow(final Map<String, Object> data) {\n+    roleForPlayers.clear();\n+    factionGrid\n+        .getChildren()\n+        .removeIf(\n+            node -> {\n+              final Integer row = GridPane.getRowIndex(node);\n+              return row != null && row > 0;\n+            });\n+    gameData =\n+        (GameData)\n+            Optional.ofNullable(data.get(SELECTED_MAP_KEY))\n+                .orElseThrow(\n+                    () -> new IllegalStateException(\"Missing GameData when calling screen\"));\n+    final List<String> availablePlayers = List.of(PlayerType.playerTypes());\n+    for (final GamePlayer gamePlayer : gameData.getPlayerList()) {\n+      setupPlayerControl(availablePlayers, gamePlayer);\n+    }\n+  }\n+\n+  private void setupPlayerControl(\n+      final List<String> availablePlayers, final GamePlayer gamePlayer) {\n+    final var name = new Label(gamePlayer.getName());\n+    final ComboBox<String> controllingPlayer =\n+        new ComboBox<>(FXCollections.observableArrayList(availablePlayers));\n+    controllingPlayer.getSelectionModel().select(0);\n+    if (gamePlayer.getCanBeDisabled()) {\n+      controllingPlayer.getItems().add(DISABLE_TEXT);\n+    }\n+    final Button faction = newFactionButton(gamePlayer, controllingPlayer);\n+    roleForPlayers.put(gamePlayer, controllingPlayer);\n+    final var income = new Spinner<Integer>(0, 100, 100);\n+    income.setDisable(true);\n+    incomeForPlayers.put(gamePlayer, income);\n+    final var pus = new Spinner<Integer>(0, 100, 0);\n+    pus.setDisable(true);\n+    pusForPlayers.put(gamePlayer, pus);\n+    factionGrid.addRow(factionGrid.getRowCount(), name, controllingPlayer, faction, income, pus);\n+  }\n+\n+  private Button newFactionButton(\n+      final GamePlayer gamePlayer, final ComboBox<String> controllingPlayer) {\n+    final Collection<String> playerAlliances =\n+        gameData.getAllianceTracker().getAlliancesPlayerIsIn(gamePlayer);\n+    final var faction = new Button(playerAlliances.toString());\n+    faction.setOnAction(\n+        e -> {\n+          final int targetIndex = controllingPlayer.getSelectionModel().getSelectedIndex();\n+          playerAlliances.stream()\n+              .map(gameData.getAllianceTracker()::getPlayersInAlliance)\n+              .flatMap(Collection::stream)\n+              .map(roleForPlayers::get)\n+              .filter(stringComboBox -> stringComboBox.getItems().size() > targetIndex)\n+              .map(ComboBox::getSelectionModel)\n+              .forEach(selectionModel -> selectionModel.select(targetIndex));\n+        });\n+    return faction;\n+  }\n+\n+  @Override\n+  public Map<String, Class<?>> getValidTypes() {\n+    return Map.of(SELECTED_MAP_KEY, GameData.class);\n+  }\n+\n+  @FXML\n+  void setAllTo() {\n+    factionGrid.getChildren().stream()\n+        .filter(ComboBox.class::isInstance)\n+        .map(node -> (ComboBox<?>) node)\n+        .forEach(\n+            comboBox ->\n+                comboBox\n+                    .getSelectionModel()\n+                    .select(allSelectorCheckbox.getSelectionModel().getSelectedIndex()));\n+  }\n+\n+  @FXML\n+  void cancelMapSelection() {\n+    screenController.switchScreen(FxmlManager.MAP_SELECTION);\n+  }\n+\n+  @FXML\n+  void startGame() {\n+    if (resourceModifierCheckbox.isSelected()) {\n+      setupPuIncome();\n+    }\n+    final List<Entry<String, String>> flatMapping =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MDk2OA=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 152}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzNDI5OnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTozNzowMVrOFqQS6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMjo0MzowNlrOFqQ3UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw==", "bodyText": "Any idea if xmllint or spotless works on fxml files?\nIf so, any objections to using either?", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379851497", "createdAt": "2020-02-15T19:37:01Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NjA4Mw==", "bodyText": "This is a side-note for consideration, not to be done in this PR.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379856083", "createdAt": "2020-02-15T21:06:18Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NzQwMw==", "bodyText": "Well FXML should be 100% valid XML AFAIK, but I'm using SceneBuilder for the UI (a WYSIWYG editor for the most part), so all of the XML is auto-generated anyways, so not much value in style checking that IMO.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379857403", "createdAt": "2020-02-15T21:31:51Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1OTkxOA==", "bodyText": "WYSIWYG editor for doing non-prototype work always makes me nervous : |\nAnyways, when you get a chance, so others can jump in, please add some dev setup notes on which editor you are using and kindly provide a link to install it.", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379859918", "createdAt": "2020-02-15T22:21:14Z", "author": {"login": "DanVanAtta"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg2MDcwNA==", "bodyText": "Will do, it's pretty straightforward and IntelliJ integrates with it well.\nI'd highly recommend trying it out. It makes dealing with details (like padding or visual effects like shadows etc.) easy to work with.\nThe main reason to use it is because there's no way to remember all of the available features, so having a couple of checkboxes to check and uncheck to see if it changes something comes in really handy most of the time.\nObviously it doesn't solve all problems, but it should allow non-coders to work on the UI if they want to bring in their own ideas", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379860704", "createdAt": "2020-02-15T22:40:29Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg2MDgxNw==", "bodyText": "Obviously it's only useful for static content and to quickly prototype dynamic content (when you're not getting why it doesn't look like it's supposed to look)", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r379860817", "createdAt": "2020-02-15T22:43:06Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/resources/org/triplea/game/client/ui/javafx/fxml/RoleSelectionScreen.fxml", "diffHunk": "@@ -0,0 +1,52 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.geometry.*?>\n+<?import javafx.scene.control.*?>\n+<?import javafx.scene.layout.*?>\n+\n+<VBox fx:id=\"root\" alignment=\"TOP_CENTER\" fillWidth=\"false\" spacing=\"5.0\" xmlns=\"http://javafx.com/javafx/10.0.2-internal\" xmlns:fx=\"http://javafx.com/fxml/1\" fx:controller=\"org.triplea.game.client.ui.javafx.screens.RoleSelection\">\n+   <children>\n+      <HBox alignment=\"CENTER\">\n+         <children>\n+            <Label text=\"Battle Orders\" />\n+         </children>\n+      </HBox>\n+      <ScrollPane>\n+         <content>\n+            <GridPane fx:id=\"factionGrid\" hgap=\"5.0\" vgap=\"5.0\">\n+              <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                <ColumnConstraints hgrow=\"SOMETIMES\" />\n+                  <ColumnConstraints hgrow=\"SOMETIMES\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTQ5Nw=="}, "originalCommit": {"oid": "27d180461997e4405320155024a17ce38b99f36b"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQzMTMxOnYy", "diffSide": "RIGHT", "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screen/NavigationPane.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowMDoyMlrOFr--Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowMDoyMlrOFr--Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2NDc3OA==", "bodyText": "TODO: Create a unit test for this check", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r381664778", "createdAt": "2020-02-20T02:00:22Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/main/java/org/triplea/game/client/ui/javafx/screen/NavigationPane.java", "diffHunk": "@@ -54,13 +55,31 @@ public void switchScreen(final FxmlManager identifier) {\n       throw new IllegalArgumentException(\"Screen of Type \" + identifier + \" not present\");\n     }\n \n-    final Node screen = screens.get(identifier);\n+    final Node screen = screens.get(identifier).getNode();\n \n     if (root.getChildren().isEmpty()) {\n       root.getChildren().add(screen);\n     } else {\n       root.getChildren().set(0, screen);\n     }\n+    final ControlledScreen<NavigationPane> controlledScreen = screens.get(identifier);\n+    checkTypes(data, controlledScreen.getValidTypes());\n+    controlledScreen.onShow(data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebbc9c1c4b7e6146690485552aef9507cc25a4b9"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQzNTY3OnYy", "diffSide": "RIGHT", "path": "game-headed/src/test/java/org/triplea/game/client/ui/javafx/screens/RoleSelectionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowMToxN1rOFr_AIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowMToxN1rOFr_AIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2NTMxNA==", "bodyText": "TODO: Add a Test case for the onShow method", "url": "https://github.com/triplea-game/triplea/pull/5917#discussion_r381665314", "createdAt": "2020-02-20T02:01:17Z", "author": {"login": "RoiEXLab"}, "path": "game-headed/src/test/java/org/triplea/game/client/ui/javafx/screens/RoleSelectionTest.java", "diffHunk": "@@ -0,0 +1,149 @@\n+package org.triplea.game.client.ui.javafx.screens;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.core.Is.is;\n+import static org.mockito.ArgumentMatchers.anyBoolean;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+import static org.triplea.game.client.ui.javafx.screens.RoleSelection.SELECTED_MAP_KEY;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.framework.startup.ui.PlayerType;\n+import java.util.List;\n+import java.util.Map;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.Node;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.SingleSelectionModel;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.VBox;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n+import org.triplea.game.client.ui.javafx.UserAgentStylesheetTestCase;\n+import org.triplea.game.client.ui.javafx.screen.ScreenController;\n+import org.triplea.game.client.ui.javafx.util.FxmlManager;\n+\n+public class RoleSelectionTest extends UserAgentStylesheetTestCase {\n+\n+  private final RoleSelection roleSelection = new RoleSelection();\n+\n+  @Test\n+  void correctRootNodeIsReturned() {\n+    final VBox root = mock(VBox.class);\n+    roleSelection.setRoot(root);\n+\n+    assertThat(roleSelection.getNode(), is(root));\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  @Test\n+  void allSelectorCheckboxIsInitializedWithCorrectValues() {\n+    final ObservableList<String> observableList = FXCollections.observableArrayList();\n+    final ComboBox<String> comboBox = mock(ComboBox.class);\n+    when(comboBox.getItems()).thenReturn(observableList);\n+    roleSelection.setAllSelectorCheckbox(comboBox);\n+\n+    roleSelection.initialize();\n+\n+    assertThat(observableList, is(List.of(PlayerType.playerTypes())));\n+  }\n+\n+  // TODO Add Test for onShow method", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebbc9c1c4b7e6146690485552aef9507cc25a4b9"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2458, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}