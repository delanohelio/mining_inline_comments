{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNTEyMjA1", "number": 7582, "title": "Various game parser simplifications", "bodyText": "A number of simplifications of game-parser. Of note:\n\nreduced number of entrypoints (consolidated constructors)\nremoved boolean 'mustFind' and 'optional' parameters in favor of returning optional or non-optional return values.\n\n\nTesting\n\nScreens Shots\n\nAdditional Notes to Reviewer\nFirst simplifying GameParser to make future changes easier. Notably will be swapping the XML\nparsing technology out for xml-reader.\n\nRelease Note", "createdAt": "2020-09-09T05:15:31Z", "url": "https://github.com/triplea-game/triplea/pull/7582", "merged": true, "mergeCommit": {"oid": "86afd14cbfb3e575589b97ba1d7e7d92710ef9e0"}, "closed": true, "closedAt": "2020-09-10T01:05:52Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHDpcIgH2gAyNDgyNTEyMjA1OjE1YjM0ZjNiZmIwM2YyNGRhMGZlZmM5NjczOTMwODhjODYxZWM3NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIMCIUgFqTQ4NzIzNzk1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15b34f3bfb03f24da0fefc967393088c861ec741", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/15b34f3bfb03f24da0fefc967393088c861ec741", "committedDate": "2020-09-09T03:29:41Z", "message": "Combine private methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a0abd15ce46636d6bd0f08e5c31844a1da5e9cb", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/1a0abd15ce46636d6bd0f08e5c31844a1da5e9cb", "committedDate": "2020-09-09T03:40:01Z", "message": "Reduce entry points into GameParser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f4a57347b0790c2b9a39252bbcca0f15f251a0d", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/5f4a57347b0790c2b9a39252bbcca0f15f251a0d", "committedDate": "2020-09-09T03:48:52Z", "message": "Remove no longer needed test-hack code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53a360d188ac178c8710e4ef338fbc58c82ec5c1", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/53a360d188ac178c8710e4ef338fbc58c82ec5c1", "committedDate": "2020-09-09T03:57:06Z", "message": "Inline utility method for 'getValidatedObject'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208a6cfd1f1a4e3b01573ddf0ba02201ae752186", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/208a6cfd1f1a4e3b01573ddf0ba02201ae752186", "committedDate": "2020-09-09T04:05:30Z", "message": "Move 'getPlayer' attribute lookup to caller."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d76b2198908424bcaff7ad163ab5ff3629ebdddc", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/d76b2198908424bcaff7ad163ab5ff3629ebdddc", "committedDate": "2020-09-09T04:28:37Z", "message": "Inline usages of 'getValidatedObject', use Optional API instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbaaae0dcbee4386edd9f10e6fdb2461b86ddfda", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/bbaaae0dcbee4386edd9f10e6fdb2461b86ddfda", "committedDate": "2020-09-09T04:31:34Z", "message": "Consistently pass attribute value rather than 'Element'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "013c3a0e9465b0a3a80a835a225b50ef4ca69366", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/013c3a0e9465b0a3a80a835a225b50ef4ca69366", "committedDate": "2020-09-09T04:36:39Z", "message": "Convert 'getChild(.. boolean optional)' to return an Optional value."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad99883c11d7529b4de14af5c2ace7b3053322c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/2ad99883c11d7529b4de14af5c2ace7b3053322c", "committedDate": "2020-09-09T04:40:18Z", "message": "Inline GameData constructor arg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90f96cb9dea569e6e8bb9e089a27016b5b9df9f2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/90f96cb9dea569e6e8bb9e089a27016b5b9df9f2", "committedDate": "2020-09-09T04:43:09Z", "message": "cleanup imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1288bdd9f44eab7519d08a17881bc384f76dd970", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/1288bdd9f44eab7519d08a17881bc384f76dd970", "committedDate": "2020-09-09T04:45:39Z", "message": "Reduce entry points to GameParser, have callers construct an xml game element mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c67ceda1f272029335c7d64635602e1bed7061c4", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c67ceda1f272029335c7d64635602e1bed7061c4", "committedDate": "2020-09-09T04:50:40Z", "message": "Reduce game parser state, abort parsing if there are SAX errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d6e7831b91f515b392e16994691aa85b640487", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/15d6e7831b91f515b392e16994691aa85b640487", "committedDate": "2020-09-09T04:51:18Z", "message": "Fix syntax error / typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5f1e452975e250cafbfe3340823759ba04334c2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/f5f1e452975e250cafbfe3340823759ba04334c2", "committedDate": "2020-09-09T04:56:45Z", "message": "Move error message formatting to GameParseException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a384d05cbceb091867c2c7632c15515e8c83fd3", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8a384d05cbceb091867c2c7632c15515e8c83fd3", "committedDate": "2020-09-09T04:58:22Z", "message": "Move GameParseException to gameparser package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c87a8da79c6d84e7095c92427aae762d7ee5d12e", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/c87a8da79c6d84e7095c92427aae762d7ee5d12e", "committedDate": "2020-09-09T05:04:27Z", "message": "Inline usages of GameParseException in GameParser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4c45c969851a8b530197a4f409d48a3c88b8481", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/e4c45c969851a8b530197a4f409d48a3c88b8481", "committedDate": "2020-09-09T05:08:08Z", "message": "Simplify null property parsing, parseInt will throw an exception and we'll set the null value anyways"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754083366eeca81bb3f673bbebe856749a476261", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/754083366eeca81bb3f673bbebe856749a476261", "committedDate": "2020-09-09T05:10:26Z", "message": "Move variable definitions closer to usage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NjY5MTMz", "url": "https://github.com/triplea-game/triplea/pull/7582#pullrequestreview-484669133", "createdAt": "2020-09-09T05:23:19Z", "commit": {"oid": "754083366eeca81bb3f673bbebe856749a476261"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNToyMzoxOVrOHO3H8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNToyMzoyMFrOHO3H8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM0NTI2NA==", "bodyText": "Method parseMapPropertiesAndDetails has 59 lines of code (exceeds 50 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7582#discussion_r485345264", "createdAt": "2020-09-09T05:23:19Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -118,111 +106,80 @@ private GameParser(\n         });\n   }\n \n-  @Nonnull\n-  @VisibleForTesting\n-  public static GameData parse(\n-      final String mapName,\n-      final InputStream stream,\n-      final XmlGameElementMapper xmlGameElementMapper)\n-      throws GameParseException, EngineVersionException {\n-    checkNotNull(mapName);\n-    checkNotNull(stream);\n-    checkNotNull(xmlGameElementMapper);\n-\n-    return new GameParser(new GameData(), mapName, xmlGameElementMapper).parse(stream);\n-  }\n-\n   @Nonnull\n   private GameData parse(final InputStream stream)\n       throws GameParseException, EngineVersionException {\n+\n+    final Collection<SAXParseException> errorsSax = new ArrayList<>();\n     final Element root = XmlReader.parseDom(mapName, stream, errorsSax);\n-    parseMapProperties(root);\n-    parseMapDetails(root);\n-    return data;\n-  }\n \n-  private GameParseException newGameParseException(final String message) {\n-    return newGameParseException(message, null);\n-  }\n+    if (!errorsSax.isEmpty()) {\n+      throw new GameParseException(errorsSax);\n+    }\n \n-  private GameParseException newGameParseException(\n-      final String message, final @Nullable Throwable cause) {\n-    final String gameName = data.getGameName() != null ? data.getGameName() : \"<unknown>\";\n-    return new GameParseException(\n-        String.format(\"map name: '%s', game name: '%s', %s\", mapName, gameName, message), cause);\n+    parseMapPropertiesAndDetails(root);\n+    return data;\n   }\n \n-  private void parseMapProperties(final Element root)\n+  private void parseMapPropertiesAndDetails(final Element root)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754083366eeca81bb3f673bbebe856749a476261"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM0NTI2Ng==", "bodyText": "Method parseMapPropertiesAndDetails has a Cognitive Complexity of 11 (exceeds 7 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7582#discussion_r485345266", "createdAt": "2020-09-09T05:23:20Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -118,111 +106,80 @@ private GameParser(\n         });\n   }\n \n-  @Nonnull\n-  @VisibleForTesting\n-  public static GameData parse(\n-      final String mapName,\n-      final InputStream stream,\n-      final XmlGameElementMapper xmlGameElementMapper)\n-      throws GameParseException, EngineVersionException {\n-    checkNotNull(mapName);\n-    checkNotNull(stream);\n-    checkNotNull(xmlGameElementMapper);\n-\n-    return new GameParser(new GameData(), mapName, xmlGameElementMapper).parse(stream);\n-  }\n-\n   @Nonnull\n   private GameData parse(final InputStream stream)\n       throws GameParseException, EngineVersionException {\n+\n+    final Collection<SAXParseException> errorsSax = new ArrayList<>();\n     final Element root = XmlReader.parseDom(mapName, stream, errorsSax);\n-    parseMapProperties(root);\n-    parseMapDetails(root);\n-    return data;\n-  }\n \n-  private GameParseException newGameParseException(final String message) {\n-    return newGameParseException(message, null);\n-  }\n+    if (!errorsSax.isEmpty()) {\n+      throw new GameParseException(errorsSax);\n+    }\n \n-  private GameParseException newGameParseException(\n-      final String message, final @Nullable Throwable cause) {\n-    final String gameName = data.getGameName() != null ? data.getGameName() : \"<unknown>\";\n-    return new GameParseException(\n-        String.format(\"map name: '%s', game name: '%s', %s\", mapName, gameName, message), cause);\n+    parseMapPropertiesAndDetails(root);\n+    return data;\n   }\n \n-  private void parseMapProperties(final Element root)\n+  private void parseMapPropertiesAndDetails(final Element root)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754083366eeca81bb3f673bbebe856749a476261"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25fc3f541913dd1085c5cf563f7025caf78c4dc1", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/25fc3f541913dd1085c5cf563f7025caf78c4dc1", "committedDate": "2020-09-09T07:02:45Z", "message": "Combine private methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b18d9c3ec130e6a845437d2a5f9b649f1028d52e", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/b18d9c3ec130e6a845437d2a5f9b649f1028d52e", "committedDate": "2020-09-09T07:05:06Z", "message": "Remove unnecessary parameter type-cast and inline intermediate info variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "589d9b4210666f0e0d932779698fc4cc9e8fb0db", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/589d9b4210666f0e0d932779698fc4cc9e8fb0db", "committedDate": "2020-09-09T08:03:26Z", "message": "Extract game parsing validation to another class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55d04c1cd1b5ae1c1c03ac8ad6a4b26cbd3c0a25", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/55d04c1cd1b5ae1c1c03ac8ad6a4b26cbd3c0a25", "committedDate": "2020-09-09T07:22:52Z", "message": "Inline production and tech grouping methods"}, "afterCommit": {"oid": "589d9b4210666f0e0d932779698fc4cc9e8fb0db", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/589d9b4210666f0e0d932779698fc4cc9e8fb0db", "committedDate": "2020-09-09T08:03:26Z", "message": "Extract game parsing validation to another class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjM3OTU0", "url": "https://github.com/triplea-game/triplea/pull/7582#pullrequestreview-487237954", "createdAt": "2020-09-12T15:49:49Z", "commit": {"oid": "589d9b4210666f0e0d932779698fc4cc9e8fb0db"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3993, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}