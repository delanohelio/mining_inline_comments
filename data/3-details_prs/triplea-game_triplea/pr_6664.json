{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMTg0OTY3", "number": 6664, "title": "Remove legacy MD5Crypt Password", "bodyText": "All accounts being migrated to 2.0 have a bcrypt password, we\nno longer need the legacy 'password' column on lobby_user\nwhich stored passes as MD5Crypt.\nThis update:\n\nremoves the md5crypt'ed password column\nadds a non-null constraint to the bcrypt_password column\nmoves SHA512 password hashing from server to client.\nThe SHA512 password hash is simply so that those that\ncontrol the server cannot know the plain-text password\nof a user. The SHA512 hash is not intended to protect\nthe password on the client-side.\nSimplifies some of the password hash verification logic\nby collapsing intermediary function objects.\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\nVerified:\n\nlogin with existing password\nlogin after creating an account\nlogin after changing password\nlogin using a temporary password via 'forgot password'\n\n\n\n\n\nAdditional Review Notes\nAll accounts migrated to 2.0 have a bcrypt password! We can finally drop the MD5Crypt'ed password \ud83d\udc4d\nNetwork Compatibility\nThis update is not network compatible to the lobby due to the change in contract of who SHA512 hashes the users password. After this update it is up to the client to do that hashing. We could make this update network compatible by trying a users password twice, once as-is, and again SHA512 hashed. Rather than incur this inefficiency for a long time, instead we can make this incompatible and after merge would update the servers.yaml latest and min versions to notify players to upgrade. Given we are still early in soft-release, this should not be very impactful to any of the early release testers.", "createdAt": "2020-06-10T03:57:08Z", "url": "https://github.com/triplea-game/triplea/pull/6664", "merged": true, "mergeCommit": {"oid": "bb1a303bb499ec9fc400105ec2c7edc7d2a4d6aa"}, "closed": true, "closedAt": "2020-06-11T00:09:50Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpxa8GgH2gAyNDMyMTg0OTY3OjIxM2ZlZmI1MTdhODkwMDZmYzhiMTY5YWQ2MGYwOGUyMmVlZmNjMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp9Z98gFqTQyODI4OTU2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "213fefb517a89006fc8b169ad60f08e22eefcc0c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/213fefb517a89006fc8b169ad60f08e22eefcc0c", "committedDate": "2020-06-10T03:51:45Z", "message": "Remove legacy MD5Crypt Password\n\nAll accounts being migrated to 2.0 have a bcrypt password, we\nno longer need the legacy 'password' column on lobby_user\nwhich stored passes as MD5Crypt.\n\nThis update:\n- removes the md5crypt'ed password column\n- adds a non-null constraint to the bcrypt_password column\n- moves SHA512 password hashing from server to client.\n  The SHA512 password hash is simply so that those that\n  control the server cannot know the plain-text password\n  of a user. The SHA512 hash is *not* intended to protect\n  the password on the client-side.\n- Simplifies some of the password hash verification logic\n  by collapsing intermediary function objects."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73a1ec9bd40fa9c00ce51e837ad34d0696c0926", "author": {"user": {"login": "tripleabuilderbot", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/f73a1ec9bd40fa9c00ce51e837ad34d0696c0926", "committedDate": "2020-06-10T03:56:29Z", "message": "Auto-Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mjg5NTY5", "url": "https://github.com/triplea-game/triplea/pull/6664#pullrequestreview-428289569", "createdAt": "2020-06-10T17:44:26Z", "commit": {"oid": "f73a1ec9bd40fa9c00ce51e837ad34d0696c0926"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzo0NDoyNlrOGh_0FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzo0NDoyNlrOGh_0FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMwMTcxNw==", "bodyText": "IIRC we have a constraint that ensures that at least one of the password fields has to be filled.\nIs this constraint properly removed along with the password column?", "url": "https://github.com/triplea-game/triplea/pull/6664#discussion_r438301717", "createdAt": "2020-06-10T17:44:26Z", "author": {"login": "RoiEXLab"}, "path": "lobby-db/src/main/resources/db/migration/V2.00.05__drop_legacy_password.sql", "diffHunk": "@@ -0,0 +1,2 @@\n+alter table lobby_user drop column password;\n+alter table lobby_user alter column bcrypt_password set not null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f73a1ec9bd40fa9c00ce51e837ad34d0696c0926"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3375, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}