{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NjcwNzI5", "number": 7249, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMToyOTozNFrOESFfKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzoyNDo0NFrOESl9Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Mzk5NzIwOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMToyOTozNFrOG3HjFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMToyOTozNFrOG3HjFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0ODUzNQ==", "bodyText": "Method getPlayerUnitsWithImages has a Cognitive Complexity of 26 (exceeds 7 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7249#discussion_r460448535", "createdAt": "2020-07-25T21:29:34Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "diffHunk": "@@ -2,94 +2,174 @@\n \n import games.strategy.engine.data.GameData;\n import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.NamedAttachable;\n+import games.strategy.engine.data.ProductionRule;\n import games.strategy.engine.data.ResourceCollection;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n import games.strategy.engine.data.UnitType;\n import games.strategy.triplea.image.UnitImageFactory;\n+import games.strategy.triplea.image.UnitImageFactory.ImageKey;\n import games.strategy.triplea.ui.TooltipProperties;\n import games.strategy.triplea.ui.UiContext;\n import games.strategy.triplea.util.TuvUtils;\n-import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Comparator;\n+import java.util.HashSet;\n+import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.Optional;\n+import java.util.Set;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n import lombok.experimental.UtilityClass;\n+import lombok.extern.java.Log;\n \n @UtilityClass\n+@Log\n public class UnitStatsTable {\n \n   public static String getUnitStatsTable(final GameData gameData, final UiContext uiContext) {\n     // html formatted string\n     final StringBuilder hints = new StringBuilder();\n     hints.append(\"<html>\");\n     hints.append(\"<head><style>th, tr{color:black}</style></head>\");\n-    try {\n-      gameData.acquireReadLock();\n-      final Map<GamePlayer, Map<UnitType, ResourceCollection>> costs =\n-          TuvUtils.getResourceCostsForTuv(gameData, true);\n-      final Map<GamePlayer, List<UnitType>> playerUnitTypes =\n-          UnitType.getAllPlayerUnitsWithImages(gameData, uiContext, true);\n-      final String color3 = \"FEECE2\";\n-      final String color2 = \"BDBDBD\";\n-      final String color1 = \"ABABAB\";\n-      int i = 0;\n-      for (final Map.Entry<GamePlayer, List<UnitType>> entry : playerUnitTypes.entrySet()) {\n-        final GamePlayer player = entry.getKey();\n-        hints.append(\"<p><table border=\\\"1\\\" bgcolor=\\\"\" + color1 + \"\\\">\");\n-        hints\n-            .append(\n-                \"<tr><th style=\\\"font-size:120%;000000\\\" bgcolor=\\\"\" + color3 + \"\\\" colspan=\\\"4\\\">\")\n-            .append(player == null ? \"NULL\" : player.getName())\n-            .append(\" Units</th></tr>\");\n-        hints\n-            .append(\"<tr\")\n-            .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-            .append(\"><td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr>\");\n-        for (final UnitType ut : entry.getValue()) {\n-          if (uiContext.getMapData().shouldDrawUnit(ut.getName())) {\n-            i++;\n-            hints\n-                .append(\"<tr\")\n-                .append(\n-                    ((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-                .append(\">\")\n-                .append(\"<td>\")\n-                .append(getUnitImageUrl(ut, player, uiContext))\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(ut.getName())\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(costs.get(player).get(ut).toStringForHtml())\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(TooltipProperties.getInstance().getTooltip(ut, player))\n-                .append(\"</td></tr>\");\n-          }\n+    final Map<GamePlayer, Map<UnitType, ResourceCollection>> costs =\n+        TuvUtils.getResourceCostsForTuv(gameData, true);\n+    final Map<GamePlayer, List<UnitType>> playerUnitTypes =\n+        getAllPlayerUnitsWithImages(gameData, uiContext);\n+    final String color3 = \"FEECE2\";\n+    final String color2 = \"BDBDBD\";\n+    final String color1 = \"ABABAB\";\n+    int i = 0;\n+    for (final Map.Entry<GamePlayer, List<UnitType>> entry : playerUnitTypes.entrySet()) {\n+      final GamePlayer player = entry.getKey();\n+      hints.append(\"<p><table border=\\\"1\\\" bgcolor=\\\"\" + color1 + \"\\\">\");\n+      hints\n+          .append(\n+              \"<tr><th style=\\\"font-size:120%;000000\\\" bgcolor=\\\"\" + color3 + \"\\\" colspan=\\\"4\\\">\")\n+          .append(player == null ? \"NULL\" : player.getName())\n+          .append(\" Units</th></tr>\");\n+      hints\n+          .append(\"<tr\")\n+          .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+          .append(\"><td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr>\");\n+      for (final UnitType ut : entry.getValue()) {\n+        if (uiContext.getMapData().shouldDrawUnit(ut.getName())) {\n+          i++;\n+          hints\n+              .append(\"<tr\")\n+              .append(\n+                  ((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+              .append(\">\")\n+              .append(\"<td>\")\n+              .append(getUnitImageUrl(ut, player, uiContext))\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(ut.getName())\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(costs.get(player).get(ut).toStringForHtml())\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(TooltipProperties.getInstance().getTooltip(ut, player))\n+              .append(\"</td></tr>\");\n         }\n-        i++;\n-        hints\n-            .append(\"<tr\")\n-            .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-            .append(\">\")\n-            .append(\n-                \"<td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr></table></p><br />\");\n       }\n-    } finally {\n-      gameData.releaseReadLock();\n+      i++;\n+      hints\n+          .append(\"<tr\")\n+          .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+          .append(\">\")\n+          .append(\n+              \"<td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr></table></p><br />\");\n     }\n     hints.append(\"</html>\");\n     return hints.toString();\n   }\n \n+  /** Will return a key of NULL for any units which we do not have art for. */\n+  private static Map<GamePlayer, List<UnitType>> getAllPlayerUnitsWithImages(\n+      final GameData data, final UiContext uiContext) {\n+    final Map<GamePlayer, List<UnitType>> unitTypes = new LinkedHashMap<>();\n+    for (final GamePlayer p : data.getPlayerList().getPlayers()) {\n+      unitTypes.put(p, getPlayerUnitsWithImages(p, data, uiContext));\n+    }\n+    final Set<UnitType> unitsSoFar = new HashSet<>();\n+    for (final List<UnitType> l : unitTypes.values()) {\n+      unitsSoFar.addAll(l);\n+    }\n+    final Set<UnitType> all = data.getUnitTypeList().getAllUnitTypes();\n+    all.removeAll(unitsSoFar);\n+    unitTypes.put(\n+        GamePlayer.NULL_PLAYERID,\n+        getPlayerUnitsWithImages(GamePlayer.NULL_PLAYERID, data, uiContext));\n+    unitsSoFar.addAll(unitTypes.get(GamePlayer.NULL_PLAYERID));\n+    all.removeAll(unitsSoFar);\n+    if (!all.isEmpty()) {\n+      unitTypes.put(null, new ArrayList<>(all));\n+    }\n+    return unitTypes;\n+  }\n+\n+  private static List<UnitType> getPlayerUnitsWithImages(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406ea3685b3fa3749cb2be84e2ffa38044e4b0be"}, "originalPosition": 168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Mzk5NzIxOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMToyOTozNVrOG3HjGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMToyOTozNVrOG3HjGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0ODUzNg==", "bodyText": "Method getPlayerUnitsWithImages has 36 lines of code (exceeds 30 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/7249#discussion_r460448536", "createdAt": "2020-07-25T21:29:35Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "diffHunk": "@@ -2,94 +2,174 @@\n \n import games.strategy.engine.data.GameData;\n import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.NamedAttachable;\n+import games.strategy.engine.data.ProductionRule;\n import games.strategy.engine.data.ResourceCollection;\n+import games.strategy.engine.data.Territory;\n+import games.strategy.engine.data.Unit;\n import games.strategy.engine.data.UnitType;\n import games.strategy.triplea.image.UnitImageFactory;\n+import games.strategy.triplea.image.UnitImageFactory.ImageKey;\n import games.strategy.triplea.ui.TooltipProperties;\n import games.strategy.triplea.ui.UiContext;\n import games.strategy.triplea.util.TuvUtils;\n-import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Comparator;\n+import java.util.HashSet;\n+import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.Optional;\n+import java.util.Set;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n import lombok.experimental.UtilityClass;\n+import lombok.extern.java.Log;\n \n @UtilityClass\n+@Log\n public class UnitStatsTable {\n \n   public static String getUnitStatsTable(final GameData gameData, final UiContext uiContext) {\n     // html formatted string\n     final StringBuilder hints = new StringBuilder();\n     hints.append(\"<html>\");\n     hints.append(\"<head><style>th, tr{color:black}</style></head>\");\n-    try {\n-      gameData.acquireReadLock();\n-      final Map<GamePlayer, Map<UnitType, ResourceCollection>> costs =\n-          TuvUtils.getResourceCostsForTuv(gameData, true);\n-      final Map<GamePlayer, List<UnitType>> playerUnitTypes =\n-          UnitType.getAllPlayerUnitsWithImages(gameData, uiContext, true);\n-      final String color3 = \"FEECE2\";\n-      final String color2 = \"BDBDBD\";\n-      final String color1 = \"ABABAB\";\n-      int i = 0;\n-      for (final Map.Entry<GamePlayer, List<UnitType>> entry : playerUnitTypes.entrySet()) {\n-        final GamePlayer player = entry.getKey();\n-        hints.append(\"<p><table border=\\\"1\\\" bgcolor=\\\"\" + color1 + \"\\\">\");\n-        hints\n-            .append(\n-                \"<tr><th style=\\\"font-size:120%;000000\\\" bgcolor=\\\"\" + color3 + \"\\\" colspan=\\\"4\\\">\")\n-            .append(player == null ? \"NULL\" : player.getName())\n-            .append(\" Units</th></tr>\");\n-        hints\n-            .append(\"<tr\")\n-            .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-            .append(\"><td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr>\");\n-        for (final UnitType ut : entry.getValue()) {\n-          if (uiContext.getMapData().shouldDrawUnit(ut.getName())) {\n-            i++;\n-            hints\n-                .append(\"<tr\")\n-                .append(\n-                    ((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-                .append(\">\")\n-                .append(\"<td>\")\n-                .append(getUnitImageUrl(ut, player, uiContext))\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(ut.getName())\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(costs.get(player).get(ut).toStringForHtml())\n-                .append(\"</td>\")\n-                .append(\"<td>\")\n-                .append(TooltipProperties.getInstance().getTooltip(ut, player))\n-                .append(\"</td></tr>\");\n-          }\n+    final Map<GamePlayer, Map<UnitType, ResourceCollection>> costs =\n+        TuvUtils.getResourceCostsForTuv(gameData, true);\n+    final Map<GamePlayer, List<UnitType>> playerUnitTypes =\n+        getAllPlayerUnitsWithImages(gameData, uiContext);\n+    final String color3 = \"FEECE2\";\n+    final String color2 = \"BDBDBD\";\n+    final String color1 = \"ABABAB\";\n+    int i = 0;\n+    for (final Map.Entry<GamePlayer, List<UnitType>> entry : playerUnitTypes.entrySet()) {\n+      final GamePlayer player = entry.getKey();\n+      hints.append(\"<p><table border=\\\"1\\\" bgcolor=\\\"\" + color1 + \"\\\">\");\n+      hints\n+          .append(\n+              \"<tr><th style=\\\"font-size:120%;000000\\\" bgcolor=\\\"\" + color3 + \"\\\" colspan=\\\"4\\\">\")\n+          .append(player == null ? \"NULL\" : player.getName())\n+          .append(\" Units</th></tr>\");\n+      hints\n+          .append(\"<tr\")\n+          .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+          .append(\"><td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr>\");\n+      for (final UnitType ut : entry.getValue()) {\n+        if (uiContext.getMapData().shouldDrawUnit(ut.getName())) {\n+          i++;\n+          hints\n+              .append(\"<tr\")\n+              .append(\n+                  ((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+              .append(\">\")\n+              .append(\"<td>\")\n+              .append(getUnitImageUrl(ut, player, uiContext))\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(ut.getName())\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(costs.get(player).get(ut).toStringForHtml())\n+              .append(\"</td>\")\n+              .append(\"<td>\")\n+              .append(TooltipProperties.getInstance().getTooltip(ut, player))\n+              .append(\"</td></tr>\");\n         }\n-        i++;\n-        hints\n-            .append(\"<tr\")\n-            .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n-            .append(\">\")\n-            .append(\n-                \"<td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr></table></p><br />\");\n       }\n-    } finally {\n-      gameData.releaseReadLock();\n+      i++;\n+      hints\n+          .append(\"<tr\")\n+          .append(((i & 1) == 0) ? \" bgcolor=\\\"\" + color1 + \"\\\"\" : \" bgcolor=\\\"\" + color2 + \"\\\"\")\n+          .append(\">\")\n+          .append(\n+              \"<td>Unit</td><td>Name</td><td>Cost</td><td>Tool Tip</td></tr></table></p><br />\");\n     }\n     hints.append(\"</html>\");\n     return hints.toString();\n   }\n \n+  /** Will return a key of NULL for any units which we do not have art for. */\n+  private static Map<GamePlayer, List<UnitType>> getAllPlayerUnitsWithImages(\n+      final GameData data, final UiContext uiContext) {\n+    final Map<GamePlayer, List<UnitType>> unitTypes = new LinkedHashMap<>();\n+    for (final GamePlayer p : data.getPlayerList().getPlayers()) {\n+      unitTypes.put(p, getPlayerUnitsWithImages(p, data, uiContext));\n+    }\n+    final Set<UnitType> unitsSoFar = new HashSet<>();\n+    for (final List<UnitType> l : unitTypes.values()) {\n+      unitsSoFar.addAll(l);\n+    }\n+    final Set<UnitType> all = data.getUnitTypeList().getAllUnitTypes();\n+    all.removeAll(unitsSoFar);\n+    unitTypes.put(\n+        GamePlayer.NULL_PLAYERID,\n+        getPlayerUnitsWithImages(GamePlayer.NULL_PLAYERID, data, uiContext));\n+    unitsSoFar.addAll(unitTypes.get(GamePlayer.NULL_PLAYERID));\n+    all.removeAll(unitsSoFar);\n+    if (!all.isEmpty()) {\n+      unitTypes.put(null, new ArrayList<>(all));\n+    }\n+    return unitTypes;\n+  }\n+\n+  private static List<UnitType> getPlayerUnitsWithImages(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406ea3685b3fa3749cb2be84e2ffa38044e4b0be"}, "originalPosition": 168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3NDAxMzc5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/triplea/image/UnitImageFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMTo1NTozNVrOG3Hqcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMTo1NTozNVrOG3Hqcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ1MDQxOQ==", "bodyText": "Codacy found an issue: The method 'getBaseImageName()' has an NPath complexity of 102606, current threshold is 200", "url": "https://github.com/triplea-game/triplea/pull/7249#discussion_r460450419", "createdAt": "2020-07-25T21:55:35Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/image/UnitImageFactory.java", "diffHunk": "@@ -61,6 +65,113 @@ public UnitImageFactory(\n     this.mapData = mapData;\n   }\n \n+  @Value\n+  @Builder\n+  public static class ImageKey {\n+    private final GamePlayer player;\n+    private final UnitType type;\n+    private final boolean damaged;\n+    private final boolean disabled;\n+\n+    public static ImageKey of(final UnitCategory unit) {\n+      return ImageKey.builder()\n+          .player(unit.getOwner())\n+          .type(unit.getType())\n+          .damaged(unit.hasDamageOrBombingUnitDamage())\n+          .disabled(unit.getDisabled())\n+          .build();\n+    }\n+\n+    public static ImageKey of(final UnitOwner holder) {\n+      return ImageKey.builder().player(holder.getOwner()).type(holder.getType()).build();\n+    }\n+\n+    public static ImageKey of(final Unit unit) {\n+      return ImageKey.builder()\n+          .player(unit.getOwner())\n+          .type(unit.getType())\n+          .damaged(Matches.unitHasTakenSomeBombingUnitDamage().test(unit))\n+          .disabled(Matches.unitIsDisabled().test(unit))\n+          .build();\n+    }\n+\n+    public String getFullName() {\n+      return getBaseImageName() + player.getName();\n+    }\n+\n+    public String getBaseImageName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d38d61d7552e272607f5fedc9f1c71cce2bc2e9"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3OTMxNjYyOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzoyNDo0NFrOG33CNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzoyNDo0NFrOG33CNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyNjU1MQ==", "bodyText": "Could you explain why this if statement is always true?\nIf all is no subset of unitsSoFar this isn't always the case", "url": "https://github.com/triplea-game/triplea/pull/7249#discussion_r461226551", "createdAt": "2020-07-27T23:24:44Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/help/UnitStatsTable.java", "diffHunk": "@@ -103,15 +103,13 @@ public static String getUnitStatsTable(final GameData gameData, final UiContext\n     }\n     final Set<UnitType> all = data.getUnitTypeList().getAllUnitTypes();\n     all.removeAll(unitsSoFar);\n+    unitTypes.put(\n+        GamePlayer.NULL_PLAYERID,\n+        getPlayerUnitsWithImages(GamePlayer.NULL_PLAYERID, data, uiContext));\n+    unitsSoFar.addAll(unitTypes.get(GamePlayer.NULL_PLAYERID));\n+    all.removeAll(unitsSoFar);\n     if (!all.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33dbe24bf38e5d116c88de0c6f4e3269c685acf9"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2018, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}