{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTI5Mjc4", "number": 6382, "title": "Github issue client cleanup & Add \"Error Report\" label to uploaded issues", "bodyText": "Feature: Update automatic issue creation to add a label \"Error Report\"\nto issues created via the error report functionality. The labels will\nserver to more easily identify and organize errors that were uploaded\nfrom the game client.\nImplementation changes:\nTo attach labels we split the create error report object, prevoiusly\nthe error report object sent to the HTTP server matched the one we\nsent to github. After splitting the error report request object,\nthe 'createIssueRequest' object we send to github to create issues\ncan have labels added to it.\n\n\nCleanup: Update github issue client to be consistent with a well\nnamed feign client class.\n\n\nCleanup: Make github issue client upload 'isTest' behavior be internal\nto the client. Before it was the user of the client class that checked\nif the client was in test mode and stubbed a response, now the client\nwill transparently return a stubbed response when in test mode.\n\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nupdated configuration.yml to have a personal access token\nset the game client to use a local lobby server\nlaunched a local lobby server\nupdated game runner to throw an exception after the UI is rendered\nverified error report pop-up appeared and uploaded an error report.\nverified error report issue contains expected label: triplea-game/test#58", "createdAt": "2020-05-04T19:04:55Z", "url": "https://github.com/triplea-game/triplea/pull/6382", "merged": true, "mergeCommit": {"oid": "0fd02c36b1173b1096b856bf7be2445d021cb4f8"}, "closed": true, "closedAt": "2020-05-05T19:00:49Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceERnIAH2gAyNDEzMTI5Mjc4OjMwYTkyZGUzNzQzZGZkYWRjYWRiYjZlOTBhOTAyYmE0NDQyZDlkMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceXgZogH2gAyNDEzMTI5Mjc4OmFiN2MyNzQyN2ZiYmUzYTFjNGIzNGUyNjBlY2RlNmM2MzhhMTMxNDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30a92de3743dfdadcadbb6e90a902ba4442d9d22", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/30a92de3743dfdadcadbb6e90a902ba4442d9d22", "committedDate": "2020-05-04T19:02:40Z", "message": "Github issue client cleanup & Add \"Error Report\" label to uploaded issues\n\n1. Feature: Update automatic issue creation to add a label \"Error Report\"\n   to issues created via the error report functionality. The labels will\n   server to more easily identify and organize errors that were uploaded\n   from the game client.\n\n   Implementation changes:\n   To attach labels we split the create error report object, prevoiusly\n   the error report object sent to the HTTP server matched the one we\n   sent to github. After splitting the error report request object,\n   the 'createIssueRequest' object we send to github to create issues\n   can have labels added to it.\n\n2. Cleanup: Update github issue client to be consistent with a well\n   named feign client class.\n\n3. Cleanup: Make github issue client upload 'isTest' behavior be internal\n   to the client. Before it was the user of the client class that checked\n   if the client was in test mode and stubbed a response, now the client\n   will transparently return a stubbed response when in test mode."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzA1ODY1", "url": "https://github.com/triplea-game/triplea/pull/6382#pullrequestreview-405705865", "createdAt": "2020-05-05T11:38:09Z", "commit": {"oid": "30a92de3743dfdadcadbb6e90a902ba4442d9d22"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMTozODowOVrOGQla6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMTozOTozMlrOGQldmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0MzQ5Nw==", "bodyText": "What about checking !isTest || !configuration.isProd() or !(isTest && configuration.isProd()) instead of the if block?", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420043497", "createdAt": "2020-05-05T11:38:09Z", "author": {"login": "RoiEXLab"}, "path": "http-server/src/main/java/org/triplea/modules/error/reporting/ErrorReportController.java", "diffHunk": "@@ -27,15 +27,18 @@\n   private final BiFunction<String, ErrorReportRequest, ErrorReportResponse> errorReportIngestion;\n \n   public static ErrorReportController build(final AppConfig configuration, final Jdbi jdbi) {\n+    final boolean isTest = configuration.getGithubApiToken().equals(\"test\");\n+\n     final GithubIssueClient githubIssueClient =\n         GithubIssueClient.builder()\n             .uri(AppConfig.GITHUB_WEB_SERVICE_API_URL)\n             .authToken(configuration.getGithubApiToken())\n             .githubOrg(AppConfig.GITHUB_ORG)\n             .githubRepo(configuration.getGithubRepo())\n+            .isTest(isTest)\n             .build();\n \n-    if (githubIssueClient.isTest()) {\n+    if (isTest) {\n       Preconditions.checkState(!configuration.isProd());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30a92de3743dfdadcadbb6e90a902ba4442d9d22"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0NDE4Nw==", "bodyText": "Is 20000 a github limit?", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420044187", "createdAt": "2020-05-05T11:39:32Z", "author": {"login": "RoiEXLab"}, "path": "http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.triplea.http.client.github.issues;\n+\n+import com.google.common.base.Ascii;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.EqualsAndHashCode;\n+import lombok.NoArgsConstructor;\n+import lombok.ToString;\n+\n+/** Represents request data to create a github issue. */\n+@ToString\n+@EqualsAndHashCode\n+@Builder\n+@NoArgsConstructor\n+@AllArgsConstructor\n+public class CreateIssueRequest {\n+  private String title;\n+  private String body;\n+  private String[] labels;\n+\n+  public String getTitle() {\n+    return title == null ? null : Ascii.truncate(title, 125, \"...\");\n+  }\n+\n+  public String getBody() {\n+    return body == null ? null : Ascii.truncate(body, 20000, \"...\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30a92de3743dfdadcadbb6e90a902ba4442d9d22"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5178ee7eb11a335cce37eb1c60f2d5fdc4e5ab79", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/5178ee7eb11a335cce37eb1c60f2d5fdc4e5ab79", "committedDate": "2020-05-05T17:24:47Z", "message": "Merge remote-tracking branch 'origin/master' into issue-upload-labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab7c27427fbbe3a1c4b34e260ecde6c638a13144", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/ab7c27427fbbe3a1c4b34e260ecde6c638a13144", "committedDate": "2020-05-05T17:27:01Z", "message": "Use constants for title and body limits and add documentation to them."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3558, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}