{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MTgxODE0", "number": 8143, "title": "Unify non-lowluck dice hit calculations", "bodyText": "Add getDiceHits to the TotalPowerAndTotalRolls interface. Given an array\nof integers (random dice rolls), it will return a list of Die with the\nrolled number and whether it was a hit or not.\n\nTesting\n\nRan both low luck, normal, and lhtr battles and checked that the dice were correctly shown and calculated.  Also ran a hard AI for a few battles.\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-11-10T03:29:47Z", "url": "https://github.com/triplea-game/triplea/pull/8143", "merged": true, "mergeCommit": {"oid": "2c91ef0a020ececf1ab5473d2e96465fadf31f4f"}, "closed": true, "closedAt": "2020-11-12T00:38:24Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbAnDlgH2gAyNTE4MTgxODE0OjgzMmMyM2I3NWIzYzc5ZTU5ODU0ZDFlZDIwYTljN2MwOGJkZmQ4N2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbnjiJAFqTUyODY1Mzg1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "committedDate": "2020-11-10T03:15:51Z", "message": "Unify non-lowluck dice hit calculations\n\nAdd getDiceHits to the TotalPowerAndTotalRolls interface. Given an array\nof integers (random dice rolls), it will return a list of Die with the\nrolled number and whether it was a hit or not."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODI2ODAy", "url": "https://github.com/triplea-game/triplea/pull/8143#pullrequestreview-526826802", "createdAt": "2020-11-10T03:30:34Z", "commit": {"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMzozMDozNFrOHwKYqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMzozMTozNlrOHwKZnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2Mzg0OA==", "bodyText": "This fixes a bug I introduced when I refactored this code.  I now have better tests around this.  This bug is in the pre-release so I didn't add any release notes for it.", "url": "https://github.com/triplea-game/triplea/pull/8143#discussion_r520263848", "createdAt": "2020-11-10T03:30:34Z", "author": {"login": "trevan"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AaPowerStrengthAndRolls.java", "diffHunk": "@@ -267,14 +268,15 @@ private void addUnits(final Collection<Unit> units) {\n         .flatMap(\n             unitPowerStrengthAndRolls -> {\n               final int strength = unitPowerStrengthAndRolls.getStrength();\n-              final int diceValue = diceQueue.removeFirst();\n               return IntStream.range(0, unitPowerStrengthAndRolls.getRolls())\n                   .mapToObj(\n-                      rollNumber ->\n-                          new Die(\n-                              diceValue,\n-                              strength,\n-                              diceValue < strength ? Die.DieType.HIT : Die.DieType.MISS));\n+                      rollNumber -> {\n+                        final int diceValue = diceQueue.removeFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2NDA5Mg==", "bodyText": "The previous code always made the first dice roll be the \"HIT\" roll and the other be \"IGNORED\".  The new code now keeps the dice rolls in order so this test had to be updated.", "url": "https://github.com/triplea-game/triplea/pull/8143#discussion_r520264092", "createdAt": "2020-11-10T03:31:36Z", "author": {"login": "trevan"}, "path": "game-core/src/test/java/games/strategy/triplea/delegate/DiceRollTest.java", "diffHunk": "@@ -1010,8 +1010,8 @@ void testHeavyBombersLhtr2() {\n                 .gameDiceSides(testDelegateBridge.getData().getDiceSides())\n                 .territoryEffects(TerritoryEffectHelper.getEffects(germany))\n                 .build());\n-    assertThat(dice.getRolls(4).get(0).getType(), is(Die.DieType.HIT));\n-    assertThat(dice.getRolls(4).get(1).getType(), is(Die.DieType.IGNORED));\n+    assertThat(dice.getRolls(4).get(0).getType(), is(Die.DieType.IGNORED));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjUzODUx", "url": "https://github.com/triplea-game/triplea/pull/8143#pullrequestreview-528653851", "createdAt": "2020-11-12T00:38:18Z", "commit": {"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3850, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}