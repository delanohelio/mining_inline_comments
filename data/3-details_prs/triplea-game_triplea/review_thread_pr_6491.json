{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODg5OTMy", "number": 6491, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowMzozOVrOD9pe0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyMzoyNlrOD99Yjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTY5MzYzOnYy", "diffSide": "LEFT", "path": "http-server/src/main/java/org/triplea/db/dao/moderator/ModeratorUserDaoData.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowMzozOVrOGXRA3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowMzozOVrOGXRA3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA0OTE4Mw==", "bodyText": "These two constants were left-over from previous cleanups, not used.", "url": "https://github.com/triplea-game/triplea/pull/6491#discussion_r427049183", "createdAt": "2020-05-19T06:03:39Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/db/dao/moderator/ModeratorUserDaoData.java", "diffHunk": "@@ -14,9 +14,6 @@\n @NoArgsConstructor\n @Getter\n public class ModeratorUserDaoData {\n-  public static final String USERNAME_COLUMN = \"username\";\n-  public static final String LAST_LOGIN_COLUMN = \"last_login\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc7ef96421fb7fc1210faa76ab7793100848bc5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTY5NTc5OnYy", "diffSide": "LEFT", "path": "http-server/src/main/java/org/triplea/db/dao/user/UserJdbiDao.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowNDo1MFrOGXRCQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowNDo1MFrOGXRCQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA0OTUzOQ==", "bodyText": "Nothing called this update method, it can be freely removed. It's a bug that we never invoked it. The fix here is a deeper one to get this same value from the access_log table rather than maintaining the last login in two places.", "url": "https://github.com/triplea-game/triplea/pull/6491#discussion_r427049539", "createdAt": "2020-05-19T06:04:50Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/db/dao/user/UserJdbiDao.java", "diffHunk": "@@ -15,9 +15,6 @@\n   @SqlQuery(\"select bcrypt_password from lobby_user where username = :username\")\n   Optional<String> getPassword(@Bind(\"username\") String username);\n \n-  @SqlUpdate(\"update lobby_user set last_login = now() where username = :username\")\n-  int updateLastLoginTime(@Bind(\"username\") String username);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc7ef96421fb7fc1210faa76ab7793100848bc5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTY5NzIzOnYy", "diffSide": "RIGHT", "path": "http-server/src/main/java/org/triplea/modules/user/account/login/AccessLogUpdater.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowNTozMVrOGXRDNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNjowNTozMVrOGXRDNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA0OTc4MQ==", "bodyText": "insertUserAccessRecord can now figure out on its own if a user is registered or not by selecting from the lobby_user table.", "url": "https://github.com/triplea-game/triplea/pull/6491#discussion_r427049781", "createdAt": "2020-05-19T06:05:31Z", "author": {"login": "DanVanAtta"}, "path": "http-server/src/main/java/org/triplea/modules/user/account/login/AccessLogUpdater.java", "diffHunk": "@@ -21,15 +21,10 @@ public static AccessLogUpdater build(final Jdbi jdbi) {\n   @Override\n   public void accept(final LoginRecord loginRecord) {\n     final int updateCount =\n-        loginRecord.isRegistered()\n-            ? accessLogDao.insertRegisteredUserRecord(\n-                loginRecord.getUserName().getValue(),\n-                loginRecord.getIp(),\n-                loginRecord.getSystemId().getValue())\n-            : accessLogDao.insertAnonymousUserRecord(\n-                loginRecord.getUserName().getValue(),\n-                loginRecord.getIp(),\n-                loginRecord.getSystemId().getValue());\n+        accessLogDao.insertUserAccessRecord(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc7ef96421fb7fc1210faa76ab7793100848bc5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2Mjk1NDM4OnYy", "diffSide": "RIGHT", "path": "lobby-db/sample_data.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyMzoyNlrOGXxPMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDo0NToxOFrOGX3frQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3NzEzNg==", "bodyText": "Why is this one null when it was true before?", "url": "https://github.com/triplea-game/triplea/pull/6491#discussion_r427577136", "createdAt": "2020-05-19T20:23:26Z", "author": {"login": "RoiEXLab"}, "path": "lobby-db/sample_data.sql", "diffHunk": "@@ -24,12 +24,12 @@ values (1000, 'test', 'email@email.com', (select id from user_role where name =\n        (1001, 'user1', 'email@email.com', (select id from user_role where name = 'PLAYER'),\n         '$2a$10$C4rHfjK/seKexc6KlyknP.oFVBZ7Wi.kp91qUQFgmkKajwgczXzcS');\n \n-insert into access_log(access_time, username, ip, system_id, registered)\n-values (now() - interval '1 days', 'user1', '1.1.1.1', 'system-id1', false),\n-       (now() - interval '2 days', 'user2', '1.1.1.2', 'system-id2', false),\n-       (now() - interval '3 days', 'user3', '1.1.1.3', 'system-id3', true),\n-       (now() - interval '4 days', 'user1', '1.1.1.2', 'system-id4', false),\n-       (now() - interval '5 days', 'user2', '1.1.1.4', 'system-id5', false);\n+insert into access_log(access_time, username, ip, system_id, lobby_user_id)\n+values (now() - interval '1 days', 'user1', '1.1.1.1', 'system-id1', null),\n+       (now() - interval '2 days', 'user2', '1.1.1.2', 'system-id2', null),\n+       (now() - interval '3 days', 'user3', '1.1.1.3', 'system-id3', null),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc7ef96421fb7fc1210faa76ab7793100848bc5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3OTY2MQ==", "bodyText": "The 'true' was to give a sampling of data, it was easy to do. Now it takes a bit more work to FK it to an existing user row. If you log in as a moderator, you will be registered, it will be recorded in the access log, so that will just as well give an example of a registered user logging in and how that looks in the access log tab.", "url": "https://github.com/triplea-game/triplea/pull/6491#discussion_r427679661", "createdAt": "2020-05-20T00:45:18Z", "author": {"login": "DanVanAtta"}, "path": "lobby-db/sample_data.sql", "diffHunk": "@@ -24,12 +24,12 @@ values (1000, 'test', 'email@email.com', (select id from user_role where name =\n        (1001, 'user1', 'email@email.com', (select id from user_role where name = 'PLAYER'),\n         '$2a$10$C4rHfjK/seKexc6KlyknP.oFVBZ7Wi.kp91qUQFgmkKajwgczXzcS');\n \n-insert into access_log(access_time, username, ip, system_id, registered)\n-values (now() - interval '1 days', 'user1', '1.1.1.1', 'system-id1', false),\n-       (now() - interval '2 days', 'user2', '1.1.1.2', 'system-id2', false),\n-       (now() - interval '3 days', 'user3', '1.1.1.3', 'system-id3', true),\n-       (now() - interval '4 days', 'user1', '1.1.1.2', 'system-id4', false),\n-       (now() - interval '5 days', 'user2', '1.1.1.4', 'system-id5', false);\n+insert into access_log(access_time, username, ip, system_id, lobby_user_id)\n+values (now() - interval '1 days', 'user1', '1.1.1.1', 'system-id1', null),\n+       (now() - interval '2 days', 'user2', '1.1.1.2', 'system-id2', null),\n+       (now() - interval '3 days', 'user3', '1.1.1.3', 'system-id3', null),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3NzEzNg=="}, "originalCommit": {"oid": "ebc7ef96421fb7fc1210faa76ab7793100848bc5"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2209, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}