{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzkwMjgz", "number": 7067, "title": "Add tests for UnitImageFactory#getBaseImageName", "bodyText": "This just adds tests around UnitImageFactory#getBaseImageName.  It also tests the scenario from #7060 where  isSuicide units don't need _ss images.\ngetBaseImageName was made public to not cause a conflict with #7064 when that merges.  That is the only change to non test code.\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix\n[] Other:   \nTesting\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-07-08T00:17:28Z", "url": "https://github.com/triplea-game/triplea/pull/7067", "merged": true, "mergeCommit": {"oid": "5f6dae6cff7c78aa1a48b41cf42ecdc56daf7719"}, "closed": true, "closedAt": "2020-07-11T04:02:36Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyvF2AgH2gAyNDQ1NzkwMjgzOjJmZGQ4MTc2OTM5NGQ1ZjA2YjYzZGNiMGZmOWJhZjdlYzA2MzU1Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczwJ2GgFqTQ0Njc3NTEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2fdd81769394d5f06b63dcb0ff9baf7ec0635567", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/2fdd81769394d5f06b63dcb0ff9baf7ec0635567", "committedDate": "2020-07-08T00:14:13Z", "message": "Add tests for UnitImageFactory#getBaseImageName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Nzc1MTAw", "url": "https://github.com/triplea-game/triplea/pull/7067#pullrequestreview-446775100", "createdAt": "2020-07-11T03:49:37Z", "commit": {"oid": "2fdd81769394d5f06b63dcb0ff9baf7ec0635567"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMzo0OTozN1rOGwKH6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNDowMDo0NVrOGwKLkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MDY5Ng==", "bodyText": "nit, it's a bit more conventional to do test set up and assertions as separate steps. EG:\ngiven  // establish state\n\nwhen   // do the action under state\n\nthen   // assert return value has expected value\n          // assert expected post-state\n\nThe pattern is \"arrange act assert\" (AAA): https://medium.com/@pjbgf/title-testing-code-ocd-and-the-aaa-pattern-df453975ab80\nSo in this case, having the 'assert' and the 'given' split would perhaps be more canonical.", "url": "https://github.com/triplea-game/triplea/pull/7067#discussion_r453150696", "createdAt": "2020-07-11T03:49:37Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/triplea/image/UnitImageFactoryTest.java", "diffHunk": "@@ -0,0 +1,393 @@\n+package games.strategy.triplea.image;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.when;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.MutableProperty;\n+import games.strategy.engine.data.TechnologyFrontier;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.engine.data.properties.GameProperties;\n+import games.strategy.triplea.Constants;\n+import games.strategy.triplea.attachments.TechAttachment;\n+import games.strategy.triplea.attachments.UnitAttachment;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+@ExtendWith(MockitoExtension.class)\n+class UnitImageFactoryTest {\n+  @Mock GameData gameData;\n+\n+  @Nested\n+  class GetBaseImageName {\n+\n+    @BeforeEach\n+    void setupGameData() {\n+      final TechnologyFrontier technologyFrontier = new TechnologyFrontier(\"Tech\", gameData);\n+      when(gameData.getTechnologyFrontier()).thenReturn(technologyFrontier);\n+      lenient().when(gameData.getDiceSides()).thenReturn(6);\n+      final GameProperties gameProperties = new GameProperties(gameData);\n+      lenient().when(gameData.getProperties()).thenReturn(gameProperties);\n+    }\n+\n+    @Test\n+    void basicUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasSuffix(List.of(), List.of(), \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdd81769394d5f06b63dcb0ff9baf7ec0635567"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MDkwNA==", "bodyText": "Any thoughts to extract '_hit' (and other magic suffixes) to a constant?\nIf we were to use a constant, and we were for example to change the suffix or otherwise, then the tests would automatically be updated. Keeping test maintenance and coupling to production code low is a good thing. One can get into a case where small changes results in many test changes (while having tests is better than none,  keeping them maintainable helps avoid at least that secondary trap).", "url": "https://github.com/triplea-game/triplea/pull/7067#discussion_r453150904", "createdAt": "2020-07-11T03:51:48Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/triplea/image/UnitImageFactoryTest.java", "diffHunk": "@@ -0,0 +1,393 @@\n+package games.strategy.triplea.image;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.when;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.MutableProperty;\n+import games.strategy.engine.data.TechnologyFrontier;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.engine.data.properties.GameProperties;\n+import games.strategy.triplea.Constants;\n+import games.strategy.triplea.attachments.TechAttachment;\n+import games.strategy.triplea.attachments.UnitAttachment;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+@ExtendWith(MockitoExtension.class)\n+class UnitImageFactoryTest {\n+  @Mock GameData gameData;\n+\n+  @Nested\n+  class GetBaseImageName {\n+\n+    @BeforeEach\n+    void setupGameData() {\n+      final TechnologyFrontier technologyFrontier = new TechnologyFrontier(\"Tech\", gameData);\n+      when(gameData.getTechnologyFrontier()).thenReturn(technologyFrontier);\n+      lenient().when(gameData.getDiceSides()).thenReturn(6);\n+      final GameProperties gameProperties = new GameProperties(gameData);\n+      lenient().when(gameData.getProperties()).thenReturn(gameProperties);\n+    }\n+\n+    @Test\n+    void basicUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasSuffix(List.of(), List.of(), \"\");\n+    }\n+\n+    @Test\n+    void basicDamagedUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasName(\n+          \"infantry\", List.of(), List.of(), true, false, \"infantry_hit\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdd81769394d5f06b63dcb0ff9baf7ec0635567"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MTYzNA==", "bodyText": "Boolean parameters can be difficult to understand. Overloaded methods or a parameter object can help clarify this.\nFor example, with a parameter object, we could have something like:\n\n\ngivenTestSetup(SetupParameters.builder()\n       .unitTypeName(\"infantry\")\n        .unitAttachmentProperties(List.of())\n        .techAttachmentProperties(List.of())\n        .damaged(false)\n        .disabled(true))\n   .build());\n\nfinal String imageName =\n          UnitImageFactory.getBaseImageName(unitType, player, damaged, disabled);\n\nassertThat(imageName, is(\"infantry_disabled\");\n\nThe above refactor of course does not work since we need direct parameters.. This indicates a production code change to accept a parameter object is perhaps all we need and then the testing becomes drastically simplified.\nTo get there, you can create a method overload that accepts the parameter object and then invokes the original method. Then you can invoke the method overload from test. Once you have the test in place, it's a question of migrating the rest of the production code to use the better API.\nEG:\nfinal String imageName =\n          UnitImageFactory.getBaseImageName(  ImageNameParameters.builder()\n                .unitTypeName(\"infantry\")\n                .unitAttachmentProperties(List.of())\n                .techAttachmentProperties(List.of())\n                .damaged(false)\n                .disabled(true))\n   .build());\n\nassertThat(imageName, is(\"infantry_disabled\");\n\nFrom here, test parameterization could help and the API's would be straight forward. EG:\n@ParameterizedTest\n@MethodSource\nvoid verifyBaseImageName(ImageNameParameters. parameters, String expectedName) {\nfinal String imageName =\nUnitImageFactory.getBaseImageName(parameters);\n assertThat(imageName, is(expectedName);\n\n}\n\n\nThoughts @trevan ?", "url": "https://github.com/triplea-game/triplea/pull/7067#discussion_r453151634", "createdAt": "2020-07-11T04:00:45Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/triplea/image/UnitImageFactoryTest.java", "diffHunk": "@@ -0,0 +1,393 @@\n+package games.strategy.triplea.image;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.when;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.MutableProperty;\n+import games.strategy.engine.data.TechnologyFrontier;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.engine.data.properties.GameProperties;\n+import games.strategy.triplea.Constants;\n+import games.strategy.triplea.attachments.TechAttachment;\n+import games.strategy.triplea.attachments.UnitAttachment;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+@ExtendWith(MockitoExtension.class)\n+class UnitImageFactoryTest {\n+  @Mock GameData gameData;\n+\n+  @Nested\n+  class GetBaseImageName {\n+\n+    @BeforeEach\n+    void setupGameData() {\n+      final TechnologyFrontier technologyFrontier = new TechnologyFrontier(\"Tech\", gameData);\n+      when(gameData.getTechnologyFrontier()).thenReturn(technologyFrontier);\n+      lenient().when(gameData.getDiceSides()).thenReturn(6);\n+      final GameProperties gameProperties = new GameProperties(gameData);\n+      lenient().when(gameData.getProperties()).thenReturn(gameProperties);\n+    }\n+\n+    @Test\n+    void basicUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasSuffix(List.of(), List.of(), \"\");\n+    }\n+\n+    @Test\n+    void basicDamagedUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasName(\n+          \"infantry\", List.of(), List.of(), true, false, \"infantry_hit\");\n+    }\n+\n+    @Test\n+    void basicDisabledUnitType() throws MutableProperty.InvalidValueException {\n+      givenUnitTypeAndTechnologyAssertThatImageHasName(\n+          \"infantry\", List.of(), List.of(), false, true, \"infantry_disabled\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdd81769394d5f06b63dcb0ff9baf7ec0635567"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3192, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}