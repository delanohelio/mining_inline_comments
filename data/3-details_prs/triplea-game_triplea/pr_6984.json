{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNTI1OTAw", "number": 6984, "title": "De dupe error uploads & Add Map Name to Error Uploads", "bodyText": "Commits\ncommit 6af5f46\nDe-Dupe Error Report Uploads\n\nPrevent redundant error message uploads by first checking\nwith the server if an error report already exists.\nIf the error report exists, then we will show a prompt\nto the user and give them a link to the existing error report.\n\nChange Summary:\n- Add columns in error report history table to track the\n  title of the error report, reporting game version,\n  and the issue link that was created.\n- Add APIs to error reporting DAO to get the link of\n  an existing error report by title and game version.\n- Add server API to check if an error report exists\n- Update client so that after clicking 'upload error report',\n  we first query the server if an error report exists.\n  If one exists, we show the link to the user, othewise\n  we show the user the upload form.\n\nNote: we use both title and game version for de-duplication.\n  This may lead to some duplication as version number\n  changes, but in case we do not fix a problem or if\n  the title matches but is actually different in a different\n  version we will allow the error report upload.\n\ncommit 8ed128a\nAdd field to error report upload for map name\n\ncommit e9da7eb\nDo not print Exception in its own block (redundant)\n\nException is always at the head of the stack trace which\nwe already print in the issue body. This update removes\nthe redundant 'exception' block.\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix\n[] Other:   \nTesting\nAdd an explicit throw exception at the end of gameRunner launch to test out against a local server. Created an error report and then reported and verified that there was a de-dupe message.\n\nScreens Shots\nDe-Dupe Sequence\nExisting screen prompt to upload:\n\nClicking upload, get the de-dupe message:\n\nNew Map Name Field\nNotice at the bottom of the dialog there is a 'map name' field:\n\nNotice in the preview there is a 'map name' section:\n\nAdditional Notes to Reviewer\n\nRelease Note\n\nUPDATE|Error uploads will now recognize duplicates and give you a link to an existing error upload if there is one. Added 'map-name' as an error upload field", "createdAt": "2020-07-01T08:19:07Z", "url": "https://github.com/triplea-game/triplea/pull/6984", "merged": true, "mergeCommit": {"oid": "5bdb976931bd38d7da8eb5f36f26fe0f6395b486"}, "closed": true, "closedAt": "2020-07-01T23:38:53Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwlUdggH2gAyNDQyNTI1OTAwOjZhZjVmNDYwOTJmMjQ3Zjk2NzdjZjg3OTA3M2Y4ZTgzYzBiNTg5MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwx4ELAFqTQ0MTIyNTIzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6af5f46092f247f9677cf879073f8e83c0b58919", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/6af5f46092f247f9677cf879073f8e83c0b58919", "committedDate": "2020-07-01T07:43:17Z", "message": "De-Dupe Error Report Uploads\n\nPrevent redundant error message uploads by first checking\nwith the server if an error report already exists.\nIf the error report exists, then we will show a prompt\nto the user and give them a link to the existing error report.\n\nChange Summary:\n- Add columns in error report history table to track the\n  title of the error report, reporting game version,\n  and the issue link that was created.\n- Add APIs to error reporting DAO to get the link of\n  an existing error report by title and game version.\n- Add server API to check if an error report exists\n- Update client so that after clicking 'upload error report',\n  we first query the server if an error report exists.\n  If one exists, we show the link to the user, othewise\n  we show the user the upload form.\n\nNote: we use both title and game version for de-duplication.\n  This may lead to some duplication as version number\n  changes, but in case we do not fix a problem or if\n  the title matches but is actually different in a different\n  version we will allow the error report upload."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ed128a76e98949e7e5b0e438fb43d2da6a5bc0f", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8ed128a76e98949e7e5b0e438fb43d2da6a5bc0f", "committedDate": "2020-07-01T08:13:33Z", "message": "Add field to error report upload for map name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "committedDate": "2020-07-01T08:29:50Z", "message": "Do not print Exception in its own block (redundant)\n\nException is always at the head of the stack trace which\nwe already print in the issue body. This update removes\nthe redundant 'exception' block."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjI1MjM4", "url": "https://github.com/triplea-game/triplea/pull/6984#pullrequestreview-441225238", "createdAt": "2020-07-01T22:03:13Z", "commit": {"oid": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjowMzoxM1rOGr2ydA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjoyMDo1N1rOGr3Khw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzOTYwNA==", "bodyText": "Something worth considering:\nAs we all know the report body is truncated at X characters. This means that the trailing \\n```\\n\\n will be cut off if the stacktrace is too long.\nPerhaps we want to truncate the stracktrace so we don't ever hit the other limit", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448639604", "createdAt": "2020-07-01T22:03:13Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/org/triplea/debug/error/reporting/StackTraceErrorReportFormatter.java", "diffHunk": "@@ -158,11 +170,6 @@ private static String throwableToString(final Throwable e) {\n     try (PrintWriter printWriter = new PrintWriter(outputStream, false, StandardCharsets.UTF_8)) {\n       e.printStackTrace(printWriter);\n     }\n-    return \"## Exception \\n\"\n-        + e.getClass().getName()\n-        + Optional.ofNullable(e.getMessage()).map(msg -> \": \" + msg).orElse(\"\")\n-        + \"\\n\\n## Stack Trace\\n```\\n\"\n-        + outputStream.toString(StandardCharsets.UTF_8)\n-        + \"\\n```\\n\\n\";\n+    return \"## Stack Trace\\n```\\n\" + outputStream.toString(StandardCharsets.UTF_8) + \"\\n```\\n\\n\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NTc2Nw==", "bodyText": "I wonder if a check for equality is the right move here.\nIf we fix an issue, but people are still using an unpatched version, they shouldn't be able to create an issue IMO.\nThoughts?", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448645767", "createdAt": "2020-07-01T22:20:57Z", "author": {"login": "RoiEXLab"}, "path": "http-server/src/main/java/org/triplea/db/dao/error/reporting/ErrorReportingDao.java", "diffHunk": "@@ -23,4 +26,12 @@\n    */\n   @SqlUpdate(\"delete from error_report_history where date_created < :purgeSinceDate\")\n   void purgeOld(@Bind(\"purgeSinceDate\") Instant purgeSinceDate);\n+\n+  @SqlQuery(\n+      \"select created_issue_link\"\n+          + \"  from error_report_history\"\n+          + \"  where report_title = :reportTitle \"\n+          + \"    and game_version = :gameVersion\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3321, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}