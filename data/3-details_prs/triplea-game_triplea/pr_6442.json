{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTE4Nzc2", "number": 6442, "title": "Extract support logic from DiceRoll to a dedicated class.", "bodyText": "Simple move code\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:", "createdAt": "2020-05-09T05:22:48Z", "url": "https://github.com/triplea-game/triplea/pull/6442", "merged": true, "mergeCommit": {"oid": "e2f4f91532205d60da00e30ae26ca7b742261a63"}, "closed": true, "closedAt": "2020-05-09T22:34:29Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcffcDbAH2gAyNDE1NTE4Nzc2OjNkZTIxMTE5NmVmNjcyYWU0ODI2ZGNkNzlmOWY4MmQzYWIwMjY2MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfuTJigFqTQwODY4OTA5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3de211196ef672ae4826dcd79f9f82d3ab02660a", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/3de211196ef672ae4826dcd79f9f82d3ab02660a", "committedDate": "2020-05-09T05:15:26Z", "message": "Extract support logic from DiceRoll to a dedicated class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjE0MTk4", "url": "https://github.com/triplea-game/triplea/pull/6442#pullrequestreview-408614198", "createdAt": "2020-05-09T05:26:32Z", "commit": {"oid": "3de211196ef672ae4826dcd79f9f82d3ab02660a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNToyNjozMlrOGS4mvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNToyNjozMlrOGS4mvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ1NDk3Mw==", "bodyText": "Method getSupport has 58 lines of code (exceeds 30 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/6442#discussion_r422454973", "createdAt": "2020-05-09T05:26:32Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AvailableSupportCalculator.java", "diffHunk": "@@ -0,0 +1,131 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.Unit;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.triplea.attachments.UnitSupportAttachment;\n+import games.strategy.triplea.delegate.Matches;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+import org.triplea.java.collections.CollectionUtils;\n+import org.triplea.java.collections.IntegerMap;\n+\n+@UtilityClass\n+public class AvailableSupportCalculator {\n+  public static SupportCalculationResult getSortedAaSupport(\n+      final Collection<Unit> unitsGivingTheSupport,\n+      final GameData data,\n+      final boolean defence,\n+      final boolean allies) {\n+    final Set<UnitSupportAttachment> rules =\n+        UnitSupportAttachment.get(data)\n+            .parallelStream()\n+            .filter(usa -> (usa.getAaRoll() || usa.getAaStrength()))\n+            .collect(Collectors.toSet());\n+    return getSortedSupport(unitsGivingTheSupport, rules, defence, allies);\n+  }\n+\n+  /** Sorts 'supportsAvailable' lists based on unit support attachment rules. */\n+  public static SupportCalculationResult getSortedSupport(\n+      final Collection<Unit> unitsGivingTheSupport,\n+      final Set<UnitSupportAttachment> rules,\n+      final boolean defence,\n+      final boolean allies) {\n+    final SupportCalculationResult supportCalculationResult =\n+        getSupport(unitsGivingTheSupport, rules, defence, allies);\n+\n+    final SupportRuleSort supportRuleSort =\n+        SupportRuleSort.builder()\n+            .defense(defence)\n+            .friendly(allies)\n+            .roll(UnitSupportAttachment::getRoll)\n+            .strength(UnitSupportAttachment::getStrength)\n+            .build();\n+    supportCalculationResult\n+        .getSupportRules()\n+        .forEach(unitSupportAttachment -> unitSupportAttachment.sort(supportRuleSort));\n+    return supportCalculationResult;\n+  }\n+\n+  /**\n+   * Returns a calculation with support possibly given by these units.\n+   *\n+   * @param defence are the receiving units defending?\n+   * @param allies are the receiving units allied to the giving units?\n+   */\n+  public static SupportCalculationResult getSupport(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3de211196ef672ae4826dcd79f9f82d3ab02660a"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ1NDk3NA==", "bodyText": "Method getSupport has a Cognitive Complexity of 26 (exceeds 7 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/6442#discussion_r422454974", "createdAt": "2020-05-09T05:26:32Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AvailableSupportCalculator.java", "diffHunk": "@@ -0,0 +1,131 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.Unit;\n+import games.strategy.engine.data.UnitType;\n+import games.strategy.triplea.attachments.UnitSupportAttachment;\n+import games.strategy.triplea.delegate.Matches;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+import lombok.experimental.UtilityClass;\n+import org.triplea.java.collections.CollectionUtils;\n+import org.triplea.java.collections.IntegerMap;\n+\n+@UtilityClass\n+public class AvailableSupportCalculator {\n+  public static SupportCalculationResult getSortedAaSupport(\n+      final Collection<Unit> unitsGivingTheSupport,\n+      final GameData data,\n+      final boolean defence,\n+      final boolean allies) {\n+    final Set<UnitSupportAttachment> rules =\n+        UnitSupportAttachment.get(data)\n+            .parallelStream()\n+            .filter(usa -> (usa.getAaRoll() || usa.getAaStrength()))\n+            .collect(Collectors.toSet());\n+    return getSortedSupport(unitsGivingTheSupport, rules, defence, allies);\n+  }\n+\n+  /** Sorts 'supportsAvailable' lists based on unit support attachment rules. */\n+  public static SupportCalculationResult getSortedSupport(\n+      final Collection<Unit> unitsGivingTheSupport,\n+      final Set<UnitSupportAttachment> rules,\n+      final boolean defence,\n+      final boolean allies) {\n+    final SupportCalculationResult supportCalculationResult =\n+        getSupport(unitsGivingTheSupport, rules, defence, allies);\n+\n+    final SupportRuleSort supportRuleSort =\n+        SupportRuleSort.builder()\n+            .defense(defence)\n+            .friendly(allies)\n+            .roll(UnitSupportAttachment::getRoll)\n+            .strength(UnitSupportAttachment::getStrength)\n+            .build();\n+    supportCalculationResult\n+        .getSupportRules()\n+        .forEach(unitSupportAttachment -> unitSupportAttachment.sort(supportRuleSort));\n+    return supportCalculationResult;\n+  }\n+\n+  /**\n+   * Returns a calculation with support possibly given by these units.\n+   *\n+   * @param defence are the receiving units defending?\n+   * @param allies are the receiving units allied to the giving units?\n+   */\n+  public static SupportCalculationResult getSupport(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3de211196ef672ae4826dcd79f9f82d3ab02660a"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg5MDk3", "url": "https://github.com/triplea-game/triplea/pull/6442#pullrequestreview-408689097", "createdAt": "2020-05-09T22:34:17Z", "commit": {"oid": "3de211196ef672ae4826dcd79f9f82d3ab02660a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3412, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}