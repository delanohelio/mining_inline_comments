{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzODMwNzQ2", "number": 6409, "title": "Add right click menu for moderators to view game chat history", "bodyText": "Enables a 'show chat history\" option for moderators to view the chat\nhistory of any lobby game.\nChange summary:\n\nadd moderator right click option\nadd client side module to query lobby for chat history of a game id\nand display results in a pop-up in a text area box\nadd http client call to fetch game chat history\nadd moderator only http server endpoint to fetch game chat history\nadd http server chat history module to request chat history\nfrom DB and marshall into a response object\nadds a game chat history DAO to query game chat history table.\n\nOf note:\n\nchanged indices on lobby_game table to match expected query pattern\nchanged types of date columns that did not have timezones. Testing\nrevealed that timestamps returned from those tables were in local\ntime, these were all changed to be 'timestamptz' to keep all times\nin UTC (the only non-UTC times should be when we are displaying a\nlast-mile date value to a user, otherwise we want all UTC or epoch\nmillis everywhere else).\n\n\nFunctional Changes\n\n[] New map or map update\n[x] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nmanual verified UI on a local lobby\n\n\n\nScreens Shots", "createdAt": "2020-05-06T01:20:44Z", "url": "https://github.com/triplea-game/triplea/pull/6409", "merged": true, "mergeCommit": {"oid": "853cdd8c26c98c3f290b34c7929a16fa8dec510f"}, "closed": true, "closedAt": "2020-05-07T22:21:53Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceeREEAH2gAyNDEzODMwNzQ2OjkxNDJiMWU4MmIxMDlmMjg4Y2Q1MTgzNDdiNjI3OTZmMTBjNjYyMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfE61WgFqTQwNzg3NzI2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9142b1e82b109f288cd518347b62796f10c66236", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/9142b1e82b109f288cd518347b62796f10c66236", "committedDate": "2020-05-06T01:19:36Z", "message": "Add right click menu for moderators to view game chat history\n\nEnables a 'show chat history\" option for moderators to view the chat\nhistory of any lobby game.\n\nChange summary:\n- add moderator right click option\n- add client side module to query lobby for chat history of a game id\n  and display results in a pop-up in a text area box\n- add http client call to fetch game chat history\n- add moderator only http server endpoint to fetch game chat history\n- add http server chat history module to request chat history\n  from DB and marshall into a response object\n- adds a game chat history DAO to query game chat history table.\n\nOf note:\n- changed indices on lobby_game table to match expected query pattern\n- changed types of date columns that did not have timezones. Testing\n  revealed that timestamps returned from those tables were in local\n  time, these were all changed to be 'timestamptz' to keep all times\n  in UTC (the only non-UTC times should be when we are displaying a\n  last-mile date value to a user, otherwise we want all UTC or epoch\n  millis everywhere else)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3ODc3MjYw", "url": "https://github.com/triplea-game/triplea/pull/6409#pullrequestreview-407877260", "createdAt": "2020-05-07T22:20:17Z", "commit": {"oid": "9142b1e82b109f288cd518347b62796f10c66236"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMjoyMDoxN1rOGSSUpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMjoyMDoxN1rOGSSUpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgyNzc1MA==", "bodyText": "Are old chat messages ever deleted?\nIf not I'm concerned that we'll run out of disk space very quickly \ud83e\udd14", "url": "https://github.com/triplea-game/triplea/pull/6409#discussion_r421827750", "createdAt": "2020-05-07T22:20:17Z", "author": {"login": "RoiEXLab"}, "path": "http-server/src/main/java/org/triplea/db/dao/moderator/chat/history/GameChatHistoryDao.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.triplea.db.dao.moderator.chat.history;\n+\n+import java.util.List;\n+import org.jdbi.v3.sqlobject.customizer.Bind;\n+import org.jdbi.v3.sqlobject.statement.SqlQuery;\n+\n+/**\n+ * DAO to access history of in-game chat messages stored in database. Chat messages are stored for\n+ * all lobby-connected games.\n+ */\n+public interface GameChatHistoryDao {\n+\n+  @SqlQuery(\n+      \"select \"\n+          + \"    gch.date,\"\n+          + \"    gch.username,\"\n+          + \"    gch.message\"\n+          + \"  from game_chat_history gch\"\n+          + \"  join lobby_game lg on lg.id = gch.lobby_game_id\"\n+          + \"  where\"\n+          + \"    lg.game_id = :gameId\"\n+          + \"    and date > (now() - '6 hour'::interval)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9142b1e82b109f288cd518347b62796f10c66236"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3394, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}