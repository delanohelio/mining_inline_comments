{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5Mzk4NDAy", "number": 5980, "title": "Add username and password fields to PBF selection screen", "bodyText": "The two fields are required in order to do a test posting or\nto start a PBF game. This update places the two required fields\non the same screen where we have the 'play' button.\nThis update adds similar 'highlight field label red if invalid'\nfor the username and password field.\nOf note, to avoid circular event callbacks between view and\nview-model, the view updates its own state after firing an\nevent on the view-model. For example, the username field\nsets the view-model username value, the view then queries\nand updates to see if any labels or buttons are updated and\nenabled. The view model could invoke the view to update all\nfields, this can then trigger another callback though to the\nview when fields are updated and action listeners fire to\nupdate the view model which can then again trigger a view\nrefresh and so-on.\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[x] Manual testing done\nVerified:\n\nfields are updated when selecting forum option\nplay button is enabled/disabled when setting/unsetting fields\nview forum button works for both forum types and is enabled/disabled\ntest post button is enabled/disabled as username/password/topic fields are all set/unset\n\n\n\nScreens Shots\nBefore\n\nAfter", "createdAt": "2020-02-25T06:52:18Z", "url": "https://github.com/triplea-game/triplea/pull/5980", "merged": true, "mergeCommit": {"oid": "71c879bb436ae30d45e15bcbe95f657abf356c13"}, "closed": true, "closedAt": "2020-02-27T07:31:24Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHsYZCgH2gAyMzc5Mzk4NDAyOjRjNDc5NzhhYTA3N2FjMWUyNmZmMDE0ZTY3NzIwMjY3OWFlZjJlNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIWNupgFqTM2NTQ2MTQ3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c47978aa077ac1e26ff014e677202679aef2e63", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/4c47978aa077ac1e26ff014e677202679aef2e63", "committedDate": "2020-02-25T06:46:01Z", "message": "Add username and password fields to PBF selection screen\n\nThe two fields are required in order to do a test posting or\nto start a PBF game. This update places the two required fields\non the same screen where we have the 'play' button.\n\nThis update adds similar 'highlight field label red if invalid'\nfor the username and password field.\n\nOf note, to avoid circular event callbacks between view and\nview-model, the view updates its own state after firing an\nevent on the view-model. For example, the username field\nsets the view-model username value, the view then queries\nand updates to see if any labels or buttons are updated and\nenabled. The view model could invoke the view to update all\nfields, this can then trigger another callback though to the\nview when fields are updated and action listeners fire to\nupdate the view model which can then again trigger a view\nrefresh and so-on."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mjk4NTYx", "url": "https://github.com/triplea-game/triplea/pull/5980#pullrequestreview-365298561", "createdAt": "2020-02-26T22:41:57Z", "commit": {"oid": "4c47978aa077ac1e26ff014e677202679aef2e63"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjo0MTo1OFrOFu_FHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjo0OTo1M1rOFu_RuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxMjMxOQ==", "bodyText": "Just noticed this: It should be easily removable now that guava's Predicates#not can be replaced with Predicate#not from the standard library", "url": "https://github.com/triplea-game/triplea/pull/5980#discussion_r384812319", "createdAt": "2020-02-26T22:41:58Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/posted/game/pbf/ForumPosterEditorViewModel.java", "diffHunk": "@@ -48,6 +48,28 @@\n     populateFromGameProperties(properties);\n   }\n \n+  void setForumPassword(final char[] password) {\n+    final ClientSetting<char[]> passwordSetting =\n+        forumSelection.equals(NodeBbForumPoster.TRIPLEA_FORUM_DISPLAY_NAME)\n+            ? ClientSetting.tripleaForumPassword\n+            : ClientSetting.aaForumPassword;\n+\n+    passwordSetting.setValueAndFlush(password);\n+    forumPassword = password;\n+    readyCallback.run();\n+  }\n+\n+  void setForumUsername(final String username) {\n+    final ClientSetting<char[]> usernameSetting =\n+        forumSelection.equals(NodeBbForumPoster.TRIPLEA_FORUM_DISPLAY_NAME)\n+            ? ClientSetting.tripleaForumUsername\n+            : ClientSetting.aaForumUsername;\n+\n+    usernameSetting.setValueAndFlush(username.toCharArray());\n+    forumUsername = username;\n+    readyCallback.run();\n+  }\n+\n   @SuppressWarnings(\"Guava\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c47978aa077ac1e26ff014e677202679aef2e63"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxMzIxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ? ClientSetting.tripleaForumPassword.getValue().orElse(new char[] {})\n          \n          \n            \n                        : ClientSetting.aaForumPassword.getValue().orElse(new char[] {});\n          \n          \n            \n                        ? ClientSetting.tripleaForumPassword.getValue().orElse(new char[0])\n          \n          \n            \n                        : ClientSetting.aaForumPassword.getValue().orElse(new char[0]);", "url": "https://github.com/triplea-game/triplea/pull/5980#discussion_r384813217", "createdAt": "2020-02-26T22:44:12Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/posted/game/pbf/ForumPosterEditorViewModel.java", "diffHunk": "@@ -60,8 +82,14 @@ synchronized void setForumSelection(final String forumSelection) {\n         \"Forum selection is driven by a drop-down to ensure user can never set it to null, \"\n             + \"if setting to null from a game properties, we default to the first available \"\n             + \"selection entry, forum selection should never be null or empty.\");\n-    viewForumPostButtonEnabled = areFieldsValid();\n-    testForumPostButtonEnabled = areFieldsValid();\n+    forumUsername =\n+        this.forumSelection.equals(NodeBbForumPoster.TRIPLEA_FORUM_DISPLAY_NAME)\n+            ? ClientSetting.tripleaForumUsername.getValue().map(String::valueOf).orElse(\"\")\n+            : ClientSetting.aaForumUsername.getValue().map(String::valueOf).orElse(\"\");\n+    forumPassword =\n+        this.forumSelection.equals(NodeBbForumPoster.TRIPLEA_FORUM_DISPLAY_NAME)\n+            ? ClientSetting.tripleaForumPassword.getValue().orElse(new char[] {})\n+            : ClientSetting.aaForumPassword.getValue().orElse(new char[] {});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c47978aa077ac1e26ff014e677202679aef2e63"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxNTU0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Arguments.of(\"1\", \"\", new char[] {}));\n          \n          \n            \n                    Arguments.of(\"1\", \"\", new char[0]));\n          \n      \n    \n    \n  \n\nBut in this scenario I would be ok with keeping the initializer curly braces because of consistency", "url": "https://github.com/triplea-game/triplea/pull/5980#discussion_r384815544", "createdAt": "2020-02-26T22:49:53Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/games/strategy/engine/framework/startup/ui/posted/game/pbf/ForumPosterEditorViewModelTest.java", "diffHunk": "@@ -129,45 +131,49 @@ void viewForumPostNoOpOnInvalidData(final String forumSelection, final String to\n   }\n \n   private ForumPosterEditorViewModel givenViewModelWithInvalidFieldSettings(\n-      final String forumSelection, final String topicId) {\n+      final String topicId, final String username, final char[] password) {\n     final ForumPosterEditorViewModel viewModel = new ForumPosterEditorViewModel(() -> {});\n-    viewModel.setForumSelection(forumSelection);\n     viewModel.setTopicId(topicId);\n-    Preconditions.checkState(\n-        !viewModel.isTopicIdValid(), \"Test makes sense only if topic id is invalid\");\n+    viewModel.setForumUsername(username);\n+    viewModel.setForumPassword(password);\n     return viewModel;\n   }\n \n   @SuppressWarnings(\"unused\")\n   private static List<Arguments> invalidForumSettings() {\n     return List.of(\n-        Arguments.of(\"forumSelection\", \"not a number\"),\n-        Arguments.of(\"forumSelection\", \"\"),\n-        Arguments.of(\"forumSelection\", \"0.0\"),\n-        Arguments.of(\"forumSelection\", \"0\"),\n-        Arguments.of(\"forumSelection\", \"-1\"));\n+        // invalid topic IDs\n+        Arguments.of(\"not a number\", \"user\", new char[] {'a'}),\n+        Arguments.of(\"\", \"user\", new char[] {'a'}),\n+        Arguments.of(\"0.0\", \"user\", new char[] {'a'}),\n+        Arguments.of(\"0\", \"user\", new char[] {'a'}),\n+        Arguments.of(\"-1\", \"user\", new char[] {'a'}),\n+        // missing user\n+        Arguments.of(\"1\", \"\", new char[] {'a'}),\n+        // missing password\n+        Arguments.of(\"1\", \"\", new char[] {}));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c47978aa077ac1e26ff014e677202679aef2e63"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "668a0dfd1ff1e93caaa44d21c2a1c39932ee72b1", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/668a0dfd1ff1e93caaa44d21c2a1c39932ee72b1", "committedDate": "2020-02-27T03:50:11Z", "message": "Use non-guava for predicate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7281536d833aa5e07881c8e3dd618cd4be2fd794", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/7281536d833aa5e07881c8e3dd618cd4be2fd794", "committedDate": "2020-02-27T04:13:01Z", "message": "Update game-core/src/main/java/games/strategy/engine/framework/startup/ui/posted/game/pbf/ForumPosterEditorViewModel.java\n\nCo-Authored-By: RoiEX <8350879+RoiEXLab@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDYxNDc3", "url": "https://github.com/triplea-game/triplea/pull/5980#pullrequestreview-365461477", "createdAt": "2020-02-27T07:30:23Z", "commit": {"oid": "7281536d833aa5e07881c8e3dd618cd4be2fd794"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3697, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}