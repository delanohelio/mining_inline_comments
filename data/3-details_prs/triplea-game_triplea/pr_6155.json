{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMDkyODY2", "number": 6155, "title": "Hide units to place collapsible panel during placement", "bodyText": "Summary\n\nChanges place panel to be rendered as it was in 1.9\nUpdates placement collapsible panel to show placement unit count\nRemoves \"None\" label from collapsible panel when zero units are purchased\nSwaps location of the unit scroller with placements collapsible panel\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nplay tested on napoleon\n\nplayed through a couple players turns\n\n\nplay tested on revised\n\n\n\nScreens Shots", "createdAt": "2020-04-07T07:35:27Z", "url": "https://github.com/triplea-game/triplea/pull/6155", "merged": true, "mergeCommit": {"oid": "ad70991748ff0bddfa26d56e51fd1c7372ec275f"}, "closed": true, "closedAt": "2020-04-07T21:29:21Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVOS_FAFqTM4ODg1NzgyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVTkCXgFqTM4OTEzMDkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODU3ODI4", "url": "https://github.com/triplea-game/triplea/pull/6155#pullrequestreview-388857828", "createdAt": "2020-04-07T07:37:54Z", "commit": {"oid": "42674629a3124f8d2aad365e1ab81eacd2de5ad2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzozNzo1NFrOGB2xkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzozNzo1NFrOGB2xlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU5OTE4NQ==", "bodyText": "Method stepIsAfterPurchaseAndBeforePlacement has a Cognitive Complexity of 6 (exceeds 5 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/6155#discussion_r404599185", "createdAt": "2020-04-07T07:37:54Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/PlacementUnitsCollapsiblePanel.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package games.strategy.triplea.ui;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GameDataEvent;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.GameStep;\n+import games.strategy.triplea.util.UnitSeparator;\n+import javax.swing.SwingUtilities;\n+import lombok.Getter;\n+import org.triplea.swing.CollapsiblePanel;\n+\n+class PlacementUnitsCollapsiblePanel {\n+  private final SimpleUnitPanel unitsToPlacePanel;\n+\n+  @Getter private final CollapsiblePanel panel;\n+  private final GameData gameData;\n+\n+  PlacementUnitsCollapsiblePanel(final GameData gameData, final UiContext uiContext) {\n+    this.gameData = gameData;\n+    unitsToPlacePanel =\n+        new SimpleUnitPanel(\n+            uiContext, SimpleUnitPanel.Style.SMALL_ICONS_WRAPPED_WITH_LABEL_WHEN_EMPTY);\n+    panel = new CollapsiblePanel(unitsToPlacePanel, \"\");\n+    panel.setVisible(false);\n+    gameData.addGameDataEventListener(GameDataEvent.GAME_STEP_CHANGED, this::updateStep);\n+  }\n+\n+  private void updateStep() {\n+    final GameStep step = gameData.getSequence().getStep();\n+\n+    SwingUtilities.invokeLater(\n+        () -> {\n+          if (GameStep.isPlaceStep(step.getName()) || isInitializationStep(step)) {\n+            panel.setVisible(false);\n+            return;\n+          }\n+\n+          final boolean hasUnitsToPlace = !step.getPlayerId().getUnits().isEmpty();\n+\n+          if (hasUnitsToPlace || stepIsAfterPurchaseAndBeforePlacement(step)) {\n+            panel.setTitle(\"Units To Place (\" + step.getPlayerId().getUnits().size() + \")\");\n+            unitsToPlacePanel.setUnitsFromCategories(\n+                UnitSeparator.categorize(step.getPlayerId().getUnits()));\n+            panel.setVisible(true);\n+          } else {\n+            panel.setVisible(false);\n+          }\n+        });\n+  }\n+\n+  private static boolean isInitializationStep(final GameStep gameStep) {\n+    return gameStep.getPlayerId() == null;\n+  }\n+\n+  private boolean stepIsAfterPurchaseAndBeforePlacement(final GameStep step) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42674629a3124f8d2aad365e1ab81eacd2de5ad2"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU5OTE5MA==", "bodyText": "TODO found", "url": "https://github.com/triplea-game/triplea/pull/6155#discussion_r404599190", "createdAt": "2020-04-07T07:37:54Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/AbstractMovePanel.java", "diffHunk": "@@ -104,6 +104,7 @@ private void disableCancelButton() {\n     cancelMoveButton.setEnabled(false);\n   }\n \n+  // TODO: rename this to 'getGameDataFromPlayerBridge'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42674629a3124f8d2aad365e1ab81eacd2de5ad2"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b5f6bec5be2add4f222f755c5ac6c7ae4e7bd5", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/21b5f6bec5be2add4f222f755c5ac6c7ae4e7bd5", "committedDate": "2020-04-07T07:43:23Z", "message": "Update PlacePanel to mostly have 1.9 behavior when placing units"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42674629a3124f8d2aad365e1ab81eacd2de5ad2", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/42674629a3124f8d2aad365e1ab81eacd2de5ad2", "committedDate": "2020-04-07T07:34:44Z", "message": "Formatting"}, "afterCommit": {"oid": "93accbb8fbb6d464cb6d01b51f59dc2f56654254", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/93accbb8fbb6d464cb6d01b51f59dc2f56654254", "committedDate": "2020-04-07T07:43:27Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87e3a05cf3e53d0892bee1c4bc44837d71ebb4a3", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/87e3a05cf3e53d0892bee1c4bc44837d71ebb4a3", "committedDate": "2020-04-07T07:44:38Z", "message": "Extract placement collapsible panel to be its own panel.\n\n- Show the panel if we have units to place, or if we are after\n  a placement phase and should be showing a \"None\" label."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "865a72e0cfe1c629936b2ec49a029cfd2dee8f83", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/865a72e0cfe1c629936b2ec49a029cfd2dee8f83", "committedDate": "2020-04-07T07:44:41Z", "message": "Remove placements panel empty label now that we have unit count in the title"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b69942b418decedbe5701bfcaabb71ec23bd2e0", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/7b69942b418decedbe5701bfcaabb71ec23bd2e0", "committedDate": "2020-04-07T07:44:41Z", "message": "Place unit scroller below placements panel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf12f9d279954a66e0d53bc40aa1249687876321", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/cf12f9d279954a66e0d53bc40aa1249687876321", "committedDate": "2020-04-07T07:44:41Z", "message": "Formatting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93accbb8fbb6d464cb6d01b51f59dc2f56654254", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/93accbb8fbb6d464cb6d01b51f59dc2f56654254", "committedDate": "2020-04-07T07:43:27Z", "message": "Formatting"}, "afterCommit": {"oid": "cf12f9d279954a66e0d53bc40aa1249687876321", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/cf12f9d279954a66e0d53bc40aa1249687876321", "committedDate": "2020-04-07T07:44:41Z", "message": "Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTMwOTEw", "url": "https://github.com/triplea-game/triplea/pull/6155#pullrequestreview-389130910", "createdAt": "2020-04-07T13:45:39Z", "commit": {"oid": "cf12f9d279954a66e0d53bc40aa1249687876321"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0NTo0MFrOGCETPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0NTo0MFrOGCETPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDc5Nw==", "bodyText": "Is there any specific reason why we iterate backwards over the steps?", "url": "https://github.com/triplea-game/triplea/pull/6155#discussion_r404820797", "createdAt": "2020-04-07T13:45:40Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/triplea/ui/PlacementUnitsCollapsiblePanel.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package games.strategy.triplea.ui;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.GameDataEvent;\n+import games.strategy.engine.data.GamePlayer;\n+import games.strategy.engine.data.GameStep;\n+import games.strategy.triplea.util.UnitSeparator;\n+import javax.swing.SwingUtilities;\n+import lombok.Getter;\n+import org.triplea.swing.CollapsiblePanel;\n+\n+class PlacementUnitsCollapsiblePanel {\n+  private final SimpleUnitPanel unitsToPlacePanel;\n+\n+  @Getter private final CollapsiblePanel panel;\n+  private final GameData gameData;\n+\n+  PlacementUnitsCollapsiblePanel(final GameData gameData, final UiContext uiContext) {\n+    this.gameData = gameData;\n+    unitsToPlacePanel =\n+        new SimpleUnitPanel(\n+            uiContext, SimpleUnitPanel.Style.SMALL_ICONS_WRAPPED_WITH_LABEL_WHEN_EMPTY);\n+    panel = new CollapsiblePanel(unitsToPlacePanel, \"\");\n+    panel.setVisible(false);\n+    gameData.addGameDataEventListener(GameDataEvent.GAME_STEP_CHANGED, this::updateStep);\n+  }\n+\n+  private void updateStep() {\n+    final GameStep step = gameData.getSequence().getStep();\n+\n+    SwingUtilities.invokeLater(\n+        () -> {\n+          if (GameStep.isPlaceStep(step.getName()) || isInitializationStep(step)) {\n+            panel.setVisible(false);\n+            return;\n+          }\n+\n+          final boolean hasUnitsToPlace = !step.getPlayerId().getUnits().isEmpty();\n+\n+          if (hasUnitsToPlace || stepIsAfterPurchaseAndBeforePlacement(step)) {\n+            panel.setTitle(\"Units To Place (\" + step.getPlayerId().getUnits().size() + \")\");\n+            unitsToPlacePanel.setUnitsFromCategories(\n+                UnitSeparator.categorize(step.getPlayerId().getUnits()));\n+            panel.setVisible(true);\n+          } else {\n+            panel.setVisible(false);\n+          }\n+        });\n+  }\n+\n+  private static boolean isInitializationStep(final GameStep gameStep) {\n+    return gameStep.getPlayerId() == null;\n+  }\n+\n+  private boolean stepIsAfterPurchaseAndBeforePlacement(final GameStep step) {\n+    final GamePlayer currentPlayer = step.getPlayerId();\n+\n+    for (int i = gameData.getSequence().getStepIndex() - 1; i >= 0; i--) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf12f9d279954a66e0d53bc40aa1249687876321"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3642, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}