{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5Mjc0MTQ4", "number": 6139, "title": "Websocket message burn & ban checking", "bodyText": "Overview\nHardens websocket endpoints:\n\nif we get too many bad messages that can't be parsed from a given IP, then we'll start dropping those messages\ncheck if an IP is banned on connect and disconnect if banned.\n\nCommits\ncommit 17ee453\nBurn invalid messages if too many are sent\n\ncommit a1db73f\nDisconnect banned users connecting via websocket\n\nThe banned user http filter is not invoked when players\nconnect via websocket. This update adds to the websocket\nonOpen method to check if the connecting IP address is\nbanned and if so, disconnects them.\n\nFunctional Changes\n\n[] New map or map update\n[x] New Feature\n[x] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\nMessage Burning\n\nUse wscat to verify the bad message dropping\n\nIn the screenshot below, notice that the server stops responding to repeated bad messages:\n\nFor rejected messages, on the server we log:\nWARN  [2020-04-05 22:14:10,886] org.triplea.web.socket.GenericWebSocket: Failed to decode JSON string from IP /127.0.0.1, into a MessageEnvelope: jkl;\nWARN  [2020-04-05 22:14:11,619] org.triplea.web.socket.GenericWebSocket: Failed to decode JSON string from IP /127.0.0.1, into a MessageEnvelope: fdas\nWARN  [2020-04-05 22:14:12,147] org.triplea.web.socket.GenericWebSocket: Failed to decode JSON string from IP /127.0.0.1, into a MessageEnvelope: fds\n\nBanned IPs connecting directly to WS\n\nAgain used wscat to verify could not connect when banned:\n\nran 'load_local_data' script to get a moderator user \"test:test\"\nbanned myself via toolbox after connecting to server\nverified session was disconnected after connecting with wscat\nverified that after a 30 second cooldown, server responds with an error message again.\n\n\n\n\n\n\n\nAdditional Review Notes\nIn both cases we put the checks in GenericWebSocket. We shift the responsibility of JSON decoding from the WebsocketMessageBug to GenericWebsocket.", "createdAt": "2020-04-05T22:17:12Z", "url": "https://github.com/triplea-game/triplea/pull/6139", "merged": true, "mergeCommit": {"oid": "0b931682f0a3ca75ba4eca6d9455ebe60e99ab62"}, "closed": true, "closedAt": "2020-04-07T01:39:51Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUxkl2gH2gAyMzk5Mjc0MTQ4OjE3ZWU0NTM4M2FkMmMyOGM0MGUzMDYyZTIxNmNiNTc5OGJiYTZmNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVJK96gFqTM4ODcyNjk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "17ee45383ad2c28c40e3062e216cb5798bba6f72", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/17ee45383ad2c28c40e3062e216cb5798bba6f72", "committedDate": "2020-04-05T22:09:53Z", "message": "Burn invalid messages if too many are sent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1db73fb24b5423fdfe1f1af296d6a22fee5d645", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/a1db73fb24b5423fdfe1f1af296d6a22fee5d645", "committedDate": "2020-04-05T22:09:53Z", "message": "Disconnect banned users connecting via websocket\n\nThe banned user http filter is not invoked when players\nconnect via websocket. This update adds to the websocket\nonOpen method to check if the connecting IP address is\nbanned and if so, disconnects them."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47ccdc56e70f6d391ab1d2c935250e42561354a8", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/47ccdc56e70f6d391ab1d2c935250e42561354a8", "committedDate": "2020-04-05T22:23:14Z", "message": "Shorten server configuration method, extract common websocket setup code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ed5e396ad812b407b90e37c9238535e59d29c0b", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8ed5e396ad812b407b90e37c9238535e59d29c0b", "committedDate": "2020-04-05T22:25:59Z", "message": "Move helper method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzI2OTg0", "url": "https://github.com/triplea-game/triplea/pull/6139#pullrequestreview-388726984", "createdAt": "2020-04-07T01:30:16Z", "commit": {"oid": "8ed5e396ad812b407b90e37c9238535e59d29c0b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMTozMDoxNlrOGBvwiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMTozMDoxNlrOGBvwiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4NDIzMw==", "bodyText": "Should be camel case webSocket?", "url": "https://github.com/triplea-game/triplea/pull/6139#discussion_r404484233", "createdAt": "2020-04-07T01:30:16Z", "author": {"login": "ron-murhammer"}, "path": "http-server/src/main/java/org/triplea/http/ServerApplication.java", "diffHunk": "@@ -208,6 +192,22 @@ private static void enableAuthentication(\n     return ImmutableList.of(new IllegalArgumentMapper());\n   }\n \n+  private static void setupWebSocket(\n+      final ServerEndpointConfig websocket,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ed5e396ad812b407b90e37c9238535e59d29c0b"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3633, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}