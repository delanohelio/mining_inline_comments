{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNTI2NzAw", "number": 6926, "title": "Compute maps folder location rather than storing as client setting", "bodyText": "This update removes client setting storage of default maps folder\nand instead computes the location when it is not overriden.\nThe default maps folder location is not a value the user would configure\nand hence is not appropriate to be in client settings.\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix\n[] Other:   \nTesting\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nIt seems possible that storing the map folder as a client setting could cause problems if we have users install TripleA to a new location and delete their old. I'll do some follow-up testing to see if this is also a problem fix. In the meantime the update to not store map folder is IMO correct. The client settings should generally not be so aware of implementation details of like how to find a default folder path and should generally try to have primitive values.\nRelease Note", "createdAt": "2020-06-29T16:34:43Z", "url": "https://github.com/triplea-game/triplea/pull/6926", "merged": true, "mergeCommit": {"oid": "5116d6d4e2f0651f7bedabcfb0eaecc5244a4d5d"}, "closed": true, "closedAt": "2020-06-30T01:54:57Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwDpnWgH2gAyNDQxNTI2NzAwOjhkZjkzNGVkMjlkNmQ0NGQxYTFkYzU0YjM4YzI5ZjNjYmQ1ZmEzMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwK8-fAH2gAyNDQxNTI2NzAwOjY4YWNjYWQ4NDU5OWIwMjlhM2RmOGQwZGMwM2VjMDVkNmY5NTcyMGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "committedDate": "2020-06-29T16:29:37Z", "message": "Compute maps folder location rather than storing as client setting\n\nThis update removes client setting storage of default maps folder\nand instead computes the location when it is not overriden.\nThe default maps folder location is not a value the user would configure\nand hence is not appropriate to be in client settings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTUzNTY5", "url": "https://github.com/triplea-game/triplea/pull/6926#pullrequestreview-439553569", "createdAt": "2020-06-29T22:47:34Z", "commit": {"oid": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjo0NzozNFrOGqlLAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjo0ODowM1rOGqlLtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjQwMg==", "bodyText": "getRootFolder() is a little bit weird tbh.\nOn a clean system the triplea folder will never be inside \"documents\", only if you manually create this folder it will end up storing it there indefinitely.", "url": "https://github.com/triplea-game/triplea/pull/6926#discussion_r447302402", "createdAt": "2020-06-29T22:47:34Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java", "diffHunk": "@@ -105,25 +105,22 @@ public static File getUserRootFolder() {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    final File mapsFolder =\n-        getUserMapsFolder(ClientSetting.userMapsFolderPath, ClientSetting.mapFolderOverride)\n-            .toFile();\n-    if (!mapsFolder.exists()) {\n-      mapsFolder.mkdirs();\n-    }\n-    if (!mapsFolder.exists()) {\n-      log.severe(\"Error, downloaded maps folder does not exist: \" + mapsFolder.getAbsolutePath());\n-    }\n-    return mapsFolder;\n+    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjU4MA==", "bodyText": "Some day we can migrate all of the APIs to use java.nio.Path ^^", "url": "https://github.com/triplea-game/triplea/pull/6926#discussion_r447302580", "createdAt": "2020-06-29T22:48:03Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java", "diffHunk": "@@ -105,25 +105,22 @@ public static File getUserRootFolder() {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    final File mapsFolder =\n-        getUserMapsFolder(ClientSetting.userMapsFolderPath, ClientSetting.mapFolderOverride)\n-            .toFile();\n-    if (!mapsFolder.exists()) {\n-      mapsFolder.mkdirs();\n-    }\n-    if (!mapsFolder.exists()) {\n-      log.severe(\"Error, downloaded maps folder does not exist: \" + mapsFolder.getAbsolutePath());\n-    }\n-    return mapsFolder;\n+    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);\n   }\n \n   @VisibleForTesting\n-  static Path getUserMapsFolder(\n-      final GameSetting<Path> currentUserMapsFolderSetting,\n-      final GameSetting<Path> overrideUserMapsFolderSetting) {\n-    return overrideUserMapsFolderSetting.isSet()\n-        ? overrideUserMapsFolderSetting.getValueOrThrow()\n-        : currentUserMapsFolderSetting.getValueOrThrow();\n+  static File getUserMapsFolder(final Supplier<File> userHomeRootFolderSupplier) {\n+    final File mapsFolder =\n+        ClientSetting.mapFolderOverride\n+            .getValue()\n+            .map(Path::toFile)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68accad84599b029a3df8d0dc03ec05d6f95720f", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/68accad84599b029a3df8d0dc03ec05d6f95720f", "committedDate": "2020-06-30T01:00:06Z", "message": "Fix, use correct 'getUserRoot' folder method"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3310, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}