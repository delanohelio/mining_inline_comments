{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzc1OTU4", "number": 6063, "title": "Combine server side websockets", "bodyText": "This update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward means we will likely only have two websocket endpoints\nin the long run.\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\nPretty well covered already by automated testing.\nManual smoke testing:\n\nconnect to local lobby, verify chat and hosted games are listed", "createdAt": "2020-03-20T06:41:17Z", "url": "https://github.com/triplea-game/triplea/pull/6063", "merged": true, "mergeCommit": {"oid": "26e011f8f068b4009bbb0611a233312f563991fb"}, "closed": true, "closedAt": "2020-03-21T22:35:19Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPavYjAFqTM3ODI1NzI0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcP88OfAFqTM3ODk1Njk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjU3MjQ1", "url": "https://github.com/triplea-game/triplea/pull/6063#pullrequestreview-378257245", "createdAt": "2020-03-20T06:44:14Z", "commit": {"oid": "f75833acc0e946339c72cc2132f031a093ba255a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwNjo0NDoxNFrOF5I6Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwNjo0NDoxNFrOF5I6Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ1OTEzMQ==", "bodyText": "TODO found", "url": "https://github.com/triplea-game/triplea/pull/6063#discussion_r395459131", "createdAt": "2020-03-20T06:44:14Z", "author": {"login": "codeclimate"}, "path": "http-server/src/main/java/org/triplea/server/web/socket/GameConnectionWebSocket.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package org.triplea.server.web.socket;\n+\n+import javax.websocket.CloseReason;\n+import javax.websocket.OnClose;\n+import javax.websocket.OnError;\n+import javax.websocket.OnOpen;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+import org.triplea.http.client.web.socket.WebsocketPaths;\n+import org.triplea.server.remote.actions.RemoteActionsEventQueue;\n+\n+@ServerEndpoint(WebsocketPaths.GAME_CONNECTIONS)\n+public class GameConnectionWebSocket {\n+\n+  public static final String REMOTE_ACTIONS_QUEUE_KEY = \"remote.actions.event.queue\";\n+\n+  @OnOpen\n+  public void open(final Session session) {\n+    ((RemoteActionsEventQueue) session.getUserProperties().get(REMOTE_ACTIONS_QUEUE_KEY))\n+        .addSession(session);\n+  }\n+\n+  @OnClose\n+  public void onClose(final Session session, final CloseReason closeReason) {\n+    ((RemoteActionsEventQueue) session.getUserProperties().get(REMOTE_ACTIONS_QUEUE_KEY))\n+        .removeSession(session);\n+  }\n+\n+  /**\n+   * This error handler is called automatically when server processing encounters an uncaught\n+   * exception. We use it to notify the user that an error occurred.\n+   */\n+  @OnError\n+  public void handleError(final Session session, final Throwable throwable) {\n+    // TODO: Project#12 implement error notification", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f75833acc0e946339c72cc2132f031a093ba255a"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "committedDate": "2020-03-20T07:06:00Z", "message": "Combine server side websockets\n\nThis update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\n\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward this means we will likely only have two websocket\nendpoints in the long run."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f75833acc0e946339c72cc2132f031a093ba255a", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/f75833acc0e946339c72cc2132f031a093ba255a", "committedDate": "2020-03-20T06:38:46Z", "message": "Combine server side websockets\n\nThis update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\n\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward this means we will likely only have two websocket\nendpoints in the long run."}, "afterCommit": {"oid": "a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "committedDate": "2020-03-20T07:06:00Z", "message": "Combine server side websockets\n\nThis update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\n\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward this means we will likely only have two websocket\nendpoints in the long run."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTU2OTYz", "url": "https://github.com/triplea-game/triplea/pull/6063#pullrequestreview-378956963", "createdAt": "2020-03-21T22:35:02Z", "commit": {"oid": "a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3583, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}