{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDEwODkx", "number": 6002, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0MDo0NFrODk9D9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMzo0NzoxMVrODlzTVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc1NzY0OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0MDo0NFrOFxkMPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0MDo0NFrOFxkMPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzUwMw==", "bodyText": "Method run has 33 lines of code (exceeds 25 allowed). Consider refactoring.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387517503", "createdAt": "2020-03-04T08:40:44Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e42972525dda2fa0571ee9a32799adf913ab91f4"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc1NzY1OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0MDo0NFrOFxkMQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODo0MDo0NFrOFxkMQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzUwNQ==", "bodyText": "TODO found", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387517505", "createdAt": "2020-03-04T08:40:44Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e42972525dda2fa0571ee9a32799adf913ab91f4"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjQxNDY2OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyNDowMlrOFx0Obg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDo1ODo1NlrOFx9aCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4MDIwNg==", "bodyText": "Do we really need more than this level of detail?\nI'd really like to avoid keeping a legacy variant of the version class just for comparison.\nIf you ask me we should really serialize String rather than Version because that should be a more robust approach.\nIf the object isn't a string we can safely assume that it's incompatible and in case it is a string we could throw some super fancy analysis algorithm on it if we ever try to change the version format again in the future", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387780206", "createdAt": "2020-03-04T16:24:02Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -59,16 +61,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n \n     final ObjectInputStream input = new ObjectInputStream(new GZIPInputStream(is));\n     try {\n-      final Version readVersion = (Version) input.readObject();\n-      if (!ClientContext.engineVersion().isCompatibleWithEngineVersion(readVersion)) {\n-        final String error =\n-            \"Incompatible engine versions. We are: \"\n-                + ClientContext.engineVersion()\n-                + \" . Trying to load game created with: \"\n-                + readVersion\n-                + \"\\nTo download the latest version of TripleA, Please visit \"\n-                + UrlConstants.DOWNLOAD_WEBSITE;\n-        throw new IOException(error);\n+      final Object version = input.readObject();\n+\n+      if (version instanceof games.strategy.util.Version) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load incompatible save game version: %s<br/>\"\n+                    + \"To download an older version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",\n+                ClientContext.engineVersion(),\n+                ((games.strategy.util.Version) version).getExactVersion(),\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE,\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE));\n+\n+      } else if (!(version instanceof Version)) {\n+        throw new IOException(\n+            \"Incompatible engine version with save game, \"\n+                + \"unable to determine version of the save game\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMDYzMw==", "bodyText": "In short, the more detail we can get, the better.\nConsidering the reported issue: #5957, @ron-murhammer said: \"Yeah we need a good error notification here as this will happen fairly often.\"\nWithout a good error message, I'm pretty positive a generic error message that does not really tell a user why the save game cannot be loaded would get reported as a bug. We do not have really any other way to tell a user to accurately that they need a 1.9 version. IMO, having the legacy class is a cost of the serialization technology used for save games. We introduced a feature regression when we removed the 'old jar' capability, keeping a legacy class around for a release is not a material cost to us.\nGenerally agree that we probably should encode the version as a string to keep the compatibility. Though, that is not what we have or had, it might be better to move directly to the project where we fix save game serialization and skip the intermediary step.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387930633", "createdAt": "2020-03-04T20:58:56Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -59,16 +61,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n \n     final ObjectInputStream input = new ObjectInputStream(new GZIPInputStream(is));\n     try {\n-      final Version readVersion = (Version) input.readObject();\n-      if (!ClientContext.engineVersion().isCompatibleWithEngineVersion(readVersion)) {\n-        final String error =\n-            \"Incompatible engine versions. We are: \"\n-                + ClientContext.engineVersion()\n-                + \" . Trying to load game created with: \"\n-                + readVersion\n-                + \"\\nTo download the latest version of TripleA, Please visit \"\n-                + UrlConstants.DOWNLOAD_WEBSITE;\n-        throw new IOException(error);\n+      final Object version = input.readObject();\n+\n+      if (version instanceof games.strategy.util.Version) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load incompatible save game version: %s<br/>\"\n+                    + \"To download an older version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",\n+                ClientContext.engineVersion(),\n+                ((games.strategy.util.Version) version).getExactVersion(),\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE,\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE));\n+\n+      } else if (!(version instanceof Version)) {\n+        throw new IOException(\n+            \"Incompatible engine version with save game, \"\n+                + \"unable to determine version of the save game\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4MDIwNg=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjQ1MjY3OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjozMjo1MFrOFx0mUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMTowNjo0N1rOFx9o4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4NjMyMw==", "bodyText": "A couple of things regarding the HTML here:\n\nPer HTML5 specification the <br> tag doesn't need to be closed, the <br /> is xhtml notation AFAIK.\nEven though per spec quotes after attributes like href=\"http://some/link\" are optional it's a good practice to always use them in case the link ever contains some sort of space or something", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387786323", "createdAt": "2020-03-04T16:32:50Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -59,16 +61,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n \n     final ObjectInputStream input = new ObjectInputStream(new GZIPInputStream(is));\n     try {\n-      final Version readVersion = (Version) input.readObject();\n-      if (!ClientContext.engineVersion().isCompatibleWithEngineVersion(readVersion)) {\n-        final String error =\n-            \"Incompatible engine versions. We are: \"\n-                + ClientContext.engineVersion()\n-                + \" . Trying to load game created with: \"\n-                + readVersion\n-                + \"\\nTo download the latest version of TripleA, Please visit \"\n-                + UrlConstants.DOWNLOAD_WEBSITE;\n-        throw new IOException(error);\n+      final Object version = input.readObject();\n+\n+      if (version instanceof games.strategy.util.Version) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load incompatible save game version: %s<br/>\"\n+                    + \"To download an older version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",\n+                ClientContext.engineVersion(),\n+                ((games.strategy.util.Version) version).getExactVersion(),\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE,\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE));\n+\n+      } else if (!(version instanceof Version)) {\n+        throw new IOException(\n+            \"Incompatible engine version with save game, \"\n+                + \"unable to determine version of the save game\");\n+      } else if (!ClientContext.engineVersion().isCompatibleWithEngineVersion((Version) version)) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load game created with: %s<br/>\"\n+                    + \"To download the latest version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzNDQzMw==", "bodyText": "The swing HTML renderer is not exactly HTML5 compliant, regardless, those are not bad cleanups per-say, updated:\n\nd9b6893\naf46b9f", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387934433", "createdAt": "2020-03-04T21:06:47Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -59,16 +61,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n \n     final ObjectInputStream input = new ObjectInputStream(new GZIPInputStream(is));\n     try {\n-      final Version readVersion = (Version) input.readObject();\n-      if (!ClientContext.engineVersion().isCompatibleWithEngineVersion(readVersion)) {\n-        final String error =\n-            \"Incompatible engine versions. We are: \"\n-                + ClientContext.engineVersion()\n-                + \" . Trying to load game created with: \"\n-                + readVersion\n-                + \"\\nTo download the latest version of TripleA, Please visit \"\n-                + UrlConstants.DOWNLOAD_WEBSITE;\n-        throw new IOException(error);\n+      final Object version = input.readObject();\n+\n+      if (version instanceof games.strategy.util.Version) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load incompatible save game version: %s<br/>\"\n+                    + \"To download an older version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",\n+                ClientContext.engineVersion(),\n+                ((games.strategy.util.Version) version).getExactVersion(),\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE,\n+                UrlConstants.OLD_DOWNLOADS_WEBSITE));\n+\n+      } else if (!(version instanceof Version)) {\n+        throw new IOException(\n+            \"Incompatible engine version with save game, \"\n+                + \"unable to determine version of the save game\");\n+      } else if (!ClientContext.engineVersion().isCompatibleWithEngineVersion((Version) version)) {\n+        throw new IOException(\n+            String.format(\n+                \"Incompatible engine versions. We are: %s<br/>\"\n+                    + \"Trying to load game created with: %s<br/>\"\n+                    + \"To download the latest version of TripleA,<br/>\"\n+                    + \"please visit: <a href=%s>%s</a>\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4NjMyMw=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjQ2OTMwOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/mc/GameSelectorModel.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjozNjo1NVrOFx0w1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMTowOToyNFrOFx9t4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4OTAxNA==", "bodyText": "Why make the exception type so broad?\nAs far as I can see the only checked exception here is IOException", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387789014", "createdAt": "2020-03-04T16:36:55Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/mc/GameSelectorModel.java", "diffHunk": "@@ -66,31 +67,25 @@ public void load(final GameChooserEntry entry) {\n   /**\n    * Loads game data by parsing a given file.\n    *\n-   * @return True if file parsing was successful and an internal {@code GameData} was set. Otherwise\n-   *     returns false and internal {@code GameData} is null.\n+   * @throws Exception If file parsing is successful and an internal {@code GameData} was set.\n    */\n-  public boolean load(final File file) {\n-    if (!file.isFile()) {\n-      return false;\n-    }\n+  public void load(final File file) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzNTcxNA==", "bodyText": "There is also:\n  public static GameData parse(final String mapName, final InputStream stream)\n      throws GameParseException, EngineVersionException {\n\nTurns out if we break it out further, there would eventually be more of them.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387935714", "createdAt": "2020-03-04T21:09:24Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/mc/GameSelectorModel.java", "diffHunk": "@@ -66,31 +67,25 @@ public void load(final GameChooserEntry entry) {\n   /**\n    * Loads game data by parsing a given file.\n    *\n-   * @return True if file parsing was successful and an internal {@code GameData} was set. Otherwise\n-   *     returns false and internal {@code GameData} is null.\n+   * @throws Exception If file parsing is successful and an internal {@code GameData} was set.\n    */\n-  public boolean load(final File file) {\n-    if (!file.isFile()) {\n-      return false;\n-    }\n+  public void load(final File file) throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4OTAxNA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjUwNTI2OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjo0NjowMlrOFx1HUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxODo1MTowMFrOFzDj9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NDc2OA==", "bodyText": "I thought this kind of handling was odd so aI had a look at the documentation:\nTurns out it's way nicer to use FileDialog#getFiles() which returns an array with the selected files (with a single element because multipleMode is false by default, or empty if the operation was canceled)\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  final String fileName = fileDialog.getFile();\n          \n          \n            \n                  final String dirName = fileDialog.getDirectory();\n          \n          \n            \n                  return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n          \n          \n            \n                  return Optional.ofNullable(fileName)\n          \n          \n            \n                      .map(name -> new File(dirName, fileName))\n          \n          \n            \n                      .map(this::mapFileResult);\n          \n          \n            \n            return Arrays.stream(fileDialog.getFiles())\n          \n          \n            \n                .findAny()\n          \n          \n            \n                .map(this::mapFileResult);", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387794768", "createdAt": "2020-03-04T16:46:02Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzODExNg==", "bodyText": "I think this direction, but not for this PR. The updates here already tested, would need to be re-tested again once this update is made. We can just as easily make this it's own follow-up and do its own testing for it. From another perspective, the update here is to also improve the existing handling, not necessarily change how the file is gathered.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387938116", "createdAt": "2020-03-04T21:14:24Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NDc2OA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzODQyMA==", "bodyText": "I'm not sure if the 'findAny' would be very clear as well to future maintainers, having this logic be close to where we limit to one selection would probably be the thing to do.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387938420", "createdAt": "2020-03-04T21:15:10Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NDc2OA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwMzA0Nw==", "bodyText": "This one in a future PR", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388903047", "createdAt": "2020-03-06T13:31:25Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NDc2OA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4MDA1Mw==", "bodyText": "If you'd like to do so @RoiEXLab , I don't think I'll rush to do it. This part of the changeset is a bugfix. The scope of change you have proposed is outside of the intended changeset presented in this PR. For example, I could pick many any other diffs in this same changeset and suggest many other valuable alternatives to the surrounding lines that would make the same diff simpler. It can become arbitrary at some point, this seems like a \"while you are here, please also do this\" type of change, which is something I did not want/or choose to do in the first place for reasons:\n\nscope creep\nkeeping set of changes to what I was wanting and felt comfortable testing.\nreview cost (already we have many commits, some questions I think would have been answered by looking at commit comments and individual diffs, adding more commits would have made it even less likely for the commit context to have been observed)\ntest burden\ngetting this done", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389080053", "createdAt": "2020-03-06T18:51:00Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NDc2OA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjUyMzI2OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorPanel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjo1MDo0NFrOFx1Sug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyNTo1OFrOFx-NCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NzY5MA==", "bodyText": "Good thing HTML parsers aren't really known for their strictness \ud83d\ude05\n(I mean we could turn this into valid HTMl by adding a body tag, closing the whole thing and everything but as long as it is displayed correctly, I honestly don't even care at this point, this is not even a browser after all ^^ )", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387797690", "createdAt": "2020-03-04T16:50:44Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorPanel.java", "diffHunk": "@@ -312,30 +318,41 @@ public void update(final Observable o, final Object arg) {\n   }\n \n   private void selectSavedGameFile() {\n-    GameFileSelector.selectGameFile(JOptionPane.getFrameForComponent(this))\n+    GameFileSelector.builder()\n+        .fileDoesNotExistAction(\n+            file ->\n+                DialogBuilder.builder()\n+                    .parent(this)\n+                    .title(\"Save Game File Not Found\")\n+                    .errorMessage(\"File does not exist: \" + file.getAbsolutePath())\n+                    .showDialog())\n+        .build()\n+        .selectGameFile(JOptionPane.getFrameForComponent(this))\n         .ifPresent(\n-            file -> {\n-              try {\n-                if (!GameRunner.newBackgroundTaskRunner()\n-                    .runInBackgroundAndReturn(\n-                        \"Loading savegame...\",\n+            file ->\n+                TaskRunner.builder()\n+                    .waitDialogTitle(\"Loading Save Game\")\n+                    .exceptionHandler(\n+                        e ->\n+                            SwingComponents.showDialogWithLinks(\n+                                DialogWithLinksParams.builder()\n+                                    .title(\"Failed To Load Save Game\")\n+                                    .dialogType(DialogWithLinksTypes.ERROR)\n+                                    .dialogText(\n+                                        String.format(\n+                                            \"<html>Error: %s<br/><br/>\"\n+                                                + \"If this is not expected, please \"\n+                                                + \"file a <a href=%s>bug report</a><br/>\"\n+                                                + \"and attach the error message above and the \"\n+                                                + \"save game you are trying to load.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MzY5MQ==", "bodyText": "Indeed, though, swing is not really a compliant HTML parser and we're not really rendering HTML pages. It would be inappropriate to have a body or head tag. The prefix of <html> is effectively a hack to tell swing to do html rendering. IIRC, swing supports only a subset of tags.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387943691", "createdAt": "2020-03-04T21:25:58Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorPanel.java", "diffHunk": "@@ -312,30 +318,41 @@ public void update(final Observable o, final Object arg) {\n   }\n \n   private void selectSavedGameFile() {\n-    GameFileSelector.selectGameFile(JOptionPane.getFrameForComponent(this))\n+    GameFileSelector.builder()\n+        .fileDoesNotExistAction(\n+            file ->\n+                DialogBuilder.builder()\n+                    .parent(this)\n+                    .title(\"Save Game File Not Found\")\n+                    .errorMessage(\"File does not exist: \" + file.getAbsolutePath())\n+                    .showDialog())\n+        .build()\n+        .selectGameFile(JOptionPane.getFrameForComponent(this))\n         .ifPresent(\n-            file -> {\n-              try {\n-                if (!GameRunner.newBackgroundTaskRunner()\n-                    .runInBackgroundAndReturn(\n-                        \"Loading savegame...\",\n+            file ->\n+                TaskRunner.builder()\n+                    .waitDialogTitle(\"Loading Save Game\")\n+                    .exceptionHandler(\n+                        e ->\n+                            SwingComponents.showDialogWithLinks(\n+                                DialogWithLinksParams.builder()\n+                                    .title(\"Failed To Load Save Game\")\n+                                    .dialogType(DialogWithLinksTypes.ERROR)\n+                                    .dialogText(\n+                                        String.format(\n+                                            \"<html>Error: %s<br/><br/>\"\n+                                                + \"If this is not expected, please \"\n+                                                + \"file a <a href=%s>bug report</a><br/>\"\n+                                                + \"and attach the error message above and the \"\n+                                                + \"save game you are trying to load.\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NzY5MA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU2ODE5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMjozMlrOFx1vXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyNDozOVrOFx-KiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNTAyMg==", "bodyText": "It's a shame generic exceptions can't be caught here.\nHowever I wouldn't catch throwable here, just the regular Exception, it can't even be specified as generic type anyways", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387805022", "createdAt": "2020-03-04T17:02:32Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);\n+    }\n+  }\n+\n+  private SwingWorker<Void, Void> buildBackgroundJobRunnerWithWaitDialog(\n+      final ThrowingRunnable<E> backgroundAction,\n+      final AtomicReference<Throwable> exceptionRef,\n+      final WaitDialog waitDialog) {\n+    return new SwingWorker<>() {\n+      @Override\n+      protected Void doInBackground() {\n+        try {\n+          backgroundAction.run();\n+        } catch (final Throwable e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MzA0OQ==", "bodyText": "This class should look very similar to BackGroundTaskRunner, it was modeled after it and really started off as a spawn of it. I remember debating this one and see why BackGroundTaskRunner had a Throwable, it is not needed here. I agree better to catch Exception, updated: ef1ecb9", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387943049", "createdAt": "2020-03-04T21:24:39Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);\n+    }\n+  }\n+\n+  private SwingWorker<Void, Void> buildBackgroundJobRunnerWithWaitDialog(\n+      final ThrowingRunnable<E> backgroundAction,\n+      final AtomicReference<Throwable> exceptionRef,\n+      final WaitDialog waitDialog) {\n+    return new SwingWorker<>() {\n+      @Override\n+      protected Void doInBackground() {\n+        try {\n+          backgroundAction.run();\n+        } catch (final Throwable e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNTAyMg=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU4NTM5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/org/triplea/game/server/HeadlessLaunchAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowNzoyNlrOFx16dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDo1NToyNlrOFx9TBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNzg2MA==", "bodyText": "I believe a small bug sneaked in here:\nLoad should only get invoked when the file does actually exist, not the other way round.\nPreviously in the if statement this was the case because the second or case was only ever executed if !f1.exists() was false i.e. f1.exists() was true.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387807860", "createdAt": "2020-03-04T17:07:26Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/org/triplea/game/server/HeadlessLaunchAction.java", "diffHunk": "@@ -31,8 +31,8 @@ public void handleGameInterruption(\n       // then crashing out, then launching, etc.\n       serverModel.setAllPlayersToNullNodes();\n       final File f1 = getAutoSaveFileUtils().getHeadlessAutoSaveFile();\n-      if (!f1.exists() || !gameSelectorModel.load(f1)) {\n-        gameSelectorModel.resetGameDataToNull();\n+      if (!f1.exists()) {\n+        gameSelectorModel.load(f1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkyODgzNw==", "bodyText": "You're right, that is a good catch.\nFixed in: 7846a1b", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387928837", "createdAt": "2020-03-04T20:55:26Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/org/triplea/game/server/HeadlessLaunchAction.java", "diffHunk": "@@ -31,8 +31,8 @@ public void handleGameInterruption(\n       // then crashing out, then launching, etc.\n       serverModel.setAllPlayersToNullNodes();\n       final File f1 = getAutoSaveFileUtils().getHeadlessAutoSaveFile();\n-      if (!f1.exists() || !gameSelectorModel.load(f1)) {\n-        gameSelectorModel.resetGameDataToNull();\n+      if (!f1.exists()) {\n+        gameSelectorModel.load(f1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNzg2MA=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU5NzA0OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzoxMDo0OVrOFx2Btw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjo1OToyMlrOFzJ7rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ==", "bodyText": "new File(fileName) is called three times here, I'd appreciate if it was put into a single variable and used 3 times, even if that adds another if block", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r387809719", "createdAt": "2020-03-04T17:10:49Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwMjcyNg==", "bodyText": "This one", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388902726", "createdAt": "2020-03-06T13:30:46Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA3NzM1Mg==", "bodyText": "Sorry, though I'd rather not refactor this code beyond handling the newly checked exception. This was OS specific code that requires an installer of the app, the test burden here is really high. A unit test would be good to have, OTOH this existing logic block is far outside of the intended scope of change.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389077352", "createdAt": "2020-03-06T18:45:11Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyMTYzNg==", "bodyText": "The only reason I'm pointing this out is because this PR introduces another call to new File(fileName).\nSo I was thinking that now that there's 3 of them adding a variable and use that3 times would finally be worth it, but nothing too crazy here. I can also do that in a follow-up PR. It's nothing special", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389121636", "createdAt": "2020-03-06T20:13:37Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3NzMzNQ==", "bodyText": "It is your prerogative. IMO it could be more effective prioritization to focus on 2.0 or deeper refactoring that would remove game loading from GameRunner", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389177335", "createdAt": "2020-03-06T22:36:23Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE4NDQzMQ==", "bodyText": "Removing this bit of the code would be a good step into the right direction, but a hard one to achieve  unfortunately.\nThe \"join headless host\" code depends on it, so it can pass parameters to the newly spawned process \ud83d\ude05", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389184431", "createdAt": "2020-03-06T22:59:22Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameRunner.java", "diffHunk": "@@ -153,7 +156,12 @@ private static void loadGame() {\n     gameSelectorModel.loadDefaultGameSameThread();\n     final String fileName = System.getProperty(TRIPLEA_GAME, \"\");\n     if (!fileName.isEmpty() && new File(fileName).exists()) {\n-      gameSelectorModel.load(new File(fileName));\n+      try {\n+        gameSelectorModel.load(new File(fileName));\n+      } catch (final Exception e) {\n+        log.log(\n+            Level.SEVERE, \"Error loading game file: \" + new File(fileName).getAbsolutePath(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwOTcxOQ=="}, "originalCommit": {"oid": "3db89602f9e9922924fa5c6010027ecc8445f812"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTYwMjYzOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMzozNDowNlrOFy41nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMDowOTo1NlrOFzF__g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNDM0OA==", "bodyText": "It's a bit hard to wrap my head around this, this is a super weird side-effect, but ok.\nPerhaps worth annotating this method with @Nullable", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388904348", "createdAt": "2020-03-06T13:34:06Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);\n     }\n \n     // Non-Mac platforms should use the normal Swing JFileChooser\n     final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n     final int selectedOption = fileChooser.showOpenDialog(owner);\n     if (selectedOption == JFileChooser.APPROVE_OPTION) {\n-      return Optional.of(fileChooser.getSelectedFile());\n+      return Optional.of(fileChooser.getSelectedFile()).map(this::mapFileResult);\n     }\n     return Optional.empty();\n   }\n+\n+  private File mapFileResult(final File file) {\n+    if (file.exists()) {\n+      return file;\n+    } else {\n+      fileDoesNotExistAction.accept(file);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4NDM0NA==", "bodyText": "Why super-weird? It's an error handling callback. Could that have been made more clear?\nThe nullable update is maybe getting us into diminishing returns, it is much better we take care of higher level concerns. Regardless, updated: 3fbfa90", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389084344", "createdAt": "2020-03-06T18:59:58Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);\n     }\n \n     // Non-Mac platforms should use the normal Swing JFileChooser\n     final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n     final int selectedOption = fileChooser.showOpenDialog(owner);\n     if (selectedOption == JFileChooser.APPROVE_OPTION) {\n-      return Optional.of(fileChooser.getSelectedFile());\n+      return Optional.of(fileChooser.getSelectedFile()).map(this::mapFileResult);\n     }\n     return Optional.empty();\n   }\n+\n+  private File mapFileResult(final File file) {\n+    if (file.exists()) {\n+      return file;\n+    } else {\n+      fileDoesNotExistAction.accept(file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNDM0OA=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExOTk5OA==", "bodyText": "Well from just looking at the other method I assumed that mapFileResult was a \"pure\" function with no side-effects, so I was quite suprised to see the error handler there.\nMaybe not \"weird\" but definitely unexpected.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389119998", "createdAt": "2020-03-06T20:09:56Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameFileSelector.java", "diffHunk": "@@ -32,15 +36,26 @@ private GameFileSelector() {}\n       fileDialog.setVisible(true);\n       final String fileName = fileDialog.getFile();\n       final String dirName = fileDialog.getDirectory();\n-      return Optional.ofNullable(fileName).map(name -> new File(dirName, fileName));\n+      return Optional.ofNullable(fileName)\n+          .map(name -> new File(dirName, fileName))\n+          .map(this::mapFileResult);\n     }\n \n     // Non-Mac platforms should use the normal Swing JFileChooser\n     final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n     final int selectedOption = fileChooser.showOpenDialog(owner);\n     if (selectedOption == JFileChooser.APPROVE_OPTION) {\n-      return Optional.of(fileChooser.getSelectedFile());\n+      return Optional.of(fileChooser.getSelectedFile()).map(this::mapFileResult);\n     }\n     return Optional.empty();\n   }\n+\n+  private File mapFileResult(final File file) {\n+    if (file.exists()) {\n+      return file;\n+    } else {\n+      fileDoesNotExistAction.accept(file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNDM0OA=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTYwODE2OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMzozNTo1NFrOFy45Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTowNTo0NlrOFzD_Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNTIxOA==", "bodyText": "The AtomicReference is still Throwable instead of just exception", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388905218", "createdAt": "2020-03-06T13:35:54Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);\n+    }\n+  }\n+\n+  private SwingWorker<Void, Void> buildBackgroundJobRunnerWithWaitDialog(\n+      final ThrowingRunnable<E> backgroundAction,\n+      final AtomicReference<Throwable> exceptionRef,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4NzAwMw==", "bodyText": "Updated: 8e794f4", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389087003", "createdAt": "2020-03-06T19:05:46Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);\n+    }\n+  }\n+\n+  private SwingWorker<Void, Void> buildBackgroundJobRunnerWithWaitDialog(\n+      final ThrowingRunnable<E> backgroundAction,\n+      final AtomicReference<Throwable> exceptionRef,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwNTIxOA=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTYyNjc3OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMzo0MTo0MFrOFy5EGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzowMjo1OVrOFzJ_lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwODA1Nw==", "bodyText": "I'm 99% sure a ClassCastException can only ever be thrown inside the exception handler here, so in case we catch an unchecked Exception by accident causing the exceptionHandler to trip up, this exception isn't as impossible as it seems.\nThinking about it we might want to consider explicitly passing a class object here to correctly filter out the \"unwanted\" exception types \ud83e\udd14", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388908057", "createdAt": "2020-03-06T13:41:40Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4Njk0OA==", "bodyText": "Thinking about it we might want to consider explicitly passing a class object here to correctly filter out the \"unwanted\" exception types thinking\n\nThis was an explicit decision. Background runner I found hard to use in the exception handling case and also turns out to be brittle (if the background task opens a swing window, because you can't close the modal wait dialog, you get a deadlock. The background task then only needs to log/throw an exception that triggers an error report dialog to crash the system). The exception API requiring an exception type was an unwelcome parameter to see, it's redundant to the generic type already. The trade-off for really specific error handling to API usage is not favorable here (otherwise background task runner could have been made fine to use).", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389086948", "createdAt": "2020-03-06T19:05:39Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwODA1Nw=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE4NTQyOQ==", "bodyText": "My only problem with this is that we only use AssertionError for impossible conditions (like when UTF-8 is hardcoded as charset, but an exception is thrown, or when we do a switch and we checked all possible cases so the default case can never get reached). But this particular condition is very possible in practice, so I'd prefer using IllegalStateException", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389185429", "createdAt": "2020-03-06T23:02:59Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/framework/ui/background/TaskRunner.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package games.strategy.engine.framework.ui.background;\n+\n+import com.google.common.base.Preconditions;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import javax.swing.SwingWorker;\n+import javax.swing.WindowConstants;\n+import lombok.Builder;\n+import org.triplea.java.function.ThrowingRunnable;\n+import org.triplea.swing.SwingComponents;\n+\n+/**\n+ * Runs a background task with a wait dialog in the foreground. Similar to {@see\n+ * BackgroundTaskRunner} except:\n+ *\n+ * <ul>\n+ *   <li>Wait dialog can be closed.\n+ *   <li>Does not throw exceptions, instead invokes an exception handler\n+ * </ul>\n+ *\n+ * @param <E> Exception type that can be thrown by the background task.\n+ */\n+@Builder\n+public class TaskRunner<E extends Exception> {\n+  /**\n+   * Error callback handler. The background task encounters an exception, the background task is\n+   * cancelled and this is invoked with the exception that occurred.\n+   */\n+  @Nonnull private final Consumer<E> exceptionHandler;\n+  /**\n+   * Title of the wait spinner window that is displayed to user while a background action is being\n+   * executed.\n+   */\n+  @Nonnull private final String waitDialogTitle;\n+\n+  /**\n+   * Runs a task with a closeable wait spinner dialog in the foreground. THe wait spinner closes\n+   * when the task completes. If the spinner dialog is closed, then the background task is\n+   * cancelled. If there are any exceptions encountered, the spinner dialog is closed and the {@see\n+   * exceptionHandler} {@code Consumer} property is called.\n+   *\n+   * @param backgroundAction The action to be executed.\n+   */\n+  public void run(final ThrowingRunnable<E> backgroundAction) {\n+    Preconditions.checkNotNull(backgroundAction);\n+    final AtomicReference<Throwable> exceptionRef = new AtomicReference<>();\n+\n+    // TODO: after https://github.com/triplea-game/triplea/pull/6001 is merged\n+    //   change the 'null' parent window reference to main frame.\n+    final WaitDialog waitDialog = new WaitDialog(null, waitDialogTitle);\n+    waitDialog.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+    final SwingWorker<Void, Void> worker =\n+        buildBackgroundJobRunnerWithWaitDialog(backgroundAction, exceptionRef, waitDialog);\n+    // If wait dialog is closed, then cancel the worker background job.\n+    SwingComponents.addWindowClosedListener(waitDialog, () -> worker.cancel(true));\n+\n+    worker.execute();\n+    waitDialog.setVisible(true);\n+\n+    try {\n+      @SuppressWarnings(\"unchecked\")\n+      final @Nullable E exception = (E) exceptionRef.get();\n+      if (exception != null) {\n+        exceptionHandler.accept(exception);\n+      }\n+    } catch (final ClassCastException e) {\n+      throw new AssertionError(\"Unexpected exception thrown\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkwODA1Nw=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTY0NDM5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/util/Version.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMzo0NzoxMVrOFy5OfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOToxMDo0NlrOFzEISQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkxMDcxNg==", "bodyText": "This whole part as well as the constructors can be removed IMO, just to be sure no one actually tries to do something about this. \ud83e\udd37\u200d\u2642\nJust because it's deprecated doesn't mean people won't actually try to use it", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r388910716", "createdAt": "2020-03-06T13:47:11Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/util/Version.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package games.strategy.util;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * Represents a version string. versions are of the form major.minor.point.micro\n+ *\n+ * @deprecated Do not use this class, this is here purely to allow serialization from older save\n+ *     games.\n+ */\n+@SuppressWarnings({\"MemberName\", \"UnmatchedTest\"})\n+@Deprecated\n+public final class Version implements Serializable, Comparable<Version> {\n+  private static final long serialVersionUID = -4770210855326775333L;\n+\n+  private final int m_major;\n+  private final int m_minor;\n+  private final int m_point;\n+  private final int m_micro;\n+  private final String exactVersion;\n+\n+  /** Constructs a Version object without the point and micro version, defaults those to 0. */\n+  public Version(final int major, final int minor) {\n+    this(major, minor, 0);\n+  }\n+\n+  /** Constructs a Version object without the micro version, defaults to 0. */\n+  public Version(final int major, final int minor, final int point) {\n+    this(major, minor, point, 0);\n+  }\n+\n+  /** Constructs a Version object with all version values set. */\n+  public Version(final int major, final int minor, final int point, final int micro) {\n+    this.m_major = major;\n+    this.m_minor = minor;\n+    this.m_point = point;\n+    this.m_micro = micro;\n+    exactVersion = toString();\n+  }\n+\n+  /**\n+   * version must be of the from xx.xx.xx.xx or xx.xx.xx or xx.xx or xx where xx is a positive\n+   * integer\n+   */\n+  public Version(final String version) {\n+    exactVersion = version;\n+\n+    final Matcher matcher =\n+        Pattern.compile(\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.((?:\\\\d+|dev)[^.]*))?)?)?\")\n+            .matcher(version);\n+\n+    if (matcher.find()) {\n+      m_major = Integer.parseInt(matcher.group(1));\n+      m_minor = Optional.ofNullable(matcher.group(2)).map(Integer::valueOf).orElse(0);\n+      m_point = Optional.ofNullable(matcher.group(3)).map(Integer::valueOf).orElse(0);\n+      final String microString = matcher.group(4);\n+      m_micro =\n+          \"dev\".equals(microString)\n+              ? Integer.MAX_VALUE\n+              : Optional.ofNullable(microString).map(Integer::valueOf).orElse(0);\n+      return;\n+    }\n+    throw new IllegalArgumentException(\"Invalid version String: \" + version);\n+  }\n+\n+  /**\n+   * Returns the exact and full version number. For example, if we specify: <code>\n+   * new Version(1.2.3.4.5).getMicro == 4; // true\n+   * new Version(1.2.3.4.5).toString().equals(\"1.2.3.4\"); // true\n+   * new Version(1.2.3.4.5).getExactVersion.equals(\"1.2.3.4.5\"); // true\n+   * </code>\n+   */\n+  public String getExactVersion() {\n+    // in case of deserialization, exactVersion may be null, in which case toString() it.\n+    return exactVersion != null ? exactVersion : toString();\n+  }\n+\n+  /** Returns the major version number. */\n+  public int getMajor() {\n+    return m_major;\n+  }\n+\n+  /** Returns the minor version number. */\n+  public int getMinor() {\n+    return m_minor;\n+  }\n+\n+  /** Returns the point version number. */\n+  public int getPoint() {\n+    return m_point;\n+  }\n+\n+  /** Returns the micro version number. */\n+  public int getMicro() {\n+    return m_micro;\n+  }\n+\n+  @Override\n+  public boolean equals(final @Nullable Object o) {\n+    return o instanceof Version && compareTo((Version) o) == 0;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(m_major, m_minor, m_point, m_micro);\n+  }\n+\n+  @Override\n+  public int compareTo(final Version other) {\n+    checkNotNull(other);\n+\n+    return Comparator.comparingInt(Version::getMajor)\n+        .thenComparingInt(Version::getMinor)\n+        .thenComparingInt(Version::getPoint)\n+        .thenComparingInt(Version::getMicro)\n+        .compare(this, other);\n+  }\n+\n+  /**\n+   * Indicates this version is greater than the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is greater than the specified version; otherwise {@code\n+   *     false}.\n+   */\n+  public boolean isGreaterThan(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) > 0;\n+  }\n+\n+  /**\n+   * Indicates this version is greater than or equal to the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is greater than or equal to the specified version;\n+   *     otherwise {@code false}.\n+   */\n+  public boolean isGreaterThanOrEqualTo(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) >= 0;\n+  }\n+\n+  /**\n+   * Indicates this version is less than the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is less than the specified version; otherwise {@code\n+   *     false}.\n+   */\n+  public boolean isLessThan(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) < 0;\n+  }\n+\n+  /**\n+   * Returns a new version with the major, minor, and point versions from this instance and the\n+   * specified micro version.\n+   */\n+  public Version withMicro(final int micro) {\n+    return new Version(m_major, m_minor, m_point, micro);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4OTM1Mw==", "bodyText": "Not willing to modify this.\n\nWould like diffs to be minimal\nWaste of time reviewing changes here and equally responding to any potential feedback, and I would be lost for words if we introduced any further problems and then had to spend yet more time on that. We need to value our time highly, and keep that in mind when considering our review bar and how much stuff we need to get done. Failures is an option, the community is shrinking, there are new alternatives for players being made, we need to get stuff done.\n\n\nJust because it's deprecated doesn't mean people won't actually try to use it\n\nBy that reasoning, folks might try to append to it as well. Hopefully the big strike-through makes it clear this is deprecated.", "url": "https://github.com/triplea-game/triplea/pull/6002#discussion_r389089353", "createdAt": "2020-03-06T19:10:46Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/util/Version.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package games.strategy.util;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * Represents a version string. versions are of the form major.minor.point.micro\n+ *\n+ * @deprecated Do not use this class, this is here purely to allow serialization from older save\n+ *     games.\n+ */\n+@SuppressWarnings({\"MemberName\", \"UnmatchedTest\"})\n+@Deprecated\n+public final class Version implements Serializable, Comparable<Version> {\n+  private static final long serialVersionUID = -4770210855326775333L;\n+\n+  private final int m_major;\n+  private final int m_minor;\n+  private final int m_point;\n+  private final int m_micro;\n+  private final String exactVersion;\n+\n+  /** Constructs a Version object without the point and micro version, defaults those to 0. */\n+  public Version(final int major, final int minor) {\n+    this(major, minor, 0);\n+  }\n+\n+  /** Constructs a Version object without the micro version, defaults to 0. */\n+  public Version(final int major, final int minor, final int point) {\n+    this(major, minor, point, 0);\n+  }\n+\n+  /** Constructs a Version object with all version values set. */\n+  public Version(final int major, final int minor, final int point, final int micro) {\n+    this.m_major = major;\n+    this.m_minor = minor;\n+    this.m_point = point;\n+    this.m_micro = micro;\n+    exactVersion = toString();\n+  }\n+\n+  /**\n+   * version must be of the from xx.xx.xx.xx or xx.xx.xx or xx.xx or xx where xx is a positive\n+   * integer\n+   */\n+  public Version(final String version) {\n+    exactVersion = version;\n+\n+    final Matcher matcher =\n+        Pattern.compile(\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.((?:\\\\d+|dev)[^.]*))?)?)?\")\n+            .matcher(version);\n+\n+    if (matcher.find()) {\n+      m_major = Integer.parseInt(matcher.group(1));\n+      m_minor = Optional.ofNullable(matcher.group(2)).map(Integer::valueOf).orElse(0);\n+      m_point = Optional.ofNullable(matcher.group(3)).map(Integer::valueOf).orElse(0);\n+      final String microString = matcher.group(4);\n+      m_micro =\n+          \"dev\".equals(microString)\n+              ? Integer.MAX_VALUE\n+              : Optional.ofNullable(microString).map(Integer::valueOf).orElse(0);\n+      return;\n+    }\n+    throw new IllegalArgumentException(\"Invalid version String: \" + version);\n+  }\n+\n+  /**\n+   * Returns the exact and full version number. For example, if we specify: <code>\n+   * new Version(1.2.3.4.5).getMicro == 4; // true\n+   * new Version(1.2.3.4.5).toString().equals(\"1.2.3.4\"); // true\n+   * new Version(1.2.3.4.5).getExactVersion.equals(\"1.2.3.4.5\"); // true\n+   * </code>\n+   */\n+  public String getExactVersion() {\n+    // in case of deserialization, exactVersion may be null, in which case toString() it.\n+    return exactVersion != null ? exactVersion : toString();\n+  }\n+\n+  /** Returns the major version number. */\n+  public int getMajor() {\n+    return m_major;\n+  }\n+\n+  /** Returns the minor version number. */\n+  public int getMinor() {\n+    return m_minor;\n+  }\n+\n+  /** Returns the point version number. */\n+  public int getPoint() {\n+    return m_point;\n+  }\n+\n+  /** Returns the micro version number. */\n+  public int getMicro() {\n+    return m_micro;\n+  }\n+\n+  @Override\n+  public boolean equals(final @Nullable Object o) {\n+    return o instanceof Version && compareTo((Version) o) == 0;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(m_major, m_minor, m_point, m_micro);\n+  }\n+\n+  @Override\n+  public int compareTo(final Version other) {\n+    checkNotNull(other);\n+\n+    return Comparator.comparingInt(Version::getMajor)\n+        .thenComparingInt(Version::getMinor)\n+        .thenComparingInt(Version::getPoint)\n+        .thenComparingInt(Version::getMicro)\n+        .compare(this, other);\n+  }\n+\n+  /**\n+   * Indicates this version is greater than the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is greater than the specified version; otherwise {@code\n+   *     false}.\n+   */\n+  public boolean isGreaterThan(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) > 0;\n+  }\n+\n+  /**\n+   * Indicates this version is greater than or equal to the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is greater than or equal to the specified version;\n+   *     otherwise {@code false}.\n+   */\n+  public boolean isGreaterThanOrEqualTo(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) >= 0;\n+  }\n+\n+  /**\n+   * Indicates this version is less than the specified version.\n+   *\n+   * @param other The version to compare.\n+   * @return {@code true} if this version is less than the specified version; otherwise {@code\n+   *     false}.\n+   */\n+  public boolean isLessThan(final Version other) {\n+    checkNotNull(other);\n+\n+    return compareTo(other) < 0;\n+  }\n+\n+  /**\n+   * Returns a new version with the major, minor, and point versions from this instance and the\n+   * specified micro version.\n+   */\n+  public Version withMicro(final int micro) {\n+    return new Version(m_major, m_minor, m_point, micro);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkxMDcxNg=="}, "originalCommit": {"oid": "2b986558d428cb8b387baf829478e6e21bb658f1"}, "originalPosition": 172}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2503, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}