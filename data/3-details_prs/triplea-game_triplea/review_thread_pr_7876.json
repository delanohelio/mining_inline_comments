{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMjA5MjQ1", "number": 7876, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQyMjowMjoxM1rOEsbQvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMjowOTozM1rOEscxZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MDE5NDUzOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQyMjowMjoxM1rOHfq8Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQyMjo1NDoxMlrOHfrSFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk3MTQ4Nw==", "bodyText": "Should a log.error be added here as well?", "url": "https://github.com/triplea-game/triplea/pull/7876#discussion_r502971487", "createdAt": "2020-10-11T22:02:13Z", "author": {"login": "trevan"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -93,39 +94,28 @@ public static GameData loadGame(final InputStream is) throws IOException {\n                 version,\n                 UrlConstants.DOWNLOAD_WEBSITE,\n                 UrlConstants.DOWNLOAD_WEBSITE));\n+        return Optional.empty();\n       } else if (!HeadlessGameServer.headless()\n           && ((Version) version).isGreaterThan(ClientContext.engineVersion())) {\n-        // we can still load it because our engine is compatible, however this save was made by a\n-        // newer engine, so prompt the user to upgrade\n-        promptToLoadNewerSaveGame();\n+        // Prompt the user to upgrade\n+        log.warn(\n+            \"This save was made by a newer version of TripleA.<br>\"\n+                + \"To load this save, download the latest version of TripleA: \"\n+                + \"<a href=\\\"{}\\\">{}</a>\",\n+            UrlConstants.DOWNLOAD_WEBSITE,\n+            UrlConstants.DOWNLOAD_WEBSITE);\n+        return Optional.empty();\n+      } else {\n+        final GameData data = (GameData) input.readObject();\n+        data.postDeSerialize();\n+        loadDelegates(input, data);\n+        return Optional.of(data);\n       }\n-\n-      final GameData data = (GameData) input.readObject();\n-      data.postDeSerialize();\n-      loadDelegates(input, data);\n-      return data;\n     } catch (final ClassNotFoundException cnfe) {\n-      throw new IOException(cnfe.getMessage());\n-    }\n-  }\n-\n-  private static void promptToLoadNewerSaveGame() throws IOException {\n-    // this is needed because a newer client might depend on variables that are part of the new\n-    // save but will be stripped by the old client. When the old client re-saves the data, the\n-    // new client will load the save game and be in odd state.\n-    final String messageString =\n-        \"This save was made by a newer version of TripleA.\"\n-            + \"\\nPlaying newer saves with an older engine can lead to unpredictable problems. \"\n-            + \"It is recommended that you upgrade to the latest version of TripleA before playing \"\n-            + \"this save game. To download the latest version of TripleA, Please visit \"\n-            + UrlConstants.DOWNLOAD_WEBSITE\n-            + \".\\n\"\n-            + \"\\n\\nDo you wish to continue and open this save with your current 'old' version?;\";\n-    final int answer =\n-        JOptionPane.showConfirmDialog(\n-            null, messageString, \"Open Newer Save Game?\", JOptionPane.YES_NO_OPTION);\n-    if (answer != JOptionPane.YES_OPTION) {\n-      throw new IOException(\"Loading the save game was aborted\");\n+      log.error(\"Error loading game data\", cnfe);\n+      return Optional.empty();\n+    } catch (final IOException e) {\n+      return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b5dd59d7da6b5236e5bfbb5658d9e3963a24308"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk3NzA0Ng==", "bodyText": "Yes, an error of omission on my part. That was something I had intended to come back to, updated in: c7ae2ca", "url": "https://github.com/triplea-game/triplea/pull/7876#discussion_r502977046", "createdAt": "2020-10-11T22:54:12Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -93,39 +94,28 @@ public static GameData loadGame(final InputStream is) throws IOException {\n                 version,\n                 UrlConstants.DOWNLOAD_WEBSITE,\n                 UrlConstants.DOWNLOAD_WEBSITE));\n+        return Optional.empty();\n       } else if (!HeadlessGameServer.headless()\n           && ((Version) version).isGreaterThan(ClientContext.engineVersion())) {\n-        // we can still load it because our engine is compatible, however this save was made by a\n-        // newer engine, so prompt the user to upgrade\n-        promptToLoadNewerSaveGame();\n+        // Prompt the user to upgrade\n+        log.warn(\n+            \"This save was made by a newer version of TripleA.<br>\"\n+                + \"To load this save, download the latest version of TripleA: \"\n+                + \"<a href=\\\"{}\\\">{}</a>\",\n+            UrlConstants.DOWNLOAD_WEBSITE,\n+            UrlConstants.DOWNLOAD_WEBSITE);\n+        return Optional.empty();\n+      } else {\n+        final GameData data = (GameData) input.readObject();\n+        data.postDeSerialize();\n+        loadDelegates(input, data);\n+        return Optional.of(data);\n       }\n-\n-      final GameData data = (GameData) input.readObject();\n-      data.postDeSerialize();\n-      loadDelegates(input, data);\n-      return data;\n     } catch (final ClassNotFoundException cnfe) {\n-      throw new IOException(cnfe.getMessage());\n-    }\n-  }\n-\n-  private static void promptToLoadNewerSaveGame() throws IOException {\n-    // this is needed because a newer client might depend on variables that are part of the new\n-    // save but will be stripped by the old client. When the old client re-saves the data, the\n-    // new client will load the save game and be in odd state.\n-    final String messageString =\n-        \"This save was made by a newer version of TripleA.\"\n-            + \"\\nPlaying newer saves with an older engine can lead to unpredictable problems. \"\n-            + \"It is recommended that you upgrade to the latest version of TripleA before playing \"\n-            + \"this save game. To download the latest version of TripleA, Please visit \"\n-            + UrlConstants.DOWNLOAD_WEBSITE\n-            + \".\\n\"\n-            + \"\\n\\nDo you wish to continue and open this save with your current 'old' version?;\";\n-    final int answer =\n-        JOptionPane.showConfirmDialog(\n-            null, messageString, \"Open Newer Save Game?\", JOptionPane.YES_NO_OPTION);\n-    if (answer != JOptionPane.YES_OPTION) {\n-      throw new IOException(\"Loading the save game was aborted\");\n+      log.error(\"Error loading game data\", cnfe);\n+      return Optional.empty();\n+    } catch (final IOException e) {\n+      return Optional.empty();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk3MTQ4Nw=="}, "originalCommit": {"oid": "0b5dd59d7da6b5236e5bfbb5658d9e3963a24308"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MDQ0MTk3OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMjowOTozMlrOHfs8TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMjowOTozMlrOHfs8TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAwNDIzNw==", "bodyText": "Avoid too many return statements within this method.", "url": "https://github.com/triplea-game/triplea/pull/7876#discussion_r503004237", "createdAt": "2020-10-12T02:09:32Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -77,13 +77,14 @@ public static GameData loadGame(final InputStream is) throws IOException {\n                 ((games.strategy.util.Version) version).getExactVersion(),\n                 UrlConstants.OLD_DOWNLOADS_WEBSITE,\n                 UrlConstants.OLD_DOWNLOADS_WEBSITE));\n-\n+        return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e697119819508c407656bd17fc08cd9962a477"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MDQ0MTk5OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMjowOTozM1rOHfs8UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMjowOTozM1rOHfs8UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAwNDI0MA==", "bodyText": "Avoid too many return statements within this method.", "url": "https://github.com/triplea-game/triplea/pull/7876#discussion_r503004240", "createdAt": "2020-10-12T02:09:33Z", "author": {"login": "codeclimate"}, "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -93,39 +94,26 @@ public static GameData loadGame(final InputStream is) throws IOException {\n                 version,\n                 UrlConstants.DOWNLOAD_WEBSITE,\n                 UrlConstants.DOWNLOAD_WEBSITE));\n+        return Optional.empty();\n       } else if (!HeadlessGameServer.headless()\n           && ((Version) version).isGreaterThan(ClientContext.engineVersion())) {\n-        // we can still load it because our engine is compatible, however this save was made by a\n-        // newer engine, so prompt the user to upgrade\n-        promptToLoadNewerSaveGame();\n+        // Prompt the user to upgrade\n+        log.warn(\n+            \"This save was made by a newer version of TripleA.<br>\"\n+                + \"To load this save, download the latest version of TripleA: \"\n+                + \"<a href=\\\"{}\\\">{}</a>\",\n+            UrlConstants.DOWNLOAD_WEBSITE,\n+            UrlConstants.DOWNLOAD_WEBSITE);\n+        return Optional.empty();\n+      } else {\n+        final GameData data = (GameData) input.readObject();\n+        data.postDeSerialize();\n+        loadDelegates(input, data);\n+        return Optional.of(data);\n       }\n-\n-      final GameData data = (GameData) input.readObject();\n-      data.postDeSerialize();\n-      loadDelegates(input, data);\n-      return data;\n-    } catch (final ClassNotFoundException cnfe) {\n-      throw new IOException(cnfe.getMessage());\n-    }\n-  }\n-\n-  private static void promptToLoadNewerSaveGame() throws IOException {\n-    // this is needed because a newer client might depend on variables that are part of the new\n-    // save but will be stripped by the old client. When the old client re-saves the data, the\n-    // new client will load the save game and be in odd state.\n-    final String messageString =\n-        \"This save was made by a newer version of TripleA.\"\n-            + \"\\nPlaying newer saves with an older engine can lead to unpredictable problems. \"\n-            + \"It is recommended that you upgrade to the latest version of TripleA before playing \"\n-            + \"this save game. To download the latest version of TripleA, Please visit \"\n-            + UrlConstants.DOWNLOAD_WEBSITE\n-            + \".\\n\"\n-            + \"\\n\\nDo you wish to continue and open this save with your current 'old' version?;\";\n-    final int answer =\n-        JOptionPane.showConfirmDialog(\n-            null, messageString, \"Open Newer Save Game?\", JOptionPane.YES_NO_OPTION);\n-    if (answer != JOptionPane.YES_OPTION) {\n-      throw new IOException(\"Loading the save game was aborted\");\n+    } catch (final ClassNotFoundException | IOException e) {\n+      log.error(\"Error loading game data\", e);\n+      return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53e697119819508c407656bd17fc08cd9962a477"}, "originalPosition": 135}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2740, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}