{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MjAxODUx", "number": 8119, "title": "Create AirBattleCombatValue objects and use them", "bodyText": "Move all of the air battle strength/roll/power logic to one place\nsimilar to the AA and main battle combat values work.\n\nTesting\n\nDid a hard AI run and manually played an air battle with break points to make sure strength/rolls/power was calculated correctly.\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note", "createdAt": "2020-11-07T22:49:35Z", "url": "https://github.com/triplea-game/triplea/pull/8119", "merged": true, "mergeCommit": {"oid": "24cd14982698f7a4e6f4ff7efb8adf6ce4b64b7d"}, "closed": true, "closedAt": "2020-11-08T18:25:37Z", "author": {"login": "trevan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaTL1FgH2gAyNTE3MjAxODUxOjBlMDVhMzFjYzEzNjdiYTdjYTViNmI3ODkwMWUyNWJjNjY5ZDdhNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdaUaE5gH2gAyNTE3MjAxODUxOjZkNTg2ZThjOWQyYzExMzg1NmVkOTliNDRmMjcyNzI5ZDBiYzQ1M2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e", "committedDate": "2020-11-07T22:20:23Z", "message": "Create AirBattleCombatValue objects and use them\n\nMove all of the air battle strength/roll/power logic to one place\nsimilar to the AA and main battle combat values work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09606127eca723a4797064ab93568d7e70de73d5", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/09606127eca723a4797064ab93568d7e70de73d5", "committedDate": "2020-11-07T23:08:20Z", "message": "Merge remote-tracking branch 'upstream/master' into air-battle-combat-value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjkwNTI3", "url": "https://github.com/triplea-game/triplea/pull/8119#pullrequestreview-525690527", "createdAt": "2020-11-07T23:08:43Z", "commit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzowODo0M1rOHvLWRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzowODo0M1rOHvLWRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTA0Nw==", "bodyText": "Is this comment correct? \"offense\" vs BattleDefense\nWhat is involved when calculating air battle combat value? How is this different from land battles? Answering those questions could perhaps make this a stronger javadoc to give a maintainer a good sense of what and how this class accomplishes it's goal.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231047", "createdAt": "2020-11-07T23:08:43Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjkwNTYz", "url": "https://github.com/triplea-game/triplea/pull/8119#pullrequestreview-525690563", "createdAt": "2020-11-07T23:09:16Z", "commit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzowOToxNlrOHvLWiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzowOToxNlrOHvLWiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTExNQ==", "bodyText": "minor, if you have '@getter' on every field, you can add it to the class to have it apply to all fields.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231115", "createdAt": "2020-11-07T23:09:16Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ba1890eb154c1764e85d87d3d8747a5f35afbf", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/74ba1890eb154c1764e85d87d3d8747a5f35afbf", "committedDate": "2020-11-07T23:19:32Z", "message": "Fix merge issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjkwNjQw", "url": "https://github.com/triplea-game/triplea/pull/8119#pullrequestreview-525690640", "createdAt": "2020-11-07T23:10:24Z", "commit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzoxMDoyNFrOHvLXCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QyMzoxOTozM1rOHvLaLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTI0Mw==", "bodyText": "minor, it can be a nicer syntax to use the 'underscore' variant, eg: @Getter(onMethod_ = @Override)", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231243", "createdAt": "2020-11-07T23:10:24Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTI4NA==", "bodyText": "@Value already includes @AllArgsConstructor, the latter should not be needed.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231284", "createdAt": "2020-11-07T23:10:53Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleDefenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleDefenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {\n+    return gameData.getDiceSides();\n+  }\n+\n+  @Value\n+  @AllArgsConstructor", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTM5NA==", "bodyText": "IIRC, 'getOwner' can return null for neutrals. Will that cause an issue here? I'd recommend adding a test case to verify this.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231394", "createdAt": "2020-11-07T23:11:56Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleDefenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleDefenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {\n+    return gameData.getDiceSides();\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseRoll implements RollCalculator {\n+\n+    @Override\n+    public RollValue getRoll(final Unit unit) {\n+      return RollValue.of(unit.getUnitAttachment().getDefenseRolls(unit.getOwner()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTQ2Nw==", "bodyText": "side-note, a no-op return value is code-smell (indicates that the API is overly-broad and that we implement a sub-set of the API only. It hints that the interface is actually mutiple interfaces and/or the methods on the interface have low cohesion). Any thoughts?", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231467", "createdAt": "2020-11-07T23:12:57Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleDefenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleDefenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {\n+    return gameData.getDiceSides();\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseRoll implements RollCalculator {\n+\n+    @Override\n+    public RollValue getRoll(final Unit unit) {\n+      return RollValue.of(unit.getUnitAttachment().getDefenseRolls(unit.getOwner()));\n+    }\n+\n+    @Override\n+    public Map<Unit, IntegerMap<Unit>> getSupportGiven() {\n+      return Map.of();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTYzOQ==", "bodyText": "side-note, I really wonder about our OO design. Generally an object should take care of its concerns and we could have a single method like \"unit.getAirDefenseStrength\". Keeping data and its access consistent is very important on the other hand so we probably should not mix it up until we can fix the majority of it in one go.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231639", "createdAt": "2020-11-07T23:14:45Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleDefenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleDefenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {\n+    return gameData.getDiceSides();\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseRoll implements RollCalculator {\n+\n+    @Override\n+    public RollValue getRoll(final Unit unit) {\n+      return RollValue.of(unit.getUnitAttachment().getDefenseRolls(unit.getOwner()));\n+    }\n+\n+    @Override\n+    public Map<Unit, IntegerMap<Unit>> getSupportGiven() {\n+      return Map.of();\n+    }\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseStrength implements StrengthCalculator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTc1Nw==", "bodyText": "This API is bothersome:\n unit.getUnitAttachment().getAirDefense(unit.getOwner()));\n\nA 'unit' should already know who it's owner is. The encapsulation around data is very weak, we have knowledge here of attachments, unit owners, the air defense type.. Any thoughts if this can be fixed?", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231757", "createdAt": "2020-11-07T23:16:08Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleDefenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleDefenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleDefenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleDefenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {\n+    return gameData.getDiceSides();\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseRoll implements RollCalculator {\n+\n+    @Override\n+    public RollValue getRoll(final Unit unit) {\n+      return RollValue.of(unit.getUnitAttachment().getDefenseRolls(unit.getOwner()));\n+    }\n+\n+    @Override\n+    public Map<Unit, IntegerMap<Unit>> getSupportGiven() {\n+      return Map.of();\n+    }\n+  }\n+\n+  @Value\n+  @AllArgsConstructor\n+  static class AirBattleDefenseStrength implements StrengthCalculator {\n+\n+    int diceSides;\n+\n+    @Override\n+    public StrengthValue getStrength(final Unit unit) {\n+      return StrengthValue.of(diceSides, unit.getUnitAttachment().getAirDefense(unit.getOwner()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMTg5Mg==", "bodyText": "Having a reference to a game data is a bit of a step backwards. It's a god-class and the fix for it is to avoid adding references to it.\nWhat if instead of passing the 'gameData' reference to the builder of this class, we push the responsibility getting the dice sides to the caller? That would also make this more of a value class as well where it really just holds values.", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519231892", "createdAt": "2020-11-07T23:17:51Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleOffenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleOffenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTIzMjA0NA==", "bodyText": "It's really odd that getDiceSides has Unit as a parameter. AFAIK we do not support per-unit dice sides, it's a global config for a game. Why is the unit parameter here? Do we ever user Unit to compute the dice sides value?", "url": "https://github.com/triplea-game/triplea/pull/8119#discussion_r519232044", "createdAt": "2020-11-07T23:19:33Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AirBattleOffenseCombatValue.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package games.strategy.triplea.delegate.power.calculator;\n+\n+import games.strategy.engine.data.GameData;\n+import games.strategy.engine.data.TerritoryEffect;\n+import games.strategy.engine.data.Unit;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Value;\n+import org.triplea.java.collections.IntegerMap;\n+\n+/** Calculates offense strength and roll for Air Battle dice */\n+@Builder\n+@Value\n+@Getter(AccessLevel.NONE)\n+class AirBattleOffenseCombatValue implements CombatValue {\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  GameData gameData;\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> friendUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<Unit> enemyUnits = List.of();\n+\n+  @Getter(onMethod = @__({@Override}))\n+  @NonNull\n+  @Builder.Default\n+  Collection<TerritoryEffect> territoryEffects = List.of();\n+\n+  @Override\n+  public RollCalculator getRoll() {\n+    return new AirBattleOffenseRoll();\n+  }\n+\n+  @Override\n+  public StrengthCalculator getStrength() {\n+    return new AirBattleOffenseStrength(gameData.getDiceSides());\n+  }\n+\n+  @Override\n+  public boolean isDefending() {\n+    return false;\n+  }\n+\n+  @Override\n+  public int getDiceSides(final Unit unit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e05a31cc1367ba7ca5b6b78901e25bc669d7a5e"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d586e8c9d2c113856ed99b44f272729d0bc453f", "author": {"user": {"login": "trevan", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/6d586e8c9d2c113856ed99b44f272729d0bc453f", "committedDate": "2020-11-07T23:45:51Z", "message": "Review feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3846, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}