{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODMyOTM0", "number": 5920, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0MTo1OFrODgLJTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwNTo0NTowMlrODiENyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzNjI4OnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0MTo1OFrOFqQT5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo1NDoxNVrOFqQWfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTc1MQ==", "bodyText": "Any objection to adding a comment to explain this regex a bit and give an example of what it matches?\nCan we simplify the regex, does it have to be this long or maybe strict? It is a bit scary looking and seems to be more specified than what we had. I'm not sure if we need it to be extremely \"strict\".", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379851751", "createdAt": "2020-02-15T19:41:58Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "diffHunk": "@@ -35,12 +35,15 @@\n import org.apache.http.util.EntityUtils;\n \n /** A pbem dice roller that reads its configuration from a properties file. */\n-@Log\n @Builder\n public final class MartiDiceRoller implements IRemoteDiceServer {\n   private static final int MESSAGE_MAX_LENGTH = 200;\n   private static final String DICE_ROLLER_PATH = \"/MARTI.php\";\n \n+  private final Pattern errorPattern = Pattern.compile(\"fatal error:(.*)!\");\n+  private final Pattern dicePattern =\n+      Pattern.compile(\"your dice are:\\\\s*((?:\\\\d(?:,\\\\d+)*)?)\\\\s*<p>\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjQxMw==", "bodyText": "The \"benefit\" of this regex being rather strict is that it allows us to avoid any further exception handling down below.\nSo we could of course simply it quite a bit, but would then have to re-introduce a try catch block below that rethrows an exception.\nBut yeah adding a comment is a good idea", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379852413", "createdAt": "2020-02-15T19:54:15Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "diffHunk": "@@ -35,12 +35,15 @@\n import org.apache.http.util.EntityUtils;\n \n /** A pbem dice roller that reads its configuration from a properties file. */\n-@Log\n @Builder\n public final class MartiDiceRoller implements IRemoteDiceServer {\n   private static final int MESSAGE_MAX_LENGTH = 200;\n   private static final String DICE_ROLLER_PATH = \"/MARTI.php\";\n \n+  private final Pattern errorPattern = Pattern.compile(\"fatal error:(.*)!\");\n+  private final Pattern dicePattern =\n+      Pattern.compile(\"your dice are:\\\\s*((?:\\\\d(?:,\\\\d+)*)?)\\\\s*<p>\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTc1MQ=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzNzA4OnYy", "diffSide": "RIGHT", "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0Mzo0NFrOFqQUWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0Mzo0NFrOFqQUWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTg2NQ==", "bodyText": "nit, missing either display name and/or assertion comment to explain why we expect this test to pass. I'd lean to an assertion comment personally to spell it out a bit.", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379851865", "createdAt": "2020-02-15T19:43:44Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzNzk1OnYy", "diffSide": "RIGHT", "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0NjowM1rOFqQU2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMDo1OTo1MFrOFqQjgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTk5Mg==", "bodyText": "nit, potentially over-specified test-case here. It's often not best to look for exact exception messages, instead if we check that key information is in the exception message than we get more flexibility. For example, we may want to change the message to be `Email 'user@mail.invalid' is not registered', which would fail this test. If we check instead that the marti URL and email address are present, then we are pretty sure the message is sufficient.\nSecond, the marti URL being hardcode is potentially something that is likely to change at some point, is there a constant somewhere that represents the same?", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379851992", "createdAt": "2020-02-15T19:46:03Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjkyOA==", "bodyText": "I had mixed feelings when writing the test cases.\nMy number one goal was to ensure nothing breaks with this change. That's why I simply went ahead an just copy-pasted an actual response from MARTI (and changed the email afterwards) to ensure that 1. the tests work with the original code and 2. they work with my new code which so we can be rather sure that nothing breaks.\nAfter that I wasn't sure if I should simplify the test to make it more readable, but also lose some of the safety guarantees", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379852928", "createdAt": "2020-02-15T20:03:18Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTk5Mg=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NTc0NA==", "bodyText": "That's a good approach in general, I think we can relax the assertions made in this line without losing that or over-simplifying.", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379855744", "createdAt": "2020-02-15T20:59:50Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTk5Mg=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzODM5OnYy", "diffSide": "RIGHT", "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTo0NzowOFrOFqQVDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjowMDoyMVrOFsZOYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng==", "bodyText": "Why is this assertion useful? Is it needed for correctness that the exception thrown have no cause?\nSide-note, it's really questionable already we are using exception for control-flow handling. The exception being thrown makes it hard to tell if we are seeing a case where the dice-roller is down, no network, or the totally expected case where a user is not yet registered.", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379852046", "createdAt": "2020-02-15T19:47:08Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MzQwMQ==", "bodyText": "Not really, it only sort-of ensures that this isn't some generic InvocationTargetException that is actually thrown for some legitimate reason.\nI mean I'm convinced the designers of InvocationTargetException made the cause a mandatory argument for a reason in the constructor, in 99% of all cases there should be a cause", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379853401", "createdAt": "2020-02-15T20:12:06Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1NTgzOQ==", "bodyText": "Hmm, isn't 99% of all cases a user not being registered? It seems like almost everyone hits that case and before this exception message was the thing to tell you to register. It was a common problem that people would not grok the error message and were just left confused how to make the system work.\nOverall, I think the root problem is we are dealing with control-flow-by-exception-handling anti-pattern.\nIf we are verifying those criteria, we can add messages to the assertion to document the reasoning and perhaps check the instance of the exception as well.", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379855839", "createdAt": "2020-02-15T21:01:38Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1Nzc5NQ==", "bodyText": "Do you think it would help using an unchecked custom exception and throwing that and just catching a generic RuntimeException somewhere else?\nIn this case neither the exception message nor any exception causes would be relevant", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379857795", "createdAt": "2020-02-15T21:39:31Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1OTY0Nw==", "bodyText": "My thinking, at a low level, there should be something that does the send test and returns a payload that has an error message or a success flag. Any exception would then be for cases where we can't connect or cannot send. If there is a difference in how we would recover from such a scenario, then different exceptions would be appropriate.\nCatching unchecked exceptions, or throwing a custom exception and then doing a catch-all to catch any runtime exception does not seem super easy to grok. Exceptions are effectively glorified GOTO statements after-all.\nGetting back to this test case, I think the things to do, to make the test clear, would be:\n\n\nadd an assertion comment to explain why we are verifying the condition. You stated so much in response to my questions earlier: \"it only sort-of ensures that this isn't some generic InvocationTargetException that is actually thrown for some legitimate reason.\"\n\n\nPerhaps also verify the instance type of the exception is an InvocationTargetException", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r379859647", "createdAt": "2020-02-15T22:15:57Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA5NDk0NA==", "bodyText": "@DanVanAtta I re-did some of the Exceptions.\nBasically explicit server error messages like \"wrong/missing email\" etc. now have their own exception type and the code has to explicitly catch that.\nSemantic Errors like the server returning an invalid string that doesn't match the pattern is now treated as IllegalStateException, never explicitly caught and is supposed to be a likely programmer error.\nAll kind of network related exceptions are now treaded as such. As user-fixable errors and provides a link to the forum in case the error doesn't go away.\nLet me know what you think, I tested all 3 scenarios (by changing the source code to invalid servers/URLs and entering non existing emails) and I believe the error pop-up seems appropriate in each case and provides the right amount of information to debug the issue.", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r382094944", "createdAt": "2020-02-20T16:00:21Z", "author": {"login": "RoiEXLab"}, "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package games.strategy.engine.random;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.hamcrest.collection.IsArray.array;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+import java.io.IOException;\n+import java.lang.reflect.InvocationTargetException;\n+import java.net.URI;\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+\n+public class MartiDiceRollerTest {\n+  private static final String successMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\t<p>Dice results were sent via email.</p>\"\n+          + \"<br><a href='https://dice.marti.triplea-game.org/MARTI_verify.php?iv=oTVwKksuDf4f0LW4j\"\n+          + \"6U6yAklQWsxpdac%2FmX1NMP7uXY%3D&enc=vhDa64l%2FORX6X8di6LVdl5JQGC81uQyKE4Jt0gHoVsOV5Uxz\"\n+          + \"msbVReOsBQonZmQi7JZAwGhL4HoFXzkJMjilNX1gRMs5%2FhXyjyoUryYGPzgOWIVG7IxkuOMRiot7kPqJQwNc\"\n+          + \"f08ev8TNj9WxZTSWPNy2j1Y17piXRn%2FffXIGPDDcrmw2rSeB3lCq6ZjlKSmMCIqEXk%2FSsJjQO7jKq7CkWT\"\n+          + \"ZPY2QxTfFuOmFEj1Ji7pp1GVuVcc5g90q5'>Click here to verify the roll.</a>\"\n+          + \"<br>your dice are: 2,5,1<p><p>\\t</body>\\n\"\n+          + \"</html>\";\n+\n+  private static final String failureMessage =\n+      \"<!DOCTYPE html>\\n\"\n+          + \"<html>\\n\"\n+          + \"\\t<head>\\n\"\n+          + \"\\t\\t<title>M.A.R.T.I. Server -- \\\"more accurate rolls than irony\\\"</title>\\n\"\n+          + \"\\t</head>\\n\"\n+          + \"\\t<body>\\n\"\n+          + \"\\t\\tfatal error: Emails [user@mail.invalid] are not registered.\"\n+          + \" Please register them at https://dice.marti.triplea-game.org/register.php .!\\n\"\n+          + \"\\n\";\n+\n+  private final MartiDiceRoller martiDiceRoller =\n+      MartiDiceRoller.builder()\n+          .diceRollerUri(URI.create(\"http://uri.invalid\"))\n+          .ccAddress(\"\")\n+          .toAddress(\"\")\n+          .gameId(\"\")\n+          .build();\n+\n+  @Test\n+  @SuppressWarnings(\"unchecked\")\n+  void successfulMessageExtraction() throws Exception {\n+    final Integer[] dice =\n+        Arrays.stream(martiDiceRoller.getDice(successMessage, 0)).boxed().toArray(Integer[]::new);\n+\n+    assertThat(dice, is(array(equalTo(1), equalTo(4), equalTo(0))));\n+  }\n+\n+  @Test\n+  void unsuccessfulMessageExtraction() {\n+    final Exception exception =\n+        assertThrows(\n+            InvocationTargetException.class, () -> martiDiceRoller.getDice(failureMessage, 0));\n+    assertThat(\n+        exception.getMessage(),\n+        is(\n+            \" Emails [user@mail.invalid] are not registered.\"\n+                + \" Please register them at https://dice.marti.triplea-game.org/register.php .\"));\n+    assertThat(exception.getCause(), is(nullValue()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MjA0Ng=="}, "originalCommit": {"oid": "0f5284cf242257eb2d3a585fbdd398eadbd5d389"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MDQ3MjQzOnYy", "diffSide": "RIGHT", "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwNTo0NTowMlrOFtJr0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwNTo0NTowMlrOFtJr0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg4ODkxMg==", "bodyText": "Nit, we should keep in mind the audience of exception messages. Things like \"String\" is geared towards a developer, would not otherwise make sense to an end user. They want to know what happened and what they should do about it if anything.\nWith that said, this exception type and message are fine for now. We may though want to consider creating some infrastructure that would suffix an error message with something like \"This is an unexpected error and indicates a bug. Please report this to TripleA development\"", "url": "https://github.com/triplea-game/triplea/pull/5920#discussion_r382888912", "createdAt": "2020-02-22T05:45:02Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "diffHunk": "@@ -96,16 +95,15 @@ public String postRequest(\n   }\n \n   @Override\n-  public int[] getDice(final String string, final int count)\n-      throws IOException, InvocationTargetException {\n+  public int[] getDice(final String string, final int count) throws DiceServerException {\n     final Matcher errorMatcher = errorPattern.matcher(string);\n     if (errorMatcher.find()) {\n-      throw new InvocationTargetException(null, errorMatcher.group(1));\n+      throw new DiceServerException(errorMatcher.group(1));\n     }\n \n     final Matcher diceMatcher = dicePattern.matcher(string);\n     if (!diceMatcher.find()) {\n-      throw new IOException(\"String '\" + string + \"' has an invalid format.\");\n+      throw new IllegalStateException(\"String '\" + string + \"' has an invalid format.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1ee406d4c51feb36653cb31f7b46dacac68bba3"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2461, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}