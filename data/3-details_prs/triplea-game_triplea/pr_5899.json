{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMTI2NDIy", "number": 5899, "title": "Clean Up and Restructure Travis Build Scripts", "bodyText": "Re-structure Build Scripts\n\nGoal was to make it so .travis.yml contained very little to any logic at all for build commands.\nSecond, by grouping build jobs together, the script structure and scope of which scripts were\nused for what is hopefully now more clear.\nThe new script configuration places build scripts into their own folders following this\nconvention: '.travis/stages///run'. Any additional support scripts\nused by a given job will be in the 'job' folder. For most part, any .travis.yml build job\nwill just call a 'run' a script and nothing more\nScripts that are shared between multiple jobs are now located in '.travis/shared/'\n\n\n\nBreak up Build Jobs\n\nResults in a slightly faster build as we get better parallelism, and the slowest build is now\nslightly faster as it has fewer tasks to perform.\nError output is more focused, looking at which build job failed we can get a pretty good idea\nof what went wrong without looking at the logs\nWe get more feedback. Rather than knowing that just tests failed, we can see which parts of the\nbuild passed and which pieces failed. For example, if there is just a checkstyle violation,\nthen we'll see just one failure for checkstyle and everything else would pass.\n\n\n\nClean up .travis.yml\n\nBuild logic extracted to a 'run' script\nLists and maps written with a single line syntax where possible and clean.\nCommon operations, like \"install: false\", and \"cache: ..\" are extracted to a top level\nwhere they become common for all jobs.\n\n\n\nRemove java-11.0.5 install\n\n11.0.2 is currently doing the job. We added the 11.0.5 install to mitigate a TLS versioning\nissue where connections to JCenter were being rejected due to our version of TLS being too low.\nBackground info: #5480\nIt appears the problem is currently mitigated or patched on the Travis side as 11.0.2 is working.\nWe can restore the 11.0.5 install pretty readily if the need arises again, in the meantime it's\nnot necessary (and adds unwanted complexity).\n\n\n\nMove error reporting to a top-level task (out of build scripts) and be consistent\n\nWith all build jobs extracted to folders and invoked on a single line in .travis.yml,\nwe can more cleanly execute a build job fail handler by adding \"|| $REPORT_FAIL\" to\nthe end of each run script. This means if any script fails, we'll call the report-fail handler\nto consistently have an issue be created whenever we see a build failure.\nNote: we filter PR builds by checking to see if needed env variables that are only available\nto a master branch build are present, if they are not, the 'report-fail' script is a no-op.\n\n\n\nMove Succuss Detection to a final Stage\n\nWe no longer require a specific script to detect if the build passed and report success. Instead\nthere is now a third and final build stage that will report a success and close any 'Build failed'\nissues that may be open. This is in part to make it so that each build script in .travis/ can be\nmore focused on just one task.\n\n\n\nUpdates to Prod Deployment - Just Install SSH Keys and Security updates\n\nImplicitly, decided prod deployments will be done 'by-hand'\nProd will be updated on every build, but it'll only have SSH keys deployed and security patches\napplied, no binaries or configuration will be changed.\n\n\n\n \nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[x] Configuration Change\n[] Problem fix:  \n[] Other:   \nTesting\n\n[x] Manual testing done\n\nVerified branch build looks good\nDisabled conditional checks in .travis.yml to verify the 'deploy' stage builds looked good. They still died due to 'variable not defined' errors, but seemingly looked to be well configured FWIW.\n\nDid not verify a build fail issue would be created on failure or closed on success.\n\n\n\nAdditional Review Notes\n\nGiven some of the build steps are only done on master branch, I expect there may be some fast-follow iterations to fix minor problems that were not found during testing.\nThe diff's are likely not easy to follow as much was moved:\n\nThe .travis.yml script was restructured, recommend to view it in its new state without any diff lines. Please provide feedback on structure, naming of stages, and if job and stage breakup makes sense.\n\n\nPlease have a look at the new folder structure, check if that looks good.\nBuild scripts are simplified/broken up, there is no new functionality or any removed.\n\nScreens Shots\nTravis Jobs Before\n\nTravis Jobs After\n\nFolder structure before:\n\nFolder structure after:\n\n.travis.yml Before (sample)\n\n.travis.yml After (sample)", "createdAt": "2020-02-03T05:22:20Z", "url": "https://github.com/triplea-game/triplea/pull/5899", "merged": true, "mergeCommit": {"oid": "f761837be81c58a3d94372b0fd458d41eb8055de"}, "closed": true, "closedAt": "2020-02-07T03:41:21Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAl3keAH2gAyMzcwMTI2NDIyOjEzNTNiOWIxMjFkOTNhZDQyNzVmODU1YjJjNDA3NDlmMWMxOTI0Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB2uqhgH2gAyMzcwMTI2NDIyOjhlOWU3ODkxM2QxN2QwNzNmNTBhOTFiZmU0ODkwYTMyMDEwYzcxMWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1353b9b121d93ad4275f855b2c40749f1c192437", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/1353b9b121d93ad4275f855b2c40749f1c192437", "committedDate": "2020-02-03T05:13:16Z", "message": "Clean Up and Restructure Travis Build Scripts\n\n- **Re-structure Build Scripts**\n  - Goal was to make it so .travis.yml contained very little to any logic at all for build commands.\n    Second, by grouping build jobs together, the script structure and scope of which scripts were\n    used for what is hopefully now more clear.\n  - The new script configuration places build scripts into their own folders following this\n    convention: '.travis/stages/<stage-name>/<job-name>/run'. Any additional support scripts\n    used by a given job will be in the 'job' folder. For most part, any .travis.yml build job\n    will just call a 'run' a script and nothing more\n  - Scripts that are shared between multiple jobs are now located in '.travis/shared/'\n\n- **Break up Build Jobs**\n  - Results in a slightly faster build as we get better parallelism, and the slowest build is now\n    slightly faster as it has fewer tasks to perform.\n  - Error output is more focused, looking at which build job failed we can get a pretty good idea\n    of what went wrong without looking at the logs\n  - We get more feedback. Rather than knowing that just tests failed, we can see which parts of the\n    build passed and which pieces failed. For example, if there is just a checkstyle violation,\n    then we'll see just one failure for checkstyle and everything else would pass.\n\n- **Clean up .travis.yml**\n  - Build logic extracted to a 'run' script\n  - Lists and maps written with a single line syntax where possible and clean.\n  - Common operations, like \"install: false\", and \"cache: ..\" are extracted to a top level\n    where they become common for all jobs.\n\n- **Remove java-11.0.5 install**\n  - 11.0.2 is currently doing the job. We added the 11.0.5 install to mitigate a TLS versioning\n    issue where connections to JCenter were being rejected due to our version of TLS being too low.\n    Background info: https://github.com/triplea-game/triplea/issues/5480\n    It appears the problem is currently mitigated or patched on the Travis side as 11.0.2 is working.\n    We can restore the 11.0.5 install pretty readily if the need arises again, in the meantime it's\n    not necessary (and adds unwanted complexity).\n\n- **Move error reporting to a top-level task (out of build scripts) and be consistent**\n  - With all build jobs extracted to folders and invoked on a single line in .travis.yml,\n    we can more cleanly execute a build job fail handler by adding \"|| $REPORT_FAIL\" to\n    the end of each run script. This means if any script fails, we'll call the report-fail handler\n    to consistently have an issue be created whenever we see a build failure.\n    Note: we filter PR builds by checking to see if needed env variables that are only available\n    to a master branch build are present, if they are not, the 'report-fail' script is a no-op.\n\n- **Move Succuss Detection to a final Stage**\n  - We no longer require a specific script to detect if the build passed and report success. Instead\n    there is now a third and final build stage that will report a success and close any 'Build failed'\n    issues that may be open. This is in part to make it so that each build script in .travis/ can be\n    more focused on just one task.\n\n- **Updates to Prod Deployment - Just Install SSH Keys and Security updates**\n  - Implicitly, decided prod deployments will be done 'by-hand'\n  - Prod will be updated on every build, but it'll only have SSH keys deployed and security patches\n    applied, no binaries or configuration will be changed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzOTA3MDI0", "url": "https://github.com/triplea-game/triplea/pull/5899#pullrequestreview-353907024", "createdAt": "2020-02-05T17:34:09Z", "commit": {"oid": "1353b9b121d93ad4275f855b2c40749f1c192437"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNzozNDowOVrOFmAwgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNzozODo0MFrOFmA5YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwMjYyNQ==", "bodyText": "Hmm, I think this mix of the yaml 1.1 syntax and the newer 1.2 syntax is a little bot weird here and there.\nThis line in particular doesn't add to readability IMO, but personal preference I guess", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375402625", "createdAt": "2020-02-05T17:34:09Z", "author": {"login": "RoiEXLab"}, "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Tests: Unit Test\"\n+      script: [ $VERIFY_STAGE/unit-testing/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Tests: Smoke Test\"\n       addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - ./.travis/setup_database\n-        - ./.travis/run_smoke_tests\n-    - stage: deploy artifacts\n-      env: \"Upload to Github Releases\"\n+      script: [ $VERIFY_STAGE/smoke-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: PMD Verification\"\n+      script: [ $VERIFY_STAGE/pmd-verification/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Checkstyle\"\n+      script: [ $VERIFY_STAGE/checkstyle/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Java Formatting\"\n+      script: [ $VERIFY_STAGE/java-formatting/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Check Links and YAML Syntax\"\n+      script: [ $VERIFY_STAGE/check-links-and-yaml-syntax/run || $REPORT_FAIL ]\n+      \n+    - stage: Verify\n+      name: \"Analysis: Code Convention Checks\"\n+      script: [ $VERIFY_STAGE/code-convention-checks/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: Find Unused or Unmatched Tests\"\n+      script: [ $VERIFY_STAGE/find-unused-or-unmatched-tests/run || $REPORT_FAIL ]\n+\n+    ########################################################################\n+\n+    - stage: Deploy\n+      name: \"Push Map Descriptions to Website\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      addons: { apt: { packages: [ python3, python3-yaml ] } }\n+      script: [ $DEPLOY_STAGE/update-maps-on-website/run || $REPORT_FAIL ]     \n+\n+    - stage: Deploy\n+      name: \"Ansible Deploy to Prerelease\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      language: python\n+      python: \"3.6\"\n+      addons: { apt: { packages: [ sshpass ] } }\n+      install: [ pip install ansible ]\n+      script: [ $DEPLOY_STAGE/ansible-deploy-to-prerelease/run || $REPORT_FAIL ]\n+\n+    - stage: Deploy\n+      name: \"Build Installer Downloads & Upload to Github Releases\"\n       if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n-      install: skip\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      script:\n-        - ./.travis/setup_gpg\n-        ## Update product version to include build number.\n-        ## EG: replace \"2.0.0\" to be \"2.0.15555\";\n-        - sed -i \"s/.0 *$/.$TRAVIS_BUILD_NUMBER/\" game-core/src/main/resources/META-INF/triplea/product.properties\n-        - ./.travis/do_release\n+      script: [ $DEPLOY_STAGE/installers/run || $REPORT_FAIL ]\n       deploy:\n+        on: { tags: false, repo: triplea-game/triplea, branch: master }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1353b9b121d93ad4275f855b2c40749f1c192437"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDI5MQ==", "bodyText": "For all of the script parts: I'm pretty sure that travis doesn't care if a list or a single entry is given. After all the default value for this key should be ./gradlew check IIRC", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375404291", "createdAt": "2020-02-05T17:37:26Z", "author": {"login": "RoiEXLab"}, "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1353b9b121d93ad4275f855b2c40749f1c192437"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDg5Ng==", "bodyText": "The same thing here, similar to the script thingy. It shouldn't be necessary to add list brackets here.", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375404896", "createdAt": "2020-02-05T17:38:40Z", "author": {"login": "RoiEXLab"}, "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Tests: Unit Test\"\n+      script: [ $VERIFY_STAGE/unit-testing/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Tests: Smoke Test\"\n       addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - ./.travis/setup_database\n-        - ./.travis/run_smoke_tests\n-    - stage: deploy artifacts\n-      env: \"Upload to Github Releases\"\n+      script: [ $VERIFY_STAGE/smoke-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: PMD Verification\"\n+      script: [ $VERIFY_STAGE/pmd-verification/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Checkstyle\"\n+      script: [ $VERIFY_STAGE/checkstyle/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Java Formatting\"\n+      script: [ $VERIFY_STAGE/java-formatting/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Check Links and YAML Syntax\"\n+      script: [ $VERIFY_STAGE/check-links-and-yaml-syntax/run || $REPORT_FAIL ]\n+      \n+    - stage: Verify\n+      name: \"Analysis: Code Convention Checks\"\n+      script: [ $VERIFY_STAGE/code-convention-checks/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: Find Unused or Unmatched Tests\"\n+      script: [ $VERIFY_STAGE/find-unused-or-unmatched-tests/run || $REPORT_FAIL ]\n+\n+    ########################################################################\n+\n+    - stage: Deploy\n+      name: \"Push Map Descriptions to Website\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      addons: { apt: { packages: [ python3, python3-yaml ] } }\n+      script: [ $DEPLOY_STAGE/update-maps-on-website/run || $REPORT_FAIL ]     \n+\n+    - stage: Deploy\n+      name: \"Ansible Deploy to Prerelease\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      language: python\n+      python: \"3.6\"\n+      addons: { apt: { packages: [ sshpass ] } }\n+      install: [ pip install ansible ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1353b9b121d93ad4275f855b2c40749f1c192437"}, "originalPosition": 156}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e9e78913d17d073f50a91bfe4890a32010c711c", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8e9e78913d17d073f50a91bfe4890a32010c711c", "committedDate": "2020-02-07T03:25:51Z", "message": "Remove unnecessary openJDK spec"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3779, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}