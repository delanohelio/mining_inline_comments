{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NTAwMDI2", "number": 6289, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxODozNjoyMlrODzP-BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxODozNjoyMlrODzP-BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MDY1NjA0OnYy", "diffSide": "LEFT", "path": "game-core/src/main/java/games/strategy/engine/data/UnitHitsChange.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxODozNjoyMlrOGHtN1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQyMDoyNToxMlrOGHt9Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczNDAzOA==", "bodyText": "Is this disjoint check just not needed in the end?", "url": "https://github.com/triplea-game/triplea/pull/6289#discussion_r410734038", "createdAt": "2020-04-18T18:36:22Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/data/UnitHitsChange.java", "diffHunk": "@@ -10,35 +9,42 @@\n \n   private final IntegerMap<Unit> hits;\n   private final IntegerMap<Unit> undoHits;\n+  private final Collection<Territory> territoriesToNotify;\n \n-  private UnitHitsChange(final IntegerMap<Unit> hits, final IntegerMap<Unit> undoHits) {\n+  private UnitHitsChange(\n+      final IntegerMap<Unit> hits,\n+      final IntegerMap<Unit> undoHits,\n+      final Collection<Territory> territoriesToNotify) {\n     this.hits = hits;\n     this.undoHits = undoHits;\n+    this.territoriesToNotify = territoriesToNotify;\n   }\n \n-  public UnitHitsChange(final IntegerMap<Unit> hits) {\n-    this.hits = new IntegerMap<>(hits);\n-    undoHits = new IntegerMap<>();\n-    for (final Unit item : this.hits.keySet()) {\n+  public UnitHitsChange(\n+      final IntegerMap<Unit> hits, final Collection<Territory> territoriesToNotify) {\n+    this(new IntegerMap<>(hits), undoHits(hits), territoriesToNotify);\n+  }\n+\n+  private static IntegerMap<Unit> undoHits(final IntegerMap<Unit> hits) {\n+    final var undoHits = new IntegerMap<Unit>();\n+    for (final Unit item : hits.keySet()) {\n       undoHits.put(item, item.getHits());\n     }\n+    return undoHits;\n   }\n \n   @Override\n   protected void perform(final GameData data) {\n     for (final Unit item : hits.keySet()) {\n       item.setHits(hits.getInt(item));\n     }\n-    final Set<Unit> units = hits.keySet();\n-    for (final Territory element : data.getMap().getTerritories()) {\n-      if (!Collections.disjoint(element.getUnits(), units)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dc31a1f1cba2accd269510d79987b3a7cabf722"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0NjE1OQ==", "bodyText": "That's right. The old code was using it to determine if the affected units are in the territory in question. Now, we track that directly, so this is removed. (This call was what was so slow in the first place.)", "url": "https://github.com/triplea-game/triplea/pull/6289#discussion_r410746159", "createdAt": "2020-04-18T20:25:12Z", "author": {"login": "asvitkine"}, "path": "game-core/src/main/java/games/strategy/engine/data/UnitHitsChange.java", "diffHunk": "@@ -10,35 +9,42 @@\n \n   private final IntegerMap<Unit> hits;\n   private final IntegerMap<Unit> undoHits;\n+  private final Collection<Territory> territoriesToNotify;\n \n-  private UnitHitsChange(final IntegerMap<Unit> hits, final IntegerMap<Unit> undoHits) {\n+  private UnitHitsChange(\n+      final IntegerMap<Unit> hits,\n+      final IntegerMap<Unit> undoHits,\n+      final Collection<Territory> territoriesToNotify) {\n     this.hits = hits;\n     this.undoHits = undoHits;\n+    this.territoriesToNotify = territoriesToNotify;\n   }\n \n-  public UnitHitsChange(final IntegerMap<Unit> hits) {\n-    this.hits = new IntegerMap<>(hits);\n-    undoHits = new IntegerMap<>();\n-    for (final Unit item : this.hits.keySet()) {\n+  public UnitHitsChange(\n+      final IntegerMap<Unit> hits, final Collection<Territory> territoriesToNotify) {\n+    this(new IntegerMap<>(hits), undoHits(hits), territoriesToNotify);\n+  }\n+\n+  private static IntegerMap<Unit> undoHits(final IntegerMap<Unit> hits) {\n+    final var undoHits = new IntegerMap<Unit>();\n+    for (final Unit item : hits.keySet()) {\n       undoHits.put(item, item.getHits());\n     }\n+    return undoHits;\n   }\n \n   @Override\n   protected void perform(final GameData data) {\n     for (final Unit item : hits.keySet()) {\n       item.setHits(hits.getInt(item));\n     }\n-    final Set<Unit> units = hits.keySet();\n-    for (final Territory element : data.getMap().getTerritories()) {\n-      if (!Collections.disjoint(element.getUnits(), units)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDczNDAzOA=="}, "originalCommit": {"oid": "0dc31a1f1cba2accd269510d79987b3a7cabf722"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2272, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}