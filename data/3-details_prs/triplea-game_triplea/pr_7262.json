{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2ODI1MzAz", "number": 7262, "title": "Server launcher", "bodyText": "Few simplifications & the 4th commit is a bug fix to address: #7205\nOverview\nIn short, we add error handling such that we'll catch any errors when loading a game but before launching. Previously we did not catch any errors which then put the game in a bad state. Specifically we set a 'isLaunching' flag on construction and set it to false in 'launch'. If we hit any errors on 'load', then we'd never clear the 'launch' flag which would contribute to a stuck bot.\nCommits\ncommit 4ef63fb\nRemove AbstractLauncher, inline to children classes\n\ncommit 8daf6c0\nImprove server startup logging\n\ncommit aa332e1\nSimplify, always do crypto warm-up even\n\nIf the crypto source warm-up helps, we may as well do it for\nany multiplayer game whether it is just one player or not.\n\ncommit 13a4dd2\nFix: catch errors when launching a server game and abort cleanly\n\nIf there are any errors during game load then players will not\nbe ejected from their seats. In this case when the game stops,\nfor bots, all seats will still be occupied, the game will\nnot actually be running, and users joining will get a \"game is\nlaunching, try joining later\" message. This is a dead-state\nfor bots as the seats are full, cannot be emptied, and a game\nis not actually running. This update resolves that situation\nby resetting games if there any errors on load.\n\nOf note, it's critical the game would reach the 'launch' functionality\nto clear the 'isLaunching' flag. If we terminate earlier then the\ngame would be stuck in a 'isLaunching' state.\n\n\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[x] Code Cleanup or refactor\n[] Configuration Change\n[x] Problem fix\n[] Other:   \nTesting\n\nInjected an artificial exception between load and launch, verified we observe the same behavior as we see on the lobby with bots in such a situation.\nVerified post-fix the same artificial exception caused the bot to reset and new games could be started\n\n\nScreens Shots\n\nAdditional Notes to Reviewer\n\nRelease Note\n\nFIX|Improve server launching to better handle startup errors, prevents a 'stuck' server state.", "createdAt": "2020-07-27T00:04:05Z", "url": "https://github.com/triplea-game/triplea/pull/7262", "merged": true, "mergeCommit": {"oid": "ba3ff3a841c4eac8abe5866c6b9eaff945d32ced"}, "closed": true, "closedAt": "2020-07-27T11:15:57Z", "author": {"login": "DanVanAtta"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc41VWoAH2gAyNDU2ODI1MzAzOjRlZjYzZmJlNDQwZTE4YzI1Mjk3MmU1NjllOGZmMWM2NmUzMzFkOGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4_8P2AFqTQ1NTY4OTMxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ef63fbe440e18c252972e569e8ff1c66e331d8f", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/4ef63fbe440e18c252972e569e8ff1c66e331d8f", "committedDate": "2020-07-26T22:54:08Z", "message": "Remove AbstractLauncher, inline to children classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8daf6c051d75c4616136f9cc3f2560cb5d1f8838", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/8daf6c051d75c4616136f9cc3f2560cb5d1f8838", "committedDate": "2020-07-26T23:44:10Z", "message": "Improve server startup logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa332e19d3930b1df3c37a3e4dd37fc434db6d7b", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/aa332e19d3930b1df3c37a3e4dd37fc434db6d7b", "committedDate": "2020-07-26T23:44:21Z", "message": "Simplify, always do crypto warm-up even\n\nIf the crypto source warm-up helps, we may as well do it for\nany multiplayer game whether it is just one player or not."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a4dd25cc50a737ef1a0b2bc3b584425fc55b74", "author": {"user": {"login": "DanVanAtta", "name": "Dan Van Atta"}}, "url": "https://github.com/triplea-game/triplea/commit/13a4dd25cc50a737ef1a0b2bc3b584425fc55b74", "committedDate": "2020-07-27T00:00:42Z", "message": "Fix: catch errors when launching a server game and abort cleanly\n\nIf there are any errors during game load then players will not\nbe ejected from their seats. In this case when the game stops,\nfor bots, all seats will still be occupied, the game will\nnot actually be running, and users joining will get a \"game is\nlaunching, try joining later\" message. This is a dead-state\nfor bots as the seats are full, cannot be emptied, and a game\nis not actually running. This update resolves that situation\nby resetting games if there any errors on load.\n\nOf note, it's critical the game would reach the 'launch' functionality\nto clear the 'isLaunching' flag. If we terminate earlier then the\ngame would be stuck in a 'isLaunching' state."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NDA4NTI4", "url": "https://github.com/triplea-game/triplea/pull/7262#pullrequestreview-455408528", "createdAt": "2020-07-27T00:08:22Z", "commit": {"oid": "13a4dd25cc50a737ef1a0b2bc3b584425fc55b74"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwMDowODoyMlrOG3QQjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwMDowODoyMlrOG3QQjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU5MTI0NA==", "bodyText": "Codacy found an issue: Too many fields", "url": "https://github.com/triplea-game/triplea/pull/7262#discussion_r460591244", "createdAt": "2020-07-27T00:08:22Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/engine/framework/startup/launcher/ServerLauncher.java", "diffHunk": "@@ -23,19 +23,17 @@\n import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n-import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n import java.util.logging.Level;\n-import javax.annotation.Nullable;\n import lombok.extern.java.Log;\n import org.triplea.java.Interruptibles;\n import org.triplea.lobby.common.GameDescription;\n \n /** Implementation of {@link ILauncher} for a headed or headless network server game. */\n @Log\n-public class ServerLauncher extends AbstractLauncher<Void> {\n+public class ServerLauncher implements ILauncher {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13a4dd25cc50a737ef1a0b2bc3b584425fc55b74"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Njg5MzE0", "url": "https://github.com/triplea-game/triplea/pull/7262#pullrequestreview-455689314", "createdAt": "2020-07-27T11:15:40Z", "commit": {"oid": "13a4dd25cc50a737ef1a0b2bc3b584425fc55b74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3244, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}