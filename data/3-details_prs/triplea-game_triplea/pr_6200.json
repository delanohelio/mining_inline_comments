{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMjYzODQx", "number": 6200, "title": "Make Territory.getUnits() return an unmodifiable list. (Reland)", "bodyText": "Make Territory.getUnits() return an unmodifiable list. (Reland)\nPreviously, it was returning a copy, which was actually quite expensive given how often this was called. On a Domination 1914 game, with all AIs, this took 100 seconds of CPU time (across different threads since it's used in battle sim) over a single round.\nA few places that need a copy are updated to do the copy on their side.\nFunctional Changes\n\n[] New map or map update\n[] New Feature\n[] Feature update or enhancement\n[] Feature Removal\n[] Code Cleanup or refactor\n[] Configuration Change\n[] Problem fix:\n[X] Other:   Optimization\nTesting\nRan ./verify", "createdAt": "2020-04-12T00:01:44Z", "url": "https://github.com/triplea-game/triplea/pull/6200", "merged": true, "mergeCommit": {"oid": "7995925ae36751c4befaca51801b04022ef143f6"}, "closed": true, "closedAt": "2020-04-12T18:41:55Z", "author": {"login": "asvitkine"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWpuB4AH2gAyNDAyMjYzODQxOmRhY2ZmMWNmMDk4NWY4NzhkYjdjNzVjNjE0NGRkMWU5YjVhYzRlYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWwNoggFqTM5MTgxMzY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dacff1cf0985f878db7c75c6144dd1e9b5ac4ea3", "author": {"user": {"login": "asvitkine", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/dacff1cf0985f878db7c75c6144dd1e9b5ac4ea3", "committedDate": "2020-04-11T18:08:48Z", "message": "Make Territory.getUnits() return an unmodifiable list."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1379a2d68f2892a0250c903a85f7856607a9cd2d", "author": {"user": {"login": "asvitkine", "name": null}}, "url": "https://github.com/triplea-game/triplea/commit/1379a2d68f2892a0250c903a85f7856607a9cd2d", "committedDate": "2020-04-11T23:46:08Z", "message": "Fix error from making getUnits() unmodifiable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODEzNjk3", "url": "https://github.com/triplea-game/triplea/pull/6200#pullrequestreview-391813697", "createdAt": "2020-04-12T01:42:44Z", "commit": {"oid": "1379a2d68f2892a0250c903a85f7856607a9cd2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMTo0Mjo0NVrOGERY4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMTo0Mjo0NVrOGERY4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzMjM4NA==", "bodyText": "Would it be simpler to have the copy be done once and consistently in the source method?\nIE: UnitCollection.java\n  default Collection<Unit> getUnits() {\n    return getUnitCollection().getUnits();\n  }", "url": "https://github.com/triplea-game/triplea/pull/6200#discussion_r407132384", "createdAt": "2020-04-12T01:42:45Z", "author": {"login": "DanVanAtta"}, "path": "game-core/src/main/java/games/strategy/triplea/delegate/AbstractPlaceDelegate.java", "diffHunk": "@@ -1652,14 +1652,13 @@ private boolean getCanAllUnitsWithRequiresUnitsBePlacedCorrectly(\n     if (to == null) {\n       return new ArrayList<>();\n     }\n-    final Collection<Unit> unitsInTo = to.getUnits();\n     final Collection<Unit> unitsPlacedAlready = getAlreadyProduced(to);\n     if (Matches.territoryIsWater().test(to)) {\n       for (final Territory current : getAllProducers(to, player, null, true)) {\n         unitsPlacedAlready.addAll(getAlreadyProduced(current));\n       }\n     }\n-    final Collection<Unit> unitsAtStartOfTurnInTo = new ArrayList<>(unitsInTo);\n+    final Collection<Unit> unitsAtStartOfTurnInTo = new ArrayList<>(to.getUnits());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1379a2d68f2892a0250c903a85f7856607a9cd2d"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3661, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}