{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNDcwNTA1", "number": 14310, "title": "[FLINK-20486][hive] Hive temporal join shouldn't require a minimal 1h monitor interval", "bodyText": "What is the purpose of the change\n\nCurrently we limits the monitor interval should be at least 1 hour to avoid produce pressure to hive meta store, this should be safe in production, but it's inconvenient for demo or simple user case. This pull request to unlock the monitor interval limitation of hive temporal table.\n\nBrief change log\n\nupdate file org/apache/flink/connectors/hive/HiveLookupTableSource.java\n\nVerifying this change\n\nAdd unit test to check monitor interval can be set by users.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): ( no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-12-04T11:23:27Z", "url": "https://github.com/apache/flink/pull/14310", "merged": true, "mergeCommit": {"oid": "09ec2ae626acac0c17374a77d49f290ae5289f7d"}, "closed": true, "closedAt": "2020-12-07T12:38:33Z", "author": {"login": "leonardBang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi3Bx7gFqTU0NDkyMTcwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj01ptgFqTU0NjEwODQ0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTIxNzA3", "url": "https://github.com/apache/flink/pull/14310#pullrequestreview-544921707", "createdAt": "2020-12-04T12:37:23Z", "commit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjozNzoyM1rOH_PF8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjozNzoyM1rOH_PF8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ==", "bodyText": "I'm curious how we decided that 1h is the recommended value for monitor interval, and why a smaller value, say, 30min can cause pressure on metastore?", "url": "https://github.com/apache/flink/pull/14310#discussion_r536069619", "createdAt": "2020-12-04T12:37:23Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a8532f2384af5fab3b187902da54c32d05b713a", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/9a8532f2384af5fab3b187902da54c32d05b713a", "committedDate": "2020-12-07T07:25:23Z", "message": "[FLINK-20486][hive] Hive temporal join shouldn't require a minimal 1h monitor interval"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/cded2fcb5f10c8d6bdbfdece1c591fa658377f90", "committedDate": "2020-12-04T11:17:13Z", "message": "[FLINK-20486][hive] Hive temporal join shouldn't require a minimal 1h monitor interval"}, "afterCommit": {"oid": "9a8532f2384af5fab3b187902da54c32d05b713a", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/9a8532f2384af5fab3b187902da54c32d05b713a", "committedDate": "2020-12-07T07:25:23Z", "message": "[FLINK-20486][hive] Hive temporal join shouldn't require a minimal 1h monitor interval"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MDYwNjY3", "url": "https://github.com/apache/flink/pull/14310#pullrequestreview-546060667", "createdAt": "2020-12-07T11:29:59Z", "commit": {"oid": "9a8532f2384af5fab3b187902da54c32d05b713a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTA4NDQy", "url": "https://github.com/apache/flink/pull/14310#pullrequestreview-546108442", "createdAt": "2020-12-07T12:38:15Z", "commit": {"oid": "9a8532f2384af5fab3b187902da54c32d05b713a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3906, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}