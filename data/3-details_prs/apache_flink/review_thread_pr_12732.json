{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NTE3MjM4", "number": 12732, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOToyMDowOVrOEHfi4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOToyMDowOVrOEHfi4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjkyMzIwOnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOToyMDowOVrOGm4mYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo0OTo1OVrOGm7iCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQyNjQwMg==", "bodyText": "I think you could directly ask pendingRequest.getAllocationId(). That way you would not need to query pendingRequests again.", "url": "https://github.com/apache/flink/pull/12732#discussion_r443426402", "createdAt": "2020-06-22T09:20:09Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java", "diffHunk": "@@ -561,7 +561,11 @@ private void tryFulfillSlotRequestOrMakeAvailable(AllocatedSlot allocatedSlot) {\n \t\t\tallocatedSlots.add(pendingRequest.getSlotRequestId(), allocatedSlot);\n \t\t\tpendingRequest.getAllocatedSlotFuture().complete(allocatedSlot);\n \n-\t\t\tmaybeRemapOrphanedAllocation(allocationIdOfRequest, allocatedSlot.getAllocationId());\n+\t\t\t// the allocation id can be null if the request was fulfilled by a slot directly offered\n+\t\t\t// by a reconnected TaskExecutor before the ResourceManager is connected\n+\t\t\tif (allocationIdOfRequest != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7777affc50bf1433d0aeaad27a285e019fa5f29"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQyOTE4NA==", "bodyText": "Moreover, there is no invariant which states that pendingRequests contains the mapping. Hence, it would also make sense to directly ask pendingRequest here.", "url": "https://github.com/apache/flink/pull/12732#discussion_r443429184", "createdAt": "2020-06-22T09:24:59Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java", "diffHunk": "@@ -561,7 +561,11 @@ private void tryFulfillSlotRequestOrMakeAvailable(AllocatedSlot allocatedSlot) {\n \t\t\tallocatedSlots.add(pendingRequest.getSlotRequestId(), allocatedSlot);\n \t\t\tpendingRequest.getAllocatedSlotFuture().complete(allocatedSlot);\n \n-\t\t\tmaybeRemapOrphanedAllocation(allocationIdOfRequest, allocatedSlot.getAllocationId());\n+\t\t\t// the allocation id can be null if the request was fulfilled by a slot directly offered\n+\t\t\t// by a reconnected TaskExecutor before the ResourceManager is connected\n+\t\t\tif (allocationIdOfRequest != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQyNjQwMg=="}, "originalCommit": {"oid": "e7777affc50bf1433d0aeaad27a285e019fa5f29"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ3NDQ0Mw==", "bodyText": "Agreed. done.", "url": "https://github.com/apache/flink/pull/12732#discussion_r443474443", "createdAt": "2020-06-22T10:49:59Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java", "diffHunk": "@@ -561,7 +561,11 @@ private void tryFulfillSlotRequestOrMakeAvailable(AllocatedSlot allocatedSlot) {\n \t\t\tallocatedSlots.add(pendingRequest.getSlotRequestId(), allocatedSlot);\n \t\t\tpendingRequest.getAllocatedSlotFuture().complete(allocatedSlot);\n \n-\t\t\tmaybeRemapOrphanedAllocation(allocationIdOfRequest, allocatedSlot.getAllocationId());\n+\t\t\t// the allocation id can be null if the request was fulfilled by a slot directly offered\n+\t\t\t// by a reconnected TaskExecutor before the ResourceManager is connected\n+\t\t\tif (allocationIdOfRequest != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQyNjQwMg=="}, "originalCommit": {"oid": "e7777affc50bf1433d0aeaad27a285e019fa5f29"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4221, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}