{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzU0NDg4", "number": 10923, "title": "[FLINK-15691][tests] Remove runInTaskExecutorThreadAndWait()", "bodyText": "Removes TaskExecutorPartitionLifecycleTest#runInTaskExecutorThreadAndWait() and refactors existing usages.\nThe method did not achieve the desired effect of running the action in the TE main thread. Given that the test has not shown instabilities despite this we can conclude that these actions can just be executed in the tests main thread instead.\nAdditionally, this test removes/replaces accesses to the JobManagerTable of the TaskExecutor.\nThe first access was removed since it is not really necessary since it effectively verified the test setup.\nThe second access was replaced with a check for whether the disconnect-from-JM future has been completed, which should behave the same way.", "createdAt": "2020-01-22T09:40:49Z", "url": "https://github.com/apache/flink/pull/10923", "merged": true, "mergeCommit": {"oid": "f7a7d89ca7156a57365252f947dab82455f2ff78"}, "closed": true, "closedAt": "2020-01-23T14:54:35Z", "author": {"login": "zentol"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8ya0gAH2gAyMzY1NzU0NDg4OmJlZTNmZTRmNjEzYjdjNGMwZDMzZjg2YzJkYTY5YzQ1MWUyMDQ1YTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9LltLgBqjI5NzQwMjk4MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bee3fe4f613b7c4c0d33f86c2da69c451e2045a4", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/bee3fe4f613b7c4c0d33f86c2da69c451e2045a4", "committedDate": "2020-01-22T09:34:56Z", "message": "[hotfix][tests] Setup closable resources in BeforeClass\n\nHaving static final resources that are closed in an @AfterClass method prevents the test from being run in a loop within the IDE, since the static fields aren't re-initialized."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NzI5NzMw", "url": "https://github.com/apache/flink/pull/10923#pullrequestreview-346729730", "createdAt": "2020-01-22T16:33:47Z", "commit": {"oid": "c271c86281723f9cfa99ed95d6073c280a753e25"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjozMzo0N1rOFgixjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjozMzo0N1rOFgixjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2ODQ5NQ==", "bodyText": "I think this is not 100% correct as the internal TestingTaskExecutorPartitionTracker#promotePartitionsConsumer field is not volatile. Hence, the TaskExecutor might read a stale value. I would suggest to either setup these things before creating the TaskExecutor or if this is not possible, then make the fields volatile.", "url": "https://github.com/apache/flink/pull/10923#discussion_r369668495", "createdAt": "2020-01-22T16:33:47Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorPartitionLifecycleTest.java", "diffHunk": "@@ -254,7 +249,7 @@ public void testPartitionPromotion() throws Exception {\n \t\ttestPartitionRelease(\n \t\t\t(jobId, partitionId, taskExecutor, taskExecutorGateway, partitionTracker) -> {\n \t\t\t\tfinal CompletableFuture<Collection<ResultPartitionID>> releasePartitionsFuture = new CompletableFuture<>();\n-\t\t\t\trunInTaskExecutorThreadAndWait(taskExecutor, () -> partitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete));\n+\t\t\t\tpartitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c271c86281723f9cfa99ed95d6073c280a753e25"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3Mjk3MDgz", "url": "https://github.com/apache/flink/pull/10923#pullrequestreview-347297083", "createdAt": "2020-01-23T13:33:27Z", "commit": {"oid": "5da7ad7c8bdd667a81c5f3c3366257e02e2dcf49"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b9c2703117d2cce0c13dac71d5317f91042d39", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/21b9c2703117d2cce0c13dac71d5317f91042d39", "committedDate": "2020-01-23T14:53:52Z", "message": "[FLINK-15691][tests] Remove runInTaskExecutorThreadAndWait()\n\nThe method did not achieve the desired effect of running the action in the TE main thread. Given that the test has not shown instabilities despite this we can conclude that these actions can just be executed in the tests main thread instead.\n\nAdditionally, this test removes/replaces accesses to the JobManagerTable of the TaskExecutor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5da7ad7c8bdd667a81c5f3c3366257e02e2dcf49", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/5da7ad7c8bdd667a81c5f3c3366257e02e2dcf49", "committedDate": "2020-01-22T19:03:04Z", "message": "address comment"}, "afterCommit": {"oid": "21b9c2703117d2cce0c13dac71d5317f91042d39", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/21b9c2703117d2cce0c13dac71d5317f91042d39", "committedDate": "2020-01-23T14:53:52Z", "message": "[FLINK-15691][tests] Remove runInTaskExecutorThreadAndWait()\n\nThe method did not achieve the desired effect of running the action in the TE main thread. Given that the test has not shown instabilities despite this we can conclude that these actions can just be executed in the tests main thread instead.\n\nAdditionally, this test removes/replaces accesses to the JobManagerTable of the TaskExecutor."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4431, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}