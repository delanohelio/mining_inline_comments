{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMjcwMDE5", "number": 12533, "title": "[FLINK-18175][conf] Log final memory configuration", "bodyText": "Adds some logging for the final memory configuration.\nExamples of the logging output:\nmaster:\nFinal Master Memory configuration:\n  Total Process Memory: 1024.000mb (1073741824 bytes)\n    Total Flink Memory: 576.000mb (603979776 bytes)\n      Heap:             448.000mb (469762048 bytes)\n      Off-heap:         128.000mb (134217728 bytes)\n    JVM Metaspace:      256.000mb (268435456 bytes)\n    JVM Overhead:       192.000mb (201326592 bytes)\n\ntaskexecutor:\nFinal TaskExecutor Memory configuration:\n  Total Process Memory:      1024.000mb (1073741824 bytes)\n    Total Flink Memory:      576.000mb (603979776 bytes)\n      Total Heap Memory:     153.600mb (161061270 bytes)\n        Framework:           128.000mb (134217728 bytes)\n        Task:                25.600mb (26843542 bytes)\n      Total Off-heap Memory: 422.400mb (442918506 bytes)\n        Managed:             230.400mb (241591914 bytes)\n        Total Direct Memory: 192.000mb (201326592 bytes)\n          Framework:         128.000mb (134217728 bytes)\n          Task:              0 bytes\n          Network:           64.000mb (67108864 bytes)\n    JVM Metaspace:           256.000mb (268435456 bytes)\n    JVM Overhead:            192.000mb (201326592 bytes)", "createdAt": "2020-06-08T16:52:17Z", "url": "https://github.com/apache/flink/pull/12533", "merged": true, "mergeCommit": {"oid": "1c9f198d41a0200891ff2aed5b4901afa7f776d8"}, "closed": true, "closedAt": "2020-06-12T12:12:11Z", "author": {"login": "zentol"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpnDMnAFqTQyNzI5MjQ0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqNt9YABqjM0MzM5OTYxMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjkyNDQ0", "url": "https://github.com/apache/flink/pull/12533#pullrequestreview-427292444", "createdAt": "2020-06-09T15:39:49Z", "commit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTozOTo1MVrOGhQsJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0NjoyMVrOGhQ-pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyOTYzNw==", "bodyText": "We cannot rely on external logging in BashJavaUtils.\nThe logs have to be forced into the stdout independently from logging config to pass them to FLINK_INHERITED_LOGS env var which is used by the main Flink process to log on its startup.", "url": "https://github.com/apache/flink/pull/12533#discussion_r437529637", "createdAt": "2020-06-09T15:39:51Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java", "diffHunk": "@@ -39,6 +45,7 @@\n  * Utility class for using java utilities in bash scripts.\n  */\n public class BashJavaUtils {\n+\tprivate static final Logger LOG = LoggerFactory.getLogger(BashJavaUtils.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzMjc2NQ==", "bodyText": "This might be a bit tedious but I think it would be really cool to output this info in the format we use in JavaDocs for TaskExecutorProcessSpec if it works. Same for JM.", "url": "https://github.com/apache/flink/pull/12533#discussion_r437532765", "createdAt": "2020-06-09T15:44:08Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java", "diffHunk": "@@ -92,9 +102,42 @@ public static void main(String[] args) throws FlinkException {\n \t\tJobManagerProcessSpec jobManagerProcessSpec = JobManagerProcessUtils.processSpecFromConfigWithNewOptionToInterpretLegacyHeap(\n \t\t\tconfiguration,\n \t\t\tJobManagerOptions.JVM_HEAP_MEMORY);\n+\n+\t\tlogMasterConfiguration(jobManagerProcessSpec);\n+\n \t\treturn Collections.singletonList(ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));\n \t}\n \n+\tprivate static void logMasterConfiguration(JobManagerProcessSpec spec) {\n+\t\tJobManagerFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tLOG.info(\"Final Master Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory: {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory: {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Heap:             {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Off-heap:         {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Metaspace:      {}\", spec.getJvmMetaspaceSize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Overhead:       {}\", spec.getJvmOverheadSize().toHumanReadableString());\n+\t}\n+\n+\tprivate static void logTaskExecutorConfiguration(TaskExecutorProcessSpec spec) {\n+\t\tTaskExecutorFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tMemorySize totalOffHeapMemory = flinkMemory.getManaged().add(flinkMemory.getJvmDirectMemorySize());\n+\t\tLOG.info(\"Final TaskExecutor Memory configuration:\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzMzEzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tLOG.info(\"      Heap:             {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n          \n          \n            \n            \t\tLOG.info(\"      JVM Heap:         {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());", "url": "https://github.com/apache/flink/pull/12533#discussion_r437533130", "createdAt": "2020-06-09T15:44:40Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java", "diffHunk": "@@ -92,9 +102,42 @@ public static void main(String[] args) throws FlinkException {\n \t\tJobManagerProcessSpec jobManagerProcessSpec = JobManagerProcessUtils.processSpecFromConfigWithNewOptionToInterpretLegacyHeap(\n \t\t\tconfiguration,\n \t\t\tJobManagerOptions.JVM_HEAP_MEMORY);\n+\n+\t\tlogMasterConfiguration(jobManagerProcessSpec);\n+\n \t\treturn Collections.singletonList(ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));\n \t}\n \n+\tprivate static void logMasterConfiguration(JobManagerProcessSpec spec) {\n+\t\tJobManagerFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tLOG.info(\"Final Master Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory: {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory: {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Heap:             {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzMzM2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tLOG.info(\"      Total Heap Memory:     {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n          \n          \n            \n            \t\tLOG.info(\"      JVM Heap Memory:     {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());", "url": "https://github.com/apache/flink/pull/12533#discussion_r437533360", "createdAt": "2020-06-09T15:44:59Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java", "diffHunk": "@@ -92,9 +102,42 @@ public static void main(String[] args) throws FlinkException {\n \t\tJobManagerProcessSpec jobManagerProcessSpec = JobManagerProcessUtils.processSpecFromConfigWithNewOptionToInterpretLegacyHeap(\n \t\t\tconfiguration,\n \t\t\tJobManagerOptions.JVM_HEAP_MEMORY);\n+\n+\t\tlogMasterConfiguration(jobManagerProcessSpec);\n+\n \t\treturn Collections.singletonList(ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));\n \t}\n \n+\tprivate static void logMasterConfiguration(JobManagerProcessSpec spec) {\n+\t\tJobManagerFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tLOG.info(\"Final Master Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory: {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory: {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Heap:             {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Off-heap:         {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Metaspace:      {}\", spec.getJvmMetaspaceSize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Overhead:       {}\", spec.getJvmOverheadSize().toHumanReadableString());\n+\t}\n+\n+\tprivate static void logTaskExecutorConfiguration(TaskExecutorProcessSpec spec) {\n+\t\tTaskExecutorFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tMemorySize totalOffHeapMemory = flinkMemory.getManaged().add(flinkMemory.getJvmDirectMemorySize());\n+\t\tLOG.info(\"Final TaskExecutor Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory:      {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory:      {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Total Heap Memory:     {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNDM3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tLOG.info(\"        Total Direct Memory: {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());\n          \n          \n            \n            \t\tLOG.info(\"        JVM Direct Memory: {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());", "url": "https://github.com/apache/flink/pull/12533#discussion_r437534372", "createdAt": "2020-06-09T15:46:21Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java", "diffHunk": "@@ -92,9 +102,42 @@ public static void main(String[] args) throws FlinkException {\n \t\tJobManagerProcessSpec jobManagerProcessSpec = JobManagerProcessUtils.processSpecFromConfigWithNewOptionToInterpretLegacyHeap(\n \t\t\tconfiguration,\n \t\t\tJobManagerOptions.JVM_HEAP_MEMORY);\n+\n+\t\tlogMasterConfiguration(jobManagerProcessSpec);\n+\n \t\treturn Collections.singletonList(ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));\n \t}\n \n+\tprivate static void logMasterConfiguration(JobManagerProcessSpec spec) {\n+\t\tJobManagerFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tLOG.info(\"Final Master Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory: {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory: {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Heap:             {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Off-heap:         {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Metaspace:      {}\", spec.getJvmMetaspaceSize().toHumanReadableString());\n+\t\tLOG.info(\"    JVM Overhead:       {}\", spec.getJvmOverheadSize().toHumanReadableString());\n+\t}\n+\n+\tprivate static void logTaskExecutorConfiguration(TaskExecutorProcessSpec spec) {\n+\t\tTaskExecutorFlinkMemory flinkMemory = spec.getFlinkMemory();\n+\t\tMemorySize totalOffHeapMemory = flinkMemory.getManaged().add(flinkMemory.getJvmDirectMemorySize());\n+\t\tLOG.info(\"Final TaskExecutor Memory configuration:\");\n+\t\tLOG.info(\"  Total Process Memory:      {}\", spec.getTotalProcessMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"    Total Flink Memory:      {}\", flinkMemory.getTotalFlinkMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"      Total Heap Memory:     {}\", flinkMemory.getJvmHeapMemorySize().toHumanReadableString());\n+\t\tLOG.info(\"        Framework:           {}\", flinkMemory.getFrameworkHeap().toHumanReadableString());\n+\t\tLOG.info(\"        Task:                {}\", flinkMemory.getTaskHeap().toHumanReadableString());\n+\t\tLOG.info(\"      Total Off-heap Memory: {}\", totalOffHeapMemory.toHumanReadableString());\n+\t\tLOG.info(\"        Managed:             {}\", flinkMemory.getManaged().toHumanReadableString());\n+\t\tLOG.info(\"        Total Direct Memory: {}\", flinkMemory.getJvmDirectMemorySize().toHumanReadableString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d12c7773ea58fa0fae03312d903bad263ab86ef"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDEyMzA0", "url": "https://github.com/apache/flink/pull/12533#pullrequestreview-428012304", "createdAt": "2020-06-10T12:43:26Z", "commit": {"oid": "544b1a3cdbcde5dc45a3801508cdfc88969d4f08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcf5dd9fa40a098bf0d409c9a3635af65edd15ba", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/fcf5dd9fa40a098bf0d409c9a3635af65edd15ba", "committedDate": "2020-06-10T19:59:51Z", "message": "[FLINK-18175][conf] Log final memory configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c5493ba5a54a128582133b188f590508abe7aec", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/5c5493ba5a54a128582133b188f590508abe7aec", "committedDate": "2020-06-10T19:59:51Z", "message": "Add JVM prefix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "544b1a3cdbcde5dc45a3801508cdfc88969d4f08", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/544b1a3cdbcde5dc45a3801508cdfc88969d4f08", "committedDate": "2020-06-10T10:37:20Z", "message": "Add JVM prefix"}, "afterCommit": {"oid": "a1b0c37233ff7200b36ec769bedb5cd745cc0fd5", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/a1b0c37233ff7200b36ec769bedb5cd745cc0fd5", "committedDate": "2020-06-10T19:59:51Z", "message": "tmp (testing)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1b0c37233ff7200b36ec769bedb5cd745cc0fd5", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/a1b0c37233ff7200b36ec769bedb5cd745cc0fd5", "committedDate": "2020-06-10T19:59:51Z", "message": "tmp (testing)"}, "afterCommit": {"oid": "5c5493ba5a54a128582133b188f590508abe7aec", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/5c5493ba5a54a128582133b188f590508abe7aec", "committedDate": "2020-06-10T19:59:51Z", "message": "Add JVM prefix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3812, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}