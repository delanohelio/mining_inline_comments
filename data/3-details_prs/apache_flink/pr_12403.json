{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0OTkyNTQ1", "number": 12403, "title": "[FLINK-18030][hive] Hive UDF doesn't accept empty string literal para\u2026", "bodyText": "\u2026meters\n\nWhat is the purpose of the change\nFix the issue that Hive UDF cannot be used with empty string parameters.\nBrief change log\n\nConvert CHAR type to STRING in HiveTypeUtil::toHiveTypeInfo, if the length of char is not supported by Hive and we're told not to check precision.\nAdd test case\n\nVerifying this change\nExisting and added cases.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? NA", "createdAt": "2020-05-29T09:28:29Z", "url": "https://github.com/apache/flink/pull/12403", "merged": true, "mergeCommit": {"oid": "c9488eb8a53a07ea9541c6a2c00e196e90274320"}, "closed": true, "closedAt": "2020-06-11T06:43:30Z", "author": {"login": "lirui-apache"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoOAAkAFqTQyNTA4MDQxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqIeFSAFqTQyODYzMTc3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDgwNDE3", "url": "https://github.com/apache/flink/pull/12403#pullrequestreview-425080417", "createdAt": "2020-06-05T08:01:27Z", "commit": {"oid": "0e667a3bd702288955808b79493a09244513d202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODowMToyOFrOGfkWlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODowMToyOFrOGfkWlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc1NDY0NQ==", "bodyText": "Also modify varchar?", "url": "https://github.com/apache/flink/pull/12403#discussion_r435754645", "createdAt": "2020-06-05T08:01:28Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/util/HiveTypeUtil.java", "diffHunk": "@@ -182,11 +182,17 @@ private static DataType toFlinkPrimitiveType(PrimitiveTypeInfo hiveType) {\n \n \t\t@Override\n \t\tpublic TypeInfo visit(CharType charType) {\n-\t\t\tif (charType.getLength() > HiveChar.MAX_CHAR_LENGTH) {\n-\t\t\t\tthrow new CatalogException(\n-\t\t\t\t\t\tString.format(\"HiveCatalog doesn't support char type with length of '%d'. \" +\n-\t\t\t\t\t\t\t\t\t\"The maximum length is %d\",\n+\t\t\t// Flink treats string literal UDF parameters as CHAR. Such types may have precisions not supported by\n+\t\t\t// Hive, e.g. CHAR(0). Promote it to STRING in such case if we're told not to check precision.\n+\t\t\tif (charType.getLength() > HiveChar.MAX_CHAR_LENGTH || charType.getLength() < 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e667a3bd702288955808b79493a09244513d202"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e667a3bd702288955808b79493a09244513d202", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/0e667a3bd702288955808b79493a09244513d202", "committedDate": "2020-05-29T09:24:33Z", "message": "[FLINK-18030][hive] Hive UDF doesn't accept empty string literal parameters"}, "afterCommit": {"oid": "db8db54bfdc1802d744e906ecdaee5d4a0d3ad36", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/db8db54bfdc1802d744e906ecdaee5d4a0d3ad36", "committedDate": "2020-06-08T03:48:18Z", "message": "add changes for varchar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1843c0a3c5e25b09936b026b863a5de711f1df4", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/f1843c0a3c5e25b09936b026b863a5de711f1df4", "committedDate": "2020-06-09T02:27:37Z", "message": "[FLINK-18030][hive] Hive UDF doesn't accept empty string literal parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "131754a31058bdc732ca114172dd1c31847429d5", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/131754a31058bdc732ca114172dd1c31847429d5", "committedDate": "2020-06-09T02:27:37Z", "message": "add changes for varchar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaecb4e18e9c83f0aad76ab01a38a7ac60b81a88", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/aaecb4e18e9c83f0aad76ab01a38a7ac60b81a88", "committedDate": "2020-06-09T02:50:04Z", "message": "fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db8db54bfdc1802d744e906ecdaee5d4a0d3ad36", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/db8db54bfdc1802d744e906ecdaee5d4a0d3ad36", "committedDate": "2020-06-08T03:48:18Z", "message": "add changes for varchar"}, "afterCommit": {"oid": "aaecb4e18e9c83f0aad76ab01a38a7ac60b81a88", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/aaecb4e18e9c83f0aad76ab01a38a7ac60b81a88", "committedDate": "2020-06-09T02:50:04Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjMxNzc3", "url": "https://github.com/apache/flink/pull/12403#pullrequestreview-428631777", "createdAt": "2020-06-11T06:43:00Z", "commit": {"oid": "aaecb4e18e9c83f0aad76ab01a38a7ac60b81a88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4566, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}