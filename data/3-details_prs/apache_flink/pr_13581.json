{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTQzNzk1", "number": 13581, "title": "[FLINK-17331] Explicitly get the ByteBuf length of all classes which \u2026", "bodyText": "\u2026is written to NettyMessage\nCurrently, the length of some header fields in NettyMessage is hardcoded: InputChannelID, ExecutionAttemptID, e.t.c.\nSo if we make some changes for such field, then we are not ware that it also needs to change the respective length for related netty messages component.\nThis PR explicitly get the ByteBuf length of all classes which is written to NettyMessage to avoid such problems.\n\nWhat is the purpose of the change\nExplicitly get the ByteBuf length of all classes which is written to NettyMessage", "createdAt": "2020-10-10T09:19:09Z", "url": "https://github.com/apache/flink/pull/13581", "merged": true, "mergeCommit": {"oid": "96d8c0d46f6dc567569a321bc2e8f80962e34f3b"}, "closed": true, "closedAt": "2020-12-29T10:29:24Z", "author": {"login": "KarmaGYZ"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRIsjRgBqjM4NjI2NDM4NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdq4LCwAFqTU1OTQ3MDM4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef1039af70b46068bbbcd9ef4ea0c5cfd0583d5c", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/ef1039af70b46068bbbcd9ef4ea0c5cfd0583d5c", "committedDate": "2020-10-10T09:12:54Z", "message": "[FLINK-17331] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}, "afterCommit": {"oid": "1e187203b15559b08d15a0cca949ca15a8a3bafe", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/1e187203b15559b08d15a0cca949ca15a8a3bafe", "committedDate": "2020-10-10T09:32:44Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e187203b15559b08d15a0cca949ca15a8a3bafe", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/1e187203b15559b08d15a0cca949ca15a8a3bafe", "committedDate": "2020-10-10T09:32:44Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}, "afterCommit": {"oid": "fcc301fbb0d04ada457d2c39d325ede52cc0db8d", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/fcc301fbb0d04ada457d2c39d325ede52cc0db8d", "committedDate": "2020-10-22T03:34:49Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcc301fbb0d04ada457d2c39d325ede52cc0db8d", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/fcc301fbb0d04ada457d2c39d325ede52cc0db8d", "committedDate": "2020-10-22T03:34:49Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}, "afterCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/05751c9777cba4c922adac2fb1f1c5a980b779da", "committedDate": "2020-12-09T02:15:08Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjczNTI1", "url": "https://github.com/apache/flink/pull/13581#pullrequestreview-557673525", "createdAt": "2020-12-23T06:50:32Z", "commit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNjo1MDozMlrOIKWUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzoyOToyMlrOIKYJCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzcyMjM5Mw==", "bodyText": "Would you please add a comment here, something like\n\"the length of two long types representing an executionAttemptId, with the lower part and the upper part taking one long type of length each\" or something similar to explain where 16 comes from.", "url": "https://github.com/apache/flink/pull/13581#discussion_r547722393", "createdAt": "2020-12-23T06:50:32Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionAttemptID.java", "diffHunk": "@@ -31,6 +31,7 @@\n public class ExecutionAttemptID implements java.io.Serializable {\n \n \tprivate static final long serialVersionUID = -1169683445778281344L;\n+\tprivate static final int BYTEBUF_LEN = 16;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0MzA3Mg==", "bodyText": "similarly here, please add a comment to explain.", "url": "https://github.com/apache/flink/pull/13581#discussion_r547743072", "createdAt": "2020-12-23T07:17:07Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/InputChannelID.java", "diffHunk": "@@ -28,6 +28,7 @@\n public class InputChannelID extends AbstractID {\n \n \tprivate static final long serialVersionUID = 1L;\n+\tprivate static final int BYTEBUF_LEN = 16;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc0NTI0OQ==", "bodyText": "similarly here, please add a comment.\nWhere are the extra 4 bytes coming from? partitionNum?", "url": "https://github.com/apache/flink/pull/13581#discussion_r547745249", "createdAt": "2020-12-23T07:19:51Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/IntermediateResultPartitionID.java", "diffHunk": "@@ -30,6 +30,7 @@\n public class IntermediateResultPartitionID implements ResultID {\n \n \tprivate static final long serialVersionUID = 1L;\n+\tprivate static final int BYTEBUF_LEN = 20;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc1MjIwMw==", "bodyText": "why isCompressed (boolean) is hardcoded, while everything else is not?", "url": "https://github.com/apache/flink/pull/13581#discussion_r547752203", "createdAt": "2020-12-23T07:29:22Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyMessage.java", "diffHunk": "@@ -259,7 +259,7 @@ protected Object decode(ChannelHandlerContext ctx, ByteBuf in) throws Exception\n \t\tstatic final byte ID = 0;\n \n \t\t// receiver ID (16), sequence number (4), backlog (4), dataType (1), isCompressed (1), buffer size (4)\n-\t\tstatic final int MESSAGE_HEADER_LENGTH = 16 + 4 + 4 + 1 + 1 + 4;\n+\t\tstatic final int MESSAGE_HEADER_LENGTH = InputChannelID.getByteBufLength() + Integer.BYTES + Integer.BYTES + Byte.BYTES + 1 + Integer.BYTES;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05751c9777cba4c922adac2fb1f1c5a980b779da", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/05751c9777cba4c922adac2fb1f1c5a980b779da", "committedDate": "2020-12-09T02:15:08Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}, "afterCommit": {"oid": "cd05d23ea1ac2a9283e03039a3791b1cc2df1a95", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/cd05d23ea1ac2a9283e03039a3791b1cc2df1a95", "committedDate": "2020-12-23T08:32:51Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4Mzk1NzU5", "url": "https://github.com/apache/flink/pull/13581#pullrequestreview-558395759", "createdAt": "2020-12-24T07:59:05Z", "commit": {"oid": "cd05d23ea1ac2a9283e03039a3791b1cc2df1a95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "008f1e53122962ab10c83e548b60f0e7da5e6654", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/008f1e53122962ab10c83e548b60f0e7da5e6654", "committedDate": "2020-12-29T06:06:55Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage\n\nCurrently, the length of some header fields in NettyMessage is hardcoded: InputChannelID, ExecutionAttemptID, e.t.c.\nSo if we make some changes for such field, then we are not ware that it also needs to change the respective length for related netty messages component.\nThis PR explicitly get the ByteBuf length of all classes which is written to NettyMessage to avoid such problems."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd05d23ea1ac2a9283e03039a3791b1cc2df1a95", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/cd05d23ea1ac2a9283e03039a3791b1cc2df1a95", "committedDate": "2020-12-23T08:32:51Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage"}, "afterCommit": {"oid": "008f1e53122962ab10c83e548b60f0e7da5e6654", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/008f1e53122962ab10c83e548b60f0e7da5e6654", "committedDate": "2020-12-29T06:06:55Z", "message": "[FLINK-17331][runtime] Explicitly get the ByteBuf length of all classes which is written to NettyMessage\n\nCurrently, the length of some header fields in NettyMessage is hardcoded: InputChannelID, ExecutionAttemptID, e.t.c.\nSo if we make some changes for such field, then we are not ware that it also needs to change the respective length for related netty messages component.\nThis PR explicitly get the ByteBuf length of all classes which is written to NettyMessage to avoid such problems."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDcwMzgz", "url": "https://github.com/apache/flink/pull/13581#pullrequestreview-559470383", "createdAt": "2020-12-29T10:28:48Z", "commit": {"oid": "008f1e53122962ab10c83e548b60f0e7da5e6654"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3133, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}