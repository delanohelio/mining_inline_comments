{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTMzNjMy", "number": 11796, "title": "[FLINK-14258][table][filesystem] Integrate file system connector to streaming sink", "bodyText": "What is the purpose of the change\nIntegrate file system connector to streaming sink.\nBrief change log\n\nIntegrate streaming file sink in FileSystemTableSink\nAdd ROLLING_POLICYs\n\nVerifying this change\n\nFsStreamingSinkCsvITCaseBase\nParquetFsStreamingSinkITCase\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: (no\nThe runtime per-record code paths (performance sensitive): (no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no\nThe S3 file system connector: (no\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes)\nIf yes, how is the feature documented? JavaDocs", "createdAt": "2020-04-17T13:30:20Z", "url": "https://github.com/apache/flink/pull/11796", "merged": true, "mergeCommit": {"oid": "f095f263d86fa950274cb357000e0f10c27e5c4f"}, "closed": true, "closedAt": "2020-04-26T05:05:02Z", "author": {"login": "JingsongLi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcapWo-gH2gAyNDA1MTMzNjMyOjRkOThkNDY1MjhmYWI4MDg3ZmNjZjc5YjkxODRmMjdhNjE5N2M3MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbRqy3AH2gAyNDA1MTMzNjMyOjE3ZWNjMGIzN2ZjMjkyYzVmOGZiNzBhZjhlNjMxM2VjOTA0OGJkNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/4d98d46528fab8087fccf79b9184f27a6197c714", "committedDate": "2020-04-24T03:58:57Z", "message": "[FLINK-14258][table][filesystem] Integrate file system connector to streaming sink"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90fa0d286fbdae57d834d527a8843a8a493d5a0d", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/90fa0d286fbdae57d834d527a8843a8a493d5a0d", "committedDate": "2020-04-17T13:31:07Z", "message": "Fix name"}, "afterCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/4d98d46528fab8087fccf79b9184f27a6197c714", "committedDate": "2020-04-24T03:58:57Z", "message": "[FLINK-14258][table][filesystem] Integrate file system connector to streaming sink"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTI0MzU5", "url": "https://github.com/apache/flink/pull/11796#pullrequestreview-399924359", "createdAt": "2020-04-24T13:01:38Z", "commit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTozOFrOGLWl5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowODowNlrOGLW1kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1NzY2OQ==", "bodyText": "please add param note", "url": "https://github.com/apache/flink/pull/11796#discussion_r414557669", "createdAt": "2020-04-24T13:01:38Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1Nzg2MA==", "bodyText": "as above", "url": "https://github.com/apache/flink/pull/11796#discussion_r414557860", "createdAt": "2020-04-24T13:01:55Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,\n \t\t\tTableSchema schema,\n \t\t\tPath path,\n \t\t\tList<String> partitionKeys,\n \t\t\tString defaultPartName,\n+\t\t\tlong rollingFileSize,\n+\t\t\tlong rollingTimeInterval,\n \t\t\tMap<String, String> formatProperties) {\n+\t\tthis.isBounded = isBounded;\n \t\tthis.schema = schema;\n \t\tthis.path = path;\n \t\tthis.defaultPartName = defaultPartName;\n+\t\tthis.rollingFileSize = rollingFileSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1ODA1Ng==", "bodyText": "as above", "url": "https://github.com/apache/flink/pull/11796#discussion_r414558056", "createdAt": "2020-04-24T13:02:14Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,\n \t\t\tTableSchema schema,\n \t\t\tPath path,\n \t\t\tList<String> partitionKeys,\n \t\t\tString defaultPartName,\n+\t\t\tlong rollingFileSize,\n+\t\t\tlong rollingTimeInterval,\n \t\t\tMap<String, String> formatProperties) {\n+\t\tthis.isBounded = isBounded;\n \t\tthis.schema = schema;\n \t\tthis.path = path;\n \t\tthis.defaultPartName = defaultPartName;\n+\t\tthis.rollingFileSize = rollingFileSize;\n+\t\tthis.rollingTimeInterval = rollingTimeInterval;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MDM2OA==", "bodyText": "This note looks like strange,  I cannot the meaning..", "url": "https://github.com/apache/flink/pull/11796#discussion_r414560368", "createdAt": "2020-04-24T13:06:02Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -284,4 +337,125 @@ public boolean configurePartitionGrouping(boolean supportsGrouping) {\n \t\tthis.dynamicGrouping = supportsGrouping;\n \t\treturn dynamicGrouping;\n \t}\n+\n+\t/**\n+\t * Table bucket assigner, wrap {@link PartitionComputer}.\n+\t */\n+\tprivate static class TableBucketAssigner implements BucketAssigner<BaseRow, String> {\n+\n+\t\tprivate final PartitionComputer<BaseRow> computer;\n+\n+\t\tprivate TableBucketAssigner(PartitionComputer<BaseRow> computer) {\n+\t\t\tthis.computer = computer;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic String getBucketId(BaseRow element, Context context) {\n+\t\t\ttry {\n+\t\t\t\treturn PartitionPathUtils.generatePartitionPath(\n+\t\t\t\t\t\tcomputer.generatePartValues(element));\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new RuntimeException(e);\n+\t\t\t}\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic SimpleVersionedSerializer<String> getSerializer() {\n+\t\t\treturn SimpleVersionedStringSerializer.INSTANCE;\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Table {@link RollingPolicy}, now it is a {@link CheckpointRollingPolicy}.\n+\t * Because partition commit is hard to support false.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MTY4MQ==", "bodyText": "we can move the judgement to the begin to make the code path short", "url": "https://github.com/apache/flink/pull/11796#discussion_r414561681", "createdAt": "2020-04-24T13:08:06Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/PartitionPathUtils.java", "diffHunk": "@@ -88,7 +88,9 @@ public static String generatePartitionPath(LinkedHashMap<String, String> partiti\n \t\t\tsuffixBuf.append(escapePathName(e.getValue()));\n \t\t\ti++;\n \t\t}\n-\t\tsuffixBuf.append(Path.SEPARATOR);\n+\t\tif (partitionSpec.size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17ecc0b37fc292c5f8fb70af8e6313ec9048bd45", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/17ecc0b37fc292c5f8fb70af8e6313ec9048bd45", "committedDate": "2020-04-26T02:57:10Z", "message": "Fix comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1885, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}