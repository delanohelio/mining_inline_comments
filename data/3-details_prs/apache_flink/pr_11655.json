{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTY2NjA2", "number": 11655, "title": "[FLINK-14162][runtime] SchedulerOperations#allocateSlotsAndDeploy always deploys tasks in a bulk", "bodyText": "What is the purpose of the change\nThis is to resolve the hack in DefaultScheduler. It is a prerequisite of pipelined region scheduling.\nMore details see FLINK-14162.\nBrief change log\n\nSchedulerOperations#allocateSlotsAndDeploy now always deploys tasks in a bulk\nLazyFromSourcesSchedulingStrategy now schedules vertices one by one when invoking SchedulerOperations#allocateSlotsAndDeploy(...)\n\nVerifying this change\nThis change is already covered by existing tests, such as\n\nDefaultSchedulerTest\nLazyFromSourcesSchedulingStrategyTest (adjusted a bit)\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-04-07T10:03:04Z", "url": "https://github.com/apache/flink/pull/11655", "merged": true, "mergeCommit": {"oid": "c2c9297f9fc45c052bfb245bbca2d91d8da28c7f"}, "closed": true, "closedAt": "2020-04-08T10:18:39Z", "author": {"login": "zhuzhurk"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVhklRgFqTM4OTY3NDQzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVh9cGABqjMyMTI3MDc5OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Njc0NDM3", "url": "https://github.com/apache/flink/pull/11655#pullrequestreview-389674437", "createdAt": "2020-04-08T06:05:19Z", "commit": {"oid": "ce5175a1aecc627af31edf06d88028591a2e1b50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjowNToxOVrOGCgNzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjowNToxOVrOGCgNzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3ODE1OA==", "bodyText": "We normally add the static import when using matchers.", "url": "https://github.com/apache/flink/pull/11655#discussion_r405278158", "createdAt": "2020-04-08T06:05:19Z", "author": {"login": "GJL"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/strategy/LazyFromSourcesSchedulingStrategyTest.java", "diffHunk": "@@ -351,9 +354,13 @@ private LazyFromSourcesSchedulingStrategy startScheduling(TestingSchedulingTopol\n \t}\n \n \tprivate void assertLatestScheduledVerticesAreEqualTo(final List<TestingSchedulingExecutionVertex> expected) {\n-\t\tassertEquals(\n-\t\t\tidsFromVertices(expected),\n-\t\t\tidsFromDeploymentOptions(testingSchedulerOperation.getLatestScheduledVertices()));\n+\t\tfinal List<List<ExecutionVertexDeploymentOption>> deploymentOptions = testingSchedulerOperation.getScheduledVertices();\n+\t\tassertThat(expected.size(), Matchers.lessThanOrEqualTo(deploymentOptions.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce5175a1aecc627af31edf06d88028591a2e1b50"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Njc2NTAw", "url": "https://github.com/apache/flink/pull/11655#pullrequestreview-389676500", "createdAt": "2020-04-08T06:10:33Z", "commit": {"oid": "ce5175a1aecc627af31edf06d88028591a2e1b50"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737dca31661b75fec6d9152b50e1a6e9986efbaa", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/737dca31661b75fec6d9152b50e1a6e9986efbaa", "committedDate": "2020-04-08T06:31:55Z", "message": "[FLINK-14162][runtime] SchedulerOperations#allocateSlotsAndDeploy always deploys tasks in a bulk"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce5175a1aecc627af31edf06d88028591a2e1b50", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/ce5175a1aecc627af31edf06d88028591a2e1b50", "committedDate": "2020-04-07T09:58:28Z", "message": "[FLINK-14162][runtime] SchedulerOperations#allocateSlotsAndDeploy always deploys tasks in a bulk"}, "afterCommit": {"oid": "737dca31661b75fec6d9152b50e1a6e9986efbaa", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/737dca31661b75fec6d9152b50e1a6e9986efbaa", "committedDate": "2020-04-08T06:31:55Z", "message": "[FLINK-14162][runtime] SchedulerOperations#allocateSlotsAndDeploy always deploys tasks in a bulk"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2359, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}