{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNDcwNTA1", "number": 14310, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjozNzoyM1rOFAx-wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjozNzoyM1rOFAx-wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MzYzMjAxOnYy", "diffSide": "RIGHT", "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjozNzoyM1rOH_PF8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwODoxMzo1NVrOIAalqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ==", "bodyText": "I'm curious how we decided that 1h is the recommended value for monitor interval, and why a smaller value, say, 30min can cause pressure on metastore?", "url": "https://github.com/apache/flink/pull/14310#discussion_r536069619", "createdAt": "2020-12-04T12:37:23Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA3MDQwMQ==", "bodyText": "It seems to me that contacting metastore every 30min for new partitions should be absolutely fine.", "url": "https://github.com/apache/flink/pull/14310#discussion_r536070401", "createdAt": "2020-12-04T12:38:45Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5MDE1Nw==", "bodyText": "The duration 1h is just an empirical value, compare to 30min, hive partition that use hour is more common that hive partition use  half an hour.", "url": "https://github.com/apache/flink/pull/14310#discussion_r536190157", "createdAt": "2020-12-04T15:42:16Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzE5OTc1OA==", "bodyText": "I agree 1h may be more popular than 30min for partitioning. But just because more users use 1h doesn't mean those using 30min deserve a scary warning.\nWhen writing stream data into hive, we usually tell users that the minimum value supported for sink.partition-commit.delay is around 10min. So I suppose the warning threshold here shouldn't be bigger than that. Because if users can commit new partitions every 10min, it's reasonable to assume they also want to monitor at roughly the same interval. WDYT?", "url": "https://github.com/apache/flink/pull/14310#discussion_r537199758", "createdAt": "2020-12-07T03:05:16Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIyMDcxMg==", "bodyText": "I agree with @lirui-apache here.", "url": "https://github.com/apache/flink/pull/14310#discussion_r537220712", "createdAt": "2020-12-07T04:20:38Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIyMjQ1MQ==", "bodyText": "So I suppose the warning threshold here shouldn't be bigger than that.\n\nI totally agree that we should align the behaviour, but as the document reminded, currently the look up hive parttiont implementation is visit metastore from every task and the  hive-streaming source/sink just visit metastore from one task. So, I'm worried about use same value is not a good choice from current situation.", "url": "https://github.com/apache/flink/pull/14310#discussion_r537222451", "createdAt": "2020-12-07T04:26:33Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI1ODU4Mg==", "bodyText": "@leonardBang  I see your point and I didn't realize it's distributed access to HMS. In that case, I'm fine to keep the threshold as it is. Perhaps we should worry more about how many tasks can concurrently access HMS, than how often they access.\nOne more suggestion about the log message: I think \"Currently the recommended value of '%s' is at least '%s' when set... is easier to understand.", "url": "https://github.com/apache/flink/pull/14310#discussion_r537258582", "createdAt": "2020-12-07T06:23:23Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI3NjIwMA==", "bodyText": "@lirui-apache Nice suggestion, will update soon", "url": "https://github.com/apache/flink/pull/14310#discussion_r537276200", "createdAt": "2020-12-07T07:11:07Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwNjUzOQ==", "bodyText": "Perhaps we should worry more about how many tasks can concurrently access HMS, than how often they access.\n\nMaybe we need introduce a new mechanism the source can notify the all join subtask when to update in Flink SQL", "url": "https://github.com/apache/flink/pull/14310#discussion_r537306539", "createdAt": "2020-12-07T08:13:55Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveLookupTableSource.java", "diffHunk": "@@ -114,16 +117,16 @@ private void validateLookupConfigurations() {\n \t\t\tDuration monitorInterval = configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL) == null\n \t\t\t\t\t? DEFAULT_LOOKUP_MONITOR_INTERVAL\n \t\t\t\t\t: configuration.get(STREAMING_SOURCE_MONITOR_INTERVAL);\n-\t\t\tPreconditions.checkArgument(\n-\t\t\t\t\tmonitorInterval.toMillis() >= DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\tString.format(\n-\t\t\t\t\t\t\t\"Currently the value of '%s' is required bigger or equal to default value '%s' \" +\n-\t\t\t\t\t\t\t\t\t\"when set '%s' to 'latest', but actual is '%s'\",\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_MONITOR_INTERVAL.key(),\n-\t\t\t\t\t\t\tDEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis(),\n-\t\t\t\t\t\t\tSTREAMING_SOURCE_PARTITION_INCLUDE.key(),\n-\t\t\t\t\t\t\tmonitorInterval.toMillis())\n-\t\t\t);\n+\n+\t\t\tif (monitorInterval.toMillis() < DEFAULT_LOOKUP_MONITOR_INTERVAL.toMillis()) {\n+\t\t\t\tLOG.warn(String.format(\n+\t\t\t\t\t\"Currently the recommended value of '%s' is bigger than default value '%s' \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA2OTYxOQ=="}, "originalCommit": {"oid": "cded2fcb5f10c8d6bdbfdece1c591fa658377f90"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4696, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}