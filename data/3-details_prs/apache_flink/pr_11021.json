{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMzM1MjIz", "number": 11021, "title": "[FLINK-15546][table-planner-blink] Fix obscure error message from Sca\u2026", "bodyText": "\u2026larOperatorGens::generateCast\nWhat is the purpose of the change\nScalarOperatorGens::generateCast would produce obscure error message such as Unsupported cast from 'ROW' to 'ROW'. if we want cast one RowType to another.Users are unlikely to figure out what goes wrong from the above error message. Something like Unsupported cast from 'ROW<DECIMAL(2,1), CHAR(3)>' to 'ROW<DOUBLE, VARCHAR(10)>' will be more helpful. This PR would fix this.\nBrief change log\n\n0396817 Use LogicalType instead of LogicalTypeRoot to produce clear error message.\n\nVerifying this change\nThis change added tests to verify\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-02-05T12:00:06Z", "url": "https://github.com/apache/flink/pull/11021", "merged": true, "mergeCommit": {"oid": "5614f2160c7756b78b37e66ef8a543c2c48550bd"}, "closed": true, "closedAt": "2020-02-11T04:04:51Z", "author": {"login": "docete"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBUwHoAH2gAyMzcxMzM1MjIzOjAzOTY4MTdjZDVkODUwNzA0ZjNlZGM3YjgxOTY0NzNhZmNkMDBjZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB6XYFAFqTM1NDk3Mzk1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf", "author": {"user": {"login": "docete", "name": "Zhenghua Gao"}}, "url": "https://github.com/apache/flink/commit/0396817cd5d850704f3edc7b8196473afcd00cdf", "committedDate": "2020-02-05T11:50:40Z", "message": "[FLINK-15546][table-planner-blink] Fix obscure error message from ScalarOperatorGens::generateCast"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjIzNTU2", "url": "https://github.com/apache/flink/pull/11021#pullrequestreview-354223556", "createdAt": "2020-02-06T06:28:21Z", "commit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTUwMDAw", "url": "https://github.com/apache/flink/pull/11021#pullrequestreview-354950000", "createdAt": "2020-02-07T06:19:31Z", "commit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoxOTozMVrOFmzSCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoxOTozMVrOFmzSCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA==", "bodyText": "This test case can't reproduce the problem which reported by this issue. You should add a test case which cast a ROW to another ROW, e.g.\ntestSqlApi(\"CAST(f5 AS ROW<f0 INT, f1 STRING>)\", \"\")", "url": "https://github.com/apache/flink/pull/11021#discussion_r376230408", "createdAt": "2020-02-07T06:19:31Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTUxMTc0", "url": "https://github.com/apache/flink/pull/11021#pullrequestreview-354951174", "createdAt": "2020-02-07T06:24:05Z", "commit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoyNDowNlrOFmzVuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoyNDowNlrOFmzVuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTM1NQ==", "bodyText": "Nit: Add '' to table api too.", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231355", "createdAt": "2020-02-07T06:24:06Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarOperatorGens.scala", "diffHunk": "@@ -1280,8 +1280,8 @@ object ScalarOperatorGens {\n           | (INTERVAL_YEAR_MONTH, BIGINT) =>\n       internalExprCasting(operand, targetType)\n \n-    case (from, to) =>\n-      throw new CodeGenException(s\"Unsupported cast from '$from' to '$to'.\")\n+    case (_, _) =>\n+      throw new CodeGenException(s\"Unsupported cast from '${operand.resultType}' to '$targetType'.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6569bb9fdc622da86b48abe6b00263e720d5bbe8", "author": {"user": {"login": "docete", "name": "Zhenghua Gao"}}, "url": "https://github.com/apache/flink/commit/6569bb9fdc622da86b48abe6b00263e720d5bbe8", "committedDate": "2020-02-07T06:47:09Z", "message": "fixup: add test case to verify SQL api and improve error message for Table api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTczOTUy", "url": "https://github.com/apache/flink/pull/11021#pullrequestreview-354973952", "createdAt": "2020-02-07T07:40:02Z", "commit": {"oid": "6569bb9fdc622da86b48abe6b00263e720d5bbe8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4218, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}