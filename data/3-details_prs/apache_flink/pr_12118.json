{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjQ2MTI4", "number": 12118, "title": "[FLINK-17636][network][tests] Fix the unstable unit tests in SingleInputGateTest", "bodyText": "What is the purpose of the change\nFix the unstable unit test in SingleInputGateTest#testConcurrentReadStateAndProcessAndClose.\nIt not only throws CancelTaskException after gate closed during getNextBuffer, so we extend it to a general Throwable to avoid fragile.\nBrief change log\n\nIgnores any kind of exceptions after single gate closed inside SingleInputGateTest#testConcurrentReadStateAndProcessAndClose\n\nVerifying this change\nThis change is already covered by existing tests\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-05-13T09:45:11Z", "url": "https://github.com/apache/flink/pull/12118", "merged": true, "mergeCommit": {"oid": "c781d170e319d4617afc14aba716697ae0d517f0"}, "closed": true, "closedAt": "2020-05-14T02:17:53Z", "author": {"login": "zhijiangW"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg16-xgFqTQxMDc3Mzk4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg-Y_QAFqTQxMTI1MDQyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNzczOTg5", "url": "https://github.com/apache/flink/pull/12118#pullrequestreview-410773989", "createdAt": "2020-05-13T10:01:02Z", "commit": {"oid": "13f80049e7afb86c35be7b275c1cef74d7a81ab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMDowMTowMlrOGUqdrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMDowMTowMlrOGUqdrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMyMDQzMQ==", "bodyText": "The error message I think is incorrect, as I guess the point is, if the close future is NOT done, no exception should occur?\nif (!inputGate.getCloseFuture().isDone()) {\n  throw new AssertionError(\"Exceptions are expected here only if the gate was closed\", t);\n}", "url": "https://github.com/apache/flink/pull/12118#discussion_r424320431", "createdAt": "2020-05-13T10:01:02Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/io/network/partition/consumer/SingleInputGateTest.java", "diffHunk": "@@ -226,7 +225,8 @@ public void testConcurrentReadStateAndProcessAndClose() throws Exception {\n \t\t\t\t\t\tif (!getNextBufferAndVerify(inputGate, states)) {\n \t\t\t\t\t\t\tThread.sleep(1);\n \t\t\t\t\t\t}\n-\t\t\t\t\t} catch (CancelTaskException expected) {\n+\t\t\t\t\t} catch (Throwable t) {\n+\t\t\t\t\t\tassertTrue(\"The gate is expected closed, but the actual exception is \" + t.getMessage(), inputGate.getCloseFuture().isDone());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13f80049e7afb86c35be7b275c1cef74d7a81ab8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd705534e988974406c28afd359821b3e7f3d1a", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/acd705534e988974406c28afd359821b3e7f3d1a", "committedDate": "2020-05-13T10:10:48Z", "message": "[FLINK-17636][network][tests] Fix the unstable unit tests in SingleInputGateTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13f80049e7afb86c35be7b275c1cef74d7a81ab8", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/13f80049e7afb86c35be7b275c1cef74d7a81ab8", "committedDate": "2020-05-13T09:39:33Z", "message": "[FLINK-17636][network][tests] Fix the unstable unit tests in SingleInputGateTest"}, "afterCommit": {"oid": "acd705534e988974406c28afd359821b3e7f3d1a", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/acd705534e988974406c28afd359821b3e7f3d1a", "committedDate": "2020-05-13T10:10:48Z", "message": "[FLINK-17636][network][tests] Fix the unstable unit tests in SingleInputGateTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjUwNDI3", "url": "https://github.com/apache/flink/pull/12118#pullrequestreview-411250427", "createdAt": "2020-05-13T19:53:04Z", "commit": {"oid": "acd705534e988974406c28afd359821b3e7f3d1a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4354, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}