{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NjYxOTc2", "number": 11622, "title": "[FLINK-16913][configuration, statebackend] Migrated StateBackends to use ReadableConfig instead of Configuration", "bodyText": "What is the purpose of the change\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters.\nBrief change log\n\nReplaced Configuration with ReadableConfig for StateBackends configuration\nChanged type of TIMER_SERVICE_FACTORY option\nRemoved ReadableConfigToConfigurationAdapter.java\n\nVerifying this change\nThis change is already covered by existing tests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-04-02T15:46:09Z", "url": "https://github.com/apache/flink/pull/11622", "merged": true, "mergeCommit": {"oid": "bb46756b84940a6134910e74406bfaff4f2f37e9"}, "closed": true, "closedAt": "2020-04-05T17:31:20Z", "author": {"login": "dawidwys"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTupV7AFqTM4NjU3NDUyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUomCXgBqjMyMDIzMzU4MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTc0NTI2", "url": "https://github.com/apache/flink/pull/11622#pullrequestreview-386574526", "createdAt": "2020-04-02T16:04:30Z", "commit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNjowNDozMFrOF_yaYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNjowODo0MlrOF_yl4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMDU2MQ==", "bodyText": "Is it a problem that the type of the config option changes. You mentioned to me before that this could impact users, which is correct.\nI would not be too worried, though, because most users probably would not use this in code but rather in the yaml config.", "url": "https://github.com/apache/flink/pull/11622#discussion_r402430561", "createdAt": "2020-04-02T16:04:30Z", "author": {"login": "aljoscha"}, "path": "flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBOptions.java", "diffHunk": "@@ -47,9 +48,10 @@\n \t * Choice of timer service implementation.\n \t */\n \t@Documentation.Section(Documentation.Sections.STATE_BACKEND_ROCKSDB)\n-\tpublic static final ConfigOption<String> TIMER_SERVICE_FACTORY = ConfigOptions\n+\tpublic static final ConfigOption<PriorityQueueStateType> TIMER_SERVICE_FACTORY = ConfigOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMTc5NA==", "bodyText": "Also, weirdly named option: it's a \"factory\" but the type is an enum? \ud83d\ude05", "url": "https://github.com/apache/flink/pull/11622#discussion_r402431794", "createdAt": "2020-04-02T16:06:12Z", "author": {"login": "aljoscha"}, "path": "flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBOptions.java", "diffHunk": "@@ -47,9 +48,10 @@\n \t * Choice of timer service implementation.\n \t */\n \t@Documentation.Section(Documentation.Sections.STATE_BACKEND_ROCKSDB)\n-\tpublic static final ConfigOption<String> TIMER_SERVICE_FACTORY = ConfigOptions\n+\tpublic static final ConfigOption<PriorityQueueStateType> TIMER_SERVICE_FACTORY = ConfigOptions", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMDU2MQ=="}, "originalCommit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMjg1Nw==", "bodyText": "Nit: you could just turn the field into a ConfigOption.", "url": "https://github.com/apache/flink/pull/11622#discussion_r402432857", "createdAt": "2020-04-02T16:07:44Z", "author": {"login": "aljoscha"}, "path": "flink-state-backends/flink-statebackend-rocksdb/src/test/java/org/apache/flink/contrib/streaming/state/RocksDBStateBackendConfigTest.java", "diffHunk": "@@ -792,8 +794,11 @@ public ColumnFamilyOptions createColumnOptions(ColumnFamilyOptions currentOption\n \t\t}\n \n \t\t@Override\n-\t\tpublic RocksDBOptionsFactory configure(Configuration configuration) {\n-\t\t\tthis.backgroundJobs = configuration.getInteger(BACKGROUND_JOBS_OPTION, DEFAULT_BACKGROUND_JOBS);\n+\t\tpublic RocksDBOptionsFactory configure(ReadableConfig configuration) {\n+\t\t\tthis.backgroundJobs = configuration.get(\n+\t\t\t\tConfigOptions.key(BACKGROUND_JOBS_OPTION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMzUwNg==", "bodyText": "wouldn't config.set(RocksDBOptions.TIMER_SERVICE_FACTORY, ...) work?", "url": "https://github.com/apache/flink/pull/11622#discussion_r402433506", "createdAt": "2020-04-02T16:08:42Z", "author": {"login": "aljoscha"}, "path": "flink-tests/src/test/java/org/apache/flink/test/checkpointing/EventTimeWindowCheckpointingITCase.java", "diffHunk": "@@ -179,7 +179,7 @@ private Configuration getConfiguration() throws Exception {\n \t\t\tcase ROCKSDB_INCREMENTAL:\n \t\t\t\t// Test RocksDB based timer service as well\n \t\t\t\tconfig.setString(\n-\t\t\t\t\tRocksDBOptions.TIMER_SERVICE_FACTORY,\n+\t\t\t\t\tRocksDBOptions.TIMER_SERVICE_FACTORY.key(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abc70d0db7c027b6ff3777d38ac9f67699b8659f", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/abc70d0db7c027b6ff3777d38ac9f67699b8659f", "committedDate": "2020-04-02T15:37:10Z", "message": "[FLINK-16913][configuration, statebackend] Migrated StateBackends to use\nReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}, "afterCommit": {"oid": "49b318a91e27cbd88b5ca929761bb22881b21ea8", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/49b318a91e27cbd88b5ca929761bb22881b21ea8", "committedDate": "2020-04-02T17:41:30Z", "message": "[FLINK-16913] Migrate StateBackends to use\nReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49b318a91e27cbd88b5ca929761bb22881b21ea8", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/49b318a91e27cbd88b5ca929761bb22881b21ea8", "committedDate": "2020-04-02T17:41:30Z", "message": "[FLINK-16913] Migrate StateBackends to use\nReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}, "afterCommit": {"oid": "3d16e055f832e4449d68a711c49c52f5fbb4fa94", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/3d16e055f832e4449d68a711c49c52f5fbb4fa94", "committedDate": "2020-04-03T07:38:55Z", "message": "[FLINK-16913] Migrate StateBackends to use\nReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d16e055f832e4449d68a711c49c52f5fbb4fa94", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/3d16e055f832e4449d68a711c49c52f5fbb4fa94", "committedDate": "2020-04-03T07:38:55Z", "message": "[FLINK-16913] Migrate StateBackends to use\nReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}, "afterCommit": {"oid": "3a348f8db520e8b5e6518ae0c47575edd3e98dda", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/3a348f8db520e8b5e6518ae0c47575edd3e98dda", "committedDate": "2020-04-03T07:50:32Z", "message": "[FLINK-16913] Migrate StateBackends to use ReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MDMxNzAw", "url": "https://github.com/apache/flink/pull/11622#pullrequestreview-387031700", "createdAt": "2020-04-03T07:50:50Z", "commit": {"oid": "3d16e055f832e4449d68a711c49c52f5fbb4fa94"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46e2d9b408be3eecbd83a8aeb8bd1aa911cd89b7", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/46e2d9b408be3eecbd83a8aeb8bd1aa911cd89b7", "committedDate": "2020-04-05T11:41:53Z", "message": "[FLINK-16913] Migrate StateBackends to use ReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a348f8db520e8b5e6518ae0c47575edd3e98dda", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/3a348f8db520e8b5e6518ae0c47575edd3e98dda", "committedDate": "2020-04-03T07:50:32Z", "message": "[FLINK-16913] Migrate StateBackends to use ReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}, "afterCommit": {"oid": "46e2d9b408be3eecbd83a8aeb8bd1aa911cd89b7", "author": {"user": {"login": "dawidwys", "name": "Dawid Wysakowicz"}}, "url": "https://github.com/apache/flink/commit/46e2d9b408be3eecbd83a8aeb8bd1aa911cd89b7", "committedDate": "2020-04-05T11:41:53Z", "message": "[FLINK-16913] Migrate StateBackends to use ReadableConfig instead of Configuration\n\nStateBackendFactories do not need a full read and write access to the\nConfiguration object. It's sufficient to have read only access. Moreover\nthe ReadableConfig is a lightweight interface that can be implemented in\nother ways, not just through the Configuration. Lastly we exposed this\nlightweight interface as a configuration entry point for\nExecutionEnvironments. This change will make it possible to pass the\nReadableConfig directly to the StateBackendFactories without fragile\nadapters."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2273, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}