{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MjA1Mjc1", "number": 12496, "title": "[FLINK-18110][fs-connector] StreamingFileSink notifies for buckets detected to be inactive on restoring", "bodyText": "What is the purpose of the change\nThis PR fixed the issue that the BucketLifeCycleListener in StreamingFileSink misses the notification for buckets detected inactive on restoring. On restoring, the buckets with only pending files will get all the pending files committed and will not be recorded. At this time, StreamingFileSink should notify that the buckets get inactive.\nBrief change log\n\n18db5ae adds the missed notification.\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nAdded test that validates that the notification is sent on restoring if buckets get inactive.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable", "createdAt": "2020-06-05T03:52:48Z", "url": "https://github.com/apache/flink/pull/12496", "merged": true, "mergeCommit": {"oid": "0a1b0c615c4968afd29f09a3494bbf137a223609"}, "closed": true, "closedAt": "2020-06-08T02:09:50Z", "author": {"login": "gaoyunhaii"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoKX_7gH2gAyNDI4MjA1Mjc1OjE4ZGI1YWU0ZGIyYzUyODRiZjA1MzBjNjBlMDVmMDJiZTNhNDBkMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpGwk8AFqTQyNTg4MTExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18db5ae4db2c5284bf0530c60e05f02be3a40d19", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/18db5ae4db2c5284bf0530c60e05f02be3a40d19", "committedDate": "2020-06-05T03:48:19Z", "message": "[FLINK-18110][fs-connector] StreamingFileSink notifies for buckets detected to be inactive on restoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTA0Mjcx", "url": "https://github.com/apache/flink/pull/12496#pullrequestreview-425104271", "createdAt": "2020-06-05T08:36:13Z", "commit": {"oid": "18db5ae4db2c5284bf0530c60e05f02be3a40d19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODozNjoxM1rOGfleGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODozNjoxM1rOGfleGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc3Mjk1Mg==", "bodyText": "Add a method: inactiveBucket(Bucket<IN, BucketID>)?", "url": "https://github.com/apache/flink/pull/12496#discussion_r435772952", "createdAt": "2020-06-05T08:36:13Z", "author": {"login": "JingsongLi"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/filesystem/Buckets.java", "diffHunk": "@@ -187,6 +187,10 @@ private void handleRestoredBucketState(final BucketState<BucketID> recoveredStat\n \n \tprivate void updateActiveBucketId(final BucketID bucketId, final Bucket<IN, BucketID> restoredBucket) throws IOException {\n \t\tif (!restoredBucket.isActive()) {\n+\t\t\tif (bucketLifeCycleListener != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db5ae4db2c5284bf0530c60e05f02be3a40d19"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecd96fe843f4aa45178e54bcdb2cb1e3f8ff831b", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/ecd96fe843f4aa45178e54bcdb2cb1e3f8ff831b", "committedDate": "2020-06-07T09:01:46Z", "message": "Extract common method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODgxMTE1", "url": "https://github.com/apache/flink/pull/12496#pullrequestreview-425881115", "createdAt": "2020-06-08T02:09:28Z", "commit": {"oid": "ecd96fe843f4aa45178e54bcdb2cb1e3f8ff831b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4345, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}