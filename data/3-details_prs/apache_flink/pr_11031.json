{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODM2NDM2", "number": 11031, "title": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs", "bodyText": "What is the purpose of the change\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor. But it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the checkpoint related metrics for the case of two inputs.\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler.\nBrief change log\nAdd the related metrics while constructing the CheckpointBarrierHandler for two input cases.\nRefactor the adding of related metrics for one input in order to reuse/unify the codes.\nVerifying this change\nVia the job testing\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-02-06T11:00:02Z", "url": "https://github.com/apache/flink/pull/11031", "merged": true, "mergeCommit": {"oid": "2a0555bc85e5256718e6b546ffa768a80386e892"}, "closed": true, "closedAt": "2020-02-11T10:03:56Z", "author": {"login": "zhijiangW"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBoP6BgH2gAyMzcxODM2NDM2OmFjNDkzMDk2NWE3ZjY0YzRkYjFlYzJkOGVmM2Q3ODM4ZGQ2ZWM0NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDM33QABqjMwMjU0OTY4Mzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac4930965a7f64c4db1ec2d8ef3d7838dd6ec46f", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/ac4930965a7f64c4db1ec2d8ef3d7838dd6ec46f", "committedDate": "2020-02-06T10:33:35Z", "message": "[hotfix][task] Fix the comment typo in TwoInputStreamTask class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDU4NjQz", "url": "https://github.com/apache/flink/pull/11031#pullrequestreview-354458643", "createdAt": "2020-02-06T13:45:27Z", "commit": {"oid": "80543b67036d2b2d589bfc677e583199b96e4a61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0NToyN1rOFmbgiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0NToyN1rOFmbgiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg0MDkwNQ==", "bodyText": "? It's not used anywhere in the tests, isn't it?", "url": "https://github.com/apache/flink/pull/11031#discussion_r375840905", "createdAt": "2020-02-06T13:45:27Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointedInputGate.java", "diffHunk": "@@ -233,15 +234,17 @@ public long getLatestCheckpointId() {\n \t *\n \t * @return The duration in nanoseconds\n \t */\n-\tpublic long getAlignmentDurationNanos() {\n+\t@VisibleForTesting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80543b67036d2b2d589bfc677e583199b96e4a61"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80543b67036d2b2d589bfc677e583199b96e4a61", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/80543b67036d2b2d589bfc677e583199b96e4a61", "committedDate": "2020-02-06T10:47:58Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}, "afterCommit": {"oid": "e8db1410acaf945d236051761f928931633bea84", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/e8db1410acaf945d236051761f928931633bea84", "committedDate": "2020-02-10T05:58:25Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8db1410acaf945d236051761f928931633bea84", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/e8db1410acaf945d236051761f928931633bea84", "committedDate": "2020-02-10T05:58:25Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}, "afterCommit": {"oid": "c411f7735ea814410840a46ecfde839340d4cf3b", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/c411f7735ea814410840a46ecfde839340d4cf3b", "committedDate": "2020-02-10T06:09:48Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODA5NTY3", "url": "https://github.com/apache/flink/pull/11031#pullrequestreview-355809567", "createdAt": "2020-02-10T10:00:05Z", "commit": {"oid": "c411f7735ea814410840a46ecfde839340d4cf3b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDowMDowNVrOFngB0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDowMDowNVrOFngB0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk2MzUzOA==", "bodyText": "nit: I think we do not allow wildcard imports", "url": "https://github.com/apache/flink/pull/11031#discussion_r376963538", "createdAt": "2020-02-10T10:00:05Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTaskTest.java", "diffHunk": "@@ -51,14 +53,14 @@\n import org.apache.flink.streaming.util.TestBoundedTwoInputOperator;\n import org.apache.flink.streaming.util.TestHarnessUtil;\n \n+import org.hamcrest.collection.IsMapContaining;\n import org.junit.Assert;\n import org.junit.Test;\n \n-import java.util.Arrays;\n-import java.util.HashSet;\n-import java.util.List;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c411f7735ea814410840a46ecfde839340d4cf3b"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c411f7735ea814410840a46ecfde839340d4cf3b", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/c411f7735ea814410840a46ecfde839340d4cf3b", "committedDate": "2020-02-10T06:09:48Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}, "afterCommit": {"oid": "5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "committedDate": "2020-02-10T14:06:39Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/5cd1f9bc43cf71f6e548b76fadff0ce7f1bfa9e2", "committedDate": "2020-02-10T14:06:39Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}, "afterCommit": {"oid": "54550e7b277e46737782f8c5844ca12c5cc517c3", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/54550e7b277e46737782f8c5844ca12c5cc517c3", "committedDate": "2020-02-11T03:41:51Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "committedDate": "2020-02-11T07:47:08Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54550e7b277e46737782f8c5844ca12c5cc517c3", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/54550e7b277e46737782f8c5844ca12c5cc517c3", "committedDate": "2020-02-11T03:41:51Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}, "afterCommit": {"oid": "a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "author": {"user": {"login": "zhijiangW", "name": "zhijiang"}}, "url": "https://github.com/apache/flink/commit/a4430b7e69781faab3efcd3b31a9e448d3a87fbb", "committedDate": "2020-02-11T07:47:08Z", "message": "[FLINK-15914][checkpointing][metrics] Miss the checkpoint related metrics for the case of two inputs\n\nWhen the StreamTwoInputSelectableProcessor was introduced before, it forgot adding the checkpoint related metrics in the constructor.\nBut it did not cause any problems, because only the StreamTwoInputProcessor actually worked before.\n\nAfter StreamTwoInputProcessor is replaced by StreamTwoInputSelectableProcessor as now, this bug is exposed and we will not see the\ncheckpoint related metrics for the case of two inputs.\n\nThe solution is to add these metrics while constructing the CheckpointBarrierHandler."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4234, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}