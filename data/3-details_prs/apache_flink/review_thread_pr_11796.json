{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTMzNjMy", "number": 11796, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTozOFrOD1w17g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowODowNlrOD1xAOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzAxMzU4OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTozOFrOGLWl5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTozOFrOGLWl5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1NzY2OQ==", "bodyText": "please add param note", "url": "https://github.com/apache/flink/pull/11796#discussion_r414557669", "createdAt": "2020-04-24T13:01:38Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzAxNDg3OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTo1NVrOGLWmpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMTo1NVrOGLWmpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1Nzg2MA==", "bodyText": "as above", "url": "https://github.com/apache/flink/pull/11796#discussion_r414557860", "createdAt": "2020-04-24T13:01:55Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,\n \t\t\tTableSchema schema,\n \t\t\tPath path,\n \t\t\tList<String> partitionKeys,\n \t\t\tString defaultPartName,\n+\t\t\tlong rollingFileSize,\n+\t\t\tlong rollingTimeInterval,\n \t\t\tMap<String, String> formatProperties) {\n+\t\tthis.isBounded = isBounded;\n \t\tthis.schema = schema;\n \t\tthis.path = path;\n \t\tthis.defaultPartName = defaultPartName;\n+\t\tthis.rollingFileSize = rollingFileSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzAxNjA2OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMjoxNFrOGLWnaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowMjoxNFrOGLWnaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1ODA1Ng==", "bodyText": "as above", "url": "https://github.com/apache/flink/pull/11796#discussion_r414558056", "createdAt": "2020-04-24T13:02:14Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -75,14 +86,20 @@\n \t * @param formatProperties format properties.\n \t */\n \tpublic FileSystemTableSink(\n+\t\t\tboolean isBounded,\n \t\t\tTableSchema schema,\n \t\t\tPath path,\n \t\t\tList<String> partitionKeys,\n \t\t\tString defaultPartName,\n+\t\t\tlong rollingFileSize,\n+\t\t\tlong rollingTimeInterval,\n \t\t\tMap<String, String> formatProperties) {\n+\t\tthis.isBounded = isBounded;\n \t\tthis.schema = schema;\n \t\tthis.path = path;\n \t\tthis.defaultPartName = defaultPartName;\n+\t\tthis.rollingFileSize = rollingFileSize;\n+\t\tthis.rollingTimeInterval = rollingTimeInterval;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzAzMTQ0OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowNjowMlrOGLWwcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwMjo1NToxNFrOGL9qeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MDM2OA==", "bodyText": "This note looks like strange,  I cannot the meaning..", "url": "https://github.com/apache/flink/pull/11796#discussion_r414560368", "createdAt": "2020-04-24T13:06:02Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -284,4 +337,125 @@ public boolean configurePartitionGrouping(boolean supportsGrouping) {\n \t\tthis.dynamicGrouping = supportsGrouping;\n \t\treturn dynamicGrouping;\n \t}\n+\n+\t/**\n+\t * Table bucket assigner, wrap {@link PartitionComputer}.\n+\t */\n+\tprivate static class TableBucketAssigner implements BucketAssigner<BaseRow, String> {\n+\n+\t\tprivate final PartitionComputer<BaseRow> computer;\n+\n+\t\tprivate TableBucketAssigner(PartitionComputer<BaseRow> computer) {\n+\t\t\tthis.computer = computer;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic String getBucketId(BaseRow element, Context context) {\n+\t\t\ttry {\n+\t\t\t\treturn PartitionPathUtils.generatePartitionPath(\n+\t\t\t\t\t\tcomputer.generatePartValues(element));\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new RuntimeException(e);\n+\t\t\t}\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic SimpleVersionedSerializer<String> getSerializer() {\n+\t\t\treturn SimpleVersionedStringSerializer.INSTANCE;\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Table {@link RollingPolicy}, now it is a {@link CheckpointRollingPolicy}.\n+\t * Because partition commit is hard to support false.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE5NzgxNw==", "bodyText": "Sorry for out of date comments, should be:\nTable {@link RollingPolicy}, it extends {@link CheckpointRollingPolicy} for bulk writers.", "url": "https://github.com/apache/flink/pull/11796#discussion_r415197817", "createdAt": "2020-04-26T02:55:14Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/FileSystemTableSink.java", "diffHunk": "@@ -284,4 +337,125 @@ public boolean configurePartitionGrouping(boolean supportsGrouping) {\n \t\tthis.dynamicGrouping = supportsGrouping;\n \t\treturn dynamicGrouping;\n \t}\n+\n+\t/**\n+\t * Table bucket assigner, wrap {@link PartitionComputer}.\n+\t */\n+\tprivate static class TableBucketAssigner implements BucketAssigner<BaseRow, String> {\n+\n+\t\tprivate final PartitionComputer<BaseRow> computer;\n+\n+\t\tprivate TableBucketAssigner(PartitionComputer<BaseRow> computer) {\n+\t\t\tthis.computer = computer;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic String getBucketId(BaseRow element, Context context) {\n+\t\t\ttry {\n+\t\t\t\treturn PartitionPathUtils.generatePartitionPath(\n+\t\t\t\t\t\tcomputer.generatePartValues(element));\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new RuntimeException(e);\n+\t\t\t}\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic SimpleVersionedSerializer<String> getSerializer() {\n+\t\t\treturn SimpleVersionedStringSerializer.INSTANCE;\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Table {@link RollingPolicy}, now it is a {@link CheckpointRollingPolicy}.\n+\t * Because partition commit is hard to support false.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MDM2OA=="}, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzAzOTk1OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/PartitionPathUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzowODowNlrOGLW1kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwMjo1Njo0M1rOGL9roA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MTY4MQ==", "bodyText": "we can move the judgement to the begin to make the code path short", "url": "https://github.com/apache/flink/pull/11796#discussion_r414561681", "createdAt": "2020-04-24T13:08:06Z", "author": {"login": "leonardBang"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/PartitionPathUtils.java", "diffHunk": "@@ -88,7 +88,9 @@ public static String generatePartitionPath(LinkedHashMap<String, String> partiti\n \t\t\tsuffixBuf.append(escapePathName(e.getValue()));\n \t\t\ti++;\n \t\t}\n-\t\tsuffixBuf.append(Path.SEPARATOR);\n+\t\tif (partitionSpec.size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE5ODExMg==", "bodyText": "Good catch.\nif (partitionSpec.isEmpty()) {\n  return \"\";\n}", "url": "https://github.com/apache/flink/pull/11796#discussion_r415198112", "createdAt": "2020-04-26T02:56:43Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/PartitionPathUtils.java", "diffHunk": "@@ -88,7 +88,9 @@ public static String generatePartitionPath(LinkedHashMap<String, String> partiti\n \t\t\tsuffixBuf.append(escapePathName(e.getValue()));\n \t\t\ti++;\n \t\t}\n-\t\tsuffixBuf.append(Path.SEPARATOR);\n+\t\tif (partitionSpec.size() > 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2MTY4MQ=="}, "originalCommit": {"oid": "4d98d46528fab8087fccf79b9184f27a6197c714"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1667, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}