{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDkxNjE4", "number": 11764, "title": "[FLINK-17023][scripts] Fix format checking of extractExecutionParams in config.sh", "bodyText": "What is the purpose of the change\nIn FLINK-15727 BashJavaUtils now returns multiple lines of results to avoid using BashJavaUtils twice. But now the format checking for the last line is incorrect.\nThis PR fixes the format checking for the last line in extractExecutionParams in config.sh.\nBrief change log\n\nFix format checking of extractExecutionParams in config.sh\n\nVerifying this change\nThis change is a trivial rework / code cleanup without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable", "createdAt": "2020-04-16T03:11:43Z", "url": "https://github.com/apache/flink/pull/11764", "merged": true, "mergeCommit": {"oid": "0c9ced4e8175bf458060400c5f5a067f307fcd2a"}, "closed": true, "closedAt": "2020-04-17T15:48:26Z", "author": {"login": "tsreaper"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYa7_FgH2gAyNDA0MDkxNjE4OmVmMWZiODM1ZWM3NjU1ZWIxYTYyZWJiOWRjZjllMjAzM2RjZmIxNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZhxzJgFqTM5NjYyMjk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "author": {"user": {"login": "tsreaper", "name": null}}, "url": "https://github.com/apache/flink/commit/ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "committedDate": "2020-04-17T06:03:19Z", "message": "[FLINK-17023][scripts] Fix format checking of extractExecutionParams in config.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MjEzNDEx", "url": "https://github.com/apache/flink/pull/11764#pullrequestreview-395213411", "createdAt": "2020-04-17T07:14:12Z", "commit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNDoxM1rOGHCjDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNToyN1rOGHClKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDk1OA==", "bodyText": "taskmanager.sh uses a different way of counting lines: num_lines=$(echo \"${java_utils_output}\" | wc -l)\nI'd prefer if we stick to 1 way of doing it", "url": "https://github.com/apache/flink/pull/11764#discussion_r410034958", "createdAt": "2020-04-17T07:14:13Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQxOA==", "bodyText": "this is undefined is it not?", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035418", "createdAt": "2020-04-17T07:15:15Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQ5OA==", "bodyText": "same here, $output isn't defined anywhere", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035498", "createdAt": "2020-04-17T07:15:27Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2\n+        exit 1\n+    fi\n+\n+    if ! [[ ${execution_config} =~ ^${EXECUTION_PREFIX}.* ]]; then\n         echo \"[ERROR] Unexpected result: $execution_config\" 1>&2\n-        echo \"[ERROR] The last line of the BashJavaUtils outputs is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n+        echo \"[ERROR] The output of BashJavaUtils is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n         echo \"$output\" 1>&2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e", "author": {"user": {"login": "tsreaper", "name": null}}, "url": "https://github.com/apache/flink/commit/85d4202c20c3d4649dd4c860595ffae7ea3eba3e", "committedDate": "2020-04-17T07:24:30Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjIyOTY1", "url": "https://github.com/apache/flink/pull/11764#pullrequestreview-396622965", "createdAt": "2020-04-20T16:35:27Z", "commit": {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToyN1rOGIdaoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToyN1rOGIdaoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzc0NA==", "bodyText": "I think this change broke my local setup. If I build from master I can no longer start a cluster via bin/start-cluster.sh.", "url": "https://github.com/apache/flink/pull/11764#discussion_r411523744", "createdAt": "2020-04-20T16:35:27Z", "author": {"login": "tillrohrmann"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,10 +644,16 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local num_lines=$(echo \"$execution_config\" | wc -l)\n+    if ! [[ ${num_lines} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($num_lines lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        exit 1\n+    fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1803, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}