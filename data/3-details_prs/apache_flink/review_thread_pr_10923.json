{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzU0NDg4", "number": 10923, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjozMzo0N1rODZ5ZRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjozMzo0N1rODZ5ZRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NDgxMzUwOnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorPartitionLifecycleTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjozMzo0N1rOFgixjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODo0MTozOVrOFgm1aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2ODQ5NQ==", "bodyText": "I think this is not 100% correct as the internal TestingTaskExecutorPartitionTracker#promotePartitionsConsumer field is not volatile. Hence, the TaskExecutor might read a stale value. I would suggest to either setup these things before creating the TaskExecutor or if this is not possible, then make the fields volatile.", "url": "https://github.com/apache/flink/pull/10923#discussion_r369668495", "createdAt": "2020-01-22T16:33:47Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorPartitionLifecycleTest.java", "diffHunk": "@@ -254,7 +249,7 @@ public void testPartitionPromotion() throws Exception {\n \t\ttestPartitionRelease(\n \t\t\t(jobId, partitionId, taskExecutor, taskExecutorGateway, partitionTracker) -> {\n \t\t\t\tfinal CompletableFuture<Collection<ResultPartitionID>> releasePartitionsFuture = new CompletableFuture<>();\n-\t\t\t\trunInTaskExecutorThreadAndWait(taskExecutor, () -> partitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete));\n+\t\t\t\tpartitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c271c86281723f9cfa99ed95d6073c280a753e25"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMjcxMQ==", "bodyText": "hasn't failed so far \ud83d\ude48", "url": "https://github.com/apache/flink/pull/10923#discussion_r369732711", "createdAt": "2020-01-22T18:37:02Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorPartitionLifecycleTest.java", "diffHunk": "@@ -254,7 +249,7 @@ public void testPartitionPromotion() throws Exception {\n \t\ttestPartitionRelease(\n \t\t\t(jobId, partitionId, taskExecutor, taskExecutorGateway, partitionTracker) -> {\n \t\t\t\tfinal CompletableFuture<Collection<ResultPartitionID>> releasePartitionsFuture = new CompletableFuture<>();\n-\t\t\t\trunInTaskExecutorThreadAndWait(taskExecutor, () -> partitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete));\n+\t\t\t\tpartitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2ODQ5NQ=="}, "originalCommit": {"oid": "c271c86281723f9cfa99ed95d6073c280a753e25"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczNTAxOQ==", "bodyText": "On a more serious note I wanted to push this back a bit since it looked like a bigger change, and I didn't want to delay the removal of this method.\nBut I think I may have a quick solution that I'll try tomorrow.", "url": "https://github.com/apache/flink/pull/10923#discussion_r369735019", "createdAt": "2020-01-22T18:41:39Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorPartitionLifecycleTest.java", "diffHunk": "@@ -254,7 +249,7 @@ public void testPartitionPromotion() throws Exception {\n \t\ttestPartitionRelease(\n \t\t\t(jobId, partitionId, taskExecutor, taskExecutorGateway, partitionTracker) -> {\n \t\t\t\tfinal CompletableFuture<Collection<ResultPartitionID>> releasePartitionsFuture = new CompletableFuture<>();\n-\t\t\t\trunInTaskExecutorThreadAndWait(taskExecutor, () -> partitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete));\n+\t\t\t\tpartitionTracker.setPromotePartitionsConsumer(releasePartitionsFuture::complete);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2ODQ5NQ=="}, "originalCommit": {"oid": "c271c86281723f9cfa99ed95d6073c280a753e25"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1102, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}