{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MDIxMDky", "number": 12457, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxOTozNjowNlrOECSxUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo0ODoxNlrOEC0PQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODQwMTQ3OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateCheckpointWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxOTozNjowNlrOGeqepg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNzo0ODozM1rOGe517A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgwNjQzOA==", "bodyText": "Should be flinkBuffer (or simply buffer).", "url": "https://github.com/apache/flink/pull/12457#discussion_r434806438", "createdAt": "2020-06-03T19:36:06Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateCheckpointWriter.java", "diffHunk": "@@ -108,32 +108,30 @@\n \t\trunWithChecks(() -> serializer.writeHeader(dataStream));\n \t}\n \n-\tvoid writeInput(InputChannelInfo info, Buffer... flinkBuffers) throws Exception {\n+\tvoid writeInput(InputChannelInfo info, Buffer flinkBuffers) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e7fa184fdc100b55d436011081b645dc4ef069c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA1ODE1Ng==", "bodyText": "Renamed to buffer.\nThanks.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435058156", "createdAt": "2020-06-04T07:48:33Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateCheckpointWriter.java", "diffHunk": "@@ -108,32 +108,30 @@\n \t\trunWithChecks(() -> serializer.writeHeader(dataStream));\n \t}\n \n-\tvoid writeInput(InputChannelInfo info, Buffer... flinkBuffers) throws Exception {\n+\tvoid writeInput(InputChannelInfo info, Buffer flinkBuffers) throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgwNjQzOA=="}, "originalCommit": {"oid": "7e7fa184fdc100b55d436011081b645dc4ef069c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMzg4MTM0OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo0NTo1MFrOGfgPgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzozNjowNFrOGfjkZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4NzI5OA==", "bodyText": "What's the difference to the previous version? Especially in the behaviour? It looks like a subtle change that I'm missing.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435687298", "createdAt": "2020-06-05T04:45:50Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "diffHunk": "@@ -52,6 +53,10 @@ static ChannelStateWriteRequest write(long checkpointId, InputChannelInfo info,\n \t\treturn buildWriteRequest(checkpointId, \"writeInput\", iterator, (writer, buffer) -> writer.writeInput(info, buffer));\n \t}\n \n+\tstatic ChannelStateWriteRequest write(long checkpointId, ResultSubpartitionInfo info, Buffer... buffers) {\n+\t\treturn buildWriteRequest(checkpointId, \"writeOutput\", ofElements(Buffer::recycleBuffer, buffers), (writer, buffer) -> writer.writeOutput(info, buffer));\n+\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc0MTc5Nw==", "bodyText": "It is using CloseableIterator now, which recycles on unused elements on close().\nPrevious version recycled all buffers in cancel regardless of whether they were used or not.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435741797", "createdAt": "2020-06-05T07:36:04Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "diffHunk": "@@ -52,6 +53,10 @@ static ChannelStateWriteRequest write(long checkpointId, InputChannelInfo info,\n \t\treturn buildWriteRequest(checkpointId, \"writeInput\", iterator, (writer, buffer) -> writer.writeInput(info, buffer));\n \t}\n \n+\tstatic ChannelStateWriteRequest write(long checkpointId, ResultSubpartitionInfo info, Buffer... buffers) {\n+\t\treturn buildWriteRequest(checkpointId, \"writeOutput\", ofElements(Buffer::recycleBuffer, buffers), (writer, buffer) -> writer.writeOutput(info, buffer));\n+\t}\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4NzI5OA=="}, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMzg4MTk0OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo0NjoxN1rOGfgP3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzo0NDozMlrOGfj0gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4NzM5MQ==", "bodyText": "Can you copy JIRA description to this commit description? By looking at it, it's quite hard to understand what is it fixing and how.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435687391", "createdAt": "2020-06-05T04:46:17Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "diffHunk": "@@ -32,6 +32,7 @@\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.EXECUTING;\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.FAILED;\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.NEW;\n+import static org.apache.flink.util.CloseableIterator.ofElements;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc0NTkyMA==", "bodyText": "Done.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435745920", "createdAt": "2020-06-05T07:44:32Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriteRequest.java", "diffHunk": "@@ -32,6 +32,7 @@\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.EXECUTING;\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.FAILED;\n import static org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequestState.NEW;\n+import static org.apache.flink.util.CloseableIterator.ofElements;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4NzM5MQ=="}, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMzg4NDgxOnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNDo0ODoxNlrOGfgRvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzozNzoyOVrOGfjnBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4Nzg2OQ==", "bodyText": "Why have you dropped checkBufferType call? It was actually quite helpful couple of times when debugging. Can not we try to keep it?", "url": "https://github.com/apache/flink/pull/12457#discussion_r435687869", "createdAt": "2020-06-05T04:48:16Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "diffHunk": "@@ -129,7 +129,7 @@ public void addOutputData(long checkpointId, ResultSubpartitionInfo info, int st\n \t\t\tinfo,\n \t\t\tstartSeqNum,\n \t\t\tdata == null ? 0 : data.length);\n-\t\tenqueue(write(checkpointId, info, checkBufferType(data)), false);\n+\t\tenqueue(write(checkpointId, info, data), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc0MjQ2OQ==", "bodyText": "It is now called when building iterator - in the same way as for InputChannel buffers.", "url": "https://github.com/apache/flink/pull/12457#discussion_r435742469", "createdAt": "2020-06-05T07:37:29Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "diffHunk": "@@ -129,7 +129,7 @@ public void addOutputData(long checkpointId, ResultSubpartitionInfo info, int st\n \t\t\tinfo,\n \t\t\tstartSeqNum,\n \t\t\tdata == null ? 0 : data.length);\n-\t\tenqueue(write(checkpointId, info, checkBufferType(data)), false);\n+\t\tenqueue(write(checkpointId, info, data), false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY4Nzg2OQ=="}, "originalCommit": {"oid": "16d10ec923bd6af73a5188d9d4b86105f252d6f7"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4415, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}