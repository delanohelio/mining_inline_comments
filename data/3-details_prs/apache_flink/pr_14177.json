{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NzU1NTM0", "number": 14177, "title": " [FLINK-16443][checkpointing] Make sure that CheckpointException are also serialized in DeclineCheckpoint.", "bodyText": "What is the purpose of the change\nThe problem of having exceptions that are only in the user code classloader was fixed by proactively serializing them inside the CheckpointException. That means all consumers of CheckpointException now need to be aware of that and unwrap the serializable exception.\nI believe the right way to fix this would have been to use a SerializedException in the DeclineCheckpoint message instead, which would have localized the change to the actual problem: RPC transport.\nBrief change log\n\nUse a SerializedException in the DeclineCheckpoint message\nRevert #9742\n\nVerifying this change\nIt's a rather minor change, where proper testing would require a rather complicated setup.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-11-23T14:06:22Z", "url": "https://github.com/apache/flink/pull/14177", "merged": true, "mergeCommit": {"oid": "208126aa242c4e217be493140aefcf16c3c3aba9"}, "closed": true, "closedAt": "2020-12-03T08:01:48Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfqnQrgFqTUzNzU0MTk2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiI4ZVABqjQwNjA3MjY1NDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTQxOTY2", "url": "https://github.com/apache/flink/pull/14177#pullrequestreview-537541966", "createdAt": "2020-11-24T14:24:40Z", "commit": {"oid": "81187637662cac241774f53951af4eba82da3484"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoyNDo0MFrOH5DNLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoyNzoyNVrOH5DVsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4MzQwNA==", "bodyText": "Shouldn't we change the type if we know that it is always serialized?", "url": "https://github.com/apache/flink/pull/14177#discussion_r529583404", "createdAt": "2020-11-24T14:24:40Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/messages/checkpoint/DeclineCheckpoint.java", "diffHunk": "@@ -34,21 +35,18 @@\n \tprivate static final long serialVersionUID = 2094094662279578953L;\n \n \t/** The reason why the checkpoint was declined. */\n+\t@Nullable\n \tprivate final Throwable reason;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81187637662cac241774f53951af4eba82da3484"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4Mzg4OA==", "bodyText": "The same actually applies to the return type of getReason() method.", "url": "https://github.com/apache/flink/pull/14177#discussion_r529583888", "createdAt": "2020-11-24T14:25:17Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/messages/checkpoint/DeclineCheckpoint.java", "diffHunk": "@@ -34,21 +35,18 @@\n \tprivate static final long serialVersionUID = 2094094662279578953L;\n \n \t/** The reason why the checkpoint was declined. */\n+\t@Nullable\n \tprivate final Throwable reason;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4MzQwNA=="}, "originalCommit": {"oid": "81187637662cac241774f53951af4eba82da3484"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4NTU4NA==", "bodyText": "I guess that we can now also adapt CheckpointCoordinator.getCheckpointException.", "url": "https://github.com/apache/flink/pull/14177#discussion_r529585584", "createdAt": "2020-11-24T14:27:25Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/messages/checkpoint/DeclineCheckpoint.java", "diffHunk": "@@ -34,21 +35,18 @@\n \tprivate static final long serialVersionUID = 2094094662279578953L;\n \n \t/** The reason why the checkpoint was declined. */\n+\t@Nullable\n \tprivate final Throwable reason;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4MzQwNA=="}, "originalCommit": {"oid": "81187637662cac241774f53951af4eba82da3484"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81187637662cac241774f53951af4eba82da3484", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/81187637662cac241774f53951af4eba82da3484", "committedDate": "2020-11-23T12:56:17Z", "message": "Revert \"[FLINK-14076] Ensure CheckpointException can be deserialized on JobManager\"\n\nThis reverts commit 2bcf5094"}, "afterCommit": {"oid": "ce283f64f17cadd3f4ab80534343dbfe917867fa", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/ce283f64f17cadd3f4ab80534343dbfe917867fa", "committedDate": "2020-11-26T22:04:34Z", "message": "Revert \"[FLINK-14076] Ensure CheckpointException can be deserialized on JobManager\"\n\nThis reverts commit 2bcf5094"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5Nzk2OTc0", "url": "https://github.com/apache/flink/pull/14177#pullrequestreview-539796974", "createdAt": "2020-11-27T08:46:02Z", "commit": {"oid": "ce283f64f17cadd3f4ab80534343dbfe917867fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e3d5889560922a86586fb6abc148be6d2e1f482", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/9e3d5889560922a86586fb6abc148be6d2e1f482", "committedDate": "2020-12-02T06:49:39Z", "message": "[FLINK-16443][checkpointing] Make sure that CheckpointException are also serialized in DeclineCheckpoint."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7fcff5c36ef33398a10e786fdae848ed72664b4", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/e7fcff5c36ef33398a10e786fdae848ed72664b4", "committedDate": "2020-12-02T06:49:41Z", "message": "Revert \"[FLINK-14076] Ensure CheckpointException can be deserialized on JobManager\"\n\nThis reverts commit 2bcf5094"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce283f64f17cadd3f4ab80534343dbfe917867fa", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/ce283f64f17cadd3f4ab80534343dbfe917867fa", "committedDate": "2020-11-26T22:04:34Z", "message": "Revert \"[FLINK-14076] Ensure CheckpointException can be deserialized on JobManager\"\n\nThis reverts commit 2bcf5094"}, "afterCommit": {"oid": "e7fcff5c36ef33398a10e786fdae848ed72664b4", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/e7fcff5c36ef33398a10e786fdae848ed72664b4", "committedDate": "2020-12-02T06:49:41Z", "message": "Revert \"[FLINK-14076] Ensure CheckpointException can be deserialized on JobManager\"\n\nThis reverts commit 2bcf5094"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4072, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}