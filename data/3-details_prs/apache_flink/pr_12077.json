{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTkwMTky", "number": 12077, "title": "[FLINK-17612][python][sql-client] add the parse logic of Python command line options to CliOptionsParser in SQL Client.", "bodyText": "What is the purpose of the change\nThis pull request adds the parse logic of Python command line options to CliOptionsParser in SQL Client.\nBrief change log\n\nAdd the parse logic of Python command line options to CliOptionsParser in SQL Client.\nAppend the Python configurations from CliOptions to Session Environment.\n\nVerifying this change\nThis change can be verified as follows:\n\nStart a local standalone flink cluster.\nPrepare a sql client session environment file with python UDF declaration.\nAdded test that validates that TaskInfo is transferred only once across recoveries\nLaunch the sql client with command line option \"-pyfs xxx.py\", \"xxx.py\" is the path of the python file that defines the python UDF.\nThe sql client should up without any exception.\n\nNOTE: After adding the PyFlink e2e test, the changes in this PR will be automatically verified.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable)", "createdAt": "2020-05-11T09:47:04Z", "url": "https://github.com/apache/flink/pull/12077", "merged": true, "mergeCommit": {"oid": "722f8445b7f8f2df90af9e8c4b3cfa231d71129d"}, "closed": true, "closedAt": "2020-05-13T01:22:30Z", "author": {"login": "WeiZhong94"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgMbCTgH2gAyNDE1OTkwMTkyOmEwY2UxMzA1YmI4MWY3YjNjY2JlZjhiMDk3ZTljNTQxMzVmNDNmNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgufFvgFqTQxMDUyNTcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "committedDate": "2020-05-11T09:40:03Z", "message": "[FLINK-17612][python][sql-client] add the parse logic of Python command line options to CliOptionsParser in SQL Client."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzA4NzQw", "url": "https://github.com/apache/flink/pull/12077#pullrequestreview-409708740", "createdAt": "2020-05-12T05:30:33Z", "commit": {"oid": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNTozMDozM1rOGT2mmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNTo0NDo1NVrOGT22qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3MDc0Ng==", "bodyText": "Change to Failed to parse the Python command line options?", "url": "https://github.com/apache/flink/pull/12077#discussion_r423470746", "createdAt": "2020-05-12T05:30:33Z", "author": {"login": "dianfu"}, "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/cli/CliOptionsParser.java", "diffHunk": "@@ -331,4 +354,18 @@ private static String checkSessionId(CommandLine line) {\n \t\t}\n \t\treturn sessionId;\n \t}\n+\n+\tprivate static Configuration getPythonConfiguration(CommandLine line) {\n+\t\ttry {\n+\t\t\tClass<?> clazz = Class.forName(\n+\t\t\t\t\"org.apache.flink.python.util.PythonDependencyUtils\",\n+\t\t\t\ttrue,\n+\t\t\t\tThread.currentThread().getContextClassLoader());\n+\t\t\tMethod parsePythonDependencyConfiguration =\n+\t\t\t\tclazz.getMethod(\"parsePythonDependencyConfiguration\", CommandLine.class);\n+\t\t\treturn (Configuration) parsePythonDependencyConfiguration.invoke(null, line);\n+\t\t} catch (ClassNotFoundException | NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+\t\t\tthrow new SqlClientException(\"Parse the Python command line options failed.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3NDg1OA==", "bodyText": "could use the enrich method defined in Environment as following:\nfinal Environment sessionEnvWithPythonConfiguration = Environment.enrich( sessionEnv, options.getPythonConfiguration().toMap(), Collections.emptyMap());", "url": "https://github.com/apache/flink/pull/12077#discussion_r423474858", "createdAt": "2020-05-12T05:44:55Z", "author": {"login": "dianfu"}, "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/SqlClient.java", "diffHunk": "@@ -90,6 +96,7 @@ private void start() {\n \n \t\t\t// create CLI client with session environment\n \t\t\tfinal Environment sessionEnv = readSessionEnvironment(options.getEnvironment());\n+\t\t\tappendPythonConfig(sessionEnv, options.getPythonConfiguration());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "826be85a1c9d715a519b8558dcbc71ee1b035214", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/826be85a1c9d715a519b8558dcbc71ee1b035214", "committedDate": "2020-05-12T06:00:03Z", "message": "address comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee1f95cb56f232f916e4b5f9b6f26b8abf02ec35", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/ee1f95cb56f232f916e4b5f9b6f26b8abf02ec35", "committedDate": "2020-05-12T09:14:38Z", "message": "update the sql client doc for the python command options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTI1NzI2", "url": "https://github.com/apache/flink/pull/12077#pullrequestreview-410525726", "createdAt": "2020-05-13T01:21:15Z", "commit": {"oid": "ee1f95cb56f232f916e4b5f9b6f26b8abf02ec35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4279, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}