{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MjQxNTUz", "number": 10931, "title": "[FLINK-15603][metrics] Add checkpointStartDelay metric", "bodyText": "Introduce a checkpointStartDelay metric: the time in nanoseconds that elapsed between the creation of the last checkpoint and the time when the checkpointing process has started by this Task. This delay shows how long it takes for a first checkpoint barrier to reach the task. Back-pressure will increase this value.\nVerifying this change\nThis change is hard to test, however I've added some rudimentary checks in CheckpointBarrierAlignerTestBase\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-01-23T08:32:02Z", "url": "https://github.com/apache/flink/pull/10931", "merged": true, "mergeCommit": {"oid": "120eb1465c53906175baaf0c97909052ad1859c2"}, "closed": true, "closedAt": "2020-01-24T08:57:09Z", "author": {"login": "pnowojski"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9GZhagFqTM0NzEzMjAyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9bDopgBqjI5NzY0OTMyNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTMyMDIy", "url": "https://github.com/apache/flink/pull/10931#pullrequestreview-347132022", "createdAt": "2020-01-23T08:45:49Z", "commit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0NTo0OVrOFg2ZUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo0M1rOFg2gAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4OTk3MA==", "bodyText": "This delay shows how long it takes for the first checkpoint barrier to reach the task.\nA high value indicates back-pressure. If only a specific task has a long start delay, the most likely reason is data skew.", "url": "https://github.com/apache/flink/pull/10931#discussion_r369989970", "createdAt": "2020-01-23T08:45:49Z", "author": {"login": "AHeise"}, "path": "docs/monitoring/metrics.md", "diffHunk": "@@ -1341,11 +1341,16 @@ Metrics related to data exchange between task executors using netty network comm\n       <td>Gauge</td>\n     </tr>\n     <tr>\n-      <th rowspan=\"1\">Task</th>\n+      <th rowspan=\"2\">Task</th>\n       <td>checkpointAlignmentTime</td>\n       <td>The time in nanoseconds that the last barrier alignment took to complete, or how long the current alignment has taken so far (in nanoseconds).</td>\n       <td>Gauge</td>\n     </tr>\n+    <tr>\n+      <td>checkpointStartDelay</td>\n+      <td>The time in nanoseconds that elapsed between the creation of the last checkpoint and the time when the checkpointing process has started by this Task. This delay shows how long it takes for a first checkpoint barrier to reach the task. Back-pressure will increase this value.</td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ==", "bodyText": "1_000_000, while you usually don't use a separator up to 9999, once you start, you use it consistently every 3 places.\nWhy storing it as nanos at all? Should we just track it as ms and only display it as nano (for consistency?). We are faking a precision that is not there.", "url": "https://github.com/apache/flink/pull/10931#discussion_r369991681", "createdAt": "2020-01-23T08:49:43Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/b43b813c97413608b68d0672c312b92b23e1d4e0", "committedDate": "2020-01-22T15:48:59Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelay metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}, "afterCommit": {"oid": "ee6d65a614f081d582138c02cbaa5693ab1c00d9", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/ee6d65a614f081d582138c02cbaa5693ab1c00d9", "committedDate": "2020-01-23T14:59:41Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee6d65a614f081d582138c02cbaa5693ab1c00d9", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/ee6d65a614f081d582138c02cbaa5693ab1c00d9", "committedDate": "2020-01-23T14:59:41Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}, "afterCommit": {"oid": "753e1073d4b9d298c8e5b50a3ddc1815c8b36a40", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/753e1073d4b9d298c8e5b50a3ddc1815c8b36a40", "committedDate": "2020-01-23T15:01:09Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef7018344b2171bdb55c9770d4326eb8e0fdb21", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/6ef7018344b2171bdb55c9770d4326eb8e0fdb21", "committedDate": "2020-01-24T08:55:18Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "753e1073d4b9d298c8e5b50a3ddc1815c8b36a40", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/753e1073d4b9d298c8e5b50a3ddc1815c8b36a40", "committedDate": "2020-01-23T15:01:09Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}, "afterCommit": {"oid": "6ef7018344b2171bdb55c9770d4326eb8e0fdb21", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/6ef7018344b2171bdb55c9770d4326eb8e0fdb21", "committedDate": "2020-01-24T08:55:18Z", "message": "[FLINK-15603][metrics] Add checkpointStartDelayNanos metric\n\nThe time in nanoseconds that elapsed between the creation of the last checkpoint and\nthe time when the checkpointing process has started by this Task. This delay shows\nhow long it takes for a first checkpoint barrier to reach the task. Back-pressure will\nincrease this value."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4449, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}