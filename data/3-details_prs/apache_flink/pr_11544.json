{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NTYzMzEz", "number": 11544, "title": "[FLINK-16822] [sql-client] `table.xx` property set from CLI should also be set into TableEnvironment's TableConfig", "bodyText": "What is the purpose of the change\nThe config set by SET command does not work, the reason is table.xx property set from CLI does not be set into TableEnvironment's TableConfig.\nBrief change log\n\nUpdate table config of SessionState when calling setSessionProperty method\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nAdded testSetSessionProperties in LocalExecutorITCase to verify the bug\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-03-27T05:43:34Z", "url": "https://github.com/apache/flink/pull/11544", "merged": true, "mergeCommit": {"oid": "297f0a2c3dfae4c763eba0a1fed49f1570f37f45"}, "closed": true, "closedAt": "2020-04-15T14:23:11Z", "author": {"login": "godfreyhe"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRqAQKgH2gAyMzk0NTYzMzEzOjk2MWU1ZDdjNjkwZjgyOTY3YjkyYjAxZGY1ZWVlNWZhNzUyOTJjNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX1fj_gFqTM5MzY0Njk3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "961e5d7c690f82967b92b01df5eee5fa75292c77", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/961e5d7c690f82967b92b01df5eee5fa75292c77", "committedDate": "2020-03-27T05:39:05Z", "message": "[FLINK-16822] [sql-client] `table.xx` property set from CLI should also be set into SessionState's TableConfig"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzE2OTIz", "url": "https://github.com/apache/flink/pull/11544#pullrequestreview-382716923", "createdAt": "2020-03-27T09:57:06Z", "commit": {"oid": "961e5d7c690f82967b92b01df5eee5fa75292c77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTo1NzowN1rOF8qPnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTo1NzowN1rOF8qPnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1MTAwNw==", "bodyText": "Will this influence the RESET command which should clear all session properties?", "url": "https://github.com/apache/flink/pull/11544#discussion_r399151007", "createdAt": "2020-03-27T09:57:07Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/LocalExecutor.java", "diffHunk": "@@ -281,13 +283,18 @@ public void setSessionProperty(String sessionId, String key, String value) throw\n \t\tExecutionContext<?> context = getExecutionContext(sessionId);\n \t\tEnvironment env = context.getEnvironment();\n \t\tEnvironment newEnv = Environment.enrich(env, ImmutableMap.of(key, value), ImmutableMap.of());\n+\t\tExecutionContext.SessionState sessionState = context.getSessionState();\n+\t\t// update table config\n+\t\tnewEnv.getConfiguration().asMap().forEach((k, v) ->\n+\t\t\t\tsessionState.config.getConfiguration().setString(k, v));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "961e5d7c690f82967b92b01df5eee5fa75292c77"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b3f8b93da1e5791502bdb0ebd02bb8fba49753", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/87b3f8b93da1e5791502bdb0ebd02bb8fba49753", "committedDate": "2020-03-29T06:13:47Z", "message": "TableConfig should be built from environment's Configuration each time when initializing TableEnvironment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTM1MDI4", "url": "https://github.com/apache/flink/pull/11544#pullrequestreview-393535028", "createdAt": "2020-04-15T07:51:54Z", "commit": {"oid": "87b3f8b93da1e5791502bdb0ebd02bb8fba49753"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTk0NjMz", "url": "https://github.com/apache/flink/pull/11544#pullrequestreview-393594633", "createdAt": "2020-04-15T09:12:48Z", "commit": {"oid": "87b3f8b93da1e5791502bdb0ebd02bb8fba49753"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToxMjo0OFrOGFw2Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToxNjozMFrOGFw-dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY5NjMyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\treturn new SessionState( catalogManager, moduleManager, functionCatalog);\n          \n          \n            \n            \t\t\treturn new SessionState(catalogManager, moduleManager, functionCatalog);\n          \n      \n    \n    \n  \n\nremove space.", "url": "https://github.com/apache/flink/pull/11544#discussion_r408696322", "createdAt": "2020-04-15T09:12:48Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/ExecutionContext.java", "diffHunk": "@@ -771,28 +772,24 @@ public Builder sessionState(SessionState sessionState) {\n \n \t/** Represents the state that should be reused in one session. **/\n \tpublic static class SessionState {\n-\t\tpublic final TableConfig config;\n \t\tpublic final CatalogManager catalogManager;\n \t\tpublic final ModuleManager moduleManager;\n \t\tpublic final FunctionCatalog functionCatalog;\n \n \t\tprivate SessionState(\n-\t\t\t\tTableConfig config,\n \t\t\t\tCatalogManager catalogManager,\n \t\t\t\tModuleManager moduleManager,\n \t\t\t\tFunctionCatalog functionCatalog) {\n-\t\t\tthis.config = config;\n \t\t\tthis.catalogManager = catalogManager;\n \t\t\tthis.moduleManager = moduleManager;\n \t\t\tthis.functionCatalog = functionCatalog;\n \t\t}\n \n \t\tpublic static SessionState of(\n-\t\t\t\tTableConfig config,\n \t\t\t\tCatalogManager catalogManager,\n \t\t\t\tModuleManager moduleManager,\n \t\t\t\tFunctionCatalog functionCatalog) {\n-\t\t\treturn new SessionState(config, catalogManager, moduleManager, functionCatalog);\n+\t\t\treturn new SessionState( catalogManager, moduleManager, functionCatalog);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87b3f8b93da1e5791502bdb0ebd02bb8fba49753"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY5ODQ4NA==", "bodyText": "Do we need this change? It seems they are equivalent.", "url": "https://github.com/apache/flink/pull/11544#discussion_r408698484", "createdAt": "2020-04-15T09:16:30Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/LocalExecutor.java", "diffHunk": "@@ -281,13 +283,15 @@ public void setSessionProperty(String sessionId, String key, String value) throw\n \t\tExecutionContext<?> context = getExecutionContext(sessionId);\n \t\tEnvironment env = context.getEnvironment();\n \t\tEnvironment newEnv = Environment.enrich(env, ImmutableMap.of(key, value), ImmutableMap.of());\n+\t\tExecutionContext.SessionState sessionState = context.getSessionState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87b3f8b93da1e5791502bdb0ebd02bb8fba49753"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f68fd9807f022c7694e986f4c9cdba5cff4f47b", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/9f68fd9807f022c7694e986f4c9cdba5cff4f47b", "committedDate": "2020-04-15T09:58:25Z", "message": "address jark's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjQ2OTc4", "url": "https://github.com/apache/flink/pull/11544#pullrequestreview-393646978", "createdAt": "2020-04-15T10:25:47Z", "commit": {"oid": "9f68fd9807f022c7694e986f4c9cdba5cff4f47b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2641, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}