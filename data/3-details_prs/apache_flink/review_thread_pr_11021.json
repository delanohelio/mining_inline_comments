{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMzM1MjIz", "number": 11021, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoxOTozMVrODd7CLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoyNDowNVrODd7Ehg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzAyNTA5OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoxOTozMVrOFmzSCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjo0ODowNVrOFmzqEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA==", "bodyText": "This test case can't reproduce the problem which reported by this issue. You should add a test case which cast a ROW to another ROW, e.g.\ntestSqlApi(\"CAST(f5 AS ROW<f0 INT, f1 STRING>)\", \"\")", "url": "https://github.com/apache/flink/pull/11021#discussion_r376230408", "createdAt": "2020-02-07T06:19:31Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTI5Ng==", "bodyText": "Ah... This is table api, we want to fix sql api.", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231296", "createdAt": "2020-02-07T06:23:45Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTY2OQ==", "bodyText": "You should keep table api and sql api both.", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231669", "createdAt": "2020-02-07T06:25:39Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzNjU2Mg==", "bodyText": "OK, Added a sql api test.", "url": "https://github.com/apache/flink/pull/11021#discussion_r376236562", "createdAt": "2020-02-07T06:48:05Z", "author": {"login": "docete"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzAzMTEwOnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarOperatorGens.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjoyNDowNlrOFmzVuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwNjo0ODoxNlrOFmzqQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTM1NQ==", "bodyText": "Nit: Add '' to table api too.", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231355", "createdAt": "2020-02-07T06:24:06Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarOperatorGens.scala", "diffHunk": "@@ -1280,8 +1280,8 @@ object ScalarOperatorGens {\n           | (INTERVAL_YEAR_MONTH, BIGINT) =>\n       internalExprCasting(operand, targetType)\n \n-    case (from, to) =>\n-      throw new CodeGenException(s\"Unsupported cast from '$from' to '$to'.\")\n+    case (_, _) =>\n+      throw new CodeGenException(s\"Unsupported cast from '${operand.resultType}' to '$targetType'.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzNjYwOA==", "bodyText": "modified", "url": "https://github.com/apache/flink/pull/11021#discussion_r376236608", "createdAt": "2020-02-07T06:48:16Z", "author": {"login": "docete"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarOperatorGens.scala", "diffHunk": "@@ -1280,8 +1280,8 @@ object ScalarOperatorGens {\n           | (INTERVAL_YEAR_MONTH, BIGINT) =>\n       internalExprCasting(operand, targetType)\n \n-    case (from, to) =>\n-      throw new CodeGenException(s\"Unsupported cast from '$from' to '$to'.\")\n+    case (_, _) =>\n+      throw new CodeGenException(s\"Unsupported cast from '${operand.resultType}' to '$targetType'.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTM1NQ=="}, "originalCommit": {"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1028, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}