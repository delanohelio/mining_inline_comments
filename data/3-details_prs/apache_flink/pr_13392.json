{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTA4NjE5", "number": 13392, "title": "[FLINK-18713][table-planner-blink] Change duration configOption to duration type", "bodyText": "What is the purpose of the change\nChange duration configOption  from string type to duration type, include,\ntable.exec.async-lookup.timeout\ntable.exec.source.idle-timeout\ntable.exec.mini-batch.allow-latency\ntable.exec.emit.early-fire.delay\ntable.exec.emit.late-fire.delay\nBrief change log\n\nChange duration configOption  from string type to duration type.\nUpdate documentation execution_config_configuration.html by running 'mvn package -Dgenerate-config-docs -pl flink-docs -am -nsu -DskipTests', and other documentations are also updated together.\n\nVerifying this change\n(Please pick either of the following options)\nThis change is a trivial rework / code cleanup without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-09-15T07:51:38Z", "url": "https://github.com/apache/flink/pull/13392", "merged": true, "mergeCommit": {"oid": "607919c6ea6983ae5ad3f82d63b7d6455c73d225"}, "closed": true, "closedAt": "2020-09-22T04:03:47Z", "author": {"login": "wangxlong"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJC5GeAH2gAyNDg3MTA4NjE5OjAyNzcxNmIyNTVlNzMzM2ZhMmM4ZmYyZmRkZGFiNzA1OTFiNTkyNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLP6tJAFqTQ5MzExNDM1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "027716b255e7333fa2c8ff2fdddab70591b5925d", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/027716b255e7333fa2c8ff2fdddab70591b5925d", "committedDate": "2020-09-15T07:44:44Z", "message": "[FLINK-18713][table-planner-blink] Change duration configOption to to duration type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb82165ec567b63f6f743aec7be913a2a440fa1", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/bfb82165ec567b63f6f743aec7be913a2a440fa1", "committedDate": "2020-09-15T11:58:56Z", "message": "fix test fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/f3af04d02472f93c5d49e0262ce7957cdd910707", "committedDate": "2020-09-16T18:43:20Z", "message": "Fix test failed and update doc for config options changed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDI2NDk2", "url": "https://github.com/apache/flink/pull/13392#pullrequestreview-490426496", "createdAt": "2020-09-17T09:49:18Z", "commit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTo0OToxOVrOHTaTEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTo1Mjo1NlrOHTabbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDExNTg1OQ==", "bodyText": "The default value is 0ms now. It would be better to mention the meaning of default value, otherwise it's confusing.\n\nDefault value is 0, which means detecting source idleness is not enabled.", "url": "https://github.com/apache/flink/pull/13392#discussion_r490115859", "createdAt": "2020-09-17T09:49:19Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/config/ExecutionConfigOptions.java", "diffHunk": "@@ -60,9 +60,10 @@\n \t// ------------------------------------------------------------------------\n \n \t@Documentation.TableOption(execMode = Documentation.ExecMode.STREAMING)\n-\tpublic static final ConfigOption<String> TABLE_EXEC_SOURCE_IDLE_TIMEOUT =\n+\tpublic static final ConfigOption<Duration> TABLE_EXEC_SOURCE_IDLE_TIMEOUT =\n \t\tkey(\"table.exec.source.idle-timeout\")\n-\t\t\t.defaultValue(\"-1 ms\")\n+\t\t\t.durationType()\n+\t\t\t.defaultValue(Duration.ofMillis(0))\n \t\t\t.withDescription(\"When a source do not receive any elements for the timeout time, \" +\n \t\t\t\t\"it will be marked as temporarily idle. This allows downstream \" +\n \t\t\t\t\"tasks to advance their watermarks without the need to wait for \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDExNjgyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    val miniBatchLatency =config.getConfiguration.get(\n          \n          \n            \n                    val miniBatchLatency = config.getConfiguration.get(", "url": "https://github.com/apache/flink/pull/13392#discussion_r490116821", "createdAt": "2020-09-17T09:50:55Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/plan/optimize/StreamCommonSubGraphBasedOptimizer.scala", "diffHunk": "@@ -61,8 +60,8 @@ class StreamCommonSubGraphBasedOptimizer(planner: StreamPlanner)\n \n       val miniBatchInterval: MiniBatchInterval = if (config.getConfiguration.getBoolean(\n         ExecutionConfigOptions.TABLE_EXEC_MINIBATCH_ENABLED)) {\n-        val miniBatchLatency = getMillisecondFromConfigDuration(config,\n-          ExecutionConfigOptions.TABLE_EXEC_MINIBATCH_ALLOW_LATENCY)\n+        val miniBatchLatency =config.getConfiguration.get(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDExNzk1OQ==", "bodyText": "It's not allowed to use -1ms for Duration type. We can use .noDefaultValue() to keep the same behavior as before. You can use tableConfig.getConfiguration.getOptional(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).isPresent to check whether it is set.", "url": "https://github.com/apache/flink/pull/13392#discussion_r490117959", "createdAt": "2020-09-17T09:52:53Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/plan/utils/WindowEmitStrategy.scala", "diffHunk": "@@ -179,9 +178,10 @@ object WindowEmitStrategy {\n \n   // It is a experimental config, will may be removed later.\n   @Experimental\n-  val TABLE_EXEC_EMIT_EARLY_FIRE_DELAY: ConfigOption[String] =\n+  val TABLE_EXEC_EMIT_EARLY_FIRE_DELAY: ConfigOption[Duration] =\n   key(\"table.exec.emit.early-fire.delay\")\n-      .noDefaultValue\n+      .durationType()\n+      .defaultValue(Duration.ofMillis(-1))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDExNzk5OA==", "bodyText": "We can use .noDefaultValue() to keep the same behavior as before.", "url": "https://github.com/apache/flink/pull/13392#discussion_r490117998", "createdAt": "2020-09-17T09:52:56Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/plan/utils/WindowEmitStrategy.scala", "diffHunk": "@@ -198,9 +198,10 @@ object WindowEmitStrategy {\n \n   // It is a experimental config, will may be removed later.\n   @Experimental\n-  val TABLE_EXEC_EMIT_LATE_FIRE_DELAY: ConfigOption[String] =\n+  val TABLE_EXEC_EMIT_LATE_FIRE_DELAY: ConfigOption[Duration] =\n   key(\"table.exec.emit.late-fire.delay\")\n-      .noDefaultValue\n+      .durationType()\n+      .defaultValue(Duration.ofMillis(-1))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3af04d02472f93c5d49e0262ce7957cdd910707"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4edfc577e0d1d20203de931dbbab1ac4ab2d621", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/b4edfc577e0d1d20203de931dbbab1ac4ab2d621", "committedDate": "2020-09-17T14:25:08Z", "message": "Update the content of the comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjkwOTU1", "url": "https://github.com/apache/flink/pull/13392#pullrequestreview-491290955", "createdAt": "2020-09-18T09:16:02Z", "commit": {"oid": "b4edfc577e0d1d20203de931dbbab1ac4ab2d621"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwOToxNjowMlrOHUE6KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwOToxNjowMlrOHUE6KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgxMzk5Mg==", "bodyText": "What about refactoring the earlyFireDelay to Duration type? Then we can simplify the above code to\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                val earlyFireDelay: JLong = if (tableConfig.getConfiguration\n          \n          \n            \n                  .getOptional(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).isPresent) {\n          \n          \n            \n                  tableConfig.getConfiguration\n          \n          \n            \n                    .get(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).toMillis\n          \n          \n            \n                } else {\n          \n          \n            \n                  null\n          \n          \n            \n                }\n          \n          \n            \n            val earlyFireDelay: Duration = tableConfig.getConfiguration\n          \n          \n            \n                  .getOptional(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY)\n          \n          \n            \n                  .orElse(null)\n          \n      \n    \n    \n  \n\nI think Duration is more concise than Long.", "url": "https://github.com/apache/flink/pull/13392#discussion_r490813992", "createdAt": "2020-09-18T09:16:02Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/plan/utils/WindowEmitStrategy.scala", "diffHunk": "@@ -153,12 +152,22 @@ object WindowEmitStrategy {\n     }\n     val enableEarlyFireDelay = tableConfig.getConfiguration.getBoolean(\n       TABLE_EXEC_EMIT_EARLY_FIRE_ENABLED)\n-    val earlyFireDelay = getMillisecondFromConfigDuration(\n-      tableConfig, TABLE_EXEC_EMIT_EARLY_FIRE_DELAY)\n+    val earlyFireDelay: JLong = if (tableConfig.getConfiguration\n+      .getOptional(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).isPresent) {\n+      tableConfig.getConfiguration\n+        .get(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).toMillis\n+    } else {\n+      null\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4edfc577e0d1d20203de931dbbab1ac4ab2d621"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ae80979b126523815401a76c4dac86a06d9e23c", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/0ae80979b126523815401a76c4dac86a06d9e23c", "committedDate": "2020-09-20T11:45:13Z", "message": "Refactoring earlyFireDelay and lateFireDelay to Duration type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjU1NDcw", "url": "https://github.com/apache/flink/pull/13392#pullrequestreview-492255470", "createdAt": "2020-09-21T02:43:00Z", "commit": {"oid": "0ae80979b126523815401a76c4dac86a06d9e23c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMjo0MzowMFrOHU_X5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMjo0MzowMFrOHU_X5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc3MTg3OQ==", "bodyText": "Please update this too.", "url": "https://github.com/apache/flink/pull/13392#discussion_r491771879", "createdAt": "2020-09-21T02:43:00Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/runtime/stream/sql/WindowAggregateITCase.scala", "diffHunk": "@@ -349,15 +349,20 @@ class WindowAggregateITCase(mode: StateBackendMode)\n \n   private def withLateFireDelay(tableConfig: TableConfig, interval: Time): Unit = {\n     val intervalInMillis = interval.toMilliseconds\n-    val preLateFireInterval = getMillisecondFromConfigDuration(tableConfig,\n-      TABLE_EXEC_EMIT_LATE_FIRE_DELAY)\n+    val preLateFireInterval = if (tableConfig.getConfiguration\n+      .getOptional(TABLE_EXEC_EMIT_LATE_FIRE_DELAY).isPresent) {\n+      tableConfig.getConfiguration.get(\n+        TABLE_EXEC_EMIT_LATE_FIRE_DELAY).toMillis\n+    } else {\n+      null\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae80979b126523815401a76c4dac86a06d9e23c"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjU1Njk4", "url": "https://github.com/apache/flink/pull/13392#pullrequestreview-492255698", "createdAt": "2020-09-21T02:44:28Z", "commit": {"oid": "0ae80979b126523815401a76c4dac86a06d9e23c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMjo0NDoyOFrOHU_Yrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMjo0NDoyOFrOHU_Yrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc3MjA3OA==", "bodyText": "Pleaes update this too.", "url": "https://github.com/apache/flink/pull/13392#discussion_r491772078", "createdAt": "2020-09-21T02:44:28Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.scala", "diffHunk": "@@ -426,15 +428,20 @@ class MiniBatchIntervalInferTest extends TableTestBase {\n \n   private def withEarlyFireDelay(tableConfig: TableConfig, interval: Time): Unit = {\n     val intervalInMillis = interval.toMilliseconds\n-    val preEarlyFireInterval = TableConfigUtils.getMillisecondFromConfigDuration(\n-      tableConfig, TABLE_EXEC_EMIT_EARLY_FIRE_DELAY)\n+    val preEarlyFireInterval = if (tableConfig.getConfiguration\n+      .getOptional(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).isPresent) {\n+      tableConfig.getConfiguration\n+        .get(TABLE_EXEC_EMIT_EARLY_FIRE_DELAY).toMillis\n+    } else {\n+      null\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae80979b126523815401a76c4dac86a06d9e23c"}, "originalPosition": 165}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f86e01988e6d8ad8b904670f66713ab21e485d6", "author": {"user": {"login": "wangxlong", "name": null}}, "url": "https://github.com/apache/flink/commit/9f86e01988e6d8ad8b904670f66713ab21e485d6", "committedDate": "2020-09-21T13:53:51Z", "message": "Refactoring fireDelay to duration type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMTE0MzU2", "url": "https://github.com/apache/flink/pull/13392#pullrequestreview-493114356", "createdAt": "2020-09-22T04:03:06Z", "commit": {"oid": "9f86e01988e6d8ad8b904670f66713ab21e485d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3961, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}