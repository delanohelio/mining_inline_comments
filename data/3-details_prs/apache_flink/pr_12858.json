{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NjAxODEw", "number": 12858, "title": "[FLINK-18534][kafka][table] Fix unstable KafkaTableITCase.testKafkaDebeziumChangelogSource", "bodyText": "What is the purpose of the change\nThis fix the unstable test with \"Topic 'changelog_topic' already exists\" exception.\nBrief change log\nCurrently testKafkaDebeziumChangelogSource is executed multiple times because the super class is Parameterized with different formats. The Kafka cluster has a known issue that the topic cleanup is not guarenteed to take effect immediately.\nHowever, this case only need to be executed once. Thus, we update the test to only execute when it is json format.\nVerifying this change\nManually run in my local for hundreds of times.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-07-09T03:58:09Z", "url": "https://github.com/apache/flink/pull/12858", "merged": true, "mergeCommit": {"oid": "35865f7a40e6ff7e3483f9dcd6466a1f0296eaca"}, "closed": true, "closedAt": "2020-07-09T14:22:45Z", "author": {"login": "wuchong"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczG0z4AH2gAyNDQ2NjAxODEwOmYwYjNlZTNiNDBlOGYzNTdkMGUwMmYzNWUyNDg2ODY1NjQ4ZWRhM2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczK5efgH2gAyNDQ2NjAxODEwOjJlYTNmMmYxMmU3M2NkNzdhOTQ4OTJhNTc2MDhkOThkYmM0M2ZkMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0b3ee3b40e8f357d0e02f35e2486865648eda3c", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/f0b3ee3b40e8f357d0e02f35e2486865648eda3c", "committedDate": "2020-07-09T03:53:20Z", "message": "[FLINK-18534][kafka][table] Fix unstable KafkaTableITCase.testKafkaDebeziumChangelogSource\n\nThis fix the unstable test with \"Topic 'changelog_topic' already exists\" exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzQzMjc0", "url": "https://github.com/apache/flink/pull/12858#pullrequestreview-445343274", "createdAt": "2020-07-09T07:09:25Z", "commit": {"oid": "f0b3ee3b40e8f357d0e02f35e2486865648eda3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzowOToyNVrOGvEaNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzowOToyNVrOGvEaNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwODUwMw==", "bodyText": "How about add format:\nprotected static final String DEBEZIUM_JSON = \"debezium-json\";\n....\n//add parameters\nnew Object[]{false, DEBEZIUM_JSON}\n...\n\t@Test\n\tpublic void testKafkaSourceSink() throws Exception {\n\t\tif (DEBEZIUM_JSON.equals(format)) {\n\t\t\t// skip debezium json format\n\t\t\treturn;\n\t\t}\n       ....\n\nAnd then the testKafkaDebeziumChangelogSource will be more clear like:\nif (isLegacyConnector || !DEBEZIUM_JSON.equals(format)) {\n\t\t\t// skip tests for legacy connector, because changelog source is only supported in new connector\n\t\t\treturn;\n\t\t}", "url": "https://github.com/apache/flink/pull/12858#discussion_r452008503", "createdAt": "2020-07-09T07:09:25Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaTableTestBase.java", "diffHunk": "@@ -46,7 +46,7 @@\n @RunWith(Parameterized.class)\n public abstract class KafkaTableTestBase extends KafkaTestBaseWithFlink {\n \n-\tprivate static final String JSON_FORMAT = \"json\";\n+\tprotected static final String JSON_FORMAT = \"json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b3ee3b40e8f357d0e02f35e2486865648eda3c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1e610aee46dab3a17beed1bc1e76b6f6a55d41a", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/a1e610aee46dab3a17beed1bc1e76b6f6a55d41a", "committedDate": "2020-07-09T07:33:06Z", "message": "extract changelog test into KafkaChangelogTableITCase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Mzc3MzE1", "url": "https://github.com/apache/flink/pull/12858#pullrequestreview-445377315", "createdAt": "2020-07-09T08:00:01Z", "commit": {"oid": "a1e610aee46dab3a17beed1bc1e76b6f6a55d41a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Mzc4MzU2", "url": "https://github.com/apache/flink/pull/12858#pullrequestreview-445378356", "createdAt": "2020-07-09T08:01:26Z", "commit": {"oid": "a1e610aee46dab3a17beed1bc1e76b6f6a55d41a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwODowMToyNlrOGvGE4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwODowMToyNlrOGvGE4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAzNTgwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprotected static final String JSON_FORMAT = \"json\";\n          \n          \n            \n            \tprivate static final String JSON_FORMAT = \"json\";", "url": "https://github.com/apache/flink/pull/12858#discussion_r452035809", "createdAt": "2020-07-09T08:01:26Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaTableTestBase.java", "diffHunk": "@@ -46,7 +46,7 @@\n @RunWith(Parameterized.class)\n public abstract class KafkaTableTestBase extends KafkaTestBaseWithFlink {\n \n-\tprivate static final String JSON_FORMAT = \"json\";\n+\tprotected static final String JSON_FORMAT = \"json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1e610aee46dab3a17beed1bc1e76b6f6a55d41a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea3f2f12e73cd77a94892a57608d98dbc43fd34", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/2ea3f2f12e73cd77a94892a57608d98dbc43fd34", "committedDate": "2020-07-09T08:38:03Z", "message": "Update flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaTableTestBase.java\n\nCo-authored-by: Leonard Xu <xbjtdcq@163.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3094, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}