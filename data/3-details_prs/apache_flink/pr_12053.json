{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTMzMTc4", "number": 12053, "title": "[FLINK-17590][connector/filesystem] Support bucket lifecycle listener in streaming file sink buckets", "bodyText": "What is the purpose of the change\nThis PR adds listener into Buckets to support acquiring the events of state migration of Bucket. This is used to support writing meta-info in Hive Sink.\nBrief change log\n\n1e1d15d Adds the bucket lifecycle listener.\n\nVerifying this change\nThis PR is verified by\n\nAdded Unit test to verify the listener is called at suitable time if the listener is set.\nThe existing tests verify the Buckets works well when the listener is not set.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector:  no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable", "createdAt": "2020-05-09T07:32:03Z", "url": "https://github.com/apache/flink/pull/12053", "merged": true, "mergeCommit": {"oid": "3f487c94d6e49c6464602129074e05d638748f18"}, "closed": true, "closedAt": "2020-05-16T01:56:26Z", "author": {"login": "gaoyunhaii"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfi3I6AFqTQwODYzMTU0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchsu5nAFqTQxMzAzNjg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjMxNTQ0", "url": "https://github.com/apache/flink/pull/12053#pullrequestreview-408631544", "createdAt": "2020-05-09T09:14:44Z", "commit": {"oid": "1e1d15d10c7026928824e1fbc99099cc52821de4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwOToxNDo0NFrOGS5uzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwOToxNDo0NFrOGS5uzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ3MzQyMA==", "bodyText": "Add litsener setter to this bulk part writer builder?", "url": "https://github.com/apache/flink/pull/12053#discussion_r422473420", "createdAt": "2020-05-09T09:14:44Z", "author": {"login": "JingsongLi"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/filesystem/StreamingFileSink.java", "diffHunk": "@@ -401,6 +402,7 @@ public T withOutputFileConfig(final OutputFileConfig outputFileConfig) {\n \t\t\t\t\tbucketFactory,\n \t\t\t\t\tnew BulkPartWriter.Factory<>(writerFactory),\n \t\t\t\t\trollingPolicy,\n+\t\t\t\t\tnull,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e1d15d10c7026928824e1fbc99099cc52821de4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjMxNTkw", "url": "https://github.com/apache/flink/pull/12053#pullrequestreview-408631590", "createdAt": "2020-05-09T09:15:06Z", "commit": {"oid": "1e1d15d10c7026928824e1fbc99099cc52821de4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwOToxNTowNlrOGS5u8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwOToxNTo1NVrOGS5vTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ3MzQ1OQ==", "bodyText": "Add listener setter to this row wise part writer builder?", "url": "https://github.com/apache/flink/pull/12053#discussion_r422473459", "createdAt": "2020-05-09T09:15:06Z", "author": {"login": "JingsongLi"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/filesystem/StreamingFileSink.java", "diffHunk": "@@ -291,6 +291,7 @@ T withBucketFactory(final BucketFactory<IN, BucketID> factory) {\n \t\t\t\t\tbucketFactory,\n \t\t\t\t\tnew RowWisePartWriter.Factory<>(encoder),\n \t\t\t\t\trollingPolicy,\n+\t\t\t\t\tnull,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e1d15d10c7026928824e1fbc99099cc52821de4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ3MzU0OA==", "bodyText": "Should this be a List<Listener>?", "url": "https://github.com/apache/flink/pull/12053#discussion_r422473548", "createdAt": "2020-05-09T09:15:55Z", "author": {"login": "JingsongLi"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/filesystem/Buckets.java", "diffHunk": "@@ -65,6 +65,9 @@\n \n \tprivate final RollingPolicy<IN, BucketID> rollingPolicy;\n \n+\t@Nullable\n+\tprivate final BucketLifeCycleListener<IN, BucketID> bucketLifeCycleListener;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e1d15d10c7026928824e1fbc99099cc52821de4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0c99fba95a28aa8449a7601c940995591d23d78", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/d0c99fba95a28aa8449a7601c940995591d23d78", "committedDate": "2020-05-15T06:39:38Z", "message": "[FLINK-17590][connector/filesystem] Support bucket lifecycle listener in streaming file sink buckets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a96b05dc357929dd5e052e31d4d22f60803ed28", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/6a96b05dc357929dd5e052e31d4d22f60803ed28", "committedDate": "2020-05-15T06:39:38Z", "message": "Allow users to configure the BucketLifeCycleListener"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f7cb8a717202562c9074e8b8bab636cf0a92994", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/9f7cb8a717202562c9074e8b8bab636cf0a92994", "committedDate": "2020-05-14T00:51:26Z", "message": "Allow users to configure the BucketLifeCycleListener"}, "afterCommit": {"oid": "6a96b05dc357929dd5e052e31d4d22f60803ed28", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/6a96b05dc357929dd5e052e31d4d22f60803ed28", "committedDate": "2020-05-15T06:39:38Z", "message": "Allow users to configure the BucketLifeCycleListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d2d0e5c338e224c6d2247ab21a702e4d94536a5", "author": {"user": {"login": "gaoyunhaii", "name": "Yun Gao"}}, "url": "https://github.com/apache/flink/commit/4d2d0e5c338e224c6d2247ab21a702e4d94536a5", "committedDate": "2020-05-15T13:12:47Z", "message": "Mark the methods as internal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDM2ODgz", "url": "https://github.com/apache/flink/pull/12053#pullrequestreview-413036883", "createdAt": "2020-05-16T01:52:38Z", "commit": {"oid": "4d2d0e5c338e224c6d2247ab21a702e4d94536a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4221, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}