{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzMwODM3", "number": 12704, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxMjoyMlrOEGquNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxMjoyMlrOEGquNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDI2ODY5OnYy", "diffSide": "RIGHT", "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxMjoyMlrOGlmsXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNjo0NDo0MFrOGmbLpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NDQ0NA==", "bodyText": "We could also call this once in the constructor; it is supposed to be part of the startup anyway.", "url": "https://github.com/apache/flink/pull/12704#discussion_r442084444", "createdAt": "2020-06-18T09:12:22Z", "author": {"login": "zentol"}, "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "diffHunk": "@@ -285,9 +285,7 @@ public void run() {\n \t\t\t\tif (!jobsToRemove.isEmpty() && processArchiveDeletion) {\n \t\t\t\t\tevents.addAll(cleanupExpiredJobs(jobsToRemove));\n \t\t\t\t}\n-\t\t\t\tif (!events.isEmpty()) {\n-\t\t\t\t\tupdateJobOverview(webOverviewDir, webDir);\n-\t\t\t\t}\n+\t\t\t\tupdateJobOverview(webOverviewDir, webDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0Nzk0NA==", "bodyText": "I'm not really sure. That would yield in empty jobs/overview.json file created on startup, thus the UI would show \"no data\" icon during startup/job parsing, and then suddenly it would change into list of  jobs once the startup parsing is done.\nUp until now the UI showed those \"blurred\" lines that we understood as \"startup in progress\" instead.", "url": "https://github.com/apache/flink/pull/12704#discussion_r442147944", "createdAt": "2020-06-18T11:08:39Z", "author": {"login": "jvimr"}, "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "diffHunk": "@@ -285,9 +285,7 @@ public void run() {\n \t\t\t\tif (!jobsToRemove.isEmpty() && processArchiveDeletion) {\n \t\t\t\t\tevents.addAll(cleanupExpiredJobs(jobsToRemove));\n \t\t\t\t}\n-\t\t\t\tif (!events.isEmpty()) {\n-\t\t\t\t\tupdateJobOverview(webOverviewDir, webDir);\n-\t\t\t\t}\n+\t\t\t\tupdateJobOverview(webOverviewDir, webDir);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NDQ0NA=="}, "originalCommit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgzNzc2MQ==", "bodyText": "That \"blurring\" is not really intentional, and the result of the request to the REST API actually returning a 404 and the UI not actually handling it.\nFrom the REST API perspective, this file must be there ASAP. By doing this after the first fetch you introduce some delay, since the HistoryServer still has to query all filesystems first.\nWe also have to consider cases where there is actually nothing to be done on startup, as jobs are run later on. In this case, showing \"no data\" is more appropriate, and consistent with the Flink UI.", "url": "https://github.com/apache/flink/pull/12704#discussion_r442837761", "createdAt": "2020-06-19T13:23:19Z", "author": {"login": "zentol"}, "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "diffHunk": "@@ -285,9 +285,7 @@ public void run() {\n \t\t\t\tif (!jobsToRemove.isEmpty() && processArchiveDeletion) {\n \t\t\t\t\tevents.addAll(cleanupExpiredJobs(jobsToRemove));\n \t\t\t\t}\n-\t\t\t\tif (!events.isEmpty()) {\n-\t\t\t\t\tupdateJobOverview(webOverviewDir, webDir);\n-\t\t\t\t}\n+\t\t\t\tupdateJobOverview(webOverviewDir, webDir);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NDQ0NA=="}, "originalCommit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk0NDQyMg==", "bodyText": "OK, the method updateJobOverview is now called from JobArchiveFetcherTask's contructor too", "url": "https://github.com/apache/flink/pull/12704#discussion_r442944422", "createdAt": "2020-06-19T16:44:40Z", "author": {"login": "jvimr"}, "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "diffHunk": "@@ -285,9 +285,7 @@ public void run() {\n \t\t\t\tif (!jobsToRemove.isEmpty() && processArchiveDeletion) {\n \t\t\t\t\tevents.addAll(cleanupExpiredJobs(jobsToRemove));\n \t\t\t\t}\n-\t\t\t\tif (!events.isEmpty()) {\n-\t\t\t\t\tupdateJobOverview(webOverviewDir, webDir);\n-\t\t\t\t}\n+\t\t\t\tupdateJobOverview(webOverviewDir, webDir);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NDQ0NA=="}, "originalCommit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4334, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}