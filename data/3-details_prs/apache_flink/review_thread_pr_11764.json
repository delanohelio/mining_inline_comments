{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDkxNjE4", "number": 11764, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNDoxM1rODyyocQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToyN1rODz0WPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTg0OTQ1OnYy", "diffSide": "RIGHT", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNDoxM1rOGHCjDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNDoxM1rOGHCjDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDk1OA==", "bodyText": "taskmanager.sh uses a different way of counting lines: num_lines=$(echo \"${java_utils_output}\" | wc -l)\nI'd prefer if we stick to 1 way of doing it", "url": "https://github.com/apache/flink/pull/11764#discussion_r410034958", "createdAt": "2020-04-17T07:14:13Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTg1MjExOnYy", "diffSide": "RIGHT", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNToxNVrOGHCk2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNToxNVrOGHCk2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQxOA==", "bodyText": "this is undefined is it not?", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035418", "createdAt": "2020-04-17T07:15:15Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTg1MjY2OnYy", "diffSide": "RIGHT", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNToyN1rOGHClKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzoxNToyN1rOGHClKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQ5OA==", "bodyText": "same here, $output isn't defined anywhere", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035498", "createdAt": "2020-04-17T07:15:27Z", "author": {"login": "zentol"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2\n+        exit 1\n+    fi\n+\n+    if ! [[ ${execution_config} =~ ^${EXECUTION_PREFIX}.* ]]; then\n         echo \"[ERROR] Unexpected result: $execution_config\" 1>&2\n-        echo \"[ERROR] The last line of the BashJavaUtils outputs is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n+        echo \"[ERROR] The output of BashJavaUtils is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n         echo \"$output\" 1>&2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjYxNjMxOnYy", "diffSide": "RIGHT", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNToyN1rOGIdaoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjozNjowNFrOGIdceQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzc0NA==", "bodyText": "I think this change broke my local setup. If I build from master I can no longer start a cluster via bin/start-cluster.sh.", "url": "https://github.com/apache/flink/pull/11764#discussion_r411523744", "createdAt": "2020-04-20T16:35:27Z", "author": {"login": "tillrohrmann"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,10 +644,16 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local num_lines=$(echo \"$execution_config\" | wc -l)\n+    if ! [[ ${num_lines} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($num_lines lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        exit 1\n+    fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyNDIxNw==", "bodyText": "I think the problem is that we don't do proper trimming.", "url": "https://github.com/apache/flink/pull/11764#discussion_r411524217", "createdAt": "2020-04-20T16:36:04Z", "author": {"login": "tillrohrmann"}, "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,10 +644,16 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local num_lines=$(echo \"$execution_config\" | wc -l)\n+    if ! [[ ${num_lines} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($num_lines lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        exit 1\n+    fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzc0NA=="}, "originalCommit": {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1631, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}