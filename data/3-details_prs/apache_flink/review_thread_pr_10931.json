{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MjQxNTUz", "number": 10931, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0NTo0OVrODaFzCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo0M1rODaF3XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njg0NTUyOnYy", "diffSide": "RIGHT", "path": "docs/monitoring/metrics.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0NTo0OVrOFg2ZUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODo1Mzo1MFrOFhXHEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4OTk3MA==", "bodyText": "This delay shows how long it takes for the first checkpoint barrier to reach the task.\nA high value indicates back-pressure. If only a specific task has a long start delay, the most likely reason is data skew.", "url": "https://github.com/apache/flink/pull/10931#discussion_r369989970", "createdAt": "2020-01-23T08:45:49Z", "author": {"login": "AHeise"}, "path": "docs/monitoring/metrics.md", "diffHunk": "@@ -1341,11 +1341,16 @@ Metrics related to data exchange between task executors using netty network comm\n       <td>Gauge</td>\n     </tr>\n     <tr>\n-      <th rowspan=\"1\">Task</th>\n+      <th rowspan=\"2\">Task</th>\n       <td>checkpointAlignmentTime</td>\n       <td>The time in nanoseconds that the last barrier alignment took to complete, or how long the current alignment has taken so far (in nanoseconds).</td>\n       <td>Gauge</td>\n     </tr>\n+    <tr>\n+      <td>checkpointStartDelay</td>\n+      <td>The time in nanoseconds that elapsed between the creation of the last checkpoint and the time when the checkpointing process has started by this Task. This delay shows how long it takes for a first checkpoint barrier to reach the task. Back-pressure will increase this value.</td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMjMwNA==", "bodyText": "Just to make sure that this was not just an oversight:\nI also suggested to add \"A high value indicates back-pressure. If only a specific task has a long start delay, the most likely reason is data skew.\" instead of \"Back-pressure will increase this value.\"", "url": "https://github.com/apache/flink/pull/10931#discussion_r370522304", "createdAt": "2020-01-24T08:43:31Z", "author": {"login": "AHeise"}, "path": "docs/monitoring/metrics.md", "diffHunk": "@@ -1341,11 +1341,16 @@ Metrics related to data exchange between task executors using netty network comm\n       <td>Gauge</td>\n     </tr>\n     <tr>\n-      <th rowspan=\"1\">Task</th>\n+      <th rowspan=\"2\">Task</th>\n       <td>checkpointAlignmentTime</td>\n       <td>The time in nanoseconds that the last barrier alignment took to complete, or how long the current alignment has taken so far (in nanoseconds).</td>\n       <td>Gauge</td>\n     </tr>\n+    <tr>\n+      <td>checkpointStartDelay</td>\n+      <td>The time in nanoseconds that elapsed between the creation of the last checkpoint and the time when the checkpointing process has started by this Task. This delay shows how long it takes for a first checkpoint barrier to reach the task. Back-pressure will increase this value.</td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4OTk3MA=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyNTk2OA==", "bodyText": "Ops, sorry I've missed that. Updating.", "url": "https://github.com/apache/flink/pull/10931#discussion_r370525968", "createdAt": "2020-01-24T08:53:50Z", "author": {"login": "pnowojski"}, "path": "docs/monitoring/metrics.md", "diffHunk": "@@ -1341,11 +1341,16 @@ Metrics related to data exchange between task executors using netty network comm\n       <td>Gauge</td>\n     </tr>\n     <tr>\n-      <th rowspan=\"1\">Task</th>\n+      <th rowspan=\"2\">Task</th>\n       <td>checkpointAlignmentTime</td>\n       <td>The time in nanoseconds that the last barrier alignment took to complete, or how long the current alignment has taken so far (in nanoseconds).</td>\n       <td>Gauge</td>\n     </tr>\n+    <tr>\n+      <td>checkpointStartDelay</td>\n+      <td>The time in nanoseconds that elapsed between the creation of the last checkpoint and the time when the checkpointing process has started by this Task. This delay shows how long it takes for a first checkpoint barrier to reach the task. Back-pressure will increase this value.</td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4OTk3MA=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njg1NjYxOnYy", "diffSide": "RIGHT", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwODo0OTo0M1rOFg2gAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDo0ODowM1rOFhA0Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ==", "bodyText": "1_000_000, while you usually don't use a separator up to 9999, once you start, you use it consistently every 3 places.\nWhy storing it as nanos at all? Should we just track it as ms and only display it as nano (for consistency?). We are faking a precision that is not there.", "url": "https://github.com/apache/flink/pull/10931#discussion_r369991681", "createdAt": "2020-01-23T08:49:43Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwOTkzOQ==", "bodyText": "It's in the ns due to consistency with the existing method/field getAlignmentDurationNanos  and checkpointAlignmentTime metric.\nRe 1_000_000, I don't think that it increases readability, does it matter?", "url": "https://github.com/apache/flink/pull/10931#discussion_r370009939", "createdAt": "2020-01-23T09:30:01Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMTE3Mg==", "bodyText": "I found it weird to read, but it's clearly a nit.", "url": "https://github.com/apache/flink/pull/10931#discussion_r370031172", "createdAt": "2020-01-23T10:11:51Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMTY2MA==", "bodyText": "It's in the ns due to consistency with the existing method/field getAlignmentDurationNanos and checkpointAlignmentTime metric.\n\nI'd be okay with leaving as is. However, I don't think consistency is needed as the unit is carried in the name.", "url": "https://github.com/apache/flink/pull/10931#discussion_r370031660", "createdAt": "2020-01-23T10:12:58Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA4OTM4MA==", "bodyText": "Whether it is in the name or not, I think is a secondary issue. If we provide some stats, it's best if all have the same units.\nhttps://ci.apache.org/projects/flink/flink-docs-stable/monitoring/metrics.html#checkpointing\nhowever, annoying thing is, that in this class yes, all units are in nanos, but in other places it's millis (7 metrics in millis vs 2 in nanos?). More over, web ui is also using millis only...", "url": "https://github.com/apache/flink/pull/10931#discussion_r370089380", "createdAt": "2020-01-23T12:28:39Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA5MDAyMQ==", "bodyText": "I guess after all, I would be leaning towards converging towards millis, so changing this new metric to millis as well... WDYT?", "url": "https://github.com/apache/flink/pull/10931#discussion_r370090021", "createdAt": "2020-01-23T12:30:23Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA5MjI1Ng==", "bodyText": "Yes, I'd convert to ms. I don't see why any user profits from ns.\nIf it was some per-record metric, I'd agree with nano (like in Kinesis?).\nIt's technically much too complicated to actually produce nano-precision given the expected usability gain.", "url": "https://github.com/apache/flink/pull/10931#discussion_r370092256", "createdAt": "2020-01-23T12:35:43Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2MDY4Mg==", "bodyText": "Offline discussion consensus was to:\n\nIn order to have consistency start converging all of the metrics (when adding new ones) to nano seconds. To nanoseconds instead of milliseconds, because some metrics might need this extra precision\nAlways adding the unit (Nanos) suffix to the  metric name", "url": "https://github.com/apache/flink/pull/10931#discussion_r370160682", "createdAt": "2020-01-23T14:48:03Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/CheckpointBarrierHandler.java", "diffHunk": "@@ -95,4 +101,10 @@ protected void notifyAbortOnCancellationBarrier(long checkpointId) throws Except\n \tprotected void notifyAbort(long checkpointId, CheckpointException cause) throws Exception {\n \t\ttoNotifyOnCheckpoint.abortCheckpointOnBarrier(checkpointId, cause);\n \t}\n+\n+\tprotected void markCheckpointStart(long checkpointCreationTimestamp) {\n+\t\tlatestCheckpointStartDelayNanos = 1000_000 * Math.max(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk5MTY4MQ=="}, "originalCommit": {"oid": "b43b813c97413608b68d0672c312b92b23e1d4e0"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1105, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}