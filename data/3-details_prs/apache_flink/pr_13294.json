{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2OTEwOTEx", "number": 13294, "title": "[FLINK-19002][canal][json] Support to only read changelogs of specific database and table for canal-json format", "bodyText": "What is the purpose of the change\nUsually, users use Canal to synchronize binlog data from various MySQL databases and tables into a single Kafka topic. However, currently, canal-json can't support this case, because it requires the canal data in the topic should be in the same data format.\nThis issue propose to introduce a new option \"canal-json.database\" and \"canal-json.table\" to filter out the specific data.\nBrief change log\n\nAdded canal-json.database and canal-json.table option to CanalJsonFormatFactory.\nDrop records if they don't match the specific database and table in CanalJsonDeserializationSchema.\n\nVerifying this change\n\nAdded a test data which captures changes from 2 tables, and deserialize it using canal-json with specific database and table.\nAdded tests for factory to verify new introduced options.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-09-01T08:23:54Z", "url": "https://github.com/apache/flink/pull/13294", "merged": true, "mergeCommit": {"oid": "a3b4c93f82bb04d7313bd0ab34e584061cf22974"}, "closed": true, "closedAt": "2020-09-18T07:52:21Z", "author": {"login": "wuchong"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGyYhSgFqTQ4Mzg1NzQxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ8TxLgFqTQ5MTExMTM2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODU3NDE5", "url": "https://github.com/apache/flink/pull/13294#pullrequestreview-483857419", "createdAt": "2020-09-08T07:18:55Z", "commit": {"oid": "d9ce2f0083bbf6e00e4782c3ab2f7dd686d07e55"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoxODo1NlrOHOP39g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNzoyMjoxMVrOHOP-2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwMjE5OA==", "bodyText": "This can be reused by declaring static member.", "url": "https://github.com/apache/flink/pull/13294#discussion_r484702198", "createdAt": "2020-09-08T07:18:56Z", "author": {"login": "leonardBang"}, "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonFormatFactoryTest.java", "diffHunk": "@@ -64,44 +64,50 @@\n \tprivate static final RowType ROW_TYPE = (RowType) SCHEMA.toRowDataType().getLogicalType();\n \n \t@Test\n-\tpublic void testSeDeSchema() {\n+\tpublic void testDefaultOptions() {\n+\t\tMap<String, String> options = getAllOptions();\n \n \t\t// test Deser\n-\t\tfinal CanalJsonDeserializationSchema expectedDeser = new CanalJsonDeserializationSchema(\n-\t\t\tROW_TYPE,\n-\t\t\tInternalTypeInfo.of(ROW_TYPE),\n-\t\t\ttrue,\n-\t\t\tTimestampFormat.ISO_8601);\n-\n-\t\tfinal Map<String, String> options = getAllOptions();\n+\t\tCanalJsonDeserializationSchema expectedDeser = CanalJsonDeserializationSchema\n+\t\t\t.builder(ROW_TYPE, InternalTypeInfo.of(ROW_TYPE))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ce2f0083bbf6e00e4782c3ab2f7dd686d07e55"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwMjcxNw==", "bodyText": "InternalTypeInfo.of(SCHEMA) can be reused by declaring static member.", "url": "https://github.com/apache/flink/pull/13294#discussion_r484702717", "createdAt": "2020-09-08T07:19:53Z", "author": {"login": "leonardBang"}, "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java", "diffHunk": "@@ -61,15 +61,29 @@\n \t\tFIELD(\"weight\", FLOAT())\n \t).getLogicalType();\n \n+\t@Test\n+\tpublic void testFilteringTables() throws Exception {\n+\t\tList<String> lines = readLines(\"canal-data-filter-table.txt\");\n+\t\tCanalJsonDeserializationSchema deserializationSchema = CanalJsonDeserializationSchema\n+\t\t\t.builder(SCHEMA, InternalTypeInfo.of(SCHEMA))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ce2f0083bbf6e00e4782c3ab2f7dd686d07e55"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwMzk1MA==", "bodyText": "How about the following translation?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <td>\u4ec5\u8bfb\u53d6\u5339\u914d\u6240\u6307\u5b9a\u6570\u636e\u5e93\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"database\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002\n          \n          \n            \n                  <td>\u4ec5\u8bfb\u53d6\u6307\u5b9a\u6570\u636e\u5e93\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"database\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002", "url": "https://github.com/apache/flink/pull/13294#discussion_r484703950", "createdAt": "2020-09-08T07:22:10Z", "author": {"login": "leonardBang"}, "path": "docs/dev/table/connectors/formats/canal.zh.md", "diffHunk": "@@ -183,6 +183,20 @@ Format \u53c2\u6570\n        </ul>\n        </td>\n     </tr>\n+    <tr>\n+      <td><h5>canal-json.database</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\">(none)</td>\n+      <td>String</td>\n+      <td>\u4ec5\u8bfb\u53d6\u5339\u914d\u6240\u6307\u5b9a\u6570\u636e\u5e93\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"database\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ce2f0083bbf6e00e4782c3ab2f7dd686d07e55"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwMzk2Mw==", "bodyText": "How about the following translation?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <td>\u4ec5\u8bfb\u53d6\u5339\u914d\u6240\u6307\u5b9a\u8868\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"table\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002\n          \n          \n            \n                  <td>\u4ec5\u8bfb\u53d6\u6307\u5b9a\u8868\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"table\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002", "url": "https://github.com/apache/flink/pull/13294#discussion_r484703963", "createdAt": "2020-09-08T07:22:11Z", "author": {"login": "leonardBang"}, "path": "docs/dev/table/connectors/formats/canal.zh.md", "diffHunk": "@@ -183,6 +183,20 @@ Format \u53c2\u6570\n        </ul>\n        </td>\n     </tr>\n+    <tr>\n+      <td><h5>canal-json.database</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\">(none)</td>\n+      <td>String</td>\n+      <td>\u4ec5\u8bfb\u53d6\u5339\u914d\u6240\u6307\u5b9a\u6570\u636e\u5e93\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"database\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002\n+    </tr>\n+    <tr>\n+      <td><h5>canal-json.table</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\">(none)</td>\n+      <td>String</td>\n+      <td>\u4ec5\u8bfb\u53d6\u5339\u914d\u6240\u6307\u5b9a\u8868\u7684 changelog \u8bb0\u5f55\uff08\u901a\u8fc7\u5bf9\u6bd4 Canal \u8bb0\u5f55\u4e2d\u7684 \"table\" \u5143\u6570\u636e\u5b57\u6bb5\uff09\u3002", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ce2f0083bbf6e00e4782c3ab2f7dd686d07e55"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3493864e68acbd58a4c73524dc1639885fcae743", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/3493864e68acbd58a4c73524dc1639885fcae743", "committedDate": "2020-09-17T09:26:43Z", "message": "[FLINK-19002][canal][json] Support to only read changelogs of specific database and table for canal-json format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79b09d7dae7d662f6a907ee24f65b023eb63afe5", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/79b09d7dae7d662f6a907ee24f65b023eb63afe5", "committedDate": "2020-09-17T09:26:44Z", "message": "address review comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "051a6077bd7cda3eb9d73ca795285135102fc8de", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/051a6077bd7cda3eb9d73ca795285135102fc8de", "committedDate": "2020-09-17T09:31:48Z", "message": "rename 'canal-json.database', 'canal-json.table' to 'canal-json.database.include' and 'canal-json.table.include'"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2c5268981c4bf459bffeccac3443da6c209b13a", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/e2c5268981c4bf459bffeccac3443da6c209b13a", "committedDate": "2020-09-08T11:48:13Z", "message": "address review comments."}, "afterCommit": {"oid": "051a6077bd7cda3eb9d73ca795285135102fc8de", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/051a6077bd7cda3eb9d73ca795285135102fc8de", "committedDate": "2020-09-17T09:31:48Z", "message": "rename 'canal-json.database', 'canal-json.table' to 'canal-json.database.include' and 'canal-json.table.include'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTExMzYx", "url": "https://github.com/apache/flink/pull/13294#pullrequestreview-491111361", "createdAt": "2020-09-18T02:38:27Z", "commit": {"oid": "051a6077bd7cda3eb9d73ca795285135102fc8de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4315, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}