{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0ODk5MDkz", "number": 13910, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOTo1MTo0OVrOE1lCsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTo1MzozOVrOE1n14Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjE2ODgxOnYy", "diffSide": "RIGHT", "path": "flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaChangelogTableITCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOTo1MTo1MFrOHt7chA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOTo1MTo1MFrOHt7chA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkyMTkyNA==", "bodyText": "Add VIRTUAL to the metadata (even it is not tested)?", "url": "https://github.com/apache/flink/pull/13910#discussion_r517921924", "createdAt": "2020-11-05T09:51:50Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaChangelogTableITCase.java", "diffHunk": "@@ -109,6 +109,7 @@ public void testKafkaDebeziumChangelogSource() throws Exception {\n \t\tString bootstraps = standardProps.getProperty(\"bootstrap.servers\");\n \t\tString sourceDDL = String.format(\n \t\t\t\"CREATE TABLE debezium_source (\" +\n+\t\t\t\" origin STRING METADATA FROM 'value.source.table',\" + // test some metadata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44e62800be6f0c1ed5b117997212d69f1f7aae85"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjYwNzI1OnYy", "diffSide": "RIGHT", "path": "flink-connectors/flink-connector-kafka/src/main/java/org/apache/flink/streaming/connectors/kafka/table/KafkaDynamicSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTo0NzozNlrOHt_rSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDozMzozMlrOHuoo8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5MTI0MA==", "bodyText": "Add a comment to mention why we must put the format metadata before connector metadata? I think the order can't be switched.", "url": "https://github.com/apache/flink/pull/13910#discussion_r517991240", "createdAt": "2020-11-05T11:47:36Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-kafka/src/main/java/org/apache/flink/streaming/connectors/kafka/table/KafkaDynamicSource.java", "diffHunk": "@@ -179,13 +183,37 @@ public ScanRuntimeProvider getScanRuntimeProvider(ScanContext context) {\n \t@Override\n \tpublic Map<String, DataType> listReadableMetadata() {\n \t\tfinal Map<String, DataType> metadataMap = new LinkedHashMap<>();\n+\n+\t\t// add value format metadata with prefix", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44e62800be6f0c1ed5b117997212d69f1f7aae85"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2MjM4Nw==", "bodyText": "actually the order doesn't matter here, but I just noticed that the order should be the other way around if format metadata should have higher precedence", "url": "https://github.com/apache/flink/pull/13910#discussion_r518662387", "createdAt": "2020-11-06T10:33:32Z", "author": {"login": "twalthr"}, "path": "flink-connectors/flink-connector-kafka/src/main/java/org/apache/flink/streaming/connectors/kafka/table/KafkaDynamicSource.java", "diffHunk": "@@ -179,13 +183,37 @@ public ScanRuntimeProvider getScanRuntimeProvider(ScanContext context) {\n \t@Override\n \tpublic Map<String, DataType> listReadableMetadata() {\n \t\tfinal Map<String, DataType> metadataMap = new LinkedHashMap<>();\n+\n+\t\t// add value format metadata with prefix", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5MTI0MA=="}, "originalCommit": {"oid": "44e62800be6f0c1ed5b117997212d69f1f7aae85"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjYyNzUzOnYy", "diffSide": "RIGHT", "path": "flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaChangelogTableITCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTo1MzozOVrOHt_30Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMjozNjoyMlrOHusZ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5NDQ0OQ==", "bodyText": "Could you make this case more complex? For example, declaring 2 format metadata and 2 connector metadata, but only select 1 format metadata and 1 connector metadata. This helps to verify format and connector metadata can work together and the metadata pruning also works.", "url": "https://github.com/apache/flink/pull/13910#discussion_r517994449", "createdAt": "2020-11-05T11:53:39Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaChangelogTableITCase.java", "diffHunk": "@@ -131,7 +133,8 @@ public void testKafkaDebeziumChangelogSource() throws Exception {\n \t\ttEnv.executeSql(sourceDDL);\n \t\ttEnv.executeSql(sinkDDL);\n \t\tTableResult tableResult = tEnv.executeSql(\n-\t\t\t\"INSERT INTO sink SELECT name, SUM(weight) FROM debezium_source GROUP BY name\");\n+\t\t\t\"INSERT INTO sink SELECT FIRST_VALUE(origin), name, SUM(weight) \"\n+\t\t\t\t+ \"FROM debezium_source GROUP BY name\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44e62800be6f0c1ed5b117997212d69f1f7aae85"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODcyNDA3Ng==", "bodyText": "Good suggestion. I found a bug.", "url": "https://github.com/apache/flink/pull/13910#discussion_r518724076", "createdAt": "2020-11-06T12:36:22Z", "author": {"login": "twalthr"}, "path": "flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/table/KafkaChangelogTableITCase.java", "diffHunk": "@@ -131,7 +133,8 @@ public void testKafkaDebeziumChangelogSource() throws Exception {\n \t\ttEnv.executeSql(sourceDDL);\n \t\ttEnv.executeSql(sinkDDL);\n \t\tTableResult tableResult = tEnv.executeSql(\n-\t\t\t\"INSERT INTO sink SELECT name, SUM(weight) FROM debezium_source GROUP BY name\");\n+\t\t\t\"INSERT INTO sink SELECT FIRST_VALUE(origin), name, SUM(weight) \"\n+\t\t\t\t+ \"FROM debezium_source GROUP BY name\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5NDQ0OQ=="}, "originalCommit": {"oid": "44e62800be6f0c1ed5b117997212d69f1f7aae85"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4913, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}