{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NTkxODEw", "number": 14168, "title": "[FLINK-20277] Fix that ContinuousFileMonitoringFunction cannot restore from failure", "bodyText": "What is the purpose of the change\nIn 1.11, HiveTableSource uses ContinuousFileMonitoringFunction with given globalModificationTime, while in ContinuousFileMonitoringFunction#initializeState the state restore logic always checks whether globalModificationTime is equal to Long.MIN_VALUE. The correct logic should be checking whether the globalModificationTime is equal to the initialized globalModificationTime.\nBrief change log\n\nCheck whether the globalModificationTime is equal to the initialized  globalModificationTime\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nExtended ContinuousFileProcessingTest to verify the bug\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-11-23T09:35:06Z", "url": "https://github.com/apache/flink/pull/14168", "merged": true, "mergeCommit": {"oid": "39aea577c27bbac3c1905ddc944bb606235e33d4"}, "closed": true, "closedAt": "2020-11-24T02:35:53Z", "author": {"login": "godfreyhe"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfRv1HgH2gAyNTI1NTkxODEwOjRlNjZmZWFmZDBmNGY4YzAwZTAyNDAwMGVkMDU1YzQ0YjY1YmJjNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfWp7qAH2gAyNTI1NTkxODEwOmNmNjUxY2VmMTI5OGFhZTE4NzZhNTMxOWIxOWNiZGRlNDdlMGUxNGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e66feafd0f4f8c00e024000ed055c44b65bbc51", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/4e66feafd0f4f8c00e024000ed055c44b65bbc51", "committedDate": "2020-11-23T09:29:31Z", "message": "[FLINK-20277] Fix that ContinuousFileMonitoringFunction cannot restore from failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDA1MTc5", "url": "https://github.com/apache/flink/pull/14168#pullrequestreview-536405179", "createdAt": "2020-11-23T11:56:45Z", "commit": {"oid": "4e66feafd0f4f8c00e024000ed055c44b65bbc51"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMTo1Njo0NlrOH4KS_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMTo1Njo0NlrOH4KS_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY1MTAwNA==", "bodyText": "volatile -> final", "url": "https://github.com/apache/flink/pull/14168#discussion_r528651004", "createdAt": "2020-11-23T11:56:46Z", "author": {"login": "JingsongLi"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/source/ContinuousFileMonitoringFunction.java", "diffHunk": "@@ -96,6 +96,9 @@\n \t/** The maximum file modification time seen so far. */\n \tprivate volatile long globalModificationTime;\n \n+\t/** store the initialized value of globalModificationTime */\n+\tprivate volatile long initializedGlobalModificationTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e66feafd0f4f8c00e024000ed055c44b65bbc51"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDA1OTYw", "url": "https://github.com/apache/flink/pull/14168#pullrequestreview-536405960", "createdAt": "2020-11-23T11:57:56Z", "commit": {"oid": "4e66feafd0f4f8c00e024000ed055c44b65bbc51"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac9e64f86294f088a94e41ad1c7f165abddb24ad", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/ac9e64f86294f088a94e41ad1c7f165abddb24ad", "committedDate": "2020-11-23T11:59:25Z", "message": "address comments and fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf651cef1298aae1876a5319b19cbdde47e0e14f", "author": {"user": {"login": "godfreyhe", "name": "godfrey he"}}, "url": "https://github.com/apache/flink/commit/cf651cef1298aae1876a5319b19cbdde47e0e14f", "committedDate": "2020-11-23T15:12:36Z", "message": "update message name"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4050, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}