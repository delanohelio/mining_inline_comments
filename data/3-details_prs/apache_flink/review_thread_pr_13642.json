{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNjU3ODkx", "number": 13642, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOTo0MjoyN1rOEt6X-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOTo0MjoyN1rOEt6X-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NTc3Nzg1OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/RecoveredChannelStateHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOTo0MjoyN1rOHh_eyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMTowMjo1M1rOHiCbfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTEyOA==", "bodyText": "IOException? (org.apache.flink.runtime.checkpoint.channel.ChannelStateChunkReader#readChunk already can handle IOException).", "url": "https://github.com/apache/flink/pull/13642#discussion_r505405128", "createdAt": "2020-10-15T09:42:27Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/RecoveredChannelStateHandler.java", "diffHunk": "@@ -101,7 +101,10 @@ private RecoveredInputChannel getChannel(InputChannelInfo info) {\n \tpublic void recover(ResultSubpartitionInfo subpartitionInfo, Tuple2<BufferBuilder, BufferConsumer> bufferBuilderAndConsumer) {\n \t\tbufferBuilderAndConsumer.f0.finish();\n \t\tif (bufferBuilderAndConsumer.f1.isDataAvailable()) {\n-\t\t\tgetSubpartition(subpartitionInfo).addBufferConsumer(bufferBuilderAndConsumer.f1);\n+\t\t\tboolean added = getSubpartition(subpartitionInfo).add(bufferBuilderAndConsumer.f1);\n+\t\t\tif (!added) {\n+\t\t\t\tthrow new RuntimeException(\"Buffer consumer couldn't be added to ResultSubpartition\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04f8d715a9a672b0d832e9b9e067294376eae211"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQyMzAxNA==", "bodyText": "false is returned if the subpartition isFinished || isReleased. This case seems to me neither IO error nor recoverable.\nI can change to IOException though if you insist.", "url": "https://github.com/apache/flink/pull/13642#discussion_r505423014", "createdAt": "2020-10-15T10:08:29Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/RecoveredChannelStateHandler.java", "diffHunk": "@@ -101,7 +101,10 @@ private RecoveredInputChannel getChannel(InputChannelInfo info) {\n \tpublic void recover(ResultSubpartitionInfo subpartitionInfo, Tuple2<BufferBuilder, BufferConsumer> bufferBuilderAndConsumer) {\n \t\tbufferBuilderAndConsumer.f0.finish();\n \t\tif (bufferBuilderAndConsumer.f1.isDataAvailable()) {\n-\t\t\tgetSubpartition(subpartitionInfo).addBufferConsumer(bufferBuilderAndConsumer.f1);\n+\t\t\tboolean added = getSubpartition(subpartitionInfo).add(bufferBuilderAndConsumer.f1);\n+\t\t\tif (!added) {\n+\t\t\t\tthrow new RuntimeException(\"Buffer consumer couldn't be added to ResultSubpartition\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTEyOA=="}, "originalCommit": {"oid": "04f8d715a9a672b0d832e9b9e067294376eae211"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ0OTA2Nw==", "bodyText": "I suggested IOException because that's what was in the signature of the parent/caller method.\nMaybe alternatively CancelTaskException, but I'm not entirely sure if that's always the case (what if there was some error in this task, that caused the partition to be released?)\nWhat adds to my confusion is that this return value is ignored in rest of the code base? \ud83e\udd37\u200d\u2642\ufe0f\nI think for now it would be the best to go with IOException.", "url": "https://github.com/apache/flink/pull/13642#discussion_r505449067", "createdAt": "2020-10-15T10:54:40Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/RecoveredChannelStateHandler.java", "diffHunk": "@@ -101,7 +101,10 @@ private RecoveredInputChannel getChannel(InputChannelInfo info) {\n \tpublic void recover(ResultSubpartitionInfo subpartitionInfo, Tuple2<BufferBuilder, BufferConsumer> bufferBuilderAndConsumer) {\n \t\tbufferBuilderAndConsumer.f0.finish();\n \t\tif (bufferBuilderAndConsumer.f1.isDataAvailable()) {\n-\t\t\tgetSubpartition(subpartitionInfo).addBufferConsumer(bufferBuilderAndConsumer.f1);\n+\t\t\tboolean added = getSubpartition(subpartitionInfo).add(bufferBuilderAndConsumer.f1);\n+\t\t\tif (!added) {\n+\t\t\t\tthrow new RuntimeException(\"Buffer consumer couldn't be added to ResultSubpartition\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTEyOA=="}, "originalCommit": {"oid": "04f8d715a9a672b0d832e9b9e067294376eae211"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ1MzQzOA==", "bodyText": "Changed to IOException.\n\nWhat adds to my confusion is that this return value is ignored in rest of the code base?\n\nI agree, but I think it can be addressed separately.", "url": "https://github.com/apache/flink/pull/13642#discussion_r505453438", "createdAt": "2020-10-15T11:02:53Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/RecoveredChannelStateHandler.java", "diffHunk": "@@ -101,7 +101,10 @@ private RecoveredInputChannel getChannel(InputChannelInfo info) {\n \tpublic void recover(ResultSubpartitionInfo subpartitionInfo, Tuple2<BufferBuilder, BufferConsumer> bufferBuilderAndConsumer) {\n \t\tbufferBuilderAndConsumer.f0.finish();\n \t\tif (bufferBuilderAndConsumer.f1.isDataAvailable()) {\n-\t\t\tgetSubpartition(subpartitionInfo).addBufferConsumer(bufferBuilderAndConsumer.f1);\n+\t\t\tboolean added = getSubpartition(subpartitionInfo).add(bufferBuilderAndConsumer.f1);\n+\t\t\tif (!added) {\n+\t\t\t\tthrow new RuntimeException(\"Buffer consumer couldn't be added to ResultSubpartition\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQwNTEyOA=="}, "originalCommit": {"oid": "04f8d715a9a672b0d832e9b9e067294376eae211"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 155, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}