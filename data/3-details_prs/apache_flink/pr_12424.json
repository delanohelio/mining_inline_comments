{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1ODY5ODU4", "number": 12424, "title": "[FLINK-18046][hive] Decimal column stats not supported for Hive table", "bodyText": "What is the purpose of the change\nFix the issue that Hive table decimal column stats is not supported\nBrief change log\n\nReturn CatalogColumnStatisticsDataDouble for decimal columns\nAdd test\n\nVerifying this change\nAdded test\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? NA", "createdAt": "2020-06-01T09:49:07Z", "url": "https://github.com/apache/flink/pull/12424", "merged": true, "mergeCommit": {"oid": "88e416f988bc286b7cc0df7bcf0679184e7bb805"}, "closed": true, "closedAt": "2020-06-08T10:41:12Z", "author": {"login": "lirui-apache"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcm-rA1ABqjMzOTI3MzcyNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpIabWgBqjM0MTc5NDQzODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92b76bd98982ffcfdedd377636b51fe4a5cab233", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/92b76bd98982ffcfdedd377636b51fe4a5cab233", "committedDate": "2020-06-01T09:46:30Z", "message": "[FLINK-18046][hive] Support stats for decimal columns in Hive table"}, "afterCommit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/70a6023896eafba73b388a5d53c5a58f63d82bf6", "committedDate": "2020-06-01T11:35:36Z", "message": "[FLINK-18046][hive] Decimal column stats not supported for Hive table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzkxODk3", "url": "https://github.com/apache/flink/pull/12424#pullrequestreview-421791897", "createdAt": "2020-06-01T12:06:23Z", "commit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDk1NjI5", "url": "https://github.com/apache/flink/pull/12424#pullrequestreview-425095629", "createdAt": "2020-06-05T08:24:05Z", "commit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODoyNDowNlrOGflDrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwODoyNDozN1rOGflEwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2NjE4OQ==", "bodyText": "NIT: add method: toHiveDecimal(Decimal d)", "url": "https://github.com/apache/flink/pull/12424#discussion_r435766189", "createdAt": "2020-06-05T08:24:06Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/util/HiveStatsUtil.java", "diffHunk": "@@ -171,6 +177,22 @@ private static CatalogColumnStatisticsDataBase createTableColumnStats(DataType c\n \t\t\t\t\tstringStats.isSetAvgColLen() ? stringStats.getAvgColLen() : null,\n \t\t\t\t\tstringStats.isSetNumDVs() ? stringStats.getNumDVs() : null,\n \t\t\t\t\tstringStats.isSetNumDVs() ? stringStats.getNumNulls() : null);\n+\t\t} else if (stats.isSetDecimalStats()) {\n+\t\t\tDecimalColumnStatsData decimalStats = stats.getDecimalStats();\n+\t\t\t// for now, just return CatalogColumnStatisticsDataDouble for decimal columns\n+\t\t\tDouble max = null;\n+\t\t\tif (decimalStats.isSetHighValue()) {\n+\t\t\t\tDecimal highVal = decimalStats.getHighValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2NjQ2NQ==", "bodyText": "Also add precision like 30, 3", "url": "https://github.com/apache/flink/pull/12424#discussion_r435766465", "createdAt": "2020-06-05T08:24:37Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/catalog/hive/HiveCatalogHiveMetadataTest.java", "diffHunk": "@@ -123,9 +123,10 @@ public void testAlterTableColumnStatistics() throws Exception {\n \t\t\t\t.field(\"third\", DataTypes.BOOLEAN())\n \t\t\t\t.field(\"fourth\", DataTypes.DOUBLE())\n \t\t\t\t.field(\"fifth\", DataTypes.BIGINT())\n-\t\t\t\t.field(\"sixth\", DataTypes.BYTES());\n+\t\t\t\t.field(\"sixth\", DataTypes.BYTES())\n+\t\t\t\t.field(\"seventh\", DataTypes.DECIMAL(10, 3));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4072371afa492a31f0d68c1c90aa370b1af2796d", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/4072371afa492a31f0d68c1c90aa370b1af2796d", "committedDate": "2020-06-08T04:04:51Z", "message": "[FLINK-18046][hive] Decimal column stats not supported for Hive table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7238e01593a92ac1f62754177e1fcba913e77335", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/7238e01593a92ac1f62754177e1fcba913e77335", "committedDate": "2020-06-08T04:04:51Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70a6023896eafba73b388a5d53c5a58f63d82bf6", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/70a6023896eafba73b388a5d53c5a58f63d82bf6", "committedDate": "2020-06-01T11:35:36Z", "message": "[FLINK-18046][hive] Decimal column stats not supported for Hive table"}, "afterCommit": {"oid": "7238e01593a92ac1f62754177e1fcba913e77335", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/7238e01593a92ac1f62754177e1fcba913e77335", "committedDate": "2020-06-08T04:04:51Z", "message": "address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4163, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}