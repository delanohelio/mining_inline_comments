{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTY0NTYw", "number": 11421, "title": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack", "bodyText": "What is the purpose of the change\nDecrease the default Netty chunk size from 16MB to 4MB. Since Netty allocates memory by chunks, a smaller chunk size would decrease the amount of unused direct memory, thus decrease the total direct memory required.\nTo allow users changes the default behaviors, we also makes the page size and max order properties of NettyBufferPool configurable.\nBrief change log\n\nce674a7 introduce the configuration options and change the default chunk size to 4MB.\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nUnit tests for the configuration checking logic.\nDecrease the required direct memory in E2E test NettyShuffleMemoryControlTest from 20M to 7M and verifies that without the change there will be direct memory OOM exception, and with the change there will be no exception.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector:no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable", "createdAt": "2020-03-17T00:53:49Z", "url": "https://github.com/apache/flink/pull/11421", "merged": true, "mergeCommit": {"oid": "0bc38ba058165aa6751e7e4c654e37203df3aa35"}, "closed": true, "closedAt": "2020-03-20T09:19:11Z", "author": {"login": "gaoyunhaii"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcObr_5gFqTM3NTc0NTY1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPbyvGAFqTM3ODI4MjUyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzQ1NjU2", "url": "https://github.com/apache/flink/pull/11421#pullrequestreview-375745656", "createdAt": "2020-03-17T05:16:31Z", "commit": {"oid": "ce674a7530f5a1dae64aa226148a92ad58b2be76"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce674a7530f5a1dae64aa226148a92ad58b2be76", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/ce674a7530f5a1dae64aa226148a92ad58b2be76", "committedDate": "2020-03-17T00:44:22Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}, "afterCommit": {"oid": "dd9c079d6024bcae4216bdc3004660018e41f938", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/dd9c079d6024bcae4216bdc3004660018e41f938", "committedDate": "2020-03-17T07:20:39Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NDA3OTY2", "url": "https://github.com/apache/flink/pull/11421#pullrequestreview-377407966", "createdAt": "2020-03-19T03:54:35Z", "commit": {"oid": "dd9c079d6024bcae4216bdc3004660018e41f938"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMzo1NDozNlrOF4fTzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMzo1NDozNlrOF4fTzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3NzU0OA==", "bodyText": "There are also many other places mentioned 16 MB in comments, and we should still adjust them.", "url": "https://github.com/apache/flink/pull/11421#discussion_r394777548", "createdAt": "2020-03-19T03:54:36Z", "author": {"login": "zhijiangW"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyBufferPool.java", "diffHunk": "@@ -61,11 +61,11 @@\n \n \t/**\n \t * Arenas allocate chunks of pageSize << maxOrder bytes. With these defaults, this results in\n-\t * chunks of 16 MB.\n+\t * chunks of 4 MB.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd9c079d6024bcae4216bdc3004660018e41f938"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd9c079d6024bcae4216bdc3004660018e41f938", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/dd9c079d6024bcae4216bdc3004660018e41f938", "committedDate": "2020-03-17T07:20:39Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}, "afterCommit": {"oid": "394192b70d312009146b91bda454b5297ad3b036", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/394192b70d312009146b91bda454b5297ad3b036", "committedDate": "2020-03-20T00:12:26Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58a6e5f75b628dd8b2afb85e7658cabf3fc0fde9", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/58a6e5f75b628dd8b2afb85e7658cabf3fc0fde9", "committedDate": "2020-03-20T07:09:58Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "394192b70d312009146b91bda454b5297ad3b036", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/394192b70d312009146b91bda454b5297ad3b036", "committedDate": "2020-03-20T00:12:26Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}, "afterCommit": {"oid": "58a6e5f75b628dd8b2afb85e7658cabf3fc0fde9", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/58a6e5f75b628dd8b2afb85e7658cabf3fc0fde9", "committedDate": "2020-03-20T07:09:58Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjgyNTI4", "url": "https://github.com/apache/flink/pull/11421#pullrequestreview-378282528", "createdAt": "2020-03-20T07:57:48Z", "commit": {"oid": "58a6e5f75b628dd8b2afb85e7658cabf3fc0fde9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2811, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}