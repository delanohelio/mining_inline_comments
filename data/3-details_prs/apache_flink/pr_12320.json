{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNzMxOTQw", "number": 12320, "title": "[FLINK-17887][table][connector] Improve interface of ScanFormatFactory and SinkFormatFactory", "bodyText": "What is the purpose of the change\nThis pull request is for improving current ScanForamtFactory and SinkFormatFactory interfaces with the following problems:\n\nScanFormat#createScanFormat only accepts ScanTableSource.Context, which means it can\u2019t work in lookup source.\nThe naming of ScanFormat also indicates it is only used in scan source. But a lookup source should be able to work with format too.\nIt\u2019s confusing that ScanFormatFactory#createScanFormat and ScanFormat#createScanFormat (create itself?)\n\nBrief change log\n\nHave a common interface DynamicTableSource.Context, and make Context of ScanTableSource and LookupTableSource extend it, and rename them to LookupContext and ScanContext\nChange parameter of ScanFormat.createScanFormat from ScanTableSource.Context to DynamicTableSource.Context\nRename ScanFormat.createScanFormat to DecodingFormat#createRuntimeDecoder()\nRename SinkFormat.createSinkFormat to EncodingFormat#createRuntimeEncoder()\nRename ScanFormatFactory to DecodingFormatFactory\nRename SinkFormatFactory to EncodingFormatFactory\n\nVerifying this change\nThis change is a trivial rework and is covered by existing tests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-05-25T12:41:07Z", "url": "https://github.com/apache/flink/pull/12320", "merged": true, "mergeCommit": {"oid": "64de78e36500b5a8c8720639ded4d1c5f963ad41"}, "closed": true, "closedAt": "2020-06-01T02:32:41Z", "author": {"login": "wuchong"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABck-ePXAFqTQxNzk5NTcyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmr98hgBqjMzOTA2MjU1MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTk1NzIz", "url": "https://github.com/apache/flink/pull/12320#pullrequestreview-417995723", "createdAt": "2020-05-26T06:14:30Z", "commit": {"oid": "3153508b46fd876ac1ffd0710e54b7ec3756007f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3153508b46fd876ac1ffd0710e54b7ec3756007f", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/3153508b46fd876ac1ffd0710e54b7ec3756007f", "committedDate": "2020-05-26T01:56:34Z", "message": "fix tests"}, "afterCommit": {"oid": "1ad6eea2421dd2c9950f19ff2fd5ee54bb66c6f0", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/1ad6eea2421dd2c9950f19ff2fd5ee54bb66c6f0", "committedDate": "2020-05-28T05:49:03Z", "message": "[FLINK-17887][table][connector] Improve interface of ScanFormatFactory and SinkFormatFactory\n\n1. Have a common interface DynamicTableSource.Context, and make Context of ScanTableSource and LookupTableSource extend it, and rename them to LookupContext and ScanContext\n2. Change parameter of ScanFormat.createScanFormat from ScanTableSource.Context to DynamicTableSource.Context\n3. Rename ScanFormat.createScanFormat to DecodingFormat#createRuntimeDecoder()\n4. Rename SinkFormat.createSinkFormat to EncodingFormat#createRuntimeEncoder()\n5. Rename ScanFormatFactory to DecodingFormatFactory\n6. Rename SinkFormatFactory to EncodingFormatFactory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDYzNzU4", "url": "https://github.com/apache/flink/pull/12320#pullrequestreview-421463758", "createdAt": "2020-05-31T05:52:04Z", "commit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNTo1MjowNVrOGc240A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNTo1OTozN1rOGc26Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjU5Mg==", "bodyText": "fix wrong indention here and at other locations", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912592", "createdAt": "2020-05-31T05:52:05Z", "author": {"login": "twalthr"}, "path": "flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/table/Kafka011DynamicTableFactoryTest.java", "diffHunk": "@@ -82,12 +82,12 @@ protected KafkaDynamicSinkBase getExpectedSink(\n \t\t\tString topic,\n \t\t\tProperties properties,\n \t\t\tOptional<FlinkKafkaPartitioner<RowData>> partitioner,\n-\t\t\tSinkFormat<SerializationSchema<RowData>> sinkFormat) {\n+\t\t\tEncodingFormat<SerializationSchema<RowData>> encodingFormat) {\n \t\treturn new Kafka011DynamicSink(\n \t\t\t\tconsumedDataType,\n \t\t\t\ttopic,\n \t\t\t\tproperties,\n \t\t\t\tpartitioner,\n-\t\t\t\tsinkFormat);\n+\t\t\tencodingFormat);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjYzNA==", "bodyText": "update error message?", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912634", "createdAt": "2020-05-31T05:52:48Z", "author": {"login": "twalthr"}, "path": "flink-connectors/flink-connector-kafka-base/src/main/java/org/apache/flink/streaming/connectors/kafka/table/KafkaDynamicSinkBase.java", "diffHunk": "@@ -63,23 +63,23 @@ protected KafkaDynamicSinkBase(\n \t\t\tString topic,\n \t\t\tProperties properties,\n \t\t\tOptional<FlinkKafkaPartitioner<RowData>> partitioner,\n-\t\t\tSinkFormat<SerializationSchema<RowData>> sinkFormat) {\n+\t\t\tEncodingFormat<SerializationSchema<RowData>> encodingFormat) {\n \t\tthis.consumedDataType = Preconditions.checkNotNull(consumedDataType, \"Consumed data type must not be null.\");\n \t\tthis.topic = Preconditions.checkNotNull(topic, \"Topic must not be null.\");\n \t\tthis.properties = Preconditions.checkNotNull(properties, \"Properties must not be null.\");\n \t\tthis.partitioner = Preconditions.checkNotNull(partitioner, \"Partitioner must not be null.\");\n-\t\tthis.sinkFormat = Preconditions.checkNotNull(sinkFormat, \"Sink format must not be null.\");\n+\t\tthis.encodingFormat = Preconditions.checkNotNull(encodingFormat, \"Sink format must not be null.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjY4Mw==", "bodyText": "fix wrong indention and remove \"Scan\" from Javadoc?", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912683", "createdAt": "2020-05-31T05:53:45Z", "author": {"login": "twalthr"}, "path": "flink-connectors/flink-connector-kafka-base/src/main/java/org/apache/flink/streaming/connectors/kafka/table/KafkaDynamicSourceBase.java", "diffHunk": "@@ -85,7 +85,7 @@\n \t * @param outputDataType         Source produced data type\n \t * @param topic                  Kafka topic to consume.\n \t * @param properties             Properties for the Kafka consumer.\n-\t * @param scanFormat             Scan format for decoding records from Kafka.\n+\t * @param decodingFormat             Scan format for decoding records from Kafka.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjc2NQ==", "bodyText": "nit: for reading rows", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912765", "createdAt": "2020-05-31T05:55:21Z", "author": {"login": "twalthr"}, "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/format/DecodingFormat.java", "diffHunk": "@@ -19,19 +19,19 @@\n package org.apache.flink.table.connector.format;\n \n import org.apache.flink.annotation.PublicEvolving;\n-import org.apache.flink.table.connector.source.ScanTableSource;\n+import org.apache.flink.table.connector.source.DynamicTableSource;\n import org.apache.flink.table.types.DataType;\n \n /**\n- * A {@link Format} for a {@link ScanTableSource}.\n+ * A {@link Format} for a {@link DynamicTableSource} to reading rows.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjgxNw==", "bodyText": "we can remove the e.g. it is only for those two locations now", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912817", "createdAt": "2020-05-31T05:56:34Z", "author": {"login": "twalthr"}, "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/format/Format.java", "diffHunk": "@@ -34,15 +34,15 @@\n  *\n  * <p>Formats can be distinguished along two dimensions:\n  * <ul>\n- *     <li>Context in which the format is applied (e.g. {@link ScanTableSource} or {@link DynamicTableSink}).\n+ *     <li>Context in which the format is applied (e.g. {@link DynamicTableSource} or {@link DynamicTableSink}).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMjk1OA==", "bodyText": "fix formatting here and below", "url": "https://github.com/apache/flink/pull/12320#discussion_r432912958", "createdAt": "2020-05-31T05:59:37Z", "author": {"login": "twalthr"}, "path": "flink-table/flink-table-common/src/test/java/org/apache/flink/table/factories/TestDynamicTableFactory.java", "diffHunk": "@@ -134,13 +134,14 @@ public String factoryIdentifier() {\n \tpublic static class DynamicTableSourceMock implements ScanTableSource {\n \n \t\tpublic final String target;\n-\t\tpublic final @Nullable ScanFormat<DeserializationSchema<RowData>> sourceKeyFormat;\n-\t\tpublic final ScanFormat<DeserializationSchema<RowData>> sourceValueFormat;\n+\t\tpublic final @Nullable\n+\t\tDecodingFormat<DeserializationSchema<RowData>> sourceKeyFormat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29cda133f6e006742e1518916128bb19b6cd6518", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/29cda133f6e006742e1518916128bb19b6cd6518", "committedDate": "2020-05-31T13:48:15Z", "message": "[FLINK-17887][table][connector] Improve interface of ScanFormatFactory and SinkFormatFactory\n\n1. Have a common interface DynamicTableSource.Context, and make Context of ScanTableSource and LookupTableSource extend it, and rename them to LookupContext and ScanContext\n2. Change parameter of ScanFormat.createScanFormat from ScanTableSource.Context to DynamicTableSource.Context\n3. Rename ScanFormat.createScanFormat to DecodingFormat#createRuntimeDecoder()\n4. Rename SinkFormat.createSinkFormat to EncodingFormat#createRuntimeEncoder()\n5. Rename ScanFormatFactory to DecodingFormatFactory\n6. Rename SinkFormatFactory to EncodingFormatFactory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80bfdeac6274c0cfa3218da26c88f7e05d517f86", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/80bfdeac6274c0cfa3218da26c88f7e05d517f86", "committedDate": "2020-05-28T06:57:59Z", "message": "fix compile"}, "afterCommit": {"oid": "29cda133f6e006742e1518916128bb19b6cd6518", "author": {"user": {"login": "wuchong", "name": "Jark Wu"}}, "url": "https://github.com/apache/flink/commit/29cda133f6e006742e1518916128bb19b6cd6518", "committedDate": "2020-05-31T13:48:15Z", "message": "[FLINK-17887][table][connector] Improve interface of ScanFormatFactory and SinkFormatFactory\n\n1. Have a common interface DynamicTableSource.Context, and make Context of ScanTableSource and LookupTableSource extend it, and rename them to LookupContext and ScanContext\n2. Change parameter of ScanFormat.createScanFormat from ScanTableSource.Context to DynamicTableSource.Context\n3. Rename ScanFormat.createScanFormat to DecodingFormat#createRuntimeDecoder()\n4. Rename SinkFormat.createSinkFormat to EncodingFormat#createRuntimeEncoder()\n5. Rename ScanFormatFactory to DecodingFormatFactory\n6. Rename SinkFormatFactory to EncodingFormatFactory"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4399, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}