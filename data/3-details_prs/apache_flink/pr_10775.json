{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDkxMzk5", "number": 10775, "title": "[FLINK-15482][hive] Failed to call Hive functions returning decimal type", "bodyText": "What is the purpose of the change\nFix the issue of calling Hive functions that return decimals\nBrief change log\n\nCall TypeInfoDataTypeConverter to convert data type to type info because it's the recommended way.\nAdd test case\n\nVerifying this change\nNew test case\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? NA", "createdAt": "2020-01-06T10:48:42Z", "url": "https://github.com/apache/flink/pull/10775", "merged": true, "mergeCommit": {"oid": "b195383b6b792ea1363ae340ffcfb6ef45c84677"}, "closed": true, "closedAt": "2020-01-07T11:33:32Z", "author": {"login": "lirui-apache"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3p11CAH2gAyMzU5NDkxMzk5OjIzMDExOGZlMjJhYmRmYTJhZGFlN2ZhYmNkNGNlNjU3N2M5MmJjZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3-Gz3gFqTMzOTE0ODUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "230118fe22abdfa2adae7fabcd4ce6577c92bceb", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/230118fe22abdfa2adae7fabcd4ce6577c92bceb", "committedDate": "2020-01-06T10:45:40Z", "message": "[FLINK-15482][hive] Failed to call Hive functions returning decimal type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c6c4bbe58dce3da8eed8133e234e61c8fc1db0", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/58c6c4bbe58dce3da8eed8133e234e61c8fc1db0", "committedDate": "2020-01-06T12:12:16Z", "message": "DataFormatConverters should throw exception for unsupported decimal conversion class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d09f924b8a299087584f822180dd0fd51f50e0c1", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/d09f924b8a299087584f822180dd0fd51f50e0c1", "committedDate": "2020-01-06T12:21:54Z", "message": "ScalarFunctionCallGen should call LogicalTypeDataTypeConverter to get logical type for result DataType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f3e87d2f247d4970fdd41e9758f5575710f9cfa", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/9f3e87d2f247d4970fdd41e9758f5575710f9cfa", "committedDate": "2020-01-06T13:08:44Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDY1MjU5", "url": "https://github.com/apache/flink/pull/10775#pullrequestreview-339065259", "createdAt": "2020-01-07T07:20:28Z", "commit": {"oid": "9f3e87d2f247d4970fdd41e9758f5575710f9cfa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzoyMDoyOVrOFaxfPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzoyMDoyOVrOFaxfPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxODEwOA==", "bodyText": "Can you add a UDF case like:\nclass MyUdf extends ScalarFunction {\n   public Object eval(...) {...}\n   public TypeInformation getResultType() {\n      return Types.BIG_DECIMAL;\n   }\n}\n\nto repeat this bug?", "url": "https://github.com/apache/flink/pull/10775#discussion_r363618108", "createdAt": "2020-01-07T07:20:29Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarFunctionCallGen.scala", "diffHunk": "@@ -79,7 +80,8 @@ class ScalarFunctionCallGen(scalarFunction: ScalarFunction) extends CallGenerato\n         val boxedResultClass = ExtractionUtils.boxPrimitive(resultClass).asInstanceOf[Class[_]]\n         val javaTypeTerm = boxedResultClass.getCanonicalName\n         val resultExternalTypeWithResultClass =\n-          if (resultExternalType.getLogicalType.supportsOutputConversion(boxedResultClass)) {\n+          if (LogicalTypeDataTypeConverter.fromDataTypeToLogicalType(resultExternalType)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f3e87d2f247d4970fdd41e9758f5575710f9cfa"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDY2OTM2", "url": "https://github.com/apache/flink/pull/10775#pullrequestreview-339066936", "createdAt": "2020-01-07T07:26:02Z", "commit": {"oid": "9f3e87d2f247d4970fdd41e9758f5575710f9cfa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzoyNjowMlrOFaxkPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzoyNjowMlrOFaxkPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxOTM4OA==", "bodyText": "Put it in the else branch? Could you help to update other types which have the same problem, e.g. TIMESTAMP_WITHOUT_TIME_ZONE, TIMESTAMP_WITH_LOCAL_TIME_ZONE, TIMESTAMP_WITH_LOCAL_TIME_ZONE...", "url": "https://github.com/apache/flink/pull/10775#discussion_r363619388", "createdAt": "2020-01-07T07:26:02Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/dataformat/DataFormatConverters.java", "diffHunk": "@@ -164,9 +164,10 @@ public static DataFormatConverter getConverterForDataType(DataType originDataTyp\n \t\t\t\tTuple2<Integer, Integer> ps = getPrecision(logicalType);\n \t\t\t\tif (clazz == BigDecimal.class) {\n \t\t\t\t\treturn new BigDecimalConverter(ps.f0, ps.f1);\n-\t\t\t\t} else {\n+\t\t\t\t} else if (clazz == Decimal.class) {\n \t\t\t\t\treturn new DecimalConverter(ps.f0, ps.f1);\n \t\t\t\t}\n+\t\t\t\tthrow new RuntimeException(\"Not support class for DECIMAL: \" + clazz);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f3e87d2f247d4970fdd41e9758f5575710f9cfa"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a219cce89f3c6fa14c063f4f2231b5f9830b68f6", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/a219cce89f3c6fa14c063f4f2231b5f9830b68f6", "committedDate": "2020-01-07T08:41:49Z", "message": "add test and more fixes for DataFormatConverters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MTQ4NTM1", "url": "https://github.com/apache/flink/pull/10775#pullrequestreview-339148535", "createdAt": "2020-01-07T10:22:19Z", "commit": {"oid": "a219cce89f3c6fa14c063f4f2231b5f9830b68f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4955, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}