{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNzgxMzY4", "number": 11238, "title": "[FLINK-16304][python] Remove python packages bundled in the flink-python jar.", "bodyText": "What is the purpose of the change\nThis pull request removes python packages bundled in the flink-python jar.\nBrief change log\n\nRemove python packages bundled in the flink-python jar.\nAdd python packages to opt/python directory.\nExclude python packages in opt/python directory when executing python setup.py sdist.\n\nVerifying this change\nThis change is already covered by existing tests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable)", "createdAt": "2020-02-27T11:10:12Z", "url": "https://github.com/apache/flink/pull/11238", "merged": true, "mergeCommit": {"oid": "42f49482a3217287abba5e8903cf50791acf287a"}, "closed": true, "closedAt": "2020-03-12T10:26:57Z", "author": {"login": "WeiZhong94"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIsBBegFqTM2NjIyOTY4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM4s2rgFqTM3MzQxMzQ4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjI5Njg5", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-366229689", "createdAt": "2020-02-28T08:33:30Z", "commit": {"oid": "42b69f81b3274b2f74891c6dc5f931b3dad2e6f1"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODozMzozMFrOFvtEBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODo1MjoxNFrOFvtiOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2NTcwMA==", "bodyText": "There are a few imports which could also be removed in this file.", "url": "https://github.com/apache/flink/pull/11238#discussion_r385565700", "createdAt": "2020-02-28T08:33:30Z", "author": {"login": "dianfu"}, "path": "flink-python/pyflink/shell.py", "diffHunk": "@@ -31,23 +31,6 @@\n from pyflink.table.descriptors import *\n from pyflink.table.window import *\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42b69f81b3274b2f74891c6dc5f931b3dad2e6f1"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2ODY5NQ==", "bodyText": "Why remove this license file?", "url": "https://github.com/apache/flink/pull/11238#discussion_r385568695", "createdAt": "2020-02-28T08:40:57Z", "author": {"login": "dianfu"}, "path": "flink-python/src/main/resources/META-INF/licenses/LICENSE.cloudpickle", "diffHunk": "@@ -1,32 +0,0 @@\n-This module was extracted from the `cloud` package, developed by", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42b69f81b3274b2f74891c6dc5f931b3dad2e6f1"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2ODc0OQ==", "bodyText": "Why remove this license file?", "url": "https://github.com/apache/flink/pull/11238#discussion_r385568749", "createdAt": "2020-02-28T08:41:06Z", "author": {"login": "dianfu"}, "path": "flink-python/src/main/resources/META-INF/licenses/LICENSE.py4j", "diffHunk": "@@ -1,26 +0,0 @@\n-Copyright (c) 2009-2018, Barthelemy Dagenais and individual contributors. All\n-rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42b69f81b3274b2f74891c6dc5f931b3dad2e6f1"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU3MzQzMg==", "bodyText": "Should we move pyflink-udf-runner.sh to src/main/resources of the jar of flink-python then I think there is no necessary to extract it from the jar file any more?", "url": "https://github.com/apache/flink/pull/11238#discussion_r385573432", "createdAt": "2020-02-28T08:52:14Z", "author": {"login": "dianfu"}, "path": "flink-python/src/main/java/org/apache/flink/python/util/ResourceUtil.java", "diffHunk": "@@ -22,71 +22,45 @@\n import java.io.IOException;\n import java.nio.file.Files;\n import java.nio.file.Paths;\n-import java.util.ArrayList;\n-import java.util.List;\n \n /**\n  * Utils for building the most basic environment for running python udf workers. The basic environment does not include\n  * python part of Apache Beam. Users need to prepare it themselves.\n  */\n public class ResourceUtil {\n \n-\tpublic static final String[] BUILT_IN_PYTHON_DEPENDENCIES = {\n-\t\t\"pyflink.zip\",\n-\t\t\"py4j-0.10.8.1-src.zip\",\n-\t\t\"cloudpickle-1.2.2-src.zip\",\n-\t\t\"pyflink-udf-runner.sh\"\n-\t};\n+\tpublic static final String PYFLINK_UDF_RUNNER = \"pyflink-udf-runner.sh\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42b69f81b3274b2f74891c6dc5f931b3dad2e6f1"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8c655f0ec279add4db9e7545b3b1d35cdf4c8c2", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/d8c655f0ec279add4db9e7545b3b1d35cdf4c8c2", "committedDate": "2020-02-28T13:43:20Z", "message": "revert movement of pyflink-udf-runner.sh"}, "afterCommit": {"oid": "a715f80958d35e1507f075982e63e5844d94d893", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/a715f80958d35e1507f075982e63e5844d94d893", "committedDate": "2020-02-28T13:56:43Z", "message": "fix tests and remove unnecessary code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a715f80958d35e1507f075982e63e5844d94d893", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/a715f80958d35e1507f075982e63e5844d94d893", "committedDate": "2020-02-28T13:56:43Z", "message": "fix tests and remove unnecessary code"}, "afterCommit": {"oid": "adf9599ad65c36a99e8c0fa9130fc30baf00ebb6", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/adf9599ad65c36a99e8c0fa9130fc30baf00ebb6", "committedDate": "2020-03-03T09:58:00Z", "message": "[FLINK-16304][python] Remove python packages bundled in the flink-python jar."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adf9599ad65c36a99e8c0fa9130fc30baf00ebb6", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/adf9599ad65c36a99e8c0fa9130fc30baf00ebb6", "committedDate": "2020-03-03T09:58:00Z", "message": "[FLINK-16304][python] Remove python packages bundled in the flink-python jar."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b84fb01719d2f614e7484d2d29de7bfc685329c", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/4b84fb01719d2f614e7484d2d29de7bfc685329c", "committedDate": "2020-03-10T11:31:29Z", "message": "Let the collect_license_files.sh also collect license files that are not bundled in any jar."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjExMDY1", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-372611065", "createdAt": "2020-03-11T09:54:45Z", "commit": {"oid": "4b84fb01719d2f614e7484d2d29de7bfc685329c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTo1NDo0NVrOF0v8VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTo1NDo0NVrOF0v8VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NTc2NA==", "bodyText": "It seems that it isn't necessary to exclude .txt?", "url": "https://github.com/apache/flink/pull/11238#discussion_r390855764", "createdAt": "2020-03-11T09:54:45Z", "author": {"login": "dianfu"}, "path": "tools/releasing/collect_license_files.sh", "diffHunk": "@@ -57,4 +57,19 @@ LICENSES=\"${DST}/licenses\"\n [ -f \"${LICENSES}\" ] && rm -r \"${LICENSES}\"\n find \"${TMP}\" -name \"licenses\" -type d -exec cp -r -- \"{}\" \"${DST}\" \\;\n \n+# Search the source directory and collect those license files that\n+# not bundled in any jars but exist in binary distribution.\n+# The root license directory, hidden directories, docs, node.js should be excluded.\n+# The file name should be \"LICENSE.PROJECT_NAME\", so the license files with incorrect\n+# file names will be excluded.\n+find \"${SRC}\" -name \"LICENSE.*\" -type f \\\n+! -path \"*/.*/*\" \\\n+! -path \"*/target/*\" \\\n+! -path \"*/licenses/*\" \\\n+! -path \"*/docs/*\" \\\n+! -path \"*/flink-runtime-web/web-dashboard/node*/*\" \\\n+! -path \"*.txt\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b84fb01719d2f614e7484d2d29de7bfc685329c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjUxNDY4", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-372651468", "createdAt": "2020-03-11T10:51:22Z", "commit": {"oid": "4b84fb01719d2f614e7484d2d29de7bfc685329c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1MToyMlrOF0x5rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1MToyMlrOF0x5rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4Nzg1Mg==", "bodyText": "The license are in the binary distribution under opt/python, why are we searching the source instead of just the distribution?", "url": "https://github.com/apache/flink/pull/11238#discussion_r390887852", "createdAt": "2020-03-11T10:51:22Z", "author": {"login": "zentol"}, "path": "tools/releasing/collect_license_files.sh", "diffHunk": "@@ -57,4 +57,19 @@ LICENSES=\"${DST}/licenses\"\n [ -f \"${LICENSES}\" ] && rm -r \"${LICENSES}\"\n find \"${TMP}\" -name \"licenses\" -type d -exec cp -r -- \"{}\" \"${DST}\" \\;\n \n+# Search the source directory and collect those license files that", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b84fb01719d2f614e7484d2d29de7bfc685329c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/ee983bedfb58e59b0fa7452667c2b1e5c3910ef1", "committedDate": "2020-03-11T11:50:36Z", "message": "change to search the binary distribution directory."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzQ4OTEx", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-372748911", "createdAt": "2020-03-11T13:20:27Z", "commit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzoyMDoyN1rOF02hzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzoyOTo0MFrOF0244w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2MzY2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            find \"${SRC}/flink-dist/target\" -name \"LICENSE.*\" -type f \\\n          \n          \n            \n            find \"${SRC}\" -name \"LICENSE.*\" -type f \\\n          \n      \n    \n    \n  \n\nSRC already points to the desired directory, see create_binary_release.sh#78", "url": "https://github.com/apache/flink/pull/11238#discussion_r390963660", "createdAt": "2020-03-11T13:20:27Z", "author": {"login": "zentol"}, "path": "tools/releasing/collect_license_files.sh", "diffHunk": "@@ -57,4 +57,9 @@ LICENSES=\"${DST}/licenses\"\n [ -f \"${LICENSES}\" ] && rm -r \"${LICENSES}\"\n find \"${TMP}\" -name \"licenses\" -type d -exec cp -r -- \"{}\" \"${DST}\" \\;\n \n+# Search the binary distribution directory and collect those license files that\n+# not bundled in any jars.\n+find \"${SRC}/flink-dist/target\" -name \"LICENSE.*\" -type f \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2NzIyMQ==", "bodyText": "-path \"*/flink-*-bin/*\" should not be necessary with the above suggestion.\n\n\nIt may be worthwhile to explicitly exclude ${TMP}/licenses and ${DST}/licenses; this script should continue to work even if the python licenses are moved into to opt/python/licenses.\n\n\nmaybe do a move instead so we have a single point for licenses.", "url": "https://github.com/apache/flink/pull/11238#discussion_r390967221", "createdAt": "2020-03-11T13:25:56Z", "author": {"login": "zentol"}, "path": "tools/releasing/collect_license_files.sh", "diffHunk": "@@ -57,4 +57,9 @@ LICENSES=\"${DST}/licenses\"\n [ -f \"${LICENSES}\" ] && rm -r \"${LICENSES}\"\n find \"${TMP}\" -name \"licenses\" -type d -exec cp -r -- \"{}\" \"${DST}\" \\;\n \n+# Search the binary distribution directory and collect those license files that\n+# not bundled in any jars.\n+find \"${SRC}/flink-dist/target\" -name \"LICENSE.*\" -type f \\\n+-path \"*/flink-*-bin/*\" ! -path \"*/licenses/*\" -exec cp -- \"{}\" \"${DST}/licenses\" \\;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2ODgxNw==", "bodyText": "this entry needs to be moved to tools/releasing/NOTICE-binary_PREAMBLE.txt, otherwise this will not show up in any NOTICE.", "url": "https://github.com/apache/flink/pull/11238#discussion_r390968817", "createdAt": "2020-03-11T13:28:27Z", "author": {"login": "zentol"}, "path": "flink-python/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -59,7 +59,6 @@ See bundled license files for details\n - com.google.protobuf:protobuf-java:3.7.1\n - com.google.protobuf:protobuf-java-util:3.7.1\n - com.google.auth:google-auth-library-credentials:0.13.0\n-- cloudpickle:1.2.2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2OTU3MQ==", "bodyText": "I assume the py4j entry is retained since we still bundle the java part?", "url": "https://github.com/apache/flink/pull/11238#discussion_r390969571", "createdAt": "2020-03-11T13:29:40Z", "author": {"login": "zentol"}, "path": "flink-python/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -59,7 +59,6 @@ See bundled license files for details\n - com.google.protobuf:protobuf-java:3.7.1\n - com.google.protobuf:protobuf-java-util:3.7.1\n - com.google.auth:google-auth-library-credentials:0.13.0\n-- cloudpickle:1.2.2", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk2ODgxNw=="}, "originalCommit": {"oid": "ee983bedfb58e59b0fa7452667c2b1e5c3910ef1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e1f9de29552097bc7a7973c6532f678dfc1dabe", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/1e1f9de29552097bc7a7973c6532f678dfc1dabe", "committedDate": "2020-03-11T13:47:33Z", "message": "Change the target directory of the find command to $SRC. Exclude $DST/licenses and $TMP/licenses."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ede7b0ecef98c97bd511c9929928ceb1668582b", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/3ede7b0ecef98c97bd511c9929928ceb1668582b", "committedDate": "2020-03-11T14:00:39Z", "message": "add cloudpickle to the NOTICE-binary-PREAMBLE.txt."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDY1OTA5", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-373065909", "createdAt": "2020-03-11T19:37:01Z", "commit": {"oid": "3ede7b0ecef98c97bd511c9929928ceb1668582b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTozNzowMVrOF1F2ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTozNzowMVrOF1F2ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIxNDc1NQ==", "bodyText": "this is BSD licensed based on the python NOTICE", "url": "https://github.com/apache/flink/pull/11238#discussion_r391214755", "createdAt": "2020-03-11T19:37:01Z", "author": {"login": "zentol"}, "path": "tools/releasing/NOTICE-binary_PREAMBLE.txt", "diffHunk": "@@ -12,3 +12,4 @@ This project bundles the following dependencies under the Apache Software Licens\n - org.apache.logging.log4j:log4j-core:2.12.1\n - org.apache.logging.log4j:log4j-slf4j-impl:2.12.1\n - org.apache.logging.log4j:log4j-1.2-api:2.12.1\n+- cloudpickle:1.2.2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ede7b0ecef98c97bd511c9929928ceb1668582b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d180da9a55cbbf11f1c1b6b6dc3a0cbe6a101f4", "author": {"user": {"login": "WeiZhong94", "name": "Wei Zhong"}}, "url": "https://github.com/apache/flink/commit/4d180da9a55cbbf11f1c1b6b6dc3a0cbe6a101f4", "committedDate": "2020-03-12T01:37:27Z", "message": "Add BSD license description to NOTICE-binary_PREAMBLE.txt."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDEzNDg5", "url": "https://github.com/apache/flink/pull/11238#pullrequestreview-373413489", "createdAt": "2020-03-12T09:56:51Z", "commit": {"oid": "4d180da9a55cbbf11f1c1b6b6dc3a0cbe6a101f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3259, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}