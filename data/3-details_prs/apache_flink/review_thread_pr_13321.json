{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4Njk1MTQ4", "number": 13321, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDo1NDozN1rOEhSVBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNTowNzoyMFrOEhSubA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzM4NzU4OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/jobmanager/scheduler/SchedulerTestBase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDo1NDozN1rOHOhHbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNjo0ODowNFrOHOlwqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NDY4Nw==", "bodyText": "Maybe Releasing TaskManager in SlotPool for tests?", "url": "https://github.com/apache/flink/pull/13321#discussion_r484984687", "createdAt": "2020-09-08T14:54:37Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/jobmanager/scheduler/SchedulerTestBase.java", "diffHunk": "@@ -161,7 +161,7 @@ public TaskManagerLocation addTaskManager(int numberSlots) {\n \n \t\tpublic void releaseTaskManager(ResourceID resourceId) {\n \t\t\ttry {\n-\t\t\t\tsupplyInMainThreadExecutor(() -> slotPool.releaseTaskManager(resourceId, null));\n+\t\t\t\tsupplyInMainThreadExecutor(() -> slotPool.releaseTaskManager(resourceId, new Exception(\"Test Exception\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d25691da795ac975151e7021120f7f7a734bc902"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MDc3OA==", "bodyText": "done.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485060778", "createdAt": "2020-09-08T16:48:04Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/jobmanager/scheduler/SchedulerTestBase.java", "diffHunk": "@@ -161,7 +161,7 @@ public TaskManagerLocation addTaskManager(int numberSlots) {\n \n \t\tpublic void releaseTaskManager(ResourceID resourceId) {\n \t\t\ttry {\n-\t\t\t\tsupplyInMainThreadExecutor(() -> slotPool.releaseTaskManager(resourceId, null));\n+\t\t\t\tsupplyInMainThreadExecutor(() -> slotPool.releaseTaskManager(resourceId, new Exception(\"Test Exception\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NDY4Nw=="}, "originalCommit": {"oid": "d25691da795ac975151e7021120f7f7a734bc902"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzQwNjU4OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDo1NzozN1rOHOhTsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODozNzo1NVrOHPpLXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NzgyNQ==", "bodyText": "is it a lot of effort to fix this in tests so that we can remove this check?", "url": "https://github.com/apache/flink/pull/13321#discussion_r484987825", "createdAt": "2020-09-08T14:57:37Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "diffHunk": "@@ -364,25 +365,29 @@ public void addOperatorCoordinator(SerializedValue<OperatorCoordinator.Provider>\n \t * @param grp The slot sharing group to associate the vertex with.\n \t */\n \tpublic void setSlotSharingGroup(SlotSharingGroup grp) {\n+\t\tcheckNotNull(grp);\n+\n \t\tif (this.slotSharingGroup != null) {\n \t\t\tthis.slotSharingGroup.removeVertexFromGroup(this.getID(), this.getMinResources());\n \t\t}\n \n+\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n \t\tthis.slotSharingGroup = grp;\n-\t\tif (grp != null) {\n-\t\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n-\t\t}\n \t}\n \n \t/**\n \t * Gets the slot sharing group that this vertex is associated with. Different vertices in the same\n-\t * slot sharing group can run one subtask each in the same slot. If the vertex is not associated with\n-\t * a slot sharing group, this method returns {@code null}.\n+\t * slot sharing group can run one subtask each in the same slot.\n \t *\n-\t * @return The slot sharing group to associate the vertex with, or {@code null}, if not associated with one.\n+\t * @return The slot sharing group to associate the vertex with\n \t */\n-\t@Nullable\n \tpublic SlotSharingGroup getSlotSharingGroup() {\n+\t\tif (slotSharingGroup == null) {\n+\t\t\t// create a new slot sharing group for this vertex if it was in no other slot sharing group.\n+\t\t\t// this should only happen in testing cases at the moment because production code path will\n+\t\t\t// always set a value to it before used", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf61a096142909d16c02adea86b0f6b3dac76e0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1MjEwMg==", "bodyText": "I think so, there are 200+ usages of JobVertex constructors, distributed in 40+ test classes.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485052102", "createdAt": "2020-09-08T16:33:02Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "diffHunk": "@@ -364,25 +365,29 @@ public void addOperatorCoordinator(SerializedValue<OperatorCoordinator.Provider>\n \t * @param grp The slot sharing group to associate the vertex with.\n \t */\n \tpublic void setSlotSharingGroup(SlotSharingGroup grp) {\n+\t\tcheckNotNull(grp);\n+\n \t\tif (this.slotSharingGroup != null) {\n \t\t\tthis.slotSharingGroup.removeVertexFromGroup(this.getID(), this.getMinResources());\n \t\t}\n \n+\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n \t\tthis.slotSharingGroup = grp;\n-\t\tif (grp != null) {\n-\t\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n-\t\t}\n \t}\n \n \t/**\n \t * Gets the slot sharing group that this vertex is associated with. Different vertices in the same\n-\t * slot sharing group can run one subtask each in the same slot. If the vertex is not associated with\n-\t * a slot sharing group, this method returns {@code null}.\n+\t * slot sharing group can run one subtask each in the same slot.\n \t *\n-\t * @return The slot sharing group to associate the vertex with, or {@code null}, if not associated with one.\n+\t * @return The slot sharing group to associate the vertex with\n \t */\n-\t@Nullable\n \tpublic SlotSharingGroup getSlotSharingGroup() {\n+\t\tif (slotSharingGroup == null) {\n+\t\t\t// create a new slot sharing group for this vertex if it was in no other slot sharing group.\n+\t\t\t// this should only happen in testing cases at the moment because production code path will\n+\t\t\t// always set a value to it before used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NzgyNQ=="}, "originalCommit": {"oid": "bdf61a096142909d16c02adea86b0f6b3dac76e0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ0MTQ1MQ==", "bodyText": "ok, it is a pity that JobVertex is mutable and we do not have a separate builder for JobVertex.\nis this if basically not the same as just initialising slotSharingGroup = new SlotSharingGroup() in the constructor?\nthis should be also inline with the previous behaviour where all vertexes with null-group get into a separate group", "url": "https://github.com/apache/flink/pull/13321#discussion_r485441451", "createdAt": "2020-09-09T08:42:55Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "diffHunk": "@@ -364,25 +365,29 @@ public void addOperatorCoordinator(SerializedValue<OperatorCoordinator.Provider>\n \t * @param grp The slot sharing group to associate the vertex with.\n \t */\n \tpublic void setSlotSharingGroup(SlotSharingGroup grp) {\n+\t\tcheckNotNull(grp);\n+\n \t\tif (this.slotSharingGroup != null) {\n \t\t\tthis.slotSharingGroup.removeVertexFromGroup(this.getID(), this.getMinResources());\n \t\t}\n \n+\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n \t\tthis.slotSharingGroup = grp;\n-\t\tif (grp != null) {\n-\t\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n-\t\t}\n \t}\n \n \t/**\n \t * Gets the slot sharing group that this vertex is associated with. Different vertices in the same\n-\t * slot sharing group can run one subtask each in the same slot. If the vertex is not associated with\n-\t * a slot sharing group, this method returns {@code null}.\n+\t * slot sharing group can run one subtask each in the same slot.\n \t *\n-\t * @return The slot sharing group to associate the vertex with, or {@code null}, if not associated with one.\n+\t * @return The slot sharing group to associate the vertex with\n \t */\n-\t@Nullable\n \tpublic SlotSharingGroup getSlotSharingGroup() {\n+\t\tif (slotSharingGroup == null) {\n+\t\t\t// create a new slot sharing group for this vertex if it was in no other slot sharing group.\n+\t\t\t// this should only happen in testing cases at the moment because production code path will\n+\t\t\t// always set a value to it before used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NzgyNQ=="}, "originalCommit": {"oid": "bdf61a096142909d16c02adea86b0f6b3dac76e0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ0OTE4Nw==", "bodyText": "It's not the same because we need to invoke setSlotSharingGroup() which relies on getMinResources of the vertex.\nThe getMinResources, however, is set after the vertex is constructed.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485449187", "createdAt": "2020-09-09T08:53:58Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "diffHunk": "@@ -364,25 +365,29 @@ public void addOperatorCoordinator(SerializedValue<OperatorCoordinator.Provider>\n \t * @param grp The slot sharing group to associate the vertex with.\n \t */\n \tpublic void setSlotSharingGroup(SlotSharingGroup grp) {\n+\t\tcheckNotNull(grp);\n+\n \t\tif (this.slotSharingGroup != null) {\n \t\t\tthis.slotSharingGroup.removeVertexFromGroup(this.getID(), this.getMinResources());\n \t\t}\n \n+\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n \t\tthis.slotSharingGroup = grp;\n-\t\tif (grp != null) {\n-\t\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n-\t\t}\n \t}\n \n \t/**\n \t * Gets the slot sharing group that this vertex is associated with. Different vertices in the same\n-\t * slot sharing group can run one subtask each in the same slot. If the vertex is not associated with\n-\t * a slot sharing group, this method returns {@code null}.\n+\t * slot sharing group can run one subtask each in the same slot.\n \t *\n-\t * @return The slot sharing group to associate the vertex with, or {@code null}, if not associated with one.\n+\t * @return The slot sharing group to associate the vertex with\n \t */\n-\t@Nullable\n \tpublic SlotSharingGroup getSlotSharingGroup() {\n+\t\tif (slotSharingGroup == null) {\n+\t\t\t// create a new slot sharing group for this vertex if it was in no other slot sharing group.\n+\t\t\t// this should only happen in testing cases at the moment because production code path will\n+\t\t\t// always set a value to it before used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NzgyNQ=="}, "originalCommit": {"oid": "bdf61a096142909d16c02adea86b0f6b3dac76e0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE2NTM0MQ==", "bodyText": "Alright, I agree to consider it as a follow-up cleanup. We can introduce later a non-null SSG check in the getter to see how many tests fail.", "url": "https://github.com/apache/flink/pull/13321#discussion_r486165341", "createdAt": "2020-09-10T08:37:55Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobVertex.java", "diffHunk": "@@ -364,25 +365,29 @@ public void addOperatorCoordinator(SerializedValue<OperatorCoordinator.Provider>\n \t * @param grp The slot sharing group to associate the vertex with.\n \t */\n \tpublic void setSlotSharingGroup(SlotSharingGroup grp) {\n+\t\tcheckNotNull(grp);\n+\n \t\tif (this.slotSharingGroup != null) {\n \t\t\tthis.slotSharingGroup.removeVertexFromGroup(this.getID(), this.getMinResources());\n \t\t}\n \n+\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n \t\tthis.slotSharingGroup = grp;\n-\t\tif (grp != null) {\n-\t\t\tgrp.addVertexToGroup(this.getID(), this.getMinResources());\n-\t\t}\n \t}\n \n \t/**\n \t * Gets the slot sharing group that this vertex is associated with. Different vertices in the same\n-\t * slot sharing group can run one subtask each in the same slot. If the vertex is not associated with\n-\t * a slot sharing group, this method returns {@code null}.\n+\t * slot sharing group can run one subtask each in the same slot.\n \t *\n-\t * @return The slot sharing group to associate the vertex with, or {@code null}, if not associated with one.\n+\t * @return The slot sharing group to associate the vertex with\n \t */\n-\t@Nullable\n \tpublic SlotSharingGroup getSlotSharingGroup() {\n+\t\tif (slotSharingGroup == null) {\n+\t\t\t// create a new slot sharing group for this vertex if it was in no other slot sharing group.\n+\t\t\t// this should only happen in testing cases at the moment because production code path will\n+\t\t\t// always set a value to it before used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4NzgyNQ=="}, "originalCommit": {"oid": "bdf61a096142909d16c02adea86b0f6b3dac76e0"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzQ0NjI1OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/AbstractExecutionSlotAllocatorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNTowNTo0NlrOHOhs2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNjo0Nzo1NlrOHOlwXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NDI2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate ExecutionVertexSchedulingRequirements createSchedulingRequirement(\n          \n          \n            \n            \t\t\tfinal ExecutionVertexID executionVertexId) {\n          \n          \n            \n            \t\treturn createSchedulingRequirement(executionVertexId, null);\n          \n          \n            \n            \t}\n          \n          \n            \n            \tprivate ExecutionVertexSchedulingRequirements createSchedulingRequirement(\n          \n          \n            \n            \t\t\tfinal int subtaskIndex) {\n          \n          \n            \n            \t\treturn createSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), subtaskIndex), null);\n          \n          \n            \n            \t}", "url": "https://github.com/apache/flink/pull/13321#discussion_r484994264", "createdAt": "2020-09-08T15:05:46Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/AbstractExecutionSlotAllocatorTest.java", "diffHunk": "@@ -114,38 +118,30 @@ public void testCompletedExecutionVertexAssignmentWillBeUnregistered() {\n \tpublic void testComputeAllPriorAllocationIds() {\n \t\tfinal List<AllocationID> expectAllocationIds = Arrays.asList(new AllocationID(), new AllocationID());\n \t\tfinal List<ExecutionVertexSchedulingRequirements> testSchedulingRequirements = Arrays.asList(\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(0)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 1)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(0)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 2)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(1)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 3)).\n-\t\t\t\tbuild()\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 0), expectAllocationIds.get(0)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 1), expectAllocationIds.get(0)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 2), expectAllocationIds.get(1)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 3))\n \t\t);\n \n \t\tfinal Set<AllocationID> allPriorAllocationIds =\n \t\t\tAbstractExecutionSlotAllocator.computeAllPriorAllocationIds(testSchedulingRequirements);\n \t\tassertThat(allPriorAllocationIds, containsInAnyOrder(expectAllocationIds.toArray()));\n \t}\n \n-\tprivate List<ExecutionVertexSchedulingRequirements> createSchedulingRequirements(\n-\t\t\tfinal ExecutionVertexID... executionVertexIds) {\n-\n-\t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = new ArrayList<>(executionVertexIds.length);\n+\tprivate ExecutionVertexSchedulingRequirements createSchedulingRequirement(\n+\t\t\tfinal ExecutionVertexID executionVertexId) {\n+\t\treturn createSchedulingRequirement(executionVertexId, null);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2MDcwMw==", "bodyText": "done.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485060703", "createdAt": "2020-09-08T16:47:56Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/AbstractExecutionSlotAllocatorTest.java", "diffHunk": "@@ -114,38 +118,30 @@ public void testCompletedExecutionVertexAssignmentWillBeUnregistered() {\n \tpublic void testComputeAllPriorAllocationIds() {\n \t\tfinal List<AllocationID> expectAllocationIds = Arrays.asList(new AllocationID(), new AllocationID());\n \t\tfinal List<ExecutionVertexSchedulingRequirements> testSchedulingRequirements = Arrays.asList(\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(0)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 1)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(0)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 2)).\n-\t\t\t\twithPreviousAllocationId(expectAllocationIds.get(1)).\n-\t\t\t\tbuild(),\n-\t\t\tnew ExecutionVertexSchedulingRequirements.Builder().\n-\t\t\t\twithExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 3)).\n-\t\t\t\tbuild()\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 0), expectAllocationIds.get(0)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 1), expectAllocationIds.get(0)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 2), expectAllocationIds.get(1)),\n+\t\t\tcreateSchedulingRequirement(new ExecutionVertexID(new JobVertexID(), 3))\n \t\t);\n \n \t\tfinal Set<AllocationID> allPriorAllocationIds =\n \t\t\tAbstractExecutionSlotAllocator.computeAllPriorAllocationIds(testSchedulingRequirements);\n \t\tassertThat(allPriorAllocationIds, containsInAnyOrder(expectAllocationIds.toArray()));\n \t}\n \n-\tprivate List<ExecutionVertexSchedulingRequirements> createSchedulingRequirements(\n-\t\t\tfinal ExecutionVertexID... executionVertexIds) {\n-\n-\t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = new ArrayList<>(executionVertexIds.length);\n+\tprivate ExecutionVertexSchedulingRequirements createSchedulingRequirement(\n+\t\t\tfinal ExecutionVertexID executionVertexId) {\n+\t\treturn createSchedulingRequirement(executionVertexId, null);\n+\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NDI2NA=="}, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzQ1MjYwOnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/OneSlotPerExecutionSlotAllocatorTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNTowNzoyMFrOHOhw4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwODo1Njo1OFrOHO9l3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NTI5OA==", "bodyText": "why not to add new SlotSharingGroupId() as a default value of slotSharingGroupId in ExecutionVertexSchedulingRequirements.Builder?", "url": "https://github.com/apache/flink/pull/13321#discussion_r484995298", "createdAt": "2020-09-08T15:07:20Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/OneSlotPerExecutionSlotAllocatorTest.java", "diffHunk": "@@ -224,6 +224,7 @@ public void testCoLocationConstraintThrowsException() {\n \t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = Collections.singletonList(\n \t\t\tnew ExecutionVertexSchedulingRequirements.Builder()\n \t\t\t\t.withExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0))\n+\t\t\t\t.withSlotSharingGroupId(new SlotSharingGroupId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1ODg4Ng==", "bodyText": "In production code path, a non-null SlotSharingGroupId should always be obtainable from the vertex.\nA random SlotSharingGroupId is only needed in tests so I'd like to avoid to create it here. This is similar to how we deal with ExecutionVertexID.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485058886", "createdAt": "2020-09-08T16:44:45Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/OneSlotPerExecutionSlotAllocatorTest.java", "diffHunk": "@@ -224,6 +224,7 @@ public void testCoLocationConstraintThrowsException() {\n \t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = Collections.singletonList(\n \t\t\tnew ExecutionVertexSchedulingRequirements.Builder()\n \t\t\t\t.withExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0))\n+\t\t\t\t.withSlotSharingGroupId(new SlotSharingGroupId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NTI5OA=="}, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQzNTEyNg==", "bodyText": "ok, a bit strange to have the builder in production code where it is used only once and the builder does not have default values for all fields.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485435126", "createdAt": "2020-09-09T08:33:38Z", "author": {"login": "azagrebin"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/OneSlotPerExecutionSlotAllocatorTest.java", "diffHunk": "@@ -224,6 +224,7 @@ public void testCoLocationConstraintThrowsException() {\n \t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = Collections.singletonList(\n \t\t\tnew ExecutionVertexSchedulingRequirements.Builder()\n \t\t\t\t.withExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0))\n+\t\t\t\t.withSlotSharingGroupId(new SlotSharingGroupId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NTI5OA=="}, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1MTIyOA==", "bodyText": "Agreed. But I think we will be able to drop this builder along with ExecutionVertexSchedulingRequirements when we drops all other ExecutionSlotAllocator except for SlotSharingExecutionSlotAllocator.", "url": "https://github.com/apache/flink/pull/13321#discussion_r485451228", "createdAt": "2020-09-09T08:56:58Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/scheduler/OneSlotPerExecutionSlotAllocatorTest.java", "diffHunk": "@@ -224,6 +224,7 @@ public void testCoLocationConstraintThrowsException() {\n \t\tfinal List<ExecutionVertexSchedulingRequirements> schedulingRequirements = Collections.singletonList(\n \t\t\tnew ExecutionVertexSchedulingRequirements.Builder()\n \t\t\t\t.withExecutionVertexId(new ExecutionVertexID(new JobVertexID(), 0))\n+\t\t\t\t.withSlotSharingGroupId(new SlotSharingGroupId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk5NTI5OA=="}, "originalCommit": {"oid": "f4d7c975180ec4cf13537d67ebcd8fe63ed41525"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 427, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}