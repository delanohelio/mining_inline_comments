{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMjU0ODcw", "number": 13473, "title": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID", "bodyText": "What is the purpose of the change\nAdd JobID to ExecutionAttemptID\nBrief change log\nAdd JobID to ExecutionAttemptID\nVerifying this change\nThis change is already covered by existing tests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: yes\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no", "createdAt": "2020-09-24T07:47:34Z", "url": "https://github.com/apache/flink/pull/13473", "merged": true, "mergeCommit": {"oid": "6e5240f8ac24974826a07b5370908a85bd874ce1"}, "closed": true, "closedAt": "2020-10-01T13:32:37Z", "author": {"login": "KarmaGYZ"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNPEKBAFqTQ5NzI3NDMyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNk9VzABqjM4MTg1MzYzNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3Mjc0MzIz", "url": "https://github.com/apache/flink/pull/13473#pullrequestreview-497274323", "createdAt": "2020-09-28T08:03:52Z", "commit": {"oid": "d871e6519ed5b33b63cf34bf7454649ae19aced8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODowMzo1MlrOHYypsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODowMzo1MlrOHYypsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc1Nzc0NQ==", "bodyText": "need to check not null", "url": "https://github.com/apache/flink/pull/13473#discussion_r495757745", "createdAt": "2020-09-28T08:03:52Z", "author": {"login": "zhuzhurk"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionAttemptID.java", "diffHunk": "@@ -33,31 +36,46 @@\n \n \tprivate static final long serialVersionUID = -1169683445778281344L;\n \n+\tprivate final JobID jobId;\n \tprivate final ExecutionVertexID executionVertexId;\n \tprivate final int attemptNumber;\n \n \t/**\n \t * Get a random execution attempt id.\n \t */\n \tpublic ExecutionAttemptID() {\n-\t\tthis(new ExecutionVertexID(new JobVertexID(), 0), 0);\n+\t\tthis(new JobID(), new ExecutionVertexID(new JobVertexID(), 0), 0);\n \t}\n \n-\tpublic ExecutionAttemptID(ExecutionVertexID executionVertexId, int attemptNumber) {\n+\tpublic ExecutionAttemptID(JobID jobId, ExecutionVertexID executionVertexId, int attemptNumber) {\n \t\tPreconditions.checkState(attemptNumber >= 0);\n+\t\tthis.jobId = jobId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d871e6519ed5b33b63cf34bf7454649ae19aced8"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d871e6519ed5b33b63cf34bf7454649ae19aced8", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/d871e6519ed5b33b63cf34bf7454649ae19aced8", "committedDate": "2020-09-24T06:46:54Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}, "afterCommit": {"oid": "7341f5033aaa850ba9cf20800a3b0c082a20a5bf", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/7341f5033aaa850ba9cf20800a3b0c082a20a5bf", "committedDate": "2020-09-28T08:13:49Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7341f5033aaa850ba9cf20800a3b0c082a20a5bf", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/7341f5033aaa850ba9cf20800a3b0c082a20a5bf", "committedDate": "2020-09-28T08:13:49Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}, "afterCommit": {"oid": "e74c3f4d35222f876456134e4d800611da09c6cf", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/e74c3f4d35222f876456134e4d800611da09c6cf", "committedDate": "2020-09-28T09:39:33Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzU0NTYy", "url": "https://github.com/apache/flink/pull/13473#pullrequestreview-497354562", "createdAt": "2020-09-28T09:48:47Z", "commit": {"oid": "e74c3f4d35222f876456134e4d800611da09c6cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4Mjg3ODU5", "url": "https://github.com/apache/flink/pull/13473#pullrequestreview-498287859", "createdAt": "2020-09-29T09:36:05Z", "commit": {"oid": "ef6232c564a071236900274c014325dcb24c9e97"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwOTozNjowNVrOHZkwnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwOTozNjowNVrOHZkwnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU3ODcxNw==", "bodyText": "I don't see a need for an explicit catch block", "url": "https://github.com/apache/flink/pull/13473#discussion_r496578717", "createdAt": "2020-09-29T09:36:05Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/executiongraph/ExecutionGraphConstructionTest.java", "diffHunk": "@@ -61,6 +66,36 @@ private ExecutionGraph createExecutionGraph() throws Exception {\n \t\treturn TestingExecutionGraphBuilder.newBuilder().build();\n \t}\n \n+\t@Test\n+\tpublic void testExecutionAttemptIdInTwoIdenticalJobsIsNotSame() throws Exception {\n+\t\tJobVertex v1 = new JobVertex(\"vertex1\");\n+\t\tJobVertex v2 = new JobVertex(\"vertex2\");\n+\t\tJobVertex v3 = new JobVertex(\"vertex3\");\n+\n+\t\tv1.setParallelism(5);\n+\t\tv2.setParallelism(7);\n+\t\tv3.setParallelism(2);\n+\n+\t\tv1.setInvokableClass(AbstractInvokable.class);\n+\t\tv2.setInvokableClass(AbstractInvokable.class);\n+\t\tv3.setInvokableClass(AbstractInvokable.class);\n+\n+\t\tList<JobVertex> ordered = new ArrayList<>(Arrays.asList(v1, v2, v3));\n+\n+\t\tExecutionGraph eg1 = createExecutionGraph();\n+\t\tExecutionGraph eg2 = createExecutionGraph();\n+\t\ttry {\n+\t\t\teg1.attachJobGraph(ordered);\n+\t\t\teg2.attachJobGraph(ordered);\n+\t\t}\n+\t\tcatch (JobException e) {\n+\t\t\te.printStackTrace();\n+\t\t\tfail(\"Job failed with exception: \" + e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef6232c564a071236900274c014325dcb24c9e97"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bf412ba5eb808a8307c7c69406712142e81f562", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/4bf412ba5eb808a8307c7c69406712142e81f562", "committedDate": "2020-09-29T09:41:26Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef6232c564a071236900274c014325dcb24c9e97", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/ef6232c564a071236900274c014325dcb24c9e97", "committedDate": "2020-09-29T02:37:20Z", "message": "fixup! [FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}, "afterCommit": {"oid": "4bf412ba5eb808a8307c7c69406712142e81f562", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/4bf412ba5eb808a8307c7c69406712142e81f562", "committedDate": "2020-09-29T09:41:26Z", "message": "[FLINK-19264][runtime] Add JobID to ExecutionAttemptID"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3379, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}