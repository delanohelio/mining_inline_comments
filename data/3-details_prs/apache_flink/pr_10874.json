{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNjgzMTA0", "number": 10874, "title": "[FLINK-15552][table api] parameters --library and --jar doesn't work for DDL in sqlClient", "bodyText": "What is the purpose of the change\nThis pull request use current classloader to load classes which fix parameters --library adn --jar in sqlClient can not play correctly .\nBrief change log\n\nupdate file org/apache/flink/table/factories/TableFactoryService.java\n\nVerifying this change\nThis change is a trivial rework without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): ( no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-01-16T14:46:09Z", "url": "https://github.com/apache/flink/pull/10874", "merged": true, "mergeCommit": {"oid": "338ae70d2468e5951d566b9e55d8dd18a649c9c9"}, "closed": true, "closedAt": "2020-01-23T12:44:53Z", "author": {"login": "leonardBang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb67Lp-AH2gAyMzYzNjgzMTA0OmQ1NWE4MGU5ZGEwNzYwZjRhMWQzOWZmNjBmNTBhYzljYjhlNDA1NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9JpvlgFqTM0NzI2NDc2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d55a80e9da0760f4a1d39ff60f50ac9cb8e40557", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/d55a80e9da0760f4a1d39ff60f50ac9cb8e40557", "committedDate": "2020-01-16T14:39:40Z", "message": "[FLINK-15552][table api] parameters --library and --jar doesn't work for DDL in sqlClient"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MzI3Njg5", "url": "https://github.com/apache/flink/pull/10874#pullrequestreview-344327689", "createdAt": "2020-01-17T02:03:48Z", "commit": {"oid": "d55a80e9da0760f4a1d39ff60f50ac9cb8e40557"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMjowMzo0OFrOFes_eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMjowMzo0OFrOFes_eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczODc0NA==", "bodyText": "We can simplify it a bit more:\n\t\t\tClassLoader cl = classLoader.orElse(Thread.currentThread().getContextClassLoader());\n\t\t\tServiceLoader\n\t\t\t\t.load(TableFactory.class, cl)\n\t\t\t\t.iterator()\n\t\t\t\t.forEachRemaining(result::add);", "url": "https://github.com/apache/flink/pull/10874#discussion_r367738744", "createdAt": "2020-01-17T02:03:48Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/TableFactoryService.java", "diffHunk": "@@ -214,7 +213,10 @@\n \t\t\t\t\t.iterator()\n \t\t\t\t\t.forEachRemaining(result::add);\n \t\t\t} else {\n-\t\t\t\tdefaultLoader.iterator().forEachRemaining(result::add);\n+\t\t\t\tServiceLoader\n+\t\t\t\t\t.load(TableFactory.class, Thread.currentThread().getContextClassLoader())\n+\t\t\t\t\t.iterator()\n+\t\t\t\t\t.forEachRemaining(result::add);\n \t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d55a80e9da0760f4a1d39ff60f50ac9cb8e40557"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c956c947157110421ea2a1f29f1d0d67040875cd", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/c956c947157110421ea2a1f29f1d0d67040875cd", "committedDate": "2020-01-17T08:56:59Z", "message": "1.fix ScalaShellITcase 2. address comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0012c39e883a1d1685dd1f09d08d460370b82151", "author": {"user": {"login": "leonardBang", "name": "Leonard Xu"}}, "url": "https://github.com/apache/flink/commit/0012c39e883a1d1685dd1f09d08d460370b82151", "committedDate": "2020-01-17T10:10:47Z", "message": "fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTc1OTUx", "url": "https://github.com/apache/flink/pull/10874#pullrequestreview-344975951", "createdAt": "2020-01-19T04:17:08Z", "commit": {"oid": "0012c39e883a1d1685dd1f09d08d460370b82151"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQwNDoxNzowOFrOFfNFUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQwNDoxNzowOFrOFfNFUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI2NDUzMA==", "bodyText": "This resets classloader after each tests instead of after class. Because TableFactoryService relies to the correct thread context class loader now. Does this make sense to you @twalthr  @aljoscha  ?", "url": "https://github.com/apache/flink/pull/10874#discussion_r368264530", "createdAt": "2020-01-19T04:17:08Z", "author": {"login": "wuchong"}, "path": "flink-scala-shell/src/test/scala/org/apache/flink/api/scala/ScalaShellITCase.scala", "diffHunk": "@@ -43,6 +43,13 @@ class ScalaShellITCase extends TestLogger {\n   @Rule\n   def temporaryFolder = _temporaryFolder\n \n+  @After\n+  def resetClassLoder(): Unit = {\n+    // The Scala interpreter changes current class loader to ScalaClassLoader in every execution\n+    // refer to [[ILoop.process()]]. So, we need reset it to original class loader after every Test.\n+    Thread.currentThread().setContextClassLoader(classOf[ScalaShellITCase].getClassLoader)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0012c39e883a1d1685dd1f09d08d460370b82151"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjY0NzYw", "url": "https://github.com/apache/flink/pull/10874#pullrequestreview-347264760", "createdAt": "2020-01-23T12:39:03Z", "commit": {"oid": "0012c39e883a1d1685dd1f09d08d460370b82151"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4767, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}