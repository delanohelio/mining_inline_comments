{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NjA5MzE0", "number": 12890, "title": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink", "bodyText": "What is the purpose of the change\nFix index id in ElasticSearch6 DynamicTableSink\nBrief change log\n[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink\nVerifying this change\nThis change is already covered by existing tests\ncc @wuchong", "createdAt": "2020-07-14T02:47:10Z", "url": "https://github.com/apache/flink/pull/12890", "merged": true, "mergeCommit": {"oid": "492c7b0db94798290747f6aea5f0262b8dc012ce"}, "closed": true, "closedAt": "2020-07-14T11:31:27Z", "author": {"login": "KarmaGYZ"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0tBM1gFqTQ0Nzc0OTkyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0ua-7gFqTQ0Nzc3ODgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NzQ5OTI5", "url": "https://github.com/apache/flink/pull/12890#pullrequestreview-447749929", "createdAt": "2020-07-14T02:57:11Z", "commit": {"oid": "b0c78063017af43d2d8bbc8c6655c391d5a841b5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMjo1NzoxMVrOGxCJnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMjo1NzoxMVrOGxCJnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA2ODYzNw==", "bodyText": "Could you update the corresponding test in Elasticsearch7DynamicSinkITCase?", "url": "https://github.com/apache/flink/pull/12890#discussion_r454068637", "createdAt": "2020-07-14T02:57:11Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-elasticsearch6/src/test/java/org/apache/flink/streaming/connectors/elasticsearch/table/Elasticsearch6DynamicSinkITCase.java", "diffHunk": "@@ -226,25 +235,38 @@ public void testWritingDocumentsNoPrimaryKey() throws Exception {\n \t\t\t\t.execute()\n \t\t\t\t.actionGet()\n \t\t\t\t.getHits();\n-\t\t\tif (hits.getTotalHits() < 1) {\n+\t\t\tif (hits.getTotalHits() < 2) {\n \t\t\t\tThread.sleep(200);\n \t\t\t}\n-\t\t} while (hits.getTotalHits() < 1 && deadline.hasTimeLeft());\n+\t\t} while (hits.getTotalHits() < 2 && deadline.hasTimeLeft());\n \n-\t\tif (hits.getTotalHits() < 1) {\n+\t\tif (hits.getTotalHits() < 2) {\n \t\t\tthrow new AssertionError(\"Could not retrieve results from Elasticsearch.\");\n \t\t}\n \n-\t\tMap<String, Object> result = hits.getAt(0).getSourceAsMap();\n-\t\tMap<Object, Object> expectedMap = new HashMap<>();\n-\t\texpectedMap.put(\"a\", 1);\n-\t\texpectedMap.put(\"b\", \"00:00:12\");\n-\t\texpectedMap.put(\"c\", \"ABCDE\");\n-\t\texpectedMap.put(\"d\", 12.12d);\n-\t\texpectedMap.put(\"e\", 2);\n-\t\texpectedMap.put(\"f\", \"2003-10-20\");\n-\t\texpectedMap.put(\"g\", \"2012-12-12 12:12:12\");\n-\t\tassertThat(result, equalTo(expectedMap));\n+\t\tHashSet<Map<String, Object>> resultSet = new HashSet<>();\n+\t\tresultSet.add(hits.getAt(0).getSourceAsMap());\n+\t\tresultSet.add(hits.getAt(1).getSourceAsMap());\n+\t\tMap<Object, Object> expectedMap1 = new HashMap<>();\n+\t\texpectedMap1.put(\"a\", 1);\n+\t\texpectedMap1.put(\"b\", \"00:00:12\");\n+\t\texpectedMap1.put(\"c\", \"ABCDE\");\n+\t\texpectedMap1.put(\"d\", 12.12d);\n+\t\texpectedMap1.put(\"e\", 2);\n+\t\texpectedMap1.put(\"f\", \"2003-10-20\");\n+\t\texpectedMap1.put(\"g\", \"2012-12-12 12:12:12\");\n+\t\tMap<Object, Object> expectedMap2 = new HashMap<>();\n+\t\texpectedMap2.put(\"a\", 2);\n+\t\texpectedMap2.put(\"b\", \"00:00:12\");\n+\t\texpectedMap2.put(\"c\", \"FGHIJK\");\n+\t\texpectedMap2.put(\"d\", 13.13d);\n+\t\texpectedMap2.put(\"e\", 4);\n+\t\texpectedMap2.put(\"f\", \"2003-10-20\");\n+\t\texpectedMap2.put(\"g\", \"2013-12-12 13:13:13\");\n+\t\tHashSet<Map<Object, Object>> expectedSet = new HashSet<>();\n+\t\texpectedSet.add(expectedMap1);\n+\t\texpectedSet.add(expectedMap2);\n+\t\tassertThat(resultSet, equalTo(expectedSet));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0c78063017af43d2d8bbc8c6655c391d5a841b5"}, "originalPosition": 73}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0c78063017af43d2d8bbc8c6655c391d5a841b5", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/b0c78063017af43d2d8bbc8c6655c391d5a841b5", "committedDate": "2020-07-14T02:46:18Z", "message": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink"}, "afterCommit": {"oid": "a5a8f71e4a134075e462f8340ee138adb7ce7836", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/a5a8f71e4a134075e462f8340ee138adb7ce7836", "committedDate": "2020-07-14T03:00:25Z", "message": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "533a66f139697c1fc29441d3d9ccff3da5c82b76", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/533a66f139697c1fc29441d3d9ccff3da5c82b76", "committedDate": "2020-07-14T03:02:25Z", "message": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5a8f71e4a134075e462f8340ee138adb7ce7836", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/a5a8f71e4a134075e462f8340ee138adb7ce7836", "committedDate": "2020-07-14T03:00:25Z", "message": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink"}, "afterCommit": {"oid": "533a66f139697c1fc29441d3d9ccff3da5c82b76", "author": {"user": {"login": "KarmaGYZ", "name": "Yangze Guo"}}, "url": "https://github.com/apache/flink/commit/533a66f139697c1fc29441d3d9ccff3da5c82b76", "committedDate": "2020-07-14T03:02:25Z", "message": "[FLINK-18583] Fix index id in ElasticSearch6 DynamicTableSink"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Nzc4NjU5", "url": "https://github.com/apache/flink/pull/12890#pullrequestreview-447778659", "createdAt": "2020-07-14T04:34:45Z", "commit": {"oid": "533a66f139697c1fc29441d3d9ccff3da5c82b76"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Nzc4ODI1", "url": "https://github.com/apache/flink/pull/12890#pullrequestreview-447778825", "createdAt": "2020-07-14T04:35:15Z", "commit": {"oid": "533a66f139697c1fc29441d3d9ccff3da5c82b76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3162, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}