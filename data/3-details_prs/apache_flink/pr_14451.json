{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzODM5Nzg2", "number": 14451, "title": "[FLINK-20704][table-planner] Some rel data type does not implement th\u2026", "bodyText": "\u2026e digest correctly\nWhat is the purpose of the change\nSome of the rel data types for legacy planner:\n\nGenericRelDataType\nArrayRelDataType\nMapRelDataType\nMultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest ANY.\nBrief change log\n\nFix the digest of GenericRelDataType, ArrayRelDataType, MapRelDataType, MultisetRelDataType\n\nVerifying this change\nNo tests needed.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not documented", "createdAt": "2020-12-22T03:19:20Z", "url": "https://github.com/apache/flink/pull/14451", "merged": true, "mergeCommit": {"oid": "64d9ea339fe6360eb9c59a6fd1946948c2fecbf9"}, "closed": true, "closedAt": "2020-12-31T01:28:24Z", "author": {"login": "danny0405"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoh4npgFqTU1Njc5NDgwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqwj_2gFqTU1OTM1MDQ1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2Nzk0ODA4", "url": "https://github.com/apache/flink/pull/14451#pullrequestreview-556794808", "createdAt": "2020-12-22T03:22:55Z", "commit": {"oid": "ab709c5979a892af8c01e736f85364ecd535788e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab709c5979a892af8c01e736f85364ecd535788e", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/ab709c5979a892af8c01e736f85364ecd535788e", "committedDate": "2020-12-22T03:14:56Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "d4e0d0bf7183c4a4392efe08ad1adcebd36103cc", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/d4e0d0bf7183c4a4392efe08ad1adcebd36103cc", "committedDate": "2020-12-22T07:22:30Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDY0MzY0", "url": "https://github.com/apache/flink/pull/14451#pullrequestreview-557064364", "createdAt": "2020-12-22T13:04:51Z", "commit": {"oid": "d4e0d0bf7183c4a4392efe08ad1adcebd36103cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMzowNDo1MVrOIJ6f0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMzowNDo1MVrOIJ6f0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI2NjUxNA==", "bodyText": "I find the test does not cover the changes. I revert the changes and run the method, all tests are success.", "url": "https://github.com/apache/flink/pull/14451#discussion_r547266514", "createdAt": "2020-12-22T13:04:51Z", "author": {"login": "godfreyhe"}, "path": "flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/calcite/FlinkTypeFactoryTest.scala", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.apache.flink.table.calcite\n+\n+import org.apache.flink.api.scala.typeutils.Types\n+\n+import org.apache.calcite.sql.`type`.SqlTypeName\n+import org.junit.Assert.{assertFalse, assertTrue}\n+import org.junit.Test\n+\n+/** Test cases for [[FlinkTypeFactory]]. */\n+class FlinkTypeFactoryTest {\n+\n+  @Test\n+  def testCanonizeType(): Unit = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e0d0bf7183c4a4392efe08ad1adcebd36103cc"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4e0d0bf7183c4a4392efe08ad1adcebd36103cc", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/d4e0d0bf7183c4a4392efe08ad1adcebd36103cc", "committedDate": "2020-12-22T07:22:30Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "21d75d6c3ae56a159b454726232fa4fb85e43364", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/21d75d6c3ae56a159b454726232fa4fb85e43364", "committedDate": "2020-12-23T04:08:26Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21d75d6c3ae56a159b454726232fa4fb85e43364", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/21d75d6c3ae56a159b454726232fa4fb85e43364", "committedDate": "2020-12-23T04:08:26Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/c747527ef92f6a6b9cbedc907d4acaf04d774192", "committedDate": "2020-12-24T01:56:01Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzE0ODM0", "url": "https://github.com/apache/flink/pull/14451#pullrequestreview-558314834", "createdAt": "2020-12-24T03:05:30Z", "commit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMzowNTozMFrOIK9VRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwMzowNjoxN1rOIK9WKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM2MTU0Mg==", "bodyText": "should use eq instead of == for object equivalence in Scala", "url": "https://github.com/apache/flink/pull/14451#discussion_r548361542", "createdAt": "2020-12-24T03:05:30Z", "author": {"login": "godfreyhe"}, "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/calcite/FlinkTypeFactoryTest.scala", "diffHunk": "@@ -91,4 +94,16 @@ class FlinkTypeFactoryTest {\n     Assert.assertEquals(new DecimalType(38, 5), FlinkTypeSystem.inferAggSumType(5))\n     Assert.assertEquals(new DecimalType(false, 38, 6), FlinkTypeSystem.inferAggAvgType(5))\n   }\n+\n+  @Test\n+  def testCanonizeType(): Unit = {\n+    val typeFactory = FlinkTypeFactory.INSTANCE\n+    val genericTypeInfo = Types.GENERIC(classOf[TestClass])\n+    val genericRelType = typeFactory.createFieldTypeFromLogicalType(new TypeInformationRawType(genericTypeInfo))\n+    val genericRelType2 = typeFactory.createFieldTypeFromLogicalType(new TypeInformationRawType(genericTypeInfo))\n+\n+    assertTrue(\"The type expect to be canonized\", genericRelType == genericRelType2)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM2MTcxMg==", "bodyText": "nit: use toString() ?", "url": "https://github.com/apache/flink/pull/14451#discussion_r548361712", "createdAt": "2020-12-24T03:06:02Z", "author": {"login": "godfreyhe"}, "path": "flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/plan/schema/GenericRelDataType.scala", "diffHunk": "@@ -55,4 +53,10 @@ class GenericRelDataType(\n   override def hashCode(): Int = {\n     typeInfo.hashCode()\n   }\n+\n+  override def isNullable: Boolean = nullable\n+\n+  override def generateTypeString(sb: java.lang.StringBuilder, withDetail: Boolean): Unit = {\n+    sb.append(s\"ANY($typeInfo)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM2MTc3MQ==", "bodyText": "ditto", "url": "https://github.com/apache/flink/pull/14451#discussion_r548361771", "createdAt": "2020-12-24T03:06:17Z", "author": {"login": "godfreyhe"}, "path": "flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/plan/schema/MapRelDataType.scala", "diffHunk": "@@ -46,4 +46,7 @@ class MapRelDataType(\n     Objects.hashCode(keyType, valueType)\n   }\n \n+  override def generateTypeString(sb: java.lang.StringBuilder, withDetail: Boolean): Unit = {\n+    sb.append(s\"MAP($typeInfo)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c747527ef92f6a6b9cbedc907d4acaf04d774192", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/c747527ef92f6a6b9cbedc907d4acaf04d774192", "committedDate": "2020-12-24T01:56:01Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "c87bab456da0d1daeb6efad61d2b9178b4fa88f0", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/c87bab456da0d1daeb6efad61d2b9178b4fa88f0", "committedDate": "2020-12-24T09:11:48Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c87bab456da0d1daeb6efad61d2b9178b4fa88f0", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/c87bab456da0d1daeb6efad61d2b9178b4fa88f0", "committedDate": "2020-12-24T09:11:48Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "573a9ab1bd4b6b68d428b6de6b7700debabfb162", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/573a9ab1bd4b6b68d428b6de6b7700debabfb162", "committedDate": "2020-12-24T13:22:18Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "573a9ab1bd4b6b68d428b6de6b7700debabfb162", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/573a9ab1bd4b6b68d428b6de6b7700debabfb162", "committedDate": "2020-12-24T13:22:18Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDoes not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "22b39c8ed7af195647f9eb507e4147346380ccb8", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/22b39c8ed7af195647f9eb507e4147346380ccb8", "committedDate": "2020-12-25T01:59:35Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22b39c8ed7af195647f9eb507e4147346380ccb8", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/22b39c8ed7af195647f9eb507e4147346380ccb8", "committedDate": "2020-12-25T01:59:35Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "b3976f5cf20bd5a78289cf388c830a1739992bd0", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/b3976f5cf20bd5a78289cf388c830a1739992bd0", "committedDate": "2020-12-28T02:57:08Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MDU4OTk5", "url": "https://github.com/apache/flink/pull/14451#pullrequestreview-559058999", "createdAt": "2020-12-28T09:13:43Z", "commit": {"oid": "b3976f5cf20bd5a78289cf388c830a1739992bd0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwOToxMzo0M1rOIL0-tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwOToxMzo0M1rOIL0-tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3MzI3MQ==", "bodyText": "the change is reverted ?", "url": "https://github.com/apache/flink/pull/14451#discussion_r549273271", "createdAt": "2020-12-28T09:13:43Z", "author": {"login": "godfreyhe"}, "path": "flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/plan/schema/MapRelDataType.scala", "diffHunk": "@@ -45,5 +45,4 @@ class MapRelDataType(\n   override def hashCode(): Int = {\n     Objects.hashCode(keyType, valueType)\n   }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3976f5cf20bd5a78289cf388c830a1739992bd0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9c3ee87fa55ee7a1f7d4848c8a7dc542f2011a6", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/d9c3ee87fa55ee7a1f7d4848c8a7dc542f2011a6", "committedDate": "2020-12-28T09:33:50Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`.\n\nThe MapRelDataType is not fixed because we ignore the key/value\nnullability when creat the type, which conflicts with the digest\nsemantics, see FLINK-20785."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3976f5cf20bd5a78289cf388c830a1739992bd0", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/b3976f5cf20bd5a78289cf388c830a1739992bd0", "committedDate": "2020-12-28T02:57:08Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`."}, "afterCommit": {"oid": "d9c3ee87fa55ee7a1f7d4848c8a7dc542f2011a6", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/flink/commit/d9c3ee87fa55ee7a1f7d4848c8a7dc542f2011a6", "committedDate": "2020-12-28T09:33:50Z", "message": "[FLINK-20704][table-planner] Some rel data type does not implement the digest correctly\n\nSome of the rel data types for legacy planner:\n\n- GenericRelDataType\n- ArrayRelDataType\n- MapRelDataType\n- MultisetRelDataType\n\nDo not implement the digest correctly, especially for\nGenericRelDataType , the RelDataTypeFactory caches the type instances\nbased on its digest, a wrong digest impl would mess up the type instance\ncreation, e.g. without this patch, all the GenericRelDataType instances\nhave same digest `ANY`.\n\nThe MapRelDataType is not fixed because we ignore the key/value\nnullability when creat the type, which conflicts with the digest\nsemantics, see FLINK-20785."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MzUwNDU0", "url": "https://github.com/apache/flink/pull/14451#pullrequestreview-559350454", "createdAt": "2020-12-29T01:36:49Z", "commit": {"oid": "d9c3ee87fa55ee7a1f7d4848c8a7dc542f2011a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3344, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}