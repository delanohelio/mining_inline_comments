{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MDI1MjA3", "number": 13776, "title": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception", "bodyText": "What is the purpose of the change\nFix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception.\nBrief change log\n\nModify SourceReaderBaseTest.testExceptionInSplitReader to assert that SourceReaderBase.pollNext will not return InputStatus.END_OF_INPUT in case of split reader exception.\nMove exceptionHandler from ThrowableCatchingRunnable to SplitFetcher.errorHandler.\nConstruct happens-before relation between SplitFetcher.errorHandler and SplitFetcher.shutdownHook.\nCheck SplitFetcherManager.uncaughtFetcherException before returning InputStatus.END_OF_INPUT.\n\nVerifying this change\nThis change modifies tests and can be verified as follows:\n\nSourceReaderBaseTest.testExceptionInSplitReader\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)", "createdAt": "2020-10-23T15:01:59Z", "url": "https://github.com/apache/flink/pull/13776", "merged": true, "mergeCommit": {"oid": "2cce1aced0d6a311ff0803b773f1565e7f9d76fc"}, "closed": true, "closedAt": "2020-11-09T02:45:59Z", "author": {"login": "kezhuw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdahVLeAFqTUyNTgxMzY4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdakGQegBqjM5NzEwMjk5NTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODEzNjg5", "url": "https://github.com/apache/flink/pull/13776#pullrequestreview-525813689", "createdAt": "2020-11-08T14:36:01Z", "commit": {"oid": "100b67ca171766bec1ff561a66688471b24745be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxNDo0MjozNVrOHvW37g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxNDo0MjozNVrOHvW37g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQxOTg4Ng==", "bodyText": "I am curious. Is there a reason that we replace the ThrowableCatchingRunnable wrapper with the explicit error handler passed to the split fetcher here?", "url": "https://github.com/apache/flink/pull/13776#discussion_r519419886", "createdAt": "2020-11-08T14:42:35Z", "author": {"login": "becketqin"}, "path": "flink-connectors/flink-connector-base/src/main/java/org/apache/flink/connector/base/source/reader/fetcher/SplitFetcherManager.java", "diffHunk": "@@ -112,7 +111,7 @@ public void accept(Throwable t) {\n \tpublic abstract void addSplits(List<SplitT> splitsToAdd);\n \n \tprotected void startFetcher(SplitFetcher<E, SplitT> fetcher) {\n-\t\texecutors.submit(new ThrowableCatchingRunnable(errorHandler, fetcher));\n+\t\texecutors.submit(fetcher);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100b67ca171766bec1ff561a66688471b24745be"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "100b67ca171766bec1ff561a66688471b24745be", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/100b67ca171766bec1ff561a66688471b24745be", "committedDate": "2020-10-23T14:44:18Z", "message": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception"}, "afterCommit": {"oid": "34137c2a23fa01e836a8e990c7094ab7359b37fd", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/34137c2a23fa01e836a8e990c7094ab7359b37fd", "committedDate": "2020-11-08T16:20:42Z", "message": "[hotfix] Throw UnsupportedOperationException for not implemented MockSplitEnumeratorContext.runInCoordinatorThread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9abbb16d8e84c2ef779d578e1c0d33aeca9b7952", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/9abbb16d8e84c2ef779d578e1c0d33aeca9b7952", "committedDate": "2020-11-08T17:59:57Z", "message": "[FLINK-19717][connectors/common] Modify SourceReaderBaseTest.testExceptionInSplitReader to assert not END_OF_INPUT in case of split reader exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34137c2a23fa01e836a8e990c7094ab7359b37fd", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/34137c2a23fa01e836a8e990c7094ab7359b37fd", "committedDate": "2020-11-08T16:20:42Z", "message": "[hotfix] Throw UnsupportedOperationException for not implemented MockSplitEnumeratorContext.runInCoordinatorThread"}, "afterCommit": {"oid": "89580c411718035563019a64bbf178dcb6b739e8", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/89580c411718035563019a64bbf178dcb6b739e8", "committedDate": "2020-11-08T17:59:57Z", "message": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c138c988f40fa5f328f5560750a5ccab744ce279", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/c138c988f40fa5f328f5560750a5ccab744ce279", "committedDate": "2020-11-08T18:02:30Z", "message": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89580c411718035563019a64bbf178dcb6b739e8", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/89580c411718035563019a64bbf178dcb6b739e8", "committedDate": "2020-11-08T17:59:57Z", "message": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception"}, "afterCommit": {"oid": "c138c988f40fa5f328f5560750a5ccab744ce279", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/c138c988f40fa5f328f5560750a5ccab744ce279", "committedDate": "2020-11-08T18:02:30Z", "message": "[FLINK-19717][connectors/common] Fix spurious InputStatus.END_OF_INPUT from SourceReaderBase.pollNext caused by split reader exception"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4802, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}