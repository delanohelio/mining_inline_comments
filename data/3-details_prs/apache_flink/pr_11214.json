{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTY4MDU4", "number": 11214, "title": "[FLINK-16265][table][csv] CsvTableSourceFactoryBase should compare LogicalTypes instead of TableSchema", "bodyText": "What is the purpose of the change\n  - name: TableNumber2\n    type: source\n    $VAR_UPDATE_MODE\n    schema:\n      - name: IntegerField2\n        type: INT\n      - name: StringField2\n        type: VARCHAR\n      - name: TimestampField3\n        type: TIMESTAMP\n    connector:\n      type: filesystem\n      path: \"$VAR_SOURCE_PATH2\"\n    format:\n      type: csv\n      fields:\n        - name: IntegerField2\n          type: INT\n        - name: StringField2\n          type: VARCHAR\n        - name: TimestampField3\n          type: TIMESTAMP\n      line-delimiter: \"\\n\"\n      comment-prefix: \"#\"\n\nTable like this will fail in SQL-CLI.\nThe root cause is we will convert the properties into CatalogTableImpl and then convert into properties again. The schema type properties will use new type systems then which is not equal to the legacy types due to conversion classes.\nBrief change log\nWe should avoid compare TableSchema in CsvTableSourceFactoryBase.createTableSource.\nVerifying this change\nLocalExecutorITCase\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)", "createdAt": "2020-02-25T13:02:24Z", "url": "https://github.com/apache/flink/pull/11214", "merged": true, "mergeCommit": {"oid": "7a283be4093f7258dd33ba13200e32b22fb582ca"}, "closed": true, "closedAt": "2020-02-26T01:59:04Z", "author": {"login": "JingsongLi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHxpIzAH2gAyMzc5NTY4MDU4OmIyNWE1NTE5NTkxYTBjOTk0ZTdjMzBiOGY2YTNlMGI2OTMyOTBjMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH81hbgFqTM2NDU3Njk0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b25a5519591a0c994e7c30b8f6a3e0b693290c12", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/b25a5519591a0c994e7c30b8f6a3e0b693290c12", "committedDate": "2020-02-25T12:53:50Z", "message": "[FLINK-16265][table][csv] CsvTableSourceFactoryBase should compare LogicalTypes instead of TableSchema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTY1ODk5", "url": "https://github.com/apache/flink/pull/11214#pullrequestreview-364165899", "createdAt": "2020-02-25T14:07:21Z", "commit": {"oid": "b25a5519591a0c994e7c30b8f6a3e0b693290c12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDowNzoyMVrOFuHWGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDowNzoyMVrOFuHWGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg5OTE2MQ==", "bodyText": "Maybe we can have a small utility in the class to get the LogicalType List from TableSchema? Then we don't need the long method chain.", "url": "https://github.com/apache/flink/pull/11214#discussion_r383899161", "createdAt": "2020-02-25T14:07:21Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-api-java-bridge/src/main/java/org/apache/flink/table/sources/CsvTableSourceFactoryBase.java", "diffHunk": "@@ -123,7 +126,15 @@ protected CsvTableSource createTableSource(\n \t\t\tTableSchema formatSchema = params.getTableSchema(FORMAT_FIELDS);\n \t\t\t// the CsvTableSource needs some rework first\n \t\t\t// for now the schema must be equal to the encoding\n-\t\t\tif (!formatSchema.equals(tableSchema)) {\n+\t\t\t// Ignore conversion classes in DataType\n+\t\t\tif (!Arrays\n+\t\t\t\t\t.stream(formatSchema.getFieldDataTypes())\n+\t\t\t\t\t.map(DataType::getLogicalType)\n+\t\t\t\t\t.collect(Collectors.toList())\n+\t\t\t\t\t.equals(Arrays\n+\t\t\t\t\t\t\t.stream(tableSchema.getFieldDataTypes())\n+\t\t\t\t\t\t\t.map(DataType::getLogicalType)\n+\t\t\t\t\t\t\t.collect(Collectors.toList()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b25a5519591a0c994e7c30b8f6a3e0b693290c12"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab0c7492448d954d48c789471379d56be3fa44ed", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/ab0c7492448d954d48c789471379d56be3fa44ed", "committedDate": "2020-02-25T14:51:20Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTc2OTQ3", "url": "https://github.com/apache/flink/pull/11214#pullrequestreview-364576947", "createdAt": "2020-02-26T01:56:19Z", "commit": {"oid": "ab0c7492448d954d48c789471379d56be3fa44ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4199, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}