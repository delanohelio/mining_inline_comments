{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MTM4NzQw", "number": 13778, "title": "[FLINK-19791][network][test] Connect to an opened port instead of 8080", "bodyText": "What is the purpose of the change\nA recently added PartitionRequestClientFactoryTest.testInterruptsNotCached fails\nif failure is detected before NetworkClientHandler was obtained.\nThis PR fixes this by connecting to an opened port.\nVerifying this change\nThis change is a test fix without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? no", "createdAt": "2020-10-23T18:29:21Z", "url": "https://github.com/apache/flink/pull/13778", "merged": true, "mergeCommit": {"oid": "0184672733fb2417ca9c23c30f5183bb3dff5dd0"}, "closed": true, "closedAt": "2020-10-26T06:56:00Z", "author": {"login": "rkhachatryan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVbM0agFqTUxNTkyNTA0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWOwr0gFqTUxNjUwMzAxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTI1MDQ1", "url": "https://github.com/apache/flink/pull/13778#pullrequestreview-515925045", "createdAt": "2020-10-23T18:48:23Z", "commit": {"oid": "99697b47cb57cb5a848891bfc23adc3c36f0ff04"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODo0ODoyM1rOHnZ4Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODo1MDo0NVrOHnZ86A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4MDU1MQ==", "bodyText": "Couldn't you leave it as is and just request a ConnectionID from AwaitingNettyClient?", "url": "https://github.com/apache/flink/pull/13778#discussion_r511080551", "createdAt": "2020-10-23T18:48:23Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/PartitionRequestClientFactoryTest.java", "diffHunk": "@@ -61,15 +61,23 @@\n \n \t@Test\n \tpublic void testInterruptsNotCached() throws Exception {\n-\t\tConnectionID connectionId = new ConnectionID(new InetSocketAddress(InetAddress.getLocalHost(), 8080), 0);\n-\t\ttry (AwaitingNettyClient nettyClient = new AwaitingNettyClient()) {\n+\t\tfinal NettyTestUtil.NettyServerAndClient nettyServerAndClient = createNettyServerAndClient();\n+\t\tConnectionID connectionId = new ConnectionID(new InetSocketAddress(\n+\t\t\tnettyServerAndClient.server().getConfig().getServerAddress(),\n+\t\t\tnettyServerAndClient.server().getConfig().getServerPort()),\n+\t\t\t0);\n+\t\ttry {\n+\t\t\tAwaitingNettyClient nettyClient = new AwaitingNettyClient(nettyServerAndClient.client());\n \t\t\tPartitionRequestClientFactory factory = new PartitionRequestClientFactory(nettyClient, 0);\n \n \t\t\tnettyClient.awaitForInterrupts = true;\n \t\t\tconnectAndInterrupt(factory, connectionId);\n \n \t\t\tnettyClient.awaitForInterrupts = false;\n \t\t\tfactory.createPartitionRequestClient(connectionId);\n+\t\t} finally {\n+\t\t\tnettyServerAndClient.client().shutdown();\n+\t\t\tnettyServerAndClient.server().shutdown();\n \t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99697b47cb57cb5a848891bfc23adc3c36f0ff04"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4MDg5Mw==", "bodyText": "Add this commit before the test fix? Then you can use the method directly.", "url": "https://github.com/apache/flink/pull/13778#discussion_r511080893", "createdAt": "2020-10-23T18:49:10Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyTestUtil.java", "diffHunk": "@@ -19,6 +19,7 @@\n package org.apache.flink.runtime.io.network.netty;\n \n import org.apache.flink.configuration.Configuration;\n+import org.apache.flink.runtime.io.network.ConnectionID;\n import org.apache.flink.util.NetUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee77c062d06463064d24b4c5469dfd5bf09f529c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4MTcwNA==", "bodyText": "While the commit message is quite direct, it seems a bit clumsy.\nHow about [refactor][tests][network] Cleanup PartitionRequestClientFactoryTest?", "url": "https://github.com/apache/flink/pull/13778#discussion_r511081704", "createdAt": "2020-10-23T18:50:45Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/PartitionRequestClientFactoryTest.java", "diffHunk": "@@ -131,8 +129,6 @@ public void testNettyClientConnectRetryFailure() throws Exception {\n \n \t\t\tfactory.createPartitionRequestClient(serverAndClient.getConnectionID(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3881f36e07d498a9be32b0bd73c0838b8344dcb7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ab78cc68f6af91be5af6c3ed1813cde2332c5eb", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/3ab78cc68f6af91be5af6c3ed1813cde2332c5eb", "committedDate": "2020-10-23T19:06:10Z", "message": "[tests][network][refactor] Extract NettyServerAndClient.getConnectionID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16653c9e6783e71cfbdd967f6eafcca5807b5d74", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/16653c9e6783e71cfbdd967f6eafcca5807b5d74", "committedDate": "2020-10-23T19:06:10Z", "message": "[FLINK-19791][network][test] Connect to an opened port instead of 8080"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c2228581c8c6b288d9a6e05f43a8f3287b57f8", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/69c2228581c8c6b288d9a6e05f43a8f3287b57f8", "committedDate": "2020-10-23T19:06:57Z", "message": "[refactor][tests][network] Cleanup PartitionRequestClientFactoryTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3881f36e07d498a9be32b0bd73c0838b8344dcb7", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/3881f36e07d498a9be32b0bd73c0838b8344dcb7", "committedDate": "2020-10-23T18:24:26Z", "message": "[tests][network][refactor] Fix IDE warnings"}, "afterCommit": {"oid": "69c2228581c8c6b288d9a6e05f43a8f3287b57f8", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/69c2228581c8c6b288d9a6e05f43a8f3287b57f8", "committedDate": "2020-10-23T19:06:57Z", "message": "[refactor][tests][network] Cleanup PartitionRequestClientFactoryTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTAzMDE0", "url": "https://github.com/apache/flink/pull/13778#pullrequestreview-516503014", "createdAt": "2020-10-26T06:55:25Z", "commit": {"oid": "69c2228581c8c6b288d9a6e05f43a8f3287b57f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4807, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}