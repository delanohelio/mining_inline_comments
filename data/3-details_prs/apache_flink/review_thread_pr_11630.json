{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDY3NjE4", "number": 11630, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoyMDoxNVrODuqzjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoyMTozMFrODuqz1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMjYyNDEyOnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/common_kubernetes.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoyMDoxNVrOGAwKCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoyMDoxNVrOGAwKCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjE4Nw==", "bodyText": "If this also doesn't help, I used these commands for debugging the k8s the last time it was unstable:\nkubectl get pods -o json -n kube-system\nkubectl get pods -o json\nkubectl get events -o json\nkubectl get deployments -o json\nkubectl describe pods\nkubectl describe nodes\nkubectl get nodes -o json", "url": "https://github.com/apache/flink/pull/11630#discussion_r403442187", "createdAt": "2020-04-04T08:20:15Z", "author": {"login": "rmetzger"}, "path": "flink-end-to-end-tests/test-scripts/common_kubernetes.sh", "diffHunk": "@@ -114,10 +114,11 @@ function stop_kubernetes {\n     fi\n }\n \n-function debug_copy_and_show_logs {\n+function debug_and_show_logs {\n     echo \"Debugging failed Kubernetes test:\"\n     echo \"Currently existing Kubernetes resources\"\n     kubectl get all\n+    kubectl describe all", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a9073f279a1bc2bb44352199134c372825cb769"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMjYyNDg2OnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/test_kubernetes_embedded_job.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoyMTozMFrOGAwKaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQxMjoyMjo0NlrOGAxfkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjI4MQ==", "bodyText": "I recently got to know bash traps, which are basically signal handlers.\nYou can do trap debug_and_show_logs EXIT, which will run debug_and_show_logs whenever the script exists.", "url": "https://github.com/apache/flink/pull/11630#discussion_r403442281", "createdAt": "2020-04-04T08:21:30Z", "author": {"login": "rmetzger"}, "path": "flink-end-to-end-tests/test-scripts/test_kubernetes_embedded_job.sh", "diffHunk": "@@ -49,7 +54,4 @@ kubectl wait --for=condition=complete job/flink-job-cluster --timeout=1h\n kubectl cp `kubectl get pods | awk '/task-manager/ {print $1}'`:/cache/${OUTPUT_FILE} ${OUTPUT_VOLUME}/${OUTPUT_FILE}\n \n check_result_hash \"WordCount\" ${OUTPUT_VOLUME}/${OUTPUT_FILE} \"${RESULT_HASH}\"\n-\n-if [ $? != 0 ];then\n-  debug_copy_and_show_logs\n-fi\n+SUCCEEDED=$?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a9073f279a1bc2bb44352199134c372825cb769"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ2Mjc0Ng==", "bodyText": "We have already use the on_exit cleanup in common_kubernetes.sh. So i put the debug_and_show_logs in cleanup, it will always be called before the script exits.", "url": "https://github.com/apache/flink/pull/11630#discussion_r403462746", "createdAt": "2020-04-04T12:08:13Z", "author": {"login": "wangyang0918"}, "path": "flink-end-to-end-tests/test-scripts/test_kubernetes_embedded_job.sh", "diffHunk": "@@ -49,7 +54,4 @@ kubectl wait --for=condition=complete job/flink-job-cluster --timeout=1h\n kubectl cp `kubectl get pods | awk '/task-manager/ {print $1}'`:/cache/${OUTPUT_FILE} ${OUTPUT_VOLUME}/${OUTPUT_FILE}\n \n check_result_hash \"WordCount\" ${OUTPUT_VOLUME}/${OUTPUT_FILE} \"${RESULT_HASH}\"\n-\n-if [ $? != 0 ];then\n-  debug_copy_and_show_logs\n-fi\n+SUCCEEDED=$?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjI4MQ=="}, "originalCommit": {"oid": "9a9073f279a1bc2bb44352199134c372825cb769"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ2NDA4MQ==", "bodyText": "True. You could register on_exit debug_and_show_logs before sourcing common_kubernetes.sh.\nBut I'm fine with your solution. I just wanted to mention it so that you know it exists :)", "url": "https://github.com/apache/flink/pull/11630#discussion_r403464081", "createdAt": "2020-04-04T12:22:46Z", "author": {"login": "rmetzger"}, "path": "flink-end-to-end-tests/test-scripts/test_kubernetes_embedded_job.sh", "diffHunk": "@@ -49,7 +54,4 @@ kubectl wait --for=condition=complete job/flink-job-cluster --timeout=1h\n kubectl cp `kubectl get pods | awk '/task-manager/ {print $1}'`:/cache/${OUTPUT_FILE} ${OUTPUT_VOLUME}/${OUTPUT_FILE}\n \n check_result_hash \"WordCount\" ${OUTPUT_VOLUME}/${OUTPUT_FILE} \"${RESULT_HASH}\"\n-\n-if [ $? != 0 ];then\n-  debug_copy_and_show_logs\n-fi\n+SUCCEEDED=$?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjI4MQ=="}, "originalCommit": {"oid": "9a9073f279a1bc2bb44352199134c372825cb769"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 630, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}