{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1MjMzMzI0", "number": 13925, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyMDoyNVrOE1g1Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyNzozMFrOE1g7EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTQ3ODYyOnYy", "diffSide": "LEFT", "path": "docs/dev/table/connectors/formats/csv.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyMDoyNVrOHt078A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyMDoyNVrOHt078A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNTI4MA==", "bodyText": "Move this notes to {{field-delimiter}} option.", "url": "https://github.com/apache/flink/pull/13925#discussion_r517815280", "createdAt": "2020-11-05T06:20:25Z", "author": {"login": "wuchong"}, "path": "docs/dev/table/connectors/formats/csv.md", "diffHunk": "@@ -95,18 +95,6 @@ Format Options\n       <td>String</td>\n       <td>Field delimiter character (<code>','</code> by default).</td>\n     </tr>\n-    <tr>\n-      <td><h5>csv.line-delimiter</h5></td>\n-      <td>optional</td>\n-      <td style=\"word-wrap: break-word;\"><code>\\n</code></td>\n-      <td>String</td>\n-      <td>Line delimiter, <code>\\n</code> by default. Note the <code>\\n</code> and <code>\\r</code> are invisible special characters, you have to use unicode to specify them in plain SQL.\n-          <ul>\n-           <li>e.g. <code>'csv.line-delimiter' = U&'\\000D'</code> specifies the to use carriage return <code>\\r</code> as line delimiter.</li>\n-           <li>e.g. <code>'csv.line-delimiter' = U&'\\000A'</code> specifies the to use line feed <code>\\n</code> as line delimiter.</li>\n-          </ul>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTQ4NTMzOnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvFileSystemFormatFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyMzozMFrOHt0_3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyMzozMFrOHt0_3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNjI4Ng==", "bodyText": "Why we hard code \\n ? I think the purpose of this issue is removing the \"\\n\".", "url": "https://github.com/apache/flink/pull/13925#discussion_r517816286", "createdAt": "2020-11-05T06:23:30Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvFileSystemFormatFactory.java", "diffHunk": "@@ -194,7 +186,12 @@ private CsvSchema buildCsvSchema(RowType rowType, ReadableConfig options) {\n \n \t\tfinal CsvRowDataSerializationSchema serializationSchema = builder.build();\n \n-\t\treturn Optional.of((record, stream) -> stream.write(serializationSchema.serialize(record)));\n+\t\treturn Optional.of((record, stream) -> {\n+\t\t\tStringBuilder sb = new StringBuilder();\n+\t\t\tsb.append(new String(serializationSchema.serialize(record)));\n+\t\t\tsb.append(\"\\n\");\n+\t\t\tstream.write(sb.toString().getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTQ5MzE5OnYy", "diffSide": "LEFT", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowFormatFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyNzoxMFrOHt1Epg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyNzoxMFrOHt1Epg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNzUxMA==", "bodyText": "I would recommend not changing the legacy csv format.", "url": "https://github.com/apache/flink/pull/13925#discussion_r517817510", "createdAt": "2020-11-05T06:27:10Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowFormatFactory.java", "diffHunk": "@@ -101,9 +100,6 @@ public CsvRowFormatFactory() {\n \t\tdescriptorProperties.getOptionalCharacter(CsvValidator.FORMAT_FIELD_DELIMITER)\n \t\t\t.ifPresent(schemaBuilder::setFieldDelimiter);\n \n-\t\tdescriptorProperties.getOptionalString(CsvValidator.FORMAT_LINE_DELIMITER)\n-\t\t\t.ifPresent(schemaBuilder::setLineDelimiter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTQ5MzkyOnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowSerializationSchema.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyNzozMFrOHt1FEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNjoyNzozMFrOHt1FEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNzYxOQ==", "bodyText": "ditto. I would recommend not changing the legacy csv format.", "url": "https://github.com/apache/flink/pull/13925#discussion_r517817619", "createdAt": "2020-11-05T06:27:30Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowSerializationSchema.java", "diffHunk": "@@ -86,8 +86,8 @@ private CsvRowSerializationSchema(\n \t\tthis.typeInfo = typeInfo;\n \t\tthis.runtimeConverter = createRowRuntimeConverter(typeInfo, true);\n \t\tthis.csvMapper = new CsvMapper();\n-\t\tthis.csvSchema = csvSchema;\n-\t\tthis.objectWriter = csvMapper.writer(csvSchema);\n+\t\tthis.csvSchema = csvSchema.withLineSeparator(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4926, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}