{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzU1ODY2", "number": 13101, "title": "[FLINK-18867][hive] Generic table stored in Hive catalog is incompati\u2026", "bodyText": "\u2026ble between 1.10 and 1.11\n\nWhat is the purpose of the change\nFix the issue that tables created in 1.10 cannot be accessed in 1.11.\nBrief change log\n\nTry both new and old key when retrieving table schema from the properties.\n\nVerifying this change\nManually verified.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? NA", "createdAt": "2020-08-10T08:31:39Z", "url": "https://github.com/apache/flink/pull/13101", "merged": true, "mergeCommit": {"oid": "47bf0aa39079dd1167f6306854490b38406903fb"}, "closed": true, "closedAt": "2020-08-13T04:11:01Z", "author": {"login": "lirui-apache"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9usNXgFqTQ2NDczMjIwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-YDC1AFqTQ2NjQzMDk5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzMyMjA3", "url": "https://github.com/apache/flink/pull/13101#pullrequestreview-464732207", "createdAt": "2020-08-11T03:59:23Z", "commit": {"oid": "52a3dda64175007c4eb7b0d24edb71d95ccdaebf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMzo1OToyM1rOG-nh-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMzo1OToyM1rOG-nh-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxMjU3MA==", "bodyText": "Can we add tests for all types and watermarks and computed columns?", "url": "https://github.com/apache/flink/pull/13101#discussion_r468312570", "createdAt": "2020-08-11T03:59:23Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/catalog/hive/HiveCatalogGenericMetadataTest.java", "diffHunk": "@@ -65,6 +69,43 @@ public void testGenericTableSchema() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testTableSchemaCompatibility() throws Exception {\n+\t\tcatalog.createDatabase(db1, createDb(), false);\n+\t\tObjectPath tablePath = new ObjectPath(db1, \"generic110\");\n+\n+\t\t// create a table with old schema properties\n+\t\tTable hiveTable = org.apache.hadoop.hive.ql.metadata.Table.getEmptyTable(tablePath.getDatabaseName(),\n+\t\t\t\ttablePath.getObjectName());\n+\t\t// create table generic110 (c char(265), vc varchar(65536), ts timestamp(3), watermark for ts as ts)\n+\t\thiveTable.setDbName(tablePath.getDatabaseName());\n+\t\thiveTable.setTableName(tablePath.getObjectName());\n+\t\thiveTable.getParameters().put(CatalogConfig.IS_GENERIC, \"true\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52a3dda64175007c4eb7b0d24edb71d95ccdaebf"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzMyNjMy", "url": "https://github.com/apache/flink/pull/13101#pullrequestreview-464732632", "createdAt": "2020-08-11T04:00:57Z", "commit": {"oid": "52a3dda64175007c4eb7b0d24edb71d95ccdaebf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDowMDo1N1rOG-njiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDowMDo1N1rOG-njiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxMjk3MQ==", "bodyText": "Can add a comments: NOTE: Do not modify this test, it is important to forward compatibility..", "url": "https://github.com/apache/flink/pull/13101#discussion_r468312971", "createdAt": "2020-08-11T04:00:57Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/catalog/hive/HiveCatalogGenericMetadataTest.java", "diffHunk": "@@ -65,6 +69,43 @@ public void testGenericTableSchema() throws Exception {\n \t\t}\n \t}\n \n+\t@Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52a3dda64175007c4eb7b0d24edb71d95ccdaebf"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzMyODE0", "url": "https://github.com/apache/flink/pull/13101#pullrequestreview-464732814", "createdAt": "2020-08-11T04:01:36Z", "commit": {"oid": "52a3dda64175007c4eb7b0d24edb71d95ccdaebf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f27468b909083982fb67ae622c7fc19bb8d7bda", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/6f27468b909083982fb67ae622c7fc19bb8d7bda", "committedDate": "2020-08-12T04:17:01Z", "message": "[FLINK-18867][hive] Generic table stored in Hive catalog is incompatible between 1.10 and 1.11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef0229eb02141a237275ff939fe1eadbfab4b56", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/9ef0229eb02141a237275ff939fe1eadbfab4b56", "committedDate": "2020-08-12T04:17:01Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "949eed92f0f0b4ab3a05f54d63ed8abd3e9a8aa0", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/949eed92f0f0b4ab3a05f54d63ed8abd3e9a8aa0", "committedDate": "2020-08-12T04:17:01Z", "message": "add more test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eceed6165aa76b70b26af967197050bbacc36071", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/eceed6165aa76b70b26af967197050bbacc36071", "committedDate": "2020-08-12T04:17:35Z", "message": "checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67fc735a1a30337f7816b15e12b9c692c2769835", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/67fc735a1a30337f7816b15e12b9c692c2769835", "committedDate": "2020-08-11T12:00:04Z", "message": "add more test"}, "afterCommit": {"oid": "eceed6165aa76b70b26af967197050bbacc36071", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/eceed6165aa76b70b26af967197050bbacc36071", "committedDate": "2020-08-12T04:17:35Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NDMwOTkw", "url": "https://github.com/apache/flink/pull/13101#pullrequestreview-466430990", "createdAt": "2020-08-13T04:10:26Z", "commit": {"oid": "eceed6165aa76b70b26af967197050bbacc36071"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2848, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}