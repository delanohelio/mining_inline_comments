{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNDIzNjk4", "number": 14316, "title": "[FLINK-20470]MissingNode can't be casted to ObjectNode when deserializing JSON", "bodyText": "What is the purpose of the change\nadd check for MissingNode when deserializing JSON\nBrief change log\n\nadd check for MissingNode when deserializing JSON\n\nVerifying this change\nThis change added tests and can be verified as follows:\n(example:)\n\ntestDeserializationMissingNode\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)no\nThe serializers: (yes / no / don't know)no\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)no\nThe S3 file system connector: (yes / no / don't know)no\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)no\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)no", "createdAt": "2020-12-07T06:46:17Z", "url": "https://github.com/apache/flink/pull/14316", "merged": true, "mergeCommit": {"oid": "29e122d539caebe9dd5717439eda12b252e26d41"}, "closed": true, "closedAt": "2020-12-09T05:35:49Z", "author": {"login": "zhuxiaoshang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjvvdvAH2gAyNTMzNDIzNjk4OmIyYmExNmNmOTk4YjMxZWM1MmMyYmYwZWJkMWJlOGQ1MzlhYWZiOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkX_JfAFqTU0Nzg0OTE0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2ba16cf998b31ec52c2bf0ebd1be8d539aafb98", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/b2ba16cf998b31ec52c2bf0ebd1be8d539aafb98", "committedDate": "2020-12-07T06:41:58Z", "message": "[FLINK-20470]MissingNode can't be casted to ObjectNode when deserializing JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1OTQ0MTEy", "url": "https://github.com/apache/flink/pull/14316#pullrequestreview-545944112", "createdAt": "2020-12-07T09:00:30Z", "commit": {"oid": "b2ba16cf998b31ec52c2bf0ebd1be8d539aafb98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOTowMDozMFrOIAcU0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOTowMDozMFrOIAcU0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMzNDk5NQ==", "bodyText": "I think this is a little hack. This can't handle nested types. Would be better fix this in org.apache.flink.formats.json.JsonToRowDataConverters#wrapIntoNullableConverter. And call JsonToRowDataConverters#createConverter in the constructor.", "url": "https://github.com/apache/flink/pull/14316#discussion_r537334995", "createdAt": "2020-12-07T09:00:30Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowDataDeserializationSchema.java", "diffHunk": "@@ -101,6 +102,9 @@ public JsonRowDataDeserializationSchema(\n \tpublic RowData deserialize(byte[] message) throws IOException {\n \t\ttry {\n \t\t\tfinal JsonNode root = objectMapper.readTree(message);\n+\t\t\tif (root instanceof MissingNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2ba16cf998b31ec52c2bf0ebd1be8d539aafb98"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fae69d73f9811547cf17e4e7308b09b00903543", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/5fae69d73f9811547cf17e4e7308b09b00903543", "committedDate": "2020-12-08T12:17:56Z", "message": "[FLINK-20470]MissingNode can't be casted to ObjectNode when deserializing JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjQ0NDIz", "url": "https://github.com/apache/flink/pull/14316#pullrequestreview-547244423", "createdAt": "2020-12-08T13:43:13Z", "commit": {"oid": "5fae69d73f9811547cf17e4e7308b09b00903543"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0MzoxM1rOIBcUMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMzo0MzoxM1rOIBcUMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM4MzQxMQ==", "bodyText": "Would be better to use jsonNode.isMissingNode() here.", "url": "https://github.com/apache/flink/pull/14316#discussion_r538383411", "createdAt": "2020-12-08T13:43:13Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonToRowDataConverters.java", "diffHunk": "@@ -368,7 +369,7 @@ private Object convertField(\n \tprivate JsonToRowDataConverter wrapIntoNullableConverter(\n \t\tJsonToRowDataConverter converter) {\n \t\treturn jsonNode -> {\n-\t\t\tif (jsonNode == null || jsonNode.isNull()) {\n+\t\t\tif (jsonNode == null || jsonNode.isNull() || jsonNode instanceof MissingNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fae69d73f9811547cf17e4e7308b09b00903543"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5073f89f42332ed059ff9c8f88d55f33790d6215", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/5073f89f42332ed059ff9c8f88d55f33790d6215", "committedDate": "2020-12-08T16:24:31Z", "message": "[FLINK-20470]MissingNode can't be casted to ObjectNode when deserializing JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODQ5MTQ4", "url": "https://github.com/apache/flink/pull/14316#pullrequestreview-547849148", "createdAt": "2020-12-09T05:35:18Z", "commit": {"oid": "5073f89f42332ed059ff9c8f88d55f33790d6215"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3929, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}