{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4OTI5MzQ4", "number": 13771, "title": "[FLINK-19789][hive] Migrate Hive connector to new table source sink interface", "bodyText": "What is the purpose of the change\nMigrate Hive connector to new table source sink interface\nBrief change log\n\nRemove HiveTableFactory Hive logical\nImplement Hive table source/sink logical in HiveDynamicTableFactory\nModify HiveTableSource\nModify HiveTableSink\n\nVerifying this change\nThis change is already covered by existing tests\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no", "createdAt": "2020-10-23T12:21:17Z", "url": "https://github.com/apache/flink/pull/13771", "merged": true, "mergeCommit": {"oid": "0a14ad1cc47c4c6d4de0d5c90d3cd9578ca2536c"}, "closed": true, "closedAt": "2020-10-28T01:54:13Z", "author": {"login": "JingsongLi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVhUBhgBqjM5MTYyMTM4MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWnUIFgFqTUxNzYwMjAzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03bad16b2027912ba61be7bf02b97c5503fa3141", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/03bad16b2027912ba61be7bf02b97c5503fa3141", "committedDate": "2020-10-23T12:19:03Z", "message": "[FLINK-19789][hive] Migrate Hive connector to new table source sink interface"}, "afterCommit": {"oid": "e5442954ffac19a92ba1f9a4620584e61acb601a", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/e5442954ffac19a92ba1f9a4620584e61acb601a", "committedDate": "2020-10-24T01:58:10Z", "message": "Rebase&Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad11b74a07505a1074e060977f46c485de64ae8a", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/ad11b74a07505a1074e060977f46c485de64ae8a", "committedDate": "2020-10-26T03:04:36Z", "message": "[FLINK-19789][hive] Migrate Hive connector to new table source sink interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd404bb2fa589808d0c8b18c84fcae8da2a9c96", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/7dd404bb2fa589808d0c8b18c84fcae8da2a9c96", "committedDate": "2020-10-26T03:04:37Z", "message": "Rebase&Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cb29bdf576ab721181dcf526e0ec1575971ee33", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/7cb29bdf576ab721181dcf526e0ec1575971ee33", "committedDate": "2020-10-26T04:08:11Z", "message": "Fix cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5442954ffac19a92ba1f9a4620584e61acb601a", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/e5442954ffac19a92ba1f9a4620584e61acb601a", "committedDate": "2020-10-24T01:58:10Z", "message": "Rebase&Fix"}, "afterCommit": {"oid": "7cb29bdf576ab721181dcf526e0ec1575971ee33", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/7cb29bdf576ab721181dcf526e0ec1575971ee33", "committedDate": "2020-10-26T04:08:11Z", "message": "Fix cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "625bb55bba2c6febed70a805ffddef883b736dbc", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/625bb55bba2c6febed70a805ffddef883b736dbc", "committedDate": "2020-10-26T04:57:04Z", "message": "Fix partition pruning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed12105171506a6cca4dfba4a228ded0d8215c2e", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/ed12105171506a6cca4dfba4a228ded0d8215c2e", "committedDate": "2020-10-26T06:30:06Z", "message": "Revert no need changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NDk2NzYw", "url": "https://github.com/apache/flink/pull/13771#pullrequestreview-516496760", "createdAt": "2020-10-26T06:38:02Z", "commit": {"oid": "625bb55bba2c6febed70a805ffddef883b736dbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNjozODowMlrOHoCVwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNjozODowMlrOHoCVwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0MzQyNA==", "bodyText": "Unused field remainingPartitions", "url": "https://github.com/apache/flink/pull/13771#discussion_r511743424", "createdAt": "2020-10-26T06:38:02Z", "author": {"login": "fsk119"}, "path": "flink-table/flink-table-planner-blink/src/main/java/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRule.java", "diffHunk": "@@ -239,46 +239,40 @@ public RexNode visitInputRef(RexInputRef inputRef) {\n \t\t// get partitions from table/catalog and prune\n \t\tOptional<Catalog> catalogOptional = context.getCatalogManager().getCatalog(tableSourceTable.tableIdentifier().getCatalogName());\n \t\tList<Map<String, String>> remainingPartitions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "625bb55bba2c6febed70a805ffddef883b736dbc"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed42b2dd882c30eff6a0dc3f5e8cf5546958448", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/2ed42b2dd882c30eff6a0dc3f5e8cf5546958448", "committedDate": "2020-10-26T06:55:04Z", "message": "Address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTA0MzI4", "url": "https://github.com/apache/flink/pull/13771#pullrequestreview-517504328", "createdAt": "2020-10-27T09:35:26Z", "commit": {"oid": "2ed42b2dd882c30eff6a0dc3f5e8cf5546958448"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTozNToyNlrOHoy5lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTozNToyNlrOHoy5lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzOTAyOA==", "bodyText": "Should we report error for the else branch ?", "url": "https://github.com/apache/flink/pull/13771#discussion_r512539028", "createdAt": "2020-10-27T09:35:26Z", "author": {"login": "danny0405"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveTableSource.java", "diffHunk": "@@ -346,63 +329,30 @@ private TableSchema getProducedTableSchema() {\n \t}\n \n \t@Override\n-\tpublic boolean isLimitPushedDown() {\n-\t\treturn isLimitPushDown;\n+\tpublic void applyLimit(long limit) {\n+\t\tthis.limit = limit;\n \t}\n \n \t@Override\n-\tpublic TableSource<RowData> applyLimit(long limit) {\n-\t\treturn new HiveTableSource(\n-\t\t\t\tjobConf,\n-\t\t\t\tflinkConf,\n-\t\t\t\ttablePath,\n-\t\t\t\tcatalogTable,\n-\t\t\t\tremainingPartitions,\n-\t\t\t\thiveVersion,\n-\t\t\t\tpartitionPruned,\n-\t\t\t\tprojectedFields,\n-\t\t\t\ttrue,\n-\t\t\t\tlimit);\n+\tpublic Optional<List<Map<String, String>>> listPartitions() {\n+\t\treturn Optional.empty();\n \t}\n \n \t@Override\n-\tpublic List<Map<String, String>> getPartitions() {\n-\t\tthrow new UnsupportedOperationException(\n-\t\t\t\t\"Please use Catalog API to retrieve all partitions of a table\");\n+\tpublic void applyPartitions(List<Map<String, String>> remainingPartitions) {\n+\t\tif (catalogTable.getPartitionKeys() != null && catalogTable.getPartitionKeys().size() != 0) {\n+\t\t\tthis.remainingPartitions = remainingPartitions;\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ed42b2dd882c30eff6a0dc3f5e8cf5546958448"}, "originalPosition": 193}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9680240b60dbc74b3e0b53ddf9a5f605e4042c89", "author": {"user": {"login": "JingsongLi", "name": "Jingsong Lee"}}, "url": "https://github.com/apache/flink/commit/9680240b60dbc74b3e0b53ddf9a5f605e4042c89", "committedDate": "2020-10-27T10:41:42Z", "message": "Address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjAyMDMz", "url": "https://github.com/apache/flink/pull/13771#pullrequestreview-517602033", "createdAt": "2020-10-27T11:31:51Z", "commit": {"oid": "9680240b60dbc74b3e0b53ddf9a5f605e4042c89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4781, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}