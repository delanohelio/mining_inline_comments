{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MzgxNjE5", "number": 11096, "title": "[FLINK-16056][runtime][tests] fix CFRO creation in tests", "bodyText": "What is the purpose of the change\nContinuousFileReaderOperator was changed recently to be created using factory. But some tests create it using constructor directly. This causes problems with deserialization.\nBrief change log\n\nfix test to actually fail on exception - previously error was only logged\nuse factory in tests\nremove testing constructor\nmake class package-private\n\nVerifying this change\nThis change is already covered by existing tests: ContinuousFileProcessingITCase, ContinuousFileProcessingMigrationTest, ContinuousFileProcessingTest.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable", "createdAt": "2020-02-14T13:11:41Z", "url": "https://github.com/apache/flink/pull/11096", "merged": true, "mergeCommit": {"oid": "bc0466b8af5a17f734148bda3b8bacc200cf8418"}, "closed": true, "closedAt": "2020-02-18T14:13:32Z", "author": {"login": "rkhachatryan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEPgMPgBqjMwMzg3MTg0NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFile4gFqTM2MDM2ODY2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95adc7d325935a50f3f2c50604cf1f13fe578e18", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/95adc7d325935a50f3f2c50604cf1f13fe578e18", "committedDate": "2020-02-14T13:03:29Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}, "afterCommit": {"oid": "6f1f37ee8baceee6d08b4c4d2439d46f2c144688", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/6f1f37ee8baceee6d08b4c4d2439d46f2c144688", "committedDate": "2020-02-14T13:25:24Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTk0MTQz", "url": "https://github.com/apache/flink/pull/11096#pullrequestreview-358994143", "createdAt": "2020-02-14T14:52:04Z", "commit": {"oid": "42cb3bf3fb7e78c0525d330c6289861601d68ba6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNDo1MjowNFrOFp5GWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNDo1MjowNFrOFp5GWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3MTQ1MA==", "bodyText": "should that also complete future?", "url": "https://github.com/apache/flink/pull/11096#discussion_r379471450", "createdAt": "2020-02-14T14:52:04Z", "author": {"login": "AHeise"}, "path": "flink-fs-tests/src/test/java/org/apache/flink/hdfstests/ContinuousFileProcessingITCase.java", "diffHunk": "@@ -140,29 +141,25 @@ public void testProgram() throws Exception {\n \t\tTestingSinkFunction sink = new TestingSinkFunction();\n \t\tcontent.addSink(sink).setParallelism(1);\n \n-\t\tThread job = new Thread() {\n-\n-\t\t\t@Override\n-\t\t\tpublic void run() {\n-\t\t\t\ttry {\n-\t\t\t\t\tenv.execute(\"ContinuousFileProcessingITCase Job.\");\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tThrowable th = e;\n-\t\t\t\t\tfor (int depth = 0; depth < 20; depth++) {\n-\t\t\t\t\t\tif (th instanceof SuccessException) {\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t} else if (th.getCause() != null) {\n-\t\t\t\t\t\t\tth = th.getCause();\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n+\t\tCompletableFuture<Void> jobFuture = new CompletableFuture<>();\n+\t\tnew Thread(() -> {\n+\t\t\ttry {\n+\t\t\t\tenv.execute(\"ContinuousFileProcessingITCase Job.\");\n+\t\t\t\tjobFuture.complete(null);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tThrowable th = e;\n+\t\t\t\tfor (int depth = 0; depth < 20; depth++) {\n+\t\t\t\t\tif (th instanceof SuccessException) {\n+\t\t\t\t\t\treturn;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42cb3bf3fb7e78c0525d330c6289861601d68ba6"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dba3ab8494396950450c3a94d1a215c19783b70", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/0dba3ab8494396950450c3a94d1a215c19783b70", "committedDate": "2020-02-14T17:05:09Z", "message": "[FLINK-16056][runtime][tests] do fail ContinuousFileProcessingITCase on failure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f1f37ee8baceee6d08b4c4d2439d46f2c144688", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/6f1f37ee8baceee6d08b4c4d2439d46f2c144688", "committedDate": "2020-02-14T13:25:24Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}, "afterCommit": {"oid": "f65641913b8e78475a174d4c45fcf6720324e894", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/f65641913b8e78475a174d4c45fcf6720324e894", "committedDate": "2020-02-14T17:05:09Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f65641913b8e78475a174d4c45fcf6720324e894", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/f65641913b8e78475a174d4c45fcf6720324e894", "committedDate": "2020-02-14T17:05:09Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}, "afterCommit": {"oid": "34ac6e03b86281ba56a4108f0f713f7a769b1291", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/34ac6e03b86281ba56a4108f0f713f7a769b1291", "committedDate": "2020-02-14T19:52:47Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjAzNzQw", "url": "https://github.com/apache/flink/pull/11096#pullrequestreview-359603740", "createdAt": "2020-02-17T09:47:01Z", "commit": {"oid": "34ac6e03b86281ba56a4108f0f713f7a769b1291"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b", "committedDate": "2020-02-17T12:50:35Z", "message": "[FLINK-16056][runtime][tests] create ContinuousFileReaderOperator using factory only\nAlso drop test constructor and make the class package-private."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34ac6e03b86281ba56a4108f0f713f7a769b1291", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/34ac6e03b86281ba56a4108f0f713f7a769b1291", "committedDate": "2020-02-14T19:52:47Z", "message": "[FLINK-16056][runtime][tests] create CFRO using factory only\nAlso drop test constructor and make the class package-private."}, "afterCommit": {"oid": "03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b", "committedDate": "2020-02-17T12:50:35Z", "message": "[FLINK-16056][runtime][tests] create ContinuousFileReaderOperator using factory only\nAlso drop test constructor and make the class package-private."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTMyNDI1", "url": "https://github.com/apache/flink/pull/11096#pullrequestreview-360132425", "createdAt": "2020-02-18T08:05:49Z", "commit": {"oid": "03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODowNTo1MFrOFq4fNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODowNTo1MFrOFq4fNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUxMDAwNA==", "bodyText": "One more thing. Doesn't removal of line brake the java docs for this class (@Public so quite important)?\nReplace {@link ContinuousFileReaderOperator readers} with full class reference?", "url": "https://github.com/apache/flink/pull/11096#discussion_r380510004", "createdAt": "2020-02-18T08:05:50Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java", "diffHunk": "@@ -70,7 +70,6 @@\n import org.apache.flink.streaming.api.datastream.DataStreamSource;\n import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;\n import org.apache.flink.streaming.api.functions.source.ContinuousFileMonitoringFunction;\n-import org.apache.flink.streaming.api.functions.source.ContinuousFileReaderOperator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03ed8e68f6175a3fa9cb86e4ab1e22fe3844b56b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3e2f44f247790ca4ab7718b005e88708905f1f", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/1e3e2f44f247790ca4ab7718b005e88708905f1f", "committedDate": "2020-02-18T12:38:57Z", "message": "[FLINK-16056][docs] update StreamExecutionEnvironment javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzY4NjY2", "url": "https://github.com/apache/flink/pull/11096#pullrequestreview-360368666", "createdAt": "2020-02-18T14:13:25Z", "commit": {"oid": "1e3e2f44f247790ca4ab7718b005e88708905f1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4373, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}