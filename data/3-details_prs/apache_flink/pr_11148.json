{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NTkyNTU5", "number": 11148, "title": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId", "bodyText": "What is the purpose of the change\nScheduledUnit#vertexExecution is nullable but ProgrammedSlotProvider requires it to be non-null to work. This makes ProgrammedSlotProvider not able to be used by new scheduler tests since vertexExecution is never set in the new scheduler code path. It blocks us from reworking tests which are based legacy scheduling to base on the new scheduler.\nThus I opened this PR to replace the nullable vertexExecution with a non-null executionVertexID.\nIt also naturally fixes 2 other issues:\n\nThe log printed in SchedulerImpl#allocateSlotInternal(...) can be broken since the vertexExecution can be null.\nan NPE issue reported in FLINK-16145.\n\nBrief change log\nSee commits.\nVerifying this change\nThis change is already covered by existing tests, such as ExecutionTests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-02-20T07:22:36Z", "url": "https://github.com/apache/flink/pull/11148", "merged": true, "mergeCommit": {"oid": "9a3eb5b03b84f14c004a41681a26ed513d00ed00"}, "closed": true, "closedAt": "2020-02-28T14:57:02Z", "author": {"login": "zhuzhurk"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHxH8xgBqjMwNjkyMDgxODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIvBUHgBqjMwODE3NTQ2ODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cf340d95807d82066316548ca6e503f8fd731e8", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/9cf340d95807d82066316548ca6e503f8fd731e8", "committedDate": "2020-02-20T07:16:28Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}, "afterCommit": {"oid": "929ce55598222e5b670dce6d9d1253739318b81b", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/929ce55598222e5b670dce6d9d1253739318b81b", "committedDate": "2020-02-25T12:15:46Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0OTA3Mjk0", "url": "https://github.com/apache/flink/pull/11148#pullrequestreview-364907294", "createdAt": "2020-02-26T13:45:03Z", "commit": {"oid": "929ce55598222e5b670dce6d9d1253739318b81b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "929ce55598222e5b670dce6d9d1253739318b81b", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/929ce55598222e5b670dce6d9d1253739318b81b", "committedDate": "2020-02-25T12:15:46Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}, "afterCommit": {"oid": "4374dabbf658828b44a3a3f1c52ed0fe330b29fb", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/4374dabbf658828b44a3a3f1c52ed0fe330b29fb", "committedDate": "2020-02-27T07:52:08Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4374dabbf658828b44a3a3f1c52ed0fe330b29fb", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/4374dabbf658828b44a3a3f1c52ed0fe330b29fb", "committedDate": "2020-02-27T07:52:08Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}, "afterCommit": {"oid": "d5375507dd848cab70da6b48e15f49bfda80ac04", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/d5375507dd848cab70da6b48e15f49bfda80ac04", "committedDate": "2020-02-28T07:52:47Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MzQ3NjUz", "url": "https://github.com/apache/flink/pull/11148#pullrequestreview-366347653", "createdAt": "2020-02-28T11:59:05Z", "commit": {"oid": "d5375507dd848cab70da6b48e15f49bfda80ac04"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMTo1OTowNVrOFvyrjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMTo1OTowNVrOFvyrjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY1Nzc0Mw==", "bodyText": "I would name this executionVertexId (compare with the member below: slotSharingGroupId)", "url": "https://github.com/apache/flink/pull/11148#discussion_r385657743", "createdAt": "2020-02-28T11:59:05Z", "author": {"login": "GJL"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmanager/scheduler/ScheduledUnit.java", "diffHunk": "@@ -18,23 +18,21 @@\n \n package org.apache.flink.runtime.jobmanager.scheduler;\n \n+import org.apache.flink.annotation.VisibleForTesting;\n import org.apache.flink.runtime.executiongraph.Execution;\n import org.apache.flink.runtime.instance.SlotSharingGroupId;\n import org.apache.flink.runtime.jobgraph.JobVertexID;\n+import org.apache.flink.runtime.scheduler.strategy.ExecutionVertexID;\n import org.apache.flink.util.Preconditions;\n \n import javax.annotation.Nullable;\n \n /**\n- * ScheduledUnit contains the information necessary to allocate a slot for the given\n- * {@link JobVertexID}.\n+ * ScheduledUnit contains the information necessary to allocate a slot for the given task.\n  */\n public class ScheduledUnit {\n \n-\t@Nullable\n-\tprivate final Execution vertexExecution;\n-\n-\tprivate final JobVertexID jobVertexId;\n+\tprivate final ExecutionVertexID executionVertexID;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5375507dd848cab70da6b48e15f49bfda80ac04"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c85edee39df2e6cbcec64ede6b58a48bde28bbb", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/7c85edee39df2e6cbcec64ede6b58a48bde28bbb", "committedDate": "2020-02-28T12:24:07Z", "message": "[hotfix] Fix checkstyle violations in ScheduledUnit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c0fcc60cfab42e82d47c885e6e75f7b0f8f901", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/95c0fcc60cfab42e82d47c885e6e75f7b0f8f901", "committedDate": "2020-02-28T12:24:07Z", "message": "[hotfix][tests] Mock ExecutionVertex#getID() in ScheduelrTestUtils to avoid NPE issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92c1cc1671e793ad5b1dd3d73a671d6f1abaa273", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/92c1cc1671e793ad5b1dd3d73a671d6f1abaa273", "committedDate": "2020-02-28T12:24:07Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5375507dd848cab70da6b48e15f49bfda80ac04", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/d5375507dd848cab70da6b48e15f49bfda80ac04", "committedDate": "2020-02-28T07:52:47Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}, "afterCommit": {"oid": "92c1cc1671e793ad5b1dd3d73a671d6f1abaa273", "author": {"user": {"login": "zhuzhurk", "name": "Zhu Zhu"}}, "url": "https://github.com/apache/flink/commit/92c1cc1671e793ad5b1dd3d73a671d6f1abaa273", "committedDate": "2020-02-28T12:24:07Z", "message": "[FLINK-16180][runtime] Replace the nullable vertexExecution in ScheduledUnit with a non-null executionVertexId"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4847, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}