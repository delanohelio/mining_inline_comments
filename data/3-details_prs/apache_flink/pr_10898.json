{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTE0MzAy", "number": 10898, "title": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration", "bodyText": "What is the purpose of the change\nCurrently, when we deploy Flink cluster natively on Kubernetes and HA enabled, it could not work because of following two limitations\n\nFlink client could not connect to the jobmanager when HA enabled. It will get a internal address that could not be accessed outside of Kubernetes cluster.\nJobManagerOptions#ADDRESS has been set to service address when HA enabled. It has a risk  that the TaskManager will register to a wrong jobmanager when two jobmanagers are running. We need to use the pod ip address instead.\n\nBrief change log\n\nhotfix to make test could work for multiple pod environments.\nAlways use Kubernetes service for client to contact with jobmanager in KubernetesClusterDescriptor\nSet ip address to jobmanager.rpc.address in ClusterEntrypoint\nUpdate HighAvailabilityOptions.HA_CLUSTER_ID and HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE when HA enabled\n\nVerifying this change\n\nAdd a new unit test testDeployHighAvailabilitySessionCluster\nTest on a real Kubernetes cluster with zookeeper HA\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable)", "createdAt": "2020-01-19T09:26:13Z", "url": "https://github.com/apache/flink/pull/10898", "merged": true, "mergeCommit": {"oid": "cd9836c43bc615bd8a4475920df607e37cfd89ef"}, "closed": true, "closedAt": "2020-01-22T03:44:56Z", "author": {"login": "wangyang0918"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb70jCuABqjI5NjA3NjA0NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8jPJ-gBqjI5NjY3NDk2MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6798ddfa86fb02239ee31e75b5865bf535fd5bf", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/e6798ddfa86fb02239ee31e75b5865bf535fd5bf", "committedDate": "2020-01-19T07:49:47Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}, "afterCommit": {"oid": "09c6c4e6068e7d01c7c6f14370b9fbc6b0bdce69", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/09c6c4e6068e7d01c7c6f14370b9fbc6b0bdce69", "committedDate": "2020-01-19T09:28:49Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09c6c4e6068e7d01c7c6f14370b9fbc6b0bdce69", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/09c6c4e6068e7d01c7c6f14370b9fbc6b0bdce69", "committedDate": "2020-01-19T09:28:49Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}, "afterCommit": {"oid": "88dc2a5835294f062651e85c9146aa91eeaf302e", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/88dc2a5835294f062651e85c9146aa91eeaf302e", "committedDate": "2020-01-19T10:05:58Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88dc2a5835294f062651e85c9146aa91eeaf302e", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/88dc2a5835294f062651e85c9146aa91eeaf302e", "committedDate": "2020-01-19T10:05:58Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}, "afterCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac", "committedDate": "2020-01-19T10:13:48Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTkxNTEw", "url": "https://github.com/apache/flink/pull/10898#pullrequestreview-344991510", "createdAt": "2020-01-19T10:16:14Z", "commit": {"oid": "09c6c4e6068e7d01c7c6f14370b9fbc6b0bdce69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMDoxNjo0MFrOFfOKhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMDozODowMVrOFfOQKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MjI0Ng==", "bodyText": "It's better to add a private constructor for this util class", "url": "https://github.com/apache/flink/pull/10898#discussion_r368282246", "createdAt": "2020-01-19T10:16:40Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesEntrypointUtils.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.kubernetes.entrypoint;\n+\n+import org.apache.flink.configuration.ConfigConstants;\n+import org.apache.flink.configuration.Configuration;\n+import org.apache.flink.configuration.GlobalConfiguration;\n+import org.apache.flink.configuration.JobManagerOptions;\n+import org.apache.flink.configuration.RestOptions;\n+import org.apache.flink.kubernetes.utils.Constants;\n+import org.apache.flink.runtime.jobmanager.HighAvailabilityMode;\n+import org.apache.flink.util.Preconditions;\n+\n+/**\n+ * This class contains utility methods for the {@link KubernetesSessionClusterEntrypoint}.\n+ */\n+class KubernetesEntrypointUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MjM3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tfinal String ipAddress =  System.getenv().get(Constants.ENV_FLINK_POD_IP_ADDRESS);\n          \n          \n            \n            \t\t\tfinal String ipAddress = System.getenv().get(Constants.ENV_FLINK_POD_IP_ADDRESS);", "url": "https://github.com/apache/flink/pull/10898#discussion_r368282379", "createdAt": "2020-01-19T10:18:19Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesEntrypointUtils.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.kubernetes.entrypoint;\n+\n+import org.apache.flink.configuration.ConfigConstants;\n+import org.apache.flink.configuration.Configuration;\n+import org.apache.flink.configuration.GlobalConfiguration;\n+import org.apache.flink.configuration.JobManagerOptions;\n+import org.apache.flink.configuration.RestOptions;\n+import org.apache.flink.kubernetes.utils.Constants;\n+import org.apache.flink.runtime.jobmanager.HighAvailabilityMode;\n+import org.apache.flink.util.Preconditions;\n+\n+/**\n+ * This class contains utility methods for the {@link KubernetesSessionClusterEntrypoint}.\n+ */\n+class KubernetesEntrypointUtils {\n+\n+\t/**\n+\t * For non-HA cluster, jobmanager rpc address has be set to Kubernetes service name on client side. So the TaskManager\n+\t * will use service address to connect with jobmanager.\n+\t * For HA cluster, jobmanager rpc address will be set to ip address. The TaskManager use Zookeeper or other\n+\t * high-availability service to find the address of jobmanager. The Kubernetes DNS creates A and SRV records only for\n+\t * Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n+\t *\n+\t * @return Updated configuration\n+\t */\n+\tstatic Configuration loadConfiguration() {\n+\t\tfinal String configDir = System.getenv(ConfigConstants.ENV_FLINK_CONF_DIR);\n+\t\tPreconditions.checkNotNull(\n+\t\t\tconfigDir,\n+\t\t\t\"Flink configuration directory (%s) in environment should not be null!\",\n+\t\t\tConfigConstants.ENV_FLINK_CONF_DIR);\n+\n+\t\tfinal Configuration configuration = GlobalConfiguration.loadConfiguration(configDir);\n+\n+\t\tif (HighAvailabilityMode.isHighAvailabilityModeActivated(configuration)) {\n+\t\t\tfinal String ipAddress =  System.getenv().get(Constants.ENV_FLINK_POD_IP_ADDRESS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MjU1Ng==", "bodyText": "useless withEnvFrom?", "url": "https://github.com/apache/flink/pull/10898#discussion_r368282556", "createdAt": "2020-01-19T10:21:37Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/decorators/FlinkMasterDeploymentDecorator.java", "diffHunk": "@@ -138,13 +144,21 @@ private Container createJobManagerContainer(\n \t\t\t\tnew ContainerPortBuilder().withContainerPort(flinkConfig.getInteger(RestOptions.PORT)).build(),\n \t\t\t\tnew ContainerPortBuilder().withContainerPort(flinkConfig.getInteger(JobManagerOptions.PORT)).build(),\n \t\t\t\tnew ContainerPortBuilder().withContainerPort(blobServerPort).build()))\n-\t\t\t.withEnv(\n-\t\t\t\tBootstrapTools.getEnvironmentVariables(ResourceManagerOptions.CONTAINERIZED_MASTER_ENV_PREFIX, flinkConfig)\n-\t\t\t\t\t.entrySet()\n-\t\t\t\t\t.stream()\n-\t\t\t\t\t.map(kv -> new EnvVar(kv.getKey(), kv.getValue(), null))\n-\t\t\t\t\t.collect(Collectors.toList()))\n+\t\t\t.withEnv(buildEnvForContainer(flinkConfig)).withEnvFrom()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4Mjg4NQ==", "bodyText": "This change seems to be unrelated? How about to do it in a separate commit?", "url": "https://github.com/apache/flink/pull/10898#discussion_r368282885", "createdAt": "2020-01-19T10:26:51Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/test/java/org/apache/flink/kubernetes/kubeclient/Fabric8ClientTest.java", "diffHunk": "@@ -189,7 +190,10 @@ public void testCreateFlinkMasterDeployment() {\n \t\t\tjmContainer.getVolumeMounts().get(0).getMountPath());\n \t\tassertEquals(FLINK_CONF_FILENAME, jmContainer.getVolumeMounts().get(0).getSubPath());\n \n-\t\tassertThat(jmContainer.getEnv(), Matchers.contains(new EnvVar(FLINK_MASTER_ENV_KEY, FLINK_MASTER_ENV_VALUE, null)));\n+\t\tEnvVar masterEnv = new EnvVar(FLINK_MASTER_ENV_KEY, FLINK_MASTER_ENV_VALUE, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MzI2NA==", "bodyText": "How about to set it to IP in all cases to avoid confusion, namely, change how we set JobManagerOptions.ADDRESS in KubernetesClusterDescriptor#deployClusterInternal()?", "url": "https://github.com/apache/flink/pull/10898#discussion_r368283264", "createdAt": "2020-01-19T10:32:16Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesEntrypointUtils.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.kubernetes.entrypoint;\n+\n+import org.apache.flink.configuration.ConfigConstants;\n+import org.apache.flink.configuration.Configuration;\n+import org.apache.flink.configuration.GlobalConfiguration;\n+import org.apache.flink.configuration.JobManagerOptions;\n+import org.apache.flink.configuration.RestOptions;\n+import org.apache.flink.kubernetes.utils.Constants;\n+import org.apache.flink.runtime.jobmanager.HighAvailabilityMode;\n+import org.apache.flink.util.Preconditions;\n+\n+/**\n+ * This class contains utility methods for the {@link KubernetesSessionClusterEntrypoint}.\n+ */\n+class KubernetesEntrypointUtils {\n+\n+\t/**\n+\t * For non-HA cluster, jobmanager rpc address has be set to Kubernetes service name on client side. So the TaskManager\n+\t * will use service address to connect with jobmanager.\n+\t * For HA cluster, jobmanager rpc address will be set to ip address. The TaskManager use Zookeeper or other\n+\t * high-availability service to find the address of jobmanager. The Kubernetes DNS creates A and SRV records only for\n+\t * Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n+\t *\n+\t * @return Updated configuration\n+\t */\n+\tstatic Configuration loadConfiguration() {\n+\t\tfinal String configDir = System.getenv(ConfigConstants.ENV_FLINK_CONF_DIR);\n+\t\tPreconditions.checkNotNull(\n+\t\t\tconfigDir,\n+\t\t\t\"Flink configuration directory (%s) in environment should not be null!\",\n+\t\t\tConfigConstants.ENV_FLINK_CONF_DIR);\n+\n+\t\tfinal Configuration configuration = GlobalConfiguration.loadConfiguration(configDir);\n+\n+\t\tif (HighAvailabilityMode.isHighAvailabilityModeActivated(configuration)) {\n+\t\t\tfinal String ipAddress =  System.getenv().get(Constants.ENV_FLINK_POD_IP_ADDRESS);\n+\t\t\tPreconditions.checkState(\n+\t\t\t\tipAddress != null,\n+\t\t\t\t\"JobManager ip address environment variable %s not set\",\n+\t\t\t\tConstants.ENV_FLINK_POD_IP_ADDRESS);\n+\t\t\tconfiguration.setString(JobManagerOptions.ADDRESS, ipAddress);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MzY4OA==", "bodyText": "This might work. However, the way is a bit hack and add some dependency/assumption to the behavior of non-HA mode.\nIs there a clean way we let the client retrieve jobmanager address from k8s service no matter what the HA mode is?", "url": "https://github.com/apache/flink/pull/10898#discussion_r368283688", "createdAt": "2020-01-19T10:38:01Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/KubernetesClusterDescriptor.java", "diffHunk": "@@ -84,6 +86,11 @@ public String getClusterDescription() {\n \t\t\tif (restEndpoint != null) {\n \t\t\t\tconfiguration.setString(RestOptions.ADDRESS, restEndpoint.getAddress());\n \t\t\t\tconfiguration.setInteger(RestOptions.PORT, restEndpoint.getPort());\n+\t\t\t\t// Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes\n+\t\t\t\t// service to contact with jobmanager via rest client.\n+\t\t\t\tif (HighAvailabilityMode.isHighAvailabilityModeActivated(flinkConfig)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/93fe86fa5b20c9ab53afc0fd3f664ac8af0383ac", "committedDate": "2020-01-19T10:13:48Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}, "afterCommit": {"oid": "84bb6a6ec1c0fe6d7c62e4fa68cabef6937954a8", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/84bb6a6ec1c0fe6d7c62e4fa68cabef6937954a8", "committedDate": "2020-01-19T13:34:25Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84bb6a6ec1c0fe6d7c62e4fa68cabef6937954a8", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/84bb6a6ec1c0fe6d7c62e4fa68cabef6937954a8", "committedDate": "2020-01-19T13:34:25Z", "message": "[FLINK-15632][kubernetes] Make zookeeper HA service could work for active kubernetes integration\n\nThere will be the following differences if we want to support HA for active Kubernetes integration.\n1. The K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always use Kubernetes service to contact with jobmanager via rest client.\n2. The Kubernetes DNS creates A and SRV records only for Services. It doesn't generate pods' A records. So the ip address, not hostname, will be used as jobmanager address.\n\nAll other behaviors will be same as Zookeeper HA for standalone and Yarn."}, "afterCommit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/46e510779736a390f71ac42f8294c81b6cbaa51c", "committedDate": "2020-01-20T03:22:11Z", "message": "[FLINK-15632][kubernetes] Set JobManagerOptions#ADDRESS to the pod ip address when HA mode enabled\n\nFor non-HA cluster, JobManagerOptions#ADDRESS has be set to Kubernetes service name on client side. See KubernetesClusterDescriptor#deployClusterInternal. So the TaskManager will use service address to contact with JobManager.\nFor HA cluster, JobManagerOptions#ADDRESS will be set to the pod ip address. The TaskManager uses Zookeeper or other high-availability service to find the address of JobManager."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1Mjc5Mjc0", "url": "https://github.com/apache/flink/pull/10898#pullrequestreview-345279274", "createdAt": "2020-01-20T12:37:03Z", "commit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjozNzowM1rOFfdCHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjo0NTo0MFrOFfdPLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUyNTg1Mg==", "bodyText": "better to checkNotNull", "url": "https://github.com/apache/flink/pull/10898#discussion_r368525852", "createdAt": "2020-01-20T12:37:03Z", "author": {"login": "zhuzhurk"}, "path": "flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java", "diffHunk": "@@ -182,7 +206,7 @@ public RestClusterClient(Configuration config, T clusterId) throws Exception {\n \t\tthis.waitStrategy = checkNotNull(waitStrategy);\n \t\tthis.clusterId = checkNotNull(clusterId);\n \n-\t\tthis.clientHAServices = HighAvailabilityServicesUtils.createClientHAService(configuration);\n+\t\tthis.clientHAServices = clientHAServices;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUyOTE5Nw==", "bodyText": "What's the config overriding for?", "url": "https://github.com/apache/flink/pull/10898#discussion_r368529197", "createdAt": "2020-01-20T12:45:40Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/KubernetesClusterDescriptor.java", "diffHunk": "@@ -168,6 +185,13 @@ public String getClusterDescription() {\n \t\tfinal String nameSpace = flinkConfig.getString(KubernetesConfigOptions.NAMESPACE);\n \t\tflinkConfig.setString(JobManagerOptions.ADDRESS, clusterId + \".\" + nameSpace);\n \n+\t\tif (HighAvailabilityMode.isHighAvailabilityModeActivated(flinkConfig)) {\n+\t\t\tflinkConfig.setString(HighAvailabilityOptions.HA_CLUSTER_ID, clusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9447fa3992503fa0248804f23538087a18660c2"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1Mjg5Nzcx", "url": "https://github.com/apache/flink/pull/10898#pullrequestreview-345289771", "createdAt": "2020-01-20T12:57:50Z", "commit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjo1Nzo1MFrOFfdh9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjo1Nzo1MFrOFfdh9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUzNDAwNQ==", "bodyText": "It would be better to leave a comment here for why we use StandaloneClientHAServices for k8s client.", "url": "https://github.com/apache/flink/pull/10898#discussion_r368534005", "createdAt": "2020-01-20T12:57:50Z", "author": {"login": "zhuzhurk"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/KubernetesClusterDescriptor.java", "diffHunk": "@@ -91,7 +104,11 @@ public String getClusterDescription() {\n \t\t\t}\n \n \t\t\ttry {\n-\t\t\t\treturn new RestClusterClient<>(configuration, clusterId);\n+\t\t\t\treturn new RestClusterClient<>(\n+\t\t\t\t\tconfiguration,\n+\t\t\t\t\tclusterId,\n+\t\t\t\t\tnew StandaloneClientHAServices(HighAvailabilityServicesUtils.getWebMonitorAddress(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46e510779736a390f71ac42f8294c81b6cbaa51c", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/46e510779736a390f71ac42f8294c81b6cbaa51c", "committedDate": "2020-01-20T03:22:11Z", "message": "[FLINK-15632][kubernetes] Set JobManagerOptions#ADDRESS to the pod ip address when HA mode enabled\n\nFor non-HA cluster, JobManagerOptions#ADDRESS has be set to Kubernetes service name on client side. See KubernetesClusterDescriptor#deployClusterInternal. So the TaskManager will use service address to contact with JobManager.\nFor HA cluster, JobManagerOptions#ADDRESS will be set to the pod ip address. The TaskManager uses Zookeeper or other high-availability service to find the address of JobManager."}, "afterCommit": {"oid": "69f28f72014de47081ad433675b42d62356bb116", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/69f28f72014de47081ad433675b42d62356bb116", "committedDate": "2020-01-21T02:15:47Z", "message": "[FLINK-15632][kubernetes] Set JobManagerOptions#ADDRESS to the pod ip address when HA mode enabled\n\nFor non-HA cluster, JobManagerOptions#ADDRESS has be set to Kubernetes service name on client side. See KubernetesClusterDescriptor#deployClusterInternal. So the TaskManager will use service address to contact with JobManager.\nFor HA cluster, JobManagerOptions#ADDRESS will be set to the pod ip address. The TaskManager uses Zookeeper or other high-availability service to find the address of JobManager."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69f28f72014de47081ad433675b42d62356bb116", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/69f28f72014de47081ad433675b42d62356bb116", "committedDate": "2020-01-21T02:15:47Z", "message": "[FLINK-15632][kubernetes] Set JobManagerOptions#ADDRESS to the pod ip address when HA mode enabled\n\nFor non-HA cluster, JobManagerOptions#ADDRESS has be set to Kubernetes service name on client side. See KubernetesClusterDescriptor#deployClusterInternal. So the TaskManager will use service address to contact with JobManager.\nFor HA cluster, JobManagerOptions#ADDRESS will be set to the pod ip address. The TaskManager uses Zookeeper or other high-availability service to find the address of JobManager."}, "afterCommit": {"oid": "86fe40ba1c3256a47a001eb54399abfea8ef5598", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/86fe40ba1c3256a47a001eb54399abfea8ef5598", "committedDate": "2020-01-21T03:45:32Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be fallback to the default value of JobManagerOptions.PORT."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86fe40ba1c3256a47a001eb54399abfea8ef5598", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/86fe40ba1c3256a47a001eb54399abfea8ef5598", "committedDate": "2020-01-21T03:45:32Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be fallback to the default value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "69eaf5504b554d201901f590f8222dd4e227ffa8", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/69eaf5504b554d201901f590f8222dd4e227ffa8", "committedDate": "2020-01-21T03:53:31Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69eaf5504b554d201901f590f8222dd4e227ffa8", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/69eaf5504b554d201901f590f8222dd4e227ffa8", "committedDate": "2020-01-21T03:53:31Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "a43bc2d6a72469aecc9c5b6dec1a70d14ea94fe7", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/a43bc2d6a72469aecc9c5b6dec1a70d14ea94fe7", "committedDate": "2020-01-21T03:59:39Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a43bc2d6a72469aecc9c5b6dec1a70d14ea94fe7", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/a43bc2d6a72469aecc9c5b6dec1a70d14ea94fe7", "committedDate": "2020-01-21T03:59:39Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "a68eb2b118a55d7ad994e4a9d5dad25bc436f737", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/a68eb2b118a55d7ad994e4a9d5dad25bc436f737", "committedDate": "2020-01-21T06:38:49Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a68eb2b118a55d7ad994e4a9d5dad25bc436f737", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/a68eb2b118a55d7ad994e4a9d5dad25bc436f737", "committedDate": "2020-01-21T06:38:49Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "3da241511d5030cf3120c9f3e381b21fef0b4347", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/3da241511d5030cf3120c9f3e381b21fef0b4347", "committedDate": "2020-01-21T06:39:42Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1Njg1NTQ3", "url": "https://github.com/apache/flink/pull/10898#pullrequestreview-345685547", "createdAt": "2020-01-21T07:55:48Z", "commit": {"oid": "3da241511d5030cf3120c9f3e381b21fef0b4347"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3da241511d5030cf3120c9f3e381b21fef0b4347", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/3da241511d5030cf3120c9f3e381b21fef0b4347", "committedDate": "2020-01-21T06:39:42Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "d4624a807cb6639b2c68646b9fdb933c7560d0a6", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/d4624a807cb6639b2c68646b9fdb933c7560d0a6", "committedDate": "2020-01-21T07:58:30Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dac85ecbe94c0b9bb04808e822ccbf8b1f4a2d1e", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/dac85ecbe94c0b9bb04808e822ccbf8b1f4a2d1e", "committedDate": "2020-01-21T15:53:11Z", "message": "[hotfix][kubernetes] Only check the expected env vars in Fabric8ClientTest#testCreateFlinkMasterDeployment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffafa9908521a6b939a0c99ffcd82f86ab81424f", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/ffafa9908521a6b939a0c99ffcd82f86ab81424f", "committedDate": "2020-01-21T15:53:11Z", "message": "[FLINK-15632][kubernetes] Make Flink client always uses Kubernetes service to contact with jobmanager via rest client\n\nThe K8s service is designed for accessing the jobmanager out of K8s cluster. So Flink client will not use HA service to retrieve address of jobmanager. Instead, it always uses Kubernetes service to contact with jobmanager via rest client. So firstly, we will get the RestOptions#ADDRESS and RestOptions#PORT from the Kubernetes service and set the values to configuration. Then we will use the updated configuration to construct a StandaloneClientHAServices for RestClusterClient."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb19b25f85613aeb2f3a86e0b7f5302e20daf81a", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/fb19b25f85613aeb2f3a86e0b7f5302e20daf81a", "committedDate": "2020-01-21T15:53:11Z", "message": "[FLINK-15632][kubernetes] Set JobManagerOptions#ADDRESS to the pod ip address when HA mode enabled\n\nFor non-HA cluster, JobManagerOptions#ADDRESS has be set to Kubernetes service name on client side. See KubernetesClusterDescriptor#deployClusterInternal. So the TaskManager will use service address to contact with JobManager.\nFor HA cluster, JobManagerOptions#ADDRESS will be set to the pod ip address. The TaskManager uses Zookeeper or other high-availability service to find the address of JobManager."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18df29c4c4e6b174cb5d206ca2e4878be1e5d5dd", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/18df29c4c4e6b174cb5d206ca2e4878be1e5d5dd", "committedDate": "2020-01-21T15:53:11Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4624a807cb6639b2c68646b9fdb933c7560d0a6", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/d4624a807cb6639b2c68646b9fdb933c7560d0a6", "committedDate": "2020-01-21T07:58:30Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}, "afterCommit": {"oid": "18df29c4c4e6b174cb5d206ca2e4878be1e5d5dd", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/18df29c4c4e6b174cb5d206ca2e4878be1e5d5dd", "committedDate": "2020-01-21T15:53:11Z", "message": "[FLINK-15632][kubernetes] Update the cluster id and high-availability jobmanager port when HA enabled\n\nWhen HA enabled, the config option HighAvailabilityOptions.HA_CLUSTER_ID will be set to the user specified cluster id. And if the config option HighAvailabilityOptions.HA_JOB_MANAGER_PORT_RANGE is not set or with value 0, it will be updated to the value of JobManagerOptions.PORT."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4835, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}