{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxOTg1NTU0", "number": 12563, "title": "[FLINK-16225] Implement user class loading exception handler", "bodyText": "1.10 Port of #12446.\nalso ports #12563 to reduce netty overhead and direct memory allocation timeout in some tests", "createdAt": "2020-06-09T18:23:22Z", "url": "https://github.com/apache/flink/pull/12563", "merged": true, "mergeCommit": {"oid": "bfe6c2eddedaf3b8067c973ba82a06b36d5095f9"}, "closed": true, "closedAt": "2020-07-22T12:07:44Z", "author": {"login": "azagrebin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcppbIPgFqTQyNzQzNDc3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3ZrP9gBqjM1NzU0NjY5NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDM0Nzcz", "url": "https://github.com/apache/flink/pull/12563#pullrequestreview-427434773", "createdAt": "2020-06-09T18:32:43Z", "commit": {"oid": "9dd08c598b563dc116248372c03cd449a1525c39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dd08c598b563dc116248372c03cd449a1525c39", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/9dd08c598b563dc116248372c03cd449a1525c39", "committedDate": "2020-06-09T18:08:09Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12446."}, "afterCommit": {"oid": "c1d0d9befd392aa787f498efc6b3f7e3f2badfe6", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/c1d0d9befd392aa787f498efc6b3f7e3f2badfe6", "committedDate": "2020-06-10T06:45:59Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12446."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1d0d9befd392aa787f498efc6b3f7e3f2badfe6", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/c1d0d9befd392aa787f498efc6b3f7e3f2badfe6", "committedDate": "2020-06-10T06:45:59Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12446."}, "afterCommit": {"oid": "dd4bb7283e4b52e5646c9809f21d39f1a95bb550", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/dd4bb7283e4b52e5646c9809f21d39f1a95bb550", "committedDate": "2020-07-20T16:14:36Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12446."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDY1OTk5", "url": "https://github.com/apache/flink/pull/12563#pullrequestreview-453065999", "createdAt": "2020-07-22T07:35:59Z", "commit": {"oid": "dd4bb7283e4b52e5646c9809f21d39f1a95bb550"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNzozNjowMFrOG1WXRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNzo0MTo1OFrOG1WjzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5NDExNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tfatalErrorHandler);\n          \n          \n            \n            \t\t\t\tfailOnJvmMetaspaceOomError ? fatalErrorHandler : null);", "url": "https://github.com/apache/flink/pull/12563#discussion_r458594116", "createdAt": "2020-07-22T07:36:00Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerSharedServices.java", "diffHunk": "@@ -144,11 +146,13 @@ public static JobManagerSharedServices fromConfiguration(\n \n \t\tfinal String[] alwaysParentFirstLoaderPatterns = CoreOptions.getParentFirstLoaderPatterns(config);\n \n+\t\tfinal boolean failOnJvmMetaspaceOomError = config.getBoolean(CoreOptions.FAIL_ON_USER_CLASS_LOADING_METASPACE_OOM);\n \t\tfinal BlobLibraryCacheManager libraryCacheManager =\n \t\t\tnew BlobLibraryCacheManager(\n \t\t\t\tblobServer,\n \t\t\t\tFlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder),\n-\t\t\t\talwaysParentFirstLoaderPatterns);\n+\t\t\t\talwaysParentFirstLoaderPatterns,\n+\t\t\t\tfatalErrorHandler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd4bb7283e4b52e5646c9809f21d39f1a95bb550"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU5NzMyNQ==", "bodyText": "Here we are not respecting FAIL_ON_USER_CLASS_LOADING_METASPACE_OOM.", "url": "https://github.com/apache/flink/pull/12563#discussion_r458597325", "createdAt": "2020-07-22T07:41:58Z", "author": {"login": "tillrohrmann"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/TaskExecutor.java", "diffHunk": "@@ -1326,7 +1326,8 @@ private JobManagerConnection associateWithJobManager(\n \t\tfinal LibraryCacheManager libraryCacheManager = new BlobLibraryCacheManager(\n \t\t\tblobCacheService.getPermanentBlobService(),\n \t\t\ttaskManagerConfiguration.getClassLoaderResolveOrder(),\n-\t\t\ttaskManagerConfiguration.getAlwaysParentFirstLoaderPatterns());\n+\t\t\ttaskManagerConfiguration.getAlwaysParentFirstLoaderPatterns(),\n+\t\t\tfatalErrorHandler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd4bb7283e4b52e5646c9809f21d39f1a95bb550"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMjM1OTYy", "url": "https://github.com/apache/flink/pull/12563#pullrequestreview-453235962", "createdAt": "2020-07-22T11:41:07Z", "commit": {"oid": "3873dd832db7a863367ef10245ad62a8fd1324cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14423007176fa5cbb1ea06ac7c5c4c9fb2d64cc4", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/14423007176fa5cbb1ea06ac7c5c4c9fb2d64cc4", "committedDate": "2020-07-22T11:58:56Z", "message": "[FLINK-15962][network] Reduce the default chunk size to 4M in netty stack"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3873dd832db7a863367ef10245ad62a8fd1324cf", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/3873dd832db7a863367ef10245ad62a8fd1324cf", "committedDate": "2020-07-22T08:40:55Z", "message": "fixup! [FLINK-16225] Implement user class loading exception handler"}, "afterCommit": {"oid": "0cc21da1c18a9da8544deee5f1aa6d5d1a919479", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/0cc21da1c18a9da8544deee5f1aa6d5d1a919479", "committedDate": "2020-07-22T11:59:05Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12563."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfe6c2eddedaf3b8067c973ba82a06b36d5095f9", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/bfe6c2eddedaf3b8067c973ba82a06b36d5095f9", "committedDate": "2020-07-22T12:06:28Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12563."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cc21da1c18a9da8544deee5f1aa6d5d1a919479", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/0cc21da1c18a9da8544deee5f1aa6d5d1a919479", "committedDate": "2020-07-22T11:59:05Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12563."}, "afterCommit": {"oid": "bfe6c2eddedaf3b8067c973ba82a06b36d5095f9", "author": {"user": {"login": "azagrebin", "name": null}}, "url": "https://github.com/apache/flink/commit/bfe6c2eddedaf3b8067c973ba82a06b36d5095f9", "committedDate": "2020-07-22T12:06:28Z", "message": "[FLINK-16225] Implement user class loading exception handler\n\nThis closes #12563."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3939, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}