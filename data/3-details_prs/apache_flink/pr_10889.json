{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MjE0MDU5", "number": 10889, "title": "[Flink-15355][plugins]Enable s3 plugins under Java 11.", "bodyText": "What is the purpose of the change\nBecause of the module system of Java 9, (s3) plugins cannot access different modules anymore. This patch fixes two issues: access to platform modules for authentication related classes and bundling of jaxb in a version shaded jar.\nBrief change log\n\nAccess to platform modules for authentication related classes and\nBundling of jaxb in a version shaded jar.\n\nVerifying this change\n\nExisting e2e plugin tests under Java 11.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-01-17T16:12:17Z", "url": "https://github.com/apache/flink/pull/10889", "merged": true, "mergeCommit": {"oid": "2035b2ba3fc9cf39feeaa2427d10807527d8be20"}, "closed": true, "closedAt": "2020-01-21T12:13:57Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7VZc4AFqTM0NDg0NDAwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8d2XkgFqTM0NTczOTI5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0ODQ0MDA5", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-344844009", "createdAt": "2020-01-17T21:12:16Z", "commit": {"oid": "b352d9bce1e32923a1b3da9ab9b835d5aa6dd613"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b352d9bce1e32923a1b3da9ab9b835d5aa6dd613", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b352d9bce1e32923a1b3da9ab9b835d5aa6dd613", "committedDate": "2020-01-17T16:08:51Z", "message": "[temp]Enable misc e2e tests"}, "afterCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/966745cdadf667b21fe7e33af854f7261eb94b50", "committedDate": "2020-01-20T14:28:58Z", "message": "[temp]Enable misc e2e tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MzQ1Njkz", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345345693", "createdAt": "2020-01-20T14:30:17Z", "commit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNDozMDoxN1rOFfgHAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNDozMDoxN1rOFfgHAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng==", "bodyText": "I guess this is not the same as \"Creative Commons CC0 1.0 Universal Public Domain Dedication License\" and cannot be bundled?", "url": "https://github.com/apache/flink/pull/10889#discussion_r368576256", "createdAt": "2020-01-20T14:30:17Z", "author": {"login": "AHeise"}, "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MzUzMjY4", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345353268", "createdAt": "2020-01-20T14:41:54Z", "commit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNDo0MTo1NFrOFfgeJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNDo0NTozMFrOFfglaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4MjE4Mg==", "bodyText": "It is the Common Development and Distribution License and can be bundled.", "url": "https://github.com/apache/flink/pull/10889#discussion_r368582182", "createdAt": "2020-01-20T14:41:54Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}, "originalCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4MzY3OA==", "bodyText": "given that this depends on javax.activation I would think that we need to bundle both.\nWe had an issue in the past when we only had one in yarn: https://issues.apache.org/jira/browse/FLINK-15008", "url": "https://github.com/apache/flink/pull/10889#discussion_r368583678", "createdAt": "2020-01-20T14:44:44Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.\n+See bundled license files for details.\n+\n+- javax.xml.bind:jaxb-api:2.3.1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NDA0MA==", "bodyText": "somethings missing here ;)\nyou need to include these two files under resources/META-INF/licenses.", "url": "https://github.com/apache/flink/pull/10889#discussion_r368584040", "createdAt": "2020-01-20T14:45:30Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.\n+See bundled license files for details.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "966745cdadf667b21fe7e33af854f7261eb94b50", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/966745cdadf667b21fe7e33af854f7261eb94b50", "committedDate": "2020-01-20T14:28:58Z", "message": "[temp]Enable misc e2e tests"}, "afterCommit": {"oid": "a1af064f262c989672448ac873502eb168717685", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a1af064f262c989672448ac873502eb168717685", "committedDate": "2020-01-20T16:25:04Z", "message": "[temp]Enable misc e2e tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NTI5Mzk0", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345529394", "createdAt": "2020-01-20T20:56:58Z", "commit": {"oid": "a1af064f262c989672448ac873502eb168717685"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1af064f262c989672448ac873502eb168717685", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a1af064f262c989672448ac873502eb168717685", "committedDate": "2020-01-20T16:25:04Z", "message": "[temp]Enable misc e2e tests"}, "afterCommit": {"oid": "383ec9ba09f65430856c64712fcbf115c81ebe05", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/383ec9ba09f65430856c64712fcbf115c81ebe05", "committedDate": "2020-01-20T16:25:04Z", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NzExODky", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345711892", "createdAt": "2020-01-21T08:51:41Z", "commit": {"oid": "afa1419d99ea2bf395d623f24798b7505f0c6a45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODo1MTo0MlrOFfyOnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODo1MTo0MlrOFfyOnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg3MzExOQ==", "bodyText": "Shouldn't we propagate/handle some errors?", "url": "https://github.com/apache/flink/pull/10889#discussion_r368873119", "createdAt": "2020-01-21T08:51:42Z", "author": {"login": "pnowojski"}, "path": "flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java", "diffHunk": "@@ -182,5 +184,16 @@ private boolean isAllowedFlinkClass(final String name) {\n \t\tprivate boolean isAllowedFlinkResource(final String name) {\n \t\t\treturn Arrays.stream(allowedResourcePrefixes).anyMatch(name::startsWith);\n \t\t}\n+\n+\t\tstatic {\n+\t\t\tClassLoader platformLoader = null;\n+\t\t\ttry {\n+\t\t\t\tplatformLoader = (ClassLoader) ClassLoader.class\n+\t\t\t\t\t.getMethod(\"getPlatformClassLoader\")\n+\t\t\t\t\t.invoke(null);\n+\t\t\t} catch (Exception e) {\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "afa1419d99ea2bf395d623f24798b7505f0c6a45"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5efc5d29f49884fe98d8d7540384463fdfda58ee", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/5efc5d29f49884fe98d8d7540384463fdfda58ee", "committedDate": "2020-01-21T09:24:18Z", "message": "[FLINK-15355][plugins] PluginLoader allows access to JDK9 modules.\n\nWith Java9, classes that have moved to modules are not accessible through the bootstrap classloader anymore. The platform classloader is the equivalent to the Java8 bootstrap classloader and now used for plugins."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa264bfee8bba65fa3218fa64716908f7bab371", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cfa264bfee8bba65fa3218fa64716908f7bab371", "committedDate": "2020-01-21T09:24:18Z", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "383ec9ba09f65430856c64712fcbf115c81ebe05", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/383ec9ba09f65430856c64712fcbf115c81ebe05", "committedDate": "2020-01-20T16:25:04Z", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+."}, "afterCommit": {"oid": "cfa264bfee8bba65fa3218fa64716908f7bab371", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cfa264bfee8bba65fa3218fa64716908f7bab371", "committedDate": "2020-01-21T09:24:18Z", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NzMyMjY5", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345732269", "createdAt": "2020-01-21T09:25:30Z", "commit": {"oid": "5efc5d29f49884fe98d8d7540384463fdfda58ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwOToyNTozMFrOFfzMbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwOToyNTozMFrOFfzMbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4ODk0MQ==", "bodyText": "@pnowojski What do you think of the exception handling now? Do you have any reliable way to detect if we are on Java9+?", "url": "https://github.com/apache/flink/pull/10889#discussion_r368888941", "createdAt": "2020-01-21T09:25:30Z", "author": {"login": "AHeise"}, "path": "flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java", "diffHunk": "@@ -182,5 +184,20 @@ private boolean isAllowedFlinkClass(final String name) {\n \t\tprivate boolean isAllowedFlinkResource(final String name) {\n \t\t\treturn Arrays.stream(allowedResourcePrefixes).anyMatch(name::startsWith);\n \t\t}\n+\n+\t\tstatic {\n+\t\t\tClassLoader platformLoader = null;\n+\t\t\ttry {\n+\t\t\t\tplatformLoader = (ClassLoader) ClassLoader.class\n+\t\t\t\t\t.getMethod(\"getPlatformClassLoader\")\n+\t\t\t\t\t.invoke(null);\n+\t\t\t} catch (NoSuchMethodException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5efc5d29f49884fe98d8d7540384463fdfda58ee"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NzM5Mjk4", "url": "https://github.com/apache/flink/pull/10889#pullrequestreview-345739298", "createdAt": "2020-01-21T09:37:01Z", "commit": {"oid": "cfa264bfee8bba65fa3218fa64716908f7bab371"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4806, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}