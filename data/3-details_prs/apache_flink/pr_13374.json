{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MTk4MzAx", "number": 13374, "title": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator. [1.10]", "bodyText": "What is the purpose of the change\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered.\nBrief change log\n\nDisallow chaining of ContinuousFileReaderOperator.\n\nVerifying this change\nAdded a new test case that covers the original issue of FLINK-19109.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-09-11T15:36:10Z", "url": "https://github.com/apache/flink/pull/13374", "merged": true, "mergeCommit": {"oid": "05ff71c813650f65604d960978f93ba82f09a48d"}, "closed": true, "closedAt": "2020-09-16T13:50:43Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH4uH1ABqjM3NTcyNTE3NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJbdE6gBqjM3NzI5MTAwNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f845f98d1eed0bb8e852198085b5bb21629d984", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/8f845f98d1eed0bb8e852198085b5bb21629d984", "committedDate": "2020-09-11T15:34:11Z", "message": "[FLINK-19109][streaming] Disallow chaining of CFRO and ProcessingTimeCallback.\n\nProcessingTimeCallbacks cannot be guaranteed to be invoked in a timely manner (or at all) if ContinuousFileReaderOperator is yielding."}, "afterCommit": {"oid": "858ce532bd1800cb354ae304296db67764aad433", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/858ce532bd1800cb354ae304296db67764aad433", "committedDate": "2020-09-11T17:19:30Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Mjg5Njg0", "url": "https://github.com/apache/flink/pull/13374#pullrequestreview-487289684", "createdAt": "2020-09-13T09:19:32Z", "commit": {"oid": "858ce532bd1800cb354ae304296db67764aad433"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwOToxOTozMlrOHQ66ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwOToxOTozMlrOHQ66ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUwNDQ4NQ==", "bodyText": "I think this should be mentioned in the release notes on this branch (that since 1.10.X, we disabled chaining because of yadayadayada).", "url": "https://github.com/apache/flink/pull/13374#discussion_r487504485", "createdAt": "2020-09-13T09:19:32Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/source/ContinuousFileReaderOperator.java", "diffHunk": "@@ -80,6 +81,7 @@\n \n \tpublic ContinuousFileReaderOperator(FileInputFormat<OUT> format) {\n \t\tthis.format = checkNotNull(format);\n+\t\tsetChainingStrategy(ChainingStrategy.NEVER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858ce532bd1800cb354ae304296db67764aad433"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "858ce532bd1800cb354ae304296db67764aad433", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/858ce532bd1800cb354ae304296db67764aad433", "committedDate": "2020-09-11T17:19:30Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}, "afterCommit": {"oid": "6dabc37d6420693963132b6458419ecb15c14ed6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/6dabc37d6420693963132b6458419ecb15c14ed6", "committedDate": "2020-09-14T18:20:10Z", "message": "[temp] Executing e2e tests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dabc37d6420693963132b6458419ecb15c14ed6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/6dabc37d6420693963132b6458419ecb15c14ed6", "committedDate": "2020-09-14T18:20:10Z", "message": "[temp] Executing e2e tests."}, "afterCommit": {"oid": "55ac4dabaa1841941b8b33c11511fac8dd729289", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/55ac4dabaa1841941b8b33c11511fac8dd729289", "committedDate": "2020-09-15T12:41:58Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55ac4dabaa1841941b8b33c11511fac8dd729289", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/55ac4dabaa1841941b8b33c11511fac8dd729289", "committedDate": "2020-09-15T12:41:58Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}, "afterCommit": {"oid": "28214151caa049da65115b9fb87ac028254a0bc2", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/28214151caa049da65115b9fb87ac028254a0bc2", "committedDate": "2020-09-15T12:42:10Z", "message": "[temp] Executing e2e tests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28214151caa049da65115b9fb87ac028254a0bc2", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/28214151caa049da65115b9fb87ac028254a0bc2", "committedDate": "2020-09-15T12:42:10Z", "message": "[temp] Executing e2e tests."}, "afterCommit": {"oid": "7e1f8916c7c4fa73cdf51e04a7b172f4da7d1977", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/7e1f8916c7c4fa73cdf51e04a7b172f4da7d1977", "committedDate": "2020-09-15T12:59:18Z", "message": "[temp] Executing e2e tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTA3OTMy", "url": "https://github.com/apache/flink/pull/13374#pullrequestreview-489507932", "createdAt": "2020-09-16T10:56:03Z", "commit": {"oid": "d4d102deec879c175dc8cc9b16b342b96dce2650"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDo1NjowM1rOHSrbMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDo1NjowM1rOHSrbMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0Nzg5MA==", "bodyText": "1.11.2", "url": "https://github.com/apache/flink/pull/13374#discussion_r489347890", "createdAt": "2020-09-16T10:56:03Z", "author": {"login": "pnowojski"}, "path": "docs/release-notes/flink-1.10.md", "diffHunk": "@@ -468,3 +468,9 @@ deprecated in favor of `RocksDBOptionsFactory` and\n #### Incompatibility of serialized JobGraphs ([FLINK-14594](https://issues.apache.org/jira/browse/FLINK-14594))\n Serialized `JobGraphs` which set the `ResourceSpec` created by Flink versions < `1.10` are no longer compatible with Flink >= `1.10`. \n If you want to migrate these jobs to Flink >= `1.10` you will have to stop the job with a savepoint and then resume it from this savepoint on the Flink >= `1.10` cluster.\n+\n+#### Disabled chaining of file reading through ContinuousFileReaderOperator (1.10.3).\n+     \n+Any `readFile` or `readTextFile` of `DataStream` creates a `ContinuousFileReaderOperator` that used to be chained to subsequent operators.\n+However, chained operator do not trigger processing time timers correctly, leading to bugs in watermark assigners (FLINK-19109). As a workaround,\n+chaining of `ContinuousFileReaderOperator` is disabled. Flink 1.11.1 and later fixes the underlying problem and re-allows chaining. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4d102deec879c175dc8cc9b16b342b96dce2650"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4dc56a032b478c55ef99ed35544e9192b2e10d8", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/c4dc56a032b478c55ef99ed35544e9192b2e10d8", "committedDate": "2020-09-16T12:21:26Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e1f8916c7c4fa73cdf51e04a7b172f4da7d1977", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/7e1f8916c7c4fa73cdf51e04a7b172f4da7d1977", "committedDate": "2020-09-15T12:59:18Z", "message": "[temp] Executing e2e tests."}, "afterCommit": {"oid": "c4dc56a032b478c55ef99ed35544e9192b2e10d8", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/c4dc56a032b478c55ef99ed35544e9192b2e10d8", "committedDate": "2020-09-16T12:21:26Z", "message": "[FLINK-19109][streaming] Disallow chaining of ContinuousFileReaderOperator.\n\nWhen CFRO is not actively reading from a split, its inside some poll loop where no mail is being processed. Hence, downstream operators cannot rely on processing timers among other things being reliably triggered."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3883, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}