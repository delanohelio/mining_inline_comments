{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NDUxNjQ2", "number": 13121, "title": "[FLINK-15793][k8s] Replace kubernetes-entry.sh with unified docker-entrypoint.sh", "bodyText": "What is the purpose of the change\nCurrently, the native K8s integration does not using the existing script(e.g. jobmanager.sh, taskmanager.sh) to start JobManager and TaskManager. Instead, the java start command is generate by Flink internally(i.e. KubernetesClusterDescriptor, KubernetesResourceManager).\nIn this PR apache/flink-docker#37, we have integrated the functionality of kubernetes-entry.sh to the unified docker-entrypoint.sh.\nThis PR tries to remove the kubernetes-entry.sh completely.\nHow to enable the plugin after this PR?\nflink run-application -t kubernetes-application -Dkubernetes.cluster-id=k8s-ha-app1 ...\n-Dcontainerized.master.env.ENABLE_BUILT_IN_PLUGINS=flink-oss-fs-hadoop-1.11.1.jar \\\n-Dcontainerized.taskmanager.env.ENABLE_BUILT_IN_PLUGINS=flink-oss-fs-hadoop-1.11.1.jar \\\nlocal:///opt/flink/examples/streaming/StateMachineExample.jar\n\nBrief change log\n\nReplace kubernetes-entry.sh with unified docker-entrypoint.sh\n\nVerifying this change\n\nThis PR is covered by existing unit tests(some tests need to be updated).\nThe E2E tests(test_kubernetes_session.sh, test_kubernetes_application.sh`) should pass without modification.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-08-12T01:48:31Z", "url": "https://github.com/apache/flink/pull/13121", "merged": true, "mergeCommit": {"oid": "5db513770b5b3205b4948ecd8ffdc6327177ad52"}, "closed": true, "closedAt": "2020-08-21T07:11:53Z", "author": {"login": "wangyang0918"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_uaesAFqTQ2ODI3OTMxNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA7rIsgBqjM2Nzc4MDY3NTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4Mjc5MzE0", "url": "https://github.com/apache/flink/pull/13121#pullrequestreview-468279314", "createdAt": "2020-08-17T08:47:52Z", "commit": {"oid": "a572964939815f96ee78d0ff1939bf444812b7da"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57568ba2aee25f194628c582c4f0b43f3704b2d0", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/57568ba2aee25f194628c582c4f0b43f3704b2d0", "committedDate": "2020-08-18T06:48:21Z", "message": "[FLINK-15793][k8s] Replace kubernetes-entry.sh with unified docker-entrypoint.sh"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a572964939815f96ee78d0ff1939bf444812b7da", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/a572964939815f96ee78d0ff1939bf444812b7da", "committedDate": "2020-08-11T11:18:02Z", "message": "[FLINK-15793][k8s] Replace kubernetes-entry.sh with unified docker-entrypoint.sh"}, "afterCommit": {"oid": "8c486a2bf8f9b604acddc6ea5b3d81413aa300b3", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/8c486a2bf8f9b604acddc6ea5b3d81413aa300b3", "committedDate": "2020-08-19T10:49:29Z", "message": "[FLINK-15793][e2e] Add E2E test to enable plugin for native K8s"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzYzMDM0", "url": "https://github.com/apache/flink/pull/13121#pullrequestreview-470363034", "createdAt": "2020-08-19T11:24:57Z", "commit": {"oid": "8c486a2bf8f9b604acddc6ea5b3d81413aa300b3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMToyNDo1N1rOHDC8fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMToyNTozM1rOHDC94A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NjAyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In order to use [plugins]({{ site.baseurl }}/ops/plugins.html), they must be copied to the correct location in the Flink JobManager/TaskManager pod for them to work.\n          \n          \n            \n            In order to use [plugins]({{ site.baseurl }}/ops/plugins.html), they must be copied to the correct location in the Flink JobManager/TaskManager pod for them to work. You can use the built-in plugins without mounting a volume or building a custom Docker image.", "url": "https://github.com/apache/flink/pull/13121#discussion_r472956028", "createdAt": "2020-08-19T11:24:57Z", "author": {"login": "rmetzger"}, "path": "docs/ops/deployment/native_kubernetes.md", "diffHunk": "@@ -195,6 +188,28 @@ As always, Jobs may stop when manually canceled or, in the case of bounded Jobs,\n $ ./bin/flink cancel -t kubernetes-application -Dkubernetes.cluster-id=<ClusterID> <JobID>\n {% endhighlight %}\n \n+\n+## Log Files\n+\n+By default, the JobManager and TaskManager will output the logs to the console and `/opt/flink/log` in each pod simultaneously.\n+The STDOUT and STDERR will only be redirected to the console. You can access them via `kubectl logs <PodName>`.\n+\n+If the pod is running, you can also use `kubectl exec -it <PodName> bash` to tunnel in and view the logs or debug the process.\n+\n+## Using plugins\n+\n+In order to use [plugins]({{ site.baseurl }}/ops/plugins.html), they must be copied to the correct location in the Flink JobManager/TaskManager pod for them to work.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c486a2bf8f9b604acddc6ea5b3d81413aa300b3"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NjM4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use the following command to pass the environment variable to enable the S3 plugin for Flink application.\n          \n          \n            \n            For example, use the following command to pass the environment variable to enable the S3 plugin for your Flink application.", "url": "https://github.com/apache/flink/pull/13121#discussion_r472956384", "createdAt": "2020-08-19T11:25:33Z", "author": {"login": "rmetzger"}, "path": "docs/ops/deployment/native_kubernetes.md", "diffHunk": "@@ -195,6 +188,28 @@ As always, Jobs may stop when manually canceled or, in the case of bounded Jobs,\n $ ./bin/flink cancel -t kubernetes-application -Dkubernetes.cluster-id=<ClusterID> <JobID>\n {% endhighlight %}\n \n+\n+## Log Files\n+\n+By default, the JobManager and TaskManager will output the logs to the console and `/opt/flink/log` in each pod simultaneously.\n+The STDOUT and STDERR will only be redirected to the console. You can access them via `kubectl logs <PodName>`.\n+\n+If the pod is running, you can also use `kubectl exec -it <PodName> bash` to tunnel in and view the logs or debug the process.\n+\n+## Using plugins\n+\n+In order to use [plugins]({{ site.baseurl }}/ops/plugins.html), they must be copied to the correct location in the Flink JobManager/TaskManager pod for them to work.\n+Use the following command to pass the environment variable to enable the S3 plugin for Flink application.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c486a2bf8f9b604acddc6ea5b3d81413aa300b3"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09cf70a730004041c2e87c7fcfba180b0df30c23", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/09cf70a730004041c2e87c7fcfba180b0df30c23", "committedDate": "2020-08-21T02:47:53Z", "message": "[FLINK-15793][doc] Update documentation to show how to enable plugins for native K8s"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ee447492523e9667843a55990f5a8797c24fa45", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/3ee447492523e9667843a55990f5a8797c24fa45", "committedDate": "2020-08-21T02:47:53Z", "message": "[FLINK-15793][e2e] Add E2E test to enable plugin for native K8s"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c486a2bf8f9b604acddc6ea5b3d81413aa300b3", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/8c486a2bf8f9b604acddc6ea5b3d81413aa300b3", "committedDate": "2020-08-19T10:49:29Z", "message": "[FLINK-15793][e2e] Add E2E test to enable plugin for native K8s"}, "afterCommit": {"oid": "3ee447492523e9667843a55990f5a8797c24fa45", "author": {"user": {"login": "wangyang0918", "name": "Yang Wang"}}, "url": "https://github.com/apache/flink/commit/3ee447492523e9667843a55990f5a8797c24fa45", "committedDate": "2020-08-21T02:47:53Z", "message": "[FLINK-15793][e2e] Add E2E test to enable plugin for native K8s"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4817, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}