{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjgyMTky", "number": 11489, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTowODo1MFrODqpQ5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNzo1OFrODqpV_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQyODU1OnYy", "diffSide": "RIGHT", "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/parameters/KubernetesJobManagerParameters.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTowODo1MFrOF6hKHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0MjoyNFrOF6qYLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNDk5MQ==", "bodyText": "According to the order, the users can override the built-in labels by customization. I think the built-in labels should prioritize the user-specified ones. WDYT?", "url": "https://github.com/apache/flink/pull/11489#discussion_r396904991", "createdAt": "2020-03-24T05:08:50Z", "author": {"login": "zhengcanbin"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/parameters/KubernetesJobManagerParameters.java", "diffHunk": "@@ -52,10 +54,16 @@ public KubernetesJobManagerParameters(Configuration flinkConfig, ClusterSpecific\n \n \t@Override\n \tpublic Map<String, String> getLabels() {\n-\t\tMap<String, String> labels = getCommonLabels();\n+\t\tfinal Map<String, String> labels = new HashMap<>(getCommonLabels());\n \t\tlabels.put(Constants.LABEL_COMPONENT_KEY, Constants.LABEL_COMPONENT_JOB_MANAGER);\n+\t\tflinkConfig.getOptional(KubernetesConfigOptions.JOB_MANAGER_LABELS).ifPresent(labels::putAll);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NjA0Nw==", "bodyText": "I think you are right. I will prioritize the built-in labels.", "url": "https://github.com/apache/flink/pull/11489#discussion_r397056047", "createdAt": "2020-03-24T10:42:24Z", "author": {"login": "wangyang0918"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/parameters/KubernetesJobManagerParameters.java", "diffHunk": "@@ -52,10 +54,16 @@ public KubernetesJobManagerParameters(Configuration flinkConfig, ClusterSpecific\n \n \t@Override\n \tpublic Map<String, String> getLabels() {\n-\t\tMap<String, String> labels = getCommonLabels();\n+\t\tfinal Map<String, String> labels = new HashMap<>(getCommonLabels());\n \t\tlabels.put(Constants.LABEL_COMPONENT_KEY, Constants.LABEL_COMPONENT_JOB_MANAGER);\n+\t\tflinkConfig.getOptional(KubernetesConfigOptions.JOB_MANAGER_LABELS).ifPresent(labels::putAll);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNDk5MQ=="}, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQzNzcxOnYy", "diffSide": "RIGHT", "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/configuration/KubernetesConfigOptions.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNDo1OVrOF6hPag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMTowMTo1OVrOF6rEbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjM0Ng==", "bodyText": "How about changing the key from kubernetes.jobmanager.node-selector to kubernetes.jobmanager.node-selectors? We use the plural for the user-specified annotations and labels, in the meantime use the singular for the node-selector. Could we use a consistent key naming convention for these kind of config options?", "url": "https://github.com/apache/flink/pull/11489#discussion_r396906346", "createdAt": "2020-03-24T05:14:59Z", "author": {"login": "zhengcanbin"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/configuration/KubernetesConfigOptions.java", "diffHunk": "@@ -111,6 +112,34 @@\n \t// The following config options could be overridden by KubernetesCliOptions.\n \t// ---------------------------------------------------------------------------------\n \n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.jobmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for JobManager pod. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> TASK_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.taskmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for TaskManager pods. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_NODE_SELECTOR =\n+\t\tkey(\"kubernetes.jobmanager.node-selector\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NTU4Ng==", "bodyText": "I use singular for node-selector because in the K8s yaml file it is always singular. For labels and annotations, they are plural. So i am just trying to keep the same behavior with K8s document.\nIf you insist of changing it to node-selectors, i could update it.", "url": "https://github.com/apache/flink/pull/11489#discussion_r397055586", "createdAt": "2020-03-24T10:41:33Z", "author": {"login": "wangyang0918"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/configuration/KubernetesConfigOptions.java", "diffHunk": "@@ -111,6 +112,34 @@\n \t// The following config options could be overridden by KubernetesCliOptions.\n \t// ---------------------------------------------------------------------------------\n \n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.jobmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for JobManager pod. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> TASK_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.taskmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for TaskManager pods. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_NODE_SELECTOR =\n+\t\tkey(\"kubernetes.jobmanager.node-selector\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjM0Ng=="}, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2NzM3NQ==", "bodyText": "I use singular for node-selector because in the K8s yaml file it is always singular. For labels and annotations, they are plural. So i am just trying to keep the same behavior with K8s document.\nIf you insist of changing it to node-selectors, i could update it.\n\nIndeed, the K8s use the singular for node-selector. I think you are right, we'd better try our best to keep consistent with the K8s side.", "url": "https://github.com/apache/flink/pull/11489#discussion_r397067375", "createdAt": "2020-03-24T11:01:59Z", "author": {"login": "zhengcanbin"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/configuration/KubernetesConfigOptions.java", "diffHunk": "@@ -111,6 +112,34 @@\n \t// The following config options could be overridden by KubernetesCliOptions.\n \t// ---------------------------------------------------------------------------------\n \n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.jobmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for JobManager pod. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> TASK_MANAGER_LABELS =\n+\t\tkey(\"kubernetes.taskmanager.labels\")\n+\t\t.mapType()\n+\t\t.noDefaultValue()\n+\t\t.withDescription(\"The labels to be set for TaskManager pods. Specified as key:value pairs separated by commas. \" +\n+\t\t\t\"For example, version:alphav1,deploy:test.\");\n+\n+\tpublic static final ConfigOption<Map<String, String>> JOB_MANAGER_NODE_SELECTOR =\n+\t\tkey(\"kubernetes.jobmanager.node-selector\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjM0Ng=="}, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDQ0MTU5OnYy", "diffSide": "RIGHT", "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/parameters/KubernetesTaskManagerParameters.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNzo1OFrOF6hR3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxNzo1OFrOF6hR3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjk3Mw==", "bodyText": "The same precedence problem?", "url": "https://github.com/apache/flink/pull/11489#discussion_r396906973", "createdAt": "2020-03-24T05:17:58Z", "author": {"login": "zhengcanbin"}, "path": "flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/parameters/KubernetesTaskManagerParameters.java", "diffHunk": "@@ -59,7 +62,15 @@ public KubernetesTaskManagerParameters(\n \n \t@Override\n \tpublic Map<String, String> getLabels() {\n-\t\treturn KubernetesUtils.getTaskManagerLabels(getClusterId());\n+\t\tfinal Map<String, String> labels = new HashMap<>(KubernetesUtils.getTaskManagerLabels(getClusterId()));\n+\t\tflinkConfig.getOptional(KubernetesConfigOptions.TASK_MANAGER_LABELS).ifPresent(labels::putAll);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb02ce865fa48c9259500a8408897605534b35c2"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 686, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}