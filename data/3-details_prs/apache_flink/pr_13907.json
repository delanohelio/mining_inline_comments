{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NzA0OTA3", "number": 13907, "title": "[FLINK-19942][Connectors / JDBC]Support sink parallelism configuration to JDBC connector", "bodyText": "What is the purpose of the change\nSupport sink parallelism configuration to JDBC connector\nBrief change log\n\nSupport sink parallelism configuration to JDBC connector\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nJdbcDynamicTableFactoryTest#testJDBCSinkWithParallelism\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (no)", "createdAt": "2020-11-03T12:37:07Z", "url": "https://github.com/apache/flink/pull/13907", "merged": true, "mergeCommit": {"oid": "2ac47353f45c17b14f5d474fae6276bfb7be3870"}, "closed": true, "closedAt": "2020-12-22T02:58:35Z", "author": {"login": "zhuxiaoshang"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkYOUMAFqTU0NDY4OTk0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoNETGABqjQxMzQwNzk2ODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njg5OTQz", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-544689943", "createdAt": "2020-12-04T06:37:09Z", "commit": {"oid": "49181d26aa6a07bc289544ad0d55929fd2c89377"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjozNzoxMFrOH_C4Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjozNzoxMFrOH_C4Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTQ3MQ==", "bodyText": "does the equals and hash function need to be modify? @zhuxiaoshang", "url": "https://github.com/apache/flink/pull/13907#discussion_r535869471", "createdAt": "2020-12-04T06:37:10Z", "author": {"login": "zhisheng17"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -55,6 +61,10 @@ public int getMaxRetries() {\n \t\treturn maxRetries;\n \t}\n \n+\tpublic Integer getParallelism() {\n+\t\treturn parallelism;\n+\t}\n+\n \t@Override\n \tpublic boolean equals(Object o) {\n \t\tif (this == o) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49181d26aa6a07bc289544ad0d55929fd2c89377"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODY4NDU4", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-547868458", "createdAt": "2020-12-09T06:13:36Z", "commit": {"oid": "f4f1cf14d4d413c4c87881516215c7ffffd5be64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjoxMzozN1rOICENVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjoxMzozN1rOICENVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzNzAxMw==", "bodyText": "Will return false when parallelism > 128?", "url": "https://github.com/apache/flink/pull/13907#discussion_r539037013", "createdAt": "2020-12-09T06:13:37Z", "author": {"login": "V1ncentzzZ"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -66,12 +76,13 @@ public boolean equals(Object o) {\n \t\tJdbcExecutionOptions that = (JdbcExecutionOptions) o;\n \t\treturn batchIntervalMs == that.batchIntervalMs &&\n \t\t\tbatchSize == that.batchSize &&\n-\t\t\tmaxRetries == that.maxRetries;\n+\t\t\tmaxRetries == that.maxRetries &&\n+\t\t\tparallelism == that.parallelism;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f1cf14d4d413c4c87881516215c7ffffd5be64"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODcwMzU5", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-547870359", "createdAt": "2020-12-09T06:18:25Z", "commit": {"oid": "f4f1cf14d4d413c4c87881516215c7ffffd5be64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjoxODoyNVrOICEUQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjoxODoyNVrOICEUQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzODc4Ng==", "bodyText": "@zhuxiaoshang maybe, idea will recommend to use equals() instead of ==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539038786", "createdAt": "2020-12-09T06:18:25Z", "author": {"login": "zhisheng17"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -66,12 +76,13 @@ public boolean equals(Object o) {\n \t\tJdbcExecutionOptions that = (JdbcExecutionOptions) o;\n \t\treturn batchIntervalMs == that.batchIntervalMs &&\n \t\t\tbatchSize == that.batchSize &&\n-\t\t\tmaxRetries == that.maxRetries;\n+\t\t\tmaxRetries == that.maxRetries &&\n+\t\t\tparallelism == that.parallelism;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f1cf14d4d413c4c87881516215c7ffffd5be64"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTI1MDEz", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-547925013", "createdAt": "2020-12-09T08:06:09Z", "commit": {"oid": "a20a54634b452b7a9fbc28e3a292196376602b3f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODowNjowOVrOICHWTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODowNjowOVrOICHWTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4ODQ2Mg==", "bodyText": "It's seem this method is useless now? If no one uses it, please delete it. Otherwise, we can just treat this method as\nof(outputFormat, null)", "url": "https://github.com/apache/flink/pull/13907#discussion_r539088462", "createdAt": "2020-12-09T08:06:09Z", "author": {"login": "fsk119"}, "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/OutputFormatProvider.java", "diffHunk": "@@ -36,6 +38,23 @@ static OutputFormatProvider of(OutputFormat<RowData> outputFormat) {\n \t\treturn () -> outputFormat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a20a54634b452b7a9fbc28e3a292196376602b3f"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a20a54634b452b7a9fbc28e3a292196376602b3f", "author": {"user": {"login": "zhuxiaoshang", "name": null}}, "url": "https://github.com/apache/flink/commit/a20a54634b452b7a9fbc28e3a292196376602b3f", "committedDate": "2020-12-09T06:28:21Z", "message": "Update JdbcExecutionOptions.java"}, "afterCommit": {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/5ba8c4410ef2616561f46462d1000056949e8c6b", "committedDate": "2020-12-09T09:19:55Z", "message": "[FLINK-19942][Connectors / JDBC]Support sink parallelism configuration to JDBC connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5Nzg1NTQ0", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-549785544", "createdAt": "2020-12-11T03:59:00Z", "commit": {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODY2OTYy", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-549866962", "createdAt": "2020-12-11T07:50:08Z", "commit": {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzo1Mzo0OFrOIDtA2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODowNDoxNlrOIDtUaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDEzNg==", "bodyText": "This is a public API. Please add a new method instead of changing the existing one, otherwise, it's not API compatible.", "url": "https://github.com/apache/flink/pull/13907#discussion_r540754136", "createdAt": "2020-12-11T07:53:48Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/OutputFormatProvider.java", "diffHunk": "@@ -23,17 +23,29 @@\n import org.apache.flink.table.connector.ParallelismProvider;\n import org.apache.flink.table.data.RowData;\n \n+import java.util.Optional;\n+\n /**\n  * Provider of an {@link OutputFormat} instance as a runtime implementation for {@link DynamicTableSink}.\n  */\n @PublicEvolving\n public interface OutputFormatProvider extends DynamicTableSink.SinkRuntimeProvider, ParallelismProvider {\n \n \t/**\n-\t * Helper method for creating a static provider.\n+\t * Helper method for creating a static provider with a provided sink parallelism.\n \t */\n-\tstatic OutputFormatProvider of(OutputFormat<RowData> outputFormat) {\n-\t\treturn () -> outputFormat;\n+\tstatic OutputFormatProvider of(OutputFormat<RowData> outputFormat, Integer sinkParallelism) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1OTE0Nw==", "bodyText": "I'm not sure about adding this to JdbcExecutionOptions, because JdbcExecutionOptions is an public API for JdbcSink. For JdbcSink#sink, this may looks weird because the configured parallelism doesn't work as the returned object is SinkFunction.\nAnother option is adding the parallelism to JdbcDmlOption or JdbcOption, they are both internal class.", "url": "https://github.com/apache/flink/pull/13907#discussion_r540759147", "createdAt": "2020-12-11T08:04:16Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -35,12 +35,18 @@\n \tprivate final long batchIntervalMs;\n \tprivate final int batchSize;\n \tprivate final int maxRetries;\n+\tprivate final Integer parallelism;\n \n-\tprivate JdbcExecutionOptions(long batchIntervalMs, int batchSize, int maxRetries) {\n+\tprivate JdbcExecutionOptions(\n+\t\t\tlong batchIntervalMs,\n+\t\t\tint batchSize,\n+\t\t\tint maxRetries,\n+\t\t\tInteger parallelism) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5OTYzNjYy", "url": "https://github.com/apache/flink/pull/13907#pullrequestreview-549963662", "createdAt": "2020-12-11T10:10:13Z", "commit": {"oid": "6acdd717e9e7a4f23bf7d798e72b8e50c5ff4e83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "committedDate": "2020-12-21T03:06:24Z", "message": "[FLINK-19942][jdbc] Support sink parallelism configuration for JDBC connector\n\nThis closes #13907"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6acdd717e9e7a4f23bf7d798e72b8e50c5ff4e83", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/6acdd717e9e7a4f23bf7d798e72b8e50c5ff4e83", "committedDate": "2020-12-11T10:01:41Z", "message": "override hashCode"}, "afterCommit": {"oid": "9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "committedDate": "2020-12-21T03:06:24Z", "message": "[FLINK-19942][jdbc] Support sink parallelism configuration for JDBC connector\n\nThis closes #13907"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4723, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}