{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODAwNzc4", "number": 12269, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo0ODoxN1rOD-lasw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMzowODoxMFrOD-lx1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTUxMzQ3OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo0ODoxN1rOGYxg0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMjo1MzozOVrOGaNIPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDIyNA==", "bodyText": "I think using org.junit.Test#expected (and a specific exception class) would be more expressive and less verbose here.", "url": "https://github.com/apache/flink/pull/12269#discussion_r428630224", "createdAt": "2020-05-21T12:48:17Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxNjE4NQ==", "bodyText": "Hmm, I think different people have quite different tastes :-)\nI am doing it so because the rest of the tests are using the try-catch-fail style. But I am fine with either way.\nDo you insist on this? I can make the change if you do :-)", "url": "https://github.com/apache/flink/pull/12269#discussion_r429016185", "createdAt": "2020-05-22T02:50:44Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDIyNA=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzMzgwMA==", "bodyText": "No, I don't insist :)", "url": "https://github.com/apache/flink/pull/12269#discussion_r429233800", "createdAt": "2020-05-22T13:04:57Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDIyNA=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEzMTI2Mw==", "bodyText": "Ha, then I will mark this as resolved.", "url": "https://github.com/apache/flink/pull/12269#discussion_r430131263", "createdAt": "2020-05-26T02:53:39Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDIyNA=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTUxNzU0OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo0OTo1MVrOGYxjfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMzowMjowNVrOGZJN_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDkxMA==", "bodyText": "Why do we need to handle this error? Won't it's stacktrace be printed and test fail anyways?", "url": "https://github.com/apache/flink/pull/12269#discussion_r428630910", "createdAt": "2020-05-21T12:49:51Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());\n+\t\t} finally {\n+\t\t\ttry {\n+\t\t\t\tcoord.shutdown(JobStatus.FINISHED);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\te.printStackTrace();\n+\t\t\t\tfail(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxODYyMQ==", "bodyText": "Ha, I think you mean to throw the exception directly from the test function.\nYep, that should also work. It is indeed a bit verbose here.", "url": "https://github.com/apache/flink/pull/12269#discussion_r429018621", "createdAt": "2020-05-22T03:02:05Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());\n+\n+\t\t\tcoord.abortPendingCheckpoints(new CheckpointException(CHECKPOINT_EXPIRED));\n+\n+\t\t\tfail(\"Test failed.\");\n+\t\t}\n+\t\tcatch (Exception e) {\n+\t\t\t//expected\n+\t\t\tassertTrue(e instanceof RuntimeException);\n+\t\t\tassertEquals(errorMsg, e.getMessage());\n+\t\t} finally {\n+\t\t\ttry {\n+\t\t\t\tcoord.shutdown(JobStatus.FINISHED);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\te.printStackTrace();\n+\t\t\t\tfail(e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMDkxMA=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTUyNjQ4OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo1Mjo0OFrOGYxpAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMjozOToxMlrOGaM87A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMjMyMQ==", "bodyText": "I think this check is not necessary here because triggering should be tested separately\n(and the next check should fail anyways if trigger failed)", "url": "https://github.com/apache/flink/pull/12269#discussion_r428632321", "createdAt": "2020-05-21T12:52:48Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyNDAzNw==", "bodyText": "Hmm, I do not think it is used to test triggering. I guess it is to make sure the exception is from coord.abortPendingCheckpoints, not from other places like triggering.\nMaybe it is an overkill?", "url": "https://github.com/apache/flink/pull/12269#discussion_r429024037", "createdAt": "2020-05-22T03:27:09Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMjMyMQ=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNTkyMg==", "bodyText": "to make sure the exception is from coord.abortPendingCheckpoints, not from other places like triggering\n\nException from other places should fail other tests.\nAlso, you could specify explicitly which exception is expected from this test, so any other exception will fail it.", "url": "https://github.com/apache/flink/pull/12269#discussion_r429235922", "createdAt": "2020-05-22T13:09:37Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMjMyMQ=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEyODM2NA==", "bodyText": "to make sure the exception is from coord.abortPendingCheckpoints, not from other places like triggering\n\nException from other places should fail other tests.\nAlso, you could specify explicitly which exception is expected from this test, so any other exception will fail it.\n\nyeah, that's right. I will remove it.", "url": "https://github.com/apache/flink/pull/12269#discussion_r430128364", "createdAt": "2020-05-26T02:39:12Z", "author": {"login": "curcur"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed\n+\t\t\tfinal CompletableFuture<CompletedCheckpoint> checkPointFuture = coord.triggerCheckpoint(false);\n+\t\t\tmanuallyTriggeredScheduledExecutor.triggerAll();\n+\t\t\tassertFalse(checkPointFuture.isCompletedExceptionally());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMjMyMQ=="}, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTUzMjc4OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo1NDo1OVrOGYxs-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo1NDo1OVrOGYxs-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMzMzOA==", "bodyText": "nit: this comment basically repeats what the code does, I think it's unnecessary", "url": "https://github.com/apache/flink/pull/12269#discussion_r428633338", "createdAt": "2020-05-21T12:54:59Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -262,6 +251,40 @@ public void failJobDueToTaskFailure(Throwable cause, ExecutionAttemptID failingT\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testExpiredCheckpointExceedsTolerableFailureNumber() {\n+\t\t// create some mock Execution vertices that receive the checkpoint trigger messages\n+\t\tExecutionVertex vertex1 = mockExecutionVertex(new ExecutionAttemptID());\n+\t\tExecutionVertex vertex2 = mockExecutionVertex(new ExecutionAttemptID());\n+\n+\t\tfinal String errorMsg = \"Exceeded checkpoint failure tolerance number!\";\n+\t\tCheckpointFailureManager checkpointFailureManager = getCheckpointFailureManager(errorMsg);\n+\t\tCheckpointCoordinator coord = getCheckpointCoordinator(new JobID(), vertex1, vertex2, checkpointFailureManager);\n+\n+\t\ttry {\n+\t\t\t// trigger the checkpoint. this should succeed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTU3MjY5OnYy", "diffSide": "RIGHT", "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMzowODoxMFrOGYyGPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMzowODoxMFrOGYyGPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzOTgwNw==", "bodyText": "\ud83d\udc4d for extracting shared code", "url": "https://github.com/apache/flink/pull/12269#discussion_r428639807", "createdAt": "2020-05-21T13:08:10Z", "author": {"login": "rkhachatryan"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java", "diffHunk": "@@ -2292,6 +2315,22 @@ private CheckpointCoordinator getCheckpointCoordinator() {\n \t\t\t.build();\n \t}\n \n+\tprivate CheckpointFailureManager getCheckpointFailureManager(String errorMsg) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24c44fd00652a6b5859075b3afea1e4e9ca98445"}, "originalPosition": 83}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4533, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}