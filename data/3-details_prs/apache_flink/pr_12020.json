{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTcyNzEz", "number": 12020, "title": "[FLINK-17552][network] Do not cache InputChannels in UnionInputGate", "bodyText": "This is a simple fix for a bug on the master branch that is not visible currently in anyway, but which is causing an inconsistent state with UnionInputGate  if underlying channels are changing.\nVerifying this change\nThis change added a new unit test.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-05-07T09:40:09Z", "url": "https://github.com/apache/flink/pull/12020", "merged": true, "mergeCommit": {"oid": "35aea924e3a0dc2c370f5d7f25254db750bb3333"}, "closed": true, "closedAt": "2020-05-07T13:36:28Z", "author": {"login": "pnowojski"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce6DpKgBqjMzMTIwNzg5ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce9Z7CABqjMzMTI5MzA3OTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a007cc30e7b8afd3aa199331088c60ff80dae45", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/7a007cc30e7b8afd3aa199331088c60ff80dae45", "committedDate": "2020-05-07T09:36:25Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}, "afterCommit": {"oid": "70088254d856c0b18e664e5e05105b536502ac3d", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/70088254d856c0b18e664e5e05105b536502ac3d", "committedDate": "2020-05-07T09:42:07Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70088254d856c0b18e664e5e05105b536502ac3d", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/70088254d856c0b18e664e5e05105b536502ac3d", "committedDate": "2020-05-07T09:42:07Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}, "afterCommit": {"oid": "4203b2dffa8493394a8f9c3dc5723801b15dd163", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/4203b2dffa8493394a8f9c3dc5723801b15dd163", "committedDate": "2020-05-07T09:49:30Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzI5MDEw", "url": "https://github.com/apache/flink/pull/12020#pullrequestreview-407329010", "createdAt": "2020-05-07T10:05:33Z", "commit": {"oid": "ccd796d1e157abf7052996f185b80bccc1e5b5dc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDowNTozM1rOGR3mFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDowNTozM1rOGR3mFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4OTg0Nw==", "bodyText": "total = Arrays.stream(inputGates).mapToInt(IndexedInputGate::getNumberOfInputChannels).sum() ?", "url": "https://github.com/apache/flink/pull/12020#discussion_r421389847", "createdAt": "2020-05-07T10:05:33Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/UnionInputGate.java", "diffHunk": "@@ -101,14 +99,19 @@ public UnionInputGate(IndexedInputGate... inputGates) {\n \n \t\tfinal int maxGateIndex = Arrays.stream(inputGates).mapToInt(IndexedInputGate::getGateIndex).max().orElse(0);\n \t\tinputGateChannelIndexOffsets = new int[maxGateIndex + 1];\n+\t\tint totalNumberOfInputChannels = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccd796d1e157abf7052996f185b80bccc1e5b5dc"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d86f6e4d02824dbb3747e67f1e515be8f55c1e4", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/1d86f6e4d02824dbb3747e67f1e515be8f55c1e4", "committedDate": "2020-05-07T10:44:16Z", "message": "[FLINK-17552][network] Do not cache InputChannels in UnionInputGate\n\nThis is a simple fix for a bug on the master branch that is not visible currently in anyway, but which is causing\nan inconsistent state with UnionInputGate if underlying channels are updated inside SingleInputGate"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4203b2dffa8493394a8f9c3dc5723801b15dd163", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/4203b2dffa8493394a8f9c3dc5723801b15dd163", "committedDate": "2020-05-07T09:49:30Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}, "afterCommit": {"oid": "6dad1301491a163324578ea1c3ae3a98355888b6", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/6dad1301491a163324578ea1c3ae3a98355888b6", "committedDate": "2020-05-07T10:44:17Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzkwNDEy", "url": "https://github.com/apache/flink/pull/12020#pullrequestreview-407390412", "createdAt": "2020-05-07T11:41:30Z", "commit": {"oid": "f3cf37ca5100642d67f72382b5d01b1f3e974e16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMTo0MTozMVrOGR6oKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMTo0MTozMVrOGR6oKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQzOTUzMQ==", "bodyText": "nit: Add ChannelStateWriterImpl to commit msg.", "url": "https://github.com/apache/flink/pull/12020#discussion_r421439531", "createdAt": "2020-05-07T11:41:31Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/channel/ChannelStateWriterImpl.java", "diffHunk": "@@ -19,6 +19,8 @@\n \n import org.apache.flink.annotation.Internal;\n import org.apache.flink.runtime.checkpoint.CheckpointOptions;\n+import org.apache.flink.runtime.event.AbstractEvent;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cf37ca5100642d67f72382b5d01b1f3e974e16"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb91c3f912e993b65f5d592b467c3e052218ab3", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/abb91c3f912e993b65f5d592b467c3e052218ab3", "committedDate": "2020-05-07T13:32:20Z", "message": "[hotfix][network] Improve error message in ChannelStateWriterImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6d125b56355296b67542900256948ca7de714c9", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/e6d125b56355296b67542900256948ca7de714c9", "committedDate": "2020-05-07T13:32:32Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dad1301491a163324578ea1c3ae3a98355888b6", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/6dad1301491a163324578ea1c3ae3a98355888b6", "committedDate": "2020-05-07T10:44:17Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}, "afterCommit": {"oid": "e6d125b56355296b67542900256948ca7de714c9", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/e6d125b56355296b67542900256948ca7de714c9", "committedDate": "2020-05-07T13:32:32Z", "message": "[hotfix][network] Add debug message marking end of output recovery for unaligned checkpoints"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4648, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}