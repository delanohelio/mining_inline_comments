{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMTAxNTI2", "number": 13356, "title": "[FLINK-16789][runtime][rest] Enable JMX RMI port retrieval via REST API", "bodyText": "What is the purpose of the change\nAdd JMX RMI port retrieval in the REST API in order to determine dynamic allocated ports.\nBrief change log\n(for example:)\n\nAdded JMXPort parameter in TaskManagerInfo & TaskManagerRegistration\nUpdated tests\nUpdated documents\n\nVerifying this change\nThis change is covered by modified tests.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? yes\nIf yes, how is the feature documented? regenerated documents", "createdAt": "2020-09-08T14:51:38Z", "url": "https://github.com/apache/flink/pull/13356", "merged": true, "mergeCommit": {"oid": "798c004076b18375050331a976b8dc56c6781fe7"}, "closed": true, "closedAt": "2020-09-29T09:18:43Z", "author": {"login": "walterddr"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHeWbIgFqTQ4NTc5NDA4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNf7fKgBqjM4MTczMjM3MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1Nzk0MDgw", "url": "https://github.com/apache/flink/pull/13356#pullrequestreview-485794080", "createdAt": "2020-09-10T10:26:47Z", "commit": {"oid": "656789f8c2f1288e3b9cf369f82d0698b249f179"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDoyNjo0N1rOHPtN5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDozMTo0NVrOHPtYdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzMTUyNw==", "bodyText": "@zentol It seems that the documentation generation is not deterministic?", "url": "https://github.com/apache/flink/pull/13356#discussion_r486231527", "createdAt": "2020-09-10T10:26:47Z", "author": {"login": "rmetzger"}, "path": "docs/_includes/generated/execution_config_configuration.html", "diffHunk": "@@ -106,6 +100,12 @@\n             <td>Boolean</td>\n             <td>Whether to compress spilled data. Currently we only support compress spilled data for sort and hash-agg and hash-join operators.</td>\n         </tr>\n+        <tr>\n+            <td><h5>table.exec.state.ttl</h5><br> <span class=\"label label-primary\">Streaming</span></td>\n+            <td style=\"word-wrap: break-word;\">0 ms</td>\n+            <td>Duration</td>\n+            <td>Specifies a minimum time interval for how long idle state (i.e. state which was not updated), will be retained. State will never be cleared until it was idle for less than the minimum time, and will be cleared at some time after it was idle. Default is never clean-up the state. NOTE: Cleaning up state requires additional overhead for bookkeeping. Default value is 0, which means that it will never clean up state.</td>\n+        </tr>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "656789f8c2f1288e3b9cf369f82d0698b249f179"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzMzczNw==", "bodyText": "Why is this file generated now? (I don't see a code change that triggers this)", "url": "https://github.com/apache/flink/pull/13356#discussion_r486233737", "createdAt": "2020-09-10T10:30:49Z", "author": {"login": "rmetzger"}, "path": "docs/_includes/generated/jmx_server_configuration.html", "diffHunk": "@@ -0,0 +1,18 @@\n+<table class=\"table table-bordered\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "656789f8c2f1288e3b9cf369f82d0698b249f179"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNDIzMQ==", "bodyText": "It would be good to understand where these changes are coming from -- I want to avoid a situation where the next person generating docs will change the order again.", "url": "https://github.com/apache/flink/pull/13356#discussion_r486234231", "createdAt": "2020-09-10T10:31:45Z", "author": {"login": "rmetzger"}, "path": "docs/_includes/generated/execution_config_configuration.html", "diffHunk": "@@ -106,6 +100,12 @@\n             <td>Boolean</td>\n             <td>Whether to compress spilled data. Currently we only support compress spilled data for sort and hash-agg and hash-join operators.</td>\n         </tr>\n+        <tr>\n+            <td><h5>table.exec.state.ttl</h5><br> <span class=\"label label-primary\">Streaming</span></td>\n+            <td style=\"word-wrap: break-word;\">0 ms</td>\n+            <td>Duration</td>\n+            <td>Specifies a minimum time interval for how long idle state (i.e. state which was not updated), will be retained. State will never be cleared until it was idle for less than the minimum time, and will be cleared at some time after it was idle. Default is never clean-up the state. NOTE: Cleaning up state requires additional overhead for bookkeeping. Default value is 0, which means that it will never clean up state.</td>\n+        </tr>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzMTUyNw=="}, "originalCommit": {"oid": "656789f8c2f1288e3b9cf369f82d0698b249f179"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjQ2MDcw", "url": "https://github.com/apache/flink/pull/13356#pullrequestreview-487246070", "createdAt": "2020-09-12T18:03:37Z", "commit": {"oid": "060bb38dd26df122e05fc232cd730b35717e84b0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Mzg1OTE3", "url": "https://github.com/apache/flink/pull/13356#pullrequestreview-489385917", "createdAt": "2020-09-16T08:20:13Z", "commit": {"oid": "060bb38dd26df122e05fc232cd730b35717e84b0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwODoyMDoxNFrOHSlmiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwODoyNTo0MlrOHSlzsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1MjQ4OA==", "bodyText": "I would prefer a more general approach; basically just a Map<String, String> containing various meta-data bits. Then we could easily add information about other services and/or ports in the future.", "url": "https://github.com/apache/flink/pull/13356#discussion_r489252488", "createdAt": "2020-09-16T08:20:14Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/TaskExecutorRegistration.java", "diffHunk": "@@ -72,13 +77,15 @@ public TaskExecutorRegistration(\n \t\t\tfinal String taskExecutorAddress,\n \t\t\tfinal ResourceID resourceId,\n \t\t\tfinal int dataPort,\n+\t\t\tfinal int jmxPort,\n \t\t\tfinal HardwareDescription hardwareDescription,\n \t\t\tfinal TaskExecutorMemoryConfiguration memoryConfiguration,\n \t\t\tfinal ResourceProfile defaultSlotResourceProfile,\n \t\t\tfinal ResourceProfile totalResourceProfile) {\n \t\tthis.taskExecutorAddress = checkNotNull(taskExecutorAddress);\n \t\tthis.resourceId = checkNotNull(resourceId);\n \t\tthis.dataPort = dataPort;\n+\t\tthis.jmxPort = jmxPort;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "060bb38dd26df122e05fc232cd730b35717e84b0"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1NTg1Nw==", "bodyText": "This strikes me as an odd default value, and I could imagine this being misunderstood as \"running on some random port\". -1 may be a better choice, or even better, with my above suggestion of using a map, just not including it in the map at all.", "url": "https://github.com/apache/flink/pull/13356#discussion_r489255857", "createdAt": "2020-09-16T08:25:42Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/TaskExecutor.java", "diffHunk": "@@ -1130,6 +1131,7 @@ private void connectToResourceManager() {\n \t\t\tgetAddress(),\n \t\t\tgetResourceID(),\n \t\t\tunresolvedTaskManagerLocation.getDataPort(),\n+\t\t\tJMXService.getPort().orElse(0),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "060bb38dd26df122e05fc232cd730b35717e84b0"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "060bb38dd26df122e05fc232cd730b35717e84b0", "author": {"user": {"login": "walterddr", "name": "Rong Rong"}}, "url": "https://github.com/apache/flink/commit/060bb38dd26df122e05fc232cd730b35717e84b0", "committedDate": "2020-09-12T17:46:20Z", "message": "manually remove deleted configuration during doc gen"}, "afterCommit": {"oid": "c95d0e33b9cd23264c899aae7df75c83d290f129", "author": {"user": {"login": "walterddr", "name": "Rong Rong"}}, "url": "https://github.com/apache/flink/commit/c95d0e33b9cd23264c899aae7df75c83d290f129", "committedDate": "2020-09-26T18:18:51Z", "message": "set default jmxPort to -1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTYxNDgy", "url": "https://github.com/apache/flink/pull/13356#pullrequestreview-497561482", "createdAt": "2020-09-28T14:20:14Z", "commit": {"oid": "c95d0e33b9cd23264c899aae7df75c83d290f129"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoyMDoxNFrOHY__Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoyMDoxNFrOHY__Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk3NjI0Nw==", "bodyText": "this shouldn't be deleted; even if options are included in specific sections we also always generate a separate table for each originating file", "url": "https://github.com/apache/flink/pull/13356#discussion_r495976247", "createdAt": "2020-09-28T14:20:14Z", "author": {"login": "zentol"}, "path": "docs/_includes/generated/jmx_server_configuration.html", "diffHunk": "@@ -1,18 +0,0 @@\n-<table class=\"table table-bordered\">\n-    <thead>\n-        <tr>\n-            <th class=\"text-left\" style=\"width: 20%\">Key</th>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95d0e33b9cd23264c899aae7df75c83d290f129"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "174ea945be035310bd0f27bc3d00af5c815cda3d", "author": {"user": {"login": "walterddr", "name": "Rong Rong"}}, "url": "https://github.com/apache/flink/commit/174ea945be035310bd0f27bc3d00af5c815cda3d", "committedDate": "2020-09-29T03:49:45Z", "message": "[FLINK-16789][runtime] add in task manager jmx port to taskmanagers/:taskmanagerid endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c95d0e33b9cd23264c899aae7df75c83d290f129", "author": {"user": {"login": "walterddr", "name": "Rong Rong"}}, "url": "https://github.com/apache/flink/commit/c95d0e33b9cd23264c899aae7df75c83d290f129", "committedDate": "2020-09-26T18:18:51Z", "message": "set default jmxPort to -1"}, "afterCommit": {"oid": "174ea945be035310bd0f27bc3d00af5c815cda3d", "author": {"user": {"login": "walterddr", "name": "Rong Rong"}}, "url": "https://github.com/apache/flink/commit/174ea945be035310bd0f27bc3d00af5c815cda3d", "committedDate": "2020-09-29T03:49:45Z", "message": "[FLINK-16789][runtime] add in task manager jmx port to taskmanagers/:taskmanagerid endpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4525, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}