{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NTkyNTU4", "number": 11396, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzoxNToyNVrODn0-1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo0MDo1OFrODqYbzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMDg5MTEwOnYy", "diffSide": "LEFT", "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzoxNToyNVrOF2DLiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMjo1Nzo1NlrOF2zEsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIxOTUyOA==", "bodyText": "Do we need to remove this one? If yes, how about es6?", "url": "https://github.com/apache/flink/pull/11396#discussion_r392219528", "createdAt": "2020-03-13T13:15:25Z", "author": {"login": "libenchao"}, "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "diffHunk": "@@ -135,10 +131,6 @@ under the License.\n \t\t\t\t\t\t\t\t\t<pattern>org.elasticsearch</pattern>\n \t\t\t\t\t\t\t\t\t<shadedPattern>org.apache.flink.elasticsearch7.shaded.org.elasticsearch</shadedPattern>\n \t\t\t\t\t\t\t\t</relocation>\n-\t\t\t\t\t\t\t\t<relocation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28221f8d9b902110266893c9f4038ff1e6d89298"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAwNDIwOQ==", "bodyText": "Yes, sql-connector-es6 has been fixed in FLINK-16287.\nBTW, sql-connector-es6 is easier to found because  end2end test in sql_client_test cover, so this PR add e2e test for sql-connector-es7 too.", "url": "https://github.com/apache/flink/pull/11396#discussion_r393004209", "createdAt": "2020-03-16T12:57:56Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "diffHunk": "@@ -135,10 +131,6 @@ under the License.\n \t\t\t\t\t\t\t\t\t<pattern>org.elasticsearch</pattern>\n \t\t\t\t\t\t\t\t\t<shadedPattern>org.apache.flink.elasticsearch7.shaded.org.elasticsearch</shadedPattern>\n \t\t\t\t\t\t\t\t</relocation>\n-\t\t\t\t\t\t\t\t<relocation>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIxOTUyOA=="}, "originalCommit": {"oid": "28221f8d9b902110266893c9f4038ff1e6d89298"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODk0Nzc5OnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNjoyNzowNFrOF3PTBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNjo0MDoxMFrOF3PhxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2NjYzMA==", "bodyText": "We can use \"$ELASTICSEARCH_VERSION\" in SQL_CONF to avoid content replacement.", "url": "https://github.com/apache/flink/pull/11396#discussion_r393466630", "createdAt": "2020-03-17T06:27:04Z", "author": {"login": "wuchong"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -262,10 +271,66 @@ EOF\n JOB_ID=$($FLINK_DIR/bin/sql-client.sh embedded \\\n   --jar $KAFKA_SQL_JAR \\\n   --jar $JSON_SQL_JAR \\\n-  --jar $ELASTICSEARCH_SQL_JAR \\\n+  --jar $ELASTICSEARCH6_SQL_JAR \\\n   --jar $SQL_TOOLBOX_JAR \\\n   --environment $SQL_CONF \\\n-  --update \"$SQL_STATEMENT_5\" | grep \"Job ID:\" | sed 's/.* //g')\n+  --update \"$SQL_STATEMENT_3\" | grep \"Job ID:\" | sed 's/.* //g')\n \n # 3 upsert results and 6 append results and 3 match_recognize results\n verify_result_line_number 12 \"$ELASTICSEARCH_INDEX\"\n+\n+###############################################################################\n+# Test sql-connector-elasticsearch7\n+###############################################################################\n+echo \"Executing SQL: Values -> Elasticsearch7 (upsert)\"\n+\n+# prepare client_conf and sql statement\n+ELASTICSEARCH_VERSION=7\n+ELASTICSEARCH7_MAC_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-darwin-x86_64.tar.gz'\n+ELASTICSEARCH7_LINUX_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86_64.tar.gz'\n+\n+SQL_CONF_CONTENT=$(cat ${SQL_CONF})\n+cat >> $SQL_CONF << EOF\n+${SQL_CONF_CONTENT//version: 6/version: 7}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679fa6a6696f5adb075d8ef2608b97eaa99904fd"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3MDQwNQ==", "bodyText": "nice tips", "url": "https://github.com/apache/flink/pull/11396#discussion_r393470405", "createdAt": "2020-03-17T06:40:10Z", "author": {"login": "leonardBang"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -262,10 +271,66 @@ EOF\n JOB_ID=$($FLINK_DIR/bin/sql-client.sh embedded \\\n   --jar $KAFKA_SQL_JAR \\\n   --jar $JSON_SQL_JAR \\\n-  --jar $ELASTICSEARCH_SQL_JAR \\\n+  --jar $ELASTICSEARCH6_SQL_JAR \\\n   --jar $SQL_TOOLBOX_JAR \\\n   --environment $SQL_CONF \\\n-  --update \"$SQL_STATEMENT_5\" | grep \"Job ID:\" | sed 's/.* //g')\n+  --update \"$SQL_STATEMENT_3\" | grep \"Job ID:\" | sed 's/.* //g')\n \n # 3 upsert results and 6 append results and 3 match_recognize results\n verify_result_line_number 12 \"$ELASTICSEARCH_INDEX\"\n+\n+###############################################################################\n+# Test sql-connector-elasticsearch7\n+###############################################################################\n+echo \"Executing SQL: Values -> Elasticsearch7 (upsert)\"\n+\n+# prepare client_conf and sql statement\n+ELASTICSEARCH_VERSION=7\n+ELASTICSEARCH7_MAC_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-darwin-x86_64.tar.gz'\n+ELASTICSEARCH7_LINUX_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86_64.tar.gz'\n+\n+SQL_CONF_CONTENT=$(cat ${SQL_CONF})\n+cat >> $SQL_CONF << EOF\n+${SQL_CONF_CONTENT//version: 6/version: 7}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2NjYzMA=="}, "originalCommit": {"oid": "679fa6a6696f5adb075d8ef2608b97eaa99904fd"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODk0ODY5OnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNjoyNzozOVrOF3PTnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNjo0MDowMlrOF3PhpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2Njc4Mw==", "bodyText": "Why do we need this? Does linux binary not work in mac?", "url": "https://github.com/apache/flink/pull/11396#discussion_r393466783", "createdAt": "2020-03-17T06:27:39Z", "author": {"login": "wuchong"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -262,10 +271,66 @@ EOF\n JOB_ID=$($FLINK_DIR/bin/sql-client.sh embedded \\\n   --jar $KAFKA_SQL_JAR \\\n   --jar $JSON_SQL_JAR \\\n-  --jar $ELASTICSEARCH_SQL_JAR \\\n+  --jar $ELASTICSEARCH6_SQL_JAR \\\n   --jar $SQL_TOOLBOX_JAR \\\n   --environment $SQL_CONF \\\n-  --update \"$SQL_STATEMENT_5\" | grep \"Job ID:\" | sed 's/.* //g')\n+  --update \"$SQL_STATEMENT_3\" | grep \"Job ID:\" | sed 's/.* //g')\n \n # 3 upsert results and 6 append results and 3 match_recognize results\n verify_result_line_number 12 \"$ELASTICSEARCH_INDEX\"\n+\n+###############################################################################\n+# Test sql-connector-elasticsearch7\n+###############################################################################\n+echo \"Executing SQL: Values -> Elasticsearch7 (upsert)\"\n+\n+# prepare client_conf and sql statement\n+ELASTICSEARCH_VERSION=7\n+ELASTICSEARCH7_MAC_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-darwin-x86_64.tar.gz'\n+ELASTICSEARCH7_LINUX_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86_64.tar.gz'\n+\n+SQL_CONF_CONTENT=$(cat ${SQL_CONF})\n+cat >> $SQL_CONF << EOF\n+${SQL_CONF_CONTENT//version: 6/version: 7}\n+EOF\n+\n+SQL_STATEMENT_4=$(cat << EOF\n+INSERT INTO ElasticsearchUpsertSinkTable\n+  SELECT user_id, user_name, COUNT(*) AS user_count\n+  FROM (VALUES (1, 'Bob'), (22, 'Tom'), (42, 'Kim'), (42, 'Kim'), (42, 'Kim'), (1, 'Bob'))\n+    AS UserCountTable(user_id, user_name)\n+  GROUP BY user_id, user_name\n+EOF\n+)\n+\n+# elastcisearch offers different release binary file for corresponding system since version 7.\n+case \"$(uname -s)\" in\n+    Linux*)     OS_TYPE=linux;;\n+    Darwin*)    OS_TYPE=mac;;\n+    *)          OS_TYPE=\"UNKNOWN:${unameOut}\"\n+esac\n+OS_TYPE='test'\n+if [[ \"$OS_TYPE\" == \"mac\" ]]; then\n+  DOWNLOAD_URL=$ELASTICSEARCH_MAC_DOWNLOAD_URL\n+elif  [[ \"$OS_TYPE\" == \"linux\" ]]; then\n+  DOWNLOAD_URL=$ELASTICSEARCH7_LINUX_DOWNLOAD_URL\n+else\n+  echo \"unsupported OS, only support Mac OS\u3001Linux now.\"\n+  exit 0\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679fa6a6696f5adb075d8ef2608b97eaa99904fd"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ3MDM3Mg==", "bodyText": "yes\uff0c linux binary not work in ma", "url": "https://github.com/apache/flink/pull/11396#discussion_r393470372", "createdAt": "2020-03-17T06:40:02Z", "author": {"login": "leonardBang"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -262,10 +271,66 @@ EOF\n JOB_ID=$($FLINK_DIR/bin/sql-client.sh embedded \\\n   --jar $KAFKA_SQL_JAR \\\n   --jar $JSON_SQL_JAR \\\n-  --jar $ELASTICSEARCH_SQL_JAR \\\n+  --jar $ELASTICSEARCH6_SQL_JAR \\\n   --jar $SQL_TOOLBOX_JAR \\\n   --environment $SQL_CONF \\\n-  --update \"$SQL_STATEMENT_5\" | grep \"Job ID:\" | sed 's/.* //g')\n+  --update \"$SQL_STATEMENT_3\" | grep \"Job ID:\" | sed 's/.* //g')\n \n # 3 upsert results and 6 append results and 3 match_recognize results\n verify_result_line_number 12 \"$ELASTICSEARCH_INDEX\"\n+\n+###############################################################################\n+# Test sql-connector-elasticsearch7\n+###############################################################################\n+echo \"Executing SQL: Values -> Elasticsearch7 (upsert)\"\n+\n+# prepare client_conf and sql statement\n+ELASTICSEARCH_VERSION=7\n+ELASTICSEARCH7_MAC_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-darwin-x86_64.tar.gz'\n+ELASTICSEARCH7_LINUX_DOWNLOAD_URL='https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86_64.tar.gz'\n+\n+SQL_CONF_CONTENT=$(cat ${SQL_CONF})\n+cat >> $SQL_CONF << EOF\n+${SQL_CONF_CONTENT//version: 6/version: 7}\n+EOF\n+\n+SQL_STATEMENT_4=$(cat << EOF\n+INSERT INTO ElasticsearchUpsertSinkTable\n+  SELECT user_id, user_name, COUNT(*) AS user_count\n+  FROM (VALUES (1, 'Bob'), (22, 'Tom'), (42, 'Kim'), (42, 'Kim'), (42, 'Kim'), (1, 'Bob'))\n+    AS UserCountTable(user_id, user_name)\n+  GROUP BY user_id, user_name\n+EOF\n+)\n+\n+# elastcisearch offers different release binary file for corresponding system since version 7.\n+case \"$(uname -s)\" in\n+    Linux*)     OS_TYPE=linux;;\n+    Darwin*)    OS_TYPE=mac;;\n+    *)          OS_TYPE=\"UNKNOWN:${unameOut}\"\n+esac\n+OS_TYPE='test'\n+if [[ \"$OS_TYPE\" == \"mac\" ]]; then\n+  DOWNLOAD_URL=$ELASTICSEARCH_MAC_DOWNLOAD_URL\n+elif  [[ \"$OS_TYPE\" == \"linux\" ]]; then\n+  DOWNLOAD_URL=$ELASTICSEARCH7_LINUX_DOWNLOAD_URL\n+else\n+  echo \"unsupported OS, only support Mac OS\u3001Linux now.\"\n+  exit 0\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2Njc4Mw=="}, "originalCommit": {"oid": "679fa6a6696f5adb075d8ef2608b97eaa99904fd"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzOTI2ODMxOnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODo0MDo0M1rOF3SbQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwODo0MDo0M1rOF3SbQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUxNzg4OA==", "bodyText": "es6 and es7 have different json format about total hits in return data,\nes6:\n{ \"took\" : 263, \"timed_out\" : false, \"_shards\" : { \"total\" : 5, \"successful\" : 5, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : 3, \"max_score\" : 1.0, \"hits\" : [ { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"42_Kim\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 42, \"user_name\" : \"Kim\", \"user_count\" : 3 } }, { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"1_Bob\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 1, \"user_name\" : \"Bob\", \"user_count\" : 2 } }, { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"22_Tom\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 22, \"user_name\" : \"Tom\", \"user_count\" : 1 } } ] } }\nes7:\n{ \"took\" : 263, \"timed_out\" : false, \"_shards\" : { \"total\" : 5, \"successful\" : 5, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 3, \"relation\" : \"eq\" }, \"max_score\" : 1.0, \"hits\" : [ { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"42_Kim\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 42, \"user_name\" : \"Kim\", \"user_count\" : 3 } }, { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"1_Bob\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 1, \"user_name\" : \"Bob\", \"user_count\" : 2 } }, { \"_index\" : \"my_users\", \"_type\" : \"user\", \"_id\" : \"22_Tom\", \"_score\" : 1.0, \"_source\" : { \"user_id\" : 22, \"user_name\" : \"Tom\", \"user_count\" : 1 } } ] } }\ncheck line numbers here for general purpose.", "url": "https://github.com/apache/flink/pull/11396#discussion_r393517888", "createdAt": "2020-03-17T08:40:43Z", "author": {"login": "leonardBang"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -200,18 +224,20 @@ EOF\n )\n \n JOB_ID=$($FLINK_DIR/bin/sql-client.sh embedded \\\n-  --library $SQL_JARS_DIR \\\n+  --jar $KAFKA_SQL_JAR \\\n+  --jar $JSON_SQL_JAR \\\n+  --jar $ELASTICSEARCH_SQL_JAR \\\n   --jar $SQL_TOOLBOX_JAR \\\n   --environment $SQL_CONF \\\n-  --update \"$SQL_STATEMENT_3\" | grep \"Job ID:\" | sed 's/.* //g')\n+  --update \"$SQL_STATEMENT_1\" | grep \"Job ID:\" | sed 's/.* //g')\n \n wait_job_terminal_state \"$JOB_ID\" \"FINISHED\"\n \n-verify_result_hash \"SQL Client Elasticsearch Upsert\" \"$ELASTICSEARCH_INDEX\" 3 \"21a76360e2a40f442816d940e7071ccf\"\n+verify_result_line_number 3 \"$ELASTICSEARCH_INDEX\"\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86af6a0a881c8def3f472ed333cc0305bd38c3ec"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzY0MTkzOnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzozNDowOVrOF6Flew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMjozNTozNVrOF6fDAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1MzI0Mw==", "bodyText": "What about echo an error message and exist 1 to give an explicitly exception? Otherwise, we may miss the error alert if 7 doesn't work.", "url": "https://github.com/apache/flink/pull/11396#discussion_r396453243", "createdAt": "2020-03-23T13:34:09Z", "author": {"login": "wuchong"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -85,6 +90,31 @@ function sql_cleanup() {\n }\n on_exit sql_cleanup\n \n+function prepare_elasticsearch {\n+  echo \"Preparing Elasticsearch(version=$ELASTICSEARCH_VERSION)...\"\n+  # elastcisearch offers different release binary file for corresponding system since version 7.\n+  case \"$(uname -s)\" in\n+      Linux*)     OS_TYPE=linux;;\n+      Darwin*)    OS_TYPE=mac;;\n+      *)          OS_TYPE=\"UNKNOWN:${unameOut}\"\n+  esac\n+\n+  if [[ \"$ELASTICSEARCH_VERSION\" == 6 ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH6_DOWNLOAD_URL\n+  elif [[ \"$ELASTICSEARCH_VERSION\" == 7 ]] && [[ \"$OS_TYPE\" == \"mac\" ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH7_MAC_DOWNLOAD_URL\n+  elif [[ \"$ELASTICSEARCH_VERSION\" == 7 ]] && [[ \"$OS_TYPE\" == \"linux\" ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH7_LINUX_DOWNLOAD_URL\n+  else\n+    echo \"Unsupported elasticsearch version($ELASTICSEARCH_VERSION) for OS: $OS_TYPE, fallback to elasticsearh($ELASTICSEARCH_VERSION).\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86af6a0a881c8def3f472ed333cc0305bd38c3ec"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg3MDQwMg==", "bodyText": "okay\uff0cgiving an exception is better than fallback to elasticsearch 6.", "url": "https://github.com/apache/flink/pull/11396#discussion_r396870402", "createdAt": "2020-03-24T02:35:35Z", "author": {"login": "leonardBang"}, "path": "flink-end-to-end-tests/test-scripts/test_sql_client.sh", "diffHunk": "@@ -85,6 +90,31 @@ function sql_cleanup() {\n }\n on_exit sql_cleanup\n \n+function prepare_elasticsearch {\n+  echo \"Preparing Elasticsearch(version=$ELASTICSEARCH_VERSION)...\"\n+  # elastcisearch offers different release binary file for corresponding system since version 7.\n+  case \"$(uname -s)\" in\n+      Linux*)     OS_TYPE=linux;;\n+      Darwin*)    OS_TYPE=mac;;\n+      *)          OS_TYPE=\"UNKNOWN:${unameOut}\"\n+  esac\n+\n+  if [[ \"$ELASTICSEARCH_VERSION\" == 6 ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH6_DOWNLOAD_URL\n+  elif [[ \"$ELASTICSEARCH_VERSION\" == 7 ]] && [[ \"$OS_TYPE\" == \"mac\" ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH7_MAC_DOWNLOAD_URL\n+  elif [[ \"$ELASTICSEARCH_VERSION\" == 7 ]] && [[ \"$OS_TYPE\" == \"linux\" ]]; then\n+    DOWNLOAD_URL=$ELASTICSEARCH7_LINUX_DOWNLOAD_URL\n+  else\n+    echo \"Unsupported elasticsearch version($ELASTICSEARCH_VERSION) for OS: $OS_TYPE, fallback to elasticsearh($ELASTICSEARCH_VERSION).\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1MzI0Mw=="}, "originalCommit": {"oid": "86af6a0a881c8def3f472ed333cc0305bd38c3ec"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzY3MTE2OnYy", "diffSide": "LEFT", "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo0MDo1OFrOF6F3rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMjoyOTozOFrOF6e9Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1NzkwMg==", "bodyText": "Do we need to include carrotsearch? I saw elasticsearch connector 6 exclude this.", "url": "https://github.com/apache/flink/pull/11396#discussion_r396457902", "createdAt": "2020-03-23T13:40:58Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "diffHunk": "@@ -63,14 +63,10 @@ under the License.\n \t\t\t\t\t\t\t\t</includes>\n \t\t\t\t\t\t\t\t<excludes>\n \t\t\t\t\t\t\t\t\t<!-- These dependencies are not required. -->\n-\t\t\t\t\t\t\t\t\t<exclude>com.carrotsearch:hppc</exclude>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86af6a0a881c8def3f472ed333cc0305bd38c3ec"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2ODk1OA==", "bodyText": "yes\uff0celasticsearch connector 7 need this.", "url": "https://github.com/apache/flink/pull/11396#discussion_r396868958", "createdAt": "2020-03-24T02:29:38Z", "author": {"login": "leonardBang"}, "path": "flink-connectors/flink-sql-connector-elasticsearch7/pom.xml", "diffHunk": "@@ -63,14 +63,10 @@ under the License.\n \t\t\t\t\t\t\t\t</includes>\n \t\t\t\t\t\t\t\t<excludes>\n \t\t\t\t\t\t\t\t\t<!-- These dependencies are not required. -->\n-\t\t\t\t\t\t\t\t\t<exclude>com.carrotsearch:hppc</exclude>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1NzkwMg=="}, "originalCommit": {"oid": "86af6a0a881c8def3f472ed333cc0305bd38c3ec"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 774, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}