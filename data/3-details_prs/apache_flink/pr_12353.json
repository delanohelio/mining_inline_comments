{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNjkyODc3", "number": 12353, "title": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.", "bodyText": "What is the purpose of the change\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nBrief change log\n\nFixes BroadcastRecordWriter#randomEmit.\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\nAdded unit test in BroadcastRecordWriterTest\nAdded integration tests for latency markers and broadcast\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-05-27T08:29:42Z", "url": "https://github.com/apache/flink/pull/12353", "merged": true, "mergeCommit": {"oid": "7e7b132f611f5a564e8c7b1e6b195692293fa90f"}, "closed": true, "closedAt": "2020-06-12T15:00:37Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclp2NeABqjMzODE3NjAyODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqf4MMABqjM0Mzc3NjQ3Njg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a542150b0b6544d2b38c350be0e5b0d12dc305a2", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a542150b0b6544d2b38c350be0e5b0d12dc305a2", "committedDate": "2020-05-28T08:46:05Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early."}, "afterCommit": {"oid": "1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c", "committedDate": "2020-05-28T08:46:26Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6141cd7164c5febb45e97f68bc9873dcd6789e21", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/6141cd7164c5febb45e97f68bc9873dcd6789e21", "committedDate": "2020-05-27T08:26:57Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early."}, "afterCommit": {"oid": "a542150b0b6544d2b38c350be0e5b0d12dc305a2", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a542150b0b6544d2b38c350be0e5b0d12dc305a2", "committedDate": "2020-05-28T08:46:05Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjYzNjEx", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-420663611", "createdAt": "2020-05-29T05:35:56Z", "commit": {"oid": "1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTozNTo1N1rOGcPWeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTozNTo1N1rOGcPWeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NDgyNA==", "bodyText": "I think we should not construct the consumer before filling the BufferBuilder, otherwise the random emitted latency marker is also visible for all the other channels, which breaks the previous assumption.", "url": "https://github.com/apache/flink/pull/12353#discussion_r432264824", "createdAt": "2020-05-29T05:35:57Z", "author": {"login": "zhijiangW"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/api/writer/BroadcastRecordWriter.java", "diffHunk": "@@ -130,7 +132,7 @@ public BufferBuilder requestNewBufferBuilder(int targetChannel) throws IOExcepti\n \n \t\tBufferBuilder builder = super.requestNewBufferBuilder(targetChannel);\n \t\tif (randomTriggered) {\n-\t\t\taddBufferConsumer(builder.createBufferConsumer(), targetChannel);\n+\t\t\taddBufferConsumer(randomConsumer = builder.createBufferConsumer(), targetChannel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjYzOTA3", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-420663907", "createdAt": "2020-05-29T05:36:51Z", "commit": {"oid": "1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1e0e6b50bfecaf86fac285ff25dfb32aa52dde2c", "committedDate": "2020-05-28T08:46:26Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early."}, "afterCommit": {"oid": "b42e90672edae737f5a2ac9e4f16c5756fb6ed33", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b42e90672edae737f5a2ac9e4f16c5756fb6ed33", "committedDate": "2020-05-30T21:31:25Z", "message": "[FLINK-17322][network] Let BufferBuilder own buffer instead of memory segment.\n\nThis will unify buffer reference counting, such that it avoids BroadcastRecordWriter#randomEmit creating separate buffer reference counters for other non-target channels leading to buffers being released too early."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b42e90672edae737f5a2ac9e4f16c5756fb6ed33", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b42e90672edae737f5a2ac9e4f16c5756fb6ed33", "committedDate": "2020-05-30T21:31:25Z", "message": "[FLINK-17322][network] Let BufferBuilder own buffer instead of memory segment.\n\nThis will unify buffer reference counting, such that it avoids BroadcastRecordWriter#randomEmit creating separate buffer reference counters for other non-target channels leading to buffers being released too early."}, "afterCommit": {"oid": "a4b1247ea779353f476e4c70609094f367e7d06c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a4b1247ea779353f476e4c70609094f367e7d06c", "committedDate": "2020-05-31T17:24:08Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit caches the buffer created during BufferBuilder#createBufferConsumer and reuses it for subsequent buffer consumers."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjc0OTcy", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-423274972", "createdAt": "2020-06-03T07:11:03Z", "commit": {"oid": "a4b1247ea779353f476e4c70609094f367e7d06c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzoxMTowM1rOGeO2BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNzoxMTowM1rOGeO2BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM1MzY2OA==", "bodyText": "I think this still leaves a window for the same error to happen. When buffer == null, the returned BufferConsumer could be recycled before the next call to BufferBuilder#createBufferConsumer.\nEven besides that, the other proposal:\n\tpublic BufferConsumer copyAndSync(BufferBuilder builder) {\n\t\treturn new BufferConsumer(buffer.retainBuffer(), builder.positionMarker,\n\t\t\tbuilder.positionMarker.cachedPosition);\n\t}\n\nI think it's cleaner as it avoids adding more mutable state in the BufferBuilder.", "url": "https://github.com/apache/flink/pull/12353#discussion_r434353668", "createdAt": "2020-06-03T07:11:03Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/BufferBuilder.java", "diffHunk": "@@ -53,9 +55,13 @@ public BufferBuilder(MemorySegment memorySegment, BufferRecycler recycler) {\n \t * @return created matching instance of {@link BufferConsumer} to this {@link BufferBuilder}.\n \t */\n \tpublic BufferConsumer createBufferConsumer() {\n+\t\tif (buffer == null) {\n+\t\t\tbuffer = new NetworkBuffer(memorySegment, recycler);\n+\t\t} else {\n+\t\t\tbuffer.retainBuffer();\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4b1247ea779353f476e4c70609094f367e7d06c"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4b1247ea779353f476e4c70609094f367e7d06c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/a4b1247ea779353f476e4c70609094f367e7d06c", "committedDate": "2020-05-31T17:24:08Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit caches the buffer created during BufferBuilder#createBufferConsumer and reuses it for subsequent buffer consumers."}, "afterCommit": {"oid": "b748b70721ad822f8484a86abc4ddc32bae6e2cc", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b748b70721ad822f8484a86abc4ddc32bae6e2cc", "committedDate": "2020-06-03T11:48:49Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit uses the new BufferConsumer#copyAndSync method to copy the buffer while updating the read index to the last committed write index of the builder."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTI0OTI4", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-423524928", "createdAt": "2020-06-03T12:58:19Z", "commit": {"oid": "b748b70721ad822f8484a86abc4ddc32bae6e2cc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMjo1ODoxOVrOGeanJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzowNDoxOFrOGea1Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU0NjQ2OA==", "bodyText": "Could you re-introduced checkState(!bufferConsumerCreated) removed by 7f2382a#diff-c3aa29406973e93a909773e89093b9caL43 ?", "url": "https://github.com/apache/flink/pull/12353#discussion_r434546468", "createdAt": "2020-06-03T12:58:19Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/api/writer/BroadcastRecordWriter.java", "diffHunk": "@@ -84,7 +86,7 @@ void randomEmit(T record, int targetChannelIndex) throws IOException, Interrupte\n \t\tif (bufferBuilder != null) {\n \t\t\tfor (int index = 0; index < numberOfChannels; index++) {\n \t\t\t\tif (index != targetChannelIndex) {\n-\t\t\t\t\taddBufferConsumer(bufferBuilder.createBufferConsumer(), index);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b748b70721ad822f8484a86abc4ddc32bae6e2cc"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU1MDExOA==", "bodyText": "Uhhh. This is a nice spaghetti (the way how randomTriggeredConsumer is being set and used here).\nI don't know, but maybe we should re-think the inheritance and code deduplication between BroadcastRecordWriter and RecordWriter? Maybe we should drop this connection and live with code duplication? Or maybe there is some better way? Like extract some class and switch to composition?\nIf you and @curcur are fine with the current fix, I would be fine with doing the refactor/rethinking it outside of this bug fix.", "url": "https://github.com/apache/flink/pull/12353#discussion_r434550118", "createdAt": "2020-06-03T13:04:18Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/api/writer/BroadcastRecordWriter.java", "diffHunk": "@@ -84,7 +86,7 @@ void randomEmit(T record, int targetChannelIndex) throws IOException, Interrupte\n \t\tif (bufferBuilder != null) {\n \t\t\tfor (int index = 0; index < numberOfChannels; index++) {\n \t\t\t\tif (index != targetChannelIndex) {\n-\t\t\t\t\taddBufferConsumer(bufferBuilder.createBufferConsumer(), index);\n+\t\t\t\t\taddBufferConsumer(randomTriggeredConsumer.copyAndSync(bufferBuilder), index);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b748b70721ad822f8484a86abc4ddc32bae6e2cc"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b748b70721ad822f8484a86abc4ddc32bae6e2cc", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b748b70721ad822f8484a86abc4ddc32bae6e2cc", "committedDate": "2020-06-03T11:48:49Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit uses the new BufferConsumer#copyAndSync method to copy the buffer while updating the read index to the last committed write index of the builder."}, "afterCommit": {"oid": "20e850ec68b8e70c8e8e88a477e660a7a9ec0585", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/20e850ec68b8e70c8e8e88a477e660a7a9ec0585", "committedDate": "2020-06-05T11:46:24Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit uses the new BufferConsumer#copyAndSync method to copy the buffer while updating the read index to the last committed write index of the builder."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDgzOTA2", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-429483906", "createdAt": "2020-06-12T06:10:40Z", "commit": {"oid": "20e850ec68b8e70c8e8e88a477e660a7a9ec0585"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjoxMDo0MFrOGi4LOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjoxMDo0MFrOGi4LOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIyNTE0NA==", "bodyText": "How about renaming it as copyWithReaderPosition(int readerPosition)? The semantic of this method is for copying the current consumer with setting any reader position which is not only limited to builder.getCommittedBytes(), and then we can pass the builder.getCommittedBytes() from the caller by different usages.\nAnother consideration is that only build creates the respective consumer in single direction, so consumer will not see the builder before. copyWithReaderPosition(int readerPosition) can avoid touching builder somehow from public way.", "url": "https://github.com/apache/flink/pull/12353#discussion_r439225144", "createdAt": "2020-06-12T06:10:40Z", "author": {"login": "zhijiangW"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/BufferConsumer.java", "diffHunk": "@@ -118,6 +118,16 @@ public BufferConsumer copy() {\n \t\treturn new BufferConsumer(buffer.retainBuffer(), writerPosition.positionMarker, currentReaderPosition);\n \t}\n \n+\t/**\n+\t * Returns a retained copy with separate indexes and syncs it with the current position of the given {@link BufferBuilder}.\n+\t * This allows to read from the same {@link MemorySegment} twice starting from the position of the builder.\n+\t *\n+\t * @return a retained copy of self with separate indexes\n+\t */\n+\tpublic BufferConsumer copyAndSync(BufferBuilder builder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20e850ec68b8e70c8e8e88a477e660a7a9ec0585"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20e850ec68b8e70c8e8e88a477e660a7a9ec0585", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/20e850ec68b8e70c8e8e88a477e660a7a9ec0585", "committedDate": "2020-06-05T11:46:24Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit uses the new BufferConsumer#copyAndSync method to copy the buffer while updating the read index to the last committed write index of the builder."}, "afterCommit": {"oid": "1be27d2d61ae143a25a7beece7af333c520e02f4", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1be27d2d61ae143a25a7beece7af333c520e02f4", "committedDate": "2020-06-12T08:07:28Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjA0MTky", "url": "https://github.com/apache/flink/pull/12353#pullrequestreview-429604192", "createdAt": "2020-06-12T09:41:34Z", "commit": {"oid": "1be27d2d61ae143a25a7beece7af333c520e02f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1be27d2d61ae143a25a7beece7af333c520e02f4", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1be27d2d61ae143a25a7beece7af333c520e02f4", "committedDate": "2020-06-12T08:07:28Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}, "afterCommit": {"oid": "cd85d830cd315f6b44f0e2188175b3d0d2aedbf9", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cd85d830cd315f6b44f0e2188175b3d0d2aedbf9", "committedDate": "2020-06-12T09:56:44Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e6c27f743494ba1483195132cf622abcde78332", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/2e6c27f743494ba1483195132cf622abcde78332", "committedDate": "2020-06-12T09:59:05Z", "message": "[FLINK-17322][network] Fixes BroadcastRecordWriter overwriting memory segments on first finished BufferConsumer.\n\nBroadcastRecordWriter#randomEmit initialized buffer consumers for other non-target channels incorrectly leading to separate buffer reference counting and subsequently released buffers too early.\nThis commit uses the new BufferConsumer#copyWithReaderPosition method to copy the buffer while updating the read index to the last committed write index of the builder."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d481800964ccfc9c9077a27c64182394b1b6df1", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1d481800964ccfc9c9077a27c64182394b1b6df1", "committedDate": "2020-06-12T09:59:05Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd85d830cd315f6b44f0e2188175b3d0d2aedbf9", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cd85d830cd315f6b44f0e2188175b3d0d2aedbf9", "committedDate": "2020-06-12T09:56:44Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}, "afterCommit": {"oid": "1d481800964ccfc9c9077a27c64182394b1b6df1", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/1d481800964ccfc9c9077a27c64182394b1b6df1", "committedDate": "2020-06-12T09:59:05Z", "message": "[FLINK-17322][network] Disallowing repeated consumer creation for BufferBuilder.\n\nThis is a partial revert of FLINK-10995."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4475, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}