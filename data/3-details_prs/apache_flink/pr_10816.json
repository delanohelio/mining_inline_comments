{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwOTY1ODM3", "number": 10816, "title": "[Flink-15355] Fixed parsing of plugin parent-first patterns.", "bodyText": "What is the purpose of the change\nFixed parsing of plugin parent-first patterns.\nPreviously, empty options would result in an empty pattern, which matches everything. Thus, we effectively got parent first for all classes.\nBrief change log\n\nFix in CoreOptions for parsing of plugin parent-first patterns.\n\nVerifying this change\n\nFile Sink e2e tests\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-01-09T13:42:30Z", "url": "https://github.com/apache/flink/pull/10816", "merged": true, "mergeCommit": {"oid": "aa37c0cd89053e68e72a19d51715b3a31b74163c"}, "closed": true, "closedAt": "2020-01-10T01:54:08Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4qY4ugFqTM0MDUzNDQ5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4sQNcgBqjI5MzU1Mjc0NTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTM0NDkx", "url": "https://github.com/apache/flink/pull/10816#pullrequestreview-340534491", "createdAt": "2020-01-09T13:54:48Z", "commit": {"oid": "8f7604d34d7048aa46ec86671b43548f88369bb2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMzo1NDo0OFrOFb2jpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMzo1Njo1MFrOFb2npQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc0OTczNQ==", "bodyText": "I think the decision is that we shouldn't be adding more guava dependencies/usages in our code base. At least that's the feedback once I tried to pull out the same trick you did (\"guava already present, so why not to use it?\").", "url": "https://github.com/apache/flink/pull/10816#discussion_r364749735", "createdAt": "2020-01-09T13:54:48Z", "author": {"login": "pnowojski"}, "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -25,6 +25,9 @@\n import org.apache.flink.configuration.description.Description;\n import org.apache.flink.util.ArrayUtils;\n \n+import org.apache.flink.shaded.guava18.com.google.common.base.Splitter;\n+import org.apache.flink.shaded.guava18.com.google.common.collect.Iterables;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7604d34d7048aa46ec86671b43548f88369bb2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc1MDc1Nw==", "bodyText": "Can you deduplicate this code with getParentFirstLoaderPatterns? Provide a base method private static String[] getParentFirstLoaderPatterns(String base, String append)? Especially that the original method that was copied/duplicated didn't have the bug.\nAlso maybe a unit test since this has failed/caused a bug?", "url": "https://github.com/apache/flink/pull/10816#discussion_r364750757", "createdAt": "2020-01-09T13:56:50Z", "author": {"login": "pnowojski"}, "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -147,8 +150,8 @@\n \tpublic static String[] getPluginParentFirstLoaderPatterns(Configuration config) {\n \t\tString base = config.getString(PLUGIN_ALWAYS_PARENT_FIRST_LOADER_PATTERNS);\n \t\tString append = config.getString(PLUGIN_ALWAYS_PARENT_FIRST_LOADER_PATTERNS_ADDITIONAL);\n-\n-\t\treturn ArrayUtils.concat(base.split(\";\"), append.split(\";\"));\n+\t\tfinal Splitter splitter = Splitter.on(';').omitEmptyStrings();\n+\t\treturn Iterables.toArray(Iterables.concat(splitter.split(base), splitter.split(append)), String.class);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7604d34d7048aa46ec86671b43548f88369bb2"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f7604d34d7048aa46ec86671b43548f88369bb2", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/8f7604d34d7048aa46ec86671b43548f88369bb2", "committedDate": "2020-01-09T13:40:59Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}, "afterCommit": {"oid": "17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "committedDate": "2020-01-09T14:26:05Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "committedDate": "2020-01-09T14:26:05Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}, "afterCommit": {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "committedDate": "2020-01-09T14:34:13Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTYzMDk3", "url": "https://github.com/apache/flink/pull/10816#pullrequestreview-340563097", "createdAt": "2020-01-09T14:36:22Z", "commit": {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTgwNDgx", "url": "https://github.com/apache/flink/pull/10816#pullrequestreview-340580481", "createdAt": "2020-01-09T14:59:04Z", "commit": {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNDo1OTowNFrOFb4sZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNDo1OTowNFrOFb4sZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc4NDc0Mw==", "bodyText": "GuavaFlinkConnectorRateLimiteradditional\n:)", "url": "https://github.com/apache/flink/pull/10816#discussion_r364784743", "createdAt": "2020-01-09T14:59:04Z", "author": {"login": "pnowojski"}, "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -133,7 +127,7 @@\n \t\t.withDescription(\"A (semicolon-separated) list of patterns that specifies which classes should always be\" +\n \t\t\t\" resolved through the plugin parent ClassLoader first. A pattern is a simple prefix that is checked \" +\n \t\t\t\" against the fully qualified class name. This setting should generally not be modified. To add another \" +\n-\t\t\t\" pattern we recommend to use \\\"plugin.classloader.parent-first-patterns.additional\\\" instead.\");\n+\t\t\t\" pattern we recommend to use \\\"plugin.classloader.parent-first-patterns.GuavaFlinkConnectorRateLimiteradditional\\\" instead.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "committedDate": "2020-01-09T14:34:13Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}, "afterCommit": {"oid": "79f86e78791e0938480c97e422d7bc3003a97974", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/79f86e78791e0938480c97e422d7bc3003a97974", "committedDate": "2020-01-09T15:06:21Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTg5MjY5", "url": "https://github.com/apache/flink/pull/10816#pullrequestreview-340589269", "createdAt": "2020-01-09T15:10:22Z", "commit": {"oid": "79f86e78791e0938480c97e422d7bc3003a97974"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ff3913aadd6719a43ba19a86068e8b50cc43f6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/80ff3913aadd6719a43ba19a86068e8b50cc43f6", "committedDate": "2020-01-09T16:07:53Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79f86e78791e0938480c97e422d7bc3003a97974", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/79f86e78791e0938480c97e422d7bc3003a97974", "committedDate": "2020-01-09T15:06:21Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}, "afterCommit": {"oid": "80ff3913aadd6719a43ba19a86068e8b50cc43f6", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/80ff3913aadd6719a43ba19a86068e8b50cc43f6", "committedDate": "2020-01-09T16:07:53Z", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1785, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}