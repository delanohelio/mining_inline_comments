{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MTE1NjEy", "number": 14032, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOTo0NjoyMFrOE4mLRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOTo0NjoyMFrOE4mLRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NzgxMTg4OnYy", "diffSide": "RIGHT", "path": "flink-end-to-end-tests/flink-end-to-end-tests-hbase/src/main/java/org/apache/flink/tests/util/hbase/LocalStandaloneHBaseResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOTo0NjoyMFrOHynh9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwOTo0NjoyMFrOHynh9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgzODUxNg==", "bodyText": "I'd prefer to shutdown the hbase process by killing the process id because I encountered the hung case before when calling the stop-hbase.sh.", "url": "https://github.com/apache/flink/pull/14032#discussion_r522838516", "createdAt": "2020-11-13T09:46:20Z", "author": {"login": "openinx"}, "path": "flink-end-to-end-tests/flink-end-to-end-tests-hbase/src/main/java/org/apache/flink/tests/util/hbase/LocalStandaloneHBaseResource.java", "diffHunk": "@@ -92,62 +95,98 @@ private void setupHBaseDist() throws IOException {\n \t}\n \n \tprivate void setupHBaseCluster() throws IOException {\n-\t\tLOG.info(\"Starting HBase cluster\");\n-\t\tAutoClosableProcess.runBlocking(\n-\t\t\thbaseDir.resolve(Paths.get(\"bin\", \"start-hbase.sh\")).toString());\n-\n-\t\twhile (!isHBaseRunning()) {\n-\t\t\ttry {\n-\t\t\t\tLOG.info(\"Waiting for HBase to start\");\n-\t\t\t\tThread.sleep(500L);\n-\t\t\t} catch (InterruptedException e) {\n-\t\t\t\tThread.currentThread().interrupt();\n-\t\t\t\tbreak;\n-\t\t\t}\n-\t\t}\n+\t\tLOG.info(\"Starting HBase cluster...\");\n+\t\trunHBaseProcessWithRetry(\"start-hbase.sh\", () -> !isHMasterRunning());\n+\t\tLOG.info(\"Start HBase cluster success\");\n \t}\n \n \t@Override\n \tpublic void afterTestSuccess() {\n+\t\tshutdownResource();\n+\t\tdownloadCache.afterTestSuccess();\n+\t\ttmp.delete();\n+\t}\n+\n+\tprivate void shutdownResource() {\n+\t\tLOG.info(\"Stopping HBase Cluster...\");\n \t\ttry {\n-\t\t\tLOG.info(\"Stopping HBase Cluster\");\n-\t\t\tAutoClosableProcess.runBlocking(\n-\t\t\t\thbaseDir.resolve(Paths.get(\"bin\", \"hbase-daemon.sh\")).toString(),\n-\t\t\t\t\"stop\",\n-\t\t\t\t\"master\");\n+\t\t\trunHBaseProcessWithRetry(\"stop-hbase.sh\", () -> isHMasterAlive());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb3d2ff2f59cb246824d3971d19f2abe87ca060"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4884, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}