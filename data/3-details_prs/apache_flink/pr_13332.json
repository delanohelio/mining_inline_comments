{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNTE5MjU1", "number": 13332, "title": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml", "bodyText": "What is the purpose of the change\nCurrently, sql-client-defaults.yaml sets some runtime execution configuration by defualt, e.g. parallelism, restart strategy. which is confusing for users so that users are confused why paralleslim is changed in flink-conf.yaml but it doesn't work. sql-client-defaults.yaml should remove the runtime execution configurations, to make the configurations in flink-conf.yaml work by default.\nBrief change log\n\nRemove the runtime execution configurations defined in sql-client-defaults.yaml, which includes time-characteristic, periodic-watermarks-interval, parallelism, max-parallelism, restart-strategy.\n\nVerifying this change\n\nModify testGetSessionProperties() of LocalExecutorITCase to remove the default execution configurations in test-sql-client-defaults.yaml to verify the test case for removing the runtime execution configuration in sql-client-defaults.yaml.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-09-05T13:24:19Z", "url": "https://github.com/apache/flink/pull/13332", "merged": true, "mergeCommit": {"oid": "a7c3f161bf0af9fe7e2bb337ccb04c96df503039"}, "closed": true, "closedAt": "2020-09-22T11:56:52Z", "author": {"login": "SteNicholas"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGGlfvABqjM3MzM1MjQ0MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLWqRQgFqTQ5MzM4MDI4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42afac79c813d8cedbbe30b5a9e158d4427515c2", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/42afac79c813d8cedbbe30b5a9e158d4427515c2", "committedDate": "2020-09-06T04:00:58Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}, "afterCommit": {"oid": "f948fd6da8cc777fbfb588a49038b4aa4918160c", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/f948fd6da8cc777fbfb588a49038b4aa4918160c", "committedDate": "2020-09-06T04:20:39Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95d5e493cc42f0ddb02c4ab9d99203e765ad104b", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/95d5e493cc42f0ddb02c4ab9d99203e765ad104b", "committedDate": "2020-09-06T04:22:46Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f948fd6da8cc777fbfb588a49038b4aa4918160c", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/f948fd6da8cc777fbfb588a49038b4aa4918160c", "committedDate": "2020-09-06T04:20:39Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}, "afterCommit": {"oid": "95d5e493cc42f0ddb02c4ab9d99203e765ad104b", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/95d5e493cc42f0ddb02c4ab9d99203e765ad104b", "committedDate": "2020-09-06T04:22:46Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDQzNjc5", "url": "https://github.com/apache/flink/pull/13332#pullrequestreview-490443679", "createdAt": "2020-09-17T10:11:25Z", "commit": {"oid": "95d5e493cc42f0ddb02c4ab9d99203e765ad104b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMDoyNDo0OVrOHTbkAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMDoyNTowMVrOHTbkfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEzNjU3Ng==", "bodyText": "Do not remove entries for the existing test files. The options are still supported, so the tests are valid.\nPlease add a new testing yaml to verify the default behaivor.", "url": "https://github.com/apache/flink/pull/13332#discussion_r490136576", "createdAt": "2020-09-17T10:24:49Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/src/test/resources/test-sql-client-defaults.yaml", "diffHunk": "@@ -137,19 +137,10 @@ catalogs:\n execution:\n   planner: \"$VAR_PLANNER\"\n   type: \"$VAR_EXECUTION_TYPE\"\n-  time-characteristic: event-time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d5e493cc42f0ddb02c4ab9d99203e765ad104b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEzNjcwMw==", "bodyText": "What about only comment out (not remove) the parallelism and restart-strategy?\n\nUser can still easily enable them in the sql-client-defaults.yaml.\nIt seems that other options (time-characteristic, periodic-watermarks-interval, max-parallelism) override the default value of underlying pipeline configuraiton. So removing them may affect the SQL job behavior.\n\nBesides\nWe may also need to update org.apache.flink.table.client.config.entries.ExecutionEntry#getParallelism, it's hard coded to return a default value 1.", "url": "https://github.com/apache/flink/pull/13332#discussion_r490136703", "createdAt": "2020-09-17T10:25:01Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/conf/sql-client-defaults.yaml", "diffHunk": "@@ -100,18 +100,10 @@ execution:\n   planner: blink\n   # 'batch' or 'streaming' execution\n   type: streaming\n-  # allow 'event-time' or only 'processing-time' in sources\n-  time-characteristic: event-time\n-  # interval in ms for emitting periodic watermarks\n-  periodic-watermarks-interval: 200\n   # 'changelog', 'table' or 'tableau' presentation of results\n   result-mode: table\n   # maximum number of maintained rows in 'table' presentation of results\n   max-table-result-rows: 1000000\n-  # parallelism of the program\n-  parallelism: 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d5e493cc42f0ddb02c4ab9d99203e765ad104b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73a7458cb95aef63449e3827897fcccd83dca0e6", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/73a7458cb95aef63449e3827897fcccd83dca0e6", "committedDate": "2020-09-18T06:03:46Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTkxNzE3", "url": "https://github.com/apache/flink/pull/13332#pullrequestreview-491191717", "createdAt": "2020-09-18T06:47:13Z", "commit": {"oid": "73a7458cb95aef63449e3827897fcccd83dca0e6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo0NzoxNFrOHUALHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo0OTowM1rOHUAOQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczNjQxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             # restart-strategy:\n          \n          \n            \n              # restart-strategy:", "url": "https://github.com/apache/flink/pull/13332#discussion_r490736412", "createdAt": "2020-09-18T06:47:14Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/conf/sql-client-defaults.yaml", "diffHunk": "@@ -121,10 +121,10 @@ execution:\n   # current database of the current catalog (default database of the catalog by default)\n   current-database: default_database\n   # controls how table programs are restarted in case of a failures\n-  restart-strategy:\n+ # restart-strategy:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73a7458cb95aef63449e3827897fcccd83dca0e6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczNzIxOQ==", "bodyText": "We can keep only the exectuion entry, because all the others are not used.", "url": "https://github.com/apache/flink/pull/13332#discussion_r490737219", "createdAt": "2020-09-18T06:49:03Z", "author": {"login": "wuchong"}, "path": "flink-table/flink-sql-client/src/test/resources/test-sql-client-execution.yaml", "diffHunk": "@@ -0,0 +1,152 @@\n+################################################################################\n+#  Licensed to the Apache Software Foundation (ASF) under one\n+#  or more contributor license agreements.  See the NOTICE file\n+#  distributed with this work for additional information\n+#  regarding copyright ownership.  The ASF licenses this file\n+#  to you under the Apache License, Version 2.0 (the\n+#  \"License\"); you may not use this file except in compliance\n+#  with the License.  You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#  Unless required by applicable law or agreed to in writing, software\n+#  distributed under the License is distributed on an \"AS IS\" BASIS,\n+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#  See the License for the specific language governing permissions and\n+# limitations under the License.\n+################################################################################\n+\n+#==============================================================================\n+# TEST ENVIRONMENT FILE\n+# General purpose default environment file.\n+#==============================================================================\n+\n+# this file has variables that can be filled with content by replacing $VAR_XXX\n+\n+tables:\n+  - name: TableNumber1\n+    type: source-table\n+    $VAR_UPDATE_MODE\n+    schema:\n+      - name: IntegerField1\n+        type: INT\n+      - name: StringField1\n+        type: VARCHAR\n+      - name: TimestampField1\n+        type: TIMESTAMP\n+    connector:\n+      type: filesystem\n+      path: \"$VAR_SOURCE_PATH1\"\n+    format:\n+      type: csv\n+      fields:\n+        - name: IntegerField1\n+          type: INT\n+        - name: StringField1\n+          type: VARCHAR\n+        - name: TimestampField1\n+          type: TIMESTAMP\n+      line-delimiter: \"\\n\"\n+      comment-prefix: \"#\"\n+  - name: TestView1\n+    type: view\n+    query: SELECT scalarUDF(IntegerField1) FROM TableNumber1\n+  - name: TableNumber2\n+    # Test backwards compatibility (\"source\" -> \"source-table\")\n+    type: source\n+    $VAR_UPDATE_MODE\n+    schema:\n+      - name: IntegerField2\n+        type: INT\n+      - name: StringField2\n+        type: VARCHAR\n+      - name: TimestampField2\n+        type: TIMESTAMP\n+    connector:\n+      type: filesystem\n+      path: \"$VAR_SOURCE_PATH2\"\n+    format:\n+      type: csv\n+      fields:\n+        - name: IntegerField2\n+          type: INT\n+        - name: StringField2\n+          type: VARCHAR\n+        - name: TimestampField2\n+          type: TIMESTAMP\n+      line-delimiter: \"\\n\"\n+      comment-prefix: \"#\"\n+  - name: TableSourceSink\n+    type: source-sink-table\n+    $VAR_UPDATE_MODE\n+    schema:\n+      - name: BooleanField\n+        type: BOOLEAN\n+      - name: StringField\n+        type: VARCHAR\n+      - name: TimestampField\n+        type: TIMESTAMP\n+    connector:\n+      type: filesystem\n+      path: \"$VAR_SOURCE_SINK_PATH\"\n+    format:\n+      type: csv\n+      fields:\n+        - name: BooleanField\n+          type: BOOLEAN\n+        - name: StringField\n+          type: VARCHAR\n+        - name: TimestampField\n+          type: TIMESTAMP\n+  - name: TestView2\n+    type: view\n+    query: SELECT * FROM TestView1\n+\n+functions:\n+  - name: scalarUDF\n+    from: class\n+    class: org.apache.flink.table.client.gateway.utils.UserDefinedFunctions$ScalarUDF\n+    constructor:\n+      - 5\n+  - name: aggregateUDF\n+    from: class\n+    class: org.apache.flink.table.client.gateway.utils.UserDefinedFunctions$AggregateUDF\n+    constructor:\n+      - StarryName\n+      - false\n+      - class: java.lang.Integer\n+        constructor:\n+          - class: java.lang.String\n+            constructor:\n+              - type: VARCHAR\n+                value: 3\n+  - name: tableUDF\n+    from: class\n+    class: org.apache.flink.table.client.gateway.utils.UserDefinedFunctions$TableUDF\n+    constructor:\n+      - type: LONG\n+        value: 5\n+\n+catalogs:\n+  - name: catalog1\n+    type: DependencyTest\n+  - name: simple-catalog\n+    type: simple-catalog\n+    test-table: test-table\n+\n+execution:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73a7458cb95aef63449e3827897fcccd83dca0e6"}, "originalPosition": 137}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f1ae1192b3809aac8728de1bdb9d5c6bce36f9a", "author": {"user": {"login": "SteNicholas", "name": "SteNicholas"}}, "url": "https://github.com/apache/flink/commit/8f1ae1192b3809aac8728de1bdb9d5c6bce36f9a", "committedDate": "2020-09-18T07:12:27Z", "message": "[FLINK-19128][sql-client] Remove the runtime execution configuration in sql-client-defaults.yaml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzgwMjg0", "url": "https://github.com/apache/flink/pull/13332#pullrequestreview-493380284", "createdAt": "2020-09-22T11:54:29Z", "commit": {"oid": "8f1ae1192b3809aac8728de1bdb9d5c6bce36f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4462, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}