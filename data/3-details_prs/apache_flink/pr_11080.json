{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NzI1MTgx", "number": 11080, "title": "[FLINK-15988][json] Make JsonRowSerializationSchema's constructor private", "bodyText": "What is the purpose of the change\nChange JsonRowSerializationSchema's constructor private, and force to use Builder to build JsonRowSerializationSchema.\nBrief change log\n\nJsonRowSerializationSchema's constructor private\nAdd static builder method for JsonRowSerializationSchema\ndeprecate JsonRowSerializationSchema.Builder's public constructor\n\nVerifying this change\nThis change is a trivial rework / code cleanup without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-02-13T08:05:40Z", "url": "https://github.com/apache/flink/pull/11080", "merged": true, "mergeCommit": {"oid": "b43701f88fade8e927f3c50bad9544794075decb"}, "closed": true, "closedAt": "2020-02-18T06:54:42Z", "author": {"login": "libenchao"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD1X54AH2gAyMzc0NzI1MTgxOmQ3MzVlYjI1MzE0ZmQ3NGNhMDUyMGUwZWU5Yjk4MzllZjU4NWI2ZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFcRaiAFqTM2MDEwMjQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d735eb25314fd74ca0520e0ee9b9839ef585b6e7", "author": {"user": {"login": "libenchao", "name": "Benchao Li"}}, "url": "https://github.com/apache/flink/commit/d735eb25314fd74ca0520e0ee9b9839ef585b6e7", "committedDate": "2020-02-13T06:58:56Z", "message": "[FLINK-15988][json] Make JsonRowSerializationSchema's constructor private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bed2dbf577c649ad3e6b411730763c90a898a5d", "author": {"user": {"login": "libenchao", "name": "Benchao Li"}}, "url": "https://github.com/apache/flink/commit/8bed2dbf577c649ad3e6b411730763c90a898a5d", "committedDate": "2020-02-13T07:52:29Z", "message": "Add error message, and avoid using Builder constructor directly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjEzMzQx", "url": "https://github.com/apache/flink/pull/11080#pullrequestreview-359613341", "createdAt": "2020-02-17T10:00:41Z", "commit": {"oid": "8bed2dbf577c649ad3e6b411730763c90a898a5d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDowMDo0MlrOFqekig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDowMToxOFrOFqel0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4NTM4Ng==", "bodyText": "Put the @deprecated comment after @param.", "url": "https://github.com/apache/flink/pull/11080#discussion_r380085386", "createdAt": "2020-02-17T10:00:42Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowSerializationSchema.java", "diffHunk": "@@ -99,35 +94,66 @@ public JsonRowSerializationSchema(TypeInformation<Row> typeInfo) {\n \t@PublicEvolving\n \tpublic static class Builder {\n \n-\t\tprivate final RowTypeInfo typeInfo;\n+\t\tprivate RowTypeInfo typeInfo;\n+\n+\t\tprivate Builder() {\n+\t\t\t// private constructor\n+\t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bed2dbf577c649ad3e6b411730763c90a898a5d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4NTcxMg==", "bodyText": "Add a javadoc on this method.", "url": "https://github.com/apache/flink/pull/11080#discussion_r380085712", "createdAt": "2020-02-17T10:01:18Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowSerializationSchema.java", "diffHunk": "@@ -99,35 +94,66 @@ public JsonRowSerializationSchema(TypeInformation<Row> typeInfo) {\n \t@PublicEvolving\n \tpublic static class Builder {\n \n-\t\tprivate final RowTypeInfo typeInfo;\n+\t\tprivate RowTypeInfo typeInfo;\n+\n+\t\tprivate Builder() {\n+\t\t\t// private constructor\n+\t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.\n+\t\t *\n \t\t * Creates a JSON serialization schema for the given type information.\n \t\t *\n \t\t * @param typeInfo Type information describing the result type. The field names of {@link Row}\n \t\t *                 are used to parse the JSON properties.\n \t\t */\n+\t\t@Deprecated\n \t\tpublic Builder(TypeInformation<Row> typeInfo) {\n \t\t\tcheckArgument(typeInfo instanceof RowTypeInfo, \"Only RowTypeInfo is supported\");\n \t\t\tthis.typeInfo = (RowTypeInfo) typeInfo;\n \t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.\n+\t\t *\n \t\t * Creates a JSON serialization schema for the given JSON schema.\n \t\t *\n \t\t * @param jsonSchema JSON schema describing the result type\n \t\t *\n \t\t * @see <a href=\"http://json-schema.org/\">http://json-schema.org/</a>\n \t\t */\n+\t\t@Deprecated\n \t\tpublic Builder(String jsonSchema) {\n \t\t\tthis(JsonRowSchemaConverter.convert(checkNotNull(jsonSchema)));\n \t\t}\n \n+\t\t/**\n+\t\t * Sets type information for JSON serialization schema.\n+\t\t *\n+\t\t * @param typeInfo Type information describing the result type. The field names of {@link Row}\n+\t\t *                 are used to parse the JSON properties.\n+\t\t */\n+\t\tpublic Builder withTypeInfo(TypeInformation<Row> typeInfo) {\n+\t\t\tcheckArgument(typeInfo instanceof RowTypeInfo, \"Only RowTypeInfo is supported\");\n+\t\t\tthis.typeInfo = (RowTypeInfo) typeInfo;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Finalizes the configuration and checks validity.\n+\t\t * @return Configured {@link JsonRowSerializationSchema}\n+\t\t */\n \t\tpublic JsonRowSerializationSchema build() {\n+\t\t\tcheckArgument(typeInfo != null, \"typeInfo should be set.\");\n \t\t\treturn new JsonRowSerializationSchema(typeInfo);\n \t\t}\n \t}\n \n+\tpublic static Builder builder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bed2dbf577c649ad3e6b411730763c90a898a5d"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ca630c234f01097ac97ccb2257e532490dae51", "author": {"user": {"login": "libenchao", "name": "Benchao Li"}}, "url": "https://github.com/apache/flink/commit/75ca630c234f01097ac97ccb2257e532490dae51", "committedDate": "2020-02-17T10:42:29Z", "message": "Refine java doc for JsonRowSerializationSchema.Builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d421fec466c39ff97ac208eade8b4f32851cf21", "author": {"user": {"login": "libenchao", "name": "Benchao Li"}}, "url": "https://github.com/apache/flink/commit/4d421fec466c39ff97ac208eade8b4f32851cf21", "committedDate": "2020-02-17T15:11:38Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTAyNDg4", "url": "https://github.com/apache/flink/pull/11080#pullrequestreview-360102488", "createdAt": "2020-02-18T06:52:04Z", "commit": {"oid": "4d421fec466c39ff97ac208eade8b4f32851cf21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4349, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}