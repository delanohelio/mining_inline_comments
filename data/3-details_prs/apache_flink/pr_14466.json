{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTcyOTM5", "number": 14466, "title": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment", "bodyText": "What is the purpose of the change\nReuse SimpleJdbcConnectionProvider for jdbc connection establishment.\nBrief change log\n\nAdd SimpleJdbcConnectionProvider.closeConnection to close cached connection and declare that SimpleJdbcConnectionProvider is NotThreadSafe.\nMigrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment.\nThrow NullPointerException instead of IllegalArgumentException if required arguments is null in JdbcInputFormatBuilder and JdbcRowDataInputFormat.Builder.\n\nVerifying this change\nThis change is already covered by existing tests:\n\nJdbcInputFormatTest\nJdbcRowDataInputFormatTest\n\nThis change added tests and can be verified as follows:\n\nSimpleJdbcConnectionProviderTest\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable)\n\nFound other issues:\n\nName inconsistence: drivername or driverName ?\n0 is valid for Statement.setFetchSize, but JdbcInputFormat and JdbcRowDataInputFormat complains on this. It may not be important if all its usages are internal, but noticed thatJdbcInputFormat is Experimental.", "createdAt": "2020-12-22T14:53:54Z", "url": "https://github.com/apache/flink/pull/14466", "merged": true, "mergeCommit": {"oid": "0c36b666094c01a96d341d2b0ee0b6863a6484e8"}, "closed": true, "closedAt": "2020-12-27T05:52:55Z", "author": {"login": "kezhuw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdot4E1gBqjQxNDEwNzM1MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqLAfogFqTU1ODkwNTIxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "844cd0aee645f77f0c01e09614ad6e6cecc58837", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/844cd0aee645f77f0c01e09614ad6e6cecc58837", "committedDate": "2020-12-22T14:20:10Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}, "afterCommit": {"oid": "93f836cbe23b55502113b33a6ca08f613ed1a480", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/93f836cbe23b55502113b33a6ca08f613ed1a480", "committedDate": "2020-12-22T17:20:25Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93f836cbe23b55502113b33a6ca08f613ed1a480", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/93f836cbe23b55502113b33a6ca08f613ed1a480", "committedDate": "2020-12-22T17:20:25Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}, "afterCommit": {"oid": "cdb692019548197320d8e058c386e177fa180495", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/cdb692019548197320d8e058c386e177fa180495", "committedDate": "2020-12-23T13:06:25Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4Mzc5OTEx", "url": "https://github.com/apache/flink/pull/14466#pullrequestreview-558379911", "createdAt": "2020-12-24T07:09:04Z", "commit": {"oid": "cdb692019548197320d8e058c386e177fa180495"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwNzowOTowNVrOILBIAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQwNzoxMTo0NlrOILBKog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMzY4Mw==", "bodyText": "Maybe we don't need this method anymore, we can directly invoke connectionProvider.closeConnection in close().\nThe same to establishConnection.", "url": "https://github.com/apache/flink/pull/14466#discussion_r548423683", "createdAt": "2020-12-24T07:09:05Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/internal/AbstractJdbcOutputFormat.java", "diffHunk": "@@ -72,15 +70,7 @@ public void close() {\n \t}\n \n \tprivate void closeDbConnection() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb692019548197320d8e058c386e177fa180495"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyNDE4MA==", "bodyText": "What do you think about rename this method to getOrCreateConnection to make the create/establish behavior more explicitly?", "url": "https://github.com/apache/flink/pull/14466#discussion_r548424180", "createdAt": "2020-12-24T07:11:03Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/internal/connection/JdbcConnectionProvider.java", "diffHunk": "@@ -20,13 +20,40 @@\n import org.apache.flink.annotation.Internal;\n \n import java.sql.Connection;\n+import java.sql.SQLException;\n \n /**\n  * JDBC connection provider.\n  */\n @Internal\n public interface JdbcConnectionProvider {\n-\tConnection getConnection() throws Exception;\n+\t/**\n+\t * Get existing connection.\n+\t *\n+\t * @return existing connection\n+\t */\n+\tConnection getExistingConnection();\n \n-\tConnection reestablishConnection() throws Exception;\n+\t/**\n+\t * Get existing connection or establish an new one if there is none.\n+\t *\n+\t * @return existing connection or newly established connection\n+\t * @throws SQLException sql exception\n+\t * @throws ClassNotFoundException driver class not found\n+\t */\n+\tConnection getConnection() throws SQLException, ClassNotFoundException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb692019548197320d8e058c386e177fa180495"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyNDM1NA==", "bodyText": "Is this method necessary? Can users use getConnection instead?", "url": "https://github.com/apache/flink/pull/14466#discussion_r548424354", "createdAt": "2020-12-24T07:11:46Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/internal/connection/JdbcConnectionProvider.java", "diffHunk": "@@ -20,13 +20,40 @@\n import org.apache.flink.annotation.Internal;\n \n import java.sql.Connection;\n+import java.sql.SQLException;\n \n /**\n  * JDBC connection provider.\n  */\n @Internal\n public interface JdbcConnectionProvider {\n-\tConnection getConnection() throws Exception;\n+\t/**\n+\t * Get existing connection.\n+\t *\n+\t * @return existing connection\n+\t */\n+\tConnection getExistingConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb692019548197320d8e058c386e177fa180495"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb29832f3281af5b385f0ef87f17875224f474e", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/cfb29832f3281af5b385f0ef87f17875224f474e", "committedDate": "2020-12-25T13:22:14Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "265349b7e273ffcc388f37fd31248eb37e271550", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/265349b7e273ffcc388f37fd31248eb37e271550", "committedDate": "2020-12-24T12:47:41Z", "message": "fixup: fix typo"}, "afterCommit": {"oid": "cfb29832f3281af5b385f0ef87f17875224f474e", "author": {"user": {"login": "kezhuw", "name": "Kezhu Wang"}}, "url": "https://github.com/apache/flink/commit/cfb29832f3281af5b385f0ef87f17875224f474e", "committedDate": "2020-12-25T13:22:14Z", "message": "[FLINK-20657][connectors/jdbc] Migrate jdbc InputFormat/LookupFunction to SimpleJdbcConnectionProvider for connection establishment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTA1MjE1", "url": "https://github.com/apache/flink/pull/14466#pullrequestreview-558905215", "createdAt": "2020-12-27T05:51:33Z", "commit": {"oid": "cfb29832f3281af5b385f0ef87f17875224f474e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3369, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}