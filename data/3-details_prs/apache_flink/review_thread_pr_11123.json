{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NjEyODMz", "number": 11123, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDowNjoyMlrODgtNQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjowOTo1NlrODlxnTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NjIxNjk2OnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDowNjoyMlrOFrDkdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDowNjoyMlrOFrDkdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY5MTU3Mw==", "bodyText": "add a note that this can be removed once Java8 support is dropped?", "url": "https://github.com/apache/flink/pull/11123#discussion_r380691573", "createdAt": "2020-02-18T14:06:22Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -204,6 +204,11 @@ under the License.\n \t\t\t<artifactId>aws-java-sdk-dynamodb</artifactId>\n \t\t\t<version>${fs.s3.aws.version}</version>\n \t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>xerces</groupId>\n+\t\t\t<artifactId>xercesImpl</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83b98e39b163308ede9d79d2f905d6c12f23203b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NjIxNzI0OnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDowNjoyNVrOFrDkmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDowNjoyNVrOFrDkmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY5MTYwOQ==", "bodyText": "add a note that this can be removed once Java8 support is dropped?", "url": "https://github.com/apache/flink/pull/11123#discussion_r380691609", "createdAt": "2020-02-18T14:06:25Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/src/main/java/org/xml/sax/helpers/XMLReaderFactory.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.xml.sax.helpers;\n+\n+import org.apache.xerces.jaxp.SAXParserFactoryImpl;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.XMLReader;\n+\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.parsers.SAXParserFactory;\n+\n+/**\n+ * Workaround for JDK-8015099, this factory always provides a bundled xerces parser for plugins.\n+ *\n+ * <p>Will provide a proper isolation for all kinds of different setups (other sax parser in lib or bundled in user\n+ * code).\n+ */\n+public class XMLReaderFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83b98e39b163308ede9d79d2f905d6c12f23203b"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2Mzc5NTQxOnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-hadoop/src/main/resources/META-INF/NOTICE", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODoyMDoyNlrOFsJ2Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODoyMDoyNlrOFsJ2Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg0MzA0Mg==", "bodyText": "are we not also bundling xml-apis:xml-apis, a transitive dependency of xercesImpl?", "url": "https://github.com/apache/flink/pull/11123#discussion_r381843042", "createdAt": "2020-02-20T08:20:26Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-hadoop/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -31,6 +31,7 @@ This project bundles the following dependencies under the Apache Software Licens\n - org.apache.httpcomponents:httpcore:4.4.6\n - org.apache.httpcomponents:httpclient:4.5.3\n - software.amazon.ion:ion-java:1.0.2\n+- xerces:xercesImpl:2.12.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "385ebf4f1ad02ea7a62b2f6fadd54cd1fa6121e2"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MzIzODg1OnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMTo0MzozM1rOFwcosg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMTo0MzozM1rOFwcosg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM0NTEzOA==", "bodyText": "add a comment for why this is done", "url": "https://github.com/apache/flink/pull/11123#discussion_r386345138", "createdAt": "2020-03-02T11:43:33Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,30 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>\n+\t\t\t\t<executions>\n+\t\t\t\t\t<execution>\n+\t\t\t\t\t\t<id>shade-flink</id>\n+\t\t\t\t\t\t<phase>package</phase>\n+\t\t\t\t\t\t<goals>\n+\t\t\t\t\t\t\t<goal>shade</goal>\n+\t\t\t\t\t\t</goals>\n+\t\t\t\t\t\t<configuration>\n+\t\t\t\t\t\t\t<filters>\n+\t\t\t\t\t\t\t\t<filter>\n+\t\t\t\t\t\t\t\t\t<artifact>com.amazonaws:aws-java-sdk-s3</artifact>\n+\t\t\t\t\t\t\t\t\t<excludes>\n+\t\t\t\t\t\t\t\t\t\t<exclude>com/amazonaws/services/s3/model/transform/XmlResponsesSaxParser**</exclude>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b18e6f5ff641afd27cfeccb5236a52f1e844498"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMTEwNjcwOnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoyMjoxMFrOFxnkLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjowODo0NlrOFy2n1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw==", "bodyText": "it would be safer to move this into the presto/hadoop modules; as it stands you're excluding one dependency (and kicking out a transitive one), with downstream modules not being aware that this module is bundling anything and hence also trying to bundle aws-java-sdk-s3.\nThis is the warning you get when building downstream modules:\n[WARNING] flink-s3-fs-base-1.11-SNAPSHOT.jar, aws-java-sdk-s3-1.11.271.jar define 29 overlapping classes: \n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$GetObjectTaggingHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$ListPartsHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$BucketLocationHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$ListVersionsHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$ListAllMyBucketsHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$ListBucketInventoryConfigurationsHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$ListBucketHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$AccessControlListHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$InitiateMultipartUploadHandler\n[WARNING]   - com.amazonaws.services.s3.model.transform.XmlResponsesSaxParser$GetBucketInventoryConfigurationHandler\n[WARNING]   - 19 more...\n\nAs it stands this will require duplicating things; it would've easier if the S3 filesystems where organized in a hierarchy such that we could use inheritance for this stuff.", "url": "https://github.com/apache/flink/pull/11123#discussion_r387572783", "createdAt": "2020-03-04T10:22:10Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4OTg2Mg==", "bodyText": "I will try to pursuit the hierarchy approach.", "url": "https://github.com/apache/flink/pull/11123#discussion_r387589862", "createdAt": "2020-03-04T10:53:10Z", "author": {"login": "AHeise"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw=="}, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg4MTE2OA==", "bodyText": "Unfortunately, it's not that easy. If it's a parent project, it needs to be of type pom and cannot ship code by default.\nThere is a workaround, but it's certainly adding some complexity.\nThe cleanest solution would be to add another module just for the pom, but that's also more complex than I'd like it to be.", "url": "https://github.com/apache/flink/pull/11123#discussion_r387881168", "createdAt": "2020-03-04T19:21:55Z", "author": {"login": "AHeise"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw=="}, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM2MDIxMw==", "bodyText": "it doesn't have to ship code; you can define the shade plugin configuration in the parent, which is then inherited by the child modules, which then do the inclusion/exclusion.", "url": "https://github.com/apache/flink/pull/11123#discussion_r388360213", "createdAt": "2020-03-05T15:17:02Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw=="}, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUwMzkxNA==", "bodyText": "Not sure what you mean but flink-s3-fs-base has code that is lost when I change packaging to pom, which in turn is required for parent projects.", "url": "https://github.com/apache/flink/pull/11123#discussion_r388503914", "createdAt": "2020-03-05T19:12:07Z", "author": {"login": "AHeise"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw=="}, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2ODA1Mg==", "bodyText": "I forgot that S3 base contains code, ignore the suggestion about parent modules.", "url": "https://github.com/apache/flink/pull/11123#discussion_r388868052", "createdAt": "2020-03-06T12:08:46Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3Mjc4Mw=="}, "originalCommit": {"oid": "05703e66f5eeb89e476145d40538684c0926908d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTM2NzgyOnYy", "diffSide": "RIGHT", "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMjowOTo1N1rOFy2pZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjozMzoyNVrOFzlMPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2ODQ1NA==", "bodyText": "this should no longer be necessary since flink-s3-fs-base no longer bundles this dependency", "url": "https://github.com/apache/flink/pull/11123#discussion_r388868454", "createdAt": "2020-03-06T12:09:57Z", "author": {"login": "zentol"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>\n+\t\t\t\t<executions>\n+\t\t\t\t\t<execution>\n+\t\t\t\t\t\t<id>shade-flink</id>\n+\t\t\t\t\t\t<phase>package</phase>\n+\t\t\t\t\t\t<goals>\n+\t\t\t\t\t\t\t<goal>shade</goal>\n+\t\t\t\t\t\t</goals>\n+\t\t\t\t\t\t<configuration>\n+\t\t\t\t\t\t\t<filters>\n+\t\t\t\t\t\t\t\t<filter>\n+\t\t\t\t\t\t\t\t\t<artifact>com.amazonaws:aws-java-sdk-s3</artifact>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd9da339fdfee9967e478154bf127976b7a333b5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYzMTAzOQ==", "bodyText": "Good catch. Not sure why I thought it was necessary.", "url": "https://github.com/apache/flink/pull/11123#discussion_r389631039", "createdAt": "2020-03-09T12:33:25Z", "author": {"login": "AHeise"}, "path": "flink-filesystems/flink-s3-fs-base/pom.xml", "diffHunk": "@@ -231,6 +231,33 @@ under the License.\n \t\t\t\t\t<skip>true</skip>\n \t\t\t\t</configuration>\n \t\t\t</plugin>\n+\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>\n+\t\t\t\t<executions>\n+\t\t\t\t\t<execution>\n+\t\t\t\t\t\t<id>shade-flink</id>\n+\t\t\t\t\t\t<phase>package</phase>\n+\t\t\t\t\t\t<goals>\n+\t\t\t\t\t\t\t<goal>shade</goal>\n+\t\t\t\t\t\t</goals>\n+\t\t\t\t\t\t<configuration>\n+\t\t\t\t\t\t\t<filters>\n+\t\t\t\t\t\t\t\t<filter>\n+\t\t\t\t\t\t\t\t\t<artifact>com.amazonaws:aws-java-sdk-s3</artifact>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg2ODQ1NA=="}, "originalCommit": {"oid": "bd9da339fdfee9967e478154bf127976b7a333b5"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 944, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}