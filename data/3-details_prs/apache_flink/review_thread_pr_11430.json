{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTY1OTU2", "number": 11430, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0Mjo0MVrODo0rug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNjo1MTowNlrODpl66A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMyNzk0OnYy", "diffSide": "LEFT", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0Mjo0MVrOF3nLrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzowNjozMVrOF34ahw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1Nzk2NQ==", "bodyText": "Add a simple utility function boolean isNotEmpty(@Nullable String) that you call 3 times. This is both more readable and would've prevented bugs like in the second line below where S3_TEST_SECRET_KEY.isEmpty() is missing a negation.", "url": "https://github.com/apache/flink/pull/11430#discussion_r393857965", "createdAt": "2020-03-17T17:42:41Z", "author": {"login": "zentol"}, "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,8 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25282859e69411e8320cb694679c1404921b5305"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE0MDI5NQ==", "bodyText": "Thanks a lot. That's a very good idea :)", "url": "https://github.com/apache/flink/pull/11430#discussion_r394140295", "createdAt": "2020-03-18T07:06:31Z", "author": {"login": "rmetzger"}, "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,8 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1Nzk2NQ=="}, "originalCommit": {"oid": "25282859e69411e8320cb694679c1404921b5305"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMzMzE2OnYy", "diffSide": "RIGHT", "path": "tools/azure-pipelines/jobs-template.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0NDowNVrOF3nPMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjo1OTo0MFrOF34SBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1ODg2Nw==", "bodyText": "So this was completely broken from the start?", "url": "https://github.com/apache/flink/pull/11430#discussion_r393858867", "createdAt": "2020-03-17T17:44:05Z", "author": {"login": "zentol"}, "path": "tools/azure-pipelines/jobs-template.yml", "diffHunk": "@@ -123,9 +123,9 @@ jobs:\n   - script: STAGE=test ${{parameters.environment}} ./tools/azure_controller.sh $(module)\n     displayName: Test - $(module)\n     env:\n-      IT_CASE_S3_BUCKET: $(IT_CASE_S3_BUCKET)\n-      IT_CASE_S3_ACCESS_KEY: $(IT_CASE_S3_ACCESS_KEY)\n-      IT_CASE_S3_SECRET_KEY: $(IT_CASE_S3_SECRET_KEY)\n+      IT_CASE_S3_BUCKET: ${{variables['IT_CASE_S3_BUCKET']}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25282859e69411e8320cb694679c1404921b5305"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzODExNg==", "bodyText": "Yes  :( I did not test this w/o credentials set.", "url": "https://github.com/apache/flink/pull/11430#discussion_r394138116", "createdAt": "2020-03-18T06:59:40Z", "author": {"login": "rmetzger"}, "path": "tools/azure-pipelines/jobs-template.yml", "diffHunk": "@@ -123,9 +123,9 @@ jobs:\n   - script: STAGE=test ${{parameters.environment}} ./tools/azure_controller.sh $(module)\n     displayName: Test - $(module)\n     env:\n-      IT_CASE_S3_BUCKET: $(IT_CASE_S3_BUCKET)\n-      IT_CASE_S3_ACCESS_KEY: $(IT_CASE_S3_ACCESS_KEY)\n-      IT_CASE_S3_SECRET_KEY: $(IT_CASE_S3_SECRET_KEY)\n+      IT_CASE_S3_BUCKET: ${{variables['IT_CASE_S3_BUCKET']}}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1ODg2Nw=="}, "originalCommit": {"oid": "25282859e69411e8320cb694679c1404921b5305"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MzIwNTY2OnYy", "diffSide": "RIGHT", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNzo1ODowOVrOF35rlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwODowNjoxMVrOF355Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2MTA0Nw==", "bodyText": "let's make it private for no", "url": "https://github.com/apache/flink/pull/11430#discussion_r394161047", "createdAt": "2020-03-18T07:58:09Z", "author": {"login": "zentol"}, "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,14 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;\n+\t\treturn isNotEmpty(S3_TEST_BUCKET) && isNotEmpty(S3_TEST_ACCESS_KEY) && isNotEmpty(S3_TEST_SECRET_KEY);\n+\t}\n+\n+\t/**\n+\t * Checks if a String is not null and not empty.\n+\t */\n+\tpublic static boolean isNotEmpty(@Nullable String str) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2938805ce595d3263da2684bd8f44ff815ab36"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2NDUxMA==", "bodyText": "will do", "url": "https://github.com/apache/flink/pull/11430#discussion_r394164510", "createdAt": "2020-03-18T08:06:11Z", "author": {"login": "rmetzger"}, "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/s3/S3TestCredentials.java", "diffHunk": "@@ -44,7 +44,14 @@\n \t * of this JVM.\n \t */\n \tpublic static boolean credentialsAvailable() {\n-\t\treturn S3_TEST_BUCKET != null && S3_TEST_ACCESS_KEY != null && S3_TEST_SECRET_KEY != null;\n+\t\treturn isNotEmpty(S3_TEST_BUCKET) && isNotEmpty(S3_TEST_ACCESS_KEY) && isNotEmpty(S3_TEST_SECRET_KEY);\n+\t}\n+\n+\t/**\n+\t * Checks if a String is not null and not empty.\n+\t */\n+\tpublic static boolean isNotEmpty(@Nullable String str) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE2MTA0Nw=="}, "originalCommit": {"oid": "4a2938805ce595d3263da2684bd8f44ff815ab36"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0OTM5NDk2OnYy", "diffSide": "RIGHT", "path": "azure-pipelines.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNjo1MTowNlrOF43dgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoyNDo1N1rOF442jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3MzI1MQ==", "bodyText": "Were you not trying $[variables.IT_CASE_S3_BUCKET] in your original post? what else had to be change for things to work?", "url": "https://github.com/apache/flink/pull/11430#discussion_r395173251", "createdAt": "2020-03-19T16:51:06Z", "author": {"login": "zentol"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -40,13 +40,19 @@ resources:\n   - container: flink-build-container\n     image: rmetzger/flink-ci:ubuntu-amd64-3528acd\n \n-# See tools/azure-pipelines/jobs-template.yml for a short summary of the caching\n+# Define variables:\n+# - See tools/azure-pipelines/jobs-template.yml for a short summary of the caching\n+# - See https://stackoverflow.com/questions/60742105/how-can-i-access-a-secret-value-from-an-azure-pipelines-expression", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85a7515407184f45009e7cbe7f6c7099ea4a41be"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NjA0NQ==", "bodyText": "Currently on master, we have the $(variables.IT_CASE_S3_BUCKET) syntax, which, returns the variable, or $(variables.IT_CASE_S3_BUCKET) if nothing is set.\nWhat I first proposed in the PR was $[variables.IT_CASE_S3_BUCKET], which is always empty, if you use it in the env block of a task.\nNow, I use this weird workaround of defining the variables in the pipeline definion.\nI don't think this behavior is very intuitive.\nhttps://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch", "url": "https://github.com/apache/flink/pull/11430#discussion_r395196045", "createdAt": "2020-03-19T17:24:57Z", "author": {"login": "rmetzger"}, "path": "azure-pipelines.yml", "diffHunk": "@@ -40,13 +40,19 @@ resources:\n   - container: flink-build-container\n     image: rmetzger/flink-ci:ubuntu-amd64-3528acd\n \n-# See tools/azure-pipelines/jobs-template.yml for a short summary of the caching\n+# Define variables:\n+# - See tools/azure-pipelines/jobs-template.yml for a short summary of the caching\n+# - See https://stackoverflow.com/questions/60742105/how-can-i-access-a-secret-value-from-an-azure-pipelines-expression", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3MzI1MQ=="}, "originalCommit": {"oid": "85a7515407184f45009e7cbe7f6c7099ea4a41be"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 805, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}