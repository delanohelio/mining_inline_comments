{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNTU2OTk5", "number": 12314, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMjozMFrOD_RRvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMzoyM1rOD_RSbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjY5OTQ4OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMjozMFrOGZ1kig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMjozMFrOGZ1kig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0NTI5MA==", "bodyText": "Can you move this execute into if (filter.test(result.getTable()))?", "url": "https://github.com/apache/flink/pull/12314#discussion_r429745290", "createdAt": "2020-05-25T06:02:30Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "diffHunk": "@@ -682,20 +682,60 @@ public void alterTable(CatalogBaseTable table, ObjectIdentifier objectIdentifier\n \t * Drops a table in a given fully qualified path.\n \t *\n \t * @param objectIdentifier The fully qualified path of the table to drop.\n-\t * @param ignoreIfNotExists If false exception will be thrown if the table or database or catalog to be altered\n+\t * @param ignoreIfNotExists If false exception will be thrown if the table to drop\n \t *                          does not exist.\n \t */\n \tpublic void dropTable(ObjectIdentifier objectIdentifier, boolean ignoreIfNotExists) {\n-\t\tif (temporaryTables.containsKey(objectIdentifier)) {\n-\t\t\tthrow new ValidationException(String.format(\n-\t\t\t\t\"Temporary table with identifier '%s' exists. Drop it first before removing the permanent table.\",\n-\t\t\t\tobjectIdentifier));\n+\t\tdropTableInternal(\n+\t\t\t\tobjectIdentifier,\n+\t\t\t\ttable -> table instanceof CatalogTable,\n+\t\t\t\tignoreIfNotExists);\n+\t}\n+\n+\t/**\n+\t * Drops a view in a given fully qualified path.\n+\t *\n+\t * @param objectIdentifier The fully qualified path of the view to drop.\n+\t * @param ignoreIfNotExists If false exception will be thrown if the view to drop\n+\t *                          does not exist.\n+\t */\n+\tpublic void dropView(ObjectIdentifier objectIdentifier, boolean ignoreIfNotExists) {\n+\t\tdropTableInternal(\n+\t\t\t\tobjectIdentifier,\n+\t\t\t\ttable -> table instanceof CatalogView,\n+\t\t\t\tignoreIfNotExists);\n+\t}\n+\n+\tprivate void dropTableInternal(\n+\t\t\tObjectIdentifier objectIdentifier,\n+\t\t\tPredicate<CatalogBaseTable> filter,\n+\t\t\tboolean ignoreIfNotExists) {\n+\t\tfinal Optional<TableLookupResult> resultOpt = getTable(objectIdentifier);\n+\t\tif (resultOpt.isPresent()) {\n+\t\t\tfinal TableLookupResult result = resultOpt.get();\n+\t\t\tif (filter.test(result.getTable())) {\n+\t\t\t\tif (result.isTemporary()) {\n+\t\t\t\t\t// Same name temporary table or view exists.\n+\t\t\t\t\tthrow new ValidationException(String.format(\n+\t\t\t\t\t\t\t\"Temporary table or view with identifier '%s' exists. \"\n+\t\t\t\t\t\t\t\t\t+ \"Drop it first before removing the permanent table or view.\",\n+\t\t\t\t\t\t\tobjectIdentifier));\n+\t\t\t\t}\n+\t\t\t} else if (!ignoreIfNotExists) {\n+\t\t\t\t// To drop a table but the object identifier represents a view(or vise versa).\n+\t\t\t\tthrow new ValidationException(String.format(\n+\t\t\t\t\t\t\"Table or view with identifier '%s' does not exist.\",\n+\t\t\t\t\t\tobjectIdentifier.asSummaryString()));\n+\t\t\t} else {\n+\t\t\t\t// Table or view does not exist with ignoreIfNotExists true, do nothing.\n+\t\t\t\treturn;\n+\t\t\t}\n \t\t}\n \t\texecute(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7a68f0f07ab9bb2abc3182d72c0dc80ed59dda1"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjcwMTI3OnYy", "diffSide": "RIGHT", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMzoyM1rOGZ1lgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNjowMzoyM1rOGZ1lgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0NTUzOQ==", "bodyText": "Why not just getPermanentTable? You can keep previous temporaryTables.containsKey(objectIdentifier)", "url": "https://github.com/apache/flink/pull/12314#discussion_r429745539", "createdAt": "2020-05-25T06:03:23Z", "author": {"login": "JingsongLi"}, "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "diffHunk": "@@ -682,20 +682,60 @@ public void alterTable(CatalogBaseTable table, ObjectIdentifier objectIdentifier\n \t * Drops a table in a given fully qualified path.\n \t *\n \t * @param objectIdentifier The fully qualified path of the table to drop.\n-\t * @param ignoreIfNotExists If false exception will be thrown if the table or database or catalog to be altered\n+\t * @param ignoreIfNotExists If false exception will be thrown if the table to drop\n \t *                          does not exist.\n \t */\n \tpublic void dropTable(ObjectIdentifier objectIdentifier, boolean ignoreIfNotExists) {\n-\t\tif (temporaryTables.containsKey(objectIdentifier)) {\n-\t\t\tthrow new ValidationException(String.format(\n-\t\t\t\t\"Temporary table with identifier '%s' exists. Drop it first before removing the permanent table.\",\n-\t\t\t\tobjectIdentifier));\n+\t\tdropTableInternal(\n+\t\t\t\tobjectIdentifier,\n+\t\t\t\ttable -> table instanceof CatalogTable,\n+\t\t\t\tignoreIfNotExists);\n+\t}\n+\n+\t/**\n+\t * Drops a view in a given fully qualified path.\n+\t *\n+\t * @param objectIdentifier The fully qualified path of the view to drop.\n+\t * @param ignoreIfNotExists If false exception will be thrown if the view to drop\n+\t *                          does not exist.\n+\t */\n+\tpublic void dropView(ObjectIdentifier objectIdentifier, boolean ignoreIfNotExists) {\n+\t\tdropTableInternal(\n+\t\t\t\tobjectIdentifier,\n+\t\t\t\ttable -> table instanceof CatalogView,\n+\t\t\t\tignoreIfNotExists);\n+\t}\n+\n+\tprivate void dropTableInternal(\n+\t\t\tObjectIdentifier objectIdentifier,\n+\t\t\tPredicate<CatalogBaseTable> filter,\n+\t\t\tboolean ignoreIfNotExists) {\n+\t\tfinal Optional<TableLookupResult> resultOpt = getTable(objectIdentifier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7a68f0f07ab9bb2abc3182d72c0dc80ed59dda1"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4446, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}