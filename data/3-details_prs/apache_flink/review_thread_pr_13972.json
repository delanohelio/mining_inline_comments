{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2OTEwOTg5", "number": 13972, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDoyODo1MlrOE2mcjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNzowOTowMVrOE3FqeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Njg4NDYxOnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDoyODo1MlrOHvenAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDoyODo1MlrOHvenAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU0NjYyNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t.withDescription(\"Optional flag to specify string literal when 'map-null-key.literal' is LITERAL, \\\"null\\\" by default.\");\n          \n          \n            \n            \t\t.withDescription(\"Optional flag to specify string literal for null keys when 'map-null-key.mode' is LITERAL, \\\"null\\\" by default.\");", "url": "https://github.com/apache/flink/pull/13972#discussion_r519546625", "createdAt": "2020-11-09T04:28:52Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonOptions.java", "diffHunk": "@@ -36,14 +40,28 @@\n \t\t\t.key(\"fail-on-missing-field\")\n \t\t\t.booleanType()\n \t\t\t.defaultValue(false)\n-\t\t\t.withDescription(\"Optional flag to specify whether to fail if a field is missing or not, false by default\");\n+\t\t\t.withDescription(\"Optional flag to specify whether to fail if a field is missing or not, false by default.\");\n \n \tpublic static final ConfigOption<Boolean> IGNORE_PARSE_ERRORS = ConfigOptions\n \t\t\t.key(\"ignore-parse-errors\")\n \t\t\t.booleanType()\n \t\t\t.defaultValue(false)\n \t\t\t.withDescription(\"Optional flag to skip fields and rows with parse errors instead of failing;\\n\"\n-\t\t\t\t\t+ \"fields are set to null in case of errors, false by default\");\n+\t\t\t\t\t+ \"fields are set to null in case of errors, false by default.\");\n+\n+\tpublic static final ConfigOption<String> MAP_NULL_KEY_MODE = ConfigOptions\n+\t\t.key(\"map-null-key.mode\")\n+\t\t.stringType()\n+\t\t.defaultValue(\"FAIL\")\n+\t\t.withDescription(\"Optional flag to control the handling mode when serializing null key for map data, FAIL by default.\"\n+\t\t\t+ \" Option DROP will drop null key entries for map data.\"\n+\t\t\t+ \" Option LITERAL will use 'map-null-key.literal' as key literal.\");\n+\n+\tpublic static final ConfigOption<String> MAP_NULL_KEY_LITERAL = ConfigOptions\n+\t\t.key(\"map-null-key.literal\")\n+\t\t.stringType()\n+\t\t.defaultValue(\"null\")\n+\t\t.withDescription(\"Optional flag to specify string literal when 'map-null-key.literal' is LITERAL, \\\"null\\\" by default.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "951191135eee7d3f7fddea2a5e296dbd36716dd3"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Njg5OTk2OnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDozOToxNlrOHvevrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDozOToxNlrOHvevrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU0ODg0Nw==", "bodyText": "We don't need JSON_MAP_NULL_KEY_MODE_ENUM.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t// validator for {@link MAP_NULL_KEY_MODE}\n          \n          \n            \n            \t\tif (!JSON_MAP_NULL_KEY_MODE_ENUM.contains(mapNullKeyMode.toUpperCase())){\n          \n          \n            \n            \t\t\tthrow new ValidationException(\n          \n          \n            \n            \t\t\t\tString.format(\"Unsupported value '%s' for %s. Supported values are [FAIL, DROP, LITERAL].\",\n          \n          \n            \n            \t\t\t\t\tmapNullKeyMode, MAP_NULL_KEY_MODE.key()));\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \t\tSet<String> nullKeyModes = Arrays.stream(MapNullKeyMode.values())\n          \n          \n            \n            \t\t\t.map(Objects::toString)\n          \n          \n            \n            \t\t\t.collect(Collectors.toSet());\n          \n          \n            \n            \t\tif (!nullKeyModes.contains(tableOptions.get(MAP_NULL_KEY_MODE).toUpperCase())){\n          \n          \n            \n            \t\t\tthrow new ValidationException(String.format(\n          \n          \n            \n            \t\t\t\t\"Unsupported value '%s' for option %s. Supported values are %s.\",\n          \n          \n            \n            \t\t\t\tmapNullKeyMode,\n          \n          \n            \n            \t\t\t\tMAP_NULL_KEY_MODE.key(),\n          \n          \n            \n            \t\t\t\tnullKeyModes));\n          \n          \n            \n            \t\t}", "url": "https://github.com/apache/flink/pull/13972#discussion_r519548847", "createdAt": "2020-11-09T04:39:16Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonOptions.java", "diffHunk": "@@ -81,4 +110,89 @@ public static TimestampFormat getTimestampFormat(ReadableConfig config){\n \t\t\t\t\tString.format(\"Unsupported timestamp format '%s'. Validator should have checked that.\", timestampFormat));\n \t\t}\n \t}\n+\n+\t/**\n+\t * Creates handling mode for null key map data.\n+\t *\n+\t * <p>See {@link #JSON_MAP_NULL_KEY_MODE_FAIL}, {@link #JSON_MAP_NULL_KEY_MODE_DROP},\n+\t * and {@link #JSON_MAP_NULL_KEY_MODE_LITERAL} for more information.\n+\t */\n+\tpublic static MapNullKeyMode getMapNullKeyMode(ReadableConfig config){\n+\t\tString mapNullKeyMode = config.get(MAP_NULL_KEY_MODE);\n+\t\tswitch (mapNullKeyMode.toUpperCase()){\n+\t\t\tcase JSON_MAP_NULL_KEY_MODE_FAIL:\n+\t\t\t\treturn MapNullKeyMode.FAIL;\n+\t\t\tcase JSON_MAP_NULL_KEY_MODE_DROP:\n+\t\t\t\treturn MapNullKeyMode.DROP;\n+\t\t\tcase JSON_MAP_NULL_KEY_MODE_LITERAL:\n+\t\t\t\treturn MapNullKeyMode.LITERAL;\n+\t\t\tdefault:\n+\t\t\t\tthrow new TableException(\n+\t\t\t\t\tString.format(\"Unsupported map null key handling mode '%s'. Validator should have checked that.\", mapNullKeyMode));\n+\t\t}\n+\t}\n+\n+\t// --------------------------------------------------------------------------------------------\n+\t// Inner classes\n+\t// --------------------------------------------------------------------------------------------\n+\n+\t/** Handling mode for map data with null key. */\n+\tpublic enum MapNullKeyMode {\n+\t\tFAIL,\n+\t\tDROP,\n+\t\tLITERAL\n+\t}\n+\n+\t// --------------------------------------------------------------------------------------------\n+\t// Validation\n+\t// --------------------------------------------------------------------------------------------\n+\n+\t/**\n+\t * Validator for decoding format.\n+\t */\n+\tpublic static void validateDecodingFormatOptions(ReadableConfig tableOptions) {\n+\t\tboolean failOnMissingField = tableOptions.get(FAIL_ON_MISSING_FIELD);\n+\t\tboolean ignoreParseErrors = tableOptions.get(IGNORE_PARSE_ERRORS);\n+\t\tif (ignoreParseErrors && failOnMissingField) {\n+\t\t\tthrow new ValidationException(FAIL_ON_MISSING_FIELD.key()\n+\t\t\t\t+ \" and \"\n+\t\t\t\t+ IGNORE_PARSE_ERRORS.key()\n+\t\t\t\t+ \" shouldn't both be true.\");\n+\t\t}\n+\t\tvalidateTimestampFormat(tableOptions);\n+\t}\n+\n+\t/**\n+\t * Validator for encoding format.\n+\t */\n+\tpublic static void validateEncodingFormatOptions(ReadableConfig tableOptions) {\n+\t\tString mapNullKeyMode = tableOptions.get(MAP_NULL_KEY_MODE);\n+\t\t// validator for {@link MAP_NULL_KEY_MODE}\n+\t\tif (!JSON_MAP_NULL_KEY_MODE_ENUM.contains(mapNullKeyMode.toUpperCase())){\n+\t\t\tthrow new ValidationException(\n+\t\t\t\tString.format(\"Unsupported value '%s' for %s. Supported values are [FAIL, DROP, LITERAL].\",\n+\t\t\t\t\tmapNullKeyMode, MAP_NULL_KEY_MODE.key()));\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "951191135eee7d3f7fddea2a5e296dbd36716dd3"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzI4ODc4OnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonFormatFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNzo0NDo0NFrOHviSTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNzo0NDo0NFrOHviSTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYwNjg2MQ==", "bodyText": "Separate parameters into a new line.", "url": "https://github.com/apache/flink/pull/13972#discussion_r519606861", "createdAt": "2020-11-09T07:44:44Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonFormatFactory.java", "diffHunk": "@@ -96,16 +98,21 @@ public ChangelogMode getChangelogMode() {\n \t\t\tDynamicTableFactory.Context context,\n \t\t\tReadableConfig formatOptions) {\n \t\tFactoryUtil.validateFactoryOptions(this, formatOptions);\n+\t\tvalidateEncodingFormatOptions(formatOptions);\n \n \t\tTimestampFormat timestampOption = JsonOptions.getTimestampFormat(formatOptions);\n+\t\tJsonOptions.MapNullKeyMode mapNullKeyMode = JsonOptions.getMapNullKeyMode(formatOptions);\n+\t\tString mapNullKeyLiteral = formatOptions.get(MAP_NULL_KEY_LITERAL);\n \n \t\treturn new EncodingFormat<SerializationSchema<RowData>>() {\n \t\t\t@Override\n \t\t\tpublic SerializationSchema<RowData> createRuntimeEncoder(\n \t\t\t\t\tDynamicTableSink.Context context,\n \t\t\t\t\tDataType consumedDataType) {\n \t\t\t\tfinal RowType rowType = (RowType) consumedDataType.getLogicalType();\n-\t\t\t\treturn new JsonRowDataSerializationSchema(rowType, timestampOption);\n+\t\t\t\treturn new JsonRowDataSerializationSchema(\n+\t\t\t\t\t\trowType, timestampOption,\n+\t\t\t\t\t\tmapNullKeyMode, mapNullKeyLiteral);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2dcd73cb70c5a3a1628aeff8dc1fb8e05d6fd53"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzM3ODg2OnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoxMjozMVrOHvjGIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoxMjozMVrOHvjGIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyMDEyOQ==", "bodyText": "Can simplify invoking keyArray.isNullAt(i) here.", "url": "https://github.com/apache/flink/pull/13972#discussion_r519620129", "createdAt": "2020-11-09T08:12:31Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "diffHunk": "@@ -250,7 +261,26 @@ private RowDataToJsonConverter createMapConverter(\n \t\t\tArrayData valueArray = map.valueArray();\n \t\t\tint numElements = map.size();\n \t\t\tfor (int i = 0; i < numElements; i++) {\n-\t\t\t\tString fieldName = keyArray.getString(i).toString(); // key must be string\n+\t\t\t\tboolean isFieldNameNull = keyArray.isNullAt(i);\n+\t\t\t\tString fieldName = null;\n+\t\t\t\tif (isFieldNameNull) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2dcd73cb70c5a3a1628aeff8dc1fb8e05d6fd53"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzM3OTY1OnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoxMjo0OVrOHvjGrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODoxMjo0OVrOHvjGrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYyMDI2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\t\tthrow new RuntimeException(\"Map key is null, please have a check.\"\n          \n          \n            \n            \t\t\t\t\t\t\t\t+ \" You can setup null key handling mode to drop entry or replace with a no-null literal.\");\n          \n          \n            \n            \t\t\t\t\t\t\tthrow new RuntimeException(String.format(\n          \n          \n            \n            \t\t\t\t\t\t\t\t\"JSON format doesn't support to serialize map data with null keys. \" +\n          \n          \n            \n            \t\t\t\t\t\t\t\t\t\"You can drop null key entries or encode null in literals by specifying %s option.\",\n          \n          \n            \n            \t\t\t\t\t\t\t\tJsonOptions.MAP_NULL_KEY_LITERAL.key()));", "url": "https://github.com/apache/flink/pull/13972#discussion_r519620269", "createdAt": "2020-11-09T08:12:49Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "diffHunk": "@@ -250,7 +261,26 @@ private RowDataToJsonConverter createMapConverter(\n \t\t\tArrayData valueArray = map.valueArray();\n \t\t\tint numElements = map.size();\n \t\t\tfor (int i = 0; i < numElements; i++) {\n-\t\t\t\tString fieldName = keyArray.getString(i).toString(); // key must be string\n+\t\t\t\tboolean isFieldNameNull = keyArray.isNullAt(i);\n+\t\t\t\tString fieldName = null;\n+\t\t\t\tif (isFieldNameNull) {\n+\t\t\t\t\t// when map key is null\n+\t\t\t\t\tswitch (mapNullKeyMode) {\n+\t\t\t\t\t\tcase LITERAL:\n+\t\t\t\t\t\t\tfieldName = mapNullKeyLiteral;\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\tcase DROP:\n+\t\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t\tcase FAIL:\n+\t\t\t\t\t\t\tthrow new RuntimeException(\"Map key is null, please have a check.\"\n+\t\t\t\t\t\t\t\t+ \" You can setup null key handling mode to drop entry or replace with a no-null literal.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2dcd73cb70c5a3a1628aeff8dc1fb8e05d6fd53"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzU4ODI1OnYy", "diffSide": "RIGHT", "path": "docs/dev/table/connectors/formats/json.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOTowOToxNVrOHvlDAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOTowOToxNVrOHvlDAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MjA5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <li>Option <code>'LITERAL'</code> will replace null key with string literal.</li>\n          \n          \n            \n                    <li>Option <code>'LITERAL'</code> will replace null key with string literal. The string literal is defined by <code>json.map-null-key.literal</code> option.</li>", "url": "https://github.com/apache/flink/pull/13972#discussion_r519652098", "createdAt": "2020-11-09T09:09:15Z", "author": {"login": "wuchong"}, "path": "docs/dev/table/connectors/formats/json.md", "diffHunk": "@@ -117,6 +117,26 @@ Format Options\n       </ul>\n       </td>\n     </tr>\n+    <tr>\n+      <td><h5>json.map-null-key.mode</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\"><code>'FAIL'</code></td>\n+      <td>String</td>\n+      <td>Specify the handling mode when serializing null keys for map data. Currently supported values are <code>'FAIL'</code>, <code>'DROP'</code> and <code>'LITERAL'</code>:\n+      <ul>\n+        <li>Option <code>'FAIL'</code> will throw exception when encountering map with null key.</li>\n+        <li>Option <code>'DROP'</code> will drop null key entries for map data.</li>\n+        <li>Option <code>'LITERAL'</code> will replace null key with string literal.</li>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2dcd73cb70c5a3a1628aeff8dc1fb8e05d6fd53"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NzU5NTEzOnYy", "diffSide": "RIGHT", "path": "docs/dev/table/connectors/formats/json.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOToxMDo1OVrOHvlG8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOToxMDo1OVrOHvlG8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1MzEwNw==", "bodyText": "json.map-null-key.mode", "url": "https://github.com/apache/flink/pull/13972#discussion_r519653107", "createdAt": "2020-11-09T09:10:59Z", "author": {"login": "wuchong"}, "path": "docs/dev/table/connectors/formats/json.md", "diffHunk": "@@ -117,6 +117,26 @@ Format Options\n       </ul>\n       </td>\n     </tr>\n+    <tr>\n+      <td><h5>json.map-null-key.mode</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\"><code>'FAIL'</code></td>\n+      <td>String</td>\n+      <td>Specify the handling mode when serializing null keys for map data. Currently supported values are <code>'FAIL'</code>, <code>'DROP'</code> and <code>'LITERAL'</code>:\n+      <ul>\n+        <li>Option <code>'FAIL'</code> will throw exception when encountering map with null key.</li>\n+        <li>Option <code>'DROP'</code> will drop null key entries for map data.</li>\n+        <li>Option <code>'LITERAL'</code> will replace null key with string literal.</li>\n+      </ul>\n+      </td>\n+    </tr>\n+    <tr>\n+      <td><h5>json.map-null-key.literal</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\">'null'</td>\n+      <td>String</td>\n+      <td>Specify string literal to replace null key when <code>'json.map-null-key.literal'</code> is LITERAL.</td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2dcd73cb70c5a3a1628aeff8dc1fb8e05d6fd53"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTk5OTI5OnYy", "diffSide": "RIGHT", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNzowOTowMVrOHwOzNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNzoyOTowM1rOHwPSXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDMzNjE4MQ==", "bodyText": "Sorry, it should be MAP_NULL_KEY_MODE option.", "url": "https://github.com/apache/flink/pull/13972#discussion_r520336181", "createdAt": "2020-11-10T07:09:01Z", "author": {"login": "wuchong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "diffHunk": "@@ -272,8 +271,10 @@ private RowDataToJsonConverter createMapConverter(\n \t\t\t\t\t\tcase DROP:\n \t\t\t\t\t\t\tcontinue;\n \t\t\t\t\t\tcase FAIL:\n-\t\t\t\t\t\t\tthrow new RuntimeException(\"Map key is null, please have a check.\"\n-\t\t\t\t\t\t\t\t+ \" You can setup null key handling mode to drop entry or replace with a no-null literal.\");\n+\t\t\t\t\t\t\tthrow new RuntimeException(String.format(\n+\t\t\t\t\t\t\t\t\"JSON format doesn't support to serialize map data with null keys. \"\n+\t\t\t\t\t\t\t\t\t+ \"You can drop null key entries or encode null in literals by specifying %s option.\",\n+\t\t\t\t\t\t\t\tJsonOptions.MAP_NULL_KEY_LITERAL.key()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1393af2a259f5db3cd78f49130412df83a062a5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM0NDE1Ng==", "bodyText": "done~", "url": "https://github.com/apache/flink/pull/13972#discussion_r520344156", "createdAt": "2020-11-10T07:29:03Z", "author": {"login": "wangxlong"}, "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/RowDataToJsonConverters.java", "diffHunk": "@@ -272,8 +271,10 @@ private RowDataToJsonConverter createMapConverter(\n \t\t\t\t\t\tcase DROP:\n \t\t\t\t\t\t\tcontinue;\n \t\t\t\t\t\tcase FAIL:\n-\t\t\t\t\t\t\tthrow new RuntimeException(\"Map key is null, please have a check.\"\n-\t\t\t\t\t\t\t\t+ \" You can setup null key handling mode to drop entry or replace with a no-null literal.\");\n+\t\t\t\t\t\t\tthrow new RuntimeException(String.format(\n+\t\t\t\t\t\t\t\t\"JSON format doesn't support to serialize map data with null keys. \"\n+\t\t\t\t\t\t\t\t\t+ \"You can drop null key entries or encode null in literals by specifying %s option.\",\n+\t\t\t\t\t\t\t\tJsonOptions.MAP_NULL_KEY_LITERAL.key()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDMzNjE4MQ=="}, "originalCommit": {"oid": "e1393af2a259f5db3cd78f49130412df83a062a5"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4841, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}