{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4Nzc5Nzc3", "number": 13175, "title": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message", "bodyText": "What is the purpose of the change\nAdd checkpoint path to job startup/restore message to help users identify which checkpoint is used for restoring.\nBrief change log\n\nadd externalPointer to the message\n\nVerifying this change\nTest Msg like this:\nTest:\nIt produces something similar to:\n8366 [flink-akka.actor.default-dispatcher-4] INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Restoring job 7aec7905c64fcf38ceb2b86e6193638d from CHECKPOINT 1 @ 1597898260536 for 7aec7905c64fcf38ceb2b86e6193638d located at file:/var/folders/dm/5xn_h6n9135dwy4j27sr65zh0000gp/T/junit495383509976337357/junit8019506371853310216/checkpoints/7aec7905c64fcf38ceb2b86e6193638d/chk-1.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)", "createdAt": "2020-08-17T11:46:40Z", "url": "https://github.com/apache/flink/pull/13175", "merged": true, "mergeCommit": {"oid": "3b1b77e5611fb2ff77a2515c676b3299964a0d5a"}, "closed": true, "closedAt": "2020-08-24T08:17:39Z", "author": {"login": "curcur"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_-qKugBqjM2NjQ0MTY0MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB-J6XAFqTQ3MzIxMzQ3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "888d10fb3a82d69704454c3d0e71081e7e1e6b5c", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/888d10fb3a82d69704454c3d0e71081e7e1e6b5c", "committedDate": "2020-08-17T11:39:12Z", "message": "[FLINK-18955] Add checkpoint path to job startup/restore message"}, "afterCommit": {"oid": "eded77e663409ce1c6436ec7217fc93ce6520eb8", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/eded77e663409ce1c6436ec7217fc93ce6520eb8", "committedDate": "2020-08-18T03:42:31Z", "message": "[FLINK-18955] Add checkpoint path to job startup/restore message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eded77e663409ce1c6436ec7217fc93ce6520eb8", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/eded77e663409ce1c6436ec7217fc93ce6520eb8", "committedDate": "2020-08-18T03:42:31Z", "message": "[FLINK-18955] Add checkpoint path to job startup/restore message"}, "afterCommit": {"oid": "755d0eb542a50f3a7c9e58d19325f489cb113d19", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/755d0eb542a50f3a7c9e58d19325f489cb113d19", "committedDate": "2020-08-18T03:45:35Z", "message": "[FLINK-18955][Runtime] Add checkpoint path to job startup/restore message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "755d0eb542a50f3a7c9e58d19325f489cb113d19", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/755d0eb542a50f3a7c9e58d19325f489cb113d19", "committedDate": "2020-08-18T03:45:35Z", "message": "[FLINK-18955][Runtime] Add checkpoint path to job startup/restore message"}, "afterCommit": {"oid": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "committedDate": "2020-08-18T03:46:52Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDAyMjU0", "url": "https://github.com/apache/flink/pull/13175#pullrequestreview-470402254", "createdAt": "2020-08-19T12:23:16Z", "commit": {"oid": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMjoyMzoxNlrOHDE3Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMjoyMzoxNlrOHDE3Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzQxOA==", "bodyText": "I don't really see how @NicoK 's suggestion makes it clearer that it could also be a savepoint.\nMy suggestion would be to encode the type checkpoint/savepoint into CompletedCheckpoint#toString and just use: LOG.info(\"Restoring job {} from  {}.\", job, latest);.\nThen the full message would be\n8004 [flink-akka.actor.default-dispatcher-3] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Restoring job 36681198e38a2c91932eb131f47e3641 from Checkpoint 1 @ 1597663438566 for 36681198e38a2c91932eb131f47e3641 located at file:/var/folders/dm/5xn_h6n9135dwy4j27sr65zh0000gp/T/junit492898918775365121/junit2392379173263601046/checkpoints/36681198e38a2c91932eb131f47e3641/chk-1.\n\ninstead of\n8004 [flink-akka.actor.default-dispatcher-3] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Restoring job 36681198e38a2c91932eb131f47e3641 from checkpoint: Checkpoint 1 @ 1597663438566 for 36681198e38a2c91932eb131f47e3641 located at file:/var/folders/dm/5xn_h6n9135dwy4j27sr65zh0000gp/T/junit492898918775365121/junit2392379173263601046/checkpoints/36681198e38a2c91932eb131f47e3641/chk-1.", "url": "https://github.com/apache/flink/pull/13175#discussion_r472987418", "createdAt": "2020-08-19T12:23:16Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java", "diffHunk": "@@ -1293,7 +1293,7 @@ private boolean restoreLatestCheckpointedStateInternal(\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tLOG.info(\"Restoring job {} from latest valid checkpoint: {}.\", job, latest);\n+\t\t\tLOG.info(\"Restoring job {} from checkpoint: {}.\", job, latest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/0cc43ac38a2161bfd6c005782c08d2c70cc47e43", "committedDate": "2020-08-18T03:46:52Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}, "afterCommit": {"oid": "635f839466122e36674a38a9845c2d6b5eb5c244", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/635f839466122e36674a38a9845c2d6b5eb5c244", "committedDate": "2020-08-20T04:46:38Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzgwNzgy", "url": "https://github.com/apache/flink/pull/13175#pullrequestreview-471380782", "createdAt": "2020-08-20T08:36:19Z", "commit": {"oid": "635f839466122e36674a38a9845c2d6b5eb5c244"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODozNjoxOVrOHD0ZQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODozNjoxOVrOHD0ZQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc2NjIwOQ==", "bodyText": "Currently that would display:\n\"CHECKPOINT\"\n\"SAVEPOINT\"\n\"SYNC_SAVEPOINT\"\nI'm proposing to translate them into just \"Checkpoint\" and \"Savepoint\" to reduce the technicality. However, no strong feelings, so you can also convince me that it's better to leave as is.", "url": "https://github.com/apache/flink/pull/13175#discussion_r473766209", "createdAt": "2020-08-20T08:36:19Z", "author": {"login": "AHeise"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CompletedCheckpoint.java", "diffHunk": "@@ -320,6 +320,12 @@ void setDiscardCallback(@Nullable CompletedCheckpointStats.DiscardCallback disca\n \n \t@Override\n \tpublic String toString() {\n-\t\treturn String.format(\"Checkpoint %d @ %d for %s\", checkpointID, timestamp, job);\n+\t\treturn String.format(\n+\t\t\t\"%s %d @ %d for %s located at %s\",\n+\t\t\tprops.getCheckpointType(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "635f839466122e36674a38a9845c2d6b5eb5c244"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "committedDate": "2020-08-21T16:55:45Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "635f839466122e36674a38a9845c2d6b5eb5c244", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/635f839466122e36674a38a9845c2d6b5eb5c244", "committedDate": "2020-08-20T04:46:38Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}, "afterCommit": {"oid": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "author": {"user": {"login": "curcur", "name": "Yuan Mei"}}, "url": "https://github.com/apache/flink/commit/78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7", "committedDate": "2020-08-21T16:55:45Z", "message": "[FLINK-18955][Checkpointing] Add checkpoint path to job startup/restore message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMjEzNDc3", "url": "https://github.com/apache/flink/pull/13175#pullrequestreview-473213477", "createdAt": "2020-08-24T08:16:06Z", "commit": {"oid": "78f6ef8e0aa36ddc08ecd4a6984ec465c0192ec7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4587, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}