{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTE0MzU3", "number": 12072, "title": "[FLINK-17315][tests/checkpointing] Reenabling UnalignedCheckpointITCase.", "bodyText": "What is the purpose of the change\nFixes all known checkpointing bugs in unaligned checkpoint to reenable UnalignedCheckpointITCase.\nBrief change log\n\nFixes NPE in unaligned checkpoint after EndOfPartition events.\nDisables priority event listener.\nFixes SpillingAdaptiveSpanningRecordDeserializer#getUnconsumedBuffer.\nLocalInputChannel also checkpoints in-flight data.\nReenables UnalignedCheckpointITCase.\n\nVerifying this change\n\nAdded unit test in StreamTaskNetworkInputTest#testSnapshotAfterEndOfPartition\nExpanded unit test SpanningRecordSerializationTest#testLargeSpanningRecordUnconsumedBufferWithLeftOverBytes\nAdded unit test LocalInputChannelTest#testCheckpointingInflightData\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (yes / no)\nThe serializers: (yes / no / don't know)\nThe runtime per-record code paths (performance sensitive): (yes / no / don't know)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (yes / no / don't know)\nThe S3 file system connector: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-05-11T07:15:08Z", "url": "https://github.com/apache/flink/pull/12072", "merged": true, "mergeCommit": {"oid": "71e85d8b3dd82fbd98ad040cd66bebd3d3294e26"}, "closed": true, "closedAt": "2020-05-12T17:56:34Z", "author": {"login": "AHeise"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgLNI9AFqTQwODk0NDkzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgiD6JABqjMzMjY5MTU4Njk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTQ0OTMy", "url": "https://github.com/apache/flink/pull/12072#pullrequestreview-408944932", "createdAt": "2020-05-11T08:00:29Z", "commit": {"oid": "9046a584b295d9b431dd0b34a86dbdac89603365"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwODowMDoyOVrOGTRAYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwODoxMDo0OVrOGTRWpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NDc1Mg==", "bodyText": "I guess the reason of not using Optional.flatMap was IOException thrown from RecordDeserializer.getUnconsumedBuffer.\nThe root cause of that IOException is DataOutputSerializer wrapping with it OOMs and RuntimeExceptions.\nSince the resulting IOException is never recovered or analyzed and originally it's RuntimeException I'd consider wrap IOException and use flatMap.", "url": "https://github.com/apache/flink/pull/12072#discussion_r422854752", "createdAt": "2020-05-11T08:00:29Z", "author": {"login": "rkhachatryan"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamTaskNetworkInput.java", "diffHunk": "@@ -210,12 +210,15 @@ public int getInputIndex() {\n \t\t\tfinal InputChannel channel = checkpointedInputGate.getChannel(channelIndex);\n \n \t\t\t// Assumption for retrieving buffers = one concurrent checkpoint\n-\t\t\trecordDeserializers[channelIndex].getUnconsumedBuffer().ifPresent(buffer ->\n-\t\t\t\tchannelStateWriter.addInputData(\n-\t\t\t\t\tcheckpointId,\n-\t\t\t\t\tchannel.getChannelInfo(),\n-\t\t\t\t\tChannelStateWriter.SEQUENCE_NUMBER_UNKNOWN,\n-\t\t\t\t\tbuffer));\n+\t\t\tRecordDeserializer<?> deserializer = recordDeserializers[channelIndex];\n+\t\t\tif (deserializer != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9046a584b295d9b431dd0b34a86dbdac89603365"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1ODg4Mg==", "bodyText": "1 -> numInputChannels ?", "url": "https://github.com/apache/flink/pull/12072#discussion_r422858882", "createdAt": "2020-05-11T08:08:02Z", "author": {"login": "rkhachatryan"}, "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/io/StreamTaskNetworkInputTest.java", "diffHunk": "@@ -106,6 +111,45 @@ public void testNoDataProcessedAfterCheckpointBarrier() throws Exception {\n \t\tassertEquals(0, output.getNumberOfEmittedRecords());\n \t}\n \n+\t@Test\n+\tpublic void testSnapshotAfterEndOfPartition() throws Exception {\n+\t\tVerifyRecordsDataOutput<Long> output = new VerifyRecordsDataOutput<>();\n+\t\tLongSerializer inSerializer = LongSerializer.INSTANCE;\n+\t\tint numInputChannels = 1;\n+\t\tStreamTestSingleInputGate<Long> inputGate = new StreamTestSingleInputGate<>(numInputChannels, 0, inSerializer, 1024);\n+\t\tTestRecordDeserializer[] deserializers = IntStream.range(0, numInputChannels)\n+\t\t\t.mapToObj(index -> new TestRecordDeserializer(ioManager.getSpillingDirectoriesPaths()))\n+\t\t\t.toArray(TestRecordDeserializer[]::new);\n+\t\tStreamTaskNetworkInput<Long> input = new StreamTaskNetworkInput<>(\n+\t\t\tnew CheckpointedInputGate(\n+\t\t\t\tinputGate.getInputGate(),\n+\t\t\t\tnew CheckpointBarrierUnaligner(\n+\t\t\t\t\tnew int[] { 1 },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9046a584b295d9b431dd0b34a86dbdac89603365"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg2MDQ1Mg==", "bodyText": "Extracting 0 to channelId would make the test a bit more readable.", "url": "https://github.com/apache/flink/pull/12072#discussion_r422860452", "createdAt": "2020-05-11T08:10:49Z", "author": {"login": "rkhachatryan"}, "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/io/StreamTaskNetworkInputTest.java", "diffHunk": "@@ -106,6 +111,45 @@ public void testNoDataProcessedAfterCheckpointBarrier() throws Exception {\n \t\tassertEquals(0, output.getNumberOfEmittedRecords());\n \t}\n \n+\t@Test\n+\tpublic void testSnapshotAfterEndOfPartition() throws Exception {\n+\t\tVerifyRecordsDataOutput<Long> output = new VerifyRecordsDataOutput<>();\n+\t\tLongSerializer inSerializer = LongSerializer.INSTANCE;\n+\t\tint numInputChannels = 1;\n+\t\tStreamTestSingleInputGate<Long> inputGate = new StreamTestSingleInputGate<>(numInputChannels, 0, inSerializer, 1024);\n+\t\tTestRecordDeserializer[] deserializers = IntStream.range(0, numInputChannels)\n+\t\t\t.mapToObj(index -> new TestRecordDeserializer(ioManager.getSpillingDirectoriesPaths()))\n+\t\t\t.toArray(TestRecordDeserializer[]::new);\n+\t\tStreamTaskNetworkInput<Long> input = new StreamTaskNetworkInput<>(\n+\t\t\tnew CheckpointedInputGate(\n+\t\t\t\tinputGate.getInputGate(),\n+\t\t\t\tnew CheckpointBarrierUnaligner(\n+\t\t\t\t\tnew int[] { 1 },\n+\t\t\t\t\tChannelStateWriter.NO_OP,\n+\t\t\t\t\t\"test\",\n+\t\t\t\t\tnew DummyCheckpointInvokable())),\n+\t\t\tinSerializer,\n+\t\t\tnew StatusWatermarkValve(1, output),\n+\t\t\t0,\n+\t\t\tdeserializers);\n+\n+\t\tinputGate.sendEvent(new CheckpointBarrier(0, 0, CheckpointOptions.forCheckpointWithDefaultLocation()), 0);\n+\t\tinputGate.sendElement(new StreamRecord<>(42L), 0);\n+\n+\t\tassertHasNextElement(input, output);\n+\t\tassertHasNextElement(input, output);\n+\t\tassertEquals(1, output.getNumberOfEmittedRecords());\n+\n+\t\t// send EndOfPartitionEvent and ensure that deserializer has been released\n+\t\tinputGate.sendEvent(EndOfPartitionEvent.INSTANCE, 0);\n+\t\tinput.emitNext(output);\n+\t\tassertNull(deserializers[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9046a584b295d9b431dd0b34a86dbdac89603365"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9046a584b295d9b431dd0b34a86dbdac89603365", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/9046a584b295d9b431dd0b34a86dbdac89603365", "committedDate": "2020-05-11T07:17:06Z", "message": "[FLINK-17580][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "0bc3e6e2b8ceb77a3ba502e7d98d3897f83d9010", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/0bc3e6e2b8ceb77a3ba502e7d98d3897f83d9010", "committedDate": "2020-05-11T08:46:37Z", "message": "[FLINK-17580][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDY4MTUw", "url": "https://github.com/apache/flink/pull/12072#pullrequestreview-409068150", "createdAt": "2020-05-11T10:57:12Z", "commit": {"oid": "0bc3e6e2b8ceb77a3ba502e7d98d3897f83d9010"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0bc3e6e2b8ceb77a3ba502e7d98d3897f83d9010", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/0bc3e6e2b8ceb77a3ba502e7d98d3897f83d9010", "committedDate": "2020-05-11T08:46:37Z", "message": "[FLINK-17580][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "207a8efb19186f84bb74d997710ad4517938c6e1", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/207a8efb19186f84bb74d997710ad4517938c6e1", "committedDate": "2020-05-11T11:07:01Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "207a8efb19186f84bb74d997710ad4517938c6e1", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/207a8efb19186f84bb74d997710ad4517938c6e1", "committedDate": "2020-05-11T11:07:01Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "cb2913d57c189cf8c7879237dc0bc14ec1011950", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cb2913d57c189cf8c7879237dc0bc14ec1011950", "committedDate": "2020-05-11T16:17:20Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzUyNzY4", "url": "https://github.com/apache/flink/pull/12072#pullrequestreview-409352768", "createdAt": "2020-05-11T16:53:31Z", "commit": {"oid": "a1a282fb5a3b1b8c63e0b087d0a29068d8f22096"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjo1MzozMVrOGTk28w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzowMjozNFrOGTlN1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4MDAxOQ==", "bodyText": "remove this code and add a //TODO: use readView.notifyPriorityEvent for local channels comment?", "url": "https://github.com/apache/flink/pull/12072#discussion_r423180019", "createdAt": "2020-05-11T16:53:31Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java", "diffHunk": "@@ -127,10 +127,10 @@ public void readRecoveredState(ChannelStateReader stateReader) throws IOExceptio\n \t@Override\n \tpublic boolean add(BufferConsumer bufferConsumer, boolean isPriorityEvent) throws IOException {\n \t\tif (isPriorityEvent) {\n-\t\t\tif (readView != null && readView.notifyPriorityEvent(bufferConsumer)) {\n-\t\t\t\tbufferConsumer.close();\n-\t\t\t\treturn true;\n-\t\t\t}\n+//\t\t\tif (readView != null && readView.notifyPriorityEvent(bufferConsumer)) {\n+//\t\t\t\tbufferConsumer.close();\n+//\t\t\t\treturn true;\n+//\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a282fb5a3b1b8c63e0b087d0a29068d8f22096"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4MTY4MQ==", "bodyText": "&& buffer.isBuffer()?", "url": "https://github.com/apache/flink/pull/12072#discussion_r423181681", "createdAt": "2020-05-11T16:56:04Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/LocalInputChannel.java", "diffHunk": "@@ -196,9 +208,17 @@ public void run() {\n \t\t\t}\n \t\t}\n \n-\t\tnumBytesIn.inc(next.buffer().getSize());\n+\t\tBuffer buffer = next.buffer();\n+\t\tCheckpointBarrier notifyReceivedBarrier = parseCheckpointBarrierOrNull(buffer);\n+\t\tif (notifyReceivedBarrier != null) {\n+\t\t\treceivedCheckpointId = notifyReceivedBarrier.getId();\n+\t\t} else if (receivedCheckpointId < lastRequestedCheckpointId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d42f2dd006e6c7344453c35bcc8d0422e0fb3ff"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4NTg3OA==", "bodyText": "add maybe one more buffer and some events, like EndOfPartitionEvent at the end?", "url": "https://github.com/apache/flink/pull/12072#discussion_r423185878", "createdAt": "2020-05-11T17:02:34Z", "author": {"login": "pnowojski"}, "path": "flink-runtime/src/test/java/org/apache/flink/runtime/io/network/partition/consumer/LocalInputChannelTest.java", "diffHunk": "@@ -448,6 +455,36 @@ public void testUnblockReleasedChannel() throws Exception {\n \t\tlocalChannel.resumeConsumption();\n \t}\n \n+\t@Test\n+\tpublic void testCheckpointingInflightData() throws Exception {\n+\t\tSingleInputGate inputGate = new SingleInputGateBuilder().build();\n+\t\tList<Buffer> receivedBuffers = new ArrayList<>();\n+\t\tinputGate.registerBufferReceivedListener(new BufferReceivedListener() {\n+\t\t\t@Override\n+\t\t\tpublic void notifyBufferReceived(Buffer buffer, InputChannelInfo channelInfo) {\n+\t\t\t\treceivedBuffers.add(buffer);\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic void notifyBarrierReceived(CheckpointBarrier barrier, InputChannelInfo channelInfo) {}\n+\t\t});\n+\n+\t\tResultSubpartitionView subpartitionView = createResultSubpartitionView(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d42f2dd006e6c7344453c35bcc8d0422e0fb3ff"}, "originalPosition": 55}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb2913d57c189cf8c7879237dc0bc14ec1011950", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/cb2913d57c189cf8c7879237dc0bc14ec1011950", "committedDate": "2020-05-11T16:17:20Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "9c989d03884bb761d97b85a225d968c9e4e0afc7", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/9c989d03884bb761d97b85a225d968c9e4e0afc7", "committedDate": "2020-05-11T18:48:25Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c989d03884bb761d97b85a225d968c9e4e0afc7", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/9c989d03884bb761d97b85a225d968c9e4e0afc7", "committedDate": "2020-05-11T18:48:25Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "bab8d2812b99d7b689286dfdb67d48e2fd0dbbbf", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/bab8d2812b99d7b689286dfdb67d48e2fd0dbbbf", "committedDate": "2020-05-11T19:07:06Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bab8d2812b99d7b689286dfdb67d48e2fd0dbbbf", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/bab8d2812b99d7b689286dfdb67d48e2fd0dbbbf", "committedDate": "2020-05-11T19:07:06Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "ce38f1b465f6bc4f57a1e182eed7e777b5ba7b6a", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/ce38f1b465f6bc4f57a1e182eed7e777b5ba7b6a", "committedDate": "2020-05-11T19:17:37Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce38f1b465f6bc4f57a1e182eed7e777b5ba7b6a", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/ce38f1b465f6bc4f57a1e182eed7e777b5ba7b6a", "committedDate": "2020-05-11T19:17:37Z", "message": "[FLINK-17315][tests] Reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "4bf63a72c743ccf420334c0d717d034e7d788dfa", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/4bf63a72c743ccf420334c0d717d034e7d788dfa", "committedDate": "2020-05-12T06:10:42Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bf63a72c743ccf420334c0d717d034e7d788dfa", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/4bf63a72c743ccf420334c0d717d034e7d788dfa", "committedDate": "2020-05-12T06:10:42Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "aea00a5910b7696d262d84cf3e4220e96514f63f", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/aea00a5910b7696d262d84cf3e4220e96514f63f", "committedDate": "2020-05-12T06:17:02Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aea00a5910b7696d262d84cf3e4220e96514f63f", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/aea00a5910b7696d262d84cf3e4220e96514f63f", "committedDate": "2020-05-12T06:17:02Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "8be9463f81810d66a76da070195c0f7bf42d95c9", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/8be9463f81810d66a76da070195c0f7bf42d95c9", "committedDate": "2020-05-12T07:46:53Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODkzNTQ4", "url": "https://github.com/apache/flink/pull/12072#pullrequestreview-409893548", "createdAt": "2020-05-12T10:08:14Z", "commit": {"oid": "8be9463f81810d66a76da070195c0f7bf42d95c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b58b724bc83fd6ba7aea0e48084f1685c4a34f8a", "author": {"user": {"login": "pnowojski", "name": "Piotr Nowojski"}}, "url": "https://github.com/apache/flink/commit/b58b724bc83fd6ba7aea0e48084f1685c4a34f8a", "committedDate": "2020-05-12T10:51:28Z", "message": "[FLINK-17315][checkpointing] Fix NPE in unaligned checkpoint after EndOfPartition events\n\nReleased deserializers cause NPE in StreamTaskNetworkInput#prepareSnapshot."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fcc22e2accb51664aacf29960015ffac55733fb", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/4fcc22e2accb51664aacf29960015ffac55733fb", "committedDate": "2020-05-12T10:51:29Z", "message": "[FLINK-17315][checkpointing] Disable priority event listener\n\nPriority event listener currently does not snapshot any buffers and causes additional synchronization points. We should re-enable/re-evaluate this concept once a proper threading model has been established on input side."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c624f9723d35d684427f342ef94530fafea266f5", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/c624f9723d35d684427f342ef94530fafea266f5", "committedDate": "2020-05-12T10:52:22Z", "message": "[FLINK-17315][checkpointing] LocalInputChannel also checkpoints in-flight data.\n\nWhen a downstream tasks starts snapshotting input before the upstream task finished snapshotting output, it may happen that a buffer is neither snapshotted upstream or downstream. This commit replicates the logic of RemoteInputChannel to also store these buffers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "196222c9db55288ec5db0d6a3e5d5549dc03f749", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/196222c9db55288ec5db0d6a3e5d5549dc03f749", "committedDate": "2020-05-12T10:52:24Z", "message": "[FLINK-17315][checkpointing] Fixed SpillingAdaptiveSpanningRecordDeserializer#getUnconsumedBuffer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6ee02310d860bf05bae59b40c403185da41fe00", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/b6ee02310d860bf05bae59b40c403185da41fe00", "committedDate": "2020-05-12T10:52:24Z", "message": "[FLINK-17315][checkpointing] Only adding buffers to inflight data of PipelinedSubpartition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00813d8e2346dd390237e3215198d977c1e29066", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/00813d8e2346dd390237e3215198d977c1e29066", "committedDate": "2020-05-12T10:52:24Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8be9463f81810d66a76da070195c0f7bf42d95c9", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/8be9463f81810d66a76da070195c0f7bf42d95c9", "committedDate": "2020-05-12T07:46:53Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}, "afterCommit": {"oid": "00813d8e2346dd390237e3215198d977c1e29066", "author": {"user": {"login": "AHeise", "name": "Arvid Heise"}}, "url": "https://github.com/apache/flink/commit/00813d8e2346dd390237e3215198d977c1e29066", "committedDate": "2020-05-12T10:52:24Z", "message": "[FLINK-17315][tests] Fix and reenable UnalignedCheckpointITCase."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4260, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}