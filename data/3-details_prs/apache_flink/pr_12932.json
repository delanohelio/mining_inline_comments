{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNDU1NDY2", "number": 12932, "title": "[FLINK-18638][runtime] FutureUtils support timeout message", "bodyText": "What is the purpose of the change\nFutureUtils#orTimeout maybe throw a TimeoutException without timeout message,\nThis is rather vague and not friendly enough to analyze the problem.\nso i think maybe throw a TimeoutException with a timeout message is better.\nBrief change log\nadd timeout message for FutureUtils#orTimeout\nVerifying this change\nno\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)", "createdAt": "2020-07-19T09:25:29Z", "url": "https://github.com/apache/flink/pull/12932", "merged": true, "mergeCommit": {"oid": "d0ba79e27f7e390d1530def3517c1b4e22a60c1c"}, "closed": true, "closedAt": "2020-07-24T08:15:26Z", "author": {"login": "Tartarus0zm"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2oFQOAH2gAyNDUyNDU1NDY2OmY1M2MyMTE2ODRjMDhhNTQzYjA2YzU2YWM1YjQwZjVkMDIyNDdhODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Fj4XAH2gAyNDUyNDU1NDY2OjVlNmUxMzYwMjZjYmNkMmFiOGEwZWJhZmExZDg4YmMxYTgxZTAwNDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80", "author": {"user": {"login": "Tartarus0zm", "name": "zhangmang"}}, "url": "https://github.com/apache/flink/commit/f53c211684c08a543b06c56ac5b40f5d02247a80", "committedDate": "2020-07-20T02:19:56Z", "message": "[FLINK-18638][runtime] FutureUtils support timeout message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdf442e9d294808a06c85f9e705e81d42dc5eef3", "author": {"user": {"login": "Tartarus0zm", "name": "zhangmang"}}, "url": "https://github.com/apache/flink/commit/cdf442e9d294808a06c85f9e705e81d42dc5eef3", "committedDate": "2020-07-19T09:22:42Z", "message": "[FLINK-18638][runtime] FutureUtils support timeout message"}, "afterCommit": {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80", "author": {"user": {"login": "Tartarus0zm", "name": "zhangmang"}}, "url": "https://github.com/apache/flink/commit/f53c211684c08a543b06c56ac5b40f5d02247a80", "committedDate": "2020-07-20T02:19:56Z", "message": "[FLINK-18638][runtime] FutureUtils support timeout message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDAyMTQx", "url": "https://github.com/apache/flink/pull/12932#pullrequestreview-452402141", "createdAt": "2020-07-21T12:26:49Z", "commit": {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMjoyNjo1MFrOG01izg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMjoyODo1N1rOG01njQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA1NjM5OA==", "bodyText": "missing @Nullable", "url": "https://github.com/apache/flink/pull/12932#discussion_r458056398", "createdAt": "2020-07-21T12:26:50Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java", "diffHunk": "@@ -439,10 +453,30 @@ public RetryException(Throwable cause) {\n \t\tlong timeout,\n \t\tTimeUnit timeUnit,\n \t\tExecutor timeoutFailExecutor) {\n+\t\treturn orTimeout(future, timeout, timeUnit, timeoutFailExecutor, null);\n+\t}\n+\n+\t/**\n+\t * Times the given future out after the timeout.\n+\t *\n+\t * @param future to time out\n+\t * @param timeout after which the given future is timed out\n+\t * @param timeUnit time unit of the timeout\n+\t * @param timeoutFailExecutor executor that will complete the future exceptionally after the timeout is reached\n+\t * @param timeoutMsg timeout message for exception\n+\t * @param <T> type of the given future\n+\t * @return The timeout enriched future\n+\t */\n+\tpublic static <T> CompletableFuture<T> orTimeout(\n+\t\tCompletableFuture<T> future,\n+\t\tlong timeout,\n+\t\tTimeUnit timeUnit,\n+\t\tExecutor timeoutFailExecutor,\n+\t\tString timeoutMsg) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA1NzYxMw==", "bodyText": "this distinction isn't necessary; new TimeoutException(timeoutMsg) will work in any case.", "url": "https://github.com/apache/flink/pull/12932#discussion_r458057613", "createdAt": "2020-07-21T12:28:57Z", "author": {"login": "zentol"}, "path": "flink-runtime/src/main/java/org/apache/flink/runtime/concurrent/FutureUtils.java", "diffHunk": "@@ -1026,14 +1060,16 @@ public void onComplete(Throwable failure, U success) {\n \tprivate static final class Timeout implements Runnable {\n \n \t\tprivate final CompletableFuture<?> future;\n+\t\tprivate final String timeoutMsg;\n \n-\t\tprivate Timeout(CompletableFuture<?> future) {\n+\t\tprivate Timeout(CompletableFuture<?> future, @Nullable String timeoutMsg) {\n \t\t\tthis.future = checkNotNull(future);\n+\t\t\tthis.timeoutMsg = timeoutMsg;\n \t\t}\n \n \t\t@Override\n \t\tpublic void run() {\n-\t\t\tfuture.completeExceptionally(new TimeoutException());\n+\t\t\tfuture.completeExceptionally(null == timeoutMsg ? new TimeoutException() : new TimeoutException(timeoutMsg));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f53c211684c08a543b06c56ac5b40f5d02247a80"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "author": {"user": {"login": "Tartarus0zm", "name": "zhangmang"}}, "url": "https://github.com/apache/flink/commit/5e6e136026cbcd2ab8a0ebafa1d88bc1a81e0043", "committedDate": "2020-07-21T12:40:38Z", "message": "[FLINK-18638][runtime] FutureUtils support timeout message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2899, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}