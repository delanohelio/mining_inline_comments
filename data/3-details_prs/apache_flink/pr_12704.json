{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzMwODM3", "number": 12704, "title": "[FLINK-18360][runtime/web-frontend/HS] fix no jobs/overview.json file created for HS when no archived jobs present", "bodyText": "fix no jobs/overview.json file created for HS when no archived jobs are in the archive directory\nWhat is the purpose of the change\nThis pull requests fixes creation of the ${historyserver.web.tmpdir}/jobs/overview.json file creation for history server. This file was not created if the directory defined using the directive ${historyserver.archive.fs.dir} contained no completed/archived jobs. When the file was not created, History Server showed nothing in the Completed Jobs tab.\nBrief change log\nHistrory server show correctly Completed Jobs table when there are no archived jobs\nVerifying this change\nThis change added tests and can be verified as follows:\n\nAdded integration test for no job in the ${historyserver.archive.fs.dir}*\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no", "createdAt": "2020-06-18T09:00:09Z", "url": "https://github.com/apache/flink/pull/12704", "merged": true, "mergeCommit": {"oid": "efcc5434dd744ad547999e970c00142a9b20e914"}, "closed": true, "closedAt": "2020-06-23T09:10:01Z", "author": {"login": "jvimr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsazziAFqTQzMzA5MTI0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuBvvdgH2gAyNDM2MzMwODM3Ojg0ZjZjOTMxMTUwOGM3ZmJkYTFkNDc1NzRkODE3NzgxNWM2ZWQzZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMDkxMjQy", "url": "https://github.com/apache/flink/pull/12704#pullrequestreview-433091242", "createdAt": "2020-06-18T09:12:22Z", "commit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxMjoyMlrOGlmsXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxMjoyMlrOGlmsXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4NDQ0NA==", "bodyText": "We could also call this once in the constructor; it is supposed to be part of the startup anyway.", "url": "https://github.com/apache/flink/pull/12704#discussion_r442084444", "createdAt": "2020-06-18T09:12:22Z", "author": {"login": "zentol"}, "path": "flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServerArchiveFetcher.java", "diffHunk": "@@ -285,9 +285,7 @@ public void run() {\n \t\t\t\tif (!jobsToRemove.isEmpty() && processArchiveDeletion) {\n \t\t\t\t\tevents.addAll(cleanupExpiredJobs(jobsToRemove));\n \t\t\t\t}\n-\t\t\t\tif (!events.isEmpty()) {\n-\t\t\t\t\tupdateJobOverview(webOverviewDir, webDir);\n-\t\t\t\t}\n+\t\t\t\tupdateJobOverview(webOverviewDir, webDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdbcab3597f7c0f4d48da4fb568d04afd66cfa72"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4dc4da2fdc9e9540e82331c536bcef996cad7f1a", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/4dc4da2fdc9e9540e82331c536bcef996cad7f1a", "committedDate": "2020-06-19T16:42:59Z", "message": "call updateJobOverview from JobArchiveFetcherTask constructor"}, "afterCommit": {"oid": "3d36644835e7f42fc37370baa243c33582b29aaf", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/3d36644835e7f42fc37370baa243c33582b29aaf", "committedDate": "2020-06-19T16:43:33Z", "message": "call updateJobOverview from JobArchiveFetcherTask constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae225b23bc5a171e078ddd56dcb5d15218e191c3", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/ae225b23bc5a171e078ddd56dcb5d15218e191c3", "committedDate": "2020-06-22T09:04:49Z", "message": "fix no jobs/overview.json file created for HS when no archived jobs are in the archive directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0a636f89ec48e7e3bd3071396d0221a27db1c31", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/b0a636f89ec48e7e3bd3071396d0221a27db1c31", "committedDate": "2020-06-22T09:04:50Z", "message": "test to verify that HS shows correctly zero completed jobs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc8319084a8ce034ff4853851a231b6278beb08", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/7dc8319084a8ce034ff4853851a231b6278beb08", "committedDate": "2020-06-22T09:04:50Z", "message": "revert accidently removed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ea9050d58559d936e4b8464932889922d833e0", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/a1ea9050d58559d936e4b8464932889922d833e0", "committedDate": "2020-06-22T09:04:50Z", "message": "call updateJobOverview from JobArchiveFetcherTask constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d36644835e7f42fc37370baa243c33582b29aaf", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/3d36644835e7f42fc37370baa243c33582b29aaf", "committedDate": "2020-06-19T16:43:33Z", "message": "call updateJobOverview from JobArchiveFetcherTask constructor"}, "afterCommit": {"oid": "a1ea9050d58559d936e4b8464932889922d833e0", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/a1ea9050d58559d936e4b8464932889922d833e0", "committedDate": "2020-06-22T09:04:50Z", "message": "call updateJobOverview from JobArchiveFetcherTask constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f6c9311508c7fbda1d47574d8177815c6ed3e8", "author": {"user": {"login": "zentol", "name": "Chesnay Schepler"}}, "url": "https://github.com/apache/flink/commit/84f6c9311508c7fbda1d47574d8177815c6ed3e8", "committedDate": "2020-06-23T09:08:39Z", "message": "cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3691, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}