{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NzUwODg4", "number": 11876, "title": "[FLINK-17334] HIVE UDF BUGFIX", "bodyText": "For more information, please check\nhttps://issues.apache.org/jira/browse/FLINK-17334#", "createdAt": "2020-04-23T08:07:29Z", "url": "https://github.com/apache/flink/pull/11876", "merged": true, "mergeCommit": {"oid": "e8503986132f0ffaeec91caf5da6ece2d0eb70d3"}, "closed": true, "closedAt": "2020-04-29T02:51:45Z", "author": {"login": "z8r-coder"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaXSChAH2gAyNDA3NzUwODg4OjViNmY1NjA0NDk5MGJiMTgwZThkZjQ1NTE0ZTc5Mzg2OGQ4NGI0M2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccO9V1AFqTQwMjMyOTYwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5b6f56044990bb180e8df45514e793868d84b43f", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/5b6f56044990bb180e8df45514e793868d84b43f", "committedDate": "2020-04-23T06:55:38Z", "message": "[FLINK-17334] HIVE UDF BUGFIX"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec30671bf09b056ef47b4b89001bd8118ab23513", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/ec30671bf09b056ef47b4b89001bd8118ab23513", "committedDate": "2020-04-23T09:54:14Z", "message": "TEST CASES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc081058c881b0165b44c37e53607ac891814f5", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/5dc081058c881b0165b44c37e53607ac891814f5", "committedDate": "2020-04-24T06:49:14Z", "message": "SimpleUDF support array and map, add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a7b13805feb162cf26a374609d6e03af6a58990", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/2a7b13805feb162cf26a374609d6e03af6a58990", "committedDate": "2020-04-27T03:33:25Z", "message": "delete unuse file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/e1386aff448073520feb8effc3eac67a4f4577cb", "committedDate": "2020-04-27T07:21:15Z", "message": "code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODY3NDg4", "url": "https://github.com/apache/flink/pull/11876#pullrequestreview-400867488", "createdAt": "2020-04-27T11:36:46Z", "commit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozNjo0NlrOGMemqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTo0Njo0N1rOGMe9tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNzUxMw==", "bodyText": "Why do we still need these changes? Actually I think this method is no longer needed", "url": "https://github.com/apache/flink/pull/11876#discussion_r415737513", "createdAt": "2020-04-27T11:36:46Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/functions/hive/conversion/HiveInspectors.java", "diffHunk": "@@ -354,25 +354,25 @@ public static ObjectInspector getObjectInspector(HiveShim hiveShim, Class clazz)\n \t\tif (clazz.equals(String.class) || clazz.equals(Text.class)) {\n \n \t\t\ttypeInfo = TypeInfoFactory.stringTypeInfo;\n-\t\t} else if (clazz.equals(Boolean.class) || clazz.equals(BooleanWritable.class)) {\n+\t\t} else if (clazz.equals(boolean.class) || clazz.equals(Boolean.class) || clazz.equals(BooleanWritable.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc0MjM5NA==", "bodyText": "Why we allow a 1.0 delta here? And I think 3.0f should be the expected value and udf.eval(3.0f) should be the actual value.", "url": "https://github.com/apache/flink/pull/11876#discussion_r415742394", "createdAt": "2020-04-27T11:45:08Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/functions/hive/HiveSimpleUDFTest.java", "diffHunk": "@@ -49,6 +50,30 @@\n public class HiveSimpleUDFTest {\n \tprivate static HiveShim hiveShim = HiveShimLoader.loadHiveShim(HiveShimLoader.getHiveVersion());\n \n+\t@Test\n+\tpublic void testBooleanUDF() {\n+\t\tHiveSimpleUDF udf = init(BooleanUDF.class, new DataType[]{ DataTypes.INT()});\n+\t\tassertTrue((boolean) udf.eval(1));\n+\t}\n+\n+\t@Test\n+\tpublic void testFloatUDF() {\n+\t\tHiveSimpleUDF udf = init(FloatUDF.class, new DataType[]{ DataTypes.FLOAT()});\n+\t\tassertEquals((float) udf.eval(3.0f), 3.0f, 1.0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc0MjkxNA==", "bodyText": "just return content == 1", "url": "https://github.com/apache/flink/pull/11876#discussion_r415742914", "createdAt": "2020-04-27T11:46:02Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/functions/hive/HiveSimpleUDFTest.java", "diffHunk": "@@ -230,4 +255,64 @@ protected static HiveSimpleUDF init(Class hiveUdfClass, DataType[] argTypes) {\n \n \t\treturn udf;\n \t}\n+\n+\t/**\n+\t * Boolean Test UDF.\n+\t */\n+\tpublic static class BooleanUDF extends UDF {\n+\t\t/**\n+\t\t *\n+\t\t * @param content input\n+\t\t * @return\n+\t\t */\n+\t\tpublic boolean evaluate(int content) {\n+\t\t\tif (content == 1) {\n+\t\t\t\treturn true;\n+\t\t\t} else {\n+\t\t\t\treturn false;\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc0MzQxMw==", "bodyText": "Please remove these java docs since they're meaningless.", "url": "https://github.com/apache/flink/pull/11876#discussion_r415743413", "createdAt": "2020-04-27T11:46:47Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/functions/hive/HiveSimpleUDFTest.java", "diffHunk": "@@ -230,4 +255,64 @@ protected static HiveSimpleUDF init(Class hiveUdfClass, DataType[] argTypes) {\n \n \t\treturn udf;\n \t}\n+\n+\t/**\n+\t * Boolean Test UDF.\n+\t */\n+\tpublic static class BooleanUDF extends UDF {\n+\t\t/**\n+\t\t *\n+\t\t * @param content input\n+\t\t * @return\n+\t\t */\n+\t\tpublic boolean evaluate(int content) {\n+\t\t\tif (content == 1) {\n+\t\t\t\treturn true;\n+\t\t\t} else {\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Float Test UDF.\n+\t */\n+\tpublic static class FloatUDF extends UDF {\n+\t\t/**\n+\t\t *\n+\t\t * @param content input\n+\t\t * @return\n+\t\t */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1386aff448073520feb8effc3eac67a4f4577cb"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46bde5253c0ce7b4c33ef7ab1868b843207a5dcb", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/46bde5253c0ce7b4c33ef7ab1868b843207a5dcb", "committedDate": "2020-04-28T04:27:47Z", "message": "delete unuse code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNzQ5MTMy", "url": "https://github.com/apache/flink/pull/11876#pullrequestreview-401749132", "createdAt": "2020-04-28T11:37:32Z", "commit": {"oid": "46bde5253c0ce7b4c33ef7ab1868b843207a5dcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMTozNzozMlrOGNPwlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMTozNzozMlrOGNPwlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU0Mjg3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tassertEquals((float) udf.eval(3.0f), 3.0f, 0);\n          \n          \n            \n            \t\tassertEquals(3.0f, (float) udf.eval(3.0f), 0);\n          \n      \n    \n    \n  \n\nThe 1st argument is the expected value. Same goes for other tests.", "url": "https://github.com/apache/flink/pull/11876#discussion_r416542870", "createdAt": "2020-04-28T11:37:32Z", "author": {"login": "lirui-apache"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/table/functions/hive/HiveSimpleUDFTest.java", "diffHunk": "@@ -49,6 +50,30 @@\n public class HiveSimpleUDFTest {\n \tprivate static HiveShim hiveShim = HiveShimLoader.loadHiveShim(HiveShimLoader.getHiveVersion());\n \n+\t@Test\n+\tpublic void testBooleanUDF() {\n+\t\tHiveSimpleUDF udf = init(BooleanUDF.class, new DataType[]{ DataTypes.INT()});\n+\t\tassertTrue((boolean) udf.eval(1));\n+\t}\n+\n+\t@Test\n+\tpublic void testFloatUDF() {\n+\t\tHiveSimpleUDF udf = init(FloatUDF.class, new DataType[]{ DataTypes.FLOAT()});\n+\t\tassertEquals((float) udf.eval(3.0f), 3.0f, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46bde5253c0ce7b4c33ef7ab1868b843207a5dcb"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "373c591fb2c6773f2ff641bc4c32e72d5ae980af", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/373c591fb2c6773f2ff641bc4c32e72d5ae980af", "committedDate": "2020-04-28T12:45:00Z", "message": "code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzI1MTI5", "url": "https://github.com/apache/flink/pull/11876#pullrequestreview-402325129", "createdAt": "2020-04-29T02:02:19Z", "commit": {"oid": "373c591fb2c6773f2ff641bc4c32e72d5ae980af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzI5NjAx", "url": "https://github.com/apache/flink/pull/11876#pullrequestreview-402329601", "createdAt": "2020-04-29T02:21:38Z", "commit": {"oid": "373c591fb2c6773f2ff641bc4c32e72d5ae980af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4810, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}