{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MjgxNTY5", "number": 14377, "title": "[FLINK-19905][Connector][jdbc] The Jdbc-connector's 'lookup.max-retries' option initial value is 1 in JdbcLookupFunction", "bodyText": "\u2026es' option initial value is 1 in JdbcLookupFunction\n\nWhat is the purpose of the change\nThe Jdbc-connector's 'lookup.max-retries' option implementation is different from the meaning.\nBrief change log\nVerifying this change\nThis change is a trivial rework / code cleanup without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API, i.e., is any changed class annotated with @Public(Evolving): (no)\nThe serializers: (no)\nThe runtime per-record code paths (performance sensitive): (no)\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: (no)\nThe S3 file system connector: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)", "createdAt": "2020-12-14T09:03:50Z", "url": "https://github.com/apache/flink/pull/14377", "merged": true, "mergeCommit": {"oid": "cc9ccc42e8c8f7221c6d35f4c011d573577d0505"}, "closed": true, "closedAt": "2020-12-19T14:48:32Z", "author": {"login": "xiaoHoly"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmB1UXAH2gAyNTM5MjgxNTY5OmI2ZTQ1NDJjNzdlMjZjMWI4ZmM5NzMyMWE3OGNhYTBiMWY2OGIzZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnt1v3gFqTU1NTk0NTk2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6e4542c77e26c1b8fc97321a78caa0b1f68b3d7", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/b6e4542c77e26c1b8fc97321a78caa0b1f68b3d7", "committedDate": "2020-12-14T08:54:30Z", "message": "[FLINK-19905][Connector][jdbc] The Jdbc-connector's 'lookup.max-retries' option initial value is 1 in JdbcLookupFunction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MzEwMTk1", "url": "https://github.com/apache/flink/pull/14377#pullrequestreview-554310195", "createdAt": "2020-12-17T06:26:38Z", "commit": {"oid": "b6e4542c77e26c1b8fc97321a78caa0b1f68b3d7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/c0e212ed51c103765ada525c54ba3d83614f929a", "committedDate": "2020-12-17T12:40:09Z", "message": "[FLINK-19691][Connector][jdbc] Expose `CONNECTION_CHECK_TIMEOUT_SECONDS` as a configurable option in Jdbc connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NjcxODc1", "url": "https://github.com/apache/flink/pull/14377#pullrequestreview-554671875", "createdAt": "2020-12-17T14:46:19Z", "commit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNDo0NjoyMFrOIH5Aow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNDo1Mjo0MlrOIH5Uog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE0NDk5NQ==", "bodyText": "Space is needed before 0.", "url": "https://github.com/apache/flink/pull/14377#discussion_r545144995", "createdAt": "2020-12-17T14:46:20Z", "author": {"login": "wangxlong"}, "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/table/descriptors/JdbcValidator.java", "diffHunk": "@@ -115,7 +115,7 @@ private void validateReadProperties(DescriptorProperties properties) {\n \tprivate void validateLookupProperties(DescriptorProperties properties) {\n \t\tproperties.validateLong(CONNECTOR_LOOKUP_CACHE_MAX_ROWS, true);\n \t\tproperties.validateDuration(CONNECTOR_LOOKUP_CACHE_TTL, true, 1);\n-\t\tproperties.validateInt(CONNECTOR_LOOKUP_MAX_RETRIES, true);\n+\t\tproperties.validateInt(CONNECTOR_LOOKUP_MAX_RETRIES, true,0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE0OTM2Ng==", "bodyText": "// lookup max-retries property less than zero", "url": "https://github.com/apache/flink/pull/14377#discussion_r545149366", "createdAt": "2020-12-17T14:51:45Z", "author": {"login": "wangxlong"}, "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/table/JdbcTableSourceSinkFactoryTest.java", "diffHunk": "@@ -255,6 +255,17 @@ public void testJdbcValidation() {\n \t\t\tfail(\"exception expected\");\n \t\t} catch (IllegalArgumentException ignored) {\n \t\t}\n+\n+\t\t// lookup max-retries properties not complete", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE1MDExNA==", "bodyText": "Would be better as following,\n\nJdbcLookupOptions.Builder lookupOptionsBuilder = JdbcLookupOptions.builder().setMaxRetryTimes(0);\nif (useCache) {\nlookupOptionsBuilder.setCacheMaxSize(1000).setCacheExpireMs(1000 * 1000);\n}\nbuilder.setLookupOptions(lookupOptionsBuilder.build());", "url": "https://github.com/apache/flink/pull/14377#discussion_r545150114", "createdAt": "2020-12-17T14:52:42Z", "author": {"login": "wangxlong"}, "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/table/JdbcLookupTableITCase.java", "diffHunk": "@@ -120,7 +120,7 @@ public void testLookup() throws Exception {\n \t\t\t\t.build());\n \t\tif (useCache) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffcb3c699eb099caccb20aa38f372557e8a59306", "author": {"user": null}, "url": "https://github.com/apache/flink/commit/ffcb3c699eb099caccb20aa38f372557e8a59306", "committedDate": "2020-12-18T05:32:15Z", "message": "[FLINK-19905][Connector][jdbc] The Jdbc-connector's 'lookup.max-retries' option initial value is 1 in JdbcLookupFunction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MzE5NDgx", "url": "https://github.com/apache/flink/pull/14377#pullrequestreview-555319481", "createdAt": "2020-12-18T09:15:19Z", "commit": {"oid": "ffcb3c699eb099caccb20aa38f372557e8a59306"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOToxNToyMFrOIIagtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOToxOTo0N1rOIIaw-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY5Mzg3OQ==", "bodyText": "Please fix the comment", "url": "https://github.com/apache/flink/pull/14377#discussion_r545693879", "createdAt": "2020-12-18T09:15:20Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/table/JdbcTableSourceSinkFactoryTest.java", "diffHunk": "@@ -255,6 +255,17 @@ public void testJdbcValidation() {\n \t\t\tfail(\"exception expected\");\n \t\t} catch (IllegalArgumentException ignored) {\n \t\t}\n+\n+\t\t// lookup max-retries properties not complete", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE0OTM2Ng=="}, "originalCommit": {"oid": "c0e212ed51c103765ada525c54ba3d83614f929a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY5Njc2Ng==", "bodyText": "Zero is a valid value, so there should no exception be thrown here. I think what we want to test is -1 here.", "url": "https://github.com/apache/flink/pull/14377#discussion_r545696766", "createdAt": "2020-12-18T09:18:36Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/table/JdbcTableSourceSinkFactoryTest.java", "diffHunk": "@@ -255,6 +255,17 @@ public void testJdbcValidation() {\n \t\t\tfail(\"exception expected\");\n \t\t} catch (IllegalArgumentException ignored) {\n \t\t}\n+\n+\t\t// lookup max-retries properties not complete\n+\t\ttry {\n+\t\t\tMap<String, String> properties = getBasicProperties();\n+\t\t\tproperties.put(\"connector.lookup.max-retries\", \"0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcb3c699eb099caccb20aa38f372557e8a59306"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY5ODA0Mw==", "bodyText": "This ignores the exception from fail(\"exception expected\"), we should catch the specific exception ValidationException here.", "url": "https://github.com/apache/flink/pull/14377#discussion_r545698043", "createdAt": "2020-12-18T09:19:47Z", "author": {"login": "wuchong"}, "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/table/JdbcTableSourceSinkFactoryTest.java", "diffHunk": "@@ -255,6 +255,17 @@ public void testJdbcValidation() {\n \t\t\tfail(\"exception expected\");\n \t\t} catch (IllegalArgumentException ignored) {\n \t\t}\n+\n+\t\t// lookup max-retries properties not complete\n+\t\ttry {\n+\t\t\tMap<String, String> properties = getBasicProperties();\n+\t\t\tproperties.put(\"connector.lookup.max-retries\", \"0\");\n+\n+\t\t\tTableFactoryService.find(StreamTableSourceFactory.class, properties)\n+\t\t\t\t.createStreamTableSource(properties);\n+\t\t\tfail(\"exception expected\");\n+\t\t} catch (Throwable ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcb3c699eb099caccb20aa38f372557e8a59306"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba3f9a13b98b5ddaee1dcf142ee3cf00322fe5c0", "author": {"user": {"login": "xiaoHoly", "name": null}}, "url": "https://github.com/apache/flink/commit/ba3f9a13b98b5ddaee1dcf142ee3cf00322fe5c0", "committedDate": "2020-12-18T16:38:16Z", "message": "[FLINK-19905][Connector][jdbc] The Jdbc-connector's 'lookup.max-retries' option initial value is 1 in JdbcLookupFunction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTQ1OTY3", "url": "https://github.com/apache/flink/pull/14377#pullrequestreview-555945967", "createdAt": "2020-12-19T14:44:43Z", "commit": {"oid": "ba3f9a13b98b5ddaee1dcf142ee3cf00322fe5c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3580, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}