{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDI3MTM1", "number": 13078, "title": "[FLINK-18659][hive][orc] Fix streaming write for Hive 1.x Orc table", "bodyText": "What is the purpose of the change\nFix streaming write to Hive 1.x Orc tables.\nBrief change log\n\nCheck whether file exists before calling FileSystem::getFileStatus to get the size of in-progress files.\nFix serialization issue for OrcNoHiveBulkWriterFactory\nAdd NoHivePhysicalWriterImpl to fix NoSuchMethodError due to protobuf relocation in orc-core-nohive\nAdd tests for streaming write to orc table.\n\nVerifying this change\nExisting and added tests\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): yes\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: no\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? NA", "createdAt": "2020-08-06T13:27:21Z", "url": "https://github.com/apache/flink/pull/13078", "merged": true, "mergeCommit": {"oid": "6a7b464c708c64f359b731ae5cee97ebb6c62d07"}, "closed": true, "closedAt": "2020-08-14T01:52:16Z", "author": {"login": "lirui-apache"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8kNZMgBqjM2MzMxOTI5ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-qqojAFqTQ2NzI1OTc5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4209634e8c7709f322e2fd46b5875da9afb3502f", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/4209634e8c7709f322e2fd46b5875da9afb3502f", "committedDate": "2020-08-06T13:22:45Z", "message": "[FLINK-18659][hive][orc] Fix streaming write for Hive 1.x Orc table"}, "afterCommit": {"oid": "80725d93cee49427ba2502a0c8f763fc4215d4e7", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/80725d93cee49427ba2502a0c8f763fc4215d4e7", "committedDate": "2020-08-07T13:12:32Z", "message": "disable tests for 2.x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80725d93cee49427ba2502a0c8f763fc4215d4e7", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/80725d93cee49427ba2502a0c8f763fc4215d4e7", "committedDate": "2020-08-07T13:12:32Z", "message": "disable tests for 2.x"}, "afterCommit": {"oid": "7b73a977a7a5272e352b5f7af0aaefd619405290", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/7b73a977a7a5272e352b5f7af0aaefd619405290", "committedDate": "2020-08-12T11:29:10Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NDMyMzc1", "url": "https://github.com/apache/flink/pull/13078#pullrequestreview-466432375", "createdAt": "2020-08-13T04:15:40Z", "commit": {"oid": "7b73a977a7a5272e352b5f7af0aaefd619405290"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDoxNTo0MFrOG_7ZEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDoxNTo0MFrOG_7ZEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY4NjU0NA==", "bodyText": "Why dependency conflict? Can we make it correct?", "url": "https://github.com/apache/flink/pull/13078#discussion_r469686544", "createdAt": "2020-08-13T04:15:40Z", "author": {"login": "JingsongLi"}, "path": "flink-connectors/flink-connector-hive/src/test/java/org/apache/flink/connectors/hive/HiveTableSinkITCase.java", "diffHunk": "@@ -252,32 +252,45 @@ public void testBatchAppend() {\n \n \t@Test(timeout = 120000)\n \tpublic void testDefaultSerPartStreamingWrite() throws Exception {\n-\t\ttestStreamingWrite(true, false, true, this::checkSuccessFiles);\n+\t\ttestStreamingWrite(true, false, \"textfile\", this::checkSuccessFiles);\n \t}\n \n \t@Test(timeout = 120000)\n \tpublic void testPartStreamingWrite() throws Exception {\n-\t\ttestStreamingWrite(true, false, false, this::checkSuccessFiles);\n+\t\ttestStreamingWrite(true, false, \"parquet\", this::checkSuccessFiles);\n+\t\t// disable orc test for hive 2.x due to dependency conflict\n+\t\tif (!hiveCatalog.getHiveVersion().startsWith(\"2.\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b73a977a7a5272e352b5f7af0aaefd619405290"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6a01b8e1d30909732448f37a606b70fa9a3903e", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/a6a01b8e1d30909732448f37a606b70fa9a3903e", "committedDate": "2020-08-13T05:26:20Z", "message": "[FLINK-18659][hive][orc] Fix streaming write for Hive 1.x Orc table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0be581beac841f9e2526d92f234534f577421c2a", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/0be581beac841f9e2526d92f234534f577421c2a", "committedDate": "2020-08-13T05:26:20Z", "message": "disable tests for 2.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5044c0e4e5643c48d2e82b35c08597d4eb71840a", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/5044c0e4e5643c48d2e82b35c08597d4eb71840a", "committedDate": "2020-08-13T05:26:20Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abaa5793d9d611d241e91a6546b29be18fd6a1c6", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/abaa5793d9d611d241e91a6546b29be18fd6a1c6", "committedDate": "2020-08-13T06:39:39Z", "message": "test mr orc writer for 2.x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b73a977a7a5272e352b5f7af0aaefd619405290", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/7b73a977a7a5272e352b5f7af0aaefd619405290", "committedDate": "2020-08-12T11:29:10Z", "message": "address comments"}, "afterCommit": {"oid": "abaa5793d9d611d241e91a6546b29be18fd6a1c6", "author": {"user": {"login": "lirui-apache", "name": "Rui Li"}}, "url": "https://github.com/apache/flink/commit/abaa5793d9d611d241e91a6546b29be18fd6a1c6", "committedDate": "2020-08-13T06:39:39Z", "message": "test mr orc writer for 2.x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjU5Nzky", "url": "https://github.com/apache/flink/pull/13078#pullrequestreview-467259792", "createdAt": "2020-08-14T01:51:58Z", "commit": {"oid": "abaa5793d9d611d241e91a6546b29be18fd6a1c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4991, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}