{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMjU5NzA4", "number": 11019, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyMTowOVrODdQsag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyMzoyM1rODdQvLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMDA4ODEwOnYy", "diffSide": "RIGHT", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyMTowOVrOFlwrqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxMDoxNzoxMlrOFlyd3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzOTI0MA==", "bodyText": "nit: pass through constructor? Getting metric group from a variable named toNotifyOnCheckpoint looks a bit strange?", "url": "https://github.com/apache/flink/pull/11019#discussion_r375139240", "createdAt": "2020-02-05T09:21:09Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE1MjM1Ng==", "bodyText": "I agree with the point, and the current way is for avoiding the more changes of existing tests. Let me try that.", "url": "https://github.com/apache/flink/pull/11019#discussion_r375152356", "createdAt": "2020-02-05T09:47:03Z", "author": {"login": "zhijiangW"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzOTI0MA=="}, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE2ODQ3OQ==", "bodyText": "Fixed", "url": "https://github.com/apache/flink/pull/11019#discussion_r375168479", "createdAt": "2020-02-05T10:17:12Z", "author": {"login": "zhijiangW"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEzOTI0MA=="}, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMDA5NTE3OnYy", "diffSide": "RIGHT", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwOToyMzoyM1rOFlwwCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxMDoyMDowMlrOFlyjng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MDM2Mw==", "bodyText": "deduplicate this code with OneInputStreamTask?\nIn master version I think this is also missing\n\t\t\ttaskIOMetricGroup.gauge(\"checkpointStartDelayNanos\", inputGate::getCheckpointStartDelayNanos);", "url": "https://github.com/apache/flink/pull/11019#discussion_r375140363", "createdAt": "2020-02-05T09:23:23Z", "author": {"login": "pnowojski"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();\n+\t\ttaskIOMetricGroup.gauge(\"checkpointAlignmentTime\", barrierHandler::getAlignmentDurationNanos);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE1NDMxNQ==", "bodyText": "deduplicate this code with OneInputStreamTask\n\nI considered that and actually we can remove the method of getAlignmentDurationNanos from CheckpointedInputGate to unify the way all in the constructor of CheckpointBarrierHandler. The current way of touching minimum change is also for catching up with the release ASAP. I would try that if not very hurry.", "url": "https://github.com/apache/flink/pull/11019#discussion_r375154315", "createdAt": "2020-02-05T09:50:41Z", "author": {"login": "zhijiangW"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();\n+\t\ttaskIOMetricGroup.gauge(\"checkpointAlignmentTime\", barrierHandler::getAlignmentDurationNanos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MDM2Mw=="}, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE1NDYzMQ==", "bodyText": "Let me check the issue of checkpointStartDelayNanos", "url": "https://github.com/apache/flink/pull/11019#discussion_r375154631", "createdAt": "2020-02-05T09:51:15Z", "author": {"login": "zhijiangW"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();\n+\t\ttaskIOMetricGroup.gauge(\"checkpointAlignmentTime\", barrierHandler::getAlignmentDurationNanos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MDM2Mw=="}, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE2OTk1MA==", "bodyText": "After checking the code path, the unification in OneInputStreamTask is not strong related to this fix. So I prefer to submitting a hotfix or separate ticket for handling the case of OneInputStreamTask in master branch.", "url": "https://github.com/apache/flink/pull/11019#discussion_r375169950", "createdAt": "2020-02-05T10:20:02Z", "author": {"login": "zhijiangW"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/InputProcessorUtil.java", "diffHunk": "@@ -90,6 +91,10 @@ public static CheckpointedInputGate createCheckpointedInputGate(\n \t\t\tinputGate1.getNumberOfInputChannels() + inputGate2.getNumberOfInputChannels(),\n \t\t\ttaskName,\n \t\t\ttoNotifyOnCheckpoint);\n+\n+\t\tTaskIOMetricGroup taskIOMetricGroup = toNotifyOnCheckpoint.getEnvironment().getMetricGroup().getIOMetricGroup();\n+\t\ttaskIOMetricGroup.gauge(\"checkpointAlignmentTime\", barrierHandler::getAlignmentDurationNanos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE0MDM2Mw=="}, "originalCommit": {"oid": "012203b66328bc46e9af4d37c585521915f450ca"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1022, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}