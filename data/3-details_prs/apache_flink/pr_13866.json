{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNDY2NTcz", "number": 13866, "title": "[FLINK-19907][network] Recover channel state before initializing operators chain", "bodyText": "What is the purpose of the change\nRecover channel state bofer initializing operators chain.\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream.\nVerifying this change\nThis is a trivial change.\nOverWindowITCase in #13822 fails (non-deterministically) without this change.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): no\nThe public API, i.e., is any changed class annotated with @Public(Evolving): no\nThe serializers: no\nThe runtime per-record code paths (performance sensitive): no\nAnything that affects deployment or recovery: JobManager (and its components), Checkpointing, Kubernetes/Yarn/Mesos, ZooKeeper: yes\nThe S3 file system connector: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? no", "createdAt": "2020-10-31T17:08:38Z", "url": "https://github.com/apache/flink/pull/13866", "merged": true, "mergeCommit": {"oid": "3ab31a0473c01c27feb3b64c3f379ebe481a71ce"}, "closed": true, "closedAt": "2020-11-02T09:27:41Z", "author": {"login": "rkhachatryan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYglfoAFqTUyMTQyODYzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYhIf3AFqTUyMTQ1Nzg5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDI4NjMz", "url": "https://github.com/apache/flink/pull/13866#pullrequestreview-521428633", "createdAt": "2020-11-02T08:48:18Z", "commit": {"oid": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo0ODoxOVrOHr6-lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo0ODozOFrOHr6_SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzExMA==", "bodyText": "Good catch. I was wondering if there is any downside to putting data into buffers before initializing state. Could it be that buffers are processed before state is initialized?", "url": "https://github.com/apache/flink/pull/13866#discussion_r515817110", "createdAt": "2020-11-02T08:48:19Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java", "diffHunk": "@@ -502,9 +502,9 @@ protected void beforeInvoke() throws Exception {\n \t\t\t// both the following operations are protected by the lock\n \t\t\t// so that we avoid race conditions in the case that initializeState()\n \t\t\t// registers a timer, that fires before the open() is called.\n-\t\t\toperatorChain.initializeStateAndOpenOperators(createStreamTaskStateInitializer());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzI4OQ==", "bodyText": "Could you please fix commit msg and PR title (\"before\")?", "url": "https://github.com/apache/flink/pull/13866#discussion_r515817289", "createdAt": "2020-11-02T08:48:38Z", "author": {"login": "AHeise"}, "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java", "diffHunk": "@@ -502,9 +502,9 @@ protected void beforeInvoke() throws Exception {\n \t\t\t// both the following operations are protected by the lock", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0abd26d7b4279b3855f976f7c0152f62ecb1757c", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/0abd26d7b4279b3855f976f7c0152f62ecb1757c", "committedDate": "2020-11-02T09:09:47Z", "message": "[FLINK-19907][network] Recover channel state before initializing operators chain\n\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7", "committedDate": "2020-10-31T17:04:52Z", "message": "[FLINK-19907][network] Recover channel state bofer initializing operators chain\n\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream."}, "afterCommit": {"oid": "0abd26d7b4279b3855f976f7c0152f62ecb1757c", "author": {"user": {"login": "rkhachatryan", "name": "Roman"}}, "url": "https://github.com/apache/flink/commit/0abd26d7b4279b3855f976f7c0152f62ecb1757c", "committedDate": "2020-11-02T09:09:47Z", "message": "[FLINK-19907][network] Recover channel state before initializing operators chain\n\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDU3ODkw", "url": "https://github.com/apache/flink/pull/13866#pullrequestreview-521457890", "createdAt": "2020-11-02T09:27:34Z", "commit": {"oid": "0abd26d7b4279b3855f976f7c0152f62ecb1757c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2838, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}