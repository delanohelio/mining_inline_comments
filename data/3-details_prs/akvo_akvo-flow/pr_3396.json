{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MTY5NzEw", "number": 3396, "title": "[#3168] - save datapoints in api", "bodyText": "Before the PR (what is the issue or what needed to be done)\nDatapoints were only stored in memory and not saved in the data store.\nThe solution\nStore datapoints with the API and fetch back datapoint assignments when editing assignments\nScreenshots (if appropriate)\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-01-17T14:34:16Z", "url": "https://github.com/akvo/akvo-flow/pull/3396", "merged": true, "mergeCommit": {"oid": "308ac4fd479ed2408ab0b88b4202de74de1b220a"}, "closed": true, "closedAt": "2020-02-03T11:48:02Z", "author": {"login": "marvinkome"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbyO9V-gH2gAyMzY0MTY5NzEwOjk4Yjg2YWFmOTczODA2MjdkN2VhOWQxZDczNjM1MjY5ZTE0MWRjOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAreeMgFqTM1MjE5NTkzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "98b86aaf97380627d7ea9d1d73635269e141dc95", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/98b86aaf97380627d7ea9d1d73635269e141dc95", "committedDate": "2019-12-20T14:36:49Z", "message": "[#3168] - integrate model for storing data points assignments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ff082cde1f2df642880a51361a97c955f186971", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/0ff082cde1f2df642880a51361a97c955f186971", "committedDate": "2019-12-20T14:45:42Z", "message": "[#3168] - rename datapoints to datapointsResults, and other formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23c38367e6274de8e69863288e4458c8442d6c98", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/23c38367e6274de8e69863288e4458c8442d6c98", "committedDate": "2019-12-20T15:53:21Z", "message": "[#3168] - populate datapoints assignments\n\nP.S Happy holidays"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a985ff99144b1f34d5a392d550de6ddd9e673b", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/39a985ff99144b1f34d5a392d550de6ddd9e673b", "committedDate": "2020-01-15T14:55:07Z", "message": "Merge branch 'develop' into issue-3168/save-datapoints-in-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a517d52d2ea773af135b4d45a269e1b4fadff148", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/a517d52d2ea773af135b4d45a269e1b4fadff148", "committedDate": "2020-01-16T11:24:51Z", "message": "Merge branch 'develop' into issue-3168/save-datapoints-in-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ac05557ae0e6e7d288936d2ec4c27e33015c507", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/7ac05557ae0e6e7d288936d2ec4c27e33015c507", "committedDate": "2020-01-17T13:28:28Z", "message": "[#3168] - load datapoints when setting up assignments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dccb8e504b36063acddea48751174f173a283490", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/dccb8e504b36063acddea48751174f173a283490", "committedDate": "2020-01-17T14:28:46Z", "message": "[#3168] - search for datapoints without using controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/41a92bb58fe48eae936a6060426a6cfa15f61cd2", "committedDate": "2020-01-28T16:59:36Z", "message": "Merge branch 'develop' into issue-3168/save-datapoints-in-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTc3Nzk5", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-349977799", "createdAt": "2020-01-29T09:50:02Z", "commit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTo1MDowMlrOFjCUUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTo1ODoxOFrOFjClXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI4MjQ1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const filteredDevices = devices.filter(device => !selectedDeviceIds.includes(device.id));\n          \n          \n            \n                const unSelectedDevices = devices.filter(device => !selectedDeviceIds.includes(device.id));", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372282450", "createdAt": "2020-01-29T09:50:02Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AddDevices.jsx", "diffHunk": "@@ -16,9 +16,7 @@ export default class AddDevice extends React.Component {\n     // filter out selected devices\n     const { devices, selectedDeviceIds } = this.context.data;\n \n-    const filteredDevices = devices.filter(\n-      device => !selectedDeviceIds.includes(device.id)\n-    );\n+    const filteredDevices = devices.filter(device => !selectedDeviceIds.includes(device.id));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI4NDUwMA==", "bodyText": "or something more descriptive of why the filtering is happening", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372284500", "createdAt": "2020-01-29T09:53:53Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AddDevices.jsx", "diffHunk": "@@ -16,9 +16,7 @@ export default class AddDevice extends React.Component {\n     // filter out selected devices\n     const { devices, selectedDeviceIds } = this.context.data;\n \n-    const filteredDevices = devices.filter(\n-      device => !selectedDeviceIds.includes(device.id)\n-    );\n+    const filteredDevices = devices.filter(device => !selectedDeviceIds.includes(device.id));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI4MjQ1MA=="}, "originalCommit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI4NTc5NA==", "bodyText": "Did you merge the code from the previous PR? I thought this one had changed...\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const filteredDevices = devices.filter(device => selectedDeviceIds.includes(device.id));\n          \n          \n            \n                const selectedDevices = devices.filter(device => selectedDeviceIds.includes(device.id));", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372285794", "createdAt": "2020-01-29T09:56:23Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDevices.jsx", "diffHunk": "@@ -16,9 +16,7 @@ export default class EditDevices extends React.Component {\n     // filter out selected devices\n     const { devices, selectedDeviceIds } = this.context.data;\n \n-    const filteredDevices = devices.filter(device =>\n-      selectedDeviceIds.includes(device.id)\n-    );\n+    const filteredDevices = devices.filter(device => selectedDeviceIds.includes(device.id));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI4NjgxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  newSelectedDevices = selectedDevices.filter(device => !ids.includes(device));\n          \n          \n            \n                  newSelectedDeviceIds = selectedDevicesIds.filter(deviceId => !ids.includes(deviceId));", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372286814", "createdAt": "2020-01-29T09:58:18Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDevices.jsx", "diffHunk": "@@ -43,9 +41,7 @@ export default class EditDevices extends React.Component {\n     if (checked) {\n       newSelectedDevices = selectedDevices.concat(ids);\n     } else {\n-      newSelectedDevices = selectedDevices.filter(\n-        device => !ids.includes(device)\n-      );\n+      newSelectedDevices = selectedDevices.filter(device => !ids.includes(device));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a92bb58fe48eae936a6060426a6cfa15f61cd2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4ff0201ff9f74cd746dfa1253fd77ca081fa354", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/d4ff0201ff9f74cd746dfa1253fd77ca081fa354", "committedDate": "2020-01-29T11:54:28Z", "message": "[#3168] - update variable names to be more contextual"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNzUyMTYx", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-350752161", "createdAt": "2020-01-30T11:24:36Z", "commit": {"oid": "d4ff0201ff9f74cd746dfa1253fd77ca081fa354"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxMToyNDozNlrOFjnr4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxMTozOTo0N1rOFjoE-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5NDY4OQ==", "bodyText": "I suspect this may be a bit problematic in terms of slowing down the loading of assignments but also loading possibly unnecessary dataPointAssignments that the user is not going to look at. What's your motivation for wanting to load the datapoint assignments already?", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372894689", "createdAt": "2020-01-30T11:24:36Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/router/router.js", "diffHunk": "@@ -231,9 +227,15 @@ FLOW.Router = Ember.Router.extend({\n       editSurveysAssignment: Ember.Route.extend({\n         route: '/assign-surveys',\n         connectOutlets(router) {\n-          router\n-            .get('navDevicesController')\n-            .connectOutlet('editSurveyAssignment');\n+          router.get('navDevicesController').connectOutlet('editSurveyAssignment');\n+\n+          // if editing fetch datapoints assignments,\n+          // else well, no need for datapoints assignments in a new assignments\n+          const assignmentId = FLOW.selectedControl.selectedSurveyAssignment.get('keyId');\n+          if (assignmentId) {\n+            FLOW.dataPointAssignmentControl.populate(assignmentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4ff0201ff9f74cd746dfa1253fd77ca081fa354"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkwMDM1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if (!Ember.none(value)) {\n          \n          \n            \n              if (value) {\n          \n      \n    \n    \n  \n\nLets try to get rid of Ember where we can.", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372900359", "createdAt": "2020-01-30T11:37:45Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/utils/index.js", "diffHunk": "@@ -21,3 +21,10 @@ export function ArrNoDupe(a) {\n   }\n   return tempa;\n }\n+\n+export function formatDate(value) {\n+  if (!Ember.none(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4ff0201ff9f74cd746dfa1253fd77ca081fa354"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkwMTExMg==", "bodyText": "this function is already defined on L44 right?", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r372901112", "createdAt": "2020-01-30T11:39:47Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -43,8 +37,15 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n       this.addDevicesCheckedOption = this.addDevicesCheckedOption.bind(this);\n       this.addDevicesToAssignment = this.addDevicesToAssignment.bind(this);\n       this.removeDevicesFromAssignment = this.removeDevicesFromAssignment.bind(this);\n-      this.findDatapoints = this.findDatapoints.bind(this);\n+\n+      // datapoints methods\n+      this.saveDatapoints = this.saveDatapoints.bind(this);\n+      this.setupDatapoints = this.setupDatapoints.bind(this);\n+      this.getDeviceDatapoints = this.getDeviceDatapoints.bind(this);\n       this.detectDatapointsLoaded = this.detectDatapointsLoaded.bind(this);\n+      this.findDatapoints = this.findDatapoints.bind(this);\n+      this.detectSearchedDatapointLoaded = this.detectSearchedDatapointLoaded.bind(this);\n+      this.getDeviceDatapoints = this.getDeviceDatapoints.bind(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4ff0201ff9f74cd746dfa1253fd77ca081fa354"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e9a3545900ec7d4cf8282b409901f3cb6a9c6a", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/01e9a3545900ec7d4cf8282b409901f3cb6a9c6a", "committedDate": "2020-01-30T14:21:50Z", "message": "[#3168] - remove duplicate code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0172800e6063c4e38f25140ba0ae1a050d3f5c", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/5b0172800e6063c4e38f25140ba0ae1a050d3f5c", "committedDate": "2020-01-31T11:33:42Z", "message": "[#3168] - fetch datapoint details only when device is viewed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNTYwNjkw", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-351560690", "createdAt": "2020-01-31T14:58:03Z", "commit": {"oid": "5b0172800e6063c4e38f25140ba0ae1a050d3f5c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNDo1ODowM1rOFkN9Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNDo1OToyMlrOFkOAlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMTc2Nw==", "bodyText": "Dont you think this may end up tripping up people in the long run?  it works but its not clear which of the two is a number or string.  Can this be converted to all numbers without too much trouble?", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r373521767", "createdAt": "2020-01-31T14:58:03Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -19,8 +19,8 @@ export default class AssignDatapoints extends React.Component {\n     const { selectedDeviceId } = this.props;\n     const { devices, datapointAssignments } = this.context.data;\n \n-    const deviceData = devices.find(device => device.id === selectedDeviceId);\n-    const datapointAssignment = datapointAssignments.find(dp => dp.deviceId === selectedDeviceId);\n+    const deviceData = devices.find(device => device.id == selectedDeviceId);\n+    const datapointAssignment = datapointAssignments.find(dp => dp.deviceId == selectedDeviceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0172800e6063c4e38f25140ba0ae1a050d3f5c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMjMwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  newSelectedDevicesIds = selectedDevicesIds.filter(device => device !== id);\n          \n          \n            \n                  newSelectedDevicesIds = selectedDevicesIds.filter(deviceId => deviceId !== id);", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r373522304", "createdAt": "2020-01-31T14:58:53Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDevices.jsx", "diffHunk": "@@ -9,64 +9,60 @@ import DeviceEmpty from '../__partials/DeviceEmpty';\n \n export default class EditDevices extends React.Component {\n   state = {\n-    selectedDevices: [],\n+    selectedDevicesIds: [],\n   };\n \n   getDeviceGroups() {\n-    // filter out selected devices\n+    // filter selected devices\n     const { devices, selectedDeviceIds } = this.context.data;\n \n-    const filteredDevices = devices.filter(device =>\n-      selectedDeviceIds.includes(device.id)\n-    );\n+    const selectedDevices = devices.filter(device => selectedDeviceIds.includes(device.id));\n \n-    return _groupBy(filteredDevices, device => device.deviceGroup.id);\n+    return _groupBy(selectedDevices, device => device.deviceGroup.id);\n   }\n \n   onSelectDevice = (id, checked) => {\n-    const { selectedDevices } = this.state;\n-    let newSelectedDevices = [];\n+    const { selectedDevicesIds } = this.state;\n+    let newSelectedDevicesIds = [];\n \n     if (checked) {\n-      newSelectedDevices = selectedDevices.concat(id);\n+      newSelectedDevicesIds = selectedDevicesIds.concat(id);\n     } else {\n-      newSelectedDevices = selectedDevices.filter(device => device !== id);\n+      newSelectedDevicesIds = selectedDevicesIds.filter(device => device !== id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0172800e6063c4e38f25140ba0ae1a050d3f5c"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMjU4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  newSelectedDevicesIds = selectedDevicesIds.filter(device => !ids.includes(device));\n          \n          \n            \n                  newSelectedDevicesIds = selectedDevicesIds.filter(deviceId => !ids.includes(deviceId));", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r373522581", "createdAt": "2020-01-31T14:59:22Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDevices.jsx", "diffHunk": "@@ -9,64 +9,60 @@ import DeviceEmpty from '../__partials/DeviceEmpty';\n \n export default class EditDevices extends React.Component {\n   state = {\n-    selectedDevices: [],\n+    selectedDevicesIds: [],\n   };\n \n   getDeviceGroups() {\n-    // filter out selected devices\n+    // filter selected devices\n     const { devices, selectedDeviceIds } = this.context.data;\n \n-    const filteredDevices = devices.filter(device =>\n-      selectedDeviceIds.includes(device.id)\n-    );\n+    const selectedDevices = devices.filter(device => selectedDeviceIds.includes(device.id));\n \n-    return _groupBy(filteredDevices, device => device.deviceGroup.id);\n+    return _groupBy(selectedDevices, device => device.deviceGroup.id);\n   }\n \n   onSelectDevice = (id, checked) => {\n-    const { selectedDevices } = this.state;\n-    let newSelectedDevices = [];\n+    const { selectedDevicesIds } = this.state;\n+    let newSelectedDevicesIds = [];\n \n     if (checked) {\n-      newSelectedDevices = selectedDevices.concat(id);\n+      newSelectedDevicesIds = selectedDevicesIds.concat(id);\n     } else {\n-      newSelectedDevices = selectedDevices.filter(device => device !== id);\n+      newSelectedDevicesIds = selectedDevicesIds.filter(device => device !== id);\n     }\n \n-    this.setState({ selectedDevices: newSelectedDevices });\n+    this.setState({ selectedDevicesIds: newSelectedDevicesIds });\n   };\n \n   onSelectMultipleDevices = (ids, checked) => {\n-    const { selectedDevices } = this.state;\n-    let newSelectedDevices = [...selectedDevices];\n+    const { selectedDevicesIds } = this.state;\n+    let newSelectedDevicesIds = [...selectedDevicesIds];\n \n     if (checked) {\n-      newSelectedDevices = selectedDevices.concat(ids);\n+      newSelectedDevicesIds = selectedDevicesIds.concat(ids);\n     } else {\n-      newSelectedDevices = selectedDevices.filter(\n-        device => !ids.includes(device)\n-      );\n+      newSelectedDevicesIds = selectedDevicesIds.filter(device => !ids.includes(device));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b0172800e6063c4e38f25140ba0ae1a050d3f5c"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2b7b605fe296d221d1ce6f7d01f7657a645ec6", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/6b2b7b605fe296d221d1ce6f7d01f7657a645ec6", "committedDate": "2020-01-31T15:37:09Z", "message": "[#3168] - update variables names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjY4NTI2", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-351668526", "createdAt": "2020-01-31T17:44:46Z", "commit": {"oid": "6b2b7b605fe296d221d1ce6f7d01f7657a645ec6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8fad92952347f12b6384239a33285c748b7f500", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/e8fad92952347f12b6384239a33285c748b7f500", "committedDate": "2020-02-01T08:26:57Z", "message": "[#3168] - fix bug with js coercion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b89f97b56e1a312220f456bea88764316df1b341", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/b89f97b56e1a312220f456bea88764316df1b341", "committedDate": "2020-02-03T09:49:39Z", "message": "[#3168] -  fix JS coercion errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTgwNTYw", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-352180560", "createdAt": "2020-02-03T11:15:29Z", "commit": {"oid": "b89f97b56e1a312220f456bea88764316df1b341"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMToxNToyOVrOFkt_DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMToxODowOFrOFkuDRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NjQ3Nw==", "bodyText": "Instead of doing this I think its much clearer to set the property to a number. i.e.\nAssignDatapoints.propTypes = {\n  selectedDeviceId: PropTypes.number.isRequired,\n};", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r374046477", "createdAt": "2020-02-03T11:15:29Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -20,7 +20,9 @@ export default class AssignDatapoints extends React.Component {\n     const { devices, datapointAssignments } = this.context.data;\n \n     const deviceData = devices.find(device => device.id === selectedDeviceId);\n-    const datapointAssignment = datapointAssignments.find(dp => dp.deviceId === selectedDeviceId);\n+    const datapointAssignment = datapointAssignments.find(\n+      dp => dp.deviceId === parseInt(selectedDeviceId, 10)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b89f97b56e1a312220f456bea88764316df1b341"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NzU1Nw==", "bodyText": "Same here regarding setting the PropType", "url": "https://github.com/akvo/akvo-flow/pull/3396#discussion_r374047557", "createdAt": "2020-02-03T11:18:08Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -706,7 +706,10 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n       this.renderReactSide();\n     },\n \n-    assignDataPointsToDevice(datapoints, deviceId) {\n+    assignDataPointsToDevice(datapoints, deviceIdInString) {\n+      // convert devieId to number\n+      const deviceId = parseInt(deviceIdInString, 10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b89f97b56e1a312220f456bea88764316df1b341"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMTk1OTM4", "url": "https://github.com/akvo/akvo-flow/pull/3396#pullrequestreview-352195938", "createdAt": "2020-02-03T11:45:17Z", "commit": {"oid": "b89f97b56e1a312220f456bea88764316df1b341"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4583, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}