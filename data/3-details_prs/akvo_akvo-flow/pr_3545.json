{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NDczODE4", "number": 3545, "title": "Issue 3509/track assignment usage", "bodyText": "Before the PR (what is the issue or what needed to be done)\nwhat needed to be done?\nAdd trackers to assignment file to track creating/updating assignments, and datapoints usage\nScreenshots (if appropriate)\n[No Ui related changes]\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-04-27T12:38:06Z", "url": "https://github.com/akvo/akvo-flow/pull/3545", "merged": true, "mergeCommit": {"oid": "17b2d1bea2ebae258de3e8dc35f0cf86eccb9da1"}, "closed": true, "closedAt": "2020-04-27T13:28:24Z", "author": {"login": "marvinkome"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaMhQfAH2gAyNDA5NDczODE4OjUzMmRmZWJlYjYwMDViZDAzZWY1NTYzZTNhMmMwMTA4YTMxYTMzNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbvS-VAFqTQwMDk1MDc0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "532dfebeb6005bd03ef5563e3a2c0108a31a3373", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/532dfebeb6005bd03ef5563e3a2c0108a31a3373", "committedDate": "2020-04-22T18:23:18Z", "message": "[#3509] - add tracking method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7", "committedDate": "2020-04-27T12:31:24Z", "message": "[#3509] - adding tracker on assignment page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTEyMDE2", "url": "https://github.com/akvo/akvo-flow/pull/3545#pullrequestreview-400912016", "createdAt": "2020-04-27T12:41:46Z", "commit": {"oid": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjo0MTo0NlrOGMhFnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjo0MjoyN1rOGMhHXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODIwNw==", "bodyText": "Let's always use https, so const u = 'https://akvo.piwikpro.com'.\nProtocol relative URL are an anti-pattern now - https://www.paulirish.com/2010/the-protocol-relative-url/", "url": "https://github.com/akvo/akvo-flow/pull/3545#discussion_r415778207", "createdAt": "2020-04-27T12:41:46Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/analytics.js", "diffHunk": "@@ -1,20 +1,41 @@\n-const _paq = window._paq || [];\n-_paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n-_paq.push(['setCookieDomain', '*.akvoflow.org']);\n-_paq.push(['setDomains', ['*.akvoflow.org']]);\n-_paq.push(['trackPageView']);\n-_paq.push(['enableLinkTracking']);\n+export function init() {\n+  window._paq = window._paq || [];\n \n-(function () {\n-  const u = `${(document.location.protocol == 'https:') ? 'https' : 'http'}://analytics.akvo.org/`;\n-  _paq.push(['setTrackerUrl', `${u}piwik.php`]);\n-  _paq.push(['setSiteId', '10']);\n-  const d = document;\n-  const g = d.createElement('script');\n-  const s = d.getElementsByTagName('script')[0];\n-  g.type = 'text/javascript';\n-  g.defer = true;\n-  g.async = true;\n-  g.src = `${u}piwik.js`;\n-  s.parentNode.insertBefore(g, s);\n-}());\n+  window._paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n+  window._paq.push(['setCookieDomain', '*.akvoflow.org']);\n+  window._paq.push(['setDomains', ['*.akvoflow.org']]);\n+  window._paq.push(['enableLinkTracking']);\n+\n+  (function() {\n+    const u =\n+      document.location.protocol === 'https:'\n+        ? 'https://akvo.piwikpro.com/'\n+        : 'http://analytics.akvo.org/';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODY1Mw==", "bodyText": "Let's use {} in our if statements.", "url": "https://github.com/akvo/akvo-flow/pull/3545#discussion_r415778653", "createdAt": "2020-04-27T12:42:27Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/analytics.js", "diffHunk": "@@ -1,20 +1,41 @@\n-const _paq = window._paq || [];\n-_paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n-_paq.push(['setCookieDomain', '*.akvoflow.org']);\n-_paq.push(['setDomains', ['*.akvoflow.org']]);\n-_paq.push(['trackPageView']);\n-_paq.push(['enableLinkTracking']);\n+export function init() {\n+  window._paq = window._paq || [];\n \n-(function () {\n-  const u = `${(document.location.protocol == 'https:') ? 'https' : 'http'}://analytics.akvo.org/`;\n-  _paq.push(['setTrackerUrl', `${u}piwik.php`]);\n-  _paq.push(['setSiteId', '10']);\n-  const d = document;\n-  const g = d.createElement('script');\n-  const s = d.getElementsByTagName('script')[0];\n-  g.type = 'text/javascript';\n-  g.defer = true;\n-  g.async = true;\n-  g.src = `${u}piwik.js`;\n-  s.parentNode.insertBefore(g, s);\n-}());\n+  window._paq.push(['setDocumentTitle', `${document.domain}/${document.title}`]);\n+  window._paq.push(['setCookieDomain', '*.akvoflow.org']);\n+  window._paq.push(['setDomains', ['*.akvoflow.org']]);\n+  window._paq.push(['enableLinkTracking']);\n+\n+  (function() {\n+    const u =\n+      document.location.protocol === 'https:'\n+        ? 'https://akvo.piwikpro.com/'\n+        : 'http://analytics.akvo.org/';\n+\n+    window._paq.push(['setTrackerUrl', `${u}ppms.php`]);\n+    window._paq.push(['setSiteId', '2eb02fff-08a4-4973-ae92-fb4ae6157da4']);\n+\n+    const d = document;\n+    const g = d.createElement('script');\n+    const s = d.getElementsByTagName('script')[0];\n+    g.type = 'text/javascript';\n+    g.async = true;\n+    g.defer = true;\n+    g.src = `${u}ppms.js`;\n+    s.parentNode.insertBefore(g, s);\n+  })();\n+}\n+\n+export const trackEvent = (eventType, ...values) => {\n+  if (typeof window._paq !== 'undefined') window._paq.push(['trackEvent', eventType, ...values]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6178f5b40aadec448da85e74e8f9ce9cdf5f0b7"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8771c93ad4a4ac3b2d8a1936f65ab49d57ca997c", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/8771c93ad4a4ac3b2d8a1936f65ab49d57ca997c", "committedDate": "2020-04-27T12:46:31Z", "message": "[#3509] - minor code changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4facf3aa4a7fffc46ddc38c3f40ae47f383eeec", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/e4facf3aa4a7fffc46ddc38c3f40ae47f383eeec", "committedDate": "2020-04-27T13:20:08Z", "message": "[#3509] - use shorter action names for tracking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTUwNzQ2", "url": "https://github.com/akvo/akvo-flow/pull/3545#pullrequestreview-400950746", "createdAt": "2020-04-27T13:28:18Z", "commit": {"oid": "e4facf3aa4a7fffc46ddc38c3f40ae47f383eeec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4488, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}