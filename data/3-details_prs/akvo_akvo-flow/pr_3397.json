{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MTYwODEx", "number": 3397, "title": "[#3168] - edit datapoints", "bodyText": "The solution\nAdd page/view to be able to edit data points in a device.\nScreenshots (if appropriate)\n\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-01-21T08:47:59Z", "url": "https://github.com/akvo/akvo-flow/pull/3397", "merged": true, "mergeCommit": {"oid": "137a29b7420b5c665cccfaecdba1053fba10b440"}, "closed": true, "closedAt": "2020-02-04T12:46:19Z", "author": {"login": "marvinkome"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8NwtIgH2gAyMzY1MTYwODExOjM4ZWI5NWY5NjkzZjI4NDgwOTEwMDQxN2U4MTE2ZTgyYjE3NmZkNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBA67HAFqTM1Mjk0NjAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38eb95f9693f284809100417e8116e82b176fd70", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/38eb95f9693f284809100417e8116e82b176fd70", "committedDate": "2020-01-20T14:52:21Z", "message": "[#3168] - create Ui for editing datapoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54da12f872e7972046d3ec543fcda4ab0e844173", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/54da12f872e7972046d3ec543fcda4ab0e844173", "committedDate": "2020-01-20T15:34:47Z", "message": "[#3168] - add method to remove datapoints from device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d385754b581d74ebb5fe5e15063d6e31843aa7b3", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/d385754b581d74ebb5fe5e15063d6e31843aa7b3", "committedDate": "2020-01-21T08:38:20Z", "message": "[#3168] - add edit functionality to saving method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56c3610b4667110fedcee365db010dcabe42288f", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/56c3610b4667110fedcee365db010dcabe42288f", "committedDate": "2020-01-27T15:05:15Z", "message": "[#3168] - add edit datapoints translation. Fix styling issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e408fe26a81c71b66dc09ddd09543f022838eb6", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/2e408fe26a81c71b66dc09ddd09543f022838eb6", "committedDate": "2020-02-03T11:56:05Z", "message": "Merge branch 'develop' into issue-3168/edit-datapoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/40e7b36b95eeaa261fa23f6e4f15012e46fda5e1", "committedDate": "2020-02-03T12:57:45Z", "message": "[#3168] - fix coercion issue with editing datapoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODQ0OTUy", "url": "https://github.com/akvo/akvo-flow/pull/3397#pullrequestreview-352844952", "createdAt": "2020-02-04T09:52:48Z", "commit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo1Mjo0OFrOFlN_AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNzowOVrOFlPEsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3MDc1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const selectedDatapoint = datapointAssignments.find(\n          \n          \n            \n                const selectedDatapointAssignment = datapointAssignments.find(", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374570753", "createdAt": "2020-02-04T09:52:48Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDatapoints.jsx", "diffHunk": "@@ -0,0 +1,117 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import PropTypes from 'prop-types';\n+import Checkbox from 'akvo-flow/components/reusable/Checkbox';\n+import AssignmentsContext from '../assignment-context';\n+\n+export default class EditDatapoints extends React.Component {\n+  state = {\n+    selectedDatapoints: [],\n+  };\n+\n+  onSelectDatapoint = (id, checked) => {\n+    const { selectedDatapoints } = this.state;\n+    let newSelectedDatapoints = [];\n+\n+    if (checked) {\n+      newSelectedDatapoints = selectedDatapoints.concat(id);\n+    } else {\n+      newSelectedDatapoints = selectedDatapoints.filter(device => device !== id);\n+    }\n+\n+    this.setState({ selectedDatapoints: newSelectedDatapoints });\n+  };\n+\n+  getDeviceData = () => {\n+    const { selectedDeviceId } = this.props;\n+    const { devices, datapointAssignments } = this.context.data;\n+\n+    const deviceData = devices.find(device => device.id === selectedDeviceId);\n+    const selectedDatapoint = datapointAssignments.find(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NTYxOA==", "bodyText": "It feels a little strange that the Edit button is active even when there are no datapoints assigned. This should probably only be activated when there are actually datapoints that have been assigned to a device.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374575618", "createdAt": "2020-02-04T10:02:05Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -56,12 +57,18 @@ export default class AssignDatapoints extends React.Component {\n             <div className=\"device-details\">\n               <p>{deviceData.name}</p>\n               <p>\n-                {datapointsData.length} {strings.datapointAssigned}\n+                <span>\n+                  {datapointsData.length} {strings.datapointAssigned}\n+                </span>\n+                <span className=\"divider\">.</span>\n+                <a href=\"#\" onClick={() => this.props.changeTab('EDIT_DATAPOINTS', deviceData.id)}>\n+                  Edit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjE0Mw==", "bodyText": "Also should be a translated string.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374576143", "createdAt": "2020-02-04T10:03:06Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -56,12 +57,18 @@ export default class AssignDatapoints extends React.Component {\n             <div className=\"device-details\">\n               <p>{deviceData.name}</p>\n               <p>\n-                {datapointsData.length} {strings.datapointAssigned}\n+                <span>\n+                  {datapointsData.length} {strings.datapointAssigned}\n+                </span>\n+                <span className=\"divider\">.</span>\n+                <a href=\"#\" onClick={() => this.props.changeTab('EDIT_DATAPOINTS', deviceData.id)}>\n+                  Edit", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NTYxOA=="}, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4NzI0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                removeDatapointsFromAssignments(datapoints, deviceIdInString) {\n          \n          \n            \n                removeDatapointsFromAssignments(datapointIds, deviceIdInString) {", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374587243", "createdAt": "2020-02-04T10:24:24Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -731,5 +724,31 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n \n       this.renderReactSide();\n     },\n+\n+    removeDatapointsFromAssignments(datapoints, deviceIdInString) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4ODU5Mw==", "bodyText": "This section feels a bit confusing the way its constructed. The focus is on the single datapoint assignment that we have to update to reflect that its list of datapointIds has changed.  I dont think its necessary to go filtering through all the other datapoint assignments since all we do is just return as long as they dont match the one we want.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374588593", "createdAt": "2020-02-04T10:27:09Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -731,5 +724,31 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n \n       this.renderReactSide();\n     },\n+\n+    removeDatapointsFromAssignments(datapoints, deviceIdInString) {\n+      // convert devieId to number\n+      const deviceId = parseInt(deviceIdInString, 10);\n+\n+      // get the selected datapoint assignment\n+      this.datapointAssignments = this.datapointAssignments.map(dpAssignment => {\n+        // get the datapoints in the selected assignment\n+        if (dpAssignment.deviceId !== deviceId) {\n+          return dpAssignment;\n+        }\n+\n+        // remove the selected datapoints from the list\n+        const dps = dpAssignment.datapoints.filter(dp => {\n+          // filter out datapoints that's in the array\n+          return !datapoints.includes(dp.id);\n+        });\n+\n+        return {\n+          ...dpAssignment,\n+          datapoints: dps,\n+        };\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 151}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e194505612d5ffa480209c5873d4d976cec23f06", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/e194505612d5ffa480209c5873d4d976cec23f06", "committedDate": "2020-02-04T12:16:53Z", "message": "[#3168] - fix review issues (variable name and styling)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTQ2MDAy", "url": "https://github.com/akvo/akvo-flow/pull/3397#pullrequestreview-352946002", "createdAt": "2020-02-04T12:44:22Z", "commit": {"oid": "e194505612d5ffa480209c5873d4d976cec23f06"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4586, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}