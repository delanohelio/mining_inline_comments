{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0ODcxNzk1", "number": 3658, "title": "[#3652] using offset to return assigned datapoints", "bodyText": "Before the PR (what is the issue or what needed to be done)\nThe solution\nusing offset to return assigned datapoints in batches of 30 as query by key does not allow to query with a cursor\nScreenshots (if appropriate)\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-10-16T13:57:55Z", "url": "https://github.com/akvo/akvo-flow/pull/3658", "merged": true, "mergeCommit": {"oid": "f7ab4efa7d01a0a774516afd3f332cfc1d9d5f02"}, "closed": true, "closedAt": "2020-10-19T15:20:08Z", "author": {"login": "valllllll2000"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTGzE8gH2gAyNTA0ODcxNzk1OmVjYjg2MjQ3ZGUxYTFiZTZiNTZlNTMzYzU0ZWE2ZGMzYzEyMzI5MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUFrRxgFqTUxMTg3MjQ4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ecb86247de1a1be6b56e533c54ea6dc3c1232909", "author": {"user": {"login": "valllllll2000", "name": "Valeria Rogatchevskikh"}}, "url": "https://github.com/akvo/akvo-flow/commit/ecb86247de1a1be6b56e533c54ea6dc3c1232909", "committedDate": "2020-10-16T13:57:01Z", "message": "[#3652] using offset to return assigned datapoints\n\nin batches of 30 as query by key does not allow to query with a cursor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085", "author": {"user": {"login": "valllllll2000", "name": "Valeria Rogatchevskikh"}}, "url": "https://github.com/akvo/akvo-flow/commit/eb0dc757a91ab0636be8fe9a141822d7b5aa4085", "committedDate": "2020-10-19T10:59:18Z", "message": "[#3652] using cursor as offset when assigned datapoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjgzNjI0", "url": "https://github.com/akvo/akvo-flow/pull/3658#pullrequestreview-511683624", "createdAt": "2020-10-19T11:58:51Z", "commit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTo1ODo1MVrOHkK1xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTo1ODo1MVrOHkK1xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA==", "bodyText": "If we follow the current behaviour of the app, it will send requests to the backend until the returned results == 0.\nSo take the case of 34 assigned datapoints.\n\nFirst query = 30 datapoints and cursor=30\nsecond query = 4 datapoints and cursor=(4 or 34?)\nthird query = 0 datapoints and cursor=(?)", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507688388", "createdAt": "2020-10-19T11:58:51Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "diffHunk": "@@ -87,7 +79,11 @@ protected RestResponse handleRequest(RestRequest req) throws Exception {\n         }\n \n         res = convertToResponse(dpList, dpReq.getSurveyId());\n-        res.setCursor(BaseDAO.getCursor(dpList));\n+        String cursor = BaseDAO.getCursor(dpList);\n+        if (cursor == null && dpList.size() > 0) {\n+            cursor = dpList.size() + \"\";\n+        }\n+        res.setCursor(cursor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExODcyNDg1", "url": "https://github.com/akvo/akvo-flow/pull/3658#pullrequestreview-511872485", "createdAt": "2020-10-19T15:12:31Z", "commit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4550, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}