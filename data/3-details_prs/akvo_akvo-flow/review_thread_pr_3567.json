{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNDUzNTA0", "number": 3567, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTowNTo0OFrOD-tw6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo1MzozMFrOD-5QgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDg4MTA0OnYy", "diffSide": "RIGHT", "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTowNTo0OFrOGY_MtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTowNTo0OFrOGY_MtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg1NDQ1Mw==", "bodyText": "Why do we need an explicit boolean primitive? .... using i.getRepeatable() does the trick", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r428854453", "createdAt": "2020-05-21T19:05:48Z", "author": {"login": "iperdomo"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable().booleanValue()).collect(Collectors.toList()).size() == 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed0ffc57cc551342a4c675aed85883bce9082ba3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDg4MjE1OnYy", "diffSide": "RIGHT", "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTowNjoxM1rOGY_NeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTowNjoxM1rOGY_NeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg1NDY0OA==", "bodyText": "Idem, that extra .booleanValue() is not required, I think", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r428854648", "createdAt": "2020-05-21T19:06:13Z", "author": {"login": "iperdomo"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable().booleanValue()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static boolean validSurveyGroup(final SurveyGroup surveyGroup){\n+        return !surveyGroup.getMonitoringGroup().booleanValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed0ffc57cc551342a4c675aed85883bce9082ba3"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MjQ5MTA2OnYy", "diffSide": "RIGHT", "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyMDo0NlrOGZOxog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODo0MTowNlrOGZPXhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwOTY2Ng==", "bodyText": "So this one is a bit more subtle. It should be that webforms doesn't support monitoring forms. I.e. in a survey you have registration form and monitoring forms.  We should allow a registration form to be filled in.  Registration form id is === SurveyGroup.newLocaleSurveyId @marvinkome I guess this is already done on UI side?", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429109666", "createdAt": "2020-05-22T08:20:46Z", "author": {"login": "muloem"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMzYzNg==", "bodyText": "Yeah on the UI, monitoring surveys aren't supported", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429113636", "createdAt": "2020-05-22T08:29:02Z", "author": {"login": "marvinkome"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwOTY2Ng=="}, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExNDU4Mw==", "bodyText": "Monitoring surveys or monitoring forms?", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429114583", "createdAt": "2020-05-22T08:30:58Z", "author": {"login": "muloem"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwOTY2Ng=="}, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExNzU4OQ==", "bodyText": "\ud83d\udc40 monitoring survey groups", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429117589", "createdAt": "2020-05-22T08:37:10Z", "author": {"login": "marvinkome"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwOTY2Ng=="}, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExOTM2Ng==", "bodyText": "Should be the same... in a monitoring Survey(Group) you have two kinds of forms, registration and monitoring forms. Registration forms can be shared via webforms, monitoring forms cannot be shared. Registration form id is found by looking at the SurveyGroup.newLocaleSurveyId property", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429119366", "createdAt": "2020-05-22T08:41:06Z", "author": {"login": "muloem"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwOTY2Ng=="}, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MjY5NzE3OnYy", "diffSide": "RIGHT", "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToyOTo1M1rOGZQyPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToyOTo1M1rOGZQyPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0MjU4OA==", "bodyText": "Let's always use { } in if conditions.", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429142588", "createdAt": "2020-05-22T09:29:53Z", "author": {"login": "iperdomo"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -25,17 +25,26 @@\n \n     public static Set<String> unsupportedQuestionTypes(){\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey){\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static Boolean validSurveyGroup(final SurveyGroup surveyGroup){\n+        return !surveyGroup.getMonitoringGroup();\n+    }\n+\n+    public static boolean validWebForm(final SurveyGroup surveyGroup, final Survey survey, final List<Question> questions){\n+        boolean validQuestionGroups = validQuestionGroups(survey);\n+        if (!validQuestionGroups) return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d34af2beea879c0d6cb592a0b9d79980b9d0a11"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3Mjc2NDE2OnYy", "diffSide": "RIGHT", "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo1MzozMFrOGZRcvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo1MzozMFrOGZRcvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MzQ3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static boolean validSurveyGroup(final Survey survey, final SurveyGroup surveyGroup) {\n          \n          \n            \n                public static boolean validForm(final Survey survey, final SurveyGroup surveyGroup) {", "url": "https://github.com/akvo/akvo-flow/pull/3567#discussion_r429153471", "createdAt": "2020-05-22T09:53:30Z", "author": {"login": "muloem"}, "path": "GAE/src/com/gallatinsystems/survey/domain/WebForm.java", "diffHunk": "@@ -23,19 +23,32 @@\n \n public class WebForm {\n \n-    public static Set<String> unsupportedQuestionTypes(){\n+    public static Set<String> unsupportedQuestionTypes() {\n         Set<String> unsupportedTypes = new HashSet<String>();\n-        unsupportedTypes.add(Question.Type.CASCADE.toString());\n         unsupportedTypes.add(Question.Type.GEOSHAPE.toString());\n         unsupportedTypes.add(Question.Type.SIGNATURE.toString());\n         unsupportedTypes.add(Question.Type.CADDISFLY.toString());\n         return unsupportedTypes;\n     }\n \n-    public static boolean validWebForm(final List<Question> questions){\n-        \n-        List<Question> validQuestions = questions.stream().filter(i -> !unsupportedQuestionTypes().contains(i.getType().toString())).collect(Collectors.toList());\n+    public static boolean validQuestionGroups(final Survey survey) {\n+        return survey.getQuestionGroupMap().values().stream().filter(i -> i.getRepeatable()).collect(Collectors.toList()).size() == 0;\n+    }\n \n+    public static boolean validSurveyGroup(final Survey survey, final SurveyGroup surveyGroup) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cafdf33784247cb56131b389c4fee9e11d0a509"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4546, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}