{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNDQyNzIy", "number": 3389, "title": "[#3283] Remove featureflag package", "bodyText": "We want to keep 2 authentication methods for now. ODIC based (Auth0)\nin Production, and GAE accounts for local development", "createdAt": "2020-01-14T04:50:15Z", "url": "https://github.com/akvo/akvo-flow/pull/3389", "merged": true, "mergeCommit": {"oid": "ca2e5c5ee7114f9a3694602ee1064520abb18c20"}, "closed": true, "closedAt": "2020-01-16T14:50:32Z", "author": {"login": "iperdomo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6Jg4kAH2gAyMzYyNDQyNzIyOmQzYWEyMjdmNDFkZDVkNTA4YjFiMDcwOWYwZGU1YmEzNGZlZjFkOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb67Ve4AFqTM0Mzk2NzkwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3aa227f41dd5d508b1b0709f0de5ba34fef1d92", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/d3aa227f41dd5d508b1b0709f0de5ba34fef1d92", "committedDate": "2020-01-14T04:47:36Z", "message": "[#3283] Remove featureflag package\n\nWe want to keep 2 authentication methods for now. ODIC based (Auth0)\nin Production, and GAE accounts for local development"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNjE4NzEw", "url": "https://github.com/akvo/akvo-flow/pull/3389#pullrequestreview-342618710", "createdAt": "2020-01-14T15:28:40Z", "commit": {"oid": "d3aa227f41dd5d508b1b0709f0de5ba34fef1d92"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2bd31f641e0368042d45bcf4c507e70787331f8", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/c2bd31f641e0368042d45bcf4c507e70787331f8", "committedDate": "2020-01-15T09:34:34Z", "message": "[#3283] Remove references to alternative login path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47d7c3d4e68bb2d7e11bf799621c54fe73ff917c", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/47d7c3d4e68bb2d7e11bf799621c54fe73ff917c", "committedDate": "2020-01-15T11:02:20Z", "message": "[#3283] Use GAE API to determine the environment\n\n- Use GAE accounts in development and OIDC (Auth0) in production"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c38c572aacbf08933b2862cb939c29f84d6bfd05", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/c38c572aacbf08933b2862cb939c29f84d6bfd05", "committedDate": "2020-01-15T14:28:12Z", "message": "Merge branch 'develop' into issue/3283-feature-flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/90124f07d5a9fac67e4ce4aae61e157747ac6f40", "committedDate": "2020-01-15T16:02:28Z", "message": "Merge branch 'develop' into issue/3283-feature-flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzM2MjU4", "url": "https://github.com/akvo/akvo-flow/pull/3389#pullrequestreview-343736258", "createdAt": "2020-01-16T08:20:36Z", "commit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODoyMDozN1rOFeRJbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODozMToyNVrOFeRa_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4MjU0MQ==", "bodyText": "Explicit configuration please, so that developers can chose which auth method to use locally.", "url": "https://github.com/akvo/akvo-flow/pull/3389#discussion_r367282541", "createdAt": "2020-01-16T08:20:37Z", "author": {"login": "dlebrero"}, "path": "GAE/src/org/akvo/flow/rest/security/EntryPoint.java", "diffHunk": "@@ -25,26 +25,24 @@\n import org.springframework.security.core.AuthenticationException;\n import org.springframework.security.web.AuthenticationEntryPoint;\n \n-import com.gallatinsystems.common.util.PropertyUtil;\n+import com.google.appengine.api.utils.SystemProperty;\n \n public class EntryPoint implements AuthenticationEntryPoint {\n-    private final AuthenticationEntryPoint defaultEntryPoint;\n-    private final AuthenticationEntryPoint alternativeEntryPoint;\n-    private final String defaultAuthProvider;\n-\n-    public EntryPoint(AuthenticationEntryPoint defaultEntryPoint, AuthenticationEntryPoint alternativeEntryPoint) {\n-        this.defaultEntryPoint = defaultEntryPoint;\n-        this.alternativeEntryPoint = alternativeEntryPoint;\n-        this.defaultAuthProvider =PropertyUtil.getProperty(\"defaultAuthProvider\");\n+    private final AuthenticationEntryPoint devEntryPoint;\n+    private final AuthenticationEntryPoint prodEntryPoint;\n+\n+\n+    public EntryPoint(AuthenticationEntryPoint prodEntryPoint, AuthenticationEntryPoint devEntryPoint) {\n+        this.devEntryPoint = devEntryPoint;\n+        this.prodEntryPoint = prodEntryPoint;\n     }\n \n     @Override\n     public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {\n-        if (\"auth0\".equals(defaultAuthProvider)) {\n-            alternativeEntryPoint.commence(request, response, authException);\n+        if (SystemProperty.environment.value() == SystemProperty.Environment.Value.Production) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4NzAzOA==", "bodyText": "Maybe we can remove the defaultEntryPoint and use Spring's PropertyPlaceholderBlaBlabla... to configure the bean to use here, using as default value the auth0 bean (https://stackoverflow.com/questions/2513484/is-there-a-way-to-specify-a-default-property-value-in-spring-xml).\nAFAIK, there is not PropertyPlaceholderBlaBlabla... yet in the Spring config, so it should be added if we opt for this.", "url": "https://github.com/akvo/akvo-flow/pull/3389#discussion_r367287038", "createdAt": "2020-01-16T08:31:25Z", "author": {"login": "dlebrero"}, "path": "GAE/war/WEB-INF/webapp-security.xml", "diffHunk": "@@ -24,13 +24,6 @@\n       <b:constructor-arg ref=\"oidcConfig\"/>\n    </b:bean>\n \n-   <http pattern=\"/altlogin\" use-expressions=\"true\" entry-point-ref=\"alternativeEntryPoint\" authentication-manager-ref=\"authenticationManager\"\n-         access-decision-manager-ref=\"accessDecisionManager\">\n-      <intercept-url pattern=\"/**\" access=\"hasRole('ROLE_USER')\"/>\n-      <custom-filter position=\"PRE_AUTH_FILTER\" ref=\"gaeFilter\"/>\n-      <csrf disabled=\"true\" />\n-   </http>\n-\n     <http use-expressions=\"true\" entry-point-ref=\"defaultEntryPoint\" authentication-manager-ref=\"authenticationManager\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9547b9de808c92c04291e7571ea2d86ae6ea4abc", "author": {"user": {"login": "iperdomo", "name": "Iv\u00e1n Perdomo"}}, "url": "https://github.com/akvo/akvo-flow/commit/9547b9de808c92c04291e7571ea2d86ae6ea4abc", "committedDate": "2020-01-16T14:31:22Z", "message": "[#3283] Ability to configure the auth entrypoint via properties\n\n* Together with @dlebrero we managed to simplify the code and\n  use `System.properties` (defined in `appengine-web.xml`) and\n  override the default authentication entrypoint `oidc` with `gae`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTY3OTAz", "url": "https://github.com/akvo/akvo-flow/pull/3389#pullrequestreview-343967903", "createdAt": "2020-01-16T14:50:24Z", "commit": {"oid": "9547b9de808c92c04291e7571ea2d86ae6ea4abc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4576, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}