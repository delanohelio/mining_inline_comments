{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MTYwODEx", "number": 3397, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo1Mjo0OFrODc6qgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNzowOVrODc7Wug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjQ3ODczOnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDatapoints.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo1Mjo0OFrOFlN_AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTo1Mjo0OFrOFlN_AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3MDc1Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const selectedDatapoint = datapointAssignments.find(\n          \n          \n            \n                const selectedDatapointAssignment = datapointAssignments.find(", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374570753", "createdAt": "2020-02-04T09:52:48Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/EditDatapoints.jsx", "diffHunk": "@@ -0,0 +1,117 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import PropTypes from 'prop-types';\n+import Checkbox from 'akvo-flow/components/reusable/Checkbox';\n+import AssignmentsContext from '../assignment-context';\n+\n+export default class EditDatapoints extends React.Component {\n+  state = {\n+    selectedDatapoints: [],\n+  };\n+\n+  onSelectDatapoint = (id, checked) => {\n+    const { selectedDatapoints } = this.state;\n+    let newSelectedDatapoints = [];\n+\n+    if (checked) {\n+      newSelectedDatapoints = selectedDatapoints.concat(id);\n+    } else {\n+      newSelectedDatapoints = selectedDatapoints.filter(device => device !== id);\n+    }\n+\n+    this.setState({ selectedDatapoints: newSelectedDatapoints });\n+  };\n+\n+  getDeviceData = () => {\n+    const { selectedDeviceId } = this.props;\n+    const { devices, datapointAssignments } = this.context.data;\n+\n+    const deviceData = devices.find(device => device.id === selectedDeviceId);\n+    const selectedDatapoint = datapointAssignments.find(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjUxMDIxOnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDowMjowNVrOFlOSAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDowMzowNlrOFlOUDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NTYxOA==", "bodyText": "It feels a little strange that the Edit button is active even when there are no datapoints assigned. This should probably only be activated when there are actually datapoints that have been assigned to a device.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374575618", "createdAt": "2020-02-04T10:02:05Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -56,12 +57,18 @@ export default class AssignDatapoints extends React.Component {\n             <div className=\"device-details\">\n               <p>{deviceData.name}</p>\n               <p>\n-                {datapointsData.length} {strings.datapointAssigned}\n+                <span>\n+                  {datapointsData.length} {strings.datapointAssigned}\n+                </span>\n+                <span className=\"divider\">.</span>\n+                <a href=\"#\" onClick={() => this.props.changeTab('EDIT_DATAPOINTS', deviceData.id)}>\n+                  Edit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NjE0Mw==", "bodyText": "Also should be a translated string.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374576143", "createdAt": "2020-02-04T10:03:06Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/components/devices/AssignmentsEditView/screens/AssignDatapoints/index.jsx", "diffHunk": "@@ -56,12 +57,18 @@ export default class AssignDatapoints extends React.Component {\n             <div className=\"device-details\">\n               <p>{deviceData.name}</p>\n               <p>\n-                {datapointsData.length} {strings.datapointAssigned}\n+                <span>\n+                  {datapointsData.length} {strings.datapointAssigned}\n+                </span>\n+                <span className=\"divider\">.</span>\n+                <a href=\"#\" onClick={() => this.props.changeTab('EDIT_DATAPOINTS', deviceData.id)}>\n+                  Edit", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3NTYxOA=="}, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjU4MzE2OnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNDoyNFrOFlO_aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNDoyNFrOFlO_aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4NzI0Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                removeDatapointsFromAssignments(datapoints, deviceIdInString) {\n          \n          \n            \n                removeDatapointsFromAssignments(datapointIds, deviceIdInString) {", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374587243", "createdAt": "2020-02-04T10:24:24Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -731,5 +724,31 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n \n       this.renderReactSide();\n     },\n+\n+    removeDatapointsFromAssignments(datapoints, deviceIdInString) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjU5MTk0OnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNzowOVrOFlPEsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoyNzowOVrOFlPEsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4ODU5Mw==", "bodyText": "This section feels a bit confusing the way its constructed. The focus is on the single datapoint assignment that we have to update to reflect that its list of datapointIds has changed.  I dont think its necessary to go filtering through all the other datapoint assignments since all we do is just return as long as they dont match the one we want.", "url": "https://github.com/akvo/akvo-flow/pull/3397#discussion_r374588593", "createdAt": "2020-02-04T10:27:09Z", "author": {"login": "muloem"}, "path": "Dashboard/app/js/lib/views/devices/assignment-edit-views.jsx", "diffHunk": "@@ -731,5 +724,31 @@ FLOW.AssignmentEditView = FLOW.ReactComponentView.extend(\n \n       this.renderReactSide();\n     },\n+\n+    removeDatapointsFromAssignments(datapoints, deviceIdInString) {\n+      // convert devieId to number\n+      const deviceId = parseInt(deviceIdInString, 10);\n+\n+      // get the selected datapoint assignment\n+      this.datapointAssignments = this.datapointAssignments.map(dpAssignment => {\n+        // get the datapoints in the selected assignment\n+        if (dpAssignment.deviceId !== deviceId) {\n+          return dpAssignment;\n+        }\n+\n+        // remove the selected datapoints from the list\n+        const dps = dpAssignment.datapoints.filter(dp => {\n+          // filter out datapoints that's in the array\n+          return !datapoints.includes(dp.id);\n+        });\n+\n+        return {\n+          ...dpAssignment,\n+          datapoints: dps,\n+        };\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e7b36b95eeaa261fa23f6e4f15012e46fda5e1"}, "originalPosition": 151}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4635, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}