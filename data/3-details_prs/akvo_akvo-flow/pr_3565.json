{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNzQ1NjMw", "number": 3565, "title": "Issue 3561/add option to share webform", "bodyText": "Before the PR (what is the issue or what needed to be done)\nThe solution\nAdd a share button to share web forms in survey page\nScreenshots (if appropriate)\n\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-05-20T13:18:54Z", "url": "https://github.com/akvo/akvo-flow/pull/3565", "merged": true, "mergeCommit": {"oid": "1ca5281337af4235bed332fa5af8967687d5c360"}, "closed": true, "closedAt": "2020-05-21T17:21:47Z", "author": {"login": "marvinkome"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcigf-uAH2gAyNDIwNzQ1NjMwOjE2ZTMxNzk0NWNmMGY0MWFmOTFjM2ZjOTg4ZDM2ZjI4NTdkNjFkZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjhA-lAFqTQxNjM0MTcyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16e317945cf0f41af91c3fc988d36f2857d61dfa", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/16e317945cf0f41af91c3fc988d36f2857d61dfa", "committedDate": "2020-05-18T14:11:24Z", "message": "[#3561] - add component for share button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372a70040c9b6875acdf65729a6c454488568d92", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/372a70040c9b6875acdf65729a6c454488568d92", "committedDate": "2020-05-18T15:28:04Z", "message": "[#3561] - design modal container and header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72a2d905fdfc46075f0925a7586f673bda679ab1", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/72a2d905fdfc46075f0925a7586f673bda679ab1", "committedDate": "2020-05-19T09:47:45Z", "message": "[#3561] - design share modal and add clipboard functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e961bb0613c3937060cc5367ab1416c3e74044d8", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/e961bb0613c3937060cc5367ab1416c3e74044d8", "committedDate": "2020-05-19T13:05:47Z", "message": "[#3561] - add form validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e48595f3041a7e04ef59d2120aa4c162f590c47", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/6e48595f3041a7e04ef59d2120aa4c162f590c47", "committedDate": "2020-05-20T10:40:33Z", "message": "Merge remote-tracking branch 'origin/issue-3562' into issue-3561/add-option-to-share-webform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e2962179b9fa207e89f7d0795c6d1b33c81a9f9", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/4e2962179b9fa207e89f7d0795c6d1b33c81a9f9", "committedDate": "2020-05-20T13:15:35Z", "message": "[3561] - fetch webform id from backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d6f058013691561edcf7ac1fd74097dc615968", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/c0d6f058013691561edcf7ac1fd74097dc615968", "committedDate": "2020-05-20T13:29:24Z", "message": "[#3561] - add full webform url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957b1c0a7866965b7a32ec855ed1ec0cd6924803", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/957b1c0a7866965b7a32ec855ed1ec0cd6924803", "committedDate": "2020-05-21T11:52:12Z", "message": "Merge branch 'master' into issue-3561/add-option-to-share-webform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/366ea6072d676141171aaa19db4c2bb93c0557d1", "committedDate": "2020-05-21T12:10:54Z", "message": "[#3561] - show loading when webform id isn't yet loaded"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDk4OTAy", "url": "https://github.com/akvo/akvo-flow/pull/3565#pullrequestreview-416098902", "createdAt": "2020-05-21T12:19:33Z", "commit": {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjoxOTozM1rOGYwuNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjoxOTozM1rOGYwuNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYxNzI2OQ==", "bodyText": "remove comment and improve format", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428617269", "createdAt": "2020-05-21T12:19:33Z", "author": {"login": "tangrammer"}, "path": "Dashboard/app/js/lib/views/surveys/form-share.jsx", "diffHunk": "@@ -0,0 +1,95 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import observe from 'akvo-flow/mixins/observe';\n+import WebFormShare from 'akvo-flow/components/forms/form-share';\n+\n+require('akvo-flow/views/react-component');\n+\n+FLOW.WebFormShareView = FLOW.ReactComponentView.extend(\n+  observe({\n+    'FLOW.selectedControl.selectedSurvey.status': 'formValidation',\n+    'FLOW.selectedControl.selectedSurveyGroup.monitoringGroup': 'formValidation',\n+    'FLOW.questionControl.content.isLoaded': 'formValidation',\n+    'FLOW.questionGroupControl.content.isLoaded': 'formValidation',\n+    'FLOW.surveyControl.webformId': 'renderReactSide',\n+  }),\n+  {\n+    init() {\n+      this._super();\n+      this.formValidation = this.formValidation.bind(this);\n+      this.renderReactSide = this.renderReactSide.bind(this);\n+      this.getProps = this.getProps.bind(this);\n+      this.getShareURL = this.getShareURL.bind(this);\n+\n+      this.valid = false;\n+    },\n+\n+    didInsertElement(...args) {\n+      this._super(...args);\n+\n+      // call validate on init", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MTExNzU5", "url": "https://github.com/akvo/akvo-flow/pull/3565#pullrequestreview-416111759", "createdAt": "2020-05-21T12:41:20Z", "commit": {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo0MToyMFrOGYxUYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo0MToyMFrOGYxUYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYyNzA0Mw==", "bodyText": "backend side also checks for CASCADE type https://github.com/akvo/akvo-flow/pull/3564/files#diff-0b87b53604405485c8652761c8c3f11eR28 ... is that correct? @muloem", "url": "https://github.com/akvo/akvo-flow/pull/3565#discussion_r428627043", "createdAt": "2020-05-21T12:41:20Z", "author": {"login": "tangrammer"}, "path": "Dashboard/app/js/lib/views/surveys/form-share.jsx", "diffHunk": "@@ -0,0 +1,95 @@\n+/* eslint-disable import/no-unresolved */\n+import React from 'react';\n+import observe from 'akvo-flow/mixins/observe';\n+import WebFormShare from 'akvo-flow/components/forms/form-share';\n+\n+require('akvo-flow/views/react-component');\n+\n+FLOW.WebFormShareView = FLOW.ReactComponentView.extend(\n+  observe({\n+    'FLOW.selectedControl.selectedSurvey.status': 'formValidation',\n+    'FLOW.selectedControl.selectedSurveyGroup.monitoringGroup': 'formValidation',\n+    'FLOW.questionControl.content.isLoaded': 'formValidation',\n+    'FLOW.questionGroupControl.content.isLoaded': 'formValidation',\n+    'FLOW.surveyControl.webformId': 'renderReactSide',\n+  }),\n+  {\n+    init() {\n+      this._super();\n+      this.formValidation = this.formValidation.bind(this);\n+      this.renderReactSide = this.renderReactSide.bind(this);\n+      this.getProps = this.getProps.bind(this);\n+      this.getShareURL = this.getShareURL.bind(this);\n+\n+      this.valid = false;\n+    },\n+\n+    didInsertElement(...args) {\n+      this._super(...args);\n+\n+      // call validate on init\n+      this.formValidation();\n+\n+      this.renderReactSide();\n+    },\n+\n+    // react side\n+    renderReactSide() {\n+      const props = this.getProps();\n+      this.reactRender(<WebFormShare {...props} />);\n+    },\n+\n+    getProps() {\n+      return {\n+        strings: {},\n+        data: {\n+          valid: this.valid,\n+          shareUrl:\n+            FLOW.surveyControl.webformId &&\n+            `${window.location.origin}/webforms/${FLOW.surveyControl.webformId}`,\n+        },\n+        actions: {\n+          getShareURL: this.getShareURL,\n+        },\n+      };\n+    },\n+\n+    formValidation() {\n+      const selectedForm = FLOW.selectedControl.get('selectedSurvey');\n+      const selectedSurveyGroup = FLOW.selectedControl.get('selectedSurveyGroup');\n+      const questions = FLOW.questionControl.get('content');\n+      const questionGroups = FLOW.questionGroupControl.get('content');\n+\n+      // case 1 is form published?\n+      const isPublished = selectedForm.get('status') === 'PUBLISHED';\n+\n+      // case 2 is not monitoring\n+      const isNotMonitoring = selectedSurveyGroup.get('monitoringGroup') === false;\n+\n+      // case 3 does not have illegal question type\n+      const noIllegalQuestion =\n+        questions.some(question => {\n+          switch (question.get('type')) {\n+            case 'CADDISFLY':\n+              return true;\n+            case 'SIGNATURE':\n+              return true;\n+            case 'GEOSHAPE':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "366ea6072d676141171aaa19db4c2bb93c0557d1"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ea429b3dc4c5de623ea910fc5f53e73ca6ce63", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/65ea429b3dc4c5de623ea910fc5f53e73ca6ce63", "committedDate": "2020-05-21T13:55:51Z", "message": "[#3561] - remove comment and blank lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MzQxNzIw", "url": "https://github.com/akvo/akvo-flow/pull/3565#pullrequestreview-416341720", "createdAt": "2020-05-21T17:21:22Z", "commit": {"oid": "65ea429b3dc4c5de623ea910fc5f53e73ca6ce63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4495, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}