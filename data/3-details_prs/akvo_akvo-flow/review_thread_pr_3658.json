{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0ODcxNzk1", "number": 3658, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTo1ODo1MVrOEvR1cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTo1ODo1MVrOEvR1cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MDEwNzM3OnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTo1ODo1MVrOHkK1xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzoyNDoyOVrOHkOJ7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA==", "bodyText": "If we follow the current behaviour of the app, it will send requests to the backend until the returned results == 0.\nSo take the case of 34 assigned datapoints.\n\nFirst query = 30 datapoints and cursor=30\nsecond query = 4 datapoints and cursor=(4 or 34?)\nthird query = 0 datapoints and cursor=(?)", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507688388", "createdAt": "2020-10-19T11:58:51Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "diffHunk": "@@ -87,7 +79,11 @@ protected RestResponse handleRequest(RestRequest req) throws Exception {\n         }\n \n         res = convertToResponse(dpList, dpReq.getSurveyId());\n-        res.setCursor(BaseDAO.getCursor(dpList));\n+        String cursor = BaseDAO.getCursor(dpList);\n+        if (cursor == null && dpList.size() > 0) {\n+            cursor = dpList.size() + \"\";\n+        }\n+        res.setCursor(cursor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyOTI0Nw==", "bodyText": "cursor would be null, I need to check if it could be an issue", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507729247", "createdAt": "2020-10-19T13:05:33Z", "author": {"login": "valllllll2000"}, "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "diffHunk": "@@ -87,7 +79,11 @@ protected RestResponse handleRequest(RestRequest req) throws Exception {\n         }\n \n         res = convertToResponse(dpList, dpReq.getSurveyId());\n-        res.setCursor(BaseDAO.getCursor(dpList));\n+        String cursor = BaseDAO.getCursor(dpList);\n+        if (cursor == null && dpList.size() > 0) {\n+            cursor = dpList.size() + \"\";\n+        }\n+        res.setCursor(cursor);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA=="}, "originalCommit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc0MjcwMw==", "bodyText": "I checked and having a null cursor is not an issue. I think in this case it makes sense. User downloads all datapoints assigned to him and cursor is reset to null. Datapoints are assigned/modified. User pressed download -> download restarts from 0 (we have no way to tell if the datapoints have been modified recently because we don't have a \"real\" cursor)", "url": "https://github.com/akvo/akvo-flow/pull/3658#discussion_r507742703", "createdAt": "2020-10-19T13:24:29Z", "author": {"login": "valllllll2000"}, "path": "GAE/src/org/akvo/flow/api/app/DataPointServlet.java", "diffHunk": "@@ -87,7 +79,11 @@ protected RestResponse handleRequest(RestRequest req) throws Exception {\n         }\n \n         res = convertToResponse(dpList, dpReq.getSurveyId());\n-        res.setCursor(BaseDAO.getCursor(dpList));\n+        String cursor = BaseDAO.getCursor(dpList);\n+        if (cursor == null && dpList.size() > 0) {\n+            cursor = dpList.size() + \"\";\n+        }\n+        res.setCursor(cursor);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY4ODM4OA=="}, "originalCommit": {"oid": "eb0dc757a91ab0636be8fe9a141822d7b5aa4085"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4599, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}