{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMjM0MjY2", "number": 3668, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTowMzowMFrOE6Znbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODoxOTo0NFrOE6crew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NjcyNTU5OnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTowMzowMFrOH1dTDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTowMzowMFrOH1dTDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxNjU4OA==", "bodyText": "https://stackoverflow.com/questions/58518098/fetch-request-to-httpswww-google-com-fails-obviously-with-cors#comment103363447_58518361\nThis explains this line", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525816588", "createdAt": "2020-11-18T05:03:00Z", "author": {"login": "marvinkome"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,31 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {\n+            this.setState({ isOffline: false });\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NjczODcwOnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNToxMDowOFrOH1dafQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTo0NDozM1rOH1eAtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw==", "bodyText": "We want to check if the status is 204? res.status === 204 right?", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525818493", "createdAt": "2020-11-18T05:10:08Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -6,19 +6,25 @@ export default class OfflineIndicator extends React.Component {\n   };\n \n   componentDidMount() {\n-    window.addEventListener('online', this.onlineStatus);\n-    window.addEventListener('offline', this.onlineStatus);\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgyNTUzMA==", "bodyText": "OK, i tested it, then if we know that res.status is 0, we should check for that? res.status === 0 ?", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525825530", "createdAt": "2020-11-18T05:35:12Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -6,19 +6,25 @@ export default class OfflineIndicator extends React.Component {\n   };\n \n   componentDidMount() {\n-    window.addEventListener('online', this.onlineStatus);\n-    window.addEventListener('offline', this.onlineStatus);\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw=="}, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgyODI3Nw==", "bodyText": "So either check for res.status === 0 or remove the whole if block, since we don't want to check the status", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525828277", "createdAt": "2020-11-18T05:44:33Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -6,19 +6,25 @@ export default class OfflineIndicator extends React.Component {\n   };\n \n   componentDidMount() {\n-    window.addEventListener('online', this.onlineStatus);\n-    window.addEventListener('offline', this.onlineStatus);\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw=="}, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NzIyNzQ3OnYy", "diffSide": "RIGHT", "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODoxOTo0NFrOH1h5jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODoxOTo0NFrOH1h5jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg5MTk4MQ==", "bodyText": "@marvinkome what about translations of this messages?", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525891981", "createdAt": "2020-11-18T08:19:44Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(() => {\n+          this.setState({ isOffline: false });\n+        })\n+        .catch(() => {\n+          this.setState({ isOffline: true });\n+        });\n+    }, 5000);\n+  }\n+\n+  componentWillUnmount() {\n+    clearInterval(this.timer);\n+  }\n+\n+  render() {\n+    return this.state.isOffline && <p>You are offline. Changes {\"won't\"} be saved</p>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4602, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}