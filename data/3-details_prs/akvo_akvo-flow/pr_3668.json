{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMjM0MjY2", "number": 3668, "title": "[#3624] - add a basic text to tell user if he/she is offline", "bodyText": "Before the PR (what is the issue or what needed to be done)\nTell user is he/she is online or offline\nThe solution\nThis is a simple implementation of using navigator.onLine.\nIt wouldn't work on some older browsers, but we would handle this edge case in future modifications\nScreenshots (if appropriate)\n\nReviewer Checklist\n\n Added an explanation about the work done\n Connected the PR and the issue on Zenhub\n Added a test plan to the issue\n Updated the copyright header (when relevant)\n Formatted the code\n Added a documentation (if relevant)\n Added some unit tests (if relevant)", "createdAt": "2020-11-17T08:31:41Z", "url": "https://github.com/akvo/akvo-flow/pull/3668", "merged": true, "mergeCommit": {"oid": "8eb078022479f68183b91e1ee30c5c5f8e51bc89"}, "closed": true, "closedAt": "2020-11-18T08:20:59Z", "author": {"login": "marvinkome"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddVSqnAH2gAyNTIyMjM0MjY2OmFhOTdiMjA3OWIxMGYxYTE0MGZlNDVlNDI5ZjA4NWE0ZWY4YjczZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddpwJQAFqTUzMzE5NjkzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa97b2079b10f1a140fe45e429f085a4ef8b73ed", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/aa97b2079b10f1a140fe45e429f085a4ef8b73ed", "committedDate": "2020-11-17T08:29:26Z", "message": "[#3624] - add a basic text to tell user if he/she is offline\n\nThis is a simple implementation of using navigator.onLine.\n\nIt wouldn't work on some older browsers, but we would handle this edge case\n in future modifications"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMjE2MDY0", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-532216064", "createdAt": "2020-11-17T10:20:49Z", "commit": {"oid": "aa97b2079b10f1a140fe45e429f085a4ef8b73ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMDk0NjEy", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-533094612", "createdAt": "2020-11-18T04:23:32Z", "commit": {"oid": "aa97b2079b10f1a140fe45e429f085a4ef8b73ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/ea90934183c19c66223fa3c8589dcbe326df8af1", "committedDate": "2020-11-18T05:01:08Z", "message": "[#3624] - ping gogle every 5 seconds for internet status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTA2MDQ4", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-533106048", "createdAt": "2020-11-18T05:03:00Z", "commit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTowMzowMFrOH1dTDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNTowMzowMFrOH1dTDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxNjU4OA==", "bodyText": "https://stackoverflow.com/questions/58518098/fetch-request-to-httpswww-google-com-fails-obviously-with-cors#comment103363447_58518361\nThis explains this line", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525816588", "createdAt": "2020-11-18T05:03:00Z", "author": {"login": "marvinkome"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,31 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {\n+            this.setState({ isOffline: false });\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTA4MjQz", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-533108243", "createdAt": "2020-11-18T05:10:07Z", "commit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNToxMDowOFrOH1dafQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNToxMDowOFrOH1dafQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODQ5Mw==", "bodyText": "We want to check if the status is 204? res.status === 204 right?", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525818493", "createdAt": "2020-11-18T05:10:08Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -6,19 +6,25 @@ export default class OfflineIndicator extends React.Component {\n   };\n \n   componentDidMount() {\n-    window.addEventListener('online', this.onlineStatus);\n-    window.addEventListener('offline', this.onlineStatus);\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(res => {\n+          // with no-cors, res.status is 0 because the javascript ignores all response.\n+          // we don't need the response, all we need to know is if the request went through or not\n+          if (res.status !== 204) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea90934183c19c66223fa3c8589dcbe326df8af1"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d", "author": {"user": null}, "url": "https://github.com/akvo/akvo-flow/commit/750c0cd910c0c0f31f4b18a66ced314d58c9d05d", "committedDate": "2020-11-18T07:08:17Z", "message": "[#3624] - remove redundant if statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTk1ODEy", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-533195812", "createdAt": "2020-11-18T08:18:06Z", "commit": {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTk2OTM4", "url": "https://github.com/akvo/akvo-flow/pull/3668#pullrequestreview-533196938", "createdAt": "2020-11-18T08:19:43Z", "commit": {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODoxOTo0NFrOH1h5jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwODoxOTo0NFrOH1h5jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg5MTk4MQ==", "bodyText": "@marvinkome what about translations of this messages?", "url": "https://github.com/akvo/akvo-flow/pull/3668#discussion_r525891981", "createdAt": "2020-11-18T08:19:44Z", "author": {"login": "iperdomo"}, "path": "Dashboard/app/js/lib/components/reusable/OfflineIndicator/index.jsx", "diffHunk": "@@ -0,0 +1,27 @@\n+import React from 'react';\n+\n+export default class OfflineIndicator extends React.Component {\n+  state = {\n+    isOffline: false,\n+  };\n+\n+  componentDidMount() {\n+    this.timer = setInterval(() => {\n+      fetch('https://www.google.com/generate_204', { mode: 'no-cors' })\n+        .then(() => {\n+          this.setState({ isOffline: false });\n+        })\n+        .catch(() => {\n+          this.setState({ isOffline: true });\n+        });\n+    }, 5000);\n+  }\n+\n+  componentWillUnmount() {\n+    clearInterval(this.timer);\n+  }\n+\n+  render() {\n+    return this.state.isOffline && <p>You are offline. Changes {\"won't\"} be saved</p>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "750c0cd910c0c0f31f4b18a66ced314d58c9d05d"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4553, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}