{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNDQyNzIy", "number": 3389, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODoyMDozN1rODYa53g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODozMToyNVrODYbFsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTMzMjE0OnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/rest/security/EntryPoint.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODoyMDozN1rOFeRJbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODoyMDozN1rOFeRJbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4MjU0MQ==", "bodyText": "Explicit configuration please, so that developers can chose which auth method to use locally.", "url": "https://github.com/akvo/akvo-flow/pull/3389#discussion_r367282541", "createdAt": "2020-01-16T08:20:37Z", "author": {"login": "dlebrero"}, "path": "GAE/src/org/akvo/flow/rest/security/EntryPoint.java", "diffHunk": "@@ -25,26 +25,24 @@\n import org.springframework.security.core.AuthenticationException;\n import org.springframework.security.web.AuthenticationEntryPoint;\n \n-import com.gallatinsystems.common.util.PropertyUtil;\n+import com.google.appengine.api.utils.SystemProperty;\n \n public class EntryPoint implements AuthenticationEntryPoint {\n-    private final AuthenticationEntryPoint defaultEntryPoint;\n-    private final AuthenticationEntryPoint alternativeEntryPoint;\n-    private final String defaultAuthProvider;\n-\n-    public EntryPoint(AuthenticationEntryPoint defaultEntryPoint, AuthenticationEntryPoint alternativeEntryPoint) {\n-        this.defaultEntryPoint = defaultEntryPoint;\n-        this.alternativeEntryPoint = alternativeEntryPoint;\n-        this.defaultAuthProvider =PropertyUtil.getProperty(\"defaultAuthProvider\");\n+    private final AuthenticationEntryPoint devEntryPoint;\n+    private final AuthenticationEntryPoint prodEntryPoint;\n+\n+\n+    public EntryPoint(AuthenticationEntryPoint prodEntryPoint, AuthenticationEntryPoint devEntryPoint) {\n+        this.devEntryPoint = devEntryPoint;\n+        this.prodEntryPoint = prodEntryPoint;\n     }\n \n     @Override\n     public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {\n-        if (\"auth0\".equals(defaultAuthProvider)) {\n-            alternativeEntryPoint.commence(request, response, authException);\n+        if (SystemProperty.environment.value() == SystemProperty.Environment.Value.Production) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTM2MjQyOnYy", "diffSide": "RIGHT", "path": "GAE/war/WEB-INF/webapp-security.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODozMToyNVrOFeRa_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwODozMToyNVrOFeRa_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4NzAzOA==", "bodyText": "Maybe we can remove the defaultEntryPoint and use Spring's PropertyPlaceholderBlaBlabla... to configure the bean to use here, using as default value the auth0 bean (https://stackoverflow.com/questions/2513484/is-there-a-way-to-specify-a-default-property-value-in-spring-xml).\nAFAIK, there is not PropertyPlaceholderBlaBlabla... yet in the Spring config, so it should be added if we opt for this.", "url": "https://github.com/akvo/akvo-flow/pull/3389#discussion_r367287038", "createdAt": "2020-01-16T08:31:25Z", "author": {"login": "dlebrero"}, "path": "GAE/war/WEB-INF/webapp-security.xml", "diffHunk": "@@ -24,13 +24,6 @@\n       <b:constructor-arg ref=\"oidcConfig\"/>\n    </b:bean>\n \n-   <http pattern=\"/altlogin\" use-expressions=\"true\" entry-point-ref=\"alternativeEntryPoint\" authentication-manager-ref=\"authenticationManager\"\n-         access-decision-manager-ref=\"accessDecisionManager\">\n-      <intercept-url pattern=\"/**\" access=\"hasRole('ROLE_USER')\"/>\n-      <custom-filter position=\"PRE_AUTH_FILTER\" ref=\"gaeFilter\"/>\n-      <csrf disabled=\"true\" />\n-   </http>\n-\n     <http use-expressions=\"true\" entry-point-ref=\"defaultEntryPoint\" authentication-manager-ref=\"authenticationManager\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4624, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}