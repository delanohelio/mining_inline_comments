{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMzE5OTIx", "number": 3583, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwOToyNDoyNFrOEAAe1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0NTozOVrOEAEg_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NDQzMzUxOnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwOToyNDoyNFrOGbA8Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMTowNzoyOFrOGbEYYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk4MDEwMw==", "bodyText": "@muloem how can we read the flow env akvotest value in flow app? so we can use prod depending deployment environment", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r430980103", "createdAt": "2020-05-27T09:24:24Z", "author": {"login": "tangrammer"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"https://tech-consultancy.akvotest.org/akvo-flow-web/%s/%s\", SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "599ecb2e1d8b6ec3acc41eb3b11221524d05e2b8"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxNDgyMQ==", "bodyText": "You would need to add it to the appengine-web config and feed it in through the EnvServlet.java", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431014821", "createdAt": "2020-05-27T10:25:12Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"https://tech-consultancy.akvotest.org/akvo-flow-web/%s/%s\", SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk4MDEwMw=="}, "originalCommit": {"oid": "599ecb2e1d8b6ec3acc41eb3b11221524d05e2b8"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAyNzI1NQ==", "bodyText": "akvo/akvo-flow-server-config#600", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431027255", "createdAt": "2020-05-27T10:48:24Z", "author": {"login": "tangrammer"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"https://tech-consultancy.akvotest.org/akvo-flow-web/%s/%s\", SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk4MDEwMw=="}, "originalCommit": {"oid": "599ecb2e1d8b6ec3acc41eb3b11221524d05e2b8"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAzNjUxMw==", "bodyText": "2ef5a43", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431036513", "createdAt": "2020-05-27T11:07:28Z", "author": {"login": "tangrammer"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"https://tech-consultancy.akvotest.org/akvo-flow-web/%s/%s\", SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk4MDEwMw=="}, "originalCommit": {"oid": "599ecb2e1d8b6ec3acc41eb3b11221524d05e2b8"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTA3MjE3OnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjozOTozN1rOGbHVkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjozOTo1N1rOGbHWTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NDk0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String url = String.format(\"%s/%s/%s\", PropertyUtil.getProperty(EnvServlet.WEBFORM_REDIRECTION_URL), SystemProperty.applicationId.get(), surveyId);\n          \n          \n            \n                    String url = String.format(\"%s/%s/%s\", PropertyUtil.getProperty(EnvServlet.WEBFORM_REDIRECTION_URL), PropertyUtil.getProperty(\"appId\"), surveyId);", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431084946", "createdAt": "2020-05-27T12:39:37Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"%s/%s/%s\", PropertyUtil.getProperty(EnvServlet.WEBFORM_REDIRECTION_URL), SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NTEzNA==", "bodyText": "We try to keep all property access through same class when possible.", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431085134", "createdAt": "2020-05-27T12:39:57Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"%s/%s/%s\", PropertyUtil.getProperty(EnvServlet.WEBFORM_REDIRECTION_URL), SystemProperty.applicationId.get(), surveyId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4NDk0Ng=="}, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTA4OTMwOnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0NDoxOVrOGbHgjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo1NDowNlrOGbH4Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4Nzc1Ng==", "bodyText": "Is this for debugging?", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431087756", "createdAt": "2020-05-27T12:44:19Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4ODA5NQ==", "bodyText": "if so maybe better log.debug() instead?", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431088095", "createdAt": "2020-05-27T12:44:52Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4Nzc1Ng=="}, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5Mzg2Mw==", "bodyText": "forgot it, removing now", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431093863", "createdAt": "2020-05-27T12:54:06Z", "author": {"login": "tangrammer"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4Nzc1Ng=="}, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTA5NDM5OnYy", "diffSide": "RIGHT", "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0NTozOVrOGbHjzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo0NTozOVrOGbHjzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4ODU5MA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/akvo/akvo-flow/pull/3583#discussion_r431088590", "createdAt": "2020-05-27T12:45:39Z", "author": {"login": "muloem"}, "path": "GAE/src/org/akvo/flow/api/app/WebFormServlet.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright (C) 2020 Stichting Akvo (Akvo Foundation)\n+ *\n+ *  This file is part of Akvo FLOW.\n+ *\n+ *  Akvo FLOW is free software: you can redistribute it and modify it under the terms of\n+ *  the GNU Affero General Public License (AGPL) as published by the Free Software Foundation,\n+ *  either version 3 of the License or any later version.\n+ *\n+ *  Akvo FLOW is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ *  See the GNU Affero General Public License included below for more details.\n+ *\n+ *  The full license text can also be seen at <http://www.gnu.org/licenses/agpl.html>.\n+ */\n+\n+package org.akvo.flow.api.app;\n+\n+import com.gallatinsystems.common.util.PropertyUtil;\n+import com.gallatinsystems.framework.rest.AbstractRestApiServlet;\n+import com.gallatinsystems.framework.rest.RestRequest;\n+import com.gallatinsystems.framework.rest.RestResponse;\n+import com.google.appengine.api.utils.SystemProperty;\n+\n+import org.waterforpeople.mapping.app.web.EnvServlet;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.logging.Logger;\n+\n+\n+/**\n+ * Redirect to tech-consultancy url or show the error\n+ */\n+@SuppressWarnings(\"serial\")\n+public class WebFormServlet extends AbstractRestApiServlet {\n+    private static final Logger log = Logger.getLogger(WebFormServlet.class.getName());\n+\n+    public WebFormServlet() {\n+        setMode(JSON_MODE);\n+    }\n+\n+    @Override\n+    protected RestRequest convertRequest() throws Exception {\n+        HttpServletRequest req = getRequest();\n+        log.warning(req.getPathInfo());\n+        RestRequest restRequest = new WebFormRequest();\n+        restRequest.populateFromHttpRequest(req);\n+        return restRequest;\n+    }\n+\n+    @Override\n+    protected RestResponse handleRequest(RestRequest req) throws Exception {\n+        RestResponse res = new RestResponse();\n+        res.setCode(String.valueOf(HttpServletResponse.SC_OK));\n+        String surveyId = ((WebFormRequest)req).getSurveyId();\n+        String url = String.format(\"%s/%s/%s\", PropertyUtil.getProperty(EnvServlet.WEBFORM_REDIRECTION_URL), SystemProperty.applicationId.get(), surveyId);\n+        res.setMessage(url);\n+        return res;\n+    }\n+\n+   \n+    /**\n+     * writes response as a JSON string\n+     */\n+    @Override\n+    protected void writeOkResponse(RestResponse resp) throws Exception {\n+        int sc;\n+        try {\n+            sc = Integer.valueOf(resp.getCode());\n+        } catch (NumberFormatException ignored) {\n+            // Status code was not properly set in the RestResponse\n+            sc = HttpServletResponse.SC_INTERNAL_SERVER_ERROR;\n+        }\n+        getResponse().setStatus(sc);\n+        if (sc == HttpServletResponse.SC_OK) {\n+            HttpServletResponse response = getResponse();\n+            response.setContentType(\"text/html\");\n+            response.setStatus(response.SC_MOVED_TEMPORARILY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef5a43c4c6154763a78398ce1e729b34699bb1e"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4561, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}