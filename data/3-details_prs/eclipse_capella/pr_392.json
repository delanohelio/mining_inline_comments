{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5OTQ0NTg2", "number": 392, "title": "[567469] Fix invalid references when scenarios are transitioned", "bodyText": "added QF to delete invalid reference\nif a scenario reference an invalid scenario, clear the reference after\ntransition\n\nChange-Id: Ida38588115ae7695d108430a05c53171cc37637a\nSigned-off-by: Georgiana Ecobici georgiana-elena.ecobici@thalesgroup.com", "createdAt": "2020-10-08T13:57:55Z", "url": "https://github.com/eclipse/capella/pull/392", "merged": true, "mergeCommit": {"oid": "455d909bca6a85c81e8f75d2cfa7686cbd097e34"}, "closed": true, "closedAt": "2020-10-09T14:11:26Z", "author": {"login": "georgiana-ecobici"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQh_cHgH2gAyNDk5OTQ0NTg2OmM3NzE0ZDBmOWU5MzRjMjZlNDE4ZjEyYmUyNGYzYjJmZWI2ODY2YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ2zKlgFqTUwNTcwOTM4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad", "author": {"user": {"login": "georgiana-ecobici", "name": null}}, "url": "https://github.com/eclipse/capella/commit/c7714d0f9e934c26e418f12be24f3b2feb6866ad", "committedDate": "2020-10-08T13:56:11Z", "message": "[567469] Fix invalid references when scenarios are transitioned\n\n- added QF to delete invalid reference\n- if a scenario reference an invalid scenario, clear the reference after\ntransition\n\n\nChange-Id: Ida38588115ae7695d108430a05c53171cc37637a\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDE3NDE4", "url": "https://github.com/eclipse/capella/pull/392#pullrequestreview-505417418", "createdAt": "2020-10-09T07:16:28Z", "commit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNjoyOVrOHe93cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNjoyOVrOHe93cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw==", "bodyText": "analizedScenarios is always empty no ? it doesnt seems to me modified.\noh, can you rename it as \"result\"", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502232947", "createdAt": "2020-10-09T07:16:29Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDI0MTUy", "url": "https://github.com/eclipse/capella/pull/392#pullrequestreview-505424152", "createdAt": "2020-10-09T07:27:59Z", "commit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNzo1OVrOHe-MKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNzo1OVrOHe-MKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODI1MQ==", "bodyText": "The test failed because there was the checking valid scenario condition for selecting only one test.\nif (postRun || isScenarioValid(scenario))", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502238251", "createdAt": "2020-10-09T07:27:59Z", "author": {"login": "georgiana-ecobici"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -86,10 +84,7 @@ protected AbstractTransform getTransformation(EObject element_p) {\n         Scenario scenario = (Scenario) eObject;\n         if (postRun || isScenarioValid(scenario)) {\n           // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n+          addAllScenarios(scenario, result, postRun);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDIzMTUy", "url": "https://github.com/eclipse/capella/pull/392#pullrequestreview-505423152", "createdAt": "2020-10-09T07:26:20Z", "commit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNjoyMVrOHe-JGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyOToyNlrOHe-O7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzNzQ2Nw==", "bodyText": "can you create one instance outside the loop", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502237467", "createdAt": "2020-10-09T07:26:21Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {\n+    if (analizedScenarios.contains(scenario))\n+      return;\n     for (TimeLapse timelapse : scenario.getOwnedTimeLapses()) {\n       if (timelapse instanceof InteractionUse) {\n         InteractionUse interaction = (InteractionUse) timelapse;\n         Scenario refScenario = interaction.getReferencedScenario();\n-        if(refScenario != null && !references.contains(refScenario)) {\n-          references.add(refScenario);\n-          searchReferencedScenarios(refScenario, references, analizedScenarios);\n+\n+        // check if is a valid reference and the reference was not already processed\n+        if (refScenario != null\n+            && new MDCHK_InteractionUse_ReferencedScenario().isValidReference(interaction, scenario, refScenario)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODk1OQ==", "bodyText": "Its hard to understand the code and what is difference between references, analizedScenarios.\ncan you simplify a bit.\nThanks", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502238959", "createdAt": "2020-10-09T07:29:26Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw=="}, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDI1NjUx", "url": "https://github.com/eclipse/capella/pull/392#pullrequestreview-505425651", "createdAt": "2020-10-09T07:30:20Z", "commit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMDoyMVrOHe-Q2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMDoyMVrOHe-Q2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzOTQ1MA==", "bodyText": "can you create one instance of MDCHK_InteractionUse_ReferencedScenario outside the loop.", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502239450", "createdAt": "2020-10-09T07:30:21Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -147,8 +165,15 @@ public void run() {\n                       .filter(sc -> sc.getName().equals(refScenario.getName())).findFirst();\n                   if (match.isPresent()) {\n                     interaction.setReferencedScenario(match.get());\n+                  } else {\n+                    interaction.setReferencedScenario(null);\n                   }\n                 }\n+                if (!new MDCHK_InteractionUse_ReferencedScenario().isValidReference(interaction, scenario,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da287d9ef87863897e8759d967ada9e5255411fe", "author": {"user": {"login": "georgiana-ecobici", "name": null}}, "url": "https://github.com/eclipse/capella/commit/da287d9ef87863897e8759d967ada9e5255411fe", "committedDate": "2020-10-09T10:07:50Z", "message": "[567469] Fix invalid references when scenarios are transitioned\n\n- fix build\n\n\nChange-Id: Ib5079a1cb6f1e62a815ebee726df4bd1d09e2f7d\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91", "author": {"user": {"login": "georgiana-ecobici", "name": null}}, "url": "https://github.com/eclipse/capella/commit/1bf2fc575c515e55366950c6a53b0c62d711fc91", "committedDate": "2020-10-09T07:23:47Z", "message": "[567469] Fix invalid references when scenarios are transitioned\n\n- fix build\n\n\nChange-Id: Ib5079a1cb6f1e62a815ebee726df4bd1d09e2f7d\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>"}, "afterCommit": {"oid": "da287d9ef87863897e8759d967ada9e5255411fe", "author": {"user": {"login": "georgiana-ecobici", "name": null}}, "url": "https://github.com/eclipse/capella/commit/da287d9ef87863897e8759d967ada9e5255411fe", "committedDate": "2020-10-09T10:07:50Z", "message": "[567469] Fix invalid references when scenarios are transitioned\n\n- fix build\n\n\nChange-Id: Ib5079a1cb6f1e62a815ebee726df4bd1d09e2f7d\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ff0ac1bbf752ddcc833f816d29ba5f22177d3a", "author": {"user": {"login": "georgiana-ecobici", "name": null}}, "url": "https://github.com/eclipse/capella/commit/74ff0ac1bbf752ddcc833f816d29ba5f22177d3a", "committedDate": "2020-10-09T12:24:44Z", "message": "[567469] Fix invalid references when scenarios are transitioned\n\n- fix OES, OAS to ES, FS (System) isValidTransition\n\n\nChange-Id: I3d94fe9e4ec78095ca715defb5609d4fc80aa517\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzA5Mzgz", "url": "https://github.com/eclipse/capella/pull/392#pullrequestreview-505709383", "createdAt": "2020-10-09T14:10:47Z", "commit": {"oid": "74ff0ac1bbf752ddcc833f816d29ba5f22177d3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1269, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}