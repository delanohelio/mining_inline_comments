{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NTc1MDQ1", "number": 430, "title": "[568583] Renaming the Instance Role should rename the Represented Instance and vice-versa for all scenario kinds", "bodyText": "Right now, it works only for Part.\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton minhtutonthat@gmail.com", "createdAt": "2020-11-06T07:58:55Z", "url": "https://github.com/eclipse/capella/pull/430", "merged": true, "mergeCommit": {"oid": "23712a8a32d52b9409ab5987a5cfef22ebd5c870"}, "closed": true, "closedAt": "2020-11-12T15:02:32Z", "author": {"login": "minhtutonthat"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZy3cIgFqTUyNDk1MTQ2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbz6gNgFqTUyOTE3NTE4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTUxNDYz", "url": "https://github.com/eclipse/capella/pull/430#pullrequestreview-524951463", "createdAt": "2020-11-06T08:41:09Z", "commit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDA0NDcz", "url": "https://github.com/eclipse/capella/pull/430#pullrequestreview-525004473", "createdAt": "2020-11-06T09:53:38Z", "commit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1MzozOFrOHunTIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1MzozOFrOHunTIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MDQxOQ==", "bodyText": "ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME.equals(feature) avoids feature!=null", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518640419", "createdAt": "2020-11-06T09:53:38Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDA2MjE1", "url": "https://github.com/eclipse/capella/pull/430#pullrequestreview-525006215", "createdAt": "2020-11-06T09:56:00Z", "commit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NjowMFrOHunYdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NjowMFrOHunYdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTc4Mw==", "bodyText": "can you use .computeIfAbsent(ch, x -> new ArrayList), otherwise, a new arrayList will be created per loop", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518641783", "createdAt": "2020-11-06T09:56:00Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {\n+      String value = notification.getNewStringValue();\n+      Object notifier = notification.getNotifier();\n+\n+      if (notifier instanceof AbstractInstance) {\n+        AbstractInstance abstractInstance = ((AbstractInstance) notifier);\n+\n+        // only sync unique per-scenario instance roles\n+        Collection<EObject> representingInstanceRoles = EObjectExt.getReferencers(abstractInstance,\n+            InteractionPackage.Literals.INSTANCE_ROLE, InteractionPackage.Literals.INSTANCE_ROLE__REPRESENTED_INSTANCE);\n+\n+        if (!representingInstanceRoles.isEmpty()) {\n+          Map<Scenario, List<InstanceRole>> scenario2IRs = new HashMap<>();\n+          for (EObject instanceRole : representingInstanceRoles) {\n+            if (instanceRole instanceof InstanceRole && instanceRole.eContainer() instanceof Scenario) {\n+              Scenario scenario = (Scenario) instanceRole.eContainer();\n+              scenario2IRs.putIfAbsent(scenario, new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9995241f44c835250f64f38b0bc2ebf5ba1f321c", "author": {"user": {"login": "minhtutonthat", "name": "Minh Tu Ton That"}}, "url": "https://github.com/eclipse/capella/commit/9995241f44c835250f64f38b0bc2ebf5ba1f321c", "committedDate": "2020-11-12T12:14:03Z", "message": "[568583] Renaming the Instance Role should rename the Represented\nInstance and vice-versa for all scenario kinds\n\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd", "author": {"user": {"login": "minhtutonthat", "name": "Minh Tu Ton That"}}, "url": "https://github.com/eclipse/capella/commit/f5e6d4cc26b894039d475bd51998a42b940557cd", "committedDate": "2020-11-06T07:57:54Z", "message": "[568583] Renaming the Instance Role should rename the Represented\nInstance and vice-versa for all scenario kinds\n\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>"}, "afterCommit": {"oid": "9995241f44c835250f64f38b0bc2ebf5ba1f321c", "author": {"user": {"login": "minhtutonthat", "name": "Minh Tu Ton That"}}, "url": "https://github.com/eclipse/capella/commit/9995241f44c835250f64f38b0bc2ebf5ba1f321c", "committedDate": "2020-11-12T12:14:03Z", "message": "[568583] Renaming the Instance Role should rename the Represented\nInstance and vice-versa for all scenario kinds\n\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTc1MTgx", "url": "https://github.com/eclipse/capella/pull/430#pullrequestreview-529175181", "createdAt": "2020-11-12T15:02:15Z", "commit": {"oid": "9995241f44c835250f64f38b0bc2ebf5ba1f321c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1291, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}