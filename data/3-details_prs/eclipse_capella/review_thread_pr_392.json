{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5OTQ0NTg2", "number": 392, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNjoyOFrOEr7gDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMDoyMFrOEr7wzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDk5MDg1OnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoxNjoyOVrOHe93cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMDo1OFrOHe-SKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw==", "bodyText": "analizedScenarios is always empty no ? it doesnt seems to me modified.\noh, can you rename it as \"result\"", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502232947", "createdAt": "2020-10-09T07:16:29Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMzg3Mg==", "bodyText": "is not empty always, in the case we select multiple scenarios  (when in search scenarios goes trough the scenarios).", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502233872", "createdAt": "2020-10-09T07:18:36Z", "author": {"login": "georgiana-ecobici"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw=="}, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODk1OQ==", "bodyText": "Its hard to understand the code and what is difference between references, analizedScenarios.\ncan you simplify a bit.\nThanks", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502238959", "createdAt": "2020-10-09T07:29:26Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw=="}, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzOTc4NQ==", "bodyText": "ok", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502239785", "createdAt": "2020-10-09T07:30:58Z", "author": {"login": "georgiana-ecobici"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzMjk0Nw=="}, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NTAyMDY3OnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNjoyMVrOHe-JGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNjoyMVrOHe-JGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzNzQ2Nw==", "bodyText": "can you create one instance outside the loop", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502237467", "createdAt": "2020-10-09T07:26:21Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -83,34 +81,45 @@ protected AbstractTransform getTransformation(EObject element_p) {\n       EObject eObject = it.next();\n \n       if (eObject instanceof Scenario) {\n-        Scenario scenario = (Scenario) eObject;\n-        if (postRun || isScenarioValid(scenario)) {\n-          // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n-        }\n+        addAllScenarios((Scenario) eObject, result, postRun);\n         it.prune();\n       }\n       // TODO we can prune many objects to limit lookup\n     }\n     return result;\n   }\n   \n-/*\n- * recursively, search for all referenced scenarios\n- */\n-  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references, Collection<EObject> analizedScenarios) {\n-    if(analizedScenarios.contains(scenario))\n-       return;\n+  private void addAllScenarios(Scenario scenario, Collection<EObject> result, boolean postRun) {\n+    if (postRun || isScenarioValid(scenario)) {\n+      // add also the scenario referenced by this scenario\n+      Set<EObject> referencesScenarios = new HashSet<EObject>();\n+      searchReferencedScenarios(scenario, referencesScenarios, result, postRun);\n+      result.addAll(referencesScenarios);\n+      result.add(scenario);\n+    }\n+  }\n+  \n+  /*\n+   * recursively, search for all referenced scenarios\n+   */\n+  protected void searchReferencedScenarios(Scenario scenario, Set<EObject> references,\n+      Collection<EObject> analizedScenarios, boolean postRun) {\n+    if (analizedScenarios.contains(scenario))\n+      return;\n     for (TimeLapse timelapse : scenario.getOwnedTimeLapses()) {\n       if (timelapse instanceof InteractionUse) {\n         InteractionUse interaction = (InteractionUse) timelapse;\n         Scenario refScenario = interaction.getReferencedScenario();\n-        if(refScenario != null && !references.contains(refScenario)) {\n-          references.add(refScenario);\n-          searchReferencedScenarios(refScenario, references, analizedScenarios);\n+\n+        // check if is a valid reference and the reference was not already processed\n+        if (refScenario != null\n+            && new MDCHK_InteractionUse_ReferencedScenario().isValidReference(interaction, scenario, refScenario)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7714d0f9e934c26e418f12be24f3b2feb6866ad"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NTAyNTkzOnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNzo1OVrOHe-MKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyNzo1OVrOHe-MKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODI1MQ==", "bodyText": "The test failed because there was the checking valid scenario condition for selecting only one test.\nif (postRun || isScenarioValid(scenario))", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502238251", "createdAt": "2020-10-09T07:27:59Z", "author": {"login": "georgiana-ecobici"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -86,10 +84,7 @@ protected AbstractTransform getTransformation(EObject element_p) {\n         Scenario scenario = (Scenario) eObject;\n         if (postRun || isScenarioValid(scenario)) {\n           // add also the scenario referenced by this scenario\n-          Set<EObject> referencesScenarios = new HashSet<EObject>();\n-          searchReferencedScenarios(scenario, referencesScenarios, result);\n-          result.addAll(referencesScenarios);\n-          result.add(scenario);\n+          addAllScenarios(scenario, result, postRun);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NTAzMzcyOnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMDoyMVrOHe-Q2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzozMTozMVrOHe-TNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzOTQ1MA==", "bodyText": "can you create one instance of MDCHK_InteractionUse_ReferencedScenario outside the loop.", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502239450", "createdAt": "2020-10-09T07:30:21Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -147,8 +165,15 @@ public void run() {\n                       .filter(sc -> sc.getName().equals(refScenario.getName())).findFirst();\n                   if (match.isPresent()) {\n                     interaction.setReferencedScenario(match.get());\n+                  } else {\n+                    interaction.setReferencedScenario(null);\n                   }\n                 }\n+                if (!new MDCHK_InteractionUse_ReferencedScenario().isValidReference(interaction, scenario,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI0MDA1Mg==", "bodyText": "ok", "url": "https://github.com/eclipse/capella/pull/392#discussion_r502240052", "createdAt": "2020-10-09T07:31:31Z", "author": {"login": "georgiana-ecobici"}, "path": "core/plugins/org.polarsys.capella.core.projection.scenario/src/org/polarsys/capella/core/projection/scenario/commands/ESToISCommand.java", "diffHunk": "@@ -147,8 +165,15 @@ public void run() {\n                       .filter(sc -> sc.getName().equals(refScenario.getName())).findFirst();\n                   if (match.isPresent()) {\n                     interaction.setReferencedScenario(match.get());\n+                  } else {\n+                    interaction.setReferencedScenario(null);\n                   }\n                 }\n+                if (!new MDCHK_InteractionUse_ReferencedScenario().isValidReference(interaction, scenario,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzOTQ1MA=="}, "originalCommit": {"oid": "1bf2fc575c515e55366950c6a53b0c62d711fc91"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4188, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}