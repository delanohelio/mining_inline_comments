{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NTc1MDQ1", "number": 430, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1MzozOFrOE2BLjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NjowMFrOE2BOyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MDc3OTAwOnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1MzozOFrOHunTIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1MzozOFrOHunTIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MDQxOQ==", "bodyText": "ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME.equals(feature) avoids feature!=null", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518640419", "createdAt": "2020-11-06T09:53:38Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MDc4NzMwOnYy", "diffSide": "RIGHT", "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NjowMFrOHunYdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMjowNjo1M1rOHx328Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTc4Mw==", "bodyText": "can you use .computeIfAbsent(ch, x -> new ArrayList), otherwise, a new arrayList will be created per loop", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518641783", "createdAt": "2020-11-06T09:56:00Z", "author": {"login": "pdulth"}, "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {\n+      String value = notification.getNewStringValue();\n+      Object notifier = notification.getNotifier();\n+\n+      if (notifier instanceof AbstractInstance) {\n+        AbstractInstance abstractInstance = ((AbstractInstance) notifier);\n+\n+        // only sync unique per-scenario instance roles\n+        Collection<EObject> representingInstanceRoles = EObjectExt.getReferencers(abstractInstance,\n+            InteractionPackage.Literals.INSTANCE_ROLE, InteractionPackage.Literals.INSTANCE_ROLE__REPRESENTED_INSTANCE);\n+\n+        if (!representingInstanceRoles.isEmpty()) {\n+          Map<Scenario, List<InstanceRole>> scenario2IRs = new HashMap<>();\n+          for (EObject instanceRole : representingInstanceRoles) {\n+            if (instanceRole instanceof InstanceRole && instanceRole.eContainer() instanceof Scenario) {\n+              Scenario scenario = (Scenario) instanceRole.eContainer();\n+              scenario2IRs.putIfAbsent(scenario, new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA1NzQ1Nw==", "bodyText": "can you use .computeIfAbsent(ch, x -> new ArrayList), otherwise, a new arrayList will be created per loop\n\nNicely spotted!", "url": "https://github.com/eclipse/capella/pull/430#discussion_r522057457", "createdAt": "2020-11-12T12:06:53Z", "author": {"login": "sandupostaru"}, "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {\n+      String value = notification.getNewStringValue();\n+      Object notifier = notification.getNotifier();\n+\n+      if (notifier instanceof AbstractInstance) {\n+        AbstractInstance abstractInstance = ((AbstractInstance) notifier);\n+\n+        // only sync unique per-scenario instance roles\n+        Collection<EObject> representingInstanceRoles = EObjectExt.getReferencers(abstractInstance,\n+            InteractionPackage.Literals.INSTANCE_ROLE, InteractionPackage.Literals.INSTANCE_ROLE__REPRESENTED_INSTANCE);\n+\n+        if (!representingInstanceRoles.isEmpty()) {\n+          Map<Scenario, List<InstanceRole>> scenario2IRs = new HashMap<>();\n+          for (EObject instanceRole : representingInstanceRoles) {\n+            if (instanceRole instanceof InstanceRole && instanceRole.eContainer() instanceof Scenario) {\n+              Scenario scenario = (Scenario) instanceRole.eContainer();\n+              scenario2IRs.putIfAbsent(scenario, new ArrayList<>());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTc4Mw=="}, "originalCommit": {"oid": "f5e6d4cc26b894039d475bd51998a42b940557cd"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4208, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}