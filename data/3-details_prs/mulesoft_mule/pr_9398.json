{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzY3MDkw", "number": 9398, "title": "MULE-18752: Visitable classes must never be returned in decorators fo\u2026", "bodyText": "\u2026r stats", "createdAt": "2020-09-10T21:52:07Z", "url": "https://github.com/mulesoft/mule/pull/9398", "merged": true, "mergeCommit": {"oid": "1d3c922dd2fdaa3bbb88de585bc668ac3708df51"}, "closed": true, "closedAt": "2020-09-11T22:31:54Z", "author": {"login": "fsgonz"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHrpOTgH2gAyNDg0MzY3MDkwOjIwZTBmZjdiOTk5MzEwZjc0YTUwYzc0YjRiY2Q0NjU2NzA0NmM4YzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH7fuCgFqTQ4NzEwNzQwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "20e0ff7b999310f74a50c74b4bcd46567046c8c1", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/20e0ff7b999310f74a50c74b4bcd46567046c8c1", "committedDate": "2020-09-11T02:05:39Z", "message": "MULE-18752: Visitable classes must never be returned in decorators for\nstats"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e8b58d1d86ed43aa2ae0fe9d3da286a298c76eb", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/4e8b58d1d86ed43aa2ae0fe9d3da286a298c76eb", "committedDate": "2020-09-10T21:25:01Z", "message": "MULE-18752: Visitable classes must never be returned in decorators for stats"}, "afterCommit": {"oid": "20e0ff7b999310f74a50c74b4bcd46567046c8c1", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/20e0ff7b999310f74a50c74b4bcd46567046c8c1", "committedDate": "2020-09-11T02:05:39Z", "message": "MULE-18752: Visitable classes must never be returned in decorators for\nstats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ac528d56da65e873dba6102f573b4b0d4a83dcf", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/3ac528d56da65e873dba6102f573b4b0d4a83dcf", "committedDate": "2020-09-11T16:49:25Z", "message": "MULE-18752: Fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c12e72d4ec31d5c2acb4aeec5f53d853751e2ef0", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/c12e72d4ec31d5c2acb4aeec5f53d853751e2ef0", "committedDate": "2020-09-11T17:54:50Z", "message": "MULE-18752: Fix"}, "afterCommit": {"oid": "9f39b46c7bb8fa55fbfb404efad50a59176e7d06", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/9f39b46c7bb8fa55fbfb404efad50a59176e7d06", "committedDate": "2020-09-11T18:02:14Z", "message": "MULE-18752: Fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f39b46c7bb8fa55fbfb404efad50a59176e7d06", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/9f39b46c7bb8fa55fbfb404efad50a59176e7d06", "committedDate": "2020-09-11T18:02:14Z", "message": "MULE-18752: Fix"}, "afterCommit": {"oid": "a89cf8970a38b71bb93f142a1af1581f8bf2367d", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/a89cf8970a38b71bb93f142a1af1581f8bf2367d", "committedDate": "2020-09-11T18:06:11Z", "message": "MULE-18752: Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7ab820f9628a79bff271ca2d123813cef286f4b", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/d7ab820f9628a79bff271ca2d123813cef286f4b", "committedDate": "2020-09-11T19:46:45Z", "message": "MULE-18752: Fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a89cf8970a38b71bb93f142a1af1581f8bf2367d", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/a89cf8970a38b71bb93f142a1af1581f8bf2367d", "committedDate": "2020-09-11T18:06:11Z", "message": "MULE-18752: Fix"}, "afterCommit": {"oid": "d7ab820f9628a79bff271ca2d123813cef286f4b", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/d7ab820f9628a79bff271ca2d123813cef286f4b", "committedDate": "2020-09-11T19:46:45Z", "message": "MULE-18752: Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "473f4e854511d3f02ed331440faebe01bf8cceed", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/473f4e854511d3f02ed331440faebe01bf8cceed", "committedDate": "2020-09-11T20:20:05Z", "message": "avoid new formatting in jdoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MTAxNzg2", "url": "https://github.com/mulesoft/mule/pull/9398#pullrequestreview-487101786", "createdAt": "2020-09-11T20:24:21Z", "commit": {"oid": "473f4e854511d3f02ed331440faebe01bf8cceed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQyMDoyNDoyMVrOHQsxSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQyMDoyNToxM1rOHQsyuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI3Mjc3OQ==", "bodyText": "remove empty lines", "url": "https://github.com/mulesoft/mule/pull/9398#discussion_r487272779", "createdAt": "2020-09-11T20:24:21Z", "author": {"login": "elrodro83"}, "path": "core-tests/src/test/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsTestCase.java", "diffHunk": "@@ -703,6 +710,53 @@ public void decorateOutputResultIterator() throws IOException {\n     assertThat(statistics.getInputObjectCount(), is(0L));\n   }\n \n+  @Test\n+  public void decorateInputCursorStreamReturnsCursorStreamStatsEnabled() {\n+    verifyDecoratedCursorStreamIsCursorStream(true, decorateInputOperation(CORR_ID,\n+                                                                           decoratorFactory\n+                                                                               .componentDecoratorFactory(component1)));\n+  }\n+\n+  @Test\n+  public void decorateInputCursorStreamReturnsCursorStreamStatsDisabled() {\n+    verifyDecoratedCursorStreamIsCursorStream(false,\n+                                              decorateInputOperation(CORR_ID,\n+                                                                     decoratorFactory.componentDecoratorFactory(component1)));\n+  }\n+\n+  @Test\n+  public void decorateOuputCursorStreamReturnsCursorStreamStatsEnabled() {\n+    verifyDecoratedCursorStreamIsCursorStream(true, decorateInputOperation(CORR_ID,\n+                                                                           decoratorFactory\n+                                                                               .componentDecoratorFactory(component1)));\n+  }\n+\n+  @Test\n+  public void decorateOutputCursorStreamReturnsCursorStreamStatsDisabled() {\n+    verifyDecoratedCursorStreamIsCursorStream(false,\n+                                              decorateOutputOperation(CORR_ID,\n+                                                                      decoratorFactory\n+                                                                          .componentDecoratorFactory(component1)));\n+  }\n+\n+  @Test\n+  public void decorateOutputCursorStreamReturnsCursorStreamStatsEnabled() {\n+    verifyDecoratedCursorStreamIsCursorStream(true,\n+                                              decorateOutputOperation(CORR_ID,\n+                                                                      decoratorFactory\n+                                                                          .componentDecoratorFactory(component1)));\n+  }\n+\n+  private void verifyDecoratedCursorStreamIsCursorStream(boolean statEnabled, UnaryOperator decorationOperator) {\n+    getStatistics().setEnabled(statEnabled);\n+    InputStream cursorStream = new ByteArrayCursorStream(mock(CursorStreamProvider.class), \"Stream\".getBytes(UTF_8));\n+    InputStream decorated = (InputStream) decorationOperator.apply(cursorStream);\n+\n+    assertThat(decorated, instanceOf(CursorStream.class));\n+  }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "473f4e854511d3f02ed331440faebe01bf8cceed"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI3MzE0NQ==", "bodyText": "use else if", "url": "https://github.com/mulesoft/mule/pull/9398#discussion_r487273145", "createdAt": "2020-09-11T20:25:13Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/StatisticsUtils.java", "diffHunk": "@@ -32,6 +33,10 @@\n    * @return a visitable wrapper of source. Empty if not a visitable class.\n    */\n   public static Optional<Visitable> visitable(Object source) {\n+    if (source instanceof CursorStream) {\n+      return of(new VisitableCursorStream((CursorStream) source));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "473f4e854511d3f02ed331440faebe01bf8cceed"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641073e9703274fe71956921e6cdfe73f598cb1d", "author": {"user": null}, "url": "https://github.com/mulesoft/mule/commit/641073e9703274fe71956921e6cdfe73f598cb1d", "committedDate": "2020-09-11T20:30:00Z", "message": "Review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MTA3NDA4", "url": "https://github.com/mulesoft/mule/pull/9398#pullrequestreview-487107408", "createdAt": "2020-09-11T20:33:45Z", "commit": {"oid": "641073e9703274fe71956921e6cdfe73f598cb1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1184, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}