{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODgwMTYw", "number": 8727, "title": "OCS add system property for setting platfotm authentication url suffix", "bodyText": "", "createdAt": "2020-03-11T19:32:17Z", "url": "https://github.com/mulesoft/mule/pull/8727", "merged": true, "mergeCommit": {"oid": "b6d39d8838340127bc969f4c4f54b412ba9d3310"}, "closed": true, "closedAt": "2020-03-13T18:36:00Z", "author": {"login": "gabrieldalborgo"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM_uKigBqjMxMjM5NjE3MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNTl7HgFqTM3NDQ3NzA0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20ffc687fa091c78eec647b91058a3ec2f31fe9e", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/20ffc687fa091c78eec647b91058a3ec2f31fe9e", "committedDate": "2020-03-11T21:09:09Z", "message": "Fix imports"}, "afterCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/1f429e5a299e62b587737ee7286b6823051ddfe7", "committedDate": "2020-03-12T17:27:43Z", "message": "Fix imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODk1NzU5", "url": "https://github.com/mulesoft/mule/pull/8727#pullrequestreview-373895759", "createdAt": "2020-03-12T20:58:29Z", "commit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMDo1ODoyOVrOF1vFEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMTowMTowNVrOF1vJlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDE5NQ==", "bodyText": "this already exists at com.mulesoft.service.oauth.internal.platform.OCSSettings#sanitizeUrl. Move to a shared Utils class that both classes can reuse", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890195", "createdAt": "2020-03-12T20:58:29Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -142,4 +156,13 @@ public PlatformManagedOAuthGrantType getGrantType() {\n   public ExtensionModel getExtensionModel() {\n     return extensionModel;\n   }\n+\n+  private static String sanitizeUrl(String url) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDQ0MA==", "bodyText": "this method should only receive the entire configurationProperties object and encapsulate all the inner resolution", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890440", "createdAt": "2020-03-12T20:59:01Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -71,6 +77,14 @@ private static String getProperty(ConfigurationProperties configurationPropertie\n         .orElseThrow(() -> new IllegalArgumentException(format(\"OCS property '%s' has not been set\", key)));\n   }\n \n+  private static String getProperty(ConfigurationProperties configurationProperties, String key, String def) {\n+    return configurationProperties.resolveStringProperty(key).orElse(def);\n+  }\n+\n+  private static String resolvePlatformAuthUrl(String url, String suffix) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDk3Nw==", "bodyText": "PLATFORM_URL -> PLATFORM_AUTH_URL", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890977", "createdAt": "2020-03-12T21:00:12Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/test/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfigTestCase.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.runtime.connectivity.oauth.ocs;\n+\n+import static java.util.Optional.of;\n+import static org.hamcrest.CoreMatchers.*;\n+import static org.junit.Assert.assertThat;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.*;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.junit.MockitoJUnitRunner;\n+import org.mule.runtime.api.component.ConfigurationProperties;\n+import org.mule.tck.junit4.AbstractMuleTestCase;\n+import org.mule.tck.size.SmallTest;\n+\n+@SmallTest\n+@RunWith(MockitoJUnitRunner.class)\n+public class PlatformManagedOAuthConfigTestCase extends AbstractMuleTestCase {\n+\n+  private static final String CLIENT_ID = \"a\";\n+  private static final String SECRET_ID = \"b\";\n+  private static final String ORG_ID = \"b\";\n+  private static final String SERVICE_URL = \"c\";\n+  private static final String PLATFORM_URL = \"http://localhost/accounts\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MTM1MQ==", "bodyText": "should be defined in the same place as OCS_PLATFORM_AUTH_URL is", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391891351", "createdAt": "2020-03-12T21:01:05Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -33,6 +34,8 @@\n  */\n public class PlatformManagedOAuthConfig extends OAuthConfig<PlatformManagedOAuthGrantType> {\n \n+  private static final String DEFAULT_PLATFORM_AUTH_URL_SUFFIX = \"/oauth2/token\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/1f429e5a299e62b587737ee7286b6823051ddfe7", "committedDate": "2020-03-12T17:27:43Z", "message": "Fix imports"}, "afterCommit": {"oid": "9c37b9179d8e66fd4c8e118f398ad7955f4cce42", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/9c37b9179d8e66fd4c8e118f398ad7955f4cce42", "committedDate": "2020-03-13T12:53:23Z", "message": "Move sanitizeUrl method to shared utils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDQ0NDMw", "url": "https://github.com/mulesoft/mule/pull/8727#pullrequestreview-374444430", "createdAt": "2020-03-13T16:32:47Z", "commit": {"oid": "9c37b9179d8e66fd4c8e118f398ad7955f4cce42"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjozMjo0N1rOF2Kc3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjozMjo0N1rOF2Kc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzODY1Mw==", "bodyText": "add @since 4.3.0", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r392338653", "createdAt": "2020-03-13T16:32:47Z", "author": {"login": "marianogonzalez"}, "path": "core/src/main/java/org/mule/runtime/core/api/util/StringUtils.java", "diffHunk": "@@ -169,5 +169,17 @@ public static String trim(String str) {\n     return org.apache.commons.lang3.StringUtils.trim(str);\n   }\n \n+  /**\n+   * Remove trailing slash from {@code url}\n+   *\n+   * @param url    an url", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c37b9179d8e66fd4c8e118f398ad7955f4cce42"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3346d110ccb09d117f3fb6b4b614e092dd63bd8b", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/3346d110ccb09d117f3fb6b4b614e092dd63bd8b", "committedDate": "2020-03-13T17:06:06Z", "message": "Add system ppropery for platform auth url suffix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d61f266a7831789bf9af82c0dc4a8d89fe1a7277", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/d61f266a7831789bf9af82c0dc4a8d89fe1a7277", "committedDate": "2020-03-13T17:06:06Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e51337f2ba8e2429b8de65513bade702b8d063", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/b9e51337f2ba8e2429b8de65513bade702b8d063", "committedDate": "2020-03-13T17:06:06Z", "message": "Refactor tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c2d7742c07baaa54ed5c2052f913780858f2f92", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/6c2d7742c07baaa54ed5c2052f913780858f2f92", "committedDate": "2020-03-13T17:06:06Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd2b37c888d1bbd4be0d5d4f59e56053e49f4613", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/fd2b37c888d1bbd4be0d5d4f59e56053e49f4613", "committedDate": "2020-03-13T17:06:06Z", "message": "Rename ocs constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81442e424bcd734a89703bad8b2fd9576e91cf89", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/81442e424bcd734a89703bad8b2fd9576e91cf89", "committedDate": "2020-03-13T17:06:06Z", "message": "Refactor tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fbd8a58822e222723450def9fe88ba31626e003", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/9fbd8a58822e222723450def9fe88ba31626e003", "committedDate": "2020-03-13T17:06:06Z", "message": "Refactor for using new ocs constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec4acc8753c71d38d7f70358acb096400f8433d4", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/ec4acc8753c71d38d7f70358acb096400f8433d4", "committedDate": "2020-03-13T17:06:06Z", "message": "Refactor resolvePlatformAuthUrl method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c27280d0e34dda090a88c7b77204c915b07c6da1", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/c27280d0e34dda090a88c7b77204c915b07c6da1", "committedDate": "2020-03-13T17:06:06Z", "message": "Move sanitizeUrl method to shared utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "committedDate": "2020-03-13T17:06:06Z", "message": "Fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf8ae42b0516519b0d0e5aab379256fed9f898db", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/bf8ae42b0516519b0d0e5aab379256fed9f898db", "committedDate": "2020-03-13T17:04:46Z", "message": "Fixes"}, "afterCommit": {"oid": "6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "committedDate": "2020-03-13T17:06:06Z", "message": "Fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDc3MDQz", "url": "https://github.com/mulesoft/mule/pull/8727#pullrequestreview-374477043", "createdAt": "2020-03-13T17:16:43Z", "commit": {"oid": "6e069dae705c6f09f66fec5d7a1b57e2e0513d93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 936, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}