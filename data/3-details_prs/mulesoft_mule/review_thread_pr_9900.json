{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTc0NjY4", "number": 9900, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNToyODowOFrOFKG9nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMDo0NzoyN1rOFL5XKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ0MTU3OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNToyODowOFrOIMvhVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNToyODowOFrOIMvhVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMjQwNg==", "bodyText": "static import", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550232406", "createdAt": "2020-12-30T15:28:08Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.loader.enricher;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+import static org.mule.runtime.extension.api.loader.DeclarationEnricherPhase.POST_STRUCTURE;\n+import static org.reflections.ReflectionUtils.getAllFields;\n+import static org.reflections.ReflectionUtils.withAnnotation;\n+\n+import org.mule.runtime.api.meta.MuleVersion;\n+import org.mule.runtime.api.meta.model.declaration.fluent.BaseDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConfigurationDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConnectionProviderDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.SourceDeclaration;\n+import org.mule.runtime.extension.api.declaration.fluent.util.IdempotentDeclarationWalker;\n+import org.mule.runtime.extension.api.exception.IllegalConfigurationModelDefinitionException;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricher;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricherPhase;\n+import org.mule.runtime.extension.api.loader.ExtensionLoadingContext;\n+import org.mule.runtime.module.extension.internal.loader.java.property.ImplementingTypeModelProperty;\n+import org.mule.runtime.module.extension.internal.loader.java.property.RuntimeVersionModelProperty;\n+import org.mule.sdk.api.annotation.param.RuntimeVersion;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collection;\n+\n+import com.google.common.base.Joiner;\n+\n+/**\n+ * {@link DeclarationEnricher} which looks at classes with fields annotated with {@link RuntimeVersion}. It validates\n+ * that the annotations is used properly and if so it adds a {@link RuntimeVersionModelProperty}.\n+ * <p>\n+ * If the {@link RuntimeVersion} annotation is used in a way which breaks the rules set on its javadoc, an\n+ * {@link IllegalConfigurationModelDefinitionException} will be thrown.\n+ *\n+ * @since 4.4\n+ */\n+public class RuntimeVersionDeclarationEnricher implements DeclarationEnricher {\n+\n+  @Override\n+  public DeclarationEnricherPhase getExecutionPhase() {\n+    return POST_STRUCTURE;\n+  }\n+\n+  @Override\n+  public void enrich(ExtensionLoadingContext extensionLoadingContext) {\n+    new IdempotentDeclarationWalker() {\n+\n+      @Override\n+      public void onConfiguration(ConfigurationDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+      @Override\n+      protected void onConnectionProvider(ConnectionProviderDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+      @Override\n+      protected void onSource(SourceDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+    }.walk(extensionLoadingContext.getExtensionDeclarer().getDeclaration());\n+  }\n+\n+  private void doEnrich(BaseDeclaration declaration) {\n+    declaration.getModelProperty(ImplementingTypeModelProperty.class).ifPresent(p -> {\n+      ImplementingTypeModelProperty typeProperty = (ImplementingTypeModelProperty) p;\n+      Collection<Field> fields = getAllFields(typeProperty.getType(), withAnnotation(RuntimeVersion.class));\n+      if (isEmpty(fields)) {\n+        return;\n+      }\n+\n+      if (fields.size() > 1) {\n+        throw new IllegalConfigurationModelDefinitionException(String\n+            .format(\"Only one field is allowed to be annotated with @%s, but class '%s' has %d fields \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ0MzM1OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/java/property/RuntimeVersionModelProperty.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNToyODo1NFrOIMviXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNToyODo1NFrOIMviXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMjY3MQ==", "bodyText": "what is a custom model property? Did you mean private?", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550232671", "createdAt": "2020-12-30T15:28:54Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/java/property/RuntimeVersionModelProperty.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.loader.java.property;\n+\n+import org.mule.runtime.api.meta.model.config.ConfigurationModel;\n+import org.mule.sdk.api.annotation.param.RuntimeVersion;\n+\n+import java.lang.reflect.Field;\n+\n+/**\n+ * A custom model property used to indicate that the class implementing a {@link ConfigurationModel} has a {@link Field}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ0NjU3OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/InjectedFieldsModelValidator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozMDoyNFrOIMvkSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxNTo0MTozMlrOIPxUoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMzE2Mw==", "bodyText": "instead of calling this method 3 times, shouldn't it be refactored so that all the annotations and types are passed together and the list of fields is iterated only once?", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550233163", "createdAt": "2020-12-30T15:30:24Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/InjectedFieldsModelValidator.java", "diffHunk": "@@ -92,8 +96,10 @@ protected void onOperation(HasOperationModels owner, OperationModel model) {\n \n           @Override\n           protected void onConnectionProvider(HasConnectionProviderModels owner, ConnectionProviderModel model) {\n-            validateFields(model, getImplementingType(model), DefaultEncoding.class);\n-            validateFields(model, getImplementingType(model), RefName.class);\n+            Optional<Class> implementingType = getImplementingType(model);\n+            validateFields(model, implementingType, DefaultEncoding.class, String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk1NDE3Mw==", "bodyText": "can you explain this change? this doesn't provide the proposed optimization", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r552954173", "createdAt": "2021-01-06T20:48:48Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/InjectedFieldsModelValidator.java", "diffHunk": "@@ -92,8 +96,10 @@ protected void onOperation(HasOperationModels owner, OperationModel model) {\n \n           @Override\n           protected void onConnectionProvider(HasConnectionProviderModels owner, ConnectionProviderModel model) {\n-            validateFields(model, getImplementingType(model), DefaultEncoding.class);\n-            validateFields(model, getImplementingType(model), RefName.class);\n+            Optional<Class> implementingType = getImplementingType(model);\n+            validateFields(model, implementingType, DefaultEncoding.class, String.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMzE2Mw=="}, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzQwNzY0OA==", "bodyText": "I will have to pass the ConnectionProviderModel, the implementingType, and a list or map with the types and annotations. It looks quite ugly to me. Is there any benefit between calling three times a  method and a foreach that requires creating the list and map?\nOn the other hand it's not exactly the same of parameters, so I'll end up with code duplication anyway", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r553407648", "createdAt": "2021-01-07T15:41:32Z", "author": {"login": "Bardammu"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/InjectedFieldsModelValidator.java", "diffHunk": "@@ -92,8 +96,10 @@ protected void onOperation(HasOperationModels owner, OperationModel model) {\n \n           @Override\n           protected void onConnectionProvider(HasConnectionProviderModels owner, ConnectionProviderModel model) {\n-            validateFields(model, getImplementingType(model), DefaultEncoding.class);\n-            validateFields(model, getImplementingType(model), RefName.class);\n+            Optional<Class> implementingType = getImplementingType(model);\n+            validateFields(model, implementingType, DefaultEncoding.class, String.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMzE2Mw=="}, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ0Nzk4OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/SourceConfigurer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozMToxNVrOIMvlMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozMToxNVrOIMvlMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzMzM5NQ==", "bodyText": "Static import", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550233395", "createdAt": "2020-12-30T15:31:15Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/SourceConfigurer.java", "diffHunk": "@@ -114,7 +117,9 @@ protected Object instantiateObject() {\n           @Override\n           public Object build(ValueResolvingContext context) throws MuleException {\n             Object source = build(resolverSet.resolve(context));\n+            MuleVersion muleVersion = new MuleVersion(MuleExtensionModelProvider.MULE_VERSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ1NTI2OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozNDoyM1rOIMvpMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozNDoyM1rOIMvpMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzNDQxNg==", "bodyText": "Should it be MuleVersion instead of String?", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550234416", "createdAt": "2020-12-30T15:34:23Z", "author": {"login": "gabrieldalborgo"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.loader.enricher;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+import static org.mule.runtime.extension.api.loader.DeclarationEnricherPhase.POST_STRUCTURE;\n+import static org.reflections.ReflectionUtils.getAllFields;\n+import static org.reflections.ReflectionUtils.withAnnotation;\n+\n+import org.mule.runtime.api.meta.MuleVersion;\n+import org.mule.runtime.api.meta.model.declaration.fluent.BaseDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConfigurationDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConnectionProviderDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.SourceDeclaration;\n+import org.mule.runtime.extension.api.declaration.fluent.util.IdempotentDeclarationWalker;\n+import org.mule.runtime.extension.api.exception.IllegalConfigurationModelDefinitionException;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricher;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricherPhase;\n+import org.mule.runtime.extension.api.loader.ExtensionLoadingContext;\n+import org.mule.runtime.module.extension.internal.loader.java.property.ImplementingTypeModelProperty;\n+import org.mule.runtime.module.extension.internal.loader.java.property.RuntimeVersionModelProperty;\n+import org.mule.sdk.api.annotation.param.RuntimeVersion;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collection;\n+\n+import com.google.common.base.Joiner;\n+\n+/**\n+ * {@link DeclarationEnricher} which looks at classes with fields annotated with {@link RuntimeVersion}. It validates\n+ * that the annotations is used properly and if so it adds a {@link RuntimeVersionModelProperty}.\n+ * <p>\n+ * If the {@link RuntimeVersion} annotation is used in a way which breaks the rules set on its javadoc, an\n+ * {@link IllegalConfigurationModelDefinitionException} will be thrown.\n+ *\n+ * @since 4.4\n+ */\n+public class RuntimeVersionDeclarationEnricher implements DeclarationEnricher {\n+\n+  @Override\n+  public DeclarationEnricherPhase getExecutionPhase() {\n+    return POST_STRUCTURE;\n+  }\n+\n+  @Override\n+  public void enrich(ExtensionLoadingContext extensionLoadingContext) {\n+    new IdempotentDeclarationWalker() {\n+\n+      @Override\n+      public void onConfiguration(ConfigurationDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+      @Override\n+      protected void onConnectionProvider(ConnectionProviderDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+      @Override\n+      protected void onSource(SourceDeclaration declaration) {\n+        doEnrich(declaration);\n+      }\n+\n+    }.walk(extensionLoadingContext.getExtensionDeclarer().getDeclaration());\n+  }\n+\n+  private void doEnrich(BaseDeclaration declaration) {\n+    declaration.getModelProperty(ImplementingTypeModelProperty.class).ifPresent(p -> {\n+      ImplementingTypeModelProperty typeProperty = (ImplementingTypeModelProperty) p;\n+      Collection<Field> fields = getAllFields(typeProperty.getType(), withAnnotation(RuntimeVersion.class));\n+      if (isEmpty(fields)) {\n+        return;\n+      }\n+\n+      if (fields.size() > 1) {\n+        throw new IllegalConfigurationModelDefinitionException(String\n+            .format(\"Only one field is allowed to be annotated with @%s, but class '%s' has %d fields \"\n+                + \"with such annotation. Offending fields are: [%s]\", RuntimeVersion.class.getSimpleName(),\n+                    typeProperty.getType().getName(),\n+                    fields.size(), Joiner.on(\", \").join(fields.stream().map(Field::getName).collect(toList()))));\n+      }\n+\n+      final Field runtimeVersionField = fields.iterator().next();\n+      if (!MuleVersion.class.equals(runtimeVersionField.getType())) {\n+        throw new IllegalConfigurationModelDefinitionException(String\n+            .format(\"Class '%s' declares the field '%s' which is annotated with @%s and is of type '%s'. Only \"\n+                + \"fields of type String are allowed to carry such annotation\", typeProperty.getType().getName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTQ1NjAzOnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozNDo0NlrOIMvpmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNTozNDo0NlrOIMvpmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDIzNDUyMQ==", "bodyText": "this is basically a copy paste from RefNameDeclarationEnricher. Create a base class for both and avoid code duplication", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r550234521", "createdAt": "2020-12-30T15:34:46Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RuntimeVersionDeclarationEnricher.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.loader.enricher;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+import static org.mule.runtime.extension.api.loader.DeclarationEnricherPhase.POST_STRUCTURE;\n+import static org.reflections.ReflectionUtils.getAllFields;\n+import static org.reflections.ReflectionUtils.withAnnotation;\n+\n+import org.mule.runtime.api.meta.MuleVersion;\n+import org.mule.runtime.api.meta.model.declaration.fluent.BaseDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConfigurationDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.ConnectionProviderDeclaration;\n+import org.mule.runtime.api.meta.model.declaration.fluent.SourceDeclaration;\n+import org.mule.runtime.extension.api.declaration.fluent.util.IdempotentDeclarationWalker;\n+import org.mule.runtime.extension.api.exception.IllegalConfigurationModelDefinitionException;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricher;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricherPhase;\n+import org.mule.runtime.extension.api.loader.ExtensionLoadingContext;\n+import org.mule.runtime.module.extension.internal.loader.java.property.ImplementingTypeModelProperty;\n+import org.mule.runtime.module.extension.internal.loader.java.property.RuntimeVersionModelProperty;\n+import org.mule.sdk.api.annotation.param.RuntimeVersion;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collection;\n+\n+import com.google.common.base.Joiner;\n+\n+/**\n+ * {@link DeclarationEnricher} which looks at classes with fields annotated with {@link RuntimeVersion}. It validates\n+ * that the annotations is used properly and if so it adds a {@link RuntimeVersionModelProperty}.\n+ * <p>\n+ * If the {@link RuntimeVersion} annotation is used in a way which breaks the rules set on its javadoc, an\n+ * {@link IllegalConfigurationModelDefinitionException} will be thrown.\n+ *\n+ * @since 4.4\n+ */\n+public class RuntimeVersionDeclarationEnricher implements DeclarationEnricher {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c1589f9394228b77a858f12a5db9e9c934e1383"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4MDE4NDcyOnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RefNameDeclarationEnricher.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMDo0NzoyN1rOIPVnGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMDo0NzoyN1rOIPVnGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk1MzYyNw==", "bodyText": "there's still a lot of duplicated code. Can't the part of fetching the ImplementType and extracting the fields also be reused by simply passing the Annotation class to filter upon?", "url": "https://github.com/mulesoft/mule/pull/9900#discussion_r552953627", "createdAt": "2021-01-06T20:47:27Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/enricher/RefNameDeclarationEnricher.java", "diffHunk": "@@ -60,33 +51,21 @@ public void onConfiguration(ConfigurationDeclaration declaration) {\n       protected void onConnectionProvider(ConnectionProviderDeclaration declaration) {\n         doEnrich(declaration);\n       }\n+\n     }.walk(extensionLoadingContext.getExtensionDeclarer().getDeclaration());\n   }\n \n-  private void doEnrich(BaseDeclaration<?> declaration) {\n-\n+  @Override\n+  protected void doEnrich(BaseDeclaration<?> declaration) {\n     declaration.getModelProperty(ImplementingTypeModelProperty.class).ifPresent(typeProperty -> {\n       Collection<Field> fields = getAllFields(typeProperty.getType(), withAnnotation(RefName.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eba4b0e2f5161a9870c119393f92d07b3ff4275"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4543, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}