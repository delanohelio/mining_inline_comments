{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NjQxOTcw", "number": 9046, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzowODoxNFrOEOrSQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODo0ODoyMFrOETzVoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzODI0NzA1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzowODoxNFrOGx9PQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzo0ODoyMVrOGx-_Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNjczOA==", "bodyText": "the caller is casting the parameter to SuppressedMuleException, why is this receiving a more generic parameter?", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r455036738", "createdAt": "2020-07-15T13:08:14Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "diffHunk": "@@ -65,14 +69,36 @@ private ErrorBuilder(Throwable e) {\n     if (e instanceof ComposedErrorException) {\n       this.errors = ((ComposedErrorException) e).getErrors();\n     }\n+    if (e instanceof SuppressedMuleException) {\n+      this.suppressedErrors = getSuppressedMessagingErrors((SuppressedMuleException) e);\n+    }\n     this.exception = e;\n     String exceptionDescription = e.getMessage() != null ? e.getMessage() : \"unknown description\";\n     this.description = exceptionDescription;\n     this.detailedDescription = exceptionDescription;\n     MuleException muleRoot = getRootMuleException(this.exception);\n-    if (muleRoot != null && muleRoot.getMessage() != null) {\n-      this.description = muleRoot.getMessage();\n+    if (muleRoot != null) {\n+      this.suppressedErrors = getSuppressedMessagingErrors(muleRoot);\n+      if (muleRoot.getMessage() != null) {\n+        this.description = muleRoot.getMessage();\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns all the {@link Error} instances that the given {@link MuleException} inform as suppressed.\n+   * @param muleException Given {@link MuleException}.\n+   * @return {@link List<Error>} containing all the {@link Error} instances that the given {@link MuleException} inform as suppressed.\n+   * @see SuppressedMuleException\n+   */\n+  private List<Error> getSuppressedMessagingErrors(MuleException muleException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b016e6526d4d149efaf0c8671dee5d34add50a"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2NTM1MA==", "bodyText": "Note that there are two calls to this method, the one that you are talking about and a second one where the parameter is a MuleException (the root mule exception, if present)", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r455065350", "createdAt": "2020-07-15T13:48:21Z", "author": {"login": "IvanAndresFritzler"}, "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "diffHunk": "@@ -65,14 +69,36 @@ private ErrorBuilder(Throwable e) {\n     if (e instanceof ComposedErrorException) {\n       this.errors = ((ComposedErrorException) e).getErrors();\n     }\n+    if (e instanceof SuppressedMuleException) {\n+      this.suppressedErrors = getSuppressedMessagingErrors((SuppressedMuleException) e);\n+    }\n     this.exception = e;\n     String exceptionDescription = e.getMessage() != null ? e.getMessage() : \"unknown description\";\n     this.description = exceptionDescription;\n     this.detailedDescription = exceptionDescription;\n     MuleException muleRoot = getRootMuleException(this.exception);\n-    if (muleRoot != null && muleRoot.getMessage() != null) {\n-      this.description = muleRoot.getMessage();\n+    if (muleRoot != null) {\n+      this.suppressedErrors = getSuppressedMessagingErrors(muleRoot);\n+      if (muleRoot.getMessage() != null) {\n+        this.description = muleRoot.getMessage();\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns all the {@link Error} instances that the given {@link MuleException} inform as suppressed.\n+   * @param muleException Given {@link MuleException}.\n+   * @return {@link List<Error>} containing all the {@link Error} instances that the given {@link MuleException} inform as suppressed.\n+   * @see SuppressedMuleException\n+   */\n+  private List<Error> getSuppressedMessagingErrors(MuleException muleException) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNjczOA=="}, "originalCommit": {"oid": "23b016e6526d4d149efaf0c8671dee5d34add50a"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MzA3Mzc2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzo0NDo1NlrOGyroNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzo0NDo1NlrOGyroNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5Njc4OQ==", "bodyText": "log a WARN in this case", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r455796789", "createdAt": "2020-07-16T13:44:56Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "diffHunk": "@@ -437,9 +438,19 @@ public boolean accept(CoreEvent event) {\n     return acceptsAll() || (acceptsErrorType(event) && acceptsExpression(event));\n   }\n \n-\n   private boolean acceptsErrorType(CoreEvent event) {\n-    return errorTypeMatcher == null || errorTypeMatcher.match(event.getError().get().getErrorType());\n+    Error error = event.getError().get();\n+    return errorTypeMatcher == null || errorTypeMatcher.match(error.getErrorType())\n+        || acceptsSuppressedErrorType(error.getSuppressedErrors());\n+  }\n+\n+  private boolean acceptsSuppressedErrorType(List<Error> suppressedErrors) {\n+    for (Error suppressedError : suppressedErrors) {\n+      if (errorTypeMatcher.match(suppressedError.getErrorType())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b016e6526d4d149efaf0c8671dee5d34add50a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDgzMjYyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowMzoxMFrOGy8shg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowMzoxMFrOGy8shg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NjQyMg==", "bodyText": "{} error handler -> Error handler '{}'", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r456076422", "createdAt": "2020-07-16T21:03:10Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "diffHunk": "@@ -437,9 +439,23 @@ public boolean accept(CoreEvent event) {\n     return acceptsAll() || (acceptsErrorType(event) && acceptsExpression(event));\n   }\n \n-\n   private boolean acceptsErrorType(CoreEvent event) {\n-    return errorTypeMatcher == null || errorTypeMatcher.match(event.getError().get().getErrorType());\n+    Error error = event.getError().get();\n+    return errorTypeMatcher == null || errorTypeMatcher.match(error.getErrorType())\n+        || acceptsSuppressedErrorType(error.getSuppressedErrors(), event);\n+  }\n+\n+  private boolean acceptsSuppressedErrorType(List<Error> suppressedErrors, CoreEvent coreEvent) {\n+    for (Error suppressedError : suppressedErrors) {\n+      ErrorType suppressedErrorType = suppressedError.getErrorType();\n+      if (errorTypeMatcher.match(suppressedErrorType)) {\n+        logger\n+            .warn(\"{} error handler has matched the following underlying error: {}. Consider a configuration change in order to match the reported error: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a33e09c05ec3d91494754590405d5d02c074c532"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDgzMzYxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowMzozMVrOGy8tJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowMzozMVrOGy8tJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NjU4Mg==", "bodyText": "use the location instead of this", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r456076582", "createdAt": "2020-07-16T21:03:31Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "diffHunk": "@@ -437,9 +439,23 @@ public boolean accept(CoreEvent event) {\n     return acceptsAll() || (acceptsErrorType(event) && acceptsExpression(event));\n   }\n \n-\n   private boolean acceptsErrorType(CoreEvent event) {\n-    return errorTypeMatcher == null || errorTypeMatcher.match(event.getError().get().getErrorType());\n+    Error error = event.getError().get();\n+    return errorTypeMatcher == null || errorTypeMatcher.match(error.getErrorType())\n+        || acceptsSuppressedErrorType(error.getSuppressedErrors(), event);\n+  }\n+\n+  private boolean acceptsSuppressedErrorType(List<Error> suppressedErrors, CoreEvent coreEvent) {\n+    for (Error suppressedError : suppressedErrors) {\n+      ErrorType suppressedErrorType = suppressedError.getErrorType();\n+      if (errorTypeMatcher.match(suppressedErrorType)) {\n+        logger\n+            .warn(\"{} error handler has matched the following underlying error: {}. Consider a configuration change in order to match the reported error: {}\",\n+                  this, suppressedErrorType, coreEvent.getError().get().getErrorType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a33e09c05ec3d91494754590405d5d02c074c532"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDgzNzQ5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowNDo1MFrOGy8vjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMTowNDo1MFrOGy8vjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NzE5OA==", "bodyText": "Consider a configuration change in order to match the reported error:  -> Consider changing it to match the reported error:", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r456077198", "createdAt": "2020-07-16T21:04:50Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "diffHunk": "@@ -437,9 +439,23 @@ public boolean accept(CoreEvent event) {\n     return acceptsAll() || (acceptsErrorType(event) && acceptsExpression(event));\n   }\n \n-\n   private boolean acceptsErrorType(CoreEvent event) {\n-    return errorTypeMatcher == null || errorTypeMatcher.match(event.getError().get().getErrorType());\n+    Error error = event.getError().get();\n+    return errorTypeMatcher == null || errorTypeMatcher.match(error.getErrorType())\n+        || acceptsSuppressedErrorType(error.getSuppressedErrors(), event);\n+  }\n+\n+  private boolean acceptsSuppressedErrorType(List<Error> suppressedErrors, CoreEvent coreEvent) {\n+    for (Error suppressedError : suppressedErrors) {\n+      ErrorType suppressedErrorType = suppressedError.getErrorType();\n+      if (errorTypeMatcher.match(suppressedErrorType)) {\n+        logger\n+            .warn(\"{} error handler has matched the following underlying error: {}. Consider a configuration change in order to match the reported error: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a33e09c05ec3d91494754590405d5d02c074c532"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTk5MTE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODo0Njo1NVrOG5vgjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNTo1NDoyMVrOG7myug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIwMDM5Ng==", "bodyText": "this will have to be considered in DataSense tests", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r463200396", "createdAt": "2020-07-30T18:46:55Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "diffHunk": "@@ -212,17 +262,19 @@ public Error build() {\n     private final ErrorType errorType;\n     private final Message muleMessage;\n     private final List<Error> errors;\n+    private final List<Error> suppressedErrors;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23fcc9d8cf3d489a302517e121518cbdc2b8f34d"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE1NDc0Ng==", "bodyText": "I'm currently working in the datasense api modifications", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r465154746", "createdAt": "2020-08-04T15:54:21Z", "author": {"login": "IvanAndresFritzler"}, "path": "core/src/main/java/org/mule/runtime/core/internal/message/ErrorBuilder.java", "diffHunk": "@@ -212,17 +262,19 @@ public Error build() {\n     private final ErrorType errorType;\n     private final Message muleMessage;\n     private final List<Error> errors;\n+    private final List<Error> suppressedErrors;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIwMDM5Ng=="}, "originalCommit": {"oid": "23fcc9d8cf3d489a302517e121518cbdc2b8f34d"}, "originalPosition": 134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTk5NTIxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODo0ODoyMFrOG5vjPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODo0ODoyMFrOG5vjPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIwMTA4Nw==", "bodyText": "make sure this is logged only the firt time, otherwise it may flood the logs", "url": "https://github.com/mulesoft/mule/pull/9046#discussion_r463201087", "createdAt": "2020-07-30T18:48:20Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/privileged/exception/TemplateOnErrorHandler.java", "diffHunk": "@@ -437,9 +439,29 @@ public boolean accept(CoreEvent event) {\n     return acceptsAll() || (acceptsErrorType(event) && acceptsExpression(event));\n   }\n \n-\n   private boolean acceptsErrorType(CoreEvent event) {\n-    return errorTypeMatcher == null || errorTypeMatcher.match(event.getError().get().getErrorType());\n+    Error error = event.getError().get();\n+    return errorTypeMatcher == null || errorTypeMatcher.match(error.getErrorType())\n+        || matchesSuppressedErrorType(error, event);\n+  }\n+\n+  /**\n+   * Evaluates if the {@link #errorTypeMatcher} matches against any of the provided {@link Error#getSuppressedErrors()} error types.\n+   * @param error {@link Error} that will be evaluated.\n+   * @param coreEvent Event containing the provided error.\n+   * @return True if at least one match is found.\n+   */\n+  private boolean matchesSuppressedErrorType(Error error, CoreEvent coreEvent) {\n+    for (Error suppressedError : error.getSuppressedErrors()) {\n+      ErrorType suppressedErrorType = suppressedError.getErrorType();\n+      if (errorTypeMatcher.match(suppressedErrorType)) {\n+        logger", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23fcc9d8cf3d489a302517e121518cbdc2b8f34d"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4895, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}