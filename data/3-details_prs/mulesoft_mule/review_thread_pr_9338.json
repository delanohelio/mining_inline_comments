{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NTA1MjA2", "number": 9338, "reviewThreads": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzozNDoxMVrOEfdQEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1Nzo0N1rOEhOyfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDIwNTYxOnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/DefaultSourceCallback.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzozNDoxMVrOHLvXlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNTo1OTowNVrOHNAntg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3MjQ3MQ==", "bodyText": "this case must account PagingProviders rather than iterators? please check with the sdk guys", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r482072471", "createdAt": "2020-09-02T13:34:11Z", "author": {"login": "elrodro83"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/DefaultSourceCallback.java", "diffHunk": "@@ -249,14 +252,50 @@ public void handle(Result<T, A> result, SourceCallbackContext context) {\n                                                                                      encodingParam,\n                                                                                      mimeTypeInitParam);\n \n+    T resultValue = result.getOutput();\n+\n+    Result<?, ?> decoratedResult = result;\n+\n+    if (resultValue instanceof InputStream) {\n+      decoratedResult = decorateInputStream(result, context);\n+    } else if (resultValue instanceof Iterator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02451804e76d185619211c56b55d16e98ef0ab71"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQwMzcwMg==", "bodyText": "PagingProviders apply to operations.", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r483403702", "createdAt": "2020-09-04T05:59:05Z", "author": {"login": "fsgonz"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/DefaultSourceCallback.java", "diffHunk": "@@ -249,14 +252,50 @@ public void handle(Result<T, A> result, SourceCallbackContext context) {\n                                                                                      encodingParam,\n                                                                                      mimeTypeInitParam);\n \n+    T resultValue = result.getOutput();\n+\n+    Result<?, ?> decoratedResult = result;\n+\n+    if (resultValue instanceof InputStream) {\n+      decoratedResult = decorateInputStream(result, context);\n+    } else if (resultValue instanceof Iterator) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3MjQ3MQ=="}, "originalCommit": {"oid": "02451804e76d185619211c56b55d16e98ef0ab71"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDU5NTkyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/api/management/stats/CursorComponentDecoratorFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDoyOToyMVrOHOHQ8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToxMjozMVrOHOHq_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTEzOQ==", "bodyText": "why is this case different to the one with InputSream?", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561139", "createdAt": "2020-09-07T20:29:21Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/api/management/stats/CursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,6 +68,18 @@\n    */\n   InputStream decorateInput(InputStream decorated, String correlationId);\n \n+  /**\n+   * If statistics are enabled, decorates the provided {@link CursorStream}.\n+   * <p>\n+   * Ref: {@link PayloadStatistics#getInputByteCount()}.\n+   *\n+   * @param decorated the {@link CursorStream} to decorate.\n+   * @param correlationId information to be used in the case a detailed report needs to be obtained, allowing to match the\n+   *        measured volume to a specific execution.\n+   * @return the decorated {@link CursorStream}.\n+   */\n+  CursorStream decorateInput(CursorStream decorated, String correlationId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2NzgwNQ==", "bodyText": "When I want to decorate a CursorProvider on openCursor I need a CursorStream as a result. PayloadStatisticsInputStream extends InputStream, not CursorStream.\nThis is the wrapper for CursorStreamProvider which returns decorated cursors:\nhttps://github.com/mulesoft/mule/pull/9338/files#diff-90fb1d0f6ef60883cd38dbf9b5bc8161R32", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484567805", "createdAt": "2020-09-07T21:12:31Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/runtime/core/api/management/stats/CursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,6 +68,18 @@\n    */\n   InputStream decorateInput(InputStream decorated, String correlationId);\n \n+  /**\n+   * If statistics are enabled, decorates the provided {@link CursorStream}.\n+   * <p>\n+   * Ref: {@link PayloadStatistics#getInputByteCount()}.\n+   *\n+   * @param decorated the {@link CursorStream} to decorate.\n+   * @param correlationId information to be used in the case a detailed report needs to be obtained, allowing to match the\n+   *        measured volume to a specific execution.\n+   * @return the decorated {@link CursorStream}.\n+   */\n+  CursorStream decorateInput(CursorStream decorated, String correlationId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTEzOQ=="}, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDU5NzY1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo0MlrOHOHR0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo0MlrOHOHR0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM2MA==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561360", "createdAt": "2020-09-07T20:30:42Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDU5NzcyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo0OFrOHOHR2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo0OFrOHOHR2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM2OA==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561368", "createdAt": "2020-09-07T20:30:48Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDU5Nzc5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo1MFrOHOHR4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMDo1MFrOHOHR4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTM3Nw==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561377", "createdAt": "2020-09-07T20:30:50Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for input statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private InputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory,\n+                                String correlationId,\n+                                boolean decorateInputStreams,\n+                                boolean decorateIterators,\n+                                boolean decorateCollections,\n+                                boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    if (decorateInputStreams) {\n+      return decoratorFactory.decorateInput(visitable, correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    if (decorateIterators) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    if (decorateCollections) {\n+      return decoratorFactory.decorateInput(visitable.getDelegate(), correlationId);\n+    } else {\n+      return visitable.getDelegate();\n+    }\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    if (decorateCollections) {\n+      return (List) decoratorFactory.decorateInput(visitableList, correlationId);\n+    }\n+    return visitableList.getDelegate();\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    if (decorateCollections) {\n+      return (Set) decoratorFactory.decorateInput(visitableSet, correlationId);\n+    }\n+    return visitableSet.getDelegate();\n+  }\n+\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider cursorStreamProvider) {\n+    if (decorateCursorProviders) {\n+      return new InputDecoratedCursorStreamProvider(cursorStreamProvider.getDelegate(), decoratorFactory, correlationId);\n+    }\n+\n+    return cursorStreamProvider.getDelegate();\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {\n+      this.decorateIterators = decorateIterators;\n+      return this;\n+    }\n+\n+    public Builder decorateInputStreams(boolean decorateInputStreams) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDU5ODcwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/NoOpCursorComponentDecoratorFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMTo0MlrOHOHSXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToyMjo0NVrOHOHwsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTUwMw==", "bodyText": "remove", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561503", "createdAt": "2020-09-07T20:31:42Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/NoOpCursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,4 +68,9 @@ public InputStream decorateOutput(InputStream decorated, String correlationId) {\n   public Iterator<Result> decorateOutputResultIterator(Iterator<Result> decorated, String correlationId) {\n     return decorated;\n   }\n+\n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTI2NQ==", "bodyText": "Same commnent as above concerning CursorStream.", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484569265", "createdAt": "2020-09-07T21:22:45Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/NoOpCursorComponentDecoratorFactory.java", "diffHunk": "@@ -67,4 +68,9 @@ public InputStream decorateOutput(InputStream decorated, String correlationId) {\n   public Iterator<Result> decorateOutputResultIterator(Iterator<Result> decorated, String correlationId) {\n     return decorated;\n   }\n+\n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTUwMw=="}, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwMDI4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowMFrOHOHTKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowMFrOHOHTKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcwNg==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561706", "createdAt": "2020-09-07T20:33:00Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {\n+      this.decorateIterators = decorateIterators;\n+      return this;\n+    }\n+\n+    public Builder decorateInputStreams(boolean decorateInputStreams) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwMDMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowM1rOHOHTLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowM1rOHOHTLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcwOQ==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561709", "createdAt": "2020-09-07T20:33:03Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {\n+      this.decorateCollections = decorateCollections;\n+      return this;\n+    }\n+\n+    public Builder decorateIterators(boolean decorateIterators) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwMDM2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowNVrOHOHTMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzowNVrOHOHTMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTcxNQ==", "bodyText": "this is not used", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561715", "createdAt": "2020-09-07T20:33:05Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+import org.mule.runtime.core.internal.management.stats.InputDecoratorVisitor.Builder;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor implements Visitor {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+  private boolean decorateInputStreams = true;\n+  private boolean decorateIterators = true;\n+  private boolean decorateCollections = true;\n+  private boolean decorateCursorProviders = true;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId,\n+                                 boolean decorateInputStreams, boolean decorateIterators, boolean decorateCollections,\n+                                 boolean decorateCursorProviders) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+    this.decorateInputStreams = decorateInputStreams;\n+    this.decorateIterators = decorateIterators;\n+    this.decorateCollections = decorateCollections;\n+    this.decorateCursorProviders = decorateCursorProviders;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator visitIterator(VisitableIterator visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List visitList(VisitableList visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set visitSet(VisitableSet visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private boolean decorateCollections = true;\n+    private boolean decorateIterators = true;\n+    private boolean decorateInputStreams = true;\n+    private boolean decorateCursorProviders = true;\n+\n+    private CursorComponentDecoratorFactory factory;\n+    private String correlationId;\n+\n+    private Builder() {}\n+\n+    public Builder decorateCollections(boolean decorateCollections) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwMDg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorComponentDecoratorFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozMzozMFrOHOHTdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToyMzowNlrOHOHw3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTc4MQ==", "bodyText": "where is this class?", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484561781", "createdAt": "2020-09-07T20:33:30Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorComponentDecoratorFactory.java", "diffHunk": "@@ -145,4 +146,13 @@ private Object decorateOutput(Object decorated, String correlationId) {\n     }\n   }\n \n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {\n+    if (payloadStatistics.isEnabled()) {\n+      return new PayloadStatisticsCursorStream(decorated, payloadStatistics::addInputByteCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTMxMA==", "bodyText": "Already pushed (not originally)", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484569310", "createdAt": "2020-09-07T21:23:06Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorComponentDecoratorFactory.java", "diffHunk": "@@ -145,4 +146,13 @@ private Object decorateOutput(Object decorated, String correlationId) {\n     }\n   }\n \n+  @Override\n+  public CursorStream decorateInput(CursorStream decorated, String correlationId) {\n+    if (payloadStatistics.isEnabled()) {\n+      return new PayloadStatisticsCursorStream(decorated, payloadStatistics::addInputByteCount);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MTc4MQ=="}, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwNjY1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCollection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozODowMVrOHOHWZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozODowMVrOHOHWZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjUzNA==", "bodyText": "put all visitor stuff in its own subpackage", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562534", "createdAt": "2020-09-07T20:38:01Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCollection.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+\n+/**\n+ * A collection that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCollection implements Visitable<Collection>, Collection {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwNzI3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableIterator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozODo0MlrOHOHWug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozODo0MlrOHOHWug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjYxOA==", "bodyText": "this may need to implement HasSize", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562618", "createdAt": "2020-09-07T20:38:42Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableIterator.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * An iterator that can be visit to decorate.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableIterator implements Iterator, Visitable<Iterator> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwNzg2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToxM1rOHOHXDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToxM1rOHOHXDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjcwMA==", "bodyText": "add generics to signature", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562700", "createdAt": "2020-09-07T20:39:13Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwNzkwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToxNlrOHOHXEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToxNlrOHOHXEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjcwNQ==", "bodyText": "add generics to signature", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562705", "createdAt": "2020-09-07T20:39:16Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwODE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToyNVrOHOHXLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOToyNVrOHOHXLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MjczNQ==", "bodyText": "add generics to signature", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562735", "createdAt": "2020-09-07T20:39:25Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);\n+\n+  /**\n+   * @param visitable a visitable list\n+   * @return result of the list which has been visited\n+   */\n+  List visitList(VisitableList visitableList);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwODMwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOTozNFrOHOHXQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDozOTozNFrOHOHXQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mjc1NA==", "bodyText": "add generics to signature", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562754", "createdAt": "2020-09-07T20:39:34Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/Visitor.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * Visitor that returns an instance as a result of an operation on the visited element.\n+ */\n+public interface Visitor {\n+\n+  /**\n+   * @param visitable a visitable inputstream\n+   * @return result of the inputstream which has been visited\n+   */\n+  InputStream visitInputStream(VisitableInputStream visitable);\n+\n+  /**\n+   * @param visitable a visitable iterator\n+   * @return result of the iterator which has been visited\n+   */\n+  Iterator visitIterator(VisitableIterator visible);\n+\n+  /**\n+   * @param visitable a visitable collection\n+   * @return result of the collection which has been visited\n+   */\n+  Collection visitCollection(VisitableCollection visitable);\n+\n+  /**\n+   * @param visitable a visitable list\n+   * @return result of the list which has been visited\n+   */\n+  List visitList(VisitableList visitableList);\n+\n+  /**\n+   * @param visitable a visitable set\n+   * @return result of the set which has been visited\n+   */\n+  Set visitSet(VisitableSet visitableSet);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYwOTcxOnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/DefaultObjectBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0MDozOVrOHOHYBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0MDozOVrOHOHYBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mjk0OA==", "bodyText": "avoid return for one-line lambdas", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484562948", "createdAt": "2020-09-07T20:40:39Z", "author": {"login": "elrodro83"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/DefaultObjectBuilder.java", "diffHunk": "@@ -127,27 +128,23 @@ public T build(ValueResolvingContext context) throws MuleException {\n \n     for (Map.Entry<FieldSetter, ValueResolver<Object>> entry : resolvers.entrySet()) {\n       final Object resolvedValue = resolveValue(entry.getValue(), context);\n+      UnaryOperator decorateOperation = v -> {\n+        return visitable(v)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxMTMxOnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/ParameterGroupObjectBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0MTo1MVrOHOHY0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0MTo1MVrOHOHY0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MzE1Mw==", "bodyText": "avoid return for one-line lambdas", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563153", "createdAt": "2020-09-07T20:41:51Z", "author": {"login": "elrodro83"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/objectbuilder/ParameterGroupObjectBuilder.java", "diffHunk": "@@ -113,15 +115,10 @@ private T doBuild(Predicate<String> hasParameter, Function<String, Object> param\n             .apply(name)), context);\n         Object value = context == null || context.resolveCursors()\n             ? resolveCursor(resolvedValue, isContent ? v -> {\n-              if (v instanceof InputStream) {\n-                return componentDecoratorFactory.decorateInput((InputStream) v, context.getEvent().getCorrelationId());\n-              } else if (v instanceof Collection) {\n-                return componentDecoratorFactory.decorateInput((Collection) v, context.getEvent().getCorrelationId());\n-              } else if (v instanceof Iterator) {\n-                return componentDecoratorFactory.decorateInput((Iterator) v, context.getEvent().getCorrelationId());\n-              } else {\n-                return v;\n-              }\n+              return visitable(v).map(visitable -> visitable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a98ebd1b81e4b746c079b1c8b55ab0dc4183fd3"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxNjE5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0NjowM1rOHOHbUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0NjowM1rOHOHbUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzc5NQ==", "bodyText": "remove empty line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563795", "createdAt": "2020-09-07T20:46:03Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * A cursor stream provider that decorates its streams\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratedCursorStreamProvider implements CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+  private CursorComponentDecoratorFactory decoratorFactory;\n+  private String correlationId;\n+\n+  public InputDecoratedCursorStreamProvider(CursorStreamProvider delegate, CursorComponentDecoratorFactory decoratorFactory,\n+                                            String correlationId) {\n+    this.delegate = delegate;\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return decoratorFactory.decorateInput(delegate.openCursor(), correlationId);\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxNjIxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0NjowNlrOHOHbVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0NjowNlrOHOHbVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzc5OQ==", "bodyText": "remove empty line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563799", "createdAt": "2020-09-07T20:46:06Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/InputDecoratedCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * A cursor stream provider that decorates its streams\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class InputDecoratedCursorStreamProvider implements CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+  private CursorComponentDecoratorFactory decoratorFactory;\n+  private String correlationId;\n+\n+  public InputDecoratedCursorStreamProvider(CursorStreamProvider delegate, CursorComponentDecoratorFactory decoratorFactory,\n+                                            String correlationId) {\n+    this.delegate = delegate;\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return decoratorFactory.decorateInput(delegate.openCursor(), correlationId);\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+\n+  }\n+\n+  @Override\n+  public void releaseResources() {\n+    delegate.releaseResources();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxNjc1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorStream.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0Njo0MFrOHOHbrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMzowMjo0N1rOHOIi3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzg4NA==", "bodyText": "why is this needed intead of using the inputstream decorator?", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563884", "createdAt": "2020-09-07T20:46:40Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorStream.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.IOException;\n+import java.util.function.LongConsumer;\n+\n+import org.mule.runtime.api.streaming.CursorProvider;\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+\n+final class PayloadStatisticsCursorStream extends CursorStream {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU4MjExMA==", "bodyText": "same comment as before.", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484582110", "createdAt": "2020-09-07T23:02:47Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsCursorStream.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import java.io.IOException;\n+import java.util.function.LongConsumer;\n+\n+import org.mule.runtime.api.streaming.CursorProvider;\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+\n+final class PayloadStatisticsCursorStream extends CursorStream {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzg4NA=="}, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxNzE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0Njo1M1rOHOHb4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0Njo1M1rOHOHb4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2MzkzNw==", "bodyText": "remove empty line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563937", "createdAt": "2020-09-07T20:46:53Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDYxNzMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0Njo1N1rOHOHb8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMDo0Njo1N1rOHOHb8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2Mzk1NA==", "bodyText": "remove empty line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484563954", "createdAt": "2020-09-07T20:46:57Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;\n+  }\n+\n+  @Override\n+  public void close() {\n+    delegate.close();\n+\n+  }\n+\n+  @Override\n+  public void releaseResources() {\n+    delegate.releaseResources();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDY1MzU4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToxOToxNFrOHOHuuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToxOToxNFrOHOHuuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2ODc2MQ==", "bodyText": "this should delegate instead of returning null", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484568761", "createdAt": "2020-09-07T21:19:14Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/VisitableCursorStreamProvider.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStream;\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+\n+/**\n+ * A cursor stream provider that can be visit to be decorated\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCursorStreamProvider implements Visitable<CursorStreamProvider>, CursorStreamProvider {\n+\n+  private CursorStreamProvider delegate;\n+\n+  public VisitableCursorStreamProvider(CursorStreamProvider delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public CursorStream openCursor() {\n+    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54bb398381a415a6fe8ef688d13a14ecc56a2ab"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjc5OTA2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/OutputDecoratorVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1NTozOFrOHObhZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1NTozOFrOHObhZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzAyOQ==", "bodyText": "remove extra line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893029", "createdAt": "2020-09-08T12:55:38Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/OutputDecoratorVisitor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.io.InputStream;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.mule.runtime.api.streaming.bytes.CursorStreamProvider;\n+import org.mule.runtime.core.api.management.stats.CursorComponentDecoratorFactory;\n+\n+/**\n+ * Visitor that returns a decorator for output statistics.\n+ * \n+ * @since 4.4, 4.3.1\n+ */\n+public class OutputDecoratorVisitor<T> implements Visitor<T> {\n+\n+  private final CursorComponentDecoratorFactory decoratorFactory;\n+  private final String correlationId;\n+\n+  private OutputDecoratorVisitor(CursorComponentDecoratorFactory decoratorFactory, String correlationId) {\n+    this.decoratorFactory = decoratorFactory;\n+    this.correlationId = correlationId;\n+  }\n+\n+  @Override\n+  public InputStream visitInputStream(VisitableInputStream visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Iterator<T> visitIterator(VisitableIterator<T> visitable) {\n+    return decoratorFactory.decorateOutput(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public Collection<T> visitCollection(VisitableCollection visitable) {\n+    return decoratorFactory.decorateOutputResultCollection(visitable.getDelegate(), correlationId);\n+  }\n+\n+  @Override\n+  public List<T> visitList(VisitableList<T> visitableList) {\n+    return visitableList;\n+  }\n+\n+  @Override\n+  public Set<T> visitSet(VisitableSet<T> visitableSet) {\n+    return visitableSet;\n+  }\n+\n+  @Override\n+  public CursorStreamProvider visitCursorStreamProvider(VisitableCursorStreamProvider visitableCursorStreamProvider) {\n+    return visitableCursorStreamProvider;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static class Builder {\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af4c7336e2e73f7f434b3840d83e9b75999fa16"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjgwMDQyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableCollection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1NjowMVrOHObiSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1NjowMVrOHObiSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzI1OA==", "bodyText": "remove extra lines", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893258", "createdAt": "2020-09-08T12:56:01Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+\n+/**\n+ * A collection that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableCollection<T> implements Visitable<Collection<T>>, Collection<T> {\n+\n+  private final Collection<T> delegate;\n+\n+  public VisitableCollection(Collection<T> delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public Collection<T> accept(Visitor visitor) {\n+    return visitor.visitCollection(this);\n+  }\n+\n+  @Override\n+  public int size() {\n+    return delegate.size();\n+  }\n+\n+  @Override\n+  public boolean isEmpty() {\n+    return delegate.isEmpty();\n+  }\n+\n+  @Override\n+  public boolean contains(Object o) {\n+    return delegate.contains(o);\n+  }\n+\n+  @Override\n+  public Iterator<T> iterator() {\n+    return delegate.iterator();\n+  }\n+\n+  @Override\n+  public Object[] toArray() {\n+    return delegate.toArray();\n+  }\n+\n+  @Override\n+  public <T> T[] toArray(T[] a) {\n+    return delegate.toArray(a);\n+  }\n+\n+  @Override\n+  public boolean add(T e) {\n+    return delegate.add(e);\n+  }\n+\n+  @Override\n+  public boolean remove(Object o) {\n+    return delegate.remove(o);\n+  }\n+\n+  @Override\n+  public boolean containsAll(Collection<?> c) {\n+    return delegate.containsAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(Collection<? extends T> c) {\n+    return delegate.addAll(c);\n+  }\n+\n+  @Override\n+  public boolean removeAll(Collection<?> c) {\n+    return delegate.removeAll(c);\n+  }\n+\n+  @Override\n+  public boolean retainAll(Collection<?> c) {\n+    return delegate.retainAll(c);\n+  }\n+\n+  @Override\n+  public void clear() {\n+    delegate.clear();\n+  }\n+\n+  @Override\n+  public Collection<T> getDelegate() {\n+    return delegate;\n+  }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af4c7336e2e73f7f434b3840d83e9b75999fa16"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjgwMzI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableList.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1Njo0NFrOHObkCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1Njo0NFrOHObkCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5MzcwNw==", "bodyText": "remove extra line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484893707", "createdAt": "2020-09-08T12:56:44Z", "author": {"login": "elrodro83"}, "path": "core/src/main/java/org/mule/runtime/core/internal/management/stats/visitor/VisitableList.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.management.stats.visitor;\n+\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+\n+/**\n+ * A list that can be visit to be decorated.\n+ *\n+ * @since 4.4, 4.3.1\n+ */\n+public class VisitableList<T> implements Visitable<List<T>>, List<T> {\n+\n+  private final List<T> delegate;\n+\n+  public VisitableList(List<T> delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  @Override\n+  public List<T> accept(Visitor visitor) {\n+    return visitor.visitList(this);\n+  }\n+\n+  @Override\n+  public int size() {\n+    return delegate.size();\n+  }\n+\n+  @Override\n+  public boolean isEmpty() {\n+    return delegate.isEmpty();\n+  }\n+\n+  @Override\n+  public boolean contains(Object o) {\n+    return delegate.contains(o);\n+  }\n+\n+  @Override\n+  public Iterator<T> iterator() {\n+    return delegate.iterator();\n+  }\n+\n+  @Override\n+  public Object[] toArray() {\n+    return delegate.toArray();\n+  }\n+\n+  @Override\n+  public <T> T[] toArray(T[] a) {\n+    return delegate.toArray(a);\n+  }\n+\n+  @Override\n+  public boolean add(T e) {\n+    return delegate.add(e);\n+  }\n+\n+  @Override\n+  public boolean remove(Object o) {\n+    return delegate.remove(o);\n+  }\n+\n+  @Override\n+  public boolean containsAll(Collection<?> c) {\n+    return delegate.containsAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(Collection<? extends T> c) {\n+    return delegate.addAll(c);\n+  }\n+\n+  @Override\n+  public boolean addAll(int index, Collection<? extends T> c) {\n+    return delegate.addAll(index, c);\n+  }\n+\n+  @Override\n+  public boolean removeAll(Collection<?> c) {\n+    return delegate.removeAll(c);\n+  }\n+\n+  @Override\n+  public boolean retainAll(Collection<?> c) {\n+    return delegate.retainAll(c);\n+  }\n+\n+  @Override\n+  public void clear() {\n+    delegate.clear();\n+  }\n+\n+  @Override\n+  public T get(int index) {\n+    return delegate.get(index);\n+  }\n+\n+  @Override\n+  public T set(int index, T element) {\n+    return delegate.set(index, element);\n+  }\n+\n+  @Override\n+  public void add(int index, T element) {\n+    delegate.add(index, element);\n+  }\n+\n+  @Override\n+  public T remove(int index) {\n+    return delegate.remove(index);\n+  }\n+\n+  @Override\n+  public int indexOf(Object o) {\n+    return delegate.indexOf(o);\n+  }\n+\n+  @Override\n+  public int lastIndexOf(Object o) {\n+    return delegate.lastIndexOf(o);\n+  }\n+\n+  @Override\n+  public ListIterator<T> listIterator() {\n+    return delegate.listIterator();\n+  }\n+\n+  @Override\n+  public ListIterator<T> listIterator(int index) {\n+    return delegate.listIterator(index);\n+  }\n+\n+  @Override\n+  public List<T> subList(int fromIndex, int toIndex) {\n+    return delegate.subList(fromIndex, toIndex);\n+  }\n+\n+  @Override\n+  public List<T> getDelegate() {\n+    return delegate;\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af4c7336e2e73f7f434b3840d83e9b75999fa16"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMjgwNzY3OnYy", "diffSide": "RIGHT", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/ResolverUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1Nzo0N1rOHObmww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMjo1Nzo0N1rOHObmww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5NDQwMw==", "bodyText": "fix format, put the second // in a new line", "url": "https://github.com/mulesoft/mule/pull/9338#discussion_r484894403", "createdAt": "2020-09-08T12:57:47Z", "author": {"login": "elrodro83"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/ResolverUtils.java", "diffHunk": "@@ -176,7 +192,8 @@ public static Object resolveCursor(TypedValue<?> typedValue, UnaryOperator value\n       if (stackedTypesModelProperty.isPresent()) {\n         resolver = stackedTypesModelProperty.get().getValueResolverFactory().getExpressionBasedValueResolver(expression,\n                                                                                                              getType(type));\n-        //TODO MULE-13518: Add support for stacked value resolvers for @Parameter inside pojos // The following \"IFs\" should be removed once implemented\n+        // TODO MULE-13518: Add support for stacked value resolvers for @Parameter inside pojos // The following \"IFs\" should be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af4c7336e2e73f7f434b3840d83e9b75999fa16"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4761, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}