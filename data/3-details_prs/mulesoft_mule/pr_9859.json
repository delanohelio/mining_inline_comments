{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNTAxOTk5", "number": 9859, "title": "MULE-19055: SampleDataProvider validator is not validating generic", "bodyText": "", "createdAt": "2020-12-15T18:06:22Z", "url": "https://github.com/mulesoft/mule/pull/9859", "merged": true, "mergeCommit": {"oid": "df3fb9f03f326c51f9b546db7785f40161e34a7d"}, "closed": true, "closedAt": "2020-12-20T03:17:16Z", "author": {"login": "marianogonzalez"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmeTUwgH2gAyNTQwNTAxOTk5Ojk4MTI0M2ZlYmZmNmQzOTNlNmI5NDY0N2Y1YzQxOTRjNzJkOTI4MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnKY50AFqTU1NTAwMDQ5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "981243febff6d393e6b94647f5c4194c72d9281b", "author": {"user": {"login": "marianogonzalez", "name": "Mariano Gonzalez"}}, "url": "https://github.com/mulesoft/mule/commit/981243febff6d393e6b94647f5c4194c72d9281b", "committedDate": "2020-12-15T18:04:37Z", "message": "MULE-19055: SampleDataProvider validator is not validating generic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODAxOTQ5", "url": "https://github.com/mulesoft/mule/pull/9859#pullrequestreview-552801949", "createdAt": "2020-12-15T19:34:00Z", "commit": {"oid": "981243febff6d393e6b94647f5c4194c72d9281b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32865af933d5fc68b21610cf1e77205403400331", "author": {"user": {"login": "marianogonzalez", "name": "Mariano Gonzalez"}}, "url": "https://github.com/mulesoft/mule/commit/32865af933d5fc68b21610cf1e77205403400331", "committedDate": "2020-12-15T21:27:32Z", "message": "bug fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMzA4Mzc3", "url": "https://github.com/mulesoft/mule/pull/9859#pullrequestreview-553308377", "createdAt": "2020-12-16T02:22:15Z", "commit": {"oid": "32865af933d5fc68b21610cf1e77205403400331"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNjUyODA4", "url": "https://github.com/mulesoft/mule/pull/9859#pullrequestreview-553652808", "createdAt": "2020-12-16T12:48:09Z", "commit": {"oid": "32865af933d5fc68b21610cf1e77205403400331"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjo0ODowOVrOIHDrsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjo0ODowOVrOIHDrsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI3MTI4MA==", "bodyText": "Maybe when the type is null, and is the generic of the SampleDataProvider, we should add an error that states that the SampleDataProviderGenerics must be explicit.", "url": "https://github.com/mulesoft/mule/pull/9859#discussion_r544271280", "createdAt": "2020-12-16T12:48:09Z", "author": {"login": "ndinu"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/validation/SampleDataModelValidator.java", "diffHunk": "@@ -144,6 +157,38 @@ private void validateResolver(ConnectableComponentModel model,\n     }\n   }\n \n+  private void validateGenerics(ConnectableComponentModel model, ProblemsReporter problemsReporter,\n+                                Class<? extends SampleDataProvider> providerClass) {\n+    String providerGenerics = asGenericSignature(getInterfaceGenerics(providerClass, SampleDataProvider.class));\n+    String outputGenerics = asGenericSignature(getOutputTypes(model, providerClass.getClassLoader()));\n+\n+    if (!Objects.equals(providerGenerics, outputGenerics)) {\n+      problemsReporter.addError(new Problem(model, format(\n+                                                          \"SampleDataProvider [%s] was expecting to define '%s' generics signature but '%s' was found instead\",\n+                                                          providerClass.getName(), outputGenerics, providerGenerics)));\n+    }\n+  }\n+\n+  private List<Type> getOutputTypes(ConnectableComponentModel model, ClassLoader classLoader) {\n+    return asList(JavaTypeUtils.getType(model.getOutput().getType(), classLoader),\n+                  JavaTypeUtils.getType(model.getOutputAttributes().getType(), classLoader));\n+  }\n+\n+  private String asGenericSignature(List<Type> types) {\n+    return \"<\" + types.stream()\n+        .map(this::asString)\n+        .collect(joining(\",\")) + \">\";\n+  }\n+\n+  private String asString(Type type) {\n+    if (type instanceof ParameterizedTypeImpl) {\n+      ParameterizedTypeImpl parameterizedType = (ParameterizedTypeImpl) type;\n+      return parameterizedType.getRawType().getName() + asGenericSignature(asList(parameterizedType.getActualTypeArguments()));\n+    } else {\n+      return type != null ? type.getTypeName() : Object.class.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32865af933d5fc68b21610cf1e77205403400331"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2693efb21f443e9193eeecffb8c866f73c343ee8", "author": {"user": {"login": "marianogonzalez", "name": "Mariano Gonzalez"}}, "url": "https://github.com/mulesoft/mule/commit/2693efb21f443e9193eeecffb8c866f73c343ee8", "committedDate": "2020-12-17T18:25:35Z", "message": "bug fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MDAwNDk1", "url": "https://github.com/mulesoft/mule/pull/9859#pullrequestreview-555000495", "createdAt": "2020-12-17T21:26:32Z", "commit": {"oid": "2693efb21f443e9193eeecffb8c866f73c343ee8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1043, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}