{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDE3NjAz", "number": 9165, "title": "CMTS-26: Validate and fix ValueProviderCacheIdGenerator for complex parameters", "bodyText": "", "createdAt": "2020-08-04T21:26:38Z", "url": "https://github.com/mulesoft/mule/pull/9165", "merged": true, "mergeCommit": {"oid": "c7711a374cc95978757b75e6c5cb94d4a43713df"}, "closed": true, "closedAt": "2020-08-07T12:55:48Z", "author": {"login": "lucianoRM"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc75ijwgFqTQ2MTU3Njk3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8jZYGAFqTQ2MzI2NDM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNTc2OTc3", "url": "https://github.com/mulesoft/mule/pull/9165#pullrequestreview-461576977", "createdAt": "2020-08-05T11:29:51Z", "commit": {"oid": "545bccac50b48c69e1241c6bb53b7e75b07f038f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMToyOTo1MVrOG8FpQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMToyOTo1MVrOG8FpQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY2MDIyNw==", "bodyText": "How about Map?", "url": "https://github.com/mulesoft/mule/pull/9165#discussion_r465660227", "createdAt": "2020-08-05T11:29:51Z", "author": {"login": "gsfernandes"}, "path": "modules/spring-config/src/main/java/org/mule/runtime/config/api/dsl/model/metadata/ComponentBasedIdHelper.java", "diffHunk": "@@ -56,4 +61,50 @@ static String sourceElementNameFromSimpleValue(ComponentAst owner, ComponentPara\n     return elementModel.getRawParameterValue(CONFIG_ATTRIBUTE_NAME);\n   }\n \n+  public static int computeHashFor(ComponentParameterAst componentParameterAst) {\n+    return ParameterVisitorFunctions.computeHashFor(componentParameterAst);\n+  }\n+\n+  private static class ParameterVisitorFunctions {\n+\n+    private static int computeHashFor(ComponentParameterAst parameter) {\n+      return hash(new ParameterVisitorFunctions(parameter).hashBuilder.toString());\n+    }\n+\n+    private StringBuilder hashBuilder = new StringBuilder();\n+    private final Function<String, Void> leftFunction = this::hashForLeft;\n+    private final Function<Object, Void> rightFunction = this::hashForRight;\n+\n+    private ParameterVisitorFunctions(ComponentParameterAst startingParameter) {\n+      startingParameter.getValue().reduce(leftFunction, rightFunction);\n+    }\n+\n+    private Void hashForLeft(String s) {\n+      hashBuilder.append(s);\n+      return null;\n+    }\n+\n+    private Void hashForRight(Object o) {\n+      if (o instanceof ComponentAst) {\n+        final ComponentAst c = (ComponentAst) o;\n+        c.getParameters().stream().sorted(comparing(p -> p.getModel().getName())).forEach(p -> {\n+          hashBuilder.append(p.getModel().getName());\n+          if (p.getModel().getType() instanceof ArrayType) {\n+            hashForList((Collection<ComponentAst>) p.getValue().getRight());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "545bccac50b48c69e1241c6bb53b7e75b07f038f"}, "originalPosition": 55}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "545bccac50b48c69e1241c6bb53b7e75b07f038f", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/545bccac50b48c69e1241c6bb53b7e75b07f038f", "committedDate": "2020-08-04T21:10:23Z", "message": "added more options to test"}, "afterCommit": {"oid": "6145fa17ca2adbc2bf7c53a0f73eb5029498b955", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/6145fa17ca2adbc2bf7c53a0f73eb5029498b955", "committedDate": "2020-08-05T12:55:39Z", "message": "added more options to test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bce01b9bc0e18a46d5c5002e656e97e9261a126", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/9bce01b9bc0e18a46d5c5002e656e97e9261a126", "committedDate": "2020-08-05T12:55:39Z", "message": "new valueprovideridgenerator for caching with declaration and model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94ed00bacba0ec15955034e7de79a09b6a426b40", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/94ed00bacba0ec15955034e7de79a09b6a426b40", "committedDate": "2020-08-05T12:55:39Z", "message": "removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60ac04f3835c74658a8cb3ba5ae29518bc84bf4f", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/60ac04f3835c74658a8cb3ba5ae29518bc84bf4f", "committedDate": "2020-08-05T12:55:39Z", "message": "recursively hashing parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbfe60c1c6ea95c1dc35383931fa3af07af5e89c", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/dbfe60c1c6ea95c1dc35383931fa3af07af5e89c", "committedDate": "2020-08-05T12:55:39Z", "message": "added more tests and fixed behaviour"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7be62bd85a5f588122fbd46de1efca82d3c01c8e", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/7be62bd85a5f588122fbd46de1efca82d3c01c8e", "committedDate": "2020-08-05T12:55:39Z", "message": "more tests and new behaviour"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38938f10cd7b1e45ecc305a12166404076e59a8b", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/38938f10cd7b1e45ecc305a12166404076e59a8b", "committedDate": "2020-08-05T12:55:39Z", "message": "adding changes from test in master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87ab1aa5b7f082764522f31b7a7126d1e1099b0f", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/87ab1aa5b7f082764522f31b7a7126d1e1099b0f", "committedDate": "2020-08-05T12:55:39Z", "message": "saving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "894c6518393c81595ad3fc26eaa881686b52f5e4", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/894c6518393c81595ad3fc26eaa881686b52f5e4", "committedDate": "2020-08-05T12:55:39Z", "message": "saving"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f0eca6fb8d36c8b39d063acf1b25ea201d3bb28", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/7f0eca6fb8d36c8b39d063acf1b25ea201d3bb28", "committedDate": "2020-08-05T12:55:39Z", "message": "removed empty lines and changed log level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2e6dccd06a8b09efb7e3fa859af6b218da1c634", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/d2e6dccd06a8b09efb7e3fa859af6b218da1c634", "committedDate": "2020-08-05T12:55:39Z", "message": "removed unused implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6145fa17ca2adbc2bf7c53a0f73eb5029498b955", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/6145fa17ca2adbc2bf7c53a0f73eb5029498b955", "committedDate": "2020-08-05T12:55:39Z", "message": "added more options to test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODU4ODE2", "url": "https://github.com/mulesoft/mule/pull/9165#pullrequestreview-461858816", "createdAt": "2020-08-05T17:05:20Z", "commit": {"oid": "6145fa17ca2adbc2bf7c53a0f73eb5029498b955"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzowNToyMFrOG8Sv-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzowNToyMFrOG8Sv-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg3NDkzNw==", "bodyText": "You are right", "url": "https://github.com/mulesoft/mule/pull/9165#discussion_r465874937", "createdAt": "2020-08-05T17:05:20Z", "author": {"login": "gsfernandes"}, "path": "modules/spring-config/src/main/java/org/mule/runtime/config/api/dsl/model/metadata/ComponentBasedIdHelper.java", "diffHunk": "@@ -56,4 +61,50 @@ static String sourceElementNameFromSimpleValue(ComponentAst owner, ComponentPara\n     return elementModel.getRawParameterValue(CONFIG_ATTRIBUTE_NAME);\n   }\n \n+  public static int computeHashFor(ComponentParameterAst componentParameterAst) {\n+    return ParameterVisitorFunctions.computeHashFor(componentParameterAst);\n+  }\n+\n+  private static class ParameterVisitorFunctions {\n+\n+    private static int computeHashFor(ComponentParameterAst parameter) {\n+      return hash(new ParameterVisitorFunctions(parameter).hashBuilder.toString());\n+    }\n+\n+    private StringBuilder hashBuilder = new StringBuilder();\n+    private final Function<String, Void> leftFunction = this::hashForLeft;\n+    private final Function<Object, Void> rightFunction = this::hashForRight;\n+\n+    private ParameterVisitorFunctions(ComponentParameterAst startingParameter) {\n+      startingParameter.getValue().reduce(leftFunction, rightFunction);\n+    }\n+\n+    private Void hashForLeft(String s) {\n+      hashBuilder.append(s);\n+      return null;\n+    }\n+\n+    private Void hashForRight(Object o) {\n+      if (o instanceof ComponentAst) {\n+        final ComponentAst c = (ComponentAst) o;\n+        c.getParameters().stream().sorted(comparing(p -> p.getModel().getName())).forEach(p -> {\n+          hashBuilder.append(p.getModel().getName());\n+          if (p.getModel().getType() instanceof ArrayType) {\n+            hashForList((Collection<ComponentAst>) p.getValue().getRight());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY2MDIyNw=="}, "originalCommit": {"oid": "545bccac50b48c69e1241c6bb53b7e75b07f038f"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8125394f2e98a4e7b23da623310b51fdc4b07e5", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/f8125394f2e98a4e7b23da623310b51fdc4b07e5", "committedDate": "2020-08-05T17:37:01Z", "message": "mapping import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMjY0MzQz", "url": "https://github.com/mulesoft/mule/pull/9165#pullrequestreview-463264343", "createdAt": "2020-08-07T12:15:56Z", "commit": {"oid": "f8125394f2e98a4e7b23da623310b51fdc4b07e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 485, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}