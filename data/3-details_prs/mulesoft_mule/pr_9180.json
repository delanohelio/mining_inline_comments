{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDU5NTcz", "number": 9180, "title": "MULE-18635: DslElementModel is not created consistently", "bodyText": "Also cleanup ComponentAstBasedElementModelFactory to reuse the models already set in the ast being navigated.", "createdAt": "2020-08-10T12:07:17Z", "url": "https://github.com/mulesoft/mule/pull/9180", "merged": true, "mergeCommit": {"oid": "c51aca3066b7537f10f02133b72d2a70f8f9f39d"}, "closed": true, "closedAt": "2020-08-10T16:22:03Z", "author": {"login": "elrodro83"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8syseAH2gAyNDY1NDU5NTczOjQ4OWIzMDkyMDc0ZGFhOWZjYjkwYTQ1MjI0ZWM0NDA3NjE4ZWFiYWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9jhYWAFqTQ2NDMwNzcwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "489b3092074daa9fcb90a45224ec4407618eabac", "author": {"user": {"login": "lucianoRM", "name": "Luciano RaineriMarchina"}}, "url": "https://github.com/mulesoft/mule/commit/489b3092074daa9fcb90a45224ec4407618eabac", "committedDate": "2020-08-07T23:12:44Z", "message": "saving tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a38aa9f76703cbd04c3162f70167d59dfca43634", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/a38aa9f76703cbd04c3162f70167d59dfca43634", "committedDate": "2020-08-07T23:12:45Z", "message": "checkpoint!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "759031f273c02a751614031a5284c93cd5b8ad38", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/759031f273c02a751614031a5284c93cd5b8ad38", "committedDate": "2020-08-07T23:12:47Z", "message": "checkpoint2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad00c695ce9fdee78afedb3120b39767e0b0d04d", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/ad00c695ce9fdee78afedb3120b39767e0b0d04d", "committedDate": "2020-08-07T23:12:48Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc5999dda9333490dda448944e96eb352888d837", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/dc5999dda9333490dda448944e96eb352888d837", "committedDate": "2020-08-07T23:12:49Z", "message": "duplicates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba995fe332001b6a998d9007f14d3645e28c3966", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/ba995fe332001b6a998d9007f14d3645e28c3966", "committedDate": "2020-08-08T00:06:52Z", "message": "sdk tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23df46ed55c410ae98b5ef16e93cf41613d01b26", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/23df46ed55c410ae98b5ef16e93cf41613d01b26", "committedDate": "2020-08-08T14:45:06Z", "message": "fix metadata keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f30c66339dacb466415c6e03ea1a8d57720acd80", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/f30c66339dacb466415c6e03ea1a8d57720acd80", "committedDate": "2020-08-08T14:59:48Z", "message": "TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/f03504b19c0b68e63eec5ef44df9fa8ec27db72b", "committedDate": "2020-08-08T15:10:52Z", "message": "javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjMwNTA0", "url": "https://github.com/mulesoft/mule/pull/9180#pullrequestreview-464230504", "createdAt": "2020-08-10T13:32:42Z", "commit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozMjo0MlrOG-OsgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozMjo0MlrOG-OsgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkwNTY2NA==", "bodyText": "remove unused parameters elementDsl and parameterized", "url": "https://github.com/mulesoft/mule/pull/9180#discussion_r467905664", "createdAt": "2020-08-10T13:32:42Z", "author": {"login": "mlischetti"}, "path": "modules/spring-config/src/main/java/org/mule/runtime/config/internal/dsl/model/ComponentAstBasedElementModelFactory.java", "diffHunk": "@@ -528,75 +410,56 @@ private void populateParameterizedElements(ParameterizedModel model, DslElementS\n         .forEach(p -> addElementParameter(innerComponents, parameters, elementDsl, builder, p));\n   }\n \n-  private void populateComposableElements(ComposableModel model, DslElementSyntax elementDsl,\n+  private void populateConnectionProviderElements(NamedObject model, DslElementSyntax elementDsl,\n+                                                  DslElementModel.Builder builder, ComponentAst configuration) {\n+    configuration.directChildrenStream()\n+        .filter(c -> c.getModel(ConnectionProviderModel.class).isPresent())\n+        .forEach(nestedComponentConfig -> create(nestedComponentConfig).ifPresent(builder::containing));\n+  }\n+\n+  private void populateComposableElements(NamedObject model, DslElementSyntax elementDsl,\n                                           DslElementModel.Builder builder, ComponentAst configuration) {\n+    final List<String> paramsAsChildrenNames = configuration.getModel(ParameterizedModel.class)\n+        .map(pmz -> pmz.getAllParameterModels()\n+            .stream()\n+            .map(pm -> hyphenize(pm.getName()))\n+            .collect(toList()))\n+        .orElse(emptyList());\n \n     configuration.directChildrenStream()\n-        .forEach(nestedComponentConfig -> {\n-          DslElementModel nestedElement = createIdentifiedElement(nestedComponentConfig);\n-          if (nestedElement != null) {\n-            builder.containing(nestedElement);\n-          } else {\n-            model.getNestedComponents()\n-                .stream()\n-                .filter(nestedModel -> nestedModel instanceof NestedRouteModel)\n-                .filter(nestedModel -> elementDsl.getContainedElement(nestedModel.getName())\n-                    .map(nestedDsl -> getIdentifier(nestedDsl).map(id -> nestedComponentConfig.getIdentifier().equals(id))\n-                        .orElse(false))\n-                    .orElse(false))\n-                .findFirst()\n-                .ifPresent(nestedModel -> {\n-                  DslElementSyntax routeDsl = elementDsl.getContainedElement(nestedModel.getName()).get();\n-                  DslElementModel.Builder<? extends NestableElementModel> routeBuilder =\n-                      DslElementModel.<NestableElementModel>builder()\n-                          .withModel(nestedModel)\n-                          .withDsl(routeDsl)\n-                          .withConfig(nestedComponentConfig)\n-                          .isExplicitInDsl(true);\n-\n-                  populateParameterizedElements((ParameterizedModel) nestedModel, routeDsl, routeBuilder, nestedComponentConfig);\n-                  nestedComponentConfig.directChildrenStream()\n-                      .forEach(routeElement -> {\n-                        DslElementModel nestableElementModel = createIdentifiedElement(routeElement);\n-                        if (nestableElementModel != null) {\n-                          routeBuilder.containing(nestableElementModel);\n-                        }\n-                      });\n-\n-                  builder.containing(routeBuilder.build());\n-                });\n-          }\n-        });\n+        // TODO MULE-17711 Remove this filter\n+        .filter(c -> !paramsAsChildrenNames.contains(c.getIdentifier().getName()))\n+        .filter(c -> !c.getModel(ConnectionProviderModel.class).isPresent())\n+        .forEach(nestedComponentConfig -> create(nestedComponentConfig).ifPresent(builder::containing));\n   }\n \n-  private void addInlineGroup(DslElementSyntax elementDsl,\n+  private void addInlineGroup(DslElementSyntax elementDsl, ComponentAst parameterized,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "originalPosition": 410}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjMxMTk0", "url": "https://github.com/mulesoft/mule/pull/9180#pullrequestreview-464231194", "createdAt": "2020-08-10T13:33:29Z", "commit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozMzoyOVrOG-Oukw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozMzoyOVrOG-Oukw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkwNjE5NQ==", "bodyText": "remove unused parameters: model, elementDsl", "url": "https://github.com/mulesoft/mule/pull/9180#discussion_r467906195", "createdAt": "2020-08-10T13:33:29Z", "author": {"login": "mlischetti"}, "path": "modules/spring-config/src/main/java/org/mule/runtime/config/internal/dsl/model/ComponentAstBasedElementModelFactory.java", "diffHunk": "@@ -528,75 +410,56 @@ private void populateParameterizedElements(ParameterizedModel model, DslElementS\n         .forEach(p -> addElementParameter(innerComponents, parameters, elementDsl, builder, p));\n   }\n \n-  private void populateComposableElements(ComposableModel model, DslElementSyntax elementDsl,\n+  private void populateConnectionProviderElements(NamedObject model, DslElementSyntax elementDsl,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "originalPosition": 351}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjMyNzY3", "url": "https://github.com/mulesoft/mule/pull/9180#pullrequestreview-464232767", "createdAt": "2020-08-10T13:35:22Z", "commit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozNToyMlrOG-OzYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozNToyMlrOG-OzYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkwNzQyNQ==", "bodyText": "remove unused parameters: model, elementDsl", "url": "https://github.com/mulesoft/mule/pull/9180#discussion_r467907425", "createdAt": "2020-08-10T13:35:22Z", "author": {"login": "mlischetti"}, "path": "modules/spring-config/src/main/java/org/mule/runtime/config/internal/dsl/model/ComponentAstBasedElementModelFactory.java", "diffHunk": "@@ -528,75 +410,56 @@ private void populateParameterizedElements(ParameterizedModel model, DslElementS\n         .forEach(p -> addElementParameter(innerComponents, parameters, elementDsl, builder, p));\n   }\n \n-  private void populateComposableElements(ComposableModel model, DslElementSyntax elementDsl,\n+  private void populateConnectionProviderElements(NamedObject model, DslElementSyntax elementDsl,\n+                                                  DslElementModel.Builder builder, ComponentAst configuration) {\n+    configuration.directChildrenStream()\n+        .filter(c -> c.getModel(ConnectionProviderModel.class).isPresent())\n+        .forEach(nestedComponentConfig -> create(nestedComponentConfig).ifPresent(builder::containing));\n+  }\n+\n+  private void populateComposableElements(NamedObject model, DslElementSyntax elementDsl,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f03504b19c0b68e63eec5ef44df9fa8ec27db72b"}, "originalPosition": 358}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e33c2c4113815fdd49aea47f3f386040371ba126", "author": {"user": {"login": "elrodro83", "name": "Rodrigo Merino"}}, "url": "https://github.com/mulesoft/mule/commit/e33c2c4113815fdd49aea47f3f386040371ba126", "committedDate": "2020-08-10T14:47:27Z", "message": "sonar + review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MzA3NzA4", "url": "https://github.com/mulesoft/mule/pull/9180#pullrequestreview-464307708", "createdAt": "2020-08-10T14:58:36Z", "commit": {"oid": "e33c2c4113815fdd49aea47f3f386040371ba126"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 506, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}