{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTU5Njg4", "number": 9531, "title": "CMTS-98: DeclarationSession is not failing when parameter values for \u2026", "bodyText": "\u2026values/metadata/sampleData have an expression", "createdAt": "2020-10-08T20:09:54Z", "url": "https://github.com/mulesoft/mule/pull/9531", "merged": true, "mergeCommit": {"oid": "77520565a63aaa66107f75f6e7922ef1a97a750c"}, "closed": true, "closedAt": "2020-10-21T16:40:36Z", "author": {"login": "gsfernandes"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQquhXgFqTUwNTI1NjMyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUv08KgFqTUxMzg3NzMxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MjU2MzIx", "url": "https://github.com/mulesoft/mule/pull/9531#pullrequestreview-505256321", "createdAt": "2020-10-09T00:06:51Z", "commit": {"oid": "e4ea9a1ad10b73de737c77676b16e93a48131741"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDowNjo1MVrOHe1AZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDowNjo1MVrOHe1AZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA4Nzc4MA==", "bodyText": "I just realized that I should first check if the parameterModel.isSupportExpression() == true before checking the String content.", "url": "https://github.com/mulesoft/mule/pull/9531#discussion_r502087780", "createdAt": "2020-10-09T00:06:51Z", "author": {"login": "gsfernandes"}, "path": "modules/tooling-support/src/main/java/org/mule/runtime/module/tooling/internal/artifact/AbstractParameterResolverExecutor.java", "diffHunk": "@@ -87,9 +93,13 @@ protected ParameterValueResolver parameterValueResolver(ParameterizedElementDecl\n         final ParameterModel parameterModel = parameterGroupModel.getParameter(parameterName)\n             .orElseThrow(() -> new MuleRuntimeException(createStaticMessage(\"Could not find parameter with name: '%s' in parameter group: '%s'\",\n                                                                             parameterName, parameterGroupName)));\n-        parametersMap.put(parameterName,\n-                          extractValue(parameterElement.getValue(),\n-                                       artifactHelper.getParameterClass(parameterModel, parameterizedElementDeclaration)));\n+        Object value = extractValue(parameterElement.getValue(),\n+                                    artifactHelper.getParameterClass(parameterModel, parameterizedElementDeclaration));\n+        if (isExpression(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4ea9a1ad10b73de737c77676b16e93a48131741"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MjU2Mzc5", "url": "https://github.com/mulesoft/mule/pull/9531#pullrequestreview-505256379", "createdAt": "2020-10-09T00:07:02Z", "commit": {"oid": "e4ea9a1ad10b73de737c77676b16e93a48131741"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDowNzowMlrOHe1AoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDowNzowMlrOHe1AoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA4Nzg0MA==", "bodyText": "Same here. I just realized that I should first check if the parameterModel.isSupportExpression() == true before checking the String content.", "url": "https://github.com/mulesoft/mule/pull/9531#discussion_r502087840", "createdAt": "2020-10-09T00:07:02Z", "author": {"login": "gsfernandes"}, "path": "modules/tooling-support/src/main/java/org/mule/runtime/module/tooling/internal/artifact/metadata/MetadataKeyDeclarationResolver.java", "diffHunk": "@@ -150,7 +152,12 @@ public MetadataKeyResult resolveKeyResult() {\n             .orElseThrow(() -> new MuleRuntimeException(createStaticMessage(\"Could not find parameter with name: %s in parameter group: %s\",\n                                                                             parameterName, parameterGroupName)));\n         if (parameterModel.getModelProperty(MetadataKeyPartModelProperty.class).isPresent()) {\n-          parametersMap.put(parameterName, extractSimpleValue(parameterElement.getValue()));\n+          String value = extractSimpleValue(parameterElement.getValue());\n+          if (isExpression(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4ea9a1ad10b73de737c77676b16e93a48131741"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4ea9a1ad10b73de737c77676b16e93a48131741", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/e4ea9a1ad10b73de737c77676b16e93a48131741", "committedDate": "2020-10-08T20:02:10Z", "message": "CMTS-98: DeclarationSession is not failing when parameter values for values/metadata/sampleData have an expression"}, "afterCommit": {"oid": "7d96b9849c61499c9a05837b1785fe6072a45c74", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/7d96b9849c61499c9a05837b1785fe6072a45c74", "committedDate": "2020-10-14T20:33:00Z", "message": "self review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3526388c596152246d89aaba5a000a03de70b6aa", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/3526388c596152246d89aaba5a000a03de70b6aa", "committedDate": "2020-10-19T17:31:57Z", "message": "CMTS-98: DeclarationSession is not failing when parameter values for values/metadata/sampleData have an expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/d808a82d7f501b375b51ecf2720f862a78b24612", "committedDate": "2020-10-19T17:31:57Z", "message": "self review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d96b9849c61499c9a05837b1785fe6072a45c74", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/7d96b9849c61499c9a05837b1785fe6072a45c74", "committedDate": "2020-10-14T20:33:00Z", "message": "self review"}, "afterCommit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612", "author": {"user": {"login": "gsfernandes", "name": "Guillermo Fernandes"}}, "url": "https://github.com/mulesoft/mule/commit/d808a82d7f501b375b51ecf2720f862a78b24612", "committedDate": "2020-10-19T17:31:57Z", "message": "self review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNDQyOTM3", "url": "https://github.com/mulesoft/mule/pull/9531#pullrequestreview-513442937", "createdAt": "2020-10-21T08:44:10Z", "commit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwODo0NDoxMFrOHlg6fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwODo0NDoyMVrOHlg7Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA5ODYyMw==", "bodyText": "Even if the parameterModel supportExpressions. Shouldn't we fail? I mean, we won't be able to process them anyways.", "url": "https://github.com/mulesoft/mule/pull/9531#discussion_r509098623", "createdAt": "2020-10-21T08:44:10Z", "author": {"login": "lucianoRM"}, "path": "modules/tooling-support/src/main/java/org/mule/runtime/module/tooling/internal/artifact/AbstractParameterResolverExecutor.java", "diffHunk": "@@ -87,9 +94,13 @@ protected ParameterValueResolver parameterValueResolver(ParameterizedElementDecl\n         final ParameterModel parameterModel = parameterGroupModel.getParameter(parameterName)\n             .orElseThrow(() -> new MuleRuntimeException(createStaticMessage(\"Could not find parameter with name: '%s' in parameter group: '%s'\",\n                                                                             parameterName, parameterGroupName)));\n-        parametersMap.put(parameterName,\n-                          extractValue(parameterElement.getValue(),\n-                                       artifactHelper.getParameterClass(parameterModel, parameterizedElementDeclaration)));\n+        Object value = extractValue(parameterElement.getValue(),\n+                                    artifactHelper.getParameterClass(parameterModel, parameterizedElementDeclaration));\n+        if (!parameterModel.getExpressionSupport().equals(NOT_SUPPORTED) && isExpression(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA5ODc2Mw==", "bodyText": "The same here", "url": "https://github.com/mulesoft/mule/pull/9531#discussion_r509098763", "createdAt": "2020-10-21T08:44:21Z", "author": {"login": "lucianoRM"}, "path": "modules/tooling-support/src/main/java/org/mule/runtime/module/tooling/internal/artifact/metadata/MetadataKeyDeclarationResolver.java", "diffHunk": "@@ -150,7 +153,12 @@ public MetadataKeyResult resolveKeyResult() {\n             .orElseThrow(() -> new MuleRuntimeException(createStaticMessage(\"Could not find parameter with name: %s in parameter group: %s\",\n                                                                             parameterName, parameterGroupName)));\n         if (parameterModel.getModelProperty(MetadataKeyPartModelProperty.class).isPresent()) {\n-          parametersMap.put(parameterName, extractSimpleValue(parameterElement.getValue()));\n+          String value = extractSimpleValue(parameterElement.getValue());\n+          if (!parameterModel.getExpressionSupport().equals(NOT_SUPPORTED) && isExpression(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzODc3MzEz", "url": "https://github.com/mulesoft/mule/pull/9531#pullrequestreview-513877313", "createdAt": "2020-10-21T16:19:05Z", "commit": {"oid": "d808a82d7f501b375b51ecf2720f862a78b24612"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1155, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}