{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNjk4OTkx", "number": 9663, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzozODo0N1rOE0e-eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0Njo1NlrOE0fLTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDY4OTIwOnYy", "diffSide": "RIGHT", "path": "modules/artifact/src/test/java/org/mule/runtime/module/artifact/builder/AbstractDependencyFileBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzozODo0N1rOHsPCbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzozODo0N1rOHsPCbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0NTc3NA==", "bodyText": "this is not a classifier", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516145774", "createdAt": "2020-11-02T17:38:47Z", "author": {"login": "elrodro83"}, "path": "modules/artifact/src/test/java/org/mule/runtime/module/artifact/builder/AbstractDependencyFileBuilder.java", "diffHunk": "@@ -210,6 +213,15 @@ public T withClassifier(String classifier) {\n     return getThis();\n   }\n \n+  /**\n+   * @param scope the maven classifier", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDY5MTM0OnYy", "diffSide": "RIGHT", "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DeployableFileBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzozOToyMFrOHsPDuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzozOToyMFrOHsPDuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0NjEwNw==", "bodyText": "what's the point of this?", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516146107", "createdAt": "2020-11-02T17:39:20Z", "author": {"login": "elrodro83"}, "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DeployableFileBuilder.java", "diffHunk": "@@ -221,10 +224,24 @@ private File getClassLoaderModelFile() {\n   private Artifact getArtifact(AbstractDependencyFileBuilder builder, boolean shared) {\n     ArtifactCoordinates artifactCoordinates =\n         new ArtifactCoordinates(builder.getGroupId(), builder.getArtifactId(), builder.getVersion(), builder.getType(),\n-                                builder.getClassifier());\n-    final Artifact artifact = new Artifact(artifactCoordinates, builder.getArtifactFile().toURI());\n+                                builder.getClassifier(), builder.getScope());\n+    URI uri;\n+    if (MULE_DOMAIN_CLASSIFIER.equals(builder.getClassifier())) {\n+      try {\n+        uri = new URI(\"\");\n+      } catch (URISyntaxException e) {\n+        throw new RuntimeException(e);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDcwMTUwOnYy", "diffSide": "RIGHT", "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DeployableFileBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0MjowMFrOHsPJ7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0MjowMFrOHsPJ7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0NzY5Mw==", "bodyText": "why not ask for the classifier directly here?", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516147693", "createdAt": "2020-11-02T17:42:00Z", "author": {"login": "elrodro83"}, "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DeployableFileBuilder.java", "diffHunk": "@@ -221,10 +224,24 @@ private File getClassLoaderModelFile() {\n   private Artifact getArtifact(AbstractDependencyFileBuilder builder, boolean shared) {\n     ArtifactCoordinates artifactCoordinates =\n         new ArtifactCoordinates(builder.getGroupId(), builder.getArtifactId(), builder.getVersion(), builder.getType(),\n-                                builder.getClassifier());\n-    final Artifact artifact = new Artifact(artifactCoordinates, builder.getArtifactFile().toURI());\n+                                builder.getClassifier(), builder.getScope());\n+    URI uri;\n+    if (MULE_DOMAIN_CLASSIFIER.equals(builder.getClassifier())) {\n+      try {\n+        uri = new URI(\"\");\n+      } catch (URISyntaxException e) {\n+        throw new RuntimeException(e);\n+      }\n+    } else {\n+      uri = builder.getArtifactFile().toURI();\n+    }\n+    final Artifact artifact = new Artifact(artifactCoordinates, uri);\n     // mule-maven-plugin (packager) will not include packages/resources for mule-plugin dependencies\n-    if (isSupportingPackagesResourcesInformation() && !MULE_PLUGIN_CLASSIFIER.equals(builder.getClassifier())) {\n+    boolean shouldAddPackagesAndResources = !MULE_PLUGIN_CLASSIFIER.equals(artifact.getArtifactCoordinates().getClassifier())\n+        && artifact.getUri() != null\n+        // mule-domain are set with a \"\" URI\n+        && isNotBlank(artifact.getUri().getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDcwNDgzOnYy", "diffSide": "RIGHT", "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DomainFileBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0Mjo0NVrOHsPL4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0Mjo0NVrOHsPL4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0ODE5NQ==", "bodyText": "Use java.util.Objects.requireNonNull(T, String) instead of guava", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516148195", "createdAt": "2020-11-02T17:42:45Z", "author": {"login": "elrodro83"}, "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DomainFileBuilder.java", "diffHunk": "@@ -76,6 +85,26 @@ public String getClassifier() {\n     return MULE_DOMAIN_CLASSIFIER;\n   }\n \n+  @Override\n+  public String getScope() {\n+    return PROVIDED_SCOPE;\n+  }\n+\n+  /**\n+   * Adds a property into the plugin properties file.\n+   *\n+   * @param propertyName name fo the property to add. Non empty\n+   * @param propertyValue value of the property to add. Non null.\n+   * @return the same builder instance\n+   */\n+  public DomainFileBuilder configuredWith(String propertyName, String propertyValue) {\n+    checkImmutable();\n+    Preconditions.checkArgument(!isEmpty(propertyName), \"Property name cannot be empty\");\n+    Preconditions.checkArgument(propertyValue != null, \"Property value cannot be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDcwODI0OnYy", "diffSide": "RIGHT", "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DomainFileBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0MzozMVrOHsPN1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0MzozMVrOHsPN1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0ODY5Mw==", "bodyText": "remove {} block (applies to code above as well)", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516148693", "createdAt": "2020-11-02T17:43:31Z", "author": {"login": "elrodro83"}, "path": "modules/deployment-model-impl/src/test/java/org/mule/runtime/module/deployment/impl/internal/builder/DomainFileBuilder.java", "diffHunk": "@@ -142,6 +175,10 @@ private File createDomainJsonDescriptorFile(Optional<Boolean> redeploymentEnable\n     exportedResources.ifPresent(resources -> {\n       muleArtifactClassLoaderDescriptorBuilder.addProperty(EXPORTED_RESOURCES, resources.split(\",\"));\n     });\n+\n+    exportedClassPackages.ifPresent(packages -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDcxMTY0OnYy", "diffSide": "RIGHT", "path": "modules/deployment/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0NDoxOVrOHsPP6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0NDoxOVrOHsPP6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0OTIyNg==", "bodyText": "mule modules should not depend on actual connectors. Options are: Use a test extension or move the test that requires this to integration", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516149226", "createdAt": "2020-11-02T17:44:19Z", "author": {"login": "elrodro83"}, "path": "modules/deployment/pom.xml", "diffHunk": "@@ -16,6 +16,8 @@\n \n     <properties>\n         <formatterConfigPath>../../formatter.xml</formatterConfigPath>\n+        <!-- Mule Connectors and Modules -->\n+        <muleJavaModuleVersion>1.3.0-SNAPSHOT</muleJavaModuleVersion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDcyMjA2OnYy", "diffSide": "RIGHT", "path": "modules/deployment/src/test/resources/classloading-troubleshooting/app-classloading-troubleshooting-config.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0Njo1NlrOHsPWOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0Njo1NlrOHsPWOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE1MDg0MQ==", "bodyText": "change this to use some custom code or DW to avoid adding the dependency to the java module", "url": "https://github.com/mulesoft/mule/pull/9663#discussion_r516150841", "createdAt": "2020-11-02T17:46:56Z", "author": {"login": "elrodro83"}, "path": "modules/deployment/src/test/resources/classloading-troubleshooting/app-classloading-troubleshooting-config.xml", "diffHunk": "@@ -0,0 +1,23 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<mule xmlns=\"http://www.mulesoft.org/schema/mule/core\"\n+      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+      xmlns:java=\"http://www.mulesoft.org/schema/mule/java\"\n+      xsi:schemaLocation=\"\n+            http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd\n+            http://www.mulesoft.org/schema/mule/java http://www.mulesoft.org/schema/mule/java/current/mule-java.xsd\">\n+\n+    <configuration-properties file=\"jms.properties\"/>\n+\n+    <object name=\"overrideMe2\" class=\"OverrideMe2\"/>\n+\n+    <flow name=\"classloading-appFlow\" >\n+        <scheduler>\n+            <scheduling-strategy >\n+                <fixed-frequency frequency=\"100\" timeUnit=\"MILLISECONDS\" />\n+            </scheduling-strategy>\n+        </scheduler>\n+        <java:new class=\"test.OverrideMe\" constructor=\"OverrideMe()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad9795db676e3358116b6ae870f1bb62a9785e5"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4663, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}