{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjE0MTUx", "number": 9403, "title": "MULE-18523: Fix Flaky ClassloadingTestCase", "bodyText": "", "createdAt": "2020-09-14T13:23:22Z", "url": "https://github.com/mulesoft/mule/pull/9403", "merged": true, "mergeCommit": {"oid": "76900cc22fa820e115190719e29d504af4d2869f"}, "closed": true, "closedAt": "2020-09-15T15:09:29Z", "author": {"login": "mlischetti"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI1ZHjAFqTQ4NzkxNTkyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJHUxvgFqTQ4ODY1MDE5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTE1OTIw", "url": "https://github.com/mulesoft/mule/pull/9403#pullrequestreview-487915920", "createdAt": "2020-09-14T15:53:30Z", "commit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTo1MzozMFrOHRbvWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNTo1ODoyOFrOHRb8sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MjMzMA==", "bodyText": "use info or debug.", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488042330", "createdAt": "2020-09-14T15:53:30Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MjQ4MA==", "bodyText": "use info or debug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488042480", "createdAt": "2020-09-14T15:53:44Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MjY2Ng==", "bodyText": "use info or debug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488042666", "createdAt": "2020-09-14T15:54:00Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MjgwNQ==", "bodyText": "use info or debug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488042805", "createdAt": "2020-09-14T15:54:11Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));\n+        deployedArtifacts.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Undeployment success: %s\", artifactName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0Mjk3Ng==", "bodyText": "use info or debug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488042976", "createdAt": "2020-09-14T15:54:27Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));\n+        deployedArtifacts.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Undeployment success: %s\", artifactName));\n+        deployedArtifacts.remove(artifactName);\n+      }\n+    });\n+\n+    LOGGER.info(\"Registering domain deployment listener ...\");\n+    deploymentService.addDomainDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Deployment success:  %s\", artifactName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MzEwOQ==", "bodyText": "info or de bug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488043109", "createdAt": "2020-09-14T15:54:36Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));\n+        deployedArtifacts.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Undeployment success: %s\", artifactName));\n+        deployedArtifacts.remove(artifactName);\n+      }\n+    });\n+\n+    LOGGER.info(\"Registering domain deployment listener ...\");\n+    deploymentService.addDomainDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Deployment success:  %s\", artifactName));\n+        deployedDomains.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Undeployment success: %s\", artifactName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0MzI1NQ==", "bodyText": "info or debug", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488043255", "createdAt": "2020-09-14T15:54:48Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));\n+        deployedArtifacts.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Undeployment success: %s\", artifactName));\n+        deployedArtifacts.remove(artifactName);\n+      }\n+    });\n+\n+    LOGGER.info(\"Registering domain deployment listener ...\");\n+    deploymentService.addDomainDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Deployment success:  %s\", artifactName));\n+        deployedDomains.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Undeployment success: %s\", artifactName));\n+        deployedDomains.remove(artifactName);\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public void stop() throws MuleException {\n+    stopServerQuietly();\n+  }\n+\n+  private void stopServerQuietly() {\n+    if (serverSocket != null) {\n+      try {\n+        LOGGER.warn(\"Stopping DeploymentServerSocket ...\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0Mzc1NA==", "bodyText": "use a warning for debugging purposes in the catch block", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488043754", "createdAt": "2020-09-14T15:55:29Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {\n+\n+  private static final Logger LOGGER = getLogger(DeploymentNotifierPlugin.class);\n+  private static String DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY = \"mule.test.deployment.server.socket.port\";\n+  private static int SERVER_PORT = parseInt(getProperty(DEPLOYMENT_SERVER_SOCKET_PORT_PROPERTY));\n+\n+  protected File directory;\n+\n+  @Inject\n+  private DeploymentService deploymentService;\n+\n+  private DeploymentServerSocket serverSocket;\n+\n+  private Set<String> deployedArtifacts = synchronizedSet(new HashSet<>());\n+\n+  private Set<String> deployedDomains = synchronizedSet(new HashSet<>());\n+\n+  @Override\n+  public void setWorkingDirectory(File directory) {\n+    this.directory = directory;\n+  }\n+\n+  @Override\n+  public boolean isDisabledOnEnvironment() {\n+    return false;\n+  }\n+\n+  @Override\n+  public void dispose() {\n+\n+  }\n+\n+  @Override\n+  public void initialise() throws InitialisationException {\n+    serverSocket = new DeploymentServerSocket(SERVER_PORT, this);\n+  }\n+\n+  @Override\n+  public void start() throws MuleException {\n+    try {\n+      LOGGER.warn(\"Starting DeploymentServerSocket...\");\n+      serverSocket.start();\n+\n+    } catch (IOException e) {\n+      stopServerQuietly();\n+      throw new RuntimeException(e);\n+    }\n+\n+    LOGGER.warn(\"Registering deployment listener ...\");\n+    deploymentService.addDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Deployment success:  %s\", artifactName));\n+        deployedArtifacts.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"Undeployment success: %s\", artifactName));\n+        deployedArtifacts.remove(artifactName);\n+      }\n+    });\n+\n+    LOGGER.info(\"Registering domain deployment listener ...\");\n+    deploymentService.addDomainDeploymentListener(new DeploymentListener() {\n+\n+      @Override\n+      public void onDeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Deployment success:  %s\", artifactName));\n+        deployedDomains.add(artifactName);\n+      }\n+\n+      @Override\n+      public void onUndeploymentSuccess(String artifactName) {\n+        LOGGER.warn(format(\"[DOMAIN] Undeployment success: %s\", artifactName));\n+        deployedDomains.remove(artifactName);\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public void stop() throws MuleException {\n+    stopServerQuietly();\n+  }\n+\n+  private void stopServerQuietly() {\n+    if (serverSocket != null) {\n+      try {\n+        LOGGER.warn(\"Stopping DeploymentServerSocket ...\");\n+        serverSocket.stop();\n+      } catch (Exception e) {\n+        // Do nothing.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NDI1Ng==", "bodyText": "java docs", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488044256", "createdAt": "2020-09-14T15:56:15Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentState.java", "diffHunk": "@@ -0,0 +1,14 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+public interface DeploymentState {\n+\n+  boolean isDeployed(String artifactName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NDM3Mg==", "bodyText": "java docs", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488044372", "createdAt": "2020-09-14T15:56:25Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentNotifierPlugin.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.Integer.parseInt;\n+import static java.lang.String.format;\n+import static java.lang.System.getProperty;\n+import static java.util.Collections.synchronizedSet;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import com.mulesoft.mule.runtime.module.plugin.api.MulePlugin;\n+import org.mule.runtime.api.exception.MuleException;\n+import org.mule.runtime.api.lifecycle.InitialisationException;\n+import org.mule.runtime.module.deployment.api.DeploymentListener;\n+import org.mule.runtime.module.deployment.api.DeploymentService;\n+import org.slf4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class DeploymentNotifierPlugin implements MulePlugin, DeploymentState {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NDg2MA==", "bodyText": "java docs. Keep info or debug in logs when information about the process is provided.", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488044860", "createdAt": "2020-09-14T15:57:09Z", "author": {"login": "fsgonz"}, "path": "tests/deployment-notifier-plugin/src/main/java/org/mule/test/plugin/DeploymentServerSocket.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.plugin;\n+\n+import static java.lang.String.format;\n+import static java.net.InetAddress.getByName;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.net.ServerSocket;\n+import java.net.Socket;\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.slf4j.Logger;\n+\n+public class DeploymentServerSocket {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0NTc0Nw==", "bodyText": "java docs", "url": "https://github.com/mulesoft/mule/pull/9403#discussion_r488045747", "createdAt": "2020-09-14T15:58:28Z", "author": {"login": "fsgonz"}, "path": "tests/infrastructure/src/main/java/org/mule/test/infrastructure/client/deployment/DeploymentClient.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.test.infrastructure.client.deployment;\n+\n+import static java.lang.Boolean.parseBoolean;\n+import static java.lang.String.format;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import org.slf4j.Logger;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.net.Socket;\n+\n+public class DeploymentClient {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74eb0d01a8b952892975af9f6a0e7cb9c5a9afa9"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDAwOTk2", "url": "https://github.com/mulesoft/mule/pull/9403#pullrequestreview-488000996", "createdAt": "2020-09-14T17:39:16Z", "commit": {"oid": "dbda9856d3e1ba0c8d38ffe372c3ad61e0f3229e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55e0b6aca62d9c028d2988c3051f1da31f911d4b", "author": {"user": {"login": "mlischetti", "name": "Mariano Lischetti"}}, "url": "https://github.com/mulesoft/mule/commit/55e0b6aca62d9c028d2988c3051f1da31f911d4b", "committedDate": "2020-09-14T22:56:44Z", "message": "MULE-18523: Fix ClassloadingTestCase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b46ab7b5ead484c424a8f5c0cba3bf5a15679fc2", "author": {"user": {"login": "mlischetti", "name": "Mariano Lischetti"}}, "url": "https://github.com/mulesoft/mule/commit/b46ab7b5ead484c424a8f5c0cba3bf5a15679fc2", "committedDate": "2020-09-14T22:57:17Z", "message": "Add deployment-notifier-plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "651ed4923aa8474e7eefb83c2309bdb4a2ab255f", "author": {"user": {"login": "mlischetti", "name": "Mariano Lischetti"}}, "url": "https://github.com/mulesoft/mule/commit/651ed4923aa8474e7eefb83c2309bdb4a2ab255f", "committedDate": "2020-09-14T22:57:20Z", "message": "review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbda9856d3e1ba0c8d38ffe372c3ad61e0f3229e", "author": {"user": {"login": "mlischetti", "name": "Mariano Lischetti"}}, "url": "https://github.com/mulesoft/mule/commit/dbda9856d3e1ba0c8d38ffe372c3ad61e0f3229e", "committedDate": "2020-09-14T17:09:06Z", "message": "review"}, "afterCommit": {"oid": "651ed4923aa8474e7eefb83c2309bdb4a2ab255f", "author": {"user": {"login": "mlischetti", "name": "Mariano Lischetti"}}, "url": "https://github.com/mulesoft/mule/commit/651ed4923aa8474e7eefb83c2309bdb4a2ab255f", "committedDate": "2020-09-14T22:57:20Z", "message": "review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NjUwMTk1", "url": "https://github.com/mulesoft/mule/pull/9403#pullrequestreview-488650195", "createdAt": "2020-09-15T12:54:35Z", "commit": {"oid": "651ed4923aa8474e7eefb83c2309bdb4a2ab255f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1192, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}