{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNjM1MzE2", "number": 8912, "title": "MULE-18454: Cannot serialize artifact declaration using the managed oAuth connection provider", "bodyText": "", "createdAt": "2020-06-10T18:46:30Z", "url": "https://github.com/mulesoft/mule/pull/8912", "merged": true, "mergeCommit": {"oid": "1e643aed012c104bace4bab1a3f286cbd44cd76c"}, "closed": true, "closedAt": "2020-06-18T15:38:35Z", "author": {"login": "SebaElizalde"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp-JxhAH2gAyNDMyNjM1MzE2OjQyZWMyZTkyYmZhODBmM2JlNTRhODk0OWI3MzQ5OTdhZTVmZjk0OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsfgHQgFqTQzMzM1NDA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "42ec2e92bfa80f3be54a8949b734997ae5ff9490", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/42ec2e92bfa80f3be54a8949b734997ae5ff9490", "committedDate": "2020-06-10T18:41:46Z", "message": "added test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mzc2NDg0", "url": "https://github.com/mulesoft/mule/pull/8912#pullrequestreview-428376484", "createdAt": "2020-06-10T19:47:57Z", "commit": {"oid": "42ec2e92bfa80f3be54a8949b734997ae5ff9490"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0Nzo1N1rOGiD6OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo1MDo0MlrOGiD_5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2ODgyNQ==", "bodyText": "Same comment as in mulesoft/mule-integration-tests#1007 regarding the way the property is set.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r438368825", "createdAt": "2020-06-10T19:47:57Z", "author": {"login": "ndinu"}, "path": "modules/extensions-spring-support/src/test/java/org/mule/runtime/module/extension/internal/resources/OCSExtensionModelJsonGeneratorTestCase.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.resources;\n+\n+import static java.lang.String.format;\n+import static java.util.Arrays.asList;\n+import static java.util.stream.Collectors.toList;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.OCS_ENABLED;\n+import static org.mule.runtime.module.extension.internal.resources.ExtensionModelJsonGeneratorTestCase.ExtensionJsonGeneratorTestUnit.newTestUnit;\n+\n+import org.mule.runtime.api.meta.model.ExtensionModel;\n+import org.mule.runtime.core.api.registry.ServiceRegistry;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricher;\n+import org.mule.runtime.extension.api.loader.ExtensionModelLoader;\n+import org.mule.runtime.module.extension.api.loader.java.DefaultJavaExtensionModelLoader;\n+import org.mule.runtime.module.extension.internal.loader.enricher.JavaXmlDeclarationEnricher;\n+import org.mule.test.oauth.TestOAuthExtension;\n+\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiFunction;\n+\n+import org.junit.AfterClass;\n+import org.junit.runners.Parameterized;\n+\n+public class OCSExtensionModelJsonGeneratorTestCase extends ExtensionModelJsonGeneratorTestCase {\n+\n+  static final Map<String, ExtensionModel> extensionModels = new HashMap<>();\n+\n+  private static ExtensionModelLoader javaLoader = new DefaultJavaExtensionModelLoader();\n+\n+  @Parameterized.Parameters(name = \"{1}\")\n+  public static Collection<Object[]> data() {\n+    System.setProperty(OCS_ENABLED, \"true\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ec2e92bfa80f3be54a8949b734997ae5ff9490"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3MDI3OQ==", "bodyText": "Avoid code duplication with parent class.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r438370279", "createdAt": "2020-06-10T19:50:42Z", "author": {"login": "ndinu"}, "path": "modules/extensions-spring-support/src/test/java/org/mule/runtime/module/extension/internal/resources/OCSExtensionModelJsonGeneratorTestCase.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.resources;\n+\n+import static java.lang.String.format;\n+import static java.util.Arrays.asList;\n+import static java.util.stream.Collectors.toList;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.OCS_ENABLED;\n+import static org.mule.runtime.module.extension.internal.resources.ExtensionModelJsonGeneratorTestCase.ExtensionJsonGeneratorTestUnit.newTestUnit;\n+\n+import org.mule.runtime.api.meta.model.ExtensionModel;\n+import org.mule.runtime.core.api.registry.ServiceRegistry;\n+import org.mule.runtime.extension.api.loader.DeclarationEnricher;\n+import org.mule.runtime.extension.api.loader.ExtensionModelLoader;\n+import org.mule.runtime.module.extension.api.loader.java.DefaultJavaExtensionModelLoader;\n+import org.mule.runtime.module.extension.internal.loader.enricher.JavaXmlDeclarationEnricher;\n+import org.mule.test.oauth.TestOAuthExtension;\n+\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.BiFunction;\n+\n+import org.junit.AfterClass;\n+import org.junit.runners.Parameterized;\n+\n+public class OCSExtensionModelJsonGeneratorTestCase extends ExtensionModelJsonGeneratorTestCase {\n+\n+  static final Map<String, ExtensionModel> extensionModels = new HashMap<>();\n+\n+  private static ExtensionModelLoader javaLoader = new DefaultJavaExtensionModelLoader();\n+\n+  @Parameterized.Parameters(name = \"{1}\")\n+  public static Collection<Object[]> data() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ec2e92bfa80f3be54a8949b734997ae5ff9490"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4b264d62b455e8bd700ff2e6a5d18ebeba61b58", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/a4b264d62b455e8bd700ff2e6a5d18ebeba61b58", "committedDate": "2020-06-12T19:55:21Z", "message": "PR changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca5942bbe6086edb961b1caf56455dbd64f3e08", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/8ca5942bbe6086edb961b1caf56455dbd64f3e08", "committedDate": "2020-06-12T21:19:51Z", "message": "ensure after() is called"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/3f3ee7ca72682122adce14d69f0bff046debd738", "committedDate": "2020-06-14T20:49:59Z", "message": "chagned jdoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDM1OTEy", "url": "https://github.com/mulesoft/mule/pull/8912#pullrequestreview-431035912", "createdAt": "2020-06-15T22:27:32Z", "commit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjoyNzozMlrOGkE2kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjozMjo0M1rOGkE91A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MTQyNg==", "bodyText": "The property needs to also be present for the deserialization test.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r440481426", "createdAt": "2020-06-15T22:27:32Z", "author": {"login": "ndinu"}, "path": "modules/extensions-spring-support/src/test/java/org/mule/runtime/module/extension/internal/resources/OCSExtensionModelJsonGeneratorTestCase.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.resources;\n+\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.OCS_ENABLED;\n+import static org.mule.runtime.module.extension.internal.resources.ExtensionModelJsonGeneratorTestCase.ExtensionJsonGeneratorTestUnit.newTestUnit;\n+\n+import org.mule.runtime.extension.api.loader.ExtensionModelLoader;\n+import org.mule.runtime.module.extension.api.loader.java.DefaultJavaExtensionModelLoader;\n+import org.mule.tck.junit4.rule.SystemProperty;\n+import org.mule.test.oauth.TestOAuthExtension;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.junit.runners.Parameterized;\n+\n+public class OCSExtensionModelJsonGeneratorTestCase extends ExtensionModelJsonGeneratorTestCase {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MTU3OQ==", "bodyText": "Use static import.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r440481579", "createdAt": "2020-06-15T22:27:59Z", "author": {"login": "ndinu"}, "path": "modules/extensions-spring-support/src/test/java/org/mule/runtime/module/extension/internal/resources/OCSExtensionModelJsonGeneratorTestCase.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.resources;\n+\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.OCS_ENABLED;\n+import static org.mule.runtime.module.extension.internal.resources.ExtensionModelJsonGeneratorTestCase.ExtensionJsonGeneratorTestUnit.newTestUnit;\n+\n+import org.mule.runtime.extension.api.loader.ExtensionModelLoader;\n+import org.mule.runtime.module.extension.api.loader.java.DefaultJavaExtensionModelLoader;\n+import org.mule.tck.junit4.rule.SystemProperty;\n+import org.mule.test.oauth.TestOAuthExtension;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.junit.runners.Parameterized;\n+\n+public class OCSExtensionModelJsonGeneratorTestCase extends ExtensionModelJsonGeneratorTestCase {\n+\n+  private static ExtensionModelLoader javaLoader = new DefaultJavaExtensionModelLoader();\n+\n+  @Parameterized.Parameters(name = \"{1}\")\n+  public static Collection<Object[]> data() {\n+    List<ExtensionJsonGeneratorTestUnit> extensions =\n+        Collections.singletonList(newTestUnit(javaLoader, TestOAuthExtension.class, \"test-oauth-ocs.json\"));\n+    try {\n+      return SystemProperty.runWithProperty(OCS_ENABLED, \"true\", () -> createExtensionModels(extensions));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MjcxMA==", "bodyText": "If you need a Callable, rename variable and rename the method.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r440482710", "createdAt": "2020-06-15T22:31:03Z", "author": {"login": "ndinu"}, "path": "tests/unit/src/main/java/org/mule/tck/junit4/rule/SystemProperty.java", "diffHunk": "@@ -6,13 +6,33 @@\n  */\n package org.mule.tck.junit4.rule;\n \n+import java.util.concurrent.Callable;\n+\n import org.junit.rules.ExternalResource;\n \n /**\n  * Sets up a system property before a test and guarantees to tear it down afterward.\n  */\n public class SystemProperty extends ExternalResource {\n \n+  /**\n+   * Utility method to execute a callable with a system property and restoring the property's original value afterwards.\n+   *\n+   * @return the return value of the callable, or null if an exception was found during its execution.\n+   */\n+  public static <V> V runWithProperty(String name, String value, Callable<V> runnable) throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MzI4NA==", "bodyText": "I would call the after method in a finally block, and throw and exception if one arises.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r440483284", "createdAt": "2020-06-15T22:32:43Z", "author": {"login": "ndinu"}, "path": "tests/unit/src/main/java/org/mule/tck/junit4/rule/SystemProperty.java", "diffHunk": "@@ -6,13 +6,33 @@\n  */\n package org.mule.tck.junit4.rule;\n \n+import java.util.concurrent.Callable;\n+\n import org.junit.rules.ExternalResource;\n \n /**\n  * Sets up a system property before a test and guarantees to tear it down afterward.\n  */\n public class SystemProperty extends ExternalResource {\n \n+  /**\n+   * Utility method to execute a callable with a system property and restoring the property's original value afterwards.\n+   *\n+   * @return the return value of the callable, or null if an exception was found during its execution.\n+   */\n+  public static <V> V runWithProperty(String name, String value, Callable<V> runnable) throws Throwable {\n+    V callableValue;\n+    SystemProperty property = new SystemProperty(name, value);\n+    property.before();\n+    try {\n+      callableValue = runnable.call();\n+    } catch (Exception e) {\n+      callableValue = null;\n+    }\n+    property.after();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDA3ODQ1", "url": "https://github.com/mulesoft/mule/pull/8912#pullrequestreview-432407845", "createdAt": "2020-06-17T13:36:19Z", "commit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzozNjoxOVrOGlGFBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzozNjoxOVrOGlGFBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1MDA4NA==", "bodyText": "Fail if this happens.", "url": "https://github.com/mulesoft/mule/pull/8912#discussion_r441550084", "createdAt": "2020-06-17T13:36:19Z", "author": {"login": "ndinu"}, "path": "modules/extensions-spring-support/src/test/java/org/mule/runtime/module/extension/internal/resources/OCSExtensionModelJsonGeneratorTestCase.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.resources;\n+\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.OCS_ENABLED;\n+import static org.mule.runtime.module.extension.internal.resources.ExtensionModelJsonGeneratorTestCase.ExtensionJsonGeneratorTestUnit.newTestUnit;\n+\n+import org.mule.runtime.extension.api.loader.ExtensionModelLoader;\n+import org.mule.runtime.module.extension.api.loader.java.DefaultJavaExtensionModelLoader;\n+import org.mule.tck.junit4.rule.SystemProperty;\n+import org.mule.test.oauth.TestOAuthExtension;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.junit.runners.Parameterized;\n+\n+public class OCSExtensionModelJsonGeneratorTestCase extends ExtensionModelJsonGeneratorTestCase {\n+\n+  private static ExtensionModelLoader javaLoader = new DefaultJavaExtensionModelLoader();\n+\n+  @Parameterized.Parameters(name = \"{1}\")\n+  public static Collection<Object[]> data() {\n+    List<ExtensionJsonGeneratorTestUnit> extensions =\n+        Collections.singletonList(newTestUnit(javaLoader, TestOAuthExtension.class, \"test-oauth-ocs.json\"));\n+    try {\n+      return SystemProperty.runWithProperty(OCS_ENABLED, \"true\", () -> createExtensionModels(extensions));\n+    } catch (Throwable throwable) {\n+      return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3ee7ca72682122adce14d69f0bff046debd738"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab34bba5410a0abca85afdda20c2ed6ec465a561", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/ab34bba5410a0abca85afdda20c2ed6ec465a561", "committedDate": "2020-06-17T14:49:00Z", "message": "pr changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2a2a009ea21d5976fa9c08b5408b243877abdf1", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/f2a2a009ea21d5976fa9c08b5408b243877abdf1", "committedDate": "2020-06-17T14:51:14Z", "message": "removed unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDk4Mjk5", "url": "https://github.com/mulesoft/mule/pull/8912#pullrequestreview-432498299", "createdAt": "2020-06-17T15:05:23Z", "commit": {"oid": "f2a2a009ea21d5976fa9c08b5408b243877abdf1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "932015f7c500617f4750049f7a0edf24546f88ac", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/932015f7c500617f4750049f7a0edf24546f88ac", "committedDate": "2020-06-17T18:42:01Z", "message": "add exception cause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "078654e537342049003686a022905d2940f0d14f", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/078654e537342049003686a022905d2940f0d14f", "committedDate": "2020-06-17T22:29:27Z", "message": "fixed test init error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8949841e5146169b329bd0e2fc86f7f299c1c713", "author": {"user": {"login": "SebaElizalde", "name": "Sebastian Elizalde"}}, "url": "https://github.com/mulesoft/mule/commit/8949841e5146169b329bd0e2fc86f7f299c1c713", "committedDate": "2020-06-17T23:22:54Z", "message": "take 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzU0MDg3", "url": "https://github.com/mulesoft/mule/pull/8912#pullrequestreview-433354087", "createdAt": "2020-06-18T14:40:53Z", "commit": {"oid": "8949841e5146169b329bd0e2fc86f7f299c1c713"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 716, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}