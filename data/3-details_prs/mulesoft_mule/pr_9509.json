{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTA1MjAz", "number": 9509, "title": "MULE-18777: Multiple reconnections of a source must not occur at the same time - Part 2", "bodyText": "", "createdAt": "2020-10-05T20:41:00Z", "url": "https://github.com/mulesoft/mule/pull/9509", "merged": true, "mergeCommit": {"oid": "e19925827c5249e9435122c5fe2ab7b4f4bca45b"}, "closed": true, "closedAt": "2020-10-08T14:35:50Z", "author": {"login": "gabrieldalborgo"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPpdQpAH2gAyNDk4MTA1MjAzOjNjY2JiMzg0YjE3ZDc5YzFjMjJhYjZjNzk0OWYxMjFkZjgxZDdiNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQifHdgFqTUwNDg0NjUyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ccbb384b17d79c1c22ab6c7949f121df81d7b73", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/3ccbb384b17d79c1c22ab6c7949f121df81d7b73", "committedDate": "2020-10-05T20:04:10Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ee937fcee1ff0b41dbeffa8ced62440775bb6c", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/c2ee937fcee1ff0b41dbeffa8ced62440775bb6c", "committedDate": "2020-10-06T15:39:13Z", "message": "Remove callback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "229edf9191c294a7a2c96decc10c4a53c030ee0a", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/229edf9191c294a7a2c96decc10c4a53c030ee0a", "committedDate": "2020-10-06T16:24:13Z", "message": "Add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMzg1MTg4", "url": "https://github.com/mulesoft/mule/pull/9509#pullrequestreview-503385188", "createdAt": "2020-10-06T21:51:09Z", "commit": {"oid": "229edf9191c294a7a2c96decc10c4a53c030ee0a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMTo1MTowOVrOHdbOJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMTo1MjowNlrOHdbPyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYxNjc0Mw==", "bodyText": "bad usage of scheduler:\n\nYou're creating a scheduler which you never dispose\nAll scheduling should be done through the scheduling service", "url": "https://github.com/mulesoft/mule/pull/9509#discussion_r500616743", "createdAt": "2020-10-06T21:51:09Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/ExtensionMessageSource.java", "diffHunk": "@@ -323,22 +313,25 @@ public void onException(ConnectionException exception) {\n                        sourceAdapter.getName(), getLocation().getRootContainerName()),\n                 exception);\n \n-    Mono<Void> reconnectionAction = sourceAdapter.getReconnectionAction(exception)\n-        .map(p -> from(retryPolicyTemplate.applyPolicy(p, retryScheduler)))\n-        .orElseGet(() -> create(sink -> {\n-          try {\n-            exception.getConnection().ifPresent(sourceConnectionManager::invalidate);\n-            restart(new ReactiveReconnectionCallback(sink));\n-          } catch (Exception e) {\n-            sink.error(e);\n-          }\n-        }));\n-\n-    reconnectionAction\n-        .doOnSuccess(v -> onReconnectionSuccessful())\n-        .doOnError(this::onReconnectionFailed)\n-        .doAfterTerminate(() -> reconnecting.set(false))\n-        .subscribe();\n+    Executors.newSingleThreadExecutor().submit(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "229edf9191c294a7a2c96decc10c4a53c030ee0a"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYxNzE2Mg==", "bodyText": "delete and use org.mule.runtime.core.internal.util.rx.ImmediateScheduler#IMMEDIATE_SCHEDULER instead", "url": "https://github.com/mulesoft/mule/pull/9509#discussion_r500617162", "createdAt": "2020-10-06T21:52:06Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/ExtensionMessageSource.java", "diffHunk": "@@ -747,4 +707,12 @@ private void stopUsingConfiguration(CoreEvent event) {\n   public String toString() {\n     return this.getClass().getSimpleName() + \": \" + Objects.toString(sourceAdapter);\n   }\n+\n+  private class ImmediateExecutor implements Executor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "229edf9191c294a7a2c96decc10c4a53c030ee0a"}, "originalPosition": 157}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4488b231f05bebf18dfc2bc5e6351c9b34a6b96", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/d4488b231f05bebf18dfc2bc5e6351c9b34a6b96", "committedDate": "2020-10-06T23:05:26Z", "message": "Requested changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzOTE2ODY0", "url": "https://github.com/mulesoft/mule/pull/9509#pullrequestreview-503916864", "createdAt": "2020-10-07T14:05:32Z", "commit": {"oid": "d4488b231f05bebf18dfc2bc5e6351c9b34a6b96"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNDowNTozMlrOHd1F5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNDowODoyMlrOHd1OOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA0MDYxNQ==", "bodyText": "you already have a retry scheduler. Why not reuse that one?", "url": "https://github.com/mulesoft/mule/pull/9509#discussion_r501040615", "createdAt": "2020-10-07T14:05:32Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/ExtensionMessageSource.java", "diffHunk": "@@ -149,6 +148,7 @@\n   private SourceAdapter sourceAdapter;\n   private RetryPolicyTemplate retryPolicyTemplate;\n   private Scheduler retryScheduler;\n+  private Scheduler reconnectScheduler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4488b231f05bebf18dfc2bc5e6351c9b34a6b96"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA0Mjc0Ng==", "bodyText": "to create and destroy the scheduler on each use is not a good way of handling the lifecycle", "url": "https://github.com/mulesoft/mule/pull/9509#discussion_r501042746", "createdAt": "2020-10-07T14:08:22Z", "author": {"login": "marianogonzalez"}, "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/source/ExtensionMessageSource.java", "diffHunk": "@@ -464,6 +468,14 @@ private void stopSchedulers() {\n         retryScheduler = null;\n       }\n     }\n+\n+    if (reconnectScheduler != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4488b231f05bebf18dfc2bc5e6351c9b34a6b96"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8f040a6dafbaa587a57877763d4578aa4aba2a", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/3d8f040a6dafbaa587a57877763d4578aa4aba2a", "committedDate": "2020-10-07T14:23:40Z", "message": "Requested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5ff234076134a3535937065df19cf3ef3f1a833", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/b5ff234076134a3535937065df19cf3ef3f1a833", "committedDate": "2020-10-07T22:00:42Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b40a864d98d53c1b3b3c9bc1250b368d3dddd477", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/b40a864d98d53c1b3b3c9bc1250b368d3dddd477", "committedDate": "2020-10-08T00:41:26Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "172ba506ee2dd25e3ef7b19d489313436b6f34a7", "author": {"user": {"login": "gabrieldalborgo", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/172ba506ee2dd25e3ef7b19d489313436b6f34a7", "committedDate": "2020-10-08T01:15:52Z", "message": "Add 2 tests around reconnection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0Nzc5NDQ5", "url": "https://github.com/mulesoft/mule/pull/9509#pullrequestreview-504779449", "createdAt": "2020-10-08T13:25:59Z", "commit": {"oid": "172ba506ee2dd25e3ef7b19d489313436b6f34a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0ODQ2MTgy", "url": "https://github.com/mulesoft/mule/pull/9509#pullrequestreview-504846182", "createdAt": "2020-10-08T14:30:28Z", "commit": {"oid": "172ba506ee2dd25e3ef7b19d489313436b6f34a7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0ODQ2NTIx", "url": "https://github.com/mulesoft/mule/pull/9509#pullrequestreview-504846521", "createdAt": "2020-10-08T14:30:47Z", "commit": {"oid": "172ba506ee2dd25e3ef7b19d489313436b6f34a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1147, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}