{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2Njc2NDY0", "number": 8935, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMTozM1rOEG21dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxOTozMlrOEHIe8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NjI1MzMyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMTozM1rOGl6YVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMTozM1rOGl6YVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwNjk5Ng==", "bodyText": "2 corrections:\n\nStatic imports\nHave this as a constant, since it won't change its value during the entire execution (reading purposes, but more importantly avoid going to check system property per each time the code is executed)", "url": "https://github.com/mulesoft/mule/pull/8935#discussion_r442406996", "createdAt": "2020-06-18T18:01:33Z", "author": {"login": "mbuchwald"}, "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "diffHunk": "@@ -285,10 +285,16 @@ private String getIdForEvent(MuleEvent event) throws Exception\n     {\n         if (useSecureHash)\n         {\n+            byte[] bytes;\n             MuleMessage message = event.getMessage();\n             Object payload = message.getPayload();\n-            byte[] payloadBytes = (byte[]) objectToByteArray.transform(payload);\n-            byte[] bytes = concat(payloadBytes, message.getUniqueId().getBytes());\n+            if(Boolean.parseBoolean(System.getProperty(\"RollBackExceptionStrategy\",\"false\")))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5624424f763da387c6ea8e1f5693506e8d34c216"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NjI1NTYwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMjoyMlrOGl6Zyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMjoyMlrOGl6Zyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwNzM3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        } else {\n          \n          \n            \n                        } \n          \n          \n            \n                        else \n          \n          \n            \n                        {\n          \n      \n    \n    \n  \n\nYeah, super bothersome but we should be consistent with the ugly use of braces in mule 3", "url": "https://github.com/mulesoft/mule/pull/8935#discussion_r442407371", "createdAt": "2020-06-18T18:02:22Z", "author": {"login": "mbuchwald"}, "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "diffHunk": "@@ -285,10 +285,16 @@ private String getIdForEvent(MuleEvent event) throws Exception\n     {\n         if (useSecureHash)\n         {\n+            byte[] bytes;\n             MuleMessage message = event.getMessage();\n             Object payload = message.getPayload();\n-            byte[] payloadBytes = (byte[]) objectToByteArray.transform(payload);\n-            byte[] bytes = concat(payloadBytes, message.getUniqueId().getBytes());\n+            if(Boolean.parseBoolean(System.getProperty(\"RollBackExceptionStrategy\",\"false\")))\n+            {\n+                byte[] payloadBytes = (byte[]) objectToByteArray.transform(payload);\n+                bytes = concat(payloadBytes, message.getUniqueId().getBytes());\n+            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5624424f763da387c6ea8e1f5693506e8d34c216"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NjI1OTI4OnYy", "diffSide": "RIGHT", "path": "tests/integration/src/test/java/org/mule/test/integration/exceptions/RollbackExceptionStrategyRedeliveryCountTestCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMzoxNVrOGl6b8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxODowMzoxNVrOGl6b8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwNzkyMA==", "bodyText": "Make sure to set this as false in a @after, because if not other test might fail depending on the order of execution.", "url": "https://github.com/mulesoft/mule/pull/8935#discussion_r442407920", "createdAt": "2020-06-18T18:03:15Z", "author": {"login": "mbuchwald"}, "path": "tests/integration/src/test/java/org/mule/test/integration/exceptions/RollbackExceptionStrategyRedeliveryCountTestCase.java", "diffHunk": "@@ -34,6 +34,7 @@ protected String getConfigFile()\n     @Test\n     public void testRollbackExceptionStrategyNumberOfRetries() throws Exception\n     {\n+        System.setProperty(\"RollBackExceptionStrategy\", \"true\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5624424f763da387c6ea8e1f5693506e8d34c216"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTE0NDMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxOToyMlrOGmWgAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxOToyMlrOGmWgAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2NzcxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean forceRedelivery;\n          \n          \n            \n                private static final boolean FORCE_REDELIVERY = getBoolean(MULE_FORCE_REDELIVERY);\n          \n      \n    \n    \n  \n\n(And change how it's used)", "url": "https://github.com/mulesoft/mule/pull/8935#discussion_r442867713", "createdAt": "2020-06-19T14:19:22Z", "author": {"login": "mbuchwald"}, "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "diffHunk": "@@ -57,6 +59,7 @@\n     private ObjectStore<AtomicInteger> store;\n     private LockFactory lockFactory;\n     private String idrId;\n+    private boolean forceRedelivery;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd74e3acf34f1ead6d039d02d20299ae9ff74054"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTE0NDgzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxOTozMlrOGmWgVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoxOTozMlrOGmWgVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2Nzc5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    forceRedelivery = getBoolean(MULE_FORCE_REDELIVERY);", "url": "https://github.com/mulesoft/mule/pull/8935#discussion_r442867798", "createdAt": "2020-06-19T14:19:32Z", "author": {"login": "mbuchwald"}, "path": "core/src/main/java/org/mule/processor/IdempotentRedeliveryPolicy.java", "diffHunk": "@@ -106,6 +109,7 @@ public void initialise() throws InitialisationException\n         String flowName = flowConstruct.getName();\n         idrId = String.format(\"%s-%s-%s\",appName,flowName,\"idr\");\n         lockFactory = muleContext.getLockFactory();\n+        forceRedelivery = getBoolean(MULE_FORCE_REDELIVERY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd74e3acf34f1ead6d039d02d20299ae9ff74054"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4949, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}