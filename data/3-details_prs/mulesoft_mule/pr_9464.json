{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMjcwOTUx", "number": 9464, "title": "MULE-18799: com.hazelcast.map.impl.PartitionContainer[] causes OOM", "bodyText": "", "createdAt": "2020-09-25T17:52:25Z", "url": "https://github.com/mulesoft/mule/pull/9464", "merged": true, "mergeCommit": {"oid": "c96898fe18d18327612efc9d5937d8f340073cf9"}, "closed": true, "closedAt": "2020-09-29T15:11:39Z", "author": {"login": "pabloperalta"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMZXsbAH2gAyNDkzMjcwOTUxOmY1ZTU4ZmQ1N2E0ODFlZWI2MWIyNmRmMmE2ZTUwMDQwMDIyYjQ3MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNplrngFqTQ5ODU4MDkzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5e58fd57a481eeb61b26df2a6e50040022b471d", "author": {"user": {"login": "pabloperalta", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/f5e58fd57a481eeb61b26df2a6e50040022b471d", "committedDate": "2020-09-25T17:37:50Z", "message": "MULE-18799: com.hazelcast.map.impl.PartitionContainer[] causes OOM\n\nOverridden the way org.w3sc.dom.Node is serialized to prevent Leaks and also improve performance. It only applies to the ExpressionSplitter so far."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822", "author": {"user": {"login": "pabloperalta", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/f412da691eccef2c3eb753a69d417ad9d8459822", "committedDate": "2020-09-25T17:50:24Z", "message": "MULE-18799: com.hazelcast.map.impl.PartitionContainer[] causes OOM\n\nRemoved some Transformer configurations that were unnecessary."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NDk1MTk5", "url": "https://github.com/mulesoft/mule/pull/9464#pullrequestreview-497495199", "createdAt": "2020-09-28T13:10:58Z", "commit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMzoxMDo1OFrOHY89aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMzoyMzoxMVrOHY9eNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkyNjYzMw==", "bodyText": "static import", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495926633", "createdAt": "2020-09-28T13:10:58Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone\n+        // this prevents the CDATA from being transformed into a text node\n+      if (Node.CDATA_SECTION_NODE == node.getNodeType()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkyODM5NQ==", "bodyText": "Remove the but \"needed but because\"", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495928395", "createdAt": "2020-09-28T13:13:35Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkyOTU1NQ==", "bodyText": "static import if possible", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495929555", "createdAt": "2020-09-28T13:15:17Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone\n+        // this prevents the CDATA from being transformed into a text node\n+      if (Node.CDATA_SECTION_NODE == node.getNodeType()) {\n+        this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + CDATA_OPEN + node.getNodeValue() + CDATA_CLOSE + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+        return this;\n+      }\n+\n+      // Create and setup transformer\n+      Transformer transformer = TransformerFactory.newInstance().newTransformer();\n+      transformer.setOutputProperty(OutputKeys.ENCODING, \"UTF-8\");\n+\n+      transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, \"yes\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkyOTYzNg==", "bodyText": "static import if possible", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495929636", "createdAt": "2020-09-28T13:15:24Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone\n+        // this prevents the CDATA from being transformed into a text node\n+      if (Node.CDATA_SECTION_NODE == node.getNodeType()) {\n+        this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + CDATA_OPEN + node.getNodeValue() + CDATA_CLOSE + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+        return this;\n+      }\n+\n+      // Create and setup transformer\n+      Transformer transformer = TransformerFactory.newInstance().newTransformer();\n+      transformer.setOutputProperty(OutputKeys.ENCODING, \"UTF-8\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkzNDE2Ng==", "bodyText": "add jdoc with reference to MULE explaining the problem and fix.", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495934166", "createdAt": "2020-09-28T13:22:00Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkzNDkxOA==", "bodyText": "use static import", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495934918", "createdAt": "2020-09-28T13:23:04Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone\n+        // this prevents the CDATA from being transformed into a text node\n+      if (Node.CDATA_SECTION_NODE == node.getNodeType()) {\n+        this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + CDATA_OPEN + node.getNodeValue() + CDATA_CLOSE + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+        return this;\n+      }\n+\n+      // Create and setup transformer\n+      Transformer transformer = TransformerFactory.newInstance().newTransformer();\n+      transformer.setOutputProperty(OutputKeys.ENCODING, \"UTF-8\");\n+\n+      transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, \"yes\");\n+\n+      // Turn the node into a string\n+      StringWriter writer = new StringWriter();\n+      transformer.transform(new DOMSource(getSerializingNode(node)), new StreamResult(writer));\n+\n+      this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + writer.toString() + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+      return this;\n+    } catch (TransformerException e) {\n+      throw new WriteAbortedException(\"Error while serializing Dom object\", e);\n+    }\n+  }\n+\n+  private Object readResolve() throws ObjectStreamException {\n+    try {\n+      DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\n+      Document parse = dBuilder.parse(new ByteArrayInputStream(this.nodeAsString.getBytes()));\n+      this.node = getDeserializingNode(parse.getFirstChild());\n+    } catch (SAXException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    } catch (IOException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    } catch (ParserConfigurationException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    }\n+\n+    return this;\n+  }\n+\n+  private Node getSerializingNode(Node node) {\n+    switch (node.getNodeType()) {\n+      case Node.ATTRIBUTE_NODE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkzNTAyOA==", "bodyText": "use static import", "url": "https://github.com/mulesoft/mule/pull/9464#discussion_r495935028", "createdAt": "2020-09-28T13:23:11Z", "author": {"login": "fsgonz"}, "path": "core/src/main/java/org/mule/serialization/internal/NodeWrapper.java", "diffHunk": "@@ -0,0 +1,312 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+\n+package org.mule.serialization.internal;\n+\n+import org.w3c.dom.Attr;\n+import org.w3c.dom.DOMException;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.w3c.dom.UserDataHandler;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.stream.XMLStreamWriter;\n+import javax.xml.transform.OutputKeys;\n+import javax.xml.transform.Transformer;\n+import javax.xml.transform.TransformerException;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.dom.DOMSource;\n+import javax.xml.transform.stream.StreamResult;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.ObjectStreamException;\n+import java.io.Serializable;\n+import java.io.StringWriter;\n+import java.io.WriteAbortedException;\n+\n+public class NodeWrapper implements Serializable, Node {\n+  public static final String NODE_WRAPPER_ENVELOPE_OPEN_TAG = \"<node-wrapper-envelope>\";\n+  public static final String NODE_WRAPPER_ENVELOPE_CLOSE_TAG = \"</node-wrapper-envelope>\";\n+  public static final String CDATA_OPEN = \"<![CDATA[\";\n+  public static final String CDATA_CLOSE = \"]]>\";\n+  private final short nodeType;\n+  private final String nodeName;\n+  private transient Node node;\n+  private String nodeAsString;\n+\n+  public NodeWrapper(Node node) {\n+    this.node = node;\n+    this.nodeType = node.getNodeType();\n+    this.nodeName = node.getNodeName();\n+  }\n+\n+  private Object writeReplace() throws ObjectStreamException {\n+\n+    try {\n+        // In tests this if is not needed but because the Transformer Implementation changes in the actual standalone\n+        // this prevents the CDATA from being transformed into a text node\n+      if (Node.CDATA_SECTION_NODE == node.getNodeType()) {\n+        this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + CDATA_OPEN + node.getNodeValue() + CDATA_CLOSE + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+        return this;\n+      }\n+\n+      // Create and setup transformer\n+      Transformer transformer = TransformerFactory.newInstance().newTransformer();\n+      transformer.setOutputProperty(OutputKeys.ENCODING, \"UTF-8\");\n+\n+      transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, \"yes\");\n+\n+      // Turn the node into a string\n+      StringWriter writer = new StringWriter();\n+      transformer.transform(new DOMSource(getSerializingNode(node)), new StreamResult(writer));\n+\n+      this.nodeAsString = NODE_WRAPPER_ENVELOPE_OPEN_TAG + writer.toString() + NODE_WRAPPER_ENVELOPE_CLOSE_TAG;\n+      return this;\n+    } catch (TransformerException e) {\n+      throw new WriteAbortedException(\"Error while serializing Dom object\", e);\n+    }\n+  }\n+\n+  private Object readResolve() throws ObjectStreamException {\n+    try {\n+      DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\n+      Document parse = dBuilder.parse(new ByteArrayInputStream(this.nodeAsString.getBytes()));\n+      this.node = getDeserializingNode(parse.getFirstChild());\n+    } catch (SAXException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    } catch (IOException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    } catch (ParserConfigurationException e) {\n+      throw new WriteAbortedException(\"Error while deserializing Dom object\", e);\n+    }\n+\n+    return this;\n+  }\n+\n+  private Node getSerializingNode(Node node) {\n+    switch (node.getNodeType()) {\n+      case Node.ATTRIBUTE_NODE:\n+        return ((Attr) this.node).getOwnerElement();\n+      default:\n+        return this.node;\n+    }\n+  }\n+\n+  private Node getDeserializingNode(Node node) {\n+    switch (nodeType) {\n+      case Node.ATTRIBUTE_NODE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f412da691eccef2c3eb753a69d417ad9d8459822"}, "originalPosition": 112}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d22fbb53f403bf543718e1bde428b30e9fbdfd40", "author": {"user": {"login": "pabloperalta", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/d22fbb53f403bf543718e1bde428b30e9fbdfd40", "committedDate": "2020-09-28T17:51:39Z", "message": "MULE-18799: com.hazelcast.map.impl.PartitionContainer[] causes OOM\n\nAdded some static imports.\nAdded a Jdoc for NodeWrapper.\nAdded a test for Processing instruction (required no change in productive code)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5935db9d56b6d58ca6bca7fe87d600474e7cd022", "author": {"user": {"login": "pabloperalta", "name": null}}, "url": "https://github.com/mulesoft/mule/commit/5935db9d56b6d58ca6bca7fe87d600474e7cd022", "committedDate": "2020-09-28T18:01:16Z", "message": "MULE-18799: com.hazelcast.map.impl.PartitionContainer[] causes OOM\n\nModified comment in writeReplace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTgwOTMy", "url": "https://github.com/mulesoft/mule/pull/9464#pullrequestreview-498580932", "createdAt": "2020-09-29T15:05:31Z", "commit": {"oid": "5935db9d56b6d58ca6bca7fe87d600474e7cd022"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1235, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}