{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODY3MjA5", "number": 12055, "title": "(CDAP-16369) Remote Execution Runtime Redesign", "bodyText": "Changes are organized by commits. The biggest change is in the commit \"Change job launching and monitoring mechanism\".\nIn summary this change the the runtime launching and monitoring for non-native profile program execution.\nJob launch can be done in two ways.\n\nSSH\nRuntimeJobManager\n\nThe job launching mechanism is controlled by provisioner implementation.\nJob monitoring and metadata collection are always posted from the remote runtime to the CDAP runtime server. There are two ways that the remote runtime can communicate with CDAP.\n\nThrough SSH tunnel from CDAP and socks5 proxy that runs in the remote runtime process\nA direct URL exposed by CDAP with authentication support\n\nThe job monitoring mechanism is controlled by cdap-site configuration and can be overridden through runtime arguments\nThe job launching and job monitoring mechanism can be mix-and-match.", "createdAt": "2020-04-13T22:14:44Z", "url": "https://github.com/cdapio/cdap/pull/12055", "merged": true, "mergeCommit": {"oid": "4d7beecb2bb36c08ccfc9d0f3819cf8061d0c579"}, "closed": true, "closedAt": "2020-04-14T22:14:54Z", "author": {"login": "chtyim"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXWdfmABqjMyMjg3NTkyNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXq1QBgBqjMyMzMwNjY2MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d1e7d097f029f59d1ec3461e1fe18fcc5a21259", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/4d1e7d097f029f59d1ec3461e1fe18fcc5a21259", "committedDate": "2020-04-13T21:59:50Z", "message": "Make sure provisioning service is running before using it"}, "afterCommit": {"oid": "28ca09c08b8e676663c4076a1b24214bea0ecf09", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/28ca09c08b8e676663c4076a1b24214bea0ecf09", "committedDate": "2020-04-13T22:16:18Z", "message": "Make sure provisioning service is running before using it"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28ca09c08b8e676663c4076a1b24214bea0ecf09", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/28ca09c08b8e676663c4076a1b24214bea0ecf09", "committedDate": "2020-04-13T22:16:18Z", "message": "Make sure provisioning service is running before using it"}, "afterCommit": {"oid": "bcfaf0858581cb333d3b0bd114125d4436d014f8", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/bcfaf0858581cb333d3b0bd114125d4436d014f8", "committedDate": "2020-04-13T22:18:16Z", "message": "Make sure provisioning service is running before using it"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcfaf0858581cb333d3b0bd114125d4436d014f8", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/bcfaf0858581cb333d3b0bd114125d4436d014f8", "committedDate": "2020-04-13T22:18:16Z", "message": "Make sure provisioning service is running before using it"}, "afterCommit": {"oid": "94071282230bcf10fbf71f4e90b07e57c39cbe7a", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/94071282230bcf10fbf71f4e90b07e57c39cbe7a", "committedDate": "2020-04-13T22:40:39Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94071282230bcf10fbf71f4e90b07e57c39cbe7a", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/94071282230bcf10fbf71f4e90b07e57c39cbe7a", "committedDate": "2020-04-13T22:40:39Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}, "afterCommit": {"oid": "d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "committedDate": "2020-04-13T22:54:42Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "committedDate": "2020-04-13T22:54:42Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}, "afterCommit": {"oid": "314d1315a593ae5c5c011e6db13d26713f1f7a51", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/314d1315a593ae5c5c011e6db13d26713f1f7a51", "committedDate": "2020-04-13T22:55:14Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "314d1315a593ae5c5c011e6db13d26713f1f7a51", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/314d1315a593ae5c5c011e6db13d26713f1f7a51", "committedDate": "2020-04-13T22:55:14Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}, "afterCommit": {"oid": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "committedDate": "2020-04-13T22:56:03Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjExMzY2", "url": "https://github.com/cdapio/cdap/pull/12055#pullrequestreview-392611366", "createdAt": "2020-04-14T05:25:31Z", "commit": {"oid": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNToyNTozMVrOGE-sTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNTozMjo1M1rOGE-1Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NDYzOA==", "bodyText": "should we call this start?", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r407874638", "createdAt": "2020-04-14T05:25:31Z", "author": {"login": "CuriousVini"}, "path": "cdap-runtime-spi/src/main/java/io/cdap/cdap/runtime/spi/runtimejob/RuntimeJob.java", "diffHunk": "@@ -28,4 +28,9 @@\n    * @throws Exception thrown if any error while job execution\n    */\n   void run(RuntimeJobEnvironment runtimeJobEnvironment) throws Exception;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NjkyMw==", "bodyText": "could you please file a jira to move it to a separate extension and add it as todo here?", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r407876923", "createdAt": "2020-04-14T05:32:53Z", "author": {"login": "CuriousVini"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/monitor/GceRemoteAuthenticator.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.runtime.monitor;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import io.cdap.cdap.common.internal.remote.RemoteAuthenticator;\n+import io.cdap.common.http.HttpRequest;\n+import io.cdap.common.http.HttpRequests;\n+import io.cdap.common.http.HttpResponse;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.concurrent.TimeUnit;\n+\n+/**\n+ * A {@link RemoteAuthenticator} that authenticate remote calls using Google Cloud token acquired from GCE metadata.\n+ */\n+@SuppressWarnings(\"unused\")\n+public class GceRemoteAuthenticator extends RemoteAuthenticator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "631346a191b0296a7d0fac43ef21a35e28a0f07b", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/631346a191b0296a7d0fac43ef21a35e28a0f07b", "committedDate": "2020-04-14T20:01:03Z", "message": "(CDAP-16369) Persist all system arguments during program start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30537f1ba9aae9219c930c849b5ef31a8d24a925", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/30537f1ba9aae9219c930c849b5ef31a8d24a925", "committedDate": "2020-04-14T20:01:04Z", "message": "(CDAP-16369) Added a cursor based scan active run records to AppMetadataStore\n\n- This allows scanning active run records efficiently across all namespaces\n  without holding up large amount of memory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58117d74b9a879eb5643d6847ba159467d01c72c", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/58117d74b9a879eb5643d6847ba159467d01c72c", "committedDate": "2020-04-14T19:13:40Z", "message": "Change runtime server to bind to random port by default"}, "afterCommit": {"oid": "8d311baac8b2d326e7098cdc566773d09c6d0feb", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/8d311baac8b2d326e7098cdc566773d09c6d0feb", "committedDate": "2020-04-14T21:45:52Z", "message": "address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzIxNjA2", "url": "https://github.com/cdapio/cdap/pull/12055#pullrequestreview-393321606", "createdAt": "2020-04-14T21:51:00Z", "commit": {"oid": "8d311baac8b2d326e7098cdc566773d09c6d0feb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca3b26509e1dee0f2f5d1c98d62d00cef4da5556", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/ca3b26509e1dee0f2f5d1c98d62d00cef4da5556", "committedDate": "2020-04-14T21:58:36Z", "message": "(CDAP-16369) Added getUserArgs() method to RunRecodDetail\n\n- Unified calls for getting runtime arguments from RunRecordDetail\n- Also fixed deserialization usage of RunRecordDetail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4e1668c1942d00cfe842801ed53c15d6595ad06", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/a4e1668c1942d00cfe842801ed53c15d6595ad06", "committedDate": "2020-04-14T21:58:36Z", "message": "(CDAP-16369) Move TrafficRelayServer and ProxySelector out from RuntimeMonitorServer\n\n- This is for preparing the removal of RuntimeMonitorServer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38f0487cb334ae996d64555de565c549f68369af", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/38f0487cb334ae996d64555de565c549f68369af", "committedDate": "2020-04-14T21:58:36Z", "message": "(CDAP-16369) Improve Dataproc job manager stop() implementation\n\n- Instead of always issuing stop, check the job status first"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzI2Mzcy", "url": "https://github.com/cdapio/cdap/pull/12055#pullrequestreview-393326372", "createdAt": "2020-04-14T22:00:01Z", "commit": {"oid": "829ac0017fe72f950919bdff7bfe80559a9a9b2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc4ece49a295409671f0d9f077ba24fb861e2d0e", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/fc4ece49a295409671f0d9f077ba24fb861e2d0e", "committedDate": "2020-04-14T22:00:16Z", "message": "(CDAP-16369) Change job launching and monitoring mechanism\n\n- Remote runtime actively talking to CDAP\n- Supports either SSH tunnel or CDAP exposes URL\n- Unified SSH and RuntimeJob launch code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "482684a10e9c51560f0f7221c3a9be37573b8864", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/482684a10e9c51560f0f7221c3a9be37573b8864", "committedDate": "2020-04-14T22:00:16Z", "message": "(CDAP-16369) Change the RuntimeJobManager interface\n\n- Remove init and destroy, extends from Closeable to make it easier to use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa6a82fa1d654c35574d91bd7409c434be603cf8", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/fa6a82fa1d654c35574d91bd7409c434be603cf8", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Provisioner config and runtime argument to control monitor type\n\n- Based on CDAP config for each provisioner\n- Overridable by runtime arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e04c5149b1b036a7b6fdbc384eb383f9a9741cb", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/9e04c5149b1b036a7b6fdbc384eb383f9a9741cb", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Fixied a ByteBuf leak in runtime server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51466d79e1d81ca4035d043626660c472eeeb440", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/51466d79e1d81ca4035d043626660c472eeeb440", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Improve progress logs in runtime client service\n\n- Progress log per topic and log total number of messages being processed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19805f9864f6ca1b4d77f77640f6c451a3ab22b", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/f19805f9864f6ca1b4d77f77640f6c451a3ab22b", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Delete unused class\n\n- Monitoring proxy classes are not needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "680708a7035b4143de032add9f8d3ad73d7cf71e", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/680708a7035b4143de032add9f8d3ad73d7cf71e", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "829ac0017fe72f950919bdff7bfe80559a9a9b2e", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/829ac0017fe72f950919bdff7bfe80559a9a9b2e", "committedDate": "2020-04-14T21:53:48Z", "message": "Rename stop to requestStop"}, "afterCommit": {"oid": "680708a7035b4143de032add9f8d3ad73d7cf71e", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/680708a7035b4143de032add9f8d3ad73d7cf71e", "committedDate": "2020-04-14T22:00:17Z", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2154, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}