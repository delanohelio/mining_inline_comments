{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NjI4NDY3", "number": 12735, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMTozNjoxOVrOEd7TIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNjozNToxNVrOEe_XAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5ODE1NzEyOnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/PreviewRunnerModule.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMTozNjoxOVrOHJX73A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoyMjoyMFrOHLG2ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5MTM4OA==", "bodyText": "2016-2020?", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r479591388", "createdAt": "2020-08-29T01:36:19Z", "author": {"login": "sagarkapare"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/PreviewRunnerModule.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright \u00a9 2020 Cask Data, Inc.\n+ * Copyright \u00a9 2016-2019 Cask Data, Inc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e6b9d84ae765cc25489aae14312103867fe37ef"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwODYxMw==", "bodyText": "fixed", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481408613", "createdAt": "2020-09-01T20:22:20Z", "author": {"login": "chtyim"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/PreviewRunnerModule.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright \u00a9 2020 Cask Data, Inc.\n+ * Copyright \u00a9 2016-2019 Cask Data, Inc.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5MTM4OA=="}, "originalCommit": {"oid": "6e6b9d84ae765cc25489aae14312103867fe37ef"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTI4NTIzOnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/PreviewRunnerTwillApplication.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNjoyODozNlrOHK-3mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoyMTozMlrOHLG0wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI3Nzg1MQ==", "bodyText": "Should the application name be \"PreviewRunner\"?", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481277851", "createdAt": "2020-09-01T16:28:36Z", "author": {"login": "sagarkapare"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/PreviewRunnerTwillApplication.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.preview;\n+\n+import io.cdap.cdap.common.conf.Constants;\n+import org.apache.twill.api.ResourceSpecification;\n+import org.apache.twill.api.TwillApplication;\n+import org.apache.twill.api.TwillSpecification;\n+\n+import java.net.URI;\n+\n+/**\n+ * The {@link TwillApplication} for launch preview runner.\n+ */\n+public class PreviewRunnerTwillApplication implements TwillApplication {\n+\n+  private final URI cConfFileURI;\n+  private final URI hConfFileURI;\n+  private final ResourceSpecification resourceSpec;\n+\n+  public PreviewRunnerTwillApplication(URI cConfFileURI, URI hConfFileURI, ResourceSpecification resourceSpec) {\n+    this.cConfFileURI = cConfFileURI;\n+    this.hConfFileURI = hConfFileURI;\n+    this.resourceSpec = resourceSpec;\n+  }\n+\n+  @Override\n+  public TwillSpecification configure() {\n+    return TwillSpecification.Builder.with()\n+      .setName(Constants.Service.PREVIEW_HTTP)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwODE5Mw==", "bodyText": "changed to preview.runner", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481408193", "createdAt": "2020-09-01T20:21:32Z", "author": {"login": "chtyim"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/PreviewRunnerTwillApplication.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.preview;\n+\n+import io.cdap.cdap.common.conf.Constants;\n+import org.apache.twill.api.ResourceSpecification;\n+import org.apache.twill.api.TwillApplication;\n+import org.apache.twill.api.TwillSpecification;\n+\n+import java.net.URI;\n+\n+/**\n+ * The {@link TwillApplication} for launch preview runner.\n+ */\n+public class PreviewRunnerTwillApplication implements TwillApplication {\n+\n+  private final URI cConfFileURI;\n+  private final URI hConfFileURI;\n+  private final ResourceSpecification resourceSpec;\n+\n+  public PreviewRunnerTwillApplication(URI cConfFileURI, URI hConfFileURI, ResourceSpecification resourceSpec) {\n+    this.cConfFileURI = cConfFileURI;\n+    this.hConfFileURI = hConfFileURI;\n+    this.resourceSpec = resourceSpec;\n+  }\n+\n+  @Override\n+  public TwillSpecification configure() {\n+    return TwillSpecification.Builder.with()\n+      .setName(Constants.Service.PREVIEW_HTTP)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI3Nzg1MQ=="}, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTMwNDkyOnYy", "diffSide": "RIGHT", "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillContext.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNjozNDoyM1rOHK_Efg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzoxMTozMVrOHLAa-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4MTE1MA==", "bodyText": "Can UID be null?", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481281150", "createdAt": "2020-09-01T16:34:23Z", "author": {"login": "sagarkapare"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillContext.java", "diffHunk": "@@ -190,6 +197,12 @@ public void close() {\n     }\n   }\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMwMzI5MA==", "bodyText": "It's inherited from the interface, as from the interface definition perspective, it can be.", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481303290", "createdAt": "2020-09-01T17:11:31Z", "author": {"login": "chtyim"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillContext.java", "diffHunk": "@@ -190,6 +197,12 @@ public void close() {\n     }\n   }\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4MTE1MA=="}, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTMwODE4OnYy", "diffSide": "RIGHT", "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNjozNToxNVrOHK_GjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoyMToyM1rOHLG0YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4MTY3Nw==", "bodyText": "This comment is no longer valid now right?", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481281677", "createdAt": "2020-09-01T16:35:15Z", "author": {"login": "sagarkapare"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillController.java", "diffHunk": "@@ -145,6 +146,31 @@ public ResourceReport getResourceReport() {\n     return doRestartInstances(runnable, instanceIds);\n   }\n \n+  @Override\n+  public Future<String> restartInstance(String runnable, int instanceId, String uid) {\n+    CompletableFuture<String> resultFuture = new CompletableFuture<>();\n+    CoreV1Api api = new CoreV1Api(apiClient);\n+\n+    // Only support for stateful set for now\n+    if (!V1StatefulSet.class.equals(resourceType)) {\n+      resultFuture.completeExceptionally(\n+        new UnsupportedOperationException(\"Instance restart by instance id is only supported for statefulsets\"));\n+      return resultFuture;\n+    }\n+\n+    // pod uid is passed as \"runnable\" parameter to the method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwODA5Ng==", "bodyText": "removed", "url": "https://github.com/cdapio/cdap/pull/12735#discussion_r481408096", "createdAt": "2020-09-01T20:21:23Z", "author": {"login": "chtyim"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillController.java", "diffHunk": "@@ -145,6 +146,31 @@ public ResourceReport getResourceReport() {\n     return doRestartInstances(runnable, instanceIds);\n   }\n \n+  @Override\n+  public Future<String> restartInstance(String runnable, int instanceId, String uid) {\n+    CompletableFuture<String> resultFuture = new CompletableFuture<>();\n+    CoreV1Api api = new CoreV1Api(apiClient);\n+\n+    // Only support for stateful set for now\n+    if (!V1StatefulSet.class.equals(resourceType)) {\n+      resultFuture.completeExceptionally(\n+        new UnsupportedOperationException(\"Instance restart by instance id is only supported for statefulsets\"));\n+      return resultFuture;\n+    }\n+\n+    // pod uid is passed as \"runnable\" parameter to the method.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4MTY3Nw=="}, "originalCommit": {"oid": "bacdac5a7b749481bfc4023dd5248861bb590114"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3137, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}