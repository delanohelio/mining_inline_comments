{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1Mzc4MjYx", "number": 12485, "title": "Cherry picks of Log Viewer changes for release/6.1", "bodyText": "Cherry-picks for Log Viewer changes\nJIRA: https://issues.cask.co/browse/CDAP-16980\nBuild: https://builds.cask.co/browse/CDAP-URUT289", "createdAt": "2020-07-22T22:04:16Z", "url": "https://github.com/cdapio/cdap/pull/12485", "merged": true, "mergeCommit": {"oid": "5528605c9a0f39ca5a08d6a5d73f1011f3b342b8"}, "closed": true, "closedAt": "2020-07-23T19:38:18Z", "author": {"login": "elfenheart"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3whTQAFqTQ1NDIwMzU4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3xxutgBqjM1ODA3MTQ2MzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjAzNTg1", "url": "https://github.com/cdapio/cdap/pull/12485#pullrequestreview-454203585", "createdAt": "2020-07-23T14:43:43Z", "commit": {"oid": "9ca8d115d8b7e67c77dd8f451c5724bb39704ae4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDo0Mzo0M1rOG2N3og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDo0Mzo0M1rOG2N3og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUwMzUyMg==", "bodyText": "Should this be !isPolling?", "url": "https://github.com/cdapio/cdap/pull/12485#discussion_r459503522", "createdAt": "2020-07-23T14:43:43Z", "author": {"login": "yukiej"}, "path": "cdap-ui/app/cdap/components/LogViewer/TopPanel.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import * as React from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import DataFetcher from 'components/LogViewer/DataFetcher';\n+import Button from '@material-ui/core/Button';\n+import FormControlLabel from '@material-ui/core/FormControlLabel';\n+import Checkbox from '@material-ui/core/Checkbox';\n+import classnames from 'classnames';\n+\n+export const TOP_PANEL_HEIGHT = '50px';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    root: {\n+      backgroundColor: theme.palette.grey[100],\n+      color: theme.palette.white[50],\n+      display: 'flex',\n+      justifyContent: 'flex-end',\n+      alignItems: 'center',\n+      height: TOP_PANEL_HEIGHT,\n+      paddingLeft: '20px',\n+      paddingRight: '20px',\n+      position: 'relative',\n+    },\n+    actionButton: {\n+      margin: theme.spacing(1),\n+\n+      '&:hover': {\n+        color: theme.palette.white[50],\n+        borderColor: theme.palette.white[50],\n+        backgroundColor: theme.palette.grey[200],\n+      },\n+\n+      '&$disabled': {\n+        // needed to beat specificity\n+        color: theme.palette.grey[50],\n+        cursor: 'not-allowed',\n+        backgroundColor: theme.palette.white[50],\n+      },\n+    },\n+    disabled: {},\n+    checkboxContainer: {\n+      margin: '0 40px',\n+      userSelect: 'none',\n+    },\n+    checkbox: {\n+      color: theme.palette.white[50],\n+    },\n+  };\n+};\n+\n+interface ITopPanelProps extends WithStyles<typeof styles> {\n+  dataFetcher: DataFetcher;\n+  isPolling: boolean;\n+  getLatestLogs: () => void;\n+  setSystemLogs: (includeSystemLogs: boolean) => void;\n+}\n+\n+const TopPanelView: React.FC<ITopPanelProps> = ({\n+  classes,\n+  dataFetcher,\n+  isPolling,\n+  getLatestLogs,\n+  setSystemLogs,\n+}) => {\n+  const [includeSystemLogs, setLocalIncludeSystemLogs] = React.useState(\n+    dataFetcher.getIncludeSystemLogs()\n+  );\n+\n+  function getRawLogsBasePath() {\n+    const backendUrl = dataFetcher.getRawLogsUrl();\n+    const encodedBackendUrl = encodeURIComponent(backendUrl);\n+\n+    const url = `/downloadLogs?backendPath=${encodedBackendUrl}`;\n+    return url;\n+  }\n+\n+  function getRawLogsUrl() {\n+    return `${getRawLogsBasePath()}&type=raw`;\n+  }\n+\n+  function getDownloadLogsUrl() {\n+    const fileName = dataFetcher.getDownloadFileName();\n+    return `${getRawLogsBasePath()}&type=download&filename=${fileName}.log`;\n+  }\n+\n+  function handleToggleSystemLogs() {\n+    const newState = !includeSystemLogs;\n+    setLocalIncludeSystemLogs(newState);\n+    setSystemLogs(newState);\n+  }\n+\n+  return (\n+    <div className={classes.root}>\n+      <FormControlLabel\n+        control={\n+          <Checkbox\n+            checked={includeSystemLogs}\n+            onChange={handleToggleSystemLogs}\n+            color=\"default\"\n+            className={classes.checkbox}\n+          />\n+        }\n+        label=\"Include System Logs\"\n+        className={classes.checkboxContainer}\n+      />\n+\n+      <Button\n+        variant=\"outlined\"\n+        color=\"inherit\"\n+        className={classnames(classes.actionButton, { [classes.disabled]: isPolling })}\n+        disabled={isPolling}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca8d115d8b7e67c77dd8f451c5724bb39704ae4"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjA2ODc0", "url": "https://github.com/cdapio/cdap/pull/12485#pullrequestreview-454206874", "createdAt": "2020-07-23T14:45:17Z", "commit": {"oid": "9ca8d115d8b7e67c77dd8f451c5724bb39704ae4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "796e6ba407cb323536ee2f3c57cc79770f6d7e09", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/796e6ba407cb323536ee2f3c57cc79770f6d7e09", "committedDate": "2020-07-23T16:10:29Z", "message": "[CDAP-16981] LogViewer add Data Fetcher layer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "574c9641fb21ce2fd835830a146f093b51f009fa", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/574c9641fb21ce2fd835830a146f093b51f009fa", "committedDate": "2020-07-23T16:10:29Z", "message": "[CDAP-16980] Add LogViewer Renderer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb83109148c78783b154cd6f0d85ba52745a2ed1", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/eb83109148c78783b154cd6f0d85ba52745a2ed1", "committedDate": "2020-07-23T16:10:30Z", "message": "[CDAP-17025] Add new LogViewer to pipeline detail page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d1a2fc891b364d6afd547a33b0ac8163b30d40f", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/8d1a2fc891b364d6afd547a33b0ac8163b30d40f", "committedDate": "2020-07-23T16:11:17Z", "message": "[CDAP-17026] Add new LogViewer to Pipeline Preview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81d7eb51ca801bb80a293a35f60201cc8abcb765", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/81d7eb51ca801bb80a293a35f60201cc8abcb765", "committedDate": "2020-07-23T16:11:21Z", "message": "[CDAP-17075] Add single page Log Viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "975e20a80f328e45bfa5e966bc0e912e0bad687a", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/975e20a80f328e45bfa5e966bc0e912e0bad687a", "committedDate": "2020-07-23T16:11:21Z", "message": "Remove old log viewer components"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "committedDate": "2020-07-23T16:11:22Z", "message": "fix log viewer discrepancy for cherry-picks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ca8d115d8b7e67c77dd8f451c5724bb39704ae4", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/9ca8d115d8b7e67c77dd8f451c5724bb39704ae4", "committedDate": "2020-07-22T22:01:52Z", "message": "fix log viewer discrepancy for cherry-picks"}, "afterCommit": {"oid": "61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "committedDate": "2020-07-23T16:11:22Z", "message": "fix log viewer discrepancy for cherry-picks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1847, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}