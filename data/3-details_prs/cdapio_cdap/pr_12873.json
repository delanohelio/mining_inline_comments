{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5ODQyNzMy", "number": 12873, "title": "[CDAP-17409] Replication throughput graph", "bodyText": "JIRA: https://cdap.atlassian.net/browse/CDAP-17409\nBuild: https://builds.cask.co/browse/CDAP-UDUT886", "createdAt": "2020-11-30T22:14:35Z", "url": "https://github.com/cdapio/cdap/pull/12873", "merged": true, "mergeCommit": {"oid": "3fd2cf5058b64e97434e2745ec5791ef0c9a4347"}, "closed": true, "closedAt": "2020-12-09T06:20:12Z", "author": {"login": "elfenheart"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhvPc0gFqTU0MTQxMTg3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkSr_bgBqjQwODcyMTI3OTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDExODc0", "url": "https://github.com/cdapio/cdap/pull/12873#pullrequestreview-541411874", "createdAt": "2020-12-01T00:59:08Z", "commit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDo1OTowOVrOH8T7sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDo1OTowOVrOH8T7sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMzE4Ng==", "bodyText": "Do you think we'll use this pattern for rendering D3 graphs? Should we make some kind of higher-order component to handle the common features like resizing?", "url": "https://github.com/cdapio/cdap/pull/12873#discussion_r533003186", "createdAt": "2020-12-01T00:59:09Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/cdap/components/Replicator/Detail/ThroughputGraph/index.tsx", "diffHunk": "@@ -0,0 +1,156 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useState, useEffect, useContext } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { MyMetricApi } from 'api/metric';\n+import {\n+  COLOR_MAP,\n+  IThroughputData,\n+  renderThroughputGraph,\n+} from 'components/Replicator/Detail/ThroughputGraph/throughput';\n+import { getCurrentNamespace } from 'services/NamespaceStore';\n+import MetricsQueryHelper from 'services/MetricsQueryHelper';\n+import { PROGRAM_INFO } from 'components/Replicator/constants';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import { throughputParser } from 'components/Replicator/Detail/ThroughputGraph/parser';\n+import { Observable } from 'rxjs/Observable';\n+import Heading, { HeadingTypes } from 'components/Heading';\n+\n+const styles = (): StyleRules => {\n+  return {\n+    root: {\n+      position: 'relative',\n+    },\n+    heading: {\n+      textAlign: 'center',\n+    },\n+    square: {\n+      display: 'inline-block',\n+      height: '15px',\n+      width: '15px',\n+      marginRight: '7px',\n+    },\n+    inserts: {\n+      backgroundColor: COLOR_MAP.inserts,\n+    },\n+    updates: {\n+      backgroundColor: COLOR_MAP.updates,\n+    },\n+    deletes: {\n+      backgroundColor: COLOR_MAP.deletes,\n+    },\n+    bottomLegend: {\n+      marginTop: '25px',\n+      padding: '0 15px',\n+      display: 'flex',\n+\n+      '& > div': {\n+        marginRight: '15px',\n+      },\n+    },\n+  };\n+};\n+\n+const CONTAINER_ID = 'replication-throughput-graph';\n+\n+const ThroughputGraphView: React.FC<WithStyles<typeof styles>> = ({ classes }) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDE2Njgx", "url": "https://github.com/cdapio/cdap/pull/12873#pullrequestreview-541416681", "createdAt": "2020-12-01T01:12:13Z", "commit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMjoxM1rOH8UM9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMjoxM1rOH8UM9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNzYwNQ==", "bodyText": "Would it be better to show this as 0 or as a break in the graph?", "url": "https://github.com/cdapio/cdap/pull/12873#discussion_r533007605", "createdAt": "2020-12-01T01:12:13Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/cdap/components/Replicator/Detail/ThroughputGraph/parser.ts", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { IThroughputData } from 'components/Replicator/Detail/ThroughputGraph/throughput';\n+\n+interface IMetricData {\n+  time: number;\n+  value: number;\n+}\n+\n+interface IMetricSeries {\n+  metricName: string;\n+  data: IMetricData[];\n+}\n+\n+interface IRawMetricData {\n+  startTime: number;\n+  endTime: number;\n+  resolution: string;\n+  series: IMetricSeries[];\n+}\n+\n+const METRIC_NAME_MAP = {\n+  'user.dml.insert': 'inserts',\n+  'user.dml.update': 'updates',\n+  'user.dml.delete': 'deletes',\n+  'user.dml.error': 'errors',\n+};\n+\n+const INITIAL_DATA = {\n+  inserts: 0,\n+  updates: 0,\n+  deletes: 0,\n+  errors: 0,\n+};\n+\n+export function throughputParser(rawData: IRawMetricData): IThroughputData[] {\n+  /**\n+   * <time>: {\n+   *    time: <value>,\n+   *    inserts: <value>,\n+   *    updates: <value>,\n+   *    deletes: <value>,\n+   *    errors: <value>\n+   * }\n+   */\n+  const timeMap: Record<string, IThroughputData> = {};\n+\n+  rawData.series.forEach((metricSeries) => {\n+    const metricType = METRIC_NAME_MAP[metricSeries.metricName];\n+\n+    metricSeries.data.forEach((metricData) => {\n+      const time = metricData.time;\n+      if (!timeMap[time]) {\n+        timeMap[time] = {\n+          time,\n+          ...INITIAL_DATA,\n+        };\n+      }\n+\n+      timeMap[time][metricType] = metricData.value;\n+    });\n+  });\n+\n+  // Interpolate data with missing times\n+  const resolution = parseInt(rawData.resolution, 10);\n+  const startTime = rawData.startTime - (rawData.startTime % resolution);\n+  let currentTime = startTime;\n+  while (currentTime < rawData.endTime) {\n+    if (!timeMap[currentTime]) {\n+      timeMap[currentTime] = {\n+        time: currentTime,\n+        ...INITIAL_DATA,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "originalPosition": 86}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDE3NDUw", "url": "https://github.com/cdapio/cdap/pull/12873#pullrequestreview-541417450", "createdAt": "2020-12-01T01:14:21Z", "commit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxNDoyMVrOH8UPmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxNDoyMVrOH8UPmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwODI4Mw==", "bodyText": "Where are these colors from?", "url": "https://github.com/cdapio/cdap/pull/12873#discussion_r533008283", "createdAt": "2020-12-01T01:14:21Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/cdap/components/Replicator/Detail/ThroughputGraph/throughput.ts", "diffHunk": "@@ -0,0 +1,236 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import * as d3 from 'd3';\n+import numeral from 'numeral';\n+import { objectQuery } from 'services/helpers';\n+\n+export const COLOR_MAP = {\n+  inserts: '#185ABC',\n+  updates: '#669DF6',\n+  deletes: '#AECBFA',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDE5MzA5", "url": "https://github.com/cdapio/cdap/pull/12873#pullrequestreview-541419309", "createdAt": "2020-12-01T01:19:31Z", "commit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxOTozMVrOH8UV6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxOTozMVrOH8UV6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwOTg5OQ==", "bodyText": "We should move our formatting functions to a shared implementation.", "url": "https://github.com/cdapio/cdap/pull/12873#discussion_r533009899", "createdAt": "2020-12-01T01:19:31Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/cdap/components/Replicator/Detail/ThroughputGraph/throughput.ts", "diffHunk": "@@ -0,0 +1,236 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import * as d3 from 'd3';\n+import numeral from 'numeral';\n+import { objectQuery } from 'services/helpers';\n+\n+export const COLOR_MAP = {\n+  inserts: '#185ABC',\n+  updates: '#669DF6',\n+  deletes: '#AECBFA',\n+  horizontalLine: '#DDDDDD',\n+  verticalLine: '#979797',\n+  legend: '#999999',\n+  tick: '#333333',\n+};\n+\n+export interface IThroughputData {\n+  time: number;\n+  inserts: number;\n+  updates: number;\n+  deletes: number;\n+  errors: number;\n+}\n+\n+const timeFormat = d3.timeFormat('%m/%d %I:%M %p');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f757c2f84dbc8504b9adda8f28f7248af5307965"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjYyNzQ1", "url": "https://github.com/cdapio/cdap/pull/12873#pullrequestreview-545262745", "createdAt": "2020-12-04T20:07:59Z", "commit": {"oid": "f92d0dbab612b5eafe457326651159403f4f3932"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7873d9cdc1edfa58f85d4aebd86443785f30d0bc", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/7873d9cdc1edfa58f85d4aebd86443785f30d0bc", "committedDate": "2020-12-08T23:24:40Z", "message": "[CDAP-17409] Replication throughput graph"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f92d0dbab612b5eafe457326651159403f4f3932", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/f92d0dbab612b5eafe457326651159403f4f3932", "committedDate": "2020-12-02T06:28:08Z", "message": "refactor to use ChartContainer"}, "afterCommit": {"oid": "7873d9cdc1edfa58f85d4aebd86443785f30d0bc", "author": {"user": {"login": "elfenheart", "name": "Edwin Elia"}}, "url": "https://github.com/cdapio/cdap/commit/7873d9cdc1edfa58f85d4aebd86443785f30d0bc", "committedDate": "2020-12-08T23:24:40Z", "message": "[CDAP-17409] Replication throughput graph"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1487, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}