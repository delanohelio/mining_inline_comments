{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NTk0NzM1", "number": 12354, "title": "[CDAP-16972] Fix to stop pipeline preview running properly", "bodyText": "After provided checkbox was removed, we made a decision to show the runtime arguments modal when user clicks on start preview and when the arguments are empt. The intention was to bring it to users' attention that they are about to run a preview with empty arguments.\nWe missed a corner case where the preview was already running with empty macros(they're provided) and if users click stop, we were showing the modal again because the runtime arguments were empty.\nJIRA: https://issues.cask.co/browse/CDAP-16972", "createdAt": "2020-06-17T04:26:32Z", "url": "https://github.com/cdapio/cdap/pull/12354", "merged": true, "mergeCommit": {"oid": "76bd59e6a43e857538f1ca12b769c6de97b9a788"}, "closed": true, "closedAt": "2020-06-18T15:50:25Z", "author": {"login": "itsanudeep"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsDh7-AFqTQzMjA4MjgyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsgeeeAFqTQzMzQxODkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDgyODIx", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432082821", "createdAt": "2020-06-17T06:05:32Z", "commit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDgzMDYw", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432083060", "createdAt": "2020-06-17T06:06:07Z", "commit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjowNjowN1rOGk22HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjowNjowN1rOGk22HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMDUwOA==", "bodyText": "nit: Could we explicitly check for empty values instead of falsey values.", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441300508", "createdAt": "2020-06-17T06:06:07Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/KeyValuePairs/KeyValueStoreActions.js", "diffHunk": "@@ -44,8 +44,8 @@ const convertKeyValuePairsObjToMap = (keyValues) => {\n const keyValuePairsHaveMissingValues = (keyValues) => {\n   if (keyValues.pairs) {\n     return keyValues.pairs.some((keyValuePair) => {\n-      if (keyValuePair.notDeletable && keyValuePair.provided) {\n-        return false;\n+      if (keyValuePair.notDeletable) {\n+        return !keyValuePair.value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDgzNzAx", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432083701", "createdAt": "2020-06-17T06:07:33Z", "commit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjU0NzQy", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432654742", "createdAt": "2020-06-17T18:13:50Z", "commit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoxMzo1MVrOGlRdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoxNDoyNVrOGlRfEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjY0Ng==", "bodyText": "nit: space after if", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736646", "createdAt": "2020-06-17T18:13:51Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjk3Ng==", "bodyText": "this function signature doesn't make sense anymore", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736976", "createdAt": "2020-06-17T18:14:25Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){\n+      this.stopPreview();\n+    }\n+    else if (this.doesPreviewHaveEmptyMacros) {\n       this.doStartOrStopPreview();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzg3ODYz", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432787863", "createdAt": "2020-06-17T21:25:13Z", "commit": {"oid": "118ea295467bd6c53ca17da049dbefacb5b81713"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyNToxM1rOGlX96g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyNToxM1rOGlX96g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA==", "bodyText": "we won't ever get to this condition, can we?", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441843178", "createdAt": "2020-06-17T21:25:13Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,26 +481,24 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n-      this.doStartOrStopPreview();\n-    } else {\n-      // Validate and show runtime arguments if there are\n-      // un-fulfilled macros.\n-      this.toggleConfig();\n-    }\n-  }\n-\n-  doStartOrStopPreview() {\n-    this.getRuntimeArguments()\n-      .then(() => {\n+    if (this.previewRunning) {\n+      this.stopPreview();\n+    } else if (this.doesPreviewHaveEmptyMacros) {\n+      this.getRuntimeArguments().then(() => {\n         if (this.previewRunning) {\n           this.stopPreview();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "118ea295467bd6c53ca17da049dbefacb5b81713"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTM0Nzg4", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-432934788", "createdAt": "2020-06-18T04:37:24Z", "commit": {"oid": "7d28bfd600bba0379925e8441dc5597f5e0b00c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f86986b75e0c6a2f38f006775021dfaa75eca391", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/f86986b75e0c6a2f38f006775021dfaa75eca391", "committedDate": "2020-06-18T05:20:23Z", "message": "toggle arguments when empty"}, "afterCommit": {"oid": "d98af8932102ae61873d51baa388cc895949daa6", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/d98af8932102ae61873d51baa388cc895949daa6", "committedDate": "2020-06-18T08:27:45Z", "message": "Resolve macros at run button level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b780c96bf1fd78db6252760fd835b28f3be37cf", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/0b780c96bf1fd78db6252760fd835b28f3be37cf", "committedDate": "2020-06-18T15:35:54Z", "message": "Fix to properly stop pipeline preview"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3fe4764447eb69c80af4630729afaedcfd84a0a", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/d3fe4764447eb69c80af4630729afaedcfd84a0a", "committedDate": "2020-06-18T14:53:21Z", "message": "Fixes run button to show starting vs loading while starting the pipeline"}, "afterCommit": {"oid": "0b780c96bf1fd78db6252760fd835b28f3be37cf", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/0b780c96bf1fd78db6252760fd835b28f3be37cf", "committedDate": "2020-06-18T15:35:54Z", "message": "Fix to properly stop pipeline preview"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDE4OTEw", "url": "https://github.com/cdapio/cdap/pull/12354#pullrequestreview-433418910", "createdAt": "2020-06-18T15:49:00Z", "commit": {"oid": "0b780c96bf1fd78db6252760fd835b28f3be37cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1890, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}