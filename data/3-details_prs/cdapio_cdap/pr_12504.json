{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NzI1NDQx", "number": 12504, "title": "(CDAP-17124) Fix the PreviewRunnerService stop logic", "bodyText": "Shouldn\u2019t try to stop a preview run that was already completed\nStop individual preview runs before stopping the PreviewRunner, which the PreviewRunner runs shared services", "createdAt": "2020-07-26T09:24:27Z", "url": "https://github.com/cdapio/cdap/pull/12504", "merged": true, "mergeCommit": {"oid": "cb8123681f167d4c457e70a29e5e3c98cae647e0"}, "closed": true, "closedAt": "2020-07-27T22:44:08Z", "author": {"login": "chtyim"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5FWPZgFqTQ1NTk4Njg1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5FpIYgFqTQ1NjAwNzczNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTg2ODU4", "url": "https://github.com/cdapio/cdap/pull/12504#pullrequestreview-455986858", "createdAt": "2020-07-27T17:25:31Z", "commit": {"oid": "3a3ffe8e0afd7b74da96510305d219fb87bb340e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoyNTozMVrOG3sRrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoyNTozMVrOG3sRrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MDI4Nw==", "bodyText": "Correct. I noticed this in the testing as well. I think we should change the start order as well. Start the runner before starting pollers.", "url": "https://github.com/cdapio/cdap/pull/12504#discussion_r461050287", "createdAt": "2020-07-27T17:25:31Z", "author": {"login": "sagarkapare"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/preview/DefaultPreviewRunnerManager.java", "diffHunk": "@@ -134,14 +134,15 @@ protected void startUp() throws Exception {\n \n   @Override\n   protected void shutDown() throws Exception {\n+    // Should stop the polling service, hence individual preview runs, before stopping the top level preview runner.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a3ffe8e0afd7b74da96510305d219fb87bb340e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9efe031877bae2de47b398263a9f3026001b1d58", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/9efe031877bae2de47b398263a9f3026001b1d58", "committedDate": "2020-07-27T17:50:31Z", "message": "(CDAP-17124) Fix the PreviewRunnerService stop logic\n\n- Shouldn\u2019t try to stop a preview run that was already completed\n- Stop individual preview runs before stopping the PreviewRunner, which the PreviewRunner runs shared services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a3ffe8e0afd7b74da96510305d219fb87bb340e", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/3a3ffe8e0afd7b74da96510305d219fb87bb340e", "committedDate": "2020-07-26T01:56:47Z", "message": "(CDAP-17124) Fix the PreviewRunnerService stop logic\n\n- Shouldn\u2019t try to stop a preview run that was already completed\n- Stop individual preview runs before stopping the PreviewRunner, which the PreviewRunner runs shared services"}, "afterCommit": {"oid": "9efe031877bae2de47b398263a9f3026001b1d58", "author": {"user": {"login": "chtyim", "name": "Terence Yim"}}, "url": "https://github.com/cdapio/cdap/commit/9efe031877bae2de47b398263a9f3026001b1d58", "committedDate": "2020-07-27T17:50:31Z", "message": "(CDAP-17124) Fix the PreviewRunnerService stop logic\n\n- Shouldn\u2019t try to stop a preview run that was already completed\n- Stop individual preview runs before stopping the PreviewRunner, which the PreviewRunner runs shared services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MDA3NzM2", "url": "https://github.com/cdapio/cdap/pull/12504#pullrequestreview-456007736", "createdAt": "2020-07-27T17:54:13Z", "commit": {"oid": "9efe031877bae2de47b398263a9f3026001b1d58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1866, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}