{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDU0NzE5", "number": 11930, "title": "CDAP-16392 fix joiner fll", "bodyText": "To merge it without conflict, open against the branch in #11925\nJIRA: https://issues.cask.co/browse/CDAP-16392\nbuild: https://builds.cask.co/browse/CDAP-DUT7131-1\nThe computation of Joiner computation is wrong, if the Joiner emits the input field as [stageName].field, it should start looking for origins in that stageName instead of using the most recent one. Also for same field name from two different stages, we only compute an origin from one stage, this makes the join key incorrect and misleading", "createdAt": "2020-03-06T22:48:23Z", "url": "https://github.com/cdapio/cdap/pull/11930", "merged": true, "mergeCommit": {"oid": "add2312b9a913f8db349db4db49afa0058a14da7"}, "closed": true, "closedAt": "2020-03-07T02:34:14Z", "author": {"login": "yaojiefeng"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLKFP9AFqTM3MDcwNTUwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLLWKqgBqjMxMDczODk0ODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA1NTAy", "url": "https://github.com/cdapio/cdap/pull/11930#pullrequestreview-370705502", "createdAt": "2020-03-07T00:59:54Z", "commit": {"oid": "2ed3115e11f2c19653d5ec7529bfb39285be56d7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMDo1OTo1NFrOFzLd9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMDo1OTo1NFrOFzLd9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwOTU5MA==", "bodyText": "is this just for clarity? The behavior seems the same as before?", "url": "https://github.com/cdapio/cdap/pull/11930#discussion_r389209590", "createdAt": "2020-03-07T00:59:54Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/lineage/LineageOperationsProcessor.java", "diffHunk": "@@ -197,6 +197,10 @@ private void addMergeOperation(Set<String> stageInputs, Map<String, Operation> p\n \n     List<String> fieldsForJoin = new ArrayList<>();\n     for (String field : fields) {\n+      // for joiner, the field name is prefixed with stage name, needs to calculate this name to query for the origin\n+      // from other stages, but in the inputFields map we should use the original name since the actual name can be\n+      // same from different previous stages\n+      String actualField = field;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ed3115e11f2c19653d5ec7529bfb39285be56d7"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzE0NzUw", "url": "https://github.com/cdapio/cdap/pull/11930#pullrequestreview-370714750", "createdAt": "2020-03-07T02:19:38Z", "commit": {"oid": "c3323e9cf48c28b4b45a261795ccdb5fcdf9dd59"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMjoxOTozOFrOFzMBzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMjoxOTozOFrOFzMBzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxODc2NQ==", "bodyText": "this happens in both if and else statements, should we move it out and remove the else?", "url": "https://github.com/cdapio/cdap/pull/11930#discussion_r389218765", "createdAt": "2020-03-07T02:19:38Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/lineage/LineageOperationsProcessor.java", "diffHunk": "@@ -211,10 +219,12 @@ private void addMergeOperation(Set<String> stageInputs, Map<String, Operation> p\n         Iterator<String> stageFieldPairIter = Splitter.on(\".\").omitEmptyStrings().trimResults().split(field).iterator();\n         String stageName = stageFieldPairIter.next();\n         if (stageFieldPairIter.hasNext() && stageOperations.keySet().contains(stageName)) {\n-          field = stageFieldPairIter.next();\n+          actualField = stageFieldPairIter.next();\n           fieldsForJoin.add(field);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3323e9cf48c28b4b45a261795ccdb5fcdf9dd59"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzE1MTI2", "url": "https://github.com/cdapio/cdap/pull/11930#pullrequestreview-370715126", "createdAt": "2020-03-07T02:24:40Z", "commit": {"oid": "c3323e9cf48c28b4b45a261795ccdb5fcdf9dd59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4c452edbe4c527d43ef071d1ad41bac1689db60", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/e4c452edbe4c527d43ef071d1ad41bac1689db60", "committedDate": "2020-03-07T02:32:11Z", "message": "CDAP-16392 fix joiner fll"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3323e9cf48c28b4b45a261795ccdb5fcdf9dd59", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/c3323e9cf48c28b4b45a261795ccdb5fcdf9dd59", "committedDate": "2020-03-07T02:10:38Z", "message": "update comment"}, "afterCommit": {"oid": "e4c452edbe4c527d43ef071d1ad41bac1689db60", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/e4c452edbe4c527d43ef071d1ad41bac1689db60", "committedDate": "2020-03-07T02:32:11Z", "message": "CDAP-16392 fix joiner fll"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1346, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}