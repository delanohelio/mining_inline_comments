{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzM3Mjc1", "number": 12441, "title": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)", "bodyText": "Request history logs are now grouped and sorted by timestamp.\nBefore this PR, requestLog was kept in unsorted List<IRequestHistory>. Now, requestLog is in Map<string, List<IRequestHistory>, which maps timestamp date (e.g. April 5th) to a sorted list of corresponding request histories.", "createdAt": "2020-07-08T15:57:47Z", "url": "https://github.com/cdapio/cdap/pull/12441", "merged": true, "mergeCommit": {"oid": "f3803ecc69204f994f447fa5c12c820504b9f34a"}, "closed": true, "closedAt": "2020-07-20T23:54:59Z", "author": {"login": "jennac3"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1nztngFqTQ1MDI4MDY3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc26adLgBqjM1NjgzMDI4Nzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjgwNjc3", "url": "https://github.com/cdapio/cdap/pull/12441#pullrequestreview-450280677", "createdAt": "2020-07-16T23:25:37Z", "commit": {"oid": "d3d76a947407786525f98fff385b894d3fd21625"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoyNTozN1rOGzAHlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoyNTozN1rOGzAHlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzMjUwMQ==", "bodyText": "we have moment.js to help with this", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r456132501", "createdAt": "2020-07-16T23:25:37Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -141,17 +161,44 @@ const RequestHistoryTabView: React.FC<IRequestHistoryTabProps> = ({\n   onRequestClick,\n   resetIncomingRequest,\n }) => {\n-  const [requestLog, setRequestLog] = React.useState(List<IRequestHistory>([]));\n+  const [requestLog, setRequestLog] = React.useState(\n+    Map<string, List<IRequestHistory>>({}) // maps timestamp date (e.g. April 5th) to a list of corresponding request histories\n+  );\n+\n+  const convertDateToString = (date: Date) => {\n+    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\n+    return date.toLocaleDateString('en-US', options);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3d76a947407786525f98fff385b894d3fd21625"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTc1NjQw", "url": "https://github.com/cdapio/cdap/pull/12441#pullrequestreview-451975640", "createdAt": "2020-07-20T21:34:12Z", "commit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTozNDoxM1rOG0gFPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo0NDo0NVrOG0gWww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNDc2NQ==", "bodyText": "use color already defined in the theme palettes", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457704765", "createdAt": "2020-07-20T21:34:13Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -102,9 +112,20 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n+const StyledExpansionPanel = withStyles(() => ({\n+  root: {\n+    '&$expanded': {\n+      margin: 0,\n+    },\n+    borderBottom: '1px solid #C0C0C0',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNjkyOA==", "bodyText": "isn't valueSeq() already returns a List? do you still need the Array.from?", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457706928", "createdAt": "2020-07-20T21:39:21Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/store/HttpExecutorStore.js", "diffHunk": "@@ -62,10 +63,21 @@ const setResponse = (state, action) => {\n     timestamp: new Date().toLocaleString(),\n   };\n \n-  const newRequestLog = requestLog.push(newCall);\n+  // Update the component view in real-time, since we cannot listen to local storage's change\n+  // Since the new request call is the latest out of all the request histories, insert at 0th index\n+  const timestamp = new Date(newCall.timestamp);\n+  const dateID = getDateID(timestamp);\n+  const requestsGroup = getRequestsByDate(requestLog, dateID);\n+  const newRequestLog = requestLog.set(dateID, requestsGroup.insert(0, newCall));\n \n-  // saving of the request to the localStorage\n-  localStorage.setItem(REQUEST_HISTORY, JSON.stringify(newRequestLog));\n+  // Saving request histories to the localStorage\n+  let storedLogs = List([]);\n+  Array.from(newRequestLog.valueSeq()).forEach((requests) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTI1MQ==", "bodyText": "i think this is supposed to be MMMM D. d is day of the week, not month", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457709251", "createdAt": "2020-07-20T21:44:45Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/utilities.ts", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { List, Map } from 'immutable';\n+\n+import { IRequestHistory } from 'components/HttpExecutor/RequestHistoryTab';\n+import moment from 'moment';\n+\n+export function getDateID(date: Date) {\n+  return moment(date).format('dddd, MMMM d, YYYY');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDI1NzQ0", "url": "https://github.com/cdapio/cdap/pull/12441#pullrequestreview-452025744", "createdAt": "2020-07-20T23:26:36Z", "commit": {"oid": "35504dddcff353dc429b01755cba8fe3b0e20af7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35504dddcff353dc429b01755cba8fe3b0e20af7", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/35504dddcff353dc429b01755cba8fe3b0e20af7", "committedDate": "2020-07-20T23:25:20Z", "message": "tiny nit"}, "afterCommit": {"oid": "a8daa8c7bae6d2c9748af00d1e06198080dc7003", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/a8daa8c7bae6d2c9748af00d1e06198080dc7003", "committedDate": "2020-07-20T23:31:54Z", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c847f7d6c5bc978d51697f47a25204edbc4c8095", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/c847f7d6c5bc978d51697f47a25204edbc4c8095", "committedDate": "2020-07-20T23:40:59Z", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6995cf20db7042d65adf22d1c3e71e11392e6cf", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/c6995cf20db7042d65adf22d1c3e71e11392e6cf", "committedDate": "2020-07-20T23:39:07Z", "message": "pull from develop"}, "afterCommit": {"oid": "c847f7d6c5bc978d51697f47a25204edbc4c8095", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/c847f7d6c5bc978d51697f47a25204edbc4c8095", "committedDate": "2020-07-20T23:40:59Z", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1959, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}