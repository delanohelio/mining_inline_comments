{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3NDU4MzY2", "number": 12898, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzoxOTo1OVrOFFTt9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzoyMzoyMlrOFFTx-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTEwMjYzOnYy", "diffSide": "RIGHT", "path": "cdap-api-common/src/main/java/io/cdap/cdap/api/data/format/StructuredRecord.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzoxOTo1OVrOIFxEqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMToxODozMVrOIF0VbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxNzgwMQ==", "bodyText": "Why do we retrow ClassCastException in all other cases, but UnexpectedFormatException here?", "url": "https://github.com/cdapio/cdap/pull/12898#discussion_r542917801", "createdAt": "2020-12-14T23:19:59Z", "author": {"login": "tivv"}, "path": "cdap-api-common/src/main/java/io/cdap/cdap/api/data/format/StructuredRecord.java", "diffHunk": "@@ -192,7 +220,12 @@ public BigDecimal getDecimal(String fieldName) {\n       return new BigDecimal(new BigInteger(Bytes.toBytes((ByteBuffer) value)), scale);\n     }\n \n-    return new BigDecimal(new BigInteger((byte[]) value), scale);\n+    try {\n+      return new BigDecimal(new BigInteger((byte[]) value), scale);\n+    } catch (ClassCastException e) {\n+      throw new UnexpectedFormatException(String.format(\"Field '%s' is expected to be a %s, but is a %s.\", fieldName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d76bac6da422133e5ecf461832cc0461f6ae2ee9"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3MTI0NA==", "bodyText": "good catch, not intended will change it", "url": "https://github.com/cdapio/cdap/pull/12898#discussion_r542971244", "createdAt": "2020-12-15T01:18:31Z", "author": {"login": "albertshau"}, "path": "cdap-api-common/src/main/java/io/cdap/cdap/api/data/format/StructuredRecord.java", "diffHunk": "@@ -192,7 +220,12 @@ public BigDecimal getDecimal(String fieldName) {\n       return new BigDecimal(new BigInteger(Bytes.toBytes((ByteBuffer) value)), scale);\n     }\n \n-    return new BigDecimal(new BigInteger((byte[]) value), scale);\n+    try {\n+      return new BigDecimal(new BigInteger((byte[]) value), scale);\n+    } catch (ClassCastException e) {\n+      throw new UnexpectedFormatException(String.format(\"Field '%s' is expected to be a %s, but is a %s.\", fieldName,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxNzgwMQ=="}, "originalCommit": {"oid": "d76bac6da422133e5ecf461832cc0461f6ae2ee9"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMTExMjg5OnYy", "diffSide": "RIGHT", "path": "cdap-formats/src/test/java/io/cdap/cdap/format/StructuredRecordBuilderTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzoyMzoyMlrOIFxKZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMToyMzo0MVrOIF0dJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxOTI3MQ==", "bodyText": "It would be great to test the fix: not only exception type, but message as well. You should be able to use https://junit.org/junit4/javadoc/latest/org/junit/rules/ExpectedException.html to do it.", "url": "https://github.com/cdapio/cdap/pull/12898#discussion_r542919271", "createdAt": "2020-12-14T23:23:22Z", "author": {"login": "tivv"}, "path": "cdap-formats/src/test/java/io/cdap/cdap/format/StructuredRecordBuilderTest.java", "diffHunk": "@@ -285,4 +285,25 @@ public void testInvalidPrecision() {\n     Schema schema = Schema.recordOf(\"test\", Schema.Field.of(\"d\", Schema.decimalOf(5, 2)));\n     StructuredRecord.builder(schema).setDecimal(\"d\", new BigDecimal(new BigInteger(\"12341324\"), 2)).build();\n   }\n+\n+  @Test(expected = ClassCastException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d76bac6da422133e5ecf461832cc0461f6ae2ee9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk3MzIyMQ==", "bodyText": "nice, did not know about this, will update", "url": "https://github.com/cdapio/cdap/pull/12898#discussion_r542973221", "createdAt": "2020-12-15T01:23:41Z", "author": {"login": "albertshau"}, "path": "cdap-formats/src/test/java/io/cdap/cdap/format/StructuredRecordBuilderTest.java", "diffHunk": "@@ -285,4 +285,25 @@ public void testInvalidPrecision() {\n     Schema schema = Schema.recordOf(\"test\", Schema.Field.of(\"d\", Schema.decimalOf(5, 2)));\n     StructuredRecord.builder(schema).setDecimal(\"d\", new BigDecimal(new BigInteger(\"12341324\"), 2)).build();\n   }\n+\n+  @Test(expected = ClassCastException.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxOTI3MQ=="}, "originalCommit": {"oid": "d76bac6da422133e5ecf461832cc0461f6ae2ee9"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2560, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}