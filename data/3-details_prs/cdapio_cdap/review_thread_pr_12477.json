{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzOTUyNTg0", "number": 12477, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTowMzoxOFrOERN8jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNjoxMTowMlrOER4eaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDg5NzQyOnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTowMzoxOFrOG10HoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzowMTo1M1rOG16zAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MTYzMw==", "bodyText": "Does this test depend on the previous test? If so, can you restructure so it can be run independently?", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459081633", "createdAt": "2020-07-22T21:03:18Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "diffHunk": "@@ -33,19 +46,75 @@ describe('Pipelines with plugins having more than one endpoints', () => {\n       });\n     });\n   });\n-  afterEach(() => {\n+\n+  after(() => {\n     // Delete the pipeline to clean up\n     pipelines.forEach((pipeline) => cy.cleanup_pipelines(headers, pipeline));\n   });\n \n-  it('Should work with union splitter and condition plugins', (done) => {\n-    Helpers.deployAndTestPipeline(\n+  it('Should upload pipeline with union splitter and condition plugins', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+    cy.upload_pipeline(\n       'union_condition_splitter_pipeline_v1-cdap-data-pipeline.json',\n-      unionConditionPipeline,\n-      done\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n     );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(unionConditionPipeline)\n+      .type('{enter}');\n   });\n-  it('Should work with null splitter plugin', (done) => {\n+  it('Should show preview data for multiple outputs for splitter and correct message for conditional', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8a5c8e572c62c7f3305fbf9b94eaeab2085cf3b"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE5MTA0Mg==", "bodyText": "Good call.  I've moved the uploading of the first pipeline to a before hook since both two other tests depend on it, so now the tests do not rely on each other.", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459191042", "createdAt": "2020-07-23T03:01:53Z", "author": {"login": "yukiej"}, "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "diffHunk": "@@ -33,19 +46,75 @@ describe('Pipelines with plugins having more than one endpoints', () => {\n       });\n     });\n   });\n-  afterEach(() => {\n+\n+  after(() => {\n     // Delete the pipeline to clean up\n     pipelines.forEach((pipeline) => cy.cleanup_pipelines(headers, pipeline));\n   });\n \n-  it('Should work with union splitter and condition plugins', (done) => {\n-    Helpers.deployAndTestPipeline(\n+  it('Should upload pipeline with union splitter and condition plugins', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+    cy.upload_pipeline(\n       'union_condition_splitter_pipeline_v1-cdap-data-pipeline.json',\n-      unionConditionPipeline,\n-      done\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n     );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(unionConditionPipeline)\n+      .type('{enter}');\n   });\n-  it('Should work with null splitter plugin', (done) => {\n+  it('Should show preview data for multiple outputs for splitter and correct message for conditional', () => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MTYzMw=="}, "originalCommit": {"oid": "b8a5c8e572c62c7f3305fbf9b94eaeab2085cf3b"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTE5MDUyOnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjo0OTo0MlrOG125bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzowNzo0MFrOG163fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzE1MA==", "bodyText": "this can be dataCy(\"Deployed\")!", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459127150", "createdAt": "2020-07-22T22:49:42Z", "author": {"login": "jennac3"}, "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "diffHunk": "@@ -33,19 +46,75 @@ describe('Pipelines with plugins having more than one endpoints', () => {\n       });\n     });\n   });\n-  afterEach(() => {\n+\n+  after(() => {\n     // Delete the pipeline to clean up\n     pipelines.forEach((pipeline) => cy.cleanup_pipelines(headers, pipeline));\n   });\n \n-  it('Should work with union splitter and condition plugins', (done) => {\n-    Helpers.deployAndTestPipeline(\n+  it('Should upload pipeline with union splitter and condition plugins', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+    cy.upload_pipeline(\n       'union_condition_splitter_pipeline_v1-cdap-data-pipeline.json',\n-      unionConditionPipeline,\n-      done\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n     );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(unionConditionPipeline)\n+      .type('{enter}');\n   });\n-  it('Should work with null splitter plugin', (done) => {\n+  it('Should show preview data for multiple outputs for splitter and correct message for conditional', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    cy.get(Helpers.dataCy('pipeline-preview-btn')).click();\n+    cy.get(Helpers.dataCy('run-preview-btn')).click();\n+    cy.get(Helpers.dataCy('stop-preview-btn')).should('be.visible');\n+    cy.get(Helpers.dataCy('run-preview-btn'), { timeout: 60000 }).should('exist');\n+\n+    // Check number of output fields for null splitter\n+    cy.get(Helpers.dataCy('UnionSplitter-preview-data-btn')).click();\n+    cy.get(Helpers.dataCy('toggle-Table')).should('exist');\n+    cy.get('h3')\n+      .contains('Int')\n+      .should('be.visible');\n+    cy.get('h3')\n+      .contains('String')\n+      .should('be.visible');\n+    cy.get(closeButton).click();\n+    // Check messaging for condition plugin\n+    cy.get(`${Helpers.dataCy('plugin-node-Conditional-condition-5')} .node .node-configure-btn`)\n+      .invoke('show')\n+      .click({ force: true });\n+    cy.contains('Preview').click();\n+    cy.get('h3')\n+      .contains(conditionPreviewMsg)\n+      .should('exist');\n+    cy.get(closeButton).click();\n+    cy.get(Helpers.dataCy('toggle-preview-btn')).click();\n+  });\n+\n+  it('Should deploy pipeline with union splitter and condition plugins', (done) => {\n+    cy.get('[data-testid=deploy-pipeline]').click();\n+    cy.get('[data-cy=\"Deployed\"]', { timeout: 60000 }).should('contain', 'Deployed');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8a5c8e572c62c7f3305fbf9b94eaeab2085cf3b"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE5MjE5MA==", "bodyText": "Done", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459192190", "createdAt": "2020-07-23T03:07:40Z", "author": {"login": "yukiej"}, "path": "cdap-ui/cypress/integration/pipeline.plugin.multipleendpoints.spec.ts", "diffHunk": "@@ -33,19 +46,75 @@ describe('Pipelines with plugins having more than one endpoints', () => {\n       });\n     });\n   });\n-  afterEach(() => {\n+\n+  after(() => {\n     // Delete the pipeline to clean up\n     pipelines.forEach((pipeline) => cy.cleanup_pipelines(headers, pipeline));\n   });\n \n-  it('Should work with union splitter and condition plugins', (done) => {\n-    Helpers.deployAndTestPipeline(\n+  it('Should upload pipeline with union splitter and condition plugins', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+    cy.upload_pipeline(\n       'union_condition_splitter_pipeline_v1-cdap-data-pipeline.json',\n-      unionConditionPipeline,\n-      done\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n     );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(unionConditionPipeline)\n+      .type('{enter}');\n   });\n-  it('Should work with null splitter plugin', (done) => {\n+  it('Should show preview data for multiple outputs for splitter and correct message for conditional', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    cy.get(Helpers.dataCy('pipeline-preview-btn')).click();\n+    cy.get(Helpers.dataCy('run-preview-btn')).click();\n+    cy.get(Helpers.dataCy('stop-preview-btn')).should('be.visible');\n+    cy.get(Helpers.dataCy('run-preview-btn'), { timeout: 60000 }).should('exist');\n+\n+    // Check number of output fields for null splitter\n+    cy.get(Helpers.dataCy('UnionSplitter-preview-data-btn')).click();\n+    cy.get(Helpers.dataCy('toggle-Table')).should('exist');\n+    cy.get('h3')\n+      .contains('Int')\n+      .should('be.visible');\n+    cy.get('h3')\n+      .contains('String')\n+      .should('be.visible');\n+    cy.get(closeButton).click();\n+    // Check messaging for condition plugin\n+    cy.get(`${Helpers.dataCy('plugin-node-Conditional-condition-5')} .node .node-configure-btn`)\n+      .invoke('show')\n+      .click({ force: true });\n+    cy.contains('Preview').click();\n+    cy.get('h3')\n+      .contains(conditionPreviewMsg)\n+      .should('exist');\n+    cy.get(closeButton).click();\n+    cy.get(Helpers.dataCy('toggle-preview-btn')).click();\n+  });\n+\n+  it('Should deploy pipeline with union splitter and condition plugins', (done) => {\n+    cy.get('[data-testid=deploy-pipeline]').click();\n+    cy.get('[data-cy=\"Deployed\"]', { timeout: 60000 }).should('contain', 'Deployed');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzE1MA=="}, "originalCommit": {"oid": "b8a5c8e572c62c7f3305fbf9b94eaeab2085cf3b"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NjYyNzQwOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/ToggleSwitch/index.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwOTo1OTo1M1rOG2D6sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoyMDo1M1rOG2M1jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0MDQ2NA==", "bodyText": "This can also be toggle-${isOn? onLabel : offLabel}!", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459340464", "createdAt": "2020-07-23T09:59:53Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/components/ToggleSwitch/index.js", "diffHunk": "@@ -24,7 +24,10 @@ export default function ToggleSwitch({ isOn, onToggle, disabled, onLabel, offLab\n     <div className={classnames('toggle-switch-container', { disabled: disabled })}>\n       <div className={classnames('toggle-switch', { on: isOn, off: !isOn })} onClick={onToggle}>\n         <div className=\"switch-button\" />\n-        <div className={classnames('label', 'truncate', { 'on-label': isOn, 'off-label': !isOn })}>\n+        <div\n+          className={classnames('label', 'truncate', { 'on-label': isOn, 'off-label': !isOn })}\n+          data-cy={isOn ? `toggle-${onLabel}` : `toggle-${offLabel}`}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5348626694c38b7430ea14c6402d2ffd0ae3e1da"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4NjYwNA==", "bodyText": "Done", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459486604", "createdAt": "2020-07-23T14:20:53Z", "author": {"login": "yukiej"}, "path": "cdap-ui/app/cdap/components/ToggleSwitch/index.js", "diffHunk": "@@ -24,7 +24,10 @@ export default function ToggleSwitch({ isOn, onToggle, disabled, onLabel, offLab\n     <div className={classnames('toggle-switch-container', { disabled: disabled })}>\n       <div className={classnames('toggle-switch', { on: isOn, off: !isOn })} onClick={onToggle}>\n         <div className=\"switch-button\" />\n-        <div className={classnames('label', 'truncate', { 'on-label': isOn, 'off-label': !isOn })}>\n+        <div\n+          className={classnames('label', 'truncate', { 'on-label': isOn, 'off-label': !isOn })}\n+          data-cy={isOn ? `toggle-${onLabel}` : `toggle-${offLabel}`}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0MDQ2NA=="}, "originalCommit": {"oid": "5348626694c38b7430ea14c6402d2ffd0ae3e1da"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NjYzMTUzOnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMDowMDo1NlrOG2D9SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDoyNTo1NFrOG2ND5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0MTEyOQ==", "bodyText": "is there any reason why Table is captialized?", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459341129", "createdAt": "2020-07-23T10:00:56Z", "author": {"login": "jennac3"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };\n+const sourceNode2 = { nodeName: 'File2', nodeType: 'batchsource', nodeId: '2' };\n+const joinerNode = { nodeName: 'Joiner', nodeType: 'batchjoiner', nodeId: '1' };\n+const sinkNode = { nodeName: 'TPFSAvro', nodeType: 'batchsink', nodeId: '3' };\n+\n+// Preview messaging\n+const runPreviewMsg = 'Run preview to generate preview data';\n+const noDataMsg = 'Output records have not been generated';\n+\n+describe('Running preview with joiner plugin in pipeline studio', () => {\n+  before(() => {\n+    loginIfRequired().then(() => {\n+      cy.getCookie('CDAP_Auth_Token').then((cookie) => {\n+        if (!cookie) {\n+          return;\n+        }\n+        headers = {\n+          Authorization: 'Bearer ' + cookie.value,\n+        };\n+      });\n+    });\n+  });\n+\n+  beforeEach(() => {\n+    getArtifactsPoll(headers);\n+  });\n+\n+  after(() => {\n+    // Delete the pipeline to clean up\n+    cy.cleanup_pipelines(headers, JOINER_PIPELINE_NAME);\n+  });\n+\n+  it('Should be able to upload a pipeline with joiner widget', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+\n+    cy.upload_pipeline(\n+      'joiner_pipeline_v1-cdap-data-pipeline.json',\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n+    );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(JOINER_PIPELINE_NAME)\n+      .type('{enter}');\n+  });\n+\n+  it('Should show appropriate message when preview has not been run yet', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    cy.get(dataCy('pipeline-preview-btn')).click();\n+    cy.get(dataCy(`${joinerNode.nodeName}-preview-data-btn`)).click();\n+    cy.contains(runPreviewMsg).should('be.visible');\n+    cy.get(closeButton).click();\n+  });\n+\n+  it('Should show appropriate message when preview has been stopped before data is generated', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    // Start and then immediately stop preview\n+    cy.get(dataCy('run-preview-btn')).click();\n+    cy.get(dataCy('stop-preview-btn')).click();\n+    cy.get(dataCy('run-preview-btn'), { timeout: 30000 }).should('exist');\n+    cy.get(\n+      dataCy(`plugin-node-${sourceNode1.nodeName}-${sourceNode1.nodeType}-${sourceNode1.nodeId}`)\n+    ).within(() => {\n+      cy.get(dataCy(`${sourceNode1.nodeName}-preview-data-btn`)).click();\n+    });\n+    cy.contains(noDataMsg).should('be.visible');\n+    cy.get(closeButton).click();\n+  });\n+\n+  it('Should show preview data with table view by default for sink', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    // Start and run preview\n+    cy.get(dataCy('run-preview-btn')).click();\n+    cy.get(dataCy('stop-preview-btn')).should('be.visible');\n+    cy.get(dataCy('run-preview-btn'), { timeout: 70000 }).should('exist');\n+    cy.get(dataCy(`plugin-node-TPFSAvro-batchsink-2`)).within(() => {\n+      cy.get(dataCy(`${sinkNode.nodeName}-preview-data-btn`)).click();\n+    });\n+    // Should be able to toggle view and navigate records\n+    cy.get(dataCy('toggle-Table'), { timeout: 10000 }).should('exist');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5348626694c38b7430ea14c6402d2ffd0ae3e1da"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ5MDI3Nw==", "bodyText": "That part of the attribute comes directly from the user-facing labels on the ToggleSwitch, which are capitalized and come from the PreviewMode enum (\n  \n    \n      cdap/cdap-ui/app/cdap/components/PreviewData/index.tsx\n    \n    \n         Line 62\n      in\n      0a332be\n    \n    \n    \n    \n\n        \n          \n           enum PreviewMode { \n        \n    \n  \n\n).", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r459490277", "createdAt": "2020-07-23T14:25:54Z", "author": {"login": "yukiej"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };\n+const sourceNode2 = { nodeName: 'File2', nodeType: 'batchsource', nodeId: '2' };\n+const joinerNode = { nodeName: 'Joiner', nodeType: 'batchjoiner', nodeId: '1' };\n+const sinkNode = { nodeName: 'TPFSAvro', nodeType: 'batchsink', nodeId: '3' };\n+\n+// Preview messaging\n+const runPreviewMsg = 'Run preview to generate preview data';\n+const noDataMsg = 'Output records have not been generated';\n+\n+describe('Running preview with joiner plugin in pipeline studio', () => {\n+  before(() => {\n+    loginIfRequired().then(() => {\n+      cy.getCookie('CDAP_Auth_Token').then((cookie) => {\n+        if (!cookie) {\n+          return;\n+        }\n+        headers = {\n+          Authorization: 'Bearer ' + cookie.value,\n+        };\n+      });\n+    });\n+  });\n+\n+  beforeEach(() => {\n+    getArtifactsPoll(headers);\n+  });\n+\n+  after(() => {\n+    // Delete the pipeline to clean up\n+    cy.cleanup_pipelines(headers, JOINER_PIPELINE_NAME);\n+  });\n+\n+  it('Should be able to upload a pipeline with joiner widget', () => {\n+    cy.visit('/pipelines/ns/default/studio');\n+    cy.get('#resource-center-btn').click();\n+    cy.get('#create-pipeline-link').click();\n+    cy.url().should('include', '/studio');\n+\n+    cy.upload_pipeline(\n+      'joiner_pipeline_v1-cdap-data-pipeline.json',\n+      '#pipeline-import-config-link > input[type=\"file\"]'\n+    );\n+    // This is arbitrary. Right now we don't have a way to determine\n+    // if the upgrade check is done. Since this a standalone the assumption\n+    // is this won't take more than 10 seconds.\n+    cy.wait(10000);\n+    // Name pipeline\n+    cy.get('.pipeline-name').click();\n+    cy.get('#pipeline-name-input')\n+      .clear()\n+      .type(JOINER_PIPELINE_NAME)\n+      .type('{enter}');\n+  });\n+\n+  it('Should show appropriate message when preview has not been run yet', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    cy.get(dataCy('pipeline-preview-btn')).click();\n+    cy.get(dataCy(`${joinerNode.nodeName}-preview-data-btn`)).click();\n+    cy.contains(runPreviewMsg).should('be.visible');\n+    cy.get(closeButton).click();\n+  });\n+\n+  it('Should show appropriate message when preview has been stopped before data is generated', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    // Start and then immediately stop preview\n+    cy.get(dataCy('run-preview-btn')).click();\n+    cy.get(dataCy('stop-preview-btn')).click();\n+    cy.get(dataCy('run-preview-btn'), { timeout: 30000 }).should('exist');\n+    cy.get(\n+      dataCy(`plugin-node-${sourceNode1.nodeName}-${sourceNode1.nodeType}-${sourceNode1.nodeId}`)\n+    ).within(() => {\n+      cy.get(dataCy(`${sourceNode1.nodeName}-preview-data-btn`)).click();\n+    });\n+    cy.contains(noDataMsg).should('be.visible');\n+    cy.get(closeButton).click();\n+  });\n+\n+  it('Should show preview data with table view by default for sink', () => {\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n+    // Start and run preview\n+    cy.get(dataCy('run-preview-btn')).click();\n+    cy.get(dataCy('stop-preview-btn')).should('be.visible');\n+    cy.get(dataCy('run-preview-btn'), { timeout: 70000 }).should('exist');\n+    cy.get(dataCy(`plugin-node-TPFSAvro-batchsink-2`)).within(() => {\n+      cy.get(dataCy(`${sinkNode.nodeName}-preview-data-btn`)).click();\n+    });\n+    // Should be able to toggle view and navigate records\n+    cy.get(dataCy('toggle-Table'), { timeout: 10000 }).should('exist');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0MTEyOQ=="}, "originalCommit": {"oid": "5348626694c38b7430ea14c6402d2ffd0ae3e1da"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTg2NDk1OnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNjoxMDo1NVrOG21XAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMDowNToxNFrOG3ArHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MDUyOQ==", "bodyText": "Should we use input1 variable?", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r460150529", "createdAt": "2020-07-24T16:10:55Z", "author": {"login": "jennac3"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9f9ffea5dd020faca8eca20050b68b9aa26e8d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMzNTkwMg==", "bodyText": "I've removed input1 and input2 since we can get the same info from sourceNode1 and sourceNode2.", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r460335902", "createdAt": "2020-07-25T00:05:14Z", "author": {"login": "yukiej"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MDUyOQ=="}, "originalCommit": {"oid": "fa9f9ffea5dd020faca8eca20050b68b9aa26e8d"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MTg2NTM2OnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNjoxMTowMlrOG21XPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMTowODozNFrOG3BPCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MDU5MA==", "bodyText": "Should we use input2 variable?", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r460150590", "createdAt": "2020-07-24T16:11:02Z", "author": {"login": "jennac3"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };\n+const sourceNode2 = { nodeName: 'File2', nodeType: 'batchsource', nodeId: '2' };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9f9ffea5dd020faca8eca20050b68b9aa26e8d"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM0NTA5Ng==", "bodyText": "Removed!", "url": "https://github.com/cdapio/cdap/pull/12477#discussion_r460345096", "createdAt": "2020-07-25T01:08:34Z", "author": {"login": "yukiej"}, "path": "cdap-ui/cypress/integration/pipeline.joiner.spec.ts", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the 'License'); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { loginIfRequired, getArtifactsPoll, dataCy } from '../helpers';\n+\n+let headers = {};\n+\n+// We don't have preview enabled in distributed mode.\n+// TODO(CDAP-16620) To enable preview in distributed mode. Once it is enabled we can remove.\n+let skipPreviewTests = false;\n+// @ts-ignore \"cy.state\" is not in the \"cy\" type\n+const getMochaContext = () => cy.state('runnable').ctx;\n+const skip = () => {\n+  const ctx = getMochaContext();\n+  return ctx.skip();\n+};\n+\n+const closeButton = '[data-testid=\"close-config-popover\"]';\n+\n+// Pipeline and plugin info\n+const JOINER_PIPELINE_NAME = `joiner_pipeline_${Date.now()}`;\n+\n+const input1 = 'File';\n+const input2 = 'File2';\n+const sourceNode1 = { nodeName: 'File', nodeType: 'batchsource', nodeId: '0' };\n+const sourceNode2 = { nodeName: 'File2', nodeType: 'batchsource', nodeId: '2' };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MDU5MA=="}, "originalCommit": {"oid": "fa9f9ffea5dd020faca8eca20050b68b9aa26e8d"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3225, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}