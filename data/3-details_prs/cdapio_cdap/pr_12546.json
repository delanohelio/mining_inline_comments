{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NjQ5MDE5", "number": 12546, "title": "[CDAP-17137] Fix preview stop bug and empty error message bug", "bodyText": "JIRA for empty error message: https://issues.cask.co/browse/CDAP-17138\nJIRA for stopping preview: https://issues.cask.co/browse/CDAP-17137\nBuild: https://builds.cask.co/browse/CDAP-URUT309\n\nFixed stopPreview callback so empty error message is not shown when user stops preview.\nChanged preview status polling logic to stop polling when user tries to stop preview as long as the backend does not return error (instead of stopping polling once backend returns \"KILLED\" status) - this is to prevent the possibility of multiple preview runs running (and having their status polled for) at the same time\nChanged the stopPreview logic to allow user to retry stopping preview if previous attempt fails\nFixed a few bugs in datasource (partial cherry-pick from #12017 )", "createdAt": "2020-07-30T22:33:22Z", "url": "https://github.com/cdapio/cdap/pull/12546", "merged": true, "mergeCommit": {"oid": "82c57f34ae659712831793d31fd080dcc0cc616a"}, "closed": true, "closedAt": "2020-08-05T19:47:38Z", "author": {"login": "yukiej"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6HvYtgFqTQ1ODgxNzE1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8AW8eABqjM2MjYxMjI5NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODE3MTUw", "url": "https://github.com/cdapio/cdap/pull/12546#pullrequestreview-458817150", "createdAt": "2020-07-30T22:54:47Z", "commit": {"oid": "5fc32f7fde4fd5a5531e7c2692cf3d8e19a6a05f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjE5Nzkx", "url": "https://github.com/cdapio/cdap/pull/12546#pullrequestreview-460219791", "createdAt": "2020-08-03T17:40:49Z", "commit": {"oid": "fdf0e17f117fdd08434e56611a7d855ee7c930c4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo0MDo0OVrOG7Cv4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo0MzowOVrOG7C3HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NDE5NA==", "bodyText": "Could we define enum for status type if it also has other status such as failure?", "url": "https://github.com/cdapio/cdap/pull/12546#discussion_r464564194", "createdAt": "2020-08-03T17:40:49Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -678,15 +678,31 @@ class HydratorPlusPlusTopPanelCtrl {\n     };\n     this.previewLoading = true;\n     this.loadingLabel = 'Stopping';\n-    this.stopTimer();\n-    this.updateTimerLabelAndTitle();\n     this.myPipelineApi\n         .stopPreview(params, {})\n         .$promise\n         .then(\n-          (err) => {\n+          () => {\n+            this.stopTimer();\n+            this.updateTimerLabelAndTitle();\n             this.previewLoading = false;\n             this.previewRunning = false;\n+            this.dataSrc.stopPoll(this.pollId);\n+            this.pollId = null;\n+\n+            let pipelinePreviewPlaceholder = 'The preview of the pipeline';\n+            let pipelineName = this.HydratorPlusPlusConfigStore.getName();\n+            if (pipelineName.length > 0) {\n+              pipelinePreviewPlaceholder += ` \"${pipelineName}\"`;\n+            }\n+            this.myAlertOnValium.show({\n+              type: 'success',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf0e17f117fdd08434e56611a7d855ee7c930c4"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NTI2MA==", "bodyText": "Should we also check the nullness of bindings?\nconst resource = bindings && bindings[resourceId]? bindings[resourceId].resource : undefined;", "url": "https://github.com/cdapio/cdap/pull/12546#discussion_r464565260", "createdAt": "2020-08-03T17:41:59Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/services/cask-angular-socket-datasource/datasource.js", "diffHunk": "@@ -172,7 +172,7 @@ var socketDataSource = angular.module(PKG.name+'.services');\n \n       function startClientPoll(resourceId, bindings, interval) {\n         const intervalTimer = setTimeout(() => {\n-          const resource = bindings[resourceId].resource;\n+          const resource = bindings[resourceId]? bindings[resourceId].resource : undefined;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf0e17f117fdd08434e56611a7d855ee7c930c4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NjA0NQ==", "bodyText": "Can we use const for pipelineName, since its values are not changed?", "url": "https://github.com/cdapio/cdap/pull/12546#discussion_r464566045", "createdAt": "2020-08-03T17:43:09Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -678,15 +678,31 @@ class HydratorPlusPlusTopPanelCtrl {\n     };\n     this.previewLoading = true;\n     this.loadingLabel = 'Stopping';\n-    this.stopTimer();\n-    this.updateTimerLabelAndTitle();\n     this.myPipelineApi\n         .stopPreview(params, {})\n         .$promise\n         .then(\n-          (err) => {\n+          () => {\n+            this.stopTimer();\n+            this.updateTimerLabelAndTitle();\n             this.previewLoading = false;\n             this.previewRunning = false;\n+            this.dataSrc.stopPoll(this.pollId);\n+            this.pollId = null;\n+\n+            let pipelinePreviewPlaceholder = 'The preview of the pipeline';\n+            let pipelineName = this.HydratorPlusPlusConfigStore.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdf0e17f117fdd08434e56611a7d855ee7c930c4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTU2NTc2", "url": "https://github.com/cdapio/cdap/pull/12546#pullrequestreview-461956576", "createdAt": "2020-08-05T19:23:05Z", "commit": {"oid": "0127139aa8dba490049179a5b7db52b0a642f89b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13c50c43d37ea000e6312f6e9d56ec87eec02da2", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/13c50c43d37ea000e6312f6e9d56ec87eec02da2", "committedDate": "2020-08-05T19:25:58Z", "message": "Fix stop preview callback to remove empty error banner and allow retry to stop preview\n\nReset timer label when backend status returns error\n\nLet user retry stopping preview run if preview stop returns error from backend\n\nStop polling for preview status and show stop success banner as long as backend does not reply with error when stopping  preview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6a4d17083a7bc8ba5e23117109259875ecdacc8", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/b6a4d17083a7bc8ba5e23117109259875ecdacc8", "committedDate": "2020-08-05T19:26:01Z", "message": "Fix arguments for stopping pools in datasource"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0127139aa8dba490049179a5b7db52b0a642f89b", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/0127139aa8dba490049179a5b7db52b0a642f89b", "committedDate": "2020-08-05T19:17:12Z", "message": "Address feedback and fix linter error"}, "afterCommit": {"oid": "b6a4d17083a7bc8ba5e23117109259875ecdacc8", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/b6a4d17083a7bc8ba5e23117109259875ecdacc8", "committedDate": "2020-08-05T19:26:01Z", "message": "Fix arguments for stopping pools in datasource"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1749, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}