{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzM3Mjc1", "number": 12441, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoyNTozN1rOEPVvgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo0NDo0NVrOEQYdOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTIwMzIyOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoyNTozN1rOGzAHlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTozNTozM1rOG0cb5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzMjUwMQ==", "bodyText": "we have moment.js to help with this", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r456132501", "createdAt": "2020-07-16T23:25:37Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -141,17 +161,44 @@ const RequestHistoryTabView: React.FC<IRequestHistoryTabProps> = ({\n   onRequestClick,\n   resetIncomingRequest,\n }) => {\n-  const [requestLog, setRequestLog] = React.useState(List<IRequestHistory>([]));\n+  const [requestLog, setRequestLog] = React.useState(\n+    Map<string, List<IRequestHistory>>({}) // maps timestamp date (e.g. April 5th) to a list of corresponding request histories\n+  );\n+\n+  const convertDateToString = (date: Date) => {\n+    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\n+    return date.toLocaleDateString('en-US', options);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3d76a947407786525f98fff385b894d3fd21625"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTAzMA==", "bodyText": "done", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457645030", "createdAt": "2020-07-20T19:35:33Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -141,17 +161,44 @@ const RequestHistoryTabView: React.FC<IRequestHistoryTabProps> = ({\n   onRequestClick,\n   resetIncomingRequest,\n }) => {\n-  const [requestLog, setRequestLog] = React.useState(List<IRequestHistory>([]));\n+  const [requestLog, setRequestLog] = React.useState(\n+    Map<string, List<IRequestHistory>>({}) // maps timestamp date (e.g. April 5th) to a list of corresponding request histories\n+  );\n+\n+  const convertDateToString = (date: Date) => {\n+    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\n+    return date.toLocaleDateString('en-US', options);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzMjUwMQ=="}, "originalCommit": {"oid": "d3d76a947407786525f98fff385b894d3fd21625"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjEwNDY4OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTozNDoxM1rOG0gFPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo1Njo0MFrOG0grIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNDc2NQ==", "bodyText": "use color already defined in the theme palettes", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457704765", "createdAt": "2020-07-20T21:34:13Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -102,9 +112,20 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n+const StyledExpansionPanel = withStyles(() => ({\n+  root: {\n+    '&$expanded': {\n+      margin: 0,\n+    },\n+    borderBottom: '1px solid #C0C0C0',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDQ2NQ==", "bodyText": "Done", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457714465", "createdAt": "2020-07-20T21:56:40Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -102,9 +112,20 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n+const StyledExpansionPanel = withStyles(() => ({\n+  root: {\n+    '&$expanded': {\n+      margin: 0,\n+    },\n+    borderBottom: '1px solid #C0C0C0',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNDc2NQ=="}, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjExODUwOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/HttpExecutor/store/HttpExecutorStore.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTozOToyMVrOG0gNsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo0NjoyNlrOG0gZrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNjkyOA==", "bodyText": "isn't valueSeq() already returns a List? do you still need the Array.from?", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457706928", "createdAt": "2020-07-20T21:39:21Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/store/HttpExecutorStore.js", "diffHunk": "@@ -62,10 +63,21 @@ const setResponse = (state, action) => {\n     timestamp: new Date().toLocaleString(),\n   };\n \n-  const newRequestLog = requestLog.push(newCall);\n+  // Update the component view in real-time, since we cannot listen to local storage's change\n+  // Since the new request call is the latest out of all the request histories, insert at 0th index\n+  const timestamp = new Date(newCall.timestamp);\n+  const dateID = getDateID(timestamp);\n+  const requestsGroup = getRequestsByDate(requestLog, dateID);\n+  const newRequestLog = requestLog.set(dateID, requestsGroup.insert(0, newCall));\n \n-  // saving of the request to the localStorage\n-  localStorage.setItem(REQUEST_HISTORY, JSON.stringify(newRequestLog));\n+  // Saving request histories to the localStorage\n+  let storedLogs = List([]);\n+  Array.from(newRequestLog.valueSeq()).forEach((requests) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTk5OQ==", "bodyText": "valueSeq returns iterator", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457709999", "createdAt": "2020-07-20T21:46:26Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/store/HttpExecutorStore.js", "diffHunk": "@@ -62,10 +63,21 @@ const setResponse = (state, action) => {\n     timestamp: new Date().toLocaleString(),\n   };\n \n-  const newRequestLog = requestLog.push(newCall);\n+  // Update the component view in real-time, since we cannot listen to local storage's change\n+  // Since the new request call is the latest out of all the request histories, insert at 0th index\n+  const timestamp = new Date(newCall.timestamp);\n+  const dateID = getDateID(timestamp);\n+  const requestsGroup = getRequestsByDate(requestLog, dateID);\n+  const newRequestLog = requestLog.set(dateID, requestsGroup.insert(0, newCall));\n \n-  // saving of the request to the localStorage\n-  localStorage.setItem(REQUEST_HISTORY, JSON.stringify(newRequestLog));\n+  // Saving request histories to the localStorage\n+  let storedLogs = List([]);\n+  Array.from(newRequestLog.valueSeq()).forEach((requests) => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNjkyOA=="}, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjEzMzY5OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/HttpExecutor/utilities.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo0NDo0NVrOG0gWww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo1MzozNlrOG0gltQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTI1MQ==", "bodyText": "i think this is supposed to be MMMM D. d is day of the week, not month", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457709251", "createdAt": "2020-07-20T21:44:45Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/utilities.ts", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { List, Map } from 'immutable';\n+\n+import { IRequestHistory } from 'components/HttpExecutor/RequestHistoryTab';\n+import moment from 'moment';\n+\n+export function getDateID(date: Date) {\n+  return moment(date).format('dddd, MMMM d, YYYY');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMzA3Nw==", "bodyText": "Done", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457713077", "createdAt": "2020-07-20T21:53:36Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/components/HttpExecutor/utilities.ts", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { List, Map } from 'immutable';\n+\n+import { IRequestHistory } from 'components/HttpExecutor/RequestHistoryTab';\n+import moment from 'moment';\n+\n+export function getDateID(date: Date) {\n+  return moment(date).format('dddd, MMMM d, YYYY');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTI1MQ=="}, "originalCommit": {"oid": "a4fe9f441caced22b9e19437a6207fe30912964f"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3345, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}