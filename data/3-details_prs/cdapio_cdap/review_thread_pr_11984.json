{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwODE4NTc5", "number": 11984, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyMjo1OFrODrxsZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyNzoxOFrODrxzjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjI5NTQyOnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyMjo1OFrOF8UifQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo1NzowM1rOF8aGxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTM4OQ==", "bodyText": "you are anyway exposing these bindings, then you don't need to remove these in private module, in the private module, you can just have the ArtifactRepositoryReader binding.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398795389", "createdAt": "2020-03-26T18:22:58Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -294,11 +297,23 @@ protected void configure() {\n       bind(OwnerAdmin.class).to(DefaultOwnerAdmin.class);\n       bind(CoreSchedulerService.class).in(Scopes.SINGLETON);\n       bind(Scheduler.class).to(CoreSchedulerService.class);\n-      bind(ArtifactRepository.class)\n-        .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n-        .to(DefaultArtifactRepository.class)\n-        .in(Scopes.SINGLETON);\n-      bind(ArtifactRepository.class).to(AuthorizationArtifactRepository.class).in(Scopes.SINGLETON);\n+      install(new PrivateModule() {\n+        @Override\n+        protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n+\n+          bind(ArtifactRepository.class)\n+            .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n+            .to(DefaultArtifactRepository.class)\n+            .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class).annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NjMyMQ==", "bodyText": "also is ArtifactRepositoryReader only used by ArtifactRepository? If some other classes wants to use it, will it fail to inject because it is private?", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398796321", "createdAt": "2020-03-26T18:24:17Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -294,11 +297,23 @@ protected void configure() {\n       bind(OwnerAdmin.class).to(DefaultOwnerAdmin.class);\n       bind(CoreSchedulerService.class).in(Scopes.SINGLETON);\n       bind(Scheduler.class).to(CoreSchedulerService.class);\n-      bind(ArtifactRepository.class)\n-        .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n-        .to(DefaultArtifactRepository.class)\n-        .in(Scopes.SINGLETON);\n-      bind(ArtifactRepository.class).to(AuthorizationArtifactRepository.class).in(Scopes.SINGLETON);\n+      install(new PrivateModule() {\n+        @Override\n+        protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n+\n+          bind(ArtifactRepository.class)\n+            .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n+            .to(DefaultArtifactRepository.class)\n+            .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class).annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTM4OQ=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwNTYxMA==", "bodyText": "I think we would need to have bind(RepoReader) and bind(Repo) in the same module otherwise RepoReader binding is not visible to bind(Repo).\nYes. RepoReader is intended to be used by Repo only at this moment.\nYes. If other classes need to use it. They would do something like\nPrivateModule {\nbind(RepoReader).to(...)\nbind(SomeClassInterface).to(SomeClassImpl)\n}", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398805610", "createdAt": "2020-03-26T18:38:41Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -294,11 +297,23 @@ protected void configure() {\n       bind(OwnerAdmin.class).to(DefaultOwnerAdmin.class);\n       bind(CoreSchedulerService.class).in(Scopes.SINGLETON);\n       bind(Scheduler.class).to(CoreSchedulerService.class);\n-      bind(ArtifactRepository.class)\n-        .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n-        .to(DefaultArtifactRepository.class)\n-        .in(Scopes.SINGLETON);\n-      bind(ArtifactRepository.class).to(AuthorizationArtifactRepository.class).in(Scopes.SINGLETON);\n+      install(new PrivateModule() {\n+        @Override\n+        protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n+\n+          bind(ArtifactRepository.class)\n+            .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n+            .to(DefaultArtifactRepository.class)\n+            .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class).annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTM4OQ=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNjI3OA==", "bodyText": "That is my concern since the purpose of binding is to make injection easier, a private module should only be used if a class is specific to some other classes. If some other classes needs an interface, they need to bind it themselves, that's no different than calling the constructor themselves.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398816278", "createdAt": "2020-03-26T18:54:51Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -294,11 +297,23 @@ protected void configure() {\n       bind(OwnerAdmin.class).to(DefaultOwnerAdmin.class);\n       bind(CoreSchedulerService.class).in(Scopes.SINGLETON);\n       bind(Scheduler.class).to(CoreSchedulerService.class);\n-      bind(ArtifactRepository.class)\n-        .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n-        .to(DefaultArtifactRepository.class)\n-        .in(Scopes.SINGLETON);\n-      bind(ArtifactRepository.class).to(AuthorizationArtifactRepository.class).in(Scopes.SINGLETON);\n+      install(new PrivateModule() {\n+        @Override\n+        protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n+\n+          bind(ArtifactRepository.class)\n+            .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n+            .to(DefaultArtifactRepository.class)\n+            .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class).annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTM4OQ=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NjU5OA==", "bodyText": "The use case here is using private module to allow different bindings for the same class. As in a follow-up CL, RepoReader class will be bound to local in appfabric and remote for preview when we use local level DB.\nHere is a stackoverflow thread related to this topic\nhttps://stackoverflow.com/questions/16987815/guice-binding-several-objects-with-different-dependencies\nIn general, if we require class A to always be bound to class AImpl, then yes probably no need to use private module, or use private with expose. But if we need to bind class A to class AImplX or class AImplY depending on some other condition, then private module make the binding easy and cleaner to do.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398886598", "createdAt": "2020-03-26T20:57:03Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/AppFabricServiceRuntimeModule.java", "diffHunk": "@@ -294,11 +297,23 @@ protected void configure() {\n       bind(OwnerAdmin.class).to(DefaultOwnerAdmin.class);\n       bind(CoreSchedulerService.class).in(Scopes.SINGLETON);\n       bind(Scheduler.class).to(CoreSchedulerService.class);\n-      bind(ArtifactRepository.class)\n-        .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n-        .to(DefaultArtifactRepository.class)\n-        .in(Scopes.SINGLETON);\n-      bind(ArtifactRepository.class).to(AuthorizationArtifactRepository.class).in(Scopes.SINGLETON);\n+      install(new PrivateModule() {\n+        @Override\n+        protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n+\n+          bind(ArtifactRepository.class)\n+            .annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO))\n+            .to(DefaultArtifactRepository.class)\n+            .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class).annotatedWith(Names.named(NOAUTH_ARTIFACT_REPO));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTM4OQ=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjI5NjI0OnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/InMemoryProgramRunnerModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyMzoxMVrOF8UjBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODozODo1NlrOF8VLDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTUyNA==", "bodyText": "nit - unused imports?", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398795524", "createdAt": "2020-03-26T18:23:11Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/InMemoryProgramRunnerModule.java", "diffHunk": "@@ -32,7 +33,11 @@\n import io.cdap.cdap.common.discovery.ResolvingDiscoverable;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactFinder;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactManagerFactory;\n+import io.cdap.cdap.internal.app.runtime.artifact.ArtifactRepository;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwNTc3NQ==", "bodyText": "Removed", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398805775", "createdAt": "2020-03-26T18:38:56Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/guice/InMemoryProgramRunnerModule.java", "diffHunk": "@@ -32,7 +33,11 @@\n import io.cdap.cdap.common.discovery.ResolvingDiscoverable;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactFinder;\n import io.cdap.cdap.internal.app.runtime.artifact.ArtifactManagerFactory;\n+import io.cdap.cdap.internal.app.runtime.artifact.ArtifactRepository;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NTUyNA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjMwMzMxOnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/DefaultPreviewManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyNDo0MlrOF8UnHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODozOTo1OVrOF8VNrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NjU3NA==", "bodyText": "Same here, you are exposing this binding anyway, why make it private", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398796574", "createdAt": "2020-03-26T18:24:42Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/DefaultPreviewManager.java", "diffHunk": "@@ -345,25 +348,35 @@ protected void configure() {\n         }\n       }),\n       new ProvisionerModule(),\n-      new AbstractModule() {\n+      new PrivateModule() {\n         @Override\n         protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n           bind(ArtifactRepository.class)\n             .annotatedWith(Names.named(AppFabricServiceRuntimeModule.NOAUTH_ARTIFACT_REPO))\n             .to(DefaultArtifactRepository.class)\n             .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwNjQ0Ng==", "bodyText": "This way we limit the visibility of RepoReader's binding, meaning others can bind RepoReader differently.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398806446", "createdAt": "2020-03-26T18:39:59Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/preview/DefaultPreviewManager.java", "diffHunk": "@@ -345,25 +348,35 @@ protected void configure() {\n         }\n       }),\n       new ProvisionerModule(),\n-      new AbstractModule() {\n+      new PrivateModule() {\n         @Override\n         protected void configure() {\n+          // ArtifactRepositoryReader is required by DefaultArtifactRepository.\n+          // Keep ArtifactRepositoryReader private to minimize the scope of the binding visibility.\n+          bind(ArtifactRepositoryReader.class).to(LocalArtifactRepositoryReader.class).in(Scopes.SINGLETON);\n           bind(ArtifactRepository.class)\n             .annotatedWith(Names.named(AppFabricServiceRuntimeModule.NOAUTH_ARTIFACT_REPO))\n             .to(DefaultArtifactRepository.class)\n             .in(Scopes.SINGLETON);\n+          expose(ArtifactRepository.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NjU3NA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjMwNzYwOnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyNTo0MVrOF8UpzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTowNjo0NlrOF8fy0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA==", "bodyText": "why do we make this change? Is this class used anywhere in the response? If so, this is changing the API behavior", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398797260", "createdAt": "2020-03-26T18:25:41Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTk3NA==", "bodyText": "This PR introduces a REST endpoint for getting artifact detail, thus requiring support for serialization and deserialization. But Location is an interface that cannot be sterilized easily, thus ignoring this field and using location URI instead. The requester would need to convert from Location URI to Location using proper location factory.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398809974", "createdAt": "2020-03-26T18:45:37Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxODgwMw==", "bodyText": "This means when it get deserialized, the location will be null, which makes this class unreliable, is it necessary to return the entire ArtifactDetail back in the REST call, can we just return a subset of them?", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398818803", "createdAt": "2020-03-26T18:58:51Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxODkzNw==", "bodyText": "This means when it get deserialized, the location will be null, which makes this class unreliable, is it necessary to return the entire ArtifactDetail back in the REST call, can we just return a subset of them?", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398818937", "createdAt": "2020-03-26T18:59:02Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxMzY3Mw==", "bodyText": "Correct on location will be null. But the Remote repo reader client side implication inits Location so it returns a complete ArtifactDetail to the caller.\nActually Location object is one of the key info we need to fetch from remote for preview.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398913673", "createdAt": "2020-03-26T21:49:13Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3Njg5Ng==", "bodyText": "Better to put a comment about this, otherwise it will be super confusing to future development", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398976896", "createdAt": "2020-03-27T00:55:15Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3OTc5Mg==", "bodyText": "Okay. Added some more to the description.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398979792", "createdAt": "2020-03-27T01:06:46Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/ArtifactDescriptor.java", "diffHunk": "@@ -19,17 +19,27 @@\n import io.cdap.cdap.api.artifact.ArtifactId;\n import org.apache.twill.filesystem.Location;\n \n+import java.net.URI;\n+\n /**\n  * Uniquely describes an artifact. Artifact descriptors are ordered by scope,\n  * then by name, and finally by version.\n  */\n public final class ArtifactDescriptor implements Comparable<ArtifactDescriptor> {\n   private final ArtifactId artifactId;\n-  private final Location location;\n+\n+  /**\n+   * Mark with transient to not serialize it. Store the location URI in separate field \"locationURI\" that\n+   * gets serialized when this object needs to be transferred through the network.\n+   * The recipient should instantiate a {@link Location} based on the received \"locationURI\"\n+   */\n+  private final transient Location location;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzI2MA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjMxMzc0OnYy", "diffSide": "RIGHT", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoyNzoxOFrOF8UtuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODo0NjozM1rOF8VdtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5ODI2NA==", "bodyText": "I don't see this class is binded in anywhere, where should it get bind?", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398798264", "createdAt": "2020-03-26T18:27:18Z", "author": {"login": "yaojiefeng"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.runtime.artifact;\n+\n+import com.google.common.reflect.TypeToken;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.inject.Inject;\n+import io.cdap.cdap.api.data.schema.Schema;\n+import io.cdap.cdap.common.NotFoundException;\n+import io.cdap.cdap.common.conf.Constants;\n+import io.cdap.cdap.common.http.DefaultHttpRequestConfig;\n+import io.cdap.cdap.common.id.Id;\n+import io.cdap.cdap.common.internal.remote.RemoteClient;\n+import io.cdap.cdap.common.io.Locations;\n+import io.cdap.cdap.gateway.handlers.ArtifactHttpHandlerInternal;\n+import io.cdap.cdap.internal.io.SchemaTypeAdapter;\n+import io.cdap.common.http.HttpMethod;\n+import io.cdap.common.http.HttpRequest;\n+import io.cdap.common.http.HttpResponse;\n+import org.apache.twill.discovery.DiscoveryServiceClient;\n+import org.apache.twill.filesystem.Location;\n+import org.apache.twill.filesystem.LocationFactory;\n+import sun.net.www.protocol.http.HttpURLConnection;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+\n+\n+/**\n+ * Implementation for fetching artifact metadata from remote {@link ArtifactHttpHandlerInternal}\n+ */\n+public class RemoteArtifactRepositoryReader implements ArtifactRepositoryReader {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxMDU0OA==", "bodyText": "Remote repo reader isn't being used anywhere yet. In the next PR, will make preview to use remote repo reader for local levelDB.", "url": "https://github.com/cdapio/cdap/pull/11984#discussion_r398810548", "createdAt": "2020-03-26T18:46:33Z", "author": {"login": "wyzhang"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.runtime.artifact;\n+\n+import com.google.common.reflect.TypeToken;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.inject.Inject;\n+import io.cdap.cdap.api.data.schema.Schema;\n+import io.cdap.cdap.common.NotFoundException;\n+import io.cdap.cdap.common.conf.Constants;\n+import io.cdap.cdap.common.http.DefaultHttpRequestConfig;\n+import io.cdap.cdap.common.id.Id;\n+import io.cdap.cdap.common.internal.remote.RemoteClient;\n+import io.cdap.cdap.common.io.Locations;\n+import io.cdap.cdap.gateway.handlers.ArtifactHttpHandlerInternal;\n+import io.cdap.cdap.internal.io.SchemaTypeAdapter;\n+import io.cdap.common.http.HttpMethod;\n+import io.cdap.common.http.HttpRequest;\n+import io.cdap.common.http.HttpResponse;\n+import org.apache.twill.discovery.DiscoveryServiceClient;\n+import org.apache.twill.filesystem.Location;\n+import org.apache.twill.filesystem.LocationFactory;\n+import sun.net.www.protocol.http.HttpURLConnection;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+\n+\n+/**\n+ * Implementation for fetching artifact metadata from remote {@link ArtifactHttpHandlerInternal}\n+ */\n+public class RemoteArtifactRepositoryReader implements ArtifactRepositoryReader {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5ODI2NA=="}, "originalCommit": {"oid": "bd68eecb5b1d8ca861c49d29421856f2e3162780"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2861, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}