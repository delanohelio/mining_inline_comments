{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MDk2ODM2", "number": 12724, "title": "[CDAP-17239] Fix AuthorizerInstantiator Classloading Bug", "bodyText": "See CDAP-17239 and CDAP-17240.\nIn CDAP StandaloneMain, the AuthorizerInstantiator unpacks the custom authorization extension JAR file into a folder in data/tmp. However, the AuthorizerInstantiator is actually created in the constructor for StandaloneMain, and then cleanupTempDir() is called in startup(). This causes the unpacked JAR files to be deleted immediately after instantiation.\nClassLoaders generally perform lazy loading, which means that if an authorization extension attempts to load a class after this runtime classpath is deleted, it will throw a ClassNotFoundException.", "createdAt": "2020-08-26T19:02:37Z", "url": "https://github.com/cdapio/cdap/pull/12724", "merged": true, "mergeCommit": {"oid": "3a94e5b2822a73648badf7a8cbe85678bd64b832"}, "closed": true, "closedAt": "2020-08-27T00:49:10Z", "author": {"login": "dli357"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCwpocAFqTQ3NTc3OTYzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCzXL3ABqjM2OTY4MDk3NTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Nzc5NjMy", "url": "https://github.com/cdapio/cdap/pull/12724#pullrequestreview-475779632", "createdAt": "2020-08-26T19:06:00Z", "commit": {"oid": "b0c0fb152433c41a02c5ec30cc628a0fe0b23d5d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Nzg0MTIx", "url": "https://github.com/cdapio/cdap/pull/12724#pullrequestreview-475784121", "createdAt": "2020-08-26T19:12:38Z", "commit": {"oid": "b0c0fb152433c41a02c5ec30cc628a0fe0b23d5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxOToxMjozOFrOHHaIZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxOToxMjozOFrOHHaIZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUzMDIxNQ==", "bodyText": "Can we put a comment here to explain what we expect for this cleanup in constructor.", "url": "https://github.com/cdapio/cdap/pull/12724#discussion_r477530215", "createdAt": "2020-08-26T19:12:38Z", "author": {"login": "shifuxu0301"}, "path": "cdap-standalone/src/main/java/io/cdap/cdap/StandaloneMain.java", "diffHunk": "@@ -162,6 +162,8 @@ private StandaloneMain(List<Module> modules, CConfiguration cConf) {\n     Thread.setDefaultUncaughtExceptionHandler(new UncaughtExceptionHandler());\n     this.cConf = cConf;\n \n+    cleanupTempDir();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0c0fb152433c41a02c5ec30cc628a0fe0b23d5d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NzkxMzIx", "url": "https://github.com/cdapio/cdap/pull/12724#pullrequestreview-475791321", "createdAt": "2020-08-26T19:23:22Z", "commit": {"oid": "43d198f34ada9e7a74db909a34819de08aaabde6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43d198f34ada9e7a74db909a34819de08aaabde6", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/43d198f34ada9e7a74db909a34819de08aaabde6", "committedDate": "2020-08-26T19:22:55Z", "message": "[CDAP-17239] Added comment"}, "afterCommit": {"oid": "cbd5637521fc759aaa049f16ba0361ced58443c9", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/cbd5637521fc759aaa049f16ba0361ced58443c9", "committedDate": "2020-08-26T19:24:44Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n[CDAP-17239] Added comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdddabde57b212c34abfd47fffd6dcf90c314ea6", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/bdddabde57b212c34abfd47fffd6dcf90c314ea6", "committedDate": "2020-08-26T20:27:27Z", "message": "[CDAP-17239] Moved temporary directory cleanup logic out of constructor"}, "afterCommit": {"oid": "f190a48593715706f33351e1320ab6b72ebc8622", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/f190a48593715706f33351e1320ab6b72ebc8622", "committedDate": "2020-08-26T20:28:04Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n[CDAP-17239] Added comment\n\n[CDAP-17239] Moved temporary directory cleanup logic out of constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODQxMjgw", "url": "https://github.com/cdapio/cdap/pull/12724#pullrequestreview-475841280", "createdAt": "2020-08-26T20:38:43Z", "commit": {"oid": "f190a48593715706f33351e1320ab6b72ebc8622"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f190a48593715706f33351e1320ab6b72ebc8622", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/f190a48593715706f33351e1320ab6b72ebc8622", "committedDate": "2020-08-26T20:28:04Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n[CDAP-17239] Added comment\n\n[CDAP-17239] Moved temporary directory cleanup logic out of constructor"}, "afterCommit": {"oid": "ee371d22b6bda5af01f78bb92bd96e715ff9023c", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/ee371d22b6bda5af01f78bb92bd96e715ff9023c", "committedDate": "2020-08-26T20:49:32Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n    [CDAP-17239] Added comment\n\n    [CDAP-17239] Moved temporary directory cleanup logic out of constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODY2OTI4", "url": "https://github.com/cdapio/cdap/pull/12724#pullrequestreview-475866928", "createdAt": "2020-08-26T21:19:08Z", "commit": {"oid": "ee371d22b6bda5af01f78bb92bd96e715ff9023c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMToxOTowOFrOHHeHpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMToxOTowOFrOHHeHpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU5NTU1OQ==", "bodyText": "Construct the path at callsite and pass that in, so it is clear what state the function needs instead of passing the whole configuration structure that this function doesn't care about the other n-2 fields", "url": "https://github.com/cdapio/cdap/pull/12724#discussion_r477595559", "createdAt": "2020-08-26T21:19:08Z", "author": {"login": "wyzhang"}, "path": "cdap-standalone/src/main/java/io/cdap/cdap/StandaloneMain.java", "diffHunk": "@@ -392,7 +390,7 @@ public void shutDown() {\n     }\n   }\n \n-  private void cleanupTempDir() {\n+  private static void cleanupTempDir(CConfiguration cConf) {\n     File tmpDir = new File(cConf.get(Constants.CFG_LOCAL_DATA_DIR),\n                            cConf.get(Constants.AppFabric.TEMP_DIR)).getAbsoluteFile();\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee371d22b6bda5af01f78bb92bd96e715ff9023c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e017022c3eddf70330947cb3f5c29cb55883b34f", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/e017022c3eddf70330947cb3f5c29cb55883b34f", "committedDate": "2020-08-26T22:15:17Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n    [CDAP-17239] Added comment\n\n    [CDAP-17239] Moved temporary directory cleanup logic out of constructor\n\n[CDAP-17239] Construct tmpDir outside of static method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee371d22b6bda5af01f78bb92bd96e715ff9023c", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/ee371d22b6bda5af01f78bb92bd96e715ff9023c", "committedDate": "2020-08-26T20:49:32Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n    [CDAP-17239] Added comment\n\n    [CDAP-17239] Moved temporary directory cleanup logic out of constructor"}, "afterCommit": {"oid": "e017022c3eddf70330947cb3f5c29cb55883b34f", "author": {"user": {"login": "dli357", "name": "Dennis Li"}}, "url": "https://github.com/cdapio/cdap/commit/e017022c3eddf70330947cb3f5c29cb55883b34f", "committedDate": "2020-08-26T22:15:17Z", "message": "[CDAP-17239] Fix classloading bug where the classpath directory is deleted in StandaloneMain\n\n    [CDAP-17239] Added comment\n\n    [CDAP-17239] Moved temporary directory cleanup logic out of constructor\n\n[CDAP-17239] Construct tmpDir outside of static method"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1742, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}