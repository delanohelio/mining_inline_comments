{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDAyNjYz", "number": 12888, "title": "[CDAP-17282] Update UI to use new Drafts API + manages existing drafts in user store", "bodyText": "We now have a new draft API as part of the pipeline studio service\nUI is now updated to use the new draft API by default.\nExisting drafts in user store will slowly transitioned to use new drafts API as and when the user re-saves the draft (saves it to new api and deletes the old draft)\n\nJIRA - https://cdap.atlassian.net/browse/CDAP-17282\non-hold until backend PR is merged - #12885", "createdAt": "2020-12-07T23:03:25Z", "url": "https://github.com/cdapio/cdap/pull/12888", "merged": true, "mergeCommit": {"oid": "02d19245d00364e274116aa86eb905a82d5f4405"}, "closed": true, "closedAt": "2020-12-15T21:30:43Z", "author": {"login": "ajainarayanan"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdksLP0gFqTU0ODgyMDU5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmfPmLgBqjQxMTYyMTIzNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4ODIwNTk0", "url": "https://github.com/cdapio/cdap/pull/12888#pullrequestreview-548820594", "createdAt": "2020-12-10T05:03:18Z", "commit": {"oid": "a5f1428dc1f1edc74a4d433b5a6bb00029f83a52"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNTowMzoxOFrOIC1qzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNTowMzoxOFrOIC1qzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg0NzM3Mw==", "bodyText": "nit: is there a need for the extra div?", "url": "https://github.com/cdapio/cdap/pull/12888#discussion_r539847373", "createdAt": "2020-12-10T05:03:18Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/PipelineList/DraftPipelineView/DraftTable/DraftTableRow.tsx", "diffHunk": "@@ -31,20 +31,23 @@ export default class DraftTableRow extends React.PureComponent<IProps> {\n   public render() {\n     const draft = this.props.draft;\n     const namespace = getCurrentNamespace();\n-    const lastSaved = humanReadableDate(draft.__ui__.lastSaved, true);\n+    const lastSaved = humanReadableDate(\n+      draft.needsUpgrade ? draft.__ui__.lastSaved : draft.updatedTimeMillis,\n+      true\n+    );\n \n     const link = window.getHydratorUrl({\n       stateName: 'hydrator.create',\n       stateParams: {\n         namespace,\n-        draftId: draft.__ui__.draftId,\n+        draftId: draft.needsUpgrade ? draft.__ui__.draftId : draft.id,\n       },\n     });\n \n     return (\n       <a href={link} className=\"grid-row\" data-cy={`draft-${draft.name}`}>\n         <div className=\"name\" title={draft.name}>\n-          {draft.name}\n+          <div>{draft.name}</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f1428dc1f1edc74a4d433b5a6bb00029f83a52"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddcb3a80496dd9116af40152770f41a42844dc45", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/ddcb3a80496dd9116af40152770f41a42844dc45", "committedDate": "2020-12-15T19:09:56Z", "message": "[CDAP-17282] Update UI to use new Drafts API + manages existing drafts in user store\n\n  - Adds pipeline api for draft management on react side\n  - Adds pipeline api for draft management on angular side\n  - Updates Pipeline drafts list view to handle listing old and new drafts + upgrade old drafts to use new api\n  - Fixes pipeline studio to save to use new drafts API + manage editing and publishing pipelines from old drafts\n  - Fixes one click pipeline deploy to use new draft api\n  - Adds e2e test for migrating away to new draft UI from UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66ae2b03811009013c7eddbbd540ad13af09aa14", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/66ae2b03811009013c7eddbbd540ad13af09aa14", "committedDate": "2020-12-15T19:09:06Z", "message": "Address review comments"}, "afterCommit": {"oid": "ddcb3a80496dd9116af40152770f41a42844dc45", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/ddcb3a80496dd9116af40152770f41a42844dc45", "committedDate": "2020-12-15T19:09:56Z", "message": "[CDAP-17282] Update UI to use new Drafts API + manages existing drafts in user store\n\n  - Adds pipeline api for draft management on react side\n  - Adds pipeline api for draft management on angular side\n  - Updates Pipeline drafts list view to handle listing old and new drafts + upgrade old drafts to use new api\n  - Fixes pipeline studio to save to use new drafts API + manage editing and publishing pipelines from old drafts\n  - Fixes one click pipeline deploy to use new draft api\n  - Adds e2e test for migrating away to new draft UI from UI"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1398, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}