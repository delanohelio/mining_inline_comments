{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTIyNjYz", "number": 11816, "title": "[CDAP-16201] Integration test for stage level validation", "bodyText": "This PR has integration test that covers validating properties of a plugin in a pipeline.\nJIRA: https://issues.cask.co/browse/CDAP-16201", "createdAt": "2020-01-09T19:35:03Z", "url": "https://github.com/cdapio/cdap/pull/11816", "merged": true, "mergeCommit": {"oid": "8565eba4309c986e2b1c99648acf8178e8bd025c"}, "closed": true, "closedAt": "2020-01-29T16:37:12Z", "author": {"login": "itsanudeep"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5FbicgFqTM0MTQzMDE4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-7zZHABqjI5ODc4OTkwMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDMwMTg2", "url": "https://github.com/cdapio/cdap/pull/11816#pullrequestreview-341430186", "createdAt": "2020-01-10T21:25:15Z", "commit": {"oid": "50eb08ea65fe49f00c26f706ca429bcc64e0888b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMToyNToxNVrOFcgdKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMToyNzo0OFrOFcggcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQzNjIwMg==", "bodyText": "nit: Shouldn't validation fail for this? I neither see a dataset named randomDataset nor a table named randomTableName. When I try to manually test this locally it seems to show the right error message.", "url": "https://github.com/cdapio/cdap/pull/11816#discussion_r365436202", "createdAt": "2020-01-10T21:25:15Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/cypress/integration/plugins.validation.spec.ts", "diffHunk": "@@ -0,0 +1,104 @@\n+import {getArtifactsPoll, loginIfRequired} from '../helpers';\n+import {DEFAULT_BIGQUERY_DATASET, DEFAULT_BIGQUERY_TABLE, DEFAULT_GCP_PROJECTID, DEFAULT_GCP_SERVICEACCOUNT_PATH} from '../support/constants';\n+import {INodeInfo} from '../typings';\n+\n+const sourceNode: INodeInfo = {\n+  nodeName: 'BigQueryTable',\n+  nodeType: 'batchsource'\n+};\n+\n+const sourceProperties = {\n+  referenceName: 'BQ_Source',\n+  project: DEFAULT_GCP_PROJECTID,\n+  datasetProject: DEFAULT_GCP_PROJECTID,\n+  dataset: DEFAULT_BIGQUERY_DATASET,\n+  table: DEFAULT_BIGQUERY_TABLE,\n+  serviceFilePath: DEFAULT_GCP_SERVICEACCOUNT_PATH,\n+};\n+\n+let headers = {};\n+\n+describe('Plugin properties', () => {\n+  // Uses API call to login instead of logging in manually through UI\n+  before(() => {\n+    loginIfRequired().then(() => {\n+      cy.getCookie('CDAP_Auth_Token').then((cookie) => {\n+        if (!cookie) {\n+          return;\n+        }\n+        headers = {\n+          Authorization: 'Bearer ' + cookie.value,\n+        };\n+      });\n+    });\n+    cy.visit('/pipelines/ns/default/studio');\n+  });\n+\n+  beforeEach(() => {\n+    getArtifactsPoll(headers);\n+  });\n+\n+  it('should be validated and errors found in properties', () => {\n+    cy.add_node_to_canvas(sourceNode);\n+    cy.get(\n+          '[data-cy=\"plugin-node-BigQueryTable-batchsource-0\"] .node .node-configure-btn')\n+        .invoke('show')\n+        .click();\n+    // Testing for errors found, rgb(164, 4, 3) is the red border color\n+    cy.get('[data-cy=\"plugin-properties-validate-btn\"]').click();\n+    cy.get('[data-cy=\"plugin-properties-errors-found\"]')\n+        .should('have.text', '3 errors found.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');\n+    // Testing if the widget is highlighted when there is an error\n+    // and the error text\n+    cy.get('[data-cy=\"referenceName\"] ~ [data-cy=\"property-row-error\"]')\n+        .should(\n+            'have.text', 'Required property \\'referenceName\\' has no value.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');\n+  });\n+\n+  it('should be validated and no errors found in plugin properties', () => {\n+    // Testing for no errors found\n+    cy.get('input[data-cy=\"referenceName\"]').type('randomName');\n+    cy.get('input[data-cy=\"dataset\"]').type('randomDataset');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50eb08ea65fe49f00c26f706ca429bcc64e0888b"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQzNjQzNg==", "bodyText": "nit: One suggestion would be to make this into a variable. Tomorrow if we decided to change the shade of red this would need to be updated in more places if we have more tests testing for color.", "url": "https://github.com/cdapio/cdap/pull/11816#discussion_r365436436", "createdAt": "2020-01-10T21:25:57Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/cypress/integration/plugins.validation.spec.ts", "diffHunk": "@@ -0,0 +1,104 @@\n+import {getArtifactsPoll, loginIfRequired} from '../helpers';\n+import {DEFAULT_BIGQUERY_DATASET, DEFAULT_BIGQUERY_TABLE, DEFAULT_GCP_PROJECTID, DEFAULT_GCP_SERVICEACCOUNT_PATH} from '../support/constants';\n+import {INodeInfo} from '../typings';\n+\n+const sourceNode: INodeInfo = {\n+  nodeName: 'BigQueryTable',\n+  nodeType: 'batchsource'\n+};\n+\n+const sourceProperties = {\n+  referenceName: 'BQ_Source',\n+  project: DEFAULT_GCP_PROJECTID,\n+  datasetProject: DEFAULT_GCP_PROJECTID,\n+  dataset: DEFAULT_BIGQUERY_DATASET,\n+  table: DEFAULT_BIGQUERY_TABLE,\n+  serviceFilePath: DEFAULT_GCP_SERVICEACCOUNT_PATH,\n+};\n+\n+let headers = {};\n+\n+describe('Plugin properties', () => {\n+  // Uses API call to login instead of logging in manually through UI\n+  before(() => {\n+    loginIfRequired().then(() => {\n+      cy.getCookie('CDAP_Auth_Token').then((cookie) => {\n+        if (!cookie) {\n+          return;\n+        }\n+        headers = {\n+          Authorization: 'Bearer ' + cookie.value,\n+        };\n+      });\n+    });\n+    cy.visit('/pipelines/ns/default/studio');\n+  });\n+\n+  beforeEach(() => {\n+    getArtifactsPoll(headers);\n+  });\n+\n+  it('should be validated and errors found in properties', () => {\n+    cy.add_node_to_canvas(sourceNode);\n+    cy.get(\n+          '[data-cy=\"plugin-node-BigQueryTable-batchsource-0\"] .node .node-configure-btn')\n+        .invoke('show')\n+        .click();\n+    // Testing for errors found, rgb(164, 4, 3) is the red border color\n+    cy.get('[data-cy=\"plugin-properties-validate-btn\"]').click();\n+    cy.get('[data-cy=\"plugin-properties-errors-found\"]')\n+        .should('have.text', '3 errors found.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');\n+    // Testing if the widget is highlighted when there is an error\n+    // and the error text\n+    cy.get('[data-cy=\"referenceName\"] ~ [data-cy=\"property-row-error\"]')\n+        .should(\n+            'have.text', 'Required property \\'referenceName\\' has no value.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50eb08ea65fe49f00c26f706ca429bcc64e0888b"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQzNzA0Mg==", "bodyText": "nit: May be give a higher timeout. Or better yet remove the timeout and have the default timeout for cy.get to be like 1min.", "url": "https://github.com/cdapio/cdap/pull/11816#discussion_r365437042", "createdAt": "2020-01-10T21:27:48Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/cypress/integration/plugins.validation.spec.ts", "diffHunk": "@@ -0,0 +1,104 @@\n+import {getArtifactsPoll, loginIfRequired} from '../helpers';\n+import {DEFAULT_BIGQUERY_DATASET, DEFAULT_BIGQUERY_TABLE, DEFAULT_GCP_PROJECTID, DEFAULT_GCP_SERVICEACCOUNT_PATH} from '../support/constants';\n+import {INodeInfo} from '../typings';\n+\n+const sourceNode: INodeInfo = {\n+  nodeName: 'BigQueryTable',\n+  nodeType: 'batchsource'\n+};\n+\n+const sourceProperties = {\n+  referenceName: 'BQ_Source',\n+  project: DEFAULT_GCP_PROJECTID,\n+  datasetProject: DEFAULT_GCP_PROJECTID,\n+  dataset: DEFAULT_BIGQUERY_DATASET,\n+  table: DEFAULT_BIGQUERY_TABLE,\n+  serviceFilePath: DEFAULT_GCP_SERVICEACCOUNT_PATH,\n+};\n+\n+let headers = {};\n+\n+describe('Plugin properties', () => {\n+  // Uses API call to login instead of logging in manually through UI\n+  before(() => {\n+    loginIfRequired().then(() => {\n+      cy.getCookie('CDAP_Auth_Token').then((cookie) => {\n+        if (!cookie) {\n+          return;\n+        }\n+        headers = {\n+          Authorization: 'Bearer ' + cookie.value,\n+        };\n+      });\n+    });\n+    cy.visit('/pipelines/ns/default/studio');\n+  });\n+\n+  beforeEach(() => {\n+    getArtifactsPoll(headers);\n+  });\n+\n+  it('should be validated and errors found in properties', () => {\n+    cy.add_node_to_canvas(sourceNode);\n+    cy.get(\n+          '[data-cy=\"plugin-node-BigQueryTable-batchsource-0\"] .node .node-configure-btn')\n+        .invoke('show')\n+        .click();\n+    // Testing for errors found, rgb(164, 4, 3) is the red border color\n+    cy.get('[data-cy=\"plugin-properties-validate-btn\"]').click();\n+    cy.get('[data-cy=\"plugin-properties-errors-found\"]')\n+        .should('have.text', '3 errors found.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');\n+    // Testing if the widget is highlighted when there is an error\n+    // and the error text\n+    cy.get('[data-cy=\"referenceName\"] ~ [data-cy=\"property-row-error\"]')\n+        .should(\n+            'have.text', 'Required property \\'referenceName\\' has no value.');\n+    cy.get('[data-cy=\"referenceName\"] > [data-cy=\"widget-wrapper-container\"]')\n+        .should('have.css', 'border-color', 'rgb(164, 4, 3)');\n+  });\n+\n+  it('should be validated and no errors found in plugin properties', () => {\n+    // Testing for no errors found\n+    cy.get('input[data-cy=\"referenceName\"]').type('randomName');\n+    cy.get('input[data-cy=\"dataset\"]').type('randomDataset');\n+    cy.get('input[data-cy=\"table\"]').type('randomTableName');\n+    cy.get('[data-cy=\"plugin-properties-validate-btn\"]').click();\n+    cy.get('[data-cy=\"plugin-properties-no-errors\"]')\n+        .should('have.text', 'No errors found.');\n+  });\n+\n+  it('should be validated and errors found in schema', () => {\n+    // configuring properties for the plugin\n+    cy.get('input[data-cy=\"referenceName\"]')\n+        .clear()\n+        .type(sourceProperties.referenceName);\n+    cy.get('input[data-cy=\"project\"]').clear().type(sourceProperties.project);\n+    cy.get('input[data-cy=\"datasetProject\"]')\n+        .clear()\n+        .type(sourceProperties.datasetProject);\n+    cy.get('input[data-cy=\"dataset\"]').clear().type(sourceProperties.dataset);\n+    cy.get('input[data-cy=\"table\"]').clear().type(sourceProperties.table);\n+    cy.get('input[data-cy=\"serviceFilePath\"]')\n+        .clear()\n+        .type(sourceProperties.serviceFilePath);\n+    // retrieving schema\n+    cy.get('[data-cy=\"get-schema-btn\"]').click();\n+    cy.get('[data-cy=\"get-schema-btn\"]').contains('Get Schema', {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50eb08ea65fe49f00c26f706ca429bcc64e0888b"}, "originalPosition": 88}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50eb08ea65fe49f00c26f706ca429bcc64e0888b", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/50eb08ea65fe49f00c26f706ca429bcc64e0888b", "committedDate": "2020-01-09T19:29:57Z", "message": "Integration test for stage level validation"}, "afterCommit": {"oid": "5a79752c239436fc62d1e9b54c90492ab72c4a0b", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/5a79752c239436fc62d1e9b54c90492ab72c4a0b", "committedDate": "2020-01-28T01:34:54Z", "message": "using dataCy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Nzk1NzIz", "url": "https://github.com/cdapio/cdap/pull/11816#pullrequestreview-349795723", "createdAt": "2020-01-29T00:24:00Z", "commit": {"oid": "5a79752c239436fc62d1e9b54c90492ab72c4a0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5ODE3MTg3", "url": "https://github.com/cdapio/cdap/pull/11816#pullrequestreview-349817187", "createdAt": "2020-01-29T01:37:28Z", "commit": {"oid": "4a1ec3733791cfabf0ac6d7eab02a1626b0e1b74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2028a4dc9aeddeaabd0bb551bf5cd0e5ec6d24c0", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/2028a4dc9aeddeaabd0bb551bf5cd0e5ec6d24c0", "committedDate": "2020-01-29T01:38:29Z", "message": "Integration test for stage level validation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a1ec3733791cfabf0ac6d7eab02a1626b0e1b74", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/4a1ec3733791cfabf0ac6d7eab02a1626b0e1b74", "committedDate": "2020-01-29T01:33:24Z", "message": "refactoring;"}, "afterCommit": {"oid": "2028a4dc9aeddeaabd0bb551bf5cd0e5ec6d24c0", "author": {"user": {"login": "itsanudeep", "name": "Anudeep Katragadda"}}, "url": "https://github.com/cdapio/cdap/commit/2028a4dc9aeddeaabd0bb551bf5cd0e5ec6d24c0", "committedDate": "2020-01-29T01:38:29Z", "message": "Integration test for stage level validation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1362, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}