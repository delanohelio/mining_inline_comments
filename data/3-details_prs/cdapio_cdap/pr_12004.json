{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NjE0NzI3", "number": 12004, "title": "(CDAP-16353) Move get artifact details for range into ArtifactRepositoryReader", "bodyText": "Motivation:\nAppLifecycleDeployment use getArtifactDetails to find the artifact detail\nfor deploymnet. Moving this method into ArtifactRepositoryReader allows us\nto have remote vs local implication used by preview (when configured with\nlocal levelDB) and appfabric respectively.\nAdd implementation for this method in both LocalArtifactRepositoryReader\nand RemoteArtifactRepositoryReader. But the latter is not being used\nanywhere at the moment. A follow-up change will make preview to use\nRemoteArtifactRepositoryReader when configured with local levelDB.", "createdAt": "2020-03-27T08:20:12Z", "url": "https://github.com/cdapio/cdap/pull/12004", "merged": true, "mergeCommit": {"oid": "dd6b666de288735dc29c13e117b84a99b0d7d90f"}, "closed": true, "closedAt": "2020-03-28T03:03:28Z", "author": {"login": "wyzhang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRxRO9AFqTM4Mjg3OTA2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR74hkABqjMxNzQ1NjQ1NDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODc5MDY3", "url": "https://github.com/cdapio/cdap/pull/12004#pullrequestreview-382879067", "createdAt": "2020-03-27T13:56:12Z", "commit": {"oid": "d55b23ac0d496d1684647da5471e592cf823aa62"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzo1NjoxMlrOF8yOhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNDowNjoyNlrOF8yp1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4MTc5OA==", "bodyText": "remove debug logs", "url": "https://github.com/cdapio/cdap/pull/12004#discussion_r399281798", "createdAt": "2020-03-27T13:56:12Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/DefaultArtifactRepository.java", "diffHunk": "@@ -453,12 +454,15 @@ private boolean loadSystemArtifacts(ExecutorService executorService,\n   public void deleteArtifact(Id.Artifact artifactId) throws Exception {\n     // delete the artifact first and then privileges. Not the other way to avoid orphan artifact\n     // which does not have any privilege if the artifact delete from store fails. see CDAP-6648\n+    LOG.debug(\"wyzhang: delete artiact store: \" + artifactStore);\n+    LOG.debug(\"wyzhang: delete artiact id: \" + artifactId.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d55b23ac0d496d1684647da5471e592cf823aa62"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4MzQxNA==", "bodyText": "order.name()", "url": "https://github.com/cdapio/cdap/pull/12004#discussion_r399283414", "createdAt": "2020-03-27T13:58:32Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "diffHunk": "@@ -87,6 +92,30 @@ public ArtifactDetail getArtifact(Id.Artifact artifactId) throws Exception {\n     return artifactDetail;\n   }\n \n+  @Override\n+  public List<ArtifactDetail> getArtifactDetails(ArtifactRange range, int limit, ArtifactSortOrder order)\n+    throws Exception {\n+    String url = String.format(\"namespaces/%s/artifacts/%s/versions?lower=%s&upper=%s&limit=%s&order=%s\",\n+                               range.getNamespace(),\n+                               range.getName(),\n+                               range.getLower().toString(),\n+                               range.getUpper().toString(),\n+                               String.valueOf(limit),\n+                               String.valueOf(order));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d55b23ac0d496d1684647da5471e592cf823aa62"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4Mzg5Ng==", "bodyText": "I assume this means both lower and upper are always non-null?", "url": "https://github.com/cdapio/cdap/pull/12004#discussion_r399283896", "createdAt": "2020-03-27T13:59:13Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "diffHunk": "@@ -87,6 +92,30 @@ public ArtifactDetail getArtifact(Id.Artifact artifactId) throws Exception {\n     return artifactDetail;\n   }\n \n+  @Override\n+  public List<ArtifactDetail> getArtifactDetails(ArtifactRange range, int limit, ArtifactSortOrder order)\n+    throws Exception {\n+    String url = String.format(\"namespaces/%s/artifacts/%s/versions?lower=%s&upper=%s&limit=%s&order=%s\",\n+                               range.getNamespace(),\n+                               range.getName(),\n+                               range.getLower().toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d55b23ac0d496d1684647da5471e592cf823aa62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI4ODc5MA==", "bodyText": "is there a reason this utility method is being used over locationFactory.create()? Are they different?", "url": "https://github.com/cdapio/cdap/pull/12004#discussion_r399288790", "createdAt": "2020-03-27T14:06:26Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/artifact/RemoteArtifactRepositoryReader.java", "diffHunk": "@@ -87,6 +92,30 @@ public ArtifactDetail getArtifact(Id.Artifact artifactId) throws Exception {\n     return artifactDetail;\n   }\n \n+  @Override\n+  public List<ArtifactDetail> getArtifactDetails(ArtifactRange range, int limit, ArtifactSortOrder order)\n+    throws Exception {\n+    String url = String.format(\"namespaces/%s/artifacts/%s/versions?lower=%s&upper=%s&limit=%s&order=%s\",\n+                               range.getNamespace(),\n+                               range.getName(),\n+                               range.getLower().toString(),\n+                               range.getUpper().toString(),\n+                               String.valueOf(limit),\n+                               String.valueOf(order));\n+    HttpRequest.Builder requestBuilder = remoteClient.requestBuilder(HttpMethod.GET, url);\n+    HttpResponse httpResponse = execute(requestBuilder.build());\n+    List<ArtifactDetail> details = GSON.fromJson(httpResponse.getResponseBodyAsString(), ARTIFACT_DETAIL_LIST_TYPE);\n+    List<ArtifactDetail> detailList = new ArrayList<>();\n+    for (ArtifactDetail detail : details) {\n+      Location artifactLocation =\n+        Locations.getLocationFromAbsolutePath(locationFactory, detail.getDescriptor().getLocationURI().getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d55b23ac0d496d1684647da5471e592cf823aa62"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjUyODU1", "url": "https://github.com/cdapio/cdap/pull/12004#pullrequestreview-383252855", "createdAt": "2020-03-27T23:36:20Z", "commit": {"oid": "7271d07b7a42e99a5284796340a9240d071da156"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7271d07b7a42e99a5284796340a9240d071da156", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/7271d07b7a42e99a5284796340a9240d071da156", "committedDate": "2020-03-27T22:41:12Z", "message": "addressing comments"}, "afterCommit": {"oid": "693f6cb1e6697c843a386c6195c37569a0823179", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/693f6cb1e6697c843a386c6195c37569a0823179", "committedDate": "2020-03-28T00:17:17Z", "message": "(CDAP-16353) Move get artifact details for range into ArtifactRepositoryReader\n\nMotivation:\nAppLifecycleDeployment use getArtifactDetails to find the artifact detail\nfor deploymnet. Moving this method into ArtifactRepositoryReader allows us\nto have remote vs local implication used by preview (when configured with\nlocal levelDB) and appfabric respectively.\n\nAdd implementation for this method in both LocalArtifactRepositoryReader\nand RemoteArtifactRepositoryReader. But the latter is not being used\nanywhere at the moment. A follow-up change will make preview to use\nRemoteArtifactRepositoryReader when configured with local levelDB."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192ee7046ae50481f9c70b1eaa2bfe645392fb90", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/192ee7046ae50481f9c70b1eaa2bfe645392fb90", "committedDate": "2020-03-28T02:28:38Z", "message": "(CDAP-16353) Move get artifact details for range into ArtifactRepositoryReader\n\nMotivation:\nAppLifecycleDeployment use getArtifactDetails to find the artifact detail\nfor deploymnet. Moving this method into ArtifactRepositoryReader allows us\nto have remote vs local implication used by preview (when configured with\nlocal levelDB) and appfabric respectively.\n\nAdd implementation for this method in both LocalArtifactRepositoryReader\nand RemoteArtifactRepositoryReader. But the latter is not being used\nanywhere at the moment. A follow-up change will make preview to use\nRemoteArtifactRepositoryReader when configured with local levelDB."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "693f6cb1e6697c843a386c6195c37569a0823179", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/693f6cb1e6697c843a386c6195c37569a0823179", "committedDate": "2020-03-28T00:17:17Z", "message": "(CDAP-16353) Move get artifact details for range into ArtifactRepositoryReader\n\nMotivation:\nAppLifecycleDeployment use getArtifactDetails to find the artifact detail\nfor deploymnet. Moving this method into ArtifactRepositoryReader allows us\nto have remote vs local implication used by preview (when configured with\nlocal levelDB) and appfabric respectively.\n\nAdd implementation for this method in both LocalArtifactRepositoryReader\nand RemoteArtifactRepositoryReader. But the latter is not being used\nanywhere at the moment. A follow-up change will make preview to use\nRemoteArtifactRepositoryReader when configured with local levelDB."}, "afterCommit": {"oid": "192ee7046ae50481f9c70b1eaa2bfe645392fb90", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/192ee7046ae50481f9c70b1eaa2bfe645392fb90", "committedDate": "2020-03-28T02:28:38Z", "message": "(CDAP-16353) Move get artifact details for range into ArtifactRepositoryReader\n\nMotivation:\nAppLifecycleDeployment use getArtifactDetails to find the artifact detail\nfor deploymnet. Moving this method into ArtifactRepositoryReader allows us\nto have remote vs local implication used by preview (when configured with\nlocal levelDB) and appfabric respectively.\n\nAdd implementation for this method in both LocalArtifactRepositoryReader\nand RemoteArtifactRepositoryReader. But the latter is not being used\nanywhere at the moment. A follow-up change will make preview to use\nRemoteArtifactRepositoryReader when configured with local levelDB."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1202, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}