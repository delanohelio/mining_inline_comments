{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzUxMDUw", "number": 12317, "title": "[CDAP-16960] Preview error handling", "bodyText": "JIRA: https://issues.cask.co/browse/CDAP-16960\nBuild: https://builds.cask.co/browse/CDAP-UDUT659", "createdAt": "2020-06-12T15:36:09Z", "url": "https://github.com/cdapio/cdap/pull/12317", "merged": true, "mergeCommit": {"oid": "14f0dee0746387d70e78c74c437d3ee6664b7eef"}, "closed": true, "closedAt": "2020-06-16T21:45:46Z", "author": {"login": "yukiej"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrjrxlgFqTQzMDgyNjUzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr7Zz4gBqjM0NTA3NzI5MTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODI2NTMy", "url": "https://github.com/cdapio/cdap/pull/12317#pullrequestreview-430826532", "createdAt": "2020-06-15T16:56:21Z", "commit": {"oid": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo1NjoyMVrOGj6vFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo1OToxM1rOGj61uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNTY2OA==", "bodyText": "If the utility function is generic enough we need to pull it out. Its hard to track this change tomorrow if something changes in replicator.", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440315668", "createdAt": "2020-06-15T16:56:21Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -25,6 +25,11 @@ import { messageTextStyle } from 'components/PreviewData/Table';\n import PreviewTableContainer from 'components/PreviewData/TableContainer';\n import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import T from 'i18n-react';\n+import { extractErrorMessage } from 'components/Replicator/utilities';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNzM2OA==", "bodyText": "Since we are not sure where the error message will reside (error.response or errror.response.message) can we check if its an object and avoid rendering object in the DOM? It will break the entire app.", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440317368", "createdAt": "2020-06-15T16:59:13Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -97,26 +105,42 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n   const tableData: ITableData = getTableData();\n \n   const loadingMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n-      <Heading type={HeadingTypes.h3} label={'Fetching preview data'} className={cls.messageText} />\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.loading`)}\n+        className={cls.messageText}\n+      />\n       <LoadingSVGCentered />\n     </div>\n   );\n \n   const noPreviewDataMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.runPreview`)}\n+        className={cls.messageText}\n+      />\n+    </div>\n+  );\n+\n+  const errorMsg = (cls) => (\n+    <div className={classnames('text-danger', cls.headingContainer)}>\n       <Heading\n         type={HeadingTypes.h3}\n-        label={'Run preview to generate preview data.'}\n+        label={T.translate(`${I18N_PREFIX}.errorHeader`)}\n         className={cls.messageText}\n       />\n+      <span>{error}</span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDc2ODg3", "url": "https://github.com/cdapio/cdap/pull/12317#pullrequestreview-431076887", "createdAt": "2020-06-16T00:20:13Z", "commit": {"oid": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMDoyMDoxM1rOGkG-eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMDoyMDoxM1rOGkG-eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUxNjIxNw==", "bodyText": "nit: sort", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440516217", "createdAt": "2020-06-16T00:20:13Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/text/text-en.yaml", "diffHunk": "@@ -2410,7 +2410,10 @@ features:\n       viewNamespace: View pipelines in namespace\n     viewPipeline: View Pipeline\n   PreviewData:\n-    Table:\n+    loading: Fetching preview data\n+    errorHeader: Error fetching preview data. Please try re-running preview. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e599ce203c05300274c6a0be6c9ee63eb7fc8b41", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/e599ce203c05300274c6a0be6c9ee63eb7fc8b41", "committedDate": "2020-06-16T15:48:10Z", "message": "Export error parsing fn"}, "afterCommit": {"oid": "b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "committedDate": "2020-06-16T16:04:42Z", "message": "Address feedback and move error parsing to services/helpers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "committedDate": "2020-06-16T16:04:42Z", "message": "Address feedback and move error parsing to services/helpers"}, "afterCommit": {"oid": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "committedDate": "2020-06-16T16:06:26Z", "message": "Address feedback and move error parsing to services/helpers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzEwNDA3", "url": "https://github.com/cdapio/cdap/pull/12317#pullrequestreview-431710407", "createdAt": "2020-06-16T16:57:19Z", "commit": {"oid": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo1NzoxOVrOGkksPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjo1NzoxOVrOGkksPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwMzA2OQ==", "bodyText": "Can this use the extract error message?", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r441003069", "createdAt": "2020-06-16T16:57:19Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -97,26 +105,42 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n   const tableData: ITableData = getTableData();\n \n   const loadingMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n-      <Heading type={HeadingTypes.h3} label={'Fetching preview data'} className={cls.messageText} />\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.loading`)}\n+        className={cls.messageText}\n+      />\n       <LoadingSVGCentered />\n     </div>\n   );\n \n   const noPreviewDataMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.runPreview`)}\n+        className={cls.messageText}\n+      />\n+    </div>\n+  );\n+\n+  const errorMsg = (cls) => (\n+    <div className={classnames('text-danger', cls.headingContainer)}>\n       <Heading\n         type={HeadingTypes.h3}\n-        label={'Run preview to generate preview data.'}\n+        label={T.translate(`${I18N_PREFIX}.errorHeader`)}\n         className={cls.messageText}\n       />\n+      <span>{typeof error === 'string' ? error : JSON.stringify(error)}</span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c1798d7b375550a796df3d58a257ed871ab022b", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6c1798d7b375550a796df3d58a257ed871ab022b", "committedDate": "2020-06-16T20:35:46Z", "message": "Add error handling backend returns error while fetching preview and i18n for previewData messages"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "committedDate": "2020-06-16T16:06:26Z", "message": "Address feedback and move error parsing to services/helpers"}, "afterCommit": {"oid": "6c1798d7b375550a796df3d58a257ed871ab022b", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6c1798d7b375550a796df3d58a257ed871ab022b", "committedDate": "2020-06-16T20:35:46Z", "message": "Add error handling backend returns error while fetching preview and i18n for previewData messages"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2016, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}