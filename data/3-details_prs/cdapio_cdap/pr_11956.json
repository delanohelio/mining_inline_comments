{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTExMDU4", "number": 11956, "title": "Shutdown SystemAppManagement when BootstrapService is shutting down", "bodyText": "Fixing flaky BootstrapServiceTest\nBUILD: https://builds.cask.co/browse/CDAP-DUT7147-1", "createdAt": "2020-03-13T18:08:15Z", "url": "https://github.com/cdapio/cdap/pull/11956", "merged": true, "mergeCommit": {"oid": "c8e42ab0783d39362094aa3fb9175c7d2f7ca089"}, "closed": true, "closedAt": "2020-03-13T20:58:43Z", "author": {"login": "pandyajay10"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNUSIOAH2gAyMzg3OTExMDU4OjU2ZjM1MDkzN2Y0ZjdjY2ExY2RiZDUzZDIyYTg0NGMyZjQ3ZWE1NDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNWq_bAFqTM3NDYxMjg2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56f350937f4f7cca1cdbd53d22a844c2f47ea543", "author": {"user": null}, "url": "https://github.com/cdapio/cdap/commit/56f350937f4f7cca1cdbd53d22a844c2f47ea543", "committedDate": "2020-03-13T18:05:00Z", "message": "Shutdown SystemAppManagement when BootstrapService is shutting down"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NTE4NDk0", "url": "https://github.com/cdapio/cdap/pull/11956#pullrequestreview-374518494", "createdAt": "2020-03-13T18:19:50Z", "commit": {"oid": "56f350937f4f7cca1cdbd53d22a844c2f47ea543"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxODoxOTo1MFrOF2N9ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxODoxOTo1MFrOF2N9ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM5NjE1NQ==", "bodyText": "it's possible this isn't started yet since it's started asynchronously. I'm not sure if it will throw an error if you try stopping a service that isn't running. Can you check the behavior?\nThere is also a race here where this line completes, then the thread starts the service before the executor service is shutdown. It's better to do this after the executorService is shutdown, since we know nothing will try to start it at that point.", "url": "https://github.com/cdapio/cdap/pull/11956#discussion_r392396155", "createdAt": "2020-03-13T18:19:50Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/bootstrap/BootstrapService.java", "diffHunk": "@@ -102,6 +102,7 @@ protected void startUp() {\n   @Override\n   protected void shutDown() throws Exception {\n     LOG.info(\"Stopping {}\", getClass().getSimpleName());\n+    this.systemAppManagementService.stopAndWait();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56f350937f4f7cca1cdbd53d22a844c2f47ea543"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc67d2141ac761bd1f38bb9bc4103ff7477be016", "author": {"user": null}, "url": "https://github.com/cdapio/cdap/commit/dc67d2141ac761bd1f38bb9bc4103ff7477be016", "committedDate": "2020-03-13T19:35:09Z", "message": "Shutdown SystemAppManagement when BootstrapService is shutting down"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjEyODY5", "url": "https://github.com/cdapio/cdap/pull/11956#pullrequestreview-374612869", "createdAt": "2020-03-13T20:51:58Z", "commit": {"oid": "dc67d2141ac761bd1f38bb9bc4103ff7477be016"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2242, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}