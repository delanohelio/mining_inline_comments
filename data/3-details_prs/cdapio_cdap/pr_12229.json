{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MjU1NzEw", "number": 12229, "title": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)", "bodyText": "JIRA: https://issues.cask.co/browse/CDAP-16874\nCurrently, the plugin JSON creator supports editing JSON file through the user interface. Users are able to see their live progress and download the output.\nThis PR implements an additional feature where users can upload their own plugin JSON file. Our system will parse the file content and update the interface accordingly. The users can either further edit the file through our UI or choose to proceed with their current file.\nCurrent Progress:\n\nUpdates the UI based on the file content\nJSON file validation\n\nError handling if file-content or file-name is invalid -> shows error message in the UI\n\n\n\nThings to note:\nWhen we import a file of relatively bigger size, the inputs tend to be a bit more laggy. I'm planning to make a separate PR that addresses this speed issue.\nIf user uploads the valid file => updates the UI\n\nIf user uploads the invalid file => doesn't update the UI and shows error message", "createdAt": "2020-05-29T18:18:35Z", "url": "https://github.com/cdapio/cdap/pull/12229", "merged": true, "mergeCommit": {"oid": "ea0bc5e0a7dc4d4bd243b34ebabead5401c615ee"}, "closed": true, "closedAt": "2020-06-16T23:46:05Z", "author": {"login": "jennac3"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmJESbABqjMzODg4NDMxODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr922qgBqjM0NTEyMjE5NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81dc496ed7b586feaeb88553601149ff27cc44e2", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/81dc496ed7b586feaeb88553601149ff27cc44e2", "committedDate": "2020-05-29T18:11:47Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}, "afterCommit": {"oid": "0ab29b9183771d2ab5438904a155942d866e81b1", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/0ab29b9183771d2ab5438904a155942d866e81b1", "committedDate": "2020-05-29T21:08:39Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ab29b9183771d2ab5438904a155942d866e81b1", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/0ab29b9183771d2ab5438904a155942d866e81b1", "committedDate": "2020-05-29T21:08:39Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}, "afterCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/797996d7ff1a1f5fa7e6219af4fc946d6b0b414a", "committedDate": "2020-06-01T21:36:14Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjM0NTQ0", "url": "https://github.com/cdapio/cdap/pull/12229#pullrequestreview-423234544", "createdAt": "2020-06-03T05:47:20Z", "commit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo0NzoyMFrOGeM4Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTo1NDowM1rOGeNAAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMTUwNg==", "bodyText": "This won't be scalable. If the user uploads a new file there are two things we can do,\n\nValidate the JSON and if it has all the right widget and attribute references\nSet the output of step #1 to the state and allow the UI now re-render based on the state change.", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434321506", "createdAt": "2020-06-03T05:47:20Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/BasicPluginInfo/index.tsx", "diffHunk": "@@ -55,13 +55,31 @@ const BasicPluginInfoView: React.FC<ICreateContext & WithStyles<typeof styles>>\n   jsonView,\n   setJsonView,\n   outputName,\n+  setPluginState,\n }) => {\n   const [localPluginName, setLocalPluginName] = React.useState(pluginName);\n   const [localPluginType, setLocalPluginType] = React.useState(pluginType);\n   const [localDisplayName, setLocalDisplayName] = React.useState(displayName);\n   const [localEmitAlerts, setLocalEmitAlerts] = React.useState(emitAlerts);\n   const [localEmitErrors, setLocalEmitErrors] = React.useState(emitErrors);\n \n+  // In case user uploads new file\n+  React.useEffect(() => {\n+    setLocalPluginName(pluginName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMTYwMw==", "bodyText": "Please try to avoid this.", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434321603", "createdAt": "2020-06-03T05:47:41Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/ClosedJsonMenu/index.tsx", "diffHunk": "@@ -43,6 +44,9 @@ const styles = (theme): StyleRules => {\n     jsonCollapseActionButtons: {\n       padding: '15px',\n       flexDirection: 'column',\n+      '& > *': {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMTcyMA==", "bodyText": "Is this intended?", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434321720", "createdAt": "2020-06-03T05:48:05Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/ClosedJsonMenu/index.tsx", "diffHunk": "@@ -51,40 +55,60 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n-const ClosedJsonMenuView: React.FC<ICreateContext & WithStyles<typeof styles>> = ({\n+const DownloadJSONButton = ({ classes, downloadDisabled, onDownloadClick }) => {\n+  return (\n+    <Tooltip\n+      title={\n+        downloadDisabled\n+          ? 'Download is disabled until the required fields are filled in'\n+          : 'Download Plugin JSON'\n+      }\n+      classes={{\n+        tooltip: classes.jsonViewerTooltip,\n+      }}\n+    >\n+      <Button disabled={downloadDisabled} onClick={onDownloadClick}>\n+        <GetAppIcon />\n+      </Button>\n+    </Tooltip>\n+  );\n+};\n+\n+const ExpandJSONViewButton = ({ classes, expandJSONView }) => {\n+  return (\n+    <Tooltip\n+      title=\"Open JSON View\"\n+      classes={{\n+        tooltip: classes.jsonViewerTooltip,\n+      }}\n+    >\n+      <Button onClick={expandJSONView}>\n+        <CodeIcon />\n+      </Button>\n+    </Tooltip>\n+  );\n+};\n+\n+interface IClosedJsonMenuProps extends WithStyles<typeof styles>, ICreateContext {\n+  expandJSONView: () => void;\n+  onDownloadClick: () => void;\n+  populateImportResults: (filename: string, fileContent: string) => void;\n+  JSONStatus: JSONStatusMessage;\n+  downloadDisabled: boolean;\n+}\n+\n+const ClosedJsonMenuView: React.FC<IClosedJsonMenuProps> = ({\n   classes,\n-  pluginName,\n-  pluginType,\n-  displayName,\n-  emitAlerts,\n-  emitErrors,\n-  configurationGroups,\n-  groupToInfo,\n-  groupToWidgets,\n-  widgetToInfo,\n-  widgetToAttributes,\n-  jsonView,\n-  setJsonView,\n-  outputName,\n+  expandJSONView,\n+  onDownloadClick,\n+  populateImportResults,\n+  JSONStatus,\n+  downloadDisabled,\n }) => {\n-  const widgetJSONData = {\n-    pluginName,\n-    pluginType,\n-    displayName,\n-    emitAlerts,\n-    emitErrors,\n-    configurationGroups,\n-    groupToInfo,\n-    groupToWidgets,\n-    widgetToInfo,\n-    widgetToAttributes,\n-    outputName,\n-  };\n-  const downloadDisabled = pluginName.length === 0 || pluginType.length === 0;\n   return (\n     <div>\n       <Drawer\n-        open={!jsonView}\n+        open={true}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjM5MA==", "bodyText": "Would be worth checking if we can file-dnd on the entire page. The user might just have to drag and drop a valid plugin config and we show properties-widget view right away.", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434322390", "createdAt": "2020-06-03T05:50:31Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/PluginJsonImporter/index.tsx", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { Button, CircularProgress, WithStyles, withStyles } from '@material-ui/core';\n+import { green } from '@material-ui/core/colors';\n+import { StyleRules } from '@material-ui/core/styles';\n+import CheckIcon from '@material-ui/icons/Check';\n+import SaveIcon from '@material-ui/icons/Save';\n+import clsx from 'clsx';\n+import { JSONStatusMessage } from 'components/PluginJSONCreator/Create/Content/JsonMenu';\n+import { ICreateContext } from 'components/Replicator/Create';\n+import React from 'react';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    buttonSuccess: {\n+      backgroundColor: green[500],\n+      '&:hover': {\n+        backgroundColor: green[700],\n+      },\n+    },\n+    buttonProgress: {\n+      color: green[500],\n+      position: 'absolute',\n+      top: '50%',\n+      left: '50%',\n+      marginTop: -12,\n+      marginLeft: -12,\n+    },\n+    fileInput: {\n+      display: 'none',\n+    },\n+  };\n+};\n+\n+interface IPluginJSONImporterProps extends WithStyles<typeof styles>, ICreateContext {\n+  populateImportResults: (filename: string, fileContent: string) => void;\n+  JSONStatus: JSONStatusMessage;\n+}\n+\n+const PluginJSONImporterView: React.FC<IPluginJSONImporterProps> = ({\n+  classes,\n+  populateImportResults,\n+  JSONStatus,\n+}) => {\n+  const [loading, setLoading] = React.useState(false);\n+  const [success, setSuccess] = React.useState(false);\n+\n+  const buttonClassname = clsx({\n+    [classes.buttonSuccess]: success,\n+  });\n+\n+  React.useEffect(() => {\n+    if (JSONStatus === JSONStatusMessage.Success) {\n+      setSuccess(true);\n+    } else {\n+      setSuccess(false);\n+    }\n+  }, [JSONStatus]);\n+\n+  function processFileUpload() {\n+    return (e) => {\n+      if (!loading) {\n+        setLoading(true);\n+      }\n+      const files = e.target.files;\n+      if (files.length > 0) {\n+        const filename = files[0].name;\n+        const filenameWithoutExtension =\n+          filename.substring(0, filename.lastIndexOf('.')) || filename;\n+        const reader = new FileReader();\n+        reader.readAsText(files[0]);\n+        let fileContent;\n+        reader.onload = (r) => {\n+          fileContent = r.target.result;\n+          renderFileContent(filenameWithoutExtension, fileContent);\n+        };\n+      } else {\n+        setLoading(false);\n+      }\n+    };\n+  }\n+\n+  async function renderFileContent(filename, fileContent) {\n+    await populateImportResults(filename, fileContent);\n+    setLoading(false);\n+  }\n+\n+  return (\n+    <div>\n+      <input", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjQ2Ng==", "bodyText": "nit: Use LoadingSVG icon", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434322466", "createdAt": "2020-06-03T05:50:51Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/PluginJsonImporter/index.tsx", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { Button, CircularProgress, WithStyles, withStyles } from '@material-ui/core';\n+import { green } from '@material-ui/core/colors';\n+import { StyleRules } from '@material-ui/core/styles';\n+import CheckIcon from '@material-ui/icons/Check';\n+import SaveIcon from '@material-ui/icons/Save';\n+import clsx from 'clsx';\n+import { JSONStatusMessage } from 'components/PluginJSONCreator/Create/Content/JsonMenu';\n+import { ICreateContext } from 'components/Replicator/Create';\n+import React from 'react';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    buttonSuccess: {\n+      backgroundColor: green[500],\n+      '&:hover': {\n+        backgroundColor: green[700],\n+      },\n+    },\n+    buttonProgress: {\n+      color: green[500],\n+      position: 'absolute',\n+      top: '50%',\n+      left: '50%',\n+      marginTop: -12,\n+      marginLeft: -12,\n+    },\n+    fileInput: {\n+      display: 'none',\n+    },\n+  };\n+};\n+\n+interface IPluginJSONImporterProps extends WithStyles<typeof styles>, ICreateContext {\n+  populateImportResults: (filename: string, fileContent: string) => void;\n+  JSONStatus: JSONStatusMessage;\n+}\n+\n+const PluginJSONImporterView: React.FC<IPluginJSONImporterProps> = ({\n+  classes,\n+  populateImportResults,\n+  JSONStatus,\n+}) => {\n+  const [loading, setLoading] = React.useState(false);\n+  const [success, setSuccess] = React.useState(false);\n+\n+  const buttonClassname = clsx({\n+    [classes.buttonSuccess]: success,\n+  });\n+\n+  React.useEffect(() => {\n+    if (JSONStatus === JSONStatusMessage.Success) {\n+      setSuccess(true);\n+    } else {\n+      setSuccess(false);\n+    }\n+  }, [JSONStatus]);\n+\n+  function processFileUpload() {\n+    return (e) => {\n+      if (!loading) {\n+        setLoading(true);\n+      }\n+      const files = e.target.files;\n+      if (files.length > 0) {\n+        const filename = files[0].name;\n+        const filenameWithoutExtension =\n+          filename.substring(0, filename.lastIndexOf('.')) || filename;\n+        const reader = new FileReader();\n+        reader.readAsText(files[0]);\n+        let fileContent;\n+        reader.onload = (r) => {\n+          fileContent = r.target.result;\n+          renderFileContent(filenameWithoutExtension, fileContent);\n+        };\n+      } else {\n+        setLoading(false);\n+      }\n+    };\n+  }\n+\n+  async function renderFileContent(filename, fileContent) {\n+    await populateImportResults(filename, fileContent);\n+    setLoading(false);\n+  }\n+\n+  return (\n+    <div>\n+      <input\n+        accept=\"json/*\"\n+        id=\"raised-button-file\"\n+        type=\"file\"\n+        className={classes.fileInput}\n+        onChange={processFileUpload()}\n+      />\n+      <label htmlFor=\"raised-button-file\">\n+        <Button\n+          aria-label=\"save\"\n+          component=\"span\"\n+          color=\"primary\"\n+          disabled={loading}\n+          className={buttonClassname}\n+        >\n+          {success ? <CheckIcon /> : <SaveIcon />}\n+        </Button>\n+        {loading && <CircularProgress size={24} className={classes.buttonProgress} />}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMjc3Nw==", "bodyText": "This will give no time for the user to read the message, understand and process. The pattern we already have is to show the error message and allow the user to close the message. Success messages can be transient as they provide only confirmations and not information.", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434322777", "createdAt": "2020-06-03T05:51:56Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/index.tsx", "diffHunk": "@@ -38,46 +45,108 @@ const JsonMenuView: React.FC<ICreateContext> = ({\n   jsonView,\n   setJsonView,\n   outputName,\n+  setPluginState,\n }) => {\n+  const pluginData = {\n+    pluginName,\n+    pluginType,\n+    displayName,\n+    emitAlerts,\n+    emitErrors,\n+    configurationGroups,\n+    groupToInfo,\n+    groupToWidgets,\n+    widgetToInfo,\n+    widgetToAttributes,\n+    outputName,\n+  };\n+\n+  const [JSONStatus, setJSONStatus] = React.useState(JSONStatusMessage.Pending);\n+  const [JSONErrorMessage, setJSONErrorMessage] = React.useState('');\n+\n+  // When JSON error occurs, show the error message for 2 seconds.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMzQ1OA==", "bodyText": "I believe we already have this logic right? https://github.com/cdapio/cdap/blob/develop/cdap-ui/app/cdap/components/ConfigurationGroup/utilities/index.ts#L93 Can we extract this and make it generic and re-use this?", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r434323458", "createdAt": "2020-06-03T05:54:03Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/utilities.ts", "diffHunk": "@@ -58,10 +63,87 @@ function getJSONConfig(widgetJSONData) {\n   return config;\n }\n \n+function parsePluginJSON(filename, pluginJSON) {\n+  // Parse filename in order to set pluginName and pluginType\n+  // Currently the filename is designed to be <pluginName>-<pluginType>.json\n+  const [pluginName, pluginType] = filename.split('-');\n+\n+  // Parse file data in order to populate the rest of properties\n+  const basicPluginInfo = {\n+    // If the string fields are undefined, set them to empty string\n+    displayName: pluginJSON['display-name'] ? pluginJSON['display-name'] : '',\n+    pluginName: pluginName ? pluginName : '',\n+    pluginType: pluginType ? pluginType : '',\n+    emitAlerts: pluginJSON['emit-alerts'],\n+    emitErrors: pluginJSON['emit-errors'],\n+  } as IBasicPluginInfo;\n+\n+  const newConfigurationGroups = [];\n+  const newGroupToInfo = {};\n+  const newGroupToWidgets = {};\n+  const newWidgetToInfo = {};\n+  const newWidgetToAttributes = {};\n+\n+  pluginJSON['configuration-groups'].forEach((groupObj) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "797996d7ff1a1f5fa7e6219af4fc946d6b0b414a", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/797996d7ff1a1f5fa7e6219af4fc946d6b0b414a", "committedDate": "2020-06-01T21:36:14Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}, "afterCommit": {"oid": "7e470ab4c3b5e230a6887755c2baa2e0dfb90682", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/7e470ab4c3b5e230a6887755c2baa2e0dfb90682", "committedDate": "2020-06-04T17:15:50Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTQ2NTU1", "url": "https://github.com/cdapio/cdap/pull/12229#pullrequestreview-431946555", "createdAt": "2020-06-16T22:54:33Z", "commit": {"oid": "f09ad5e12edd9d16898128d5d9982f2576ea77fb"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMjo1NDozNFrOGkv4kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMjo1NjoxOVrOGkv6_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4NjQ1MA==", "bodyText": "nit: fields are filled", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r441186450", "createdAt": "2020-06-16T22:54:34Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/ClosedJsonMenu/index.tsx", "diffHunk": "@@ -14,102 +14,113 @@\n  * the License.\n  */\n \n+import Button from '@material-ui/core/Button';\n import Divider from '@material-ui/core/Divider';\n-import Drawer from '@material-ui/core/Drawer';\n-import IconButton from '@material-ui/core/IconButton';\n-import List from '@material-ui/core/List';\n import withStyles, { StyleRules, WithStyles } from '@material-ui/core/styles/withStyles';\n import Tooltip from '@material-ui/core/Tooltip';\n import CodeIcon from '@material-ui/icons/Code';\n import GetAppIcon from '@material-ui/icons/GetApp';\n-import { downloadPluginJSON } from 'components/PluginJSONCreator/Create/Content/JsonMenu/utilities';\n+import { JSONStatusMessage } from 'components/PluginJSONCreator/Create/Content/JsonMenu';\n+import PluginJSONImporter from 'components/PluginJSONCreator/Create/Content/JsonMenu/PluginJsonImporter';\n import { ICreateContext } from 'components/PluginJSONCreator/CreateContextConnect';\n import * as React from 'react';\n \n const styles = (theme): StyleRules => {\n   return {\n-    closedJsonMenu: {\n-      zIndex: theme.zIndex.drawer,\n-    },\n-    closedJsonMenuPaper: {\n-      backgroundColor: theme.palette.white[50],\n-    },\n-    toolbar: {\n-      minHeight: '48px',\n-    },\n-    mainMenu: {\n-      borderTop: `1px solid ${theme.palette.grey['500']}`,\n-      paddingTop: theme.Spacing(1),\n-      paddingBottom: theme.Spacing(1),\n-    },\n-    jsonCollapseActionButtons: {\n+    jsonActionButtons: {\n       padding: '15px',\n       flexDirection: 'column',\n     },\n+    jsonActionButton: {\n+      margin: '5px',\n+    },\n     jsonViewerTooltip: {\n       fontSize: '14px',\n       backgroundColor: theme.palette.grey[500],\n     },\n   };\n };\n \n-const ClosedJsonMenuView: React.FC<ICreateContext & WithStyles<typeof styles>> = (\n-  widgetJSONData\n-) => {\n-  const { classes, pluginName, pluginType, jsonView, setJsonView } = widgetJSONData;\n-  const downloadDisabled = pluginName.length === 0 || pluginType.length === 0;\n+const DownloadJSONButton = ({ classes, downloadDisabled, onDownloadClick }) => {\n   return (\n-    <div>\n-      <Drawer\n-        open={!jsonView}\n-        variant=\"persistent\"\n-        className={classes.closedJsonMenu}\n-        anchor=\"right\"\n-        ModalProps={{\n-          keepMounted: true,\n-        }}\n-        classes={{\n-          paper: classes.closedJsonMenuPaper,\n-        }}\n-        data-cy=\"navbar-jsonViewer\"\n-      >\n-        <div className={classes.toolbar} />\n-        <List component=\"nav\" dense={true} className={classes.mainMenu}>\n-          <div className={classes.jsonCollapseActionButtons}>\n-            <Tooltip\n-              title=\"Open JSON View\"\n-              classes={{\n-                tooltip: classes.jsonViewerTooltip,\n-              }}\n-            >\n-              <IconButton onClick={() => setJsonView(true)}>\n-                <CodeIcon />\n-              </IconButton>\n-            </Tooltip>\n-            <Divider />\n+    <Tooltip\n+      title={\n+        downloadDisabled\n+          ? 'Download is disabled until the required fields are filled in'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f09ad5e12edd9d16898128d5d9982f2576ea77fb"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4NjgwMw==", "bodyText": "don't use new font. for block letter, you can use <pre>", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r441186803", "createdAt": "2020-06-16T22:55:29Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/JsonLiveViewer/index.tsx", "diffHunk": "@@ -15,42 +15,28 @@\n  */\n \n import Button from '@material-ui/core/Button';\n-import Drawer from '@material-ui/core/Drawer';\n-import List from '@material-ui/core/List';\n import withStyles, { StyleRules, WithStyles } from '@material-ui/core/styles/withStyles';\n import Tooltip from '@material-ui/core/Tooltip';\n import FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\n-import SaveAltIcon from '@material-ui/icons/SaveAlt';\n-import {\n-  downloadPluginJSON,\n-  getJSONConfig,\n-} from 'components/PluginJSONCreator/Create/Content/JsonMenu/utilities';\n+import GetAppIcon from '@material-ui/icons/GetApp';\n+import { JSONStatusMessage } from 'components/PluginJSONCreator/Create/Content/JsonMenu';\n+import PluginJSONImporter from 'components/PluginJSONCreator/Create/Content/JsonMenu/PluginJsonImporter';\n import { ICreateContext } from 'components/PluginJSONCreator/CreateContextConnect';\n import * as React from 'react';\n \n-const JSON_VIEWER_WIDTH = '600px';\n-\n const styles = (theme): StyleRules => {\n   return {\n-    jsonViewer: {\n-      zIndex: theme.zIndex.drawer,\n-      width: JSON_VIEWER_WIDTH,\n-    },\n-    jsonViewerPaper: {\n-      width: JSON_VIEWER_WIDTH,\n-      backgroundColor: theme.palette.white[50],\n-    },\n-    toolbar: {\n-      minHeight: '48px',\n-    },\n-    mainMenu: {\n-      borderTop: `1px solid ${theme.palette.grey['500']}`,\n-      paddingTop: theme.Spacing(1),\n-      paddingBottom: theme.Spacing(1),\n-    },\n     jsonActionButtons: {\n-      padding: '5px',\n+      padding: '0px',\n       display: 'flex',\n+      justifyContent: 'center',\n+      alignItems: 'center',\n+    },\n+    currentFilename: {\n+      position: 'relative',\n+      margin: '0 auto',\n+      left: '25px',\n+      fontFamily: 'Courier New',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f09ad5e12edd9d16898128d5d9982f2576ea77fb"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4NzA3MQ==", "bodyText": "this seems to be the same as the tooltip being used in another component. Worth extracting this out", "url": "https://github.com/cdapio/cdap/pull/12229#discussion_r441187071", "createdAt": "2020-06-16T22:56:19Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/JsonLiveViewer/index.tsx", "diffHunk": "@@ -65,65 +51,90 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n-const JsonLiveViewerView: React.FC<ICreateContext & WithStyles<typeof styles>> = (\n-  widgetJSONData\n-) => {\n-  const { classes, pluginName, pluginType, jsonView, setJsonView } = widgetJSONData;\n-  const JSONConfig = getJSONConfig(widgetJSONData);\n-  const downloadDisabled = pluginName.length === 0 || pluginType.length === 0;\n+const DownloadJSONButton = ({ classes, downloadDisabled, onDownloadClick }) => {\n+  return (\n+    <Tooltip\n+      title={\n+        downloadDisabled\n+          ? 'Download is disabled until the required fields are filled in'\n+          : 'Download Plugin JSON'\n+      }\n+      classes={{\n+        tooltip: classes.jsonViewerTooltip,\n+      }}\n+    >\n+      <div>\n+        <Button disabled={downloadDisabled} onClick={onDownloadClick}>\n+          <GetAppIcon />\n+        </Button>\n+      </div>\n+    </Tooltip>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f09ad5e12edd9d16898128d5d9982f2576ea77fb"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTU0NjQz", "url": "https://github.com/cdapio/cdap/pull/12229#pullrequestreview-431954643", "createdAt": "2020-06-16T23:15:44Z", "commit": {"oid": "85b9e311e06ea0caa0d0c02074fd9ab24d1e50c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85b9e311e06ea0caa0d0c02074fd9ab24d1e50c0", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/85b9e311e06ea0caa0d0c02074fd9ab24d1e50c0", "committedDate": "2020-06-16T23:09:56Z", "message": "address comments"}, "afterCommit": {"oid": "c43faf976fef33d7efc707faa8d4e879ab5d6c8b", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/c43faf976fef33d7efc707faa8d4e879ab5d6c8b", "committedDate": "2020-06-16T23:18:09Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd1e1f3767fbb5022a852d12c5ee1b668821f2eb", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/dd1e1f3767fbb5022a852d12c5ee1b668821f2eb", "committedDate": "2020-06-16T23:28:42Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "993f7f737c9b09ae2c71a2aa6e685893d0b4d034", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/993f7f737c9b09ae2c71a2aa6e685893d0b4d034", "committedDate": "2020-06-16T23:25:41Z", "message": "pull from develop"}, "afterCommit": {"oid": "dd1e1f3767fbb5022a852d12c5ee1b668821f2eb", "author": {"user": {"login": "jennac3", "name": "Jenna Choi"}}, "url": "https://github.com/cdapio/cdap/commit/dd1e1f3767fbb5022a852d12c5ee1b668821f2eb", "committedDate": "2020-06-16T23:28:42Z", "message": "[CDAP-16874] Importing existing plugin JSON file (plugin JSON Creator)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2106, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}