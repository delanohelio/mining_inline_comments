{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTIxOTEy", "number": 12520, "title": "(CDAP-17130) Added Distribution to BatchJoiner API", "bodyText": "", "createdAt": "2020-07-29T00:14:36Z", "url": "https://github.com/cdapio/cdap/pull/12520", "merged": true, "mergeCommit": {"oid": "7a8ba93fb60e3c085b43e9ab330d8ec6991137de"}, "closed": true, "closedAt": "2020-07-30T18:40:29Z", "author": {"login": "MEseifan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5f3FDgFqTQ1NzExNDA5NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6ECWygFqTQ1ODY1ODM3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTE0MDk1", "url": "https://github.com/cdapio/cdap/pull/12520#pullrequestreview-457114095", "createdAt": "2020-07-29T00:19:57Z", "commit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoxOTo1N1rOG4kNPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoyNDo1OVrOG4kS4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NjY1Mw==", "bodyText": "nit: extra space before Engine", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461966653", "createdAt": "2020-07-29T00:19:57Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-data-pipeline/src/test/java/io/cdap/cdap/datapipeline/AutoJoinerTest.java", "diffHunk": "@@ -302,7 +302,8 @@ public void testAutoInnerJoinSkewed() throws Exception {\n                    .set(\"users_user_id\", 1)\n                    .set(\"users_name\", \"bob\").build());\n \n-    testSimpleAutoJoinSkewed(Arrays.asList(\"users\", \"interests\"), expected);\n+    testSimpleAutoJoinSkewed(Arrays.asList(\"users\", \"interests\"), expected,  Engine.SPARK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NjY3Nw==", "bodyText": "nit: extra space before Engine", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461966677", "createdAt": "2020-07-29T00:20:02Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-data-pipeline/src/test/java/io/cdap/cdap/datapipeline/AutoJoinerTest.java", "diffHunk": "@@ -302,7 +302,8 @@ public void testAutoInnerJoinSkewed() throws Exception {\n                    .set(\"users_user_id\", 1)\n                    .set(\"users_name\", \"bob\").build());\n \n-    testSimpleAutoJoinSkewed(Arrays.asList(\"users\", \"interests\"), expected);\n+    testSimpleAutoJoinSkewed(Arrays.asList(\"users\", \"interests\"), expected,  Engine.SPARK);\n+    testSimpleAutoJoinSkewed(Arrays.asList(\"users\", \"interests\"), expected,  Engine.MAPREDUCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NjgwNQ==", "bodyText": "include a @deprecated in the javadoc and mention that getJoinKeys() should be used instead.", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461966805", "createdAt": "2020-07-29T00:20:32Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/Joiner.java", "diffHunk": "@@ -36,8 +39,21 @@\n    * @return returns join key\n    * @throws Exception if there is some error getting the join key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2Njk4Ng==", "bodyText": "add a space after Exception", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461966986", "createdAt": "2020-07-29T00:21:02Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/Joiner.java", "diffHunk": "@@ -36,8 +39,21 @@\n    * @return returns join key\n    * @throws Exception if there is some error getting the join key\n    */\n+  @Deprecated\n   JOIN_KEY joinOn(String stageName, INPUT_RECORD inputRecord) throws Exception;\n \n+  /**\n+   * Return value for the join keys on which join will be performed\n+   *\n+   * @param stageName name of the stage to which records belongs to\n+   * @param inputRecord input record to be joined\n+   * @return returns a list of join keys\n+   * @throws Exception if there is some error getting the join key\n+   */\n+  default Collection<JOIN_KEY> getJoinKeys(String stageName, INPUT_RECORD inputRecord) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NzE5Nw==", "bodyText": "return -> continue", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461967197", "createdAt": "2020-07-29T00:21:47Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-batch/src/main/java/io/cdap/cdap/etl/batch/mapreduce/MapReduceTransformExecutorFactory.java", "diffHunk": "@@ -309,13 +310,16 @@ protected PipeStage getSinkPipeStage(StageSpec stageSpec) throws Exception {\n     public void transform(RecordInfo<INPUT_RECORD> input,\n                           Emitter<KeyValue<OUT_KEY, TaggedWritable<OUT_VALUE>>> emitter) throws Exception {\n       String stageName = input.getFromStage();\n-      JOIN_KEY key = joiner.joinOn(stageName, input.getValue());\n-      if (shouldFilter.test(stageName, key)) {\n-        return;\n+      Collection<JOIN_KEY> keys = joiner.getJoinKeys(stageName, input.getValue());\n+      for (JOIN_KEY key : keys) {\n+        if (shouldFilter.test(stageName, key)) {\n+          return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2ODA5OA==", "bodyText": "can make this default as well, where the default implementation throws an exception. That way, plugins are not forced to implement this deprecated method.", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r461968098", "createdAt": "2020-07-29T00:24:59Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/Joiner.java", "diffHunk": "@@ -36,8 +39,21 @@\n    * @return returns join key\n    * @throws Exception if there is some error getting the join key\n    */\n+  @Deprecated\n   JOIN_KEY joinOn(String stageName, INPUT_RECORD inputRecord) throws Exception;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d5c4ba2fd39d1bfc0f01fb0a6771256330221b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjI5MTM2", "url": "https://github.com/cdapio/cdap/pull/12520#pullrequestreview-458629136", "createdAt": "2020-07-30T17:53:57Z", "commit": {"oid": "6bb15647603bc3af5c8798e8a0ade298f5d546c4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzo1Mzo1N1rOG5tulw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzo1NToxOFrOG5txyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3MTIyMw==", "bodyText": "avoid using classes from other libraries in the api modules. You can throw a UnsupportedOperationException instead.", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r463171223", "createdAt": "2020-07-30T17:53:57Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/Joiner.java", "diffHunk": "@@ -17,26 +17,48 @@\n package io.cdap.cdap.etl.api;\n \n import io.cdap.cdap.api.annotation.Beta;\n+import org.apache.commons.lang.NotImplementedException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bb15647603bc3af5c8798e8a0ade298f5d546c4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE3MjA0Mg==", "bodyText": "use {@link #getJoinKeys()} instead\nthat way the javadoc will link to the method.", "url": "https://github.com/cdapio/cdap/pull/12520#discussion_r463172042", "createdAt": "2020-07-30T17:55:18Z", "author": {"login": "albertshau"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/Joiner.java", "diffHunk": "@@ -17,26 +17,48 @@\n package io.cdap.cdap.etl.api;\n \n import io.cdap.cdap.api.annotation.Beta;\n+import org.apache.commons.lang.NotImplementedException;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n \n /**\n  * Provides join keys on which join needs to be performed and merges the join results.\n  *\n- * @param <JOIN_KEY> type of the join key\n+ * @param <JOIN_KEY>     type of the join key\n  * @param <INPUT_RECORD> type of input records to be joined\n- * @param <OUT> type of output object\n+ * @param <OUT>          type of output object\n  */\n @Beta\n public interface Joiner<JOIN_KEY, INPUT_RECORD, OUT> {\n \n   /**\n    * Return value for the join key on which join will be performed\n    *\n-   * @param stageName name of the stage to which records belongs to\n+   * @param stageName   name of the stage to which records belongs to\n    * @param inputRecord input record to be joined\n    * @return returns join key\n    * @throws Exception if there is some error getting the join key\n+   * @deprecated getJoinKeys() should be used instead", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bb15647603bc3af5c8798e8a0ade298f5d546c4"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "001f3d9fc3a3abffa56d82be5b623a2c1653271e", "author": {"user": {"login": "MEseifan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/001f3d9fc3a3abffa56d82be5b623a2c1653271e", "committedDate": "2020-07-30T18:02:26Z", "message": "(CDAP-17130) Added Distribution to BatchJoiner API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bb15647603bc3af5c8798e8a0ade298f5d546c4", "author": {"user": {"login": "MEseifan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6bb15647603bc3af5c8798e8a0ade298f5d546c4", "committedDate": "2020-07-29T17:02:58Z", "message": "Addressed comments and fixed checkstyle"}, "afterCommit": {"oid": "001f3d9fc3a3abffa56d82be5b623a2c1653271e", "author": {"user": {"login": "MEseifan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/001f3d9fc3a3abffa56d82be5b623a2c1653271e", "committedDate": "2020-07-30T18:02:26Z", "message": "(CDAP-17130) Added Distribution to BatchJoiner API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjU4Mzc4", "url": "https://github.com/cdapio/cdap/pull/12520#pullrequestreview-458658378", "createdAt": "2020-07-30T18:35:53Z", "commit": {"oid": "001f3d9fc3a3abffa56d82be5b623a2c1653271e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1874, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}