{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MDMxMTE4", "number": 12342, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowMToyOFrOEGB3XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowNTowNFrOEGB8Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NzU3NDY5OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/leftpanel-ctrl.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowMToyOVrOGkk2HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowMToyOVrOGkk2HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNTU5Nw==", "bodyText": "I think all these promises need to be chained since they could overwrite each other?", "url": "https://github.com/cdapio/cdap/pull/12342#discussion_r441005597", "createdAt": "2020-06-16T17:01:29Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/leftpanel-ctrl.js", "diffHunk": "@@ -96,7 +96,15 @@ class HydratorPlusPlusLeftPanelCtrl {\n         type: this.LEFTPANELSTORE_ACTIONS.PLUGIN_DEFAULT_VERSION_CHECK_AND_UPDATE\n       });\n       const defaultVersionMap = this.leftpanelStore.getState().plugins.pluginToVersionMap;\n-      this.mySettings.set('plugin-default-version', defaultVersionMap);\n+      this.mySettings.get('CURRENT_CDAP_VERSION')\n+      .then((defaultCDAPVersion) => {\n+        if (this.rVersion.version !== defaultCDAPVersion) {\n+          this.mySettings.set('plugin-default-version', {});\n+          this.mySettings.set('CURRENT_CDAP_VERSION', this.rVersion.version);\n+          return;\n+        }\n+        this.mySettings.set('plugin-default-version', defaultVersionMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4836ba39f6eec853bc06e1bdbbbc0ded55358b0"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NzU4NjcwOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/services/hydrator-node-service.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowNTowNFrOGkk-Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowNTowNFrOGkk-Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNzYxOQ==", "bodyText": "why do we need to do this twice in line 158 and 167?", "url": "https://github.com/cdapio/cdap/pull/12342#discussion_r441007619", "createdAt": "2020-06-16T17:05:04Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/services/hydrator-node-service.js", "diffHunk": "@@ -140,6 +140,37 @@ class HydratorPlusPlusNodeService {\n \n     return true;\n   }\n+\n+  getPluginToArtifactMap(plugins = []) {\n+    let typeMap = {};\n+    plugins.forEach( plugin => {\n+      typeMap[plugin.name] = typeMap[plugin.name] || [];\n+      typeMap[plugin.name].push(plugin);\n+    });\n+    return typeMap;\n+  }\n+\n+  getDefaultVersionForPlugin(plugin = {}, defaultVersionMap = {}) {\n+    if (!Object.keys(plugin).length) {\n+      return {};\n+    }\n+    if (Object.keys(defaultVersionMap).length) {\n+      const highestVersion = window.CaskCommon.VersionUtilities.findHighestVersion(plugin.allArtifacts.map((plugin) => plugin.artifact.version), true);\n+      return plugin.allArtifacts.find((plugin) => plugin.artifact.version === highestVersion);\n+    }\n+    let defaultVersionsList = Object.keys(defaultVersionMap);\n+    let key = `${plugin.name}-${plugin.type}-${plugin.artifact.name}`;\n+    let isDefaultVersionExists = defaultVersionsList.indexOf(key) !== -1;\n+\n+    let isArtifactExistsInBackend = (plugin.allArtifacts || []).filter(plug => angular.equals(plug.artifact, defaultVersionMap[key]));\n+    if (!isDefaultVersionExists || !isArtifactExistsInBackend.length) {\n+      const highestVersion = window.CaskCommon.VersionUtilities.findHighestVersion(plugin.allArtifacts.map((plugin) => plugin.artifact.version), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4836ba39f6eec853bc06e1bdbbbc0ded55358b0"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3409, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}