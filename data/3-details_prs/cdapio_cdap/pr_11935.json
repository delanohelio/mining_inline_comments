{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MzgzNzk2", "number": 11935, "title": "CDAP-16394 fix fll direction response", "bodyText": "https://issues.cask.co/browse/CDAP-16394\nhttps://builds.cask.co/browse/CDAP-DUT7134", "createdAt": "2020-03-09T04:49:18Z", "url": "https://github.com/cdapio/cdap/pull/11935", "merged": true, "mergeCommit": {"oid": "f15e0151f00a2b29ffdc5db696ff83db4dc6a35c"}, "closed": true, "closedAt": "2020-03-09T12:19:32Z", "author": {"login": "yaojiefeng"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL2irYAFqTM3MDkxNjY1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL8xtdgBqjMxMTAzNDMzMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTE2NjUz", "url": "https://github.com/cdapio/cdap/pull/11935#pullrequestreview-370916653", "createdAt": "2020-03-09T04:52:00Z", "commit": {"oid": "955853e5d4ecc2b6fecb5ba685f612113ff7c07c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTIzNjQy", "url": "https://github.com/cdapio/cdap/pull/11935#pullrequestreview-370923642", "createdAt": "2020-03-09T05:27:32Z", "commit": {"oid": "955853e5d4ecc2b6fecb5ba685f612113ff7c07c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTI1NjI3", "url": "https://github.com/cdapio/cdap/pull/11935#pullrequestreview-370925627", "createdAt": "2020-03-09T05:37:16Z", "commit": {"oid": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTI2NjAw", "url": "https://github.com/cdapio/cdap/pull/11935#pullrequestreview-370926600", "createdAt": "2020-03-09T05:41:46Z", "commit": {"oid": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo0MTo0NlrOFzbcIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo0MTo0NlrOFzbcIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTI2NQ==", "bodyText": "Is that mean directionStr can be null? Please annotate with @Nullable if that's the case.", "url": "https://github.com/cdapio/cdap/pull/11935#discussion_r389471265", "createdAt": "2020-03-09T05:41:46Z", "author": {"login": "chtyim"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/metadata/LineageHTTPHandler.java", "diffHunk": "@@ -301,7 +301,7 @@ public long getEnd() {\n   private Constants.FieldLineage.Direction parseDirection(String directionStr) throws BadRequestException {\n     try {\n       return Constants.FieldLineage.Direction.valueOf(directionStr.toUpperCase());\n-    } catch (IllegalArgumentException e) {\n+    } catch (NullPointerException | IllegalArgumentException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTI2OTk4", "url": "https://github.com/cdapio/cdap/pull/11935#pullrequestreview-370926998", "createdAt": "2020-03-09T05:43:40Z", "commit": {"oid": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo0Mzo0MVrOFzbdWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo0Mzo0MVrOFzbdWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MTU3OQ==", "bodyText": "Strictly speaking, should have URLEncoder.encode(direction).", "url": "https://github.com/cdapio/cdap/pull/11935#discussion_r389471579", "createdAt": "2020-03-09T05:43:41Z", "author": {"login": "chtyim"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/LineageClient.java", "diffHunk": "@@ -131,10 +132,31 @@ public LineageRecord getLineage(DatasetId datasetInstance, String startTime, Str\n     if (levels != null) {\n       path = String.format(\"%s&levels=%d\", path, levels);\n     }\n-    return getLineage(datasetInstance, path);\n+    return getLineage(datasetInstance, path, LineageRecord.class);\n   }\n \n-  private LineageRecord getLineage(NamespacedEntityId namespacedId, String path)\n+  /**\n+   * Retrieves field lineage about a dataset\n+   *\n+   * @param datasetId the dataset for which to retrieve lineage\n+   * @param startTime start time for the query, in milliseconds, or in 'now - xs' format\n+   * @param endTime end time for the query, in milliseconds, or in 'now - xs' format\n+   * @param direction direction of the field lineage, can be incoming, outgoing or both\n+   * @return {@link FieldLineageSummary} for the specified dataset.\n+   */\n+  public FieldLineageSummary getFieldLineage(DatasetId datasetId, long startTime, long endTime,\n+                                             String direction)\n+    throws IOException, BadRequestException, NotFoundException, UnauthenticatedException {\n+    String path = String.format(\"datasets/%s/lineage/allfieldlineage?start=%s&end=%s\", datasetId.getDataset(),\n+                                URLEncoder.encode(Long.toString(startTime), \"UTF-8\"),\n+                                URLEncoder.encode(Long.toString(endTime), \"UTF-8\"));\n+    if (direction != null) {\n+      path = String.format(\"%s&direction=%s\", path, direction);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b4cfe41e94f991fdc92c83d47ebb72ae4bb411"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455ebd8b869d1b889e2f21840b570a305b3dbf82", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/455ebd8b869d1b889e2f21840b570a305b3dbf82", "committedDate": "2020-03-09T12:07:33Z", "message": "CDAP-16394 fix fll direction response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fc6b98b74e7b7701f1be62dbb0dbc33488a766e", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/5fc6b98b74e7b7701f1be62dbb0dbc33488a766e", "committedDate": "2020-03-09T05:50:23Z", "message": "address comment"}, "afterCommit": {"oid": "455ebd8b869d1b889e2f21840b570a305b3dbf82", "author": {"user": {"login": "yaojiefeng", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/455ebd8b869d1b889e2f21840b570a305b3dbf82", "committedDate": "2020-03-09T12:07:33Z", "message": "CDAP-16394 fix fll direction response"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2216, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}