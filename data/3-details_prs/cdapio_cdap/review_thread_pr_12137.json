{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExOTk2NDg0", "number": 12137, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwOTowMDowN1rOD4UkjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNDo1NTo0OVrOD4m1rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzgzODg1OnYy", "diffSide": "RIGHT", "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwOTowMDowOFrOGPFWdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNDoyNjoyNFrOGPetyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2OTQ5Mg==", "bodyText": "We have two keys in the cdap-site.xml to control non-heap memory, twill.java.heap.memory.ratio and twill.java.reserved.memory.mb. You can get those through the MasterEnvironmentContext.getConfigurations() method. You can refer to the org.apache.twill.internal.utils.Resources.computeMaxHeapSize method on how it computes the xmx.", "url": "https://github.com/cdapio/cdap/pull/12137#discussion_r418469492", "createdAt": "2020-05-01T09:00:08Z", "author": {"login": "chtyim"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java", "diffHunk": "@@ -87,6 +87,7 @@\n   private static final String CPU_MULTIPLIER = \"master.environment.k8s.container.cpu.multiplier\";\n   private static final String MEMORY_MULTIPLIER = \"master.environment.k8s.container.memory.multiplier\";\n   private static final String DEFAULT_MULTIPLIER = \"1.0\";\n+  private static final double MEMORY_MAX_HEAP_SIZE_FRACTION = 0.8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5eb4b1912383931535cc9537969b2f6a41367b93"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg4NTA2NQ==", "bodyText": "Done. Added twill as dependency and uses the util function directly.", "url": "https://github.com/cdapio/cdap/pull/12137#discussion_r418885065", "createdAt": "2020-05-02T04:26:24Z", "author": {"login": "wyzhang"}, "path": "cdap-kubernetes/src/main/java/io/cdap/cdap/k8s/runtime/KubeTwillPreparer.java", "diffHunk": "@@ -87,6 +87,7 @@\n   private static final String CPU_MULTIPLIER = \"master.environment.k8s.container.cpu.multiplier\";\n   private static final String MEMORY_MULTIPLIER = \"master.environment.k8s.container.memory.multiplier\";\n   private static final String DEFAULT_MULTIPLIER = \"1.0\";\n+  private static final double MEMORY_MAX_HEAP_SIZE_FRACTION = 0.8;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2OTQ5Mg=="}, "originalCommit": {"oid": "5eb4b1912383931535cc9537969b2f6a41367b93"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNjgzMTgxOnYy", "diffSide": "RIGHT", "path": "cdap-kubernetes/pom.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNDo1NTo0OVrOGPfatA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNjo0MTo1MVrOGPg8hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NjU2NA==", "bodyText": "twill-core has quite a lot of dependencies. If you are only using one class, better to exclude all the dependencies. The Resources class in Twill has no dependency on non JDK classes", "url": "https://github.com/cdapio/cdap/pull/12137#discussion_r418896564", "createdAt": "2020-05-02T04:55:49Z", "author": {"login": "chtyim"}, "path": "cdap-kubernetes/pom.xml", "diffHunk": "@@ -76,6 +76,10 @@\n       <artifactId>logback-core</artifactId>\n       <scope>test</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.twill</groupId>\n+      <artifactId>twill-core</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "320fb687b88e5f9e127310774c5f8840b741fff8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyMTYwNg==", "bodyText": "Done. Excluded all dependencies of twill-core", "url": "https://github.com/cdapio/cdap/pull/12137#discussion_r418921606", "createdAt": "2020-05-02T06:41:51Z", "author": {"login": "wyzhang"}, "path": "cdap-kubernetes/pom.xml", "diffHunk": "@@ -76,6 +76,10 @@\n       <artifactId>logback-core</artifactId>\n       <scope>test</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.twill</groupId>\n+      <artifactId>twill-core</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODg5NjU2NA=="}, "originalCommit": {"oid": "320fb687b88e5f9e127310774c5f8840b741fff8"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2625, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}