{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2OTEzNzM0", "number": 11948, "title": "Add getInputStages API", "bodyText": "getInputStages() returns a list of stage names. Joiner plugin will call this API to get the input stage names instead of trying get it from the map returned by getInputSchemas(). This approach avoids issues with JSON serialization of null values.", "createdAt": "2020-03-11T20:49:39Z", "url": "https://github.com/cdapio/cdap/pull/11948", "merged": true, "mergeCommit": {"oid": "5a0b006695a34662fe53d11427564647bd70cab2"}, "closed": true, "closedAt": "2020-03-24T19:47:17Z", "author": {"login": "rmstar"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOyBn_gBqjMxNDAyMjgxMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ4HeRgBqjMxNjEyNjAwNDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02a4920ea39be6bd6e581e669659559054969d27", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/02a4920ea39be6bd6e581e669659559054969d27", "committedDate": "2020-03-11T20:49:09Z", "message": "Add custom JSON serializer/deserializer for StageSpec\n\nBy default, maps entries containing containing null value get dropped."}, "afterCommit": {"oid": "2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "committedDate": "2020-03-18T07:17:51Z", "message": "[CDAP-16324] Serialize NULLs in StageSpec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "committedDate": "2020-03-18T07:17:51Z", "message": "[CDAP-16324] Serialize NULLs in StageSpec"}, "afterCommit": {"oid": "398aa87c6db457168ee771dc00b2cdd5a49c71da", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/398aa87c6db457168ee771dc00b2cdd5a49c71da", "committedDate": "2020-03-18T07:20:52Z", "message": "[CDAP-16324] Serialize NULLs in StageSpec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72aa72d455016872355219dad75f7f2671528607", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/72aa72d455016872355219dad75f7f2671528607", "committedDate": "2020-03-18T08:00:26Z", "message": "cleaned up tests"}, "afterCommit": {"oid": "59835869f890866103143347b3cbae79f1269838", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/59835869f890866103143347b3cbae79f1269838", "committedDate": "2020-03-18T08:22:26Z", "message": "[CDAP-16324] Serialize NULLs in StageSpec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59835869f890866103143347b3cbae79f1269838", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/59835869f890866103143347b3cbae79f1269838", "committedDate": "2020-03-18T08:22:26Z", "message": "[CDAP-16324] Serialize NULLs in StageSpec"}, "afterCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/49b64195746bc30144592a5e73502a786b59c09e", "committedDate": "2020-03-20T06:23:14Z", "message": "[CDAP-16324] Add getInputStages API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM3MTQ2", "url": "https://github.com/cdapio/cdap/pull/11948#pullrequestreview-379737146", "createdAt": "2020-03-23T19:08:09Z", "commit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowODowOVrOF6UIKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxMDowOFrOF6UMPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQ5OA==", "bodyText": "Will it ever be null?? For stage that doesn't have input (source?), it should be just an empty list, not null.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396691498", "createdAt": "2020-03-23T19:08:09Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/common/DefaultStageConfigurer.java", "diffHunk": "@@ -75,6 +77,12 @@ public void setOutputSchemas(Map<String, Schema> outputSchemas) {\n     return inputSchemas;\n   }\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MjU0MA==", "bodyText": "This seems a bit unsafe to me. The original problem was that the schemas map keyset doesn't contains all input stages. And now we are using the same keyset to construct the input stages list?\nI think it is better to have the stage names pass in explicitly (probably with a fallback to the schemas keyset for backward compatibility when deserializing from older spec).", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396692540", "createdAt": "2020-03-23T19:10:08Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODI2Njc4", "url": "https://github.com/cdapio/cdap/pull/11948#pullrequestreview-379826678", "createdAt": "2020-03-23T21:13:14Z", "commit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMToxMzoxNFrOF6YUIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMToxNzo1M1rOF6Ydhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MDA5OQ==", "bodyText": "get a list of input stage names.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396760099", "createdAt": "2020-03-23T21:13:14Z", "author": {"login": "CuriousVini"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/MultiInputStageConfigurer.java", "diffHunk": "@@ -35,6 +36,13 @@\n    */\n   Map<String, Schema> getInputSchemas();\n \n+  /**\n+   * get the of input stage names", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjUwMw==", "bodyText": "better use Collections.unmodifiableList()", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396762503", "createdAt": "2020-03-23T21:17:53Z", "author": {"login": "CuriousVini"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTM0Njgx", "url": "https://github.com/cdapio/cdap/pull/11948#pullrequestreview-380134681", "createdAt": "2020-03-24T09:32:37Z", "commit": {"oid": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTozMjozN1rOF6nxSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTozMjozN1rOF6nxSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA==", "bodyText": "Why need a Multiset for equals? Because we can contains duplicates in input stages?", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397013320", "createdAt": "2020-03-24T09:32:37Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(HashMultiset.create(inputStages), HashMultiset.create(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjAxNzI5", "url": "https://github.com/cdapio/cdap/pull/11948#pullrequestreview-380601729", "createdAt": "2020-03-24T18:47:12Z", "commit": {"oid": "a0c351eb701f90ab723a58e8484c9e60f788ebe4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0NzoxMlrOF6-Zdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0NzoxMlrOF6-Zdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDA1NQ==", "bodyText": "You can use the Standard Java API new HashSet<>(inputStages).", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397384055", "createdAt": "2020-03-24T18:47:12Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(Sets.newHashSet(inputStages), Sets.newHashSet(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0c351eb701f90ab723a58e8484c9e60f788ebe4"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "committedDate": "2020-03-24T19:31:11Z", "message": "[CDAP-16324] Add getInputStages API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0c351eb701f90ab723a58e8484c9e60f788ebe4", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/a0c351eb701f90ab723a58e8484c9e60f788ebe4", "committedDate": "2020-03-24T18:14:39Z", "message": "replace Multitset with Set"}, "afterCommit": {"oid": "1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "author": {"user": {"login": "rmstar", "name": "Prashant Jaikumar"}}, "url": "https://github.com/cdapio/cdap/commit/1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "committedDate": "2020-03-24T19:31:11Z", "message": "[CDAP-16324] Add getInputStages API"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2234, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}