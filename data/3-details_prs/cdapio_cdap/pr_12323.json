{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODg5OTY5", "number": 12323, "title": "Support Dataproc custom Image", "bodyText": "First version of supporting custom dataproc image. Expiry of custom images not handled yet.", "createdAt": "2020-06-12T21:22:17Z", "url": "https://github.com/cdapio/cdap/pull/12323", "merged": true, "mergeCommit": {"oid": "c6c828bc6606a9f3d7b0edbb462cd5e3ce4986a1"}, "closed": true, "closedAt": "2020-06-16T18:41:18Z", "author": {"login": "greeshmaswaminathan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqq53RgFqTQzMDA3MzQ3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr5LyCgBqjM0NTAyMTgzNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDczNDc2", "url": "https://github.com/cdapio/cdap/pull/12323#pullrequestreview-430073476", "createdAt": "2020-06-12T22:48:31Z", "commit": {"oid": "006a8ecbf5b1278ae3b06566612a0332cd4d0f19"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjo0ODozMVrOGjTY7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjo0OTo0MlrOGjTaCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTAyMg==", "bodyText": "Check for not empty string as well.", "url": "https://github.com/cdapio/cdap/pull/12323#discussion_r439671022", "createdAt": "2020-06-12T22:48:31Z", "author": {"login": "chtyim"}, "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java", "diffHunk": "@@ -368,6 +368,24 @@ ClusterOperationMetadata createCluster(String name, String imageVersion, Map<Str\n       clusterProperties.put(\"dataproc:dataproc.monitoring.stackdriver.enable\",\n                             Boolean.toString(conf.isStackdriverMonitoringEnabled()));\n \n+      InstanceGroupConfig.Builder instanceGroupBuilder = InstanceGroupConfig.newBuilder()\n+          .setNumInstances(conf.getWorkerNumNodes())\n+          .setMachineTypeUri(conf.getWorkerMachineType())\n+          .setDiskConfig(DiskConfig.newBuilder()\n+              .setBootDiskSizeGb(conf.getWorkerDiskGB())\n+              .setNumLocalSsds(0)\n+              .build());\n+      //If custom Image URI is specified, use that for cluster creation\n+      if (conf.getCustomImageUri() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "006a8ecbf5b1278ae3b06566612a0332cd4d0f19"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTMwNA==", "bodyText": "Better group this with an else to the if above.", "url": "https://github.com/cdapio/cdap/pull/12323#discussion_r439671304", "createdAt": "2020-06-12T22:49:42Z", "author": {"login": "chtyim"}, "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocClient.java", "diffHunk": "@@ -368,6 +368,24 @@ ClusterOperationMetadata createCluster(String name, String imageVersion, Map<Str\n       clusterProperties.put(\"dataproc:dataproc.monitoring.stackdriver.enable\",\n                             Boolean.toString(conf.isStackdriverMonitoringEnabled()));\n \n+      InstanceGroupConfig.Builder instanceGroupBuilder = InstanceGroupConfig.newBuilder()\n+          .setNumInstances(conf.getWorkerNumNodes())\n+          .setMachineTypeUri(conf.getWorkerMachineType())\n+          .setDiskConfig(DiskConfig.newBuilder()\n+              .setBootDiskSizeGb(conf.getWorkerDiskGB())\n+              .setNumLocalSsds(0)\n+              .build());\n+      //If custom Image URI is specified, use that for cluster creation\n+      if (conf.getCustomImageUri() != null) {\n+        instanceGroupBuilder.setImageUri(conf.getCustomImageUri());\n+      }\n+\n+      SoftwareConfig.Builder softwareConfigBuilder = SoftwareConfig.newBuilder()\n+          .putAllProperties(clusterProperties);\n+      //Use image version only if custom Image URI is not specified, otherwise may cause image version conflicts\n+      if (conf.getCustomImageUri() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "006a8ecbf5b1278ae3b06566612a0332cd4d0f19"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "006a8ecbf5b1278ae3b06566612a0332cd4d0f19", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/006a8ecbf5b1278ae3b06566612a0332cd4d0f19", "committedDate": "2020-06-12T20:21:19Z", "message": "Support Dataproc custom Image"}, "afterCommit": {"oid": "c5b124b28f1a09aaa51636b7583434f0eda22853", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/c5b124b28f1a09aaa51636b7583434f0eda22853", "committedDate": "2020-06-13T03:33:35Z", "message": "Support Dataproc custom Image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTExNzgx", "url": "https://github.com/cdapio/cdap/pull/12323#pullrequestreview-430111781", "createdAt": "2020-06-13T04:08:59Z", "commit": {"oid": "c5b124b28f1a09aaa51636b7583434f0eda22853"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6434484ee3ad04ccb42c1bcdf3591628093ee5cf", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6434484ee3ad04ccb42c1bcdf3591628093ee5cf", "committedDate": "2020-06-16T18:01:53Z", "message": "Support Dataproc custom Image"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5b124b28f1a09aaa51636b7583434f0eda22853", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/c5b124b28f1a09aaa51636b7583434f0eda22853", "committedDate": "2020-06-13T03:33:35Z", "message": "Support Dataproc custom Image"}, "afterCommit": {"oid": "6434484ee3ad04ccb42c1bcdf3591628093ee5cf", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6434484ee3ad04ccb42c1bcdf3591628093ee5cf", "committedDate": "2020-06-16T18:01:53Z", "message": "Support Dataproc custom Image"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2019, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}