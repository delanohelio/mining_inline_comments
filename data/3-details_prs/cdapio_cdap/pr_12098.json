{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NjgzOTU4", "number": 12098, "title": "[CDAP-16612] Make sure correct classpath is used when using ssh for s\u2026", "bodyText": "\u2026treaming pipeline launch\nAlso made launching jobs using dataproc job apis configurable through provisioner context.", "createdAt": "2020-04-21T13:43:45Z", "url": "https://github.com/cdapio/cdap/pull/12098", "merged": true, "mergeCommit": {"oid": "befe2b2e63c1635293ef70e27b41f1e8428452b1"}, "closed": true, "closedAt": "2020-04-22T02:17:47Z", "author": {"login": "CuriousVini"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ2n93gFqTM5NzQ2NjA5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ89McAFqTM5Nzc2MDExMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NDY2MDkw", "url": "https://github.com/cdapio/cdap/pull/12098#pullrequestreview-397466090", "createdAt": "2020-04-21T16:20:48Z", "commit": {"oid": "a6510f356059f7ac60f71815a5a25a3a682c02a1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNjozMTozM1rOGJNT-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNjo1MjozOVrOGJORIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMwODQ3NA==", "bodyText": "Should it be ISOLATED?", "url": "https://github.com/cdapio/cdap/pull/12098#discussion_r412308474", "createdAt": "2020-04-21T16:31:33Z", "author": {"login": "chtyim"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/distributed/DistributedProgramRunner.java", "diffHunk": "@@ -194,6 +194,10 @@ public final ProgramController run(final Program program, ProgramOptions oldOpti\n                                                          cConf.get(Constants.AppFabric.TEMP_DIR)).getAbsoluteFile());\n     try {\n       final ProgramLaunchConfig launchConfig = new ProgramLaunchConfig();\n+      if (clusterMode == ClusterMode.ON_PREMISE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6510f356059f7ac60f71815a5a25a3a682c02a1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyMzY4OA==", "bodyText": "Why only for spark runner?", "url": "https://github.com/cdapio/cdap/pull/12098#discussion_r412323688", "createdAt": "2020-04-21T16:52:11Z", "author": {"login": "chtyim"}, "path": "cdap-spark-core-base/src/main/java/io/cdap/cdap/app/runtime/spark/distributed/DistributedSparkProgramRunner.java", "diffHunk": "@@ -137,15 +140,24 @@ protected void setupLaunchConfig(ProgramLaunchConfig launchConfig, Program progr\n     ApplicationSpecification appSpec = program.getApplicationSpecification();\n     SparkSpecification spec = appSpec.getSpark().get(program.getName());\n \n-    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\",\n-                                                                   options.getUserArguments().asMap());\n+    Arguments userArguments = options.getUserArguments();\n+    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\", userArguments.asMap());\n     // Add runnable. Only one instance for the spark client\n     launchConfig.addRunnable(spec.getName(), new SparkTwillRunnable(spec.getName()), 1,\n                              clientArgs, spec.getClientResources(), 0);\n \n     Map<String, String> extraEnv = new HashMap<>();\n     extraEnv.put(Constants.SPARK_COMPAT_ENV, sparkCompat.getCompat());\n \n+    if (userArguments.hasOption(SystemArguments.RUNTIME_MANAGER_TYPE) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6510f356059f7ac60f71815a5a25a3a682c02a1"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyNDEzMA==", "bodyText": "Also, it shouldn't matter of the launch type.", "url": "https://github.com/cdapio/cdap/pull/12098#discussion_r412324130", "createdAt": "2020-04-21T16:52:39Z", "author": {"login": "chtyim"}, "path": "cdap-spark-core-base/src/main/java/io/cdap/cdap/app/runtime/spark/distributed/DistributedSparkProgramRunner.java", "diffHunk": "@@ -137,15 +140,24 @@ protected void setupLaunchConfig(ProgramLaunchConfig launchConfig, Program progr\n     ApplicationSpecification appSpec = program.getApplicationSpecification();\n     SparkSpecification spec = appSpec.getSpark().get(program.getName());\n \n-    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\",\n-                                                                   options.getUserArguments().asMap());\n+    Arguments userArguments = options.getUserArguments();\n+    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\", userArguments.asMap());\n     // Add runnable. Only one instance for the spark client\n     launchConfig.addRunnable(spec.getName(), new SparkTwillRunnable(spec.getName()), 1,\n                              clientArgs, spec.getClientResources(), 0);\n \n     Map<String, String> extraEnv = new HashMap<>();\n     extraEnv.put(Constants.SPARK_COMPAT_ENV, sparkCompat.getCompat());\n \n+    if (userArguments.hasOption(SystemArguments.RUNTIME_MANAGER_TYPE) &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyMzY4OA=="}, "originalCommit": {"oid": "a6510f356059f7ac60f71815a5a25a3a682c02a1"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6510f356059f7ac60f71815a5a25a3a682c02a1", "author": {"user": {"login": "CuriousVini", "name": "Vinisha Shah"}}, "url": "https://github.com/cdapio/cdap/commit/a6510f356059f7ac60f71815a5a25a3a682c02a1", "committedDate": "2020-04-21T13:43:20Z", "message": "[CDAP-16612] Make sure correct classpath is used when using ssh for streaming pipeline launch"}, "afterCommit": {"oid": "e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e", "author": {"user": {"login": "CuriousVini", "name": "Vinisha Shah"}}, "url": "https://github.com/cdapio/cdap/commit/e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e", "committedDate": "2020-04-21T17:30:21Z", "message": "[CDAP-16612] Make sure correct classpath is used when using ssh for streaming pipeline launch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTQxMjk3", "url": "https://github.com/cdapio/cdap/pull/12098#pullrequestreview-397541297", "createdAt": "2020-04-21T17:54:37Z", "commit": {"oid": "e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo1NDozN1rOGJRB5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo1NDozN1rOGJRB5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2OTM4Mw==", "bodyText": "What is this for?", "url": "https://github.com/cdapio/cdap/pull/12098#discussion_r412369383", "createdAt": "2020-04-21T17:54:37Z", "author": {"login": "chtyim"}, "path": "cdap-spark-core-base/src/main/java/io/cdap/cdap/app/runtime/spark/distributed/DistributedSparkProgramRunner.java", "diffHunk": "@@ -137,15 +140,24 @@ protected void setupLaunchConfig(ProgramLaunchConfig launchConfig, Program progr\n     ApplicationSpecification appSpec = program.getApplicationSpecification();\n     SparkSpecification spec = appSpec.getSpark().get(program.getName());\n \n-    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\",\n-                                                                   options.getUserArguments().asMap());\n+    Arguments userArguments = options.getUserArguments();\n+    Map<String, String> clientArgs = RuntimeArguments.extractScope(\"task\", \"client\", userArguments.asMap());\n     // Add runnable. Only one instance for the spark client\n     launchConfig.addRunnable(spec.getName(), new SparkTwillRunnable(spec.getName()), 1,\n                              clientArgs, spec.getClientResources(), 0);\n \n     Map<String, String> extraEnv = new HashMap<>();\n     extraEnv.put(Constants.SPARK_COMPAT_ENV, sparkCompat.getCompat());\n \n+    if (!userArguments.hasOption(SystemArguments.RUNTIME_MANAGER_TYPE) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5152ac26d16cfa847dbeb2313695c06afed4a90d", "author": {"user": {"login": "CuriousVini", "name": "Vinisha Shah"}}, "url": "https://github.com/cdapio/cdap/commit/5152ac26d16cfa847dbeb2313695c06afed4a90d", "committedDate": "2020-04-21T22:39:48Z", "message": "[CDAP-16612] Make sure correct classpath is used when using ssh for streaming pipeline launch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e", "author": {"user": {"login": "CuriousVini", "name": "Vinisha Shah"}}, "url": "https://github.com/cdapio/cdap/commit/e2dd9de5c8e34cb98c1670a8a27bd14b5d4faf9e", "committedDate": "2020-04-21T17:30:21Z", "message": "[CDAP-16612] Make sure correct classpath is used when using ssh for streaming pipeline launch"}, "afterCommit": {"oid": "5152ac26d16cfa847dbeb2313695c06afed4a90d", "author": {"user": {"login": "CuriousVini", "name": "Vinisha Shah"}}, "url": "https://github.com/cdapio/cdap/commit/5152ac26d16cfa847dbeb2313695c06afed4a90d", "committedDate": "2020-04-21T22:39:48Z", "message": "[CDAP-16612] Make sure correct classpath is used when using ssh for streaming pipeline launch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzYwMTEw", "url": "https://github.com/cdapio/cdap/pull/12098#pullrequestreview-397760110", "createdAt": "2020-04-22T00:15:20Z", "commit": {"oid": "5152ac26d16cfa847dbeb2313695c06afed4a90d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2177, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}