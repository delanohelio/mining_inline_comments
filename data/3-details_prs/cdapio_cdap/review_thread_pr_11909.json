{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMjUwODUz", "number": 11909, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMzo1MzozMlrODkd4qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NTo1NVrODkr02w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTY0OTcxOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/services/datasource/index.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMzo1MzozMlrOFwzn8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjozMzoyMFrOFw2b0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyMTc3OQ==", "bodyText": "There might be a potential issue with using interval. We are queing request every 10 seconds, so if for some reason response takes longer than 10 seconds, the request will keep piling. Would it be better to do this as a timeout on the response callback instead?", "url": "https://github.com/cdapio/cdap/pull/11909#discussion_r386721779", "createdAt": "2020-03-02T23:53:32Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/cdap/services/datasource/index.js", "diffHunk": "@@ -230,26 +240,33 @@ export default class Datasource {\n       type: 'POLL',\n     };\n \n-    this.socketSend('poll-start', generatedResource);\n+    this.socketSend('request', generatedResource);\n \n     return observable;\n   }\n \n+  startClientPoll = (resourceId, interval) => {\n+    const intervalTimer = setInterval(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "373aba95e776e9b9714212e7173bd757faa01ba3"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2NzgyNQ==", "bodyText": "Good point. Have updated the PR", "url": "https://github.com/cdapio/cdap/pull/11909#discussion_r386767825", "createdAt": "2020-03-03T02:33:20Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/services/datasource/index.js", "diffHunk": "@@ -230,26 +240,33 @@ export default class Datasource {\n       type: 'POLL',\n     };\n \n-    this.socketSend('poll-start', generatedResource);\n+    this.socketSend('request', generatedResource);\n \n     return observable;\n   }\n \n+  startClientPoll = (resourceId, interval) => {\n+    const intervalTimer = setInterval(() => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyMTc3OQ=="}, "originalCommit": {"oid": "373aba95e776e9b9714212e7173bd757faa01ba3"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NzkyODA0OnYy", "diffSide": "RIGHT", "path": "cdap-ui/server.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NDo0M1rOFxJHAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NDo0M1rOFxJHAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA3Mzc5NQ==", "bodyText": "Please change this to debug", "url": "https://github.com/cdapio/cdap/pull/11909#discussion_r387073795", "createdAt": "2020-03-03T14:54:43Z", "author": {"login": "nitinmotgi"}, "path": "cdap-ui/server.js", "diffHunk": "@@ -156,9 +156,11 @@ getCDAPConfig()\n     });\n \n     sockServer.on('connection', function(c) {\n+      log.info('[SOCKET OPEN] Connection to client \"' + c.id + '\" opened');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a15f26885fbc20125918255d45a144dea7e7cb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NzkzMjMzOnYy", "diffSide": "RIGHT", "path": "cdap-ui/server/aggregator.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NTozN1rOFxJJqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NTozN1rOFxJJqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA3NDQ3Mw==", "bodyText": "This should be debug or info. This can fill up disk.", "url": "https://github.com/cdapio/cdap/pull/11909#discussion_r387074473", "createdAt": "2020-03-03T14:55:37Z", "author": {"login": "nitinmotgi"}, "path": "cdap-ui/server/aggregator.js", "diffHunk": "@@ -449,21 +310,13 @@ function onSocketData(message) {\n         );\n         this.pushConfiguration(r);\n         break;\n-      case 'poll-start':\n-        log.debug('[POLL-START]: (method: ' + r.method + ', id: ' + r.id + ', url: ' + r.url + ')');\n-        this.startPolling(r);\n-        break;\n       case 'request':\n         r.startTs = Date.now();\n-        log.debug('[REQUEST]: (method: ' + r.method + ', id: ' + r.id + ', url: ' + r.url + ')');\n+        log.info('[REQUEST]: (method: ' + r.method + ', id: ' + r.id + ', url: ' + r.url + ')');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a15f26885fbc20125918255d45a144dea7e7cb"}, "originalPosition": 204}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NzkzMzcxOnYy", "diffSide": "RIGHT", "path": "cdap-ui/server/aggregator.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NTo1NVrOFxJKfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NTo1NVrOFxJKfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA3NDY4NQ==", "bodyText": "Same level as connect", "url": "https://github.com/cdapio/cdap/pull/11909#discussion_r387074685", "createdAt": "2020-03-03T14:55:55Z", "author": {"login": "nitinmotgi"}, "path": "cdap-ui/server/aggregator.js", "diffHunk": "@@ -474,8 +327,7 @@ function onSocketData(message) {\n  * @private onSocketClose\n  */\n function onSocketClose() {\n-  this.stopPollingAll();\n-  this.polledResources = {};\n+  log.info('[SOCKET CLOSE] Connection to client \"' + this.connection.id + '\" closed');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a15f26885fbc20125918255d45a144dea7e7cb"}, "originalPosition": 222}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2985, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}