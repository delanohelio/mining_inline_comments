{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NDg2MDk1", "number": 12500, "title": "Support Instance URI prefix for CLI by removing host:port assumption", "bodyText": "Support Instance URI prefix for CLI by removing host:port assumption\n\n-u option always assumed that the URI is in the format \"[http[s]://]<hostname>[:<port>[/<namespace>]]\".  This assumption is not always correct as some instance URIs may be in the form http[s]://hostname/path.\n-u option is left as it is to support backward compatibility, but is now marked as deprecated. On using -u option, a new message appears indicating the deprecated status and suggestion to use the new one.\n-l option is introduced to take in URI in the new format. This assumes URI to be in the format \"http[s]://hostname:[port]/[path]\". Since the namespace is not expected to be in the URI, a new option is introduced to take in namespace.\nBy default this will be set to the earlier default value \"http://<hostname>.local:11015\".\n-n option used with -l option can be used to set namespace value. By default this will be set to default namespace.\naccesstoken is expected to be saved in a file as specified in https://docs.cask.co/cdap/develop/en/reference-manual/cli-api.html#connecting-to-secure-cdap-instances for instance to connect if URI is n the form http[s]://hostname/path.\nconnect command allows to switch connection from the CLI. Since this command had the same URI format (\"[http[s]://]<hostname>[:<port>[/<namespace>]]\") assumption, this is now deprecated as well. Using this will give a message indicating the deprecation status.\nconnect-link command is now introduced which takes in URI in the new format and namespace.\nExisting sandbox tests reused for testing the new -l option\nOther minor fixes to avoid 411 errors. This happens when an empty body is sent with a POST request when URI is in the format https://instanceuri/api.\n\nManual tests done\n\nConnected to an instance with URI of the form https://instanceuri/api with no namespace option\nConnected to an instance with URI of the form https://instanceuri/api with non default namespace\nSwitched connection with connect-link and connect commands\nSwitched namespace with 'use namespace' command\nTested 'list' options - namespaces, apps, dataset, workflow, artifacts\nCreated an app using 'create app' option\nStarted workflow the 'start workflow' option\nTested all 'Metric' commands\nTested all 'Namespace' commands\nTested 'get lineage dataset' and 'get metadata ' commands", "createdAt": "2020-07-24T20:53:47Z", "url": "https://github.com/cdapio/cdap/pull/12500", "merged": true, "mergeCommit": {"oid": "bd42c919a163d787e772def37f296d55549bafcb"}, "closed": true, "closedAt": "2020-07-29T19:24:14Z", "author": {"login": "greeshmaswaminathan"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4KzcegFqTQ1NTE5MTE3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5umk2ABqjM2MDAxMjExNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTkxMTc4", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-455191178", "createdAt": "2020-07-24T21:18:46Z", "commit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMToxODo0N1rOG2-CZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMToyMTowMVrOG2-FcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI5MjcwOA==", "bodyText": "revert back to previous. Same for others.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460292708", "createdAt": "2020-07-24T21:18:47Z", "author": {"login": "pandyajay10"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/ApplicationClient.java", "diffHunk": "@@ -94,26 +94,27 @@ public ApplicationClient(ClientConfig config) {\n    *\n    * @param namespace the namespace to list applications from\n    * @return list of {@link ApplicationRecord ApplicationRecords}.\n-   * @throws IOException if a network error occurred", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI5MzQ4OA==", "bodyText": "here and other places same.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460293488", "createdAt": "2020-07-24T21:21:01Z", "author": {"login": "pandyajay10"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/ApplicationClient.java", "diffHunk": "@@ -438,9 +444,9 @@ public void deploy(NamespaceId namespace, File jarFile,\n   /**\n    * Creates an application with a version using an existing artifact.\n    *\n-   * @param appId the id of the application to add", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "originalPosition": 270}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTk2MDY2", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-455196066", "createdAt": "2020-07-24T21:30:29Z", "commit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTozMDoyOVrOG2-SBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTozMDoyOVrOG2-SBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI5NjcxMA==", "bodyText": "do we need setUri?", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460296710", "createdAt": "2020-07-24T21:30:29Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/LaunchOptions.java", "diffHunk": "@@ -67,12 +84,19 @@ public static Builder builder() {\n     private boolean autoconnect;\n     private boolean debug;\n     private boolean verifySSL;\n+    private String namespace;\n+    private String instanceURI;\n \n     public Builder setUri(String uri) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTk3NDMy", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-455197432", "createdAt": "2020-07-24T21:33:45Z", "commit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTozMzo0NVrOG2-WiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTozMzo0NVrOG2-WiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI5Nzg2NA==", "bodyText": "A better error message? May be something like \"Check connection parameters and/or accesstoken\". Would invalid accesstoken throw IOException? Or it will be for invalid access token file?", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460297864", "createdAt": "2020-07-24T21:33:45Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIConfig.java", "diffHunk": "@@ -183,7 +183,7 @@ private void checkConnection(ClientConfig baseClientConfig, ConnectionConfig con\n     try {\n       metaClient.ping();\n     } catch (IOException e) {\n-      throw new IOException(\"Check hostname and/or port\", e);\n+      throw new IOException(\"Check hostname and/or port and/or accesstoken\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c2b244a1b7f66b1aa9b71c954c80c2727a28b77", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/4c2b244a1b7f66b1aa9b71c954c80c2727a28b77", "committedDate": "2020-07-24T20:22:26Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6a391481548df11239774f6a336a2f8f90004d8c", "committedDate": "2020-07-25T00:29:54Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzAxOTQ0", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-455301944", "createdAt": "2020-07-25T18:32:21Z", "commit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxODozMjoyMVrOG3GgmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxODo0MjoxNVrOG3Gj5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMTUxMg==", "bodyText": "Instead of defining test methods as static and have other classes calling it, it is better to define this class as a Base class with @Test method and have sub-classes to just alter the behavior instead of repeating all the test methods. You can have all the parameters to test methods defined as protected abstract method and let the sub-classes to implement them and return instances needed by the test methods.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460431512", "createdAt": "2020-07-25T18:32:21Z", "author": {"login": "chtyim"}, "path": "cdap-cli-tests/src/test/java/io/cdap/cdap/cli/CLICommonTests.java", "diffHunk": "@@ -0,0 +1,919 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.cli;\n+\n+\n+import com.google.common.base.Charsets;\n+import com.google.common.base.Function;\n+import com.google.common.base.Joiner;\n+import com.google.common.base.Splitter;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Lists;\n+import com.google.common.collect.Maps;\n+import com.google.common.io.Files;\n+import com.google.common.util.concurrent.ListenableFuture;\n+import com.google.gson.Gson;\n+import io.cdap.cdap.ConfigTestApp;\n+import io.cdap.cdap.StandaloneTester;\n+import io.cdap.cdap.api.artifact.ArtifactScope;\n+import io.cdap.cdap.api.metadata.MetadataEntity;\n+import io.cdap.cdap.cli.command.NamespaceCommandUtils;\n+import io.cdap.cdap.cli.command.metadata.MetadataCommandHelper;\n+import io.cdap.cdap.cli.util.RowMaker;\n+import io.cdap.cdap.cli.util.table.Table;\n+import io.cdap.cdap.client.DatasetTypeClient;\n+import io.cdap.cdap.client.NamespaceClient;\n+import io.cdap.cdap.client.ProgramClient;\n+import io.cdap.cdap.client.QueryClient;\n+import io.cdap.cdap.client.app.FakeApp;\n+import io.cdap.cdap.client.app.FakeDataset;\n+import io.cdap.cdap.client.app.FakePlugin;\n+import io.cdap.cdap.client.app.FakeSpark;\n+import io.cdap.cdap.client.app.FakeWorkflow;\n+import io.cdap.cdap.client.app.PingService;\n+import io.cdap.cdap.client.app.PluginConfig;\n+import io.cdap.cdap.client.app.PrefixedEchoHandler;\n+import io.cdap.cdap.common.DatasetTypeNotFoundException;\n+import io.cdap.cdap.common.io.Locations;\n+import io.cdap.cdap.common.test.AppJarHelper;\n+import io.cdap.cdap.common.utils.Tasks;\n+import io.cdap.cdap.explore.client.ExploreExecutionResult;\n+import io.cdap.cdap.proto.DatasetTypeMeta;\n+import io.cdap.cdap.proto.NamespaceMeta;\n+import io.cdap.cdap.proto.ProgramRunStatus;\n+import io.cdap.cdap.proto.ProgramStatus;\n+import io.cdap.cdap.proto.QueryStatus;\n+import io.cdap.cdap.proto.RunRecord;\n+import io.cdap.cdap.proto.WorkflowTokenDetail;\n+import io.cdap.cdap.proto.id.ApplicationId;\n+import io.cdap.cdap.proto.id.ArtifactId;\n+import io.cdap.cdap.proto.id.DatasetId;\n+import io.cdap.cdap.proto.id.DatasetTypeId;\n+import io.cdap.cdap.proto.id.NamespaceId;\n+import io.cdap.cdap.proto.id.ProgramId;\n+import io.cdap.cdap.proto.id.ServiceId;\n+import io.cdap.common.cli.CLI;\n+import org.apache.twill.filesystem.LocalLocationFactory;\n+import org.apache.twill.filesystem.Location;\n+import org.apache.twill.filesystem.LocationFactory;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.BufferedWriter;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.io.PrintWriter;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.TimeUnit;\n+import javax.annotation.Nullable;\n+\n+public class CLICommonTests {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMTc2NA==", "bodyText": "So access token is always needed now??", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460431764", "createdAt": "2020-07-25T18:35:11Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIConfig.java", "diffHunk": "@@ -196,10 +196,6 @@ private UserAccessToken acquireAccessToken(\n     ClientConfig clientConfig, ConnectionConfig connectionInfo, PrintStream output,\n     boolean debug) throws IOException, UnauthorizedException {\n \n-    if (!isAuthenticationEnabled(connectionInfo)) {\n-      return null;\n-    }\n-\n     try {\n       UserAccessToken savedToken = getSavedAccessToken(connectionInfo.getHostname());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMTg1NA==", "bodyText": "annotate with @Nullable since null value is being passed for this parameter.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460431854", "createdAt": "2020-07-25T18:36:10Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIConnectionConfig.java", "diffHunk": "@@ -42,8 +43,13 @@ public CLIConnectionConfig(CLIConnectionConfig connectionConfig, NamespaceId nam\n     this.namespace = namespace;\n   }\n \n-  public CLIConnectionConfig(NamespaceId namespace, String hostname, int port, boolean sslEnabled) {\n-    super(hostname, port, sslEnabled);\n+  public CLIConnectionConfig(NamespaceId namespace, String hostname, Integer port, boolean sslEnabled) {\n+    this(namespace, hostname, port, sslEnabled, null);\n+  }\n+\n+  public CLIConnectionConfig(NamespaceId namespace, String hostname, Integer port, boolean sslEnabled,\n+                             String apiPath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMTkwOQ==", "bodyText": "Overriding equals requires overriding hashCode too.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460431909", "createdAt": "2020-07-25T18:36:46Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIConnectionConfig.java", "diffHunk": "@@ -58,8 +64,23 @@ public String getUsername() {\n \n   @Override\n   public URI getURI() {\n-    return URI.create(String.format(\"%s://%s%s:%d/%s\", super.isSSLEnabled() ? \"https\" : \"http\",\n-                                    username == null ? \"\" : username + \"@\",\n-                                    super.getHostname(), super.getPort(), namespace.getNamespace()));\n+    return URI.create(String.format(\"%s://%s%s/%s%s\", super.isSSLEnabled() ? \"https\" : \"http\",\n+                                    (username == null || username.isEmpty()) ? \"\" : username + \"@\",\n+                                    getFullHost(), getApiPath() == null ? \"\" : getApiPath(),\n+                                    namespace.getNamespace()));\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMTk5NQ==", "bodyText": "There is no need to have or for the format. The format is just:\nhttp[s]://<hostname>[:<port>][/<path>]", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460431995", "createdAt": "2020-07-25T18:37:57Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIMain.java", "diffHunk": "@@ -81,10 +83,19 @@\n     \"h\", \"help\", false, \"Print the usage message.\");\n \n   private static final Option URI_OPTION = new Option(\n-    \"u\", \"uri\", true, \"CDAP instance URI to interact with in\" +\n+    \"u\", \"uri\", true, \"(Deprecated. Please use option l instead). CDAP instance URI to interact with in\" +\n     \" the format \\\"[http[s]://]<hostname>[:<port>[/<namespace>]]\\\".\" +\n     \" Defaults to \\\"\" + getDefaultURI().toString() + \"\\\".\");\n \n+  private static final Option LINK_OPTION = new Option(\n+    \"l\", \"link\", true, \"CDAP instance URI to interact with in\" +\n+    \" the format \\\"[http[s]://]<hostname>[:<port>]\\\" or \\\"[https[s]://]<hostname>[/<apipath>]\\\".\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMjAyNw==", "bodyText": "annotate with @Nullable", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460432027", "createdAt": "2020-07-25T18:38:28Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/LaunchOptions.java", "diffHunk": "@@ -31,18 +31,31 @@\n   private final boolean autoconnect;\n   private final boolean debug;\n   private final boolean verifySSL;\n+  private final String namespace;\n+  private final String instanceURI;\n \n   public LaunchOptions(String uri, boolean autoconnect, boolean debug, boolean verifySSL) {\n+    this(uri, autoconnect, debug, verifySSL, null, null);\n+  }\n+\n+  public LaunchOptions(String uri, boolean autoconnect, boolean debug, boolean verifySSL,\n+                       String namespace, String instanceURI) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMjIyOQ==", "bodyText": "You can combine the withBody and build to\nHttpRequest request = HttpRequest.post(url).withBody(\"\").build();", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460432229", "createdAt": "2020-07-25T18:40:46Z", "author": {"login": "chtyim"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/DatasetClient.java", "diffHunk": "@@ -240,7 +240,10 @@ public void truncate(DatasetId instance)\n     throws IOException, UnauthenticatedException, UnauthorizedException {\n     URL url = config.resolveNamespacedURLV3(instance.getParent(),\n                                             String.format(\"data/datasets/%s/admin/truncate\", instance.getDataset()));\n-    restClient.execute(HttpMethod.POST, url, config.getAccessToken());\n+    HttpRequest.Builder request = HttpRequest.post(url);\n+    //Important to add body even if runtimeArgs is null to avoid 411 error for Http POST\n+    request.withBody(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMjI3OQ==", "bodyText": "Same as above. Combine into a single line would make this more readable.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460432279", "createdAt": "2020-07-25T18:41:28Z", "author": {"login": "chtyim"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/MetricsClient.java", "diffHunk": "@@ -87,7 +87,10 @@ public MetricsClient(ClientConfig config) {\n     addTags(tags, queryParts);\n \n     URL url = config.resolveURLV3(String.format(\"metrics/search?%s\", Joiner.on(\"&\").join(queryParts)));\n-    HttpResponse response = restClient.execute(HttpMethod.POST, url, config.getAccessToken());\n+    HttpRequest.Builder request = HttpRequest.post(url);\n+    //Important to add body even if runtimeArgs is null to avoid 411 error for Http POST\n+    request.withBody(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQzMjM1Nw==", "bodyText": "Modifying equals requires modifying hashCode as well.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r460432357", "createdAt": "2020-07-25T18:42:15Z", "author": {"login": "chtyim"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/config/ConnectionConfig.java", "diffHunk": "@@ -113,7 +128,8 @@ public boolean equals(Object obj) {\n     final ConnectionConfig other = (ConnectionConfig) obj;\n     return Objects.equal(this.hostname, other.hostname) &&\n       Objects.equal(this.port, other.port) &&\n-      Objects.equal(this.sslEnabled, other.sslEnabled);\n+      Objects.equal(this.sslEnabled, other.sslEnabled) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c"}, "originalPosition": 77}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a391481548df11239774f6a336a2f8f90004d8c", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/6a391481548df11239774f6a336a2f8f90004d8c", "committedDate": "2020-07-25T00:29:54Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/733ce1e14986910151a119cea953fcacfebe4cf8", "committedDate": "2020-07-27T21:38:19Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTk5ODgy", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456199882", "createdAt": "2020-07-27T23:21:52Z", "commit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzoyMTo1M1rOG32-Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzoyMTo1M1rOG32-Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyNTUxOA==", "bodyText": "Try to keep the same alignment with the \"String.fornat(\" block.. same for everywhere else.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461225518", "createdAt": "2020-07-27T23:21:53Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli-tests/src/test/java/io/cdap/cdap/cli/AuthorizationCLITest.java", "diffHunk": "@@ -141,75 +141,79 @@ public void testAuthorizationCLI() throws Exception {\n \n     NamespaceId namespaceId = new NamespaceId(\"ns1\");\n \n-    testCommandOutputContains(cli, String.format(\"create namespace %s\", namespaceId.getNamespace()),\n+    CLITestBase.testCommandOutputContains(cli, String.format(\"create namespace %s\", namespaceId.getNamespace()),\n                               String.format(\"Namespace '%s' created successfully\", namespaceId.getNamespace()));\n \n     // test creating role\n-    testCommandOutputContains(cli, \"create role \" + role.getName(), String.format(\"Successfully created role '%s'\",\n-                                                                                  role.getName()));\n+    CLITestBase.testCommandOutputContains(cli, \"create role \" + role.getName(),\n+                                          String.format(\"Successfully created role '%s'\",\n+                                                        role.getName()));\n \n     // test add role to principal\n-    testCommandOutputContains(cli, String.format(\"add role %s to %s %s\", role.getName(), principal.getType(),\n-                                                 principal.getName()),\n-                              String.format(\"Successfully added role '%s' to '%s' '%s'\", role.getName(),\n-                                            principal.getType(), principal.getName()));\n+    CLITestBase.testCommandOutputContains(cli, String.format(\"add role %s to %s %s\", role.getName(),\n+                                                             principal.getType(),\n+                                                             principal.getName()),\n+                                          String.format(\"Successfully added role '%s' to '%s' '%s'\", role.getName(),\n+                                                        principal.getType(), principal.getName()));\n \n     // test listing all roles\n-    String output = getCommandOutput(cli, \"list roles\");\n+    String output = CLITestBase.getCommandOutput(cli, \"list roles\");\n     List<String> lines = Arrays.asList(output.split(\"\\\\r?\\\\n\"));\n     Assert.assertEquals(2, lines.size());\n     Assert.assertEquals(role.getName(), lines.get(1)); // 0 is just the table headers\n \n     // test listing roles for a principal\n-    output = getCommandOutput(cli, String.format(\"list roles for %s %s\", principal.getType(), principal.getName()));\n+    output = CLITestBase.getCommandOutput(cli, String.format(\"list roles for %s %s\", principal.getType(),\n+                                                             principal.getName()));\n     lines = Arrays.asList(output.split(\"\\\\r?\\\\n\"));\n     Assert.assertEquals(2, lines.size());\n     Assert.assertEquals(role.getName(), lines.get(1));\n \n     // test grant action. also tests case insensitivity of Action and Principal.PrincipalType\n-    testCommandOutputContains(cli, String.format(\"grant actions %s on entity %s to %s %s\",\n+    CLITestBase.testCommandOutputContains(cli, String.format(\"grant actions %s on entity %s to %s %s\",\n                                                  Action.READ.name().toLowerCase(), namespaceId.toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjA2MDMy", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456206032", "createdAt": "2020-07-27T23:38:37Z", "commit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzozODozN1rOG33S_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzozODozN1rOG33S_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzMDg0Ng==", "bodyText": "remove?", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461230846", "createdAt": "2020-07-27T23:38:37Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/util/InstanceURIParser.java", "diffHunk": "@@ -26,6 +26,7 @@\n import java.net.URI;\n \n /**\n+ *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjA2Mjcz", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456206273", "createdAt": "2020-07-27T23:39:14Z", "commit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzozOToxNFrOG33T2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzozOToxNFrOG33T2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzMTA2NQ==", "bodyText": "unintended format", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461231065", "createdAt": "2020-07-27T23:39:14Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/util/InstanceURIParser.java", "diffHunk": "@@ -40,14 +41,12 @@ public InstanceURIParser(CConfiguration cConf) {\n   }\n \n   public CLIConnectionConfig parse(String uriString) {\n-    if (!uriString.contains(\"://\")) {\n-      uriString = DEFAULT_PROTOCOL + \"://\" + uriString;\n-    }\n+    uriString = addScheme(uriString);\n \n     URI uri = URI.create(uriString);\n     NamespaceId namespace =\n       (uri.getPath() == null || uri.getPath().isEmpty() || \"/\".equals(uri.getPath())) ?\n-      NamespaceId.DEFAULT : new NamespaceId(uri.getPath().substring(1));\n+        NamespaceId.DEFAULT : new NamespaceId(uri.getPath().substring(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "733ce1e14986910151a119cea953fcacfebe4cf8", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/733ce1e14986910151a119cea953fcacfebe4cf8", "committedDate": "2020-07-27T21:38:19Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "0959cff2cb44f8c7287ef9b51eed134043f71869", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/0959cff2cb44f8c7287ef9b51eed134043f71869", "committedDate": "2020-07-28T01:29:27Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0959cff2cb44f8c7287ef9b51eed134043f71869", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/0959cff2cb44f8c7287ef9b51eed134043f71869", "committedDate": "2020-07-28T01:29:27Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "fdcffe8ef38845012afec3bbc3bea435a312c580", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/fdcffe8ef38845012afec3bbc3bea435a312c580", "committedDate": "2020-07-28T03:42:05Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fdcffe8ef38845012afec3bbc3bea435a312c580", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/fdcffe8ef38845012afec3bbc3bea435a312c580", "committedDate": "2020-07-28T03:42:05Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/c428bd78f8af6ba21f8b9841327b976a5e1001de", "committedDate": "2020-07-28T04:01:21Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDM5NTA4", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456439508", "createdAt": "2020-07-28T09:01:50Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTowMTo1MFrOG4DY_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTowMTo1MFrOG4DY_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQyODk5MA==", "bodyText": "Use the java.util.Objects instead of the guava one.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461428990", "createdAt": "2020-07-28T09:01:50Z", "author": {"login": "chtyim"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIConnectionConfig.java", "diffHunk": "@@ -16,6 +16,7 @@\n \n package io.cdap.cdap.cli;\n \n+import com.google.common.base.Objects;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDQwMTIz", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456440123", "createdAt": "2020-07-28T09:02:38Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODcyMDc5", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456872079", "createdAt": "2020-07-28T17:51:56Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1MTo1NlrOG4X4tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1MTo1NlrOG4X4tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2NDc5MA==", "bodyText": "\"Please use option --link instead.\"", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461764790", "createdAt": "2020-07-28T17:51:56Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/CLIMain.java", "diffHunk": "@@ -81,10 +83,19 @@\n     \"h\", \"help\", false, \"Print the usage message.\");\n \n   private static final Option URI_OPTION = new Option(\n-    \"u\", \"uri\", true, \"CDAP instance URI to interact with in\" +\n+    \"u\", \"uri\", true, \"(Deprecated. Please use option l instead). CDAP instance URI to interact with in\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODczNzAw", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456873700", "createdAt": "2020-07-28T17:54:01Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NDowMlrOG4X-Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NDowMlrOG4X-Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2NjE1OA==", "bodyText": "How does it differ from ConnectCommand? May be a bit more information like \"Connects to a CDAP instance using given URI. URI can be in format of ...\"", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461766158", "createdAt": "2020-07-28T17:54:02Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/command/ConnectLinkCommand.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.cli.command;\n+\n+import io.cdap.cdap.cli.ArgumentName;\n+import io.cdap.cdap.cli.CLIConfig;\n+import io.cdap.cdap.cli.CLIConnectionConfig;\n+import io.cdap.cdap.cli.LaunchOptions;\n+import io.cdap.cdap.cli.util.InstanceURIParser;\n+import io.cdap.common.cli.Arguments;\n+import io.cdap.common.cli.Command;\n+\n+import java.io.PrintStream;\n+import javax.inject.Inject;\n+\n+/**\n+ * Connects to a CDAP instance.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODc0MTU0", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456874154", "createdAt": "2020-07-28T17:54:36Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NDozN1rOG4X_kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NDozN1rOG4X_kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2NjU0Ng==", "bodyText": "Is ConnectCommand deprecated now? If so, please mention that in the Class comment for it.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461766546", "createdAt": "2020-07-28T17:54:37Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/commandset/GeneralCommands.java", "diffHunk": "@@ -42,6 +43,7 @@ public GeneralCommands(Injector injector) {\n         .add(injector.getInstance(ExitCommand.class))\n         .add(injector.getInstance(QuitCommand.class))\n         .add(injector.getInstance(ConnectCommand.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODc1MTQ0", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456875144", "createdAt": "2020-07-28T17:55:55Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NTo1NVrOG4YCvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NTo1NVrOG4YCvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2NzM1OQ==", "bodyText": "mention deprecation in Class comment too for readability. Also mention to use ConnectLinkCommand instead in the class comment.", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461767359", "createdAt": "2020-07-28T17:55:55Z", "author": {"login": "pandyajay10"}, "path": "cdap-cli/src/main/java/io/cdap/cdap/cli/command/ConnectCommand.java", "diffHunk": "@@ -69,6 +70,6 @@ public String getPattern() {\n \n   @Override\n   public String getDescription() {\n-    return \"Connects to a CDAP instance\";\n+    return \"Connects to a CDAP instance (Deprecated, use connect-link instead)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODc2MjUx", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456876251", "createdAt": "2020-07-28T17:57:23Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NzoyM1rOG4YGUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NzoyM1rOG4YGUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2ODI3Mw==", "bodyText": "Required to add body ...", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461768273", "createdAt": "2020-07-28T17:57:23Z", "author": {"login": "pandyajay10"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/ProgramClient.java", "diffHunk": "@@ -123,11 +123,8 @@ public void start(ProgramId program, boolean debug, @Nullable Map<String, String\n     String path = String.format(\"apps/%s/versions/%s/%s/%s/%s\", program.getApplication(), program.getVersion(),\n                                 program.getType().getCategoryName(), program.getProgram(), action);\n     URL url = config.resolveNamespacedURLV3(program.getNamespaceId(), path);\n-    HttpRequest.Builder request = HttpRequest.post(url);\n-    if (runtimeArgs != null) {\n-      request.withBody(GSON.toJson(runtimeArgs));\n-    }\n-\n+    //Important to add body even if runtimeArgs is null to avoid 411 error for Http POST", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODc2NDUx", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456876451", "createdAt": "2020-07-28T17:57:37Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NzozN1rOG4YG_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzo1NzozN1rOG4YG_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2ODQ0NQ==", "bodyText": "Required to add body ...", "url": "https://github.com/cdapio/cdap/pull/12500#discussion_r461768445", "createdAt": "2020-07-28T17:57:37Z", "author": {"login": "pandyajay10"}, "path": "cdap-client/src/main/java/io/cdap/cdap/client/ProgramClient.java", "diffHunk": "@@ -220,7 +217,9 @@ public void stop(ProgramId programId) throws IOException, ProgramNotFoundExcepti\n     String path = String.format(\"apps/%s/versions/%s/%s/%s/stop\", programId.getApplication(), programId.getVersion(),\n                                 programId.getType().getCategoryName(), programId.getProgram());\n     URL url = config.resolveNamespacedURLV3(programId.getNamespaceId(), path);\n-    HttpResponse response = restClient.execute(HttpMethod.POST, url, config.getAccessToken(),\n+    //Important to add body even if runtimeArgs is null to avoid 411 error for Http POST", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODc3MDgx", "url": "https://github.com/cdapio/cdap/pull/12500#pullrequestreview-456877081", "createdAt": "2020-07-28T17:58:27Z", "commit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fba8d139253ad3afffe9e0d2b57c21a07b808e", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/e6fba8d139253ad3afffe9e0d2b57c21a07b808e", "committedDate": "2020-07-29T16:22:50Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c428bd78f8af6ba21f8b9841327b976a5e1001de", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/c428bd78f8af6ba21f8b9841327b976a5e1001de", "committedDate": "2020-07-28T04:01:21Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}, "afterCommit": {"oid": "e6fba8d139253ad3afffe9e0d2b57c21a07b808e", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/e6fba8d139253ad3afffe9e0d2b57c21a07b808e", "committedDate": "2020-07-29T16:22:50Z", "message": "Support Instance URI prefix for CLI by removing host:port assumption"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1862, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}