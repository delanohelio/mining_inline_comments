{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2OTEzNzM0", "number": 11948, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowODowOVrODqhHXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0NzoxMlrODq7MsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTA5MzQyOnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/common/DefaultStageConfigurer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowODowOVrOF6UIKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMzozNzoyM1rOF6f9hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQ5OA==", "bodyText": "Will it ever be null?? For stage that doesn't have input (source?), it should be just an empty list, not null.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396691498", "createdAt": "2020-03-23T19:08:09Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/common/DefaultStageConfigurer.java", "diffHunk": "@@ -75,6 +77,12 @@ public void setOutputSchemas(Map<String, Schema> outputSchemas) {\n     return inputSchemas;\n   }\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg4NTM4Mg==", "bodyText": "removed Nullable annotation.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396885382", "createdAt": "2020-03-24T03:37:23Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/common/DefaultStageConfigurer.java", "diffHunk": "@@ -75,6 +77,12 @@ public void setOutputSchemas(Map<String, Schema> outputSchemas) {\n     return inputSchemas;\n   }\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQ5OA=="}, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTA5OTQyOnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxMDowOFrOF6UMPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMjowMzowOVrOF6ekPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MjU0MA==", "bodyText": "This seems a bit unsafe to me. The original problem was that the schemas map keyset doesn't contains all input stages. And now we are using the same keyset to construct the input stages list?\nI think it is better to have the stage names pass in explicitly (probably with a fallback to the schemas keyset for backward compatibility when deserializing from older spec).", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396692540", "createdAt": "2020-03-23T19:10:08Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MjUyNA==", "bodyText": "fixed.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396862524", "createdAt": "2020-03-24T02:03:09Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MjU0MA=="}, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTUxMDI4OnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/MultiInputStageConfigurer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMToxMzoxNFrOF6YUIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMjowMzowMFrOF6ekGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MDA5OQ==", "bodyText": "get a list of input stage names.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396760099", "createdAt": "2020-03-23T21:13:14Z", "author": {"login": "CuriousVini"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/MultiInputStageConfigurer.java", "diffHunk": "@@ -35,6 +36,13 @@\n    */\n   Map<String, Schema> getInputSchemas();\n \n+  /**\n+   * get the of input stage names", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MjQ4OA==", "bodyText": "fixed.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396862488", "createdAt": "2020-03-24T02:03:00Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/MultiInputStageConfigurer.java", "diffHunk": "@@ -35,6 +36,13 @@\n    */\n   Map<String, Schema> getInputSchemas();\n \n+  /**\n+   * get the of input stage names", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MDA5OQ=="}, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTUyNTUzOnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMToxNzo1M1rOF6Ydhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMjowNjozMVrOF6enfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjUwMw==", "bodyText": "better use Collections.unmodifiableList()", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396762503", "createdAt": "2020-03-23T21:17:53Z", "author": {"login": "CuriousVini"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MzM1Ng==", "bodyText": "this code has been removed, but in the fallback path , I'm using ImmutableList.copyOf.", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396863356", "createdAt": "2020-03-24T02:06:31Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjUwMw=="}, "originalCommit": {"oid": "49b64195746bc30144592a5e73502a786b59c09e"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTEwNjU0OnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTozMjozN1rOF6nxSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoyMjoyNVrOF69fPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA==", "bodyText": "Why need a Multiset for equals? Because we can contains duplicates in input stages?", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397013320", "createdAt": "2020-03-24T09:32:37Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(HashMultiset.create(inputStages), HashMultiset.create(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NjAyNg==", "bodyText": "yes, it's handle duplicates input stage names (not sure if that can actually happen).", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397286026", "createdAt": "2020-03-24T16:22:46Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(HashMultiset.create(inputStages), HashMultiset.create(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA=="}, "originalCommit": {"oid": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2OTE0OA==", "bodyText": "changed MultiSet -> Set", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397369148", "createdAt": "2020-03-24T18:22:25Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(HashMultiset.create(inputStages), HashMultiset.create(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA=="}, "originalCommit": {"oid": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzM2Njg4OnYy", "diffSide": "RIGHT", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0NzoxMlrOF6-Zdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOTozMjowNFrOF6_9cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDA1NQ==", "bodyText": "You can use the Standard Java API new HashSet<>(inputStages).", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397384055", "createdAt": "2020-03-24T18:47:12Z", "author": {"login": "chtyim"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(Sets.newHashSet(inputStages), Sets.newHashSet(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0c351eb701f90ab723a58e8484c9e60f788ebe4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwOTY0OQ==", "bodyText": "fixed", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397409649", "createdAt": "2020-03-24T19:32:04Z", "author": {"login": "rmstar"}, "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(Sets.newHashSet(inputStages), Sets.newHashSet(that.inputStages)) &&", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDA1NQ=="}, "originalCommit": {"oid": "a0c351eb701f90ab723a58e8484c9e60f788ebe4"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2815, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}