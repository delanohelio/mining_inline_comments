{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1OTgwMjM4", "number": 12357, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNjoyN1rOEGdx8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMDoyODozMVrOEGjy7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE0ODMzOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/create-studio-ctrl.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNjoyN1rOGlR5Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToxNjo1MFrOGlXu-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzY2Mg==", "bodyText": "nit: space after if. Aren't this being caught by linter? are you running gulp watch?", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441743662", "createdAt": "2020-06-17T18:26:27Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/create-studio-ctrl.js", "diffHunk": "@@ -76,6 +76,9 @@ class HydratorPlusPlusStudioCtrl {\n       let config = {};\n       config.artifact = artifact;\n       HydratorPlusPlusConfigActions.initializeConfigStore(config);\n+      if(rConfig.upgrade){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgzOTM1Mw==", "bodyText": "I have gulp watch running, linter is not complaining about these", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441839353", "createdAt": "2020-06-17T21:16:50Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/create-studio-ctrl.js", "diffHunk": "@@ -76,6 +76,9 @@ class HydratorPlusPlusStudioCtrl {\n       let config = {};\n       config.artifact = artifact;\n       HydratorPlusPlusConfigActions.initializeConfigStore(config);\n+      if(rConfig.upgrade){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzY2Mg=="}, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE0OTkzOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/routes.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNjo1NVrOGlR6LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNjo1NVrOGlR6LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzkxNw==", "bodyText": "nit space after bracket", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441743917", "createdAt": "2020-06-17T18:26:55Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/routes.js", "diffHunk": "@@ -106,9 +106,9 @@ angular.module(PKG.name + '.feature.hydrator')\n                 if (isVersionInRange) {\n                   $stateParams.data.artifact.version = rCDAPVersion;\n                 } else {\n-                  defer.resolve(false);\n+                  defer.resolve({ valid: false });\n                 }\n-                defer.resolve($stateParams.data);\n+                defer.resolve({config: $stateParams.data, valid: true});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1MDkxOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/services/hydrator-upgrade-service.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzoxNFrOGlR62Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzoxNFrOGlR62Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDA4OQ==", "bodyText": "space after ()", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744089", "createdAt": "2020-06-17T18:27:14Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/services/hydrator-upgrade-service.js", "diffHunk": "@@ -287,6 +287,9 @@ class HydratorUpgradeService {\n       resolve: {\n         rPipelineConfig: function () {\n           return jsonData;\n+        },\n+        rIsImport: function(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1MjExOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/templates/create/pipeline-upgrade-modal.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzozMlrOGlR7kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzozMlrOGlR7kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDI3NA==", "bodyText": "space after bracket", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744274", "createdAt": "2020-06-17T18:27:32Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/templates/create/pipeline-upgrade-modal.html", "diffHunk": "@@ -15,7 +15,8 @@\n -->\n \n <div class=\"modal-header\">\n-  <h3 class=\"modal-title pull-left\">Import Pipeline</h3>\n+  <h3 class=\"modal-title pull-left\" data-cy=\"upgrade-modal-header\">\n+    {{PipelineUpgradeController.isUpgrade ? \"Import Pipeline\" : \"Upgrade Pipeline\"}}</h3>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1MjM3OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/templates/create/pipeline-upgrade-modal.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzozN1rOGlR7ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNzozN1rOGlR7ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDMyMw==", "bodyText": "space after bracket", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744323", "createdAt": "2020-06-17T18:27:37Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/templates/create/pipeline-upgrade-modal.html", "diffHunk": "@@ -35,9 +37,10 @@ <h3 class=\"text-xs-center\">\n <div\n   class=\"modal-body\"\n   ng-if=\"!PipelineUpgradeController.loading\"\n+  data-cy=\"upgrade-modal-body\"\n >\n   <h4 ng-if=\"PipelineUpgradeController.missingArtifactStages.length > 0 || PipelineUpgradeController.problematicStages.length > 0 || PipelineUpgradeController.problematicPostRunActions.length > 0 || PipelineUpgradeController.missingArtifactPostRunActions.length > 0\">\n-    Your pipeline cannot be imported because of the following issues:\n+    {{PipelineUpgradeController.isUpgrade ? \"Your pipeline cannot be imported because of the following issues:\" : \"Your pipeline has the following issues:\"}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1Mzk1OnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/helpers.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODowNFrOGlR82A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODo1NlrOGlR-kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDYwMA==", "bodyText": "space after bracket", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744600", "createdAt": "2020-06-17T18:28:04Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/helpers.ts", "diffHunk": "@@ -117,4 +119,22 @@ function deployAndTestPipeline(filename, pipelineName, done) {\n     .then(() => done());\n }\n \n-export { loginIfRequired, getArtifactsPoll, deployAndTestPipeline, getSessionToken };\n+function dataCy(property) {\n+  return `[data-cy=\"${property}\"]`;\n+}\n+\n+function generateDraftFromPipeline(pipeline) {\n+  return cy.fixture(pipeline).then(pipeline1 => {\n+    const draftId = uuidV4();\n+    const pipelineName = `${pipeline1.name}-${Date.now()}`;\n+    pipeline1['__ui__'] = {draftId, lastSaved: '2019-06-10T16:57:34.559Z'};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NTA0MA==", "bodyText": "lastSaved Date.now()", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441745040", "createdAt": "2020-06-17T18:28:56Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/helpers.ts", "diffHunk": "@@ -117,4 +119,22 @@ function deployAndTestPipeline(filename, pipelineName, done) {\n     .then(() => done());\n }\n \n-export { loginIfRequired, getArtifactsPoll, deployAndTestPipeline, getSessionToken };\n+function dataCy(property) {\n+  return `[data-cy=\"${property}\"]`;\n+}\n+\n+function generateDraftFromPipeline(pipeline) {\n+  return cy.fixture(pipeline).then(pipeline1 => {\n+    const draftId = uuidV4();\n+    const pipelineName = `${pipeline1.name}-${Date.now()}`;\n+    pipeline1['__ui__'] = {draftId, lastSaved: '2019-06-10T16:57:34.559Z'};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDYwMA=="}, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1NDIwOnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/helpers.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODoxMVrOGlR9Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODoxMVrOGlR9Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDY0Nw==", "bodyText": "remove", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744647", "createdAt": "2020-06-17T18:28:11Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/helpers.ts", "diffHunk": "@@ -117,4 +119,22 @@ function deployAndTestPipeline(filename, pipelineName, done) {\n     .then(() => done());\n }\n \n-export { loginIfRequired, getArtifactsPoll, deployAndTestPipeline, getSessionToken };\n+function dataCy(property) {\n+  return `[data-cy=\"${property}\"]`;\n+}\n+\n+function generateDraftFromPipeline(pipeline) {\n+  return cy.fixture(pipeline).then(pipeline1 => {\n+    const draftId = uuidV4();\n+    const pipelineName = `${pipeline1.name}-${Date.now()}`;\n+    pipeline1['__ui__'] = {draftId, lastSaved: '2019-06-10T16:57:34.559Z'};\n+    pipeline1.name = pipelineName;\n+    const pipelineDraft = {\n+      'hydratorDrafts': {'default': {[draftId]: pipeline1}}\n+    };\n+    console.log(\"draftid\",pipeline1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1NDc2OnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/helpers.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODoyNVrOGlR9eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyODoyNVrOGlR9eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NDc2MA==", "bodyText": "unnecessary quotes", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441744760", "createdAt": "2020-06-17T18:28:25Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/helpers.ts", "diffHunk": "@@ -117,4 +119,22 @@ function deployAndTestPipeline(filename, pipelineName, done) {\n     .then(() => done());\n }\n \n-export { loginIfRequired, getArtifactsPoll, deployAndTestPipeline, getSessionToken };\n+function dataCy(property) {\n+  return `[data-cy=\"${property}\"]`;\n+}\n+\n+function generateDraftFromPipeline(pipeline) {\n+  return cy.fixture(pipeline).then(pipeline1 => {\n+    const draftId = uuidV4();\n+    const pipelineName = `${pipeline1.name}-${Date.now()}`;\n+    pipeline1['__ui__'] = {draftId, lastSaved: '2019-06-10T16:57:34.559Z'};\n+    pipeline1.name = pipelineName;\n+    const pipelineDraft = {\n+      'hydratorDrafts': {'default': {[draftId]: pipeline1}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1NzYwOnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.upgrade.spec.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyOToxN1rOGlR_RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyOToxN1rOGlR_RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NTIyMA==", "bodyText": "make quotes consistent with single quotes", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441745220", "createdAt": "2020-06-17T18:29:17Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/integration/pipeline.upgrade.spec.ts", "diffHunk": "@@ -70,4 +72,25 @@ describe('Pipeline Upgrade should work fine', () => {\n       cy.contains('Hub');\n     });\n   });\n+\n+  it(\"should upgrade pipelines that are saved in drafts\", () => {\n+\n+    generateDraftFromPipeline('pipeline1.json').then(({ pipelineDraft, pipelineName }) => {\n+      cy.upload_draft_via_api(headers, pipelineDraft);\n+      cy.visit(\"/cdap/ns/default/pipelines/drafts\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE1ODI2OnYy", "diffSide": "RIGHT", "path": "cdap-ui/cypress/integration/pipeline.upgrade.spec.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyOToyN1rOGlR_rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyOToyN1rOGlR_rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0NTMyNA==", "bodyText": "space after brackets", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441745324", "createdAt": "2020-06-17T18:29:27Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/cypress/integration/pipeline.upgrade.spec.ts", "diffHunk": "@@ -15,6 +15,8 @@\n  */\n \n import * as Helpers from '../helpers';\n+import {dataCy, generateDraftFromPipeline} from '../helpers';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34c09f1e06f6046813e22765ef650aa34337dcd8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mjc2NTQxOnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/routes.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDowNlrOGlYGlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMjo0NTo0M1rOGlZ22w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTM5OA==", "bodyText": "not sure why my comment disappeared on this one..\nWhy is valid: false in here? what is considered valid? If you already have a flag for upgrade, can we just simply use that instead of adding another flag?", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441845398", "createdAt": "2020-06-17T21:30:06Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/routes.js", "diffHunk": "@@ -125,52 +128,52 @@ angular.module(PKG.name + '.feature.hydrator')\n                       if (isVersionInRange) {\n                         draft.artifact.version = rCDAPVersion;\n                       } else {\n-                        defer.resolve(false);\n+                        defer.resolve({ valid: false, config: draft, upgrade: true });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06344c9f48992a42a59ab71f0af7990647d6db09"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NDEzOQ==", "bodyText": "We used to resolve false to indicate that the configuration is invalid/when an error occurs. If we remove this field altogether, we would miss cases where it's not really a pipeline upgrade/import but an error like when parsing JSON.\nI can rename it as validConfig to make it more readable if you think that helps, please let me know.", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441874139", "createdAt": "2020-06-17T22:45:43Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/routes.js", "diffHunk": "@@ -125,52 +128,52 @@ angular.module(PKG.name + '.feature.hydrator')\n                       if (isVersionInRange) {\n                         draft.artifact.version = rCDAPVersion;\n                       } else {\n-                        defer.resolve(false);\n+                        defer.resolve({ valid: false, config: draft, upgrade: true });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTM5OA=="}, "originalCommit": {"oid": "06344c9f48992a42a59ab71f0af7990647d6db09"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzEzMzg5OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/partials/pipelineupgrade-modal-ctrl.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMDoyODozMVrOGlbp-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMjoyMjoyMlrOGldW3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMzYwOA==", "bodyText": "why do we only want to delete this on import?", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441903608", "createdAt": "2020-06-18T00:28:31Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/partials/pipelineupgrade-modal-ctrl.js", "diffHunk": "@@ -147,7 +148,7 @@ angular.module(PKG.name + '.feature.hydrator')\n       newConfig.config.stages = stages;\n       newConfig.config.postActions = postActions;\n \n-      if (newConfig.__ui__) {\n+      if (newConfig.__ui__ && this.isImport) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06344c9f48992a42a59ab71f0af7990647d6db09"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwODEwMQ==", "bodyText": "We used to delete this every time we import and fix something. This was causing the draft that's already saved to change its id and causing it to save as a new draft. For upgrading a draft, we already have an id and do not need to delete the id. So, here we're excluding deletion of this property if it's an upgrade of a draft.", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441908101", "createdAt": "2020-06-18T00:46:55Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/partials/pipelineupgrade-modal-ctrl.js", "diffHunk": "@@ -147,7 +148,7 @@ angular.module(PKG.name + '.feature.hydrator')\n       newConfig.config.stages = stages;\n       newConfig.config.postActions = postActions;\n \n-      if (newConfig.__ui__) {\n+      if (newConfig.__ui__ && this.isImport) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMzYwOA=="}, "originalCommit": {"oid": "06344c9f48992a42a59ab71f0af7990647d6db09"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzMTQ4Ng==", "bodyText": "Changed the way we preserve the draftId - instead of not deleting __ui__ at all for upgrades, we now add any existing draftId back after we clear __ui__", "url": "https://github.com/cdapio/cdap/pull/12357#discussion_r441931486", "createdAt": "2020-06-18T02:22:22Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/partials/pipelineupgrade-modal-ctrl.js", "diffHunk": "@@ -147,7 +148,7 @@ angular.module(PKG.name + '.feature.hydrator')\n       newConfig.config.stages = stages;\n       newConfig.config.postActions = postActions;\n \n-      if (newConfig.__ui__) {\n+      if (newConfig.__ui__ && this.isImport) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMzYwOA=="}, "originalCommit": {"oid": "06344c9f48992a42a59ab71f0af7990647d6db09"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3292, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}