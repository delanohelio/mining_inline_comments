{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTgzNjM2", "number": 12122, "title": "(CDAP-16672) Support GCP Dataproc cluster property override via cdap-site.xml", "bodyText": "Why:\nWhen creating Dataproc cluster, overriding cluster properties\n(i.e. property key-val pairs in config files) cannot be done dynamically.\nCurrently they are hard-coded.\nWhat:\nThis change gets property overrides from ProvisionerSystemContext and set them\nin the context used for dataproc creation, which get passed to Dataproc via\ncreation API.\nFormat of property override in cdap-site.xml:\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\"\nwhere \"prefix\" is \"provisioner.system.properties\"\nE.g.\nprovisioner.system.properties.gcp-dataproc.capacity-scheduler:yarn.scheduler.capacity.maximum-am-resource-percent: \"0.5\"\nNeeds to comply with format\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\"", "createdAt": "2020-04-25T23:06:40Z", "url": "https://github.com/cdapio/cdap/pull/12122", "merged": true, "mergeCommit": {"oid": "1d03c5dff669779ddca5c399470527ab710095ed"}, "closed": true, "closedAt": "2020-04-27T18:00:42Z", "author": {"login": "wyzhang"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbOWFlAH2gAyNDA4OTgzNjM2OmQ5ZmQzMGMzZTIyNzg2NjBiNjE0NDQ2M2EzZDIxMmZhOWViNjhhNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbymL6AFqTQwMTE2MjkwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9fd30c3e2278660b6144463a3d212fa9eb68a53", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/d9fd30c3e2278660b6144463a3d212fa9eb68a53", "committedDate": "2020-04-25T23:04:50Z", "message": "(CDAP-16672) Support GCP Dataproc cluster property override via cdap-site.xml\n\nWhy:\nWhen creating Dataproc cluster, overriding cluster properties\n(i.e. property key-val pairs in config files) cannot be done dynamically.\nCurrenlty they are hard-coded.\n\nWhat:\nThis change gets property overrides from ProvisionerSystemContext and set them\nin the context used for dataproc creation, which get passed to Dataproc via\ncreation API.\n\nHow to use:\nFormat of property override in cdap-site.xml:\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\"\nwhere \"prefix\" is \"provisioner.system.properties\"\n\nE.g.\nprovisioner.system.properties.gcp-dataproc.capacity-scheduler:yarn.scheduler.capacity.maximum-am-resource-percent: \"0.5\"\n\nNeeds to comply with format\n\"[prefix].gcp-dataproc.[dataproc config file]:[property key]\" : \"[property val]\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDc5MTgz", "url": "https://github.com/cdapio/cdap/pull/12122#pullrequestreview-400479183", "createdAt": "2020-04-26T09:06:01Z", "commit": {"oid": "d9fd30c3e2278660b6144463a3d212fa9eb68a53"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwOTowNjowMVrOGMBerA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwOTowNzowNVrOGMBfgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDMzMg==", "bodyText": "Use List as the type.", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415260332", "createdAt": "2020-04-26T09:06:01Z", "author": {"login": "chtyim"}, "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocProvisioner.java", "diffHunk": "@@ -337,13 +340,24 @@ public Capabilities getCapabilities() {\n     }\n \n     // Default settings from the system context\n-    List<String> keys = Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n-                                      DataprocConf.NETWORK,\n-                                      DataprocConf.NETWORK_HOST_PROJECT_ID,\n-                                      DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n-                                      DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n-                                      DataprocConf.IMAGE_VERSION,\n-                                      BUCKET, RUNTIME_JOB_MANAGER);\n+    ArrayList<String> keys = new ArrayList<>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9fd30c3e2278660b6144463a3d212fa9eb68a53"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI2MDU0Ng==", "bodyText": "Seems like calling unmodifiableList is unnecessary.", "url": "https://github.com/cdapio/cdap/pull/12122#discussion_r415260546", "createdAt": "2020-04-26T09:07:05Z", "author": {"login": "chtyim"}, "path": "cdap-runtime-ext-dataproc/src/main/java/io/cdap/cdap/runtime/spi/provisioner/dataproc/DataprocProvisioner.java", "diffHunk": "@@ -337,13 +340,24 @@ public Capabilities getCapabilities() {\n     }\n \n     // Default settings from the system context\n-    List<String> keys = Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n-                                      DataprocConf.NETWORK,\n-                                      DataprocConf.NETWORK_HOST_PROJECT_ID,\n-                                      DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n-                                      DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n-                                      DataprocConf.IMAGE_VERSION,\n-                                      BUCKET, RUNTIME_JOB_MANAGER);\n+    ArrayList<String> keys = new ArrayList<>(\n+      Arrays.asList(DataprocConf.PREFER_EXTERNAL_IP,\n+                    DataprocConf.NETWORK,\n+                    DataprocConf.NETWORK_HOST_PROJECT_ID,\n+                    DataprocConf.STACKDRIVER_LOGGING_ENABLED,\n+                    DataprocConf.STACKDRIVER_MONITORING_ENABLED,\n+                    DataprocConf.IMAGE_VERSION,\n+                    BUCKET, RUNTIME_JOB_MANAGER)\n+    );\n+\n+    // Default cluster properties (i.e. specifying configuration files of the dataproc cluster and the property\n+    // key value paris within those files that should be overridden) from the system context.\n+    List<String> clusterPropertyKeys = Collections.unmodifiableList(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9fd30c3e2278660b6144463a3d212fa9eb68a53"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f126cf5e534683f71c58e5adf0711aae44c99d47", "author": {"user": {"login": "wyzhang", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/f126cf5e534683f71c58e5adf0711aae44c99d47", "committedDate": "2020-04-27T17:02:01Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTYyOTA0", "url": "https://github.com/cdapio/cdap/pull/12122#pullrequestreview-401162904", "createdAt": "2020-04-27T17:19:00Z", "commit": {"oid": "f126cf5e534683f71c58e5adf0711aae44c99d47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2198, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}