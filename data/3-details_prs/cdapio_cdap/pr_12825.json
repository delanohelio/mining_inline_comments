{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMTIxNTkz", "number": 12825, "title": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program.", "bodyText": "JIRA: https://issues.cask.co/browse/CDAP-17339", "createdAt": "2020-10-27T22:10:09Z", "url": "https://github.com/cdapio/cdap/pull/12825", "merged": true, "mergeCommit": {"oid": "508d41395f9ff04dab194f7e6e7ac229e71cb641"}, "closed": true, "closedAt": "2020-10-29T03:19:06Z", "author": {"login": "sagarkapare"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWxAC5AFqTUxODIwNDcwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXH7KZgBqjM5MzQwNDI1NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjA0NzA3", "url": "https://github.com/cdapio/cdap/pull/12825#pullrequestreview-518204707", "createdAt": "2020-10-27T22:41:47Z", "commit": {"oid": "4b638e1f831d429ba2bc4f78dfae4d8ec85eafa0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjo0MTo0N1rOHpTp6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjo0ODoxNlrOHpTyig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA3NTY4OQ==", "bodyText": "what is the behavior if the tags here overlap with the tags for the current Metrics instance?", "url": "https://github.com/cdapio/cdap/pull/12825#discussion_r513075689", "createdAt": "2020-10-27T22:41:47Z", "author": {"login": "albertshau"}, "path": "cdap-api/src/main/java/io/cdap/cdap/api/metrics/Metrics.java", "diffHunk": "@@ -34,5 +36,17 @@\n    * @param value The value to be set.\n    */\n   void gauge(String metricName, long value);\n+\n+  /**\n+   * Get the child {@link Metrics} by adding specified tags to the current metrics context.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b638e1f831d429ba2bc4f78dfae4d8ec85eafa0"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA3Njg0Mg==", "bodyText": "is this an unmodifiable map? If not, we should make sure it is.", "url": "https://github.com/cdapio/cdap/pull/12825#discussion_r513076842", "createdAt": "2020-10-27T22:45:02Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/metrics/ProgramUserMetrics.java", "diffHunk": "@@ -42,4 +52,14 @@ public void count(String metricName, int delta) {\n   public void gauge(String metricName, long value) {\n     metricsContext.gauge(metricName, value);\n   }\n+\n+  @Override\n+  public Metrics child(Map<String, String> tags) {\n+    return new ProgramUserMetrics(metricsContext.childContext(tags), false);\n+  }\n+\n+  @Override\n+  public Map<String, String> getTags() {\n+    return metricsContext.getTags();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b638e1f831d429ba2bc4f78dfae4d8ec85eafa0"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA3NzU0NQ==", "bodyText": "needs to be updated.", "url": "https://github.com/cdapio/cdap/pull/12825#discussion_r513077545", "createdAt": "2020-10-27T22:47:13Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/metrics/WorkflowMetrics.java", "diffHunk": "@@ -46,4 +49,16 @@ public void gauge(String metricName, long value) {\n     programMetricsContext.gauge(metricName, value);\n     workflowMetricsContext.gauge(metricName, value);\n   }\n+\n+  @Override\n+  public Metrics child(Map<String, String> tags) {\n+    return new WorkflowMetrics(programMetricsContext.childContext(tags), workflowMetricsContext.childContext(tags));\n+  }\n+\n+  @Override\n+  public Map<String, String> getTags() {\n+    Map<String, String> result = new HashMap<>();\n+    result.putAll(programMetricsContext.getTags());\n+    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b638e1f831d429ba2bc4f78dfae4d8ec85eafa0"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA3Nzg5OA==", "bodyText": "does this mean the context returns a modifiable map? Seems like we should change it to be unmodifiable.", "url": "https://github.com/cdapio/cdap/pull/12825#discussion_r513077898", "createdAt": "2020-10-27T22:48:16Z", "author": {"login": "albertshau"}, "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/app/metrics/WorkflowMetrics.java", "diffHunk": "@@ -46,4 +49,16 @@ public void gauge(String metricName, long value) {\n     programMetricsContext.gauge(metricName, value);\n     workflowMetricsContext.gauge(metricName, value);\n   }\n+\n+  @Override\n+  public Metrics child(Map<String, String> tags) {\n+    return new WorkflowMetrics(programMetricsContext.childContext(tags), workflowMetricsContext.childContext(tags));\n+  }\n+\n+  @Override\n+  public Map<String, String> getTags() {\n+    Map<String, String> result = new HashMap<>();\n+    result.putAll(programMetricsContext.getTags());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b638e1f831d429ba2bc4f78dfae4d8ec85eafa0"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTI3MTYy", "url": "https://github.com/cdapio/cdap/pull/12825#pullrequestreview-519127162", "createdAt": "2020-10-28T22:18:59Z", "commit": {"oid": "0434ee636fec4fa9e699500f51980426bee7f342"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMjoxOTowMFrOHp_mZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMjoxOTowMFrOHp_mZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc5NTY4NA==", "bodyText": "generally we don't declare throws [? extends RuntimeException], we just put it in the javadoc.", "url": "https://github.com/cdapio/cdap/pull/12825#discussion_r513795684", "createdAt": "2020-10-28T22:19:00Z", "author": {"login": "albertshau"}, "path": "cdap-api/src/main/java/io/cdap/cdap/api/metrics/Metrics.java", "diffHunk": "@@ -34,5 +36,18 @@\n    * @param value The value to be set.\n    */\n   void gauge(String metricName, long value);\n+\n+  /**\n+   * Get the child {@link Metrics} by adding specified tags to the current metrics context.\n+   * @param tags to be added to the current metrics context\n+   * @return an instance of {@link Metrics} which can be used to collect metrics with new child context.\n+   * @throws IllegalArgumentException if any of the supplied tag name already exists in the current metrics context\n+   */\n+  Metrics child(Map<String, String> tags) throws IllegalArgumentException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0434ee636fec4fa9e699500f51980426bee7f342"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0434ee636fec4fa9e699500f51980426bee7f342", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/0434ee636fec4fa9e699500f51980426bee7f342", "committedDate": "2020-10-28T19:38:15Z", "message": "Throw exception on duplicate tags from API."}, "afterCommit": {"oid": "e41db1c00eb36d615df776417dbbb8e427c763f1", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/e41db1c00eb36d615df776417dbbb8e427c763f1", "committedDate": "2020-10-28T22:23:20Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e41db1c00eb36d615df776417dbbb8e427c763f1", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/e41db1c00eb36d615df776417dbbb8e427c763f1", "committedDate": "2020-10-28T22:23:20Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}, "afterCommit": {"oid": "e5e638182f17361215e304d8f9d1d9d72a7277fc", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/e5e638182f17361215e304d8f9d1d9d72a7277fc", "committedDate": "2020-10-28T22:38:53Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17b3afed4cf106d2c2de7e13963d9bad361c6d31", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/17b3afed4cf106d2c2de7e13963d9bad361c6d31", "committedDate": "2020-10-29T01:31:06Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5e638182f17361215e304d8f9d1d9d72a7277fc", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/e5e638182f17361215e304d8f9d1d9d72a7277fc", "committedDate": "2020-10-28T22:38:53Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}, "afterCommit": {"oid": "17b3afed4cf106d2c2de7e13963d9bad361c6d31", "author": {"user": {"login": "sagarkapare", "name": "sagarkapare"}}, "url": "https://github.com/cdapio/cdap/commit/17b3afed4cf106d2c2de7e13963d9bad361c6d31", "committedDate": "2020-10-29T01:31:06Z", "message": "CDAP-17339 Added Metrics api to accept additional tags in the metric context from program."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1711, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}