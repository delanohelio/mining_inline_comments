{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MDEyNDAx", "number": 12479, "title": "[CDAP-17015] Update Preview UI to handle queued preview runs", "bodyText": "cherry-pick of #12434\nBuild: https://builds.cask.co/browse/CDAP-URUT286", "createdAt": "2020-07-21T01:38:06Z", "url": "https://github.com/cdapio/cdap/pull/12479", "merged": true, "mergeCommit": {"oid": "0a332be257169d1ed0e2fd046ca03d5db34791b5"}, "closed": true, "closedAt": "2020-07-23T02:48:52Z", "author": {"login": "yukiej"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3IlsqAFqTQ1MjYxNDQwNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3mAhogBqjM1NzgyMTI0MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjE0NDA1", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-452614405", "createdAt": "2020-07-21T16:10:08Z", "commit": {"oid": "5b07830e07d371966159792ed8c076ab94ac93ce"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMDowOFrOG0_Y5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMjoxN1rOG0_erA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNzcwMA==", "bodyText": "We can capitalize strings to keep consistency", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r458217700", "createdAt": "2020-07-21T16:10:08Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/cdap/services/AlertStatus.ts", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+// TO-DO(CDAP-17088): Move this to Alert component once it has been converted to TS\n+enum ALERT_STATUS {\n+  Success = 'success',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b07830e07d371966159792ed8c076ab94ac93ce"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE4MA==", "bodyText": "Is it possible to define timerLabel in enums? (Pending, Running, Duration)", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r458219180", "createdAt": "2020-07-21T16:12:17Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,\n+      seconds: !seconds ? '--' : seconds,\n+    }\n+  }\n+\n+  updateTimerLabelAndTitle(res) {\n+    // set default\n+    if (!res) {\n+      this.timerLabel = 'Duration';\n+      this.queueStatus = '';\n+      return;\n+    }\n+\n+    const { WAITING, ACQUIRED, INIT, RUNNING } = window.CaskCommon.PREVIEW_STATUS;\n+    if (res.status === WAITING && res.positionInWaitingQueue > 0) {\n+      const runsAheadInQueue = res.positionInWaitingQueue;\n+      this.queueStatus = `${runsAheadInQueue} ${runsAheadInQueue === 1? 'run' : 'runs'} ahead in queue`;\n+      this.timerLabel = `${runsAheadInQueue} Pending`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b07830e07d371966159792ed8c076ab94ac93ce"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNjgwMTMx", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-453680131", "createdAt": "2020-07-22T20:58:37Z", "commit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNjgxODAx", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-453681801", "createdAt": "2020-07-22T21:01:05Z", "commit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTowMTowNlrOG10DUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTowMTowNlrOG10DUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MDUyOA==", "bodyText": "nit: the indentation seems a bit off here? I'm not sure if it's because of github UI!", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459080528", "createdAt": "2020-07-22T21:01:06Z", "author": {"login": "jennac3"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,\n+      seconds: !seconds ? '--' : seconds,\n+    }\n+  }\n+\n+  updateTimerLabelAndTitle(res) {\n+    // set default\n+    if (!res) {\n+      this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.DURATION;\n+      this.queueStatus = '';\n+      return;\n+    }\n+\n+    const { WAITING, ACQUIRED, INIT, RUNNING } = window.CaskCommon.PREVIEW_STATUS;\n+    if (res.status === WAITING && res.positionInWaitingQueue > 0) {\n+      const runsAheadInQueue = res.positionInWaitingQueue;\n+      this.queueStatus = `${runsAheadInQueue} ${runsAheadInQueue === 1? 'run' : 'runs'} ahead in queue`;\n+      this.timerLabel = `${runsAheadInQueue} ${this.GLOBALS.en.hydrator.preview.timerLabels.PENDING}`;\n+    } else if ([ WAITING, ACQUIRED, INIT, RUNNING ].includes(res.status) && this.loadingLabel !== 'Stopping') {\n+      this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.RUNNING;\n+      this.queueStatus = '';\n+    } else {\n+    this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.DURATION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNzMxNjQx", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-453731641", "createdAt": "2020-07-22T22:35:01Z", "commit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjozNTowMVrOG12lAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjozNTowMVrOG12lAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyMTkyMQ==", "bodyText": "Would this be easier to read as minutes ? minutes : '--' or even minutes || '--'? It looks like we display -- for 0.", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459121921", "createdAt": "2020-07-22T22:35:01Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNzM0NjA2", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-453734606", "createdAt": "2020-07-22T22:42:29Z", "commit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNzc1ODEz", "url": "https://github.com/cdapio/cdap/pull/12479#pullrequestreview-453775813", "createdAt": "2020-07-23T00:46:32Z", "commit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89c0935256b752944a1db54b56d4cfb697580c97", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/89c0935256b752944a1db54b56d4cfb697580c97", "committedDate": "2020-07-23T02:02:40Z", "message": "Update preview statuses and update alert component to handle info case\n\nUpdate preview statuses and button messaging to include WAITING and ACQUIRED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "committedDate": "2020-07-23T02:28:22Z", "message": "address feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d4014397a4b5213e38cf3a84ad9b3c224e00318", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/9d4014397a4b5213e38cf3a84ad9b3c224e00318", "committedDate": "2020-07-22T20:11:15Z", "message": "Add timer labels to global constants"}, "afterCommit": {"oid": "593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "author": {"user": {"login": "yukiej", "name": null}}, "url": "https://github.com/cdapio/cdap/commit/593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "committedDate": "2020-07-23T02:28:22Z", "message": "address feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1836, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}