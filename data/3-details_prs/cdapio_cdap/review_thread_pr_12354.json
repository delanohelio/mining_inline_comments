{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NTk0NzM1", "number": 12354, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjowNjowN1rOEGNKgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyNToxM1rOEGhdsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0OTQyNTk0OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/cdap/components/KeyValuePairs/KeyValueStoreActions.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjowNjowN1rOGk22HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMDozMjo0NlrOGlWTpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMDUwOA==", "bodyText": "nit: Could we explicitly check for empty values instead of falsey values.", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441300508", "createdAt": "2020-06-17T06:06:07Z", "author": {"login": "ajainarayanan"}, "path": "cdap-ui/app/cdap/components/KeyValuePairs/KeyValueStoreActions.js", "diffHunk": "@@ -44,8 +44,8 @@ const convertKeyValuePairsObjToMap = (keyValues) => {\n const keyValuePairsHaveMissingValues = (keyValues) => {\n   if (keyValues.pairs) {\n     return keyValues.pairs.some((keyValuePair) => {\n-      if (keyValuePair.notDeletable && keyValuePair.provided) {\n-        return false;\n+      if (keyValuePair.notDeletable) {\n+        return !keyValuePair.value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxNTk3Mg==", "bodyText": "done", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441815972", "createdAt": "2020-06-17T20:32:46Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/cdap/components/KeyValuePairs/KeyValueStoreActions.js", "diffHunk": "@@ -44,8 +44,8 @@ const convertKeyValuePairsObjToMap = (keyValues) => {\n const keyValuePairsHaveMissingValues = (keyValues) => {\n   if (keyValues.pairs) {\n     return keyValues.pairs.some((keyValuePair) => {\n-      if (keyValuePair.notDeletable && keyValuePair.provided) {\n-        return false;\n+      if (keyValuePair.notDeletable) {\n+        return !keyValuePair.value;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMDUwOA=="}, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjEwNTU4OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoxMzo1MVrOGlRdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMDo0NDozNVrOGlWwLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjY0Ng==", "bodyText": "nit: space after if", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736646", "createdAt": "2020-06-17T18:13:51Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMzI3OA==", "bodyText": "done", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441823278", "createdAt": "2020-06-17T20:44:35Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjY0Ng=="}, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjEwNzQ5OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoxNDoyNVrOGlRfEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMDo0NDo1NFrOGlWw4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjk3Ng==", "bodyText": "this function signature doesn't make sense anymore", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736976", "createdAt": "2020-06-17T18:14:25Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){\n+      this.stopPreview();\n+    }\n+    else if (this.doesPreviewHaveEmptyMacros) {\n       this.doStartOrStopPreview();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMzQ1Nw==", "bodyText": "refactored the start stop functions", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441823457", "createdAt": "2020-06-17T20:44:54Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){\n+      this.stopPreview();\n+    }\n+    else if (this.doesPreviewHaveEmptyMacros) {\n       this.doStartOrStopPreview();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjk3Ng=="}, "originalCommit": {"oid": "5500d2d331946adf74ec790c21c1fd1f31a626c7"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mjc1MTg3OnYy", "diffSide": "RIGHT", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyNToxM1rOGlX96g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMDo0NjoxOVrOGlb6_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA==", "bodyText": "we won't ever get to this condition, can we?", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441843178", "createdAt": "2020-06-17T21:25:13Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,26 +481,24 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n-      this.doStartOrStopPreview();\n-    } else {\n-      // Validate and show runtime arguments if there are\n-      // un-fulfilled macros.\n-      this.toggleConfig();\n-    }\n-  }\n-\n-  doStartOrStopPreview() {\n-    this.getRuntimeArguments()\n-      .then(() => {\n+    if (this.previewRunning) {\n+      this.stopPreview();\n+    } else if (this.doesPreviewHaveEmptyMacros) {\n+      this.getRuntimeArguments().then(() => {\n         if (this.previewRunning) {\n           this.stopPreview();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "118ea295467bd6c53ca17da049dbefacb5b81713"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3ODI1MA==", "bodyText": "If getRuntimeArguments call takes a while to finish, the preview state could change and we might hit this edge case I think. I doubt it's likely to happen in a real scenario but just to be safe, I did not remove this. Let me know if I should remove this, will make the change.", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441878250", "createdAt": "2020-06-17T22:58:57Z", "author": {"login": "itsanudeep"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,26 +481,24 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n-      this.doStartOrStopPreview();\n-    } else {\n-      // Validate and show runtime arguments if there are\n-      // un-fulfilled macros.\n-      this.toggleConfig();\n-    }\n-  }\n-\n-  doStartOrStopPreview() {\n-    this.getRuntimeArguments()\n-      .then(() => {\n+    if (this.previewRunning) {\n+      this.stopPreview();\n+    } else if (this.doesPreviewHaveEmptyMacros) {\n+      this.getRuntimeArguments().then(() => {\n         if (this.previewRunning) {\n           this.stopPreview();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA=="}, "originalCommit": {"oid": "118ea295467bd6c53ca17da049dbefacb5b81713"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNzk2NQ==", "bodyText": "in that case i think the right thing to do is to do nothing. When the getRuntimeArguments modal open, the expectation is for the preview to start. If it's already running, it shouldn't stop the currently running preview.", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441907965", "createdAt": "2020-06-18T00:46:19Z", "author": {"login": "elfenheart"}, "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,26 +481,24 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n-      this.doStartOrStopPreview();\n-    } else {\n-      // Validate and show runtime arguments if there are\n-      // un-fulfilled macros.\n-      this.toggleConfig();\n-    }\n-  }\n-\n-  doStartOrStopPreview() {\n-    this.getRuntimeArguments()\n-      .then(() => {\n+    if (this.previewRunning) {\n+      this.stopPreview();\n+    } else if (this.doesPreviewHaveEmptyMacros) {\n+      this.getRuntimeArguments().then(() => {\n         if (this.previewRunning) {\n           this.stopPreview();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA=="}, "originalCommit": {"oid": "118ea295467bd6c53ca17da049dbefacb5b81713"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3284, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}