{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNzU5Mzkw", "number": 12831, "title": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace ", "bodyText": "JIRA - https://issues.cask.co/browse/CDAP-8617\nProblem\n\nWhen CDAP is enabled with authorization and authentication, the admin can setup the environment by creating groups and roles and grant specific users with access to specific namespaces.\nWhen those users access the restricted namespaces in UI, the UI was showing incorrect message (404).\n\nSolution\n\nFix the logic to check invalid namespace. Previously we were checking for the presence of namespace in the namespace list API. This will check only for 404s\nFix involves making an explicit call to /v3/namespaces/:namespace. This will be the source of truth (404 vs 403) to show appropriate message in UI.\nPrior to fetching namespace details we fetch list of namespaces. There might be the case where the user does not have access any namespace. In this case we show a slightly different message.", "createdAt": "2020-10-30T05:03:38Z", "url": "https://github.com/cdapio/cdap/pull/12831", "merged": true, "mergeCommit": {"oid": "f974326407c46ed3cb2635a9337a04a7cedcdd0a"}, "closed": true, "closedAt": "2020-11-03T00:35:35Z", "author": {"login": "ajainarayanan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXrDBrgBqjM5NDI1Nzg4NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYsm16ABqjM5NTA0MDExOTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6a5d76dd0a3e9b8a3f6a9a8af25c06ba70bc678", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/b6a5d76dd0a3e9b8a3f6a9a8af25c06ba70bc678", "committedDate": "2020-10-30T05:00:25Z", "message": "Removes unnecessary margin top styling for canvas"}, "afterCommit": {"oid": "d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "committedDate": "2020-10-30T18:26:28Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "committedDate": "2020-10-30T18:26:28Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}, "afterCommit": {"oid": "715553e6b9884fbbf535ae9c47c58208ffc9aaec", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/715553e6b9884fbbf535ae9c47c58208ffc9aaec", "committedDate": "2020-10-30T18:34:06Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "715553e6b9884fbbf535ae9c47c58208ffc9aaec", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/715553e6b9884fbbf535ae9c47c58208ffc9aaec", "committedDate": "2020-10-30T18:34:06Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}, "afterCommit": {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/de2561f5ec97b139d1209958db0fb5feb06539c4", "committedDate": "2020-10-30T18:36:54Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDQyNzIx", "url": "https://github.com/cdapio/cdap/pull/12831#pullrequestreview-521042721", "createdAt": "2020-10-30T21:20:41Z", "commit": {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToyMDo0MVrOHrgzPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToyMDo0MVrOHrgzPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4ODIyMA==", "bodyText": "Long-term, should we show the message from the back end? Will it be localized? (No need to change for now)", "url": "https://github.com/cdapio/cdap/pull/12831#discussion_r515388220", "createdAt": "2020-10-30T21:20:41Z", "author": {"login": "njbriggs"}, "path": "cdap-ui/app/cdap/main.js", "diffHunk": "@@ -358,22 +357,35 @@ class CDAP extends Component {\n               </div>\n             </If>\n             <If condition={!this.state.isNamespaceFetchInFlight}>\n-              <If\n-                condition={this.state.pageLevelError && this.state.pageLevelError.errorCode === 404}\n-              >\n+              <If condition={isNamespaceNotFound}>\n                 <Page404 message={this.state.pageLevelError.message} />\n               </If>\n+              {/** We show authorization failure message when the specific namespace API returns 403 */}\n+              <If condition={isUserUnAuthorizedForNamespace}>\n+                <AuthorizationErrorMessage message={this.state.pageLevelError.message} />\n+              </If>\n               <If\n-                condition={this.state.pageLevelError && this.state.pageLevelError.errorCode !== 404}\n+                condition={\n+                  !isUserUnAuthorizedForNamespace &&\n+                  !isNamespaceNotFound &&\n+                  this.state.pageLevelError\n+                }\n               >\n                 <Page500\n                   message={this.state.pageLevelError.message}\n                   refreshFn={this.retrieveNamespace}\n                 />\n               </If>\n-\n+              {/**\n+               * We show authorization failure message when the backend return empty\n+               * namespace. This indicates the user has access to no namespace.\n+               */}\n               <If condition={!this.state.pageLevelError}>\n-                {this.state.authorizationFailed ? <AuthorizationErrorMessage /> : container}\n+                {this.state.authorizationFailed ? (\n+                  <AuthorizationErrorMessage message={this.state.pageLevelError.message} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDQ2NjU3", "url": "https://github.com/cdapio/cdap/pull/12831#pullrequestreview-521046657", "createdAt": "2020-10-30T21:29:20Z", "commit": {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bee67d0593ac641c0e141fc331cde19e9252fd5", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/9bee67d0593ac641c0e141fc331cde19e9252fd5", "committedDate": "2020-11-02T22:47:38Z", "message": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace\n\n  - Consolidates throwing Authorization error in Home & RouteToNamespace components in react side of the app\n  - Adds utility functions to NamespaceStore to check and validate namespace, including access to no namespace\n  - Adds namespace context to AuthorizationErrorMessage component + exports it to use in Angular side\n  - Removes old implementation of validating namespace function in angular helpers\n  - Replaces old namespace validation function usage in both hydrator & tracker with new one exported from react\n  - Removes unnecessary margin top styling for canvas\n  - Fixes namespace accordion in Admin view to show valid empty message when user has access to no namespace\n  - Fixes navigation to Admin view to reset page error\n  - Fixes tracker and hydtator to properly handle 403s vs 404s"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/de2561f5ec97b139d1209958db0fb5feb06539c4", "committedDate": "2020-10-30T18:36:54Z", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s"}, "afterCommit": {"oid": "9bee67d0593ac641c0e141fc331cde19e9252fd5", "author": {"user": {"login": "ajainarayanan", "name": "Ajai"}}, "url": "https://github.com/cdapio/cdap/commit/9bee67d0593ac641c0e141fc331cde19e9252fd5", "committedDate": "2020-11-02T22:47:38Z", "message": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace\n\n  - Consolidates throwing Authorization error in Home & RouteToNamespace components in react side of the app\n  - Adds utility functions to NamespaceStore to check and validate namespace, including access to no namespace\n  - Adds namespace context to AuthorizationErrorMessage component + exports it to use in Angular side\n  - Removes old implementation of validating namespace function in angular helpers\n  - Replaces old namespace validation function usage in both hydrator & tracker with new one exported from react\n  - Removes unnecessary margin top styling for canvas\n  - Fixes namespace accordion in Admin view to show valid empty message when user has access to no namespace\n  - Fixes navigation to Admin view to reset page error\n  - Fixes tracker and hydtator to properly handle 403s vs 404s"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1722, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}