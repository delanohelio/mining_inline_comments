{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTUzOTM3", "number": 1702, "title": "SOLR-14681 Delete JAR", "bodyText": "Description\nAdd the ability to delete a locally stored a distributed jar. This issue is to support my uninstall package requirement. See https://issues.apache.org/jira/browse/SOLR-14681\nSolution\nPR\nTests\nI add test for changes to the package stores.\nChecklist\nPlease review the following and check all that apply:\n\n I have reviewed the guidelines for How to Contribute and my code conforms to the standards described there to the best of my ability.\n I have created a Jira issue and added the issue ID to my pull request title.\n I have given Solr maintainers access to contribute to my PR branch. (optional but recommended)\n I have developed this patch against the master branch.\n I have run ant precommit and the appropriate test suite.\n I have added tests for my changes.\n I have added documentation for the Ref Guide (for Solr changes only).", "createdAt": "2020-07-28T04:55:22Z", "url": "https://github.com/apache/lucene-solr/pull/1702", "merged": true, "mergeCommit": {"oid": "f443edebd207f93398b35520b24e2b66eba3609a"}, "closed": true, "closedAt": "2020-07-31T08:23:18Z", "author": {"login": "MarcusSorealheis"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbfAS4gH2gAyNDU3NTUzOTM3OjI2Yzc0ZDA5NTRjZWVlODU2NmUyNzE1MWI0MmZmYjk4MWEyZjgxYmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6P3lrgFqTQ1ODk5OTU5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "26c74d0954ceee8566e27151b42ffb981a2f81bb", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/26c74d0954ceee8566e27151b42ffb981a2f81bb", "committedDate": "2020-04-26T18:29:25Z", "message": "Fix typo in `cloud-scripts` path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd4a84b3255afea970bb72d1d18716573b4ae13", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/9dd4a84b3255afea970bb72d1d18716573b4ae13", "committedDate": "2020-04-28T22:34:28Z", "message": "t push :Merge branch 'master' of github.com:MarcusSorealheis/lucene-solr\n\n* 'master' of github.com:MarcusSorealheis/lucene-solr:\n  Fix typo in `cloud-scripts` path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fbeb9d42095bcdc2cfd687efc15c27bc9f2fe77", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/4fbeb9d42095bcdc2cfd687efc15c27bc9f2fe77", "committedDate": "2020-04-30T21:40:51Z", "message": "Merge remote-tracking branch 'upstream/master'\n\n* upstream/master:\n  SOLR-14237: Fix HDFS nightly test failure\n  LUCENE-9278: concatenate paths for sourcepath using path separator rather than whitespace (which causes invalid option to be passed to javadoc).\n  LUCENE-9333: Add gradle task to compile changes.txt to a html (#1468)\n  update CHANGES for #807\n  Fix tests to survive nightly runs with many documents\n  SOLR-14173: Don't use JQuery-Slim as it breaks the sidebar sub-menu system.\n  SOLR-14237: A new panel with security info in admin UI's dashboard\n  SOLR-14237: A new panel with security info in admin UI's dashboard\n  LUCENE-7788: fail precommit on unparameterised log messages and examine for wasted work/objects\n  SOLR-14173: Change left nav item highlighting to fix menu jumpiness when hovering/selecting\n  LUCENE-9349: TermInSetQuery should use consumeMatchingTerms in visit() (#1465)\n  LUCENE-9089: update FST usage example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f599df52c52310f8f967e501fa5ee09ab396c727", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/f599df52c52310f8f967e501fa5ee09ab396c727", "committedDate": "2020-06-20T17:08:03Z", "message": "Merge remote-tracking branch 'upstream/master'\n\n* upstream/master: (218 commits)\n  LUCENE-9412 Do not validate jenkins HTTPS cert\n  LUCENE-8962: add ability to selectively merge on commit (#1552)\n  Replace DWPT.DocState with simple method parameters (#1594)\n  LUCENE-9402: Let MultiCollector handle minCompetitiveScore (#1567)\n  SOLR-14574: Fix or suppress warnings in solr/core/src/test (part 2)\n  SOLR-14561 CoreAdminAPI's parameters instanceDir and dataDir are now validated (#1572)\n  SOLR-14532: Add *.iml files to gitignore\n  SOLR-14577: Return BAD REQUEST when field is missing in terms QP (#1588)\n  SOLR-14574: Fix or suppress warnings in solr/core/src/test (part 1)\n  remove debug code\n  LUCENE-9408: roll back only called once enforcement\n  LUCENE-8962: Allow waiting for all merges in a merge spec (#1585)\n  SOLR-14572 document missing SearchComponents (#1581)\n  LUCENE-9359: Avoid test failures when the extra file is a dir.\n  SOLR-14573: Fix or suppress warnings in solrj/src/test\n  LUCENE-9353: Move terms metadata to its own file. (#1473)\n  Cleanup TermsHashPerField (#1573)\n  SOLR-14558: Record all log lines in SolrLogPostTool (#1570)\n  LUCENE-9404: simplify checksum calculation of ByteBuffersIndexOutput\n  LUCENE-9403: tune BufferedChecksum.DEFAULT_BUFFERSIZE\n  ..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8115d055822e5877e424cc1f09855779721f162c", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/8115d055822e5877e424cc1f09855779721f162c", "committedDate": "2020-07-06T03:21:47Z", "message": "Merge remote-tracking branch 'upstream/master'\n\n* upstream/master: (90 commits)\n  SOLR-14595: add AwaitsFix test to TestJsonFacetRefinement demonstrating problem, and work around to randomized testing in TestCloudJSONFacetSKGEquiv\n  SOLR-14404: update was not working\n  SOLR-14523: Enhance gradle logging calls validation: eliminate getMessage(). Added Gradle validation check.\n  SOLR-14021: Deprecate HDFS support\n  SOLR-14603: Update CHANGES.txt\n  SOLR-14603: Upgrade Restlet to 2.4.3\n  SOLR-14537: Fix gradle precommit failures\n  SOLR-14610: ReflectMapWriter to use VarHandle instead of old legacy reflection (#1635)\n  SOLR-10742: SolrCores.getNamesForCore is quite inefficient and blocks other core operations\n  fix link and wordsmith a bit (#1642)\n  SOLR-14358 respond to feedback on URLClassifyProcessorFactory (#1632)\n  SOLR-14537: Improve performance of ExportWriter.\n  SOLR-14561: Fix silly mistake in refguide link\n  SOLR-14561: Adding upgrade notes for allowPaths (#1641)\n  SOLR-14066: Deprecate DIH\n  SOLR-14022: Deprecate CDCR\n  SOLR-14588: Implement Circuit Breakers (#1626)\n  Remove Redundant Import in TestContainerPlugin\n  SOLR-14404: Unregister was not working for plugins with $path-prefix\n  SOLR-14523: Enhance gradle logging calls validation: eliminate getMessage()\n  ..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf6b4d55fdbe578a04cd31330f255f4e4099370c", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/cf6b4d55fdbe578a04cd31330f255f4e4099370c", "committedDate": "2020-07-16T07:01:02Z", "message": "Merge remote-tracking branch 'upstream/master'\n\n* upstream/master: (45 commits)\n  SOLR-14151 Make schema components load from packages (#1669)\n  SOLR-13939: Extract any non-gradle related patches (deprecations, URL fixes, etc.) from gradle effort. Attmept to fix Windows disk full issues\n  SOLR-14646: Add STEM notation support for the Ref Guide\n  Add back-compat indices for 8.6.0\n  Sync CHANGES for 8.6.0\n  SOLR-13939: Extract any non-gradle related patches (deprecations, URL fixes, etc.) from gradle effort (thread leaks)\n  DOAP changes for release 8.6.0\n  SOLR-14647\n  SOLR-14637 update CloudSolrClient examples to remove deprecated .Builder() method (#1670)\n  SOLR-14244: Remove ReplicaInfo.\n  SOLR-14635: re-enable test with better gatekeeping of expected 'ownership threads' and (nightly only) polling of 'locked/waiting threads' before making asserts\n  Ref Guide: fix aliases.adoc TIP for proper conversion\n  Harden TestBuildingUpMemoryPressure (#1662)\n  SOLR-13939: https://issues.apache.org/jira/browse/SOLR-13939\n  SOLR-11262: XML writer implements writeMap and writeIterator (#1665)\n  Ref Guide: fix documentation for forceElevation param\n  Ref Guide: move allowPaths note into Security section for 8.6\n  Ref Guide: fix template to put list items inside a <p> element for consistent styling\n  SOLR-13132: fix some small package visibility and javadoc glitches that were caught on backport by the java8/branch_8x precommit but slipped past the java11/master precommit\n  SOLR-13132: JSON Facet perf improvements to support \"sweeping\" collection of \"relatedness()\"\n  ..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3ccd18e4f035f4dc2e5e82e1ac2b7836ea05e5c", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/a3ccd18e4f035f4dc2e5e82e1ac2b7836ea05e5c", "committedDate": "2020-07-28T00:48:11Z", "message": "Merge branch 'master' of github.com:marcussorealheis/lucene-solr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bafd7d801fa657d6409111c0af242c9282ec85f6", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/bafd7d801fa657d6409111c0af242c9282ec85f6", "committedDate": "2020-07-28T00:49:24Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5680f3314331dc69a984c1cc86afeaf1c5001ea", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/c5680f3314331dc69a984c1cc86afeaf1c5001ea", "committedDate": "2020-07-28T04:53:45Z", "message": "add delete JAR capability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/94c4c69d5259b9556a577aeb7b49bd34360bb041", "committedDate": "2020-07-28T08:42:26Z", "message": "change comment to be clearer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTIxNjEz", "url": "https://github.com/apache/lucene-solr/pull/1702#pullrequestreview-458921613", "createdAt": "2020-07-31T05:19:05Z", "commit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNToxOTowNVrOG58S5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNToyMjo1M1rOG58WjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQwOTg5NA==", "bodyText": "don't need this since deleteLocal will also call checkInZk?", "url": "https://github.com/apache/lucene-solr/pull/1702#discussion_r463409894", "createdAt": "2020-07-31T05:19:05Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/filestore/DistribPackageStore.java", "diffHunk": "@@ -470,13 +473,48 @@ public void syncToAllNodes(String path) throws IOException {\n     return fileDetails;\n   }\n \n+  @Override\n+  public void delete(String path) {\n+    checkInZk(path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxMDQyNA==", "bodyText": "do we use this for locking? no no no. we should be using zk versions for that.\nI understand that the code may have been in place before, but we need to fix it then before we can add additional features on top of this. it will add so much trouble.", "url": "https://github.com/apache/lucene-solr/pull/1702#discussion_r463410424", "createdAt": "2020-07-31T05:21:06Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/filestore/PackageStoreAPI.java", "diffHunk": "@@ -131,6 +131,53 @@ public void validateFiles(List<String> files, boolean validateSignatures, Consum\n \n     static final String TMP_ZK_NODE = \"/packageStoreWriteInProgress\";\n \n+    @EndPoint(\n+            path = \"/cluster/files/*\",\n+            method = SolrRequest.METHOD.DELETE,\n+            permission = PermissionNameProvider.Name.FILESTORE_WRITE_PERM)\n+    public void delete(SolrQueryRequest req, SolrQueryResponse rsp) {\n+      if (!coreContainer.getPackageLoader().getPackageAPI().isEnabled()) {\n+        throw new RuntimeException(PackageAPI.ERR_MSG);\n+      }\n+\n+      try {\n+        coreContainer.getZkController().getZkClient().create(TMP_ZK_NODE, \"true\".getBytes(UTF_8),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxMDcxMg==", "bodyText": "please configure your IDE to not do this", "url": "https://github.com/apache/lucene-solr/pull/1702#discussion_r463410712", "createdAt": "2020-07-31T05:22:23Z", "author": {"login": "madrob"}, "path": "solr/core/src/test/org/apache/solr/filestore/TestDistribPackageStore.java", "diffHunk": "@@ -39,15 +40,11 @@\n import org.apache.zookeeper.server.ByteBufferInputStream;\n import org.junit.After;\n import org.junit.Before;\n-\n import java.io.IOException;\n import java.io.InputStream;\n import java.nio.ByteBuffer;\n import java.nio.file.Paths;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Objects;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxMDc4MQ==", "bodyText": "vestigial?", "url": "https://github.com/apache/lucene-solr/pull/1702#discussion_r463410781", "createdAt": "2020-07-31T05:22:40Z", "author": {"login": "madrob"}, "path": "solr/core/src/test/org/apache/solr/filestore/TestDistribPackageStore.java", "diffHunk": "@@ -68,12 +65,13 @@ public void teardown() {\n     System.clearProperty(\"enable.packages\");\n   }\n   \n-  @SuppressWarnings({\"unchecked\"})\n+  @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n   public void testPackageStoreManagement() throws Exception {\n     MiniSolrCloudCluster cluster =\n         configureCluster(4)\n         .withJettyConfig(jetty -> jetty.enableV2(true))\n         .addConfig(\"conf\", configset(\"cloud-minimal\"))\n+        .addConfig(\"conf\", configset(\"cloud-minimal\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxMDgyOA==", "bodyText": "is this necessary?", "url": "https://github.com/apache/lucene-solr/pull/1702#discussion_r463410828", "createdAt": "2020-07-31T05:22:53Z", "author": {"login": "madrob"}, "path": "solr/core/src/test/org/apache/solr/filestore/TestDistribPackageStore.java", "diffHunk": "@@ -68,12 +65,13 @@ public void teardown() {\n     System.clearProperty(\"enable.packages\");\n   }\n   \n-  @SuppressWarnings({\"unchecked\"})\n+  @SuppressWarnings({\"unchecked\", \"rawtypes\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c4c69d5259b9556a577aeb7b49bd34360bb041"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d4b438d87b21a736a95dbc854c58e724065190", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/54d4b438d87b21a736a95dbc854c58e724065190", "committedDate": "2020-07-31T07:29:37Z", "message": "delete the superfluous."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5623fa62c875316071f52f758107af3d6eb5de4", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/f5623fa62c875316071f52f758107af3d6eb5de4", "committedDate": "2020-07-31T07:32:11Z", "message": "fix the imports in test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e5911471244e78f4147fbcaae14665b91a654f6", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/1e5911471244e78f4147fbcaae14665b91a654f6", "committedDate": "2020-07-31T07:33:19Z", "message": "oof"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3e54cffda4ee5667d64c08e4844c5334012c941", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/f3e54cffda4ee5667d64c08e4844c5334012c941", "committedDate": "2020-07-31T07:41:54Z", "message": "fix test imports."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6041f29d33407921143d7f2438cf5cccdab23fb", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/c6041f29d33407921143d7f2438cf5cccdab23fb", "committedDate": "2020-07-31T07:47:21Z", "message": "add changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd1ba0c5992d9671c41d1d53c4082ac06cb214d8", "author": {"user": {"login": "MarcusSorealheis", "name": "Marcus"}}, "url": "https://github.com/apache/lucene-solr/commit/fd1ba0c5992d9671c41d1d53c4082ac06cb214d8", "committedDate": "2020-07-31T07:59:03Z", "message": "changing to package store so it's easier to search for."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTk5NTkw", "url": "https://github.com/apache/lucene-solr/pull/1702#pullrequestreview-458999590", "createdAt": "2020-07-31T08:22:59Z", "commit": {"oid": "fd1ba0c5992d9671c41d1d53c4082ac06cb214d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2506, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}