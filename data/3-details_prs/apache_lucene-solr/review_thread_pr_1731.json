{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NjA2OTE1", "number": 1731, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjozMTo1NVrOEW3tsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozNTozNFrOEXm28A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNDE2OTQ0OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/search/DoubleValuesSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjozMTo1NVrOG-WYaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozMTo1OVrOG_fLow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMTU5Mg==", "bodyText": "This might be better as an object equality check instead of reference equality, I'm not sure.", "url": "https://github.com/apache/lucene-solr/pull/1731#discussion_r468031592", "createdAt": "2020-08-10T16:31:55Z", "author": {"login": "madrob"}, "path": "lucene/core/src/java/org/apache/lucene/search/DoubleValuesSource.java", "diffHunk": "@@ -456,13 +456,16 @@ public String toString() {\n \n     @Override\n     public SortField rewrite(IndexSearcher searcher) throws IOException {\n-      DoubleValuesSortField rewritten = new DoubleValuesSortField(producer.rewrite(searcher), reverse);\n+      DoubleValuesSource rewrittenSource = producer.rewrite(searcher);\n+      if (rewrittenSource == producer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9035c95dd0b3ac7b8bf9687d8f2173d4ceca02fa"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIyNDM1NQ==", "bodyText": "Reference equality is the right check.", "url": "https://github.com/apache/lucene-solr/pull/1731#discussion_r469224355", "createdAt": "2020-08-12T12:31:59Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/DoubleValuesSource.java", "diffHunk": "@@ -456,13 +456,16 @@ public String toString() {\n \n     @Override\n     public SortField rewrite(IndexSearcher searcher) throws IOException {\n-      DoubleValuesSortField rewritten = new DoubleValuesSortField(producer.rewrite(searcher), reverse);\n+      DoubleValuesSource rewrittenSource = producer.rewrite(searcher);\n+      if (rewrittenSource == producer) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMTU5Mg=="}, "originalCommit": {"oid": "9035c95dd0b3ac7b8bf9687d8f2173d4ceca02fa"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMTg4NjAyOnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/search/Sort.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozMzoyN1rOG_fPFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozMzoyN1rOG_fPFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIyNTIzNw==", "bodyText": "this should remain a reference equality check", "url": "https://github.com/apache/lucene-solr/pull/1731#discussion_r469225237", "createdAt": "2020-08-12T12:33:27Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/Sort.java", "diffHunk": "@@ -177,12 +177,12 @@ public Sort rewrite(IndexSearcher searcher) throws IOException {\n     SortField[] rewrittenSortFields = new SortField[fields.length];\n     for (int i = 0; i < fields.length; i++) {\n       rewrittenSortFields[i] = fields[i].rewrite(searcher);\n-      if (fields[i] != rewrittenSortFields[i]) {\n+      if (! fields[i].equals(rewrittenSortFields[i])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6da31797c931a42b2c381e4b1164b2a6b98384"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMTg5MzYwOnYy", "diffSide": "RIGHT", "path": "lucene/core/src/test/org/apache/lucene/search/TestSort.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozNTozNFrOG_fTpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMjozNTozNFrOG_fTpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIyNjQwNA==", "bodyText": "This test looks like it belongs to TestDoubleValuesSource/TestLongValuesSource more than it belongs to TestSort?", "url": "https://github.com/apache/lucene-solr/pull/1731#discussion_r469226404", "createdAt": "2020-08-12T12:35:34Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/test/org/apache/lucene/search/TestSort.java", "diffHunk": "@@ -878,4 +878,22 @@ public void testMultiSort() throws IOException {\n     ir.close();\n     dir.close();\n   }\n+\n+  public void testRewrite() throws IOException {\n+    try (Directory dir = newDirectory()) {\n+      RandomIndexWriter writer = new RandomIndexWriter(random(), dir);\n+      IndexSearcher searcher = newSearcher(writer.getReader());\n+      writer.close();\n+\n+      LongValuesSource longSource = LongValuesSource.constant(1L);\n+      Sort sort = new Sort(longSource.getSortField(false));\n+\n+      assertSame(sort, sort.rewrite(searcher));\n+\n+      DoubleValuesSource doubleSource = DoubleValuesSource.constant(1.0);\n+      sort = new Sort(doubleSource.getSortField(false));\n+\n+      assertSame(sort, sort.rewrite(searcher));\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6da31797c931a42b2c381e4b1164b2a6b98384"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1276, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}