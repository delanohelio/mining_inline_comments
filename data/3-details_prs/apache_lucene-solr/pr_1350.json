{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTU3NzA1", "number": 1350, "title": "Cleanup DWPT for readability", "bodyText": "DWPT had some complicated logic to account for failures etc.\nThis change cleans up this logic and simplifies the document processing\nloop.", "createdAt": "2020-03-13T20:04:32Z", "url": "https://github.com/apache/lucene-solr/pull/1350", "merged": true, "mergeCommit": {"oid": "bdb40fb1640079f7584146987fbe1a81b3709876"}, "closed": true, "closedAt": "2020-03-17T14:18:39Z", "author": {"login": "s1monw"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNV91xgH2gAyMzg3OTU3NzA1OmZhZjE4NWFiOTdkM2IwMzBmODMwNzJhYTQ4ZDNiNzNkNzFkNTkxMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcN09AoAH2gAyMzg3OTU3NzA1OmRhNTY3ZWFmNDEwNDVjOTVjOWYxYzU4MGU0NDVkZmE1NGNjNGQ5MmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/faf185ab97d3b030f83072aa48d3b73d71d59118", "committedDate": "2020-03-13T20:02:39Z", "message": "Cleanup DWPT for readability\n\nDWPT had some complicated logic to account for failures etc.\nThis change cleans up this logic and simplifies the document processing\nloop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzI4MzE4", "url": "https://github.com/apache/lucene-solr/pull/1350#pullrequestreview-374728318", "createdAt": "2020-03-14T13:46:46Z", "commit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0Njo0NlrOF2ZxUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NzoyNFrOF2ZxdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTY0OQ==", "bodyText": "nit:  add spaces around -", "url": "https://github.com/apache/lucene-solr/pull/1350#discussion_r392589649", "createdAt": "2020-03-14T13:46:46Z", "author": {"login": "dnhatn"}, "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "diffHunk": "@@ -249,34 +247,19 @@ public long updateDocuments(Iterable<? extends Iterable<? extends IndexableField\n           reserveOneDoc();\n           docState.doc = doc;\n           docState.docID = numDocsInRAM;\n-          docCount++;\n-\n-          boolean success = false;\n           try {\n             consumer.processDocument();\n-            success = true;\n           } finally {\n-            if (!success) {\n-              // Incr here because finishDocument will not\n-              // be called (because an exc is being thrown):\n-              numDocsInRAM++;\n-            }\n+            numDocsInRAM++; // we count the doc anyway even in the case of an exception\n           }\n-\n-          numDocsInRAM++;\n         }\n         allDocsIndexed = true;\n-        return finishDocuments(deleteNode, docCount);\n+        return finishDocuments(deleteNode, docsInRamBefore);\n       } finally {\n         if (!allDocsIndexed && !aborted) {\n           // the iterator threw an exception that is not aborting\n           // go and mark all docs from this block as deleted\n-          int docID = numDocsInRAM - 1;\n-          final int endDocID = docID - docCount;\n-          while (docID > endDocID) {\n-            deleteDocID(docID);\n-            docID--;\n-          }\n+          deleteLastDocs(numDocsInRAM-docsInRamBefore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTY4NA==", "bodyText": "Can you update the javadocs (it's a bit stale: a specific docID).", "url": "https://github.com/apache/lucene-solr/pull/1350#discussion_r392589684", "createdAt": "2020-03-14T13:47:24Z", "author": {"login": "dnhatn"}, "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "diffHunk": "@@ -318,8 +301,10 @@ private long finishDocuments(DocumentsWriterDeleteQueue.Node<?> deleteNode, int\n \n   // Buffer a specific docID for deletion. Currently only\n   // used when we hit an exception when adding a document\n-  void deleteDocID(int docIDUpto) {\n-    pendingUpdates.addDocID(docIDUpto);\n+  private void deleteLastDocs(int docCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118"}, "originalPosition": 113}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee0e53bc996d129006bb193596ca6df53e41d9a4", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/ee0e53bc996d129006bb193596ca6df53e41d9a4", "committedDate": "2020-03-15T07:32:15Z", "message": "Merge branch 'master' into small_dwpt_cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc383d6a2c3808238954fe8e9a4d208884e5947", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/8cc383d6a2c3808238954fe8e9a4d208884e5947", "committedDate": "2020-03-15T07:36:44Z", "message": "apply feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e57fa36b19e77ef6d675842d3087d07a3afdb723", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/e57fa36b19e77ef6d675842d3087d07a3afdb723", "committedDate": "2020-03-15T08:01:39Z", "message": "some more small nits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da567eaf41045c95c9f1c580e445dfa54cc4d92d", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/da567eaf41045c95c9f1c580e445dfa54cc4d92d", "committedDate": "2020-03-15T08:08:48Z", "message": "Merge branch 'master' into small_dwpt_cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2198, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}