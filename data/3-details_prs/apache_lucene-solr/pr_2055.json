{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTk5NjA2", "number": 2055, "title": "SOLR-14978 OOM Killer in Foreground", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14978", "createdAt": "2020-11-02T17:07:46Z", "url": "https://github.com/apache/lucene-solr/pull/2055", "merged": true, "mergeCommit": {"oid": "7c1ff288b73b053cc9d17c6d4db4b35ed6c5559a"}, "closed": true, "closedAt": "2020-11-04T23:20:17Z", "author": {"login": "madrob"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY8BYlAFqTUyMjY4MzIzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZVsgvAH2gAyNTE0MTk5NjA2OjI4NWM4Yzk4MjI1ODQwYmE5YzA3NzVmOWUyMzcwOGNhMDU0MzNjMDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNjgzMjM2", "url": "https://github.com/apache/lucene-solr/pull/2055#pullrequestreview-522683236", "createdAt": "2020-11-03T16:40:55Z", "commit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0MzozOVrOHs3bcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0Njo0OFrOHs3k2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwNzUzOA==", "bodyText": "Should this also be moved to bin/solr?", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516807538", "createdAt": "2020-11-03T16:43:39Z", "author": {"login": "HoustonPutman"}, "path": "solr/docker/include/scripts/solr-fg", "diffHunk": "@@ -15,21 +15,19 @@ if [[ -z \"${OOM:-}\" ]]; then\n   OOM='none'\n fi\n case \"$OOM\" in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwOTk0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            # If a heap dump directory is specified, enable it in SOLR_OPTS\n          \n          \n            \n            if [[ -z \"$SOLR_HEAP_DUMP_DIR\" ]] && [[ \"$SOLR_HEAP_DUMP\" == \"true\" ]]; then\n          \n          \n            \n              SOLR_HEAP_DUMP_DIR=\"${SOLR_LOGS_DIR}/dumps\"\n          \n          \n            \n            fi\n          \n          \n            \n            \n          \n      \n    \n    \n  \n\nI like the idea of having a boolean flag that lets you say that you want a heap dump at the default location of heap dumps. Not a necessity, just a thought.", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516809944", "createdAt": "2020-11-03T16:46:48Z", "author": {"login": "HoustonPutman"}, "path": "solr/bin/solr", "diffHunk": "@@ -2172,6 +2172,12 @@ function start_solr() {\n     SOLR_OPTS+=($AUTHC_OPTS)\n   fi\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c7f04089bcf3964369c7b1b281cfbc045c653f", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/a0c7f04089bcf3964369c7b1b281cfbc045c653f", "committedDate": "2020-11-03T21:43:51Z", "message": "SOLR-14978 OOM Killer in Foreground"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a928e78e4aa772c39bc9602d7fc014e2cc82e9a5", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/a928e78e4aa772c39bc9602d7fc014e2cc82e9a5", "committedDate": "2020-11-03T21:43:52Z", "message": "Update solr/bin/solr\n\nCo-authored-by: Houston Putman <houstonputman@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b76f058a935da8b1bfd369ad09dec590062eb56", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/3b76f058a935da8b1bfd369ad09dec590062eb56", "committedDate": "2020-11-03T21:43:53Z", "message": "Add documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1fd8109815e9b4611f034d0ff9c92c13f33d028c", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/1fd8109815e9b4611f034d0ff9c92c13f33d028c", "committedDate": "2020-11-03T21:31:12Z", "message": "indent new section."}, "afterCommit": {"oid": "3b76f058a935da8b1bfd369ad09dec590062eb56", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/3b76f058a935da8b1bfd369ad09dec590062eb56", "committedDate": "2020-11-03T21:43:53Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f75d6ff4f0d981136f64a28c173b5ac4a7263ec", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/8f75d6ff4f0d981136f64a28c173b5ac4a7263ec", "committedDate": "2020-11-04T19:55:49Z", "message": "Remove redundant options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzA4Mzcw", "url": "https://github.com/apache/lucene-solr/pull/2055#pullrequestreview-523708370", "createdAt": "2020-11-04T20:24:58Z", "commit": {"oid": "8f75d6ff4f0d981136f64a28c173b5ac4a7263ec"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDoyNDo1OFrOHtobWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDoyNDo1OFrOHtobWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxMDMyOA==", "bodyText": "Why are you piping the errors here? mkdir -p should be safe right?", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r517610328", "createdAt": "2020-11-04T20:24:58Z", "author": {"login": "HoustonPutman"}, "path": "solr/bin/solr", "diffHunk": "@@ -2172,6 +2172,16 @@ function start_solr() {\n     SOLR_OPTS+=($AUTHC_OPTS)\n   fi\n \n+  # If a heap dump directory is specified, enable it in SOLR_OPTS\n+  if [[ -z \"$SOLR_HEAP_DUMP_DIR\" ]] && [[ \"$SOLR_HEAP_DUMP\" == \"true\" ]]; then\n+    SOLR_HEAP_DUMP_DIR=\"${SOLR_LOGS_DIR}/dumps\"\n+  fi\n+  if [[ -n \"$SOLR_HEAP_DUMP_DIR\" ]]; then\n+    SOLR_OPTS+=(\"-XX:+HeapDumpOnOutOfMemoryError\")\n+    SOLR_OPTS+=(\"-XX:HeapDumpPath=$SOLR_HEAP_DUMP_DIR/solr-$(date +%s)-pid$$.hprof\")\n+    mkdir -p \"$SOLR_HEAP_DUMP_DIR\" 2>/dev/null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f75d6ff4f0d981136f64a28c173b5ac4a7263ec"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ab2b031d7f7ec3e7bf80ee262daff61f89b4b7", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/14ab2b031d7f7ec3e7bf80ee262daff61f89b4b7", "committedDate": "2020-11-04T21:41:42Z", "message": "Refactor dir creation logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a750acdd0cd518346250a77cf2d0eab135801ab6", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/a750acdd0cd518346250a77cf2d0eab135801ab6", "committedDate": "2020-11-04T21:42:46Z", "message": "pipe mkdir error to dev/null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "285c8c98225840ba9c0775f9e23708ca05433c04", "author": {"user": {"login": "madrob", "name": "Mike Drob"}}, "url": "https://github.com/apache/lucene-solr/commit/285c8c98225840ba9c0775f9e23708ca05433c04", "committedDate": "2020-11-04T22:41:58Z", "message": "check for unset dir"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2559, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}