{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNzIxOTMw", "number": 2152, "title": "SOLR-14034: remove deprecated min_rf references", "bodyText": "Description\nRemove min_rf and MIN_REPFACT references in code, tests and documentation.\nSolution\nIncrementally remove min_rf and MIN_REPFACT references.\nTests\n./gradlew check\nChecklist\nPlease review the following and check all that apply:\n\n I have reviewed the guidelines for How to Contribute and my code conforms to the standards described there to the best of my ability.\n I have created a Jira issue and added the issue ID to my pull request title.\n I have given Solr maintainers access to contribute to my PR branch. (optional but recommended)\n I have developed this patch against the master branch.\n I have run ./gradlew check.\n I have added tests for my changes.\n I have added documentation for the Ref Guide (for Solr changes only).", "createdAt": "2020-12-17T09:17:47Z", "url": "https://github.com/apache/lucene-solr/pull/2152", "merged": true, "mergeCommit": {"oid": "17adcc7aa499dd23500772717b075835182480b4"}, "closed": true, "closedAt": "2020-12-31T15:59:49Z", "author": {"login": "trdillon"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm4MOwAH2gAyNTQxNzIxOTMwOmRmZWExMzU4OWQ3YTM1MjQzM2RhNWU0YmEzZWJmZmNkZGJiYzE3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrPQXlAFqTU2MDA0MTc3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfea13589d7a352433da5e4ba3ebffcddbbc1798", "author": {"user": {"login": "trdillon", "name": "Tim Dillon"}}, "url": "https://github.com/apache/lucene-solr/commit/dfea13589d7a352433da5e4ba3ebffcddbbc1798", "committedDate": "2020-12-17T00:14:24Z", "message": "Removed min_rf and MIN_REPFACT parameter references"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NjIwMDAy", "url": "https://github.com/apache/lucene-solr/pull/2152#pullrequestreview-555620002", "createdAt": "2020-12-18T16:09:41Z", "commit": {"oid": "dfea13589d7a352433da5e4ba3ebffcddbbc1798"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3", "author": {"user": {"login": "trdillon", "name": "Tim Dillon"}}, "url": "https://github.com/apache/lucene-solr/commit/72dea2e333832ca561f41c92b042ac398296d5b3", "committedDate": "2020-12-21T23:00:31Z", "message": "Added SOLR-14034 to CHANGES.txt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTQ2NDAw", "url": "https://github.com/apache/lucene-solr/pull/2152#pullrequestreview-557146400", "createdAt": "2020-12-22T15:06:03Z", "commit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowNjowNFrOIJ-TCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTozMzo1NFrOIJ_Qgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyODc3Nw==", "bodyText": "Suggest to also remove the Integer minRf = null; at line 696 above.", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r547328777", "createdAt": "2020-12-22T15:06:04Z", "author": {"login": "cpoerschke"}, "path": "solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "diffHunk": "@@ -716,7 +716,6 @@ protected RouteException getRouteException(SolrException.ErrorCode serverError,\n         if (rf == null || routeRf < rf)\n           rf = routeRf;\n       }\n-      minRf = (Integer)header.get(UpdateRequest.MIN_REPFACT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzMxNA==", "bodyText": "Hi @trdillon - thanks for opening this pull request!\nOkay, I think I see it now, so your https://issues.apache.org/jira/browse/SOLR-14034?focusedCommentId=17223427&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17223427 question is about this sort of test change here i.e. whether or not minRf should remain an unused sendDoc argument or whether or not it should be removed. I'm thinking here in HttpPartitionTest removal makes sense (haven't yet looked at ReplicationFactorTest). What do you think?", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r547337314", "createdAt": "2020-12-22T15:21:25Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/HttpPartitionTest.java", "diffHunk": "@@ -548,9 +548,6 @@ protected int sendDoc(int docId, Integer minRf, SolrClient solrClient, String co\n     doc.addField(\"a_t\", \"hello\" + docId);\n \n     UpdateRequest up = new UpdateRequest();\n-    if (minRf != null) {\n-      up.setParam(UpdateRequest.MIN_REPFACT, String.valueOf(minRf));\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM0Mjk5Mg==", "bodyText": "How about also removing the minRf argument here since it's now no longer used?", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r547342992", "createdAt": "2020-12-22T15:31:12Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/ReplicationFactorTest.java", "diffHunk": "@@ -461,38 +447,24 @@ protected void doDelete(UpdateRequest req, String msg, int expectedRf, int retri\n \n   protected int sendDoc(int docId, int minRf) throws Exception {\n     UpdateRequest up = new UpdateRequest();\n-    boolean minRfExplicit = maybeAddMinRfExplicitly(minRf, up);\n     SolrInputDocument doc = new SolrInputDocument();\n     doc.addField(id, String.valueOf(docId));\n     doc.addField(\"a_t\", \"hello\" + docId);\n     up.add(doc);\n-    return runAndGetAchievedRf(up, minRfExplicit, minRf);\n+    return runAndGetAchievedRf(up, minRf);\n   }\n   \n-  private int runAndGetAchievedRf(UpdateRequest up, boolean minRfExplicit, int minRf) throws SolrServerException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM0NDUxNQ==", "bodyText": "Looks like assertMinRfInResponse is now also unused then, if so suggest to remove it also.", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r547344515", "createdAt": "2020-12-22T15:33:54Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/ReplicationFactorTest.java", "diffHunk": "@@ -461,38 +447,24 @@ protected void doDelete(UpdateRequest req, String msg, int expectedRf, int retri\n \n   protected int sendDoc(int docId, int minRf) throws Exception {\n     UpdateRequest up = new UpdateRequest();\n-    boolean minRfExplicit = maybeAddMinRfExplicitly(minRf, up);\n     SolrInputDocument doc = new SolrInputDocument();\n     doc.addField(id, String.valueOf(docId));\n     doc.addField(\"a_t\", \"hello\" + docId);\n     up.add(doc);\n-    return runAndGetAchievedRf(up, minRfExplicit, minRf);\n+    return runAndGetAchievedRf(up, minRf);\n   }\n   \n-  private int runAndGetAchievedRf(UpdateRequest up, boolean minRfExplicit, int minRf) throws SolrServerException, IOException {\n+  private int runAndGetAchievedRf(UpdateRequest up, int minRf) throws SolrServerException, IOException {\n     NamedList<Object> response = cloudClient.request(up);\n-    if (minRfExplicit) {\n-      assertMinRfInResponse(minRf, response);\n-    }\n     return cloudClient.getMinAchievedReplicationFactor(cloudClient.getDefaultCollection(), response);\n   }\n \n   private void assertMinRfInResponse(int minRf, NamedList<Object> response) {\n-    Object minRfFromResponse = response.findRecursive(\"responseHeader\", UpdateRequest.MIN_REPFACT);\n+    Object minRfFromResponse = response.findRecursive(\"responseHeader\");\n     assertNotNull(\"Expected min_rf header in the response\", minRfFromResponse);\n     assertEquals(\"Unexpected min_rf in response\", ((Integer)minRfFromResponse).intValue(), minRf);\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e7316dbd45860aa59dca5e1dfad7eb23da98e3", "author": {"user": {"login": "trdillon", "name": "Tim Dillon"}}, "url": "https://github.com/apache/lucene-solr/commit/77e7316dbd45860aa59dca5e1dfad7eb23da98e3", "committedDate": "2020-12-22T22:57:14Z", "message": "Remove assertMinRfInResponse and minRf references"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTUzNjU2", "url": "https://github.com/apache/lucene-solr/pull/2152#pullrequestreview-558153656", "createdAt": "2020-12-23T18:07:43Z", "commit": {"oid": "77e7316dbd45860aa59dca5e1dfad7eb23da98e3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxODowNzo0M1rOIKtfLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxODozNTo0NlrOIKu1nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODEwMTkzMg==", "bodyText": "Alright, so with maybeAddMinRfExplicitly gone and the minRf argument in runAndGetAchievedRf gone the minRf argument of sendDoc becomes unused, right? I wonder how the code would work out if sendDoc had its minRf argument taken away too? Bit like peeling an onion this here i.e. multiple layers (but it hopefully won't make anyone cry).", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r548101932", "createdAt": "2020-12-23T18:07:43Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/ReplicationFactorTest.java", "diffHunk": "@@ -461,38 +447,18 @@ protected void doDelete(UpdateRequest req, String msg, int expectedRf, int retri\n \n   protected int sendDoc(int docId, int minRf) throws Exception {\n     UpdateRequest up = new UpdateRequest();\n-    boolean minRfExplicit = maybeAddMinRfExplicitly(minRf, up);\n     SolrInputDocument doc = new SolrInputDocument();\n     doc.addField(id, String.valueOf(docId));\n     doc.addField(\"a_t\", \"hello\" + docId);\n     up.add(doc);\n-    return runAndGetAchievedRf(up, minRfExplicit, minRf);\n+    return runAndGetAchievedRf(up);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77e7316dbd45860aa59dca5e1dfad7eb23da98e3"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODEyNDA2MQ==", "bodyText": "Thanks for the code pointers and detailed explanation!\nHow about we scope this pull request to remove minRf in almost all code paths i.e. sendDoc gets its unused argument removed in both the replication factor and http partition tests but sendDocsWithRetry remains unchanged for now since as you say it's used in other test classes too?\nIt appears that the minRf argument in sendDocsWithRetry is indeed unused already but it might be clearer to tidy that up in a separate follow-up pull request rather than mix it in here at this time.", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r548124061", "createdAt": "2020-12-23T18:35:46Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/HttpPartitionTest.java", "diffHunk": "@@ -548,9 +548,6 @@ protected int sendDoc(int docId, Integer minRf, SolrClient solrClient, String co\n     doc.addField(\"a_t\", \"hello\" + docId);\n \n     UpdateRequest up = new UpdateRequest();\n-    if (minRf != null) {\n-      up.setParam(UpdateRequest.MIN_REPFACT, String.valueOf(minRf));\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzMxNA=="}, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e109454193a8711e6e7adad2ee0d0a2878603f24", "author": {"user": {"login": "trdillon", "name": "Tim Dillon"}}, "url": "https://github.com/apache/lucene-solr/commit/e109454193a8711e6e7adad2ee0d0a2878603f24", "committedDate": "2020-12-26T03:19:23Z", "message": "Remove minRf argument from sendDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "babf2c82717a113231b793cbc776806e3569239f", "author": {"user": {"login": "trdillon", "name": "Tim Dillon"}}, "url": "https://github.com/apache/lucene-solr/commit/babf2c82717a113231b793cbc776806e3569239f", "committedDate": "2020-12-26T03:21:18Z", "message": "Remove minRf argument from sendDoc in ReplicationFactorTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5ODk3NTI4", "url": "https://github.com/apache/lucene-solr/pull/2152#pullrequestreview-559897528", "createdAt": "2020-12-30T06:24:07Z", "commit": {"oid": "babf2c82717a113231b793cbc776806e3569239f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjoyNDowN1rOIMeL6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjoyNDowN1rOIMeL6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0ODM5NA==", "bodyText": "It appears that the minRf argument in sendDocsWithRetry is indeed unused already but it might be clearer to tidy that up in a separate follow-up pull request rather than mix it in here at this time.\n\nI'm wondering if it would be better for this method to actually start using this parameter, and retry in the case of minRf not achieved? This is not something that was being done in this method, but may help improve some of the tests using it. I don't think such a change should be done in this PR, but maybe lets not remove the parameter yet then. WDYT?", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r549948394", "createdAt": "2020-12-30T06:24:07Z", "author": {"login": "tflobbe"}, "path": "solr/core/src/test/org/apache/solr/cloud/HttpPartitionTest.java", "diffHunk": "@@ -548,9 +548,6 @@ protected int sendDoc(int docId, Integer minRf, SolrClient solrClient, String co\n     doc.addField(\"a_t\", \"hello\" + docId);\n \n     UpdateRequest up = new UpdateRequest();\n-    if (minRf != null) {\n-      up.setParam(UpdateRequest.MIN_REPFACT, String.valueOf(minRf));\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzMxNA=="}, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMDQxNzcy", "url": "https://github.com/apache/lucene-solr/pull/2152#pullrequestreview-560041772", "createdAt": "2020-12-30T13:10:19Z", "commit": {"oid": "babf2c82717a113231b793cbc776806e3569239f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMzoxMDoxOVrOIMs7Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMzoxNDo1MFrOIMs_qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4OTgzNA==", "bodyText": "I appreciate you committing the changes separately, thanks. The ReplicationFactorTest change looks good to me.", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r550189834", "createdAt": "2020-12-30T13:10:19Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/ReplicationFactorTest.java", "diffHunk": "@@ -461,38 +447,18 @@ protected void doDelete(UpdateRequest req, String msg, int expectedRf, int retri\n \n   protected int sendDoc(int docId, int minRf) throws Exception {\n     UpdateRequest up = new UpdateRequest();\n-    boolean minRfExplicit = maybeAddMinRfExplicitly(minRf, up);\n     SolrInputDocument doc = new SolrInputDocument();\n     doc.addField(id, String.valueOf(docId));\n     doc.addField(\"a_t\", \"hello\" + docId);\n     up.add(doc);\n-    return runAndGetAchievedRf(up, minRfExplicit, minRf);\n+    return runAndGetAchievedRf(up);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODEwMTkzMg=="}, "originalCommit": {"oid": "77e7316dbd45860aa59dca5e1dfad7eb23da98e3"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE5MTAxNg==", "bodyText": "I'm wondering if it would be better for this method to actually start using this parameter, ...\n\nAh, yes, I agree, if it's a case of a not-yet-used parameter then keeping it and starting to use it makes sense. Removal would only be for no-longer-used parameter cases. Good catch!", "url": "https://github.com/apache/lucene-solr/pull/2152#discussion_r550191016", "createdAt": "2020-12-30T13:14:50Z", "author": {"login": "cpoerschke"}, "path": "solr/core/src/test/org/apache/solr/cloud/HttpPartitionTest.java", "diffHunk": "@@ -548,9 +548,6 @@ protected int sendDoc(int docId, Integer minRf, SolrClient solrClient, String co\n     doc.addField(\"a_t\", \"hello\" + docId);\n \n     UpdateRequest up = new UpdateRequest();\n-    if (minRf != null) {\n-      up.setParam(UpdateRequest.MIN_REPFACT, String.valueOf(minRf));\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNzMxNA=="}, "originalCommit": {"oid": "72dea2e333832ca561f41c92b042ac398296d5b3"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2468, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}