{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MzcxMjY2", "number": 1740, "title": "LUCENE-9458: WDGF and WDF should tie-break by endOffset", "bodyText": "Can happen with catenateAll and not generating word xor number part when the input ends with the non-generated sub-token.\nhttps://issues.apache.org/jira/browse/LUCENE-9458\nCC @jimczi maybe you could review this please; I believe you reviewed the predecessor.", "createdAt": "2020-08-11T21:45:00Z", "url": "https://github.com/apache/lucene-solr/pull/1740", "merged": true, "mergeCommit": {"oid": "0303063e12049d9b470757c5ef2fb9afa6c5cd18"}, "closed": true, "closedAt": "2020-10-02T02:27:46Z", "author": {"login": "dsmiley"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc995StgH2gAyNDY2MzcxMjY2OjhiZTM0Y2QzMzM3YmI1YjllN2E0ZTg5MjEzMGYyZTNjYjdlOWMyOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOcgHqAH2gAyNDY2MzcxMjY2OmFiYjJhZWJhMTdkM2E5Mjg1NGJlMGE2M2U2ZGZiOTIzNDEzN2QzYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8be34cd3337bb5b9e7a4e892130f2e3cb7e9c28b", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/8be34cd3337bb5b9e7a4e892130f2e3cb7e9c28b", "committedDate": "2020-08-11T21:42:15Z", "message": "LUCENE-9458: WDGF and WDF should tie-break by endOffset\nCan happen with catenateAll and not generating word xor number part when the input ends with the non-generated sub-token."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NzUxMzUw", "url": "https://github.com/apache/lucene-solr/pull/1740#pullrequestreview-466751350", "createdAt": "2020-08-13T13:17:48Z", "commit": {"oid": "8be34cd3337bb5b9e7a4e892130f2e3cb7e9c28b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDI5NTg3", "url": "https://github.com/apache/lucene-solr/pull/1740#pullrequestreview-467029587", "createdAt": "2020-08-13T18:33:10Z", "commit": {"oid": "8be34cd3337bb5b9e7a4e892130f2e3cb7e9c28b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODozMzoxMFrOHAYfdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODozMzoxMFrOHAYfdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE2MzMxOQ==", "bodyText": "@bruno-roustant pointed out to me that the existing comparison here looks faulty -- notice it's doing the later position due to the swap of \"j\" and \"i\".  This is how it was before.  I think it's wrong, and makes me suspect that it's likely this comparison yields a zero.  If true, this is more evidence that suggest the sort can merely look at start & end offsets.", "url": "https://github.com/apache/lucene-solr/pull/1740#discussion_r470163319", "createdAt": "2020-08-13T18:33:10Z", "author": {"login": "dsmiley"}, "path": "lucene/analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/WordDelimiterFilter.java", "diffHunk": "@@ -398,10 +399,20 @@ public void reset() throws IOException {\n   private class OffsetSorter extends InPlaceMergeSorter {\n     @Override\n     protected int compare(int i, int j) {\n+      // earlier start offset\n       int cmp = Integer.compare(startOff[i], startOff[j]);\n-      if (cmp == 0) {\n-        cmp = Integer.compare(posInc[j], posInc[i]);\n+      if (cmp != 0) {\n+        return cmp;\n       }\n+      \n+      // earlier position\n+      cmp = Integer.compare(posInc[j], posInc[i]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8be34cd3337bb5b9e7a4e892130f2e3cb7e9c28b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4663df971931090b56542804178c34bac8a579b7", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/4663df971931090b56542804178c34bac8a579b7", "committedDate": "2020-09-21T19:53:18Z", "message": "Fuzzing revealed that only start & end offsets are needed to order sub-tokens."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c6a6bc519e4631f41d657d602f0b28be9470c16", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/6c6a6bc519e4631f41d657d602f0b28be9470c16", "committedDate": "2020-09-21T19:59:18Z", "message": "Reverted WDF changes.\n WDF is a problem still but left it as-is because I'm suspicious my solution introduces a bug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a338f0b18efa5df612ab693f332ea84e622cf03", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/4a338f0b18efa5df612ab693f332ea84e622cf03", "committedDate": "2020-10-02T02:20:21Z", "message": "Merge branch 'master' into lucene9458_wdf_useEndOffsetForOrder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb2aeba17d3a92854be0a63e6dfb9234137d3b3", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/abb2aeba17d3a92854be0a63e6dfb9234137d3b3", "committedDate": "2020-10-02T02:24:36Z", "message": "CHANGES.txt"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2357, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}