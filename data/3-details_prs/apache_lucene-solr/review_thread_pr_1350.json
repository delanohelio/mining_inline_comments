{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTU3NzA1", "number": 1350, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0Njo0NlrODoDgjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NzoyNFrODoDgoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzI3MTE4OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0Njo0NlrOF2ZxUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0Njo0NlrOF2ZxUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTY0OQ==", "bodyText": "nit:  add spaces around -", "url": "https://github.com/apache/lucene-solr/pull/1350#discussion_r392589649", "createdAt": "2020-03-14T13:46:46Z", "author": {"login": "dnhatn"}, "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "diffHunk": "@@ -249,34 +247,19 @@ public long updateDocuments(Iterable<? extends Iterable<? extends IndexableField\n           reserveOneDoc();\n           docState.doc = doc;\n           docState.docID = numDocsInRAM;\n-          docCount++;\n-\n-          boolean success = false;\n           try {\n             consumer.processDocument();\n-            success = true;\n           } finally {\n-            if (!success) {\n-              // Incr here because finishDocument will not\n-              // be called (because an exc is being thrown):\n-              numDocsInRAM++;\n-            }\n+            numDocsInRAM++; // we count the doc anyway even in the case of an exception\n           }\n-\n-          numDocsInRAM++;\n         }\n         allDocsIndexed = true;\n-        return finishDocuments(deleteNode, docCount);\n+        return finishDocuments(deleteNode, docsInRamBefore);\n       } finally {\n         if (!allDocsIndexed && !aborted) {\n           // the iterator threw an exception that is not aborting\n           // go and mark all docs from this block as deleted\n-          int docID = numDocsInRAM - 1;\n-          final int endDocID = docID - docCount;\n-          while (docID > endDocID) {\n-            deleteDocID(docID);\n-            docID--;\n-          }\n+          deleteLastDocs(numDocsInRAM-docsInRamBefore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzI3MTM2OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NzoyNFrOF2ZxdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NzoyNFrOF2ZxdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTY4NA==", "bodyText": "Can you update the javadocs (it's a bit stale: a specific docID).", "url": "https://github.com/apache/lucene-solr/pull/1350#discussion_r392589684", "createdAt": "2020-03-14T13:47:24Z", "author": {"login": "dnhatn"}, "path": "lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java", "diffHunk": "@@ -318,8 +301,10 @@ private long finishDocuments(DocumentsWriterDeleteQueue.Node<?> deleteNode, int\n \n   // Buffer a specific docID for deletion. Currently only\n   // used when we hit an exception when adding a document\n-  void deleteDocID(int docIDUpto) {\n-    pendingUpdates.addDocID(docIDUpto);\n+  private void deleteLastDocs(int docCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faf185ab97d3b030f83072aa48d3b73d71d59118"}, "originalPosition": 113}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 865, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}