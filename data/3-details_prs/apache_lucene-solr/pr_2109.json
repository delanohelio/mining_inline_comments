{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMDgyNDA0", "number": 2109, "title": "LUCENE-9627: Small refactor of codec classes", "bodyText": "Refactor of codec classes to separate reading header/footer from reading content of the file.\nIn addition the Lucene50FieldInfosFormat class is removed as it is not used in the codebase.", "createdAt": "2020-12-01T07:39:18Z", "url": "https://github.com/apache/lucene-solr/pull/2109", "merged": true, "mergeCommit": {"oid": "4b3e8d7ce8feba658a9730e65da70c04a7e9c52f"}, "closed": true, "closedAt": "2020-12-15T09:13:25Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh07uTAH2gAyNTMwMDgyNDA0OjY2Njk3Zjg3ZjAyMTMwNmYwNDlhNTBjMmRhY2VhNWU4NmZmMzkwZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmHIG-gH2gAyNTMwMDgyNDA0OjRiNmYwMzg2ZmU5NzkwN2Y1MmJiN2Y5MDRjNzQ5YzJiZjQ3MmU1NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66697f87f021306f049a50c2dacea5e86ff390f6", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/apache/lucene-solr/commit/66697f87f021306f049a50c2dacea5e86ff390f6", "committedDate": "2020-12-01T07:37:02Z", "message": "refactor of codec classes to separate reading header/footer from reading content of the file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMzA1MjQ1", "url": "https://github.com/apache/lucene-solr/pull/2109#pullrequestreview-551305245", "createdAt": "2020-12-14T12:05:02Z", "commit": {"oid": "66697f87f021306f049a50c2dacea5e86ff390f6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMjowNTowMlrOIFNZTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMjowNTowMlrOIFNZTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMzMzI2Mg==", "bodyText": "call it writeCompoundFile?", "url": "https://github.com/apache/lucene-solr/pull/2109#discussion_r542333262", "createdAt": "2020-12-14T12:05:02Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/codecs/lucene50/Lucene50CompoundFormat.java", "diffHunk": "@@ -80,52 +89,46 @@ public void write(Directory dir, SegmentInfo si, IOContext context) throws IOExc\n          IndexOutput entries = dir.createOutput(entriesFile, context)) {\n       CodecUtil.writeIndexHeader(data,    DATA_CODEC, VERSION_CURRENT, si.getId(), \"\");\n       CodecUtil.writeIndexHeader(entries, ENTRY_CODEC, VERSION_CURRENT, si.getId(), \"\");\n-      \n-      // write number of files\n-      entries.writeVInt(si.files().size());\n-      for (String file : si.files()) {\n-        \n-        // write bytes for file\n-        long startOffset = data.getFilePointer();\n-        try (ChecksumIndexInput in = dir.openChecksumInput(file, IOContext.READONCE)) {\n-\n-          // just copies the index header, verifying that its id matches what we expect\n-          CodecUtil.verifyAndCopyIndexHeader(in, data, si.getId());\n-          \n-          // copy all bytes except the footer\n-          long numBytesToCopy = in.length() - CodecUtil.footerLength() - in.getFilePointer();\n-          data.copyBytes(in, numBytesToCopy);\n-\n-          // verify footer (checksum) matches for the incoming file we are copying\n-          long checksum = CodecUtil.checkFooter(in);\n \n-          // this is poached from CodecUtil.writeFooter, but we need to use our own checksum, not data.getChecksum(), but I think\n-          // adding a public method to CodecUtil to do that is somewhat dangerous:\n-          data.writeInt(CodecUtil.FOOTER_MAGIC);\n-          data.writeInt(0);\n-          data.writeLong(checksum);\n-        }\n-        long endOffset = data.getFilePointer();\n-        \n-        long length = endOffset - startOffset;\n-        \n-        // write entry for file\n-        entries.writeString(IndexFileNames.stripSegmentName(file));\n-        entries.writeLong(startOffset);\n-        entries.writeLong(length);\n-      }\n+      writeSegmentInfo(entries, data, dir, si);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66697f87f021306f049a50c2dacea5e86ff390f6"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d530975d7cddba1598f0b1697cce967afcffc4ee", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/apache/lucene-solr/commit/d530975d7cddba1598f0b1697cce967afcffc4ee", "committedDate": "2020-12-14T15:00:07Z", "message": "Merge branch 'master' into refactor-codec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6f0386fe97907f52bb7f904c749c2bf472e545", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/apache/lucene-solr/commit/4b6f0386fe97907f52bb7f904c749c2bf472e545", "committedDate": "2020-12-14T15:04:33Z", "message": "add entry in CHANGES.txt and address review comments."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2631, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}