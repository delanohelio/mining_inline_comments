{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2OTUxMTQ4", "number": 1941, "title": "LUCENE-9554: Expose IndexWriter#pendingNumDocs", "bodyText": "Some applications can use the pendingNumDocs from IndexWriter to estimate that the number of documents of an index is very close to the hard limit so that it can reject writes without constructing Lucene documents.", "createdAt": "2020-10-02T14:40:58Z", "url": "https://github.com/apache/lucene-solr/pull/1941", "merged": true, "mergeCommit": {"oid": "7e04e4d0ca3951e90c064f2fd04ca89772080c91"}, "closed": true, "closedAt": "2020-10-02T21:32:21Z", "author": {"login": "dnhatn"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOnBE_gH2gAyNDk2OTUxMTQ4OmEwYjBlNzhlNWM0N2E4ZWRlOTI5ODFiNzRjMjJiM2NlMDA1MGU4YmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOrQp2gH2gAyNDk2OTUxMTQ4OjUwMWMxNDE0NjgwZDk5YjZhZGExN2UzMDVhYzI3YzFmNzIyZTczYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0b0e78e5c47a8ede92981b74c22b3ce0050e8bf", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/apache/lucene-solr/commit/a0b0e78e5c47a8ede92981b74c22b3ce0050e8bf", "committedDate": "2020-10-02T14:39:39Z", "message": "LUCENE-9554: Expose IndexWriter#pendingNumDocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16269e556a44dac582fe548e4845a5a79bdbfb8d", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/apache/lucene-solr/commit/16269e556a44dac582fe548e4845a5a79bdbfb8d", "committedDate": "2020-10-02T15:01:11Z", "message": "stylecheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjU0Mzkw", "url": "https://github.com/apache/lucene-solr/pull/1941#pullrequestreview-501254390", "createdAt": "2020-10-02T15:53:18Z", "commit": {"oid": "16269e556a44dac582fe548e4845a5a79bdbfb8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo1NDozN1rOHby6gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo1NDozN1rOHby6gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkwNzc3OA==", "bodyText": "I'm confused why we are calling separate methods when numDocs is negative or not?", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498907778", "createdAt": "2020-10-02T15:54:37Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -1072,7 +1073,14 @@ public IndexWriter(Directory d, IndexWriterConfig conf) throws IOException {\n \n       config.getFlushPolicy().init(config);\n       bufferedUpdatesStream = new BufferedUpdatesStream(infoStream);\n-      docWriter = new DocumentsWriter(flushNotifications, segmentInfos.getIndexCreatedVersionMajor(), pendingNumDocs,\n+      final IntConsumer reserveDocs = numDocs -> {\n+        if (numDocs > 0) {\n+          reserveDocs(numDocs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16269e556a44dac582fe548e4845a5a79bdbfb8d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/apache/lucene-solr/commit/655b7d9f8c0014bd879e90f22e1d9aa5d3096efd", "committedDate": "2020-10-02T16:39:35Z", "message": "smaller change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjk1Mzkw", "url": "https://github.com/apache/lucene-solr/pull/1941#pullrequestreview-501295390", "createdAt": "2020-10-02T16:52:26Z", "commit": {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1MjoyNlrOHb0sqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1MjoyNlrOHb0sqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNzAwMw==", "bodyText": "Maybe add @lucene.experimental?  We are exposing (slightly) internal details about IndexWriter so maybe we need to reserve the right to change this API in the future ...", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498937003", "createdAt": "2020-10-02T16:52:26Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -5463,6 +5463,13 @@ private void tooManyDocs(long addedNumDocs) {\n     throw new IllegalArgumentException(\"number of documents in the index cannot exceed \" + actualMaxDocs + \" (current document count is \" + pendingNumDocs.get() + \"; added numDocs is \" + addedNumDocs + \")\");\n   }\n \n+  /**\n+   * Returns the number of documents in the index including documents are being added (i.e., reserved).\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d4fbc4a01cbfc50f386a8a88064e82d1027ee0", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/apache/lucene-solr/commit/61d4fbc4a01cbfc50f386a8a88064e82d1027ee0", "committedDate": "2020-10-02T17:19:25Z", "message": "lucene experimental"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "501c1414680d99b6ada17e305ac27c1f722e73a5", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/apache/lucene-solr/commit/501c1414680d99b6ada17e305ac27c1f722e73a5", "committedDate": "2020-10-02T19:36:17Z", "message": "rename"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2674, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}