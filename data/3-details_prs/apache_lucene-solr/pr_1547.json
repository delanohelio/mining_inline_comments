{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTg3ODcw", "number": 1547, "title": "SOLR-14525 For components loaded from packages SolrCoreAware, ResourceLoaderAware are not honored", "bodyText": "SOLR-14525\nFor components loaded from packages SolrCoreAware, ResourceLoaderAware are not honored", "createdAt": "2020-05-31T09:54:38Z", "url": "https://github.com/apache/lucene-solr/pull/1547", "merged": true, "mergeCommit": {"oid": "e841d7625cc9cf495e611972b488390bcc8458ea"}, "closed": true, "closedAt": "2020-06-02T00:01:40Z", "author": {"login": "noblepaul"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmomlUgH2gAyNDI1NTg3ODcwOjNlYmUzODYxZDA3OWE3MDQzMWRkMTY1Y2U2NWYwOTljZGUxNTY1MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnI0zvgH2gAyNDI1NTg3ODcwOmZmZjNhNmI3ZDkyZWZiZTRiNzA0MGQzOWI2ODY2ODBjZTI2YmQ4ZjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ebe3861d079a70431dd165ce65f099cde156521", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/3ebe3861d079a70431dd165ce65f099cde156521", "committedDate": "2020-05-31T09:53:33Z", "message": "For components loaded from packages SolrCoreAware, ResourceLoaderAware are not honored"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/918cb0c81cfc3ff4161eca4221aef617c167a587", "committedDate": "2020-06-01T00:34:37Z", "message": "removed unused imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTc0Mjg5", "url": "https://github.com/apache/lucene-solr/pull/1547#pullrequestreview-421574289", "createdAt": "2020-06-01T03:23:18Z", "commit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwMzoyMzoxOFrOGc91wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwMzo0MjoyN1rOGc-A_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAyNjQ5Nw==", "bodyText": "Can you please configure your IDE to put java.* import statements up front instead of below?", "url": "https://github.com/apache/lucene-solr/pull/1547#discussion_r433026497", "createdAt": "2020-06-01T03:23:18Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/pkg/PackageLoader.java", "diffHunk": "@@ -17,31 +17,25 @@\n \n package org.apache.solr.pkg;\n \n-import java.io.Closeable;\n-import java.io.IOException;\n-import java.lang.invoke.MethodHandles;\n-import java.nio.file.Path;\n-import java.nio.file.Paths;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.HashSet;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Objects;\n-import java.util.Set;\n-import java.util.concurrent.ConcurrentHashMap;\n-import java.util.concurrent.CopyOnWriteArrayList;\n-\n+import org.apache.lucene.analysis.util.ResourceLoaderAware;\n import org.apache.solr.common.MapWriter;\n+import org.apache.solr.common.SolrException;\n import org.apache.solr.common.cloud.ZkStateReader;\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n import org.apache.solr.core.SolrResourceLoader;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.io.Closeable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAyNjc3NQ==", "bodyText": "incomplete comment?  Could use an explanation as to why. SolrCoreAware isn't handled here.", "url": "https://github.com/apache/lucene-solr/pull/1547#discussion_r433026775", "createdAt": "2020-06-01T03:25:14Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/pkg/PackageLoader.java", "diffHunk": "@@ -301,6 +295,32 @@ public String toString() {\n       }\n     }\n   }\n+  static class PackageResourceLoader extends SolrResourceLoader {\n+\n+    PackageResourceLoader(String name, List<Path> classpath, Path instanceDir, ClassLoader parent) {\n+      super(name, classpath, instanceDir, parent);\n+    }\n+\n+    @Override\n+    public <T> boolean addToCoreAware(T obj) {\n+      //do not do anything\n+      //this class is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAyNzk3MA==", "bodyText": "Lets figure out why the base class doesn't just immediately call inform like this here.  What test then fails?  I've read an interesting JIRA issue: https://issues.apache.org/jira/browse/SOLR-8311  (lots of info there; I recommend reading all of it)  It's been on my mind for some time now actually since when I was cleaning up SolrResourceLoader since this \"live\" wart seems like a hack.", "url": "https://github.com/apache/lucene-solr/pull/1547#discussion_r433027970", "createdAt": "2020-06-01T03:33:15Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/pkg/PackageLoader.java", "diffHunk": "@@ -301,6 +295,32 @@ public String toString() {\n       }\n     }\n   }\n+  static class PackageResourceLoader extends SolrResourceLoader {\n+\n+    PackageResourceLoader(String name, List<Path> classpath, Path instanceDir, ClassLoader parent) {\n+      super(name, classpath, instanceDir, parent);\n+    }\n+\n+    @Override\n+    public <T> boolean addToCoreAware(T obj) {\n+      //do not do anything\n+      //this class is\n+      return false;\n+    }\n+\n+    @Override\n+    public <T> boolean addToResourceLoaderAware(T obj) {\n+      if (obj instanceof ResourceLoaderAware) {\n+        assertAwareCompatibility(ResourceLoaderAware.class, obj);\n+        try {\n+          ((ResourceLoaderAware) obj).inform(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAyODU5Nw==", "bodyText": "Aha; makes sense.", "url": "https://github.com/apache/lucene-solr/pull/1547#discussion_r433028597", "createdAt": "2020-06-01T03:37:30Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/pkg/PackagePluginHolder.java", "diffHunk": "@@ -117,6 +114,13 @@ protected void initNewInstance(PackageLoader.Package.Version newest) {\n     Object instance = SolrCore.createInstance(pluginInfo.className,\n         pluginMeta.clazz, pluginMeta.getCleanTag(), core, newest.getLoader());\n     PluginBag.initInstance(instance, pluginInfo);\n+    if (instance instanceof SolrCoreAware) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAyOTM3Mg==", "bodyText": "Should this not be in its own method now too?", "url": "https://github.com/apache/lucene-solr/pull/1547#discussion_r433029372", "createdAt": "2020-06-01T03:42:27Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/core/SolrResourceLoader.java", "diffHunk": "@@ -566,25 +566,42 @@ static void clearCache() {\n \n     } catch (Exception e) {\n       throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,\n-          \"Error instantiating class: '\" + clazz.getName() + \"'\", e);\n+              \"Error instantiating class: '\" + clazz.getName() + \"'\", e);\n     }\n \n-    if (!live) {\n-      if (obj instanceof SolrCoreAware) {\n-        assertAwareCompatibility(SolrCoreAware.class, obj);\n-        waitingForCore.add((SolrCoreAware) obj);\n+    addToCoreAware(obj);\n+    addToResourceLoaderAware(obj);\n+    if(!live) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "918cb0c81cfc3ff4161eca4221aef617c167a587"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efd54232b796f33d46060efb367a568ae55a810", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/4efd54232b796f33d46060efb367a568ae55a810", "committedDate": "2020-06-01T10:26:48Z", "message": "change the invocation order of ResourceLoader.infor()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c7e03f55f177851215716c43d2fc15eeafa4b46", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/4c7e03f55f177851215716c43d2fc15eeafa4b46", "committedDate": "2020-06-01T23:15:11Z", "message": "move adding info beans to separate method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ef305b94a16a694742da78c7fe0129fbfb736e9", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/4ef305b94a16a694742da78c7fe0129fbfb736e9", "committedDate": "2020-06-01T23:17:54Z", "message": "merging with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fbb4c26de45f00c4fae4ad88d6dc53b88885ade", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/0fbb4c26de45f00c4fae4ad88d6dc53b88885ade", "committedDate": "2020-06-01T23:21:16Z", "message": "Revert \"merging with master\"\n\nThis reverts commit 4ef305b94a16a694742da78c7fe0129fbfb736e9.\n\nreverting last commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610ae82bebcb88e1c228372380c38732826279b0", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/610ae82bebcb88e1c228372380c38732826279b0", "committedDate": "2020-06-01T23:24:47Z", "message": "CHANGES.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff3a6b7d92efbe4b7040d39b686680ce26bd8f4", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/fff3a6b7d92efbe4b7040d39b686680ce26bd8f4", "committedDate": "2020-06-01T23:26:03Z", "message": "Merge branch 'master' into jira/solr14525"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2568, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}