{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODkxODgz", "number": 1675, "title": "SOLR-14652: SolrCore should hold its own CoreDescriptor", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14652\n(minor refactoring)\nAlso:\n\nSolrCore's constructors don't need a \"name\" since it's guaranteed to always be the name in the coreDescriptor.\u00a0 I checked.\nSolrCore's constructor shouldn't call coreContainer.solrCores.addCoreDescriptor(cd); because it's the container's responsibility to manage such things.\u00a0 I made SolrCores.putCore ensure the descriptor is added, and this is called by CoreContainer.registerCore which is called after new SolrCore instances are created.\nsolrCore.setName should only be called when we expect the name to change.\u00a0 Furthermore that shouldn't ever happen in SolrCloud so I added checks.\nsolrCore.setName calls coreMetricManager.afterCoreSetName() which is something that is really only related to a rename, not name initialization\u00a0(from the constructor).\u00a0 I renamed that method and further only call it if the name did change from non-null.\u00a0\u00a0CC @sigram\n\n@ErickErickson you might want to do a code review based on your past interactions with the CoreContainer/CoreDescriptor/SolrCores/SolrCore relationship.\nI'm doubtful this deserves a CHANGES.txt entry; invisible to users and is relatively minor.", "createdAt": "2020-07-16T04:39:06Z", "url": "https://github.com/apache/lucene-solr/pull/1675", "merged": true, "mergeCommit": {"oid": "5295007022b524160b76a7afc55b76d1eee26541"}, "closed": true, "closedAt": "2020-07-25T05:08:24Z", "author": {"login": "dsmiley"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1XnB9gH2gAyNDQ5ODkxODgzOmQzZGNiNjIzOGMxOTllZjk4NjVjNGFlMGNhMmI5ZTk5YzI4NTU4Y2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4Kr3IAFqTQ1NTE4NjE5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf", "committedDate": "2020-07-16T04:34:31Z", "message": "SOLR-14652: SolrCore should hold its own CoreDescriptor\n(minor refactoring)\nAlso:\n* SolrCore's constructors don't need a \"name\" since it's guaranteed to always be the name in the coreDescriptor.\u00a0 I checked.\n* SolrCore's constructor shouldn't call coreContainer.solrCores.addCoreDescriptor(cd); because it's the container's responsibility to manage such things.\u00a0 I made SolrCores.putCore ensure the descriptor is added, and this is called by CoreContainer.registerCore which is called after new SolrCore instances are created.\n* solrCore.setName should only be called when we expect the name to change.\u00a0 Furthermore that shouldn't ever happen in SolrCloud so I added checks.\n* solrCore.setName calls coreMetricManager.afterCoreSetName() which is something that is really only related to a rename, not name initialization\u00a0(from the constructor).\u00a0 I renamed that method and further only call it if the name did change from non-null.\u00a0\u00a0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzcwNTk0", "url": "https://github.com/apache/lucene-solr/pull/1675#pullrequestreview-450770594", "createdAt": "2020-07-17T15:51:16Z", "commit": {"oid": "d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTo1MToxNlrOGzYPdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTo1NjozMFrOGzYahw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUyNzczMg==", "bodyText": "Should it call apiAssumeStandalone()?", "url": "https://github.com/apache/lucene-solr/pull/1675#discussion_r456527732", "createdAt": "2020-07-17T15:51:16Z", "author": {"login": "bruno-roustant"}, "path": "solr/core/src/java/org/apache/solr/core/SolrCore.java", "diffHunk": "@@ -487,10 +488,13 @@ public String getName() {\n   }\n \n   public void setName(String v) {\n+    Objects.requireNonNull(v);\n+    boolean renamed = this.name != null && !this.name.equals(v);\n+    assert !renamed || coreDescriptor.getCloudDescriptor() == null : \"Cores are not renamed in SolrCloud\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUzMDU2Nw==", "bodyText": "Should it call apiAssumeStandalone()?", "url": "https://github.com/apache/lucene-solr/pull/1675#discussion_r456530567", "createdAt": "2020-07-17T15:56:30Z", "author": {"login": "bruno-roustant"}, "path": "solr/core/src/java/org/apache/solr/metrics/SolrCoreMetricManager.java", "diffHunk": "@@ -92,10 +92,10 @@ public void loadReporters() {\n    * are carried over and will be used under the new core name.\n    * This method also reloads reporters so that they use the new core name.\n    */\n-  public void afterCoreSetName() {\n+  public void afterCoreRename() {\n+    assert core.getCoreDescriptor().getCloudDescriptor() == null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTA3NzM1", "url": "https://github.com/apache/lucene-solr/pull/1675#pullrequestreview-450907735", "createdAt": "2020-07-17T19:30:32Z", "commit": {"oid": "d3dcb6238c199ef9865c4ae0ca2b9e99c28558cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83142f21ad75f477e9e38c67921c94f3d6d52dc1", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/83142f21ad75f477e9e38c67921c94f3d6d52dc1", "committedDate": "2020-07-21T05:34:02Z", "message": "Merge branch 'master' into solr-14652\n\n# Conflicts:\n#\tsolr/core/src/java/org/apache/solr/core/SolrCore.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDg0MzEy", "url": "https://github.com/apache/lucene-solr/pull/1675#pullrequestreview-452484312", "createdAt": "2020-07-21T13:57:44Z", "commit": {"oid": "83142f21ad75f477e9e38c67921c94f3d6d52dc1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1Nzo0NVrOG05Rgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1Nzo0NVrOG05Rgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExNzUwNw==", "bodyText": "change java doc reflecting this change", "url": "https://github.com/apache/lucene-solr/pull/1675#discussion_r458117507", "createdAt": "2020-07-21T13:57:45Z", "author": {"login": "juanka588"}, "path": "solr/core/src/java/org/apache/solr/core/CoreContainer.java", "diffHunk": "@@ -1788,6 +1786,7 @@ public void unload(String name, boolean deleteIndexDir, boolean deleteDataDir, b\n   }\n \n   public void rename(String name, String toName) {\n+    apiAssumeStandalone();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83142f21ad75f477e9e38c67921c94f3d6d52dc1"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTg2MTk0", "url": "https://github.com/apache/lucene-solr/pull/1675#pullrequestreview-455186194", "createdAt": "2020-07-24T21:07:33Z", "commit": {"oid": "83142f21ad75f477e9e38c67921c94f3d6d52dc1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTowNzozM1rOG29yZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQyMTowNzozM1rOG29yZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI4ODYxMw==", "bodyText": "More clear as !v.equals(this.name) I think?", "url": "https://github.com/apache/lucene-solr/pull/1675#discussion_r460288613", "createdAt": "2020-07-24T21:07:33Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/core/SolrCore.java", "diffHunk": "@@ -497,10 +498,13 @@ public String getName() {\n   }\n \n   public void setName(String v) {\n+    Objects.requireNonNull(v);\n+    boolean renamed = this.name != null && !this.name.equals(v);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83142f21ad75f477e9e38c67921c94f3d6d52dc1"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2467, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}