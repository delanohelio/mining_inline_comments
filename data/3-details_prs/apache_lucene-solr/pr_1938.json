{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NjA2MTMw", "number": 1938, "title": "SOLR-14659: Remove restlet as dependency for the ManagedResource API", "bodyText": "Description\nHere\u2019s a quick pass at keeping the existing ManagedResource API endpoints in place but without using Restlet. Now that I\u2019ve gone through this code again, it seems like Restlet was more aspirational than technically required to support the current functionality. As I said on the mailing list, I don\u2019t know the history of why Restlet was introduced so I can\u2019t say much more about that.\nWhat I do know is that it\u2019s not needed to support the ManagedResource endpoints we have today. In a nutshell, RestManager keeps a mapping from a PATH (e.g. /schema/analysis/stopwords/english) to a ManagedResource impl and Restlet is used to route REST requests for the PATH to a ManagedResource. There\u2019s a ManagedEndpoint used as the shim between Restlet and the ManagedResource that\u2019s just details ...\nIn this PR, I\u2019ve simply replaced the Restlet routing logic with a SolrRequestHandler that resolves the ManagedResource for a PATH using the RestManager\u2019s mapping. Put simply, plugging into the Restlet routing logic isn\u2019t necessary for Managed Resources. Not to mention, there\u2019s some rigid mapping to /schema in places, so I\u2019m not certain we achieved the supposed goal of supporting dynamic mapping of path to resource that Restlet provides.\nAs has been discussed on the mailing list, we could just remove all of this ManagedResource code from master but that requires us to come up with some LTR specific request handler to allow managing models and features. However, the approach in this PR doesn\u2019t feel too dirty to me and avoids breaking the existing APIs for stopwords / synonyms / LTR models & features.\nI\u2019m happy to go either way here but wanted to see what it would take to remove Restlet but keep the existing endpoints and this work accomplishes that.\nSolution\nPlease provide a short description of the approach taken to implement your solution.\nTests\nPlease describe the tests you've developed or run to confirm this patch implements the feature or solves the problem.\nChecklist\nPlease review the following and check all that apply:\n\n I have reviewed the guidelines for How to Contribute and my code conforms to the standards described there to the best of my ability.\n I have created a Jira issue and added the issue ID to my pull request title.\n I have given Solr maintainers access to contribute to my PR branch. (optional but recommended)\n I have developed this patch against the master branch.\n I have run ./gradlew check.\n I have added tests for my changes.\n I have added documentation for the Ref Guide (for Solr changes only).", "createdAt": "2020-10-01T23:51:02Z", "url": "https://github.com/apache/lucene-solr/pull/1938", "merged": true, "mergeCommit": {"oid": "e879a52291ef7dcd0514e7419d811b6ff800bcce"}, "closed": true, "closedAt": "2020-10-04T17:21:50Z", "author": {"login": "thelabdude"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOZgEpAH2gAyNDk2NjA2MTMwOjBiOTUzMDk3NWJjMmI4OWVhZGQ0ODdmMmQxNzA0Zjc4NjhiNGM1NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPRmV_AH2gAyNDk2NjA2MTMwOmZiZTQ0NmY0MDk2ZWRlMTU1ZWVhMTY1NjVjOGE2NjcwOTcyZDJhOTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b9530975bc2b89eadd487f2d1704f7868b4c547", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/0b9530975bc2b89eadd487f2d1704f7868b4c547", "committedDate": "2020-10-01T22:54:50Z", "message": "SOLR-14766: Remove restlet as dependency for the ManagedResource API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwODExMzgz", "url": "https://github.com/apache/lucene-solr/pull/1938#pullrequestreview-500811383", "createdAt": "2020-10-02T01:16:33Z", "commit": {"oid": "0b9530975bc2b89eadd487f2d1704f7868b4c547"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMToxNjozM1rOHbfB3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMToxNjozM1rOHbfB3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MTk4Mg==", "bodyText": "UNSAFE_HASH_EQUALS:  Unsafe comparison of hash that are susceptible to timing attack (details)", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r498581982", "createdAt": "2020-10-02T01:16:33Z", "author": {"login": "sonatype-lift"}, "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -326,44 +327,46 @@ public void doInit() throws ResourceException {\n           }\n         }\n       }    \n-      \n+\n       if (managedResource == null) {\n-        if (Method.PUT.equals(getMethod()) || Method.POST.equals(getMethod())) {\n+        final String method = getSolrRequest().getHttpMethod();\n+        if (\"PUT\".equals(method) || \"POST\".equals(method)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b9530975bc2b89eadd487f2d1704f7868b4c547"}, "originalPosition": 176}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4124ae724e47f43764250c316749b20af6bb1cb3", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/4124ae724e47f43764250c316749b20af6bb1cb3", "committedDate": "2020-10-02T14:51:36Z", "message": "Apply patch from Noble and clean-up stray references to restlet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/90fd21de89843ce75978c99ab1c1c6c299c5be02", "committedDate": "2020-10-02T15:21:45Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308cf2f07d818e378b3aa6dd65a78acb6b4b9033", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/308cf2f07d818e378b3aa6dd65a78acb6b4b9033", "committedDate": "2020-10-02T16:12:22Z", "message": "Remove unnecessary changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzIyMDA4", "url": "https://github.com/apache/lucene-solr/pull/1938#pullrequestreview-501322008", "createdAt": "2020-10-02T17:33:22Z", "commit": {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzozMzoyMlrOHb151g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzozMzoyMlrOHb151g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk1Njc1OA==", "bodyText": "THREAD_SAFETY_VIOLATION:  Read/Write race. Non-private method RestManager$Registry.isPathRegistered(...) reads without synchronization from container this.registered via call to Map.containsKey(...). Potentially races with write in method RestManager$Registry.registerManagedResource(...).\nReporting because another access to the same memory occurs on a background thread, although this access may not.", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r498956758", "createdAt": "2020-10-02T17:33:22Z", "author": {"login": "sonatype-lift"}, "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -160,6 +156,10 @@ private Pattern getReservedEndpointsPattern() {\n       return Pattern.compile(builder.toString());\n     }\n \n+    public boolean isPathRegistered(String s) {\n+      return registered.containsKey(s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTE4NDUx", "url": "https://github.com/apache/lucene-solr/pull/1938#pullrequestreview-501518451", "createdAt": "2020-10-03T03:57:08Z", "commit": {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMzo1NzowOFrOHb_cvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMzo1NzowOFrOHb_cvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTExMzE0OA==", "bodyText": "I'd prefer you configure your IDE to keep java.* up front.  FWIW this is in the IntelliJ config in the project.", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r499113148", "createdAt": "2020-10-03T03:57:08Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -16,15 +16,33 @@\n  */\n package org.apache.solr.rest;\n \n+import org.apache.solr.common.SolrException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfb33fc7d984d61d0be4b0f1d56d8dad21b0d81", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/ddfb33fc7d984d61d0be4b0f1d56d8dad21b0d81", "committedDate": "2020-10-03T05:12:33Z", "message": "Move the request handler to SchemaHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b5f504282d9f539ed04e73f0442546f85bdb7a5", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/2b5f504282d9f539ed04e73f0442546f85bdb7a5", "committedDate": "2020-10-03T05:31:34Z", "message": "Support for security permissions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTIzMjMw", "url": "https://github.com/apache/lucene-solr/pull/1938#pullrequestreview-501523230", "createdAt": "2020-10-03T05:46:57Z", "commit": {"oid": "2b5f504282d9f539ed04e73f0442546f85bdb7a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8d4c84f0373b2706d8b16ffc93a5c37ba566a27", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/e8d4c84f0373b2706d8b16ffc93a5c37ba566a27", "committedDate": "2020-10-04T15:09:27Z", "message": "Fix import order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09dcb51d3a1259c7da84f06272e908139152e1fe", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/09dcb51d3a1259c7da84f06272e908139152e1fe", "committedDate": "2020-10-04T15:20:45Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5545260f2007bb1410e4d5374b2ba94bb5536d5f", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/5545260f2007bb1410e4d5374b2ba94bb5536d5f", "committedDate": "2020-10-04T16:12:26Z", "message": "Merge remote-tracking branch 'asf/master' into jira/solr-14766"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf8d47f99a397d42aea445e48a8bd4c58263b1d", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/cbf8d47f99a397d42aea445e48a8bd4c58263b1d", "committedDate": "2020-10-04T16:13:39Z", "message": "Add to changes.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbe446f4096ede155eea16565c8a6670972d2a99", "author": {"user": {"login": "thelabdude", "name": "Timothy Potter"}}, "url": "https://github.com/apache/lucene-solr/commit/fbe446f4096ede155eea16565c8a6670972d2a99", "committedDate": "2020-10-04T16:16:22Z", "message": "Fix import order"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2671, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}