{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTQxMDM1", "number": 1522, "title": "LUCENE-9374: Add checkBrokenLinks gradle task", "bodyText": "Description\nThis adds documentationLint task to gradle build. This adds checkBrokenLinks task to gradle build. The task is a placeholder for :lucene:checkBrokenLinks and :solr:checkBrokenLinks that detect broken or invalid links in docs under _project_/build/documentation.\nFor now, both check tasks fail as there are broken links in the javadocs.\nSee also https://issues.apache.org/jira/browse/LUCENE-9374\nGradle command\n./gradlew checkBrokenLinks\n\nor\n./gradlew :lucene:checkBrokenLinks\n./gradlew :solr:checkBrokenLinks\n\nNote\n\nI added documentationLint task that wraps checkBrokenLinks to align semantics with documentation task, but it can be removed if not needed.\ndocumentation-lint.gradle could be placed under gradle/documentation ?", "createdAt": "2020-05-16T09:24:33Z", "url": "https://github.com/apache/lucene-solr/pull/1522", "merged": true, "mergeCommit": {"oid": "84ea0cb87dd7071648bd8efb97644f2af148fa7c"}, "closed": true, "closedAt": "2020-05-20T14:23:25Z", "author": {"login": "mocobeta"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchy3wMAH2gAyNDE4OTQxMDM1OmQ1ZDFjZWQ5ODc1NjhiMGJjMmE3MDNjNTFkOGZmNWIyNWIzYmFhNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcizSilgH2gAyNDE4OTQxMDM1Ojc3ODcwMWM5NzEyMGZiYzJlNjU3OGE1NDVkNzcxOWFjMTlkODJkNzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/d5d1ced987568b0bc2a703c51d8ff5b25b3baa43", "committedDate": "2020-05-16T09:01:44Z", "message": "LUCENE-9374: Add doclumentationLint gradle task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDYyNzc0", "url": "https://github.com/apache/lucene-solr/pull/1522#pullrequestreview-413062774", "createdAt": "2020-05-16T09:27:56Z", "commit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwOToyNzo1N1rOGWZVNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwOTozMjo1MlrOGWZWkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjg4Ng==", "bodyText": "There is already a comment about include ordering above I believe, but fine.", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426136886", "createdAt": "2020-05-16T09:27:57Z", "author": {"login": "dweiss"}, "path": "build.gradle", "diffHunk": "@@ -134,3 +134,4 @@ apply from: file('gradle/ant-compat/forbidden-api-rules-in-sync.gradle')\n apply from: file('gradle/documentation/documentation.gradle')\n apply from: file('gradle/documentation/changes-to-html.gradle')\n apply from: file('gradle/render-javadoc.gradle')\n+apply from: file('gradle/validation/documentation-lint.gradle')  // should be placed here; needs to be evaluated after documentation.gradle", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNjk1Mg==", "bodyText": "This can be explicit since there are only two? (\":lucene:checkBrokenLinks\", \":solr:checkBrokenLinks\")?", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426136952", "createdAt": "2020-05-16T09:28:55Z", "author": {"login": "dweiss"}, "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzExOA==", "bodyText": "I would add (commented out) check.dependsOn checkBrokenLinks to task declaration per-project as well so that when you run gradlew -p lucene check the validation runs on a per-project basis too.", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426137118", "createdAt": "2020-05-16T09:31:03Z", "author": {"login": "dweiss"}, "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->\n+      prj.tasks.matching { task -> task.name == 'checkBrokenLinks'}\n+    }\n+  }\n+\n+  // TODO: uncomment this line after fixing all broken links.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEzNzIzMg==", "bodyText": "(I don't know how to do this without changing field signature) but ideally this should be a lazy provider returning project.docroot. This would make it evaluation-order independent and would trigger input evaluation only if the task actually runs.\nJust a thought if you want to get deeper into gradle. ;)", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426137232", "createdAt": "2020-05-16T09:32:52Z", "author": {"login": "dweiss"}, "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn 'documentation'\n+    dependsOn subprojects.collect { prj ->\n+      prj.tasks.matching { task -> task.name == 'checkBrokenLinks'}\n+    }\n+  }\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn documentationLint\n+}\n+\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+  task checkBrokenLinks(type: CheckBrokenLinksTask)\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+  @Input\n+  File docsDir = project.docroot", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d1ced987568b0bc2a703c51d8ff5b25b3baa43"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e178c3feb3b5cb98364833001939e28037bc2c6", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/3e178c3feb3b5cb98364833001939e28037bc2c6", "committedDate": "2020-05-16T10:55:27Z", "message": "make check task depends on 'checkBrokenLinks'; lazily evaluate 'docroot' property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDcwNjYy", "url": "https://github.com/apache/lucene-solr/pull/1522#pullrequestreview-413070662", "createdAt": "2020-05-16T11:46:42Z", "commit": {"oid": "3e178c3feb3b5cb98364833001939e28037bc2c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxMTo0Njo0MlrOGWZ66w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxMTo0Njo0MlrOGWZ66w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NjUzOQ==", "bodyText": "I think that should just depend on the documentation task, so it can also check the index.html files and all other stuff.\nI think the python script will also find errors introduced by the markdown stuff. At least it did when I broke the ant task in #1477.\n#1477 is ready for review, once it is merged you can test more.", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426146539", "createdAt": "2020-05-16T11:46:42Z", "author": {"login": "uschindler"}, "path": "gradle/validation/documentation-lint.gradle", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task documentationLint {\n+    group 'Verification'\n+    description 'Verify all documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+}\n+\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  project.afterEvaluate {\n+    task checkBrokenLinks(type: CheckBrokenLinksTask) {\n+      docsDir = project.docroot\n+      dependsOn subprojects.collect { prj ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e178c3feb3b5cb98364833001939e28037bc2c6"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b689a58728e7113e50dd733c02fbb464cff1afd", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/9b689a58728e7113e50dd733c02fbb464cff1afd", "committedDate": "2020-05-17T13:17:15Z", "message": "Merge branch 'master' into jira/LUCENE-9374-check-broken-links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231f029658c60912f295685de928f086a0c0e5ba", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/231f029658c60912f295685de928f086a0c0e5ba", "committedDate": "2020-05-17T13:38:14Z", "message": "make 'checkBrokenLinks' depend on 'documentation'; get rid of top level 'documentationLint' task."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac195d147a3b7d25605ca98034028f9719913782", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/ac195d147a3b7d25605ca98034028f9719913782", "committedDate": "2020-05-18T13:43:55Z", "message": "use Provider to lazily evaluate docroot property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3", "committedDate": "2020-05-18T14:23:23Z", "message": "move script file path to @Input field."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzEwNjMw", "url": "https://github.com/apache/lucene-solr/pull/1522#pullrequestreview-413710630", "createdAt": "2020-05-18T15:35:58Z", "commit": {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNTo1OVrOGW8qcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNTo1OVrOGW8qcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc2MA==", "bodyText": "Should be @InputFile", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426715760", "createdAt": "2020-05-18T15:35:59Z", "author": {"login": "uschindler"}, "path": "gradle/validation/check-broken-links.gradle", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task checkBrokenLinks {\n+    group 'Verification'\n+    description 'Check broken links in the entire documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+\n+}\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation')\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn checkBrokenLinks\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+\n+  @Input", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzEwNzM1", "url": "https://github.com/apache/lucene-solr/pull/1522#pullrequestreview-413710735", "createdAt": "2020-05-18T15:36:08Z", "commit": {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNjowOFrOGW8qxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNjowOFrOGW8qxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTg0NA==", "bodyText": "same here", "url": "https://github.com/apache/lucene-solr/pull/1522#discussion_r426715844", "createdAt": "2020-05-18T15:36:08Z", "author": {"login": "uschindler"}, "path": "gradle/validation/check-broken-links.gradle", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+configure(rootProject) {\n+\n+  task checkBrokenLinks {\n+    group 'Verification'\n+    description 'Check broken links in the entire documentation'\n+\n+    dependsOn ':lucene:checkBrokenLinks'\n+    dependsOn ':solr:checkBrokenLinks'\n+  }\n+\n+}\n+configure(subprojects.findAll { it.path in [':lucene', ':solr'] }) {\n+\n+  task checkBrokenLinks(type: CheckBrokenLinksTask, 'dependsOn': 'documentation')\n+\n+  // TODO: uncomment this line after fixing all broken links.\n+  // (we can't fix the cross-project links until ant build is disabled.)\n+  // check.dependsOn checkBrokenLinks\n+}\n+\n+class CheckBrokenLinksTask extends DefaultTask {\n+\n+  @Input\n+  Provider<File> docsDir = project.providers.provider { project.docroot }\n+\n+  @Input", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "988f7db0c2e8c6f3c20e49e29220c3d2eca54bf3"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f280310accb06861d94800854ddafba11132ee4", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/5f280310accb06861d94800854ddafba11132ee4", "committedDate": "2020-05-19T00:58:19Z", "message": "Fix input annotations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45f381778e271a3b10ca663e8193254157b5e52a", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/45f381778e271a3b10ca663e8193254157b5e52a", "committedDate": "2020-05-19T01:09:24Z", "message": "make docsDir field final."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "778701c97120fbc2e6578a545d7719ac19d82d75", "author": {"user": {"login": "mocobeta", "name": "Tomoko Uchida"}}, "url": "https://github.com/apache/lucene-solr/commit/778701c97120fbc2e6578a545d7719ac19d82d75", "committedDate": "2020-05-19T12:04:55Z", "message": "use DirectoryProperty instead of directly having Provider"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2531, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}