{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjUxNjcx", "number": 1598, "title": "SOLR-14409: Existing violations allow bypassing policy rules when add\u2026", "bodyText": "", "createdAt": "2020-06-22T02:58:17Z", "url": "https://github.com/apache/lucene-solr/pull/1598", "merged": true, "mergeCommit": {"oid": "419560ef2a5a04ab9d77d3428459e1aa08253764"}, "closed": true, "closedAt": "2020-06-25T00:33:29Z", "author": {"login": "noblepaul"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctn11BAH2gAyNDM3NjUxNjcxOmE4ZTllNTc4OWJlYmE2ZmRjMzQ0ZDYxOGVkZjU5NjMxOGVmZDBiYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcujkcegH2gAyNDM3NjUxNjcxOmE5YzMzNzEwYTY2NjM3YjBhYTQ4NzdlMTc5Mzc5ZjdmOGFiZDlhMDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a8e9e5789beba6fdc344d618edf596318efd0bbc", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/a8e9e5789beba6fdc344d618edf596318efd0bbc", "committedDate": "2020-06-22T02:57:46Z", "message": "SOLR-14409: Existing violations allow bypassing policy rules when adding new replicas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTE0MDEx", "url": "https://github.com/apache/lucene-solr/pull/1598#pullrequestreview-435914011", "createdAt": "2020-06-23T15:43:13Z", "commit": {"oid": "a8e9e5789beba6fdc344d618edf596318efd0bbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTo0MzoxM1rOGnvWAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTo0MzoxM1rOGnvWAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyMzMyOQ==", "bodyText": "assertThat(exp.getMessage(), contains(\"...\"))", "url": "https://github.com/apache/lucene-solr/pull/1598#discussion_r444323329", "createdAt": "2020-06-23T15:43:13Z", "author": {"login": "madrob"}, "path": "solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy2.java", "diffHunk": "@@ -516,6 +517,16 @@ public void testInfiniteLoop() {\n     System.out.println(suggestions);\n   }\n \n+  public void testAddTooManyPerPolicy() {\n+    Map<String, Object> m = (Map<String, Object>) loadFromResource(\"testAddTooManyPerPolicy.json\");\n+    SolrCloudManager cloudManagerFromDiagnostics = createCloudManagerFromDiagnostics(m);\n+    AutoScalingConfig autoScalingConfig = new AutoScalingConfig((Map<String, Object>) getObjectByPath(m, false, \"diagnostics/config\"));\n+    SolrException exp =  expectThrows(SolrException.class, () -> PolicyHelper.getReplicaLocations(\"TooManyPerPolicy\", autoScalingConfig, cloudManagerFromDiagnostics,\n+            EMPTY_MAP, Collections.singletonList(\"shard1\"), 1, 0, 0, null));\n+    assertTrue(exp.getMessage().contains(\"No node can satisfy the rules\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8e9e5789beba6fdc344d618edf596318efd0bbc"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a966a4bf002f477eb58b8a38ada7c1205f183cb", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/2a966a4bf002f477eb58b8a38ada7c1205f183cb", "committedDate": "2020-06-24T12:58:43Z", "message": "SuppressWarnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "170f0f88b0b63fffc6b3c4b8d3c818cd8289c50c", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/170f0f88b0b63fffc6b3c4b8d3c818cd8289c50c", "committedDate": "2020-06-25T00:31:57Z", "message": "CHANGES.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9c33710a66637b0aa4877e179379f7f8abd9a03", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/a9c33710a66637b0aa4877e179379f7f8abd9a03", "committedDate": "2020-06-25T00:33:05Z", "message": "Merge branch 'master' into jira/solr14409"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2648, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}