{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwOTgzMDI0", "number": 1624, "title": "use MethodHandles in AnnotatedAPI", "bodyText": "@uschindler Please review", "createdAt": "2020-06-28T01:07:40Z", "url": "https://github.com/apache/lucene-solr/pull/1624", "merged": true, "mergeCommit": {"oid": "20c1fdbf7e4573948434cfa82e1f7b0fc4d54b31"}, "closed": true, "closedAt": "2020-06-30T12:40:27Z", "author": {"login": "noblepaul"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvh1fcgH2gAyNDQwOTgzMDI0OjhjZjhlMTNkMTMwMTU0NDVlZmJiYjVhOTFhNmI1ZmY3NWM0NjYyODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwU_IJAFqTQzOTk3MjU1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/8cf8e13d13015445efbbb5a91a6b5ff75c466281", "committedDate": "2020-06-28T01:05:49Z", "message": "use MethodHandles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzM4ODI1", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-438738825", "createdAt": "2020-06-28T02:55:39Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMjo1NTozOVrOGp52mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMjo1NTozOVrOGp52mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MjY2NQ==", "bodyText": "Catching Throwable is generally something to avoid.  Why here do you think it makes sense?", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r446592665", "createdAt": "2020-06-28T02:55:39Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -306,7 +313,7 @@ void invoke(SolrQueryRequest req, SolrQueryResponse rsp, CommandOperation cmd) {\n       } catch (InvocationTargetException ite) {\n         log.error(\"Error executing command \", ite);\n         throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, ite.getCause());\n-      } catch (Exception e) {\n+      } catch (Throwable e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzYwNjQ2", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-438760646", "createdAt": "2020-06-28T09:07:01Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOTowNzowMVrOGp7wag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOTowNzowMVrOGp7wag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyMzg1MA==", "bodyText": "You obviously meant theClass.getName() here and not klas.getName().", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r446623850", "createdAt": "2020-06-28T09:07:01Z", "author": {"login": "murblanc"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -87,16 +88,18 @@ public EndPoint getEndPoint() {\n   public static List<Api> getApis(Object obj) {\n     return getApis(obj.getClass(), obj);\n   }\n-  public static List<Api> getApis(Class<? extends Object> klas , Object obj) {\n-    if (!Modifier.isPublic(klas.getModifiers())) {\n-      throw new RuntimeException(klas.getName() + \" is not public\");\n+  public static List<Api> getApis(Class<? extends Object> theClass , Object obj)  {\n+    Class<?> klas = null;\n+    try {\n+      klas = MethodHandles.publicLookup().accessClass(theClass);\n+    } catch (IllegalAccessException e) {\n+      throw new RuntimeException(klas.getName() + \" is not public\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzYxNjIy", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-438761622", "createdAt": "2020-06-28T09:19:01Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOToxOTowMVrOGp71pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOToxOTowMVrOGp71pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyNTE5MQ==", "bodyText": "Lets throw SolrException here.", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r446625191", "createdAt": "2020-06-28T09:19:01Z", "author": {"login": "chatman"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -225,7 +228,11 @@ public void call(SolrQueryRequest req, SolrQueryResponse rsp) {\n       if (Modifier.isPublic(method.getModifiers())) {\n         this.command = command;\n         this.obj = obj;\n-        this.method = method;\n+        try {\n+          this.method = MethodHandles.publicLookup().unreflect(method);\n+        } catch (IllegalAccessException e) {\n+          throw new RuntimeException(\"Unable to unlookup method\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzYzMTY2", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-438763166", "createdAt": "2020-06-28T09:38:35Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOTozODozNlrOGp79ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwOTozODozNlrOGp79ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyNzIxMA==", "bodyText": "Is this still needed? Wouldn't MethodHandles.publicLookup().accessClass(theClass) only return public methods?", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r446627210", "createdAt": "2020-06-28T09:38:36Z", "author": {"login": "murblanc"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -113,7 +116,7 @@ public EndPoint getEndPoint() {\n       return Collections.singletonList(new AnnotatedApi(specProvider, endPoint, commands, null));\n     } else {\n       List<Api> apis = new ArrayList<>();\n-      for (Method m : klas.getDeclaredMethods()) {\n+      for (Method m : klas.getMethods()) {\n         EndPoint endPoint = m.getAnnotation(EndPoint.class);\n         if (endPoint == null) continue;\n         if (!Modifier.isPublic(m.getModifiers())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzY5NzMz", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-438769733", "createdAt": "2020-06-28T11:04:54Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDMzNTQw", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-439033540", "createdAt": "2020-06-29T11:12:50Z", "commit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMToxMjo1MFrOGqMAMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMToxMjo1MFrOGqMAMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg5MDAzMw==", "bodyText": "This catch block can go away!", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r446890033", "createdAt": "2020-06-29T11:12:50Z", "author": {"login": "uschindler"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -306,7 +313,7 @@ void invoke(SolrQueryRequest req, SolrQueryResponse rsp, CommandOperation cmd) {\n       } catch (InvocationTargetException ite) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf8e13d13015445efbbb5a91a6b5ff75c466281"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "330dd5398ff3226c58083d8c3e3e0332ed162f66", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/330dd5398ff3226c58083d8c3e3e0332ed162f66", "committedDate": "2020-06-30T08:01:17Z", "message": "Implementing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7184bffc9d0e227f66d36fd7d771f3e57824cf", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/1a7184bffc9d0e227f66d36fd7d771f3e57824cf", "committedDate": "2020-06-30T08:03:21Z", "message": "implement review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ebf59a01a54ce416577bb82792f39c3adda59e", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/c2ebf59a01a54ce416577bb82792f39c3adda59e", "committedDate": "2020-06-30T12:01:23Z", "message": "Implementing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c160be57ffbb580d78ea5b435664585c564ae40", "author": {"user": {"login": "noblepaul", "name": "Noble Paul"}}, "url": "https://github.com/apache/lucene-solr/commit/7c160be57ffbb580d78ea5b435664585c564ae40", "committedDate": "2020-06-30T12:21:08Z", "message": "precommit errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5OTcyNTU4", "url": "https://github.com/apache/lucene-solr/pull/1624#pullrequestreview-439972558", "createdAt": "2020-06-30T12:41:22Z", "commit": {"oid": "7c160be57ffbb580d78ea5b435664585c564ae40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjo0MToyMlrOGq6ckw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMjo0MToyMlrOGq6ckw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1MDk2Mw==", "bodyText": "this should be declared final and not nulled.", "url": "https://github.com/apache/lucene-solr/pull/1624#discussion_r447650963", "createdAt": "2020-06-30T12:41:22Z", "author": {"login": "uschindler"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -87,16 +83,18 @@ public EndPoint getEndPoint() {\n   public static List<Api> getApis(Object obj) {\n     return getApis(obj.getClass(), obj);\n   }\n-  public static List<Api> getApis(Class<? extends Object> klas , Object obj) {\n-    if (!Modifier.isPublic(klas.getModifiers())) {\n-      throw new RuntimeException(klas.getName() + \" is not public\");\n+  public static List<Api> getApis(Class<? extends Object> theClass , Object obj)  {\n+    Class<?> klas = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c160be57ffbb580d78ea5b435664585c564ae40"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2436, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}