{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3OTM4MDIy", "number": 2069, "title": "LUCENE-9378: Make it possible to configure how to trade speed for compression on doc values.", "bodyText": "This adds a switch to Lucene80DocValuesFormat which allows to\nconfigure whether to prioritize retrieval speed over compression ratio\nor the other way around. When prioritizing retrieval speed, binary doc\nvalues are written using the exact same format as before more aggressive\ncompression got introduced.", "createdAt": "2020-11-09T17:57:35Z", "url": "https://github.com/apache/lucene-solr/pull/2069", "merged": true, "mergeCommit": {"oid": "06877b2c6e47bc481a79d7bedd8ea4fb099f1b4c"}, "closed": true, "closedAt": "2020-11-12T15:10:00Z", "author": {"login": "jpountz"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda4f87gH2gAyNTE3OTM4MDIyOjQ3MjUyZTVhMDFmMjA1Mzc1ODJlNGQyNzc1NzYxYWEwZWJmNTBkYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbztxwgFqTUyOTE1OTgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47252e5a01f20537582e4d2775761aa0ebf50db5", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/47252e5a01f20537582e4d2775761aa0ebf50db5", "committedDate": "2020-11-09T17:48:51Z", "message": "LUCENE-9378: Make it possible to configure how to trade speed for compression on doc values.\n\nThis adds a switch to `Lucene80DocValuesFormat` which allows to\nconfigure whether to prioritize retrieval speed over compression ratio\nor the other way around. When prioritizing retrieval speed, binary doc\nvalues are written using the exact same format as before more aggressive\ncompression got introduced."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/c54f2ce667bfeee72b2d5b386b7f50557dcf8564", "committedDate": "2020-11-09T17:58:24Z", "message": "CHANGES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a30f4b5e4d58065d99e380085862ddf4032fd6f", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/0a30f4b5e4d58065d99e380085862ddf4032fd6f", "committedDate": "2020-11-09T18:31:30Z", "message": "iter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTMwODU5", "url": "https://github.com/apache/lucene-solr/pull/2069#pullrequestreview-526530859", "createdAt": "2020-11-09T18:22:26Z", "commit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyMjoyNlrOHv7suw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyNToyN1rOHv7zvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzIyNw==", "bodyText": "Nice!  So we roll up the tradeoffs to Codec level which will then tell each format how to tradeoff.", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520023227", "createdAt": "2020-11-09T18:22:26Z", "author": {"login": "mikemccand"}, "path": "lucene/backward-codecs/src/java/org/apache/lucene/backward_codecs/lucene87/Lucene87Codec.java", "diffHunk": "@@ -56,6 +57,23 @@\n  * @lucene.experimental\n  */\n public class Lucene87Codec extends Codec {\n+\n+  /** Configuration option for the codec. */\n+  public static enum Mode {\n+    /** Trade compression ratio for retrieval speed. */\n+    BEST_SPEED(Lucene87StoredFieldsFormat.Mode.BEST_SPEED, Lucene80DocValuesFormat.Mode.BEST_SPEED),\n+    /** Trade retrieval speed for compression ratio. */\n+    BEST_COMPRESSION(Lucene87StoredFieldsFormat.Mode.BEST_COMPRESSION, Lucene80DocValuesFormat.Mode.BEST_COMPRESSION);\n+\n+    private final Lucene87StoredFieldsFormat.Mode storedMode;\n+    private final Lucene80DocValuesFormat.Mode dvMode;\n+\n+    private Mode(Lucene87StoredFieldsFormat.Mode storedMode, Lucene80DocValuesFormat.Mode dvMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNDYzNA==", "bodyText": "Will this randomize between the different Mode tradeoffs?", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520024634", "createdAt": "2020-11-09T18:24:51Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/BaseLucene80DocValuesFormatTestCase.java", "diffHunk": "@@ -286,7 +278,7 @@ private void doTestTermsEnumRandom(int numDocs, Supplier<String> valuesProducer)\n     conf.setMergeScheduler(new SerialMergeScheduler());\n     // set to duel against a codec which has ordinals:\n     final PostingsFormat pf = TestUtil.getPostingsFormatWithOrds(random());\n-    final DocValuesFormat dv = new Lucene80DocValuesFormat();\n+    final DocValuesFormat dv = getCodec().docValuesFormat();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNTAyMQ==", "bodyText": "Do we also have a dedicated TestBestCompressedLucene80DocValuesFormat?", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520025021", "createdAt": "2020-11-09T18:25:27Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/TestBestSpeedLucene80DocValuesFormat.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.lucene.codecs.lucene80;\n+\n+import org.apache.lucene.codecs.Codec;\n+import org.apache.lucene.util.TestUtil;\n+\n+/**\n+ * Tests Lucene80DocValuesFormat\n+ */\n+public class TestBestSpeedLucene80DocValuesFormat extends BaseLucene80DocValuesFormatTestCase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTcyNTUy", "url": "https://github.com/apache/lucene-solr/pull/2069#pullrequestreview-526572552", "createdAt": "2020-11-09T19:11:09Z", "commit": {"oid": "0a30f4b5e4d58065d99e380085862ddf4032fd6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94b45406b0f2648e2fcee37b2a6bf3be19be36c2", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/94b45406b0f2648e2fcee37b2a6bf3be19be36c2", "committedDate": "2020-11-10T09:50:26Z", "message": "Merge branch 'master' into lucene9378"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cdd7a1ada1ea787df0e1b3551abf6e43e6c9657", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/8cdd7a1ada1ea787df0e1b3551abf6e43e6c9657", "committedDate": "2020-11-10T16:10:44Z", "message": "Improve codec randomization."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65bb945cff0d2e9731c277a9c13f3824bbebd037", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/65bb945cff0d2e9731c277a9c13f3824bbebd037", "committedDate": "2020-11-10T16:23:32Z", "message": "iter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTEyMDIy", "url": "https://github.com/apache/lucene-solr/pull/2069#pullrequestreview-527512022", "createdAt": "2020-11-10T18:52:59Z", "commit": {"oid": "8cdd7a1ada1ea787df0e1b3551abf6e43e6c9657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aca71f04669d285ac400cf466188980c20fa1b4", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/apache/lucene-solr/commit/6aca71f04669d285ac400cf466188980c20fa1b4", "committedDate": "2020-11-12T08:11:45Z", "message": "iter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTU5ODMw", "url": "https://github.com/apache/lucene-solr/pull/2069#pullrequestreview-529159830", "createdAt": "2020-11-12T14:48:21Z", "commit": {"oid": "6aca71f04669d285ac400cf466188980c20fa1b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2585, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}