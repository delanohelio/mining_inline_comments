{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzOTg3ODAz", "number": 1317, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNzowMzo0OVrODnKmUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTozNzozNFrODoBe8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMzk0NzA2OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/store/shared/metadata/SharedShardMetadataController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNzowMzo0OVrOF1AVmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNzowMzo0OVrOF1AVmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyNDM3Ng==", "bodyText": "Wouldn't it be more appropriate to call it createMetadataNode and fail in case the node already exists?", "url": "https://github.com/apache/lucene-solr/pull/1317#discussion_r391124376", "createdAt": "2020-03-11T17:03:49Z", "author": {"login": "mbwaheed"}, "path": "solr/core/src/java/org/apache/solr/store/shared/metadata/SharedShardMetadataController.java", "diffHunk": "@@ -53,12 +53,12 @@ public SharedShardMetadataController(SolrCloudManager cloudManager) {\n   \n   /**\n    * Creates a new metadata node if it doesn't exist for shared shared index whose correctness metadata \n-   * is managed by ZooKeeper\n+   * is managed by ZooKeeper. This node should only be created during Shard creation or Recovery events\n    *  \n    * @param collectionName name of the collection that needs a metadata node\n    * @param shardName name of the shard that needs a metadata node\n    */\n-  public void ensureMetadataNodeExists(String collectionName, String shardName) throws IOException {\n+  public void initiateMetadataNode(String collectionName, String shardName) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de74c5f001aeae6859c58a3d9aa14d819ec569e9"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMjkzMzgyOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/store/shared/metadata/SharedShardMetadataController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMToyODozMFrOF2XA2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMToyODozMFrOF2XA2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU0NDQ3Mw==", "bodyText": "#makePath will also throw an AlreadyExistsException if the node exists and failOnExists=true", "url": "https://github.com/apache/lucene-solr/pull/1317#discussion_r392544473", "createdAt": "2020-03-14T01:28:30Z", "author": {"login": "andyvuong"}, "path": "solr/core/src/java/org/apache/solr/store/shared/metadata/SharedShardMetadataController.java", "diffHunk": "@@ -146,20 +148,18 @@ public void cleanUpMetadataNodes(String collectionName, String shardName) {\n     }\n   }\n \n-  private void createPersistentNodeIfNonExistent(String path, byte[] data) {\n+  private void createPersistentNode(String path, byte[] data) {\n     try {\n       if (!stateManager.hasData(path)) {\n-        try {\n-          stateManager.makePath(path, data, CreateMode.PERSISTENT, /* failOnExists */ false);\n-        } catch (AlreadyExistsException e) {\n-          // it's okay if another beats us creating the node\n-        }\n+        stateManager.makePath(path, data, CreateMode.PERSISTENT, /* failOnExists */ true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f30bc90e2a9c93a5a54c5c7ea4a4a27dc5e74a8"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMjkzOTM3OnYy", "diffSide": "RIGHT", "path": "solr/core/src/test/org/apache/solr/store/shared/metadata/SharedShardMetadataControllerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTozNzozNFrOF2XDvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTozNzozNFrOF2XDvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU0NTIxNA==", "bodyText": "few typos.", "url": "https://github.com/apache/lucene-solr/pull/1317#discussion_r392545214", "createdAt": "2020-03-14T01:37:34Z", "author": {"login": "mbwaheed"}, "path": "solr/core/src/test/org/apache/solr/store/shared/metadata/SharedShardMetadataControllerTest.java", "diffHunk": "@@ -77,10 +77,26 @@ public void cleanup() throws Exception {\n    */\n   @Test\n   public void testSetupMetadataNode() throws Exception {    \n-    shardMetadataController.ensureMetadataNodeExists(TEST_COLLECTION_NAME, TEST_SHARD_NAME);\n+    shardMetadataController.createMetadataNode(TEST_COLLECTION_NAME, TEST_SHARD_NAME);\n     assertTrue(cluster.getZkClient().exists(metadataNodePath, false));\n   }\n   \n+  /**\n+   * Test if we try to create the same metadat anode twice, we faile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f30bc90e2a9c93a5a54c5c7ea4a4a27dc5e74a8"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 845, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}