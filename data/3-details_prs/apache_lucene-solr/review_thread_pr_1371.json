{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxODM4OTc3", "number": 1371, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo1MDo0MVrODqYspw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzozNToyM1rOElMjEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzcxNDMxOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo1MDo0MVrOF6GScw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NzowNVrOF6zxIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NDc1NQ==", "bodyText": "shouldn't we include type?", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396464755", "createdAt": "2020-03-23T13:50:41Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -184,6 +184,11 @@ public boolean equals(final Object other) {\n     public int hashCode() {\n       return 17 * (31 + selectorText.hashCode()) * (31 + type.hashCode());\n     }\n+\n+    @Override\n+    public String toString(){\n+      return selectorText;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTg5MQ==", "bodyText": "Added type too", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397209891", "createdAt": "2020-03-24T14:47:05Z", "author": {"login": "gunasekhardora"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -184,6 +184,11 @@ public boolean equals(final Object other) {\n     public int hashCode() {\n       return 17 * (31 + selectorText.hashCode()) * (31 + type.hashCode());\n     }\n+\n+    @Override\n+    public String toString(){\n+      return selectorText;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NDc1NQ=="}, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzcxNjI4OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo1MToxMVrOF6GTqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NzoxNFrOF6zxpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTA2NQ==", "bodyText": "Maybe add curly braces for beginning and end", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396465065", "createdAt": "2020-03-23T13:51:11Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDAyMg==", "bodyText": "Added them", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397210022", "createdAt": "2020-03-24T14:47:14Z", "author": {"login": "gunasekhardora"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTA2NQ=="}, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzcxOTYyOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzo1MTo1NlrOF6GVsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NzoyMVrOF6zyDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTU4Nw==", "bodyText": "check if converting them enum makes it cleaner", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r396465587", "createdAt": "2020-03-23T13:51:56Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + getNullPolicyString(this.nullPolicy) +\n+          \", groupHeadSelector=\" + this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size;\n+    }\n+\n+    private String getNullPolicyString(int nullPolicy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDEyNg==", "bodyText": "Converted this to enum", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r397210126", "createdAt": "2020-03-24T14:47:21Z", "author": {"login": "gunasekhardora"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -276,7 +281,19 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + getNullPolicyString(this.nullPolicy) +\n+          \", groupHeadSelector=\" + this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size;\n+    }\n+\n+    private String getNullPolicyString(int nullPolicy) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ2NTU4Nw=="}, "originalCommit": {"oid": "044b0a83b7b1bfe57968ea5c0b9a35c8b1709b7c"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzY1NDkwOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNToxNDozMlrOGLcgzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMTowNjoyNlrOGPHUOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY1NDY3MA==", "bodyText": "These constants can be removed and everything routed through the NullPolicy enum. Same for the NULL_COLLAPSE string above and others.", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r414654670", "createdAt": "2020-04-24T15:14:32Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -218,7 +245,7 @@ public static GroupHeadSelector build(final SolrParams localParams) {\n     public String hint;\n     private boolean needsScores = true;\n     private boolean needsScores4Collapsing = false;\n-    private int nullPolicy;\n+    private NullPolicy nullPolicy;\n     private Set<BytesRef> boosted; // ordered by \"priority\"\n     public static final int NULL_POLICY_IGNORE = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9543abeaca92db78c55a9058a07cbbc1b2c048ac"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUwMTY5MQ==", "bodyText": "@madrob Missed your comment somehow. Added the change that you have suggested. Can you please review this now?", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418501691", "createdAt": "2020-05-01T11:06:26Z", "author": {"login": "gunasekhardora"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -218,7 +245,7 @@ public static GroupHeadSelector build(final SolrParams localParams) {\n     public String hint;\n     private boolean needsScores = true;\n     private boolean needsScores4Collapsing = false;\n-    private int nullPolicy;\n+    private NullPolicy nullPolicy;\n     private Set<BytesRef> boosted; // ordered by \"priority\"\n     public static final int NULL_POLICY_IGNORE = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY1NDY3MA=="}, "originalCommit": {"oid": "9543abeaca92db78c55a9058a07cbbc1b2c048ac"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTQyODc2OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMDoxNToyOVrOGPUjUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzo0OTowOFrOHUjqdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng==", "bodyText": "Can we get rid of the earlier String declarations too? Lines 125-127?", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418718546", "createdAt": "2020-05-01T20:15:29Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -128,6 +128,28 @@ field collapsing (with ngroups) when the number of distinct groups\n   public static final String HINT_TOP_FC = \"top_fc\";\n   public static final String HINT_MULTI_DOCVALUES = \"multi_docvalues\";\n \n+  public enum NullPolicy {\n+    IGNORE(\"ignore\", 0),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05c53497ae5be967b26f998fcd4eeeb160a20c6d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjQ2OA==", "bodyText": "@madrob Removed them. Added an unit test to validate if null policy is an illegal argument as well.", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r418926468", "createdAt": "2020-05-02T07:40:47Z", "author": {"login": "gunasekhardora"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -128,6 +128,28 @@ field collapsing (with ngroups) when the number of distinct groups\n   public static final String HINT_TOP_FC = \"top_fc\";\n   public static final String HINT_MULTI_DOCVALUES = \"multi_docvalues\";\n \n+  public enum NullPolicy {\n+    IGNORE(\"ignore\", 0),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng=="}, "originalCommit": {"oid": "05c53497ae5be967b26f998fcd4eeeb160a20c6d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxNzg3OA==", "bodyText": "I agree with @madrob about removing the unused declarations but as access the public for these variables. I think we should deprecate it in this PR(for 8x) and remove it in different PR\nwdyt?", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491317878", "createdAt": "2020-09-19T07:49:08Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -128,6 +128,28 @@ field collapsing (with ngroups) when the number of distinct groups\n   public static final String HINT_TOP_FC = \"top_fc\";\n   public static final String HINT_MULTI_DOCVALUES = \"multi_docvalues\";\n \n+  public enum NullPolicy {\n+    IGNORE(\"ignore\", 0),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODU0Ng=="}, "originalCommit": {"oid": "05c53497ae5be967b26f998fcd4eeeb160a20c6d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3NDM3NzgzOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzozMjoxOFrOHUjVvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzozMjoxOFrOHUjVvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMjU3Mw==", "bodyText": "would it be better to include the class name too here?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return \"groupHeadSelectorText=\" +this.selectorText + \", groupHeadSelectorType=\" +this.type;\n          \n          \n            \n                  return \"GroupHeadSelector[selectorText=\" +this.selectorText + \", type=\" +this.type + \"]\";", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491312573", "createdAt": "2020-09-19T07:32:18Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -188,6 +206,11 @@ public int hashCode() {\n       return 17 * (31 + selectorText.hashCode()) * (31 + type.hashCode());\n     }\n \n+    @Override\n+    public String toString(){\n+      return \"groupHeadSelectorText=\" +this.selectorText + \", groupHeadSelectorType=\" +this.type;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "596f130fc07d9cb5edc0de3d9dabbfb802310d60"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3NDM4MzUyOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzozNToyM1rOHUjZRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwNzo0NToyN1rOHUjmCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMzQ3OA==", "bodyText": "{!collapse specifies the query parser, I think we shouldn't include it in toString()\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return \"{!collapse field=\" + this.collapseField +\n          \n          \n            \n                      \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n          \n          \n            \n                      this.groupHeadSelector.toString() +\n          \n          \n            \n                      (hint == null ? \"\": \", hint=\" + this.hint) +\n          \n          \n            \n                      \", size=\" + this.size\n          \n          \n            \n                      + \"}\";\n          \n          \n            \n                  return \"CollapsingPostFilter[field=\" + this.collapseField +\n          \n          \n            \n                      \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n          \n          \n            \n                      this.groupHeadSelector +\n          \n          \n            \n                      (hint == null ? \"\": \", hint=\" + this.hint) +\n          \n          \n            \n                      \", size=\" + this.size\n          \n          \n            \n                      + \"]\";", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491313478", "createdAt": "2020-09-19T07:35:23Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -279,7 +299,12 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"{!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n+          this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size\n+          + \"}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "596f130fc07d9cb5edc0de3d9dabbfb802310d60"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxNjc0NQ==", "bodyText": "The above suggestion might lead cause this in debug response\nCollapsingPostFilter([CollapsingPostFilter field=id, nullPolicy=expand, GroupHeadSelector[selectorText=_version_ asc, type=SORT], hint=top_fc, size=5000])\n\n\nThis is caused due to how Query is converted to String by QueryParsing Class but I think that should be handled separately as issue exists for different query type\n\n  \n    \n      lucene-solr/solr/core/src/java/org/apache/solr/search/QueryParsing.java\n    \n    \n         Line 336\n      in\n      ab3f1f0\n    \n    \n    \n    \n\n        \n          \n           out.append(query.getClass().getSimpleName()).append('(').append(query.toString()).append(')');", "url": "https://github.com/apache/lucene-solr/pull/1371#discussion_r491316745", "createdAt": "2020-09-19T07:45:27Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java", "diffHunk": "@@ -279,7 +299,12 @@ public int getCost() {\n     }\n \n     public String toString(String s) {\n-      return s;\n+      return \"{!collapse field=\" + this.collapseField +\n+          \", nullPolicy=\" + this.nullPolicy.getName() + \", \" +\n+          this.groupHeadSelector.toString() +\n+          (hint == null ? \"\": \", hint=\" + this.hint) +\n+          \", size=\" + this.size\n+          + \"}\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMxMzQ3OA=="}, "originalCommit": {"oid": "596f130fc07d9cb5edc0de3d9dabbfb802310d60"}, "originalPosition": 78}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 887, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}