{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NDgzMTcz", "number": 2065, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNDozMzoyNFrOE2akyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjozMjoyMlrOE3r1YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDkzOTYwOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNDozMzoyNFrOHvM0fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQyMjozNjo1NVrOHva-QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTE2Ng==", "bodyText": "This is super fragile and fails if we have Widget implements ConfigurablePlugin<WidgetInfo> and then NewerWidget extends Widget", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519255166", "createdAt": "2020-11-08T04:33:24Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -372,9 +396,27 @@ public void init() throws Exception {\n         holders.add(new ApiHolder((AnnotatedApi) api));\n       }\n     }\n+\n+    @SuppressWarnings(\"rawtypes\")\n+    private Class getConfigObj(Object o) {\n+      Type[] interfaces = o.getClass().getGenericInterfaces();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NzA0MQ==", "bodyText": "fixed", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519487041", "createdAt": "2020-11-08T22:36:55Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -372,9 +396,27 @@ public void init() throws Exception {\n         holders.add(new ApiHolder((AnnotatedApi) api));\n       }\n     }\n+\n+    @SuppressWarnings(\"rawtypes\")\n+    private Class getConfigObj(Object o) {\n+      Type[] interfaces = o.getClass().getGenericInterfaces();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTE2Ng=="}, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDkzOTk1OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNDozMzo0OVrOHvM0pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQyMzo1MDo1MVrOHvbgcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTIwNw==", "bodyText": "At the very least, don't suppress raw types here.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519255207", "createdAt": "2020-11-08T04:33:49Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -372,9 +396,27 @@ public void init() throws Exception {\n         holders.add(new ApiHolder((AnnotatedApi) api));\n       }\n     }\n+\n+    @SuppressWarnings(\"rawtypes\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ5NTc5Mw==", "bodyText": "it's not required", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519495793", "createdAt": "2020-11-08T23:50:51Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -372,9 +396,27 @@ public void init() throws Exception {\n         holders.add(new ApiHolder((AnnotatedApi) api));\n       }\n     }\n+\n+    @SuppressWarnings(\"rawtypes\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTIwNw=="}, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDk0MjE0OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNDozNzoxMVrOHvM1lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQyMjoxMzowMlrOHvaz-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTQ0Ng==", "bodyText": "Does T need to extend PluginMeta as you do in the unit test or no?", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519255446", "createdAt": "2020-11-08T04:37:11Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.solr.api;\n+\n+/**Implement this interface if your plugin needs to accept some configuration\n+ * \n+ * @param <T> the configuration Object type\n+ */\n+public interface ConfigurablePlugin<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NDQxMA==", "bodyText": "No,it does not have to. I did it to make writing the test easy", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519484410", "createdAt": "2020-11-08T22:13:02Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.solr.api;\n+\n+/**Implement this interface if your plugin needs to accept some configuration\n+ * \n+ * @param <T> the configuration Object type\n+ */\n+public interface ConfigurablePlugin<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTQ0Ng=="}, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDk0MjIxOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNDozNzozMlrOHvM1oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQyMjoxNDozMVrOHva0ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTQ1Ng==", "bodyText": "Is this a security risk? Why do we need this?", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519255456", "createdAt": "2020-11-08T04:37:32Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -69,7 +72,8 @@\n public class ContainerPluginsRegistry implements ClusterPropertiesListener, MapWriter, Closeable {\n   private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n \n-  private final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper();\n+  private static final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper()\n+      .configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NDU3NA==", "bodyText": "This is not a security risk. In general it's better to ignore extra attributes for backcompat. Imagine adding an extra attribute to your plugin in a newer version and old Solr nodes failing because of that", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r519484574", "createdAt": "2020-11-08T22:14:31Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -69,7 +72,8 @@\n public class ContainerPluginsRegistry implements ClusterPropertiesListener, MapWriter, Closeable {\n   private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n \n-  private final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper();\n+  private static final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper()\n+      .configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1NTQ1Ng=="}, "originalCommit": {"oid": "b59e29d90f585b8a8f2ee8d3dfd2a36ca968d075"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk0ODQ1OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToxNToyOFrOHwX0DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToxNToyOFrOHwX0DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4Mzg1Mw==", "bodyText": "Maybe configure(T cfg)? the current name looks awkward.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520483853", "createdAt": "2020-11-10T11:15:28Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.solr.api;\n+\n+/**Implement this interface if your plugin needs to accept some configuration\n+ * \n+ * @param <T> the configuration Object type\n+ */\n+public interface ConfigurablePlugin<T> {\n+\n+  /**This is invoked soon after the Object is initialized\n+   * \n+   * @param cfg value deserialized from JSON\n+   */\n+  void initConfig(T cfg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk1NzYzOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToxNzo1OFrOHwX51w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToxNzo1OFrOHwX51w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NTMzNQ==", "bodyText": "ObjectMapper is a relatively heavy object, we should not create new instances in every class that needs it - maybe put a common instance somewhere in Utils?", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520485335", "createdAt": "2020-11-10T11:17:58Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -222,7 +223,8 @@ public void call(SolrQueryRequest req, SolrQueryResponse rsp) {\n     final String command;\n     final MethodHandle method;\n     final Object obj;\n-    ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper();\n+    ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk2NDE5OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToxOTo0M1rOHwX9yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMjoyMTo0OVrOHz7VuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA==", "bodyText": "Does PluginMeta still need a separate pathPrefix? I think this could become a config property.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520486344", "createdAt": "2020-11-10T11:19:43Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNjEyMw==", "bodyText": "It's a standard property , that is a part of the plugin definition", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520936123", "createdAt": "2020-11-10T23:19:18Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyMzM2Mw==", "bodyText": "It made sense when all plugins were request handlers, which is no longer true. In case of plugins that are not handlers a \"standard\" pathPrefix property doesn't make sense.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521323363", "createdAt": "2020-11-11T12:27:44Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwODA2Mg==", "bodyText": "PluginMeta is the information used by the framework. It's optional, so your plugin can choose to ignore it", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521708062", "createdAt": "2020-11-11T23:44:16Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzOTcyMg==", "bodyText": "I know that I can ignore it - my point was that this property is a relic of the time when we allowed only Api handlers as plugins. Now when non-Api plugins are first-class citizens half of the time this property doesn't make sense because it's specific only to Api plugins - so it should not be exposed as a standard property for all plugins.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r522039722", "createdAt": "2020-11-12T11:35:00Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA4OTA0OQ==", "bodyText": "It can be a specific sub-class of PluginMeta say EndPointPluginMeta .\nHowever, that change does not belong here", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r524089049", "createdAt": "2020-11-16T10:28:43Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIxMTY0MA==", "bodyText": "Let's make it a sub-class.\n(I would argue that it belongs in this PR because it's a part of the configuration mechanism for the plugins that this PR defines. Since we are adding a flexible config bean it doesn't make sense to still keep the old primitive field. And you can always ADD fields in subclasses but removing them is much harder... ;) )", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r524211640", "createdAt": "2020-11-16T12:21:49Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -114,6 +118,16 @@ public synchronized ApiInfo getPlugin(String name) {\n     return currentPlugins.get(name);\n   }\n \n+  static class PluginMetaHolder {\n+    private final Map<String, Object> original;\n+    private final PluginMeta meta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjM0NA=="}, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk2NTkwOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMDoxM1rOHwX-2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMDoxM1rOHwX-2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjYxNg==", "bodyText": "Whitespace.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520486616", "createdAt": "2020-11-10T11:20:13Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -349,7 +365,7 @@ public ApiInfo(PluginMeta info, List<String> errs) {\n       }\n     }\n \n-    @SuppressWarnings({\"rawtypes\"})\n+    @SuppressWarnings({\"rawtypes\",\"unchecked\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk2NjUxOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMDoyMlrOHwX_Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMDoyMlrOHwX_Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4NjcwNw==", "bodyText": "Whitespace.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520486707", "createdAt": "2020-11-10T11:20:22Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ContainerPluginsRegistry.java", "diffHunk": "@@ -360,6 +376,14 @@ public void init() throws Exception {\n       } else {\n         throw new RuntimeException(\"Must have a no-arg constructor or CoreContainer constructor \");\n       }\n+      if (instance instanceof ConfigurablePlugin) {\n+        Class c = getConfigClass((ConfigurablePlugin<?>) instance);\n+        if(c != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mjk3NjgxOnYy", "diffSide": "RIGHT", "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMzoxNVrOHwYFiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyMzoxNVrOHwYFiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4ODMzMQ==", "bodyText": "This example may be confusing because in general case configuration classes don't have to subclass PluginMeta. I propose removing this subclassing here to make it clear that's the case.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r520488331", "createdAt": "2020-11-10T11:23:15Z", "author": {"login": "sigram"}, "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "diffHunk": "@@ -312,6 +340,45 @@ public void testApiFromPackage() throws Exception {\n     }\n   }\n \n+  public static class CC1 extends CC {\n+\n+  }\n+  public static class CC2 extends CC1 {\n+\n+  }\n+  public static class CC implements ConfigurablePlugin<CConfig> {\n+    private CConfig cfg;\n+\n+\n+\n+    @Override\n+    public void initConfig(CConfig cfg) {\n+      this.cfg = cfg;\n+\n+    }\n+\n+    @EndPoint(method = GET,\n+        path = \"/hello/plugin\",\n+        permission = PermissionNameProvider.Name.READ_PERM)\n+    public void m2(SolrQueryRequest req, SolrQueryResponse rsp) {\n+      rsp.add(\"config\", cfg);\n+    }\n+\n+  }\n+\n+  public static class CConfig extends PluginMeta {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196d610783315930963558963eedfdc1ca1df252"}, "originalPosition": 222}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODIyODc1OnYy", "diffSide": "RIGHT", "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjoyNToyN1rOHxK-yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMToyNjozN1rOHx2fLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyMjE4NA==", "bodyText": "I don't understand this change. Do all config beans have to implement ReflectMapWriter?\nIf that's the case, and all config beans have to implement ReflectMapWriter then that's what the generic type in ConfigurablePlugin should use. If not then this test is misleading again because it suggests you have to implement additional interfaces to have a usable config bean.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521322184", "createdAt": "2020-11-11T12:25:27Z", "author": {"login": "sigram"}, "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "diffHunk": "@@ -366,7 +381,7 @@ public void m2(SolrQueryRequest req, SolrQueryResponse rsp) {\n \n   }\n \n-  public static class CConfig extends PluginMeta {\n+  public static class CConfig implements ReflectMapWriter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwNzY1Mw==", "bodyText": "All beans must implement MapWriter", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521707653", "createdAt": "2020-11-11T23:42:47Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "diffHunk": "@@ -366,7 +381,7 @@ public void m2(SolrQueryRequest req, SolrQueryResponse rsp) {\n \n   }\n \n-  public static class CConfig extends PluginMeta {\n+  public static class CConfig implements ReflectMapWriter {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyMjE4NA=="}, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDk4OA==", "bodyText": "Then we have to explicitly say so in ConfigurablePlugin<T extends MapWriter>.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r522034988", "createdAt": "2020-11-12T11:26:37Z", "author": {"login": "sigram"}, "path": "solr/core/src/test/org/apache/solr/handler/TestContainerPlugin.java", "diffHunk": "@@ -366,7 +381,7 @@ public void m2(SolrQueryRequest req, SolrQueryResponse rsp) {\n \n   }\n \n-  public static class CConfig extends PluginMeta {\n+  public static class CConfig implements ReflectMapWriter {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyMjE4NA=="}, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODI0OTA2OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjozMToxM1rOHxLKzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMzo0MTo1NlrOHxifaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyNTI2MA==", "bodyText": "Oh, I didn't notice before that it was created for each request. That was horrible!\nStill, we already have one instance here and another (configured the same) in ContainerPluginsRegistry. We should probably expose this instance here and reuse it in ContainerPluginsRegistry.", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521325260", "createdAt": "2020-11-11T12:31:13Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -62,6 +63,8 @@\n \n public class AnnotatedApi extends Api implements PermissionNameProvider , Closeable {\n   private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private static final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwNzM2OQ==", "bodyText": "It was not created per request. it was created per API", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521707369", "createdAt": "2020-11-11T23:41:56Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/AnnotatedApi.java", "diffHunk": "@@ -62,6 +63,8 @@\n \n public class AnnotatedApi extends Api implements PermissionNameProvider , Closeable {\n   private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n+  private static final ObjectMapper mapper = SolrJacksonAnnotationInspector.createObjectMapper()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyNTI2MA=="}, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODI1MzEzOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjozMjoyMlrOHxLNOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMzo0MjoxOFrOHxif7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyNTg4Mw==", "bodyText": "Should this be <T extends ReflectMapWriter> ? See my comment below in TestContainerPlugin.java", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521325883", "createdAt": "2020-11-11T12:32:22Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.solr.api;\n+\n+/**Implement this interface if your plugin needs to accept some configuration\n+ * \n+ * @param <T> the configuration Object type\n+ */\n+public interface ConfigurablePlugin<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwNzUwMw==", "bodyText": "may be <T extends MapWriter>", "url": "https://github.com/apache/lucene-solr/pull/2065#discussion_r521707503", "createdAt": "2020-11-11T23:42:18Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/api/ConfigurablePlugin.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.solr.api;\n+\n+/**Implement this interface if your plugin needs to accept some configuration\n+ * \n+ * @param <T> the configuration Object type\n+ */\n+public interface ConfigurablePlugin<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMyNTg4Mw=="}, "originalCommit": {"oid": "b7983a765c883014ad47d7a1735d7d337047846e"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1061, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}