{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NzU1MDEw", "number": 1825, "title": "SOLR-14828: reduce 'error' logging noise in BaseCloudSolrClient.requestWithRetryOnStaleState", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14828", "createdAt": "2020-09-03T16:38:04Z", "url": "https://github.com/apache/lucene-solr/pull/1825", "merged": true, "mergeCommit": {"oid": "876de8be41a837b83ef7ea6b82b322ed829b0595"}, "closed": true, "closedAt": "2020-09-24T16:06:46Z", "author": {"login": "cpoerschke"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFTRrrAH2gAyNDc4NzU1MDEwOjI1NTUyMzUzZjc5YmU4NmIxMTlkZDk5NDQ5MGQwNjE5ZDczNDgwZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJdKf2AH2gAyNDc4NzU1MDEwOjNiMjE0MTE5NTdiYTcwZWZlYjEzYzFiMTE1MGEwNDg5NzUwYjU2OGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "25552353f79be86b119dd994490d0619d73480f8", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/25552353f79be86b119dd994490d0619d73480f8", "committedDate": "2020-09-03T16:34:22Z", "message": "SOLR-14828: reduce 'error' logging noise in BaseCloudSolrClient.requestWithRetryOnStaleState"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODUxNDU4", "url": "https://github.com/apache/lucene-solr/pull/1825#pullrequestreview-487851458", "createdAt": "2020-09-14T14:51:10Z", "commit": {"oid": "25552353f79be86b119dd994490d0619d73480f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDo1MToxMFrOHRYxnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDo1MToxMFrOHRYxnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5Mzc1Nw==", "bodyText": "Since you add  - retrying to the info logging above, maybe add something like  - max retries hit here", "url": "https://github.com/apache/lucene-solr/pull/1825#discussion_r487993757", "createdAt": "2020-09-14T14:51:10Z", "author": {"login": "HoustonPutman"}, "path": "solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "diffHunk": "@@ -994,12 +991,15 @@ public RouteException(ErrorCode errorCode, NamedList<Throwable> throwables, Map<\n           // and we could not get any information from the server\n           //it is probably not worth trying again and again because\n           // the state would not have been updated\n-          log.info(\"trying request again\");\n+          log.info(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} - retrying\",\n+              inputCollections, errorCode, rootCause, retryCount, wasCommError, errorCode);\n           return requestWithRetryOnStaleState(request, retryCount + 1, inputCollections);\n         }\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n+      log.error(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} \",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25552353f79be86b119dd994490d0619d73480f8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4990ee038cf02833736a968faf80105e0dd68cf", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/c4990ee038cf02833736a968faf80105e0dd68cf", "committedDate": "2020-09-14T16:34:03Z", "message": "include maxRetries limit alongside retryCount value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTYxMTU1", "url": "https://github.com/apache/lucene-solr/pull/1825#pullrequestreview-487961155", "createdAt": "2020-09-14T16:47:28Z", "commit": {"oid": "c4990ee038cf02833736a968faf80105e0dd68cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4ODg1ODMz", "url": "https://github.com/apache/lucene-solr/pull/1825#pullrequestreview-488885833", "createdAt": "2020-09-15T17:00:47Z", "commit": {"oid": "c4990ee038cf02833736a968faf80105e0dd68cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzowMDo0N1rOHSLT6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzowMDo0N1rOHSLT6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyMTczNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n          \n          \n            \n                  log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n          \n      \n    \n    \n  \n\n@noblepaul - is this what you had in mind when you wrote \"switch this to INFO\" on the https://issues.apache.org/jira/browse/SOLR-14828 ticket? Or would you prefer keeping the logging at line 973 only but as INFO instead of ERROR?", "url": "https://github.com/apache/lucene-solr/pull/1825#discussion_r488821736", "createdAt": "2020-09-15T17:00:47Z", "author": {"login": "cpoerschke"}, "path": "solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "diffHunk": "@@ -994,12 +991,15 @@ public RouteException(ErrorCode errorCode, NamedList<Throwable> throwables, Map<\n           // and we could not get any information from the server\n           //it is probably not worth trying again and again because\n           // the state would not have been updated\n-          log.info(\"trying request again\");\n+          log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} - retrying\",\n+              inputCollections, errorCode, rootCause, retryCount, MAX_STALE_RETRIES, wasCommError, errorCode);\n           return requestWithRetryOnStaleState(request, retryCount + 1, inputCollections);\n         }\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n+      log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4990ee038cf02833736a968faf80105e0dd68cf"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b21411957ba70efeb13c1b1150a0489750b568d", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/3b21411957ba70efeb13c1b1150a0489750b568d", "committedDate": "2020-09-16T14:21:16Z", "message": "Update solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2798, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}