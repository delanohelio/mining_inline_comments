{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTk3NDE0", "number": 1996, "title": "SOLR-14907: Adding V2 API for ConfigSet Upload.", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14907\nAdding v2 APIs.", "createdAt": "2020-10-16T17:31:47Z", "url": "https://github.com/apache/lucene-solr/pull/1996", "merged": true, "mergeCommit": {"oid": "5091e75c9d85eda88c52f5ffb6ab395556c044ae"}, "closed": true, "closedAt": "2020-11-02T19:06:46Z", "author": {"login": "HoustonPutman"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTlmveAFqTUxMTAyNjY5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYoK0LAH2gAyNTA0OTk3NDE0OjFjNjYwYWVhM2M3MTcxMWJiZmI2NWIwMjY2MjZkYzg0OTNmYTFmYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDI2Njk4", "url": "https://github.com/apache/lucene-solr/pull/1996#pullrequestreview-511026698", "createdAt": "2020-10-18T01:49:58Z", "commit": {"oid": "37c2a5f63b88111fdffc28ce361045346760f4c1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQwMTo0OTo1OVrOHjhGyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQwMTo1MDoxMlrOHjhG8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAwNDYxOQ==", "bodyText": "Let's use a proper REST mechanism here\npath =\"/cluster/configs/{configname}/*", "url": "https://github.com/apache/lucene-solr/pull/1996#discussion_r507004619", "createdAt": "2020-10-18T01:49:59Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/handler/ClusterAPI.java", "diffHunk": "@@ -133,6 +134,62 @@ public void create(PayloadObj<CreateConfigInfo> obj) throws Exception {\n \n   }\n \n+  @EndPoint(method = POST,\n+      path =   \"/cluster/configs/{name}\",\n+      permission = CONFIG_EDIT_PERM\n+  )\n+  public void uploadConfigSet(SolrQueryRequest req, SolrQueryResponse rsp) throws Exception {\n+    req = wrapParams(req,\n+            \"action\", ConfigSetParams.ConfigSetAction.UPLOAD.toString(),\n+            CommonParams.NAME, req.getPathTemplateValues().get(\"name\"));\n+    configSetsHandler.handleRequestBody(req, rsp);\n+  }\n+\n+  @EndPoint(method = PUT,\n+      path =   \"/cluster/configs/{name}\",\n+      permission = CONFIG_EDIT_PERM\n+  )\n+  public void uploadConfigSetWithOverwrite(SolrQueryRequest req, SolrQueryResponse rsp) throws Exception {\n+    req = wrapParams(req,\n+            \"action\", ConfigSetParams.ConfigSetAction.UPLOAD.toString(),\n+            CommonParams.NAME, req.getPathTemplateValues().get(\"name\"),\n+            ConfigSetParams.OVERWRITE, true,\n+            ConfigSetParams.CLEANUP, req.getParams().getBool(ConfigSetParams.CLEANUP, false));\n+    configSetsHandler.handleRequestBody(req, rsp);\n+  }\n+\n+  @EndPoint(method = POST,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c2a5f63b88111fdffc28ce361045346760f4c1"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAwNDY1Ng==", "bodyText": "same as above", "url": "https://github.com/apache/lucene-solr/pull/1996#discussion_r507004656", "createdAt": "2020-10-18T01:50:12Z", "author": {"login": "noblepaul"}, "path": "solr/core/src/java/org/apache/solr/handler/ClusterAPI.java", "diffHunk": "@@ -133,6 +134,62 @@ public void create(PayloadObj<CreateConfigInfo> obj) throws Exception {\n \n   }\n \n+  @EndPoint(method = POST,\n+      path =   \"/cluster/configs/{name}\",\n+      permission = CONFIG_EDIT_PERM\n+  )\n+  public void uploadConfigSet(SolrQueryRequest req, SolrQueryResponse rsp) throws Exception {\n+    req = wrapParams(req,\n+            \"action\", ConfigSetParams.ConfigSetAction.UPLOAD.toString(),\n+            CommonParams.NAME, req.getPathTemplateValues().get(\"name\"));\n+    configSetsHandler.handleRequestBody(req, rsp);\n+  }\n+\n+  @EndPoint(method = PUT,\n+      path =   \"/cluster/configs/{name}\",\n+      permission = CONFIG_EDIT_PERM\n+  )\n+  public void uploadConfigSetWithOverwrite(SolrQueryRequest req, SolrQueryResponse rsp) throws Exception {\n+    req = wrapParams(req,\n+            \"action\", ConfigSetParams.ConfigSetAction.UPLOAD.toString(),\n+            CommonParams.NAME, req.getPathTemplateValues().get(\"name\"),\n+            ConfigSetParams.OVERWRITE, true,\n+            ConfigSetParams.CLEANUP, req.getParams().getBool(ConfigSetParams.CLEANUP, false));\n+    configSetsHandler.handleRequestBody(req, rsp);\n+  }\n+\n+  @EndPoint(method = POST,\n+      path =   \"/cluster/configs/{name}/file\",\n+      permission = CONFIG_EDIT_PERM\n+  )\n+  public void insertIntoConfigSet(SolrQueryRequest req, SolrQueryResponse rsp) throws Exception {\n+    String path = req.getParams().get(ConfigSetParams.PATH);\n+    if (path == null || path.isBlank()) {\n+      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST, \"In order to insert a file into a configSet, a valid 'path' parameter must be provided.\");\n+    }\n+    req = wrapParams(req,\n+            \"action\", ConfigSetParams.ConfigSetAction.UPLOAD.toString(),\n+            CommonParams.NAME, req.getPathTemplateValues().get(\"name\"));\n+    configSetsHandler.handleRequestBody(req, rsp);\n+  }\n+\n+  @EndPoint(method = PUT,\n+      path =   \"/cluster/configs/{name}/file\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c2a5f63b88111fdffc28ce361045346760f4c1"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjM3OTI0", "url": "https://github.com/apache/lucene-solr/pull/1996#pullrequestreview-513237924", "createdAt": "2020-10-21T01:07:23Z", "commit": {"oid": "2cf3f209b64643402d4bb7feafdc2f990a623659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "828cdfcedc18831508ca5f917b659629c3962f6b", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/828cdfcedc18831508ca5f917b659629c3962f6b", "committedDate": "2020-11-02T17:10:35Z", "message": "Adding V2 API for ConfigSet Upload."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75915c66eeca91ba01eae0092404e83a451dff77", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/75915c66eeca91ba01eae0092404e83a451dff77", "committedDate": "2020-11-02T17:10:35Z", "message": "Adding tests for v1 and v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6c3c10b12c3d2c89599451474f5b109e9ad714", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/bb6c3c10b12c3d2c89599451474f5b109e9ad714", "committedDate": "2020-11-02T17:10:35Z", "message": "Throw error for empty configSet upload."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9b86cea42b8ad9080a4fe42a1817989dd34bc8f", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/f9b86cea42b8ad9080a4fe42a1817989dd34bc8f", "committedDate": "2020-11-02T17:10:35Z", "message": "Putting filePath in path for v2 API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d86fd04d14ba28f8cca3d74e43c6c6e04218d84", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/0d86fd04d14ba28f8cca3d74e43c6c6e04218d84", "committedDate": "2020-11-02T17:10:35Z", "message": "Making v2 upload commands only accept HTTP PUT."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c1ead8246b074db636db106de7312b78b9540b", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/46c1ead8246b074db636db106de7312b78b9540b", "committedDate": "2020-11-02T17:10:35Z", "message": "Remove /files/ from singleFile path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f76fce0b0dee2d9ff81b6358f2d612acd30ace9", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/0f76fce0b0dee2d9ff81b6358f2d612acd30ace9", "committedDate": "2020-11-02T17:12:15Z", "message": "Moving CHANGES.txt section to 8.8.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cf3f209b64643402d4bb7feafdc2f990a623659", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/2cf3f209b64643402d4bb7feafdc2f990a623659", "committedDate": "2020-10-20T13:45:48Z", "message": "Remove /files/ from singleFile path"}, "afterCommit": {"oid": "0f76fce0b0dee2d9ff81b6358f2d612acd30ace9", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/0f76fce0b0dee2d9ff81b6358f2d612acd30ace9", "committedDate": "2020-11-02T17:12:15Z", "message": "Moving CHANGES.txt section to 8.8.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTMxOTUw", "url": "https://github.com/apache/lucene-solr/pull/1996#pullrequestreview-512931950", "createdAt": "2020-10-20T16:41:09Z", "commit": {"oid": "7750043e74cbc51284eb336edc4759487f07cff8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjo0MTowOVrOHlHYFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjo0MTowOVrOHlHYFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY4MDIxMg==", "bodyText": "Can we just use a boolean here?", "url": "https://github.com/apache/lucene-solr/pull/1996#discussion_r508680212", "createdAt": "2020-10-20T16:41:09Z", "author": {"login": "anshumg"}, "path": "solr/core/src/java/org/apache/solr/handler/admin/ConfigSetsHandler.java", "diffHunk": "@@ -230,7 +231,9 @@ private void handleConfigUploadRequest(SolrQueryRequest req, SolrQueryResponse r\n \n     ZipInputStream zis = new ZipInputStream(inputStream, StandardCharsets.UTF_8);\n     ZipEntry zipEntry = null;\n+    int entryCount = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7750043e74cbc51284eb336edc4759487f07cff8"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c660aea3c71711bbfb65b026626dc8493fa1fab", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/1c660aea3c71711bbfb65b026626dc8493fa1fab", "committedDate": "2020-11-02T17:39:26Z", "message": "Changing from int to boolean."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2750, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}