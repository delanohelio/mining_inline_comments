{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3OTkwNjg2", "number": 1600, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDo0NTowM1rOEINzUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDo0NjoxMlrOEINz_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDUwMTkzOnYy", "diffSide": "LEFT", "path": "solr/core/src/java/org/apache/solr/core/SolrPaths.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDo0NTowM1rOGoCvsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDo0NTowM1rOGoCvsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0MTIwMg==", "bodyText": "The delta here with Paths API isn't line-for-line; it's much better.  Files.createDirectories works if it exists and simply throws if something goes wrong.", "url": "https://github.com/apache/lucene-solr/pull/1600#discussion_r444641202", "createdAt": "2020-06-24T04:45:03Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/core/SolrPaths.java", "diffHunk": "@@ -94,26 +87,6 @@ public static Path locateSolrHome() {\n     return Paths.get(home).toAbsolutePath().normalize();\n   }\n \n-  public static void ensureUserFilesDataDir(Path solrHome) {\n-    final Path userFilesPath = getUserFilesPath(solrHome);\n-    final File userFilesDirectory = new File(userFilesPath.toString());\n-    if (!userFilesDirectory.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a029c6cf78f63c52d4ed5cdda8d594d7d3091b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDUwMzY2OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/handler/CatStream.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDo0NjoxMlrOGoCwvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wN1QxNTozMDowMFrOIhJzQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0MTQ3MQ==", "bodyText": "Path \"startsWith\" API makes what you were trying to do simpler (less code).", "url": "https://github.com/apache/lucene-solr/pull/1600#discussion_r444641471", "createdAt": "2020-06-24T04:46:12Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/handler/CatStream.java", "diffHunk": "@@ -158,28 +157,20 @@ public Explanation toExplanation(StreamFactory factory) throws IOException {\n   }\n \n   private List<CrawlFile> validateAndSetFilepathsInSandbox() {\n-    final String[] relativePathRoots = commaDelimitedFilepaths.split(\",\");\n-\n     final List<CrawlFile> crawlSeeds = new ArrayList<>();\n-    for (String crawlRoot : relativePathRoots) {\n-      final File crawlRootFile = new File(crawlRoot);\n-      if (crawlRootFile.isAbsolute()) {\n-        throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,\n-            \"file/directory to stream must be provided as an absolute path: \" + crawlRoot);\n-      }\n-      if ( crawlRoot.contains(\"..\")) {\n+    for (String crawlRootStr : commaDelimitedFilepaths.split(\",\")) {\n+      Path crawlRootPath = chroot.resolve(crawlRootStr).normalize();\n+      if (! crawlRootPath.startsWith(chroot)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a029c6cf78f63c52d4ed5cdda8d594d7d3091b"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTYzNDQ5Nw==", "bodyText": "I hope you're right about this. In my testing it does prevent the use of \"..\", but there is nothing explicit that I've read that says the change made here will prevent the use of \"..\". This is not a small issue because of the security ramifications.\nThis PR also exposes the chroot in the error message which needs to be changed.", "url": "https://github.com/apache/lucene-solr/pull/1600#discussion_r571634497", "createdAt": "2021-02-07T15:30:00Z", "author": {"login": "joel-bernstein"}, "path": "solr/core/src/java/org/apache/solr/handler/CatStream.java", "diffHunk": "@@ -158,28 +157,20 @@ public Explanation toExplanation(StreamFactory factory) throws IOException {\n   }\n \n   private List<CrawlFile> validateAndSetFilepathsInSandbox() {\n-    final String[] relativePathRoots = commaDelimitedFilepaths.split(\",\");\n-\n     final List<CrawlFile> crawlSeeds = new ArrayList<>();\n-    for (String crawlRoot : relativePathRoots) {\n-      final File crawlRootFile = new File(crawlRoot);\n-      if (crawlRootFile.isAbsolute()) {\n-        throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,\n-            \"file/directory to stream must be provided as an absolute path: \" + crawlRoot);\n-      }\n-      if ( crawlRoot.contains(\"..\")) {\n+    for (String crawlRootStr : commaDelimitedFilepaths.split(\",\")) {\n+      Path crawlRootPath = chroot.resolve(crawlRootStr).normalize();\n+      if (! crawlRootPath.startsWith(chroot)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0MTQ3MQ=="}, "originalCommit": {"oid": "d2a029c6cf78f63c52d4ed5cdda8d594d7d3091b"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1490, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}