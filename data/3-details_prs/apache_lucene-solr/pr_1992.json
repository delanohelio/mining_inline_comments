{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0ODAwODM1", "number": 1992, "title": "SOLR-14939: JSON range faceting to support cache=false parameter", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14939", "createdAt": "2020-10-16T12:18:37Z", "url": "https://github.com/apache/lucene-solr/pull/1992", "merged": true, "mergeCommit": {"oid": "0b5003cfed5187286ac49fa56d5aafe15165101d"}, "closed": true, "closedAt": "2020-12-16T17:42:25Z", "author": {"login": "cpoerschke"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTE_qOgH2gAyNTA0ODAwODM1OjkwNDQ0NjE1YjE2MmUxN2FjNjQwNjcwMDY1MjRkYzhmYzczMTVmZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmx7rAgH2gAyNTA0ODAwODM1OjU4OTJkM2MwMzNiMThhYTI4NzJmYmQxYjQyM2UxOWJmNTUyZWQyMzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "90444615b162e17ac64067006524dc8fc7315fdb", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/90444615b162e17ac64067006524dc8fc7315fdb", "committedDate": "2020-10-16T11:50:57Z", "message": "SOLR-14939: JSON range faceting to support cache=false parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d30f1e5a238ae29916f84c7af73d4c76564cdf2b", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/d30f1e5a238ae29916f84c7af73d4c76564cdf2b", "committedDate": "2020-12-10T14:31:15Z", "message": "Merge remote-tracking branch 'origin/master' into master-solr-14939"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODE4MDk0", "url": "https://github.com/apache/lucene-solr/pull/1992#pullrequestreview-549818094", "createdAt": "2020-12-11T05:51:13Z", "commit": {"oid": "d30f1e5a238ae29916f84c7af73d4c76564cdf2b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNTo1MToxM1rOIDqKcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNTo1NTozN1rOIDqQGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcwNzQ0MA==", "bodyText": "Here (and in the else) I think I would explicitly do setCache(false) as it feels more readable to me, but I don't have strong opinions on that.", "url": "https://github.com/apache/lucene-solr/pull/1992#discussion_r540707440", "createdAt": "2020-12-11T05:51:13Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/search/facet/FacetRangeProcessor.java", "diffHunk": "@@ -531,7 +533,20 @@ private  SimpleOrderedMap getRangeCountsIndexed() throws IOException {\n   private Query[] filters;\n   private DocSet[] intersections;\n   private void rangeStats(Range range, int slot) throws IOException {\n-    Query rangeQ = sf.getType().getRangeQuery(null, sf, range.low == null ? null : calc.formatValue(range.low), range.high==null ? null : calc.formatValue(range.high), range.includeLower, range.includeUpper);\n+    final Query rangeQ;\n+    {\n+      final Query rangeQuery = sf.getType().getRangeQuery(null, sf, range.low == null ? null : calc.formatValue(range.low), range.high==null ? null : calc.formatValue(range.high), range.includeLower, range.includeUpper);\n+      if (fcontext.cache) {\n+        rangeQ = rangeQuery;\n+      } else if (rangeQuery instanceof ExtendedQuery) {\n+        ((ExtendedQuery) rangeQuery).setCache(fcontext.cache);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d30f1e5a238ae29916f84c7af73d4c76564cdf2b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcwODg5MQ==", "bodyText": "Might as well store the string directly?", "url": "https://github.com/apache/lucene-solr/pull/1992#discussion_r540708891", "createdAt": "2020-12-11T05:55:37Z", "author": {"login": "madrob"}, "path": "solr/core/src/test/org/apache/solr/search/facet/TestJsonRangeFacets.java", "diffHunk": "@@ -41,6 +42,7 @@ public static void beforeTests() throws Exception {\n     if (Boolean.getBoolean(NUMERIC_POINTS_SYSPROP)) System.setProperty(NUMERIC_DOCVALUES_SYSPROP,\"true\");\n \n     initCore(\"solrconfig-tlog.xml\",\"schema_latest.xml\");\n+    cache = random().nextBoolean();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d30f1e5a238ae29916f84c7af73d4c76564cdf2b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f517ffd743ddef283e29040dbf309bd8100b55db", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/f517ffd743ddef283e29040dbf309bd8100b55db", "committedDate": "2020-12-15T17:45:28Z", "message": "code review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzczNjk4", "url": "https://github.com/apache/lucene-solr/pull/1992#pullrequestreview-552773698", "createdAt": "2020-12-15T18:58:58Z", "commit": {"oid": "f517ffd743ddef283e29040dbf309bd8100b55db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5892d3c033b18aa2872fbd1b423e19bf552ed236", "author": {"user": {"login": "cpoerschke", "name": "Christine Poerschke"}}, "url": "https://github.com/apache/lucene-solr/commit/5892d3c033b18aa2872fbd1b423e19bf552ed236", "committedDate": "2020-12-16T16:56:53Z", "message": "add solr/CHANGES.txt entry"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2739, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}