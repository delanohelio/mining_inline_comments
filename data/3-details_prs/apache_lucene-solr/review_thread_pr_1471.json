{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODU4OTg3", "number": 1471, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjozNjoxN1rOD4aogA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo0Mjo1NlrOD4avbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDgzMjAwOnYy", "diffSide": "RIGHT", "path": "solr/bin/solr.cmd", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjozNjoxN1rOGPOtCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozNzozOVrOGPSEUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMjczMQ==", "bodyText": "This clobbers the previous START_OPTS", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418622731", "createdAt": "2020-05-01T16:36:17Z", "author": {"login": "madrob"}, "path": "solr/bin/solr.cmd", "diffHunk": "@@ -1288,6 +1295,7 @@ REM '-OmitStackTraceInFastThrow' ensures stack traces in errors,\n REM users who don't care about useful error msgs can override in SOLR_OPTS with +OmitStackTraceInFastThrow\n set \"START_OPTS=%START_OPTS% -XX:-OmitStackTraceInFastThrow\"\n set START_OPTS=%START_OPTS% !GC_TUNE! %GC_LOG_OPTS%\n+set START_OPTS=-DdisableAdminUI=%DISABLE_ADMIN_UI%", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3Nzg0Mw==", "bodyText": "I believe this one is fixed as well @madrob", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418677843", "createdAt": "2020-05-01T18:37:39Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/bin/solr.cmd", "diffHunk": "@@ -1288,6 +1295,7 @@ REM '-OmitStackTraceInFastThrow' ensures stack traces in errors,\n REM users who don't care about useful error msgs can override in SOLR_OPTS with +OmitStackTraceInFastThrow\n set \"START_OPTS=%START_OPTS% -XX:-OmitStackTraceInFastThrow\"\n set START_OPTS=%START_OPTS% !GC_TUNE! %GC_LOG_OPTS%\n+set START_OPTS=-DdisableAdminUI=%DISABLE_ADMIN_UI%", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMjczMQ=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDgzNDI4OnYy", "diffSide": "RIGHT", "path": "solr/bin/solr", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjozNzowMFrOGPOuXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMjo1NFrOGPRqhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA==", "bodyText": "It doesn't look like this property is ever passed to the run command?", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418623070", "createdAt": "2020-05-01T16:37:00Z", "author": {"login": "madrob"}, "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMDEyMQ==", "bodyText": "You have to explicitly pass it, or you can pass the system property", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418630121", "createdAt": "2020-05-01T16:53:16Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0NDkxNQ==", "bodyText": "So if I set SOLR_ADMIN_UI_DISABLED=true in my solr.in.sh, then it sets SOLR_ADMIN_UI=\"-DdisableAdminUI=true\" here, and then... does nothing? Because the SOLR_ADMIN_UI variable is never read. What am I missing?", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418644915", "createdAt": "2020-05-01T17:25:47Z", "author": {"login": "madrob"}, "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY0NjEwMA==", "bodyText": "Yes, that was an error on my part. I forgot to carry that over from the previous PR. I've added it. See line 2219", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418646100", "createdAt": "2020-05-01T17:28:26Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTIzOQ==", "bodyText": "dedcdfe @madrob", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418671239", "createdAt": "2020-05-01T18:22:54Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/bin/solr", "diffHunk": "@@ -2097,6 +2097,14 @@ else\n   SECURITY_MANAGER_OPTS=()\n fi\n \n+# Enable ADMIN UI by default, and give the option for users to disable it\n+if [ \"$SOLR_ADMIN_UI_DISABLED\" == \"true\" ]; then\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=true\"\n+  echo -e \"ADMIN UI Disabled\"\n+else\n+  SOLR_ADMIN_UI=\"-DdisableAdminUI=false\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzA3MA=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDgzNjU3OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjozNzo0MFrOGPOvtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo1MTo1NVrOGPPHwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzQxNA==", "bodyText": "nit: did you mean to move these imports around?", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418623414", "createdAt": "2020-05-01T16:37:40Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -15,6 +15,13 @@\n  * limitations under the License.\n  */\n package org.apache.solr.servlet;\n+import javax.servlet.http.HttpServletRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyOTU2OA==", "bodyText": "Yes. I did that because the precommit failed before locally.", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418629568", "createdAt": "2020-05-01T16:51:55Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -15,6 +15,13 @@\n  * limitations under the License.\n  */\n package org.apache.solr.servlet;\n+import javax.servlet.http.HttpServletRequest;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzQxNA=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDg0OTc1OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo0Mjo1NlrOGPO4Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNDo0MDoyM1rOGPym2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw==", "bodyText": "Would this make sense to do before the close shield methods?", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418625583", "createdAt": "2020-05-01T16:42:56Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4OTY2OQ==", "bodyText": "Not in its current state because response object won't exist, but I could refactor if you have a good reason for that. Or, if I think of one. Gonna peep those methods again now.", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418689669", "createdAt": "2020-05-01T19:03:56Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3OTc1NQ==", "bodyText": "So, I got pulled away by some work. I'll update. I think it makes sense to drop the response before the close shield if possible.", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418779755", "createdAt": "2020-05-01T23:36:59Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc3OTk4MQ==", "bodyText": "I'm testing it now.", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r418779981", "createdAt": "2020-05-01T23:38:21Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxMDk3MA==", "bodyText": "Handling the raw response works better. Looking at the snippet on this page originally I didn't have the full context. Good suggestion. Thanks \ud83d\udc4d", "url": "https://github.com/apache/lucene-solr/pull/1471#discussion_r419210970", "createdAt": "2020-05-04T04:40:23Z", "author": {"login": "MarcusSorealheis"}, "path": "solr/core/src/java/org/apache/solr/servlet/LoadAdminUiServlet.java", "diffHunk": "@@ -24,29 +31,26 @@\n import org.apache.solr.core.CoreContainer;\n import org.apache.solr.core.SolrCore;\n \n-import javax.servlet.http.HttpServletRequest;\n-import javax.servlet.http.HttpServletResponse;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStreamWriter;\n-import java.io.Writer;\n-import java.nio.charset.StandardCharsets;\n-\n /**\n  * A simple servlet to load the Solr Admin UI\n  * \n  * @since solr 4.0\n  */\n public final class LoadAdminUiServlet extends BaseSolrServlet {\n \n+  // check system properties for whether or not admin UI is disabled, default is false\n+  private static final boolean disabled = Boolean.parseBoolean(System.getProperty(\"disableAdminUI\", \"false\"));\n+\n   @Override\n-  public void doGet(HttpServletRequest _request,\n-                    HttpServletResponse _response)\n-      throws IOException {\n+  public void doGet(HttpServletRequest _request, HttpServletResponse _response) throws IOException {\n     HttpServletRequest request = SolrDispatchFilter.closeShield(_request, false);\n     HttpServletResponse response = SolrDispatchFilter.closeShield(_response, false);\n-    \n+\n+    if(disabled){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNTU4Mw=="}, "originalCommit": {"oid": "896b1454a722a7f96a83a120122d3b55b1a73678"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 811, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}