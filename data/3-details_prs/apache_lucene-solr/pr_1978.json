{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTgxODU3", "number": 1978, "title": "LUCENE-9524: Fix NPE in SpanWeight#explain when no scoring is require\u2026", "bodyText": "Description\nSpanWeight#explain uses Similarity.SimScorer to generate explanations, and may fail with NullPointerException when scoring is not needed and thus Similarity.SimScorer is set to null, such as matching for must not occur span query.\nSolution\nThe solution is to check for null Similarity.SimScorer in SpanWeight#explain, and provides alternative explanation.\nTests\nAdded 1 integration test to TestMemoryIndex that was broken before the fix.\nChecklist\nPlease review the following and check all that apply:\n\n I have reviewed the guidelines for How to Contribute and my code conforms to the standards described there to the best of my ability.\n I have created a Jira issue and added the issue ID to my pull request title.\n I have given Solr maintainers access to contribute to my PR branch. (optional but recommended)\n I have developed this patch against the master branch.\n I have run ./gradlew check.\n I have added tests for my changes.\n I have added documentation for the Ref Guide (for Solr changes only).", "createdAt": "2020-10-13T04:56:52Z", "url": "https://github.com/apache/lucene-solr/pull/1978", "merged": true, "mergeCommit": {"oid": "6990109f9be97c6c32724dd5c001f5d3bc8da5e8"}, "closed": true, "closedAt": "2020-10-16T17:00:46Z", "author": {"login": "zacharymorn"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSBQUUAH2gAyNTAxOTgxODU3OmY1MTBmYzk1MmMzODNmNThlMDRmODA3NzBhZWRmMjYxNWRjZTgwZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTFUbVAH2gAyNTAxOTgxODU3OmE2NmE4ZTEzZDk5NmRhMDE1MjhiNjZmMWU1OWY5MWZmMGQ3MzZjMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5", "author": {"user": {"login": "zacharymorn", "name": "zacharymorn"}}, "url": "https://github.com/apache/lucene-solr/commit/f510fc952c383f58e04f80770aedf2615dce80d5", "committedDate": "2020-10-13T04:55:36Z", "message": "LUCENE-9524: Fix NPE in SpanWeight#explain when no scoring is required and SpanWeight has null Similarity.SimScorer."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzQwNTE4", "url": "https://github.com/apache/lucene-solr/pull/1978#pullrequestreview-508740518", "createdAt": "2020-10-14T21:17:39Z", "commit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToxNzozOVrOHhlYGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjoxMDoxOVrOHhnWnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NzQzNA==", "bodyText": "can you assert on the explanation string?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r504977434", "createdAt": "2020-10-14T21:17:39Z", "author": {"login": "jpountz"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {\n+    String queryString = \"(lorem AND NOT \\\"dolor lorem\\\") OR ipsum\";\n+    String text = \"dolor lorem ipsum\";\n+\n+    Analyzer analyzer = new MockAnalyzer(random());\n+    Query query = new ComplexPhraseQueryParser(\"content\", analyzer).parse(queryString);\n+\n+    MemoryIndex memoryIndex = new MemoryIndex(true);\n+    memoryIndex.addField(\"content\", text, analyzer);\n+\n+    IndexSearcher searcher = memoryIndex.createSearcher();\n+\n+    TopDocs topDocs = searcher.search(query, 1);\n+    ScoreDoc match = topDocs.scoreDocs[0];\n+    searcher.explain(query, match.doc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwOTgyMA==", "bodyText": "I don't think this is specific to MemoryIndex, so can you move this test to TestSpansExplanations?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r505009820", "createdAt": "2020-10-14T22:10:19Z", "author": {"login": "jpountz"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d06473da5f1c5a2ccd0e52dd76a90d0ed8af032d", "author": {"user": {"login": "zacharymorn", "name": "zacharymorn"}}, "url": "https://github.com/apache/lucene-solr/commit/d06473da5f1c5a2ccd0e52dd76a90d0ed8af032d", "committedDate": "2020-10-15T02:18:18Z", "message": "LUCENE-9524: Move integration test from TestMemoryIndex to TestSpanExplanations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b", "author": {"user": {"login": "zacharymorn", "name": "zacharymorn"}}, "url": "https://github.com/apache/lucene-solr/commit/9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b", "committedDate": "2020-10-16T00:32:52Z", "message": "LUCENE-9524: Use more focused logic for testing null simScorer scenaior, and assert on explanation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjI1MjMz", "url": "https://github.com/apache/lucene-solr/pull/1978#pullrequestreview-510225233", "createdAt": "2020-10-16T07:41:16Z", "commit": {"oid": "9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo0MToxNlrOHirwXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo0MToxNlrOHirwXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzMDUyNw==", "bodyText": "we should be able to remove this now?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r506130527", "createdAt": "2020-10-16T07:41:16Z", "author": {"login": "jpountz"}, "path": "lucene/core/build.gradle", "diffHunk": "@@ -22,4 +22,5 @@ description = 'Lucene core library'\n dependencies {\n   testImplementation project(':lucene:codecs')\n   testImplementation project(':lucene:test-framework')\n+  testImplementation project(':lucene:queryparser')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a66a8e13d996da01528b66f1e59f91ff0d736c06", "author": {"user": {"login": "zacharymorn", "name": "zacharymorn"}}, "url": "https://github.com/apache/lucene-solr/commit/a66a8e13d996da01528b66f1e59f91ff0d736c06", "committedDate": "2020-10-16T12:13:38Z", "message": "LUCENE-9524: Remove no longer needed dependency"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2732, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}