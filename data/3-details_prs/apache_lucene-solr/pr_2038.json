{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMjQzNTM2", "number": 2038, "title": "SOLR-14955: Add env var options to Prometheus Export scripts.", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14955", "createdAt": "2020-10-26T19:02:30Z", "url": "https://github.com/apache/lucene-solr/pull/2038", "merged": true, "mergeCommit": {"oid": "e1698bda95dcd76e1d0bdf351c3672d68478eb80"}, "closed": true, "closedAt": "2020-10-30T15:15:33Z", "author": {"login": "HoustonPutman"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWYhB1AH2gAyNTEwMjQzNTM2OjUyZDIxMWI4MmU1NzdiMTQ3ODE1MWQ1NTYxZDAzOTBiNjNhNGMxMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXapJTAH2gAyNTEwMjQzNTM2OjM2ZDg3NjkxMGNmMTc2Zjg5N2FhZmRlOGU0Yzk1MDYzNWY2YzYxMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52d211b82e577b1478151d5561d0390b63a4c128", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/52d211b82e577b1478151d5561d0390b63a4c128", "committedDate": "2020-10-26T18:17:22Z", "message": "SOLR-14955: Add env var options to Prometheus Export scripts."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a68028462826958ff19391ea6e5b9b9dbc5e381b", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/a68028462826958ff19391ea6e5b9b9dbc5e381b", "committedDate": "2020-10-26T18:17:22Z", "message": "First pass for exporter.cmd, need to test still."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ae05c683f3c5b37ef7283b4c6f9e16d4322be1", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/75ae05c683f3c5b37ef7283b4c6f9e16d4322be1", "committedDate": "2020-10-26T18:29:42Z", "message": "Changes.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe41cc2e803fb766663e70065bd93d85b5cb290", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/9fe41cc2e803fb766663e70065bd93d85b5cb290", "committedDate": "2020-10-26T19:01:03Z", "message": "Fix command line args for windows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTI4Njkx", "url": "https://github.com/apache/lucene-solr/pull/2038#pullrequestreview-519528691", "createdAt": "2020-10-29T10:32:24Z", "commit": {"oid": "9fe41cc2e803fb766663e70065bd93d85b5cb290"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDozMjoyNFrOHqVoBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDozNTo1MVrOHqVwDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1NjU0OA==", "bodyText": "I find it puzzling that default port is the same as the default port for embedded Zookeeper, i.e. if you start bin/solr -c and then start exporter on same host, you'll have a port collision.", "url": "https://github.com/apache/lucene-solr/pull/2038#discussion_r514156548", "createdAt": "2020-10-29T10:32:24Z", "author": {"login": "janhoy"}, "path": "solr/solr-ref-guide/src/monitoring-solr-with-prometheus-and-grafana.adoc", "diffHunk": "@@ -81,34 +81,44 @@ $ ./bin/solr-exporter -p 9854 -z localhost:2181/solr -f ./conf/solr-exporter-con\n \n === Command Line Parameters\n \n-The parameters in the example start commands shown above:\n+The list of available parameters for the Prometheus Exporter.\n+All parameters can be provided via an environment variable, instead of through the command line.\n \n `h`, `--help`::\n Displays command line help and usage.\n \n-`-p`, `--port`::\n-The port where Prometheus will listen for new data. This port will be used to configure Prometheus. It can be any port not already in use on your server. The default is `9983`.\n+`-p`, `--port`, `$PORT`::\n+The port where Prometheus will listen for new data. This port will be used to configure Prometheus.\n+It can be any port not already in use on your server. The default is `9983`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fe41cc2e803fb766663e70065bd93d85b5cb290"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1ODYwNg==", "bodyText": "I like the simplicity of PORT, but is there a risk that such generic naming could lead to conflict, i.e. that a user hast this env set for some other app, and then the exporter will use it?", "url": "https://github.com/apache/lucene-solr/pull/2038#discussion_r514158606", "createdAt": "2020-10-29T10:35:51Z", "author": {"login": "janhoy"}, "path": "solr/contrib/prometheus-exporter/bin/solr-exporter", "diffHunk": "@@ -135,15 +134,42 @@ if $cygwin; then\n   [ -n \"$REPO\" ] && REPO=`cygpath --path --windows \"$REPO\"`\n fi\n \n+# Convert Environment Variables to Command Line Options\n+EXPORTER_ARGS=()\n+\n+if [[ -n \"$CONFIG_FILE\" ]]; then\n+  EXPORTER_ARGS+=(-f \"$CONFIG_FILE\")\n+fi\n+\n+if [[ -n \"$PORT\" ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fe41cc2e803fb766663e70065bd93d85b5cb290"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d876910cf176f897aafde8e4c950635f6c6106", "author": {"user": {"login": "HoustonPutman", "name": "Houston Putman"}}, "url": "https://github.com/apache/lucene-solr/commit/36d876910cf176f897aafde8e4c950635f6c6106", "committedDate": "2020-10-29T23:19:58Z", "message": "Update solr-exporter.cmd\n\nFixed windows usage."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2529, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}