{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2OTUxMTQ4", "number": 1941, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo1NDozN1rOEp3W0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1MjoyNlrOEp4c7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzM0MDM1OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo1NDozN1rOHby6gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTo1NDozN1rOHby6gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkwNzc3OA==", "bodyText": "I'm confused why we are calling separate methods when numDocs is negative or not?", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498907778", "createdAt": "2020-10-02T15:54:37Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -1072,7 +1073,14 @@ public IndexWriter(Directory d, IndexWriterConfig conf) throws IOException {\n \n       config.getFlushPolicy().init(config);\n       bufferedUpdatesStream = new BufferedUpdatesStream(infoStream);\n-      docWriter = new DocumentsWriter(flushNotifications, segmentInfos.getIndexCreatedVersionMajor(), pendingNumDocs,\n+      final IntConsumer reserveDocs = numDocs -> {\n+        if (numDocs > 0) {\n+          reserveDocs(numDocs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16269e556a44dac582fe548e4845a5a79bdbfb8d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzUxOTgyOnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo1MjoyNlrOHb0sqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzozNDo0MlrOHb18IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNzAwMw==", "bodyText": "Maybe add @lucene.experimental?  We are exposing (slightly) internal details about IndexWriter so maybe we need to reserve the right to change this API in the future ...", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498937003", "createdAt": "2020-10-02T16:52:26Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -5463,6 +5463,13 @@ private void tooManyDocs(long addedNumDocs) {\n     throw new IllegalArgumentException(\"number of documents in the index cannot exceed \" + actualMaxDocs + \" (current document count is \" + pendingNumDocs.get() + \"; added numDocs is \" + addedNumDocs + \")\");\n   }\n \n+  /**\n+   * Returns the number of documents in the index including documents are being added (i.e., reserved).\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk1NzM0NQ==", "bodyText": "++. I pushed 61d4fbc", "url": "https://github.com/apache/lucene-solr/pull/1941#discussion_r498957345", "createdAt": "2020-10-02T17:34:42Z", "author": {"login": "dnhatn"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriter.java", "diffHunk": "@@ -5463,6 +5463,13 @@ private void tooManyDocs(long addedNumDocs) {\n     throw new IllegalArgumentException(\"number of documents in the index cannot exceed \" + actualMaxDocs + \" (current document count is \" + pendingNumDocs.get() + \"; added numDocs is \" + addedNumDocs + \")\");\n   }\n \n+  /**\n+   * Returns the number of documents in the index including documents are being added (i.e., reserved).\n+   */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNzAwMw=="}, "originalCommit": {"oid": "655b7d9f8c0014bd879e90f22e1d9aa5d3096efd"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1117, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}