{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMTU1NDc5", "number": 2040, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNDo0MFrOEy0_dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozOTowNlrOEy_eRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzMyNDcwOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNDo0MFrOHprscQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNDo0MFrOHprscQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2OTU1Mw==", "bodyText": "You should never create instances of SolrMetricManager in your components. Always use the single instance constructed in CoreContainer.getMetricManager().\nThe only reason it kind of worked for you was that you made it a shared registry, which is created once per JVM - but as I explain below in this case a shared registry is incorrect and should not be used.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513469553", "createdAt": "2020-10-28T14:04:40Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -173,6 +175,9 @@\n \n     private final Stats zkStats;\n \n+    private final SolrMetricManager metricManager = new SolrMetricManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzM4MzkwOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxNjozM1rOHpsRjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNzowMDowNFrOH-nEjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3OTA1Mw==", "bodyText": "You should create a SolrMetricsContext in Overseer, and create a child context here, and then pass it as the first argument to registerGauge. This helps to properly unregister old gauges from the registry (because a new instance of ClusterStateUpdater is created each time this Overseer instance becomes the leader, and then it registers a new instance of gauge with the same name). Using a static string \"overseer\" defeats this mechanism, because it falsely indicates that the life-cycle of ClusterStateUpdater is the same as its parent object Overseer.\nThen in the ClusterStateUpdater.close() method you should unregister this gauge using the value of solrMetricsContext.getTag(). This prevents obscure reference leaks in the metrics registry.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513479053", "createdAt": "2020-10-28T14:16:33Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -185,6 +190,9 @@ public ClusterStateUpdater(final ZkStateReader reader, final String myId, Stats\n       this.completedMap = getCompletedMap(zkClient);\n       this.myId = myId;\n       this.reader = reader;\n+\n+      registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+      metricManager.registerGauge(null, registryName, () -> stateUpdateQueue.getZkStats().getQueueLength(), \"overseer\", true, \"stateUpdateQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYxMjk3MA==", "bodyText": "Thanks for the feedback, will update accordingly.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513612970", "createdAt": "2020-10-28T17:02:40Z", "author": {"login": "saatchibhalla"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -185,6 +190,9 @@ public ClusterStateUpdater(final ZkStateReader reader, final String myId, Stats\n       this.completedMap = getCompletedMap(zkClient);\n       this.myId = myId;\n       this.reader = reader;\n+\n+      registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+      metricManager.registerGauge(null, registryName, () -> stateUpdateQueue.getZkStats().getQueueLength(), \"overseer\", true, \"stateUpdateQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3OTA1Mw=="}, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYzMjY4Mg==", "bodyText": "@sigram Thanks for the feedback! Is there documentation around adding metrics that covers things like this?", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513632682", "createdAt": "2020-10-28T17:29:50Z", "author": {"login": "megancarey"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -185,6 +190,9 @@ public ClusterStateUpdater(final ZkStateReader reader, final String myId, Stats\n       this.completedMap = getCompletedMap(zkClient);\n       this.myId = myId;\n       this.reader = reader;\n+\n+      registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+      metricManager.registerGauge(null, registryName, () -> stateUpdateQueue.getZkStats().getQueueLength(), \"overseer\", true, \"stateUpdateQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3OTA1Mw=="}, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcyOTkxNw==", "bodyText": "@sigram Updated the PR with those proposed changes. Whenever you're free to take another look I'd appreciate it!", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513729917", "createdAt": "2020-10-28T20:10:59Z", "author": {"login": "saatchibhalla"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -185,6 +190,9 @@ public ClusterStateUpdater(final ZkStateReader reader, final String myId, Stats\n       this.completedMap = getCompletedMap(zkClient);\n       this.myId = myId;\n       this.reader = reader;\n+\n+      registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+      metricManager.registerGauge(null, registryName, () -> stateUpdateQueue.getZkStats().getQueueLength(), \"overseer\", true, \"stateUpdateQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3OTA1Mw=="}, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQxMzkwMg==", "bodyText": "@megancarey unfortunately, there's not much documentation apart from the javadocs and user-level info in the RefGuide. We should create a doc in solr/dev-docs/metrics.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r535413902", "createdAt": "2020-12-03T17:00:04Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -185,6 +190,9 @@ public ClusterStateUpdater(final ZkStateReader reader, final String myId, Stats\n       this.completedMap = getCompletedMap(zkClient);\n       this.myId = myId;\n       this.reader = reader;\n+\n+      registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+      metricManager.registerGauge(null, registryName, () -> stateUpdateQueue.getZkStats().getQueueLength(), \"overseer\", true, \"stateUpdateQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3OTA1Mw=="}, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzM5MzI5OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxODozNlrOHpsXjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxODozNlrOHpsXjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MDU5MQ==", "bodyText": "Please use the context tag value here.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513480591", "createdAt": "2020-10-28T14:18:36Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -544,6 +552,7 @@ private LeaderStatus amILeader() {\n     @Override\n       public void close() {\n         this.isClosed = true;\n+        metricManager.unregisterGauges(registryName, \"overseer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzM5NDQ0OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxODo1NFrOHpsYYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxODo1NFrOHpsYYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MDgwMw==", "bodyText": "See above - this should never be done.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513480803", "createdAt": "2020-10-28T14:18:54Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "diffHunk": "@@ -94,6 +96,8 @@\n   private boolean isClosed;\n \n   private volatile Stats stats;\n+  private final SolrMetricManager metricManager = new SolrMetricManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzQwOTYzOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyMTo1NFrOHpsiEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyMTo1NFrOHpsiEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MzI4MA==", "bodyText": "See above comments - you should create a child context here (from the one created in Overseer) and use it in this call, and then unregister this gauge using this context's tag value.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513483280", "createdAt": "2020-10-28T14:21:54Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "diffHunk": "@@ -154,6 +158,9 @@ public OverseerTaskProcessor(ZkStateReader zkStateReader, String myId,\n     this.runningTasks = ConcurrentHashMap.newKeySet();\n     this.completedTasks = new ConcurrentHashMap<>();\n     thisNode = Utils.getMDCNode();\n+\n+    registryName = SolrMetricManager.getRegistryName(SolrInfoBean.Group.overseer);\n+    metricManager.registerGauge(null, registryName, () -> workQueue.getZkStats().getQueueLength(), \"overseer\", true, \"collectionWorkQueueSize\", \"queue\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzQxMDg2OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyMjoxMFrOHpsi1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyMjoxMFrOHpsi1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MzQ3Nw==", "bodyText": "See above - use the tag value from the context.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513483477", "createdAt": "2020-10-28T14:22:10Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "diffHunk": "@@ -386,6 +393,7 @@ private void cleanUpWorkQueue() throws KeeperException, InterruptedException {\n \n   public void close() {\n     isClosed = true;\n+    metricManager.unregisterGauges(registryName, \"overseer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzQyMzc3OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/metrics/SolrMetricManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyNDozNVrOHpsqyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyNDozNVrOHpsqyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4NTUxNA==", "bodyText": "Overseer registry CANNOT be a shared registry because it's possible to have multiple Overseers in a single JVM, especially in unit tests. This should be a regular per-CoreContainer registry, which is created within the scope of the instance available from CC.getMetricManager().", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513485514", "createdAt": "2020-10-28T14:24:35Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/metrics/SolrMetricManager.java", "diffHunk": "@@ -423,13 +429,13 @@ public boolean hasRegistry(String name) {\n   /**\n    * Check for predefined shared registry names. This compares the input name\n    * with normalized names of predefined shared registries -\n-   * {@link #JVM_REGISTRY} and {@link #JETTY_REGISTRY}.\n+   * {@link #JVM_REGISTRY}, {@link #JETTY_REGISTRY}, and {@link #OVERSEER_REGISTRY}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzQyNTU4OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/metrics/SolrMetricManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyNDo1NlrOHpssDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoyNDo1NlrOHpssDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4NTgzNw==", "bodyText": "See above - this can't be a shared registry.", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513485837", "createdAt": "2020-10-28T14:24:56Z", "author": {"login": "sigram"}, "path": "solr/core/src/java/org/apache/solr/metrics/SolrMetricManager.java", "diffHunk": "@@ -423,13 +429,13 @@ public boolean hasRegistry(String name) {\n   /**\n    * Check for predefined shared registry names. This compares the input name\n    * with normalized names of predefined shared registries -\n-   * {@link #JVM_REGISTRY} and {@link #JETTY_REGISTRY}.\n+   * {@link #JVM_REGISTRY}, {@link #JETTY_REGISTRY}, and {@link #OVERSEER_REGISTRY}\n    *\n    * @param registry already normalized name\n    * @return true if the name matches one of shared registries\n    */\n   private static boolean isSharedRegistry(String registry) {\n-    return JETTY_REGISTRY.equals(registry) || JVM_REGISTRY.equals(registry);\n+    return JETTY_REGISTRY.equals(registry) || JVM_REGISTRY.equals(registry) || OVERSEER_REGISTRY.equals(registry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5c6eaacda382095a5ca99f524f6c54afca8e85d"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTAzNDc0OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozNjo0OVrOHp8dDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMToyODo1MFrOHp-LNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NDE0MQ==", "bodyText": "Are there any tests that instantiate OverseerCollectionConfigSetProcessor? (Just want to make sure this is the only time this method is used, since we changed the signature)", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513744141", "createdAt": "2020-10-28T20:36:49Z", "author": {"login": "megancarey"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -636,7 +650,7 @@ public synchronized void start(String id) {\n     ThreadGroup ccTg = new ThreadGroup(\"Overseer collection creation process.\");\n \n     OverseerNodePrioritizer overseerPrioritizer = new OverseerNodePrioritizer(reader, getStateUpdateQueue(), adminPath, shardHandler.getShardHandlerFactory());\n-    overseerCollectionConfigSetProcessor = new OverseerCollectionConfigSetProcessor(reader, id, shardHandler, adminPath, stats, Overseer.this, overseerPrioritizer);\n+    overseerCollectionConfigSetProcessor = new OverseerCollectionConfigSetProcessor(reader, id, shardHandler, adminPath, stats, Overseer.this, overseerPrioritizer, solrMetricsContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3125c45db659dd93b895555696b8e56cb4fb8cdf"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3MjM0Mg==", "bodyText": "Updated the one test that calls this thanks for the catch!", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513772342", "createdAt": "2020-10-28T21:28:50Z", "author": {"login": "saatchibhalla"}, "path": "solr/core/src/java/org/apache/solr/cloud/Overseer.java", "diffHunk": "@@ -636,7 +650,7 @@ public synchronized void start(String id) {\n     ThreadGroup ccTg = new ThreadGroup(\"Overseer collection creation process.\");\n \n     OverseerNodePrioritizer overseerPrioritizer = new OverseerNodePrioritizer(reader, getStateUpdateQueue(), adminPath, shardHandler.getShardHandlerFactory());\n-    overseerCollectionConfigSetProcessor = new OverseerCollectionConfigSetProcessor(reader, id, shardHandler, adminPath, stats, Overseer.this, overseerPrioritizer);\n+    overseerCollectionConfigSetProcessor = new OverseerCollectionConfigSetProcessor(reader, id, shardHandler, adminPath, stats, Overseer.this, overseerPrioritizer, solrMetricsContext);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NDE0MQ=="}, "originalCommit": {"oid": "3125c45db659dd93b895555696b8e56cb4fb8cdf"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTAzODMzOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozNzo1OVrOHp8fLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozNzo1OVrOHp8fLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NDY4NQ==", "bodyText": "Same question here - would be good to double-check that this is the only place we instantiate OverseerTaskProcessor", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513744685", "createdAt": "2020-10-28T20:37:59Z", "author": {"login": "megancarey"}, "path": "solr/core/src/java/org/apache/solr/cloud/OverseerTaskProcessor.java", "diffHunk": "@@ -134,13 +136,14 @@ public String toString() {\n   private String thisNode;\n \n   public OverseerTaskProcessor(ZkStateReader zkStateReader, String myId,\n-                                        Stats stats,\n-                                        OverseerMessageHandlerSelector selector,\n-                                        OverseerNodePrioritizer prioritizer,\n-                                        OverseerTaskQueue workQueue,\n-                                        DistributedMap runningMap,\n-                                        DistributedMap completedMap,\n-                                        DistributedMap failureMap) {\n+                               Stats stats,\n+                               OverseerMessageHandlerSelector selector,\n+                               OverseerNodePrioritizer prioritizer,\n+                               OverseerTaskQueue workQueue,\n+                               DistributedMap runningMap,\n+                               DistributedMap completedMap,\n+                               DistributedMap failureMap,\n+                               SolrMetricsContext solrMetricsContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3125c45db659dd93b895555696b8e56cb4fb8cdf"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTA0MTk3OnYy", "diffSide": "RIGHT", "path": "solr/solr-ref-guide/src/metrics-reporting.adoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozOTowNlrOHp8hYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMToyODoxOVrOHp-KPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NTI0OA==", "bodyText": "We can update this doc comment now, since we are using the CoreContainer registry", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513745248", "createdAt": "2020-10-28T20:39:06Z", "author": {"login": "megancarey"}, "path": "solr/solr-ref-guide/src/metrics-reporting.adoc", "diffHunk": "@@ -53,6 +53,12 @@ This registry is returned at `solr.jvm` and includes the following information.\n * System properties such as Java information, various installation directory paths, ports, and similar information. You can control what appears here by modifying `solr.xml`.\n // TODO for 7.0 fix this\n \n+=== Overseer Registry", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3125c45db659dd93b895555696b8e56cb4fb8cdf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3MjA5NA==", "bodyText": "chose to leave it this way - although we're using MetricManager from CoreContainer i'm still registering these metrics under \"solr.overseer.\"", "url": "https://github.com/apache/lucene-solr/pull/2040#discussion_r513772094", "createdAt": "2020-10-28T21:28:19Z", "author": {"login": "saatchibhalla"}, "path": "solr/solr-ref-guide/src/metrics-reporting.adoc", "diffHunk": "@@ -53,6 +53,12 @@ This registry is returned at `solr.jvm` and includes the following information.\n * System properties such as Java information, various installation directory paths, ports, and similar information. You can control what appears here by modifying `solr.xml`.\n // TODO for 7.0 fix this\n \n+=== Overseer Registry", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NTI0OA=="}, "originalCommit": {"oid": "3125c45db659dd93b895555696b8e56cb4fb8cdf"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1035, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}