{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5Mjg5MzM0", "number": 1610, "title": "LUCENE-9384: Backport for field sort optimization", "bodyText": "Backport for: LUCENE-9280: Collectors to skip noncompetitive documents (#1351)\nSimilar how scorers can update their iterators to skip non-competitive\ndocuments, collectors and comparators should also provide and update\niterators that allow them to skip non-competive documents.\nTo enable sort optimization for numeric sort fields,\nthe following needs to be done:\n\nthe field should be indexed with both doc_values and points, that\nmust have the same field name and same data\nSortField#setCanSkipNonCompetitiveDocs must be set\ntotalHitsThreshold should not be set to max value.", "createdAt": "2020-06-24T15:37:54Z", "url": "https://github.com/apache/lucene-solr/pull/1610", "merged": true, "mergeCommit": {"oid": "7b12849282898780b9a94546d23e325f5b8be6bb"}, "closed": true, "closedAt": "2020-07-31T18:12:58Z", "author": {"login": "mayya-sharipova"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcua39PgH2gAyNDM5Mjg5MzM0OjQ2NmQzZGI3NzE0OTM3NGZiMjMyYTdiNWY4ODJlZWUwNTFjYTdjOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6YQ0fgH2gAyNDM5Mjg5MzM0OmI3YjRlNWY4NTVjNjc0ZmJmNGU5OWQzYmExYmU2MDM1YTU4NTMyZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/466d3db77149374fb232a7b5f882eee051ca7c90", "committedDate": "2020-06-24T14:25:15Z", "message": "LUCENE-9384: Backport for field sort optimization\n\nBackport for: LUCENE-9280: Collectors to skip noncompetitive documents (#1351)\n\nSimilar how scorers can update their iterators to skip non-competitive\ndocuments, collectors and comparators should also provide and update\niterators that allow them to skip non-competive documents.\n\nTo enable sort optimization for numeric sort fields,\nthe following needs to be done:\n1) the field should be indexed with both doc_values and points, that\nmust have the same field name and same data\n2) SortField#setCanSkipNonCompetitiveDocs must be set\n3) totalHitsThreshold should not be set to max value."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MzY0NjYx", "url": "https://github.com/apache/lucene-solr/pull/1610#pullrequestreview-437364661", "createdAt": "2020-06-25T10:27:12Z", "commit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyNzoxMlrOGo0v-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyNzoxMlrOGo0v-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA==", "bodyText": "I wonder if we should make the option less ambiguous by naming it something like setCanUsePoints or something along those lines ? I am afraid that this could be misleading if we set this option on a sort field that use the _score or a keyword field for instance. We should maybe at least validate that the field is not null ?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r445460474", "createdAt": "2020-06-25T10:27:12Z", "author": {"login": "jimczi"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODg2NjUx", "url": "https://github.com/apache/lucene-solr/pull/1610#pullrequestreview-448886651", "createdAt": "2020-07-15T12:04:27Z", "commit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMjowNDoyN1rOGx6-_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMjoyMTo1NFrOGx7jrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5OTgwNw==", "bodyText": "IMO setCanUsePoints is good enough since this is a \"SortField\" so it should be obvious that this is for sorting?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r454999807", "createdAt": "2020-07-15T12:04:27Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA=="}, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwOTE5Ng==", "bodyText": "I wonder if we should actually take it into account for equals/hashcode as this could disable index sorting optimizations, which check for equality of the index-time and search-time SortField instances.", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r455009196", "createdAt": "2020-07-15T12:21:54Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -408,6 +428,7 @@ public boolean equals(Object o) {\n       && other.reverse == this.reverse\n       && Objects.equals(this.comparatorSource, other.comparatorSource)\n       && Objects.equals(this.missingValue, other.missingValue)\n+      && other.skipNonCompetitiveDocs == this.skipNonCompetitiveDocs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/6158872bc2c0442d6ff64e40db463be266873959", "committedDate": "2020-07-23T13:14:47Z", "message": "Address feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6827412efa1b9765e1521d5a2fda673360637e0a", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/6827412efa1b9765e1521d5a2fda673360637e0a", "committedDate": "2020-07-23T13:08:49Z", "message": "Address feedback"}, "afterCommit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/6158872bc2c0442d6ff64e40db463be266873959", "committedDate": "2020-07-23T13:14:47Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTAwMTY1", "url": "https://github.com/apache/lucene-solr/pull/1610#pullrequestreview-457500165", "createdAt": "2020-07-29T13:06:00Z", "commit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjA5OTA0", "url": "https://github.com/apache/lucene-solr/pull/1610#pullrequestreview-458609904", "createdAt": "2020-07-30T17:27:04Z", "commit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyNzowNFrOG5szeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyNzowNFrOG5szeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1NjA4OQ==", "bodyText": "Can you add a comment to say that we're not taking it into account on purpose? I foresee that someone will file a PR to add it after running a code analysis tool that would complain that not all fields are taken into account for equals otherwise.", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r463156089", "createdAt": "2020-07-30T17:27:04Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -428,7 +428,6 @@ public boolean equals(Object o) {\n       && other.reverse == this.reverse\n       && Objects.equals(this.comparatorSource, other.comparatorSource)\n       && Objects.equals(this.missingValue, other.missingValue)\n-      && other.skipNonCompetitiveDocs == this.skipNonCompetitiveDocs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b4e5f855c674fbf4e99d3ba1be6035a58532fd", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/b7b4e5f855c674fbf4e99d3ba1be6035a58532fd", "committedDate": "2020-07-31T18:09:47Z", "message": "Explain why canUsePoints is not part of equal"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2662, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}