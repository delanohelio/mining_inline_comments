{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5Mjg5MzM0", "number": 1610, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyNzoxMlrOEIs-Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyNzowNFrOETxoAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTYwOTM0OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyNzoxMlrOGo0v-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMjowNDoyN1rOGx6-_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA==", "bodyText": "I wonder if we should make the option less ambiguous by naming it something like setCanUsePoints or something along those lines ? I am afraid that this could be misleading if we set this option on a sort field that use the _score or a keyword field for instance. We should maybe at least validate that the field is not null ?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r445460474", "createdAt": "2020-06-25T10:27:12Z", "author": {"login": "jimczi"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczNzAyMQ==", "bodyText": "How about setCanUsePointsForSort? I am also fine with setCanUsePoints.", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r445737021", "createdAt": "2020-06-25T17:55:39Z", "author": {"login": "mayya-sharipova"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA=="}, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzNDg4NA==", "bodyText": "@jpountz  Do you have suggestions how we should expose sort optimization in 8.x? Are you ok with a proposal to have  a method for SortField::setCanUsePointsForSort that when set true indicates that the same data is used for indexing points and docValues?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r450234884", "createdAt": "2020-07-06T13:51:49Z", "author": {"login": "mayya-sharipova"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA=="}, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5OTgwNw==", "bodyText": "IMO setCanUsePoints is good enough since this is a \"SortField\" so it should be obvious that this is for sorting?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r454999807", "createdAt": "2020-07-15T12:04:27Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -394,6 +399,21 @@ public String toString() {\n     return buffer.toString();\n   }\n \n+\n+  /**\n+   * For numeric sort fields, setting this field, indicates that\n+   * the same numeric data has been indexed with two fields: doc values and points and\n+   * that these fields have the same name.\n+   * This allows to use sort optimization and skip non-competitive documents.\n+   */\n+  public void setSkipNonCompetitiveDocs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MDQ3NA=="}, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzODA3MDgxOnYy", "diffSide": "RIGHT", "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMjoyMTo1NFrOGx7jrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMDoyNjoxMVrOGyOmPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwOTE5Ng==", "bodyText": "I wonder if we should actually take it into account for equals/hashcode as this could disable index sorting optimizations, which check for equality of the index-time and search-time SortField instances.", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r455009196", "createdAt": "2020-07-15T12:21:54Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -408,6 +428,7 @@ public boolean equals(Object o) {\n       && other.reverse == this.reverse\n       && Objects.equals(this.comparatorSource, other.comparatorSource)\n       && Objects.equals(this.missingValue, other.missingValue)\n+      && other.skipNonCompetitiveDocs == this.skipNonCompetitiveDocs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMyMTE0OQ==", "bodyText": "@jpountz Thank you for your feedback. Alternatively we can add setCanUsePoints parameter to Sort object instead of SortField?  What do you think?", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r455321149", "createdAt": "2020-07-15T20:26:11Z", "author": {"login": "mayya-sharipova"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -408,6 +428,7 @@ public boolean equals(Object o) {\n       && other.reverse == this.reverse\n       && Objects.equals(this.comparatorSource, other.comparatorSource)\n       && Objects.equals(this.missingValue, other.missingValue)\n+      && other.skipNonCompetitiveDocs == this.skipNonCompetitiveDocs", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwOTE5Ng=="}, "originalCommit": {"oid": "466d3db77149374fb232a7b5f882eee051ca7c90"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTcxNDU2OnYy", "diffSide": "LEFT", "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyNzowNFrOG5szeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzoyNzowNFrOG5szeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1NjA4OQ==", "bodyText": "Can you add a comment to say that we're not taking it into account on purpose? I foresee that someone will file a PR to add it after running a code analysis tool that would complain that not all fields are taken into account for equals otherwise.", "url": "https://github.com/apache/lucene-solr/pull/1610#discussion_r463156089", "createdAt": "2020-07-30T17:27:04Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/java/org/apache/lucene/search/SortField.java", "diffHunk": "@@ -428,7 +428,6 @@ public boolean equals(Object o) {\n       && other.reverse == this.reverse\n       && Objects.equals(this.comparatorSource, other.comparatorSource)\n       && Objects.equals(this.missingValue, other.missingValue)\n-      && other.skipNonCompetitiveDocs == this.skipNonCompetitiveDocs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6158872bc2c0442d6ff64e40db463be266873959"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1499, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}