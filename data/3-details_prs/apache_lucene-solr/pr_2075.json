{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NzkwNjM2", "number": 2075, "title": "LUCENE-9599 Disable sort optim on index sort", "bodyText": "Disable sort optimization in comparators on index sort.\nCurrently, if search sort is equal or a part of the index sort, we have\nan early termination in TopFieldCollector.\nBut comparators are not aware of the index sort, and may run\nsort optimization even if the search sort is congruent with\nthe index sort.\nThis patch:\n\nmake leaf comparators aware that search sort is congruent\nwith the index sort.\ndisables sort optimization in comparators in this case.\nremoves a private  MultiComparatorLeafCollector class as the only\nclass that extended that class was TopFieldLeafCollector that\nnow incorporates the logic of the deleted class.\n\nRelates to #1351", "createdAt": "2020-11-10T22:02:44Z", "url": "https://github.com/apache/lucene-solr/pull/2075", "merged": true, "mergeCommit": {"oid": "69de1a490f4b78ca6479f944f495f4f4beb80771"}, "closed": true, "closedAt": "2020-12-03T17:08:47Z", "author": {"login": "mayya-sharipova"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbQndHAH2gAyNTE4NzkwNjM2OmFlMzNmZjIzN2Y2NTZjYmVkM2EyMWY1MDYyMWQ5YjU4Zjg2MmI1MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdikrLIAH2gAyNTE4NzkwNjM2OmM1ZTAzNjJiMzZmZTk4ZTM1ZDNiOTZhYTI3YTU1ODAyOTJjZjMxYzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae33ff237f656cbed3a21f50621d9b58f862b521", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/ae33ff237f656cbed3a21f50621d9b58f862b521", "committedDate": "2020-11-10T21:54:46Z", "message": "LUCENE-9599 Disable sort optim on index sort\n\nDisable sort optimization in comparators on index sort.\n\nCurrently, if search sort is equal or a part of the index sort, we have\nan early termination in TopFieldCollector.\nBut comparators are not aware of the index sort, and may run\nsort optimization even if the search sort is congruent with\nthe index sort.\n\nThis patch:\n- make leaf comparators aware that search sort is congruent\nwith the index sort.\n- disables sort optimization in comparators in this case.\n- removes a private  MultiComparatorLeafCollector class as the only\nclass that extended that class was TopFieldLeafCollector that\nnow incorporates the logic of the deleted class.\n\nRelates to #1351"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "907fc4bc60c3bf9adb3ebcec5282be1a61041021", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/907fc4bc60c3bf9adb3ebcec5282be1a61041021", "committedDate": "2020-11-20T19:44:25Z", "message": "TopFieldCollector informs FieldComparator on index sort"}, "afterCommit": {"oid": "34eeba52174c3b6394630d2ddcee3c8f8d5724d0", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/34eeba52174c3b6394630d2ddcee3c8f8d5724d0", "committedDate": "2020-11-20T19:47:27Z", "message": "TopFieldCollector informs FieldComparator on index sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aa08f51bd997050f17bbc3ef08d6c6a281ad4ac", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/5aa08f51bd997050f17bbc3ef08d6c6a281ad4ac", "committedDate": "2020-11-20T19:49:38Z", "message": "TopFieldCollector informs FieldComparator on index sort"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34eeba52174c3b6394630d2ddcee3c8f8d5724d0", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/34eeba52174c3b6394630d2ddcee3c8f8d5724d0", "committedDate": "2020-11-20T19:47:27Z", "message": "TopFieldCollector informs FieldComparator on index sort"}, "afterCommit": {"oid": "5aa08f51bd997050f17bbc3ef08d6c6a281ad4ac", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/5aa08f51bd997050f17bbc3ef08d6c6a281ad4ac", "committedDate": "2020-11-20T19:49:38Z", "message": "TopFieldCollector informs FieldComparator on index sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae710614d1c7fba925ad2ab6ef59dfdb1ab23508", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/ae710614d1c7fba925ad2ab6ef59dfdb1ab23508", "committedDate": "2020-12-03T13:36:41Z", "message": "Rename usesIndexSort to disableSkipping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTg0NTYw", "url": "https://github.com/apache/lucene-solr/pull/2075#pullrequestreview-543984560", "createdAt": "2020-12-03T14:05:39Z", "commit": {"oid": "ae710614d1c7fba925ad2ab6ef59dfdb1ab23508"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDowNTo0MFrOH-dRGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDowNTo0MFrOH-dRGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1MzI3Mw==", "bodyText": "Can we avoid the cast here", "url": "https://github.com/apache/lucene-solr/pull/2075#discussion_r535253273", "createdAt": "2020-12-03T14:05:40Z", "author": {"login": "jimczi"}, "path": "lucene/core/src/java/org/apache/lucene/search/TopFieldCollector.java", "diffHunk": "@@ -360,8 +352,8 @@ protected void updateMinCompetitiveScore(Scorable scorer) throws IOException {\n     if (canSetMinScore\n           && queueFull\n           && hitsThresholdChecker.isThresholdReached()) {\n-      assert bottom != null && relevanceComparator != null;\n-      float minScore = relevanceComparator.value(bottom.slot);\n+      assert bottom != null;\n+      float minScore = ((FieldComparator.RelevanceComparator) firstComparator).value(bottom.slot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae710614d1c7fba925ad2ab6ef59dfdb1ab23508"}, "originalPosition": 123}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5e0362b36fe98e35d3b96aa27a5580292cf31c5", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/apache/lucene-solr/commit/c5e0362b36fe98e35d3b96aa27a5580292cf31c5", "committedDate": "2020-12-03T15:14:24Z", "message": "Avoid cast"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2590, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}