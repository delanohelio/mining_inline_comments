{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTk5NjA2", "number": 2055, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0MzozOVrOE05BVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDoyNDo1OFrOE1Ymxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzODk1NjM4OnYy", "diffSide": "RIGHT", "path": "solr/docker/include/scripts/solr-fg", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0MzozOVrOHs3bcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxOTozNjo1MlrOHtm5Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwNzUzOA==", "bodyText": "Should this also be moved to bin/solr?", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516807538", "createdAt": "2020-11-03T16:43:39Z", "author": {"login": "HoustonPutman"}, "path": "solr/docker/include/scripts/solr-fg", "diffHunk": "@@ -15,21 +15,19 @@ if [[ -z \"${OOM:-}\" ]]; then\n   OOM='none'\n fi\n case \"$OOM\" in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk3NDU5Mw==", "bodyText": "I don't think so. It might make sense to remove it entirely, but in bin/solr these options can be specified directly instead.", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516974593", "createdAt": "2020-11-03T21:47:45Z", "author": {"login": "madrob"}, "path": "solr/docker/include/scripts/solr-fg", "diffHunk": "@@ -15,21 +15,19 @@ if [[ -z \"${OOM:-}\" ]]; then\n   OOM='none'\n fi\n case \"$OOM\" in", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwNzUzOA=="}, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk3NjUwMA==", "bodyText": "I wonder what effect these even have if we are going to run the oom_script by default, which will kill the solr process", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516976500", "createdAt": "2020-11-03T21:51:46Z", "author": {"login": "HoustonPutman"}, "path": "solr/docker/include/scripts/solr-fg", "diffHunk": "@@ -15,21 +15,19 @@ if [[ -z \"${OOM:-}\" ]]; then\n   OOM='none'\n fi\n case \"$OOM\" in", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwNzUzOA=="}, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU4NTE1OQ==", "bodyText": "After some experimentation, I don't think these do anything.", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r517585159", "createdAt": "2020-11-04T19:36:52Z", "author": {"login": "madrob"}, "path": "solr/docker/include/scripts/solr-fg", "diffHunk": "@@ -15,21 +15,19 @@ if [[ -z \"${OOM:-}\" ]]; then\n   OOM='none'\n fi\n case \"$OOM\" in", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwNzUzOA=="}, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzODk3MTQzOnYy", "diffSide": "RIGHT", "path": "solr/bin/solr", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0Njo0OFrOHs3k2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNjo0Njo0OFrOHs3k2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgwOTk0NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            # If a heap dump directory is specified, enable it in SOLR_OPTS\n          \n          \n            \n            if [[ -z \"$SOLR_HEAP_DUMP_DIR\" ]] && [[ \"$SOLR_HEAP_DUMP\" == \"true\" ]]; then\n          \n          \n            \n              SOLR_HEAP_DUMP_DIR=\"${SOLR_LOGS_DIR}/dumps\"\n          \n          \n            \n            fi\n          \n          \n            \n            \n          \n      \n    \n    \n  \n\nI like the idea of having a boolean flag that lets you say that you want a heap dump at the default location of heap dumps. Not a necessity, just a thought.", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r516809944", "createdAt": "2020-11-03T16:46:48Z", "author": {"login": "HoustonPutman"}, "path": "solr/bin/solr", "diffHunk": "@@ -2172,6 +2172,12 @@ function start_solr() {\n     SOLR_OPTS+=($AUTHC_OPTS)\n   fi\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63d5bcf27f5fea419503537172e3602ed80a2060"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDEzMTI3OnYy", "diffSide": "RIGHT", "path": "solr/bin/solr", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDoyNDo1OFrOHtobWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTo0NDo0OFrOHtqyGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxMDMyOA==", "bodyText": "Why are you piping the errors here? mkdir -p should be safe right?", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r517610328", "createdAt": "2020-11-04T20:24:58Z", "author": {"login": "HoustonPutman"}, "path": "solr/bin/solr", "diffHunk": "@@ -2172,6 +2172,16 @@ function start_solr() {\n     SOLR_OPTS+=($AUTHC_OPTS)\n   fi\n \n+  # If a heap dump directory is specified, enable it in SOLR_OPTS\n+  if [[ -z \"$SOLR_HEAP_DUMP_DIR\" ]] && [[ \"$SOLR_HEAP_DUMP\" == \"true\" ]]; then\n+    SOLR_HEAP_DUMP_DIR=\"${SOLR_LOGS_DIR}/dumps\"\n+  fi\n+  if [[ -n \"$SOLR_HEAP_DUMP_DIR\" ]]; then\n+    SOLR_OPTS+=(\"-XX:+HeapDumpOnOutOfMemoryError\")\n+    SOLR_OPTS+=(\"-XX:HeapDumpPath=$SOLR_HEAP_DUMP_DIR/solr-$(date +%s)-pid$$.hprof\")\n+    mkdir -p \"$SOLR_HEAP_DUMP_DIR\" 2>/dev/null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f75d6ff4f0d981136f64a28c173b5ac4a7263ec"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0ODkyMg==", "bodyText": "I was doing it to match the call at \n  \n    \n      lucene-solr/solr/bin/solr\n    \n    \n         Line 2243\n      in\n      8f75d6f\n    \n    \n    \n    \n\n        \n          \n           mkdir -p \"$SOLR_LOGS_DIR\" 2>/dev/null \n        \n    \n  \n\n but that also had additional checks afterwards. I extracted the commonality here and call that function instead.\nmkdir can fail if you don't have permissions to that directory path, which would also indicate that the process won't have permissions later to write the log files.", "url": "https://github.com/apache/lucene-solr/pull/2055#discussion_r517648922", "createdAt": "2020-11-04T21:44:48Z", "author": {"login": "madrob"}, "path": "solr/bin/solr", "diffHunk": "@@ -2172,6 +2172,16 @@ function start_solr() {\n     SOLR_OPTS+=($AUTHC_OPTS)\n   fi\n \n+  # If a heap dump directory is specified, enable it in SOLR_OPTS\n+  if [[ -z \"$SOLR_HEAP_DUMP_DIR\" ]] && [[ \"$SOLR_HEAP_DUMP\" == \"true\" ]]; then\n+    SOLR_HEAP_DUMP_DIR=\"${SOLR_LOGS_DIR}/dumps\"\n+  fi\n+  if [[ -n \"$SOLR_HEAP_DUMP_DIR\" ]]; then\n+    SOLR_OPTS+=(\"-XX:+HeapDumpOnOutOfMemoryError\")\n+    SOLR_OPTS+=(\"-XX:HeapDumpPath=$SOLR_HEAP_DUMP_DIR/solr-$(date +%s)-pid$$.hprof\")\n+    mkdir -p \"$SOLR_HEAP_DUMP_DIR\" 2>/dev/null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYxMDMyOA=="}, "originalCommit": {"oid": "8f75d6ff4f0d981136f64a28c173b5ac4a7263ec"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1054, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}