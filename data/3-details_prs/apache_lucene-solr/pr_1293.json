{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTY4OTUw", "number": 1293, "title": "SOLR-14044: Delete collection bug fix by changing sharedShardName to use the same blob delimiter", "bodyText": "In shared storage, deletion from the blob store works by listing files beginning with a certain prefix and reading from a blob store requires knowing some or all of the file name.\nThe sharedShardName, or the identifier prefixing all blob storage files per shard works by concatenating the collection name (uniqueness assumption in solr cloud overall) and the shard name with _  joining the two. _ is allowed in collection names which allows for a bug in listing files from other collections unintentionally.\nThis change changes the delimiter to use \"/\" which is more consistent with how index files stored in blob are structured anyway /<index_file_blob_name>. Piggy-backed a minor unrelated test fix in DistributedZkUpdateProcessorTest.java that I missed earlier.\nChange Summary\n\nUse \"/\" in sharedShardName\nUpdate tests\nFix DistributedZkUpdateProcessorTest which tries to delete all collections after every test. In the same cleanup method the entire tmp directory we use as a local blob store gets deleted at the same time so the collection deletion errors out and leaks threads. This is a test setup issue vs a functional one. We spin up a new cluster in the different test cases anyway so we don't need to delete all collections.", "createdAt": "2020-02-27T00:04:53Z", "url": "https://github.com/apache/lucene-solr/pull/1293", "merged": true, "mergeCommit": {"oid": "c8c216514af29d94d3f269d01f57e1c0f2421b69"}, "closed": true, "closedAt": "2020-03-05T22:01:45Z", "author": {"login": "andyvuong"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIPrk7gH2gAyMzgwNTY4OTUwOmY5MTk0YWZiNTliOGM2OTVjMjM5NzVmNTU0OWNmNTMwZjRmYTJjMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKxjB0AH2gAyMzgwNTY4OTUwOjJhNjZiNzkzYjllZmRjNzdhMmI0ZmRiMjUxZWIxOTNkZjJlZmU2ZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9194afb59b8c695c23975f5549cf530f4fa2c24", "author": {"user": {"login": "andyvuong", "name": "Andy Vuong"}}, "url": "https://github.com/apache/lucene-solr/commit/f9194afb59b8c695c23975f5549cf530f4fa2c24", "committedDate": "2020-02-26T23:53:39Z", "message": "Change sharedShardName to use blob delimiter and fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc4c4c0dfaf6a41121d348ee42e984aa82a41fdb", "author": {"user": {"login": "andyvuong", "name": "Andy Vuong"}}, "url": "https://github.com/apache/lucene-solr/commit/bc4c4c0dfaf6a41121d348ee42e984aa82a41fdb", "committedDate": "2020-03-02T20:05:13Z", "message": "Merge branch 'jira/SOLR-13101' into jira/SOLR-13101-fix-collection-delete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjQ4Nzk2", "url": "https://github.com/apache/lucene-solr/pull/1293#pullrequestreview-369248796", "createdAt": "2020-03-05T01:55:39Z", "commit": {"oid": "bc4c4c0dfaf6a41121d348ee42e984aa82a41fdb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMTo1NTozOVrOFyEAFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMTo1NTozOVrOFyEAFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzODY3Ng==", "bodyText": "Minor: use Assign.buildSharedShardName?", "url": "https://github.com/apache/lucene-solr/pull/1293#discussion_r388038676", "createdAt": "2020-03-05T01:55:39Z", "author": {"login": "mbwaheed"}, "path": "solr/core/src/test/org/apache/solr/store/blob/metadata/CorePushPullTest.java", "diffHunk": "@@ -52,7 +53,7 @@\n   private static CoreStorageClient storageClient;\n   private static Path localBlobDir;\n   \n-  private String sharedBlobName = \"collectionTest_shardTest\";\n+  private String sharedBlobName = \"collectionTest\" + BlobClientUtils.BLOB_FILE_PATH_DELIMITER + \"shardTest\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc4c4c0dfaf6a41121d348ee42e984aa82a41fdb"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a66b793b9efdc77a2b4fdb251eb193df2efe6d8", "author": {"user": {"login": "andyvuong", "name": "Andy Vuong"}}, "url": "https://github.com/apache/lucene-solr/commit/2a66b793b9efdc77a2b4fdb251eb193df2efe6d8", "committedDate": "2020-03-05T20:28:56Z", "message": "use assign in test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2154, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}