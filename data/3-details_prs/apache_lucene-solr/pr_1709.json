{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwNTk2NDAx", "number": 1709, "title": "LUCENE-9446: In boolean rewrite, remove MatchAllDocsQuery filter clauses", "bodyText": "Previously, we only removed 'match all' FILTER clauses if there was at least one\nMUST clause. Now they're also removed if there is another distinct FILTER clause.\nThis lets boolean queries like #field:value #*:* be written to #field:value.", "createdAt": "2020-07-31T23:07:44Z", "url": "https://github.com/apache/lucene-solr/pull/1709", "merged": true, "mergeCommit": {"oid": "b91a16128397d4ebaa18e926ad9f18dd9a4449f3"}, "closed": true, "closedAt": "2020-08-04T15:08:11Z", "author": {"login": "jtibshirani"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6cf_9gH2gAyNDYwNTk2NDAxOjYxZGUzZjIyYjZhMzYxODRiYzE1MjFkYTlmZmNjMzE1ZmMzYTZjYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7n4T0gFqTQ2MDg5NDU0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61de3f22b6a36184bc1521da9ffcc315fc3a6cc9", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/apache/lucene-solr/commit/61de3f22b6a36184bc1521da9ffcc315fc3a6cc9", "committedDate": "2020-07-31T23:05:59Z", "message": "LUCENE-9446: Remove MatchAllDocsQuery filters in boolean write.\n\nPreviously, we only removed 'match all' FILTER clauses if there was at least one\nMUST clause. Now they're also removed if there is another distinct FILTER clause.\n\nThis lets boolean queries like `#field:value #*:*` be written to `#field:value`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjA0NzAw", "url": "https://github.com/apache/lucene-solr/pull/1709#pullrequestreview-460204700", "createdAt": "2020-08-03T17:23:14Z", "commit": {"oid": "61de3f22b6a36184bc1521da9ffcc315fc3a6cc9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzoyMzoxNFrOG7CEFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzoyMzoxNFrOG7CEFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1Mjk4Mg==", "bodyText": "maybe also add a test for the case when there are two MatchAllDocsQuery queries as filters with no MUST clauses?", "url": "https://github.com/apache/lucene-solr/pull/1709#discussion_r464552982", "createdAt": "2020-08-03T17:23:14Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/test/org/apache/lucene/search/TestBooleanRewrites.java", "diffHunk": "@@ -312,12 +312,20 @@ public void testRemoveMatchAllFilter() throws IOException {\n         .add(new TermQuery(new Term(\"foo\", \"baz\")), Occur.MUST)\n         .add(new MatchAllDocsQuery(), Occur.FILTER)\n         .build();\n-    BooleanQuery expected = new BooleanQuery.Builder()\n+    Query expected = new BooleanQuery.Builder()\n         .setMinimumNumberShouldMatch(bq.getMinimumNumberShouldMatch())\n         .add(new TermQuery(new Term(\"foo\", \"bar\")), Occur.MUST)\n         .add(new TermQuery(new Term(\"foo\", \"baz\")), Occur.MUST)\n         .build();\n     assertEquals(expected, searcher.rewrite(bq));\n+\n+    bq = new BooleanQuery.Builder()\n+            .add(new TermQuery(new Term(\"foo\", \"bar\")), Occur.FILTER)\n+            .add(new MatchAllDocsQuery(), Occur.FILTER)\n+            .build();\n+    expected = new BoostQuery(new ConstantScoreQuery(\n+            new TermQuery(new Term(\"foo\", \"bar\"))), 0.0f);\n+    assertEquals(expected, searcher.rewrite(bq));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61de3f22b6a36184bc1521da9ffcc315fc3a6cc9"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a6d7de532a583823e3b9a4d9d7ebd1fc95c86f6", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/apache/lucene-solr/commit/4a6d7de532a583823e3b9a4d9d7ebd1fc95c86f6", "committedDate": "2020-08-03T17:34:25Z", "message": "Add another test case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa3f5b1bf0faa39c4c37e8885a031e517e3ac7f6", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/apache/lucene-solr/commit/fa3f5b1bf0faa39c4c37e8885a031e517e3ac7f6", "committedDate": "2020-08-03T17:45:18Z", "message": "Add a changelog entry."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODk0NTQ3", "url": "https://github.com/apache/lucene-solr/pull/1709#pullrequestreview-460894547", "createdAt": "2020-08-04T14:55:25Z", "commit": {"oid": "fa3f5b1bf0faa39c4c37e8885a031e517e3ac7f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2513, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}