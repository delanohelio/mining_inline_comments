{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3OTM4MDIy", "number": 2069, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyMjoyNlrOE25N_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyNToyN1rOE25ShQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTk2MDMwOnYy", "diffSide": "RIGHT", "path": "lucene/backward-codecs/src/java/org/apache/lucene/backward_codecs/lucene87/Lucene87Codec.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyMjoyNlrOHv7suw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxOToxMDo0NVrOHv9qLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzIyNw==", "bodyText": "Nice!  So we roll up the tradeoffs to Codec level which will then tell each format how to tradeoff.", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520023227", "createdAt": "2020-11-09T18:22:26Z", "author": {"login": "mikemccand"}, "path": "lucene/backward-codecs/src/java/org/apache/lucene/backward_codecs/lucene87/Lucene87Codec.java", "diffHunk": "@@ -56,6 +57,23 @@\n  * @lucene.experimental\n  */\n public class Lucene87Codec extends Codec {\n+\n+  /** Configuration option for the codec. */\n+  public static enum Mode {\n+    /** Trade compression ratio for retrieval speed. */\n+    BEST_SPEED(Lucene87StoredFieldsFormat.Mode.BEST_SPEED, Lucene80DocValuesFormat.Mode.BEST_SPEED),\n+    /** Trade retrieval speed for compression ratio. */\n+    BEST_COMPRESSION(Lucene87StoredFieldsFormat.Mode.BEST_COMPRESSION, Lucene80DocValuesFormat.Mode.BEST_COMPRESSION);\n+\n+    private final Lucene87StoredFieldsFormat.Mode storedMode;\n+    private final Lucene80DocValuesFormat.Mode dvMode;\n+\n+    private Mode(Lucene87StoredFieldsFormat.Mode storedMode, Lucene80DocValuesFormat.Mode dvMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNTQzMg==", "bodyText": "Right. It's still possible to made different choices for stored fields and doc values given that we allow configuration of doc values on a per-field basis, but this should at least keep simple use simple with one switch that configures stored fields and doc values at the same time.", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520035432", "createdAt": "2020-11-09T18:43:48Z", "author": {"login": "jpountz"}, "path": "lucene/backward-codecs/src/java/org/apache/lucene/backward_codecs/lucene87/Lucene87Codec.java", "diffHunk": "@@ -56,6 +57,23 @@\n  * @lucene.experimental\n  */\n public class Lucene87Codec extends Codec {\n+\n+  /** Configuration option for the codec. */\n+  public static enum Mode {\n+    /** Trade compression ratio for retrieval speed. */\n+    BEST_SPEED(Lucene87StoredFieldsFormat.Mode.BEST_SPEED, Lucene80DocValuesFormat.Mode.BEST_SPEED),\n+    /** Trade retrieval speed for compression ratio. */\n+    BEST_COMPRESSION(Lucene87StoredFieldsFormat.Mode.BEST_COMPRESSION, Lucene80DocValuesFormat.Mode.BEST_COMPRESSION);\n+\n+    private final Lucene87StoredFieldsFormat.Mode storedMode;\n+    private final Lucene80DocValuesFormat.Mode dvMode;\n+\n+    private Mode(Lucene87StoredFieldsFormat.Mode storedMode, Lucene80DocValuesFormat.Mode dvMode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzIyNw=="}, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA1NTM0MQ==", "bodyText": "Great!  Simple for common use cases (\"I want best compression\" or \"I want fastest search\"), and complex for complex use cases (I want separate control for each part of the index).", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520055341", "createdAt": "2020-11-09T19:10:45Z", "author": {"login": "mikemccand"}, "path": "lucene/backward-codecs/src/java/org/apache/lucene/backward_codecs/lucene87/Lucene87Codec.java", "diffHunk": "@@ -56,6 +57,23 @@\n  * @lucene.experimental\n  */\n public class Lucene87Codec extends Codec {\n+\n+  /** Configuration option for the codec. */\n+  public static enum Mode {\n+    /** Trade compression ratio for retrieval speed. */\n+    BEST_SPEED(Lucene87StoredFieldsFormat.Mode.BEST_SPEED, Lucene80DocValuesFormat.Mode.BEST_SPEED),\n+    /** Trade retrieval speed for compression ratio. */\n+    BEST_COMPRESSION(Lucene87StoredFieldsFormat.Mode.BEST_COMPRESSION, Lucene80DocValuesFormat.Mode.BEST_COMPRESSION);\n+\n+    private final Lucene87StoredFieldsFormat.Mode storedMode;\n+    private final Lucene80DocValuesFormat.Mode dvMode;\n+\n+    private Mode(Lucene87StoredFieldsFormat.Mode storedMode, Lucene80DocValuesFormat.Mode dvMode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzIyNw=="}, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTk2OTE2OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/BaseLucene80DocValuesFormatTestCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyNDo1MVrOHv7yOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0MjozNlrOHv8ZxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNDYzNA==", "bodyText": "Will this randomize between the different Mode tradeoffs?", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520024634", "createdAt": "2020-11-09T18:24:51Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/BaseLucene80DocValuesFormatTestCase.java", "diffHunk": "@@ -286,7 +278,7 @@ private void doTestTermsEnumRandom(int numDocs, Supplier<String> valuesProducer)\n     conf.setMergeScheduler(new SerialMergeScheduler());\n     // set to duel against a codec which has ordinals:\n     final PostingsFormat pf = TestUtil.getPostingsFormatWithOrds(random());\n-    final DocValuesFormat dv = new Lucene80DocValuesFormat();\n+    final DocValuesFormat dv = getCodec().docValuesFormat();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNDc1Nw==", "bodyText": "It's not randomizing, we are testing both modes explicitly via TestBestSpeedLucene80DocValuesFormat on one hand and TestBestCompressionLucene80DocValuesFormat on the other hand.", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520034757", "createdAt": "2020-11-09T18:42:36Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/BaseLucene80DocValuesFormatTestCase.java", "diffHunk": "@@ -286,7 +278,7 @@ private void doTestTermsEnumRandom(int numDocs, Supplier<String> valuesProducer)\n     conf.setMergeScheduler(new SerialMergeScheduler());\n     // set to duel against a codec which has ordinals:\n     final PostingsFormat pf = TestUtil.getPostingsFormatWithOrds(random());\n-    final DocValuesFormat dv = new Lucene80DocValuesFormat();\n+    final DocValuesFormat dv = getCodec().docValuesFormat();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNDYzNA=="}, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTk3MTg5OnYy", "diffSide": "RIGHT", "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/TestBestSpeedLucene80DocValuesFormat.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyNToyN1rOHv7zvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0MDo0NVrOHv8VdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNTAyMQ==", "bodyText": "Do we also have a dedicated TestBestCompressedLucene80DocValuesFormat?", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520025021", "createdAt": "2020-11-09T18:25:27Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/TestBestSpeedLucene80DocValuesFormat.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.lucene.codecs.lucene80;\n+\n+import org.apache.lucene.codecs.Codec;\n+import org.apache.lucene.util.TestUtil;\n+\n+/**\n+ * Tests Lucene80DocValuesFormat\n+ */\n+public class TestBestSpeedLucene80DocValuesFormat extends BaseLucene80DocValuesFormatTestCase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMTI2NA==", "bodyText": "Oh nevermind I see you opened followon issue for this: https://issues.apache.org/jira/browse/LUCENE-9602", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520031264", "createdAt": "2020-11-09T18:36:37Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/TestBestSpeedLucene80DocValuesFormat.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.lucene.codecs.lucene80;\n+\n+import org.apache.lucene.codecs.Codec;\n+import org.apache.lucene.util.TestUtil;\n+\n+/**\n+ * Tests Lucene80DocValuesFormat\n+ */\n+public class TestBestSpeedLucene80DocValuesFormat extends BaseLucene80DocValuesFormatTestCase {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNTAyMQ=="}, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMzY1Mg==", "bodyText": "You should see a TestBestCompressedLucene80DocValuesFormat file as well in this PR. I opened LUCENE-9602 specifically for backward compatibility and make sure we check in indices created by BEST_COMPRESSION in our source tree after every release to make sure we have good bw compatibility coverage.", "url": "https://github.com/apache/lucene-solr/pull/2069#discussion_r520033652", "createdAt": "2020-11-09T18:40:45Z", "author": {"login": "jpountz"}, "path": "lucene/core/src/test/org/apache/lucene/codecs/lucene80/TestBestSpeedLucene80DocValuesFormat.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.lucene.codecs.lucene80;\n+\n+import org.apache.lucene.codecs.Codec;\n+import org.apache.lucene.util.TestUtil;\n+\n+/**\n+ * Tests Lucene80DocValuesFormat\n+ */\n+public class TestBestSpeedLucene80DocValuesFormat extends BaseLucene80DocValuesFormatTestCase {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyNTAyMQ=="}, "originalCommit": {"oid": "c54f2ce667bfeee72b2d5b386b7f50557dcf8564"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1070, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}