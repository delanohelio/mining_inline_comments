{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTgxODU3", "number": 1978, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToxNzozOVrOEtqk3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo0MToxNlrOEuWDNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzE4OTQzOnYy", "diffSide": "RIGHT", "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToxNzozOVrOHhlYGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMjoxNjoxMVrOHijC8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NzQzNA==", "bodyText": "can you assert on the explanation string?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r504977434", "createdAt": "2020-10-14T21:17:39Z", "author": {"login": "jpountz"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {\n+    String queryString = \"(lorem AND NOT \\\"dolor lorem\\\") OR ipsum\";\n+    String text = \"dolor lorem ipsum\";\n+\n+    Analyzer analyzer = new MockAnalyzer(random());\n+    Query query = new ComplexPhraseQueryParser(\"content\", analyzer).parse(queryString);\n+\n+    MemoryIndex memoryIndex = new MemoryIndex(true);\n+    memoryIndex.addField(\"content\", text, analyzer);\n+\n+    IndexSearcher searcher = memoryIndex.createSearcher();\n+\n+    TopDocs topDocs = searcher.search(query, 1);\n+    ScoreDoc match = topDocs.scoreDocs[0];\n+    searcher.explain(query, match.doc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNzc2Ng==", "bodyText": "I've tried this and it seems to be a bit more complicated to do. The problem here is that under the current test setup, the new explanation string code will only be exercised when there's a match between the (none-scoring) prohibited clause and the text.  So the matched topDoc that exercised that code path will actually not include that particular explanation as it must have been matching alternative clause instead.\nTherefore, I'm considering two alternatives here. One would be to test SpanWeight#explain directly with null SimScorer; the other would be to setup another test to match span query without scoring, but I tried query with Occur.FILTER and MUST and see there's still a 1.0 boost associated and valid SimScorer. So I'm not sure if the latter approach is something actually achievable / meaningful to implement?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r505127766", "createdAt": "2020-10-15T02:31:18Z", "author": {"login": "zacharymorn"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {\n+    String queryString = \"(lorem AND NOT \\\"dolor lorem\\\") OR ipsum\";\n+    String text = \"dolor lorem ipsum\";\n+\n+    Analyzer analyzer = new MockAnalyzer(random());\n+    Query query = new ComplexPhraseQueryParser(\"content\", analyzer).parse(queryString);\n+\n+    MemoryIndex memoryIndex = new MemoryIndex(true);\n+    memoryIndex.addField(\"content\", text, analyzer);\n+\n+    IndexSearcher searcher = memoryIndex.createSearcher();\n+\n+    TopDocs topDocs = searcher.search(query, 1);\n+    ScoreDoc match = topDocs.scoreDocs[0];\n+    searcher.explain(query, match.doc);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NzQzNA=="}, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk4NzgyNQ==", "bodyText": "I've found a work-around in test and able to test with tighter condition, and assert for explanation message. Could you please let me know if this looks good to you?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r505987825", "createdAt": "2020-10-16T02:16:11Z", "author": {"login": "zacharymorn"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {\n+    String queryString = \"(lorem AND NOT \\\"dolor lorem\\\") OR ipsum\";\n+    String text = \"dolor lorem ipsum\";\n+\n+    Analyzer analyzer = new MockAnalyzer(random());\n+    Query query = new ComplexPhraseQueryParser(\"content\", analyzer).parse(queryString);\n+\n+    MemoryIndex memoryIndex = new MemoryIndex(true);\n+    memoryIndex.addField(\"content\", text, analyzer);\n+\n+    IndexSearcher searcher = memoryIndex.createSearcher();\n+\n+    TopDocs topDocs = searcher.search(query, 1);\n+    ScoreDoc match = topDocs.scoreDocs[0];\n+    searcher.explain(query, match.doc);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NzQzNA=="}, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzM4NjgzOnYy", "diffSide": "RIGHT", "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjoxMDoxOVrOHhnWnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjoxOTowMVrOHhuWsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwOTgyMA==", "bodyText": "I don't think this is specific to MemoryIndex, so can you move this test to TestSpansExplanations?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r505009820", "createdAt": "2020-10-14T22:10:19Z", "author": {"login": "jpountz"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNDUyOQ==", "bodyText": "Done", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r505124529", "createdAt": "2020-10-15T02:19:01Z", "author": {"login": "zacharymorn"}, "path": "lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java", "diffHunk": "@@ -618,4 +622,21 @@ public void testToStringDebug() {\n         \"fields=2, terms=2, positions=3\", mi.toStringDebug());\n   }\n \n+  public void testExplain() throws ParseException, IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwOTgyMA=="}, "originalCommit": {"oid": "f510fc952c383f58e04f80770aedf2615dce80d5"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MDMxMjIwOnYy", "diffSide": "RIGHT", "path": "lucene/core/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo0MToxNlrOHirwXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjoxODoxOVrOHi5gSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzMDUyNw==", "bodyText": "we should be able to remove this now?", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r506130527", "createdAt": "2020-10-16T07:41:16Z", "author": {"login": "jpountz"}, "path": "lucene/core/build.gradle", "diffHunk": "@@ -22,4 +22,5 @@ description = 'Lucene core library'\n dependencies {\n   testImplementation project(':lucene:codecs')\n   testImplementation project(':lucene:test-framework')\n+  testImplementation project(':lucene:queryparser')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM1NTc4Nw==", "bodyText": "Ops yes removed.", "url": "https://github.com/apache/lucene-solr/pull/1978#discussion_r506355787", "createdAt": "2020-10-16T12:18:19Z", "author": {"login": "zacharymorn"}, "path": "lucene/core/build.gradle", "diffHunk": "@@ -22,4 +22,5 @@ description = 'Lucene core library'\n dependencies {\n   testImplementation project(':lucene:codecs')\n   testImplementation project(':lucene:test-framework')\n+  testImplementation project(':lucene:queryparser')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzMDUyNw=="}, "originalCommit": {"oid": "9d96fe6a5e177df1d3fcb617cb13cfefb4ff674b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1147, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}