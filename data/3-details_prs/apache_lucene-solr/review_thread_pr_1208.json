{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDUwMjY4", "number": 1208, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMzoxMDoyM1rODaonHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxODoxNzoxMFrODdFAiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjU0OTQyOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/store/blob/metadata/CorePushPull.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMzoxMDoyM1rOFhszLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQwMDowMjoxM1rOFhtcCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg4MTMyNg==", "bodyText": "From what I could find, deletedAt and deleteDelay is only set using System.nanoTime/1000000, so there should not be any mismatch from comparing times that used nanoTime and times that used currentTimeMillis", "url": "https://github.com/apache/lucene-solr/pull/1208#discussion_r370881326", "createdAt": "2020-01-24T23:10:23Z", "author": {"login": "ebehrendt"}, "path": "solr/core/src/java/org/apache/solr/store/blob/metadata/CorePushPull.java", "diffHunk": "@@ -499,7 +500,7 @@ void enqueueForHardDelete(BlobCoreMetadataBuilder bcmBuilder) throws Exception {\n     @VisibleForTesting\n     protected boolean okForHardDelete(BlobCoreMetadata.BlobFileToDelete file) {\n       // For now we only check how long ago the file was marked for delete.\n-      return System.nanoTime() - file.getDeletedAt() >= deleteManager.getDeleteDelayMs();\n+      return (System.nanoTime() / 1000000) - file.getDeletedAt() >= deleteManager.getDeleteDelayMs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c0e904cb4f94fc5bb21f7e03ef288744f582dde"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5MTc4Nw==", "bodyText": "It might be a good idea to update the BlobFileToDelete class to make it explicit via the javadoc (actually it doesn't have any) that the getDeletedAt() returns the timestamp in milliseconds", "url": "https://github.com/apache/lucene-solr/pull/1208#discussion_r370891787", "createdAt": "2020-01-25T00:02:13Z", "author": {"login": "andyvuong"}, "path": "solr/core/src/java/org/apache/solr/store/blob/metadata/CorePushPull.java", "diffHunk": "@@ -499,7 +500,7 @@ void enqueueForHardDelete(BlobCoreMetadataBuilder bcmBuilder) throws Exception {\n     @VisibleForTesting\n     protected boolean okForHardDelete(BlobCoreMetadata.BlobFileToDelete file) {\n       // For now we only check how long ago the file was marked for delete.\n-      return System.nanoTime() - file.getDeletedAt() >= deleteManager.getDeleteDelayMs();\n+      return (System.nanoTime() / 1000000) - file.getDeletedAt() >= deleteManager.getDeleteDelayMs();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg4MTMyNg=="}, "originalCommit": {"oid": "6c0e904cb4f94fc5bb21f7e03ef288744f582dde"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjYxNjM3OnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/store/blob/metadata/CorePushPull.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQwMDowMzowMFrOFhtciQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQwMDowMzowMFrOFhtciQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5MTkxMw==", "bodyText": "I'd consider making System.nanoTime() / 1000000 a util method in BlobStoreUtils", "url": "https://github.com/apache/lucene-solr/pull/1208#discussion_r370891913", "createdAt": "2020-01-25T00:03:00Z", "author": {"login": "andyvuong"}, "path": "solr/core/src/java/org/apache/solr/store/blob/metadata/CorePushPull.java", "diffHunk": "@@ -114,7 +114,7 @@ protected CoreContainer getContainerFromServerMetadata(ServerSideMetadata solrSe\n      * @param newMetadataSuffix suffix of the new core.metadata file to be created as part of this push\n      */\n     public BlobCoreMetadata pushToBlobStore(String currentMetadataSuffix, String newMetadataSuffix) throws Exception {\n-      long startTimeMs = System.nanoTime();\n+      long startTimeMs = System.nanoTime() / 1000000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c0e904cb4f94fc5bb21f7e03ef288744f582dde"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODE3MzUyOnYy", "diffSide": "RIGHT", "path": "solr/core/src/java/org/apache/solr/store/blob/util/BlobStoreUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxODoxNzoxMFrOFleXrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0Mjo0MlrOFlhDhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgzOTIxNQ==", "bodyText": "Why not just call it getCurrentTimeMs and let the javadoc make it clear it's not the same as System.currentTimeMillis(), the main reason being it was changed originally to fix ant precommit failures?", "url": "https://github.com/apache/lucene-solr/pull/1208#discussion_r374839215", "createdAt": "2020-02-04T18:17:10Z", "author": {"login": "andyvuong"}, "path": "solr/core/src/java/org/apache/solr/store/blob/util/BlobStoreUtils.java", "diffHunk": "@@ -75,6 +76,16 @@ public static String generateMetadataSuffix() {\n     return UUID.randomUUID().toString();\n   }\n \n+  /**\n+   * Returns current nano time in millisecond resolution for use in measuring elapsed time.\n+   * \n+   * Note: Do not combine this value with currentTimeMillis - currentTimeMillis will return ms relative to epoch\n+   * while this method returns ms relative to some arbitrary time\n+   */\n+  public static long getCurrentNanoTimeInMs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf4bbfeac67a4493b24cefbf74cf60dd885db6a5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4MzIwNQ==", "bodyText": "Sure - I had named this way to avoid combining with currentTimeMillis but if the javadoc is good enough for that I'll rename", "url": "https://github.com/apache/lucene-solr/pull/1208#discussion_r374883205", "createdAt": "2020-02-04T19:42:42Z", "author": {"login": "ebehrendt"}, "path": "solr/core/src/java/org/apache/solr/store/blob/util/BlobStoreUtils.java", "diffHunk": "@@ -75,6 +76,16 @@ public static String generateMetadataSuffix() {\n     return UUID.randomUUID().toString();\n   }\n \n+  /**\n+   * Returns current nano time in millisecond resolution for use in measuring elapsed time.\n+   * \n+   * Note: Do not combine this value with currentTimeMillis - currentTimeMillis will return ms relative to epoch\n+   * while this method returns ms relative to some arbitrary time\n+   */\n+  public static long getCurrentNanoTimeInMs() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgzOTIxNQ=="}, "originalCommit": {"oid": "cf4bbfeac67a4493b24cefbf74cf60dd885db6a5"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 896, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}