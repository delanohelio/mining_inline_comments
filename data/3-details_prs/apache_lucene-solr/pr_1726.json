{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODAzNjc1", "number": 1726, "title": "SOLR-14722: timeAllowed should track from req creation", "bodyText": "https://issues.apache.org/jira/browse/SOLR-14722", "createdAt": "2020-08-07T20:31:27Z", "url": "https://github.com/apache/lucene-solr/pull/1726", "merged": true, "mergeCommit": {"oid": "0ce2d610c2e3524b1cb819d9cd2a5e2ccb190bd0"}, "closed": true, "closedAt": "2020-08-15T04:41:08Z", "author": {"login": "dsmiley"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8qcGxgH2gAyNDY0ODAzNjc1OmVmOWRiYzliZDc4YWFmMGE5N2EwM2ZjZWI5MTZlOGFlNzE5OTZiNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-7hM3gH2gAyNDY0ODAzNjc1OjliMjhkYmZlZTA5YzE3YjYyMjAyNDExOTNhNjU4N2FkYWI0NTRlOWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63", "committedDate": "2020-08-07T20:28:15Z", "message": "SOLR-14722: timeAllowed should track from req creation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTk0MzI1", "url": "https://github.com/apache/lucene-solr/pull/1726#pullrequestreview-463594325", "createdAt": "2020-08-07T20:32:40Z", "commit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDozMjo0MVrOG9nB7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDozMjo0MVrOG9nB7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1NTc5MA==", "bodyText": "For back-compat sake, on 8x I could retain the former method as Deprecated... but I'm unsure if anyone calls it.", "url": "https://github.com/apache/lucene-solr/pull/1726#discussion_r467255790", "createdAt": "2020-08-07T20:32:41Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/search/SolrQueryTimeoutImpl.java", "diffHunk": "@@ -42,23 +44,23 @@ public static SolrQueryTimeoutImpl getInstance() {\n   }\n \n   /**\n-   * Get the current value of timeoutAt.\n+   * The time (nanoseconds) at which the request should be considered timed out.\n    */\n-  public static Long get() {\n+  public static Long getTimeoutAtNs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzM1OTUy", "url": "https://github.com/apache/lucene-solr/pull/1726#pullrequestreview-464735952", "createdAt": "2020-08-11T04:13:04Z", "commit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoxMzowNFrOG-nugg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwNDoxNjo0OFrOG-nx-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxNTc3OA==", "bodyText": "should this be a primitive instead of a boxed type?", "url": "https://github.com/apache/lucene-solr/pull/1726#discussion_r468315778", "createdAt": "2020-08-11T04:13:04Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/search/SolrQueryTimeoutImpl.java", "diffHunk": "@@ -67,8 +69,21 @@ public boolean shouldExit() {\n   }\n \n   /**\n-   * Method to set the time at which the timeOut should happen.\n-   * @param timeAllowed set the time at which this thread should timeout.\n+   * Sets or clears the time allowed based on how much time remains from the start of the request plus the configured\n+   * {@link CommonParams#TIME_ALLOWED}.\n+   */\n+  public static void set(SolrQueryRequest req) {\n+    long timeAllowed = req.getParams().getLong(CommonParams.TIME_ALLOWED, -1L);\n+    if (timeAllowed >= 0L) {\n+      set(timeAllowed - (long)req.getRequestTimer().getTime()); // reduce by time already spent\n+    } else {\n+      reset();\n+    }\n+  }\n+\n+  /**\n+   * Sets the time allowed (milliseconds), assuming we start a timer immediately.\n+   * You should probably invoke {@link #set(SolrQueryRequest)} instead.\n    */\n   public static void set(Long timeAllowed) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxNjY2NA==", "bodyText": "Should be >, not >=. Doc on time allowed state that zero is no timeout, not immediate timeout. Looks like we were previously inconsistent about this.", "url": "https://github.com/apache/lucene-solr/pull/1726#discussion_r468316664", "createdAt": "2020-08-11T04:16:48Z", "author": {"login": "madrob"}, "path": "solr/core/src/java/org/apache/solr/search/SolrQueryTimeoutImpl.java", "diffHunk": "@@ -67,8 +69,21 @@ public boolean shouldExit() {\n   }\n \n   /**\n-   * Method to set the time at which the timeOut should happen.\n-   * @param timeAllowed set the time at which this thread should timeout.\n+   * Sets or clears the time allowed based on how much time remains from the start of the request plus the configured\n+   * {@link CommonParams#TIME_ALLOWED}.\n+   */\n+  public static void set(SolrQueryRequest req) {\n+    long timeAllowed = req.getParams().getLong(CommonParams.TIME_ALLOWED, -1L);\n+    if (timeAllowed >= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef9dbc9bd78aaf0a97a03fceb916e8ae71996b63"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7173f2bc002f9c3d49bc3911e4a46224678b215f", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/7173f2bc002f9c3d49bc3911e4a46224678b215f", "committedDate": "2020-08-11T16:44:57Z", "message": "set(long) instead of set(Long).\nAnd other minor warnings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjkxNjYy", "url": "https://github.com/apache/lucene-solr/pull/1726#pullrequestreview-465291662", "createdAt": "2020-08-11T17:45:28Z", "commit": {"oid": "7173f2bc002f9c3d49bc3911e4a46224678b215f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f2c070f5ee356a074e3491fd0a2b4857b68a727", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/7f2c070f5ee356a074e3491fd0a2b4857b68a727", "committedDate": "2020-08-12T14:14:49Z", "message": "Fix javadocs CommonParams.TIME_ALLOWED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9181f44ee319018a8cfb0ab3d38f01fc58ff7dfe", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/9181f44ee319018a8cfb0ab3d38f01fc58ff7dfe", "committedDate": "2020-08-14T21:27:51Z", "message": "Merge branch 'master' into solr14722_solrQueryTimeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b28dbfee09c17b6220241193a6587adab454e9c", "author": {"user": {"login": "dsmiley", "name": "David Smiley"}}, "url": "https://github.com/apache/lucene-solr/commit/9b28dbfee09c17b6220241193a6587adab454e9c", "committedDate": "2020-08-14T21:30:03Z", "message": "changes.txt"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2333, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}