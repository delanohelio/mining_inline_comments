{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNjA1MzQ5", "number": 1617, "title": "LUCENE-8962: Merge small segments on commit", "bodyText": "This PR revisits the merge-on-commit patch submitted by @msfroh a little while ago. The only change from that earlier PR is a fix for failures uncovered by TestIndexWriter.testRandomOperations, some whitespace cleanups, and a rebase on the current master branch. The problem was that updateSegmentInfosOnMergeFinish would incorrectly decRef a merged segments' files if that segment was modified by deletions (or updates) while it was being merged.\nWith this fix, I ran the failing test case several thousands of times with no failures, whereas before it would routinely fail after a few hundred test runs.\nCo-authored-by: Michael Froh msfroh@apache.org\nCo-authored-by: Michael Sokolov sokolov@falutin.net\nThis is the third try after the patch itself and #1552", "createdAt": "2020-06-26T14:04:51Z", "url": "https://github.com/apache/lucene-solr/pull/1617", "merged": true, "mergeCommit": {"oid": "7f352a96659b4d304ae3ef0c7a1b62784ce2a406"}, "closed": true, "closedAt": "2020-06-27T20:25:46Z", "author": {"login": "s1monw"}, "timelineItems": {"totalCount": 49, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnueDJgH2gAyNDQwNjA1MzQ5OjY0MmU1NmFiYTg1OTQ3YmEyODBlMzA5MTdiNjFiZGY2MDVjMGFhNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvdBdlAH2gAyNDQwNjA1MzQ5OmMzNjhmNmRhYjIxYTNjMjlmYzk1MmVlYTU4MmZlZDRhNWE0NDA2YmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "642e56aba85947ba280e30917b61bdf605c0aa51", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/642e56aba85947ba280e30917b61bdf605c0aa51", "committedDate": "2020-06-03T19:17:35Z", "message": "Revert \"Revert \"LUCENE-8962\"\"\n\nThis reverts commit 4501b3d3fdbc35af99bde6abe7432cfc5e8b5547.\n\nThis reverts commit 075adac59865b3277adcf86052f2fae3e6d11135."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab5ef5e6f2bdcda59fd669a298ec1377777af9d", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/cab5ef5e6f2bdcda59fd669a298ec1377777af9d", "committedDate": "2020-06-03T19:17:35Z", "message": "Fix case where mergeOnCommit would attempt to delete files twice in the presence of deletions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf0f7990e919e9f5428ff4546bb936bfe1b13a3e", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/bf0f7990e919e9f5428ff4546bb936bfe1b13a3e", "committedDate": "2020-06-12T21:55:26Z", "message": "fix test failures caused by attempt to merge a no-segments merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a707bb4f9e0cb4964b56dddd9f1f001a88f7c9d1", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/a707bb4f9e0cb4964b56dddd9f1f001a88f7c9d1", "committedDate": "2020-06-17T21:00:20Z", "message": "Merge branch 'master' into jira/lucene-8962"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85a4193223807f40e80b89d26a4ac53b83180178", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/85a4193223807f40e80b89d26a4ac53b83180178", "committedDate": "2020-06-17T21:11:54Z", "message": "current state of affairs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1fe0d21754f92d4c2a61d43356315a8ab95a129", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/e1fe0d21754f92d4c2a61d43356315a8ab95a129", "committedDate": "2020-06-17T22:12:44Z", "message": "LUCENE-9408: roll back only called once enforcement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d6bb8f487557d48913b79b8b90386ab3c949279", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/4d6bb8f487557d48913b79b8b90386ab3c949279", "committedDate": "2020-06-17T22:12:44Z", "message": "remove debug code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "650da5431ed9803d03cbc46271c1ca8aee42d35e", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/650da5431ed9803d03cbc46271c1ca8aee42d35e", "committedDate": "2020-06-17T22:12:52Z", "message": "Ensure we stop adding to the new commit once we stopped waiting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d84691652973aff9aa387a1730a9779939541bd5", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d84691652973aff9aa387a1730a9779939541bd5", "committedDate": "2020-06-17T22:20:20Z", "message": "cut over to long for waitOnCommit and default to 0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9448ff07cc627155dd9e6902971145714270c8b6", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/9448ff07cc627155dd9e6902971145714270c8b6", "committedDate": "2020-06-17T22:22:30Z", "message": "remove IndexWriterEvents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8e26ebc6499b7c18c3d5d562ae5ddee6245d629", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/c8e26ebc6499b7c18c3d5d562ae5ddee6245d629", "committedDate": "2020-06-17T22:30:13Z", "message": "remove dead code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4cfc88567744f786c7ea1994969e2abe25e8f11", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d4cfc88567744f786c7ea1994969e2abe25e8f11", "committedDate": "2020-06-17T22:33:06Z", "message": "Merge branch 'master' into jira/lucene-8962"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "338478ab66998a24b4e71c79b08ce5c9c96cb988", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/338478ab66998a24b4e71c79b08ce5c9c96cb988", "committedDate": "2020-06-17T22:40:28Z", "message": "remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d19e1cde9967228d128639d3b5d295bb9afa2d98", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d19e1cde9967228d128639d3b5d295bb9afa2d98", "committedDate": "2020-06-18T07:27:46Z", "message": "apply fixes for review commnets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a096f76520f222db335f67db694184276832bf3", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/0a096f76520f222db335f67db694184276832bf3", "committedDate": "2020-06-18T07:37:21Z", "message": "fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea750da32128aaf0b5bdf5c62c7bfa2655b87b4f", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/ea750da32128aaf0b5bdf5c62c7bfa2655b87b4f", "committedDate": "2020-06-24T16:12:37Z", "message": "Merge branch 'master' into jira/lucene-8962"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29875f964deb4cd04d88ac9b357f0fa0e615237", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/c29875f964deb4cd04d88ac9b357f0fa0e615237", "committedDate": "2020-06-24T16:14:44Z", "message": "add failing test for carry-over deletes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a533094c1479e9e350ad7f364e64f6ec362a62d0", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/a533094c1479e9e350ad7f364e64f6ec362a62d0", "committedDate": "2020-06-24T16:23:50Z", "message": "pimp test to randomly use soft-deletes which also check if DV updates work accordingly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "189244b60a137626d5029e1e56899da3acb2f340", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/189244b60a137626d5029e1e56899da3acb2f340", "committedDate": "2020-06-24T16:27:37Z", "message": "LUCENE-8962: Ensure we don't include fully deleted segments in a commit\n\nIW might drop segments that are merged into a fully deleted segment on the floor\nand deletes the newly created files right away. We should not include these segments\nin a commit since we can't guarantee valid ref-counts on these files."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff17e876c61ba5ecfa4a791527c8a73e1d3f8d5c", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/ff17e876c61ba5ecfa4a791527c8a73e1d3f8d5c", "committedDate": "2020-06-24T16:27:53Z", "message": "add prototype to preserve atomicity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b12a00ab82a993683788913092bf918367876e", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d9b12a00ab82a993683788913092bf918367876e", "committedDate": "2020-06-24T16:28:57Z", "message": "ensure we actually apply the updates in the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aa937ef156bd461b423d50abcdb4c01c2af9d79", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/2aa937ef156bd461b423d50abcdb4c01c2af9d79", "committedDate": "2020-06-24T16:50:04Z", "message": "apply comments from #1601"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09187e8b305c195e57ff81a174cefa548669c70f", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/09187e8b305c195e57ff81a174cefa548669c70f", "committedDate": "2020-06-24T19:33:40Z", "message": "Merge branch 'master' into jira/lucene-8962"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179a730006e9d2462ae6e7ded9c8a21bf014a224", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/179a730006e9d2462ae6e7ded9c8a21bf014a224", "committedDate": "2020-06-24T20:10:43Z", "message": "add test and infrastructure to ensure readers are closed when merges are aborted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "827334deef23236884c76deeda17e38f1d950725", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/827334deef23236884c76deeda17e38f1d950725", "committedDate": "2020-06-24T20:11:19Z", "message": "remove TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "976397ad6500764dba5e998b7c4e6c13bb73569b", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/976397ad6500764dba5e998b7c4e6c13bb73569b", "committedDate": "2020-06-24T20:40:23Z", "message": "add a test to stress updateing the same doc wiht merge on commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c37d08cafaacd7532089e352255ca303340c5fe", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/5c37d08cafaacd7532089e352255ca303340c5fe", "committedDate": "2020-06-24T22:53:21Z", "message": "fix some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206eea3347ef9ed648fff9ba6100de7c8cea1d69", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/206eea3347ef9ed648fff9ba6100de7c8cea1d69", "committedDate": "2020-06-25T07:11:02Z", "message": "fix more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0e2cf61f120209a9b0a4e898795ef4e85b7074d", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/e0e2cf61f120209a9b0a4e898795ef4e85b7074d", "committedDate": "2020-06-25T08:55:39Z", "message": "harden closing merge readers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bcce44d62823f0d0d37ca5f0bda0ab0e5ef7c71", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/3bcce44d62823f0d0d37ca5f0bda0ab0e5ef7c71", "committedDate": "2020-06-25T09:21:38Z", "message": "add comments to explain what the hell we are doing here"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d895593edfda89ed005c61c1aea515132fc53eb9", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d895593edfda89ed005c61c1aea515132fc53eb9", "committedDate": "2020-06-25T09:24:27Z", "message": "rarely wait longer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e17717fb2c986fb4e199830df89dfa4012811a7", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/4e17717fb2c986fb4e199830df89dfa4012811a7", "committedDate": "2020-06-25T09:35:07Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8463279b077a0d4d69c5c48efd1c91ee857fcfe2", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/8463279b077a0d4d69c5c48efd1c91ee857fcfe2", "committedDate": "2020-06-25T10:16:22Z", "message": "ensure merge readers are dropped from the list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9722b339d8851a4ed7a228f996f97f298189be3", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/d9722b339d8851a4ed7a228f996f97f298189be3", "committedDate": "2020-06-25T10:27:56Z", "message": "orgnaize imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f3e26c3cedfefb91e01a70011d630aed37ba314", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/0f3e26c3cedfefb91e01a70011d630aed37ba314", "committedDate": "2020-06-26T06:56:00Z", "message": "wait forevery in this test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a9580b8e3016294232e4eda0824748169a292bb", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/2a9580b8e3016294232e4eda0824748169a292bb", "committedDate": "2020-06-26T13:15:48Z", "message": "cleanup after broken merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56351688673a7ce35cfa57a3bbdf9bb53a79e3b9", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/56351688673a7ce35cfa57a3bbdf9bb53a79e3b9", "committedDate": "2020-06-26T13:18:53Z", "message": "also remove merge from pending"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e13b062763c54e2b9c0a3e7161109cabd6c842", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/20e13b062763c54e2b9c0a3e7161109cabd6c842", "committedDate": "2020-06-26T13:19:03Z", "message": "remove nl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bafae889a97850087f5804dc17dc86f555824e5", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/1bafae889a97850087f5804dc17dc86f555824e5", "committedDate": "2020-06-26T14:16:12Z", "message": "fix import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77152e3c38c05f3c960978f491d0677aa2ccb099", "author": {"user": null}, "url": "https://github.com/apache/lucene-solr/commit/77152e3c38c05f3c960978f491d0677aa2ccb099", "committedDate": "2020-06-26T16:09:43Z", "message": "wordsmithing javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDExNTk2", "url": "https://github.com/apache/lucene-solr/pull/1617#pullrequestreview-438411596", "createdAt": "2020-06-26T15:56:52Z", "commit": {"oid": "1bafae889a97850087f5804dc17dc86f555824e5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Njo1MlrOGpmJIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNjo0MTo0OVrOGpnkgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2OTcyOA==", "bodyText": "Hmm is there some (sneaky) reason why we couldn't just do this.mergeReaders = new ArrayList<>(segments.size()); above and then append to that list?  Instead of appending to private ArrayList and then making a copy in the end?", "url": "https://github.com/apache/lucene-solr/pull/1617#discussion_r446269728", "createdAt": "2020-06-26T15:56:52Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/MergePolicy.java", "diffHunk": "@@ -399,6 +416,40 @@ boolean hasFinished() {\n     Optional<Boolean> hasCompletedSuccessfully() {\n       return Optional.ofNullable(mergeCompleted.getNow(null));\n     }\n+\n+\n+    /**\n+     * Called before the merge is committed\n+     */\n+    void onMergeCommit() {\n+    }\n+\n+    /**\n+     * Sets the merge readers for this merge.\n+     */\n+    void initMergeReaders(IOUtils.IOFunction<SegmentCommitInfo, MergeReader> readerFactory) throws IOException {\n+      assert mergeReaders.isEmpty() : \"merge readers must be empty\";\n+      assert mergeCompleted.isDone() == false : \"merge is already done\";\n+      ArrayList<MergeReader> readers = new ArrayList<>(segments.size());\n+      try {\n+        for (final SegmentCommitInfo info : segments) {\n+          // Hold onto the \"live\" reader; we will use this to\n+          // commit merged deletes\n+          readers.add(readerFactory.apply(info));\n+        }\n+      } finally {\n+        // ensure we assign this to close them in the case of an exception\n+        this.mergeReaders = List.copyOf(readers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bafae889a97850087f5804dc17dc86f555824e5"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI5MzEyMw==", "bodyText": "Hmm how did this sneak in?", "url": "https://github.com/apache/lucene-solr/pull/1617#discussion_r446293123", "createdAt": "2020-06-26T16:41:49Z", "author": {"login": "mikemccand"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriterConfig.java", "diffHunk": "@@ -459,6 +463,27 @@ public IndexWriterConfig setCommitOnClose(boolean commitOnClose) {\n     return this;\n   }\n \n+  /**\n+   * Expert: sets the amount of time to wait for merges returned by MergePolicy.findFullFlushMerges(...).\n+   * If this time is reached, we proceed with the commit based on segments merged up to that point.\n+   * The merges are not cancelled, and will still run to completion independent of the commit\n+   * like normal segment merges. The default is <code>{@value IndexWriterConfig#DEFAULT_MAX_COMMIT_MERGE_WAIT_MILLIS}</code>.\n+   *\n+   * Note: This settings has no effect unless {@link MergePolicy#findFullFlushMerges(MergeTrigger, SegmentInfos, MergePolicy.MergeContext)}\n+   * has an implementation that actually returns merges which by default doesn't return any merges.\n+   */\n+  public IndexWriterConfig setMaxCommitMergeWaitMillis(long maxCommitMergeWaitMillis) {\n+    this.maxCommitMergeWaitMillis = maxCommitMergeWaitMillis;\n+    return this;\n+  }\n+\n+  /** We only allow sorting on these types */\n+  private static final EnumSet<SortField.Type> ALLOWED_INDEX_SORT_TYPES = EnumSet.of(SortField.Type.STRING,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77152e3c38c05f3c960978f491d0677aa2ccb099"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3af907f511f022659b0402e5c150b1247453ff", "author": {"user": {"login": "mikemccand", "name": "Michael McCandless"}}, "url": "https://github.com/apache/lucene-solr/commit/3d3af907f511f022659b0402e5c150b1247453ff", "committedDate": "2020-06-26T17:43:39Z", "message": "LUCENE-8962: tweak comments/javadoc, rename one method (onMergeCommit -> onMergeCompleted)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "478fe9c681092f4cf1020a51b7a50fa24eb80db5", "author": {"user": {"login": "mikemccand", "name": "Michael McCandless"}}, "url": "https://github.com/apache/lucene-solr/commit/478fe9c681092f4cf1020a51b7a50fa24eb80db5", "committedDate": "2020-06-26T18:57:23Z", "message": "LUCENE-8962: remove ghost EnumSet code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbca89687ddcda15badfee1ae01e883295da51c6", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/fbca89687ddcda15badfee1ae01e883295da51c6", "committedDate": "2020-06-26T19:50:25Z", "message": "leave comment why we use List.copyOf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTU4OTc3", "url": "https://github.com/apache/lucene-solr/pull/1617#pullrequestreview-438558977", "createdAt": "2020-06-26T19:56:22Z", "commit": {"oid": "fbca89687ddcda15badfee1ae01e883295da51c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOTo1NjoyMlrOGps_VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxOTo1NjoyMlrOGps_VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4MTkwOA==", "bodyText": "I am torn if we'd use a double or long here. I think we used double in other places but I do like a discrete value better...", "url": "https://github.com/apache/lucene-solr/pull/1617#discussion_r446381908", "createdAt": "2020-06-26T19:56:22Z", "author": {"login": "s1monw"}, "path": "lucene/core/src/java/org/apache/lucene/index/IndexWriterConfig.java", "diffHunk": "@@ -459,6 +463,21 @@ public IndexWriterConfig setCommitOnClose(boolean commitOnClose) {\n     return this;\n   }\n \n+  /**\n+   * Expert: sets the amount of time to wait for merges (during {@link IndexWriter#commit}) returned by\n+   * MergePolicy.findFullFlushMerges(...).\n+   * If this time is reached, we proceed with the commit based on segments merged up to that point.\n+   * The merges are not cancelled, and will still run to completion independent of the commit,\n+   * like natural segment merges. The default is <code>{@value IndexWriterConfig#DEFAULT_MAX_COMMIT_MERGE_WAIT_MILLIS}</code>.\n+   *\n+   * Note: This settings has no effect unless {@link MergePolicy#findFullFlushMerges(MergeTrigger, SegmentInfos, MergePolicy.MergeContext)}\n+   * has an implementation that actually returns merges which by default doesn't return any merges.\n+   */\n+  public IndexWriterConfig setMaxCommitMergeWaitMillis(long maxCommitMergeWaitMillis) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbca89687ddcda15badfee1ae01e883295da51c6"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8235076e07fd15ebac1a61289e378dde1519047a", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/8235076e07fd15ebac1a61289e378dde1519047a", "committedDate": "2020-06-26T20:02:09Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5078c3f36c6ce60b747705a1fc12f1a6d3a8e711", "author": {"user": {"login": "s1monw", "name": "Simon Willnauer"}}, "url": "https://github.com/apache/lucene-solr/commit/5078c3f36c6ce60b747705a1fc12f1a6d3a8e711", "committedDate": "2020-06-26T20:56:37Z", "message": "fix TestPhraseWildcardQuery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae8ac0cba211b0dba497944cf40b526cb697fe65", "author": {"user": {"login": "mikemccand", "name": "Michael McCandless"}}, "url": "https://github.com/apache/lucene-solr/commit/ae8ac0cba211b0dba497944cf40b526cb697fe65", "committedDate": "2020-06-26T23:03:06Z", "message": "LUCENE-8962: add some IndexWriter verbosity about what commit-on-merge is doing; fix test case to use deterministic merging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c368f6dab21a3c29fc952eea582fed4a5a4406ba", "author": {"user": {"login": "mikemccand", "name": "Michael McCandless"}}, "url": "https://github.com/apache/lucene-solr/commit/c368f6dab21a3c29fc952eea582fed4a5a4406ba", "committedDate": "2020-06-27T19:29:22Z", "message": "LUCENE-8962: fix TestPhraseWildcardQuery to never merge its two required segments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2428, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}