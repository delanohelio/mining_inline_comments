{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NjAwMjQ2", "number": 1707, "title": "SOLR-14692: Allow 'method' specification on JSON Facet join domain transforms", "bodyText": "Description\nSolr offers several different join implementations which can be switched off providing the \"method\" local-param on JoinQuery's.  Each of these implementations has different performance characteristics and can behave very differently depending on a user's data and use case.\nWhen joins are used internally as a part of JSON Faceting's \"join\" domain-transform though, users have no way to specify which implementation they would like to use.  We should correct this by adding a \"method\" property to the join domain-transform.  This will let user's choose the join that's most performant for their use case during JSON Facet requests.\nSolution\nAdds parsing to FacetRequest for a 'method' value, which is then forwarded to JoinQParserPlugin.createJoinQuery to create the appropriate join-type.\nTests\nNone, yet.\nChecklist\nPlease review the following and check all that apply:\n\n I have reviewed the guidelines for How to Contribute and my code conforms to the standards described there to the best of my ability.\n I have created a Jira issue and added the issue ID to my pull request title.\n I have given Solr maintainers access to contribute to my PR branch. (optional but recommended)\n I have developed this patch against the master branch.\n I have run ant precommit and the appropriate test suite.\n I have added tests for my changes.\n I have added documentation for the Ref Guide (for Solr changes only).", "createdAt": "2020-07-30T21:02:13Z", "url": "https://github.com/apache/lucene-solr/pull/1707", "merged": true, "mergeCommit": {"oid": "5887032e95953a8d93d723e1a5210793472def71"}, "closed": true, "closedAt": "2020-08-11T12:21:08Z", "author": {"login": "gerlowskija"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6BrR2AH2gAyNDU5NjAwMjQ2OjA4NDBmNmZhZmJmOWYyMTM4OGY4YzkzY2NmYjgzOWU2MjNkZmQ0NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc908fiAH2gAyNDU5NjAwMjQ2OjljMDE1ZTY5MDNmN2U0OGM2ZmQ1OTNlZDgwN2I1NmFiOWQ4Mjg4ZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0840f6fafbf9f21388f8c93ccfb839e623dfd444", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/0840f6fafbf9f21388f8c93ccfb839e623dfd444", "committedDate": "2020-07-30T15:50:52Z", "message": "Plumb 'method' parameter over to JoinQParserPlugin.createJoinQuery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d0f6d59ee01c92ad30fd03cfaa7a50ac95e87a", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/83d0f6d59ee01c92ad30fd03cfaa7a50ac95e87a", "committedDate": "2020-07-30T20:56:45Z", "message": "Obey 'method' parameter passed into JoinQParserPlugin.createJoinQuery\n\nRemaining todo items before this effort is fit for merging:\n  - tests\n  - figure out whether method=scoreWithDV is fit for use\n  - figure out whether method=crossCollection is fit for use\n  - figure out whether method=topLevelDV uses TPI by default or whether\n    we should be tweaking the query params there in some way to force\n    TPI behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64b723227410f1e401fb945314989361e54b6c3d", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/64b723227410f1e401fb945314989361e54b6c3d", "committedDate": "2020-07-31T14:45:20Z", "message": "Improve invalid-method error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71dadd916540381987a21124e9b2262c84a5963a", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/71dadd916540381987a21124e9b2262c84a5963a", "committedDate": "2020-07-31T14:46:09Z", "message": "Correct out-of-date input validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efbdfc9e50280ca44647698c13bffaf82342a594", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/efbdfc9e50280ca44647698c13bffaf82342a594", "committedDate": "2020-07-31T15:58:59Z", "message": "Add join-domain support for 'dvWithScore' method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af3607f59bd406030a0f126477b002297812edf7", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/af3607f59bd406030a0f126477b002297812edf7", "committedDate": "2020-07-31T16:01:46Z", "message": "Use JoinField constants more widely"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8424a1cba4c06150ff9f63f384190d6179ca70f6", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/8424a1cba4c06150ff9f63f384190d6179ca70f6", "committedDate": "2020-07-31T17:24:12Z", "message": "Add unit tests for new 'method' join domain property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cfb49ae5ed59a8d32be291ef39e139ae752323e", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/0cfb49ae5ed59a8d32be291ef39e139ae752323e", "committedDate": "2020-07-31T17:42:55Z", "message": "Document 'method' Join domain-change property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "703ba5a1f1b669edf88a9b623fe1d95b212a3835", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/703ba5a1f1b669edf88a9b623fe1d95b212a3835", "committedDate": "2020-07-31T18:25:50Z", "message": "Fix unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ef72236e71113066b92dfbfa9da0fc876537f9", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/d0ef72236e71113066b92dfbfa9da0fc876537f9", "committedDate": "2020-07-31T18:31:19Z", "message": "Fix precommit: String.format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a4442942e878285d1b28f2636d51507648175dc", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/5a4442942e878285d1b28f2636d51507648175dc", "committedDate": "2020-07-31T18:51:43Z", "message": "Fix precommit: bad ref-guide target"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTY3MTM2", "url": "https://github.com/apache/lucene-solr/pull/1707#pullrequestreview-459567136", "createdAt": "2020-08-01T09:39:10Z", "commit": {"oid": "5a4442942e878285d1b28f2636d51507648175dc"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwOTozOToxMFrOG6c8OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwOTo0MDozNVrOG6c8vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk0NDc2MQ==", "bodyText": "I think this could be reused by creating static enumSet", "url": "https://github.com/apache/lucene-solr/pull/1707#discussion_r463944761", "createdAt": "2020-08-01T09:39:10Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/JoinQParserPlugin.java", "diffHunk": "@@ -182,9 +203,34 @@ public Query parse() throws SyntaxError {\n    * @param subQuery the query to define the starting set of documents on the \"left side\" of the join\n    * @param fromField \"left side\" field name to use in the join\n    * @param toField \"right side\" field name to use in the join\n+   * @param method indicates which implementation should be used to process the join.  Currently only 'index',\n+   *               'dvWithScore', and 'topLevelDV' are supported.\n    */\n-  public static Query createJoinQuery(Query subQuery, String fromField, String toField) {\n-    return new JoinQuery(fromField, toField, null, subQuery);\n+  public static Query createJoinQuery(Query subQuery, String fromField, String toField, String method) {\n+    final EnumSet<Method> methodWhitelist = EnumSet.of(Method.index, Method.topLevelDV, Method.dvWithScore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a4442942e878285d1b28f2636d51507648175dc"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk0NDg5NA==", "bodyText": "these variables could be package-private or preferably private", "url": "https://github.com/apache/lucene-solr/pull/1707#discussion_r463944894", "createdAt": "2020-08-01T09:40:35Z", "author": {"login": "munendrasn"}, "path": "solr/core/src/java/org/apache/solr/search/facet/FacetRequest.java", "diffHunk": "@@ -163,15 +166,23 @@ public boolean canBecomeNonEmpty() {\n \n     /** Are we doing a query time join across other documents */\n     public static class JoinField {\n+      public static final String FROM_PARAM = \"from\";\n+      public static final String TO_PARAM = \"to\";\n+      public static final String METHOD_PARAM = \"method\";\n+      public static final Set<String> SUPPORTED_JOIN_PROPERTIES = Sets.newHashSet(FROM_PARAM, TO_PARAM, METHOD_PARAM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a4442942e878285d1b28f2636d51507648175dc"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f156c5904f7475accec321c6455d773b5194177", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/0f156c5904f7475accec321c6455d773b5194177", "committedDate": "2020-08-11T11:14:53Z", "message": "Address review comments, rd 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c015e6903f7e48c6fd593ed807b56ab9d8288e7", "author": {"user": {"login": "gerlowskija", "name": "Jason Gerlowski"}}, "url": "https://github.com/apache/lucene-solr/commit/9c015e6903f7e48c6fd593ed807b56ab9d8288e7", "committedDate": "2020-08-11T11:16:36Z", "message": "Merge branch 'master' into SOLR_14692_support_method_param_on_facetings_join_domain_transform"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2510, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}