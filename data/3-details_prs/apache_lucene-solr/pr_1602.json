{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MjExMTQ0", "number": 1602, "title": "SOLR-14582: Expose IWC.setMaxCommitMergeWaitMillis in Solr's index config", "bodyText": "LUCENE-8962 added the ability to merge segments synchronously on commit. This isn't done by default and the default MergePolicy won't do it, but custom merge policies can take advantage of this. Solr allows plugging in custom merge policies, so if someone wants to make use of this feature they could, however, they need to set IndexWriterConfig.maxCommitMergeWaitSeconds to something greater than 0.\nSince this is an expert feature, I plan to document it only in javadoc and not the ref guide.", "createdAt": "2020-06-22T22:33:42Z", "url": "https://github.com/apache/lucene-solr/pull/1602", "merged": true, "mergeCommit": {"oid": "e6275d9970702c250b69792b5491ef9d94b08638"}, "closed": true, "closedAt": "2020-08-07T17:54:37Z", "author": {"login": "tflobbe"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwFAlwgBqjM0OTM5MDQ5NTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8nykMABqjM2MzQwOTU4NzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0185743e899e4a2552f172346053b60b69053da5", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/0185743e899e4a2552f172346053b60b69053da5", "committedDate": "2020-06-22T22:32:09Z", "message": "Expose IWC.setMaxCommitMergeWaitSeconds in Solr's index config"}, "afterCommit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/93e8a6a679615b1278a5705c3a8dcb14649273ab", "committedDate": "2020-06-29T18:04:13Z", "message": "Use updated Lucene API\n\nAlso, be explicit about no support in default MP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTg2NTcy", "url": "https://github.com/apache/lucene-solr/pull/1602#pullrequestreview-440986572", "createdAt": "2020-07-01T15:39:49Z", "commit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTozOTo1MFrOGrrSDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTozOTo1MFrOGrrSDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MTA4Ng==", "bodyText": "I don't think we need to clear this, the test runner takes care of it and will reset it to whatever it was previously if it had been set?", "url": "https://github.com/apache/lucene-solr/pull/1602#discussion_r448451086", "createdAt": "2020-07-01T15:39:50Z", "author": {"login": "madrob"}, "path": "solr/core/src/test/org/apache/solr/update/SolrIndexConfigTest.java", "diffHunk": "@@ -208,4 +210,16 @@ public void testToMap() throws Exception {\n \n     assertEquals(mSizeExpected, m.size());\n   }\n+  \n+  public void testMaxCommitMergeWaitSeconds() throws Exception {\n+    SolrConfig sc = new SolrConfig(TEST_PATH().resolve(\"collection1\"), \"solrconfig-test-misc.xml\");\n+    assertEquals(-1, sc.indexConfig.maxCommitMergeWaitMillis);\n+    assertEquals(IndexWriterConfig.DEFAULT_MAX_COMMIT_MERGE_WAIT_MILLIS, sc.indexConfig.toIndexWriterConfig(h.getCore()).getMaxCommitMergeWaitMillis());\n+    System.setProperty(\"solr.tests.maxCommitMergeWait\", \"10\");\n+    sc = new SolrConfig(TEST_PATH().resolve(\"collection1\"), \"solrconfig-test-misc.xml\");\n+    assertEquals(10, sc.indexConfig.maxCommitMergeWaitMillis);\n+    assertEquals(10, sc.indexConfig.toIndexWriterConfig(h.getCore()).getMaxCommitMergeWaitMillis());\n+    System.clearProperty(\"solr.tests.maxCommitMergeWait\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTg2Nzcy", "url": "https://github.com/apache/lucene-solr/pull/1602#pullrequestreview-440986772", "createdAt": "2020-07-01T15:40:05Z", "commit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjY4OTIx", "url": "https://github.com/apache/lucene-solr/pull/1602#pullrequestreview-462668921", "createdAt": "2020-08-06T16:13:40Z", "commit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNjoxMzo0MVrOG86i9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNjoxNToyNFrOG86nNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUyNjk2Ng==", "bodyText": "Lets use org.apache.lucene.index.IndexWriterConfig#DEFAULT_MAX_COMMIT_MERGE_WAIT_MILLIS.  In the future, this constant might change, and that's good.", "url": "https://github.com/apache/lucene-solr/pull/1602#discussion_r466526966", "createdAt": "2020-08-06T16:13:41Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/update/SolrIndexConfig.java", "diffHunk": "@@ -87,6 +100,7 @@ private SolrIndexConfig(SolrConfig solrConfig) {\n     maxBufferedDocs = -1;\n     ramBufferSizeMB = 100;\n     ramPerThreadHardLimitMB = -1;\n+    maxCommitMergeWaitMillis = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUyODA1NA==", "bodyText": "I appreciate documentation but redundant documentation -- not so much.  Can't you do a @see or @link to one place -- org.apache.lucene.index.IndexWriterConfig#setMaxCommitMergeWaitMillis", "url": "https://github.com/apache/lucene-solr/pull/1602#discussion_r466528054", "createdAt": "2020-08-06T16:15:24Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/update/SolrIndexConfig.java", "diffHunk": "@@ -68,6 +68,19 @@\n \n   public final double ramBufferSizeMB;\n   public final int ramPerThreadHardLimitMB;\n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjczMDcy", "url": "https://github.com/apache/lucene-solr/pull/1602#pullrequestreview-462673072", "createdAt": "2020-08-06T16:18:55Z", "commit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNjoxODo1NlrOG86vaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNjoxODo1NlrOG86vaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzMDE1Mg==", "bodyText": "I noticed you omitted a \"Millis\" setting.  I think either you should add this for clarity, or for consistency with some other times I see in solrconfig (e.g. maxTime), use suffix \"Time\".", "url": "https://github.com/apache/lucene-solr/pull/1602#discussion_r466530152", "createdAt": "2020-08-06T16:18:56Z", "author": {"login": "dsmiley"}, "path": "solr/core/src/java/org/apache/solr/update/SolrIndexConfig.java", "diffHunk": "@@ -129,8 +143,9 @@ public SolrIndexConfig(SolrConfig solrConfig, String prefix, SolrIndexConfig def\n         true);\n \n     useCompoundFile = solrConfig.getBool(prefix+\"/useCompoundFile\", def.useCompoundFile);\n-    maxBufferedDocs=solrConfig.getInt(prefix+\"/maxBufferedDocs\",def.maxBufferedDocs);\n+    maxBufferedDocs = solrConfig.getInt(prefix+\"/maxBufferedDocs\", def.maxBufferedDocs);\n     ramBufferSizeMB = solrConfig.getDouble(prefix+\"/ramBufferSizeMB\", def.ramBufferSizeMB);\n+    maxCommitMergeWaitMillis = solrConfig.getInt(prefix+\"/maxCommitMergeWait\", def.maxCommitMergeWaitMillis);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93e8a6a679615b1278a5705c3a8dcb14649273ab"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97da26e2c8cd78ebbbb88ecc8324b288935d7244", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/97da26e2c8cd78ebbbb88ecc8324b288935d7244", "committedDate": "2020-08-06T21:14:08Z", "message": "Address PR comments"}, "afterCommit": {"oid": "b669aee2fffa5027eef71d87187f51541b94aab8", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/b669aee2fffa5027eef71d87187f51541b94aab8", "committedDate": "2020-08-06T21:31:18Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNDUyNTk3", "url": "https://github.com/apache/lucene-solr/pull/1602#pullrequestreview-463452597", "createdAt": "2020-08-07T16:39:38Z", "commit": {"oid": "b669aee2fffa5027eef71d87187f51541b94aab8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30784033c53edcacce4b7aa4e088c3d8ef9b396e", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/30784033c53edcacce4b7aa4e088c3d8ef9b396e", "committedDate": "2020-08-07T17:10:32Z", "message": "Expose IWC.setMaxCommitMergeWaitSeconds in Solr's index config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "007b23bba3a02fe36751c206284a9c8e9e3c6223", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/007b23bba3a02fe36751c206284a9c8e9e3c6223", "committedDate": "2020-08-07T17:10:32Z", "message": "Use updated Lucene API\n\nAlso, be explicit about no support in default MP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54382ae7885cf9e638055316f142608a51ee119f", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/54382ae7885cf9e638055316f142608a51ee119f", "committedDate": "2020-08-07T17:10:32Z", "message": "Address PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b12455151592a47ea57f2a1bd6ec906178aef9d6", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/b12455151592a47ea57f2a1bd6ec906178aef9d6", "committedDate": "2020-08-07T17:22:50Z", "message": "Add CHANGES entry"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b669aee2fffa5027eef71d87187f51541b94aab8", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/b669aee2fffa5027eef71d87187f51541b94aab8", "committedDate": "2020-08-06T21:31:18Z", "message": "Address PR comments"}, "afterCommit": {"oid": "b12455151592a47ea57f2a1bd6ec906178aef9d6", "author": {"user": {"login": "tflobbe", "name": "Tomas Fernandez Lobbe"}}, "url": "https://github.com/apache/lucene-solr/commit/b12455151592a47ea57f2a1bd6ec906178aef9d6", "committedDate": "2020-08-07T17:22:50Z", "message": "Add CHANGES entry"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2655, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}