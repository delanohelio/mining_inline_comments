{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NjM5MjA3", "number": 646, "title": "Implement readiness and liveness health check support for the Kafka connector", "bodyText": "The Kafka connector reports the readiness and liveness of each channel managed by the connector.\nReadiness\nOn the inbound side (receiving records from Kafka), the readiness check verifies that:\n\nthe broker is available\nthe Kafka topic is created (available in the broker).\nno failures have been caught\n\nOn the outbound side (writing records to Kafka), the readiness check verifies that:\n\nthe broker is available\nthe Kafka topic is created (available in the broker).\n\nLiveness\nOn the inbound side (receiving records from Kafka), the liveness check verifies that:\n\nno failures have been caught\nthe client is connected to the broker\n\nOn the outbound side (writing records to Kafka), the liveness check verifies that:\n\nno failures have been caught\n\nNote that a message processing failures nacks the message which is then handled by the failure-strategy.\nIt the responsibility of the failure-strategy to report the failure and influence the outcome of the liveness checks.\nThe fail failure strategy reports the failure and so the liveness check will report the failure.", "createdAt": "2020-07-06T09:04:10Z", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646", "merged": true, "mergeCommit": {"oid": "b9d28672964b814dfb6a7479aae6bf7e7ea1dd1d"}, "closed": true, "closedAt": "2020-07-06T14:09:57Z", "author": {"login": "cescoffier"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyNitBABqjM1MTQ5NjUxNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyRu-8AFqTQ0MzEwMzcwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc32592e258ef853fd38aca6efdaf62e7b7eb388", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/bc32592e258ef853fd38aca6efdaf62e7b7eb388", "committedDate": "2020-07-06T09:03:50Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}, "afterCommit": {"oid": "a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "committedDate": "2020-07-06T09:08:43Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "committedDate": "2020-07-06T09:08:43Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}, "afterCommit": {"oid": "14044a9e1539ffed7ff24de99e55832cfedcf0f8", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/14044a9e1539ffed7ff24de99e55832cfedcf0f8", "committedDate": "2020-07-06T10:03:55Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14044a9e1539ffed7ff24de99e55832cfedcf0f8", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/14044a9e1539ffed7ff24de99e55832cfedcf0f8", "committedDate": "2020-07-06T10:03:55Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}, "afterCommit": {"oid": "bd146329b180058ff32c3ee143a2e45dae7a1e0c", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/bd146329b180058ff32c3ee143a2e45dae7a1e0c", "committedDate": "2020-07-06T10:12:45Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd146329b180058ff32c3ee143a2e45dae7a1e0c", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/bd146329b180058ff32c3ee143a2e45dae7a1e0c", "committedDate": "2020-07-06T10:12:45Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}, "afterCommit": {"oid": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "committedDate": "2020-07-06T11:47:17Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDY4NTI1", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646#pullrequestreview-443068525", "createdAt": "2020-07-06T13:21:21Z", "commit": {"oid": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzoyMToyMlrOGtW-Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzoyMToyMlrOGtW-Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNTQ1NQ==", "bodyText": "As this is now being used in at least a couple of places, should we be capturing the topic name instead of calling configuration more than once?", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646#discussion_r450215455", "createdAt": "2020-07-06T13:21:22Z", "author": {"login": "kenfinnigan"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -187,4 +211,48 @@ public void closeQuietly() {\n             log.exceptionOnClose(e);\n         }\n     }\n+\n+    public void isAlive(HealthReport.HealthReportBuilder builder) {\n+        if (configuration.getHealthEnabled()) {\n+            List<Throwable> actualFailures;\n+            boolean isCurrentlyConnected;\n+            synchronized (this) {\n+                actualFailures = new ArrayList<>(failures);\n+            }\n+            if (!actualFailures.isEmpty()) {\n+                builder.add(configuration.getChannel(), false,\n+                        actualFailures.stream().map(Throwable::getMessage).collect(Collectors.joining()));\n+            } else {\n+                builder.add(configuration.getChannel(), true);\n+            }\n+        }\n+\n+        // If health is disable do not add anything to the builder.\n+    }\n+\n+    private String getTopic() {\n+        return configuration.getTopic().orElseGet(configuration::getChannel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88fce71cc1caeb6ee8092cc3653a68023e08f743", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/88fce71cc1caeb6ee8092cc3653a68023e08f743", "committedDate": "2020-07-06T13:56:15Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "committedDate": "2020-07-06T11:47:17Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}, "afterCommit": {"oid": "88fce71cc1caeb6ee8092cc3653a68023e08f743", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/88fce71cc1caeb6ee8092cc3653a68023e08f743", "committedDate": "2020-07-06T13:56:15Z", "message": "Implement readiness and liveness health check support for the Kafka connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTAzNzA2", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646#pullrequestreview-443103706", "createdAt": "2020-07-06T14:02:00Z", "commit": {"oid": "88fce71cc1caeb6ee8092cc3653a68023e08f743"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2309, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}