{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODUwMzA2", "number": 415, "title": "Change default for retry-attempts to infinite retries", "bodyText": "If not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds.", "createdAt": "2020-02-11T19:55:32Z", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415", "merged": true, "mergeCommit": {"oid": "bb8795c9559fd48f7351e8b7c3ea89eb736b850c"}, "closed": true, "closedAt": "2020-03-01T08:24:23Z", "author": {"login": "thescouser89"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFw8QpAFqTM2MDg3NjIxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJUyJ2gFqTM2Njg0MjU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODc2MjE1", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#pullrequestreview-360876215", "createdAt": "2020-02-19T06:55:24Z", "commit": {"oid": "291fdb9d910ba7e2d71310da8ed552ad94350c48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwNjo1NToyNFrOFrc16A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwNjo1NTo1NFrOFrc2kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEwNTY0MA==", "bodyText": "Minor - I generally use -1 for infinite, but null is ok.", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#discussion_r381105640", "createdAt": "2020-02-19T06:55:24Z", "author": {"login": "cescoffier"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -65,11 +65,17 @@ public KafkaSource(Vertx vertx, Config config, String servers) {\n                 .doOnError(t -> LOGGER.error(\"Unable to read a record from Kafka topic '{}'\", topic, t));\n \n         if (config.getOptionalValue(\"retry\", Boolean.class).orElse(true)) {\n-            Integer max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(5);\n-            flowable = flowable\n+            Integer max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291fdb9d910ba7e2d71310da8ed552ad94350c48"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEwNTgwOQ==", "bodyText": "Wondering if we should implement some kind of exponential backoff. WDYT?", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#discussion_r381105809", "createdAt": "2020-02-19T06:55:54Z", "author": {"login": "cescoffier"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -65,11 +65,17 @@ public KafkaSource(Vertx vertx, Config config, String servers) {\n                 .doOnError(t -> LOGGER.error(\"Unable to read a record from Kafka topic '{}'\", topic, t));\n \n         if (config.getOptionalValue(\"retry\", Boolean.class).orElse(true)) {\n-            Integer max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(5);\n-            flowable = flowable\n+            Integer max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(null);\n+\n+            if (max == null) {\n+                // always retry\n+                flowable = flowable.retryWhen(attempts -> attempts.flatMap(i -> Flowable.timer(10, TimeUnit.SECONDS)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "291fdb9d910ba7e2d71310da8ed552ad94350c48"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "291fdb9d910ba7e2d71310da8ed552ad94350c48", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/291fdb9d910ba7e2d71310da8ed552ad94350c48", "committedDate": "2020-02-11T19:53:26Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, at an interval of 10 seconds.\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number."}, "afterCommit": {"oid": "c0da59e68b955346dbe06c86c2cfc2dcc086fcd9", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/c0da59e68b955346dbe06c86c2cfc2dcc086fcd9", "committedDate": "2020-02-25T20:40:48Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NjcxMTQ3", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#pullrequestreview-364671147", "createdAt": "2020-02-26T07:31:50Z", "commit": {"oid": "c0da59e68b955346dbe06c86c2cfc2dcc086fcd9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NjcxMjkw", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#pullrequestreview-364671290", "createdAt": "2020-02-26T07:32:15Z", "commit": {"oid": "c0da59e68b955346dbe06c86c2cfc2dcc086fcd9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwNzozMjoxNVrOFugqXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwNzozMjoxNVrOFugqXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMxMzk0OA==", "bodyText": "Should be an AtomicInteger.", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#discussion_r384313948", "createdAt": "2020-02-26T07:32:15Z", "author": {"login": "cescoffier"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -65,11 +65,30 @@ public KafkaSource(Vertx vertx, Config config, String servers) {\n                 .doOnError(t -> LOGGER.error(\"Unable to read a record from Kafka topic '{}'\", topic, t));\n \n         if (config.getOptionalValue(\"retry\", Boolean.class).orElse(true)) {\n-            Integer max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(5);\n-            flowable = flowable\n-                    .retryWhen(attempts -> attempts\n-                            .zipWith(Flowable.range(1, max), (n, i) -> i)\n-                            .flatMap(i -> Flowable.timer(i, TimeUnit.SECONDS)));\n+            int max = config.getOptionalValue(\"retry-attempts\", Integer.class).orElse(-1);\n+            int retryMaxWait = config.getOptionalValue(\"retry-max-wait\", Integer.class).orElse(30);\n+\n+            if (max == -1) {\n+                // always retry\n+                final int[] CURRENT_WAIT_SECOND = { 1 };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0da59e68b955346dbe06c86c2cfc2dcc086fcd9"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0da59e68b955346dbe06c86c2cfc2dcc086fcd9", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/c0da59e68b955346dbe06c86c2cfc2dcc086fcd9", "committedDate": "2020-02-25T20:40:48Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}, "afterCommit": {"oid": "6a14cc705a77fab6d08d8da737641c1c012c0e4f", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6a14cc705a77fab6d08d8da737641c1c012c0e4f", "committedDate": "2020-02-26T20:18:25Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb76ab8c09e171ca562f93281076494ec4131a3a", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/eb76ab8c09e171ca562f93281076494ec4131a3a", "committedDate": "2020-02-26T20:21:28Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a14cc705a77fab6d08d8da737641c1c012c0e4f", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6a14cc705a77fab6d08d8da737641c1c012c0e4f", "committedDate": "2020-02-26T20:18:25Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}, "afterCommit": {"oid": "eb76ab8c09e171ca562f93281076494ec4131a3a", "author": {"user": {"login": "thescouser89", "name": "Dustin Kut"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/eb76ab8c09e171ca562f93281076494ec4131a3a", "committedDate": "2020-02-26T20:21:28Z", "message": "Change default for retry-attempts to infinite retries\n\nIf not specified by the user, the default retry behaviour is to always\nretry, with an exponential backoff wait time, up to the retry max wait\ntime (30 seconds by default).\n\nIf the user specify a retry-attempts, then the nubmer of retries will be\nlimited to that number.\n\nA new env var is also introduced, 'retry-max-wait'. It is used to set\nthe max wait time in seconds between retries, with a default of 30\nseconds."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODQyNTY2", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/415#pullrequestreview-366842566", "createdAt": "2020-03-01T08:24:17Z", "commit": {"oid": "eb76ab8c09e171ca562f93281076494ec4131a3a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2231, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}