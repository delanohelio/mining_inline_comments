{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMDAzNTg4", "number": 867, "title": "Improve reporting when too many records are not committed", "bodyText": "Fix #865\n\ufeffImprove reporting when too many message have not been acked or nacked.", "createdAt": "2020-11-12T16:29:16Z", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867", "merged": true, "mergeCommit": {"oid": "8d4d96e96ba86eb979cfdeafc65d67cdba21a8f5"}, "closed": true, "closedAt": "2020-11-16T12:35:14Z", "author": {"login": "cescoffier"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcJgjYgFqTUzMDE5NDQ5NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcYpIpABqjM5OTYyNzQwNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTk0NDk1", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#pullrequestreview-530194495", "createdAt": "2020-11-13T16:11:49Z", "commit": {"oid": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNjoxMTo0OVrOHy0gWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNjoxMTo0OVrOHy0gWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1MTA5Nw==", "bodyText": "I'm not sure if the remark about the maximum capacity is always true. In my case, only the timeout hit (I have 89 messages waiting in batching). Not sure if you should change the wording.", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523051097", "createdAt": "2020-11-13T16:11:49Z", "author": {"login": "andreas-eberle"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/i18n/KafkaLogging.java", "diffHunk": "@@ -139,8 +139,11 @@\n     void configuredPattern(String channel, String pattern);\n \n     @LogMessage(level = Logger.Level.WARN)\n-    @Message(id = 18231, value = \"The amount of received messages without acking is too high for topic partition '%s', amount %d.\")\n-    void receivedTooManyMessagesWithoutAcking(String topicPartition, long amount);\n+    @Message(id = 18231, value = \"The amount of received messages without acking is too high for topic partition '%s', \"\n+            + \"amount %d. The last committed offset was %d. It means that the Kafka connector received Kafka Records that \"\n+            + \"have neither be acked nor nacked in a timely fashion. The connector accumulates records in memory, but that \"\n+            + \"buffer reached its maximum capacity. The connector cannot commit as a record processing has not completed.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzI0Nzg4", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#pullrequestreview-530324788", "createdAt": "2020-11-13T18:54:01Z", "commit": {"oid": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxODo1NDowMlrOHy7KAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxODo1NDowMlrOHy7KAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MDA2Nw==", "bodyText": "This null check isn't strictly necessary since the code block is in a while received offset is not empty. But this is fine.", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/867#discussion_r523160067", "createdAt": "2020-11-13T18:54:02Z", "author": {"login": "pcasaes"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/commit/KafkaThrottledLatestProcessedCommit.java", "diffHunk": "@@ -355,10 +366,14 @@ long clearLesserSequentiallyProcessedOffsetsAndReturnLargestOffset() {\n                         break;\n                     }\n                     unProcessedTotal--;\n-                    largestSequentialProcessedOffset = receivedOffsets.poll().getOffset();\n+                    OffsetReceivedAt poll = receivedOffsets.poll();\n+                    if (poll != null) {\n+                        largestSequentialProcessedOffset = poll.getOffset();\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e16c139a515bc3b01683112dcf076f182c308fac", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/e16c139a515bc3b01683112dcf076f182c308fac", "committedDate": "2020-11-14T09:48:30Z", "message": "Fix #865\n\nImprove reporting when too many message have not been acked or nacked.\nThe exception contains the last committed offset as well as the topic/partition.\nThe logged message explains why the exception has been thrown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/9e0f888978cfa2cd91f30bc16ee6b40c0b6a6288", "committedDate": "2020-11-12T16:28:37Z", "message": "Fix #865\n\nImprove reporting when too many message have not been acked or nacked."}, "afterCommit": {"oid": "e16c139a515bc3b01683112dcf076f182c308fac", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/e16c139a515bc3b01683112dcf076f182c308fac", "committedDate": "2020-11-14T09:48:30Z", "message": "Fix #865\n\nImprove reporting when too many message have not been acked or nacked.\nThe exception contains the last committed offset as well as the topic/partition.\nThe logged message explains why the exception has been thrown."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2244, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}