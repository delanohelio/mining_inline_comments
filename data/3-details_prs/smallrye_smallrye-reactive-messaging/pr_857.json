{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MTczNDkz", "number": 857, "title": "Implement deserialization failure handler", "bodyText": "", "createdAt": "2020-11-07T18:16:59Z", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/857", "merged": true, "mergeCommit": {"oid": "52f5b7ad9383ccaa414b699688b7d46a66e612ed"}, "closed": true, "closedAt": "2020-11-09T14:58:24Z", "author": {"login": "cescoffier"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaPwfAABqjM5NzAxMDg0ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda1tqxgBqjM5NzQwNjA2MTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3cbbe1b5256dbaa30e9f25da4a7a6f1f58fc011", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/d3cbbe1b5256dbaa30e9f25da4a7a6f1f58fc011", "committedDate": "2020-11-07T18:16:07Z", "message": "Implement deserializer failure handler support"}, "afterCommit": {"oid": "1d0bf32c3c74e49de4d1ad417226579b2d9713ba", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/1d0bf32c3c74e49de4d1ad417226579b2d9713ba", "committedDate": "2020-11-07T18:20:39Z", "message": "Implement deserialization failure handler support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a311579070ddaf8759b5aa06e9b4df2230e76828", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a311579070ddaf8759b5aa06e9b4df2230e76828", "committedDate": "2020-11-07T20:01:54Z", "message": "Fix back-pressure issue in tests"}, "afterCommit": {"oid": "cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719", "committedDate": "2020-11-08T08:15:10Z", "message": "Fix back-pressure issue in tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Mjk1Mzg1", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/857#pullrequestreview-526295385", "createdAt": "2020-11-09T14:14:10Z", "commit": {"oid": "cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDoxNDoxMVrOHvwvAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDoxNTo0MVrOHvwzpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg0MzU4NA==", "bodyText": "\"is be applied\" -> could you remove the \"be\"?", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/857#discussion_r519843584", "createdAt": "2020-11-09T14:14:11Z", "author": {"login": "kenfinnigan"}, "path": "documentation/src/main/doc/modules/connectors/partials/META-INF/connector/smallrye-kafka-incoming.adoc", "diffHunk": "@@ -109,7 +109,15 @@ Type: _int_ | false | `1`\n \n Type: _boolean_ | false | `true`\n \n-| *consumer-rebalance-listener.name* | The name set in `javax.inject.Named` of a bean that implements `io.smallrye.reactive.messaging.kafka.KafkaConsumerRebalanceListener`. If set the listener will be applied to the consumer.\n+| *consumer-rebalance-listener.name* | The name set in `javax.inject.Named` of a bean that implements `io.smallrye.reactive.messaging.kafka.KafkaConsumerRebalanceListener`. If set, this rebalance listener is be applied to the consumer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg0NDc3Mw==", "bodyText": "Not huge, but maybe switch the ordering of the config keys to have the \"key\" first as it's mentioned first in other situations", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/857#discussion_r519844773", "createdAt": "2020-11-09T14:15:41Z", "author": {"login": "kenfinnigan"}, "path": "documentation/src/main/doc/modules/kafka/pages/inbound.adoc", "diffHunk": "@@ -137,6 +137,40 @@ The record written on the dead letter queue contains a set of additional headers\n * `dead-letter-partition` - the original partition of the record (integer mapped to String)\n * `dead-letter-offset` - the original offset of the record (long mapped to String)\n \n+=== Handling deserialization failures\n+\n+Because deserialization happens before creating a `Message`, the failure strategy presented above cannot be applied.\n+However, when a deserialization failure occurs, you can intercept it and provide a fallback value.\n+If you don't, `null` will be used as fallback value.\n+\n+To achieve this, create a CDI bean implementing the {javadoc-base}/io/smallrye/reactive/messaging/kafka/DeserializationFailureHandler.html[DeserializationFailureHandler<T>] interface:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Named(\"failure-fallback\") // Set the name of the failure handler\n+public static class MyDeserializationFailureHandler\n+    implements DeserializationFailureHandler<JsonObject> { // Specify the expected type\n+\n+    @Override\n+    public JsonObject handleDeserializationFailure(String topic, boolean isKey,\n+            String deserializer, byte[] data,\n+            Exception exception, Headers headers) {\n+        return fallback;\n+    }\n+}\n+----\n+\n+The bean must be exposed with the `@Named` qualifier specifying the name of the bean.\n+Then, in the connector configuration, specify the following attribute:\n+\n+* `mp.messaging.incoming.$channel.value-deserialization-failure-handler`: name of the bean handling deserialization failures happening for the record's value,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6b9f354d0f4dcf062067abe921fbfca681cb362", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/b6b9f354d0f4dcf062067abe921fbfca681cb362", "committedDate": "2020-11-09T14:33:56Z", "message": "Initial support of the deserialisation failure handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa56828477ef46c7138632fc461a472abb8267a3", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/aa56828477ef46c7138632fc461a472abb8267a3", "committedDate": "2020-11-09T14:33:56Z", "message": "Move the broker creation to a junit 5 extension\n\nThat avoid many broker creations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61a2961c556dfb1d45d5a7ce83e6458823673e0e", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/61a2961c556dfb1d45d5a7ce83e6458823673e0e", "committedDate": "2020-11-09T14:33:56Z", "message": "Use mock instances in tests to avoid creating CDI containers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65282a8212f9811ad6aded976d71919f5a3c6b7e", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/65282a8212f9811ad6aded976d71919f5a3c6b7e", "committedDate": "2020-11-09T14:33:56Z", "message": "Implement deserialization failure handler support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52bfccda519e183918949a7871f8af379f18312a", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/52bfccda519e183918949a7871f8af379f18312a", "committedDate": "2020-11-09T14:33:56Z", "message": "Fix back-pressure issue in tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/cf5bad54cd6888e0fb5a5be4ff0c91f18cd82719", "committedDate": "2020-11-08T08:15:10Z", "message": "Fix back-pressure issue in tests"}, "afterCommit": {"oid": "52bfccda519e183918949a7871f8af379f18312a", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/52bfccda519e183918949a7871f8af379f18312a", "committedDate": "2020-11-09T14:33:56Z", "message": "Fix back-pressure issue in tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2242, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}