{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NzM2NzM3", "number": 760, "title": "Kafka test reorg and disable auto commit", "bodyText": "This PR disables the Kafka auto commit (if not explicitely set by the user) and refactor the tests.\nThis PR:\n\nRemoves a dependency not used anymore since AMQP tests uses junit 5\nFixes typos in logged messages\nRemoves non-kafka properties from configurations\nFixes typo in exception class name\nApply a major refactoring of the Kafka tests\nUses test container instead of debezium\nDisables auto commit by default", "createdAt": "2020-09-19T14:51:04Z", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760", "merged": true, "mergeCommit": {"oid": "588866a2533fc4dd0d2b5517f76c60a233cfa662"}, "closed": true, "closedAt": "2020-09-21T07:49:15Z", "author": {"login": "cescoffier"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKb0xEgBqjM3ODUyMTk0Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKyv4lABqjM3ODYyODcwMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76c164d670acf606af7478287860f0c44b5b7674", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/76c164d670acf606af7478287860f0c44b5b7674", "committedDate": "2020-09-19T14:49:05Z", "message": "Disable auto commit by default"}, "afterCommit": {"oid": "63438664baee6e5ab0aa54f4a5c7b58df31534f9", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/63438664baee6e5ab0aa54f4a5c7b58df31534f9", "committedDate": "2020-09-19T15:21:22Z", "message": "Disable auto commit by default"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07736319332b8451055d7c13daa36c87a1c9cf57", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/07736319332b8451055d7c13daa36c87a1c9cf57", "committedDate": "2020-09-19T17:51:11Z", "message": "Fix race in NoKafkataTest"}, "afterCommit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "committedDate": "2020-09-19T18:11:40Z", "message": "Fix race in NoKafkataTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMTk4ODg0", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#pullrequestreview-492198884", "createdAt": "2020-09-20T14:34:43Z", "commit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQxNDozNDo0M1rOHU61Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQxNDozNDo0M1rOHU61Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzQyMw==", "bodyText": "It looks like enable.auto.commit will always have a value now, no need for getOrDefault on line 96.\nAlso , why not use the defined constant ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG instead of the literal enable.auto.commit on line 91?", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491697423", "createdAt": "2020-09-20T14:34:43Z", "author": {"login": "pcasaes"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -86,9 +86,14 @@ public KafkaSource(Vertx vertx,\n             kafkaConfiguration.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, config.getKeyDeserializer());\n         }\n \n+        if (!kafkaConfiguration.containsKey(\"enable.auto.commit\")) {\n+            log.disableAutoCommit(config.getChannel());\n+            kafkaConfiguration.put(\"enable.auto.commit\", \"false\");\n+        }\n+\n         String commitStrategy = config\n                 .getCommitStrategy()\n-                .orElse(Boolean.parseBoolean(kafkaConfiguration.getOrDefault(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"true\"))\n+                .orElse(Boolean.parseBoolean(kafkaConfiguration.getOrDefault(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"false\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMTk4OTU2", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#pullrequestreview-492198956", "createdAt": "2020-09-20T14:35:48Z", "commit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQxNDozNTo0OFrOHU61hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQxNDozNTo0OFrOHU61hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzU0Mg==", "bodyText": "Might be worded a bit better:\n\nIt's recommended to NOT use auto-commit and let the connector handle commits", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491697542", "createdAt": "2020-09-20T14:35:48Z", "author": {"login": "pcasaes"}, "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/KafkaConnector.java", "diffHunk": "@@ -57,6 +57,7 @@\n @ConnectorAttribute(name = \"value.deserializer\", type = \"string\", direction = Direction.INCOMING, description = \"The deserializer classname used to deserialize the record's value\", mandatory = true)\n @ConnectorAttribute(name = \"fetch.min.bytes\", type = \"int\", direction = Direction.INCOMING, description = \"The minimum amount of data the server should return for a fetch request. The default setting of 1 byte means that fetch requests are answered as soon as a single byte of data is available or the fetch request times out waiting for data to arrive.\", defaultValue = \"1\")\n @ConnectorAttribute(name = \"group.id\", type = \"string\", direction = Direction.INCOMING, description = \"A unique string that identifies the consumer group the application belongs to. If not set, a unique, generated id is used\")\n+@ConnectorAttribute(name = \"enable.auto.commit\", type = \"boolean\", direction = Direction.INCOMING, description = \"Whether or not auto-commit is enabled. It's recommended to NOT use auto-commit and let's the connector handle commit\", defaultValue = \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afe23c0bf4ab595e65e66ceac5bcb46892b97aa4", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/afe23c0bf4ab595e65e66ceac5bcb46892b97aa4", "committedDate": "2020-09-20T17:40:18Z", "message": "Remove a dependency not used anymore since AMQP tests uses junit 5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ba59f93a44be0946053f53f589554582fd001e", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/f1ba59f93a44be0946053f53f589554582fd001e", "committedDate": "2020-09-20T17:40:18Z", "message": "Fixed type in logged messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "903156613b161a7964fab322dc543a9e17a164b2", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/903156613b161a7964fab322dc543a9e17a164b2", "committedDate": "2020-09-20T17:40:18Z", "message": "Remove non-kafka properties from configurations\n\nRemove group.id from admin config\nRemove tracing.enabled from both the consumer and admin config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dda2d99e3240dba132afda2a0ec5c5416373f65", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6dda2d99e3240dba132afda2a0ec5c5416373f65", "committedDate": "2020-09-20T17:40:18Z", "message": "Fix typo in exception class name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef702030342e5e393518b7016e5f3b8b63c3e1d8", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/ef702030342e5e393518b7016e5f3b8b63c3e1d8", "committedDate": "2020-09-20T17:40:18Z", "message": "Major refactoring of the Kafka tests\n\n- Switch to junit 5\n- New config goodies\n- Move base classes to their own package and refactor code to avoid duplications"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "committedDate": "2020-09-19T18:11:40Z", "message": "Fix race in NoKafkataTest"}, "afterCommit": {"oid": "81b32c82fed297d571653eb1f0784cb6cb60780e", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/81b32c82fed297d571653eb1f0784cb6cb60780e", "committedDate": "2020-09-20T17:46:12Z", "message": "Fix race in NoKafkataTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81b32c82fed297d571653eb1f0784cb6cb60780e", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/81b32c82fed297d571653eb1f0784cb6cb60780e", "committedDate": "2020-09-20T17:46:12Z", "message": "Fix race in NoKafkataTest"}, "afterCommit": {"oid": "dec83646f3502cef15e1b438c068f1062324c3e1", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/dec83646f3502cef15e1b438c068f1062324c3e1", "committedDate": "2020-09-20T17:47:47Z", "message": "Fix race in NoKafkataTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36d153d697f964019d62b400e1aef1c0fa3408d", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a36d153d697f964019d62b400e1aef1c0fa3408d", "committedDate": "2020-09-20T18:03:55Z", "message": "Disable auto commit by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b1c3edd5aacd6eabdb4614d686e9ae9dd60efdd", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/1b1c3edd5aacd6eabdb4614d686e9ae9dd60efdd", "committedDate": "2020-09-20T18:03:55Z", "message": "Missed some update to Mutiny 0.8.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "987f27a0429704a061170a4f9261afcc28661286", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/987f27a0429704a061170a4f9261afcc28661286", "committedDate": "2020-09-20T18:03:55Z", "message": "Close admin clients"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "443a28e2b95bccdfece8aeaf4368e439e093e498", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/443a28e2b95bccdfece8aeaf4368e439e093e498", "committedDate": "2020-09-20T18:03:55Z", "message": "Fix race in NoKafkataTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dec83646f3502cef15e1b438c068f1062324c3e1", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/dec83646f3502cef15e1b438c068f1062324c3e1", "committedDate": "2020-09-20T17:47:47Z", "message": "Fix race in NoKafkataTest"}, "afterCommit": {"oid": "443a28e2b95bccdfece8aeaf4368e439e093e498", "author": {"user": {"login": "cescoffier", "name": "Clement Escoffier"}}, "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/443a28e2b95bccdfece8aeaf4368e439e093e498", "committedDate": "2020-09-20T18:03:55Z", "message": "Fix race in NoKafkataTest"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2264, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}