{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2Njg0NTE0", "number": 1690, "title": "Check equipment compatibility with motive type when validating vehicles", "bodyText": "This is part of the fix for MegaMek/megameklab#440. The bug report only mentions combat vehicle flotation hull, but I have included the amphibious and dune buggy CV mods, as well as industrial equipment and a few other equipment types I noticed. The logic is in a public static method in TestTank where it can be used by TestSupportVehicle, as well as MML in equipment filtering.", "createdAt": "2020-02-18T15:32:39Z", "url": "https://github.com/MegaMek/megamek/pull/1690", "merged": true, "mergeCommit": {"oid": "a819bbd6552510d9c360a2b720c4c247c686e22b"}, "closed": true, "closedAt": "2020-02-18T17:03:33Z", "author": {"login": "neoancient"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFQZWAAH2gAyMzc2Njg0NTE0OjUxYjEzMDI4YzE0YWM1NGMwOTA2YzExMTYzZTk5OTdiMDlmMTc2M2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFk6oyAFqTM2MDUwNzk1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51b13028c14ac54c0906c11163e9997b09f1763d", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/51b13028c14ac54c0906c11163e9997b09f1763d", "committedDate": "2020-02-17T17:01:52Z", "message": "Moved motive type filtering for CV equipment to TestTank for validation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e0b9849bef2a3f034ccc0e80aa78589682c5b02", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/7e0b9849bef2a3f034ccc0e80aa78589682c5b02", "committedDate": "2020-02-18T15:16:39Z", "message": "Add motive type validataion for weapons."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06ec6f8b30e79745897dd2db34ea049214870915", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/06ec6f8b30e79745897dd2db34ea049214870915", "committedDate": "2020-02-18T15:17:39Z", "message": "Validate support tank equipment against motive type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTA3ODkw", "url": "https://github.com/MegaMek/megamek/pull/1690#pullrequestreview-360507890", "createdAt": "2020-02-18T16:56:14Z", "commit": {"oid": "06ec6f8b30e79745897dd2db34ea049214870915"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo1NjoxNFrOFrKdjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo1NjoxNFrOFrKdjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgwNDQ5Mg==", "bodyText": "What? VTOLs can't mount rivet guns? That's BS, I demand a refund! ::monocle::", "url": "https://github.com/MegaMek/megamek/pull/1690#discussion_r380804492", "createdAt": "2020-02-18T16:56:14Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/common/verifier/TestTank.java", "diffHunk": "@@ -451,6 +458,71 @@ public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {\n         return correct;\n     }\n \n+    /**\n+     * Checks whether the equipment is compatible with the vehicle's motive type\n+     *\n+     * @param eq   The equipment to check\n+     * @param mode The vehicle's motive type\n+     * @return     Whether the equipment and motive type are compatible\n+     */\n+    public static boolean legalForMotiveType(EquipmentType eq, EntityMovementMode mode) {\n+        final boolean isNaval = mode.equals(EntityMovementMode.NAVAL)\n+                || mode.equals(EntityMovementMode.HYDROFOIL)\n+                || mode.equals(EntityMovementMode.SUBMARINE);\n+        if (eq instanceof MiscType) {\n+            if (eq.hasFlag(MiscType.F_FLOTATION_HULL)) {\n+                // Per errata, WiGE vehicles automatically include flotation hull\n+                return mode.equals(EntityMovementMode.HOVER) || mode.equals(EntityMovementMode.VTOL);\n+            }\n+            if (eq.hasFlag(MiscType.F_FULLY_AMPHIBIOUS)\n+                    || eq.hasFlag(MiscType.F_LIMITED_AMPHIBIOUS)\n+                    || eq.hasFlag(MiscType.F_BULLDOZER)\n+                    || (eq.hasFlag(MiscType.F_CLUB) && eq.hasSubType(MiscType.S_COMBINE))) {\n+                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED);\n+            }\n+            if (eq.hasFlag(MiscType.F_DUNE_BUGGY)) {\n+                return mode.equals(EntityMovementMode.WHEELED);\n+            }\n+            if (eq.hasFlag(MiscType.F_CLUB)\n+                    && eq.hasSubType(MiscType.S_CHAINSAW | MiscType.S_DUAL_SAW | MiscType.S_MINING_DRILL)) {\n+                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED)\n+                        || mode.equals(EntityMovementMode.HOVER) || mode.equals(EntityMovementMode.WIGE);\n+            }\n+            if (eq.hasFlag(MiscType.F_MINESWEEPER)) {\n+                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED)\n+                    || isNaval;\n+            }\n+            if (eq.hasFlag(MiscType.F_LIFEBOAT)) {\n+                // Need to filter out atmospheric lifeboat\n+                return isNaval && (eq.hasFlag(MiscType.F_TANK_EQUIPMENT) || eq.hasFlag(MiscType.F_SUPPORT_TANK_EQUIPMENT));\n+            }\n+            if (eq.hasFlag(MiscType.F_HEAVY_BRIDGE_LAYER)\n+                    || eq.hasFlag(MiscType.F_MEDIUM_BRIDGE_LAYER)\n+                    || eq.hasFlag(MiscType.F_LIGHT_BRIDGE_LAYER)\n+                    || (eq.hasFlag(MiscType.F_CLUB)\n+                    && eq.hasSubType(MiscType.S_BACKHOE | MiscType.S_ROCK_CUTTER\n+                    | MiscType.S_SPOT_WELDER | MiscType.S_WRECKING_BALL))) {\n+                return !mode.equals(EntityMovementMode.VTOL);\n+            }\n+            if (eq.hasFlag(MiscType.F_CLUB) && eq.hasSubType(MiscType.S_PILE_DRIVER)) {\n+                return !mode.equals(EntityMovementMode.VTOL)\n+                        && !mode.equals(EntityMovementMode.HOVER)\n+                        && !mode.equals(EntityMovementMode.WIGE);\n+            }\n+            if (eq.hasFlag(MiscType.F_AP_POD)) {\n+                return !isNaval;\n+            }\n+        } else if (eq instanceof WeaponType) {\n+            if (((WeaponType) eq).getAmmoType() == AmmoType.T_BPOD) {\n+                return !isNaval;\n+            }\n+            if (((WeaponType) eq).getAmmoType() == AmmoType.T_NAIL_RIVET_GUN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06ec6f8b30e79745897dd2db34ea049214870915"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTA3OTUx", "url": "https://github.com/MegaMek/megamek/pull/1690#pullrequestreview-360507951", "createdAt": "2020-02-18T16:56:20Z", "commit": {"oid": "06ec6f8b30e79745897dd2db34ea049214870915"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4548, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}