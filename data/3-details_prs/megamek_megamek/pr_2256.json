{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjYzMTA1", "number": 2256, "title": "fix minefield clearance eligibility; bulletproof attack handling", "bodyText": "Fixes #1813\n\"can clear minefield\" was checking ammo types, but lasers don't have ammo, so they were reporting as being able to clear minefields.\nDoing that was causing the WeaponAttackHandler to go into an endless loop as the number of hits would never get reduced. Added a fallback case to reduce the number of hits anyway and log it, to at least avoid going into an endless loop.", "createdAt": "2020-09-27T03:42:15Z", "url": "https://github.com/MegaMek/megamek/pull/2256", "merged": true, "mergeCommit": {"oid": "641c3f0642496e32969294ee161560a6e489ffdc"}, "closed": true, "closedAt": "2020-09-27T04:18:35Z", "author": {"login": "NickAragua"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdM2lN1gH2gAyNDkzNjYzMTA1OjA1ZWY0YTI4MDIwNGEzYWZlMTFhOWUwODhhNDNhNzNlNDMyZjAxYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdM3FhOAH2gAyNDkzNjYzMTA1OmNiNDljNTZlOWNhNThhYTQ1OTRiYzA2MThkMGIxOTY1Y2QxYTExYmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05ef4a280204a3afe11a9e088a43a73e432f01a8", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/05ef4a280204a3afe11a9e088a43a73e432f01a8", "committedDate": "2020-09-27T03:39:51Z", "message": "fix minefield clearance eligibility; bulletproof attack handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDQ4NjA2", "url": "https://github.com/MegaMek/megamek/pull/2256#pullrequestreview-497048606", "createdAt": "2020-09-27T03:54:55Z", "commit": {"oid": "05ef4a280204a3afe11a9e088a43a73e432f01a8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMzo1NDo1NVrOHYkaHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwMzo1NDo1NVrOHYkaHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUyNDM4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    getLogger().error(getClass(), \"Unexpected target type: \" + target.getTargetType());\n          \n          \n            \n                                    getLogger().error(this, \"Unexpected target type: \" + target.getTargetType());", "url": "https://github.com/MegaMek/megamek/pull/2256#discussion_r495524381", "createdAt": "2020-09-27T03:54:55Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/weapons/WeaponHandler.java", "diffHunk": "@@ -1173,33 +1173,34 @@ public boolean handle(IGame.Phase phase, Vector<Report> returnedReports) {\n                         r.subject = subjectId;\n                         vPhaseReport.addElement(r);\n                         hits = 0;\n-                    }\n-                    // targeting a hex for igniting\n-                    if ((target.getTargetType() == Targetable.TYPE_HEX_IGNITE)\n+                    // targeting a hex for igniting    \n+                    } else if ((target.getTargetType() == Targetable.TYPE_HEX_IGNITE)\n                             || (target.getTargetType() == Targetable.TYPE_BLDG_IGNITE)) {\n                         handleIgnitionDamage(vPhaseReport, bldg, hits);\n                         hits = 0;\n-                    }\n                     // targeting a hex for clearing\n-                    if (target.getTargetType() == Targetable.TYPE_HEX_CLEAR) {\n+                    } else if (target.getTargetType() == Targetable.TYPE_HEX_CLEAR) {\n                         nDamage = nDamPerHit * hits;\n                         handleClearDamage(vPhaseReport, bldg, nDamage);\n                         hits = 0;\n-                    }\n                     // Targeting a building.\n-                    if (target.getTargetType() == Targetable.TYPE_BUILDING) {\n+                    } else if (target.getTargetType() == Targetable.TYPE_BUILDING) {\n                         // The building takes the full brunt of the attack.\n                         nDamage = nDamPerHit * hits;\n                         handleBuildingDamage(vPhaseReport, bldg, nDamage,\n                                 target.getPosition());\n                         hits = 0;\n-                    }\n-                    if (entityTarget != null) {\n+                    } else if (entityTarget != null) {\n                         handleEntityDamage(entityTarget, vPhaseReport, bldg,\n                                 hits, nCluster, bldgAbsorbs);\n                         server.creditKill(entityTarget, ae);\n                         hits -= nCluster;\n                         firstHit = false;\n+                    } else {\n+                        // we shouldn't be here, but if we get here, let's set hits to 0\n+                        // to avoid infinite loops\n+                        hits = 0;\n+                        getLogger().error(getClass(), \"Unexpected target type: \" + target.getTargetType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05ef4a280204a3afe11a9e088a43a73e432f01a8"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb49c56e9ca58aa4594bc0618d0b1965cd1a11bd", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/cb49c56e9ca58aa4594bc0618d0b1965cd1a11bd", "committedDate": "2020-09-27T04:15:08Z", "message": "remove redundant null check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4787, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}