{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTExODEx", "number": 2052, "title": "Account for variable equipment size and armored components in TRO entries", "bodyText": "This is part of the variable equipment size changes that kept separate then forgot about. I didn't realize it wasn't merged until I tried to update it to indicated armored components.\nThe equipment table is built by sorting the equipment list by location and mapping the EquipmentType to the number found in that location. I have replaced the EquipmentType key with a data class that distinguishes between different sizes (e.g. a 20' ladder and a 40' ladder in the same location won't be combined into a single ladder) and also between armored and non-armored instances of the same equipment type in the same location.\nThere's also some code cleanup.\nFixes MegaMek/megameklab#636", "createdAt": "2020-07-06T17:32:06Z", "url": "https://github.com/MegaMek/megamek/pull/2052", "merged": true, "mergeCommit": {"oid": "7452505a62791b951b008fe36d1b6673ef812471"}, "closed": true, "closedAt": "2020-07-07T21:43:46Z", "author": {"login": "neoancient"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccROqnAH2gAyNDQ0OTExODExOjQ1NzBjODQ5ZWVlNmY1ZGU0ZDMyZjViZTgyZTMwMmRmODk1N2ZjMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyc48TAFqTQ0MzUzMDA2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4570c849eee6f5de4d32f5be82e302df8957fc1a", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/4570c849eee6f5de4d32f5be82e302df8957fc1a", "committedDate": "2020-04-29T05:00:22Z", "message": "Account for variable sized-equipment in TRO summaries."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbba209d395668db521ae525f2cfbd0683e639ad", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/dbba209d395668db521ae525f2cfbd0683e639ad", "committedDate": "2020-04-29T05:46:06Z", "message": "Don't strip variable size note from equipment name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b3078208e2b576c0768c2a64ebd2f6c48176e2", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/b0b3078208e2b576c0768c2a64ebd2f6c48176e2", "committedDate": "2020-04-29T05:46:41Z", "message": "Warnings cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d1a6e60e5691ca05b86c1b4bed7b19f98b953cd", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/9d1a6e60e5691ca05b86c1b4bed7b19f98b953cd", "committedDate": "2020-07-06T16:32:30Z", "message": "Merge remote-tracking branch 'origin/master' into variable_equipment_tro\n\n# Conflicts:\n#\tmegamek/src/megamek/common/templates/SupportVeeTROView.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b13737d9da6246c72c549bdca51213fd6d98f55", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/5b13737d9da6246c72c549bdca51213fd6d98f55", "committedDate": "2020-07-06T17:14:54Z", "message": "Indicate armored component in TRO view."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjk2Mjc4", "url": "https://github.com/MegaMek/megamek/pull/2052#pullrequestreview-443296278", "createdAt": "2020-07-06T18:01:05Z", "commit": {"oid": "5b13737d9da6246c72c549bdca51213fd6d98f55"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowMTowNlrOGthr2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNDozOFrOGthznw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MTAwMw==", "bodyText": "Yikes.", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450391003", "createdAt": "2020-07-06T18:01:06Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/common/templates/InfantryTROView.java", "diffHunk": "@@ -226,10 +226,8 @@ private void addAugmentationNotes(List<String> notes) {\n         }\n         if (!options.isEmpty()) {\n             notes.add(Messages.getString(\"TROView.InfantryNote.Augmented\"));\n-            options.forEach(o -> {\n-                notes.add(o.getDisplayableName().replaceAll(\"\\\\s+\\\\(Not Implemn?ented\\\\)\", \"\") + \": \"\n-                        + o.getDescription().replaceAll(\"See IO.*\", \"\"));\n-            });\n+            options.forEach(o -> notes.add(o.getDisplayableName().replaceAll(\"\\\\s+\\\\(Not Implemented\\\\)\", \"\") + \": \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b13737d9da6246c72c549bdca51213fd6d98f55"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5Mjk5MQ==", "bodyText": "The name variable appears to get overwritten if the equipment is not ammo but takes up more than one slot?", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450392991", "createdAt": "2020-07-06T18:04:38Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/common/templates/TROView.java", "diffHunk": "@@ -439,26 +429,30 @@ protected int addEquipment(Entity entity, boolean includeAmmo) {\n             if (m.isOmniPodMounted() || !entity.isOmni()) {\n                 final String loc = formatLocationTableEntry(entity, m);\n                 equipment.putIfAbsent(loc, new HashMap<>());\n-                equipment.get(loc).merge(m.getType(), 1, Integer::sum);\n+                equipment.get(loc).merge(new EquipmentKey(m.getType(), m.getSize(), m.isArmored()),\n+                        1, Integer::sum);\n             }\n         }\n         final List<Map<String, Object>> eqList = new ArrayList<>();\n         for (final String loc : equipment.keySet()) {\n-            for (final Map.Entry<EquipmentType, Integer> entry : equipment.get(loc).entrySet()) {\n-                final EquipmentType eq = entry.getKey();\n-                final int count = equipment.get(loc).get(eq);\n-                String name = stripNotes(eq.getName());\n+            for (final Map.Entry<EquipmentKey, Integer> entry : equipment.get(loc).entrySet()) {\n+                final EquipmentType eq = entry.getKey().getType();\n+                final int count = equipment.get(loc).get(entry.getKey());\n+                String name = stripNotes(entry.getKey().name());\n+                if (entry.getKey().isArmored()) {\n+                    name += \" (Armored)\";\n+                }\n                 if (eq instanceof AmmoType) {\n                     name = String.format(\"%s (%d)\", name, ((AmmoType) eq).getShots() * count);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b13737d9da6246c72c549bdca51213fd6d98f55"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a4ed39fd8bbb91555827b60b261eb7ddd8018a", "author": {"user": {"login": "neoancient", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/77a4ed39fd8bbb91555827b60b261eb7ddd8018a", "committedDate": "2020-07-06T19:45:18Z", "message": "Include armored tag when multiple occurrences are in the same location."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNTMwMDYy", "url": "https://github.com/MegaMek/megamek/pull/2052#pullrequestreview-443530062", "createdAt": "2020-07-07T03:01:50Z", "commit": {"oid": "77a4ed39fd8bbb91555827b60b261eb7ddd8018a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4894, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}