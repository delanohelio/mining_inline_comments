{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NjQwNDU5", "number": 2531, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1Mzo0NlrOFKfAHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNjowMjozNFrOFKfCiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM4MDEyOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/ui/swing/dialog/imageChooser/CamoChooser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1Mzo0NlrOINQ-Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxODo0NjoxM1rOINR2kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDQ2Mw==", "bodyText": "Could this be moved to showDialog? This isn't necessary but I started playing with unit testing swing and it would be nice to have effortless ctors going forward.", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780463", "createdAt": "2021-01-01T15:53:46Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/client/ui/swing/dialog/imageChooser/CamoChooser.java", "diffHunk": "@@ -19,49 +19,53 @@\n package megamek.client.ui.swing.dialog.imageChooser;\n \n import megamek.client.ui.swing.tileset.MMStaticDirectoryManager;\n-import megamek.client.ui.swing.util.PlayerColors;\n+import megamek.client.ui.swing.util.PlayerColour;\n+import megamek.common.annotations.Nullable;\n import megamek.common.icons.AbstractIcon;\n import megamek.common.icons.Camouflage;\n import megamek.common.util.fileUtils.DirectoryItems;\n \n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.Objects;\n \n public class CamoChooser extends AbstractIconChooser {\n     //region Variable Declarations\n-    /** True when an individual camo is being selected for an entity. */\n-    private boolean individualCamo = false;\n-\n-    /** When an individual camo is being selected, the player's camo is displayed as a reset option. */\n-    private AbstractIcon entityOwnerCamo;\n+    private AbstractIcon ownerCamouflage;\n+    private AbstractIcon individualCamouflage;\n     //endregion Variable Declarations\n \n     //region Constructors\n-    public CamoChooser() {\n-        this(null);\n-    }\n-\n-    public CamoChooser(AbstractIcon icon) {\n-        super(new CamoChooserTree(), icon);\n+    public CamoChooser(@Nullable AbstractIcon ownerCamouflage, AbstractIcon individualCamouflage) {\n+        super(null, individualCamouflage);\n+        setOwnerCamouflage(ownerCamouflage);\n+        setIndividualCamouflage(individualCamouflage);\n+        refreshDirectory(new CamoChooserTree(hasIndividualCamouflage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc5NDg5OQ==", "bodyText": "To fix the search and some other performance oddities I've found for it I'll need to do a significant rework of parts of the dialog, so I'll add it to that list for you", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550794899", "createdAt": "2021-01-01T18:46:13Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/ui/swing/dialog/imageChooser/CamoChooser.java", "diffHunk": "@@ -19,49 +19,53 @@\n package megamek.client.ui.swing.dialog.imageChooser;\n \n import megamek.client.ui.swing.tileset.MMStaticDirectoryManager;\n-import megamek.client.ui.swing.util.PlayerColors;\n+import megamek.client.ui.swing.util.PlayerColour;\n+import megamek.common.annotations.Nullable;\n import megamek.common.icons.AbstractIcon;\n import megamek.common.icons.Camouflage;\n import megamek.common.util.fileUtils.DirectoryItems;\n \n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.Objects;\n \n public class CamoChooser extends AbstractIconChooser {\n     //region Variable Declarations\n-    /** True when an individual camo is being selected for an entity. */\n-    private boolean individualCamo = false;\n-\n-    /** When an individual camo is being selected, the player's camo is displayed as a reset option. */\n-    private AbstractIcon entityOwnerCamo;\n+    private AbstractIcon ownerCamouflage;\n+    private AbstractIcon individualCamouflage;\n     //endregion Variable Declarations\n \n     //region Constructors\n-    public CamoChooser() {\n-        this(null);\n-    }\n-\n-    public CamoChooser(AbstractIcon icon) {\n-        super(new CamoChooserTree(), icon);\n+    public CamoChooser(@Nullable AbstractIcon ownerCamouflage, AbstractIcon individualCamouflage) {\n+        super(null, individualCamouflage);\n+        setOwnerCamouflage(ownerCamouflage);\n+        setIndividualCamouflage(individualCamouflage);\n+        refreshDirectory(new CamoChooserTree(hasIndividualCamouflage()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDQ2Mw=="}, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM4MTI5OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/ui/swing/skinEditor/SkinEditorMainGUI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1NTo0MFrOINQ-vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1NTo0MFrOINQ-vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDYwNw==", "bodyText": "Perhaps an overload of getCamouflage could help simplify this pattern?\nentity.getCamouflageOrElse(player.getCamouflage())", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780607", "createdAt": "2021-01-01T15:55:40Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/client/ui/swing/skinEditor/SkinEditorMainGUI.java", "diffHunk": "@@ -872,10 +870,9 @@ public JFrame getFrame() {\n     }\n    \n     public void loadPreviewImage(JLabel bp, Entity entity, IPlayer player) {\n-        Image camo = ((entity.getCamoCategory() != null) && !Camouflage.NO_CAMOUFLAGE.equals(entity.getCamoCategory())\n-                ? entity.getCamouflage() : player.getCamouflage()).getImage();\n-        int tint = PlayerColors.getColorRGB(player.getColorIndex());\n-        bp.setIcon(new ImageIcon(bv.getTilesetManager().loadPreviewImage(entity, camo, tint, bp)));\n+        Image camo = (entity.getCamouflage().hasDefaultCategory()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM4NDc5OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/common/preference/IClientPreferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1OTo1NVrOINRAPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1OTo1NVrOINRAPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDk4OQ==", "bodyText": "Is this still needed?", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780989", "createdAt": "2021-01-01T15:59:55Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/preference/IClientPreferences.java", "diffHunk": "@@ -14,6 +14,8 @@\n \n package megamek.common.preference;\n \n+import megamek.client.ui.swing.util.PlayerColour;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM4NTIzOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/server/Server.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNjowMToxM1rOINRAbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxODowMjoyOFrOINRnwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MTAzOQ==", "bodyText": "Should this be equals?", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550781039", "createdAt": "2021-01-01T16:01:13Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -1022,23 +1022,21 @@ private IPlayer addNewPlayer(int connId, String name) {\n             team++;\n         }\n         IPlayer newPlayer = new Player(connId, name);\n-        int colorInd = newPlayer.getColorIndex();\n+        PlayerColour colour = newPlayer.getColour();\n         Enumeration<IPlayer> players = game.getPlayers();\n-        while (players.hasMoreElements() && (colorInd < PlayerColors.COLOR_NAMES.length)) {\n+        final PlayerColour[] colours = PlayerColour.values();\n+        while (players.hasMoreElements()) {\n             final IPlayer p = players.nextElement();\n             if (p.getId() == newPlayer.getId()) {\n                 continue;\n             }\n-            if (p.getColorIndex() == colorInd) {\n-                colorInd++;\n+            if ((p.getColour() == colour) && (colours.length < (colour.ordinal() + 1))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc5MTEwNg==", "bodyText": "No, but it should be greater than instead of less than\nThat's there to prevent an index out of bounds error.", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550791106", "createdAt": "2021-01-01T18:02:28Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -1022,23 +1022,21 @@ private IPlayer addNewPlayer(int connId, String name) {\n             team++;\n         }\n         IPlayer newPlayer = new Player(connId, name);\n-        int colorInd = newPlayer.getColorIndex();\n+        PlayerColour colour = newPlayer.getColour();\n         Enumeration<IPlayer> players = game.getPlayers();\n-        while (players.hasMoreElements() && (colorInd < PlayerColors.COLOR_NAMES.length)) {\n+        final PlayerColour[] colours = PlayerColour.values();\n+        while (players.hasMoreElements()) {\n             final IPlayer p = players.nextElement();\n             if (p.getId() == newPlayer.getId()) {\n                 continue;\n             }\n-            if (p.getColorIndex() == colorInd) {\n-                colorInd++;\n+            if ((p.getColour() == colour) && (colours.length < (colour.ordinal() + 1))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MTAzOQ=="}, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM4NjMyOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/server/Server.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNjowMjozNFrOINRA6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNjowMjozNFrOINRA6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MTE2Mg==", "bodyText": "Consider Set<PlayerColour>", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550781162", "createdAt": "2021-01-01T16:02:34Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -1051,26 +1049,31 @@ private IPlayer addNewPlayer(int connId, String name) {\n     public void validatePlayerInfo(int playerId) {\n         final IPlayer player = getPlayer(playerId);\n \n-        // TODO : check for duplicate or reserved names\n-\n-        // make sure colorIndex is unique\n-        boolean[] colorUsed = new boolean[PlayerColors.COLOR_NAMES.length];\n-        for (Enumeration<IPlayer> i = game.getPlayers(); i.hasMoreElements(); ) {\n-            final IPlayer otherPlayer = i.nextElement();\n-            if (otherPlayer.getId() != playerId) {\n-                colorUsed[otherPlayer.getColorIndex()] = true;\n+        if (player != null) {\n+            // TODO : check for duplicate or reserved names\n+\n+            // Colour Assignment\n+            final PlayerColour[] playerColours = PlayerColour.values();\n+            boolean allUsed = true;\n+            boolean[] colourUtilization = new boolean[playerColours.length];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2563, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}