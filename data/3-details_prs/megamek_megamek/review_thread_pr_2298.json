{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NDY4MDU2", "number": 2298, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoxNTo1NFrOEqHIMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoyODozNlrOEqHLww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNTkyNDM1OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/common/Entity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoxNTo1NFrOHcJPlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQyMDo1OToyNlrOHcKI0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3MzYyMQ==", "bodyText": "If this takes into account height() being one less, as below, can you include that note here too?", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499273621", "createdAt": "2020-10-04T18:15:54Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/Entity.java", "diffHunk": "@@ -2233,6 +2241,11 @@ public boolean canGoUp(int assumedElevation, Coords assumedPos) {\n                 break;\n             case VTOL:\n                 maxAlt = hex.surface() + 50;\n+                // When under a bridge, restrict upward movement\n+                if (hex.containsTerrain(Terrains.BRIDGE_ELEV)\n+                        && assumedElevation < hex.terrainLevel(Terrains.BRIDGE_ELEV)) {\n+                    maxAlt = hex.terrainLevel(Terrains.BRIDGE_ELEV) - height() - 1;   ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4ODI3NQ==", "bodyText": "Done.", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499288275", "createdAt": "2020-10-04T20:59:26Z", "author": {"login": "SJuliez"}, "path": "megamek/src/megamek/common/Entity.java", "diffHunk": "@@ -2233,6 +2241,11 @@ public boolean canGoUp(int assumedElevation, Coords assumedPos) {\n                 break;\n             case VTOL:\n                 maxAlt = hex.surface() + 50;\n+                // When under a bridge, restrict upward movement\n+                if (hex.containsTerrain(Terrains.BRIDGE_ELEV)\n+                        && assumedElevation < hex.terrainLevel(Terrains.BRIDGE_ELEV)) {\n+                    maxAlt = hex.terrainLevel(Terrains.BRIDGE_ELEV) - height() - 1;   ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3MzYyMQ=="}, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNTkyNDc2OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/common/Entity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoxNjoxOFrOHcJPyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQyMDowNjowNFrOHcJ3Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3MzY3Mw==", "bodyText": "Is <= proper for \"under\" a bridge?", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499273673", "createdAt": "2020-10-04T18:16:18Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/Entity.java", "diffHunk": "@@ -2287,23 +2300,34 @@ public boolean isElevationValid(int assumedElevation, IHex hex) {\n         int assumedAlt = assumedElevation + hex.surface();\n         if (getMovementMode() == EntityMovementMode.VTOL) {\n             if ((this instanceof Infantry)\n-                && (hex.containsTerrain(Terrains.BUILDING)\n-                    || hex.containsTerrain(Terrains.WOODS) || hex\n-                    .containsTerrain(Terrains.JUNGLE))) {\n+                    && (hex.containsTerrain(Terrains.BUILDING)\n+                            || hex.containsTerrain(Terrains.WOODS) \n+                            || hex.containsTerrain(Terrains.JUNGLE))) {\n                 // VTOL BA (sylph) can move as ground unit as well\n                 return ((assumedElevation <= 50) && (assumedAlt >= hex.floor()));\n-            } else if (hex.containsTerrain(Terrains.BRIDGE_ELEV)) {\n-                // fly under a bridge as long as there is enough clearance below and above the unit\n-                return (assumedElevation <= 50)\n-                        && assumedElevation > hex.floor()\n-                        && (assumedElevation > hex.terrainLevel(Terrains.BRIDGE_ELEV)\n-                                || assumedElevation + height() < hex.terrainLevel(Terrains.BRIDGE_ELEV) - 1);\n-            } else if (hex.containsTerrain(Terrains.WOODS)\n-                       || hex.containsTerrain(Terrains.WATER)\n-                       || hex.containsTerrain(Terrains.JUNGLE)) {\n-                return ((assumedElevation <= 50) && (assumedAlt > hex.ceiling()));\n-            }\n-            return ((assumedElevation <= 50) && (assumedAlt >= hex.ceiling()));\n+            } else {\n+                // VTOLs can be anywhere on or above ground and fly beneath bridges,\n+                // land on buildings and ignore planted fields and industrial zone \n+                // but cannot land on water or trees\n+                // As always, height() reports one less than the rules (TW p.99) say\n+                // Units may move under a bridge if their top is \n+                // lower than or equal to the bridge height (TW p.62)\n+                boolean allowed = (assumedElevation <= 50) && (assumedElevation >= 0);\n+                if (hex.containsTerrain(Terrains.BRIDGE_ELEV)) {\n+                    allowed &= (assumedElevation >= hex.terrainLevel(Terrains.BRIDGE_ELEV))\n+                            || (assumedElevation + height() + 1 <= hex.terrainLevel(Terrains.BRIDGE_ELEV));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzcxOQ==", "bodyText": "TW says a unit may move under a bridge so long as the height of the unit is less than or equal to the bridge level. I.E. a mech fits under a level 2 bridge. A heli, elevation 1 and height 1 (0 in MM for whatever reason), should also fit under a bridge. I think (hope) this one is correct.", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499283719", "createdAt": "2020-10-04T20:06:04Z", "author": {"login": "SJuliez"}, "path": "megamek/src/megamek/common/Entity.java", "diffHunk": "@@ -2287,23 +2300,34 @@ public boolean isElevationValid(int assumedElevation, IHex hex) {\n         int assumedAlt = assumedElevation + hex.surface();\n         if (getMovementMode() == EntityMovementMode.VTOL) {\n             if ((this instanceof Infantry)\n-                && (hex.containsTerrain(Terrains.BUILDING)\n-                    || hex.containsTerrain(Terrains.WOODS) || hex\n-                    .containsTerrain(Terrains.JUNGLE))) {\n+                    && (hex.containsTerrain(Terrains.BUILDING)\n+                            || hex.containsTerrain(Terrains.WOODS) \n+                            || hex.containsTerrain(Terrains.JUNGLE))) {\n                 // VTOL BA (sylph) can move as ground unit as well\n                 return ((assumedElevation <= 50) && (assumedAlt >= hex.floor()));\n-            } else if (hex.containsTerrain(Terrains.BRIDGE_ELEV)) {\n-                // fly under a bridge as long as there is enough clearance below and above the unit\n-                return (assumedElevation <= 50)\n-                        && assumedElevation > hex.floor()\n-                        && (assumedElevation > hex.terrainLevel(Terrains.BRIDGE_ELEV)\n-                                || assumedElevation + height() < hex.terrainLevel(Terrains.BRIDGE_ELEV) - 1);\n-            } else if (hex.containsTerrain(Terrains.WOODS)\n-                       || hex.containsTerrain(Terrains.WATER)\n-                       || hex.containsTerrain(Terrains.JUNGLE)) {\n-                return ((assumedElevation <= 50) && (assumedAlt > hex.ceiling()));\n-            }\n-            return ((assumedElevation <= 50) && (assumedAlt >= hex.ceiling()));\n+            } else {\n+                // VTOLs can be anywhere on or above ground and fly beneath bridges,\n+                // land on buildings and ignore planted fields and industrial zone \n+                // but cannot land on water or trees\n+                // As always, height() reports one less than the rules (TW p.99) say\n+                // Units may move under a bridge if their top is \n+                // lower than or equal to the bridge height (TW p.62)\n+                boolean allowed = (assumedElevation <= 50) && (assumedElevation >= 0);\n+                if (hex.containsTerrain(Terrains.BRIDGE_ELEV)) {\n+                    allowed &= (assumedElevation >= hex.terrainLevel(Terrains.BRIDGE_ELEV))\n+                            || (assumedElevation + height() + 1 <= hex.terrainLevel(Terrains.BRIDGE_ELEV));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3MzY3Mw=="}, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNTkyNTI3OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/common/pathfinder/PathDecorator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoxNzowOVrOHcJQCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoxNzowOVrOHcJQCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3MzczNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!(source.getEntity().getMovementMode() == EntityMovementMode.VTOL)) {\n          \n          \n            \n                    if (source.getEntity().getMovementMode() != EntityMovementMode.VTOL) {", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499273737", "createdAt": "2020-10-04T18:17:09Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/pathfinder/PathDecorator.java", "diffHunk": "@@ -160,37 +162,58 @@\n     }\n     \n     /**\n-     * Given a path, adds \"UP\" steps to it so that a forward movement can pass over intervening terrain\n+     * For units using VTOL movement, add \"UP\" steps to the end of the MovePath source \n+     * so that a forward movement can pass over intervening terrain\n      */\n     public static void AdjustElevationForForwardMovement(MovePath source) {\n+        // Do this only for VTOLs\n+        if (!(source.getEntity().getMovementMode() == EntityMovementMode.VTOL)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNTkzMzQ3OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/common/Terrain.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoyODozNlrOHcJUJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxODoyODozNlrOHcJUJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3NDc4OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (type == Terrains.BLDG_ELEV && level < 1) {\n          \n          \n            \n                        rv = false;\n          \n          \n            \n                    } else if (type == Terrains.BRIDGE_ELEV && level < 0) {\n          \n          \n            \n                    } else if ((type == Terrains.BLDG_ELEV) && (level < 1)) {\n          \n          \n            \n                        rv = false;\n          \n          \n            \n                    } else if ((type == Terrains.BRIDGE_ELEV) && (level < 0)) {", "url": "https://github.com/MegaMek/megamek/pull/2298#discussion_r499274788", "createdAt": "2020-10-04T18:28:36Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Terrain.java", "diffHunk": "@@ -637,6 +637,10 @@ public boolean isValid(StringBuffer errBuff) {\n             rv = false;\n         } else if (type == Terrains.FOLIAGE_ELEV && (level < 1 || level > 3)) {\n             rv = false;\n+        } else if (type == Terrains.BLDG_ELEV && level < 1) {\n+            rv = false;\n+        } else if (type == Terrains.BRIDGE_ELEV && level < 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37129054a19291717abe0a5fc0899ceb2beb9cc2"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2756, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}