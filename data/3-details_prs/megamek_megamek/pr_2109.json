{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDkzODMw", "number": 2109, "title": "fix path enumerator NPEs for destroyed entities", "bodyText": "Occasionally, a unit will get destroyed while the path enumerator is still calculating movement possibilities for it. Since that happens in a separate thread, the underlying game object gets updated and a call to \"getEntity(id)\" returns null, but the entity object having its moves calculated is still present, leading to NPEs.\nThis should fix that problem (it's difficult to reproduce since it goes away if you kick the bot and have it reconnect) by double checking that the entity is actually in the game before starting path calculations. It also cleans up orphaned entries for that entity in the various lookup tables.\nFixes #1807", "createdAt": "2020-08-05T01:39:22Z", "url": "https://github.com/MegaMek/megamek/pull/2109", "merged": true, "mergeCommit": {"oid": "7b49f5e03d6b77661a5047e8f6a6c6823054f2d7"}, "closed": true, "closedAt": "2020-08-05T02:14:50Z", "author": {"login": "NickAragua"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7xCjWgH2gAyNDYzMDkzODMwOmZhOWYwZDg2N2JkNmRiZDMxMDYwODA3MzJhZmM5ODg0OTg5ZWRkM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7xmB3AH2gAyNDYzMDkzODMwOjY0ZjAxMzNkN2FlMmQ5YTU0NGMyM2M1NTBlYjkzYzg2YTgzZjMwNWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa9f0d867bd6dbd3106080732afc9884989edd3a", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/fa9f0d867bd6dbd3106080732afc9884989edd3a", "committedDate": "2020-08-05T01:35:45Z", "message": "fix path enumerator NPEs for destroyed entities"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjkyNjI2", "url": "https://github.com/MegaMek/megamek/pull/2109#pullrequestreview-461292626", "createdAt": "2020-08-05T02:11:59Z", "commit": {"oid": "fa9f0d867bd6dbd3106080732afc9884989edd3a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjoxMTo1OVrOG73pYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjoxMTo1OVrOG73pYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzMDg4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(getGame().getEntity(mover.getId()) == null) {\n          \n          \n            \n                        if (getGame().getEntity(mover.getId()) == null) {", "url": "https://github.com/MegaMek/megamek/pull/2109#discussion_r465430881", "createdAt": "2020-08-05T02:11:59Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/bot/princess/PathEnumerator.java", "diffHunk": "@@ -179,6 +179,16 @@ public void recalculateMovesFor(final Entity mover) {\n             // Clear out any already calculated paths.\n             getUnitPaths().remove(mover.getId());\n             getLongRangePaths().remove(mover.getId());\n+            \n+            // if the entity does not exist in the game for any reason, let's cut out safely\n+            // otherwise, we'll run into problems calculating paths\n+            if(getGame().getEntity(mover.getId()) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9f0d867bd6dbd3106080732afc9884989edd3a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64f0133d7ae2d9a544c23c550eb93c86a83f305a", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/64f0133d7ae2d9a544c23c550eb93c86a83f305a", "committedDate": "2020-08-05T02:14:30Z", "message": "Update megamek/src/megamek/client/bot/princess/PathEnumerator.java\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4698, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}