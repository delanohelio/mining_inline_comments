{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2Njc2MjIz", "number": 2135, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMDoyMlrOEXp1Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMjoxMTowOVrOEYT5qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjM4MDUxOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/Client.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMDoyMlrOG_j_Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToyNDoyNFrOG_zY8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwMzEzMA==", "bodyText": "Why not use the TilesetManager class instead of basically rolling your own implementation of it? It's present in the BoardView class and contains pretty much all of the information you could need.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r469303130", "createdAt": "2020-08-12T14:30:22Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -161,6 +129,15 @@\n \n     public Map<String, Client> bots = new TreeMap<String, Client>(StringUtil.stringComparator());\n \n+    //get the image data\n+    private MechTileset mechTileset = new MechTileset(Configuration.unitImagesDir());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NTQ0MQ==", "bodyText": "Initially I was having trouble getting an image to show, so after I got it working initially I just kept building around it. Now that I have a better understand of how it works, I'll definitely go back and do it that way and address the other changes as well.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r469555441", "createdAt": "2020-08-12T21:24:24Z", "author": {"login": "Krashner"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -161,6 +129,15 @@\n \n     public Map<String, Client> bots = new TreeMap<String, Client>(StringUtil.stringComparator());\n \n+    //get the image data\n+    private MechTileset mechTileset = new MechTileset(Configuration.unitImagesDir());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwMzEzMA=="}, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjM4MzI1OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMTowMFrOG_kBHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTo1MzowMlrOHAk-Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwMzU4Mg==", "bodyText": "This class needs a standard megamek header comment.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r469303582", "createdAt": "2020-08-12T14:31:00Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package megamek.client.ui.swing.util;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2Nzc1MQ==", "bodyText": "I think we usually put the header comment above the imports.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r470367751", "createdAt": "2020-08-14T01:53:02Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package megamek.client.ui.swing.util;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwMzU4Mg=="}, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjM4NDg5OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMToyNFrOG_kCLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMToyNFrOG_kCLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwMzg1Mw==", "bodyText": "Let's put a javadoc-style comment on the class and any public-facing methods.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r469303853", "createdAt": "2020-08-12T14:31:24Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/ui/swing/util/BASE64ImageView.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package megamek.client.ui.swing.util;\n+\n+import javax.imageio.ImageIO;\n+import javax.swing.text.Element;\n+import javax.swing.text.html.HTML;\n+import javax.swing.text.html.ImageView;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.ByteArrayInputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Base64;\n+import java.util.Dictionary;\n+import java.util.Hashtable;\n+\n+public class BASE64ImageView extends ImageView {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjM4NjYzOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/ui/swing/util/BASE64ToolKit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMTo0NlrOG_kDRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNDozMTo0NlrOG_kDRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMwNDEzNA==", "bodyText": "\"Copyright\" header, javadoc comment on class and public-facing methods.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r469304134", "createdAt": "2020-08-12T14:31:46Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/ui/swing/util/BASE64ToolKit.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package megamek.client.ui.swing.util;\n+\n+import javax.swing.text.*;\n+import javax.swing.text.html.HTML;\n+import javax.swing.text.html.HTMLEditorKit;\n+\n+public class BASE64ToolKit extends HTMLEditorKit {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e533857b10bca0bc6061667f2fe7d6ae64e3394"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTI0MjIxOnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/Client.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTo1MDozMVrOHAk7tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTo1MDozMVrOHAk7tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2NzE1OQ==", "bodyText": "Let's get rid of this commented out method.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r470367159", "createdAt": "2020-08-14T01:50:31Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -274,6 +245,14 @@ protected void updateConnection() {\n         }\n     }\n \n+    private BoardView1 bv;\n+    public void setBoardView(BoardView1 bv){\n+        this.bv = bv;\n+    }\n+\n+    //public getBoardView(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b613715a6f674c68b10210479f2a34c2dee7883d"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTI3MzM3OnYy", "diffSide": "RIGHT", "path": "megamek/src/megamek/client/Client.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMjoxMTowOVrOHAlODQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNDo0MlrOHA8ZzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3MTg1Mw==", "bodyText": "I'm fairly certain that the TilesetManager has its own caching mechanism. I don't think you need to have a separate caching mechanism here.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r470371853", "createdAt": "2020-08-14T02:11:09Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1125,7 +1115,85 @@ public String receiveReport(Vector<Report> v) {\n         for (Report r : v) {\n             report.append(r.getText());\n         }\n-        return report.toString();\n+\n+        Set<Integer> set = new HashSet<Integer>();\n+        //find id stored in spans and extract it\n+        Pattern p = Pattern.compile(\"<s(.*?)n>\");\n+        Matcher m = p.matcher(report.toString());\n+\n+        //add all instances to a hashset to prevent duplicates\n+        while(m.find()){\n+            String cleanedText = m.group(1).replaceAll(\"\\\\D\", \"\");\n+            if(cleanedText.length() > 0) {\n+                set.add(Integer.parseInt(cleanedText));\n+            }\n+        }\n+\n+        String updatedReport = report.toString();\n+        //loop through the hashset of unique ids and replace the ids with img tags\n+        for (int i : set) {\n+            if(getCachedImageData(i) != null) {\n+                updatedReport = updatedReport.replace(\"<span id='\" +i + \"'></span>\", getCachedImageData(i));\n+            }\n+        }\n+        return updatedReport;\n+    }\n+\n+    /**\n+     * get img tag for unit id\n+     */\n+    private String getCachedImageData(int id){\n+        if(imgCache == null || !imgCache.containsKey(id)) {\n+            return null;\n+        }\n+        return imgCache.get(id);\n+    }\n+\n+    /**\n+     * Hashtable for storing image tags containing base64Text src\n+     */\n+    private void cacheImageData(Entity entity){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b613715a6f674c68b10210479f2a34c2dee7883d"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwMTIxOQ==", "bodyText": "I looked at that, but I'm storing strings after the image is encoded as a Base64 string and put into an <img> tag. the data looks something like the following, but just quite a bit longer.\n<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAwCAYAAABE1blzAAALvkl...'>\nI do actually use TilesetManager's image cache when I call imageFor though. Perhaps I should rename cacheImageData so that it doesn't sound like I'm just recaching the images?", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r470601219", "createdAt": "2020-08-14T12:45:09Z", "author": {"login": "Krashner"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1125,7 +1115,85 @@ public String receiveReport(Vector<Report> v) {\n         for (Report r : v) {\n             report.append(r.getText());\n         }\n-        return report.toString();\n+\n+        Set<Integer> set = new HashSet<Integer>();\n+        //find id stored in spans and extract it\n+        Pattern p = Pattern.compile(\"<s(.*?)n>\");\n+        Matcher m = p.matcher(report.toString());\n+\n+        //add all instances to a hashset to prevent duplicates\n+        while(m.find()){\n+            String cleanedText = m.group(1).replaceAll(\"\\\\D\", \"\");\n+            if(cleanedText.length() > 0) {\n+                set.add(Integer.parseInt(cleanedText));\n+            }\n+        }\n+\n+        String updatedReport = report.toString();\n+        //loop through the hashset of unique ids and replace the ids with img tags\n+        for (int i : set) {\n+            if(getCachedImageData(i) != null) {\n+                updatedReport = updatedReport.replace(\"<span id='\" +i + \"'></span>\", getCachedImageData(i));\n+            }\n+        }\n+        return updatedReport;\n+    }\n+\n+    /**\n+     * get img tag for unit id\n+     */\n+    private String getCachedImageData(int id){\n+        if(imgCache == null || !imgCache.containsKey(id)) {\n+            return null;\n+        }\n+        return imgCache.get(id);\n+    }\n+\n+    /**\n+     * Hashtable for storing image tags containing base64Text src\n+     */\n+    private void cacheImageData(Entity entity){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3MTg1Mw=="}, "originalCommit": {"oid": "b613715a6f674c68b10210479f2a34c2dee7883d"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MTY5Mw==", "bodyText": "Now that I look at it again, I get what you're doing.", "url": "https://github.com/MegaMek/megamek/pull/2135#discussion_r470751693", "createdAt": "2020-08-14T17:14:42Z", "author": {"login": "NickAragua"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1125,7 +1115,85 @@ public String receiveReport(Vector<Report> v) {\n         for (Report r : v) {\n             report.append(r.getText());\n         }\n-        return report.toString();\n+\n+        Set<Integer> set = new HashSet<Integer>();\n+        //find id stored in spans and extract it\n+        Pattern p = Pattern.compile(\"<s(.*?)n>\");\n+        Matcher m = p.matcher(report.toString());\n+\n+        //add all instances to a hashset to prevent duplicates\n+        while(m.find()){\n+            String cleanedText = m.group(1).replaceAll(\"\\\\D\", \"\");\n+            if(cleanedText.length() > 0) {\n+                set.add(Integer.parseInt(cleanedText));\n+            }\n+        }\n+\n+        String updatedReport = report.toString();\n+        //loop through the hashset of unique ids and replace the ids with img tags\n+        for (int i : set) {\n+            if(getCachedImageData(i) != null) {\n+                updatedReport = updatedReport.replace(\"<span id='\" +i + \"'></span>\", getCachedImageData(i));\n+            }\n+        }\n+        return updatedReport;\n+    }\n+\n+    /**\n+     * get img tag for unit id\n+     */\n+    private String getCachedImageData(int id){\n+        if(imgCache == null || !imgCache.containsKey(id)) {\n+            return null;\n+        }\n+        return imgCache.get(id);\n+    }\n+\n+    /**\n+     * Hashtable for storing image tags containing base64Text src\n+     */\n+    private void cacheImageData(Entity entity){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3MTg1Mw=="}, "originalCommit": {"oid": "b613715a6f674c68b10210479f2a34c2dee7883d"}, "originalPosition": 203}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2647, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}