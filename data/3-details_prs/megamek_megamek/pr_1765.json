{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MjU2MzY4", "number": 1765, "title": "Issue1583 map editor", "bodyText": "Removed tileManager.loadAllHexes() from a boardview event handler. This line creates long load times (10s or more, was I the only one having this?). In everything I did (start games, load games, MapEditor, change tileset) it did not seem to make a difference. AFAIK the tileset images load individually whenever necessary. Tileset changes are handled elsewhere.\n\n\nBridge:0 is now correctly marked as invalid and the MapEditor will not write it to the map.\n\n\nThe board now reports a BUILDING hex that has forced exits and an exit to an adjacent BUILDING hex of different type (e.g. building:2 and building:1) or different class (BLDG_CLASS:) as invalid. The hexes themselves can't be marked easily because a hex cannot make this validation.\n\n\nUsing board validation in the MapEditor will now call board.initializeHex on all hexes which will restructure all exitable terrains that do not have forced exits wherever necessary. This autocorrects buildings, roads and bridges and the like. If the user has checked the \"Exits\" checkbox (forcing the exits) on a hex then that hex will not be corrected but may report as invalid.\n\n\nSaving a board in the MapEditor (Save or Save As) will now first run board validation (as above). This means it will autocorrect building and road connection issues and report errors if there are any. It will then save the board anyway but at least the user has been notified of problems.\nNote: This autocorrection may change building and road hexes. This may remove things the user wanted to keep such as mixed buildings and cut off roads. But loading a board will run InitializeHex on all hexes removing these things anyway.  Therefore, as far as I can make out, all the changes that happen now before saving are unavoidable. So better make them visible to the user right away.\n\n\nReplaced tabs with white space and changed some comments and moved definitions around. And curiously I found Building.defaultCF but still dont know where in the rules the value of 120 for a hardened building comes from.", "createdAt": "2020-03-14T10:48:41Z", "url": "https://github.com/MegaMek/megamek/pull/1765", "merged": true, "mergeCommit": {"oid": "a392955443c0ba48a0b2e8349eae569ffa472789"}, "closed": true, "closedAt": "2020-03-20T01:51:17Z", "author": {"login": "SJuliez"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNe6PkAH2gAyMzg4MjU2MzY4Ojg1NzZjZjQ5NTA4NDVhZThiZTk4OTkxZDliMTJmMWJkZjM3MjU3ZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPTIUrAFqTM3ODExOTcwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8576cf4950845ae8be98991d9b12f1bdf37257fd", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/8576cf4950845ae8be98991d9b12f1bdf37257fd", "committedDate": "2020-03-14T06:27:52Z", "message": "MapEditor Validation for Buildings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7db87d026711a203a26e95e84d785263922d669a", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/7db87d026711a203a26e95e84d785263922d669a", "committedDate": "2020-03-14T08:48:34Z", "message": "MapEditor Validation Updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6feb724ad59c32595e39555e052d370172a33c", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/3d6feb724ad59c32595e39555e052d370172a33c", "committedDate": "2020-03-14T09:56:03Z", "message": "Adjustments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebfced3b2a2cb934317da966df391f093ef980aa", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/ebfced3b2a2cb934317da966df391f093ef980aa", "committedDate": "2020-03-14T09:58:27Z", "message": "Tabs replaced with white spaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/51276a5806b93f153d53eb6a4e6fa523edde4eba", "committedDate": "2020-03-14T10:31:08Z", "message": "Remove double validation report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzI4MjI4", "url": "https://github.com/MegaMek/megamek/pull/1765#pullrequestreview-374728228", "createdAt": "2020-03-14T13:45:12Z", "commit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NToxMlrOF2Zwzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NToxMlrOF2Zwzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTUxOQ==", "bodyText": "Then why keep the code?", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392589519", "createdAt": "2020-03-14T13:45:12Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/ui/swing/boardview/BoardView1.java", "diffHunk": "@@ -5120,7 +5120,7 @@ public synchronized void boardChangedHex(BoardEvent b) {\n      */\n     public synchronized void boardChangedAllHexes(BoardEvent b) {\n         clearHexImageCache();\n-        tileManager.loadAllHexes();\n+//        tileManager.loadAllHexes(); Creates long load times and seems unnecessary ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzI4Mjg5", "url": "https://github.com/MegaMek/megamek/pull/1765#pullrequestreview-374728289", "createdAt": "2020-03-14T13:46:19Z", "commit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzo0NjoxOVrOF2ZxKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDoxMDozOFrOF2Z3Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTYxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (errBuff.length()>0)\n          \n          \n            \n                                    errBuff.append(\"----\\n\");\n          \n          \n            \n                                if (errBuff.length() > 0) {\n          \n          \n            \n                                    errBuff.append(\"----\\n\");\n          \n          \n            \n                                }", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392589610", "createdAt": "2020-03-14T13:46:19Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit in direction \"+dir+\" to a building of another Building Class.\\n\");\n+                            }\n+                        }\n+                    }\n+                }\n+                \n                 // Return early if we aren't logging errors\n                 if (!valid && (errBuff == null)) {\n                     return false;\n                 } else if (!valid) { // Otherwise, log the error for later output\n-                    errBuff.append(\"Hex \" + String.format(\"%1$02d%02$2d\", x + 1, y + 1) + \" is invalid!\\n\");\n-                    errBuff.append(currBuff.toString().replaceAll(\"^\", \"\\t\"));\n+                    if (errBuff.length()>0)\n+                        errBuff.append(\"----\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTYzNw==", "bodyText": "Just easier to read", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392589637", "createdAt": "2020-03-14T13:46:34Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit in direction \"+dir+\" to a building of another Building Class.\\n\");\n+                            }\n+                        }\n+                    }\n+                }\n+                \n                 // Return early if we aren't logging errors\n                 if (!valid && (errBuff == null)) {\n                     return false;\n                 } else if (!valid) { // Otherwise, log the error for later output\n-                    errBuff.append(\"Hex \" + String.format(\"%1$02d%02$2d\", x + 1, y + 1) + \" is invalid!\\n\");\n-                    errBuff.append(currBuff.toString().replaceAll(\"^\", \"\\t\"));\n+                    if (errBuff.length()>0)\n+                        errBuff.append(\"----\\n\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTYxMA=="}, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4OTY4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                Coords c = new Coords(x,y);\n          \n          \n            \n                                Coords c = new Coords(x, y);", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392589682", "createdAt": "2020-03-14T13:47:22Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit in direction \"+dir+\" to a building of another Building Class.\\n\");\n+                            }\n+                        }\n+                    }\n+                }\n+                \n                 // Return early if we aren't logging errors\n                 if (!valid && (errBuff == null)) {\n                     return false;\n                 } else if (!valid) { // Otherwise, log the error for later output\n-                    errBuff.append(\"Hex \" + String.format(\"%1$02d%02$2d\", x + 1, y + 1) + \" is invalid!\\n\");\n-                    errBuff.append(currBuff.toString().replaceAll(\"^\", \"\\t\"));\n+                    if (errBuff.length()>0)\n+                        errBuff.append(\"----\\n\");\n+                    Coords c = new Coords(x,y);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDEyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                errBuff.append(\"Hex \" + c.getBoardNum() + \" is invalid:\\n\");\n          \n          \n            \n                                errBuff.append(currBuff.toString());\n          \n          \n            \n                                errBuff.append(\"Hex \" + c.getBoardNum() + \" is invalid:\\n\")\n          \n          \n            \n                                        .append(currBuff.toString());", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590122", "createdAt": "2020-03-14T13:53:51Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit in direction \"+dir+\" to a building of another Building Class.\\n\");\n+                            }\n+                        }\n+                    }\n+                }\n+                \n                 // Return early if we aren't logging errors\n                 if (!valid && (errBuff == null)) {\n                     return false;\n                 } else if (!valid) { // Otherwise, log the error for later output\n-                    errBuff.append(\"Hex \" + String.format(\"%1$02d%02$2d\", x + 1, y + 1) + \" is invalid!\\n\");\n-                    errBuff.append(currBuff.toString().replaceAll(\"^\", \"\\t\"));\n+                    if (errBuff.length()>0)\n+                        errBuff.append(\"----\\n\");\n+                    Coords c = new Coords(x,y);\n+                    errBuff.append(\"Hex \" + c.getBoardNum() + \" is invalid:\\n\");\n+                    errBuff.append(currBuff.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDIwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (type == Terrains.BRIDGE && level < 1) {\n          \n          \n            \n                    } else if ((type == Terrains.BRIDGE) && (level < 1)) {", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590200", "createdAt": "2020-03-14T13:55:03Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Terrain.java", "diffHunk": "@@ -633,6 +633,8 @@ public boolean isValid(StringBuffer errBuff) {\n             rv = false;\n         } else if (type == Terrains.TUNDRA && level != 1) {\n             rv = false;\n+        } else if (type == Terrains.BRIDGE && level < 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDI3NA==", "bodyText": "Suggested change", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590274", "createdAt": "2020-03-14T13:55:49Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -33,13 +33,21 @@\n  */\n public class Building implements Serializable {\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDMwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // The Building Class\n          \n          \n            \n                // The Building Classes", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590302", "createdAt": "2020-03-14T13:56:07Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -33,13 +33,21 @@\n  */\n public class Building implements Serializable {\n \n-    // Private attributes and helper functions.\n-\n-    /**\n-     *\n-     */\n     private static final long serialVersionUID = -8236017592012683793L;\n \n+    // The Building Types\n+    public static final int LIGHT = 1;\n+    public static final int MEDIUM = 2;\n+    public static final int HEAVY = 3;\n+    public static final int HARDENED = 4;\n+    public static final int WALL = 5;\n+    \n+    // The Building Class", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDM4OA==", "bodyText": "Remove this comment and the CASTLE_BRIAN constant, and move it to be commented out under the building classes above", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590388", "createdAt": "2020-03-14T13:57:40Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -268,22 +279,6 @@ public static BasementType getType(int value) {\n         }\n     }\n \n-    /**\n-     * Various construction types.\n-     */\n-    public static final int LIGHT = 1;\n-    public static final int MEDIUM = 2;\n-    public static final int HEAVY = 3;\n-    public static final int HARDENED = 4;\n-    public static final int WALL = 5;\n-\n-    /**\n-     * Various building types\n-     */\n-    public static final int STANDARD = 0;\n-    public static final int HANGAR = 1;\n-    public static final int FORTRESS = 2;\n-    public static final int GUN_EMPLACEMENT = 3;\n \n     // TODO: leaving out Castles Brian until issues with damage scaling are\n     // resolved", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDQ0Mg==", "bodyText": "Does this not error out if the Construction factor changes? IIRC, shouldn't that be enforced too?", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590442", "createdAt": "2020-03-14T13:58:35Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -167,7 +178,7 @@ protected void include(Coords coords, IBoard board, int structureType) {\n         }\n \n         if (structureType == Terrains.BUILDING) {\n-            // Error off if the building type, or CF is off.\n+            // Error if the Building Type (Light, Medium...) or Building Class (Standard, Hangar...) is off.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDY4MQ==", "bodyText": "UNKNOWN should probably be moved up here from line 235.", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590681", "createdAt": "2020-03-14T14:02:14Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -33,13 +33,21 @@\n  */\n public class Building implements Serializable {\n \n-    // Private attributes and helper functions.\n-\n-    /**\n-     *\n-     */\n     private static final long serialVersionUID = -8236017592012683793L;\n \n+    // The Building Types", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDc4Mw==", "bodyText": "Maybe move this to be listed under the classes instead of having a comment that might go out of date?", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590783", "createdAt": "2020-03-14T14:04:01Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -51,16 +59,19 @@\n     private Vector<Coords> coordinates = new Vector<Coords>();\n \n     /**\n-     * The construction type of the building.\n+     * The Construction Type of the building; equal to the terrain elevation of the BUILDING terrain of a hex.\n+     * Types: LIGHT, MEDIUM, HEAVY, HARDENED, WALL\n      */\n     private int type = Building.UNKNOWN;\n \n     /**\n      * The Basement type of the building.\n      */\n     private Map<Coords,BasementType> basement = new HashMap<Coords,BasementType>();\n+    \n     /**\n-     * the class of the building\n+     * The Building Class of the building; equal to the terrain elevation of the BUILDING CLASS terrain of a hex.\n+     * Types: STANDARD, HANGAR, FORTRESS, GUN_EMPLACEMENT \n      */\n     private int bldgClass = Building.STANDARD;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDgwMw==", "bodyText": "Maybe move this to be under the list of types instead of a comment?", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590803", "createdAt": "2020-03-14T14:04:22Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Building.java", "diffHunk": "@@ -51,16 +59,19 @@\n     private Vector<Coords> coordinates = new Vector<Coords>();\n \n     /**\n-     * The construction type of the building.\n+     * The Construction Type of the building; equal to the terrain elevation of the BUILDING terrain of a hex.\n+     * Types: LIGHT, MEDIUM, HEAVY, HARDENED, WALL\n      */\n     private int type = Building.UNKNOWN;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MDg1MA==", "bodyText": "Why use a StringBuffer? Does this require thread safety?", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392590850", "createdAt": "2020-03-14T14:05:19Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/ui/swing/BoardEditor.java", "diffHunk": "@@ -1440,12 +1440,32 @@ public String getDescription() {\n         mapSettings.setBoardSize(board.getWidth(), board.getHeight());\n         refreshTerrainList();\n     }\n+    \n+    /**\n+     * Will do board.initializeHex() for all hexes, correcting \n+     * building and road connection issues for those hexes that do not have\n+     * the exits check set.\n+     */\n+    private void correctExits() {\n+        for (int x = 0; x < board.getWidth(); x++) {\n+            for (int y = 0; y < board.getHeight(); y++) {\n+                board.initializeHex(x, y);\n+            }\n+        }\n+    }\n \n     /**\n      * Checks to see if there is already a path and name stored; if not, calls\n      * \"save as\"; otherwise, saves the board to the specified file.\n      */\n     private void boardSave() {\n+        // First, correct connection issues and do a validation.\n+        correctExits();\n+        StringBuffer errBuff = new StringBuffer();\n+        board.isValid(errBuff);\n+        if (errBuff.length() > 0) {\n+            showBoardValidationReport(errBuff);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTA0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n          \n          \n            \n                                    {\n          \n          \n            \n                                            && hex.containsTerrainExit(Terrains.BUILDING, dir)) {", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392591044", "createdAt": "2020-03-14T14:08:32Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTA2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    if (adjHex != null \n          \n          \n            \n                                    if ((adjHex != null)", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392591064", "createdAt": "2020-03-14T14:08:42Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTEzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                        && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n          \n          \n            \n                                                        && (adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel()))", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392591131", "createdAt": "2020-03-14T14:09:36Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTE0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                        || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n          \n          \n            \n                                                        || (!adjHex.containsTerrain(Terrains.BLDG_CLASS)))) {", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392591145", "createdAt": "2020-03-14T14:09:50Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTE4Mw==", "bodyText": "Replace the + dir + with chained append calls.", "url": "https://github.com/MegaMek/megamek/pull/1765#discussion_r392591183", "createdAt": "2020-03-14T14:10:38Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/common/Board.java", "diffHunk": "@@ -971,12 +971,40 @@ private boolean isValid(IHex[] data, int width, int height, StringBuffer errBuff\n                 }\n                 StringBuffer currBuff = new StringBuffer();\n                 boolean valid = hex.isValid(currBuff);\n+                \n+                // Multi-hex problems \n+                // A building hex must only have exits to other building hexes of the same Building Type and Class\n+                if (hex.containsTerrain(Terrains.BUILDING) && hex.getTerrain(Terrains.BUILDING).hasExitsSpecified()) {\n+                    for (int dir = 0; dir < 6; dir++) {\n+                        IHex adjHex = getHexInDir(x, y, dir);\n+                        if (adjHex != null \n+                                && adjHex.containsTerrain(Terrains.BUILDING) \n+                                && hex.containsTerrainExit(Terrains.BUILDING, dir)) \n+                        {\n+                            if (adjHex.getTerrain(Terrains.BUILDING).getLevel() != hex.getTerrain(Terrains.BUILDING).getLevel()) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit to a building of another Building Type (Light, Medium...).\\n\");\n+                            }\n+                            if (hex.containsTerrain(Terrains.BLDG_CLASS) \n+                                    && ((adjHex.containsTerrain(Terrains.BLDG_CLASS) \n+                                            && adjHex.getTerrain(Terrains.BLDG_CLASS).getLevel() != hex.getTerrain(Terrains.BLDG_CLASS).getLevel())\n+                                            || (!adjHex.containsTerrain(Terrains.BLDG_CLASS) )  )) {\n+                                valid = false;\n+                                currBuff.append(\"Building has an exit in direction \"+dir+\" to a building of another Building Class.\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51276a5806b93f153d53eb6a4e6fa523edde4eba"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "370df68b1b560e07446676e285da7960b477cfd2", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/370df68b1b560e07446676e285da7960b477cfd2", "committedDate": "2020-03-19T21:08:23Z", "message": "Update megamek/src/megamek/common/Board.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "547ce93bb109fc309bdfca4d19c54e0691df50ab", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/547ce93bb109fc309bdfca4d19c54e0691df50ab", "committedDate": "2020-03-19T21:30:10Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dab6f588dbbeaee547189d1fd7dfced1adc7c9c", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/7dab6f588dbbeaee547189d1fd7dfced1adc7c9c", "committedDate": "2020-03-19T21:32:06Z", "message": "Merge remote-tracking branch 'JuliezFork/Issue1583_MapEditor' into\nIssue1583_Bridge0\n\nConflicts:\n\tmegamek/src/megamek/common/Board.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4daec8ddf817d7086754961c8f1ea53a65537cc2", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/4daec8ddf817d7086754961c8f1ea53a65537cc2", "committedDate": "2020-03-19T21:35:00Z", "message": "Merge branch 'master' into Issue1583_MapEditor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "281dd39e9c1a1a1ee28fea6ed4cd14c1e898f58f", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/281dd39e9c1a1a1ee28fea6ed4cd14c1e898f58f", "committedDate": "2020-03-19T21:41:06Z", "message": "Small change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "059dd8fa79617e30cd069c12f2ad3b8c50e44b4c", "author": {"user": {"login": "SJuliez", "name": null}}, "url": "https://github.com/MegaMek/megamek/commit/059dd8fa79617e30cd069c12f2ad3b8c50e44b4c", "committedDate": "2020-03-19T21:42:15Z", "message": "Merge remote-tracking branch 'JuliezFork/Issue1583_MapEditor' into Issue1583_Bridge0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTE5NzA5", "url": "https://github.com/MegaMek/megamek/pull/1765#pullrequestreview-378119709", "createdAt": "2020-03-19T21:52:14Z", "commit": {"oid": "059dd8fa79617e30cd069c12f2ad3b8c50e44b4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4601, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}