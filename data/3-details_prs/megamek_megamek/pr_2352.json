{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NTAzMTkx", "number": 2352, "title": "File Factory Standardization", "bodyText": "Following up on #2165, this relocates and standardizes the file factories.\nThis requires the MekHQ-side to merge.", "createdAt": "2020-10-22T19:13:36Z", "url": "https://github.com/MegaMek/megamek/pull/2352", "merged": true, "mergeCommit": {"oid": "3efc064688571f00460c2da4036cc90b14a96e95"}, "closed": true, "closedAt": "2020-11-04T02:14:38Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVGKOxgH2gAyNTA4NTAzMTkxOmY5MmU3ZmU5MzU0OTJiMGI5Yzc0Y2JhNzVhOTEyYTBlNWRlYTIwY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXVoudgFqTUxOTkxMDUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f92e7fe935492b0b9c74cba75a912a0e5dea20cf", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/f92e7fe935492b0b9c74cba75a912a0e5dea20cf", "committedDate": "2020-10-22T18:20:15Z", "message": "File reorganization and code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05d36041767569151ec4ed3f929efa9a0ad37966", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/05d36041767569151ec4ed3f929efa9a0ad37966", "committedDate": "2020-10-22T19:04:48Z", "message": "Simplifying FileFactories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f88c203a82d14d46ff98f5304e313a4756524816", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/f88c203a82d14d46ff98f5304e313a4756524816", "committedDate": "2020-10-22T19:21:58Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FileFactory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MjAzMzgx", "url": "https://github.com/MegaMek/megamek/pull/2352#pullrequestreview-515203381", "createdAt": "2020-10-23T00:18:35Z", "commit": {"oid": "f88c203a82d14d46ff98f5304e313a4756524816"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMDoxODozNVrOHm4QBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMDoxODozNVrOHm4QBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDUyOTU0MA==", "bodyText": "Should we be caching the scaled image as long as height/width don't change? Or do we scale them a lot?", "url": "https://github.com/MegaMek/megamek/pull/2352#discussion_r510529540", "createdAt": "2020-10-23T00:18:35Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/util/fileUtils/ScaledImageFileFactory.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright (C) 2004 - Ben Mazur (bmazur@sev.org)\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MegaMek.\n+ *\n+ * MegaMek is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MegaMek is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MegaMek. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package megamek.common.util.fileUtils;\n+\n+import java.awt.Image;\n+import java.io.File;\n+import java.util.Objects;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipFile;\n+\n+import megamek.common.util.ImageUtil;\n+\n+/**\n+ * This class will produce <code>Image</code> objects from files. If an image\n+ * file is inside of JAR and ZIP file, then it must save the contents to a\n+ * temporary file. Created on January 18, 2004\n+ * \n+ * @author James Damour\n+ * @version 1\n+ */\n+public class ScaledImageFileFactory extends ImageFileFactory {\n+    //region Variable Declarations\n+    protected int width;\n+    protected int height;\n+    //endregion Variable Declarations\n+\n+    //region Constructors\n+    public ScaledImageFileFactory() {\n+        this(84, 72);\n+    }\n+\n+    public ScaledImageFileFactory(int width, int height) {\n+        super();\n+        setWidth(width);\n+        setHeight(height);\n+    }\n+    //endregion Constructors\n+\n+    //region Getters/Setters\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    public void setWidth(int width) {\n+        this.width = width;\n+    }\n+\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    public void setHeight(int height) {\n+        this.height = height;\n+    }\n+    //endregion Getters/Setters\n+\n+    /**\n+     * Get the <code>ItemFile</code> for the given <code>File</code>.\n+     *\n+     * @param file The input <code>File</code> object that will be read to produce the item.\n+     *             This value must not be <code>null</code>.\n+     * @return an <code>ItemFile</code> for the given file.\n+     */\n+    @Override\n+    public ItemFile getItemFile(final File file) {\n+        // Validate the input.\n+        Objects.requireNonNull(file, \"A null image file was passed.\");\n+\n+        // Construct an anonymous class that gets an Image for the file.\n+        return new ItemFile() {\n+            private File itemFile = file; // copy the file entry\n+            private Image image = null; // cache the Image\n+\n+            @Override\n+            public Object getItem() {\n+                // Cache the image on first use.\n+                if (image == null) {\n+                    String name = itemFile.getAbsolutePath();\n+                    image = ImageUtil.loadImageFromFile(name);\n+                }\n+                // Return a copy of the image.\n+                return ImageUtil.getScaledImage(image, getWidth(), getHeight());\n+            }\n+        };\n+    }\n+\n+    /**\n+     * Get the <code>ItemFile</code> for the given <code>ZipEntry</code> in the <code>ZipFile</code>.\n+     *\n+     * @param zipEntry The <code>ZipEntry</code> that will be read to produce the item. This value\n+     *                 must not be <code>null</code>.\n+     * @param zipFile The <code>ZipFile</code> object that contains the <code>ZipEntry</code>\n+     *                that will produce the item. This value must not be <code>null</code>.\n+     * @return an <code>ItemFile</code> for the given zip file entry.\n+     */\n+    @Override\n+    public ItemFile getItemFile(final ZipEntry zipEntry, final ZipFile zipFile) {\n+        // Validate the input.\n+        Objects.requireNonNull(zipEntry, \"A null ZIP entry was passed.\");\n+        Objects.requireNonNull(zipFile, \"A null ZIP file was passed.\");\n+\n+        // Construct an anonymous class that gets an Image for the file.\n+        return new ItemFile() {\n+            private ZipEntry itemEntry = zipEntry; // copy the ZipEntry\n+            private Image image = null; // cache the Image\n+\n+            @Override\n+            public Object getItem() throws Exception {\n+                // Cache the image on first use.\n+                if (image == null) {\n+                    image = createZippedImage(itemEntry, zipFile);\n+                }\n+                // Return a copy of the image.\n+                return ImageUtil.getScaledImage(image, getWidth(), getHeight());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f88c203a82d14d46ff98f5304e313a4756524816"}, "originalPosition": 132}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be75a048e56d5f6c5687a48f6641e5f5654ff26", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/3be75a048e56d5f6c5687a48f6641e5f5654ff26", "committedDate": "2020-10-23T00:28:05Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FileFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea08f704e740436513243b1b6202c73c28ad1d1", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/aea08f704e740436513243b1b6202c73c28ad1d1", "committedDate": "2020-10-23T17:01:35Z", "message": "Storing as scaled instead of rescaling each time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTEwNTI3", "url": "https://github.com/MegaMek/megamek/pull/2352#pullrequestreview-519910527", "createdAt": "2020-10-29T17:29:59Z", "commit": {"oid": "aea08f704e740436513243b1b6202c73c28ad1d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4652, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}