{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NjQwNDU5", "number": 2531, "title": "MekHQ 1727: Colour Camouflage", "bodyText": "This PR contains the following changes:\n\n Create PlayerColour Enum to simplify internal player colours\n Separates Player Colours from Camouflage Colours (long-standing camo bug... the two should not correlate. However, this will require a separate enhancement allowing one to customize the colour, which will be done in the next few days)\n Separates Colour Camouflage from No Camouflage\n Standardize Camouflage Selector Dialogs (MegaMek/mekhq#1727)\n Fixes #2499, with the rest of the issue being MekHQ-origin issues subsumed by MegaMek/mekhq#2318\n Remove unused Icon Panel classes\n Cleanup antiquated GUIPreferences usages (String name colours, string booleans)\n\nThis fixes #2499.\nTo Review: I'm currently testing this branch, but am opening it up so that it can be reviewed and tested by more than just myself. The changes here are significant enough to open a PR up before moving on with the camouflage changes. They are in a working state, albeit one that does not fix current bugs. Because of this I have identified the cause of MegaMek/mekhq#2318, which will be fixed in the camouflage swapover", "createdAt": "2020-12-25T23:46:05Z", "url": "https://github.com/MegaMek/megamek/pull/2531", "merged": true, "mergeCommit": {"oid": "f4d6b681babdcecfc92200ed1251d52903e6a3e6"}, "closed": true, "closedAt": "2021-01-01T22:13:53Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpwGbuAH2gAyNTQ1NjQwNDU5OjQ0NGZjNGViNDliYTgyMDcxMTExZWUxMTMzNTZkMjJlYjM3OGFlZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdr-kagAFqTU2MDYwNDE4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "444fc4eb49ba82071111ee113356d22eb378aed8", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/444fc4eb49ba82071111ee113356d22eb378aed8", "committedDate": "2020-12-25T22:30:36Z", "message": "PlayerColours, Colour Camo Standardization, and standardizing camo selector"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aebace10abc9ba8f067007ba3f2c7301192e7431", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/aebace10abc9ba8f067007ba3f2c7301192e7431", "committedDate": "2020-12-25T23:30:57Z", "message": "Applying changes as per review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68a23ae3076d0f06f5f3667ecb1d35ee03f8a978", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/68a23ae3076d0f06f5f3667ecb1d35ee03f8a978", "committedDate": "2020-12-27T01:43:58Z", "message": "Bugfixing Player Colours implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae5051db38ec0c3c58a8987dd8e77dfaff2930ee", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/ae5051db38ec0c3c58a8987dd8e77dfaff2930ee", "committedDate": "2020-12-27T02:28:25Z", "message": "Cleaning up ECM Effects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f11ddd5aa0aaa4646ca32342ea9a09abe98ec457", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/f11ddd5aa0aaa4646ca32342ea9a09abe98ec457", "committedDate": "2020-12-27T03:39:21Z", "message": "1727: Fixing duplicated player colours during initial assignment, provided there are free new colours"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4a36130bea4a2d04fe2ab3aaa022a41e14d98ad", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/a4a36130bea4a2d04fe2ab3aaa022a41e14d98ad", "committedDate": "2020-12-27T04:00:56Z", "message": "Fixing a few AbstractIconChooser comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2529d78d2639e223e1f9db5d5e73d9c60b20f6f1", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/2529d78d2639e223e1f9db5d5e73d9c60b20f6f1", "committedDate": "2020-12-28T20:53:20Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_1727"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/4348a54d51610c3b170302287aa825e8e25a711f", "committedDate": "2020-12-31T15:50:21Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_1727"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTkyOTQ3", "url": "https://github.com/MegaMek/megamek/pull/2531#pullrequestreview-560592947", "createdAt": "2021-01-01T15:53:46Z", "commit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTo1Mzo0NlrOINQ-Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNjowMjozNFrOINRA6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDQ2Mw==", "bodyText": "Could this be moved to showDialog? This isn't necessary but I started playing with unit testing swing and it would be nice to have effortless ctors going forward.", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780463", "createdAt": "2021-01-01T15:53:46Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/client/ui/swing/dialog/imageChooser/CamoChooser.java", "diffHunk": "@@ -19,49 +19,53 @@\n package megamek.client.ui.swing.dialog.imageChooser;\n \n import megamek.client.ui.swing.tileset.MMStaticDirectoryManager;\n-import megamek.client.ui.swing.util.PlayerColors;\n+import megamek.client.ui.swing.util.PlayerColour;\n+import megamek.common.annotations.Nullable;\n import megamek.common.icons.AbstractIcon;\n import megamek.common.icons.Camouflage;\n import megamek.common.util.fileUtils.DirectoryItems;\n \n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.Objects;\n \n public class CamoChooser extends AbstractIconChooser {\n     //region Variable Declarations\n-    /** True when an individual camo is being selected for an entity. */\n-    private boolean individualCamo = false;\n-\n-    /** When an individual camo is being selected, the player's camo is displayed as a reset option. */\n-    private AbstractIcon entityOwnerCamo;\n+    private AbstractIcon ownerCamouflage;\n+    private AbstractIcon individualCamouflage;\n     //endregion Variable Declarations\n \n     //region Constructors\n-    public CamoChooser() {\n-        this(null);\n-    }\n-\n-    public CamoChooser(AbstractIcon icon) {\n-        super(new CamoChooserTree(), icon);\n+    public CamoChooser(@Nullable AbstractIcon ownerCamouflage, AbstractIcon individualCamouflage) {\n+        super(null, individualCamouflage);\n+        setOwnerCamouflage(ownerCamouflage);\n+        setIndividualCamouflage(individualCamouflage);\n+        refreshDirectory(new CamoChooserTree(hasIndividualCamouflage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDYwNw==", "bodyText": "Perhaps an overload of getCamouflage could help simplify this pattern?\nentity.getCamouflageOrElse(player.getCamouflage())", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780607", "createdAt": "2021-01-01T15:55:40Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/client/ui/swing/skinEditor/SkinEditorMainGUI.java", "diffHunk": "@@ -872,10 +870,9 @@ public JFrame getFrame() {\n     }\n    \n     public void loadPreviewImage(JLabel bp, Entity entity, IPlayer player) {\n-        Image camo = ((entity.getCamoCategory() != null) && !Camouflage.NO_CAMOUFLAGE.equals(entity.getCamoCategory())\n-                ? entity.getCamouflage() : player.getCamouflage()).getImage();\n-        int tint = PlayerColors.getColorRGB(player.getColorIndex());\n-        bp.setIcon(new ImageIcon(bv.getTilesetManager().loadPreviewImage(entity, camo, tint, bp)));\n+        Image camo = (entity.getCamouflage().hasDefaultCategory()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MDk4OQ==", "bodyText": "Is this still needed?", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550780989", "createdAt": "2021-01-01T15:59:55Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/common/preference/IClientPreferences.java", "diffHunk": "@@ -14,6 +14,8 @@\n \n package megamek.common.preference;\n \n+import megamek.client.ui.swing.util.PlayerColour;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MTAzOQ==", "bodyText": "Should this be equals?", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550781039", "createdAt": "2021-01-01T16:01:13Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -1022,23 +1022,21 @@ private IPlayer addNewPlayer(int connId, String name) {\n             team++;\n         }\n         IPlayer newPlayer = new Player(connId, name);\n-        int colorInd = newPlayer.getColorIndex();\n+        PlayerColour colour = newPlayer.getColour();\n         Enumeration<IPlayer> players = game.getPlayers();\n-        while (players.hasMoreElements() && (colorInd < PlayerColors.COLOR_NAMES.length)) {\n+        final PlayerColour[] colours = PlayerColour.values();\n+        while (players.hasMoreElements()) {\n             final IPlayer p = players.nextElement();\n             if (p.getId() == newPlayer.getId()) {\n                 continue;\n             }\n-            if (p.getColorIndex() == colorInd) {\n-                colorInd++;\n+            if ((p.getColour() == colour) && (colours.length < (colour.ordinal() + 1))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc4MTE2Mg==", "bodyText": "Consider Set<PlayerColour>", "url": "https://github.com/MegaMek/megamek/pull/2531#discussion_r550781162", "createdAt": "2021-01-01T16:02:34Z", "author": {"login": "sixlettervariables"}, "path": "megamek/src/megamek/server/Server.java", "diffHunk": "@@ -1051,26 +1049,31 @@ private IPlayer addNewPlayer(int connId, String name) {\n     public void validatePlayerInfo(int playerId) {\n         final IPlayer player = getPlayer(playerId);\n \n-        // TODO : check for duplicate or reserved names\n-\n-        // make sure colorIndex is unique\n-        boolean[] colorUsed = new boolean[PlayerColors.COLOR_NAMES.length];\n-        for (Enumeration<IPlayer> i = game.getPlayers(); i.hasMoreElements(); ) {\n-            final IPlayer otherPlayer = i.nextElement();\n-            if (otherPlayer.getId() != playerId) {\n-                colorUsed[otherPlayer.getColorIndex()] = true;\n+        if (player != null) {\n+            // TODO : check for duplicate or reserved names\n+\n+            // Colour Assignment\n+            final PlayerColour[] playerColours = PlayerColour.values();\n+            boolean allUsed = true;\n+            boolean[] colourUtilization = new boolean[playerColours.length];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4348a54d51610c3b170302287aa825e8e25a711f"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e97072d7562e1ece518680df1197d41fc45018b6", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/megamek/commit/e97072d7562e1ece518680df1197d41fc45018b6", "committedDate": "2021-01-01T18:48:13Z", "message": "Implementing changes per review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjA0MTgz", "url": "https://github.com/MegaMek/megamek/pull/2531#pullrequestreview-560604183", "createdAt": "2021-01-01T20:29:52Z", "commit": {"oid": "e97072d7562e1ece518680df1197d41fc45018b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4635, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}