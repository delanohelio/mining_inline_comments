{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4ODg0NDEx", "number": 2156, "title": "Fixed null pointer exception causing bot to break", "bodyText": "Fix for #2150. In some instances, the BoardView for the client is being called before it gets initialized. So I just added a null check to fix the error. I also refactored the null check prior to trying to encode an image to better protect from a potential null reference. I didn't notice any other problems, but if more issues arise in regards to PR #2135 then just notify me and I'll take a look at them too.", "createdAt": "2020-08-17T14:55:10Z", "url": "https://github.com/MegaMek/megamek/pull/2156", "merged": true, "mergeCommit": {"oid": "aab38a644a271c92634ecde2f977a35ad4433823"}, "closed": true, "closedAt": "2020-08-17T15:36:44Z", "author": {"login": "Krashner"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_zaSdgH2gAyNDY4ODg0NDExOjYzMjM0NDVlYzc0Y2FkZDIyMjQyZWZkYmI5MjJkOGM0Yjc2Yjg1MmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_0LaBAFqTQ2ODU2ODg1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b", "author": {"user": {"login": "Krashner", "name": "Justin"}}, "url": "https://github.com/MegaMek/megamek/commit/6323445ec74cadd22242efdbb922d8c4b76b852b", "committedDate": "2020-08-17T14:37:11Z", "message": "Fixed null pointer exception causing bot to break"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTQxNjk4", "url": "https://github.com/MegaMek/megamek/pull/2156#pullrequestreview-468541698", "createdAt": "2020-08-17T14:59:34Z", "commit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo1OTozNFrOHBscKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowMzoyM1rOHBsmDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODcyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        System.out.println(\"Null entity reference in cacheImgTag()\");\n          \n          \n            \n                        MegaMek.getLogger().error(this, \"Null entity reference\");", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538728", "createdAt": "2020-08-17T14:59:34Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODkyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n          \n          \n            \n                    } else if (imgCache.containsKey(entity.getId())) {\n          \n          \n            \n                        //remove images that should be refreshed", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538929", "createdAt": "2020-08-17T14:59:51Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzOTU1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache\n          \n          \n            \n                    if (getTargetImage(entity) != null) {\n          \n          \n            \n                        //convert image to base64, add to to <img> tag and store in cache", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471539559", "createdAt": "2020-08-17T15:00:43Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n             imgCache.remove(entity.getId());\n         }\n \n-        //convert to base64, add to to <img> tag and store in cache\n-        if (!imgCache.containsKey(entity.getId())) {\n-            Image image = ImageUtil.getScaledImage(getTargetImage(entity),  56, 48);\n-            if(image!=null) {\n-                try {\n-                    String base64Text;\n-                    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n-                    ImageIO.write((RenderedImage) image, \"png\", baos);\n-                    baos.flush();\n-                    base64Text = Base64.getEncoder().encodeToString(baos.toByteArray());\n-                    baos.close();\n-                    String img = \"<img src='data:image/png;base64,\" + base64Text + \"'>\";\n-                    imgCache.put(entity.getId(), img);\n-                } catch (final IOException ioe) {\n-                    throw new UncheckedIOException(ioe);\n-                }\n+        if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw==", "bodyText": "if (bv == null) {\n    return null;\n} else if (e.isDestroyed()) {\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\n} else {\n    return bv.getTilesetManager().imageFor(e);\n}", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541003", "createdAt": "2020-08-17T15:02:58Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1186,10 +1182,14 @@ private void cacheImgTag(Entity entity){\n      * Gets the current mech image\n      */\n     private Image getTargetImage(Entity e){\n-        if(e.isDestroyed()) {\n-            return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+        if(bv == null){\n+            return  null;\n         }else {\n-            return bv.getTilesetManager().imageFor(e);\n+            if (e.isDestroyed()) {\n+                return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+            } else {\n+                return bv.getTilesetManager().imageFor(e);\n+            }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTI2Mw==", "bodyText": "Suggested rewrite to improve readability.", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541263", "createdAt": "2020-08-17T15:03:23Z", "author": {"login": "Windchild292"}, "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1186,10 +1182,14 @@ private void cacheImgTag(Entity entity){\n      * Gets the current mech image\n      */\n     private Image getTargetImage(Entity e){\n-        if(e.isDestroyed()) {\n-            return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+        if(bv == null){\n+            return  null;\n         }else {\n-            return bv.getTilesetManager().imageFor(e);\n+            if (e.isDestroyed()) {\n+                return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+            } else {\n+                return bv.getTilesetManager().imageFor(e);\n+            }\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}, "originalCommit": {"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "003a3704d61d4a88f229a76b99c1cd9b0636eff9", "author": {"user": {"login": "Krashner", "name": "Justin"}}, "url": "https://github.com/MegaMek/megamek/commit/003a3704d61d4a88f229a76b99c1cd9b0636eff9", "committedDate": "2020-08-17T15:11:52Z", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "404482bd4a69bc7978ea6b2172f6961766dbd2da", "author": {"user": {"login": "Krashner", "name": "Justin"}}, "url": "https://github.com/MegaMek/megamek/commit/404482bd4a69bc7978ea6b2172f6961766dbd2da", "committedDate": "2020-08-17T15:12:13Z", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c806953e87dfc92726070d9009e96d7bc399b36d", "author": {"user": {"login": "Krashner", "name": "Justin"}}, "url": "https://github.com/MegaMek/megamek/commit/c806953e87dfc92726070d9009e96d7bc399b36d", "committedDate": "2020-08-17T15:12:27Z", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55578c152e70d891c312091a55fae76076549952", "author": {"user": {"login": "Krashner", "name": "Justin"}}, "url": "https://github.com/MegaMek/megamek/commit/55578c152e70d891c312091a55fae76076549952", "committedDate": "2020-08-17T15:16:13Z", "message": "Fixed readability for getTargetImage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTY4ODUy", "url": "https://github.com/MegaMek/megamek/pull/2156#pullrequestreview-468568852", "createdAt": "2020-08-17T15:30:50Z", "commit": {"oid": "55578c152e70d891c312091a55fae76076549952"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4722, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}