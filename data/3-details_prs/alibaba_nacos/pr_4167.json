{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MTM4NzY0", "number": 4167, "title": "[ISSUE-#4166] Optimize notifyCenter code", "bodyText": "What is the purpose of the change\nFor-#4166", "createdAt": "2020-11-07T13:36:03Z", "url": "https://github.com/alibaba/nacos/pull/4167", "merged": true, "mergeCommit": {"oid": "48d0c68527010f91e3fbcb07753f91979d62e5fa"}, "closed": true, "closedAt": "2020-11-09T03:17:31Z", "author": {"login": "horizonzy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaLXDSAH2gAyNTE3MTM4NzY0OmIwNTQ4NzliMmU2ZjgwMmJlNGFjM2ZhZWY0ODNmNmFmZDE1MzEyMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdasADkgFqTUyNTg5OTA1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/b054879b2e6f802be4ac3faef483f6afd153120f", "committedDate": "2020-11-07T13:13:24Z", "message": "enhance notify center code quality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODczNjg4", "url": "https://github.com/alibaba/nacos/pull/4167#pullrequestreview-525873688", "createdAt": "2020-11-09T01:26:10Z", "commit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjoxMVrOHvcV7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjo1NFrOHvcWcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTQ4NA==", "bodyText": "I think the old implementation is better for readablilty", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519509484", "createdAt": "2020-11-09T01:26:11Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -250,13 +250,12 @@ private static void addSubscriber(final Subscriber consumer, Class<? extends Eve\n     private static boolean removeSubscriber(final Subscriber consumer, Class<? extends Event> subscribeType) {\n         \n         final String topic = ClassUtils.getCanonicalName(subscribeType);\n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            publisher.removeSubscriber(consumer);\n-            return true;\n+        EventPublisher eventPublisher = INSTANCE.publisherMap.get(topic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTYxNg==", "bodyText": "Same as above", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519509616", "createdAt": "2020-11-09T01:26:54Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -281,18 +280,19 @@ public static boolean publishEvent(final Event event) {\n      * @param event     event instance.\n      */\n     private static boolean publishEvent(final Class<? extends Event> eventType, final Event event) {\n-        final String topic = ClassUtils.getCanonicalName(eventType);\n         if (ClassUtils.isAssignableFrom(SlowEvent.class, eventType)) {\n             return INSTANCE.sharePublisher.publish(event);\n         }\n         \n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            return publisher.publish(event);\n+        final String topic = ClassUtils.getCanonicalName(eventType);\n+        \n+        EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n+        if (publisher == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a5b5df2f9fc9865541866168ec78025aaf96f4", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/57a5b5df2f9fc9865541866168ec78025aaf96f4", "committedDate": "2020-11-09T02:39:25Z", "message": "reverse the judge logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODk5MDUw", "url": "https://github.com/alibaba/nacos/pull/4167#pullrequestreview-525899050", "createdAt": "2020-11-09T03:14:00Z", "commit": {"oid": "57a5b5df2f9fc9865541866168ec78025aaf96f4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMzoxNDowMFrOHvdrqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMzoxNDowMFrOHvdrqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUzMTQzNA==", "bodyText": "OK", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519531434", "createdAt": "2020-11-09T03:14:00Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -250,13 +250,12 @@ private static void addSubscriber(final Subscriber consumer, Class<? extends Eve\n     private static boolean removeSubscriber(final Subscriber consumer, Class<? extends Event> subscribeType) {\n         \n         final String topic = ClassUtils.getCanonicalName(subscribeType);\n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            publisher.removeSubscriber(consumer);\n-            return true;\n+        EventPublisher eventPublisher = INSTANCE.publisherMap.get(topic);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTQ4NA=="}, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 90}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4215, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}