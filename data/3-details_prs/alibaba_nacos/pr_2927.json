{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTU4ODcy", "number": 2927, "title": "[ISSUE#1815]Adding lifecycle interface and resolve the service downtime caused by thread leak ", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\nThe related issue is [ISSUE #1815 ]\n(1)Adding lifecycle interface and resolve the service downtime caused by thread leak .\nBrief changelog\n(1)Define and implement the lifecycle interface and related abstract class codes.\n(2)Add lifecycle related codes.\n(3)Adjust the ServerHttpAgent and MetricsHttpAgent class to implement the lifecycle interface.\nVerifying this change\nI have already add the unit test codes.\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.", "createdAt": "2020-05-31T04:24:42Z", "url": "https://github.com/alibaba/nacos/pull/2927", "merged": true, "mergeCommit": {"oid": "4c38fe139b974d8b069826b63fa49f2d25c24182"}, "closed": true, "closedAt": "2020-06-11T05:47:56Z", "author": {"login": "zongtanghu"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckp8kKgH2gAyNDI1NTU4ODcyOjBkZGJlN2QyNmVhY2VlYWNhMzQ0MWRmZWJlNGJmNWUyNmMwZmQwODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqHrf-gFqTQyODYwODQ3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0ddbe7d26eaceeaca3441dfebe4bf5e26c0fd087", "author": {"user": {"login": "yanlinly", "name": "yanlinly"}}, "url": "https://github.com/alibaba/nacos/commit/0ddbe7d26eaceeaca3441dfebe4bf5e26c0fd087", "committedDate": "2020-05-25T06:19:37Z", "message": "Merge pull request #2875 from alibaba/develop\n\nupdate 1.3.0 beta"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "886fe6de00cdcefda6c9434c9211c3da40fc2166", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/886fe6de00cdcefda6c9434c9211c3da40fc2166", "committedDate": "2020-05-29T06:12:32Z", "message": "[#1815]define LifeCycle interface and related abstract class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6981fbc57641b953afd1e42cad2827e27c8ae390", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/6981fbc57641b953afd1e42cad2827e27c8ae390", "committedDate": "2020-05-29T11:10:06Z", "message": "[#1815]add ResourceLifeCycleManager,adjust some code and fix some unit test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1baed235386290ed5bac012865d5949344fe98", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/6d1baed235386290ed5bac012865d5949344fe98", "committedDate": "2020-05-31T04:20:20Z", "message": "[#1815]add the related lifecycle test cases codes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cb690a6a0ee5eead744bb56e123a09b1ca012fc", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/2cb690a6a0ee5eead744bb56e123a09b1ca012fc", "committedDate": "2020-05-31T05:26:06Z", "message": "[#1815]add class file license."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab3b234987458a492eb52738764542c085953c85", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/ab3b234987458a492eb52738764542c085953c85", "committedDate": "2020-05-31T05:26:27Z", "message": "[#1815]add class file license."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDY0NDc2", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-421464476", "createdAt": "2020-05-31T06:09:56Z", "commit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjowOTo1NlrOGc28XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjowOTo1NlrOGc28XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMzUwMQ==", "bodyText": "The thread pool shutdown code should sink into ThreadUtils", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r432913501", "createdAt": "2020-05-31T06:09:56Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/ServerHttpAgent.java", "diffHunk": "@@ -329,7 +315,57 @@ private void initMaxRetry(Properties properties) {\n     }\n \n     @Override\n-    public synchronized void start() throws NacosException {\n+    protected void doStart() throws Exception {\n+        LOGGER.info(\"do start begin\");\n+\n+        // init executorService\n+        this.executorService = new ScheduledThreadPoolExecutor(1, new ThreadFactory() {\n+            @Override\n+            public Thread newThread(Runnable r) {\n+                Thread t = new Thread(r);\n+                t.setName(\"com.alibaba.nacos.client.config.security.updater\");\n+                t.setDaemon(true);\n+                return t;\n+            }\n+        });\n+\n+        this.executorService.scheduleWithFixedDelay(new Runnable() {\n+            @Override\n+            public void run() {\n+                securityProxy.login(serverListMgr.getServerUrls());\n+            }\n+        }, 0, securityInfoRefreshIntervalMills, TimeUnit.MILLISECONDS);\n+\n+        LOGGER.info(\"do start end\");\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDY0NTgx", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-421464581", "createdAt": "2020-05-31T06:12:20Z", "commit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxMjoyMFrOGc28-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxMjoyMFrOGc28-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMzY1Nw==", "bodyText": "New Object() may be executed multiple times", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r432913657", "createdAt": "2020-05-31T06:12:20Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/lifecycle/ResourceLifeCycleManager.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.alibaba.nacos.common.lifecycle;\n+\n+import com.alibaba.nacos.common.utils.ShutdownUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+/**\n+ * A class to manage every instances' life cycle which register into it.\n+ * @author zongtanghu\n+ *\n+ */\n+public final class ResourceLifeCycleManager {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ResourceLifeCycleManager.class);\n+\n+    /**\n+     * <Object instance...>\n+     */\n+    private List<AbstractLifeCycle> lifeCycleResources;\n+\n+    /**\n+     * Map<Object instance, Object>\n+     */\n+    private Map<AbstractLifeCycle, Object> lockers = new ConcurrentHashMap<AbstractLifeCycle, Object>(8);\n+\n+    private static final ResourceLifeCycleManager INSTANCE = new ResourceLifeCycleManager();\n+\n+    private static final AtomicBoolean CLOSED = new AtomicBoolean(false);\n+\n+    static {\n+        INSTANCE.init();\n+        ShutdownUtils.addShutdownHook(new Thread(new Runnable() {\n+            @Override\n+            public void run() {\n+                LOGGER.warn(\"[LifeCycleManager] Start destroying Every Instance\");\n+                shutdown();\n+                LOGGER.warn(\"[LifeCycleManager] Destruction of the end\");\n+            }\n+        }));\n+    }\n+\n+    private void init() {\n+        this.lifeCycleResources = new CopyOnWriteArrayList<AbstractLifeCycle>();\n+    }\n+\n+    public static ResourceLifeCycleManager getInstance() {\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Destroy all of the life cycle resources which are managed by ResourceLifeCycleManager.\n+     *\n+     */\n+    public static void shutdown() {\n+        if (!CLOSED.compareAndSet(false, true)) {\n+            return;\n+        }\n+\n+        List<AbstractLifeCycle> instances = INSTANCE.lifeCycleResources;\n+        for (AbstractLifeCycle instance : instances) {\n+            INSTANCE.destroy(instance);\n+        }\n+    }\n+\n+    /**\n+     * Destroy the life cycle resource instance.\n+     *\n+     * @param instance the life cycle resource instance which is need to be destroyed.\n+     */\n+    public void destroy(AbstractLifeCycle instance) {\n+        final Object monitor = lockers.get(instance);\n+        if (monitor == null) {\n+            return;\n+        }\n+        synchronized (monitor) {\n+            try {\n+                // the life cycle resources which managed are do stop method.\n+                if (LOGGER.isDebugEnabled()) {\n+                    LOGGER.debug(\"Life cycle resources do stop\");\n+                }\n+                instance.stop();\n+                INSTANCE.lifeCycleResources.remove(instance);\n+                INSTANCE.lockers.remove(instance);\n+            } catch (Exception e) {\n+                LOGGER.error(\"An exception occurred during resource do stop : {}\", e);\n+            }\n+        }\n+    }\n+\n+\n+    /**\n+     * Cancel the specified lifecycle resource instance management.\n+     *\n+     * @param instance the management life cycle resource instances;\n+     *\n+     */\n+    public void deregister(AbstractLifeCycle instance) {\n+        if (this.lifeCycleResources.contains(instance)) {\n+            final Object monitor = lockers.get(instance);\n+            synchronized (monitor) {\n+                this.lifeCycleResources.remove(instance);\n+                this.lockers.remove(instance);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Register the life cycle resource instances into the lifeCycleResources lists.\n+     *\n+     * @param instance the management life cycle resource instances.\n+     */\n+    public void register(AbstractLifeCycle instance) {\n+        if (!lifeCycleResources.contains(instance)) {\n+            synchronized(this) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "originalPosition": 135}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDYyOTk0", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-421462994", "createdAt": "2020-05-31T05:33:44Z", "commit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNTozMzo0NFrOGc202A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxMzozNFrOGc29Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMTU3Ng==", "bodyText": "use this.serverHttpAgent.start()", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r432911576", "createdAt": "2020-05-31T05:33:44Z", "author": {"login": "wangweizZZ"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/MetricsHttpAgent.java", "diffHunk": "@@ -91,22 +92,32 @@ public HttpResult httpDelete(String path, List<String> headers, List<String> par\n \n     @Override\n     public String getName() {\n-        return httpAgent.getName();\n+        return this.serverHttpAgent.getName();\n     }\n \n     @Override\n     public String getNamespace() {\n-        return httpAgent.getNamespace();\n+        return this.serverHttpAgent.getNamespace();\n     }\n \n     @Override\n     public String getTenant() {\n-        return httpAgent.getTenant();\n+        return this.serverHttpAgent.getTenant();\n     }\n \n     @Override\n     public String getEncode() {\n-        return httpAgent.getEncode();\n+        return this.serverHttpAgent.getEncode();\n+    }\n+\n+    @Override\n+    public void doStart() throws Exception {\n+        this.serverHttpAgent.doStart();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMTc1OQ==", "bodyText": "use this.serverHttpAgent.stop()", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r432911759", "createdAt": "2020-05-31T05:37:05Z", "author": {"login": "wangweizZZ"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/MetricsHttpAgent.java", "diffHunk": "@@ -91,22 +92,32 @@ public HttpResult httpDelete(String path, List<String> headers, List<String> par\n \n     @Override\n     public String getName() {\n-        return httpAgent.getName();\n+        return this.serverHttpAgent.getName();\n     }\n \n     @Override\n     public String getNamespace() {\n-        return httpAgent.getNamespace();\n+        return this.serverHttpAgent.getNamespace();\n     }\n \n     @Override\n     public String getTenant() {\n-        return httpAgent.getTenant();\n+        return this.serverHttpAgent.getTenant();\n     }\n \n     @Override\n     public String getEncode() {\n-        return httpAgent.getEncode();\n+        return this.serverHttpAgent.getEncode();\n+    }\n+\n+    @Override\n+    public void doStart() throws Exception {\n+        this.serverHttpAgent.doStart();\n+    }\n+\n+    @Override\n+    public void doStop() throws Exception {\n+        this.serverHttpAgent.doStop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMzczOQ==", "bodyText": "maybe need double check?", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r432913739", "createdAt": "2020-05-31T06:13:34Z", "author": {"login": "wangweizZZ"}, "path": "common/src/main/java/com/alibaba/nacos/common/lifecycle/ResourceLifeCycleManager.java", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.alibaba.nacos.common.lifecycle;\n+\n+import com.alibaba.nacos.common.utils.ShutdownUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+/**\n+ * A class to manage every instances' life cycle which register into it.\n+ * @author zongtanghu\n+ *\n+ */\n+public final class ResourceLifeCycleManager {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ResourceLifeCycleManager.class);\n+\n+    /**\n+     * <Object instance...>\n+     */\n+    private List<AbstractLifeCycle> lifeCycleResources;\n+\n+    /**\n+     * Map<Object instance, Object>\n+     */\n+    private Map<AbstractLifeCycle, Object> lockers = new ConcurrentHashMap<AbstractLifeCycle, Object>(8);\n+\n+    private static final ResourceLifeCycleManager INSTANCE = new ResourceLifeCycleManager();\n+\n+    private static final AtomicBoolean CLOSED = new AtomicBoolean(false);\n+\n+    static {\n+        INSTANCE.init();\n+        ShutdownUtils.addShutdownHook(new Thread(new Runnable() {\n+            @Override\n+            public void run() {\n+                LOGGER.warn(\"[LifeCycleManager] Start destroying Every Instance\");\n+                shutdown();\n+                LOGGER.warn(\"[LifeCycleManager] Destruction of the end\");\n+            }\n+        }));\n+    }\n+\n+    private void init() {\n+        this.lifeCycleResources = new CopyOnWriteArrayList<AbstractLifeCycle>();\n+    }\n+\n+    public static ResourceLifeCycleManager getInstance() {\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Destroy all of the life cycle resources which are managed by ResourceLifeCycleManager.\n+     *\n+     */\n+    public static void shutdown() {\n+        if (!CLOSED.compareAndSet(false, true)) {\n+            return;\n+        }\n+\n+        List<AbstractLifeCycle> instances = INSTANCE.lifeCycleResources;\n+        for (AbstractLifeCycle instance : instances) {\n+            INSTANCE.destroy(instance);\n+        }\n+    }\n+\n+    /**\n+     * Destroy the life cycle resource instance.\n+     *\n+     * @param instance the life cycle resource instance which is need to be destroyed.\n+     */\n+    public void destroy(AbstractLifeCycle instance) {\n+        final Object monitor = lockers.get(instance);\n+        if (monitor == null) {\n+            return;\n+        }\n+        synchronized (monitor) {\n+            try {\n+                // the life cycle resources which managed are do stop method.\n+                if (LOGGER.isDebugEnabled()) {\n+                    LOGGER.debug(\"Life cycle resources do stop\");\n+                }\n+                instance.stop();\n+                INSTANCE.lifeCycleResources.remove(instance);\n+                INSTANCE.lockers.remove(instance);\n+            } catch (Exception e) {\n+                LOGGER.error(\"An exception occurred during resource do stop : {}\", e);\n+            }\n+        }\n+    }\n+\n+\n+    /**\n+     * Cancel the specified lifecycle resource instance management.\n+     *\n+     * @param instance the management life cycle resource instances;\n+     *\n+     */\n+    public void deregister(AbstractLifeCycle instance) {\n+        if (this.lifeCycleResources.contains(instance)) {\n+            final Object monitor = lockers.get(instance);\n+            synchronized (monitor) {\n+                this.lifeCycleResources.remove(instance);\n+                this.lockers.remove(instance);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Register the life cycle resource instances into the lifeCycleResources lists.\n+     *\n+     * @param instance the management life cycle resource instances.\n+     */\n+    public void register(AbstractLifeCycle instance) {\n+        if (!lifeCycleResources.contains(instance)) {\n+            synchronized(this) {\n+                lockers.put(instance, new Object());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab3b234987458a492eb52738764542c085953c85"}, "originalPosition": 136}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d6dd8f41b362967ec9d19a041a9bc9b2ab76095", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/8d6dd8f41b362967ec9d19a041a9bc9b2ab76095", "committedDate": "2020-06-01T09:57:35Z", "message": "[#1815]adjust codes and reput the lifecycle to ConfigService class level."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/2ab274216a59cf3e1765de0a940c8ae86d316869", "committedDate": "2020-06-02T11:55:30Z", "message": "[#1815]adjust and optimize codes, reput the lifecycle to ConfigService class level at the same time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjc3NTcy", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-422677572", "createdAt": "2020-06-02T13:31:22Z", "commit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozMToyMlrOGdxtZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozMToyMlrOGdxtZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg3NjMyNw==", "bodyText": "Better add the class name to see which Object is currently closed", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r433876327", "createdAt": "2020-06-02T13:31:22Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/ServerHttpAgent.java", "diffHunk": "@@ -413,22 +420,29 @@ private static String getSTSResponse() throws IOException {\n \n     @Override\n     public String getName() {\n-        return serverListMgr.getName();\n+        return this.serverListMgr.getName();\n     }\n \n     @Override\n     public String getNamespace() {\n-        return serverListMgr.getNamespace();\n+        return this.serverListMgr.getNamespace();\n     }\n \n     @Override\n     public String getTenant() {\n-        return serverListMgr.getTenant();\n+        return this.serverListMgr.getTenant();\n     }\n \n     @Override\n     public String getEncode() {\n-        return encode;\n+        return this.encode;\n+    }\n+\n+    @Override\n+    public void shutdown() throws NacosException{\n+        LOGGER.info(\"do shutdown begin\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "originalPosition": 304}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjgwNDEz", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-422680413", "createdAt": "2020-06-02T13:34:18Z", "commit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozNDoxOFrOGdx1ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzozNDoxOFrOGdx1ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg3ODQzMA==", "bodyText": "Translate the Chinese annotation into English", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r433878430", "createdAt": "2020-06-02T13:34:18Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/impl/ClientWorker.java", "diffHunk": "@@ -275,39 +277,39 @@ private void checkLocalConfig(CacheData cacheData) {\n         final String dataId = cacheData.dataId;\n         final String group = cacheData.group;\n         final String tenant = cacheData.tenant;\n-        File path = LocalConfigInfoProcessor.getFailoverFile(agent.getName(), dataId, group, tenant);\n+        File path = LocalConfigInfoProcessor.getFailoverFile(this.agent.getName(), dataId, group, tenant);\n \n         // \u6ca1\u6709 -> \u6709", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "originalPosition": 190}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjg2MTgx", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-422686181", "createdAt": "2020-06-02T13:40:10Z", "commit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0MDoxMFrOGdyGrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0MDoxMFrOGdyGrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4Mjc5Nw==", "bodyText": "I think NumberUtils can be replace by ConvertUtils", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r433882797", "createdAt": "2020-06-02T13:40:10Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/impl/ClientWorker.java", "diffHunk": "@@ -482,12 +484,20 @@ public void run() {\n \n     private void init(Properties properties) {\n \n-        timeout = Math.max(NumberUtils.toInt(properties.getProperty(PropertyKeyConst.CONFIG_LONG_POLL_TIMEOUT),\n+        this.timeout = Math.max(NumberUtils.toInt(properties.getProperty(PropertyKeyConst.CONFIG_LONG_POLL_TIMEOUT),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "originalPosition": 344}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjg2NjM5", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-422686639", "createdAt": "2020-06-02T13:40:38Z", "commit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0MDozOFrOGdyIJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzo0MDozOFrOGdyIJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg4MzE3NA==", "bodyText": "don't impotr *", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r433883174", "createdAt": "2020-06-02T13:40:38Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/impl/ServerListManager.java", "diffHunk": "@@ -18,32 +18,36 @@\n import com.alibaba.nacos.api.PropertyKeyConst;\n import com.alibaba.nacos.api.SystemPropertyKeyConst;\n import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.api.naming.NamingFactory;\n import com.alibaba.nacos.client.config.impl.EventDispatcher.ServerlistChangeEvent;\n import com.alibaba.nacos.client.config.impl.HttpSimpleClient.HttpResult;\n import com.alibaba.nacos.client.utils.*;\n+import com.alibaba.nacos.common.executor.ExecutorFactory;\n+import com.alibaba.nacos.common.executor.NameThreadFactory;\n+import com.alibaba.nacos.common.lifecycle.Closeable;\n import com.alibaba.nacos.common.utils.IoUtils;\n import com.alibaba.nacos.common.utils.StringUtils;\n+import com.alibaba.nacos.common.utils.ThreadUtils;\n import org.slf4j.Logger;\n \n import java.io.IOException;\n import java.io.StringReader;\n import java.net.HttpURLConnection;\n import java.util.*;\n-import java.util.concurrent.Callable;\n-import java.util.concurrent.TimeUnit;\n-\n+import java.util.concurrent.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab274216a59cf3e1765de0a940c8ae86d316869"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e2840a6bd1a84ad9e954ac781b5accbef0a12c0", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/5e2840a6bd1a84ad9e954ac781b5accbef0a12c0", "committedDate": "2020-06-03T02:46:41Z", "message": "[#1815]adjust and optimize codes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjA5MjY5", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-423209269", "createdAt": "2020-06-03T04:26:25Z", "commit": {"oid": "5e2840a6bd1a84ad9e954ac781b5accbef0a12c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0320e5851c4bb704dcf9f1e3910db8084012c57d", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/0320e5851c4bb704dcf9f1e3910db8084012c57d", "committedDate": "2020-06-03T05:36:51Z", "message": "Merge remote-tracking branch 'upstream/master' into feature_lifecycle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjQ0MzQ0", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-423244344", "createdAt": "2020-06-03T06:12:29Z", "commit": {"oid": "0320e5851c4bb704dcf9f1e3910db8084012c57d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNjoxMjoyOVrOGeNXQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNjoxODoyNFrOGeNfaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyOTQwOQ==", "bodyText": "This line code is no used.", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r434329409", "createdAt": "2020-06-03T06:12:29Z", "author": {"login": "KomachiSion"}, "path": "api/src/main/java/com/alibaba/nacos/api/config/ConfigFactory.java", "diffHunk": "@@ -59,4 +59,19 @@ public static ConfigService createConfigService(String serverAddr) throws NacosE\n         return createConfigService(properties);\n     }\n \n+    /**\n+     * Destroy Config Instance's Resources.\n+     *\n+     * @param configService\n+     * @throws NacosException\n+     */\n+    public static void destroyConfigService(ConfigService configService) throws NacosException{\n+        try {\n+            configService.shutDown();\n+            configService = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0320e5851c4bb704dcf9f1e3910db8084012c57d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyOTYwOQ==", "bodyText": "This line code is no used.", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r434329609", "createdAt": "2020-06-03T06:13:02Z", "author": {"login": "KomachiSion"}, "path": "api/src/main/java/com/alibaba/nacos/api/naming/NamingFactory.java", "diffHunk": "@@ -48,4 +49,19 @@ public static NamingService createNamingService(Properties properties) throws Na\n             throw new NacosException(NacosException.CLIENT_INVALID_PARAM, e);\n         }\n     }\n+\n+    /**\n+     * Destroy Config Instance's Resources.\n+     *\n+     * @param namingService\n+     * @throws NacosException\n+     */\n+    public static void destroyNamingService(NamingService namingService) throws NacosException{\n+        try {\n+            namingService.shutDown();\n+            namingService = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0320e5851c4bb704dcf9f1e3910db8084012c57d"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMzMTQ5Nw==", "bodyText": "When using member variables normally, do not need to add this, otherwise the code looks very redundant.\nthis can be used uniformly in the set method and constructor.", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r434331497", "createdAt": "2020-06-03T06:18:24Z", "author": {"login": "KomachiSion"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/ServerHttpAgent.java", "diffHunk": "@@ -465,12 +480,12 @@ public String getCode() {\n         @Override\n         public String toString() {\n             return \"STSCredential{\" +\n-                \"accessKeyId='\" + accessKeyId + '\\'' +\n-                \", accessKeySecret='\" + accessKeySecret + '\\'' +\n-                \", expiration=\" + expiration +\n-                \", securityToken='\" + securityToken + '\\'' +\n-                \", lastUpdated=\" + lastUpdated +\n-                \", code='\" + code + '\\'' +\n+                \"accessKeyId='\" + this.accessKeyId + '\\'' +\n+                \", accessKeySecret='\" + this.accessKeySecret + '\\'' +\n+                \", expiration=\" + this.expiration +\n+                \", securityToken='\" + this.securityToken + '\\'' +\n+                \", lastUpdated=\" + this.lastUpdated +\n+                \", code='\" + this.code + '\\'' +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0320e5851c4bb704dcf9f1e3910db8084012c57d"}, "originalPosition": 326}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e86c1582625bedafb25bb97471f5dc035da7b861", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/e86c1582625bedafb25bb97471f5dc035da7b861", "committedDate": "2020-06-03T06:57:46Z", "message": "resolve codes conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c726dd0665b2e15f3a022c4755d1664587ba6f19", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/c726dd0665b2e15f3a022c4755d1664587ba6f19", "committedDate": "2020-06-03T06:58:46Z", "message": "Merge branch 'feature_lifecycle' of https://github.com/zongtanghu/nacos into feature_lifecycle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09752e354dca2d59448e89ac2e0c6750af8931af", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/09752e354dca2d59448e89ac2e0c6750af8931af", "committedDate": "2020-06-03T09:35:06Z", "message": "[#1815]adjust this keywords which just includes constructor and set method in the class and fix some unit test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94c41e11d186346bf2b002c6be5a583c654a7ce9", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/94c41e11d186346bf2b002c6be5a583c654a7ce9", "committedDate": "2020-06-03T09:35:49Z", "message": "[#1815]fix unit test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860a2d02b1d768aa0c7a98796a1fde7ce593d984", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/860a2d02b1d768aa0c7a98796a1fde7ce593d984", "committedDate": "2020-06-03T09:41:22Z", "message": "resolve codes conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15fad5d98abf6421231a7d5c997da8c35bb73a3b", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/15fad5d98abf6421231a7d5c997da8c35bb73a3b", "committedDate": "2020-06-03T11:19:29Z", "message": "[#1815]remove destroyService from Factory Class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTQxMDc3", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-423541077", "createdAt": "2020-06-03T13:17:16Z", "commit": {"oid": "15fad5d98abf6421231a7d5c997da8c35bb73a3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzoxNzoxNlrOGebVsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMzoxNzoxNlrOGebVsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU1ODM4NA==", "bodyText": "Why is ConfigService in namingFactory?", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r434558384", "createdAt": "2020-06-03T13:17:16Z", "author": {"login": "KomachiSion"}, "path": "api/src/main/java/com/alibaba/nacos/api/naming/NamingFactory.java", "diffHunk": "@@ -18,6 +18,7 @@\n import java.lang.reflect.Constructor;\n import java.util.Properties;\n \n+import com.alibaba.nacos.api.config.ConfigService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15fad5d98abf6421231a7d5c997da8c35bb73a3b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTQ3Nzc5", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-423547779", "createdAt": "2020-06-03T13:24:47Z", "commit": {"oid": "15fad5d98abf6421231a7d5c997da8c35bb73a3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDM0MDYz", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-424034063", "createdAt": "2020-06-04T01:05:16Z", "commit": {"oid": "15fad5d98abf6421231a7d5c997da8c35bb73a3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a2921e2cf2c153c3bdd6bbaeba16e8f087aed47", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/8a2921e2cf2c153c3bdd6bbaeba16e8f087aed47", "committedDate": "2020-06-04T01:21:44Z", "message": "[#1815]remove no used package name from Factory Class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzgyMzAy", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-426782302", "createdAt": "2020-06-09T04:36:17Z", "commit": {"oid": "8a2921e2cf2c153c3bdd6bbaeba16e8f087aed47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNDozNjoxN1rOGg4crg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNDozNjoxN1rOGg4crg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEzMjQ2Mg==", "bodyText": "don't import *", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r437132462", "createdAt": "2020-06-09T04:36:17Z", "author": {"login": "chuntaojun"}, "path": "client/src/main/java/com/alibaba/nacos/client/naming/core/HostReactor.java", "diffHunk": "@@ -23,8 +23,10 @@\n import com.alibaba.nacos.client.naming.cache.DiskCache;\n import com.alibaba.nacos.client.naming.net.NamingProxy;\n import com.alibaba.nacos.client.naming.utils.UtilAndComs;\n+import com.alibaba.nacos.common.lifecycle.Closeable;\n import com.alibaba.nacos.common.utils.JacksonUtils;\n \n+import com.alibaba.nacos.common.utils.ThreadUtils;\n import org.apache.commons.lang3.StringUtils;\n \n import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a2921e2cf2c153c3bdd6bbaeba16e8f087aed47"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4", "committedDate": "2020-06-09T06:10:47Z", "message": "[#1815]remove no used package name from Factory Class and adjust test cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTY4ODM3", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-427968837", "createdAt": "2020-06-10T11:41:55Z", "commit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo0MTo1NVrOGhw9-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo0MTo1NVrOGhw9-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA1ODQ5MQ==", "bodyText": "1\u3001\u589e\u52a0\u8fd9\u4e2a\u5f02\u5e38\u7684\u573a\u666f\u662f\uff1f\n2\u3001\u5982\u679c\u5fc5\u987b\u8981\u8fd9\u4e2a\u5f02\u5e38\uff0csdk\u4fa7\u7684\u5f02\u5e38\u662f\u8d1f\u6570\uff0c\u800c\u4e14\u9700\u8981\u53c2\u8003\u4e00\u4e0bhttp\u72b6\u6001\u7801\u7684\u8bed\u4e49", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438058491", "createdAt": "2020-06-10T11:41:55Z", "author": {"login": "yanlinly"}, "path": "api/src/main/java/com/alibaba/nacos/api/exception/NacosException.java", "diffHunk": "@@ -146,4 +146,9 @@ public String toString() {\n \n \tpublic static final int RESOURCE_NOT_FOUND = -404;\n \n+    /**\n+     * resource instance destroy failed.\n+     */\n+\tpublic static final int RESOURCE_DESTROY_FAILED = 410;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTczNTAw", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-427973500", "createdAt": "2020-06-10T11:49:11Z", "commit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo0OToxMVrOGhxLOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo0OToxMVrOGhxLOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA2MTg4MA==", "bodyText": "\u8fd9\u4e2a\u5730\u65b9\u4e0d\u8981\u6539\u4e86\uff0c\u8fd9\u5757\u4e0d\u662f\u7b80\u5355\u7684\u83b7\u53d6\u670d\u52a1\u5217\u8868\n1\u3001HttpAgent\u5c4f\u853d\u4e86\u540e\u9762\u670d\u52a1\u7684\u591a\u4e2a\u8282\u70b9\n2\u3001\u7ef4\u62a4\u591a\u4e2a\u8282\u70b9\u5217\u8868\uff0c\u52a8\u6001\u5237\u65b0\u80fd\u529b\n3\u3001\u7ed9\u51fa\u53ef\u7528ip\u548c\u8bf7\u6c42ip\u6362ip\u903b\u8f91\u3002\n\u8fd9\u4e2a\u662f\u4e00\u4e2a\u4e0eserver\u5efa\u8054\u7684\u4e00\u4e2aagent\uff0c\u542f\u52a8\u5176\u5b9e\u662f\u505a\u5f88\u591a\u4e8b\u60c5\u7684\u3002", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438061880", "createdAt": "2020-06-10T11:49:11Z", "author": {"login": "yanlinly"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/http/HttpAgent.java", "diffHunk": "@@ -27,13 +28,14 @@\n  *\n  * @author Nacos\n  */\n-public interface HttpAgent {\n+public interface HttpAgent extends Closeable {\n+\n     /**\n      * start to get nacos ip list\n      * @return Nothing.\n      * @throws NacosException on get ip list error.\n      */\n-    void start() throws NacosException;\n+    void fetchServerIpList() throws NacosException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTc4OTQx", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-427978941", "createdAt": "2020-06-10T11:57:37Z", "commit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo1NzozN1rOGhxbxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMTo1NzozN1rOGhxbxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA2NjExNg==", "bodyText": "ConvertUtils \u8fd9\u5757\u4e3a\u4ec0\u4e48\u8981\u6539\u5462", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438066116", "createdAt": "2020-06-10T11:57:37Z", "author": {"login": "yanlinly"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/impl/ClientWorker.java", "diffHunk": "@@ -482,12 +499,21 @@ public void run() {\n \n     private void init(Properties properties) {\n \n-        timeout = Math.max(NumberUtils.toInt(properties.getProperty(PropertyKeyConst.CONFIG_LONG_POLL_TIMEOUT),\n+        this.timeout = Math.max(ConvertUtils.toInt(properties.getProperty(PropertyKeyConst.CONFIG_LONG_POLL_TIMEOUT),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "originalPosition": 178}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTg0NjMx", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-427984631", "createdAt": "2020-06-10T12:06:06Z", "commit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjowNjowNlrOGhxsJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjowNjowNlrOGhxsJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3MDMxMA==", "bodyText": "\u76ee\u524d\u770bLifeCycle \u8fd9\u4e2a\u62bd\u8c61\u5bf9\u6574\u4f53\u751f\u547d\u5468\u671f\u7ba1\u7406\u5e2e\u52a9\u4e0d\u5927\uff0c\u53cd\u800c\u4f1a\u589e\u52a0\u4ee3\u7801\u7406\u89e3\u6210\u672c\uff0c\u5efa\u8bae\u8fd9\u5757\u4ee3\u7801\u5148\u4e0d\u8981\u5408\u5165\u4e86\u3002", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438070310", "createdAt": "2020-06-10T12:06:06Z", "author": {"login": "yanlinly"}, "path": "common/src/main/java/com/alibaba/nacos/common/lifecycle/LifeCycle.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.alibaba.nacos.common.lifecycle;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+\n+/**\n+ *\n+ * The lifecycle interface for generic service. Classes are need to implement\n+ * this interface have a defined life cycle defined by the methods of this interface.\n+ *\n+ * @author zongtanghu\n+ */\n+public interface LifeCycle {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f7fb0f65a51cf959017ee2140ae5a62c8b5cdd4"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb39830b6c821dec817228d873c84cefc95e10bf", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/eb39830b6c821dec817228d873c84cefc95e10bf", "committedDate": "2020-06-11T01:42:44Z", "message": "[#1815]remove lifeCycle, lifeCycleManager, and adjust some related codes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6e3161c0ef42c876acdc007499e6e9833b482da", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/e6e3161c0ef42c876acdc007499e6e9833b482da", "committedDate": "2020-06-11T01:45:00Z", "message": "resolve the codes conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b873797ca07b81220c4f4baa021353353a945a9", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/9b873797ca07b81220c4f4baa021353353a945a9", "committedDate": "2020-06-11T02:35:50Z", "message": "[#1815]fix ut."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2b980677f1ebce427b47457a51c4a82763f5dac", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/d2b980677f1ebce427b47457a51c4a82763f5dac", "committedDate": "2020-06-11T03:33:38Z", "message": "[#1815]remove code comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NTcyMjYz", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-428572263", "createdAt": "2020-06-11T03:43:48Z", "commit": {"oid": "9b873797ca07b81220c4f4baa021353353a945a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0Mzo0OFrOGiNf1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0Mzo0OFrOGiNf1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNTkxMQ==", "bodyText": "\u5efa\u8bae\u505a\u4e00\u4e2a\u79c1\u6709\u7c7b\u521d\u59cb\u5316\uff0c\u8fd9\u7ebf\u7a0b\u8ddf\u8fd9\u4e2a\u7c7b\u4e00\u8d77\u5b58\u5728\u7684\u3002  \u76ee\u524d\u8fd9\u4e2a\u7c7b\u521d\u59cb\u5316\u53e3\u5b50\u6bd4\u8f83\u591a\uff0c\u5230\u5904\u52a0\u4e0d\u592a\u4f18\u96c5", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438525911", "createdAt": "2020-06-11T03:43:48Z", "author": {"login": "yanlinly"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/impl/ServerListManager.java", "diffHunk": "@@ -200,14 +217,27 @@ public String call() {\n         if (Boolean.parseBoolean(isUseEndpointRuleParsing)) {\n             String endpointUrl = ParamUtil.parsingEndpointRule(endpointTmp);\n             if (StringUtils.isNotBlank(endpointUrl)) {\n-                serverAddrsStr = \"\";\n+                this.serverAddrsStr = \"\";\n             }\n             return endpointUrl;\n         }\n \n         return StringUtils.isNotBlank(endpointTmp) ? endpointTmp : \"\";\n     }\n \n+    private void initExecutor() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b873797ca07b81220c4f4baa021353353a945a9"}, "originalPosition": 236}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NTczMTM1", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-428573135", "createdAt": "2020-06-11T03:47:06Z", "commit": {"oid": "9b873797ca07b81220c4f4baa021353353a945a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0NzowNlrOGiNixQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0NzowNlrOGiNixQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNjY2MQ==", "bodyText": "\u8fd9\u5757\u5efa\u8bae\u4fdd\u6301\u8001\u65b9\u5f0f\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6bcf\u4e2a\u7c7b\u79c1\u6709\u521d\u59cb\u5316\u662f\u8ddf\u5b9e\u4f8b\u4fdd\u6301\u4e00\u81f4\u7684\u3002 \u76f8\u5bf9\u7b80\u5355\u4e00\u4e9b", "url": "https://github.com/alibaba/nacos/pull/2927#discussion_r438526661", "createdAt": "2020-06-11T03:47:06Z", "author": {"login": "yanlinly"}, "path": "client/src/main/java/com/alibaba/nacos/client/naming/backups/FailoverReactor.java", "diffHunk": "@@ -37,29 +40,31 @@\n /**\n  * @author nkorange\n  */\n-public class FailoverReactor {\n+public class FailoverReactor implements Closeable {\n \n     private String failoverDir;\n \n     private HostReactor hostReactor;\n \n+    private ScheduledExecutorService executorService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b873797ca07b81220c4f4baa021353353a945a9"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7796b39352f4d17c4a2185d4739be34edd0e9dc", "author": {"user": {"login": "zongtanghu", "name": "Hu Zongtang"}}, "url": "https://github.com/alibaba/nacos/commit/e7796b39352f4d17c4a2185d4739be34edd0e9dc", "committedDate": "2020-06-11T04:42:47Z", "message": "[#1815]adjust codes for instance class attribute init."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjA4NDc0", "url": "https://github.com/alibaba/nacos/pull/2927#pullrequestreview-428608474", "createdAt": "2020-06-11T05:47:45Z", "commit": {"oid": "e7796b39352f4d17c4a2185d4739be34edd0e9dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4463, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}