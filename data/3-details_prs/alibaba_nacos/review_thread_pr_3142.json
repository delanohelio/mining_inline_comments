{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjUzNzM1", "number": 3142, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MDo1NlrOEHdqTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OTo0NFrOEHhktg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjYxNDUzOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/BaseHttpMethod.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MDo1NlrOGm1i6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MDo1NlrOGm1i6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NjM2MQ==", "bodyText": "Do not change the indent.", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443376361", "createdAt": "2020-06-22T07:50:56Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/BaseHttpMethod.java", "diffHunk": "@@ -49,7 +49,7 @@\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n public enum BaseHttpMethod {\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjYxNjc1OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/HttpClientBeanHolder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MTo0MFrOGm1kag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzo1MTo0MFrOGm1kag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3Njc0Ng==", "bodyText": "do not change indent please", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443376746", "createdAt": "2020-06-22T07:51:40Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/HttpClientBeanHolder.java", "diffHunk": "@@ -34,21 +34,15 @@\n  * @author mai.jh\n  */\n public final class HttpClientBeanHolder {\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjY0OTEzOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/handler/ResponseHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMTozMlrOGm14wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMTozMlrOGm14wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MTk1Mw==", "bodyText": "If the tmp variable is only used once, I suggest do not change.", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443381953", "createdAt": "2020-06-22T08:01:32Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/handler/ResponseHandler.java", "diffHunk": "@@ -78,14 +78,22 @@\n         String contentType = headers.getValue(HttpHeaderConsts.CONTENT_TYPE);\n         InputStream body = response.getBody();\n         T extractBody = null;\n+        boolean typeToStr = String.class.toString().equals(type.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjY0OTQwOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/handler/ResponseHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMTozN1rOGm147Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMTozN1rOGm147Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MTk5Nw==", "bodyText": "If the tmp variable is only used once, I suggest do not change.", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443381997", "createdAt": "2020-06-22T08:01:37Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/handler/ResponseHandler.java", "diffHunk": "@@ -78,14 +78,22 @@\n         String contentType = headers.getValue(HttpHeaderConsts.CONTENT_TYPE);\n         InputStream body = response.getBody();\n         T extractBody = null;\n+        boolean typeToStr = String.class.toString().equals(type.toString());\n         if (contentType != null && contentType.startsWith(MediaType.APPLICATION_JSON) && HttpStatus.SC_OK == response\n-                .getStatusCode()) {\n-            extractBody = convert(body, type);\n+            .getStatusCode()) {\n+            // When the type is string type and the response contentType is [application/json],\n+            // then it should be serialized as string\n+            if (typeToStr) {\n+                extractBody = (T) IoUtils.toString(body, headers.getCharset());\n+            } else {\n+                extractBody = convert(body, type);\n+            }\n         }\n         if (extractBody == null) {\n-            if (!String.class.toString().equals(type.toString())) {\n+            if (!typeToStr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjY1NTg3OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/NacosRestTemplate.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMzo0NFrOGm19CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowMzo0NFrOGm19CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MzA0OA==", "bodyText": "What's the mean of From I read the method think it should be exchangeForm, is it?", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443383048", "createdAt": "2020-06-22T08:03:44Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/NacosRestTemplate.java", "diffHunk": "@@ -298,7 +297,29 @@ public NacosRestTemplate(HttpClientRequest requestClient) {\n                 Query.newInstance().initParams(paramValues), bodyValues);\n         return execute(url, HttpMethod.POST, requestHttpEntity, responseType);\n     }\n-    \n+\n+    /**\n+     * Execute the HTTP method to the given URI template, writing the given request entity to the request, and\n+     * returns the response as {@link HttpRestResult}.\n+     *\n+     * @param url          url\n+     * @param header       http header param\n+     * @param paramValues  http query param\n+     * @param bodyValues   http body param\n+     * @param httpMethod   http method\n+     * @param responseType return type\n+     * @return {@link HttpRestResult}\n+     * @throws Exception ex\n+     */\n+    public <T> HttpRestResult<T> exchangeFrom(String url, Header header,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 143}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjY1Nzk5OnYy", "diffSide": "RIGHT", "path": "test/src/test/java/com/alibaba/nacos/test/naming/NamingBase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowNDoxN1rOGm1-Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODowNDoxN1rOGm1-Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MzM2Ng==", "bodyText": "What's the mean of From I read the method think it should be putFrom, is it?", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443383366", "createdAt": "2020-06-22T08:04:17Z", "author": {"login": "KomachiSion"}, "path": "test/src/test/java/com/alibaba/nacos/test/naming/NamingBase.java", "diffHunk": "@@ -166,39 +170,32 @@ public static boolean verifyInstanceList(List<Instance> instanceList1, List<Inst\n         return true;\n     }\n \n-    public static void prepareServer(int localPort) {\n+    public static void prepareServer(int localPort) throws Exception{\n         prepareServer(localPort, \"UP\");\n     }\n \n-    public static void prepareServer(int localPort, String status) {\n+    public static void prepareServer(int localPort, String status) throws Exception {\n         String url = \"http://127.0.0.1:\" + localPort + \"/nacos/v1/ns/operator/switches?entry=overriddenServerStatus&value=\" + status;\n-        List<String> headers = new ArrayList<String>();\n-        headers.add(HttpHeaderConsts.USER_AGENT_HEADER);\n-        headers.add(\"Nacos-Server\");\n-        HttpClient.HttpResult result =\n-            HttpClient.request(url, headers, new HashMap<String, String>(), StringUtils.EMPTY, \"UTF-8\", \"PUT\");\n+        Header header = Header.newInstance();\n+        header.addParam(HttpHeaderConsts.USER_AGENT_HEADER, \"Nacos-Server\");\n+        HttpRestResult<String> result = nacosRestTemplate.putFrom(url, header, Query.EMPTY, new HashMap<>(), String.class);\n         System.out.println(result);\n-        Assert.assertEquals(HttpStatus.SC_OK, result.code);\n-\n+        Assert.assertEquals(HttpStatus.SC_OK, result.getCode());\n \n         url = \"http://127.0.0.1:\" + localPort + \"/nacos/v1/ns/operator/switches?entry=autoChangeHealthCheckEnabled&value=\" + false;\n-        headers = new ArrayList<String>();\n-        headers.add(HttpHeaderConsts.USER_AGENT_HEADER);\n-        headers.add(\"Nacos-Server\");\n-        result =\n-            HttpClient.request(url, headers, new HashMap<String, String>(), StringUtils.EMPTY, \"UTF-8\", \"PUT\");\n+\n+        result = nacosRestTemplate.putFrom(url, header, Query.EMPTY, new HashMap<>(), String.class);\n         System.out.println(result);\n-        Assert.assertEquals(HttpStatus.SC_OK, result.code);\n+        Assert.assertEquals(HttpStatus.SC_OK, result.getCode());\n     }\n \n-    public static void destoryServer(int localPort) {\n+    public static void destoryServer(int localPort) throws Exception{\n         String url = \"http://127.0.0.1:\" + localPort + \"/nacos/v1/ns/operator/switches?entry=autoChangeHealthCheckEnabled&value=\" + true;\n-        List<String> headers = new ArrayList<String>();\n-        headers.add(HttpHeaderConsts.USER_AGENT_HEADER);\n-        headers.add(\"Nacos-Server\");\n-        HttpClient.HttpResult result =\n-            HttpClient.request(url, headers, new HashMap<String, String>(), StringUtils.EMPTY, \"UTF-8\", \"PUT\");\n+        Header header = Header.newInstance();\n+        header.addParam(HttpHeaderConsts.USER_AGENT_HEADER, \"Nacos-Server\");\n+\n+        HttpRestResult<String> result = nacosRestTemplate.putFrom(url, header, Query.EMPTY, new HashMap<>(), String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5eeff0cdaa04f1c86d80190987f05944214b103"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzI1MzQxOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/BaseHttpMethod.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OToxMlrOGm70HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OToxMlrOGm70HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ3OTA2OA==", "bodyText": "Do not change intend", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443479068", "createdAt": "2020-06-22T10:59:12Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/BaseHttpMethod.java", "diffHunk": "@@ -59,14 +59,14 @@ protected HttpRequestBase createRequest(String url) {\n             return new HttpGet(url);\n         }\n     },\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae37587f1067b1c94553b9ac270451761b461bd"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzI1NDc1OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/HttpClientBeanHolder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OTozMVrOGm704Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OTozMVrOGm704Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ3OTI2NQ==", "bodyText": "Do not change indent", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443479265", "createdAt": "2020-06-22T10:59:31Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/HttpClientBeanHolder.java", "diffHunk": "@@ -36,19 +36,13 @@\n public final class HttpClientBeanHolder {\n     \n     private static final Logger LOGGER = LoggerFactory.getLogger(HttpClientManager.class);\n-    \n-    private static final int TIMEOUT = Integer.getInteger(\"nacos.http.timeout\", 5000);\n-    \n-    private static final HttpClientConfig HTTP_CLIENT_CONFIG = HttpClientConfig.builder().setConTimeOutMillis(TIMEOUT)\n-            .setReadTimeOutMillis(TIMEOUT >> 1).build();\n-    \n+\n     private static final Map<String, NacosRestTemplate> SINGLETON_REST = new HashMap<String, NacosRestTemplate>(10);\n-    \n-    private static final Map<String, NacosAsyncRestTemplate> SINGLETON_ASYNC_REST = new HashMap<String, NacosAsyncRestTemplate>(\n-            10);\n-    \n+\n+    private static final Map<String, NacosAsyncRestTemplate> SINGLETON_ASYNC_REST = new HashMap<String, NacosAsyncRestTemplate>(10);\n+\n     private static final AtomicBoolean ALREADY_SHUTDOWN = new AtomicBoolean(false);\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae37587f1067b1c94553b9ac270451761b461bd"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzI1NTU4OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpClientResponse.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OTo0NFrOGm71WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMDo1OTo0NFrOGm71WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ3OTM4NQ==", "bodyText": "Do not change indent", "url": "https://github.com/alibaba/nacos/pull/3142#discussion_r443479385", "createdAt": "2020-06-22T10:59:44Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpClientResponse.java", "diffHunk": "@@ -26,39 +26,38 @@\n  * Represents a client-side HTTP response.\n  *\n  * @author mai.jh\n- * @date 2020/5/23\n  */\n public interface HttpClientResponse extends Closeable {\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ae37587f1067b1c94553b9ac270451761b461bd"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4434, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}