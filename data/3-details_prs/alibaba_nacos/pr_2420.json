{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0Njk4NjUy", "number": 2420, "title": "Fea auto clean service", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\nfeature #2419\nBrief changelog\nXX\nVerifying this change\nXXXX\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.", "createdAt": "2020-03-06T08:39:06Z", "url": "https://github.com/alibaba/nacos/pull/2420", "merged": true, "mergeCommit": {"oid": "fe4946a1e3d0791b5951654b92cbd2a30c31564e"}, "closed": true, "closedAt": "2020-03-09T09:07:11Z", "author": {"login": "chuntaojun"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK3vlsgH2gAyMzg0Njk4NjUyOjUwMmU5Yzc1OTc0MWFmOWMxNDI1ZWQyNTg5YzA3NGIyMTFjMjkxOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL6L6IgFqTM3MTAwMjQ3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "502e9c759741af9c1425ed2589c074b211c2919f", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/502e9c759741af9c1425ed2589c074b211c2919f", "committedDate": "2020-03-06T03:42:05Z", "message": "feat(naming): Support for automatic removal of empty services"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f65e4fcbc06cb05bba8cb3d42f44bff088eb792a", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/f65e4fcbc06cb05bba8cb3d42f44bff088eb792a", "committedDate": "2020-03-06T08:32:59Z", "message": "refactor(naming): Optimize the empty service removal logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e403c565532025ae95c7d064896b9f90b901598", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/3e403c565532025ae95c7d064896b9f90b901598", "committedDate": "2020-03-06T08:33:33Z", "message": "refactor: remove unuse dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8fb011bd63bc85bfe8cfc204fae37d8f01de00b", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/f8fb011bd63bc85bfe8cfc204fae37d8f01de00b", "committedDate": "2020-03-06T08:36:50Z", "message": "fix(naming): Fixed finalizeCnt error count problem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/86e3b0dbc98f666a0f786541199ce52df6183211", "committedDate": "2020-03-06T11:33:06Z", "message": "fix(naming): Fixed a namespace parameter passing error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMzY1MTk1", "url": "https://github.com/alibaba/nacos/pull/2420#pullrequestreview-370365195", "createdAt": "2020-03-06T14:34:37Z", "commit": {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDozNDozN1rOFy6y_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNDozNDozN1rOFy6y_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzNjQ0NQ==", "bodyText": "\u6700\u597d\u4e0d\u8981\u7528\u7f29\u5199\uff0c\u53ef\u4ee5\u7528finalizeCount", "url": "https://github.com/alibaba/nacos/pull/2420#discussion_r388936445", "createdAt": "2020-03-06T14:34:37Z", "author": {"login": "nkorange"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Service.java", "diffHunk": "@@ -57,6 +57,11 @@\n     @JSONField(serialize = false)\n     private ClientBeatCheckTask clientBeatCheckTask = new ClientBeatCheckTask(this);\n \n+    /**\n+     * Identify the information used to determine how many isEmpty judgments the service has experienced\n+     */\n+    private int finalizeCnt = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f264fed2db9e55c47699d9c6f41c6e9ce8630d7", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/4f264fed2db9e55c47699d9c6f41c6e9ce8630d7", "committedDate": "2020-03-07T03:39:08Z", "message": "style(naming): Variable name specification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzQ3NzY0", "url": "https://github.com/alibaba/nacos/pull/2420#pullrequestreview-370747764", "createdAt": "2020-03-07T14:51:00Z", "commit": {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNDo1MTowMFrOFzOh1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNDo1MTowMFrOFzOh1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI1OTczMg==", "bodyText": "\u8fd9\u4e2a\u6e05\u7406\u5468\u671f\u4e5f\u53ef\u4ee5\u505a\u6210\u53ef\u914d\u7f6e\u7684", "url": "https://github.com/alibaba/nacos/pull/2420#discussion_r389259732", "createdAt": "2020-03-07T14:51:00Z", "author": {"login": "nkorange"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/ServiceManager.java", "diffHunk": "@@ -97,6 +117,19 @@ public void init() {\n \n         UtilsAndCommons.SERVICE_UPDATE_EXECUTOR.submit(new UpdatedServiceProcessor());\n \n+        if (emptyServiceAutoClean) {\n+\n+            // delay 60s, period 20s;\n+\n+            // This task is not recommended to be performed frequently in order to avoid\n+            // the possibility that the service cache information may just be deleted\n+            // and then created due to the heartbeat mechanism\n+\n+            GlobalExecutor.scheduleServiceAutoClean(new EmptyServiceAutoClean(), 60_000L, 20_000L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0886653a086de0fdc5ec5a1b7b093c8bb74fc34a", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/0886653a086de0fdc5ec5a1b7b093c8bb74fc34a", "committedDate": "2020-03-07T16:00:44Z", "message": "feat(naming): Support empty service cleanup task time configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a7b664bfb6e660b5684e1d5fb3c9538555dfdf3", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/6a7b664bfb6e660b5684e1d5fb3c9538555dfdf3", "committedDate": "2020-03-09T03:28:39Z", "message": "fix(naming): The fix configuration name is different"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa9a0c045a85468a6d0d18e314169c71232f28bc", "author": {"user": {"login": "nkorange", "name": "Peter Zhu"}}, "url": "https://github.com/alibaba/nacos/commit/aa9a0c045a85468a6d0d18e314169c71232f28bc", "committedDate": "2020-03-09T03:35:12Z", "message": "Merge branch 'develop' into fea_auto_clean_service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a325bf9c78f884ab456f2f1fb5b223540046fde", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/0a325bf9c78f884ab456f2f1fb5b223540046fde", "committedDate": "2020-03-09T07:38:03Z", "message": "fix: fix merge confilt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8466c347be743676b5b93cf5b75c896c1fa3bdbe", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/8466c347be743676b5b93cf5b75c896c1fa3bdbe", "committedDate": "2020-03-09T07:39:44Z", "message": "Merge branch 'fea_auto_clean_service' of https://github.com/chuntaojun/nacos into fea_auto_clean_service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b848873e4b6ecda9893400572b146803786e555", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/8b848873e4b6ecda9893400572b146803786e555", "committedDate": "2020-03-09T07:48:31Z", "message": "docs:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b44e7d6f44e98404ae98d57d51691b698152c413", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/b44e7d6f44e98404ae98d57d51691b698152c413", "committedDate": "2020-03-09T07:52:46Z", "message": "docs: remove dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6594932050e90ca2b0667c4790934fc1d7828dd", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/a6594932050e90ca2b0667c4790934fc1d7828dd", "committedDate": "2020-03-09T07:57:22Z", "message": "refactor: Uniform configuration format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f30c5ab7575a0db59f1a97c996525277cd6ce601", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/f30c5ab7575a0db59f1a97c996525277cd6ce601", "committedDate": "2020-03-09T08:00:05Z", "message": "docs: Uniform configuration format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDAyNDc5", "url": "https://github.com/alibaba/nacos/pull/2420#pullrequestreview-371002479", "createdAt": "2020-03-09T09:06:46Z", "commit": {"oid": "f30c5ab7575a0db59f1a97c996525277cd6ce601"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4478, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}