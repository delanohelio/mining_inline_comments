{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMTQ0NDY2", "number": 3773, "title": "IPv6 support", "bodyText": "https://www.yuque.com/docs/share/864a401b-e905-4dda-9e6f-72c0c127b811?#\uff08\u5bc6\u7801\uff1ayrol\uff09 \u300aNacos\u652f\u6301ipv6\u7f51\u7edc\u73af\u5883\u7684\u6539\u9020\u300b", "createdAt": "2020-09-07T07:40:18Z", "url": "https://github.com/alibaba/nacos/pull/3773", "merged": true, "mergeCommit": {"oid": "538509502f85c5acc0fd69007a4569b5acfb7bbb"}, "closed": true, "closedAt": "2020-11-05T12:15:07Z", "author": {"login": "KeRan213539"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGdpmcAH2gAyNDgxMTQ0NDY2OjkzOGI4ZjQwNDc5MmRjZjNiMTJlODAxZDUyNTRjMDVmMTJmOTk2ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZhUYKAFqTUyNDIwMTg0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/938b8f404792dcf3b12e801d5254c05f12f996e5", "committedDate": "2020-09-07T07:13:28Z", "message": "IPv6 support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzI1OTUz", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483325953", "createdAt": "2020-09-07T07:46:49Z", "commit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNzo0Njo1MFrOHNz8Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODoxMzoxMFrOHN1MTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI0NDU4Mw==", "bodyText": "It is best Util class not to depend on Util class.\nI see AddressServerParamCheckUtil only one method, I think it can be merged into IpUtil.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484244583", "createdAt": "2020-09-07T07:46:50Z", "author": {"login": "KomachiSion"}, "path": "address/src/main/java/com/alibaba/nacos/address/util/AddressServerParamCheckUtil.java", "diffHunk": "@@ -16,8 +16,7 @@\n \n package com.alibaba.nacos.address.util;\n \n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n+import com.alibaba.nacos.common.utils.IpUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI1MzE2NQ==", "bodyText": "Remove unused codes", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484253165", "createdAt": "2020-09-07T07:55:37Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/utils/IpUtil.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.utils;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * ip tool.\n+ *\n+ * @author Nacos\n+ */\n+public class IpUtil {\n+    \n+    public static final boolean PREFER_IPV6_ADDRESSES = Boolean.parseBoolean(System.getProperty(\"java.net.preferIPv6Addresses\"));\n+    \n+    public static final String IPV6_START_MARK = \"[\";\n+    \n+    public static final String IPV6_END_MARK = \"]\";\n+    \n+    public static final int SPLIT_IP_PORT_RESULT_LENGTH = 2;\n+    \n+    private static final String LOCAL_HOST_IP_V4 = \"127.0.0.1\";\n+    \n+    private static final String LOCAL_HOST_IP_V6 = \"[::1]\";\n+    \n+    private static Pattern ipv4Pattern = Pattern.compile(\"\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\");\n+    \n+    /**\n+     * get localhost ip.\n+     * @return java.lang.String\n+     */\n+    public static String localHostIp() {\n+        if (PREFER_IPV6_ADDRESSES) {\n+            return LOCAL_HOST_IP_V6;\n+        }\n+        return LOCAL_HOST_IP_V4;\n+    }\n+    \n+    /**\n+     * check whether the ip address is IPv4.\n+     *\n+     * @param addr ip address\n+     * @return boolean\n+     */\n+    public static boolean isIpv4(String addr) {\n+        try {\n+            return InetAddress.getByName(addr).getAddress().length == 4;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * check whether the ip address is IPv6.\n+     *\n+     * @param addr ip address\n+     * @return boolean\n+     */\n+    public static boolean isIpv6(String addr) {\n+        try {\n+            return InetAddress.getByName(addr).getAddress().length == 16;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * check whether the str is ip address (IPv4 or IPv6).\n+     *\n+     * @param addr ip address str\n+     * @return boolean\n+     */\n+    public static boolean isIp(String addr) {\n+        try {\n+            InetAddress.getByName(addr);\n+            return true;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * Check if the address contains a port.\n+     * 2020/9/3 14:53\n+     * @param address address string\n+     * @return boolean\n+     */\n+    public static boolean containsPort(String address) {\n+        return splitIpPortStr(address).length == 2;\n+    }\n+    \n+    /**\n+     * Split IP and port strings, support IPv4 and IPv6, IP in IPv6 must be enclosed with [].\n+     *\n+     * @param str ip and port string\n+     * @return java.lang.String[]\n+     */\n+    public static String[] splitIpPortStr(String str) {\n+        if (StringUtils.isBlank(str)) {\n+            throw new IllegalArgumentException(\"ip and port string cannot be empty!\");\n+        }\n+        String[] serverAddrArr;\n+        if (str.startsWith(IPV6_START_MARK) && StringUtils.containsIgnoreCase(str, IPV6_END_MARK)) {\n+            if (str.endsWith(IPV6_END_MARK)) {\n+                serverAddrArr = new String[1];\n+                serverAddrArr[0] = str;\n+            } else {\n+                serverAddrArr = new String[2];\n+                serverAddrArr[0] = str.substring(0, (str.indexOf(IPV6_END_MARK) + 1));\n+                serverAddrArr[1] = str.substring((str.indexOf(IPV6_END_MARK) + 2));\n+            }\n+            if (!isIpv6(serverAddrArr[0])) {\n+                throw new IllegalArgumentException(\"The IPv6 address(\\\"\" + serverAddrArr[0] + \"\\\") is incorrect.\");\n+            }\n+        } else {\n+            serverAddrArr = str.split(\":\");\n+            if (serverAddrArr.length > SPLIT_IP_PORT_RESULT_LENGTH) {\n+                throw new IllegalArgumentException(\"The IP address(\\\"\" + str\n+                        + \"\\\") is incorrect. If it is an IPv6 address, please use [] to enclose the IP part!\");\n+            }\n+            if (!isIpv4(serverAddrArr[0])) {\n+                throw new IllegalArgumentException(\"The IPv4 address(\\\"\" + serverAddrArr[0] + \"\\\") is incorrect.\");\n+            }\n+        }\n+        return serverAddrArr;\n+    }\n+    \n+    /**\n+     * Resolve the IP from the string containing the IP address.\n+     * @param str string containing IP address\n+     * @return java.lang.String\n+     */\n+    public static String getIpFromString(String str) {\n+        if (StringUtils.isBlank(str)) {\n+            return \"\";\n+        }\n+        String result = \"\";\n+        if (StringUtils.containsIgnoreCase(str, IPV6_START_MARK) && StringUtils.containsIgnoreCase(str, IPV6_END_MARK)) {\n+            result = str.substring(str.indexOf(IPV6_START_MARK), (str.indexOf(IPV6_END_MARK) + 1));\n+            if (!isIpv6(result)) {\n+                result = \"\";\n+                //throw new IllegalArgumentException(\"The IPv6 address(\\\"\" + result + \"\\\") is incorrect.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI2Mjk2Mg==", "bodyText": "Is the same behavior when provider without port like 11.11.11.11 ?", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484262962", "createdAt": "2020-09-07T08:09:18Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Instance.java", "diffHunk": "@@ -117,19 +115,18 @@ public static Instance fromString(String config) {\n         }\n         \n         String provider = ipAddressAttributes[0];\n-        Matcher matcher = IP_PATTERN.matcher(provider);\n-        if (!matcher.matches()) {\n+        String[] providerAddr = IpUtil.splitIpPortStr(provider);\n+        if (providerAddr.length != IpUtil.SPLIT_IP_PORT_RESULT_LENGTH) {\n+            // not ip:port string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI2NDc1MA==", "bodyText": "Can 2 replaced with SPLIT_IP_PORT_RESULT_LENGTH", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484264750", "createdAt": "2020-09-07T08:12:41Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/utils/IpUtil.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.utils;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * ip tool.\n+ *\n+ * @author Nacos\n+ */\n+public class IpUtil {\n+    \n+    public static final boolean PREFER_IPV6_ADDRESSES = Boolean.parseBoolean(System.getProperty(\"java.net.preferIPv6Addresses\"));\n+    \n+    public static final String IPV6_START_MARK = \"[\";\n+    \n+    public static final String IPV6_END_MARK = \"]\";\n+    \n+    public static final int SPLIT_IP_PORT_RESULT_LENGTH = 2;\n+    \n+    private static final String LOCAL_HOST_IP_V4 = \"127.0.0.1\";\n+    \n+    private static final String LOCAL_HOST_IP_V6 = \"[::1]\";\n+    \n+    private static Pattern ipv4Pattern = Pattern.compile(\"\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\");\n+    \n+    /**\n+     * get localhost ip.\n+     * @return java.lang.String\n+     */\n+    public static String localHostIp() {\n+        if (PREFER_IPV6_ADDRESSES) {\n+            return LOCAL_HOST_IP_V6;\n+        }\n+        return LOCAL_HOST_IP_V4;\n+    }\n+    \n+    /**\n+     * check whether the ip address is IPv4.\n+     *\n+     * @param addr ip address\n+     * @return boolean\n+     */\n+    public static boolean isIpv4(String addr) {\n+        try {\n+            return InetAddress.getByName(addr).getAddress().length == 4;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * check whether the ip address is IPv6.\n+     *\n+     * @param addr ip address\n+     * @return boolean\n+     */\n+    public static boolean isIpv6(String addr) {\n+        try {\n+            return InetAddress.getByName(addr).getAddress().length == 16;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * check whether the str is ip address (IPv4 or IPv6).\n+     *\n+     * @param addr ip address str\n+     * @return boolean\n+     */\n+    public static boolean isIp(String addr) {\n+        try {\n+            InetAddress.getByName(addr);\n+            return true;\n+        } catch (UnknownHostException e) {\n+            return false;\n+        }\n+    }\n+    \n+    /**\n+     * Check if the address contains a port.\n+     * 2020/9/3 14:53\n+     * @param address address string\n+     * @return boolean\n+     */\n+    public static boolean containsPort(String address) {\n+        return splitIpPortStr(address).length == 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI2NTAzNw==", "bodyText": "replaced with IpUtil.containPort?", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484265037", "createdAt": "2020-09-07T08:13:10Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/ServiceManager.java", "diffHunk": "@@ -796,7 +797,8 @@ public int getPagedService(String namespaceId, int startPage, int pageSize, Stri\n                 contained = false;\n                 List<Instance> instances = service.allIPs();\n                 for (Instance instance : instances) {\n-                    if (containedInstance.contains(\":\")) {\n+                    String[] containedInstanceIpPort = IpUtil.splitIpPortStr(containedInstance);\n+                    if (containedInstanceIpPort.length == IpUtil.SPLIT_IP_PORT_RESULT_LENGTH) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938b8f404792dcf3b12e801d5254c05f12f996e5"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd7aeb6cf52d25b87f6bf11cc7209a8f53ab3707", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/dd7aeb6cf52d25b87f6bf11cc7209a8f53ab3707", "committedDate": "2020-09-07T08:51:16Z", "message": "AddressServerParamCheckUtil \u5408\u5e76\u5230 IpUtil \u53ca\u4e00\u4e9b\u4fee\u6539"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4f234d4ebf0d291fc703928a3222ef298c5cbef", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/b4f234d4ebf0d291fc703928a3222ef298c5cbef", "committedDate": "2020-09-07T10:01:41Z", "message": "\u89e3\u51b3\u9b54\u6cd5\u503c"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDYwMTU5", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483460159", "createdAt": "2020-09-07T10:51:37Z", "commit": {"oid": "b4f234d4ebf0d291fc703928a3222ef298c5cbef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMDo1MTozOFrOHN6siw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMDo1MTozOFrOHN6siw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1NTIxMQ==", "bodyText": "possible for OutOfIndexException\uff1f", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484355211", "createdAt": "2020-09-07T10:51:38Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Instance.java", "diffHunk": "@@ -117,19 +115,19 @@ public static Instance fromString(String config) {\n         }\n         \n         String provider = ipAddressAttributes[0];\n-        Matcher matcher = IP_PATTERN.matcher(provider);\n-        if (!matcher.matches()) {\n+        String[] providerAddr;\n+        try {\n+            providerAddr = IpUtil.splitIpPortStr(provider);\n+        } catch (Exception ex) {\n             return null;\n         }\n         \n-        int expectedGroupCount = 2;\n-        \n         int port = 0;\n-        if (NumberUtils.isNumber(matcher.group(expectedGroupCount))) {\n-            port = Integer.parseInt(matcher.group(expectedGroupCount));\n+        if (NumberUtils.isNumber(providerAddr[1])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4f234d4ebf0d291fc703928a3222ef298c5cbef"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb4e17790e68df192a886349c7ecfc745a6c8ad4", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/bb4e17790e68df192a886349c7ecfc745a6c8ad4", "committedDate": "2020-09-08T01:04:23Z", "message": "\u4fee\u6539\u9690\u60a3"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzQ4ODMz", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483748833", "createdAt": "2020-09-08T01:50:27Z", "commit": {"oid": "bb4e17790e68df192a886349c7ecfc745a6c8ad4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "601f0b4609747c750b0ef70582aadf46e235c8e4", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/601f0b4609747c750b0ef70582aadf46e235c8e4", "committedDate": "2020-09-08T02:07:42Z", "message": "\u8c03\u6574\u4f7f\u7528\u4e86\u7c7b\u4f3c ip.indexOf(\":\") \u67e5\u627e\u662f\u5426\u6709\u7aef\u53e3\u7684\u5730\u65b9\u7684\u903b\u8f91, \u4e00\u4e9b \":\" \u66ff\u6362\u4e3a\u5e38\u91cf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzUzNjQz", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483753643", "createdAt": "2020-09-08T02:10:19Z", "commit": {"oid": "601f0b4609747c750b0ef70582aadf46e235c8e4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMjoxMDoyMFrOHOKafA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMjoxMDoyOVrOHOKamg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYxMjczMg==", "bodyText": "format test method name to describe what situation the method test", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484612732", "createdAt": "2020-09-08T02:10:20Z", "author": {"login": "KomachiSion"}, "path": "common/src/test/java/com/alibaba/nacos/common/utils/IpUtilTest.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.utils;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.InetAddress;\n+import java.net.NetworkInterface;\n+import java.util.Enumeration;\n+\n+/**\n+ * test IpUtil.\n+ * @ClassName: IpUtilTest\n+ * @date 2020/9/3 10:31\n+ */\n+public class IpUtilTest {\n+    \n+    @Test\n+    public void test111(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601f0b4609747c750b0ef70582aadf46e235c8e4"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYxMjc2Mg==", "bodyText": "remove unused codes", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484612762", "createdAt": "2020-09-08T02:10:29Z", "author": {"login": "KomachiSion"}, "path": "common/src/test/java/com/alibaba/nacos/common/utils/IpUtilTest.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.utils;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.InetAddress;\n+import java.net.NetworkInterface;\n+import java.util.Enumeration;\n+\n+/**\n+ * test IpUtil.\n+ * @ClassName: IpUtilTest\n+ * @date 2020/9/3 10:31\n+ */\n+public class IpUtilTest {\n+    \n+    @Test\n+    public void test111(){\n+        try {\n+            Enumeration<NetworkInterface> en = NetworkInterface.getNetworkInterfaces();\n+            while (en.hasMoreElements()) {\n+                NetworkInterface ni = en.nextElement();\n+                Enumeration<InetAddress> ads = ni.getInetAddresses();\n+                while (ads.hasMoreElements()) {\n+                    InetAddress ip = ads.nextElement();\n+                    System.out.println(ip.getHostAddress());\n+                    // Compatible group does not regulate 11 network segments\n+                    if (!ip.isLoopbackAddress() && ip.getHostAddress().indexOf(\":\") == -1\n+                        /* && ip.isSiteLocalAddress() */) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "601f0b4609747c750b0ef70582aadf46e235c8e4"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc", "committedDate": "2020-09-08T02:17:38Z", "message": "\u5220\u9664\u65e0\u7528\u6d4b\u8bd5"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzU1NzY2", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483755766", "createdAt": "2020-09-08T02:19:22Z", "commit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzU2NDk3", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483756497", "createdAt": "2020-09-08T02:22:17Z", "commit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMjoyMjoxN1rOHOKksA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMjoyNToyNFrOHOKnjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYxNTM0NA==", "bodyText": "IpUtil.checkOK(str) I think is better", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484615344", "createdAt": "2020-09-08T02:22:17Z", "author": {"login": "chuntaojun"}, "path": "address/src/main/java/com/alibaba/nacos/address/controller/AddressServerClusterController.java", "diffHunk": "@@ -87,8 +87,8 @@ public ResponseEntity postCluster(@RequestParam(required = false) String product\n             clusterObj.setHealthChecker(new AbstractHealthChecker.None());\n             serviceManager.createServiceIfAbsent(Constants.DEFAULT_NAMESPACE_ID, serviceName, false, clusterObj);\n             String[] ipArray = addressServerManager.splitIps(ips);\n-            String checkResult = AddressServerParamCheckUtil.checkIps(ipArray);\n-            if (AddressServerParamCheckUtil.CHECK_OK.equals(checkResult)) {\n+            String checkResult = IpUtil.checkIps(ipArray);\n+            if (IpUtil.CHECK_OK.equals(checkResult)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYxNTkxOA==", "bodyText": "Ip => IP", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484615918", "createdAt": "2020-09-08T02:24:45Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/tls/SelfHostnameVerifier.java", "diffHunk": "@@ -38,7 +38,7 @@\n     \n     private static ConcurrentHashMap<String, Boolean> hosts = new ConcurrentHashMap<String, Boolean>();\n     \n-    private static final String[] LOCALHOST_HOSTNAME = new String[] {\"localhost\", \"127.0.0.1\"};\n+    private static final String[] LOCALHOST_HOSTNAME = new String[] {\"localhost\", IpUtil.localHostIp()};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYxNjA3Nw==", "bodyText": "IpUtil => IPUtil", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484616077", "createdAt": "2020-09-08T02:25:24Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/utils/IpUtil.java", "diffHunk": "@@ -0,0 +1,210 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.utils;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * ip tool.\n+ *\n+ * @author Nacos\n+ */\n+public class IpUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzY4MDQ2", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-483768046", "createdAt": "2020-09-08T03:08:54Z", "commit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMzowODo1NFrOHOLOog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwMzowODo1NFrOHOLOog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYyNjA4Mg==", "bodyText": "\u8fd9\u79cd\u5730\u65b9\u73b0\u5728\u662f\u4e0d\u662f\u5e94\u8be5\u7528isIp\u66ff\u6362isIpv4\u4e86\uff1f", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r484626082", "createdAt": "2020-09-08T03:08:54Z", "author": {"login": "wangweizZZ"}, "path": "client/src/main/java/com/alibaba/nacos/client/config/utils/ParamUtils.java", "diffHunk": "@@ -190,7 +190,7 @@ public static void checkBetaIps(String betaIps) throws NacosException {\n         }\n         String[] ipsArr = betaIps.split(\",\");\n         for (String ip : ipsArr) {\n-            if (!IpUtils.isIpv4(ip)) {\n+            if (!IpUtil.isIpv4(ip)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ab5f16bec8bd640463dbc19e1b8aabb9dd06fc"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1858bc0649acc0f83beeb943bf15b7b5d79e2615", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/1858bc0649acc0f83beeb943bf15b7b5d79e2615", "committedDate": "2020-09-08T04:40:00Z", "message": "IpUtil \u6539\u540d \u4e3a IPUtil, \u6d89\u53caIP\u7684\u76f8\u5173\u65b9\u6cd5\u540d\u4fee\u6539,\u6d89\u53ca\u5230\u7684\u8c03\u7528\u4fee\u6539,\u68c0\u6d4bIP\u7684\u5730\u65b9\u8c03\u7528\u7684isIPv4\u6539\u4e3aisIP. \u4fee\u6539\u6d89\u53caIP\u7684\u5b57\u6bb5\u957f\u5ea6\u53ca\u76f8\u5173\u5347\u7ea7\u66f4\u65b0\u7684sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0a63207c88cdc602201c549ac3a11a87d465232", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/a0a63207c88cdc602201c549ac3a11a87d465232", "committedDate": "2020-09-08T05:14:24Z", "message": "no message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe893465b1e4f7f8feeace364f1c9a8db646b43", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/dbe893465b1e4f7f8feeace364f1c9a8db646b43", "committedDate": "2020-09-08T05:14:43Z", "message": "no message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37620a4123c556b396ee2bf0ab85c2deaa1bb9ed", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/37620a4123c556b396ee2bf0ab85c2deaa1bb9ed", "committedDate": "2020-09-08T05:17:57Z", "message": "no message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c38451a863842507da77ce774628239b084494", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/55c38451a863842507da77ce774628239b084494", "committedDate": "2020-09-08T05:18:40Z", "message": "no message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44c7ff8a30f47a525266b4ba9d7ecfc1e3e16ec9", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/44c7ff8a30f47a525266b4ba9d7ecfc1e3e16ec9", "committedDate": "2020-09-09T06:47:18Z", "message": "\u83b7\u53d6\u672c\u673aIP\u65f6,\u5982\u679c\u672c\u673aIP\u662fIPv6\u5e76\u4e14\u5305\u542b\u7f51\u5361\u4fe1\u606f(V6\u5730\u5740\u4e2d\u6700\u540e\u9762\u7684\u767e\u5206\u53f7\u548c\u767e\u5206\u53f7\u540e\u9762\u7684\u5185\u5bb9)\u5219\u53bb\u9664\u7f51\u5361\u4fe1\u606f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "167d47915aca5f862c81ab26e72c07e108746159", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/167d47915aca5f862c81ab26e72c07e108746159", "committedDate": "2020-09-21T02:15:57Z", "message": "Merge pull request #1 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba31524c6c39e482c703c184845e3400d61120e", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/7ba31524c6c39e482c703c184845e3400d61120e", "committedDate": "2020-09-21T03:29:22Z", "message": "Merge branch 'develop' into support_ipv6\n\n# Conflicts:\n#\tcore/src/main/java/com/alibaba/nacos/core/cluster/MemberUtils.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/consistency/persistent/raft/RaftCore.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/consistency/persistent/raft/RaftProxy.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/healthcheck/ClientBeatCheckTask.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/misc/NamingProxy.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/misc/NetUtils.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/misc/ServerStatusSynchronizer.java\n#\tnaming/src/main/java/com/alibaba/nacos/naming/misc/ServiceStatusSynchronizer.java\n#\tsys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fe766ae5826e64806901a643d2fbcffd8bb70cb", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/5fe766ae5826e64806901a643d2fbcffd8bb70cb", "committedDate": "2020-10-12T03:13:06Z", "message": "Merge pull request #2 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef561bc017c3dc8bed802ea2e5ccfccf8b8af4c", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/9ef561bc017c3dc8bed802ea2e5ccfccf8b8af4c", "committedDate": "2020-10-13T07:55:09Z", "message": "Merge pull request #3 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34b53fc23ec15e4bee45f17ee746c00d301205a8", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/34b53fc23ec15e4bee45f17ee746c00d301205a8", "committedDate": "2020-10-17T06:51:52Z", "message": "Merge pull request #4 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a3b893365ccd9440fd887ad3b6b3345fc936264", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/5a3b893365ccd9440fd887ad3b6b3345fc936264", "committedDate": "2020-10-17T07:07:21Z", "message": "Merge branch 'develop' into support_ipv6\n\n# Conflicts:\n#\tnaming/src/main/java/com/alibaba/nacos/naming/misc/NetUtils.java\n#\tsys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "877ebab31199458bf647e88d8601dbe5cc80e585", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/877ebab31199458bf647e88d8601dbe5cc80e585", "committedDate": "2020-10-17T07:20:13Z", "message": "\u89e3\u51b3 AvoidComplexConditionRule(\u8bf7\u4e0d\u8981\u5728\u6761\u4ef6\u4e2d\u4f7f\u7528\u590d\u6742\u7684\u8868\u8fbe\u5f0f)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce519390ecb26ea03cf0b383568aa72e2cca144f", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/ce519390ecb26ea03cf0b383568aa72e2cca144f", "committedDate": "2020-10-19T04:07:21Z", "message": "\u79fb\u9664\u65e0\u7528\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1deee2aa15cc5764bf2430ce67a76f1f19e1517d", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/1deee2aa15cc5764bf2430ce67a76f1f19e1517d", "committedDate": "2020-10-20T06:35:47Z", "message": "Merge pull request #5 from alibaba/develop\n\n\u62c9\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6db4d53e4ad51cc133fd5296b5abc29a71dd48ff", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/6db4d53e4ad51cc133fd5296b5abc29a71dd48ff", "committedDate": "2020-10-22T03:49:27Z", "message": "Merge pull request #6 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34904b430329d30e296abd34ac889c9d20cb32a", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/a34904b430329d30e296abd34ac889c9d20cb32a", "committedDate": "2020-10-22T06:32:09Z", "message": "Merge branch 'develop' into support_ipv6\n\n# Conflicts:\n#\tnaming/src/main/java/com/alibaba/nacos/naming/consistency/persistent/raft/RaftCore.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29e7546a70ab312f0df0cfc1548de9f1179589f4", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/29e7546a70ab312f0df0cfc1548de9f1179589f4", "committedDate": "2020-10-26T03:35:33Z", "message": "Merge pull request #7 from alibaba/develop\n\n\u66f4\u65b0\u4ee3\u7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9eae1cb8b021cd5dd839e28df3eb699ea4ed572", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/e9eae1cb8b021cd5dd839e28df3eb699ea4ed572", "committedDate": "2020-10-26T03:39:35Z", "message": "Merge branch 'develop' into support_ipv6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTI5ODk2", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-501129896", "createdAt": "2020-10-02T13:22:52Z", "commit": {"oid": "7ba31524c6c39e482c703c184845e3400d61120e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoyMjo1MlrOHbtbIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoyMjo1MlrOHbtbIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxNzgyNw==", "bodyText": "\u4e3a\u4ec0\u4e48\u8981\u52a0\u8fd9\u4e2a\u5224\u65ad\uff1f", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r498817827", "createdAt": "2020-10-02T13:22:52Z", "author": {"login": "chuntaojun"}, "path": "core/src/main/java/com/alibaba/nacos/core/utils/WebUtils.java", "diffHunk": "@@ -93,6 +93,11 @@ private static String resolveValue(String value, String encoding) {\n         try {\n             value = HttpUtils.decode(new String(value.getBytes(StandardCharsets.UTF_8), encoding), encoding);\n         } catch (UnsupportedEncodingException ignore) {\n+        } catch (Exception ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ba31524c6c39e482c703c184845e3400d61120e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4", "committedDate": "2020-11-03T08:17:01Z", "message": "\u6dfb\u52a0\u6ce8\u91ca"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMDAzMzAw", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-523003300", "createdAt": "2020-11-04T02:26:26Z", "commit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwMjoyNjoyNlrOHtHCEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwMjo0ODozMVrOHtHXJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2MzE4Nw==", "bodyText": "Please do not change the code style.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517063187", "createdAt": "2020-11-04T02:26:26Z", "author": {"login": "Maijh97"}, "path": "core/src/main/java/com/alibaba/nacos/core/utils/WebUtils.java", "diffHunk": "@@ -42,7 +42,7 @@\n  * @author nkorange\n  */\n public class WebUtils {\n-    \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2NjI2MQ==", "bodyText": "Here \":\" can use IPUtil.IP_PORT_SPLITER.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517066261", "createdAt": "2020-11-04T02:38:39Z", "author": {"login": "Maijh97"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/ServiceManager.java", "diffHunk": "@@ -955,7 +956,7 @@ public int getPagedService(String namespaceId, int startPage, int pageSize, Stri\n                 contained = false;\n                 List<Instance> instances = service.allIPs();\n                 for (Instance instance : instances) {\n-                    if (containedInstance.contains(\":\")) {\n+                    if (IPUtil.containsPort(containedInstance)) {\n                         if (StringUtils.equals(instance.getIp() + \":\" + instance.getPort(), containedInstance)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2NjI5Ng==", "bodyText": "Here \":\" can use IPUtil.IP_PORT_SPLITER.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517066296", "createdAt": "2020-11-04T02:38:48Z", "author": {"login": "Maijh97"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/healthcheck/ClientBeatCheckTask.java", "diffHunk": "@@ -135,7 +136,7 @@ private void deleteIp(Instance instance) {\n                     .appendParam(\"ephemeral\", \"true\").appendParam(\"clusterName\", instance.getClusterName())\n                     .appendParam(\"serviceName\", service.getName()).appendParam(\"namespaceId\", service.getNamespaceId());\n             \n-            String url = \"http://127.0.0.1:\" + ApplicationUtils.getPort() + ApplicationUtils.getContextPath()\n+            String url = \"http://\" + IPUtil.localHostIP() + \":\" + ApplicationUtils.getPort() + ApplicationUtils.getContextPath()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2NjgzNg==", "bodyText": "Please do not change the code style.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517066836", "createdAt": "2020-11-04T02:40:58Z", "author": {"login": "Maijh97"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -87,20 +81,20 @@ public void run() {\n                 if (StringUtils.isBlank(nacosIP)) {\n                     nacosIP = ApplicationUtils.getProperty(IP_ADDRESS);\n                 }\n-                \n-                boolean illegalIP = !StringUtils.isBlank(nacosIP) && !(isIP(nacosIP) || isDomain(nacosIP));\n-                if (illegalIP) {\n-                    throw new RuntimeException(\"nacos address \" + nacosIP + \" is not ip\");\n+                if (!StringUtils.isBlank(nacosIP)) {\n+                    if (!(IPUtil.isIP(nacosIP) || isDomain(nacosIP))) {\n+                        throw new RuntimeException(\"nacos address \" + nacosIP + \" is not ip\");\n+                    }\n                 }\n                 String tmpSelfIP = nacosIP;\n                 if (StringUtils.isBlank(tmpSelfIP)) {\n                     preferHostnameOverIP = Boolean.getBoolean(SYSTEM_PREFER_HOSTNAME_OVER_IP);\n-                    \n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2Njg3NA==", "bodyText": "Please do not change the code style.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517066874", "createdAt": "2020-11-04T02:41:09Z", "author": {"login": "Maijh97"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -87,20 +81,20 @@ public void run() {\n                 if (StringUtils.isBlank(nacosIP)) {\n                     nacosIP = ApplicationUtils.getProperty(IP_ADDRESS);\n                 }\n-                \n-                boolean illegalIP = !StringUtils.isBlank(nacosIP) && !(isIP(nacosIP) || isDomain(nacosIP));\n-                if (illegalIP) {\n-                    throw new RuntimeException(\"nacos address \" + nacosIP + \" is not ip\");\n+                if (!StringUtils.isBlank(nacosIP)) {\n+                    if (!(IPUtil.isIP(nacosIP) || isDomain(nacosIP))) {\n+                        throw new RuntimeException(\"nacos address \" + nacosIP + \" is not ip\");\n+                    }\n                 }\n                 String tmpSelfIP = nacosIP;\n                 if (StringUtils.isBlank(tmpSelfIP)) {\n                     preferHostnameOverIP = Boolean.getBoolean(SYSTEM_PREFER_HOSTNAME_OVER_IP);\n-                    \n+    \n                     if (!preferHostnameOverIP) {\n                         preferHostnameOverIP = Boolean\n                                 .parseBoolean(ApplicationUtils.getProperty(PREFER_HOSTNAME_OVER_IP));\n                     }\n-                    \n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA2ODU4Mg==", "bodyText": "IPUtil.PREFER_IPV6_ADDRESSES ? address instanceof Inet6Address : address instanceof Inet4Address\nHere is a separate line, which is more readable.", "url": "https://github.com/alibaba/nacos/pull/3773#discussion_r517068582", "createdAt": "2020-11-04T02:48:31Z", "author": {"login": "Maijh97"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -159,8 +160,9 @@ public static InetAddress findFirstNonLoopbackAddress() {\n                     if (!ignoreInterface(ifc.getDisplayName())) {\n                         for (Enumeration<InetAddress> addrs = ifc.getInetAddresses(); addrs.hasMoreElements(); ) {\n                             InetAddress address = addrs.nextElement();\n-                            if (address instanceof Inet4Address && !address.isLoopbackAddress() && isPreferredAddress(\n-                                    address)) {\n+                            if ((IPUtil.PREFER_IPV6_ADDRESSES ? address instanceof Inet6Address\n+                                    : address instanceof Inet4Address) && !address.isLoopbackAddress()\n+                                    && isPreferredAddress(address)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99cbf16b1cfa5eb4f22e3a7836c5d35b1911afc4"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bceff65d438192f2925374fb602491516a6e7e59", "author": {"user": {"login": "KeRan213539", "name": "\u90aa\u5f71oO"}}, "url": "https://github.com/alibaba/nacos/commit/bceff65d438192f2925374fb602491516a6e7e59", "committedDate": "2020-11-04T03:40:52Z", "message": "\u8c03\u6574code style, \u8c03\u6574\u83b7\u53d6\u672c\u673aIP\u7684\u903b\u8f91"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjAxODQw", "url": "https://github.com/alibaba/nacos/pull/3773#pullrequestreview-524201840", "createdAt": "2020-11-05T12:14:28Z", "commit": {"oid": "bceff65d438192f2925374fb602491516a6e7e59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4280, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}