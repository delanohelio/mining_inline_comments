{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzOTUyNjM3", "number": 3995, "title": "Refactor dispatch task execute", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\nRefactor dispatch task execute, abstract an execute task engine to common-module, so that it can be used only only in distro.\nBrief changelog\n\nRefactor dispatch task execute\n\nVerifying this change\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.", "createdAt": "2020-10-15T09:17:14Z", "url": "https://github.com/alibaba/nacos/pull/3995", "merged": true, "mergeCommit": {"oid": "d78ebbbce10c6b9a534779de075206553eca9517"}, "closed": true, "closedAt": "2020-10-16T06:32:40Z", "author": {"login": "KomachiSion"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSoktJAH2gAyNTAzOTUyNjM3OmQ0ZjIxZmM5NzRjNjNhYzA4MzlmNWRhYjZmZGQwZGNhN2NjMjhhNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTAcBMAFqTUxMDE4Nzc5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4f21fc974c63ac0839f5dab6fdd0dca7cc28a6c", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/d4f21fc974c63ac0839f5dab6fdd0dca7cc28a6c", "committedDate": "2020-10-15T02:44:10Z", "message": "Refactor nacos task execute engine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b291294d605fba294f3e381488d4142291afc59", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/6b291294d605fba294f3e381488d4142291afc59", "committedDate": "2020-10-15T06:43:20Z", "message": "Refactor nacos task execute engine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ba85b823c42c1e6c6e4280096a846e503e52d52", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/0ba85b823c42c1e6c6e4280096a846e503e52d52", "committedDate": "2020-10-15T08:44:44Z", "message": "For checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/e2b1f38be54de5d5037409df5530c0ce7047500f", "committedDate": "2020-10-15T08:45:34Z", "message": "For checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzE2MDA0", "url": "https://github.com/alibaba/nacos/pull/3995#pullrequestreview-509316004", "createdAt": "2020-10-15T12:19:21Z", "commit": {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoxOToyMlrOHiE89Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjoyMzoxNFrOHiFGMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NDc3Mw==", "bodyText": "Can it be dynamically changed or defined by the user", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505494773", "createdAt": "2020-10-15T12:19:22Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/NacosExecuteTaskExecuteEngine.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.task.engine;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.common.task.AbstractExecuteTask;\n+import com.alibaba.nacos.common.task.NacosTaskProcessor;\n+import org.slf4j.Logger;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Nacos execute task execute engine.\n+ *\n+ * @author xiweng.yy\n+ */\n+public class NacosExecuteTaskExecuteEngine extends AbstractNacosTaskExecuteEngine<AbstractExecuteTask> {\n+    \n+    private final TaskExecuteWorker[] executeWorkers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NTIxNA==", "bodyText": "If I remember correctly, there's a special way to do this", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505495214", "createdAt": "2020-10-15T12:20:06Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/NacosExecuteTaskExecuteEngine.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.task.engine;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.common.task.AbstractExecuteTask;\n+import com.alibaba.nacos.common.task.NacosTaskProcessor;\n+import org.slf4j.Logger;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Nacos execute task execute engine.\n+ *\n+ * @author xiweng.yy\n+ */\n+public class NacosExecuteTaskExecuteEngine extends AbstractNacosTaskExecuteEngine<AbstractExecuteTask> {\n+    \n+    private final TaskExecuteWorker[] executeWorkers;\n+    \n+    public NacosExecuteTaskExecuteEngine(String name, Logger logger) {\n+        super(logger);\n+        int workerCount = findWorkerCount();\n+        executeWorkers = new TaskExecuteWorker[workerCount];\n+        for (int mod = 0; mod < workerCount; ++mod) {\n+            executeWorkers[mod] = new TaskExecuteWorker(name, mod, workerCount);\n+        }\n+    }\n+    \n+    private int findWorkerCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5NzEzNg==", "bodyText": "must be thread ? why not use runnable that execute by thread-pool-executor", "url": "https://github.com/alibaba/nacos/pull/3995#discussion_r505497136", "createdAt": "2020-10-15T12:23:14Z", "author": {"login": "chuntaojun"}, "path": "common/src/main/java/com/alibaba/nacos/common/task/engine/TaskExecuteWorker.java", "diffHunk": "@@ -101,12 +96,12 @@ public void shutdown() throws NacosException {\n      * Inner execute worker.\n      */\n     private class InnerWorker extends Thread {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2b1f38be54de5d5037409df5530c0ce7047500f"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8fe6692dc6799e2d3564a78b761bc82f932141a", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/e8fe6692dc6799e2d3564a78b761bc82f932141a", "committedDate": "2020-10-16T03:43:09Z", "message": "Use ThreadUtils to reduce duplicate codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0c9ddb2a2c2bfcfbbcf620ea46f509739bc81d6", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/b0c9ddb2a2c2bfcfbbcf620ea46f509739bc81d6", "committedDate": "2020-10-16T03:53:12Z", "message": "Set custom logger for TaskExecuteWorker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f20fcd8f3811967564f7c593e11a9f1df617ef7", "author": {"user": {"login": "KomachiSion", "name": "\u6768\u7fca SionYang"}}, "url": "https://github.com/alibaba/nacos/commit/0f20fcd8f3811967564f7c593e11a9f1df617ef7", "committedDate": "2020-10-16T03:58:44Z", "message": "Set custom logger for TaskExecuteWorker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMTg3Nzkx", "url": "https://github.com/alibaba/nacos/pull/3995#pullrequestreview-510187791", "createdAt": "2020-10-16T06:32:24Z", "commit": {"oid": "0f20fcd8f3811967564f7c593e11a9f1df617ef7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4186, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}