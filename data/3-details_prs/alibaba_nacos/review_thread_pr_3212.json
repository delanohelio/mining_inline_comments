{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxODczNDQ4", "number": 3212, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODo1Mjo1OFrOEKACJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMTozMDowM1rOEKtqcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4OTIxNzY1OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/BeanResponseConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODo1Mjo1OFrOGqylwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODo1Mjo1OFrOGqylwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUyMjI0Mg==", "bodyText": "Can we use JacksonUtil directly? I think we will replace and remove com.alibaba.nacos.common.http.handler.ResponseHandler Gradually", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r447522242", "createdAt": "2020-06-30T08:52:58Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/BeanResponseConverter.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.http.HttpRestResult;\n+import com.alibaba.nacos.common.http.param.Header;\n+import com.alibaba.nacos.common.http.param.MediaType;\n+import com.alibaba.nacos.common.model.RestResult;\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+\n+import java.io.InputStream;\n+import java.lang.reflect.Type;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * RestResult response converter\n+ * Mainly converter response type as bean type, Contain responseType as {@link RestResult}.\n+ *\n+ * @author mai.jh\n+ */\n+public class BeanResponseConverter<T> implements ResponseConverter<T> {\n+    \n+    private static final Set<Class<?>> NON_BEAN_CLASSES = Collections\n+            .unmodifiableSet(new HashSet<Class<?>>(Arrays.asList(Object.class, Class.class)));\n+    \n+    @Override\n+    public boolean canConverter(Type responseType, String contentType) {\n+        return contentType != null\n+                && contentType.startsWith(MediaType.APPLICATION_JSON)\n+                && isBindableBean(JacksonUtils.constructJavaType(responseType).getRawClass());\n+    }\n+    \n+    @Override\n+    @SuppressWarnings(\"unchecked\")\n+    public HttpRestResult<T> converter(HttpClientResponse response, Type responseType) throws Exception {\n+        final Header headers = response.getHeaders();\n+        InputStream body = response.getBody();\n+        T extractBody = com.alibaba.nacos.common.http.handler.ResponseHandler.convert(body, responseType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8f1781659a0a6a71a804a5587f46ecf6a35c6c"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI3MTU5OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/AbstractResponseConverterHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowMzowMlrOGrjAEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowMzowMlrOGrjAEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNTQwOQ==", "bodyText": "AbstractResponseHandler is enough, I think.", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448315409", "createdAt": "2020-07-01T12:03:02Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/AbstractResponseConverterHandler.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.http.HttpRestResult;\n+import com.alibaba.nacos.common.http.param.Header;\n+import com.alibaba.nacos.common.utils.IoUtils;\n+import org.apache.http.HttpStatus;\n+\n+import java.lang.reflect.Type;\n+\n+/**\n+ * Abstract response converter handler\n+ *\n+ * @author mai.jh\n+ */\n+public abstract class AbstractResponseConverterHandler<T> implements ResponseHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI3Mjk0OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/BeanResponseConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowMzoyOVrOGrjA_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowMzoyOVrOGrjA_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNTY0Nw==", "bodyText": "BeanResponseHandler, I think", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448315647", "createdAt": "2020-07-01T12:03:29Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/BeanResponseConverter.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.http.HttpRestResult;\n+import com.alibaba.nacos.common.http.param.Header;\n+\n+import java.io.InputStream;\n+import java.lang.reflect.Type;\n+\n+/**\n+ * bean response converter\n+ * Mainly converter response type as bean type\n+ *\n+ * @author mai.jh\n+ */\n+public class BeanResponseConverter<T> extends AbstractResponseConverterHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI3NTIwOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNDowOVrOGrjCYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNDowOVrOGrjCYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjAwMQ==", "bodyText": "abstract class AbstractNacosRestTemplate?", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448316001", "createdAt": "2020-07-01T12:04:09Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpConverter.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.constant.ResponseHandlerType;\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+import com.fasterxml.jackson.databind.JavaType;\n+\n+import java.lang.reflect.Type;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * http converter\n+ * For NacosRestTemplate and NacosAsyncRestTemplate,\n+ * provide initialization and register of response converter\n+ *\n+ * @author mai.jh\n+ */\n+public class HttpConverter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI3OTI2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNTozMlrOGrjE-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNTozMlrOGrjE-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjY2Nw==", "bodyText": "comment need an end '.', please  check all you comment.", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448316667", "createdAt": "2020-07-01T12:05:32Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/HttpConverter.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.constant.ResponseHandlerType;\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+import com.fasterxml.jackson.databind.JavaType;\n+\n+import java.lang.reflect.Type;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * http converter\n+ * For NacosRestTemplate and NacosAsyncRestTemplate,\n+ * provide initialization and register of response converter\n+ *\n+ * @author mai.jh\n+ */\n+public class HttpConverter {\n+    \n+    private final Map<String, ResponseHandler> responseConverterMap = new HashMap<String, ResponseHandler>();\n+    \n+    public HttpConverter() {\n+        // init response converter\n+        responseConverterMap.put(ResponseHandlerType.STRING_TYPE, new StringResponseConverter());\n+        responseConverterMap.put(ResponseHandlerType.RESTRESULT_TYPE, new RestResultResponseConverter());\n+        responseConverterMap.put(ResponseHandlerType.DEFAULT_BEAN_TYPE, new BeanResponseConverter());\n+    }\n+    \n+    /**\n+     * register customization Response Handler\n+     * @param responseHandler {@link ResponseHandler}\n+     */\n+    public void registerResponseHandler(String responseHandlerType, ResponseHandler responseHandler) {\n+        responseConverterMap.put(responseHandlerType, responseHandler);\n+    }\n+    \n+    /**\n+     * Select a response handler by responseType", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4MDQ4OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/RestResultResponseConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNTo1NVrOGrjFyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNTo1NVrOGrjFyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjg3Mw==", "bodyText": "RestResultResponseHandler.", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448316873", "createdAt": "2020-07-01T12:05:55Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/RestResultResponseConverter.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.http.HttpRestResult;\n+import com.alibaba.nacos.common.http.param.Header;\n+import com.alibaba.nacos.common.model.RestResult;\n+\n+import java.io.InputStream;\n+import java.lang.reflect.Type;\n+\n+/**\n+ * RestResult response converter\n+ * Mainly converter response type as {@link RestResult} type.\n+ *\n+ * @author mai.jh\n+ */\n+public class RestResultResponseConverter<T> extends AbstractResponseConverterHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDI4MDk3OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/StringResponseConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjowN1rOGrjGEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjowNjowN1rOGrjGEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjk0NA==", "bodyText": "StringResponseHandler", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448316944", "createdAt": "2020-07-01T12:06:07Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/StringResponseConverter.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.http.HttpRestResult;\n+import com.alibaba.nacos.common.http.param.Header;\n+import com.alibaba.nacos.common.utils.IoUtils;\n+\n+import java.lang.reflect.Type;\n+\n+/**\n+ * string response handler,\n+ * Mainly converter response type as string type.\n+ *\n+ * @author mai.jh\n+ */\n+public class StringResponseConverter extends AbstractResponseConverterHandler<String> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7565459b9e2cfec3815ab3ac0ae856c570ad7037"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjY5MzYyOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/http/client/AbstractNacosRestTemplate.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMTozMDowM1rOGr6Z8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMTozMDowM1rOGr6Z8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5ODg2NQ==", "bodyText": "We need change the name, because We rename the class.", "url": "https://github.com/alibaba/nacos/pull/3212#discussion_r448698865", "createdAt": "2020-07-02T01:30:03Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/http/client/AbstractNacosRestTemplate.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.common.http.client;\n+\n+import com.alibaba.nacos.common.constant.ResponseHandlerType;\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+import com.fasterxml.jackson.databind.JavaType;\n+\n+import java.lang.reflect.Type;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * For NacosRestTemplate and NacosAsyncRestTemplate,\n+ * provide initialization and register of response converter.\n+ *\n+ * @author mai.jh\n+ */\n+public abstract class AbstractNacosRestTemplate {\n+    \n+    private final Map<String, ResponseHandler> responseConverterMap = new HashMap<String, ResponseHandler>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d6fb38c5639304c75b59bff2416fe8c5df5c6a9"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4450, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}