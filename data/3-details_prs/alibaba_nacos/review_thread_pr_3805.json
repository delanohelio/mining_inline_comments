{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NzI2NDY2", "number": 3805, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoyNDoyMFrOEiaeuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0MzoxN1rOEia2Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTIwODg5OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/Main.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoyNDoyMFrOHQRajA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0NTo0NVrOHQSDZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyNDU4OA==", "bodyText": "What's the reason create this class?", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486824588", "createdAt": "2020-09-11T07:24:20Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/Main.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ *  Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.sys;\n+\n+/**\n+ * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n+ */\n+public class Main {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzNTA0NA==", "bodyText": "already remove, wait next comit", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486835044", "createdAt": "2020-09-11T07:45:45Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/Main.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ *  Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.sys;\n+\n+/**\n+ * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n+ */\n+public class Main {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyNDU4OA=="}, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTIxNzAwOnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosDefaultPropertySourceEnvironmentPostProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoyNjo0OVrOHQRfUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0NTo1MlrOHQSDpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyNTgwOQ==", "bodyText": "Why change the indentation of lecense?", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486825809", "createdAt": "2020-09-11T07:26:49Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosDefaultPropertySourceEnvironmentPostProcessor.java", "diffHunk": "@@ -1,20 +1,20 @@\n /*\n- * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *  Copyright 1999-2018 Alibaba Group Holding Ltd.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzNTEwOA==", "bodyText": "already fix", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486835108", "createdAt": "2020-09-11T07:45:52Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosDefaultPropertySourceEnvironmentPostProcessor.java", "diffHunk": "@@ -1,20 +1,20 @@\n /*\n- * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *  Copyright 1999-2018 Alibaba Group Holding Ltd.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyNTgwOQ=="}, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTI0MDk3OnYy", "diffSide": "RIGHT", "path": "console/src/main/resources/application.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzozNDo0OFrOHQRt1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzozNDo0OFrOHQRt1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyOTUyNg==", "bodyText": "Why exclude these classes\uff1f", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486829526", "createdAt": "2020-09-11T07:34:48Z", "author": {"login": "KomachiSion"}, "path": "console/src/main/resources/application.properties", "diffHunk": "@@ -175,3 +175,14 @@ nacos.istio.mcp.server.enabled=false\n # nacos.core.protocol.raft.data.read_index_type=ReadOnlySafe\n ### rpc request timeout, default 5 seconds\n # nacos.core.protocol.raft.data.rpc_request_timeout_ms=5000\n+\n+\n+## HTTP Encoding\n+spring.http.encoding.force=true\n+spring.http.encoding.enabled=true\n+\n+## i18n\n+spring.messages.encoding=UTF-8\n+\n+## Exclude Spring Boot Auto-Configuration class(es)\n+spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTI2NTQ3OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosAutoRefreshPropertySourceLoader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0MjowNVrOHQR8Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0MjowNVrOHQR8Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzMzE5OQ==", "bodyText": "I found this inner class only used in current class line 97. And each time create a new one. Can this inner class refactor to some private method.\nIf there are other same package class need this class. Whether extract as an single class will be better?", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486833199", "createdAt": "2020-09-11T07:42:05Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosAutoRefreshPropertySourceLoader.java", "diffHunk": "@@ -0,0 +1,332 @@\n+/*\n+ *  Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.sys.env;\n+\n+import com.alibaba.nacos.api.exception.NacosException;\n+import com.alibaba.nacos.common.JustForTest;\n+import com.alibaba.nacos.sys.file.FileChangeEvent;\n+import com.alibaba.nacos.sys.file.FileWatcher;\n+import com.alibaba.nacos.sys.file.WatchFileCenter;\n+import com.alibaba.nacos.sys.utils.ApplicationUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.boot.env.OriginTrackedMapPropertySource;\n+import org.springframework.boot.env.PropertySourceLoader;\n+import org.springframework.boot.origin.Origin;\n+import org.springframework.boot.origin.OriginTrackedValue;\n+import org.springframework.boot.origin.TextResourceOrigin;\n+import org.springframework.core.env.PropertySource;\n+import org.springframework.core.io.Resource;\n+import org.springframework.util.Assert;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.LineNumberReader;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Support for configuring automatic refresh and loading into the Environment.\n+ *\n+ * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n+ */\n+public class NacosAutoRefreshPropertySourceLoader implements PropertySourceLoader {\n+    \n+    private final Map<String, Object> properties = new ConcurrentHashMap<>(16);\n+    \n+    private Resource holder = null;\n+    \n+    @Override\n+    public String[] getFileExtensions() {\n+        return new String[] {\"properties\"};\n+    }\n+    \n+    @Override\n+    public List<PropertySource<?>> load(String name, Resource resource) throws IOException {\n+        holder = resource;\n+        Map<String, ?> tmp = loadProperties(resource);\n+        properties.putAll(tmp);\n+    \n+        try {\n+            WatchFileCenter.registerWatcher(ApplicationUtils.getConfFilePath(), new FileWatcher() {\n+                @Override\n+                public void onChange(FileChangeEvent event) {\n+                    try {\n+                        Map<String, ?> tmp1 = loadProperties(holder);\n+                        properties.putAll(tmp1);\n+                    } catch (IOException ignore) {\n+                    \n+                    }\n+                }\n+            \n+                @Override\n+                public boolean interest(String context) {\n+                    return StringUtils.contains(context, \"application.properties\");\n+                }\n+            });\n+        } catch (NacosException ignore) {\n+        \n+        }\n+    \n+        if (properties.isEmpty()) {\n+            return Collections.emptyList();\n+        }\n+        return Collections\n+                .singletonList(new OriginTrackedMapPropertySource(\"nacos_application_conf\", properties));\n+    }\n+    \n+    private Map<String, ?> loadProperties(Resource resource) throws IOException {\n+        return new OriginTrackedPropertiesLoader(resource).load();\n+    }\n+    \n+    @JustForTest\n+    protected Map<String, Object> getProperties() {\n+        return properties;\n+    }\n+    \n+    static class OriginTrackedPropertiesLoader {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd596e9cdc9fef270f6ced9b680711eff8cae877"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTI2OTE4OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosDefaultPropertySourceEnvironmentPostProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0MzoxN1rOHQR-jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo0MzoxN1rOHQR-jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzMzgwNw==", "bodyText": "This file has been deleted?", "url": "https://github.com/alibaba/nacos/pull/3805#discussion_r486833807", "createdAt": "2020-09-11T07:43:17Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/NacosDefaultPropertySourceEnvironmentPostProcessor.java", "diffHunk": "@@ -56,7 +57,7 @@\n      * @see ResourcePatternResolver#CLASSPATH_ALL_URL_PREFIX\n      */\n     public static final String RESOURCE_LOCATION_PATTERN =\n-            CLASSPATH_ALL_URL_PREFIX + \"META-INF/nacos-default.properties\";\n+            ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX + \"META-INF/nacos-default.properties\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bde78ff5dcd572f0de98463d67853be2bb964eb"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4360, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}