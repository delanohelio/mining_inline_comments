{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyODQ3NzE1", "number": 3913, "title": "[ISSUE #3909] add domain's judgement", "bodyText": "What is the purpose of the change\nfix-#3909", "createdAt": "2020-09-25T05:45:16Z", "url": "https://github.com/alibaba/nacos/pull/3913", "merged": true, "mergeCommit": {"oid": "c0496b364e43d416350135b671296d22cf643325"}, "closed": true, "closedAt": "2020-10-12T04:19:03Z", "author": {"login": "horizonzy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMPKQHAH2gAyNDkyODQ3NzE1OjAwYmI3YmQ5MzE5ZDdkMjJjNWI4YzIyNjhlM2MyZjczZTFjZjA2NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN53K5AFqTQ5OTI3MzgyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00bb7bd9319d7d22c5b8c2268e3c2f73e1cf0646", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/00bb7bd9319d7d22c5b8c2268e3c2f73e1cf0646", "committedDate": "2020-09-25T05:44:06Z", "message": "add domain's judgement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDUxMTI1", "url": "https://github.com/alibaba/nacos/pull/3913#pullrequestreview-497051125", "createdAt": "2020-09-27T04:54:35Z", "commit": {"oid": "00bb7bd9319d7d22c5b8c2268e3c2f73e1cf0646"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNDo1NDozNlrOHYkq8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNTowMDoxN1rOHYksYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUyODY4OA==", "bodyText": "There is no port, just set ip or domain.\nSee isIP", "url": "https://github.com/alibaba/nacos/pull/3913#discussion_r495528688", "createdAt": "2020-09-27T04:54:36Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -219,6 +219,26 @@ public static boolean isIP(String str) {\n         return matcher.matches();\n     }\n     \n+    /**\n+     * juege str is right domain.\n+     *\n+     * @param str nacosIp\n+     * @return nacosIp is domain\n+     */\n+    public static boolean isDomain(String str) {\n+        try {\n+            String[] split = str.split(\":\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00bb7bd9319d7d22c5b8c2268e3c2f73e1cf0646"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUyOTA1Nw==", "bodyText": "Is this too strict to judge?\nthis method need the input must can be parse to IP and can reach.\nBut we just need check the input string is a domain pattern", "url": "https://github.com/alibaba/nacos/pull/3913#discussion_r495529057", "createdAt": "2020-09-27T05:00:17Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -219,6 +219,26 @@ public static boolean isIP(String str) {\n         return matcher.matches();\n     }\n     \n+    /**\n+     * juege str is right domain.\n+     *\n+     * @param str nacosIp\n+     * @return nacosIp is domain\n+     */\n+    public static boolean isDomain(String str) {\n+        try {\n+            String[] split = str.split(\":\");\n+            if (split.length != 2) {\n+                return false;\n+            }\n+            Integer.parseInt(split[1]);\n+            InetAddress address = InetAddress.getByName(split[0]);\n+            return address.isReachable(100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00bb7bd9319d7d22c5b8c2268e3c2f73e1cf0646"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9f5f7101a03f291bb8e777fa5364d44a1a3de49", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/c9f5f7101a03f291bb8e777fa5364d44a1a3de49", "committedDate": "2020-09-27T05:58:06Z", "message": "modify domain's judgement, can resolve = true"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a9745f87d994421cb1a758ff3f834e48ecb6bf1", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/2a9745f87d994421cb1a758ff3f834e48ecb6bf1", "committedDate": "2020-09-27T07:05:03Z", "message": "remove judgement in 'if' code block"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MTYyNTIz", "url": "https://github.com/alibaba/nacos/pull/3913#pullrequestreview-497162523", "createdAt": "2020-09-28T03:12:21Z", "commit": {"oid": "2a9745f87d994421cb1a758ff3f834e48ecb6bf1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMzoxMjoyMVrOHYtMhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMzoxMjoyMVrOHYtMhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY2ODM1Ng==", "bodyText": "illegalIp => illegalIP", "url": "https://github.com/alibaba/nacos/pull/3913#discussion_r495668356", "createdAt": "2020-09-28T03:12:21Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -87,7 +88,8 @@ public void run() {\n                     nacosIp = ApplicationUtils.getProperty(IP_ADDRESS);\n                 }\n                 \n-                if (!StringUtils.isBlank(nacosIp) && !isIP(nacosIp)) {\n+                boolean illegalIp = !StringUtils.isBlank(nacosIp) && !(isIP(nacosIp) || isDomain(nacosIp));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9745f87d994421cb1a758ff3f834e48ecb6bf1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6545584c5d9538bd7523430f9bb5bc0fc2b46945", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/6545584c5d9538bd7523430f9bb5bc0fc2b46945", "committedDate": "2020-09-28T04:34:42Z", "message": "replace Ip to IP in InetUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDg4NTE3", "url": "https://github.com/alibaba/nacos/pull/3913#pullrequestreview-499088517", "createdAt": "2020-09-30T05:12:09Z", "commit": {"oid": "6545584c5d9538bd7523430f9bb5bc0fc2b46945"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNToxMjowOVrOHaNiXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNToxMjowOVrOHaNiXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI0NjgxNA==", "bodyText": "A Warn log can be output here to indicate that the domain name is not reachable", "url": "https://github.com/alibaba/nacos/pull/3913#discussion_r497246814", "createdAt": "2020-09-30T05:12:09Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -219,35 +221,46 @@ public static boolean isIP(String str) {\n         return matcher.matches();\n     }\n     \n+    /**\n+     * juege str is right domain.\n+     *\n+     * @param str nacosIP\n+     * @return nacosIP is domain\n+     */\n+    public static boolean isDomain(String str) {\n+        InetSocketAddress address = new InetSocketAddress(str, 0);\n+        return !address.isUnresolved();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6545584c5d9538bd7523430f9bb5bc0fc2b46945"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd775d5722913ed65d1a4788f647f101e08323a4", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/bd775d5722913ed65d1a4788f647f101e08323a4", "committedDate": "2020-09-30T08:23:57Z", "message": "log warn info when domain can not be resolved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MjA4MTAx", "url": "https://github.com/alibaba/nacos/pull/3913#pullrequestreview-499208101", "createdAt": "2020-09-30T08:40:49Z", "commit": {"oid": "bd775d5722913ed65d1a4788f647f101e08323a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODo0MDo0OVrOHaTRtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODo0MDo0OVrOHaTRtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM0MDg1Mw==", "bodyText": "isResolved => unResolved", "url": "https://github.com/alibaba/nacos/pull/3913#discussion_r497340853", "createdAt": "2020-09-30T08:40:49Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/utils/InetUtils.java", "diffHunk": "@@ -219,35 +221,50 @@ public static boolean isIP(String str) {\n         return matcher.matches();\n     }\n     \n+    /**\n+     * juege str is right domain.\n+     *\n+     * @param str nacosIP\n+     * @return nacosIP is domain\n+     */\n+    public static boolean isDomain(String str) {\n+        InetSocketAddress address = new InetSocketAddress(str, 0);\n+        boolean isResolved = !address.isUnresolved();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd775d5722913ed65d1a4788f647f101e08323a4"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16b8eca3a38fbfd29b9b3a9a05bdbb51dc865841", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/16b8eca3a38fbfd29b9b3a9a05bdbb51dc865841", "committedDate": "2020-09-30T09:58:00Z", "message": "fix vaiable name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MjczODI2", "url": "https://github.com/alibaba/nacos/pull/3913#pullrequestreview-499273826", "createdAt": "2020-09-30T10:03:06Z", "commit": {"oid": "16b8eca3a38fbfd29b9b3a9a05bdbb51dc865841"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4174, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}