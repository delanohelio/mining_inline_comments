{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMTAzMzY1", "number": 4259, "title": "[ISSUE-#4258]  Fix wrong path when -Dspring.config.location not set", "bodyText": "What is the purpose of the change\nFix-#4258", "createdAt": "2020-11-18T11:04:47Z", "url": "https://github.com/alibaba/nacos/pull/4259", "merged": true, "mergeCommit": {"oid": "dc266b03bcfb5660f99089ea88f6bf8a553766a5"}, "closed": true, "closedAt": "2020-11-25T09:02:22Z", "author": {"login": "horizonzy"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddrtBcAH2gAyNTIzMTAzMzY1OjdiMGNhMTliNDgxNDg1NzhmMmEzYzFkMTM5MDQ4ODVlZTY2MTMyY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdf6jdpgFqTUzODI4MDMzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b0ca19b48148578f2a3c1d13904885ee66132ce", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/7b0ca19b48148578f2a3c1d13904885ee66132ce", "committedDate": "2020-11-18T10:36:08Z", "message": "fix spring.config.location is nullapplication.properties when -Dspring.config.location is not set in env"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e366e3391c436c1660d9ce53c1a8707b015fec51", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/e366e3391c436c1660d9ce53c1a8707b015fec51", "committedDate": "2020-11-18T10:58:30Z", "message": "fix wrong path when -Dspring.config.location not set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ecfba190a44552a304323e40ebe07508076ea70", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/0ecfba190a44552a304323e40ebe07508076ea70", "committedDate": "2020-11-18T11:10:35Z", "message": "modify default file resource method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c0937e4920665ffcbcc0820e153aab1071eaa84", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/8c0937e4920665ffcbcc0820e153aab1071eaa84", "committedDate": "2020-11-18T11:49:12Z", "message": "fix \"/\" magic value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMzM4NDgx", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-533338481", "createdAt": "2020-11-18T11:10:47Z", "commit": {"oid": "e366e3391c436c1660d9ce53c1a8707b015fec51"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMToxMDo0N1rOH1otQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMToxMDo0N1rOH1otQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAwMzUyMg==", "bodyText": "new File(path + \"application.properties\") => Paths.get().toFile()", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526003522", "createdAt": "2020-11-18T11:10:47Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +361,35 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {\n+            return getDefaultResource();\n+        }\n+        return customResource;\n+    }\n+    \n+    private static Resource getCustomFileResource() {\n         String path = getProperty(\"spring.config.location\");\n-        InputStream inputStream = null;\n+        if (path == null) {\n+            return null;\n+        }\n         if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {\n             String[] paths = path.split(\",\");\n             path = paths[paths.length - 1].substring(FILE_PREFIX.length());\n         }\n+        if (!path.endsWith(\"/\")) {\n+            path += \"/\";\n+        }\n         try {\n-            inputStream = new FileInputStream(new File(path + \"application.properties\"));\n+            InputStream inputStream = new FileInputStream(new File(path + \"application.properties\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e366e3391c436c1660d9ce53c1a8707b015fec51"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f046dcc220fcc65b05cfebd17ca63299b318cfd4", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/f046dcc220fcc65b05cfebd17ca63299b318cfd4", "committedDate": "2020-11-18T11:56:17Z", "message": "change the way of get file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "088ea237a3cb2a1f1217fbae70affb66364f3f4a", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/088ea237a3cb2a1f1217fbae70affb66364f3f4a", "committedDate": "2020-11-18T12:06:16Z", "message": "not judge pathSplit by self, use Paths.get(a, b);"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a734f20396cda39d4697bc1a93987947c7d428d", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/5a734f20396cda39d4697bc1a93987947c7d428d", "committedDate": "2020-11-19T02:36:17Z", "message": "when spring.config.location is not set, use {nacos.home}/conf/application.properties to cover it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDU0NDUw", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-534054450", "createdAt": "2020-11-19T03:23:55Z", "commit": {"oid": "5a734f20396cda39d4697bc1a93987947c7d428d"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzoyMzo1NlrOH2LQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzoyMzo1NlrOH2LQSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU2OTU0Nw==", "bodyText": "use Paths.get(...)", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526569547", "createdAt": "2020-11-19T03:23:56Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -363,15 +363,15 @@ public static String getMemberList() {\n     public static Resource getApplicationConfFileResource() {\n         Resource customResource = getCustomFileResource();\n         if (customResource == null) {\n-            return getDefaultFileResource();\n+            return getDefaultResource();\n         }\n         return customResource;\n     }\n     \n     private static Resource getCustomFileResource() {\n         String path = getProperty(\"spring.config.location\");\n         if (path == null) {\n-            return null;\n+            path = EnvUtil.getNacosHome() + \"/conf\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a734f20396cda39d4697bc1a93987947c7d428d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d578a44a2178c660acbcbe31a82661ce509ebe28", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/d578a44a2178c660acbcbe31a82661ce509ebe28", "committedDate": "2020-11-19T07:38:18Z", "message": "refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTcyNzQx", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-534172741", "createdAt": "2020-11-19T08:20:16Z", "commit": {"oid": "d578a44a2178c660acbcbe31a82661ce509ebe28"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTkxMzI0", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-534191324", "createdAt": "2020-11-19T08:44:46Z", "commit": {"oid": "d578a44a2178c660acbcbe31a82661ce509ebe28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0NDo0NlrOH2SS_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0NDo0NlrOH2SS_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NDkyNQ==", "bodyText": "\u8fd9\u4e2aif (customPath == null)\u53ef\u4ee5\u53bb\u6389\uff0c\u56e0\u4e3a\u65b9\u6cd5\u7ed3\u675f\u4f1areturn getRelativePathResource(Paths.get(EnvUtil.getNacosHome(), \"conf\"));", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526684925", "createdAt": "2020-11-19T08:44:46Z", "author": {"login": "Maijh97"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +362,38 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n-        String path = getProperty(\"spring.config.location\");\n-        InputStream inputStream = null;\n-        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {\n-            String[] paths = path.split(\",\");\n-            path = paths[paths.length - 1].substring(FILE_PREFIX.length());\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {\n+            return getDefaultResource();\n         }\n+        return customResource;\n+    }\n+    \n+    private static Resource getCustomFileResource() {\n+        String customPath = getProperty(\"spring.config.location\");\n+        if (customPath == null) {\n+            return getRelativePathResource(Paths.get(EnvUtil.getNacosHome(), \"conf\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d578a44a2178c660acbcbe31a82661ce509ebe28"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820b2202a38c576b68aa7842804ec1eee5c6d4f8", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/820b2202a38c576b68aa7842804ec1eee5c6d4f8", "committedDate": "2020-11-19T09:33:54Z", "message": "code quality enhance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDQ1ODcw", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-534445870", "createdAt": "2020-11-19T13:30:48Z", "commit": {"oid": "820b2202a38c576b68aa7842804ec1eee5c6d4f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDQ4ODg5", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-534448889", "createdAt": "2020-11-19T13:34:22Z", "commit": {"oid": "820b2202a38c576b68aa7842804ec1eee5c6d4f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b", "committedDate": "2020-11-20T02:38:57Z", "message": "just use two level to load conf. {spring.config.location}/application.properties -> classpath:/application.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDQxMjk4", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-535041298", "createdAt": "2020-11-20T03:09:08Z", "commit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMzowOTowOFrOH270xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMzowOTowOFrOH270xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2NTMxOA==", "bodyText": "StringUtils.contains() \u6709\u8fd9\u79cd\u65b9\u6cd5\u5417\uff1f", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r527365318", "createdAt": "2020-11-20T03:09:08Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -370,21 +369,18 @@ public static Resource getApplicationConfFileResource() {\n     }\n     \n     private static Resource getCustomFileResource() {\n-        String customPath = getProperty(\"spring.config.location\");\n-        \n-        if (StringUtils.isNotBlank(customPath) && customPath.contains(FILE_PREFIX)) {\n-            String[] paths = customPath.split(\",\");\n-            customPath = paths[paths.length - 1].substring(FILE_PREFIX.length());\n-            Path parentPath = Paths.get(customPath);\n-            return getRelativePathResource(parentPath);\n+        String path = getProperty(\"spring.config.location\");\n+        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODI5NTAz", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-535829503", "createdAt": "2020-11-20T22:55:06Z", "commit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDM5NTcx", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-536039571", "createdAt": "2020-11-22T08:29:57Z", "commit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTQ1ODE4", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-536145818", "createdAt": "2020-11-23T02:01:00Z", "commit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowMVrOH39iiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowMVrOH39iiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ0MTk5NQ==", "bodyText": "Simply to null == customResource ? return getDefaultResource() : customResource", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r528441995", "createdAt": "2020-11-23T02:01:01Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +361,34 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "613217b6d1c8722ef05fb0d92f108424f4ee74a3", "author": {"user": {"login": "horizonzy", "name": "\u8d75\u5ef6"}}, "url": "https://github.com/alibaba/nacos/commit/613217b6d1c8722ef05fb0d92f108424f4ee74a3", "committedDate": "2020-11-23T02:34:06Z", "message": "code clean"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTU3MDYy", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-536157062", "createdAt": "2020-11-23T03:08:06Z", "commit": {"oid": "613217b6d1c8722ef05fb0d92f108424f4ee74a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTg4Mjcy", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-536188272", "createdAt": "2020-11-23T05:45:40Z", "commit": {"oid": "613217b6d1c8722ef05fb0d92f108424f4ee74a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjgwMzMx", "url": "https://github.com/alibaba/nacos/pull/4259#pullrequestreview-538280331", "createdAt": "2020-11-25T09:02:07Z", "commit": {"oid": "613217b6d1c8722ef05fb0d92f108424f4ee74a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4109, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}