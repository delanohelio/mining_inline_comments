{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNzk3MDkz", "number": 2403, "title": "fix checksum bug #2401", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\nfix the checksum bug, refer to #2401\nMessageDigest is not safe in multi-thread\nBrief changelog\nAdd a lock to ensure execute success\nVerifying this change\nsee InstancesTest", "createdAt": "2020-03-03T07:54:17Z", "url": "https://github.com/alibaba/nacos/pull/2403", "merged": true, "mergeCommit": {"oid": "b7a2c756fe68a489e8dfdc70b4a55a526a6b90cb"}, "closed": true, "closedAt": "2020-03-29T15:01:49Z", "author": {"login": "lkxiaolou"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJ9XoIgH2gAyMzgyNzk3MDkzOmI3NmMwNDA4MjZiMTY4Y2FiNzNhOWNlYmU3N2ZmNGMxMzRkZjRlM2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNh3DjAH2gAyMzgyNzk3MDkzOjgzYzA5OGI4Y2FiYTM4NTVhMWY0ZWIxZmVjZDhiNDYzZTI4NzdkMjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b76c040826b168cab73a9cebe77ff4c134df4e3f", "author": {"user": {"login": "lkxiaolou", "name": "Roshi"}}, "url": "https://github.com/alibaba/nacos/commit/b76c040826b168cab73a9cebe77ff4c134df4e3f", "committedDate": "2020-03-03T07:41:25Z", "message": "fix checksum bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NzY0NjQz", "url": "https://github.com/alibaba/nacos/pull/2403#pullrequestreview-367764643", "createdAt": "2020-03-03T07:59:43Z", "commit": {"oid": "b76c040826b168cab73a9cebe77ff4c134df4e3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwNzo1OTo0NFrOFw7b4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwNzo1OTo0NFrOFw7b4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg0OTc2MQ==", "bodyText": "Can ThreadLocal be used to avoid lock contention", "url": "https://github.com/alibaba/nacos/pull/2403#discussion_r386849761", "createdAt": "2020-03-03T07:59:44Z", "author": {"login": "chuntaojun"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Instances.java", "diffHunk": "@@ -84,8 +86,10 @@ private String recalculateChecksum() {\n         }\n \n         if (MESSAGE_DIGEST != null) {\n-            checksum =\n-                new BigInteger(1, MESSAGE_DIGEST.digest((sb.toString()).getBytes(Charset.forName(\"UTF-8\")))).toString(16);\n+            synchronized (LOCK) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b76c040826b168cab73a9cebe77ff4c134df4e3f"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7ca2c1df4de414bfa3d09dd9e15b008662e1de9", "author": {"user": {"login": "lkxiaolou", "name": "Roshi"}}, "url": "https://github.com/alibaba/nacos/commit/c7ca2c1df4de414bfa3d09dd9e15b008662e1de9", "committedDate": "2020-03-03T08:22:00Z", "message": "\u6539\u4e3athreadLocal\u5b9e\u73b0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODUxNzQw", "url": "https://github.com/alibaba/nacos/pull/2403#pullrequestreview-367851740", "createdAt": "2020-03-03T10:13:51Z", "commit": {"oid": "c7ca2c1df4de414bfa3d09dd9e15b008662e1de9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoxMzo1MVrOFw_poQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoxMzo1MVrOFw_poQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkxODgxNw==", "bodyText": "Here, you can consider holding the MessageDigest with a local variable to avoid getting again later", "url": "https://github.com/alibaba/nacos/pull/2403#discussion_r386918817", "createdAt": "2020-03-03T10:13:51Z", "author": {"login": "chuntaojun"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Instances.java", "diffHunk": "@@ -83,9 +84,10 @@ private String recalculateChecksum() {\n             sb.append(\",\");\n         }\n \n-        if (MESSAGE_DIGEST != null) {\n-            checksum =\n-                new BigInteger(1, MESSAGE_DIGEST.digest((sb.toString()).getBytes(Charset.forName(\"UTF-8\")))).toString(16);\n+        if (MESSAGE_DIGEST_LOCAL.get() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7ca2c1df4de414bfa3d09dd9e15b008662e1de9"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e70787b25b74e1eda2b0cb50a179b5942c1b6b35", "author": {"user": {"login": "lkxiaolou", "name": "Roshi"}}, "url": "https://github.com/alibaba/nacos/commit/e70787b25b74e1eda2b0cb50a179b5942c1b6b35", "committedDate": "2020-03-03T10:47:13Z", "message": "commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzI1NDA0", "url": "https://github.com/alibaba/nacos/pull/2403#pullrequestreview-370725404", "createdAt": "2020-03-07T05:53:53Z", "commit": {"oid": "e70787b25b74e1eda2b0cb50a179b5942c1b6b35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83c098b8caba3855a1f4eb1fecd8b463e2877d23", "author": {"user": {"login": "lkxiaolou", "name": "Roshi"}}, "url": "https://github.com/alibaba/nacos/commit/83c098b8caba3855a1f4eb1fecd8b463e2877d23", "committedDate": "2020-03-14T09:54:06Z", "message": "\u7edf\u4e00md5\u8ba1\u7b97"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4476, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}