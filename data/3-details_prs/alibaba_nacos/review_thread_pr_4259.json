{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMTAzMzY1", "number": 4259, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMToxMDo0N1rOE6hBwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowMVrOE8DC5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NzkzOTg2OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMToxMDo0N1rOH1otQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMjowNjo0OFrOH1qtKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAwMzUyMg==", "bodyText": "new File(path + \"application.properties\") => Paths.get().toFile()", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526003522", "createdAt": "2020-11-18T11:10:47Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +361,35 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {\n+            return getDefaultResource();\n+        }\n+        return customResource;\n+    }\n+    \n+    private static Resource getCustomFileResource() {\n         String path = getProperty(\"spring.config.location\");\n-        InputStream inputStream = null;\n+        if (path == null) {\n+            return null;\n+        }\n         if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {\n             String[] paths = path.split(\",\");\n             path = paths[paths.length - 1].substring(FILE_PREFIX.length());\n         }\n+        if (!path.endsWith(\"/\")) {\n+            path += \"/\";\n+        }\n         try {\n-            inputStream = new FileInputStream(new File(path + \"application.properties\"));\n+            InputStream inputStream = new FileInputStream(new File(path + \"application.properties\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e366e3391c436c1660d9ce53c1a8707b015fec51"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAzNjI2Nw==", "bodyText": "ok", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526036267", "createdAt": "2020-11-18T12:06:48Z", "author": {"login": "horizonzy"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +361,35 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {\n+            return getDefaultResource();\n+        }\n+        return customResource;\n+    }\n+    \n+    private static Resource getCustomFileResource() {\n         String path = getProperty(\"spring.config.location\");\n-        InputStream inputStream = null;\n+        if (path == null) {\n+            return null;\n+        }\n         if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {\n             String[] paths = path.split(\",\");\n             path = paths[paths.length - 1].substring(FILE_PREFIX.length());\n         }\n+        if (!path.endsWith(\"/\")) {\n+            path += \"/\";\n+        }\n         try {\n-            inputStream = new FileInputStream(new File(path + \"application.properties\"));\n+            InputStream inputStream = new FileInputStream(new File(path + \"application.properties\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAwMzUyMg=="}, "originalCommit": {"oid": "e366e3391c436c1660d9ce53c1a8707b015fec51"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTUzOTg3OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzoyMzo1NlrOH2LQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzoyMzo1NlrOH2LQSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU2OTU0Nw==", "bodyText": "use Paths.get(...)", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526569547", "createdAt": "2020-11-19T03:23:56Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -363,15 +363,15 @@ public static String getMemberList() {\n     public static Resource getApplicationConfFileResource() {\n         Resource customResource = getCustomFileResource();\n         if (customResource == null) {\n-            return getDefaultFileResource();\n+            return getDefaultResource();\n         }\n         return customResource;\n     }\n     \n     private static Resource getCustomFileResource() {\n         String path = getProperty(\"spring.config.location\");\n         if (path == null) {\n-            return null;\n+            path = EnvUtil.getNacosHome() + \"/conf\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a734f20396cda39d4697bc1a93987947c7d428d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjMxNTA3OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0NDo0NlrOH2SS_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0NDo0NlrOH2SS_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NDkyNQ==", "bodyText": "\u8fd9\u4e2aif (customPath == null)\u53ef\u4ee5\u53bb\u6389\uff0c\u56e0\u4e3a\u65b9\u6cd5\u7ed3\u675f\u4f1areturn getRelativePathResource(Paths.get(EnvUtil.getNacosHome(), \"conf\"));", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r526684925", "createdAt": "2020-11-19T08:44:46Z", "author": {"login": "Maijh97"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +362,38 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n-        String path = getProperty(\"spring.config.location\");\n-        InputStream inputStream = null;\n-        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {\n-            String[] paths = path.split(\",\");\n-            path = paths[paths.length - 1].substring(FILE_PREFIX.length());\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {\n+            return getDefaultResource();\n         }\n+        return customResource;\n+    }\n+    \n+    private static Resource getCustomFileResource() {\n+        String customPath = getProperty(\"spring.config.location\");\n+        if (customPath == null) {\n+            return getRelativePathResource(Paths.get(EnvUtil.getNacosHome(), \"conf\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d578a44a2178c660acbcbe31a82661ce509ebe28"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNjYyMTk2OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMzowOTowOFrOH270xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTo1MDo1OVrOH2_zmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2NTMxOA==", "bodyText": "StringUtils.contains() \u6709\u8fd9\u79cd\u65b9\u6cd5\u5417\uff1f", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r527365318", "createdAt": "2020-11-20T03:09:08Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -370,21 +369,18 @@ public static Resource getApplicationConfFileResource() {\n     }\n     \n     private static Resource getCustomFileResource() {\n-        String customPath = getProperty(\"spring.config.location\");\n-        \n-        if (StringUtils.isNotBlank(customPath) && customPath.contains(FILE_PREFIX)) {\n-            String[] paths = customPath.split(\",\");\n-            customPath = paths[paths.length - 1].substring(FILE_PREFIX.length());\n-            Path parentPath = Paths.get(customPath);\n-            return getRelativePathResource(parentPath);\n+        String path = getProperty(\"spring.config.location\");\n+        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM5ODIwOQ==", "bodyText": "\u73b0\u5728\u6709\u4e2acontainsIgnoreCase. \u53ef\u4ee5\u7528\u8fd9\u4e2a\u66ff\u6362", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r527398209", "createdAt": "2020-11-20T04:59:33Z", "author": {"login": "horizonzy"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -370,21 +369,18 @@ public static Resource getApplicationConfFileResource() {\n     }\n     \n     private static Resource getCustomFileResource() {\n-        String customPath = getProperty(\"spring.config.location\");\n-        \n-        if (StringUtils.isNotBlank(customPath) && customPath.contains(FILE_PREFIX)) {\n-            String[] paths = customPath.split(\",\");\n-            customPath = paths[paths.length - 1].substring(FILE_PREFIX.length());\n-            Path parentPath = Paths.get(customPath);\n-            return getRelativePathResource(parentPath);\n+        String path = getProperty(\"spring.config.location\");\n+        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2NTMxOA=="}, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQwODUwMg==", "bodyText": "\u8def\u5f84\u4e0d\u80fdIgnoreCase", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r527408502", "createdAt": "2020-11-20T05:26:37Z", "author": {"login": "chuntaojun"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -370,21 +369,18 @@ public static Resource getApplicationConfFileResource() {\n     }\n     \n     private static Resource getCustomFileResource() {\n-        String customPath = getProperty(\"spring.config.location\");\n-        \n-        if (StringUtils.isNotBlank(customPath) && customPath.contains(FILE_PREFIX)) {\n-            String[] paths = customPath.split(\",\");\n-            customPath = paths[paths.length - 1].substring(FILE_PREFIX.length());\n-            Path parentPath = Paths.get(customPath);\n-            return getRelativePathResource(parentPath);\n+        String path = getProperty(\"spring.config.location\");\n+        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2NTMxOA=="}, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQzMDU1Mg==", "bodyText": "\u8fd9\u4e2a\u53ea\u662f\u5224\u65adfile:, \u8fd9\u4e2a\u5927\u5c0f\u5199\u5ffd\u7565ok\u7684", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r527430552", "createdAt": "2020-11-20T05:50:59Z", "author": {"login": "horizonzy"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -370,21 +369,18 @@ public static Resource getApplicationConfFileResource() {\n     }\n     \n     private static Resource getCustomFileResource() {\n-        String customPath = getProperty(\"spring.config.location\");\n-        \n-        if (StringUtils.isNotBlank(customPath) && customPath.contains(FILE_PREFIX)) {\n-            String[] paths = customPath.split(\",\");\n-            customPath = paths[paths.length - 1].substring(FILE_PREFIX.length());\n-            Path parentPath = Paths.get(customPath);\n-            return getRelativePathResource(parentPath);\n+        String path = getProperty(\"spring.config.location\");\n+        if (StringUtils.isNotBlank(path) && path.contains(FILE_PREFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2NTMxOA=="}, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMzk5OTA5OnYy", "diffSide": "RIGHT", "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowMVrOH39iiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMjowMTowMVrOH39iiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ0MTk5NQ==", "bodyText": "Simply to null == customResource ? return getDefaultResource() : customResource", "url": "https://github.com/alibaba/nacos/pull/4259#discussion_r528441995", "createdAt": "2020-11-23T02:01:01Z", "author": {"login": "KomachiSion"}, "path": "sys/src/main/java/com/alibaba/nacos/sys/env/EnvUtil.java", "diffHunk": "@@ -361,19 +361,34 @@ public static String getMemberList() {\n     private static final String FILE_PREFIX = \"file:\";\n     \n     public static Resource getApplicationConfFileResource() {\n+        Resource customResource = getCustomFileResource();\n+        if (customResource == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c61bdc5b65d320d2ee0b8ff18325eaf37e1d293b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4260, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}