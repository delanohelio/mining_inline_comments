{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MTM4NzY0", "number": 4167, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjoxMVrOE2k4ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjo1NFrOE2k46A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjYyODU4OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjoxMVrOHvcV7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMzoxNDowMFrOHvdrqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTQ4NA==", "bodyText": "I think the old implementation is better for readablilty", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519509484", "createdAt": "2020-11-09T01:26:11Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -250,13 +250,12 @@ private static void addSubscriber(final Subscriber consumer, Class<? extends Eve\n     private static boolean removeSubscriber(final Subscriber consumer, Class<? extends Event> subscribeType) {\n         \n         final String topic = ClassUtils.getCanonicalName(subscribeType);\n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            publisher.removeSubscriber(consumer);\n-            return true;\n+        EventPublisher eventPublisher = INSTANCE.publisherMap.get(topic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUyMTEzNQ==", "bodyText": "I think containsKey() and get() is duplicated. get() can cover containsKey(); Maybe should judge eventPublish != null?", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519521135", "createdAt": "2020-11-09T02:26:14Z", "author": {"login": "horizonzy"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -250,13 +250,12 @@ private static void addSubscriber(final Subscriber consumer, Class<? extends Eve\n     private static boolean removeSubscriber(final Subscriber consumer, Class<? extends Event> subscribeType) {\n         \n         final String topic = ClassUtils.getCanonicalName(subscribeType);\n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            publisher.removeSubscriber(consumer);\n-            return true;\n+        EventPublisher eventPublisher = INSTANCE.publisherMap.get(topic);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTQ4NA=="}, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUzMTQzNA==", "bodyText": "OK", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519531434", "createdAt": "2020-11-09T03:14:00Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -250,13 +250,12 @@ private static void addSubscriber(final Subscriber consumer, Class<? extends Eve\n     private static boolean removeSubscriber(final Subscriber consumer, Class<? extends Event> subscribeType) {\n         \n         final String topic = ClassUtils.getCanonicalName(subscribeType);\n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            publisher.removeSubscriber(consumer);\n-            return true;\n+        EventPublisher eventPublisher = INSTANCE.publisherMap.get(topic);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTQ4NA=="}, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NjYyOTUyOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjo1NFrOHvcWcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMToyNjo1NFrOHvcWcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUwOTYxNg==", "bodyText": "Same as above", "url": "https://github.com/alibaba/nacos/pull/4167#discussion_r519509616", "createdAt": "2020-11-09T01:26:54Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/notify/NotifyCenter.java", "diffHunk": "@@ -281,18 +280,19 @@ public static boolean publishEvent(final Event event) {\n      * @param event     event instance.\n      */\n     private static boolean publishEvent(final Class<? extends Event> eventType, final Event event) {\n-        final String topic = ClassUtils.getCanonicalName(eventType);\n         if (ClassUtils.isAssignableFrom(SlowEvent.class, eventType)) {\n             return INSTANCE.sharePublisher.publish(event);\n         }\n         \n-        if (INSTANCE.publisherMap.containsKey(topic)) {\n-            EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n-            return publisher.publish(event);\n+        final String topic = ClassUtils.getCanonicalName(eventType);\n+        \n+        EventPublisher publisher = INSTANCE.publisherMap.get(topic);\n+        if (publisher == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b054879b2e6f802be4ac3faef483f6afd153120f"}, "originalPosition": 116}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4318, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}