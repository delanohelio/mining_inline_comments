{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1ODA5NjAw", "number": 2934, "title": "[#2933] fixed compatibility issues with older versions", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\nfix issue #2933\nBrief changelog\nXX\nVerifying this change\nXXXX\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.", "createdAt": "2020-06-01T07:40:44Z", "url": "https://github.com/alibaba/nacos/pull/2934", "merged": true, "mergeCommit": {"oid": "dc9d1368fe16d50f6b9487451b49cd34d765cefa"}, "closed": true, "closedAt": "2020-06-02T02:55:02Z", "author": {"login": "chuntaojun"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcm7OaqgH2gAyNDI1ODA5NjAwOjZmYjI3NTAwMjE5MzQ2YmFkMGExMTNiZGYzOWJlZTkzNWMxNTRkNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnLfU1AH2gAyNDI1ODA5NjAwOjAxYmIwMmI5NDNjZTc1NDQxZDU3YWI4ZjcyZmUyYmJjYTVlYWQ4Njg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6fb27500219346bad0a113bdf39bee935c154d6e", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/6fb27500219346bad0a113bdf39bee935c154d6e", "committedDate": "2020-06-01T07:35:21Z", "message": "fix: fixed compatibility issues with older versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7556fa7762a889863379cd8ca559813d9670205", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/a7556fa7762a889863379cd8ca559813d9670205", "committedDate": "2020-06-01T08:59:01Z", "message": "fix: fix old version information not available in new version reality issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/31694246058ef6c226cba4bf7d39ad3fc4a65362", "committedDate": "2020-06-01T13:54:29Z", "message": "refactor: optimize old version information synchronization logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjgyNjU1", "url": "https://github.com/alibaba/nacos/pull/2934#pullrequestreview-422282655", "createdAt": "2020-06-02T01:25:24Z", "commit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMToyNToyNVrOGdfHHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMTozMjozMVrOGdfOmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MTYxMw==", "bodyText": "Why  remove constant value\uff1fI think use constant value will be better", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433571613", "createdAt": "2020-06-02T01:25:25Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/utils/ByteUtils.java", "diffHunk": "@@ -17,12 +17,13 @@\n package com.alibaba.nacos.common.utils;\n \n import java.nio.charset.Charset;\n-import java.nio.charset.StandardCharsets;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MTg3Ng==", "bodyText": "like before said, I think use constant value will be better.", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433571876", "createdAt": "2020-06-02T01:26:28Z", "author": {"login": "KomachiSion"}, "path": "common/src/main/java/com/alibaba/nacos/common/utils/StringUtils.java", "diffHunk": "@@ -41,7 +38,7 @@\n     public static final String EMPTY = \"\";\n \n     public static String newString4UTF8(byte[] bytes) {\n-        return new String(bytes, Charset.forName(StandardCharsets.UTF_8.name()));\n+        return new String(bytes, Charset.forName(\"UTF-8\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3Mjc5Nw==", "bodyText": "Move this TODO common to deprecated annotation may be better?", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433572797", "createdAt": "2020-06-02T01:29:49Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/cluster/ServerListManager.java", "diffHunk": "@@ -0,0 +1,233 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.naming.cluster;\n+\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+import com.alibaba.nacos.core.cluster.Member;\n+import com.alibaba.nacos.core.cluster.MemberChangeEvent;\n+import com.alibaba.nacos.core.cluster.MemberChangeListener;\n+import com.alibaba.nacos.core.cluster.MemberMetaDataConstants;\n+import com.alibaba.nacos.core.cluster.NodeState;\n+import com.alibaba.nacos.core.cluster.ServerMemberManager;\n+import com.alibaba.nacos.core.notify.NotifyCenter;\n+import com.alibaba.nacos.core.utils.ApplicationUtils;\n+import com.alibaba.nacos.naming.consistency.persistent.raft.RaftPeer;\n+import com.alibaba.nacos.naming.misc.GlobalExecutor;\n+import com.alibaba.nacos.naming.misc.Loggers;\n+import com.alibaba.nacos.naming.misc.Message;\n+import com.alibaba.nacos.naming.misc.NamingProxy;\n+import com.alibaba.nacos.naming.misc.ServerStatusSynchronizer;\n+import com.alibaba.nacos.naming.misc.SwitchDomain;\n+import com.alibaba.nacos.naming.misc.Synchronizer;\n+import com.alibaba.nacos.naming.misc.UtilsAndCommons;\n+import com.google.common.collect.Maps;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+/**\n+ * The manager to globally refresh and operate server list.\n+ *\n+ * // TODO This object will be deleted sometime after version 1.3.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzUwMg==", "bodyText": "Move this TODO common to deprecated annotation may be better?", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433573502", "createdAt": "2020-06-02T01:32:23Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/OperatorController.java", "diffHunk": "@@ -200,12 +200,37 @@ public ObjectNode getHealthyServerList(@RequestParam(required = false) boolean h\n         return result;\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzUzMQ==", "bodyText": "Move this TODO common to deprecated annotation may be better?", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433573531", "createdAt": "2020-06-02T01:32:31Z", "author": {"login": "KomachiSion"}, "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/OperatorController.java", "diffHunk": "@@ -200,12 +200,37 @@ public ObjectNode getHealthyServerList(@RequestParam(required = false) boolean h\n         return result;\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0\n+     *\n+     * @deprecated 1.3.0\n+     * @param serverStatus server status\n+     * @return \"ok\"\n+     */\n+    @Deprecated\n+    @RequestMapping(\"/server/status\")\n+    public String serverStatus(@RequestParam String serverStatus) {\n+        serverListManager.onReceiveServerStatus(serverStatus);\n+        return \"ok\";\n+    }\n+\n     @PutMapping(\"/log\")\n     public String setLogLevel(@RequestParam String logName, @RequestParam String logLevel) {\n         Loggers.setLogLevel(logName, logLevel);\n         return \"ok\";\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362"}, "originalPosition": 102}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01bb02b943ce75441d57ab8f72fe2bbca5ead868", "author": {"user": {"login": "chuntaojun", "name": "liaochuntao"}}, "url": "https://github.com/alibaba/nacos/commit/01bb02b943ce75441d57ab8f72fe2bbca5ead868", "committedDate": "2020-06-02T02:32:18Z", "message": "refactor: long volume, annotation optimization"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4336, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}