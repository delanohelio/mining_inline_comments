{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzU5OTMy", "number": 3206, "title": "[ISSUE #2856]Adjust the use of thread pools (config module)", "bodyText": "Please do not create a Pull Request without creating an issue first.\nWhat is the purpose of the change\n#2856\nBrief changelog\n\nUnified config module thread pool usage\nUnified cmdb module thread pool usage\n\n\nConsider that SimpleIPFlowData and SimpleIPFlowData are not spring beans and are not used. Not moved to ConfigExecutor class management\n\nVerifying this change\nXXXX\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.", "createdAt": "2020-06-30T03:26:59Z", "url": "https://github.com/alibaba/nacos/pull/3206", "merged": true, "mergeCommit": {"oid": "891c1f3ba57f667ab8689fe390f6e41112a0f5c3"}, "closed": true, "closedAt": "2020-07-13T09:33:26Z", "author": {"login": "wangweizZZ"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcz4bEOAH2gAyNDQxNzU5OTMyOjk0ZjZjNjFjY2RjY2QwODY2YWJjNzI0Y2E0Zjg2MThhYTFiOGYxMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0eEu-AFqTQ0NzA4NjU1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "committedDate": "2020-07-11T13:40:28Z", "message": "[ISSUE #2856]Adjust the use of thread pools (config\u3001cmdb module)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2754ef6e166dd998db725774b8f73266f3d40d81", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/2754ef6e166dd998db725774b8f73266f3d40d81", "committedDate": "2020-06-30T03:12:17Z", "message": "[ISSUE #2856]Adjust the use of thread pools (config module)\n\nChange-Id: I65c3bb4c13b7024decb8ee1465ead236876cb487"}, "afterCommit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "committedDate": "2020-07-11T13:40:28Z", "message": "[ISSUE #2856]Adjust the use of thread pools (config\u3001cmdb module)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2OTU0MjY1", "url": "https://github.com/alibaba/nacos/pull/3206#pullrequestreview-446954265", "createdAt": "2020-07-13T03:02:56Z", "commit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwMzowMjo1NlrOGwZ_Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwMzozMToyMFrOGwaWlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxMDYxMA==", "bodyText": "Should we create a new class CmdbExecutors like naming and config? Don't put them into UtilsAndCommons", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453410610", "createdAt": "2020-07-13T03:02:56Z", "author": {"login": "KomachiSion"}, "path": "cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java", "diffHunk": "@@ -117,11 +117,9 @@ public void init() throws NacosException {\n         initCmdbService();\n         load();\n         \n-        UtilsAndCommons.GLOBAL_EXECUTOR.schedule(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.GLOBAL_EXECUTOR\n-                .schedule(new CmdbLabelTask(), switches.getLabelTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.GLOBAL_EXECUTOR\n-                .schedule(new CmdbEventTask(), switches.getEventTaskInterval(), TimeUnit.SECONDS);\n+        UtilsAndCommons.scheduleCmdbTask(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxMDg1Mw==", "bodyText": "Why remove public?", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453410853", "createdAt": "2020-07-13T03:04:02Z", "author": {"login": "KomachiSion"}, "path": "config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java", "diffHunk": "@@ -30,17 +30,17 @@\n  * @author Nacos\n  */\n @Service\n-public class MemoryMonitor {\n+class MemoryMonitor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxNjU5OA==", "bodyText": "The thread pool factory are different between original and here.", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453416598", "createdAt": "2020-07-13T03:31:20Z", "author": {"login": "KomachiSion"}, "path": "config/src/main/java/com/alibaba/nacos/config/server/utils/ConfigExecutor.java", "diffHunk": "@@ -31,20 +35,68 @@\n  */\n public final class ConfigExecutor {\n     \n-    private static final Executor DUMP_EXECUTOR = ExecutorFactory\n-            .newFixedExecutorService(Config.class.getCanonicalName(), 1,\n-                    new NameThreadFactory(\"nacos.config.embedded.dump\"));\n+    private static final Executor DUMP_EXECUTOR = ExecutorFactory.Managed\n+            .newSingleExecutorService(ClassUtils.getCanonicalName(Config.class),\n+                    new NameThreadFactory(\"com.alibaba.nacos.config.embedded.dump\"));\n     \n-    private static final ScheduledExecutorService TIMER_EXECUTOR = ExecutorFactory\n-            .newScheduledExecutorService(Config.class.getCanonicalName(), 10,\n-                    new NameThreadFactory(\"com.alibaba.nacos.server.Timer\"));\n+    private static final ScheduledExecutorService TIMER_EXECUTOR = ExecutorFactory.Managed\n+            .newScheduledExecutorService(ClassUtils.getCanonicalName(Config.class), 10,\n+                    new NameThreadFactory(\"com.alibaba.nacos.config.server.timer\"));\n     \n-    public static void scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit) {\n+    private static final ScheduledExecutorService CAPACITY_MANAGEMENT_EXECUTOR = ExecutorFactory.Managed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/eb86f4e7131dfa78781794e4767ef2197f129a2a", "committedDate": "2020-07-13T08:21:31Z", "message": "add CmdbExecutor class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41cf64c02e235d43270bc1be328568219f2b0102", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/41cf64c02e235d43270bc1be328568219f2b0102", "committedDate": "2020-07-13T06:33:01Z", "message": "add CmdbExecutor class"}, "afterCommit": {"oid": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "author": {"user": {"login": "wangweizZZ", "name": "Gagharv"}}, "url": "https://github.com/alibaba/nacos/commit/eb86f4e7131dfa78781794e4767ef2197f129a2a", "committedDate": "2020-07-13T08:21:31Z", "message": "add CmdbExecutor class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDg2NTU5", "url": "https://github.com/alibaba/nacos/pull/3206#pullrequestreview-447086559", "createdAt": "2020-07-13T09:32:28Z", "commit": {"oid": "eb86f4e7131dfa78781794e4767ef2197f129a2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4403, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}