{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDQ5MTY0", "number": 3242, "title": "bugfix: fix batch sql getTableMeta error", "bodyText": "Signed-off-by: slievrly slievrly@163.com\n\n\u2160. Describe what this PR did\nbugfix: fix batch sql getTableMeta error\n\u2161. Does this pull request fix one issue?\nfix #3244\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-10-29T17:41:15Z", "url": "https://github.com/seata/seata/pull/3242", "merged": true, "mergeCommit": {"oid": "49f1b5d8e6d739a40417896a13774135b94f09d8"}, "closed": true, "closedAt": "2020-10-30T03:12:27Z", "author": {"login": "slievrly"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXVxaIAH2gAyNTEyNDQ5MTY0OmQwYWFhM2U2ZjBiYTBmN2Y4NmRhODZiYjI0NjY0MTgxMjQ5NTA2Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXd9s0AFqTUyMDM1MDI1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0aaa3e6f0ba0f7f86da86bb2466418124950677", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/d0aaa3e6f0ba0f7f86da86bb2466418124950677", "committedDate": "2020-10-29T17:39:28Z", "message": "bugfix: fix batch sql getTableMeta error\n\nSigned-off-by: slievrly <slievrly@163.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzE0MDk3", "url": "https://github.com/seata/seata/pull/3242#pullrequestreview-520314097", "createdAt": "2020-10-30T01:25:33Z", "commit": {"oid": "d0aaa3e6f0ba0f7f86da86bb2466418124950677"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMToyNTozNFrOHq0paw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMToyNTozNFrOHq0paw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY2NDgxMQ==", "bodyText": "Look like new HashMap that s enough.", "url": "https://github.com/seata/seata/pull/3242#discussion_r514664811", "createdAt": "2020-10-30T01:25:34Z", "author": {"login": "l81893521"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java", "diffHunk": "@@ -98,6 +105,28 @@ protected T executeAutoCommitFalse(Object[] args) throws Exception {\n         return result;\n     }\n \n+    private boolean isMultiPk() {\n+        if (null != sqlRecognizer) {\n+            return getTableMeta().getPrimaryKeyOnlyName().size() > 1;\n+        }\n+        if (CollectionUtils.isNotEmpty(sqlRecognizers)) {\n+            List<SQLRecognizer> distinctSQLRecognizer = sqlRecognizers.stream().filter(\n+                distinctByKey(t -> t.getTableName())).collect(Collectors.toList());\n+            for (SQLRecognizer sqlRecognizer : distinctSQLRecognizer) {\n+                if (getTableMeta(sqlRecognizer.getTableName()).getPrimaryKeyOnlyName().size() > 1) {\n+                    return true;\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private static <T> Predicate<T> distinctByKey(Function<? super T, ?> keyExtractor) {\n+        Map<Object, Boolean> seen = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0aaa3e6f0ba0f7f86da86bb2466418124950677"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23afa70677a03c3c3a1ac1755e9af1b71c5e2ecd", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/23afa70677a03c3c3a1ac1755e9af1b71c5e2ecd", "committedDate": "2020-10-30T02:42:55Z", "message": "fix review\n\nSigned-off-by: slievrly <slievrly@163.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzQ3NzQ3", "url": "https://github.com/seata/seata/pull/3242#pullrequestreview-520347747", "createdAt": "2020-10-30T03:02:54Z", "commit": {"oid": "23afa70677a03c3c3a1ac1755e9af1b71c5e2ecd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzQ5MDky", "url": "https://github.com/seata/seata/pull/3242#pullrequestreview-520349092", "createdAt": "2020-10-30T03:07:41Z", "commit": {"oid": "23afa70677a03c3c3a1ac1755e9af1b71c5e2ecd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzUwMjU3", "url": "https://github.com/seata/seata/pull/3242#pullrequestreview-520350257", "createdAt": "2020-10-30T03:12:08Z", "commit": {"oid": "23afa70677a03c3c3a1ac1755e9af1b71c5e2ecd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3480, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}