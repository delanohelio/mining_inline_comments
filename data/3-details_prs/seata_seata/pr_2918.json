{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MDE3NTE4", "number": 2918, "title": "bugfix: fix the isolation problem when rollback in AT mode", "bodyText": "\u2160. Describe what this PR did\n\u6267\u884c\u56de\u6eda\u9636\u6bb5\u68c0\u67e5\u6570\u636e\u662f\u5426\u88ab\u5176\u4ed6\u7a0b\u5e8f\u4fee\u6539\u8fc7\u65f6\uff0c\u4e3a\u67e5\u8be2\u6570\u636esql\u6dfb\u52a0\u6392\u4ed6\u9501\u3002\u9632\u6b62\u6570\u636e\u88ab\u67e5\u8be2\u51fa\u6765\u4e4b\u540e\uff0c\u6267\u884cundosql\u4e4b\u524d\u518d\u88ab\u5176\u4ed6\u7a0b\u5e8f\u4fee\u6539\u65f6\u53ef\u80fd\u5bfc\u81f4\u810f\u6570\u636e\u7684\u95ee\u9898\u3002\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-07-22T10:10:38Z", "url": "https://github.com/seata/seata/pull/2918", "merged": true, "mergeCommit": {"oid": "d1e6355d022e269ecfa2324a792fe5ebfeb264c7"}, "closed": true, "closedAt": "2020-08-04T11:10:13Z", "author": {"login": "yangxb2010000"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3X2RogH2gAyNDU1MDE3NTE4OjAwMzQxOWM1NWJjODIzZGMyMDQ2ZjBkNmQ1YzliZjNjNzYwYWY1ZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7kpEJgFqTQ2MDcxNDQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "003419c55bc823dc2046f0d6d5c9bf3c760af5f0", "author": {"user": {"login": "yangxb2010000", "name": null}}, "url": "https://github.com/seata/seata/commit/003419c55bc823dc2046f0d6d5c9bf3c760af5f0", "committedDate": "2020-07-22T09:59:01Z", "message": "Merge pull request #1 from seata/develop\n\nmerge from seata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af309e00508d238f7aba4954b23ba92a16a166ab", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/af309e00508d238f7aba4954b23ba92a16a166ab", "committedDate": "2020-07-22T10:07:22Z", "message": "\u6267\u884c\u56de\u6eda\u9636\u6bb5\u68c0\u67e5\u6570\u636e\u662f\u5426\u88ab\u5176\u4ed6\u7a0b\u5e8f\u4fee\u6539\u8fc7\u65f6\uff0c\u67e5\u8be2\u6570\u636esql\u6dfb\u52a0\u6392\u4ed6\u9501\u3002\u9632\u6b62\u6570\u636e\u88ab\u67e5\u8be2\u51fa\u6765\u4e4b\u540e\uff0c\u6267\u884cundosql\u4e4b\u524d\u518d\u88ab\u5176\u4ed6\u7a0b\u5e8f\u4fee\u6539\u65f6\u53ef\u80fd\u5bfc\u81f4\u810f\u6570\u636e\u7684\u95ee\u9898\u3002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTgxNjMz", "url": "https://github.com/seata/seata/pull/2918#pullrequestreview-453181633", "createdAt": "2020-07-22T10:13:33Z", "commit": {"oid": "af309e00508d238f7aba4954b23ba92a16a166ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMDoxMzozNFrOG1b_4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMDoxMzozNFrOG1b_4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY4NjQzNA==", "bodyText": "for update It should be at the end of the statement", "url": "https://github.com/seata/seata/pull/2918#discussion_r458686434", "createdAt": "2020-07-22T10:13:34Z", "author": {"login": "a364176773"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoExecutor.java", "diffHunk": "@@ -68,7 +68,7 @@\n      * template of check sql\n      * TODO support multiple primary key\n      */\n-    private static final String CHECK_SQL_TEMPLATE = \"SELECT * FROM %s WHERE %s\";\n+    private static final String CHECK_SQL_TEMPLATE = \"SELECT * FROM %s FOR UPDATE WHERE %s\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af309e00508d238f7aba4954b23ba92a16a166ab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c7a483ae694be474e39ad3783634b6be01bb67", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/46c7a483ae694be474e39ad3783634b6be01bb67", "committedDate": "2020-07-22T10:14:01Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f2062042a03065de4860ff07f5befafbe677822", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/0f2062042a03065de4860ff07f5befafbe677822", "committedDate": "2020-07-22T10:19:01Z", "message": "for update\u79fb\u52a8\u5230sql\u8bed\u53e5\u7684\u6700\u540e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdcbcf6293b565e85f051aa323370c74085f4127", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/bdcbcf6293b565e85f051aa323370c74085f4127", "committedDate": "2020-07-22T10:19:20Z", "message": "Merge branch 'develop' of https://github.com/yangxb2010000/seata into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe41b05ea473edf9ad774ccac31670cb139fd3b", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/8fe41b05ea473edf9ad774ccac31670cb139fd3b", "committedDate": "2020-07-23T01:43:34Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODI5NDQy", "url": "https://github.com/seata/seata/pull/2918#pullrequestreview-453829442", "createdAt": "2020-07-23T04:29:52Z", "commit": {"oid": "8fe41b05ea473edf9ad774ccac31670cb139fd3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNDoyOTo1MlrOG174Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNDoyOTo1MlrOG174Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwODczMA==", "bodyText": "If it fails, how do release the X lock?", "url": "https://github.com/seata/seata/pull/2918#discussion_r459208730", "createdAt": "2020-07-23T04:29:52Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/AbstractUndoExecutor.java", "diffHunk": "@@ -68,7 +68,7 @@\n      * template of check sql\n      * TODO support multiple primary key\n      */\n-    private static final String CHECK_SQL_TEMPLATE = \"SELECT * FROM %s WHERE %s\";\n+    private static final String CHECK_SQL_TEMPLATE = \"SELECT * FROM %s WHERE %s FOR UPDATE\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe41b05ea473edf9ad774ccac31670cb139fd3b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f46f2e8722fe45b8aab6fedcfb69de9b4fa6aa5c", "author": {"user": {"login": "yangxb2010000", "name": null}}, "url": "https://github.com/seata/seata/commit/f46f2e8722fe45b8aab6fedcfb69de9b4fa6aa5c", "committedDate": "2020-07-26T10:11:33Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da84d0470f1968ab234c34b86e49d5e97bae7856", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/da84d0470f1968ab234c34b86e49d5e97bae7856", "committedDate": "2020-08-04T03:57:07Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDgxMjYx", "url": "https://github.com/seata/seata/pull/2918#pullrequestreview-460481261", "createdAt": "2020-08-04T04:05:19Z", "commit": {"oid": "da84d0470f1968ab234c34b86e49d5e97bae7856"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b92465fe1896e9477772cbffbf28d6de62ff0c4d", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/b92465fe1896e9477772cbffbf28d6de62ff0c4d", "committedDate": "2020-08-04T10:54:27Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzE0NDg4", "url": "https://github.com/seata/seata/pull/2918#pullrequestreview-460714488", "createdAt": "2020-08-04T11:09:03Z", "commit": {"oid": "b92465fe1896e9477772cbffbf28d6de62ff0c4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3830, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}