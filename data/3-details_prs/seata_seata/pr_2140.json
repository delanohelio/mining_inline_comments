{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MzU2ODEx", "number": 2140, "title": "optimize: GzipUtil code style", "bodyText": "\u2160. Describe what this PR did\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-01-06T01:13:21Z", "url": "https://github.com/seata/seata/pull/2140", "merged": true, "mergeCommit": {"oid": "16d7030b93d84c04ae1f2e1b0a900e8891d0caf1"}, "closed": true, "closedAt": "2020-01-21T08:02:09Z", "author": {"login": "InstallingB"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3hod_AH2gAyMzU5MzU2ODExOjcwYjI1YmExOGJmZDkwNWNkYTZiYWVhOTEwYTczNGQ5YzM2YTg0YzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8cfNcgFqTM0NTY4ODAyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70b25ba18bfd905cda6baea910a734d9c36a84c4", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/70b25ba18bfd905cda6baea910a734d9c36a84c4", "committedDate": "2020-01-06T01:11:50Z", "message": "optimize: GzipUtil code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b36dff704ef585b5ae0bfac55ba55db93dd33a9", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/5b36dff704ef585b5ae0bfac55ba55db93dd33a9", "committedDate": "2020-01-06T01:14:21Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbfc69f5e0fa99cc7d5a99e6634b77eacc1ee419", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/fbfc69f5e0fa99cc7d5a99e6634b77eacc1ee419", "committedDate": "2020-01-06T10:28:29Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88960dfd5ef4230c005f68ea814212ccaa3b275d", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/88960dfd5ef4230c005f68ea814212ccaa3b275d", "committedDate": "2020-01-06T13:27:30Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4ce446a5182ad07d82e433d9672d70bcf089829", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/f4ce446a5182ad07d82e433d9672d70bcf089829", "committedDate": "2020-01-06T14:52:00Z", "message": "fix: unit test GzipCompressorTest#testCompressAndDecompress gzip decompress error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/496dc747ca5201e886650bab7a1ceff37e27e146", "committedDate": "2020-01-06T14:52:17Z", "message": "Merge remote-tracking branch 'origin/patch-11' into patch-11"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDU5MDk1", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-339059095", "createdAt": "2020-01-07T07:00:03Z", "commit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzowMDowNFrOFaxNPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzowMDowNFrOFaxNPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMzUwMA==", "bodyText": "The close method of GZIPOutputStream should be called.And the close method of ByteArrayOutputStream actually does nothing.", "url": "https://github.com/seata/seata/pull/2140#discussion_r363613500", "createdAt": "2020-01-07T07:00:04Z", "author": {"login": "xingfudeshi"}, "path": "compressor/seata-compressor-gzip/src/main/java/io/seata/compressor/gzip/GzipUtil.java", "diffHunk": "@@ -28,48 +26,43 @@\n  */\n public class GzipUtil {\n \n+    private GzipUtil() {\n+\n+    }\n+\n     private static final int BUFFER_SIZE = 8192;\n \n     public static byte[] compress(byte[] bytes) {\n         if (bytes == null) {\n             throw new NullPointerException(\"bytes is null\");\n         }\n-        ByteArrayOutputStream out = null;\n-        GZIPOutputStream gzip = null;\n-        try {\n-            out = new ByteArrayOutputStream();\n-            gzip = new GZIPOutputStream(out);\n+\n+        try (ByteArrayOutputStream out = new ByteArrayOutputStream();\n+             GZIPOutputStream gzip = new GZIPOutputStream(out)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDU5NDY2", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-339059466", "createdAt": "2020-01-07T07:01:16Z", "commit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzowMToxNlrOFaxOZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzowMToxNlrOFaxOZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMzc5OQ==", "bodyText": "The close method of GZIPInputStream should be called.", "url": "https://github.com/seata/seata/pull/2140#discussion_r363613799", "createdAt": "2020-01-07T07:01:16Z", "author": {"login": "xingfudeshi"}, "path": "compressor/seata-compressor-gzip/src/main/java/io/seata/compressor/gzip/GzipUtil.java", "diffHunk": "@@ -28,48 +26,43 @@\n  */\n public class GzipUtil {\n \n+    private GzipUtil() {\n+\n+    }\n+\n     private static final int BUFFER_SIZE = 8192;\n \n     public static byte[] compress(byte[] bytes) {\n         if (bytes == null) {\n             throw new NullPointerException(\"bytes is null\");\n         }\n-        ByteArrayOutputStream out = null;\n-        GZIPOutputStream gzip = null;\n-        try {\n-            out = new ByteArrayOutputStream();\n-            gzip = new GZIPOutputStream(out);\n+\n+        try (ByteArrayOutputStream out = new ByteArrayOutputStream();\n+             GZIPOutputStream gzip = new GZIPOutputStream(out)) {\n             gzip.write(bytes);\n-            gzip.close();\n+            gzip.flush();\n+            gzip.finish();\n             return out.toByteArray();\n         } catch (IOException e) {\n             throw new RuntimeException(\"gzip compress error\", e);\n-        } finally {\n-            IOUtil.close(out);\n         }\n-\n     }\n \n     public static byte[] decompress(byte[] bytes) {\n         if (bytes == null) {\n             throw new NullPointerException(\"bytes is null\");\n         }\n-        ByteArrayOutputStream out = null;\n-        GZIPInputStream gunzip = null;\n-        try {\n-            out = new ByteArrayOutputStream();\n-            gunzip = new GZIPInputStream(new ByteArrayInputStream(bytes));\n+\n+        try (ByteArrayOutputStream out = new ByteArrayOutputStream();\n+             GZIPInputStream gunzip = new GZIPInputStream(new ByteArrayInputStream(bytes))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDU5NjA4", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-339059608", "createdAt": "2020-01-07T07:01:46Z", "commit": {"oid": "496dc747ca5201e886650bab7a1ceff37e27e146"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90debd1d03c0d1d3f5840b149def9edc34f901aa", "author": {"user": {"login": "lovepoem", "name": "Xin Wang"}}, "url": "https://github.com/seata/seata/commit/90debd1d03c0d1d3f5840b149def9edc34f901aa", "committedDate": "2020-01-10T06:34:19Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f9085b826fb5d14dc870e6b67e052002ed375ce", "author": {"user": {"login": "xingfudeshi", "name": "xingfudeshi"}}, "url": "https://github.com/seata/seata/commit/3f9085b826fb5d14dc870e6b67e052002ed375ce", "committedDate": "2020-01-11T03:41:14Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53f24c3ed79dafcb8cba5272a431af2118deeee0", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/53f24c3ed79dafcb8cba5272a431af2118deeee0", "committedDate": "2020-01-11T13:55:25Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e69714212fb3f3de70f019fea26900598f34354", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/3e69714212fb3f3de70f019fea26900598f34354", "committedDate": "2020-01-11T13:57:45Z", "message": "optimize resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f02dc10e16b11839d6c7fda93ac0c2f3f341d6a8", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/f02dc10e16b11839d6c7fda93ac0c2f3f341d6a8", "committedDate": "2020-01-11T13:58:24Z", "message": "Merge remote-tracking branch 'origin/patch-11' into patch-11"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTI0MTc3", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-341524177", "createdAt": "2020-01-11T14:08:24Z", "commit": {"oid": "f02dc10e16b11839d6c7fda93ac0c2f3f341d6a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMzkwMDEz", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-342390013", "createdAt": "2020-01-14T09:28:05Z", "commit": {"oid": "f02dc10e16b11839d6c7fda93ac0c2f3f341d6a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToyODowNVrOFdQ4dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToyODowNVrOFdQ4dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyOTYyMg==", "bodyText": "Is it necessary here? close will call the finish method.", "url": "https://github.com/seata/seata/pull/2140#discussion_r366229622", "createdAt": "2020-01-14T09:28:05Z", "author": {"login": "slievrly"}, "path": "compressor/seata-compressor-gzip/src/main/java/io/seata/compressor/gzip/GzipUtil.java", "diffHunk": "@@ -28,48 +26,42 @@\n  */\n public class GzipUtil {\n \n+    private GzipUtil() {\n+\n+    }\n+\n     private static final int BUFFER_SIZE = 8192;\n \n     public static byte[] compress(byte[] bytes) {\n         if (bytes == null) {\n             throw new NullPointerException(\"bytes is null\");\n         }\n-        ByteArrayOutputStream out = null;\n-        GZIPOutputStream gzip = null;\n-        try {\n-            out = new ByteArrayOutputStream();\n-            gzip = new GZIPOutputStream(out);\n+        ByteArrayOutputStream out = new ByteArrayOutputStream();\n+        try (GZIPOutputStream gzip = new GZIPOutputStream(out)) {\n             gzip.write(bytes);\n-            gzip.close();\n+            gzip.flush();\n+            gzip.finish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f02dc10e16b11839d6c7fda93ac0c2f3f341d6a8"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641671c2430834bf7a917bb9b657c0882b5a83da", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/641671c2430834bf7a917bb9b657c0882b5a83da", "committedDate": "2020-01-14T10:50:29Z", "message": "add test_compressEqualDecompress unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5898f54bd6022e88fd6c1fd722d736dd46a22b7c", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/5898f54bd6022e88fd6c1fd722d736dd46a22b7c", "committedDate": "2020-01-14T10:51:46Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a04c9374028ffdb393085c9a484c9b5314b167f1", "author": {"user": {"login": "xingfudeshi", "name": "xingfudeshi"}}, "url": "https://github.com/seata/seata/commit/a04c9374028ffdb393085c9a484c9b5314b167f1", "committedDate": "2020-01-15T03:17:30Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bdeb65589c8724895ce2c3783de5939febb3b12", "author": {"user": {"login": "xingfudeshi", "name": "xingfudeshi"}}, "url": "https://github.com/seata/seata/commit/3bdeb65589c8724895ce2c3783de5939febb3b12", "committedDate": "2020-01-16T01:50:49Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b7b992ac1204863f59943e87672d085dce3b614", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/7b7b992ac1204863f59943e87672d085dce3b614", "committedDate": "2020-01-16T11:50:37Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb252da68b293e0f30f44d212b98fa6d2388fc96", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/bb252da68b293e0f30f44d212b98fa6d2388fc96", "committedDate": "2020-01-17T06:18:17Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68e4438006c8557f00dbc97156d8670e4b978af1", "author": {"user": {"login": "InstallingB", "name": "withthewind"}}, "url": "https://github.com/seata/seata/commit/68e4438006c8557f00dbc97156d8670e4b978af1", "committedDate": "2020-01-20T06:10:49Z", "message": "Merge branch 'develop' into patch-11"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1Njg4MDIx", "url": "https://github.com/seata/seata/pull/2140#pullrequestreview-345688021", "createdAt": "2020-01-21T08:01:49Z", "commit": {"oid": "68e4438006c8557f00dbc97156d8670e4b978af1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4125, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}