{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTYyNDI2", "number": 3303, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToxNjo0M1rOE8mHyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDo1NDowNFrOFI6AYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTc0NjAyOnYy", "diffSide": "RIGHT", "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToxNjo0M1rOH4zttA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToyNDoyOVrOH40TGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMyOTU4OA==", "bodyText": "should it be kept configService.removeConfig(dataId, getNacosGroup());\uff1f", "url": "https://github.com/seata/seata/pull/3303#discussion_r529329588", "createdAt": "2020-11-24T09:16:43Z", "author": {"login": "a364176773"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -129,7 +143,8 @@ public boolean putConfigIfAbsent(String dataId, String content, long timeoutMill\n     public boolean removeConfig(String dataId, long timeoutMills) {\n         boolean result = false;\n         try {\n-            result = configService.removeConfig(dataId, getNacosGroup());\n+            seataConfig.remove(dataId);\n+            result = configService.publishConfig(getNacosDataId(), getNacosGroup(), getSeataConfigStr());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzOTE2Mg==", "bodyText": "\u6211\u8c03\u7684\u4e0d\u662fremove\u65b9\u6cd5\uff0c\u662fpublishConfig\u65b9\u6cd5\uff0c\u662f\u628a\u5220\u9664\u7684\u914d\u7f6e\u540c\u6b65\u5230nacos\u4e0a\uff0c\u540e\u9762\u7684getSeataConfigStr()\u662f\u83b7\u53d6\u6240\u6709\u914d\u7f6e\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\u3002", "url": "https://github.com/seata/seata/pull/3303#discussion_r529339162", "createdAt": "2020-11-24T09:24:29Z", "author": {"login": "Rubbernecker"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -129,7 +143,8 @@ public boolean putConfigIfAbsent(String dataId, String content, long timeoutMill\n     public boolean removeConfig(String dataId, long timeoutMills) {\n         boolean result = false;\n         try {\n-            result = configService.removeConfig(dataId, getNacosGroup());\n+            seataConfig.remove(dataId);\n+            result = configService.publishConfig(getNacosDataId(), getNacosGroup(), getSeataConfigStr());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMyOTU4OA=="}, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTc0ODEzOnYy", "diffSide": "RIGHT", "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToxNzowMFrOH4zvFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToyNDozOFrOH40T4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMyOTk0Mg==", "bodyText": "should it be kept configService.publishConfig(dataId, getNacosGroup(), content);\uff1f", "url": "https://github.com/seata/seata/pull/3303#discussion_r529329942", "createdAt": "2020-11-24T09:17:00Z", "author": {"login": "a364176773"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -101,19 +108,26 @@ public String getLatestConfig(String dataId, String defaultValue, long timeoutMi\n         if (value != null) {\n             return value;\n         }\n-        try {\n-            value = configService.getConfig(dataId, getNacosGroup(), timeoutMills);\n-        } catch (NacosException exx) {\n-            LOGGER.error(exx.getErrMsg());\n+\n+        value = seataConfig.getProperty(dataId);\n+\n+        if (null == value) {\n+            try {\n+                value = configService.getConfig(dataId, getNacosGroup(), timeoutMills);\n+            } catch (NacosException exx) {\n+                LOGGER.error(exx.getErrMsg());\n+            }\n         }\n+\n         return value == null ? defaultValue : value;\n     }\n \n     @Override\n     public boolean putConfig(String dataId, String content, long timeoutMills) {\n         boolean result = false;\n         try {\n-            result = configService.publishConfig(dataId, getNacosGroup(), content);\n+            seataConfig.setProperty(dataId, content);\n+            result = configService.publishConfig(getNacosDataId(), getNacosGroup(), getSeataConfigStr());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzOTM2Mw==", "bodyText": "\u540c\u4e0a", "url": "https://github.com/seata/seata/pull/3303#discussion_r529339363", "createdAt": "2020-11-24T09:24:38Z", "author": {"login": "Rubbernecker"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -101,19 +108,26 @@ public String getLatestConfig(String dataId, String defaultValue, long timeoutMi\n         if (value != null) {\n             return value;\n         }\n-        try {\n-            value = configService.getConfig(dataId, getNacosGroup(), timeoutMills);\n-        } catch (NacosException exx) {\n-            LOGGER.error(exx.getErrMsg());\n+\n+        value = seataConfig.getProperty(dataId);\n+\n+        if (null == value) {\n+            try {\n+                value = configService.getConfig(dataId, getNacosGroup(), timeoutMills);\n+            } catch (NacosException exx) {\n+                LOGGER.error(exx.getErrMsg());\n+            }\n         }\n+\n         return value == null ? defaultValue : value;\n     }\n \n     @Override\n     public boolean putConfig(String dataId, String content, long timeoutMills) {\n         boolean result = false;\n         try {\n-            result = configService.publishConfig(dataId, getNacosGroup(), content);\n+            seataConfig.setProperty(dataId, content);\n+            result = configService.publishConfig(getNacosDataId(), getNacosGroup(), getSeataConfigStr());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMyOTk0Mg=="}, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTc1NjQzOnYy", "diffSide": "RIGHT", "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToxODoxMFrOH4z0nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMjo0Mjo1NVrOH5hBxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzMTM1Ng==", "bodyText": "It's a singleton", "url": "https://github.com/seata/seata/pull/3303#discussion_r529331356", "createdAt": "2020-11-24T09:18:10Z", "author": {"login": "a364176773"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -63,8 +68,9 @@\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile ConfigService configService;\n     private static final int MAP_INITIAL_CAPACITY = 8;\n-    private ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap\n-        = new ConcurrentHashMap<>(MAP_INITIAL_CAPACITY);\n+    private static ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM0MzUzNA==", "bodyText": "\u8fd9\u662f\u4e3a\u4e86\u8ba9\u4e0b\u9762\u7684\u76d1\u542c\u5668\u7684\u5185\u90e8\u7c7b\u8c03\u7528\uff0c\u4e0d\u7136\u4f20\u503c\u592a\u9ebb\u70e6\u4e86", "url": "https://github.com/seata/seata/pull/3303#discussion_r529343534", "createdAt": "2020-11-24T09:27:50Z", "author": {"login": "Rubbernecker"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -63,8 +68,9 @@\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile ConfigService configService;\n     private static final int MAP_INITIAL_CAPACITY = 8;\n-    private ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap\n-        = new ConcurrentHashMap<>(MAP_INITIAL_CAPACITY);\n+    private static ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzMTM1Ng=="}, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3OTk3OA==", "bodyText": "\u90a3\u5c31static final \u4fee\u9970\u4e00\u4e0b", "url": "https://github.com/seata/seata/pull/3303#discussion_r529479978", "createdAt": "2020-11-24T11:38:22Z", "author": {"login": "a364176773"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -63,8 +68,9 @@\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile ConfigService configService;\n     private static final int MAP_INITIAL_CAPACITY = 8;\n-    private ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap\n-        = new ConcurrentHashMap<>(MAP_INITIAL_CAPACITY);\n+    private static ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzMTM1Ng=="}, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA3MjAwNg==", "bodyText": "\u6539\u597d\u4e86", "url": "https://github.com/seata/seata/pull/3303#discussion_r530072006", "createdAt": "2020-11-25T02:42:55Z", "author": {"login": "Rubbernecker"}, "path": "config/seata-config-nacos/src/main/java/io/seata/config/nacos/NacosConfiguration.java", "diffHunk": "@@ -63,8 +68,9 @@\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile ConfigService configService;\n     private static final int MAP_INITIAL_CAPACITY = 8;\n-    private ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap\n-        = new ConcurrentHashMap<>(MAP_INITIAL_CAPACITY);\n+    private static ConcurrentMap<String, ConcurrentMap<ConfigurationChangeListener, NacosListener>> configListenersMap", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzMTM1Ng=="}, "originalCommit": {"oid": "ca1e1caa9e9529957d6c0ad7f21ec41a6d450e7e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTcyMTIyOnYy", "diffSide": "RIGHT", "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDo1Njo1N1rOH7-28g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTowMTo1M1rOH7_FkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NzkwNg==", "bodyText": "dataId=\"seataServer.properties\"", "url": "https://github.com/seata/seata/pull/3303#discussion_r532657906", "createdAt": "2020-11-30T14:56:57Z", "author": {"login": "a364176773"}, "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "diffHunk": "@@ -31,6 +31,7 @@\n     private String group = \"SEATA_GROUP\";\n     private String username = \"\";\n     private String password = \"\";\n+    private String dataId = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e71b84907a60208272e924eb6e4cc70fa9ea87a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY2MTY0OA==", "bodyText": "\u5df2\u7ecf\u52a0\u5230\u540e\u9762\u63d0\u7684pr\u4e0a\u4e86", "url": "https://github.com/seata/seata/pull/3303#discussion_r532661648", "createdAt": "2020-11-30T15:01:53Z", "author": {"login": "Rubbernecker"}, "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "diffHunk": "@@ -31,6 +31,7 @@\n     private String group = \"SEATA_GROUP\";\n     private String username = \"\";\n     private String password = \"\";\n+    private String dataId = \"\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NzkwNg=="}, "originalCommit": {"oid": "1e71b84907a60208272e924eb6e4cc70fa9ea87a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0ODgzMjk5OnYy", "diffSide": "RIGHT", "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDo1NDowNFrOILFRuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDo1Nzo0OFrOILFVqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ5MTcwNQ==", "bodyText": "Can you keep it same?\nseata.properties\n\nor\nseataServer.properties", "url": "https://github.com/seata/seata/pull/3303#discussion_r548491705", "createdAt": "2020-12-24T10:54:04Z", "author": {"login": "l81893521"}, "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "diffHunk": "@@ -31,6 +31,7 @@\n     private String group = \"SEATA_GROUP\";\n     private String username = \"\";\n     private String password = \"\";\n+    private String dataId = \"seata.properties\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b37003fadc0f7e640f5aa9485f7774ea0d9c0b26"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ5MjcxNQ==", "bodyText": "\u9ed8\u8ba4\u503c\u90fd\u662fseata.properties", "url": "https://github.com/seata/seata/pull/3303#discussion_r548492715", "createdAt": "2020-12-24T10:57:48Z", "author": {"login": "Rubbernecker"}, "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/config/ConfigNacosProperties.java", "diffHunk": "@@ -31,6 +31,7 @@\n     private String group = \"SEATA_GROUP\";\n     private String username = \"\";\n     private String password = \"\";\n+    private String dataId = \"seata.properties\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ5MTcwNQ=="}, "originalCommit": {"oid": "b37003fadc0f7e640f5aa9485f7774ea0d9c0b26"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1349, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}