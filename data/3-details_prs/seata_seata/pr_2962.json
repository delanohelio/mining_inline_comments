{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYxOTE1Njg3", "number": 2962, "title": "optimize: @GlobalTransactional and @GlobalLock can now customize lock retry config", "bodyText": "\u2160. Describe what this PR did\nallow @GlobalTransactional and @GlobalLock to customize lock retry interval and times, which would override the global config.\n\u2161. Does this pull request fix one issue?\nfixes #2943", "createdAt": "2020-08-03T03:08:05Z", "url": "https://github.com/seata/seata/pull/2962", "merged": true, "mergeCommit": {"oid": "6c0c75939dedbf19c4a21a8ac7aa0fb98879a8fd"}, "closed": true, "closedAt": "2020-10-12T10:22:19Z", "author": {"login": "selfishlover"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6RIy8gH2gAyNDYxOTE1Njg3OjEyM2VkNmE1MjNmM2UyODZmNTVlMTgyOTNjNzJmYTY1MmE2OGZjOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdabbZvAFqTUyNTc4MzUwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "123ed6a523f3e286f55e18293c72fa652a68fc98", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/123ed6a523f3e286f55e18293c72fa652a68fc98", "committedDate": "2020-07-31T09:51:41Z", "message": "optimize: @GlobalTransactional and @GlobalLock can now customize lock retry config (#2943)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c6841ba68982dacb3cc84acf2a6816931d17c9", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/72c6841ba68982dacb3cc84acf2a6816931d17c9", "committedDate": "2020-07-31T10:22:45Z", "message": "optimize: @GlobalTransactional and @GlobalLock can now customize lock retry config (#2943)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48fba473e9fb684b0d46f2af38409da4070ee083", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/48fba473e9fb684b0d46f2af38409da4070ee083", "committedDate": "2020-07-31T10:24:04Z", "message": "Merge remote-tracking branch 'origin/develop' into develop\n\n# Conflicts:\n#\tcore/src/main/java/io/seata/core/context/GlobalLockConfigHolder.java\n#\tcore/src/main/java/io/seata/core/model/GlobalLockConfig.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be3b2213dadb8adc77300dcc6851f7d9342f1efe", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/be3b2213dadb8adc77300dcc6851f7d9342f1efe", "committedDate": "2020-08-03T02:31:17Z", "message": "fix: adjust TransactionInfoTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "297f9785236dadf88609636df85827161874efb5", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/297f9785236dadf88609636df85827161874efb5", "committedDate": "2020-08-03T02:35:15Z", "message": "fix: adjust TransactionInfoTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12a43a425027c38d28e12190e1efb09cac05a67b", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/12a43a425027c38d28e12190e1efb09cac05a67b", "committedDate": "2020-08-03T02:44:08Z", "message": "Merge remote-tracking branch 'origin/develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46387e52cbcf9172dd61a68ad47cdfddb7fc1d15", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/46387e52cbcf9172dd61a68ad47cdfddb7fc1d15", "committedDate": "2020-08-03T03:06:04Z", "message": "fix: style check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec", "author": {"user": {"login": "selfishlover", "name": null}}, "url": "https://github.com/seata/seata/commit/0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec", "committedDate": "2020-08-03T03:10:46Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NzU3ODY2", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-459757866", "createdAt": "2020-08-03T05:35:29Z", "commit": {"oid": "0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNTozNToyOVrOG6srVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNTozNToyOVrOG6srVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIwMjU4MQ==", "bodyText": "\u6211\u89c9\u5f97\u52a0\u4e0aelse retryInternal=ConfigurationFactory.getInstance().getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL, DEFAULT_CLIENT_LOCK_RETRY_INTERVAL);\n\u53ef\u4ee5\u5728\u6709\u672c\u5730\u7684\u9501\u91cd\u8bd5\u65f6\uff0c\u65e0\u5e8f\u518d\u53bb\u52a0\u8f7d\u914d\u7f6e\u4e2d\u5fc3\u4e2d\u7684\u914d\u7f6e", "url": "https://github.com/seata/seata/pull/2962#discussion_r464202581", "createdAt": "2020-08-03T05:35:29Z", "author": {"login": "a364176773"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -32,13 +34,31 @@\n     private static int LOCK_RETRY_TIMES =\n         ConfigurationFactory.getInstance().getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);\n \n-    private int lockRetryInternal = LOCK_RETRY_INTERNAL;\n-    private int lockRetryTimes = LOCK_RETRY_TIMES;\n+    private int lockRetryInternal;\n+    private int lockRetryTimes;\n \n     /**\n      * Instantiates a new Lock retry controller.\n      */\n     public LockRetryController() {\n+        int retryInternal = LOCK_RETRY_INTERNAL;\n+        int retryTimes = LOCK_RETRY_TIMES;\n+\n+        GlobalLockConfig config = GlobalLockConfigHolder.getCurrentGlobalLockConfig();\n+        if (config != null) {\n+            int configInternal = config.getLockRetryInternal();\n+            if (configInternal > 0) {\n+                retryInternal = configInternal;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NzU4MDI0", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-459758024", "createdAt": "2020-08-03T05:36:06Z", "commit": {"oid": "0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNTozNjowNlrOG6sr6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNTozNjowNlrOG6sr6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIwMjczMA==", "bodyText": "\u540c\u4e0a\uff0c\u6539\u52a8\u540eLOCK_RETRY_TIMES\u548cLOCK_RETRY_TIMES \u4f3c\u4e4e\u5c31\u53ef\u4ee5\u5220\u9664", "url": "https://github.com/seata/seata/pull/2962#discussion_r464202730", "createdAt": "2020-08-03T05:36:06Z", "author": {"login": "a364176773"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -32,13 +34,31 @@\n     private static int LOCK_RETRY_TIMES =\n         ConfigurationFactory.getInstance().getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);\n \n-    private int lockRetryInternal = LOCK_RETRY_INTERNAL;\n-    private int lockRetryTimes = LOCK_RETRY_TIMES;\n+    private int lockRetryInternal;\n+    private int lockRetryTimes;\n \n     /**\n      * Instantiates a new Lock retry controller.\n      */\n     public LockRetryController() {\n+        int retryInternal = LOCK_RETRY_INTERNAL;\n+        int retryTimes = LOCK_RETRY_TIMES;\n+\n+        GlobalLockConfig config = GlobalLockConfigHolder.getCurrentGlobalLockConfig();\n+        if (config != null) {\n+            int configInternal = config.getLockRetryInternal();\n+            if (configInternal > 0) {\n+                retryInternal = configInternal;\n+            }\n+\n+            int configTimes = config.getLockRetryTimes();\n+            if (configTimes >= 0) {\n+                retryTimes = configTimes;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a7fe1537c052e486fb1dccf0a0cb9f2db6407ec"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f9aa27783d3fdd6bca82955c731afdb20d1b74a", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/7f9aa27783d3fdd6bca82955c731afdb20d1b74a", "committedDate": "2020-08-03T07:05:32Z", "message": "optimize: LockRetryController no need to access config center when customized config is available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebfc6de45da6541e8bd5d84d60e5cd1525d4cf1d", "author": {"user": {"login": "selfishlover", "name": null}}, "url": "https://github.com/seata/seata/commit/ebfc6de45da6541e8bd5d84d60e5cd1525d4cf1d", "committedDate": "2020-08-04T06:16:18Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c7fdbaeaad00fee4afc248eef6df7aab660c641", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2c7fdbaeaad00fee4afc248eef6df7aab660c641", "committedDate": "2020-08-06T05:44:09Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab7368d3cfb3e38c55362b9c91324b888e461513", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/ab7368d3cfb3e38c55362b9c91324b888e461513", "committedDate": "2020-08-10T10:18:40Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MDk3MDc2", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-465097076", "createdAt": "2020-08-11T14:03:39Z", "commit": {"oid": "ab7368d3cfb3e38c55362b9c91324b888e461513"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce935754071de3033eac8c11c825027256a5b475", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/ce935754071de3033eac8c11c825027256a5b475", "committedDate": "2020-08-14T03:51:18Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f7bcea0793464a8bf031761a63bd36b1618a61", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/93f7bcea0793464a8bf031761a63bd36b1618a61", "committedDate": "2020-08-18T01:31:21Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbf66604451831d3da4bfa305051bfd4356f8fc7", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/fbf66604451831d3da4bfa305051bfd4356f8fc7", "committedDate": "2020-08-19T01:45:38Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90881fb5c78f055fd5d8062585e63b1dca3b3a6", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/a90881fb5c78f055fd5d8062585e63b1dca3b3a6", "committedDate": "2020-09-01T14:52:41Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44ef995c05bc4600d706920433522f61bd1b65aa", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/44ef995c05bc4600d706920433522f61bd1b65aa", "committedDate": "2020-09-04T03:37:28Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e8f58860eeaa170fab79ed56c9c0cab9932c88", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/27e8f58860eeaa170fab79ed56c9c0cab9932c88", "committedDate": "2020-09-14T15:20:01Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "383b7c9b107d1d89d683c4f5cdf9cbce59847ef0", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/383b7c9b107d1d89d683c4f5cdf9cbce59847ef0", "committedDate": "2020-09-15T02:16:51Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzAxMzg4", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-488301388", "createdAt": "2020-09-15T03:44:34Z", "commit": {"oid": "383b7c9b107d1d89d683c4f5cdf9cbce59847ef0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMzo0NDozNFrOHRva7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMzo0NDozNFrOHRva7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM2NDc4Mg==", "bodyText": "Why remove the try catch?", "url": "https://github.com/seata/seata/pull/2962#discussion_r488364782", "createdAt": "2020-09-15T03:44:34Z", "author": {"login": "l81893521"}, "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionalInterceptor.java", "diffHunk": "@@ -147,21 +149,27 @@ public Object invoke(final MethodInvocation methodInvocation) throws Throwable {\n                 if (globalTransactionalAnnotation != null) {\n                     return handleGlobalTransaction(methodInvocation, globalTransactionalAnnotation);\n                 } else if (globalLockAnnotation != null) {\n-                    return handleGlobalLock(methodInvocation);\n+                    return handleGlobalLock(methodInvocation, globalLockAnnotation);\n                 }\n             }\n         }\n         return methodInvocation.proceed();\n     }\n \n-    private Object handleGlobalLock(final MethodInvocation methodInvocation) throws Exception {\n-        return globalLockTemplate.execute(() -> {\n-            try {\n+    private Object handleGlobalLock(final MethodInvocation methodInvocation,\n+        final GlobalLock globalLockAnno) throws Throwable {\n+        return globalLockTemplate.execute(new GlobalLockExecutor() {\n+            @Override\n+            public Object execute() throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "383b7c9b107d1d89d683c4f5cdf9cbce59847ef0"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09a5c5152256fceedd3bb05f0a392475ee985412", "author": {"user": {"login": "selfishlover", "name": null}}, "url": "https://github.com/seata/seata/commit/09a5c5152256fceedd3bb05f0a392475ee985412", "committedDate": "2020-09-15T05:34:16Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/289b6d7b29a0ae59c763915f1ebf58d3ca8ef212", "committedDate": "2020-09-15T06:07:21Z", "message": "optimize: add junit test for GlobalLockConfigHolder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4Mzg2NTEx", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-488386511", "createdAt": "2020-09-15T07:10:28Z", "commit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMDoyOFrOHRzzBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMDoyOFrOHRzzBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNjQ4Ng==", "bodyText": "Keep this constants. Returns it in the get methods, if there is no customized config.", "url": "https://github.com/seata/seata/pull/2962#discussion_r488436486", "createdAt": "2020-09-15T07:10:28Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -27,18 +30,17 @@\n  * @author sharajava\n  */\n public class LockRetryController {\n-    private static int LOCK_RETRY_INTERNAL =\n-        ConfigurationFactory.getInstance().getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL, DEFAULT_CLIENT_LOCK_RETRY_INTERVAL);\n-    private static int LOCK_RETRY_TIMES =\n-        ConfigurationFactory.getInstance().getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4Mzg4MzUy", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-488388352", "createdAt": "2020-09-15T07:13:08Z", "commit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMzowOVrOHRz4kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMzowOVrOHRz4kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNzkwNw==", "bodyText": "Recovery LOCK_RETRY_INTERNAL, and returns LOCK_RETRY_INTERNAL.", "url": "https://github.com/seata/seata/pull/2962#discussion_r488437907", "createdAt": "2020-09-15T07:13:09Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -57,4 +59,32 @@ public void sleep(Exception e) throws LockWaitTimeoutException {\n         } catch (InterruptedException ignore) {\n         }\n     }\n+\n+    private int getLockRetryInternal() {\n+        // get customized config first\n+        GlobalLockConfig config = GlobalLockConfigHolder.getCurrentGlobalLockConfig();\n+        if (config != null) {\n+            int configInternal = config.getLockRetryInternal();\n+            if (configInternal > 0) {\n+                return configInternal;\n+            }\n+        }\n+        // if there is no customized config, use global config instead\n+        Configuration configuration = ConfigurationFactory.getInstance();\n+        return configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL, DEFAULT_CLIENT_LOCK_RETRY_INTERVAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4Mzg4NTI3", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-488388527", "createdAt": "2020-09-15T07:13:22Z", "commit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMzoyM1rOHRz5GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzoxMzoyM1rOHRz5GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzODA0MA==", "bodyText": "Recovery LOCK_RETRY_TIMES, and returns LOCK_RETRY_TIMES.", "url": "https://github.com/seata/seata/pull/2962#discussion_r488438040", "createdAt": "2020-09-15T07:13:23Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -57,4 +59,32 @@ public void sleep(Exception e) throws LockWaitTimeoutException {\n         } catch (InterruptedException ignore) {\n         }\n     }\n+\n+    private int getLockRetryInternal() {\n+        // get customized config first\n+        GlobalLockConfig config = GlobalLockConfigHolder.getCurrentGlobalLockConfig();\n+        if (config != null) {\n+            int configInternal = config.getLockRetryInternal();\n+            if (configInternal > 0) {\n+                return configInternal;\n+            }\n+        }\n+        // if there is no customized config, use global config instead\n+        Configuration configuration = ConfigurationFactory.getInstance();\n+        return configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL, DEFAULT_CLIENT_LOCK_RETRY_INTERVAL);\n+    }\n+\n+    private int getLockRetryTimes() {\n+        // get customized config first\n+        GlobalLockConfig config = GlobalLockConfigHolder.getCurrentGlobalLockConfig();\n+        if (config != null) {\n+            int configTimes = config.getLockRetryTimes();\n+            if (configTimes >= 0) {\n+                return configTimes;\n+            }\n+        }\n+        // if there is no customized config, use global config instead\n+        Configuration configuration = ConfigurationFactory.getInstance();\n+        return configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "289b6d7b29a0ae59c763915f1ebf58d3ca8ef212"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01470ac006e2e8ee6a1524a0001bec0f20a82e23", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/01470ac006e2e8ee6a1524a0001bec0f20a82e23", "committedDate": "2020-09-16T03:31:29Z", "message": "optimize: faster implement for LockRetryController to access global config(using ConfigurationChangeListener)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjUwNTg0", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-489250584", "createdAt": "2020-09-16T03:41:10Z", "commit": {"oid": "01470ac006e2e8ee6a1524a0001bec0f20a82e23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzo0MToxMFrOHSe5gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzo0MToxMFrOHSe5gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE0MjY1OQ==", "bodyText": "volatile", "url": "https://github.com/seata/seata/pull/2962#discussion_r489142659", "createdAt": "2020-09-16T03:41:10Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -84,7 +87,50 @@ private int getLockRetryTimes() {\n             }\n         }\n         // if there is no customized config, use global config instead\n-        Configuration configuration = ConfigurationFactory.getInstance();\n-        return configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);\n+        return globalConfig.getGlobalLockRetryTimes();\n+    }\n+\n+    static class GlobalConfig implements ConfigurationChangeListener {\n+\n+        private int globalLockRetryInternal;\n+\n+        private int globalLockRetryTimes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01470ac006e2e8ee6a1524a0001bec0f20a82e23"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjUwNzUw", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-489250750", "createdAt": "2020-09-16T03:41:52Z", "commit": {"oid": "01470ac006e2e8ee6a1524a0001bec0f20a82e23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzo0MTo1MlrOHSe6Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMzo0MTo1MlrOHSe6Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE0MjgxOA==", "bodyText": "use the static method NumberUtils.toInt", "url": "https://github.com/seata/seata/pull/2962#discussion_r489142818", "createdAt": "2020-09-16T03:41:52Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -84,7 +87,50 @@ private int getLockRetryTimes() {\n             }\n         }\n         // if there is no customized config, use global config instead\n-        Configuration configuration = ConfigurationFactory.getInstance();\n-        return configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, DEFAULT_CLIENT_LOCK_RETRY_TIMES);\n+        return globalConfig.getGlobalLockRetryTimes();\n+    }\n+\n+    static class GlobalConfig implements ConfigurationChangeListener {\n+\n+        private int globalLockRetryInternal;\n+\n+        private int globalLockRetryTimes;\n+\n+        private final int defaultRetryInternal = DefaultValues.DEFAULT_CLIENT_LOCK_RETRY_INTERVAL;\n+        private final int defaultRetryTimes = DefaultValues.DEFAULT_CLIENT_LOCK_RETRY_TIMES;\n+\n+        public GlobalConfig() {\n+            Configuration configuration = ConfigurationFactory.getInstance();\n+            globalLockRetryInternal = configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL, defaultRetryInternal);\n+            globalLockRetryTimes = configuration.getInt(ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES, defaultRetryTimes);\n+        }\n+\n+        @Override\n+        public void onChangeEvent(ConfigurationChangeEvent event) {\n+            String dataId = event.getDataId();\n+            String newValue = event.getNewValue();\n+            if (ConfigurationKeys.CLIENT_LOCK_RETRY_INTERVAL.equals(dataId)) {\n+                globalLockRetryInternal = parseInt(newValue, defaultRetryInternal);\n+            }\n+            if (ConfigurationKeys.CLIENT_LOCK_RETRY_TIMES.equals(dataId)) {\n+                globalLockRetryTimes = parseInt(newValue, defaultRetryTimes);\n+            }\n+        }\n+\n+        private int parseInt(String value, int fallback) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01470ac006e2e8ee6a1524a0001bec0f20a82e23"}, "originalPosition": 91}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ea0701d89a16dec82d6a0de6fca6a71403f9e5d", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/4ea0701d89a16dec82d6a0de6fca6a71403f9e5d", "committedDate": "2020-09-16T04:14:06Z", "message": "optimize: fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "064c27304b3a9ce3b34c8d7a4f05faa78d199671", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/064c27304b3a9ce3b34c8d7a4f05faa78d199671", "committedDate": "2020-09-16T04:24:18Z", "message": "optimize: add volatile flag and use NumberUtils method instead of \"repeating it\" myself"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjY2MTkx", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-489266191", "createdAt": "2020-09-16T04:38:06Z", "commit": {"oid": "4ea0701d89a16dec82d6a0de6fca6a71403f9e5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDozODowN1rOHSfwfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDozODowN1rOHSfwfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1NjczMg==", "bodyText": "\u5e38\u91cf\u7684\u53d8\u91cf\u540d\u7528\u5927\u5199\u5c31\u597d\uff0c\u4e0d\u8981\u628afinal\u62ff\u6389\u3002", "url": "https://github.com/seata/seata/pull/2962#discussion_r489156732", "createdAt": "2020-09-16T04:38:07Z", "author": {"login": "wangliang181230"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/LockRetryController.java", "diffHunk": "@@ -28,7 +32,7 @@\n  */\n public class LockRetryController {\n \n-    private static final GlobalConfig globalConfig = new GlobalConfig();\n+    private static GlobalConfig globalConfig = new GlobalConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ea0701d89a16dec82d6a0de6fca6a71403f9e5d"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa10f27264dea8925f0e1699299f26e06dc0d857", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/fa10f27264dea8925f0e1699299f26e06dc0d857", "committedDate": "2020-09-28T09:58:34Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba8b789169e623d87adda478643dd6a6f319b1e1", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/ba8b789169e623d87adda478643dd6a6f319b1e1", "committedDate": "2020-10-12T06:57:33Z", "message": "Merge remote-tracking branch 'upstream/develop' into develop\n\n# Conflicts:\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalTransactionalInterceptor.java\n#\ttm/src/main/java/io/seata/tm/api/TransactionalTemplate.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ca7af7deaf9b4de656512d26050ae216be7bc1b", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/3ca7af7deaf9b4de656512d26050ae216be7bc1b", "committedDate": "2020-10-12T07:16:01Z", "message": "optimize: fix merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4791b2244257da9ddc15684bad36d5799043fdb5", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/4791b2244257da9ddc15684bad36d5799043fdb5", "committedDate": "2020-10-12T08:55:42Z", "message": "optimize: adjust LockRetryController instantiate time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDI1Mzk0", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-506425394", "createdAt": "2020-10-12T08:58:38Z", "commit": {"oid": "4791b2244257da9ddc15684bad36d5799043fdb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bb3078a812517ab89ce77ad73fb08285215e27d", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/8bb3078a812517ab89ce77ad73fb08285215e27d", "committedDate": "2020-10-12T09:08:42Z", "message": "optimize: add final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "851ea24a06564a9e2765c9738914b14ede1bee1e", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/851ea24a06564a9e2765c9738914b14ede1bee1e", "committedDate": "2020-10-12T09:12:34Z", "message": "optimize: FIX style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5cbe053e120d3eb3e9772df3db51409a2be282c", "author": {"user": null}, "url": "https://github.com/seata/seata/commit/f5cbe053e120d3eb3e9772df3db51409a2be282c", "committedDate": "2020-10-12T09:23:53Z", "message": "optimize: FIX style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDcyNjI2", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-506472626", "createdAt": "2020-10-12T09:57:18Z", "commit": {"oid": "f5cbe053e120d3eb3e9772df3db51409a2be282c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f39dfbd4b7bccd28bf45787ad136964fbfcf43", "author": {"user": {"login": "selfishlover", "name": null}}, "url": "https://github.com/seata/seata/commit/07f39dfbd4b7bccd28bf45787ad136964fbfcf43", "committedDate": "2020-10-12T10:11:03Z", "message": "optimize: FIX git account"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NzgzNTA4", "url": "https://github.com/seata/seata/pull/2962#pullrequestreview-525783508", "createdAt": "2020-11-08T07:56:14Z", "commit": {"oid": "07f39dfbd4b7bccd28bf45787ad136964fbfcf43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNzo1NjoxNFrOHvOVOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNzo1NjoxNFrOHvOVOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI3OTkyOA==", "bodyText": "lockRetryInternal  \u662f\u4e0d\u662f\u5e94\u8be5\u53eb\u505a lockRetryInterval \u3002  \u662f\u62fc\u9519\u4e86\uff0c \u8fd8\u662f\u672c\u6765\u5c31\u662f\u8fd9\u4e2a\u610f\u601d?", "url": "https://github.com/seata/seata/pull/2962#discussion_r519279928", "createdAt": "2020-11-08T07:56:14Z", "author": {"login": "ls9527"}, "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactional.java", "diffHunk": "@@ -83,4 +83,20 @@\n      * @return\n      */\n     Propagation propagation() default Propagation.REQUIRED;\n+\n+    /**\n+     * customized global lock retry internal(unit: ms)\n+     * you may use this to override global config of \"client.rm.lock.retryInterval\"\n+     * note: 0 or negative number will take no effect(which mean fall back to global config)\n+     * @return\n+     */\n+    int lockRetryInternal() default 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07f39dfbd4b7bccd28bf45787ad136964fbfcf43"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3590, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}