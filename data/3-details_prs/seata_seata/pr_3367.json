{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM4OTA3NDI2", "number": 3367, "title": "bugfix: when the xa branch is rollback, it cannot be executed due to idle state", "bodyText": "\u2160. Describe what this PR did\n\u2161. Does this pull request fix one issue?\n\nfixes #3361\nfixes #3256\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-12-13T08:01:27Z", "url": "https://github.com/seata/seata/pull/3367", "merged": true, "mergeCommit": {"oid": "dac15bf62c50f88ffa30eb884a93890c8d371684"}, "closed": true, "closedAt": "2021-02-05T01:52:05Z", "author": {"login": "a364176773"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdky6qLAH2gAyNTM4OTA3NDI2Ojc1YzRmMzk0NDgzY2NkN2IxNDliYzQwNDk0YTNmMWYxMjJhMGE5OWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2_jO_gFqTU4Mzk2MjQ2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75c4f394483ccd7b149bc40494a3f1f122a0a99f", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/75c4f394483ccd7b149bc40494a3f1f122a0a99f", "committedDate": "2020-12-10T12:57:50Z", "message": "optimize: last XA branch exception execute xa rolled back"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b4040b5f7be2f5e7c841eb57adb0bafbd9e317", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/f6b4040b5f7be2f5e7c841eb57adb0bafbd9e317", "committedDate": "2020-12-10T13:01:07Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f776630dc4ea33872ff6da353f43092271ac5bc5", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/f776630dc4ea33872ff6da353f43092271ac5bc5", "committedDate": "2020-12-13T07:52:19Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fd8fbf0a2dfbbfb6f8a387e18cf30d5cedbe6c2", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/1fd8fbf0a2dfbbfb6f8a387e18cf30d5cedbe6c2", "committedDate": "2020-12-14T08:05:08Z", "message": "Merge branch 'develop' of https://github.com/seata/seata into 1210-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf7819e07ea407fae8c068d9c6c90144b8b220d3", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/cf7819e07ea407fae8c068d9c6c90144b8b220d3", "committedDate": "2020-12-27T10:00:34Z", "message": "Merge branch 'develop' of https://github.com/seata/seata into 1210-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a24821acd0cc0f190fe824a7b418d62ee36d9de", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/4a24821acd0cc0f190fe824a7b418d62ee36d9de", "committedDate": "2020-12-27T10:03:54Z", "message": "update 1.5.0.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c170b676d81b4cf71317e1f9bc5129552ba05cba", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/c170b676d81b4cf71317e1f9bc5129552ba05cba", "committedDate": "2020-12-27T10:06:59Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e64181b7d2b6c8027d48b09e8a7e53368ab4e5b2", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/e64181b7d2b6c8027d48b09e8a7e53368ab4e5b2", "committedDate": "2020-12-28T09:54:28Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0405fff22170031208879fc9ae51e538f36e0a69", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/0405fff22170031208879fc9ae51e538f36e0a69", "committedDate": "2020-12-28T09:55:57Z", "message": "bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8642480112697dfac703999d22375241c3eba989", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/8642480112697dfac703999d22375241c3eba989", "committedDate": "2020-12-29T03:54:15Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMzUwNjUz", "url": "https://github.com/seata/seata/pull/3367#pullrequestreview-562350653", "createdAt": "2021-01-06T06:21:35Z", "commit": {"oid": "8642480112697dfac703999d22375241c3eba989"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQwNjoyMTozNVrOIOzTMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQwNjoyMTozNVrOIOzTMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjM5MTQ3NA==", "bodyText": "rolled back\uff1f", "url": "https://github.com/seata/seata/pull/3367#discussion_r552391474", "createdAt": "2021-01-06T06:21:35Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/xa/ConnectionProxyXA.java", "diffHunk": "@@ -201,22 +209,21 @@ public void rollback() throws SQLException {\n         if (!xaActive || this.xaBranchXid == null) {\n             throw new SQLException(\"should NOT rollback on an inactive session\");\n         }\n-        try {\n-            // Branch Report to TC\n-            DefaultResourceManager.get().branchReport(BranchType.XA, xid, xaBranchXid.getBranchId(), BranchStatus.PhaseOne_Failed, null);\n-\n-        } catch (TransactionException te) {\n-            // log and ignore the report failure\n-            LOGGER.warn(\"Failed to report XA branch rollback on \" + xid + \"-\" + xaBranchXid.getBranchId()\n-                + \" since \" + te.getCode() + \":\" + te.getMessage());\n-        }\n         try {\n             // XA End: Fail\n             xaResource.end(xaBranchXid, XAResource.TMFAIL);\n+            xaRollback(xaBranchXid);\n+            // Branch Report to TC\n+            DefaultResourceManager.get().branchReport(BranchType.XA, xid, xaBranchXid.getBranchId(),\n+                BranchStatus.PhaseOne_Failed, null);\n+            LOGGER.info(xaBranchXid + \" was rolled back.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8642480112697dfac703999d22375241c3eba989"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c239669538853a28a4ca26d61886fe68b7d2f35", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/0c239669538853a28a4ca26d61886fe68b7d2f35", "committedDate": "2021-01-06T08:05:21Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eccecdb575ce69c51f83c9da87881d7d5ac3175", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/9eccecdb575ce69c51f83c9da87881d7d5ac3175", "committedDate": "2021-01-06T09:47:13Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e55296c413561aae71aa30f60f1b0bcc9f29b10", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/8e55296c413561aae71aa30f60f1b0bcc9f29b10", "committedDate": "2021-01-06T09:48:29Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80102d041fcf54163e0c01d607e62a4d7d251e16", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/80102d041fcf54163e0c01d607e62a4d7d251e16", "committedDate": "2021-01-10T14:23:46Z", "message": "Update 1.5.0.md"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "becbeeb7b4b794cf3c145a26fc92a25e2af0dc8a", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/becbeeb7b4b794cf3c145a26fc92a25e2af0dc8a", "committedDate": "2021-01-10T14:28:12Z", "message": "update"}, "afterCommit": {"oid": "80102d041fcf54163e0c01d607e62a4d7d251e16", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/80102d041fcf54163e0c01d607e62a4d7d251e16", "committedDate": "2021-01-10T14:23:46Z", "message": "Update 1.5.0.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87bf54afa5497e05f64e7a289da2a4d5e978971a", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/87bf54afa5497e05f64e7a289da2a4d5e978971a", "committedDate": "2021-01-10T14:30:37Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc3MDE5Mjg0", "url": "https://github.com/seata/seata/pull/3367#pullrequestreview-577019284", "createdAt": "2021-01-27T06:31:32Z", "commit": {"oid": "87bf54afa5497e05f64e7a289da2a4d5e978971a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6c92acf0544bae1df584f2dc18fe3e05a1a3b44", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/a6c92acf0544bae1df584f2dc18fe3e05a1a3b44", "committedDate": "2021-02-04T06:10:59Z", "message": "Merge branch 'develop' into 1210-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzOTYyNDYz", "url": "https://github.com/seata/seata/pull/3367#pullrequestreview-583962463", "createdAt": "2021-02-05T01:51:39Z", "commit": {"oid": "a6c92acf0544bae1df584f2dc18fe3e05a1a3b44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3546, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}