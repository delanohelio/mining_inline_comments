{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNzQ5OTg3", "number": 3140, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOToyNDoxNlrOEmd80g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNjo1Mjo1MFrOEsQYQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzcyMDUwOnYy", "diffSide": "RIGHT", "path": "tm/src/main/java/io/seata/tm/api/transaction/Propagation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOToyNDoxNlrOHWgbcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxNDo1MVrOHWjasQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MjAzNQ==", "bodyText": "\u8fd9\u6ce8\u91ca\u91cc\u7684\u4f2a\u4ee3\u7801\u65b9\u6cd5\uff0c\u4e0d\u662fseata\u73b0\u6709\u7684api\u3002\u8fd9\u4e2a\u5730\u65b9\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u53c2\u8003spring\u4e8b\u52a1\uff0c\u7ed9\u6e05\u6670\u7684\u6ce8\u91ca\u5c31\u597d\u4e86\uff0c\u5c31\u6bd4\u5982\u4f60\u4e0a\u9762\u76842\u53e5\uff0c\u5df2\u7ecf\u8db3\u591f\u6e05\u6670\u4e86\u3002\u52a0\u8fd9\u4e2a\u4ee3\u7801\uff0c\u4f7f\u7528\u8005\u7528\u7684\u65f6\u5019\u5982\u679c\u770b\u4e86\u8fd9\u91cc\uff0c\u4f1a\u4e0d\u4f1a\u6709\u4e2a\u9519\u89c9\uff0c\u4ed6\u7528\u8fd9\u4e2a\u4f20\u64ad\u5c5e\u6027\uff0c\u8fd8\u5f97\u7167\u7740\u8fd9\u4e2a\u6a21\u677f\u7f16\u7801\u3002\u3002\u3002\u3002\u3002\u3002\u4ee3\u7801\u793a\u4f8b\uff0c\u5e94\u8be5\u591a\u662f\u6307\u5bfc\u7528\u6237\u53bb\u7f16\u7801\u7684\uff0c\u8fd9\u4e2a\u4ee3\u7801\u793a\u4f8b\uff0c\u611f\u89c9\u662f\u6307\u5bfc\u5199\u6846\u67b6\u7684\u4eba\u7684\uff0c\u4f46\u662f\u65b9\u6cd5\u53c8\u4e0d\u662fseata\u91cc\u7684\u65b9\u6cd5\u3002\u3002\u3002\uff08\u4e2a\u4eba\u770b\u6cd5\uff0c\u63a2\u8ba8\u4e00\u4e0b\uff09", "url": "https://github.com/seata/seata/pull/3140#discussion_r493362035", "createdAt": "2020-09-23T09:24:16Z", "author": {"login": "lightClouds917"}, "path": "tm/src/main/java/io/seata/tm/api/transaction/Propagation.java", "diffHunk": "@@ -19,37 +19,125 @@\n  * Propagation level of global transactions.\n  *\n  * @author haozhibei\n+ * @see io.seata.spring.annotation.GlobalTransactional\n+ * @see io.seata.tm.api.TransactionalTemplate\n  */\n public enum Propagation {\n     /**\n      * The REQUIRED.\n+     * <p>\n+     * If transaction is existing, execute with current transaction,\n+     * else execute with new transaction.\n+     * </p>\n+     * <pre>\n+     *     if (tx == null) {\n+     *         tx = beginNewTransaction(); // begin new transaction, is not existing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxMDk5Mw==", "bodyText": "\u6211\u53c2\u7167\u4e86JDK\u91cc\u7684\u4e00\u4e9b\u4ee3\u7801\u7684\u6ce8\u91ca\u3002\u4e5f\u662f\u5199\u4e86\u4e00\u4e9b\u4f2a\u4ee3\u7801\uff0c\u6765\u8868\u793a\u8fd9\u4e2a\u65b9\u6cd5\u7684\u57fa\u672c\u903b\u8f91\u3002\n\u6211\u89c9\u5f97\u5e94\u8be5\u6ca1\u6709\u4eba\u4f1a\u5f04\u9519\u5427\u3002", "url": "https://github.com/seata/seata/pull/3140#discussion_r493410993", "createdAt": "2020-09-23T10:14:51Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/transaction/Propagation.java", "diffHunk": "@@ -19,37 +19,125 @@\n  * Propagation level of global transactions.\n  *\n  * @author haozhibei\n+ * @see io.seata.spring.annotation.GlobalTransactional\n+ * @see io.seata.tm.api.TransactionalTemplate\n  */\n public enum Propagation {\n     /**\n      * The REQUIRED.\n+     * <p>\n+     * If transaction is existing, execute with current transaction,\n+     * else execute with new transaction.\n+     * </p>\n+     * <pre>\n+     *     if (tx == null) {\n+     *         tx = beginNewTransaction(); // begin new transaction, is not existing", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MjAzNQ=="}, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NzcyODIyOnYy", "diffSide": "RIGHT", "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOToyNToyOVrOHWggbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyMzo1NVrOHWj63g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MzMwOQ==", "bodyText": "\u4ece\u6e05\u6670\u7684\u8bed\u4e49\u4e0a\u6765\u8bf4\uff0c\u8fd9\u91ccexistingTransaction \u662f\u4e0d\u662f\u6bd4 tx == null \u8fd9\u79cd\u66f4\u6e05\u6670\u4e9b\u3002", "url": "https://github.com/seata/seata/pull/3140#discussion_r493363309", "createdAt": "2020-09-23T09:25:29Z", "author": {"login": "lightClouds917"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -48,64 +48,82 @@\n      * @throws TransactionalExecutor.ExecutionException the execution exception\n      */\n     public Object execute(TransactionalExecutor business) throws Throwable {\n-        // 1 get transactionInfo\n+        // 1. Get transactionInfo\n         TransactionInfo txInfo = business.getTransactionInfo();\n         if (txInfo == null) {\n             throw new ShouldNeverHappenException(\"transactionInfo does not exist\");\n         }\n-        // 1.1 get or create a transaction\n-        GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n+        // 1.1 Get current transaction, if not null, the tx role is 'GlobalTransactionRole.Participant'.\n+        GlobalTransaction tx = GlobalTransactionContext.getCurrent();\n \n-        // 1.2 Handle the Transaction propatation and the branchType\n+        // 1.2 Handle the transaction propagation.\n         Propagation propagation = txInfo.getPropagation();\n         SuspendedResourcesHolder suspendedResourcesHolder = null;\n         try {\n             switch (propagation) {\n                 case NOT_SUPPORTED:\n-                    suspendedResourcesHolder = tx.suspend(true);\n+                    // If transaction is existing, suspend it.\n+                    if (tx != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxOTIzMA==", "bodyText": "done", "url": "https://github.com/seata/seata/pull/3140#discussion_r493419230", "createdAt": "2020-09-23T10:23:55Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -48,64 +48,82 @@\n      * @throws TransactionalExecutor.ExecutionException the execution exception\n      */\n     public Object execute(TransactionalExecutor business) throws Throwable {\n-        // 1 get transactionInfo\n+        // 1. Get transactionInfo\n         TransactionInfo txInfo = business.getTransactionInfo();\n         if (txInfo == null) {\n             throw new ShouldNeverHappenException(\"transactionInfo does not exist\");\n         }\n-        // 1.1 get or create a transaction\n-        GlobalTransaction tx = GlobalTransactionContext.getCurrentOrCreate();\n+        // 1.1 Get current transaction, if not null, the tx role is 'GlobalTransactionRole.Participant'.\n+        GlobalTransaction tx = GlobalTransactionContext.getCurrent();\n \n-        // 1.2 Handle the Transaction propatation and the branchType\n+        // 1.2 Handle the transaction propagation.\n         Propagation propagation = txInfo.getPropagation();\n         SuspendedResourcesHolder suspendedResourcesHolder = null;\n         try {\n             switch (propagation) {\n                 case NOT_SUPPORTED:\n-                    suspendedResourcesHolder = tx.suspend(true);\n+                    // If transaction is existing, suspend it.\n+                    if (tx != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MzMwOQ=="}, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4Nzc0NjMzOnYy", "diffSide": "RIGHT", "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOToyODoxN1rOHWgrzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoxODo0OVrOHWjnzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2NjIyMw==", "bodyText": "\u6309\u7167\u4e00\u8d2f\u7684\u98ce\u683c\uff0cjava.*\u7684\u4ee3\u7801\u5e94\u8be5\u5728\u6700\u4e0a\u9762", "url": "https://github.com/seata/seata/pull/3140#discussion_r493366223", "createdAt": "2020-09-23T09:28:17Z", "author": {"login": "lightClouds917"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -26,7 +24,9 @@\n import io.seata.tm.api.transaction.TransactionHook;\n import io.seata.tm.api.transaction.TransactionHookManager;\n import io.seata.tm.api.transaction.TransactionInfo;\n+\n import java.util.List;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNDM0OQ==", "bodyText": "done", "url": "https://github.com/seata/seata/pull/3140#discussion_r493414349", "createdAt": "2020-09-23T10:18:49Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -26,7 +24,9 @@\n import io.seata.tm.api.transaction.TransactionHook;\n import io.seata.tm.api.transaction.TransactionHookManager;\n import io.seata.tm.api.transaction.TransactionInfo;\n+\n import java.util.List;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2NjIyMw=="}, "originalCommit": {"oid": "9b2c71f7cf521e031eace131ca22866a4d69eb1e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MzE3MTc2OnYy", "diffSide": "RIGHT", "path": "tm/src/main/java/io/seata/tm/api/GlobalTransactionContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTowMDo0MFrOHXVBMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDo1MTo0OVrOHXxWAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyMzY2Ng==", "bodyText": "I think should include the\npublic\n\ncause the code style is different in different people, we should keep it same.", "url": "https://github.com/seata/seata/pull/3140#discussion_r494223666", "createdAt": "2020-09-24T11:00:40Z", "author": {"login": "l81893521"}, "path": "tm/src/main/java/io/seata/tm/api/GlobalTransactionContext.java", "diffHunk": "@@ -34,7 +34,7 @@ private GlobalTransactionContext() {\n      *\n      * @return\n      */\n-    private static GlobalTransaction createNew() {\n+    static GlobalTransaction createNew() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5762c57de900296cb6b831eab6050636d52972de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY4Nzc0NA==", "bodyText": "done", "url": "https://github.com/seata/seata/pull/3140#discussion_r494687744", "createdAt": "2020-09-25T00:51:49Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/GlobalTransactionContext.java", "diffHunk": "@@ -34,7 +34,7 @@ private GlobalTransactionContext() {\n      *\n      * @return\n      */\n-    private static GlobalTransaction createNew() {\n+    static GlobalTransaction createNew() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyMzY2Ng=="}, "originalCommit": {"oid": "5762c57de900296cb6b831eab6050636d52972de"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0ODQxMTUyOnYy", "diffSide": "RIGHT", "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNjo1Mjo1MFrOHfdyBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNzoxMzoyMlrOHfd43w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NTg0Ng==", "bodyText": "Why did you make this change?", "url": "https://github.com/seata/seata/pull/3140#discussion_r502755846", "createdAt": "2020-10-10T06:52:50Z", "author": {"login": "slievrly"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -120,17 +136,20 @@ public Object execute(TransactionalExecutor business) throws Throwable {\n                 cleanUp();\n             }\n         } finally {\n-            tx.resume(suspendedResourcesHolder);\n+            // If the transaction is suspended, resume it.\n+            if (suspendedResourcesHolder != null) {\n+                suspendedResourcesHolder.resume();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9983abb175ce253447a58b42860b9965cf2a07e"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NzU5OQ==", "bodyText": "Previously, I thought Holder could contain actions, but now it's back.", "url": "https://github.com/seata/seata/pull/3140#discussion_r502757599", "createdAt": "2020-10-10T07:13:22Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -120,17 +136,20 @@ public Object execute(TransactionalExecutor business) throws Throwable {\n                 cleanUp();\n             }\n         } finally {\n-            tx.resume(suspendedResourcesHolder);\n+            // If the transaction is suspended, resume it.\n+            if (suspendedResourcesHolder != null) {\n+                suspendedResourcesHolder.resume();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NTg0Ng=="}, "originalCommit": {"oid": "f9983abb175ce253447a58b42860b9965cf2a07e"}, "originalPosition": 128}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1438, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}