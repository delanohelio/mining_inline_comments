{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMzY2MDUz", "number": 2540, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxODozMlrOEKjfOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMToxNDoxOVrOENljEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTAyNjUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmUndoLogProcessor.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxODozMlrOGrqb8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNjoyMDowMlrOGvrL0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNzIzNQ==", "bodyText": "Why change handle something to do something? I think this method just handle it, not do it.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448437235", "createdAt": "2020-07-01T15:18:32Z", "author": {"login": "l81893521"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmUndoLogProcessor.java", "diffHunk": "@@ -48,10 +48,10 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle undo log process:\" + msg);\n         }\n-        handleUndoLogDelete((UndoLogDeleteRequest) msg);\n+        doUndoLogDelete((UndoLogDeleteRequest) msg);\n     }\n \n-    private void handleUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {\n+    private void doUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcxNzA2MQ==", "bodyText": "Because \"do\" will be better, the meaning of \"handle\" and \"process\" is a bit repeated.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448717061", "createdAt": "2020-07-02T02:42:35Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmUndoLogProcessor.java", "diffHunk": "@@ -48,10 +48,10 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle undo log process:\" + msg);\n         }\n-        handleUndoLogDelete((UndoLogDeleteRequest) msg);\n+        doUndoLogDelete((UndoLogDeleteRequest) msg);\n     }\n \n-    private void handleUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {\n+    private void doUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNzIzNQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyMjk5Ng==", "bodyText": "But the method start of \"do\", usually means doing real business logic.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448722996", "createdAt": "2020-07-02T03:07:11Z", "author": {"login": "l81893521"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmUndoLogProcessor.java", "diffHunk": "@@ -48,10 +48,10 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle undo log process:\" + msg);\n         }\n-        handleUndoLogDelete((UndoLogDeleteRequest) msg);\n+        doUndoLogDelete((UndoLogDeleteRequest) msg);\n     }\n \n-    private void handleUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {\n+    private void doUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNzIzNQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY0Mzc5Mg==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452643792", "createdAt": "2020-07-10T06:20:02Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmUndoLogProcessor.java", "diffHunk": "@@ -48,10 +48,10 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle undo log process:\" + msg);\n         }\n-        handleUndoLogDelete((UndoLogDeleteRequest) msg);\n+        doUndoLogDelete((UndoLogDeleteRequest) msg);\n     }\n \n-    private void handleUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {\n+    private void doUndoLogDelete(UndoLogDeleteRequest undoLogDeleteRequest) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNzIzNQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTA0ODg3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/io/seata/server/coordinator/DefaultCore.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToyNDoxNlrOGrqqTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMToxMDo1MlrOGvmtSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MDkxMQ==", "bodyText": "Please reset this class.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448440911", "createdAt": "2020-07-01T15:24:16Z", "author": {"login": "l81893521"}, "path": "server/src/main/java/io/seata/server/coordinator/DefaultCore.java", "diffHunk": "@@ -38,6 +31,12 @@\n import io.seata.server.session.GlobalSession;\n import io.seata.server.session.SessionHelper;\n import io.seata.server.session.SessionHolder;\n+import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcxODE2OQ==", "bodyText": "Logger is useful in this class, cannot be removed.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448718169", "createdAt": "2020-07-02T02:46:43Z", "author": {"login": "objcoding"}, "path": "server/src/main/java/io/seata/server/coordinator/DefaultCore.java", "diffHunk": "@@ -38,6 +31,12 @@\n import io.seata.server.session.GlobalSession;\n import io.seata.server.session.SessionHelper;\n import io.seata.server.session.SessionHolder;\n+import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MDkxMQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyMjg1Mg==", "bodyText": "I mean, this class do not change any thing but the format. reset it can make the pr review easier.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448722852", "createdAt": "2020-07-02T03:06:26Z", "author": {"login": "l81893521"}, "path": "server/src/main/java/io/seata/server/coordinator/DefaultCore.java", "diffHunk": "@@ -38,6 +31,12 @@\n import io.seata.server.session.GlobalSession;\n import io.seata.server.session.SessionHelper;\n import io.seata.server.session.SessionHolder;\n+import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MDkxMQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU3MDQ0Mw==", "bodyText": "Done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452570443", "createdAt": "2020-07-10T01:10:52Z", "author": {"login": "objcoding"}, "path": "server/src/main/java/io/seata/server/coordinator/DefaultCore.java", "diffHunk": "@@ -38,6 +31,12 @@\n import io.seata.server.session.GlobalSession;\n import io.seata.server.session.SessionHelper;\n import io.seata.server.session.SessionHolder;\n+import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MDkxMQ=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTA1NTUxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/io/seata/server/store/DbcpDataSourceProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToyNTo1MFrOGrqulA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMjo0NTozM1rOGr7kMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MjAwNA==", "bodyText": "Please reset here.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448442004", "createdAt": "2020-07-01T15:25:50Z", "author": {"login": "l81893521"}, "path": "server/src/main/java/io/seata/server/store/DbcpDataSourceProvider.java", "diffHunk": "@@ -39,6 +39,7 @@ public DataSource generate() {\n         ds.setDriverClassLoader(getDriverClassLoader());\n         ds.setUrl(getUrl());\n         ds.setUsername(getUser());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcxNzg3NQ==", "bodyText": "Done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r448717875", "createdAt": "2020-07-02T02:45:33Z", "author": {"login": "objcoding"}, "path": "server/src/main/java/io/seata/server/store/DbcpDataSourceProvider.java", "diffHunk": "@@ -39,6 +39,7 @@ public DataSource generate() {\n         ds.setDriverClassLoader(getDriverClassLoader());\n         ds.setUrl(getUrl());\n         ds.setUsername(getUser());\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0MjAwNA=="}, "originalCommit": {"oid": "e2fbf216cbbae2da14fab39e4b3444e04f45a296"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMDE1MzY2OnYy", "diffSide": "RIGHT", "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToyODo1NVrOGt2etw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOToxMDozMlrOGufJeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTcwMw==", "bodyText": "branch register was async request.", "url": "https://github.com/seata/seata/pull/2540#discussion_r450731703", "createdAt": "2020-07-07T09:28:55Z", "author": {"login": "l81893521"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -64,7 +64,7 @@ public Long branchRegister(BranchType branchType, String resourceId, String clie\n             request.setBranchType(branchType);\n             request.setApplicationData(applicationData);\n \n-            BranchRegisterResponse response = (BranchRegisterResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchRegisterResponse response = (BranchRegisterResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczNjYzNA==", "bodyText": "My fault.", "url": "https://github.com/seata/seata/pull/2540#discussion_r450736634", "createdAt": "2020-07-07T09:37:21Z", "author": {"login": "l81893521"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -64,7 +64,7 @@ public Long branchRegister(BranchType branchType, String resourceId, String clie\n             request.setBranchType(branchType);\n             request.setApplicationData(applicationData);\n \n-            BranchRegisterResponse response = (BranchRegisterResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchRegisterResponse response = (BranchRegisterResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTcwMw=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5ODAwOA==", "bodyText": "ok", "url": "https://github.com/seata/seata/pull/2540#discussion_r451398008", "createdAt": "2020-07-08T09:10:32Z", "author": {"login": "objcoding"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -64,7 +64,7 @@ public Long branchRegister(BranchType branchType, String resourceId, String clie\n             request.setBranchType(branchType);\n             request.setApplicationData(applicationData);\n \n-            BranchRegisterResponse response = (BranchRegisterResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchRegisterResponse response = (BranchRegisterResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTcwMw=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMDE1NDUwOnYy", "diffSide": "RIGHT", "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToyOTowOFrOGt2fRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOToxMDo1MlrOGufKUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTg0NA==", "bodyText": "branch report was async request.", "url": "https://github.com/seata/seata/pull/2540#discussion_r450731844", "createdAt": "2020-07-07T09:29:08Z", "author": {"login": "l81893521"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -94,7 +95,7 @@ public void branchReport(BranchType branchType, String xid, long branchId, Branc\n             request.setStatus(status);\n             request.setApplicationData(applicationData);\n \n-            BranchReportResponse response = (BranchReportResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchReportResponse response = (BranchReportResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczNjU2Ng==", "bodyText": "My fault.", "url": "https://github.com/seata/seata/pull/2540#discussion_r450736566", "createdAt": "2020-07-07T09:37:16Z", "author": {"login": "l81893521"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -94,7 +95,7 @@ public void branchReport(BranchType branchType, String xid, long branchId, Branc\n             request.setStatus(status);\n             request.setApplicationData(applicationData);\n \n-            BranchReportResponse response = (BranchReportResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchReportResponse response = (BranchReportResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTg0NA=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5ODIyNA==", "bodyText": "ok", "url": "https://github.com/seata/seata/pull/2540#discussion_r451398224", "createdAt": "2020-07-08T09:10:52Z", "author": {"login": "objcoding"}, "path": "rm/src/main/java/io/seata/rm/AbstractResourceManager.java", "diffHunk": "@@ -94,7 +95,7 @@ public void branchReport(BranchType branchType, String xid, long branchId, Branc\n             request.setStatus(status);\n             request.setApplicationData(applicationData);\n \n-            BranchReportResponse response = (BranchReportResponse) RmRpcClient.getInstance().sendMsgWithResponse(request);\n+            BranchReportResponse response = (BranchReportResponse) RmNettyRemotingClient.getInstance().sendSyncRequest(request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMTg0NA=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzUzNzA5OnYy", "diffSide": "RIGHT", "path": "rm/src/main/java/io/seata/rm/AbstractRMHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMzo0OTozNlrOGuXIFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMToxODozN1rOGvm0tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI2NjU4Mw==", "bodyText": "Why remove here?", "url": "https://github.com/seata/seata/pull/2540#discussion_r451266583", "createdAt": "2020-07-08T03:49:36Z", "author": {"login": "l81893521"}, "path": "rm/src/main/java/io/seata/rm/AbstractRMHandler.java", "diffHunk": "@@ -153,7 +152,7 @@ public AbstractResultMessage onRequest(AbstractMessage request, RpcContext conte\n \n     @Override\n     public void onResponse(AbstractResultMessage response, RpcContext context) {\n-        throw new ShouldNeverHappenException();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU3MjM0MQ==", "bodyText": "It may have been removed by hand, I will roll back.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452572341", "createdAt": "2020-07-10T01:18:37Z", "author": {"login": "objcoding"}, "path": "rm/src/main/java/io/seata/rm/AbstractRMHandler.java", "diffHunk": "@@ -153,7 +152,7 @@ public AbstractResultMessage onRequest(AbstractMessage request, RpcContext conte\n \n     @Override\n     public void onResponse(AbstractResultMessage response, RpcContext context) {\n-        throw new ShouldNeverHappenException();\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI2NjU4Mw=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTEwNDE3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjozOToxOFrOGumIBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMToyMDo1OFrOGvm20w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxMjMyNQ==", "bodyText": "response   has  msg field.", "url": "https://github.com/seata/seata/pull/2540#discussion_r451512325", "createdAt": "2020-07-08T12:39:18Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -161,7 +161,7 @@ public void onRegTmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        getServerMessageSender().sendResponse(request, ctx.channel(), response);\n+        getServerMessageSender().sendAsyncResponse(request, ctx.channel(), new RegisterTMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU3Mjg4Mw==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452572883", "createdAt": "2020-07-10T01:20:58Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -161,7 +161,7 @@ public void onRegTmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        getServerMessageSender().sendResponse(request, ctx.channel(), response);\n+        getServerMessageSender().sendAsyncResponse(request, ctx.channel(), new RegisterTMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxMjMyNQ=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTEwNTEzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjozOTozMVrOGumIlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwMToyMTowM1rOGvm25g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxMjQ2OQ==", "bodyText": "response   has  msg field.", "url": "https://github.com/seata/seata/pull/2540#discussion_r451512469", "createdAt": "2020-07-08T12:39:31Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -129,7 +129,7 @@ public void onRegRmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        getServerMessageSender().sendResponse(request, ctx.channel(), response);\n+        getServerMessageSender().sendAsyncResponse(request, ctx.channel(), new RegisterRMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU3MjkwMg==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452572902", "createdAt": "2020-07-10T01:21:03Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -129,7 +129,7 @@ public void onRegRmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        getServerMessageSender().sendResponse(request, ctx.channel(), response);\n+        getServerMessageSender().sendAsyncResponse(request, ctx.channel(), new RegisterRMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxMjQ2OQ=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTE0Nzc1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/RemotingClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjo1MTowMFrOGumjWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyMzowNFrOGvTgWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxOTMyMA==", "bodyText": "should there be a channel parameter?", "url": "https://github.com/seata/seata/pull/2540#discussion_r451519320", "createdAt": "2020-07-08T12:51:00Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/RemotingClient.java", "diffHunk": "@@ -33,43 +34,42 @@\n public interface RemotingClient {\n \n     /**\n-     * Send msg with response object.\n+     * client send sync request.\n+     * In this request, if {@link NettyClientConfig#isEnableClientBatchSendRequest} is enabled,\n+     * the message will be sent in batches.\n      *\n-     * @param msg     the msg\n-     * @param timeout the timeout\n-     * @return the object\n-     * @throws TimeoutException the timeout exception\n+     * @param msg transaction message {@link io.seata.core.protocol}\n+     * @return server result message\n+     * @throws TimeoutException\n      */\n-    Object sendMsgWithResponse(Object msg, long timeout) throws TimeoutException;\n+    Object sendSyncRequest(Object msg) throws TimeoutException;\n \n     /**\n-     * Send msg with response object.\n+     * client send sync request.\n      *\n-     * @param serverAddress the server address\n-     * @param msg           the msg\n-     * @param timeout       the timeout\n-     * @return the object\n-     * @throws TimeoutException the timeout exception\n+     * @param channel client channel\n+     * @param msg     transaction message {@link io.seata.core.protocol}\n+     * @return server result message\n+     * @throws TimeoutException\n      */\n-    Object sendMsgWithResponse(String serverAddress, Object msg, long timeout) throws TimeoutException;\n+    Object sendSyncRequest(Channel channel, Object msg) throws TimeoutException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1NTgzNA==", "bodyText": "At that time, why the channel invaded the RemotingClient interface was also a helpless choice, because when called in many places, the various parameters were not uniform, it was difficult to remove the dependency of the channel. At that time, my idea was,\n\nRemotingClient as a top-level interface, when other rpc types are added in the future, their interfaces can be added to this top-level interface\nRemove the netty-related dependencies and make a RemotingClient that is truly irrelevant to the specific rpc type\nIn the end I chose the first and easiest method to refactor.\n\nI would like to add a pr later to improve it.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452255834", "createdAt": "2020-07-09T14:23:04Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/RemotingClient.java", "diffHunk": "@@ -33,43 +34,42 @@\n public interface RemotingClient {\n \n     /**\n-     * Send msg with response object.\n+     * client send sync request.\n+     * In this request, if {@link NettyClientConfig#isEnableClientBatchSendRequest} is enabled,\n+     * the message will be sent in batches.\n      *\n-     * @param msg     the msg\n-     * @param timeout the timeout\n-     * @return the object\n-     * @throws TimeoutException the timeout exception\n+     * @param msg transaction message {@link io.seata.core.protocol}\n+     * @return server result message\n+     * @throws TimeoutException\n      */\n-    Object sendMsgWithResponse(Object msg, long timeout) throws TimeoutException;\n+    Object sendSyncRequest(Object msg) throws TimeoutException;\n \n     /**\n-     * Send msg with response object.\n+     * client send sync request.\n      *\n-     * @param serverAddress the server address\n-     * @param msg           the msg\n-     * @param timeout       the timeout\n-     * @return the object\n-     * @throws TimeoutException the timeout exception\n+     * @param channel client channel\n+     * @param msg     transaction message {@link io.seata.core.protocol}\n+     * @return server result message\n+     * @throws TimeoutException\n      */\n-    Object sendMsgWithResponse(String serverAddress, Object msg, long timeout) throws TimeoutException;\n+    Object sendSyncRequest(Channel channel, Object msg) throws TimeoutException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxOTMyMA=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTE1OTI4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientBootstrap.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMjo1Mzo0MVrOGumqPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDowOTozNVrOGvS6Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyMTA4Nw==", "bodyText": "NettyClientBootstrap", "url": "https://github.com/seata/seata/pull/2540#discussion_r451521087", "createdAt": "2020-07-08T12:53:41Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientBootstrap.java", "diffHunk": "@@ -49,9 +49,9 @@\n  * @author slievrly\n  * @author zhaojun\n  */\n-public class RpcClientBootstrap implements RemotingBootstrap {\n+public class NettyClientBootstrap implements RemotingBootstrap {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractRpcRemotingClient.class);\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractNettyRemotingClient.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0NjAyMg==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452246022", "createdAt": "2020-07-09T14:09:35Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientBootstrap.java", "diffHunk": "@@ -49,9 +49,9 @@\n  * @author slievrly\n  * @author zhaojun\n  */\n-public class RpcClientBootstrap implements RemotingBootstrap {\n+public class NettyClientBootstrap implements RemotingBootstrap {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractRpcRemotingClient.class);\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractNettyRemotingClient.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyMTA4Nw=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTIwOTA1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/netty/NettyRemotingServer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMzowNjoxNVrOGunJYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNjoxNzowNFrOGvrIfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyOTA1OQ==", "bodyText": "Keep abstract, there will be netty Server between TC and TC, don't write business logic dead here", "url": "https://github.com/seata/seata/pull/2540#discussion_r451529059", "createdAt": "2020-07-08T13:06:15Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyRemotingServer.java", "diffHunk": "@@ -23,43 +23,105 @@\n import io.netty.handler.timeout.IdleState;\n import io.netty.handler.timeout.IdleStateEvent;\n import io.seata.common.util.NetUtil;\n+import io.seata.core.protocol.HeartbeatMessage;\n+import io.seata.core.protocol.MessageType;\n+import io.seata.core.protocol.ProtocolConstants;\n import io.seata.core.protocol.RpcMessage;\n-import io.seata.core.rpc.ChannelManager;\n+import io.seata.core.rpc.RegisterCheckAuthHandler;\n import io.seata.core.rpc.RemotingServer;\n import io.seata.core.rpc.RpcContext;\n import io.seata.core.rpc.TransactionMessageHandler;\n-import io.seata.core.rpc.processor.Pair;\n import io.seata.core.rpc.processor.RemotingProcessor;\n+import io.seata.core.rpc.processor.Pair;\n+import io.seata.core.rpc.processor.server.RegRmProcessor;\n+import io.seata.core.rpc.processor.server.RegTmProcessor;\n+import io.seata.core.rpc.processor.server.ServerHeartbeatProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnRequestProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnResponseProcessor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ThreadPoolExecutor;\n+import java.util.concurrent.TimeoutException;\n \n /**\n- * The type Rpc remoting server.\n+ * The netty remoting server.\n  *\n  * @author slievrly\n  * @author xingfudeshi@gmail.com\n  * @author zhangchenghui.dev@gmail.com\n  */\n-public abstract class AbstractRpcRemotingServer extends AbstractRpcRemoting implements RemotingServer {\n+public class NettyRemotingServer extends AbstractNettyRemoting implements RemotingServer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1NTcxMQ==", "bodyText": "You are right, I will roll back later.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452255711", "createdAt": "2020-07-09T14:22:53Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyRemotingServer.java", "diffHunk": "@@ -23,43 +23,105 @@\n import io.netty.handler.timeout.IdleState;\n import io.netty.handler.timeout.IdleStateEvent;\n import io.seata.common.util.NetUtil;\n+import io.seata.core.protocol.HeartbeatMessage;\n+import io.seata.core.protocol.MessageType;\n+import io.seata.core.protocol.ProtocolConstants;\n import io.seata.core.protocol.RpcMessage;\n-import io.seata.core.rpc.ChannelManager;\n+import io.seata.core.rpc.RegisterCheckAuthHandler;\n import io.seata.core.rpc.RemotingServer;\n import io.seata.core.rpc.RpcContext;\n import io.seata.core.rpc.TransactionMessageHandler;\n-import io.seata.core.rpc.processor.Pair;\n import io.seata.core.rpc.processor.RemotingProcessor;\n+import io.seata.core.rpc.processor.Pair;\n+import io.seata.core.rpc.processor.server.RegRmProcessor;\n+import io.seata.core.rpc.processor.server.RegTmProcessor;\n+import io.seata.core.rpc.processor.server.ServerHeartbeatProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnRequestProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnResponseProcessor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ThreadPoolExecutor;\n+import java.util.concurrent.TimeoutException;\n \n /**\n- * The type Rpc remoting server.\n+ * The netty remoting server.\n  *\n  * @author slievrly\n  * @author xingfudeshi@gmail.com\n  * @author zhangchenghui.dev@gmail.com\n  */\n-public abstract class AbstractRpcRemotingServer extends AbstractRpcRemoting implements RemotingServer {\n+public class NettyRemotingServer extends AbstractNettyRemoting implements RemotingServer {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyOTA1OQ=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY0Mjk0Mg==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r452642942", "createdAt": "2020-07-10T06:17:04Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyRemotingServer.java", "diffHunk": "@@ -23,43 +23,105 @@\n import io.netty.handler.timeout.IdleState;\n import io.netty.handler.timeout.IdleStateEvent;\n import io.seata.common.util.NetUtil;\n+import io.seata.core.protocol.HeartbeatMessage;\n+import io.seata.core.protocol.MessageType;\n+import io.seata.core.protocol.ProtocolConstants;\n import io.seata.core.protocol.RpcMessage;\n-import io.seata.core.rpc.ChannelManager;\n+import io.seata.core.rpc.RegisterCheckAuthHandler;\n import io.seata.core.rpc.RemotingServer;\n import io.seata.core.rpc.RpcContext;\n import io.seata.core.rpc.TransactionMessageHandler;\n-import io.seata.core.rpc.processor.Pair;\n import io.seata.core.rpc.processor.RemotingProcessor;\n+import io.seata.core.rpc.processor.Pair;\n+import io.seata.core.rpc.processor.server.RegRmProcessor;\n+import io.seata.core.rpc.processor.server.RegTmProcessor;\n+import io.seata.core.rpc.processor.server.ServerHeartbeatProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnRequestProcessor;\n+import io.seata.core.rpc.processor.server.ServerOnResponseProcessor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ThreadPoolExecutor;\n+import java.util.concurrent.TimeoutException;\n \n /**\n- * The type Rpc remoting server.\n+ * The netty remoting server.\n  *\n  * @author slievrly\n  * @author xingfudeshi@gmail.com\n  * @author zhangchenghui.dev@gmail.com\n  */\n-public abstract class AbstractRpcRemotingServer extends AbstractRpcRemoting implements RemotingServer {\n+public class NettyRemotingServer extends AbstractNettyRemoting implements RemotingServer {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyOTA1OQ=="}, "originalCommit": {"oid": "6e1ab479c801cf8d28f915da0d3823d4343f6cae"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjgzNjc4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmBranchRollbackProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOToyNToyMFrOGvweCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOTozOToyOVrOGvw5ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczMDM3Ng==", "bodyText": "Why change the name to handleUndoLogDelete?", "url": "https://github.com/seata/seata/pull/2540#discussion_r452730376", "createdAt": "2020-07-10T09:25:20Z", "author": {"login": "l81893521"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmBranchRollbackProcessor.java", "diffHunk": "@@ -55,19 +55,19 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle branch rollback process:\" + msg);\n         }\n-        handleBranchRollback(rpcMessage, remoteAddress, (BranchRollbackRequest) msg);\n+        handleUndoLogDelete(rpcMessage, remoteAddress, (BranchRollbackRequest) msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a96697d68ce54ef5407fe52668cc32fc55ed3aa9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczNzM4MQ==", "bodyText": "done", "url": "https://github.com/seata/seata/pull/2540#discussion_r452737381", "createdAt": "2020-07-10T09:39:29Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/processor/client/RmBranchRollbackProcessor.java", "diffHunk": "@@ -55,19 +55,19 @@ public void process(ChannelHandlerContext ctx, RpcMessage rpcMessage) throws Exc\n         if (LOGGER.isInfoEnabled()) {\n             LOGGER.info(\"rm handle branch rollback process:\" + msg);\n         }\n-        handleBranchRollback(rpcMessage, remoteAddress, (BranchRollbackRequest) msg);\n+        handleUndoLogDelete(rpcMessage, remoteAddress, (BranchRollbackRequest) msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczMDM3Ng=="}, "originalCommit": {"oid": "a96697d68ce54ef5407fe52668cc32fc55ed3aa9"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNjc5MTc3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegRmProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMDozNToyMFrOGwTKqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMjo1NTo0NlrOGwUC6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI5ODg1Nw==", "bodyText": "response", "url": "https://github.com/seata/seata/pull/2540#discussion_r453298857", "createdAt": "2020-07-12T10:35:20Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegRmProcessor.java", "diffHunk": "@@ -80,7 +80,7 @@ private void onRegRmMessage(ChannelHandlerContext ctx, RpcMessage rpcMessage) {\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        remotingServer.sendResponse(rpcMessage, ctx.channel(), response);\n+        remotingServer.sendAsyncResponse(rpcMessage, ctx.channel(), new RegisterRMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMxMzI1Ng==", "bodyText": "done", "url": "https://github.com/seata/seata/pull/2540#discussion_r453313256", "createdAt": "2020-07-12T12:55:46Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegRmProcessor.java", "diffHunk": "@@ -80,7 +80,7 @@ private void onRegRmMessage(ChannelHandlerContext ctx, RpcMessage rpcMessage) {\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        remotingServer.sendResponse(rpcMessage, ctx.channel(), response);\n+        remotingServer.sendAsyncResponse(rpcMessage, ctx.channel(), new RegisterRMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI5ODg1Nw=="}, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNjc5MzAwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegTmProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMDozNzoxMFrOGwTLRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMjo1NTo0NFrOGwUC2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI5OTAxNA==", "bodyText": "response", "url": "https://github.com/seata/seata/pull/2540#discussion_r453299014", "createdAt": "2020-07-12T10:37:10Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegTmProcessor.java", "diffHunk": "@@ -82,7 +82,7 @@ private void onRegTmMessage(ChannelHandlerContext ctx, RpcMessage rpcMessage) {\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        remotingServer.sendResponse(rpcMessage, ctx.channel(), response);\n+        remotingServer.sendAsyncResponse(rpcMessage, ctx.channel(), new RegisterTMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMxMzI0Mg==", "bodyText": "done.", "url": "https://github.com/seata/seata/pull/2540#discussion_r453313242", "createdAt": "2020-07-12T12:55:44Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/processor/server/RegTmProcessor.java", "diffHunk": "@@ -82,7 +82,7 @@ private void onRegTmMessage(ChannelHandlerContext ctx, RpcMessage rpcMessage) {\n         if (StringUtils.isNotEmpty(errorInfo)) {\n             response.setMsg(errorInfo);\n         }\n-        remotingServer.sendResponse(rpcMessage, ctx.channel(), response);\n+        remotingServer.sendAsyncResponse(rpcMessage, ctx.channel(), new RegisterTMResponse(isSuccess));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI5OTAxNA=="}, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNjgyMTI4OnYy", "diffSide": "LEFT", "path": "core/src/main/java/io/seata/core/rpc/netty/AbstractNettyRemotingServer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMToxNDoxOVrOGwTZaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxMjo1NTo0MVrOGwUCxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMwMjYzMw==", "bodyText": "vs  AbstractNettyRemotingClient, why remove Bootstrap?", "url": "https://github.com/seata/seata/pull/2540#discussion_r453302633", "createdAt": "2020-07-12T11:14:19Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/netty/AbstractNettyRemotingServer.java", "diffHunk": "@@ -23,96 +23,82 @@\n import io.netty.handler.timeout.IdleState;\n import io.netty.handler.timeout.IdleStateEvent;\n import io.seata.common.util.NetUtil;\n+import io.seata.core.protocol.HeartbeatMessage;\n+import io.seata.core.protocol.ProtocolConstants;\n import io.seata.core.protocol.RpcMessage;\n-import io.seata.core.rpc.ChannelManager;\n import io.seata.core.rpc.RemotingServer;\n import io.seata.core.rpc.RpcContext;\n-import io.seata.core.rpc.TransactionMessageHandler;\n import io.seata.core.rpc.processor.Pair;\n import io.seata.core.rpc.processor.RemotingProcessor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ThreadPoolExecutor;\n+import java.util.concurrent.TimeoutException;\n \n /**\n- * The type Rpc remoting server.\n+ * The type abstract remoting server.\n  *\n- * @author slievrly\n- * @author xingfudeshi@gmail.com\n  * @author zhangchenghui.dev@gmail.com\n+ * @since 1.3.0\n  */\n-public abstract class AbstractRpcRemotingServer extends AbstractRpcRemoting implements RemotingServer {\n+public abstract class AbstractNettyRemotingServer extends AbstractNettyRemoting implements RemotingServer {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractRpcRemotingServer.class);\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractNettyRemotingServer.class);\n \n-    private final RpcServerBootstrap serverBootstrap;\n-\n-    private TransactionMessageHandler transactionMessageHandler;\n-\n-    /**\n-     * Instantiates a new Rpc remoting server.\n-     *\n-     * @param messageExecutor   the message executor\n-     * @param nettyServerConfig the netty server config\n-     */\n-    public AbstractRpcRemotingServer(final ThreadPoolExecutor messageExecutor, NettyServerConfig nettyServerConfig) {\n+    public AbstractNettyRemotingServer(ThreadPoolExecutor messageExecutor) {\n         super(messageExecutor);\n-        serverBootstrap = new RpcServerBootstrap(nettyServerConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMxMzIyMw==", "bodyText": "Specific Bootstrap has subclasses to implement, for example, now put bootstarp in NettyRemotingServer.", "url": "https://github.com/seata/seata/pull/2540#discussion_r453313223", "createdAt": "2020-07-12T12:55:41Z", "author": {"login": "objcoding"}, "path": "core/src/main/java/io/seata/core/rpc/netty/AbstractNettyRemotingServer.java", "diffHunk": "@@ -23,96 +23,82 @@\n import io.netty.handler.timeout.IdleState;\n import io.netty.handler.timeout.IdleStateEvent;\n import io.seata.common.util.NetUtil;\n+import io.seata.core.protocol.HeartbeatMessage;\n+import io.seata.core.protocol.ProtocolConstants;\n import io.seata.core.protocol.RpcMessage;\n-import io.seata.core.rpc.ChannelManager;\n import io.seata.core.rpc.RemotingServer;\n import io.seata.core.rpc.RpcContext;\n-import io.seata.core.rpc.TransactionMessageHandler;\n import io.seata.core.rpc.processor.Pair;\n import io.seata.core.rpc.processor.RemotingProcessor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.util.concurrent.ExecutorService;\n import java.util.concurrent.ThreadPoolExecutor;\n+import java.util.concurrent.TimeoutException;\n \n /**\n- * The type Rpc remoting server.\n+ * The type abstract remoting server.\n  *\n- * @author slievrly\n- * @author xingfudeshi@gmail.com\n  * @author zhangchenghui.dev@gmail.com\n+ * @since 1.3.0\n  */\n-public abstract class AbstractRpcRemotingServer extends AbstractRpcRemoting implements RemotingServer {\n+public abstract class AbstractNettyRemotingServer extends AbstractNettyRemoting implements RemotingServer {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractRpcRemotingServer.class);\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractNettyRemotingServer.class);\n \n-    private final RpcServerBootstrap serverBootstrap;\n-\n-    private TransactionMessageHandler transactionMessageHandler;\n-\n-    /**\n-     * Instantiates a new Rpc remoting server.\n-     *\n-     * @param messageExecutor   the message executor\n-     * @param nettyServerConfig the netty server config\n-     */\n-    public AbstractRpcRemotingServer(final ThreadPoolExecutor messageExecutor, NettyServerConfig nettyServerConfig) {\n+    public AbstractNettyRemotingServer(ThreadPoolExecutor messageExecutor) {\n         super(messageExecutor);\n-        serverBootstrap = new RpcServerBootstrap(nettyServerConfig);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMwMjYzMw=="}, "originalCommit": {"oid": "41ebbe3c7df940b2039d4a7f5881fa203152bf82"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1528, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}