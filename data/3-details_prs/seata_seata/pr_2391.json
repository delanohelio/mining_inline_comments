{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NDU4ODg1", "number": 2391, "title": "bugfix: configuration exceptions lead to increased CPU usage", "bodyText": "\u2160. Describe what this PR did\noptimize file configuration reading\n\u2161. Does this pull request fix one issue?\n\n#2387\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-03-11T03:06:54Z", "url": "https://github.com/seata/seata/pull/2391", "merged": true, "mergeCommit": {"oid": "bd61afe0041717cd194e308a0ff231496af53771"}, "closed": true, "closedAt": "2020-03-17T08:36:01Z", "author": {"login": "a364176773"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMeLQMgH2gAyMzg2NDU4ODg1OjBlMzU3NGM3MWE1MjY5NWI0YTI4ZmM1MTE5MDJlM2FkYTM3NDE3NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOdQEMgFqTM3NTc4MTUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e3574c71a52695b4a28fc511902e3ada3741749", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/0e3574c71a52695b4a28fc511902e3ada3741749", "committedDate": "2020-03-11T03:02:37Z", "message": "optimize file configuration reading"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTczNTA5", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-372573509", "createdAt": "2020-03-11T09:01:49Z", "commit": {"oid": "0e3574c71a52695b4a28fc511902e3ada3741749"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTowMTo0OVrOF0uHZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTowMTo0OVrOF0uHZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyNTgzMQ==", "bodyText": "I think ScheduledExecutorService would be instantiate more time if I listen different config.", "url": "https://github.com/seata/seata/pull/2391#discussion_r390825831", "createdAt": "2020-03-11T09:01:49Z", "author": {"login": "l81893521"}, "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -306,7 +308,9 @@ public FileListener(String dataId, ConfigurationChangeListener listener) {\n \n         @Override\n         public void onChangeEvent(ConfigurationChangeEvent event) {\n-            while (true) {\n+            ScheduledExecutorService onChangeEventExecutor =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e3574c71a52695b4a28fc511902e3ada3741749"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9671e727ec5c9959d4e5f573eb8f34cce4411d69", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/9671e727ec5c9959d4e5f573eb8f34cce4411d69", "committedDate": "2020-03-11T09:12:47Z", "message": "optimize code logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf7e314577dd31fc0797dffb7586339e7e6166f7", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/bf7e314577dd31fc0797dffb7586339e7e6166f7", "committedDate": "2020-03-11T09:20:03Z", "message": "Merge branch 'develop' into fix_error_sleep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfbbacf97fd75cdd0bd6709011933c80ac5190dc", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/dfbbacf97fd75cdd0bd6709011933c80ac5190dc", "committedDate": "2020-03-11T12:11:57Z", "message": "adjust code logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b9bc5f7a6a4c4deff41633390a42203d00c75b4", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/7b9bc5f7a6a4c4deff41633390a42203d00c75b4", "committedDate": "2020-03-12T01:38:51Z", "message": "remove redundant abnormal output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzk3NjE0", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-373397614", "createdAt": "2020-03-12T09:34:33Z", "commit": {"oid": "7b9bc5f7a6a4c4deff41633390a42203d00c75b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTozNDozM1rOF1XFag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTozNDozM1rOF1XFag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NzA2Ng==", "bodyText": "use\nLOGGER.error\n\ninstead of\ne.printStackTrace();", "url": "https://github.com/seata/seata/pull/2391#discussion_r391497066", "createdAt": "2020-03-12T09:34:33Z", "author": {"login": "l81893521"}, "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -315,13 +315,17 @@ public void onChangeEvent(ConfigurationChangeEvent event) {\n                         event.setDataId(dataId).setNewValue(currentConfig).setOldValue(oldConfig);\n                         listener.onChangeEvent(event);\n                     }\n-                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n                 } catch (Exception exx) {\n-                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage(), exx);\n+                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage());\n+                }\n+                try {\n+                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n+                } catch (InterruptedException e) {\n+                    e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b9bc5f7a6a4c4deff41633390a42203d00c75b4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b99f2a4a9d2c74efb3e99d5919b2dacb8aa4c9f", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/0b99f2a4a9d2c74efb3e99d5919b2dacb8aa4c9f", "committedDate": "2020-03-12T09:38:52Z", "message": "adjust the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d8013c5bbe4deb3bff9f951abad936b8a2b35e3", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/6d8013c5bbe4deb3bff9f951abad936b8a2b35e3", "committedDate": "2020-03-12T09:40:50Z", "message": "Merge branch 'develop' into fix_error_sleep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTU2MTE0", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-373556114", "createdAt": "2020-03-12T13:31:46Z", "commit": {"oid": "6d8013c5bbe4deb3bff9f951abad936b8a2b35e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzozMTo0NlrOF1esIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzozMTo0NlrOF1esIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYyMTY2Ng==", "bodyText": "Please help correct the spelling by the way.Thank you!\nLISTENER_CONFIG_INTERNAL->LISTENER_CONFIG_INTERVAL", "url": "https://github.com/seata/seata/pull/2391#discussion_r391621666", "createdAt": "2020-03-12T13:31:46Z", "author": {"login": "xingfudeshi"}, "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -315,9 +315,13 @@ public void onChangeEvent(ConfigurationChangeEvent event) {\n                         event.setDataId(dataId).setNewValue(currentConfig).setOldValue(oldConfig);\n                         listener.onChangeEvent(event);\n                     }\n-                    Thread.sleep(LISTENER_CONFIG_INTERNAL);\n                 } catch (Exception exx) {\n-                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage(), exx);\n+                    LOGGER.error(\"fileListener execute error:{}\", exx.getMessage());\n+                }\n+                try {\n+                    Thread.sleep(LISTENER_CONFIG_INTERNAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8013c5bbe4deb3bff9f951abad936b8a2b35e3"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f522ec7fbc0a256df241ff8ffe684a96f4489c17", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/f522ec7fbc0a256df241ff8ffe684a96f4489c17", "committedDate": "2020-03-12T13:55:21Z", "message": "modify the variable name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODgwNzQ2", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-374880746", "createdAt": "2020-03-16T02:26:18Z", "commit": {"oid": "f522ec7fbc0a256df241ff8ffe684a96f4489c17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d23e59bf7b338d6ec1c5642150febdc4f56c9de", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/5d23e59bf7b338d6ec1c5642150febdc4f56c9de", "committedDate": "2020-03-17T05:17:14Z", "message": "Merge branch 'develop' into fix_error_sleep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f13fb0db51f35721a702f7bfe52b4eb1e510af66", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/f13fb0db51f35721a702f7bfe52b4eb1e510af66", "committedDate": "2020-03-17T05:28:45Z", "message": "Merge branch 'develop' into fix_error_sleep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzQ5MDg4", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-375749088", "createdAt": "2020-03-17T05:29:00Z", "commit": {"oid": "f13fb0db51f35721a702f7bfe52b4eb1e510af66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzgxNTM3", "url": "https://github.com/seata/seata/pull/2391#pullrequestreview-375781537", "createdAt": "2020-03-17T07:05:49Z", "commit": {"oid": "f13fb0db51f35721a702f7bfe52b4eb1e510af66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4083, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}