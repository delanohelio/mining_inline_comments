{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTkxNTMy", "number": 3116, "title": "feature:support configuring apolloService and apolloCluster", "bodyText": "\u2160. Describe what this PR did\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-09-15T10:16:10Z", "url": "https://github.com/seata/seata/pull/3116", "merged": true, "mergeCommit": {"oid": "20e21a1fd38f8e6c614db36e0f92228307b008f2"}, "closed": true, "closedAt": "2021-02-08T07:07:14Z", "author": {"login": "slinpq"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJFC-sAH2gAyNDg3MTkxNTMyOjI5OTYwNjE2NDg0OTlhNDJlN2Q3OTU5MTY3ZGY1MmRlYTE1YzRmYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd4B1-JgFqTU4NTIwNDk4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2996061648499a42e7d7959167df52dea15c4fc2", "author": {"user": {"login": "slinpq", "name": null}}, "url": "https://github.com/seata/seata/commit/2996061648499a42e7d7959167df52dea15c4fc2", "committedDate": "2020-09-15T10:15:20Z", "message": "support configuring apolloService and apolloCluster"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTU0MTQ2", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-488554146", "createdAt": "2020-09-15T10:44:28Z", "commit": {"oid": "2996061648499a42e7d7959167df52dea15c4fc2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo0NDoyOFrOHR7yrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMDo0NDo0N1rOHR7zPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzQ3MA==", "bodyText": "APOLLO_CLUSTER = \"seata\"  Is that better?", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567470", "createdAt": "2020-09-15T10:44:28Z", "author": {"login": "a364176773"}, "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -54,17 +54,21 @@\n     private static final String APP_ID = \"appId\";\n     private static final String APOLLO_META = \"apolloMeta\";\n     private static final String APOLLO_SECRET = \"apolloAccesskeySecret\";\n+    private static final String APOLLO_CLUSTER = \"cluster\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2996061648499a42e7d7959167df52dea15c4fc2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzU1MA==", "bodyText": "file", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567550", "createdAt": "2020-09-15T10:44:36Z", "author": {"login": "a364176773"}, "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -57,7 +57,7 @@ registry {\n \n config {\n   # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n-  type = \"file\"\n+  type = \"apollo\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2996061648499a42e7d7959167df52dea15c4fc2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzYxNQ==", "bodyText": "cluster = \"seata\"  Is that better?", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567615", "createdAt": "2020-09-15T10:44:47Z", "author": {"login": "a364176773"}, "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -71,9 +71,12 @@ config {\n   }\n   apollo {\n     appId = \"seata-server\"\n+    ## apolloConfigService will cover apolloMeta\n     apolloMeta = \"http://192.168.1.204:8801\"\n+    apolloConfigService = \"http://192.168.1.204:8080\"\n     namespace = \"application\"\n     apolloAccesskeySecret = \"\"\n+    cluster = \"cluster\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2996061648499a42e7d7959167df52dea15c4fc2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e8288e8a45affd83eda14c4ca9c360f906bb18d", "author": {"user": {"login": "slinpq", "name": null}}, "url": "https://github.com/seata/seata/commit/8e8288e8a45affd83eda14c4ca9c360f906bb18d", "committedDate": "2020-09-15T11:18:08Z", "message": "support configuring apolloService and apolloCluster"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjEzMTEz", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-489213113", "createdAt": "2020-09-16T01:32:21Z", "commit": {"oid": "8e8288e8a45affd83eda14c4ca9c360f906bb18d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTozMjoyMVrOHSc02A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTozMjoyOVrOHSc0_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng==", "bodyText": "If the value is \"\"?", "url": "https://github.com/seata/seata/pull/3116#discussion_r489108696", "createdAt": "2020-09-16T01:32:21Z", "author": {"login": "a364176773"}, "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -176,6 +180,12 @@ private void readyApolloConfig() {\n                 System.setProperty(PROP_APOLLO_SECRET, secretKey);\n             }\n         }\n+        if (!properties.containsKey(APOLLO_CLUSTER)) {\n+            System.setProperty(PROP_APOLLO_CLUSTER, FILE_CONFIG.getConfig(getApolloCluster()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8288e8a45affd83eda14c4ca9c360f906bb18d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODczMw==", "bodyText": "If the value is \"\"?", "url": "https://github.com/seata/seata/pull/3116#discussion_r489108733", "createdAt": "2020-09-16T01:32:29Z", "author": {"login": "a364176773"}, "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -176,6 +180,12 @@ private void readyApolloConfig() {\n                 System.setProperty(PROP_APOLLO_SECRET, secretKey);\n             }\n         }\n+        if (!properties.containsKey(APOLLO_CLUSTER)) {\n+            System.setProperty(PROP_APOLLO_CLUSTER, FILE_CONFIG.getConfig(getApolloCluster()));\n+        }\n+        if (!properties.containsKey(APOLLO_CONFIG_SERVICE)) {\n+            System.setProperty(PROP_APOLLO_CONFIG_SERVICE, FILE_CONFIG.getConfig(getApolloConfigService()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8288e8a45affd83eda14c4ca9c360f906bb18d"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17e68e5d35353a9ce0be2f23711b389557eba097", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/17e68e5d35353a9ce0be2f23711b389557eba097", "committedDate": "2020-09-18T06:21:29Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cc910849dc69535e72584361708968480563bed", "author": {"user": {"login": "slinpq", "name": null}}, "url": "https://github.com/seata/seata/commit/5cc910849dc69535e72584361708968480563bed", "committedDate": "2020-09-18T06:50:41Z", "message": "support configuring apolloService and apolloCluster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5b8ee740827f2479b8f51e0b7e709edee5bcdb5", "author": {"user": {"login": "slinpq", "name": null}}, "url": "https://github.com/seata/seata/commit/f5b8ee740827f2479b8f51e0b7e709edee5bcdb5", "committedDate": "2020-09-18T06:50:57Z", "message": "Merge branch 'develop' of https://github.com/slinpq/seata into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aff33542f6221251f8c33c1af29673b1f102110", "author": {"user": {"login": "slinpq", "name": null}}, "url": "https://github.com/seata/seata/commit/6aff33542f6221251f8c33c1af29673b1f102110", "committedDate": "2020-09-21T08:48:41Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzOTk5MzQ4", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-493999348", "createdAt": "2020-09-23T03:12:31Z", "commit": {"oid": "6aff33542f6221251f8c33c1af29673b1f102110"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737a85003840d94b3dfe61a9a018a687591c83bb", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/737a85003840d94b3dfe61a9a018a687591c83bb", "committedDate": "2020-09-28T09:33:15Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83e7cddebab597b04132a186ca002693b0257f48", "author": {"user": {"login": "xingfudeshi", "name": "xingfudeshi"}}, "url": "https://github.com/seata/seata/commit/83e7cddebab597b04132a186ca002693b0257f48", "committedDate": "2020-10-01T13:18:09Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzM4MTM5", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-500338139", "createdAt": "2020-10-01T13:20:17Z", "commit": {"oid": "83e7cddebab597b04132a186ca002693b0257f48"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzoyMDoxN1rOHbKCVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzoyMDoxN1rOHbKCVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIzODAzOA==", "bodyText": "Pls Give it a initial size.", "url": "https://github.com/seata/seata/pull/3116#discussion_r498238038", "createdAt": "2020-10-01T13:20:17Z", "author": {"login": "xingfudeshi"}, "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -54,17 +54,21 @@\n     private static final String APP_ID = \"appId\";\n     private static final String APOLLO_META = \"apolloMeta\";\n     private static final String APOLLO_SECRET = \"apolloAccesskeySecret\";\n+    private static final String APOLLO_CLUSTER = \"seata\";\n+    private static final String APOLLO_CONFIG_SERVICE = \"apolloConfigService\";\n     private static final String PROP_APP_ID = \"app.id\";\n     private static final String PROP_APOLLO_META = \"apollo.meta\";\n+    private static final String PROP_APOLLO_CONFIG_SERVICE = \"apollo.configService\";\n     private static final String PROP_APOLLO_SECRET = \"apollo.accesskey.secret\";\n+    private static final String PROP_APOLLO_CLUSTER = \"apollo.cluster\";\n     private static final String NAMESPACE = \"namespace\";\n     private static final String DEFAULT_NAMESPACE = \"application\";\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile Config config;\n     private ExecutorService configOperateExecutor;\n     private static final int CORE_CONFIG_OPERATE_THREAD = 1;\n     private static final ConcurrentMap<String, Set<ConfigurationChangeListener>> LISTENER_SERVICE_MAP\n-        = new ConcurrentHashMap<>();\n+            = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83e7cddebab597b04132a186ca002693b0257f48"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzM4NTMz", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-500338533", "createdAt": "2020-10-01T13:20:41Z", "commit": {"oid": "83e7cddebab597b04132a186ca002693b0257f48"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzQwNTEw", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-500340510", "createdAt": "2020-10-01T13:22:47Z", "commit": {"oid": "83e7cddebab597b04132a186ca002693b0257f48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cdf6caef34ce31ca5774e11ca937568c1f84eb9", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2cdf6caef34ce31ca5774e11ca937568c1f84eb9", "committedDate": "2020-10-10T07:57:41Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f6a6aca9eb51ecc73b2b3f2865919852fb4b31", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/91f6a6aca9eb51ecc73b2b3f2865919852fb4b31", "committedDate": "2020-11-11T01:27:35Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2208a5f4b9c22dcfc48d929bb54559dbc7923c57", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2208a5f4b9c22dcfc48d929bb54559dbc7923c57", "committedDate": "2020-11-22T12:52:19Z", "message": "Merge branch 'develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg1MjA0OTgz", "url": "https://github.com/seata/seata/pull/3116#pullrequestreview-585204983", "createdAt": "2021-02-08T07:05:51Z", "commit": {"oid": "2208a5f4b9c22dcfc48d929bb54559dbc7923c57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3659, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}