{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NDAzNDE5", "number": 3117, "title": "optimize:make log more clearly and remove the useless code", "bodyText": "\u2160. Describe what this PR did\nmake log more clearly and remove the useless code\n\u2161. Does this pull request fix one issue?\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-09-15T16:07:05Z", "url": "https://github.com/seata/seata/pull/3117", "merged": true, "mergeCommit": {"oid": "9d7d0aed5fd4a10782f79f729412d451a6b0ec84"}, "closed": true, "closedAt": "2020-10-17T12:43:03Z", "author": {"login": "PeineLiang"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJKD6ugH2gAyNDg3NDAzNDE5OmRmY2QzOGE0NmI3ZTFjZGUzNGM5Y2JkNmMyN2YzY2E4MmU5ZjllMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTZce4AH2gAyNDg3NDAzNDE5OjJiNTk4YTViZDQxYmU5NTJlNjkwZWRhZWRhYWRmMTljMDczZDJiMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04", "committedDate": "2020-09-15T16:05:53Z", "message": "optimize:make log more clearly and remove the useless code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjAzNDQ3", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-489203447", "createdAt": "2020-09-16T01:00:28Z", "commit": {"oid": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjA3Mzkx", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-489207391", "createdAt": "2020-09-16T01:13:52Z", "commit": {"oid": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMToxMzo1MlrOHScgVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMToxMzo1MlrOHScgVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwMzQ0NA==", "bodyText": "\u5982\u679cserviceGroup\u4e3a\u7a7a\uff0c\u660e\u786e\u63d0\u793a\u7528\u6237\u672a\u914d\u7f6eservice.vgroupMapping.${transactionServiceGroup}\u662f\u5426\u4f1a\u66f4\u597d\uff1f", "url": "https://github.com/seata/seata/pull/3117#discussion_r489103444", "createdAt": "2020-09-16T01:13:52Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -167,7 +167,7 @@ void reconnect(String transactionServiceGroup) {\n         if (CollectionUtils.isEmpty(availList)) {\n             String serviceGroup = RegistryFactory.getInstance()\n                                                  .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n+            LOGGER.error(\"no available service '{}' found in service group '{}', please make sure registry config correct\", serviceGroup, transactionServiceGroup);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfcd38a46b7e1cde34c9cbd6c27f3ca82e9f9e04"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6484a6164a31fad45955ac58ef59726f8e2fdf2", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/c6484a6164a31fad45955ac58ef59726f8e2fdf2", "committedDate": "2020-09-17T05:58:15Z", "message": "Merge branch 'develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b72d5411434402fe3e07f3f75f263c93a32c00dc", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/b72d5411434402fe3e07f3f75f263c93a32c00dc", "committedDate": "2020-09-23T02:15:30Z", "message": "optimize:make log more clearly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef2792a40efabc41b28aaaa84b05d63089dd45a", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/8ef2792a40efabc41b28aaaa84b05d63089dd45a", "committedDate": "2020-09-23T02:16:08Z", "message": "Merge remote-tracking branch 'origin/optimize' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73ff3c658a7d0a9d27bc7ae04bae94b967e6182", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/b73ff3c658a7d0a9d27bc7ae04bae94b967e6182", "committedDate": "2020-09-23T02:18:59Z", "message": "Merge remote-tracking branch 'seata/develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0f64e985526600ab1b2253bdef182a4c4c86f39", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/e0f64e985526600ab1b2253bdef182a4c4c86f39", "committedDate": "2020-09-23T02:32:43Z", "message": "Revert \"optimize:make log more clearly\"\n\nThis reverts commit b72d541"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd352764c5ac542de33b2480d303624dda03885a", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/bd352764c5ac542de33b2480d303624dda03885a", "committedDate": "2020-09-23T02:33:22Z", "message": "optimize:make log more clearly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MDEwODI3", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-494010827", "createdAt": "2020-09-23T03:53:50Z", "commit": {"oid": "bd352764c5ac542de33b2480d303624dda03885a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMzo1Mzo1MFrOHWVZvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMzo1Mzo1MFrOHWVZvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE4MTM3Mw==", "bodyText": "if use third registry center ,will not read this configuration item.", "url": "https://github.com/seata/seata/pull/3117#discussion_r493181373", "createdAt": "2020-09-23T03:53:50Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +167,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            String clusterName = RegistryFactory.getInstance().getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isNotBlank(clusterName)) {\n+                LOGGER.error(\"no available service found in cluster '{}{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_PREFIX,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd352764c5ac542de33b2480d303624dda03885a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf72e9de18fb5a7fd553727ba853c265b7f13c3", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/bbf72e9de18fb5a7fd553727ba853c265b7f13c3", "committedDate": "2020-09-24T15:17:26Z", "message": "Merge remote-tracking branch 'seata/develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04ab08fac800b3915aa93141afffbd7b67466787", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/04ab08fac800b3915aa93141afffbd7b67466787", "committedDate": "2020-09-24T16:25:17Z", "message": "optimize:make log more clearly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7ca0965a1312c39c4f093a1eddf11de8187d786", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/c7ca0965a1312c39c4f093a1eddf11de8187d786", "committedDate": "2020-09-24T16:28:30Z", "message": "Revert \"optimize:make log more clearly\"\n\nThis reverts commit 04ab08f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c2a5b8f0c0583cc90ab349094af61ecfa7140a", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/81c2a5b8f0c0583cc90ab349094af61ecfa7140a", "committedDate": "2020-09-24T16:29:03Z", "message": "optimize:make log more clearly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa609fbea451cae77119ad6ac49da4b89f75bff", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/efa609fbea451cae77119ad6ac49da4b89f75bff", "committedDate": "2020-09-28T09:32:02Z", "message": "Merge branch 'develop' into optimize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzQxNTMz", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-497341533", "createdAt": "2020-09-28T09:32:42Z", "commit": {"oid": "efa609fbea451cae77119ad6ac49da4b89f75bff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzYyODMy", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-497362832", "createdAt": "2020-09-28T09:59:46Z", "commit": {"oid": "efa609fbea451cae77119ad6ac49da4b89f75bff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTo1OTo0NlrOHY2w2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTo1OTo0NlrOHY2w2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgyNTExMw==", "bodyText": "cant no -> can't", "url": "https://github.com/seata/seata/pull/3117#discussion_r495825113", "createdAt": "2020-09-28T09:59:46Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"cant no get cluster name in registry config '{}{}', please make sure registry config correct\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efa609fbea451cae77119ad6ac49da4b89f75bff"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6629bf55bc632d47b648207dd542adc8188413", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/2b6629bf55bc632d47b648207dd542adc8188413", "committedDate": "2020-09-28T14:43:45Z", "message": "Merge remote-tracking branch 'seata/develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf870b719c76ad8cfb2e8291aa02ed9d62db3041", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/bf870b719c76ad8cfb2e8291aa02ed9d62db3041", "committedDate": "2020-09-28T14:47:13Z", "message": "optimize:fix word"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/cd7ee1b1a4e4a7b264799ab9e62b236fee980e04", "committedDate": "2020-09-28T14:47:24Z", "message": "Merge remote-tracking branch 'origin/optimize' into optimize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDI0MzI2", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-498024326", "createdAt": "2020-09-29T02:38:51Z", "commit": {"oid": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDI0ODAy", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-498024802", "createdAt": "2020-09-29T02:40:29Z", "commit": {"oid": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMjo0MDoyOVrOHZWekw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMjo0MDoyOVrOHZWekw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjM0NDcyMw==", "bodyText": "line 185: return;\nIf missed, it may throw NPE.", "url": "https://github.com/seata/seata/pull/3117#discussion_r496344723", "createdAt": "2020-09-29T02:40:29Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,10 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n-            return;\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"can not get cluster name in registry config '{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_GROUP_MAPPING_PREFIX,\n+                        transactionServiceGroup);\n+                return;\n+            }\n+\n+            if (!(registryService instanceof FileRegistryServiceImpl)) {\n+                LOGGER.error(\"no available service found, please make sure registry config correct and keep your seata server running\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd7ee1b1a4e4a7b264799ab9e62b236fee980e04"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21071195d17add28ae85ff69438811e1ca31e9e3", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/21071195d17add28ae85ff69438811e1ca31e9e3", "committedDate": "2020-09-29T03:15:20Z", "message": "optimize:add return;"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDM1ODMx", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-498035831", "createdAt": "2020-09-29T03:17:38Z", "commit": {"oid": "21071195d17add28ae85ff69438811e1ca31e9e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTI3NzU1", "url": "https://github.com/seata/seata/pull/3117#pullrequestreview-498127755", "createdAt": "2020-09-29T06:23:18Z", "commit": {"oid": "21071195d17add28ae85ff69438811e1ca31e9e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNjoyMzoxOFrOHZci_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNjoyMzoxOFrOHZci_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NDE1Nw==", "bodyText": "Is it better to prompt the cluster name here?", "url": "https://github.com/seata/seata/pull/3117#discussion_r496444157", "createdAt": "2020-09-29T06:23:18Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/rpc/netty/NettyClientChannelManager.java", "diffHunk": "@@ -165,9 +169,19 @@ void reconnect(String transactionServiceGroup) {\n             return;\n         }\n         if (CollectionUtils.isEmpty(availList)) {\n-            String serviceGroup = RegistryFactory.getInstance()\n-                                                 .getServiceGroup(transactionServiceGroup);\n-            LOGGER.error(\"no available service '{}' found, please make sure registry config correct\", serviceGroup);\n+            RegistryService registryService = RegistryFactory.getInstance();\n+            String clusterName = registryService.getServiceGroup(transactionServiceGroup);\n+\n+            if (StringUtils.isBlank(clusterName)) {\n+                LOGGER.error(\"can not get cluster name in registry config '{}{}', please make sure registry config correct\",\n+                        ConfigurationKeys.SERVICE_GROUP_MAPPING_PREFIX,\n+                        transactionServiceGroup);\n+                return;\n+            }\n+\n+            if (!(registryService instanceof FileRegistryServiceImpl)) {\n+                LOGGER.error(\"no available service found, please make sure registry config correct and keep your seata server running\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21071195d17add28ae85ff69438811e1ca31e9e3"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a123f296ed36f7c8a5b95bdb762793f376215252", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/a123f296ed36f7c8a5b95bdb762793f376215252", "committedDate": "2020-10-06T08:34:19Z", "message": "Merge remote-tracking branch 'seata/develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1e5359ef0e2448a222a54a8df37a379c72b98b", "author": {"user": {"login": "PeineLiang", "name": "Peine"}}, "url": "https://github.com/seata/seata/commit/3b1e5359ef0e2448a222a54a8df37a379c72b98b", "committedDate": "2020-10-06T08:36:36Z", "message": "optimize:add cluster name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8441ba01924f4a3845d7e9cbd99ce392c327a7", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/cc8441ba01924f4a3845d7e9cbd99ce392c327a7", "committedDate": "2020-10-17T11:22:42Z", "message": "Merge branch 'develop' into optimize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b598a5bd41be952e690edaedaadf19c073d2b38", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2b598a5bd41be952e690edaedaadf19c073d2b38", "committedDate": "2020-10-17T11:40:32Z", "message": "Merge branch 'develop' into optimize"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3662, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}