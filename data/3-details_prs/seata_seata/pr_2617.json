{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MTAzNjIx", "number": 2617, "title": "bugfix: fix incorrect getAnnotation about class and method", "bodyText": "\u2160. Describe what this PR did\nbug fix for getAnnotation\n1.\u7c7b\u4e0a\u6709\u6ce8\u89e3,\u65b9\u6cd5\u65e0 \u53ef\u6b63\u5e38\u8fd0\u884c\n2.\u65b9\u6cd5\u6709\u6ce8\u89e3,\u7c7b\u4e0a\u65e0 \u53ef\u6b63\u5e38\u8fd0\u884c\n3.\u7c7b\u4e0a\u65b9\u6cd5\u4e0a\u90fd\u6709,\u4f18\u5148\u8bfb\u53d6\u65b9\u6cd5\u4e0a\u6ce8\u89e3 \u53ef\u6b63\u5e38\u8fd0\u884c\n4.\u57fa\u7c7b\u65b9\u6cd5\u8c03\u7528\u65f6,\u6392\u9664\u57fa\u7c7b\u8c03\u7528 \u53ef\u6b63\u5e38\u8fd0\u884c\n5.\u7c7b\u91cd\u5199\u57fa\u7c7b\u65b9\u6cd5,\u6bd4\u5982toString\u540e,\u91cd\u5199\u7684\u65b9\u6cd5\u5c5e\u4e8e\u672c\u7c7b\u65b9\u6cd5,\u56e0\u6b64\u4f1a\u5f00\u542f\u5168\u5c40\u4e8b\u52a1.\n\u2161. Does this pull request fix one issue?\n\nfix #2562\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-04-26T15:33:36Z", "url": "https://github.com/seata/seata/pull/2617", "merged": true, "mergeCommit": {"oid": "a627e3624b04ec115bf68122fa56c36ed8f4b43c"}, "closed": true, "closedAt": "2020-05-19T04:35:47Z", "author": {"login": "a364176773"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbceRvgH2gAyNDA5MTAzNjIxOmFkYzAyNGM1Nzg0OTZmYTQ1YmFiMDJjOWZhYmFkYTQ1ZDhkNzFmM2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcirutvgFqTQxNDA3MzEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "adc024c578496fa45bab02c9fabada45d8d71f3c", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/adc024c578496fa45bab02c9fabada45d8d71f3c", "committedDate": "2020-04-26T15:32:27Z", "message": "fix bug for getAnnotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aeaab270cd29cb40860e8cc3fbeac78924ebfb3", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2aeaab270cd29cb40860e8cc3fbeac78924ebfb3", "committedDate": "2020-04-27T01:57:21Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNTkzMTQz", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-400593143", "createdAt": "2020-04-27T02:35:37Z", "commit": {"oid": "2aeaab270cd29cb40860e8cc3fbeac78924ebfb3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwMjozNTozOFrOGMOR5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwMjozNTozOFrOGMOR5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MDA1Mw==", "bodyText": "How about to use lambda for more readable like :\n        return Optional.ofNullable(method)\n                       .map(m -> m.getAnnotation(annotationClass))\n                       .orElse(Optional.ofNullable(targetClass)\n                                       .map(t -> t.getAnnotation(annotationClass))\n                                       .orElse(null));", "url": "https://github.com/seata/seata/pull/2617#discussion_r415470053", "createdAt": "2020-04-27T02:35:38Z", "author": {"login": "helloworlde"}, "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionalInterceptor.java", "diffHunk": "@@ -166,8 +165,11 @@ public TransactionInfo getTransactionInfo() {\n     }\n \n     private <T extends Annotation> T getAnnotation(Method method, Class<?> targetClass, Class<T> annotationClass) {\n-        return method == null ? targetClass == null ? null : targetClass.getAnnotation(annotationClass)\n-            : method.getAnnotation(annotationClass);\n+        T annotation = null == method ? null : method.getAnnotation(annotationClass);\n+        if (null == annotation) {\n+            annotation = null == targetClass ? null : targetClass.getAnnotation(annotationClass);\n+        }\n+        return annotation;\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aeaab270cd29cb40860e8cc3fbeac78924ebfb3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc03cd99040aa273da35d10737c81e70621c9beb", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/fc03cd99040aa273da35d10737c81e70621c9beb", "committedDate": "2020-04-27T03:32:45Z", "message": "optimize code, add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f526dc7a0857c4d800e64b6dcecaf86b7bd636a5", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/f526dc7a0857c4d800e64b6dcecaf86b7bd636a5", "committedDate": "2020-04-27T03:33:39Z", "message": "Merge branch 'element_type' of https://github.com/a364176773/seata into element_type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjQyNDc2", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-400642476", "createdAt": "2020-04-27T05:50:34Z", "commit": {"oid": "f526dc7a0857c4d800e64b6dcecaf86b7bd636a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjQ5NTM0", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-400649534", "createdAt": "2020-04-27T06:09:24Z", "commit": {"oid": "f526dc7a0857c4d800e64b6dcecaf86b7bd636a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23b912f591519bc4d435030d716e35ce089b6146", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/23b912f591519bc4d435030d716e35ce089b6146", "committedDate": "2020-04-27T06:09:38Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f9431b62ae3d853b729ef9b24b656ac79ad40e2", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/3f9431b62ae3d853b729ef9b24b656ac79ad40e2", "committedDate": "2020-04-27T07:51:58Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b6b48c69202d6695e2993b6f5d910f0d375177", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/42b6b48c69202d6695e2993b6f5d910f0d375177", "committedDate": "2020-04-27T08:26:50Z", "message": "optimize test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717c87397c06e46b779616f274125bb0112d3328", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/717c87397c06e46b779616f274125bb0112d3328", "committedDate": "2020-04-27T08:47:36Z", "message": "optimize test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzgwNzI1", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-400780725", "createdAt": "2020-04-27T09:30:11Z", "commit": {"oid": "717c87397c06e46b779616f274125bb0112d3328"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTozMDoxMVrOGMZuyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOTozMDoxMVrOGMZuyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1NzY3NQ==", "bodyText": "The global variable declare in testGetAnnotation method?", "url": "https://github.com/seata/seata/pull/2617#discussion_r415657675", "createdAt": "2020-04-27T09:30:11Z", "author": {"login": "jsbxyyx"}, "path": "spring/src/test/java/io/seata/spring/annotation/MethodDescTest.java", "diffHunk": "@@ -37,6 +36,8 @@\n     private static Class<?> targetClass = null;\n     private static GlobalTransactional transactional = null;\n \n+    private static final GlobalTransactionalInterceptor globalTransactionalInterceptor=new GlobalTransactionalInterceptor(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "717c87397c06e46b779616f274125bb0112d3328"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6067713a03cf4e50d1bb295cd5d8e569e1435dce", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/6067713a03cf4e50d1bb295cd5d8e569e1435dce", "committedDate": "2020-04-27T09:37:41Z", "message": "modify test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwODEyMDgy", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-400812082", "createdAt": "2020-04-27T10:12:30Z", "commit": {"oid": "6067713a03cf4e50d1bb295cd5d8e569e1435dce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c4dce15b844a1362cd86a0654a581c5189159b5", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/6c4dce15b844a1362cd86a0654a581c5189159b5", "committedDate": "2020-04-28T01:22:25Z", "message": "modify test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2019034e9957b501d71687ac279da0cf46115d34", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/2019034e9957b501d71687ac279da0cf46115d34", "committedDate": "2020-04-28T01:57:27Z", "message": "add support for read annotation on class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df690b658d27d92ac46adab0aaaa9cfb6709ec10", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/df690b658d27d92ac46adab0aaaa9cfb6709ec10", "committedDate": "2020-04-28T07:52:10Z", "message": "exclude base class methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b7c08bf840a06567452f0f49fe09a29230b3c1", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/d9b7c08bf840a06567452f0f49fe09a29230b3c1", "committedDate": "2020-04-29T02:57:30Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd97f2755955a085358187de5c91405256b5610", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/cfd97f2755955a085358187de5c91405256b5610", "committedDate": "2020-04-29T07:52:48Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cd04d12b32bff3438c9a1576a2700d9b2cef5d9", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/3cd04d12b32bff3438c9a1576a2700d9b2cef5d9", "committedDate": "2020-05-03T05:12:59Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24dcb4698aae059c08fc4866142fc2d1268575c0", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/24dcb4698aae059c08fc4866142fc2d1268575c0", "committedDate": "2020-05-04T06:49:32Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10c866a9a7abe85157e21900759a98a433ce1c9a", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/10c866a9a7abe85157e21900759a98a433ce1c9a", "committedDate": "2020-05-05T02:34:25Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc1bfa36aa06e92aa871cce06eb140cca2a11fb2", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/bc1bfa36aa06e92aa871cce06eb140cca2a11fb2", "committedDate": "2020-05-06T01:15:46Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "274d71e715b3f1023202784590184e5d6cb36a0a", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/274d71e715b3f1023202784590184e5d6cb36a0a", "committedDate": "2020-05-08T08:00:56Z", "message": "resolve conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25817708b43e158a14673fc3f27b1c650b04ed0e", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/25817708b43e158a14673fc3f27b1c650b04ed0e", "committedDate": "2020-05-18T03:43:03Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271e5048a31f57fde4920ddd67c27876f9883c0c", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/271e5048a31f57fde4920ddd67c27876f9883c0c", "committedDate": "2020-05-19T01:22:53Z", "message": "Merge branch 'develop' into element_type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "268ac711755b09510330143b457cc73e4aa9caa0", "author": {"user": {"login": "a364176773", "name": "FUNKYE"}}, "url": "https://github.com/seata/seata/commit/268ac711755b09510330143b457cc73e4aa9caa0", "committedDate": "2020-05-19T02:32:50Z", "message": "add test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MDczMTAw", "url": "https://github.com/seata/seata/pull/2617#pullrequestreview-414073100", "createdAt": "2020-05-19T03:16:27Z", "commit": {"oid": "268ac711755b09510330143b457cc73e4aa9caa0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3937, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}