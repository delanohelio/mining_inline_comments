{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDIyMTcx", "number": 3241, "title": "bugfix: forbidden use order by or limit in multi sql", "bodyText": "\u2160. Describe what this PR did\nif multi sql contains order by or limit, throws NotSupportYetException to notic user\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-10-29T16:57:01Z", "url": "https://github.com/seata/seata/pull/3241", "merged": true, "mergeCommit": {"oid": "08fbcef5314e212d1b40a2509640316bab57b733"}, "closed": true, "closedAt": "2020-12-24T06:47:06Z", "author": {"login": "caohdgege"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXU8hXAH2gAyNTEyNDIyMTcxOjMzNjFhM2NjMjYwZTJiZDFmZWM5OTE1ZjFlNjU2MGNiZmNhYTJlMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpN4_sgFqTU1ODM3MTQyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3361a3cc260e2bd1fec9915f1e6560cbfcaa2e36", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/3361a3cc260e2bd1fec9915f1e6560cbfcaa2e36", "committedDate": "2020-10-29T16:41:42Z", "message": "bugfix: should throws ex if multi sql contains order by or limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48314a678593329d6e7ccde5d698b08ffa47ca1", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/c48314a678593329d6e7ccde5d698b08ffa47ca1", "committedDate": "2020-10-29T16:47:20Z", "message": "bugfix: add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a0c8750d827e8d4192369915e84a583a56d2eda", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/2a0c8750d827e8d4192369915e84a583a56d2eda", "committedDate": "2020-10-29T16:49:15Z", "message": "fix: ci err"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f70246e79e163e053df2bc670b519a67abdef9", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/e7f70246e79e163e053df2bc670b519a67abdef9", "committedDate": "2020-10-29T16:50:17Z", "message": "fix: ci err"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef1ae6ed19ebf966ef147e572061ae460c885724", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/ef1ae6ed19ebf966ef147e572061ae460c885724", "committedDate": "2020-10-29T16:55:00Z", "message": "test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd44cce2761e93249bb734e08102398d833c3a9", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/bfd44cce2761e93249bb734e08102398d833c3a9", "committedDate": "2020-11-01T16:31:45Z", "message": "Merge branch 'develop' into bugfix-1030"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d87f8e10b66c5d4007c975c894a738fb0f10ca2b", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/d87f8e10b66c5d4007c975c894a738fb0f10ca2b", "committedDate": "2020-11-06T06:49:45Z", "message": "Merge branch 'develop' into bugfix-1030"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/33242f2953002c15baa4d70908f1563aaf46206f", "committedDate": "2020-11-07T03:30:01Z", "message": "fix: ci ex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwOTAxMzgx", "url": "https://github.com/seata/seata/pull/3241#pullrequestreview-530901381", "createdAt": "2020-11-16T03:37:14Z", "commit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMzozNzoxNFrOHznTlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMzozNzoyNFrOHznTwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzQxMw==", "bodyText": "NotSupportYetException ?", "url": "https://github.com/seata/seata/pull/3241#discussion_r523883413", "createdAt": "2020-11-16T03:37:14Z", "author": {"login": "jsbxyyx"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiDeleteExecutor.java", "diffHunk": "@@ -55,6 +57,15 @@ protected TableRecords beforeImage() throws SQLException {\n         for (SQLRecognizer recognizer : sqlRecognizers) {\n             sqlRecognizer = recognizer;\n             SQLDeleteRecognizer visitor = (SQLDeleteRecognizer) recognizer;\n+\n+            ParametersHolder parametersHolder = statementProxy instanceof ParametersHolder ? (ParametersHolder)statementProxy : null;\n+            if (StringUtils.isNotBlank(visitor.getLimit(parametersHolder, paramAppenderList))) {\n+                throw new ShouldNeverHappenException(\"Multi delete SQL should not contains limit condition !\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzQxOA==", "bodyText": "NotSupportYetException ?", "url": "https://github.com/seata/seata/pull/3241#discussion_r523883418", "createdAt": "2020-11-16T03:37:16Z", "author": {"login": "jsbxyyx"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiDeleteExecutor.java", "diffHunk": "@@ -55,6 +57,15 @@ protected TableRecords beforeImage() throws SQLException {\n         for (SQLRecognizer recognizer : sqlRecognizers) {\n             sqlRecognizer = recognizer;\n             SQLDeleteRecognizer visitor = (SQLDeleteRecognizer) recognizer;\n+\n+            ParametersHolder parametersHolder = statementProxy instanceof ParametersHolder ? (ParametersHolder)statementProxy : null;\n+            if (StringUtils.isNotBlank(visitor.getLimit(parametersHolder, paramAppenderList))) {\n+                throw new ShouldNeverHappenException(\"Multi delete SQL should not contains limit condition !\");\n+            }\n+            if (StringUtils.isNotBlank(visitor.getOrderBy())) {\n+                throw new ShouldNeverHappenException(\"Multi delete SQL should not contains order by condition !\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzQ0MQ==", "bodyText": "NotSupportYetException ?", "url": "https://github.com/seata/seata/pull/3241#discussion_r523883441", "createdAt": "2020-11-16T03:37:21Z", "author": {"login": "jsbxyyx"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiUpdateExecutor.java", "diffHunk": "@@ -79,6 +81,15 @@ protected TableRecords beforeImage() throws SQLException {\n         for (SQLRecognizer recognizer : sqlRecognizers) {\n             sqlRecognizer = recognizer;\n             SQLUpdateRecognizer sqlUpdateRecognizer = (SQLUpdateRecognizer) recognizer;\n+\n+            ParametersHolder parametersHolder = statementProxy instanceof ParametersHolder ? (ParametersHolder)statementProxy : null;\n+            if (StringUtils.isNotBlank(sqlUpdateRecognizer.getLimit(parametersHolder, paramAppenderList))) {\n+                throw new ShouldNeverHappenException(\"Multi update SQL should not contains limit condition !\");\n+            }\n+            if (StringUtils.isNotBlank(sqlUpdateRecognizer.getOrderBy())) {\n+                throw new ShouldNeverHappenException(\"Multi update SQL should not contains order by condition !\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzQ1Nw==", "bodyText": "NotSupportYetException ?", "url": "https://github.com/seata/seata/pull/3241#discussion_r523883457", "createdAt": "2020-11-16T03:37:24Z", "author": {"login": "jsbxyyx"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiUpdateExecutor.java", "diffHunk": "@@ -79,6 +81,15 @@ protected TableRecords beforeImage() throws SQLException {\n         for (SQLRecognizer recognizer : sqlRecognizers) {\n             sqlRecognizer = recognizer;\n             SQLUpdateRecognizer sqlUpdateRecognizer = (SQLUpdateRecognizer) recognizer;\n+\n+            ParametersHolder parametersHolder = statementProxy instanceof ParametersHolder ? (ParametersHolder)statementProxy : null;\n+            if (StringUtils.isNotBlank(sqlUpdateRecognizer.getLimit(parametersHolder, paramAppenderList))) {\n+                throw new ShouldNeverHappenException(\"Multi update SQL should not contains limit condition !\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33242f2953002c15baa4d70908f1563aaf46206f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23e43cdf2150a773ef567a7aad1b616781b39e4a", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/23e43cdf2150a773ef567a7aad1b616781b39e4a", "committedDate": "2020-11-16T03:38:02Z", "message": "Merge branch 'develop' into bugfix-1030"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860b6c9e9a88310e054ecf9cb91305d2558fe06d", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/860b6c9e9a88310e054ecf9cb91305d2558fe06d", "committedDate": "2020-11-19T16:09:57Z", "message": "ShouldNeverHappenException -> NotSupportYetException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae282c4d11c6442a27f36ad854cd4650167bc0a8", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/ae282c4d11c6442a27f36ad854cd4650167bc0a8", "committedDate": "2020-11-19T16:07:06Z", "message": "Merge remote-tracking branch 'origin/bugfix-1030' into bugfix-1030\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiDeleteExecutor.java\n#\trm-datasource/src/main/java/io/seata/rm/datasource/exec/MultiUpdateExecutor.java"}, "afterCommit": {"oid": "860b6c9e9a88310e054ecf9cb91305d2558fe06d", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/860b6c9e9a88310e054ecf9cb91305d2558fe06d", "committedDate": "2020-11-19T16:09:57Z", "message": "ShouldNeverHappenException -> NotSupportYetException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd9fe7c2035ffda986c069abd10ee289e06772a7", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/bd9fe7c2035ffda986c069abd10ee289e06772a7", "committedDate": "2020-11-19T16:12:21Z", "message": "ShouldNeverHappenException -> NotSupportYetException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzY0ODYw", "url": "https://github.com/seata/seata/pull/3241#pullrequestreview-558364860", "createdAt": "2020-12-24T06:18:26Z", "commit": {"oid": "bd9fe7c2035ffda986c069abd10ee289e06772a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzY2NDYw", "url": "https://github.com/seata/seata/pull/3241#pullrequestreview-558366460", "createdAt": "2020-12-24T06:20:18Z", "commit": {"oid": "bd9fe7c2035ffda986c069abd10ee289e06772a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82fabf8ba80ab714cdb0415a99c14cbc99c958af", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/82fabf8ba80ab714cdb0415a99c14cbc99c958af", "committedDate": "2020-12-24T06:24:11Z", "message": "Merge branch 'github-develop' into bugfix-1030"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzY3ODky", "url": "https://github.com/seata/seata/pull/3241#pullrequestreview-558367892", "createdAt": "2020-12-24T06:26:05Z", "commit": {"oid": "bd9fe7c2035ffda986c069abd10ee289e06772a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3908125d4cfa114172ad6c2851e599df518265a3", "author": {"user": {"login": "caohdgege", "name": "chd"}}, "url": "https://github.com/seata/seata/commit/3908125d4cfa114172ad6c2851e599df518265a3", "committedDate": "2020-12-24T06:36:33Z", "message": "add change info && rm `max-parallel` of ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzcxNDIx", "url": "https://github.com/seata/seata/pull/3241#pullrequestreview-558371421", "createdAt": "2020-12-24T06:39:09Z", "commit": {"oid": "3908125d4cfa114172ad6c2851e599df518265a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3477, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}