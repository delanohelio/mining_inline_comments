{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODYxNTg3", "number": 3195, "title": "optimize: opt XID related codes", "bodyText": "\u2160. Describe what this PR did\noptimize: opt XID related codes.\n\u4f18\u5316XID\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u4f7f\u4ee3\u7801\u66f4\u52a0\u4e25\u8c28\u3002\u53e6\u5916\u90e8\u5206\u4ee3\u7801\u66f4\u52a0\u7b80\u6d01\u3002\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-10-15T06:30:22Z", "url": "https://github.com/seata/seata/pull/3195", "merged": true, "mergeCommit": {"oid": "4e56d4a53911364bc579dc454b4f51f0fc6df5bc"}, "closed": true, "closedAt": "2020-10-17T11:14:47Z", "author": {"login": "wangliang181230"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLmSOVAH2gAyNTAzODYxNTg3OmU4NzY3MGQxNGViZjgwMjUxODE5M2RkOTI3YTc1OWE1Yjc4NDc3MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTZD3rgFqTUxMDk3ODAzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e87670d14ebf802518193dd927a759a5b7847719", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/e87670d14ebf802518193dd927a759a5b7847719", "committedDate": "2020-09-23T06:06:42Z", "message": "optimize: opt get xid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "242201ac38a2f1974106d53100cc09a16cb2f225", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/242201ac38a2f1974106d53100cc09a16cb2f225", "committedDate": "2020-09-23T06:17:06Z", "message": "\u5c0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f96e66db23bf91f53fb92189257299ae0e5bcc28", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/f96e66db23bf91f53fb92189257299ae0e5bcc28", "committedDate": "2020-10-12T11:13:06Z", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-get-xid\n\n# Conflicts:\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalLock.java\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalTransactional.java\n#\tspring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java\n#\ttcc/src/main/java/io/seata/rm/tcc/api/LocalTCC.java\n#\ttcc/src/main/java/io/seata/rm/tcc/api/TwoPhaseBusinessAction.java\n#\ttm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "207bdff6e17ff133f53f8ca4f3d5915fe30962b0", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/207bdff6e17ff133f53f8ca4f3d5915fe30962b0", "committedDate": "2020-10-12T11:15:27Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5b6630021cd5cbfc4e28366a6a368fc203f92d0", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/a5b6630021cd5cbfc4e28366a6a368fc203f92d0", "committedDate": "2020-10-13T02:03:24Z", "message": "Revert some code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7e4a3cf4b204e02cca66b07b6c4dcc4b4d5f4f2", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/f7e4a3cf4b204e02cca66b07b6c4dcc4b4d5f4f2", "committedDate": "2020-10-15T02:23:49Z", "message": "optimize code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "committedDate": "2020-10-15T02:24:44Z", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-get-xid"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDQyMzc0", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509042374", "createdAt": "2020-10-15T06:32:03Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMjowM1rOHhzHTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMjowM1rOHhzHTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMjUxMQ==", "bodyText": "getXID\u65b9\u6cd5\u8c03\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u5c06\u5224\u7a7a\u8f6c\u79fb\u5230bind\u65b9\u6cd5\u4f1a\u6bd4\u8f83\u597d\u4e00\u4e9b\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505202511", "createdAt": "2020-10-15T06:32:03Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -76,20 +77,20 @@ public static void setDefaultBranchType(BranchType defaultBranchType) {\n      *\n      * @return the xid\n      */\n+    @Nullable\n     public static String getXID() {\n-        String xid = (String) CONTEXT_HOLDER.get(KEY_XID);\n-        if (StringUtils.isNotBlank(xid)) {\n-            return xid;\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDQ0NTI4", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509044528", "createdAt": "2020-10-15T06:33:10Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMzoxMFrOHhzKrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMzoxMFrOHhzKrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMzM3NA==", "bodyText": "bind\u65f6\u4e25\u683c\u63a7\u5236xid\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u66f4\u52a0\u4e25\u8c28\u4e00\u4e9b\uff0c\u907f\u514d\u4e00\u4e9b\u672a\u77e5\u7684BUG\u3002\u540c\u65f6\uff0cget\u65b9\u6cd5\u4e2d\u7684\u5224\u7a7a\u4e5f\u53ef\u4ee5\u79fb\u9664\u6389\u4e86\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505203374", "createdAt": "2020-10-15T06:33:10Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -76,20 +77,20 @@ public static void setDefaultBranchType(BranchType defaultBranchType) {\n      *\n      * @return the xid\n      */\n+    @Nullable\n     public static String getXID() {\n-        String xid = (String) CONTEXT_HOLDER.get(KEY_XID);\n-        if (StringUtils.isNotBlank(xid)) {\n-            return xid;\n-        }\n-        return null;\n+        return (String) CONTEXT_HOLDER.get(KEY_XID);\n     }\n \n     /**\n-     * Bind.\n+     * Bind xid.\n      *\n      * @param xid the xid\n      */\n     public static void bind(@Nonnull String xid) {\n+        if (StringUtils.isBlank(xid)) {\n+            throw new IllegalArgumentException(\"xid must be not blank\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDQ1Mzgz", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509045383", "createdAt": "2020-10-15T06:33:36Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMzozNlrOHhzMCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozMzozNlrOHhzMCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMzcyMQ==", "bodyText": "\u548cxid\u4e00\u6837\uff0c\u4e25\u683c\u63a7\u5236\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u907f\u514d\u672a\u77e5\u7684BUG\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505203721", "createdAt": "2020-10-15T06:33:36Z", "author": {"login": "wangliang181230"}, "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -178,6 +181,9 @@ public static BranchType getBranchType() {\n      * @param branchType the branch type\n      */\n     public static void bindBranchType(@Nonnull BranchType branchType) {\n+        if (branchType == null) {\n+            throw new IllegalArgumentException(\"branchType must be not null\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDQ4MzI4", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509048328", "createdAt": "2020-10-15T06:35:11Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozNToxMVrOHhzRGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozNToxMVrOHhzRGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwNTAxNg==", "bodyText": "RootContext.getXID()\u65b9\u6cd5\u4f18\u5316\u8fc7\uff0c\u4e0d\u662fnull\u5c31\u662f\u975e\u7a7a\u767d\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u8981\u5224\u65ad\u4e0d\u4e3anull\u5c31\u884c\u3002\n\u5176\u4ed6\u5730\u65b9\u4e5f\u4e00\u6837\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505205016", "createdAt": "2020-10-15T06:35:11Z", "author": {"login": "wangliang181230"}, "path": "integration/grpc/src/main/java/io/seata/integration/grpc/interceptor/client/ClientTransactionInterceptor.java", "diffHunk": "@@ -43,7 +42,7 @@\n \n             @Override\n             public void start(Listener<RespT> responseListener, Metadata headers) {\n-                if (StringUtils.isNotBlank(xid)) {\n+                if (xid != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDUzNjcy", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509053672", "createdAt": "2020-10-15T06:38:06Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozODowNlrOHhzaDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozODowNlrOHhzaDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwNzMwOA==", "bodyText": "boolean unbindXid\u53c2\u6570\u4e3afalse\u65f6\uff0c\u8ddf\u6ca1\u8c03\u7528\u6b64\u65b9\u6cd5\u4e00\u4e2a\u6837\uff0c\u8be5\u53c2\u6570\u53c8\u662f\u7531\u8c03\u7528\u65b9\u4f20\u7684\uff0c\u800c\u4e14\u4f20false\u8ddf\u6ca1\u6709\u6267\u884c\u8be5\u65b9\u6cd5\u4e00\u4e2a\u6837\uff0c\u90a3\u4e48\u76f4\u63a5\u4e0d\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u5c31\u597d\u4e86\u561b\u3002\n\u6240\u4ee5\u8fd9\u4e2a\u53c2\u6570\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u3002\u76f4\u63a5\u79fb\u9664\u6389\u4e86\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505207308", "createdAt": "2020-10-15T06:38:06Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java", "diffHunk": "@@ -181,17 +180,16 @@ public void rollback() throws TransactionException {\n     }\n \n     @Override\n-    public SuspendedResourcesHolder suspend(boolean unbindXid) throws TransactionException {\n-        String xid = RootContext.getXID();\n-        if (StringUtils.isNotEmpty(xid) && unbindXid) {\n-            RootContext.unbind();\n+    public SuspendedResourcesHolder suspend() throws TransactionException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDU1NTIz", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-509055523", "createdAt": "2020-10-15T06:39:06Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozOTowNlrOHhzddw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNjozOTowNlrOHhzddw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwODE4Mw==", "bodyText": "suspendedResourcesHolder.getXid()\u6539\u6210\u80af\u5b9a\u4e0d\u4e3a\u7a7a\u4e86\u3002\n\u6240\u4ee5\u8fd9\u91cc\u4e0d\u9700\u8981\u518d\u5224\u65ad\u7a7a\u503c\u4e86\u3002", "url": "https://github.com/seata/seata/pull/3195#discussion_r505208183", "createdAt": "2020-10-15T06:39:06Z", "author": {"login": "wangliang181230"}, "path": "tm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java", "diffHunk": "@@ -200,11 +198,9 @@ public void resume(SuspendedResourcesHolder suspendedResourcesHolder) throws Tra\n             return;\n         }\n         String xid = suspendedResourcesHolder.getXid();\n-        if (StringUtils.isNotEmpty(xid)) {\n-            RootContext.bind(xid);\n-            if (LOGGER.isDebugEnabled()) {\n-                LOGGER.debug(\"Resumimg the transaction,xid = {}\", xid);\n-            }\n+        RootContext.bind(xid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTc2NjU0", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-510976654", "createdAt": "2020-10-17T10:47:24Z", "commit": {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "605bc49d6555082bb28babcd01b893fa12eec108", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/605bc49d6555082bb28babcd01b893fa12eec108", "committedDate": "2020-10-17T10:47:31Z", "message": "Merge branch 'develop' into optimize-get-xid"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTc4MDMx", "url": "https://github.com/seata/seata/pull/3195#pullrequestreview-510978031", "createdAt": "2020-10-17T11:13:40Z", "commit": {"oid": "605bc49d6555082bb28babcd01b893fa12eec108"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3708, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}