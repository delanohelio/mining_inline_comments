{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMjUyODY4", "number": 2329, "title": "refactor : separate the different storage pattern processing logic", "bodyText": "", "createdAt": "2020-03-02T08:52:47Z", "url": "https://github.com/seata/seata/pull/2329", "merged": true, "mergeCommit": {"oid": "44cbf0523335d1a6921e69bf4f687b7c1679a2fb"}, "closed": true, "closedAt": "2020-03-20T10:51:48Z", "author": {"login": "ph3636"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJpwgAgH2gAyMzgyMjUyODY4OjM2ZjFhZWIzODI4ZTI4ODJjMDRjZDdmMzU4MDk1MDUzYWRkZDMzYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPd-40gH2gAyMzgyMjUyODY4OmZhYzNjOTY1NjA3NTU3YTIxMjk3MGIyMmU1ZTQxMWZmMTIxZjljN2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "36f1aeb3828e2882c04cd7f358095053addd33bf", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/36f1aeb3828e2882c04cd7f358095053addd33bf", "committedDate": "2020-03-02T08:50:29Z", "message": "separate the different storage pattern processing logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8032c57177e770705aca7c22680bc1bd38ee41d1", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/8032c57177e770705aca7c22680bc1bd38ee41d1", "committedDate": "2020-03-05T01:11:54Z", "message": "Merge branch 'develop' into separate_store_mode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODI4NjI2", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-370828626", "createdAt": "2020-03-08T13:04:44Z", "commit": {"oid": "8032c57177e770705aca7c22680bc1bd38ee41d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxMzowNDo0NVrOFzVHNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxMzowNDo0NVrOFzVHNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM2NzYwNQ==", "bodyText": "Uppercase static constants.", "url": "https://github.com/seata/seata/pull/2329#discussion_r389367605", "createdAt": "2020-03-08T13:04:45Z", "author": {"login": "objcoding"}, "path": "server/src/main/java/io/seata/server/lock/LockerManagerFactory.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.server.lock;\n+\n+import io.seata.common.loader.EnhancedServiceLoader;\n+import io.seata.config.ConfigurationFactory;\n+import io.seata.core.constants.ConfigurationKeys;\n+\n+/**\n+ * The type Lock manager factory.\n+ *\n+ * @author sharajava\n+ */\n+public class LockerManagerFactory {\n+\n+    /**\n+     * the lock manager\n+     */\n+    private static LockManager lockManager = EnhancedServiceLoader.load(LockManager.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8032c57177e770705aca7c22680bc1bd38ee41d1"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODM1MTcw", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-370835170", "createdAt": "2020-03-08T14:43:32Z", "commit": {"oid": "8032c57177e770705aca7c22680bc1bd38ee41d1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65625df69c1d14ca1e569ed2f2f6f8175a46349a", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/65625df69c1d14ca1e569ed2f2f6f8175a46349a", "committedDate": "2020-03-09T04:25:49Z", "message": "merge develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1fd6b4df14e97cccb591b44e1de816f2b6786fe", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/f1fd6b4df14e97cccb591b44e1de816f2b6786fe", "committedDate": "2020-03-09T04:26:09Z", "message": "Uppercase static constants."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/0d4142dda913c2b586949d8a015a8226d15aa9a2", "committedDate": "2020-03-15T16:12:16Z", "message": "Merge branch 'develop' into separate_store_mode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODQyNjY2", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-376842666", "createdAt": "2020-03-18T13:06:00Z", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODg2ODky", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-376886892", "createdAt": "2020-03-18T13:57:14Z", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NjU0OTc5", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-377654979", "createdAt": "2020-03-19T12:03:05Z", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMjowMzowNVrOF4rbBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMjoyMTo0NFrOF4r_aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk3NjAwNA==", "bodyText": "already ensure  SessionHolder.findGlobalSession(xid, false) are not in the case.", "url": "https://github.com/seata/seata/pull/2329#discussion_r394976004", "createdAt": "2020-03-19T12:03:05Z", "author": {"login": "slievrly"}, "path": "server/src/main/java/io/seata/server/storage/db/lock/DataBaseLockManager.java", "diffHunk": "@@ -44,11 +61,19 @@ public boolean releaseLock(BranchSession branchSession) throws TransactionExcept\n \n     @Override\n     public boolean releaseGlobalSessionLock(GlobalSession globalSession) throws TransactionException {\n-        ArrayList<BranchSession> branchSessions = globalSession.getBranchSessions();\n+        List<BranchSession> branchSessions = globalSession.getBranchSessions();\n         if (CollectionUtils.isEmpty(branchSessions)) {\n             return true;\n         }\n-        List<Long> branchIds = branchSessions.stream().map(BranchSession::getBranchId).collect(Collectors.toList());\n+        List<Long> branchIds = new ArrayList<>(branchSessions.size());\n+        boolean notNeedReleaseLock = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk4NTMyMA==", "bodyText": "why not abstract method\uff1f", "url": "https://github.com/seata/seata/pull/2329#discussion_r394985320", "createdAt": "2020-03-19T12:21:44Z", "author": {"login": "slievrly"}, "path": "server/src/main/java/io/seata/server/lock/AbstractLockManager.java", "diffHunk": "@@ -106,7 +111,7 @@ protected Locker getLocker() {\n      * @return the locker\n      */\n     protected Locker getLocker(BranchSession branchSession) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzIwMzYz", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-377720363", "createdAt": "2020-03-19T13:32:07Z", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzQ3MDI3", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-377747027", "createdAt": "2020-03-19T14:01:27Z", "commit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMToyN1rOF4vxBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMToyN1rOF4vxBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0NzE3Mg==", "bodyText": "unnecessary attribute", "url": "https://github.com/seata/seata/pull/2329#discussion_r395047172", "createdAt": "2020-03-19T14:01:27Z", "author": {"login": "zjinlei"}, "path": "server/src/main/java/io/seata/server/storage/db/lock/DataBaseLockManager.java", "diffHunk": "@@ -44,11 +61,19 @@ public boolean releaseLock(BranchSession branchSession) throws TransactionExcept\n \n     @Override\n     public boolean releaseGlobalSessionLock(GlobalSession globalSession) throws TransactionException {\n-        ArrayList<BranchSession> branchSessions = globalSession.getBranchSessions();\n+        List<BranchSession> branchSessions = globalSession.getBranchSessions();\n         if (CollectionUtils.isEmpty(branchSessions)) {\n             return true;\n         }\n-        List<Long> branchIds = branchSessions.stream().map(BranchSession::getBranchId).collect(Collectors.toList());\n+        List<Long> branchIds = new ArrayList<>(branchSessions.size());\n+        boolean notNeedReleaseLock = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d4142dda913c2b586949d8a015a8226d15aa9a2"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3311a30895f8ec6ff46542fd76759d981a8466", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/1f3311a30895f8ec6ff46542fd76759d981a8466", "committedDate": "2020-03-20T05:16:09Z", "message": "Merge branch 'develop' into separate_store_mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "442fa0c57e44b7ccedeb67c510b376452bb7d381", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/442fa0c57e44b7ccedeb67c510b376452bb7d381", "committedDate": "2020-03-20T06:07:26Z", "message": "getLocker(BranchSession branchSession) change to abstract method and delete unnecessary attribute,because lock_key is always blank id db mode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzE1OTMw", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-378315930", "createdAt": "2020-03-20T09:02:25Z", "commit": {"oid": "442fa0c57e44b7ccedeb67c510b376452bb7d381"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTowMjoyNVrOF5L2DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTowMjoyNVrOF5L2DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUwNzIxMg==", "bodyText": "Will be initialized 4 times by SessionHolder, it should be static.", "url": "https://github.com/seata/seata/pull/2329#discussion_r395507212", "createdAt": "2020-03-20T09:02:25Z", "author": {"login": "zjinlei"}, "path": "server/src/main/java/io/seata/server/storage/db/session/DataBaseSessionManager.java", "diffHunk": "@@ -79,7 +77,7 @@ public DataBaseSessionManager(String name) {\n \n     @Override\n     public void init() {\n-        transactionStoreManager = EnhancedServiceLoader.load(TransactionStoreManager.class, StoreMode.DB.name());\n+        transactionStoreManager = new DataBaseTransactionStoreManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "442fa0c57e44b7ccedeb67c510b376452bb7d381"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff3165be0a74110031b3830070f56c357a3245b", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/8ff3165be0a74110031b3830070f56c357a3245b", "committedDate": "2020-03-20T09:11:47Z", "message": "Merge branch 'develop' into separate_store_mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208324700ea1e92832b9dfb8816800bc16c0b25e", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/208324700ea1e92832b9dfb8816800bc16c0b25e", "committedDate": "2020-03-20T09:43:39Z", "message": "Change DataBaseTransactionStoreManager to a single instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56bb9bedd8ca10676b09f64b4d0a2caed8dc3bfa", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/56bb9bedd8ca10676b09f64b4d0a2caed8dc3bfa", "committedDate": "2020-03-20T09:44:15Z", "message": "Merge remote-tracking branch 'origin/separate_store_mode' into separate_store_mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db324ad8fcfaecfe3ef9d217acb4a5de0c1d7396", "author": {"user": {"login": "ph3636", "name": null}}, "url": "https://github.com/seata/seata/commit/db324ad8fcfaecfe3ef9d217acb4a5de0c1d7396", "committedDate": "2020-03-20T09:54:36Z", "message": "Change DataBaseTransactionStoreManager to a single instance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzcxMTg0", "url": "https://github.com/seata/seata/pull/2329#pullrequestreview-378371184", "createdAt": "2020-03-20T10:30:46Z", "commit": {"oid": "db324ad8fcfaecfe3ef9d217acb4a5de0c1d7396"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac3c965607557a212970b22e5e411ff121f9c7c", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/fac3c965607557a212970b22e5e411ff121f9c7c", "committedDate": "2020-03-20T10:30:53Z", "message": "Merge branch 'develop' into separate_store_mode"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4038, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}