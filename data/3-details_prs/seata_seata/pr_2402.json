{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MTQzNjQ5", "number": 2402, "title": "optimize:optimize the rm and tm register log", "bodyText": "\u2160. Describe what this PR did\noptimize:optimize the rm and tm register log\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-03-14T04:05:15Z", "url": "https://github.com/seata/seata/pull/2402", "merged": true, "mergeCommit": {"oid": "166ecfb4c8a3d23b60432c33bca16ed7145a2177"}, "closed": true, "closedAt": "2020-03-18T13:58:58Z", "author": {"login": "lightClouds917"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNc1RzAH2gAyMzg4MTQzNjQ5OjFmNzRkZDYwZDcxZGVkYzEzNDQ4OTVmZDM5ZmNkZDJiMGMxOTZkZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPAHISAFqTM3NzMxMzIyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f74dd60d71dedc1344895fd39fcdd2b0c196de5", "author": {"user": {"login": "lightClouds917", "name": "IT\u4e91\u6e05"}}, "url": "https://github.com/seata/seata/commit/1f74dd60d71dedc1344895fd39fcdd2b0c196de5", "committedDate": "2020-03-14T04:02:38Z", "message": "optimize:optimize the rm and tm register log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzg4MDM4", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-374788038", "createdAt": "2020-03-15T10:42:29Z", "commit": {"oid": "1f74dd60d71dedc1344895fd39fcdd2b0c196de5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e9526553770b120e499c995210b671c963d74cd", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/7e9526553770b120e499c995210b671c963d74cd", "committedDate": "2020-03-15T10:42:36Z", "message": "Merge branch 'develop' into optimize_registerlog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODAyOTU4", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-374802958", "createdAt": "2020-03-15T14:16:22Z", "commit": {"oid": "7e9526553770b120e499c995210b671c963d74cd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNDoxNjoyMlrOF2fKGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNDoxNzowM1rOF2fKWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY3NzkxMg==", "bodyText": "debug and info Inconsistent", "url": "https://github.com/seata/seata/pull/2402#discussion_r392677912", "createdAt": "2020-03-15T14:16:22Z", "author": {"login": "zjinlei"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -106,20 +106,25 @@ public void onTrxMessage(RpcMessage request, ChannelHandlerContext ctx) {\n     @Override\n     public void onRegRmMessage(RpcMessage request, ChannelHandlerContext ctx, RegisterCheckAuthHandler checkAuthHandler) {\n         RegisterRMRequest message = (RegisterRMRequest)request.getBody();\n+        String ipAndPort = NetUtil.toStringAddress(ctx.channel().remoteAddress());\n         boolean isSuccess = false;\n         try {\n             if (null == checkAuthHandler || checkAuthHandler.regResourceManagerCheckAuth(message)) {\n                 ChannelManager.registerRMChannel(message, ctx.channel());\n                 Version.putChannelVersion(ctx.channel(), message.getVersion());\n                 isSuccess = true;\n+                if (LOGGER.isDebugEnabled()) {\n+                    LOGGER.info(\"checkAuth for client:{},vgroup:{},applicationId:{}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e9526553770b120e499c995210b671c963d74cd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY3Nzk3Ng==", "bodyText": "debug and info Inconsistent", "url": "https://github.com/seata/seata/pull/2402#discussion_r392677976", "createdAt": "2020-03-15T14:17:03Z", "author": {"login": "zjinlei"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -134,7 +139,7 @@ public void onRegTmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n                 ChannelManager.registerTMChannel(message, ctx.channel());\n                 Version.putChannelVersion(ctx.channel(), message.getVersion());\n                 isSuccess = true;\n-                if (LOGGER.isInfoEnabled()) {\n+                if (LOGGER.isDebugEnabled()) {\n                     LOGGER.info(\"checkAuth for client:{},vgroup:{},applicationId:{}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e9526553770b120e499c995210b671c963d74cd"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ede06716fbeb951e91ac851f592900fa7146b9e", "author": {"user": {"login": "lightClouds917", "name": "IT\u4e91\u6e05"}}, "url": "https://github.com/seata/seata/commit/7ede06716fbeb951e91ac851f592900fa7146b9e", "committedDate": "2020-03-16T05:52:29Z", "message": "fix:change the log level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0OTI2MzA5", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-374926309", "createdAt": "2020-03-16T05:54:39Z", "commit": {"oid": "7ede06716fbeb951e91ac851f592900fa7146b9e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6f578895200ee0aa82c457f517a8c2431b32edc", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/a6f578895200ee0aa82c457f517a8c2431b32edc", "committedDate": "2020-03-16T06:12:45Z", "message": "Merge branch 'develop' into optimize_registerlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baa714b3f30b0d3981eec530a645e16f74214062", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/baa714b3f30b0d3981eec530a645e16f74214062", "committedDate": "2020-03-17T05:06:12Z", "message": "Merge branch 'develop' into optimize_registerlog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzQzODA1", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-375743805", "createdAt": "2020-03-17T05:10:04Z", "commit": {"oid": "baa714b3f30b0d3981eec530a645e16f74214062"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNToxMDowNFrOF3OJmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwNToxMDoxMFrOF3OJrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0NzgzMg==", "bodyText": "not recommended to serialize the entire object of the message", "url": "https://github.com/seata/seata/pull/2402#discussion_r393447832", "createdAt": "2020-03-17T05:10:04Z", "author": {"login": "zjinlei"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -106,20 +106,25 @@ public void onTrxMessage(RpcMessage request, ChannelHandlerContext ctx) {\n     @Override\n     public void onRegRmMessage(RpcMessage request, ChannelHandlerContext ctx, RegisterCheckAuthHandler checkAuthHandler) {\n         RegisterRMRequest message = (RegisterRMRequest)request.getBody();\n+        String ipAndPort = NetUtil.toStringAddress(ctx.channel().remoteAddress());\n         boolean isSuccess = false;\n         try {\n             if (null == checkAuthHandler || checkAuthHandler.regResourceManagerCheckAuth(message)) {\n                 ChannelManager.registerRMChannel(message, ctx.channel());\n                 Version.putChannelVersion(ctx.channel(), message.getVersion());\n                 isSuccess = true;\n+                if (LOGGER.isDebugEnabled()) {\n+                    LOGGER.debug(\"checkAuth for client:{},vgroup:{},applicationId:{}\",\n+                            ipAndPort,message.getTransactionServiceGroup(),message.getApplicationId());\n+                }\n             }\n         } catch (Exception exx) {\n             isSuccess = false;\n             LOGGER.error(exx.getMessage());\n         }\n         getServerMessageSender().sendResponse(request, ctx.channel(), new RegisterRMResponse(isSuccess));\n         if (LOGGER.isInfoEnabled()) {\n-            LOGGER.info(\"rm register success,message:{},channel:{}\", message, ctx.channel());\n+            LOGGER.info(\"RM register success,message:{},channel:{}\", message, ctx.channel());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baa714b3f30b0d3981eec530a645e16f74214062"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0Nzg1NQ==", "bodyText": "not recommended to serialize the entire object of the message", "url": "https://github.com/seata/seata/pull/2402#discussion_r393447855", "createdAt": "2020-03-17T05:10:10Z", "author": {"login": "zjinlei"}, "path": "core/src/main/java/io/seata/core/rpc/DefaultServerMessageListenerImpl.java", "diffHunk": "@@ -144,6 +149,9 @@ public void onRegTmMessage(RpcMessage request, ChannelHandlerContext ctx, Regist\n             LOGGER.error(exx.getMessage());\n         }\n         getServerMessageSender().sendResponse(request, ctx.channel(), new RegisterTMResponse(isSuccess));\n+        if (LOGGER.isInfoEnabled()) {\n+            LOGGER.info(\"TM register success,message:{},channel:{}\", message, ctx.channel());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baa714b3f30b0d3981eec530a645e16f74214062"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0327b4d28f8cec8ebcaa4696f4bc323efa0997ba", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/0327b4d28f8cec8ebcaa4696f4bc323efa0997ba", "committedDate": "2020-03-18T05:21:41Z", "message": "Merge branch 'develop' into optimize_registerlog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTcxMzc0", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-376571374", "createdAt": "2020-03-18T05:22:48Z", "commit": {"oid": "0327b4d28f8cec8ebcaa4696f4bc323efa0997ba"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTc2NTM3", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-376576537", "createdAt": "2020-03-18T05:40:39Z", "commit": {"oid": "0327b4d28f8cec8ebcaa4696f4bc323efa0997ba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNTo0MDo0MFrOF329vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNTo0MDo0MFrOF329vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDExNjU0Mw==", "bodyText": "remove duplicate calls", "url": "https://github.com/seata/seata/pull/2402#discussion_r394116543", "createdAt": "2020-03-18T05:40:40Z", "author": {"login": "zjinlei"}, "path": "core/src/main/java/io/seata/core/rpc/netty/TmRpcClient.java", "diffHunk": "@@ -151,6 +151,10 @@ public String getTransactionServiceGroup() {\n     @Override\n     public void onRegisterMsgSuccess(String serverAddress, Channel channel, Object response,\n                                      AbstractMessage requestMessage) {\n+        if (LOGGER.isInfoEnabled()) {\n+            LOGGER.info(\"register TM success. server version:{},channel:{}\", ((RegisterTMResponse)response).getVersion(), channel);\n+            getClientChannelManager().registerChannel(serverAddress, channel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0327b4d28f8cec8ebcaa4696f4bc323efa0997ba"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb0bb0cf2cab152d66512d6011cd3a63f657bae9", "author": {"user": {"login": "lightClouds917", "name": "IT\u4e91\u6e05"}}, "url": "https://github.com/seata/seata/commit/cb0bb0cf2cab152d66512d6011cd3a63f657bae9", "committedDate": "2020-03-18T05:44:19Z", "message": "fix:remove the redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2e1694946d93f81eb3b7bd3ac8cf6cb1cf0eb54", "author": {"user": {"login": "lightClouds917", "name": "IT\u4e91\u6e05"}}, "url": "https://github.com/seata/seata/commit/f2e1694946d93f81eb3b7bd3ac8cf6cb1cf0eb54", "committedDate": "2020-03-18T05:49:27Z", "message": "Merge branch 'develop' of github.com:seata/seata into optimize_registerlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14dfabfa025a5112f3aef464909139a55ae64a84", "author": {"user": {"login": "lightClouds917", "name": "IT\u4e91\u6e05"}}, "url": "https://github.com/seata/seata/commit/14dfabfa025a5112f3aef464909139a55ae64a84", "committedDate": "2020-03-18T05:50:56Z", "message": "Merge branch 'optimize_registerlog' of github.com:lightClouds917/seata into optimize_registerlog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODg2MDUy", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-376886052", "createdAt": "2020-03-18T13:56:19Z", "commit": {"oid": "14dfabfa025a5112f3aef464909139a55ae64a84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzEzMjI4", "url": "https://github.com/seata/seata/pull/2402#pullrequestreview-377313228", "createdAt": "2020-03-18T23:42:44Z", "commit": {"oid": "14dfabfa025a5112f3aef464909139a55ae64a84"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4091, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}