{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzYwNDA2", "number": 2788, "title": "optimize: optimize seata-server log pattern and support for colored log.", "bodyText": "\u2160. Describe what this PR did\nseata-server\u7aef\u7684\u65e5\u5fd7\u76f8\u5173\u4f18\u5316\uff1a\n1\u3001\u65e5\u5fd7\u683c\u5f0f\u8c03\u6574\uff0c\u4f7f\u65e5\u5fd7\u66f4\u6574\u9f50\u3002\n2\u3001\u63a7\u5236\u53f0\u6253\u5370\u65e5\u5fd7\u65f6\uff0c\u90e8\u5206\u6587\u5b57\u5e26\u989c\u8272\u3002\n3\u3001\u65e5\u5fd7\u6587\u4ef6\u540d\u62fc\u63a5\u7aef\u53e3\u53f7\uff0c\u9632\u6b62\u96c6\u7fa4\u65f6\u90e8\u5206\u65e5\u5fd7\u5199\u5165\u5931\u8d25\u3002\n4\u3001\u65e5\u5fd7\u6587\u4ef6\u6309\u65e5\u5fd7\u7ea7\u522b\u5206\u5f00\uff1atxc.${port}.all.log\u3001txc.${port}.warn.log\u3001txc.${port}.error.log\n5\u3001\u5386\u53f2\u65e5\u5fd7\u6587\u4ef6\uff0c\u653e\u5165\u5b50\u6587\u4ef6\u5939/history\u4e2d\uff0c\u4e14\u5386\u53f2\u6587\u4ef6\u540e\u7f00\u540d\u6539\u4e3a.gz\n\u76f8\u5173\u529f\u80fd\u53ca\u65e5\u5fd7\u683c\u5f0f\uff0c\u4ecespring-boot.jar\u4e2d\u590d\u5236\u8fc7\u6765\u7684\uff0c\u6211\u53ea\u662f\u642c\u8fd0\u5de5\uff0c\u54c8\u54c8\u3002\n\u4f18\u5316\u540e\u7684\u6548\u679c\u5982\u4e0b\uff1a\n\u63a7\u5236\u53f0\u8f93\u51fa\uff1a\n\n\u65e5\u5fd7\u6587\u4ef6\u8f93\u51fa\uff1a\n\n\u4f18\u5316\u524d\u7684\u6548\u679c\u5982\u4e0b\uff1a\n\u63a7\u5236\u53f0\u8f93\u51fa\uff1a\n\n\u65e5\u5fd7\u6587\u4ef6\u8f93\u51fa\uff1a\n\n\u2161. Does this pull request fix one issue?\n\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-06-10T10:27:46Z", "url": "https://github.com/seata/seata/pull/2788", "merged": true, "mergeCommit": {"oid": "a428685dff650417cafc405e83ad41fb3a5f4c11"}, "closed": true, "closedAt": "2020-06-19T03:36:13Z", "author": {"login": "wangliang181230"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp3DBBgH2gAyNDMyMzYwNDA2OmEwZTE3Y2NlZDc4YjEyMGMxZjk3MGVmYTBjMDI2NWFlMTYwMDUzZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsqlilAFqTQzMzc4MTQxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a0e17cced78b120c1f970efa0c0265ae160053d6", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/a0e17cced78b120c1f970efa0c0265ae160053d6", "committedDate": "2020-06-10T10:25:03Z", "message": "seata-server\u7684\u65e5\u5fd7\u6253\u5370\u683c\u5f0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee75dc052aaf5b084ffa3edfe55917b2c101aa5", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/fee75dc052aaf5b084ffa3edfe55917b2c101aa5", "committedDate": "2020-06-11T04:27:13Z", "message": "seata-server\u7684\u65e5\u5fd7\uff0c\u63a7\u5236\u53f0\u6253\u5370\u65f6\uff0c\u53ef\u6253\u5370\u5e26\u989c\u8272\u7684\u6587\u5b57\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a4dde3fa1bd1821cacaff1be7285e4964571a9", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/19a4dde3fa1bd1821cacaff1be7285e4964571a9", "committedDate": "2020-06-11T04:52:37Z", "message": "fix style."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0d68b657e2fa1c5debb3ab9f7584e241a214950", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/f0d68b657e2fa1c5debb3ab9f7584e241a214950", "committedDate": "2020-06-11T05:15:33Z", "message": "\u5386\u53f2\u65e5\u5fd7\u6587\u4ef6\u653e\u5165\u5b50\u6587\u4ef6\u5939/history\u4e2d\uff0c\u4e14\u540e\u7f00\u540d\u6539\u4e3a.gz"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6f22f90ffe54f9a51cf81875e95f6a0bbad38f2", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/d6f22f90ffe54f9a51cf81875e95f6a0bbad38f2", "committedDate": "2020-06-11T05:43:47Z", "message": "\u65e5\u5fd7\u4fe1\u606f\u4e2d\uff0c\u52a0\u5165\u8fdb\u7a0bID\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5203e12a25cda0a6b9c57cba8b31d28aebff3ebf", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/5203e12a25cda0a6b9c57cba8b31d28aebff3ebf", "committedDate": "2020-06-11T05:45:28Z", "message": "fix style."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTMyNzY2", "url": "https://github.com/seata/seata/pull/2788#pullrequestreview-430132766", "createdAt": "2020-06-13T11:26:42Z", "commit": {"oid": "5203e12a25cda0a6b9c57cba8b31d28aebff3ebf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5094d582a996e73d529a8fac5badbd40eb1b033", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/f5094d582a996e73d529a8fac5badbd40eb1b033", "committedDate": "2020-06-13T11:39:26Z", "message": "\u8c03\u6574\u65e5\u5fd7\u8f93\u51faPID\u7684\u529f\u80fd\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227c46b87162956dbba7cf71d3053df0b504b48c", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/227c46b87162956dbba7cf71d3053df0b504b48c", "committedDate": "2020-06-14T02:31:15Z", "message": "Merge branch 'develop' into server-log-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "defff17337dde7a2bd56d25ea6156bdcb55c3a47", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/defff17337dde7a2bd56d25ea6156bdcb55c3a47", "committedDate": "2020-06-15T08:27:26Z", "message": "\u53bb\u9664\u591a\u4f59\u7684\u7a7a\u683c\u3002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDI5MDcx", "url": "https://github.com/seata/seata/pull/2788#pullrequestreview-432029071", "createdAt": "2020-06-17T03:13:57Z", "commit": {"oid": "defff17337dde7a2bd56d25ea6156bdcb55c3a47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMzoxMzo1N1rOGk0JFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMzoxMzo1N1rOGk0JFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1NjIxNA==", "bodyText": "logger length original is 56, now is 39, is there a difference?", "url": "https://github.com/seata/seata/pull/2788#discussion_r441256214", "createdAt": "2020-06-17T03:13:57Z", "author": {"login": "jsbxyyx"}, "path": "server/src/main/resources/logback.xml", "diffHunk": "@@ -16,11 +16,20 @@\n   -->\n \n <configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\">\n+    <!-- Copied from spring-boot.jar -->\n+    <conversionRule conversionWord=\"clr\" converterClass=\"io.seata.server.logging.logback.ColorConverter\" />\n+    <conversionRule conversionWord=\"wex\" converterClass=\"io.seata.server.logging.logback.WhitespaceThrowableProxyConverter\" />\n+    <conversionRule conversionWord=\"wEx\" converterClass=\"io.seata.server.logging.logback.ExtendedWhitespaceThrowableProxyConverter\" />\n+    <conversionRule conversionWord=\"pid\" converterClass=\"io.seata.server.logging.logback.PidConverter\" />\n+    <property name=\"CONSOLE_LOG_PATTERN\" value=\"%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(%pid){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx\"/>\n+    <property name=\"FILE_LOG_PATTERN\" value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} %5p %pid --- [%t] %-40.40logger{39} : %m%n%wEx\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "defff17337dde7a2bd56d25ea6156bdcb55c3a47"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb27166fb1253747945a4d52ce464bb2bb319c60", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/bb27166fb1253747945a4d52ce464bb2bb319c60", "committedDate": "2020-06-17T06:06:08Z", "message": "Merge branch 'develop' into server-log-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a70658bd61adc535837f73dfa813e35ba91f02ab", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/a70658bd61adc535837f73dfa813e35ba91f02ab", "committedDate": "2020-06-18T03:22:23Z", "message": "Merge branch 'develop' into server-log-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7e5bcb87a5c9ceb87b9a313b18b3b541258ddfc", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/b7e5bcb87a5c9ceb87b9a313b18b3b541258ddfc", "committedDate": "2020-06-18T09:05:53Z", "message": "seata-server: \u65e5\u5fd7\u6587\u4ef6\u540d\u62fc\u63a5\u7aef\u53e3\u53f7\u3002\u4e14WARN\u548cERROR\u65e5\u5fd7\u53e6\u5b58\u4e00\u4e2a\u6587\u4ef6\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a2075a3868c05d2814dfea57d13e2ec837f512", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/40a2075a3868c05d2814dfea57d13e2ec837f512", "committedDate": "2020-06-18T09:22:37Z", "message": "\u6dfb\u52a0Copyright"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9fc8018ebba0e39d5dc7a1f21b2a6b7699fa5fa", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/d9fc8018ebba0e39d5dc7a1f21b2a6b7699fa5fa", "committedDate": "2020-06-18T09:31:42Z", "message": "\u5c0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ea3229fb0bce1a8d8e9a3f2a93938fcb4e52384", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/7ea3229fb0bce1a8d8e9a3f2a93938fcb4e52384", "committedDate": "2020-06-18T09:32:57Z", "message": "\u5c0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06bbcf1d62858ba1e58dcd7abcd1e9fdb8e22bfa", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/06bbcf1d62858ba1e58dcd7abcd1e9fdb8e22bfa", "committedDate": "2020-06-18T09:49:43Z", "message": "\u5c0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTM2Nzc5", "url": "https://github.com/seata/seata/pull/2788#pullrequestreview-433136779", "createdAt": "2020-06-18T10:10:23Z", "commit": {"oid": "40a2075a3868c05d2814dfea57d13e2ec837f512"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDoxMDoyM1rOGlovgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDoxMToyMFrOGloxog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjExODAxOA==", "bodyText": "original value is ${user.home}/logs/seata", "url": "https://github.com/seata/seata/pull/2788#discussion_r442118018", "createdAt": "2020-06-18T10:10:23Z", "author": {"login": "jsbxyyx"}, "path": "server/src/main/resources/logback.xml", "diffHunk": "@@ -16,39 +16,91 @@\n   -->\n \n <configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\">\n-    <property name=\"LOG_HOME\" value=\"${user.home}/logs/seata\"/>\n+    <!-- Context listeners -->\n+    <contextListener class=\"io.seata.server.logging.listener.SystemPropertyLoggerContextListener\" />\n \n-    <appender name=\"stdout\" class=\"ch.qos.logback.core.ConsoleAppender\">\n-        <encoder class=\"ch.qos.logback.classic.encoder.PatternLayoutEncoder\">\n-            <Pattern>%date{yyyy-MM-dd HH:mm:ss.SSS} %-5level[%thread]%logger{56}.%method:%L -%msg%n</Pattern>\n+    <!-- Copied from spring-boot.jar -->\n+    <conversionRule conversionWord=\"clr\" converterClass=\"io.seata.server.logging.logback.ColorConverter\" />\n+    <conversionRule conversionWord=\"wex\" converterClass=\"io.seata.server.logging.logback.WhitespaceThrowableProxyConverter\" />\n+    <conversionRule conversionWord=\"wEx\" converterClass=\"io.seata.server.logging.logback.ExtendedWhitespaceThrowableProxyConverter\" />\n+    <property name=\"CONSOLE_LOG_PATTERN\" value=\"%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx\"/>\n+    <property name=\"FILE_LOG_PATTERN\" value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} %5p --- [%t] %-40.40logger{39} : %m%n%wEx\"/>\n+\n+    <property name=\"LOG_HOME\" value=\"./logs\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a2075a3868c05d2814dfea57d13e2ec837f512"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjExODU2Mg==", "bodyText": "The class not used?", "url": "https://github.com/seata/seata/pull/2788#discussion_r442118562", "createdAt": "2020-06-18T10:11:20Z", "author": {"login": "jsbxyyx"}, "path": "server/src/main/java/io/seata/server/logging/logback/ApplicationPid.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.server.logging.logback;\n+\n+import java.lang.management.ManagementFactory;\n+\n+/**\n+ * An application process ID.\n+ *\n+ * @author wang.liang\n+ */\n+public class ApplicationPid {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a2075a3868c05d2814dfea57d13e2ec837f512"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1eec00ea7ac7cba4529a1dbdf992af6690c4053", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/d1eec00ea7ac7cba4529a1dbdf992af6690c4053", "committedDate": "2020-06-18T10:18:43Z", "message": "\u5c0f\u8c03\u6574\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3db15bdfa54ed15c9ddf4f435752af15761238ee", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/3db15bdfa54ed15c9ddf4f435752af15761238ee", "committedDate": "2020-06-18T10:19:45Z", "message": "\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u53d8\u56de\u53bb\u3002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d44bf154fcc7a74aa822067a2e8539f8753d6a9c", "author": {"user": {"login": "wangliang181230", "name": "WangLiang/\u738b\u826f"}}, "url": "https://github.com/seata/seata/commit/d44bf154fcc7a74aa822067a2e8539f8753d6a9c", "committedDate": "2020-06-18T10:20:34Z", "message": "if\u8bed\u53e5\u6dfb\u52a0\u5927\u62ec\u53f7\u3002"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzUxMDk1", "url": "https://github.com/seata/seata/pull/2788#pullrequestreview-433751095", "createdAt": "2020-06-19T01:44:04Z", "commit": {"oid": "d44bf154fcc7a74aa822067a2e8539f8753d6a9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzgxNDEx", "url": "https://github.com/seata/seata/pull/2788#pullrequestreview-433781411", "createdAt": "2020-06-19T03:35:46Z", "commit": {"oid": "d44bf154fcc7a74aa822067a2e8539f8753d6a9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3759, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}