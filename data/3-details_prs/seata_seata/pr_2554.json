{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTEyODI1", "number": 2554, "title": "bugfix: add zk serializer.", "bodyText": "\u2160. Describe what this PR did\nadd zk serializer.\n\u2161. Does this pull request fix one issue?\n\nfixes #2337", "createdAt": "2020-04-15T02:56:50Z", "url": "https://github.com/seata/seata/pull/2554", "merged": true, "mergeCommit": {"oid": "141891ea9e6a9cbeb3fc31446f9e9dfc3df09778"}, "closed": true, "closedAt": "2020-04-24T03:04:12Z", "author": {"login": "objcoding"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXvDzdAH2gAyNDAzNTEyODI1OmM2MzVjYTQ4NzMwZGMyM2E2ZGFmMGQ1NWFhODJkMDRkOTJiN2IxZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaokURgFqTM5OTYwOTQwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c635ca48730dc23a6daf0d55aa82d04d92b7b1eb", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/c635ca48730dc23a6daf0d55aa82d04d92b7b1eb", "committedDate": "2020-04-15T02:56:02Z", "message": "feature: add zk serializer."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjMzMjkz", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-393633293", "createdAt": "2020-04-15T10:05:10Z", "commit": {"oid": "c635ca48730dc23a6daf0d55aa82d04d92b7b1eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowNToxMFrOGFyw2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowNToxMFrOGFyw2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNzc3MA==", "bodyText": "Exception replace to Throwable ? Class.forName can be appears LinkageError", "url": "https://github.com/seata/seata/pull/2554#discussion_r408727770", "createdAt": "2020-04-15T10:05:10Z", "author": {"login": "jsbxyyx"}, "path": "config/seata-config-zk/src/main/java/io/seata/config/zk/ZookeeperConfiguration.java", "diffHunk": "@@ -245,4 +250,23 @@ public void handleDataDeleted(String s) {\n         }\n     }\n \n+    private ZkSerializer getZkSerializer() {\n+        ZkSerializer zkSerializer = null;\n+        String serializer = FILE_CONFIG.getConfig(FILE_CONFIG_KEY_PREFIX + SERIALIZER_KEY);\n+        if (StringUtils.isNotBlank(serializer)) {\n+            try {\n+                Class<?> aClass = Class.forName(serializer);\n+                zkSerializer = (ZkSerializer) aClass.newInstance();\n+            } catch (ClassNotFoundException cfe) {\n+                LOGGER.error(\"No zk serializer class found, serializer:{}\", serializer, cfe);\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c635ca48730dc23a6daf0d55aa82d04d92b7b1eb"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5856d19752b0ccf669234c72f6b9f8ff67c7c808", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/5856d19752b0ccf669234c72f6b9f8ff67c7c808", "committedDate": "2020-04-16T10:03:23Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65b47d67611edffe00fadf4730faaf6d5392940d", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/65b47d67611edffe00fadf4730faaf6d5392940d", "committedDate": "2020-04-16T12:40:03Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13b66816811d9a76e4d01e7add5e7e3ea93fe584", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/13b66816811d9a76e4d01e7add5e7e3ea93fe584", "committedDate": "2020-04-16T14:09:13Z", "message": "add zk serializer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e7e8c8eddf44d12bb471f75361f033d3cb747f5", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/8e7e8c8eddf44d12bb471f75361f033d3cb747f5", "committedDate": "2020-04-16T14:09:23Z", "message": "add DefaultZkSerializer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12429de78226e2c18add4dc64632854aedb23b22", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/12429de78226e2c18add4dc64632854aedb23b22", "committedDate": "2020-04-16T14:10:00Z", "message": "Class.forName can be appears LinkageError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8670b248f2be4bd0ec1ef49b218402fe0b17c368", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/8670b248f2be4bd0ec1ef49b218402fe0b17c368", "committedDate": "2020-04-16T14:10:14Z", "message": "Merge remote-tracking branch 'origin/zk-serializer' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd18c3770a6663b2cf63def72d2664ecf9d7588", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/bbd18c3770a6663b2cf63def72d2664ecf9d7588", "committedDate": "2020-04-16T14:11:06Z", "message": "License for DefaultZkSerializer.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjgwNTI4", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-394680528", "createdAt": "2020-04-16T14:19:00Z", "commit": {"oid": "bbd18c3770a6663b2cf63def72d2664ecf9d7588"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDoxOTowMFrOGGnpiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDoxOTowMFrOGGnpiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU5NDI0OQ==", "bodyText": "Default config type is file.", "url": "https://github.com/seata/seata/pull/2554#discussion_r409594249", "createdAt": "2020-04-16T14:19:00Z", "author": {"login": "l81893521"}, "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -54,7 +54,7 @@ registry {\n \n config {\n   # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n-  type = \"file\"\n+  type = \"zk\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd18c3770a6663b2cf63def72d2664ecf9d7588"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc", "committedDate": "2020-04-16T14:22:22Z", "message": "Default config type is file."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjkwOTcz", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-394690973", "createdAt": "2020-04-16T14:29:10Z", "commit": {"oid": "dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDoyOToxMFrOGGoJKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDoyOToxMFrOGGoJKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYwMjM0Nw==", "bodyText": "How about use log to tell users, zkSerializer would use DefaultZkSerializer", "url": "https://github.com/seata/seata/pull/2554#discussion_r409602347", "createdAt": "2020-04-16T14:29:10Z", "author": {"login": "l81893521"}, "path": "config/seata-config-zk/src/main/java/io/seata/config/zk/ZookeeperConfiguration.java", "diffHunk": "@@ -247,4 +252,23 @@ public void handleDataDeleted(String s) {\n         }\n     }\n \n+    private ZkSerializer getZkSerializer() {\n+        ZkSerializer zkSerializer = null;\n+        String serializer = FILE_CONFIG.getConfig(FILE_CONFIG_KEY_PREFIX + SERIALIZER_KEY);\n+        if (StringUtils.isNotBlank(serializer)) {\n+            try {\n+                Class<?> aClass = Class.forName(serializer);\n+                zkSerializer = (ZkSerializer) aClass.newInstance();\n+            } catch (ClassNotFoundException cfe) {\n+                LOGGER.error(\"No zk serializer class found, serializer:{}\", serializer, cfe);\n+            } catch (Throwable cause) {\n+                LOGGER.error(\"found zk serializer encountered an unknown exception\", cause);\n+            }\n+        }\n+        if (zkSerializer == null) {\n+            zkSerializer = new DefaultZkSerializer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3690abac77cb2e01b3ef7aa69ba393034525c6d0", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/3690abac77cb2e01b3ef7aa69ba393034525c6d0", "committedDate": "2020-04-16T14:30:50Z", "message": "fix getZkSerializer log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cea21a8a8aadafa738b6c4aa826ec40e0adb1d82", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/cea21a8a8aadafa738b6c4aa826ec40e0adb1d82", "committedDate": "2020-04-16T14:39:47Z", "message": "fix DefaultZkSerializer.java comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bff4229ba8783efe6202ea6444a1158d2fa1774", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/3bff4229ba8783efe6202ea6444a1158d2fa1774", "committedDate": "2020-04-16T14:44:58Z", "message": "remove useless import."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDk5Nzgy", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-395099782", "createdAt": "2020-04-17T01:13:24Z", "commit": {"oid": "3bff4229ba8783efe6202ea6444a1158d2fa1774"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88ee0baaba90570fb553a6d47f6fe20456cf189", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/a88ee0baaba90570fb553a6d47f6fe20456cf189", "committedDate": "2020-04-19T09:22:50Z", "message": "Prevent privatization of default constructor."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f99fded99ded66ca83e66076175410afe92dd27", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/9f99fded99ded66ca83e66076175410afe92dd27", "committedDate": "2020-04-19T10:50:53Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MTc0NzEw", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-396174710", "createdAt": "2020-04-20T06:38:05Z", "commit": {"oid": "9f99fded99ded66ca83e66076175410afe92dd27"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b780e5581b12106a12b8707f2f70daf4715eaef", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/0b780e5581b12106a12b8707f2f70daf4715eaef", "committedDate": "2020-04-20T07:38:20Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "079c2a4b4de5a4ad2d4a12969e58b969a4d7cdc4", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/079c2a4b4de5a4ad2d4a12969e58b969a4d7cdc4", "committedDate": "2020-04-22T05:05:53Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adc2f1a578be0ec1c4cac652c6e5de6749e59596", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/adc2f1a578be0ec1c4cac652c6e5de6749e59596", "committedDate": "2020-04-22T06:09:06Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "debea7cf7549ea40c15ea41c8f26cc4acc16a325", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/debea7cf7549ea40c15ea41c8f26cc4acc16a325", "committedDate": "2020-04-22T14:34:49Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39b4617b91b76d8e74e7bb0629178c459889fe75", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/39b4617b91b76d8e74e7bb0629178c459889fe75", "committedDate": "2020-04-22T14:35:17Z", "message": "Merge remote-tracking branch 'origin/zk-serializer' into zk-serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NzMwNDY1", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-398730465", "createdAt": "2020-04-23T03:15:22Z", "commit": {"oid": "39b4617b91b76d8e74e7bb0629178c459889fe75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMzoxNToyMlrOGKUrlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMzoxNToyMlrOGKUrlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3Nzc4Mg==", "bodyText": "It is not recommended that the serializer be exposed to the user to increase the cost of understanding what code is actually defined for the configuration item.", "url": "https://github.com/seata/seata/pull/2554#discussion_r413477782", "createdAt": "2020-04-23T03:15:22Z", "author": {"login": "slievrly"}, "path": "config/seata-config-core/src/main/resources/registry.conf", "diffHunk": "@@ -66,6 +66,7 @@ config {\n     serverAddr = \"127.0.0.1:2181\"\n     sessionTimeout = 6000\n     connectTimeout = 2000\n+    serializer = \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39b4617b91b76d8e74e7bb0629178c459889fe75"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19fcdf78435f78154b0081a913598cfcb21bf2f9", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/19fcdf78435f78154b0081a913598cfcb21bf2f9", "committedDate": "2020-04-23T14:56:53Z", "message": "remove zk serializer configuration item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88841845265e54dab6e994ba60662e818ef8a723", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/88841845265e54dab6e994ba60662e818ef8a723", "committedDate": "2020-04-24T01:47:49Z", "message": "Merge branch 'develop' into zk-serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjA5NDAy", "url": "https://github.com/seata/seata/pull/2554#pullrequestreview-399609402", "createdAt": "2020-04-24T03:03:59Z", "commit": {"oid": "88841845265e54dab6e994ba60662e818ef8a723"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3913, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}