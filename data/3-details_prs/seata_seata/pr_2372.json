{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTQ1MjA5", "number": 2372, "title": "optimize: refactor lock store sql with SPI", "bodyText": "\u2160. Describe what this PR did\nRefactor lock store sql with spi.", "createdAt": "2020-03-07T13:31:59Z", "url": "https://github.com/seata/seata/pull/2372", "merged": true, "mergeCommit": {"oid": "494f673ddadff7aa702ee16da4c32fd40350f091"}, "closed": true, "closedAt": "2020-04-01T04:21:32Z", "author": {"login": "objcoding"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLUsS8AH2gAyMzg1MTQ1MjA5OmMzOGI4NWNiNGNmMDQzOTA3ZDkzYWM4MTE1NzdlN2FhNTBjNWQ1YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTP44egFqTM4NTI1NjE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c38b85cb4cf043907d93ac811577e7aa50c5d5a2", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/c38b85cb4cf043907d93ac811577e7aa50c5d5a2", "committedDate": "2020-03-07T13:25:44Z", "message": "Optimize: refactor lock store sql with spi."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2755445e8bcc2ac4f122802794f8c5ee79c54503", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/2755445e8bcc2ac4f122802794f8c5ee79c54503", "committedDate": "2020-03-07T13:28:44Z", "message": "Optimize: refactor lock store sql with spi."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1512a075f06d2d65723ef75b893df06f7afbf8e", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/f1512a075f06d2d65723ef75b893df06f7afbf8e", "committedDate": "2020-03-07T13:31:03Z", "message": "Optimize: refactor lock store sql with spi."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3859d5368810796d732e31d5cc1e9928f3c5863", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/d3859d5368810796d732e31d5cc1e9928f3c5863", "committedDate": "2020-03-07T13:36:52Z", "message": "fix: h2 spi name."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7171f39953f62496165b43a0c473c0b11f1fa623", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/7171f39953f62496165b43a0c473c0b11f1fa623", "committedDate": "2020-03-07T13:40:42Z", "message": "Merge branch 'develop' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3ab523b91341e83c335a6d403677ad29483f55", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/8d3ab523b91341e83c335a6d403677ad29483f55", "committedDate": "2020-03-07T14:03:29Z", "message": "add sql dir."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c98e317d0a543ae18059ef4d602412af92b830fe", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/c98e317d0a543ae18059ef4d602412af92b830fe", "committedDate": "2020-03-07T14:39:05Z", "message": "restore import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d050b9b1af78bbd473db7bfd70cb6c45e04670d3", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/d050b9b1af78bbd473db7bfd70cb6c45e04670d3", "committedDate": "2020-03-08T08:15:32Z", "message": "bugfix: getLogStoreSql."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8922180b854b4da4f86584132baaa23a914b060", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/e8922180b854b4da4f86584132baaa23a914b060", "committedDate": "2020-03-08T08:15:53Z", "message": "Merge remote-tracking branch 'origin/refactor_lock_store_sql_with_spi' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c81b2ad8ea40bee6c7dc2c96f1f96a0d649f01a", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/0c81b2ad8ea40bee6c7dc2c96f1f96a0d649f01a", "committedDate": "2020-03-08T10:19:07Z", "message": "bugfix: rename lock store plugin."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "430d66d7b5e52d69b72bb6442386f59d750d4584", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/430d66d7b5e52d69b72bb6442386f59d750d4584", "committedDate": "2020-03-10T12:42:34Z", "message": "Optimize: Should not support multiple database, Can be changed to a single."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f55937ff14e425c93726bc173a5e316b8e6d54e3", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/f55937ff14e425c93726bc173a5e316b8e6d54e3", "committedDate": "2020-03-18T07:56:45Z", "message": "LOCK_STORE_SQL_MAP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f5940a0536948d82ceb9b9ff3037051b9123dd7", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/2f5940a0536948d82ceb9b9ff3037051b9123dd7", "committedDate": "2020-03-18T12:53:50Z", "message": "add the Lock Store Sql Factory Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09ab9103af97387924ea13fa876f330190c7ade6", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/09ab9103af97387924ea13fa876f330190c7ade6", "committedDate": "2020-03-22T07:59:10Z", "message": "Merge branch 'develop' into refactor_lock_store_sql_with_spi\n\n# Conflicts:\n#\tserver/src/main/java/io/seata/server/storage/db/lock/LockStoreDataBaseDAO.java\n#\tserver/src/main/java/io/seata/server/storage/db/lock/LockStoreSqls.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3871f6d253d286714362256ff08640dca1ca1cb1", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/3871f6d253d286714362256ff08640dca1ca1cb1", "committedDate": "2020-03-22T08:59:13Z", "message": "resolve the code conflict."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/00b8586bbb714cc9b6a056e0b7f59d6d817526f1", "committedDate": "2020-03-29T02:36:54Z", "message": "Merge branch 'develop' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzY4MTAz", "url": "https://github.com/seata/seata/pull/2372#pullrequestreview-383368103", "createdAt": "2020-03-29T03:00:54Z", "commit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mzg5MTQ0", "url": "https://github.com/seata/seata/pull/2372#pullrequestreview-384389144", "createdAt": "2020-03-31T04:07:46Z", "commit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNDowNzo0NlrOF-El2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNDowODo1MFrOF-Em7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzMTI1Nw==", "bodyText": "notice the space", "url": "https://github.com/seata/seata/pull/2372#discussion_r400631257", "createdAt": "2020-03-31T04:07:46Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/store/db/sql/lock/MysqlLockStoreSql.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.core.store.db.sql.lock;\n+\n+import io.seata.common.loader.LoadLevel;\n+\n+/**\n+ * the database lock store mysql sql\n+ *\n+ * @author zhangchenghui.dev@gmail.com\n+ * @since 1.2.0\n+ */\n+@LoadLevel(name = \"mysql\")\n+public class MysqlLockStoreSql extends AbstractLockStoreSql {\n+\n+    /**\n+     * The constant INSERT_LOCK_SQL_MYSQL.\n+     */\n+    private static final String INSERT_LOCK_SQL_MYSQL = \"insert into \" + LOCK_TABLE_PLACE_HOLD + \"(\" + ALL_COLUMNS + \")\" +\n+        \"values (?, ?, ?, ?, ?, ?, ?, now(), now())\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzMTM2OQ==", "bodyText": "notice the space", "url": "https://github.com/seata/seata/pull/2372#discussion_r400631369", "createdAt": "2020-03-31T04:08:12Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/store/db/sql/lock/OceanbaseLockStoreSql.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.core.store.db.sql.lock;\n+\n+import io.seata.common.loader.LoadLevel;\n+\n+/**\n+ * the database lock store oceanbase sql\n+ *\n+ * @author zhangchenghui.dev@gmail.com\n+ * @since 1.2.0\n+ */\n+@LoadLevel(name = \"oceanbase\")\n+public class OceanbaseLockStoreSql extends AbstractLockStoreSql {\n+\n+    /**\n+     * The constant INSERT_LOCK_SQL_OCEANBASE.\n+     */\n+    private static final String INSERT_LOCK_SQL_OCEANBASE = \"insert into \" + LOCK_TABLE_PLACE_HOLD + \"(\" + ALL_COLUMNS + \")\" +\n+        \"values (?, ?, ?, ?, ?, ?, ?, now(), now())\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzMTQxMg==", "bodyText": "notice the space", "url": "https://github.com/seata/seata/pull/2372#discussion_r400631412", "createdAt": "2020-03-31T04:08:27Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/store/db/sql/lock/OracleLockStoreSql.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.core.store.db.sql.lock;\n+\n+import io.seata.common.loader.LoadLevel;\n+\n+/**\n+ * the database lock store oracle sql\n+ *\n+ * @author zhangchenghui.dev@gmail.com\n+ * @since 1.2.0\n+ */\n+@LoadLevel(name = \"oracle\")\n+public class OracleLockStoreSql extends AbstractLockStoreSql {\n+\n+    /**\n+     * The constant INSERT_LOCK_SQL_ORACLE.\n+     */\n+    private static final String INSERT_LOCK_SQL_ORACLE = \"insert into \" + LOCK_TABLE_PLACE_HOLD + \"(\" + ALL_COLUMNS + \")\"\n+        +\n+        \"values (?, ?, ?, ?, ?, ?, ?, sysdate, sysdate)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYzMTUzNQ==", "bodyText": "notice the space", "url": "https://github.com/seata/seata/pull/2372#discussion_r400631535", "createdAt": "2020-03-31T04:08:50Z", "author": {"login": "slievrly"}, "path": "core/src/main/java/io/seata/core/store/db/sql/lock/PostgresqlLockStoreSql.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.core.store.db.sql.lock;\n+\n+import io.seata.common.loader.LoadLevel;\n+\n+/**\n+ * the database lock store postgre sql\n+ *\n+ * @author zhangchenghui.dev@gmail.com\n+ * @since 1.2.0\n+ */\n+@LoadLevel(name = \"postgresql\")\n+public class PostgresqlLockStoreSql extends AbstractLockStoreSql {\n+\n+    /**\n+     * The constant INSERT_LOCK_SQL_POSTGRESQL.\n+     */\n+    private static final String INSERT_LOCK_SQL_POSTGRESQL = \"insert into \" + LOCK_TABLE_PLACE_HOLD + \"(\" + ALL_COLUMNS + \")\"\n+        +\n+        \"values (?, ?, ?, ?, ?, ?, ?, now(), now())\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00b8586bbb714cc9b6a056e0b7f59d6d817526f1"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018e9d4019f48ac15ecc08d355e1016a43550043", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/018e9d4019f48ac15ecc08d355e1016a43550043", "committedDate": "2020-03-31T05:29:22Z", "message": "fix insert space"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee5e08bb04a02508c475b813989b15a90f7ddfd4", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/ee5e08bb04a02508c475b813989b15a90f7ddfd4", "committedDate": "2020-03-31T05:29:33Z", "message": "Merge remote-tracking branch 'origin/refactor_lock_store_sql_with_spi' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c1f175ad279fdc49a7688dc2af75142a4b9d852", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/2c1f175ad279fdc49a7688dc2af75142a4b9d852", "committedDate": "2020-03-31T05:31:17Z", "message": "fix insert space"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f8d424fd04621c2658129234e46309480cb251c", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/4f8d424fd04621c2658129234e46309480cb251c", "committedDate": "2020-03-31T08:51:48Z", "message": "Merge branch 'develop' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d689db8b09a0c22d64e8113fda485fb19fcafa3e", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/d689db8b09a0c22d64e8113fda485fb19fcafa3e", "committedDate": "2020-03-31T10:13:45Z", "message": "fix insert space"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1842dcc388dba52b823b2fc75ee12f394ff12d9e", "author": {"user": {"login": "objcoding", "name": "zhangchenghui"}}, "url": "https://github.com/seata/seata/commit/1842dcc388dba52b823b2fc75ee12f394ff12d9e", "committedDate": "2020-03-31T10:14:16Z", "message": "Merge remote-tracking branch 'origin/refactor_lock_store_sql_with_spi' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef5cc30c72f936ac2afc690a941f4e7f9776110a", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/ef5cc30c72f936ac2afc690a941f4e7f9776110a", "committedDate": "2020-04-01T03:21:01Z", "message": "Merge branch 'develop' into refactor_lock_store_sql_with_spi"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjU2MTYz", "url": "https://github.com/seata/seata/pull/2372#pullrequestreview-385256163", "createdAt": "2020-04-01T04:21:21Z", "commit": {"oid": "ef5cc30c72f936ac2afc690a941f4e7f9776110a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4067, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}