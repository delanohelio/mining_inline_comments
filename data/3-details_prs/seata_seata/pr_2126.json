{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODgyMTMw", "number": 2126, "title": "bugfix: escape characters for column and table names", "bodyText": "\u2160. Describe what this PR did\noracle table name lowercase escape.\n\u2161. Does this pull request fix one issue?\n\nfixes: #2123 #2163\n\u2162. Why don't you add test cases (unit test/integration test)?\n\u2163. Describe how to verify it\n\u2164. Special notes for reviews", "createdAt": "2020-01-03T06:02:09Z", "url": "https://github.com/seata/seata/pull/2126", "merged": true, "mergeCommit": {"oid": "a9cc6061a19fe7fa5c8abbda475e07e2698b4bc8"}, "closed": true, "closedAt": "2020-02-13T07:02:25Z", "author": {"login": "jsbxyyx"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2n7kSAH2gAyMzU4ODgyMTMwOmEyNjE1OThmNDMzOTJlOTM1ZjI3NDAwNWViMTM4OGU2ZWRhODkxMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDzgmIgFqTM1Nzk1MjM4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a261598f43392e935f274005eb1388e6eda89132", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/a261598f43392e935f274005eb1388e6eda89132", "committedDate": "2020-01-03T05:58:12Z", "message": "fix: oracle table name lowercase escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0171cedb81978bd6afea197ea4e27cb63e126279", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/0171cedb81978bd6afea197ea4e27cb63e126279", "committedDate": "2020-01-03T06:16:53Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07be6e5bb923d2d80d31eebddcee547e3d273ce2", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/07be6e5bb923d2d80d31eebddcee547e3d273ce2", "committedDate": "2020-01-03T07:54:48Z", "message": "fix: oracle delete insert update undo log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTA2MzI3", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-338506327", "createdAt": "2020-01-06T07:55:47Z", "commit": {"oid": "07be6e5bb923d2d80d31eebddcee547e3d273ce2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNzo1NTo0N1rOFaXTAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwNzo1NTo0N1rOFaXTAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE4ODk5Mg==", "bodyText": "New continuous maintenance point, I hope there is a way to do it once and for all.\nSuch as passing dbType.", "url": "https://github.com/seata/seata/pull/2126#discussion_r363188992", "createdAt": "2020-01-06T07:55:47Z", "author": {"login": "zjinlei"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -155,12 +157,43 @@ public static String addEscape(String colName, Escape escape) {\n         if (colName.charAt(0) == escape.value && colName.charAt(colName.length() - 1) == escape.value) {\n             return colName;\n         }\n-        return String.format(\"%s%s%s\", escape.value, colName, escape.value);\n+\n+        KeywordChecker keywordChecker = null;\n+        if (escape == Escape.STANDARD) {\n+            keywordChecker = KeywordCheckerFactory.getKeywordChecker(JdbcConstants.ORACLE);\n+        } else if (escape == Escape.MYSQL) {\n+            keywordChecker = KeywordCheckerFactory.getKeywordChecker(JdbcConstants.MYSQL);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07be6e5bb923d2d80d31eebddcee547e3d273ce2"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada9ffa866ce15f3bf63a1dd29692d5baf336161", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/ada9ffa866ce15f3bf63a1dd29692d5baf336161", "committedDate": "2020-01-06T09:54:32Z", "message": "fix: test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc290013a00ba9ee9cd96d220779fd2dff8c24c", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/5bc290013a00ba9ee9cd96d220779fd2dff8c24c", "committedDate": "2020-01-06T10:18:23Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52be99182f94d55c2a2f1a8633b3f34f521aa9e7", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/52be99182f94d55c2a2f1a8633b3f34f521aa9e7", "committedDate": "2020-01-06T10:33:33Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2e05262b56f6f4ed036f614f71010049c36650", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/fe2e05262b56f6f4ed036f614f71010049c36650", "committedDate": "2020-01-06T10:51:53Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ed05fe8d7e9d9fcdb35f599d8806f793acbd367", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/9ed05fe8d7e9d9fcdb35f599d8806f793acbd367", "committedDate": "2020-01-06T10:52:18Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e059bf09ac30cfb434454d6b954d3ccd6a3df59e", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/e059bf09ac30cfb434454d6b954d3ccd6a3df59e", "committedDate": "2020-01-07T01:07:52Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62bda3ad746e4e8fd0b31c2d67ec56af36183c69", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/62bda3ad746e4e8fd0b31c2d67ec56af36183c69", "committedDate": "2020-01-08T07:33:51Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96548a95935ec015bf0d48be4b74a4b40437071b", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/96548a95935ec015bf0d48be4b74a4b40437071b", "committedDate": "2020-01-10T06:28:05Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4981ae0c98d22e2e1aff384d84873053b94eacea", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/4981ae0c98d22e2e1aff384d84873053b94eacea", "committedDate": "2020-01-10T06:37:10Z", "message": "fix conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "611118127de74a598d7344c95af26f0307cb2b81", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/611118127de74a598d7344c95af26f0307cb2b81", "committedDate": "2020-01-10T06:53:43Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f05af739681b3ee4cd2c659e7d81df4f1a45068b", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/f05af739681b3ee4cd2c659e7d81df4f1a45068b", "committedDate": "2020-01-15T08:32:07Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed08363fecfa55e6f274152cb2328812cb349b1", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/2ed08363fecfa55e6f274152cb2328812cb349b1", "committedDate": "2020-01-16T03:43:58Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f6f75bfd994f603f48bbe2f4eb80e243ffbb4d", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/55f6f75bfd994f603f48bbe2f4eb80e243ffbb4d", "committedDate": "2020-01-23T15:01:53Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a335de310a51d1509e2b415bb0727223fb0fc4", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/98a335de310a51d1509e2b415bb0727223fb0fc4", "committedDate": "2020-01-23T16:19:12Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2bdf94e4e2d5dfe706cf1122743f0d9b4a36551", "author": {"user": {"login": "l81893521", "name": "will"}}, "url": "https://github.com/seata/seata/commit/a2bdf94e4e2d5dfe706cf1122743f0d9b4a36551", "committedDate": "2020-02-03T09:25:20Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4838aed3ff688ebe9c3cbb3a4391a149950230e0", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/4838aed3ff688ebe9c3cbb3a4391a149950230e0", "committedDate": "2020-02-04T07:51:52Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf9ffa61333d56b1a77c3d81eb7d23515038399", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/bbf9ffa61333d56b1a77c3d81eb7d23515038399", "committedDate": "2020-02-04T07:53:30Z", "message": "fix: postgresql uppercase character"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODI5ODQ0", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-352829844", "createdAt": "2020-02-04T09:30:19Z", "commit": {"oid": "bbf9ffa61333d56b1a77c3d81eb7d23515038399"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTozMDoxOVrOFlNRPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwOTozMDoxOVrOFlNRPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1OTAzOQ==", "bodyText": "2* escape.len", "url": "https://github.com/seata/seata/pull/2126#discussion_r374559039", "createdAt": "2020-02-04T09:30:19Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -148,19 +150,76 @@ public static String addEscape(String colName, String dbType) {\n      * @param escape the escape\n      * @return\n      */\n-    public static String addEscape(String colName, Escape escape) {\n+    private static String addEscape(String colName, String dbType, Escape escape) {\n         if (colName == null || colName.isEmpty()) {\n             return colName;\n         }\n         if (colName.charAt(0) == escape.value && colName.charAt(colName.length() - 1) == escape.value) {\n             return colName;\n         }\n-        return String.format(\"%s%s%s\", escape.value, colName, escape.value);\n+\n+        KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(dbType);\n+        if (keywordChecker != null) {\n+            boolean check = keywordChecker.check(colName);\n+            if (!check) {\n+                boolean uppercase = isUppercase(colName);\n+                if (uppercase && isOracle(dbType)) {\n+                    // oracle\n+                    // we are recommend table name and column name must uppercase.\n+                    // if exists full uppercase, the table name or column name does't bundle escape symbol.\n+                    return colName;\n+                }\n+                boolean containsUppercase = containsUppercase(colName);\n+                if (!containsUppercase && isPostgresql(dbType)) {\n+                    // postgresql\n+                    // we are recommend table name and column name must lowercase.\n+                    // if exists uppercase character or full uppercase, the table name or column name must bundle escape symbol.\n+                    return colName;\n+                }\n+            }\n+        }\n+\n+        StringBuilder result = new StringBuilder(2 + colName.length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbf9ffa61333d56b1a77c3d81eb7d23515038399"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc632b86888facf68a84e097d8418fc11f94610d", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/dc632b86888facf68a84e097d8418fc11f94610d", "committedDate": "2020-02-05T05:48:15Z", "message": "fix: string builder capacity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c5883bb9087bc8387a2c1dad254046d41ab497a", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/0c5883bb9087bc8387a2c1dad254046d41ab497a", "committedDate": "2020-02-05T05:48:40Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad35d82f77a81c3194eb9b1f653a968fd0da0d1", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/1ad35d82f77a81c3194eb9b1f653a968fd0da0d1", "committedDate": "2020-02-05T10:02:14Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37da76f58a0778e1fbb529fe86114d495d32bf5", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/c37da76f58a0778e1fbb529fe86114d495d32bf5", "committedDate": "2020-02-06T15:38:42Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec6f60cc59bb620fad3541eb830ce41d1cf4ac4", "author": {"user": {"login": "xingfudeshi", "name": "xingfudeshi"}}, "url": "https://github.com/seata/seata/commit/7ec6f60cc59bb620fad3541eb830ce41d1cf4ac4", "committedDate": "2020-02-08T02:21:31Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a391782eb013e1a31eb580a424e9497c9c2a2f", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/69a391782eb013e1a31eb580a424e9497c9c2a2f", "committedDate": "2020-02-10T02:14:57Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjcwMTQz", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-355670143", "createdAt": "2020-02-10T02:56:28Z", "commit": {"oid": "69a391782eb013e1a31eb580a424e9497c9c2a2f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMjo1NjoyOFrOFnZIyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMzowNDozNVrOFnZNxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MDYzMw==", "bodyText": "can be merged with addEscape(String colName, String dbType)", "url": "https://github.com/seata/seata/pull/2126#discussion_r376850633", "createdAt": "2020-02-10T02:56:28Z", "author": {"login": "zjinlei"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -148,19 +150,76 @@ public static String addEscape(String colName, String dbType) {\n      * @param escape the escape\n      * @return\n      */\n-    public static String addEscape(String colName, Escape escape) {\n+    private static String addEscape(String colName, String dbType, Escape escape) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a391782eb013e1a31eb580a424e9497c9c2a2f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MTU1NA==", "bodyText": "if 'colName' comes from user sql and check is false, Is it possible to return 'colName' directly?", "url": "https://github.com/seata/seata/pull/2126#discussion_r376851554", "createdAt": "2020-02-10T03:02:46Z", "author": {"login": "zjinlei"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -148,19 +150,76 @@ public static String addEscape(String colName, String dbType) {\n      * @param escape the escape\n      * @return\n      */\n-    public static String addEscape(String colName, Escape escape) {\n+    private static String addEscape(String colName, String dbType, Escape escape) {\n         if (colName == null || colName.isEmpty()) {\n             return colName;\n         }\n         if (colName.charAt(0) == escape.value && colName.charAt(colName.length() - 1) == escape.value) {\n             return colName;\n         }\n-        return String.format(\"%s%s%s\", escape.value, colName, escape.value);\n+\n+        KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(dbType);\n+        if (keywordChecker != null) {\n+            boolean check = keywordChecker.check(colName);\n+            if (!check) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a391782eb013e1a31eb580a424e9497c9c2a2f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg1MTkxMA==", "bodyText": "Replace keywordChecker.checkAndReplace with ColumnUtils. addEscape uniformly?", "url": "https://github.com/seata/seata/pull/2126#discussion_r376851910", "createdAt": "2020-02-10T03:04:35Z", "author": {"login": "zjinlei"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoInsertExecutor.java", "diffHunk": "@@ -58,8 +58,7 @@ protected String buildUndoSQL() {\n         }\n         Row row = afterImageRows.get(0);\n         Field pkField = row.primaryKeys().get(0);\n-        return String.format(DELETE_SQL_TEMPLATE,\n-                             keywordChecker.checkAndReplace(sqlUndoLog.getTableName()),\n+        return String.format(DELETE_SQL_TEMPLATE, sqlUndoLog.getTableName(),\n                              keywordChecker.checkAndReplace(pkField.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a391782eb013e1a31eb580a424e9497c9c2a2f"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f1353208f3f8f342b339cdf224091eb0cc23b4d", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/7f1353208f3f8f342b339cdf224091eb0cc23b4d", "committedDate": "2020-02-10T09:31:45Z", "message": "fix reviews"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f027121369a312d943a6c657d71e8bc42af5f544", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/f027121369a312d943a6c657d71e8bc42af5f544", "committedDate": "2020-02-10T10:08:55Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MDE0MTk5", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-356014199", "createdAt": "2020-02-10T15:11:53Z", "commit": {"oid": "7f1353208f3f8f342b339cdf224091eb0cc23b4d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNToxMTo1M1rOFnpsjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNToxMTo1M1rOFnpsjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEyMTkzMw==", "bodyText": "move these 3 lines to pgsql keywordcheck", "url": "https://github.com/seata/seata/pull/2126#discussion_r377121933", "createdAt": "2020-02-10T15:11:53Z", "author": {"login": "zjinlei"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -160,22 +160,12 @@ private static String addEscape(String colName, String dbType, Escape escape) {\n \n         KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(dbType);\n         if (keywordChecker != null) {\n-            boolean check = keywordChecker.check(colName);\n+            boolean check = keywordChecker.checkNative(colName);\n             if (!check) {\n-                boolean uppercase = isUppercase(colName);\n-                if (uppercase && isOracle(dbType)) {\n-                    // oracle\n-                    // we are recommend table name and column name must uppercase.\n-                    // if exists full uppercase, the table name or column name does't bundle escape symbol.\n-                    return colName;\n-                }\n-                boolean containsUppercase = containsUppercase(colName);\n-                if (!containsUppercase && isPostgresql(dbType)) {\n-                    // postgresql\n-                    // we are recommend table name and column name must lowercase.\n-                    // if exists uppercase character or full uppercase, the table name or column name must bundle escape symbol.\n-                    return colName;\n-                }\n+                // postgresql\n+                // we are recommend table name and column name must lowercase.\n+                // if exists uppercase character or full uppercase, the table name or column name must bundle escape symbol.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f1353208f3f8f342b339cdf224091eb0cc23b4d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2", "author": {"user": {"login": "zjinlei", "name": null}}, "url": "https://github.com/seata/seata/commit/2870aceac173fe361f5b3c1f8adf0e3238363cc2", "committedDate": "2020-02-11T11:24:05Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTUzOTcz", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-357153973", "createdAt": "2020-02-12T02:33:00Z", "commit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMjozMzowMFrOFof96Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMjozNjozOVrOFogA5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxMTExMw==", "bodyText": "CheckEscape?", "url": "https://github.com/seata/seata/pull/2126#discussion_r378011113", "createdAt": "2020-02-12T02:33:00Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/oracle/keyword/OracleKeywordChecker.java", "diffHunk": "@@ -502,9 +502,34 @@ public boolean check(String fieldOrTableName) {\n \n     }\n \n+    @Override\n+    public boolean checkNative(String fieldOrTableName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxMTg3Nw==", "bodyText": "There is no KeywordChecker for PGSQL, waiting for PGSQL to merge and process.", "url": "https://github.com/seata/seata/pull/2126#discussion_r378011877", "createdAt": "2020-02-12T02:36:39Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/ColumnUtils.java", "diffHunk": "@@ -160,22 +160,12 @@ private static String addEscape(String colName, String dbType, Escape escape) {\n \n         KeywordChecker keywordChecker = KeywordCheckerFactory.getKeywordChecker(dbType);\n         if (keywordChecker != null) {\n-            boolean check = keywordChecker.check(colName);\n+            boolean check = keywordChecker.checkNative(colName);\n             if (!check) {\n-                boolean uppercase = isUppercase(colName);\n-                if (uppercase && isOracle(dbType)) {\n-                    // oracle\n-                    // we are recommend table name and column name must uppercase.\n-                    // if exists full uppercase, the table name or column name does't bundle escape symbol.\n-                    return colName;\n-                }\n-                boolean containsUppercase = containsUppercase(colName);\n-                if (!containsUppercase && isPostgresql(dbType)) {\n-                    // postgresql\n-                    // we are recommend table name and column name must lowercase.\n-                    // if exists uppercase character or full uppercase, the table name or column name must bundle escape symbol.\n-                    return colName;\n-                }\n+                // postgresql\n+                // we are recommend table name and column name must lowercase.\n+                // if exists uppercase character or full uppercase, the table name or column name must bundle escape symbol.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzEyMTkzMw=="}, "originalCommit": {"oid": "7f1353208f3f8f342b339cdf224091eb0cc23b4d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTY5OTg4", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-357169988", "createdAt": "2020-02-12T03:35:17Z", "commit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMzozNToxOFrOFog0DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMzozNzo1NVrOFog2Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAyNDk3Mw==", "bodyText": "mark: update columns must not contain escape, otherwise the original SQL will report an error.", "url": "https://github.com/seata/seata/pull/2126#discussion_r378024973", "createdAt": "2020-02-12T03:35:18Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoUpdateExecutor.java", "diffHunk": "@@ -58,10 +58,9 @@ protected String buildUndoSQL() {\n         Field pkField = row.primaryKeys().get(0);\n         List<Field> nonPkFields = row.nonPrimaryKeys();\n         String updateColumns = nonPkFields.stream()\n-            .map(field -> keywordChecker.checkAndReplace(field.getName()) + \" = ?\")\n+            .map(field -> field.getName() + \" = ?\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAyNTUxOA==", "bodyText": "I think we need to escape character judgment here on the primary key.", "url": "https://github.com/seata/seata/pull/2126#discussion_r378025518", "createdAt": "2020-02-12T03:37:55Z", "author": {"login": "slievrly"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/undo/mysql/MySQLUndoUpdateExecutor.java", "diffHunk": "@@ -58,10 +58,9 @@ protected String buildUndoSQL() {\n         Field pkField = row.primaryKeys().get(0);\n         List<Field> nonPkFields = row.nonPrimaryKeys();\n         String updateColumns = nonPkFields.stream()\n-            .map(field -> keywordChecker.checkAndReplace(field.getName()) + \" = ?\")\n+            .map(field -> field.getName() + \" = ?\")\n             .collect(Collectors.joining(\", \"));\n-        return String.format(UPDATE_SQL_TEMPLATE, keywordChecker.checkAndReplace(sqlUndoLog.getTableName()),\n-                             updateColumns, keywordChecker.checkAndReplace(pkField.getName()));\n+        return String.format(UPDATE_SQL_TEMPLATE, sqlUndoLog.getTableName(), updateColumns, pkField.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2870aceac173fe361f5b3c1f8adf0e3238363cc2"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "020cd2598fe361b3cfc194181f8ce620d00b18f2", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/020cd2598fe361b3cfc194181f8ce620d00b18f2", "committedDate": "2020-02-12T06:35:18Z", "message": "fix: undo log sql add escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "602dd93ea5d2ddda67be2c3fae623e52d6eb23dd", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/602dd93ea5d2ddda67be2c3fae623e52d6eb23dd", "committedDate": "2020-02-12T06:36:06Z", "message": "Merge branch 'fix_2123' of https://github.com/jsbxyyx/seata into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4f9799686e22c2197e4128cd947bae332c813d2", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/a4f9799686e22c2197e4128cd947bae332c813d2", "committedDate": "2020-02-12T06:49:09Z", "message": "fix: unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58946ef83a33f5764b506e1d33b77d5ca862c819", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/58946ef83a33f5764b506e1d33b77d5ca862c819", "committedDate": "2020-02-12T07:07:20Z", "message": "fix: ci"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MzAyNjc3", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-357302677", "createdAt": "2020-02-12T09:33:25Z", "commit": {"oid": "58946ef83a33f5764b506e1d33b77d5ca862c819"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c768f42c3b27a841892cbdc1c7d00e304624a32a", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/c768f42c3b27a841892cbdc1c7d00e304624a32a", "committedDate": "2020-02-12T09:55:17Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412a0c38820a5ea5c4a720eef5b4b63b475ebaed", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/412a0c38820a5ea5c4a720eef5b4b63b475ebaed", "committedDate": "2020-02-12T10:42:02Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTE0NjQy", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-357914642", "createdAt": "2020-02-13T02:11:55Z", "commit": {"oid": "412a0c38820a5ea5c4a720eef5b4b63b475ebaed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMjoxMTo1NVrOFpE8rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMjoxMTo1NVrOFpE8rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYxNzAwNA==", "bodyText": "What afterImage use for?", "url": "https://github.com/seata/seata/pull/2126#discussion_r378617004", "createdAt": "2020-02-13T02:11:55Z", "author": {"login": "l81893521"}, "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/BaseTransactionalExecutor.java", "diffHunk": "@@ -317,7 +317,8 @@ protected TableRecords buildTableRecords(TableMeta tableMeta, String selectSQL,\n      * @throws SQLException\n      */\n     protected TableRecords buildTableRecords(List<Object> pkValues) throws SQLException {\n-        String pk = getTableMeta().getPkName();\n+        TableRecords afterImage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "412a0c38820a5ea5c4a720eef5b4b63b475ebaed"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a74c3ab304d7b54a384ec9e31e968059a4cdf462", "author": {"user": {"login": "slievrly", "name": "jimin"}}, "url": "https://github.com/seata/seata/commit/a74c3ab304d7b54a384ec9e31e968059a4cdf462", "committedDate": "2020-02-13T02:15:50Z", "message": "Merge branch 'develop' into fix_2123"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c43ab831dee343a321ef53569527a9bb0815b5a", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/4c43ab831dee343a321ef53569527a9bb0815b5a", "committedDate": "2020-02-13T03:38:08Z", "message": "feat: pgsql checkEscape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "952ca35e9976933e972cf38588e407a2fc9ea837", "author": {"user": {"login": "jsbxyyx", "name": "jsbxyyx"}}, "url": "https://github.com/seata/seata/commit/952ca35e9976933e972cf38588e407a2fc9ea837", "committedDate": "2020-02-13T03:47:51Z", "message": "feat: pgsql checkEscape"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTUyMzg3", "url": "https://github.com/seata/seata/pull/2126#pullrequestreview-357952387", "createdAt": "2020-02-13T04:48:37Z", "commit": {"oid": "952ca35e9976933e972cf38588e407a2fc9ea837"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4108, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}