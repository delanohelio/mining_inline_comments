{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTk5ODEw", "number": 105, "title": "Add settings to disable/enable AD dynamically", "bodyText": "Issue #, if available:\nDescription of changes:\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\nTesting done:\n\nadded tests to verify if AD plugin rejects RESTful requests when it is disabled\nmanually verified AD jobs are stopped when AD plugin is disabled\n\nUsage:\ncurl -XPUT \"localhost:9200/_cluster/settings\" -H 'Content-Type: application/json' -d'\n{\n  \"persistent\": {\n    \"opendistro.anomaly_detection.enabled\": false\n  }\n}'\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-04T21:40:05Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105", "merged": true, "mergeCommit": {"oid": "810966096c35b77d277e84f5d0e16ec0d7dcc65a"}, "closed": true, "closedAt": "2020-05-04T22:50:17Z", "author": {"login": "kaituo"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceG-3_gFqTQwNTM4NDM5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceHhWDABqjMzMDIwMTQzNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzg0Mzk3", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#pullrequestreview-405384397", "createdAt": "2020-05-04T22:11:55Z", "commit": {"oid": "7904012d104bcbe9f1a74e795b7904f6e72ca80b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzkxOTY5", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#pullrequestreview-405391969", "createdAt": "2020-05-04T22:28:49Z", "commit": {"oid": "7904012d104bcbe9f1a74e795b7904f6e72ca80b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyODo0OVrOGQUg1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyODo0OVrOGQUg1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NjQ4NQ==", "bodyText": "We will set AD plugin as enabled by default. After user disabling it and restart domain, are we able to read the latest configuration and set AD as disabled by defulat?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#discussion_r419766485", "createdAt": "2020-05-04T22:28:49Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/EnabledSetting.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.settings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import static java.util.Collections.unmodifiableMap;\n+import static org.elasticsearch.common.settings.Setting.Property.Dynamic;\n+import static org.elasticsearch.common.settings.Setting.Property.NodeScope;\n+\n+public class EnabledSetting {\n+\n+    private static Logger logger = LogManager.getLogger(EnabledSetting.class);\n+\n+    /**\n+     * Singleton instance\n+     */\n+    private static EnabledSetting INSTANCE;\n+\n+    /**\n+     * Settings name\n+     */\n+    public static final String AD_PLUGIN_ENABLED = \"opendistro.anomaly_detection.enabled\";\n+\n+    private final Map<String, Setting<?>> settings = unmodifiableMap(new HashMap<String, Setting<?>>() {\n+        {\n+            /**\n+             * AD plugin enable/disable setting\n+             */\n+            put(AD_PLUGIN_ENABLED, Setting.boolSetting(AD_PLUGIN_ENABLED, true, NodeScope, Dynamic));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7904012d104bcbe9f1a74e795b7904f6e72ca80b"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzk0NzAx", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/105#pullrequestreview-405394701", "createdAt": "2020-05-04T22:35:13Z", "commit": {"oid": "7904012d104bcbe9f1a74e795b7904f6e72ca80b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f652c78405c2b9d05e1a256e82c85d68689ce5e6", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f652c78405c2b9d05e1a256e82c85d68689ce5e6", "committedDate": "2020-05-04T22:43:51Z", "message": "Add settings to disable/enable AD dynamically\n\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\n\nTesting done:\n- added tests to verify if AD plugin rejects RESTful requests when it is disabled\n- manually verified AD jobs are stopped when AD plugin is disabled"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7904012d104bcbe9f1a74e795b7904f6e72ca80b", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/7904012d104bcbe9f1a74e795b7904f6e72ca80b", "committedDate": "2020-05-04T21:31:32Z", "message": "Add settings to disable/enable AD dynamically\n\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\n\nTesting done:\n- added tests to verify if AD plugin rejects RESTful requests when it is disabled\n- manually verified AD jobs are stopped when AD plugin is disabled"}, "afterCommit": {"oid": "f652c78405c2b9d05e1a256e82c85d68689ce5e6", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f652c78405c2b9d05e1a256e82c85d68689ce5e6", "committedDate": "2020-05-04T22:43:51Z", "message": "Add settings to disable/enable AD dynamically\n\nThis PR adds settings to disable/enable AD dynamically.  AD plugin rejects RESTful requests and stops AD jobs when it is disabled.\n\nTesting done:\n- added tests to verify if AD plugin rejects RESTful requests when it is disabled\n- manually verified AD jobs are stopped when AD plugin is disabled"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1673, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}