{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMDM3ODU0", "number": 251, "title": "Adding User support for Detector and DetectorJob", "bodyText": "*Issue #195 *\nDescription of changes:\nAdding User support to store User information for each detector created and store user context in .opendistro-anomaly-detectors index.\nAdding User support for AD Job and store user context in .opendistro-anomaly-detectors-jobs.\nUser role will be used to filter when AD Rest API's are invoked.\nBackground jobs will soon have injected role from the User context.\nUser information is always sent to elasticsearch when Opendistro security plugin is enabled.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-14T00:47:09Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251", "merged": true, "mergeCommit": {"oid": "77e8b8587b89154e7c9863fd1a8063ee04b91c10"}, "closed": true, "closedAt": "2020-10-15T09:39:16Z", "author": {"login": "saratvemulapalli"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSRurzgH2gAyNTAzMDM3ODU0OmQwODk0Y2I1ZDY1OGVkMjA2MzhjNjgyNGVmZWNmOTAwMDNjYjUwYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS0at1gFqTUwOTU2NDQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0894cb5d658ed20638c6824efecf90003cb50c5", "author": {"user": {"login": "saratvemulapalli", "name": "Sarat Vemulapalli"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/d0894cb5d658ed20638c6824efecf90003cb50c5", "committedDate": "2020-10-14T00:07:15Z", "message": "Adding User support for AD and ADJob"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81093f7f1f2fe6b898e5db4b673fc3608ad8d65f", "author": {"user": {"login": "saratvemulapalli", "name": "Sarat Vemulapalli"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/81093f7f1f2fe6b898e5db4b673fc3608ad8d65f", "committedDate": "2020-10-14T00:39:48Z", "message": "Rebasing changes from master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTM3MTY5", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-507937169", "createdAt": "2020-10-14T01:41:14Z", "commit": {"oid": "81093f7f1f2fe6b898e5db4b673fc3608ad8d65f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5", "author": {"user": {"login": "saratvemulapalli", "name": "Sarat Vemulapalli"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/ec266d0c419ce0acd696e84cad8fde89fdbffdc5", "committedDate": "2020-10-14T01:54:20Z", "message": "Adding spotless recommended changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTYxOTA0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-507961904", "createdAt": "2020-10-14T03:05:02Z", "commit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzowNTowM1rOHhAdyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzowNTowM1rOHhAdyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3MjY4Mg==", "bodyText": "Add user field in detector index mapping https://github.com/opendistro-for-elasticsearch/anomaly-detection/blob/master/src/main/resources/mappings/anomaly-detectors.json ?\nSame for detector job.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#discussion_r504372682", "createdAt": "2020-10-14T03:05:03Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/AnomalyDetector.java", "diffHunk": "@@ -289,6 +308,9 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n         if (categoryFields != null) {\n             xContentBuilder.field(CATEGORY_FIELD, categoryFields.toArray());\n         }\n+        if (user != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTYyNTk3", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-507962597", "createdAt": "2020-10-14T03:07:31Z", "commit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzowNzozMlrOHhAf_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzowNzozMlrOHhAf_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3MzI0NA==", "bodyText": "Here we just add User in each detector document. Security plugin will do authorization check for each request based on backend_roles or roles ? Can you share the related code?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#discussion_r504373244", "createdAt": "2020-10-14T03:07:32Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/AnomalyDetector.java", "diffHunk": "@@ -131,7 +135,8 @@ public AnomalyDetector(\n         Map<String, Object> uiMetadata,\n         Integer schemaVersion,\n         Instant lastUpdateTime,\n-        List<String> categoryFields\n+        List<String> categoryFields,\n+        User user", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3OTYzOTE1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-507963915", "createdAt": "2020-10-14T03:12:00Z", "commit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzoxMjowMVrOHhAkgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMzoxMjowMVrOHhAkgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3NDQwMw==", "bodyText": "For old detector, they have no user field, so they will be open to all users which has AD permission ?\nFor new detector, we will create default user with the creator's user role?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#discussion_r504374403", "createdAt": "2020-10-14T03:12:01Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/AnomalyDetector.java", "diffHunk": "@@ -260,6 +273,12 @@ public void writeTo(StreamOutput output) throws IOException {\n         output.writeInt(schemaVersion);\n         output.writeInstant(lastUpdateTime);\n         output.writeStringCollection(categoryFields);\n+        if (user != null) {\n+            output.writeBoolean(true); // user exists\n+            user.writeTo(output);\n+        } else {\n+            output.writeBoolean(false); // user does not exist", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec266d0c419ce0acd696e84cad8fde89fdbffdc5"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "010c88c43b52cce58a46630dda89115a1fe05375", "author": {"user": {"login": "saratvemulapalli", "name": "Sarat Vemulapalli"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/010c88c43b52cce58a46630dda89115a1fe05375", "committedDate": "2020-10-14T07:58:07Z", "message": "Updated AD and ADJob Mappings with User information"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTkzMTM2", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-509193136", "createdAt": "2020-10-15T09:33:55Z", "commit": {"oid": "010c88c43b52cce58a46630dda89115a1fe05375"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTY0NDA3", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/251#pullrequestreview-509564407", "createdAt": "2020-10-15T16:32:07Z", "commit": {"oid": "010c88c43b52cce58a46630dda89115a1fe05375"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1575, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}