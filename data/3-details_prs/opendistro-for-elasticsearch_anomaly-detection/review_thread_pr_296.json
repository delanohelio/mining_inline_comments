{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNTAxMzg5", "number": 296, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjozNzowMlrOEyM3jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjozNzowMlrOEyM3jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDc1MDg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjozNzowMlrOHotNsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMDoxMzoxOVrOHqCBOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg==", "bodyText": "Should we return empty results or some failure like this https://github.com/opendistro-for-elasticsearch/anomaly-detection/blob/master/src/main/java/com/amazon/opendistroforelasticsearch/ad/feature/FeatureManager.java#L525", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512445872", "createdAt": "2020-10-27T06:37:02Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ1MTYzOA==", "bodyText": "Such failure will be caught and empty result is still returned instead in onFailure()\nI think it is okay to just return empty result", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512451638", "createdAt": "2020-10-27T06:53:19Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODkyNg==", "bodyText": "Could you tell me why it would end up calling onFailure?  listener is the rest channel.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r512958926", "createdAt": "2020-10-27T19:12:43Z", "author": {"login": "kaituo"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzExNTcxNw==", "bodyText": "If entities is empty, code execution won't go into the for loop below, and listener has no chance to call onFailure or onResponse", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513115717", "createdAt": "2020-10-28T00:50:15Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcxMDE1NQ==", "bodyText": "I feel it is better to return some failure and show that on kibana than return empty result.  Customers may wonder why it returns nothing.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513710155", "createdAt": "2020-10-28T19:35:26Z", "author": {"login": "kaituo"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgzMTI4Ng==", "bodyText": "if empty list is returned, existing Kibana will show corresponding message.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513831286", "createdAt": "2020-10-28T23:59:42Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgzNTMyMw==", "bodyText": "Can you add a comment explaining why we want to return empty responses instead of errors?  It helps code readability.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/296#discussion_r513835323", "createdAt": "2020-10-29T00:13:19Z", "author": {"login": "kaituo"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorRunner.java", "diffHunk": "@@ -72,6 +72,9 @@ public void executeDetector(AnomalyDetector detector, Instant startTime, Instant\n         if (categoryField != null && !categoryField.isEmpty()) {\n             featureManager.getPreviewEntities(detector, startTime.toEpochMilli(), endTime.toEpochMilli(), ActionListener.wrap(entities -> {\n \n+                if (entities == null || entities.isEmpty()) {\n+                    listener.onResponse(Collections.emptyList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ0NTg3Mg=="}, "originalCommit": {"oid": "3a06ebbf88cfc47f605e74563b30b440c32beed0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2800, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}