{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNjA5MDIx", "number": 133, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoxMzoyMlrOD_BLqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMzo1Njo1OFrOD_GDZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDA2MjUwOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoxMzoyMlrOGZeQTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMTozOTowNVrOGZmxYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MzI3Ng==", "bodyText": "if it is timed out, is it better to fail fast?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429363276", "createdAt": "2020-05-22T17:13:22Z", "author": {"login": "wnbts"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "diffHunk": "@@ -172,7 +172,22 @@ private void startDetector(\n             } catch (Exception e) {}\n         }\n         Thread.sleep(5_000);\n-        getDetectionResult(detectorId, begin, end, client);\n+        // It takes more time to wait for model initialization on a remote cluster\n+        long startTime = System.currentTimeMillis();\n+        while (true) {\n+            try {\n+                getDetectionResult(detectorId, begin, end, client);\n+                break;\n+            } catch (Exception e) {\n+                long duration = System.currentTimeMillis() - startTime;\n+                // we wait at most 60 secs\n+                if (duration < 60_000) {\n+                    Thread.sleep(2_000);\n+                } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgxNg==", "bodyText": "yeah, changed to throw exception.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429502816", "createdAt": "2020-05-23T01:39:05Z", "author": {"login": "kaituo"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "diffHunk": "@@ -172,7 +172,22 @@ private void startDetector(\n             } catch (Exception e) {}\n         }\n         Thread.sleep(5_000);\n-        getDetectionResult(detectorId, begin, end, client);\n+        // It takes more time to wait for model initialization on a remote cluster\n+        long startTime = System.currentTimeMillis();\n+        while (true) {\n+            try {\n+                getDetectionResult(detectorId, begin, end, client);\n+                break;\n+            } catch (Exception e) {\n+                long duration = System.currentTimeMillis() - startTime;\n+                // we wait at most 60 secs\n+                if (duration < 60_000) {\n+                    Thread.sleep(2_000);\n+                } else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MzI3Ng=="}, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDA2NDQxOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoxNDowNlrOGZeRjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMTozOToxMlrOGZmxaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MzU5Ng==", "bodyText": "this wait can be merged to the wait below now", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429363596", "createdAt": "2020-05-22T17:14:06Z", "author": {"login": "wnbts"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "diffHunk": "@@ -172,7 +172,22 @@ private void startDetector(\n             } catch (Exception e) {}\n         }\n         Thread.sleep(5_000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgyNw==", "bodyText": "merged", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429502827", "createdAt": "2020-05-23T01:39:12Z", "author": {"login": "kaituo"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/e2e/DetectionResultEvalutationIT.java", "diffHunk": "@@ -172,7 +172,22 @@ private void startDetector(\n             } catch (Exception e) {}\n         }\n         Thread.sleep(5_000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2MzU5Ng=="}, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDg2MDU1OnYy", "diffSide": "RIGHT", "path": ".github/workflows/CI.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMzo1Njo1OFrOGZmIkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMjo0MDo0N1rOGZnBfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5MjM3MQ==", "bodyText": "This won't run if the first one fails. just wanna confirm if this is what we expect", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429492371", "createdAt": "2020-05-22T23:56:58Z", "author": {"login": "weicongs-amazon"}, "path": ".github/workflows/CI.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+name: Build and Test Anomaly detection\n+on:\n+  push:\n+    branches:\n+      - master\n+      - opendistro-*\n+\n+jobs:\n+  Build-ad:\n+    strategy:\n+      matrix:\n+        java: [14]\n+\n+    name: Build and Test Anomaly detection Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout AD\n+        uses: actions/checkout@v1\n+\n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+\n+      - name: Run build\n+        run: |\n+          ./gradlew build\n+          ls -ltr build/distributions/\n+\n+      - name: Pull and Run Docker\n+        run: |\n+          plugin=`ls build/distributions/*.zip`\n+          version=`echo $plugin|awk -F- '{print $4}'| cut -d. -f 1-3`\n+          plugin_version=`echo $plugin|awk -F- '{print $4}'| cut -d. -f 1-4`\n+          echo $version\n+          cd ..\n+\n+          if docker pull opendistroforelasticsearch/opendistroforelasticsearch:$version\n+          then\n+            echo \"FROM opendistroforelasticsearch/opendistroforelasticsearch:$version\" >> Dockerfile\n+\n+            ## The ESRestTest Client uses http by default.\n+            ## Need to disable the security plugin to call the rest api over http.\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro_security ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro_security; fi\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro-anomaly-detection ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro-anomaly-detection; fi\" >> Dockerfile\n+            echo \"ADD anomaly-detection/build/distributions/opendistro-anomaly-detection-$plugin_version.zip /tmp/\" >> Dockerfile\n+            echo \"RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch file:/tmp/opendistro-anomaly-detection-$plugin_version.zip\" >> Dockerfile\n+\n+            docker build -t odfe-ad:test .\n+          fi\n+\n+      - name: Run Docker Image\n+        run: |\n+          cd ..\n+          docker run -p 9200:9200 -d -p 9600:9600 -e \"discovery.type=single-node\" odfe-ad:test\n+          sleep 90\n+          curl -XGET http://localhost:9200/_cat/plugins\n+\n+      - name: Run AD Test\n+        run: |\n+          ./gradlew ':integTestRunner' --tests \"com.amazon.opendistroforelasticsearch.ad.rest.*IT\" -Dtests.rest.cluster=localhost:9200 -Dtests.cluster=localhost:9200 -Dtests.clustername=\"docker-cluster\"\n+          ./gradlew :integTestRunner --tests \"com.amazon.opendistroforelasticsearch.ad.e2e.*IT\"  -Dtests.rest.cluster=localhost:9200 -Dtests.cluster=localhost:9200 -Dtests.clustername=\"docker-cluster\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNjk0MQ==", "bodyText": "good point.  Merged these 2 lines into one.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/133#discussion_r429506941", "createdAt": "2020-05-23T02:40:47Z", "author": {"login": "kaituo"}, "path": ".github/workflows/CI.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+name: Build and Test Anomaly detection\n+on:\n+  push:\n+    branches:\n+      - master\n+      - opendistro-*\n+\n+jobs:\n+  Build-ad:\n+    strategy:\n+      matrix:\n+        java: [14]\n+\n+    name: Build and Test Anomaly detection Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout AD\n+        uses: actions/checkout@v1\n+\n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+\n+      - name: Run build\n+        run: |\n+          ./gradlew build\n+          ls -ltr build/distributions/\n+\n+      - name: Pull and Run Docker\n+        run: |\n+          plugin=`ls build/distributions/*.zip`\n+          version=`echo $plugin|awk -F- '{print $4}'| cut -d. -f 1-3`\n+          plugin_version=`echo $plugin|awk -F- '{print $4}'| cut -d. -f 1-4`\n+          echo $version\n+          cd ..\n+\n+          if docker pull opendistroforelasticsearch/opendistroforelasticsearch:$version\n+          then\n+            echo \"FROM opendistroforelasticsearch/opendistroforelasticsearch:$version\" >> Dockerfile\n+\n+            ## The ESRestTest Client uses http by default.\n+            ## Need to disable the security plugin to call the rest api over http.\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro_security ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro_security; fi\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro-anomaly-detection ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro-anomaly-detection; fi\" >> Dockerfile\n+            echo \"ADD anomaly-detection/build/distributions/opendistro-anomaly-detection-$plugin_version.zip /tmp/\" >> Dockerfile\n+            echo \"RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch file:/tmp/opendistro-anomaly-detection-$plugin_version.zip\" >> Dockerfile\n+\n+            docker build -t odfe-ad:test .\n+          fi\n+\n+      - name: Run Docker Image\n+        run: |\n+          cd ..\n+          docker run -p 9200:9200 -d -p 9600:9600 -e \"discovery.type=single-node\" odfe-ad:test\n+          sleep 90\n+          curl -XGET http://localhost:9200/_cat/plugins\n+\n+      - name: Run AD Test\n+        run: |\n+          ./gradlew ':integTestRunner' --tests \"com.amazon.opendistroforelasticsearch.ad.rest.*IT\" -Dtests.rest.cluster=localhost:9200 -Dtests.cluster=localhost:9200 -Dtests.clustername=\"docker-cluster\"\n+          ./gradlew :integTestRunner --tests \"com.amazon.opendistroforelasticsearch.ad.e2e.*IT\"  -Dtests.rest.cluster=localhost:9200 -Dtests.cluster=localhost:9200 -Dtests.clustername=\"docker-cluster\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5MjM3MQ=="}, "originalCommit": {"oid": "b530acfafd75a5b10c72ed98e3fb88029c78a30f"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2858, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}