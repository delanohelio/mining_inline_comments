{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NjIzMTUz", "number": 347, "title": "backport change: filter out exceptions which should not be counted in failure stats", "bodyText": "Issue #, if available:\nBackport this change: #341\nDescription of changes:\n\nCatch wrong feature query exception and stop detector\nSome exceptions are caused by customer input, which not related with the code logic. Will filter out such exceptions so we can get the failure stats which caused by server error.\n\nTest\n\n./gradlew build\n./gradlew integTest -PnumNodes=3 \nStart local cluster and test\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-29T20:25:57Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347", "merged": true, "mergeCommit": {"oid": "11dfbf1a726039fb3a778d9f21d01022fa312f8e"}, "closed": true, "closedAt": "2020-12-29T23:13:34Z", "author": {"login": "ylwu-amzn"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdq5IVmgH2gAyNTQ2NjIzMTUzOmUyOWZjZmRmNjEwOGE5OGQzM2ViZDdiNjk3NTQ0Yjk1NzE3NTA4ZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrDDYLgFqTU1OTczNDUwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8", "author": {"user": {"login": "ylwu-amzn", "name": "Yaliang"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/e29fcfdf6108a98d33ebd7b697544b95717508e8", "committedDate": "2020-12-29T11:35:45Z", "message": "filter out exceptions which should not be counted in failure stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzA2ODE5", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#pullrequestreview-559706819", "createdAt": "2020-12-29T21:21:18Z", "commit": {"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMToyMToxOFrOIMYcNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQyMToyMToxOFrOIMYcNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg1NDI2MQ==", "bodyText": "Do we have tests for HC detectors?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#discussion_r549854261", "createdAt": "2020-12-29T21:21:18Z", "author": {"login": "kaituo"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/transport/AnomalyResultTransportActionTests.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import static com.amazon.opendistroforelasticsearch.ad.TestHelpers.randomQuery;\n+\n+import java.io.IOException;\n+import java.time.Instant;\n+import java.time.temporal.ChronoUnit;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.elasticsearch.action.get.GetResponse;\n+import org.elasticsearch.common.io.stream.NotSerializableExceptionWrapper;\n+import org.elasticsearch.search.aggregations.AggregationBuilder;\n+import org.elasticsearch.test.rest.ESRestTestCase;\n+import org.junit.Before;\n+\n+import com.amazon.opendistroforelasticsearch.ad.ADIntegTestCase;\n+import com.amazon.opendistroforelasticsearch.ad.TestHelpers;\n+import com.amazon.opendistroforelasticsearch.ad.common.exception.AnomalyDetectionException;\n+import com.amazon.opendistroforelasticsearch.ad.model.AnomalyDetector;\n+import com.amazon.opendistroforelasticsearch.ad.model.Feature;\n+import com.amazon.opendistroforelasticsearch.ad.model.IntervalTimeConfiguration;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+\n+public class AnomalyResultTransportActionTests extends ADIntegTestCase {\n+    private String testIndex;\n+    private Instant testDataTimeStamp;\n+    private long start;\n+    private long end;\n+\n+    @Override\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+        testIndex = \"test_data\";\n+        testDataTimeStamp = Instant.now();\n+        start = testDataTimeStamp.minus(10, ChronoUnit.MINUTES).toEpochMilli();\n+        end = testDataTimeStamp.plus(10, ChronoUnit.MINUTES).toEpochMilli();\n+        ingestTestData();\n+    }\n+\n+    private void ingestTestData() throws IOException {\n+        String mappings = \"{\\\"properties\\\":{\\\"timestamp\\\":{\\\"type\\\":\\\"date\\\",\\\"format\\\":\\\"strict_date_time||epoch_millis\\\"},\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzIxOTg4", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#pullrequestreview-559721988", "createdAt": "2020-12-29T22:10:03Z", "commit": {"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzM0NTA5", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/347#pullrequestreview-559734509", "createdAt": "2020-12-29T23:09:23Z", "commit": {"oid": "e29fcfdf6108a98d33ebd7b697544b95717508e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1458, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}