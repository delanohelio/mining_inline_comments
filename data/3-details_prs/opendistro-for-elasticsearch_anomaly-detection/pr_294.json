{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NzQ0NTI3", "number": 294, "title": "fix no permission when preview detector with detector id", "bodyText": "Issue #, if available:\nDescription of changes:\nWhen FGAC enabled and preview detector with detector id, it throws no permission exception as can't read detector config index.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-26T04:15:07Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294", "merged": true, "mergeCommit": {"oid": "060db245b1f9792df2566e2aa5fc61ca088ce5ac"}, "closed": true, "closedAt": "2020-10-26T17:06:06Z", "author": {"login": "ylwu-amzn"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWOWLiAH2gAyNTA5NzQ0NTI3Ojg5YzkwNTcxOGY4Nzg2ZDZlZGYwNjUwYjhlNmVjOGRjYWFhMjcwY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWXf53AFqTUxNjk5NTQ2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb", "author": {"user": {"login": "ylwu-amzn", "name": "Yaliang"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/89c905718f8786d6edf0650b8e6ec8dcaaa270cb", "committedDate": "2020-10-26T06:26:28Z", "message": "fix no permission when preview detector with detector id"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f91edc6d389c051141632a00cd5f080f13e552a", "author": {"user": {"login": "ylwu-amzn", "name": "Yaliang"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/0f91edc6d389c051141632a00cd5f080f13e552a", "committedDate": "2020-10-26T04:13:47Z", "message": "fix no permission of preview detector with detector id"}, "afterCommit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb", "author": {"user": {"login": "ylwu-amzn", "name": "Yaliang"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/89c905718f8786d6edf0650b8e6ec8dcaaa270cb", "committedDate": "2020-10-26T06:26:28Z", "message": "fix no permission when preview detector with detector id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTUxNTQ1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294#pullrequestreview-516951545", "createdAt": "2020-10-26T16:22:29Z", "commit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjoyMjoyOVrOHoXmXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjoyMjoyOVrOHoXmXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MTc0MQ==", "bodyText": "Do we always throw RestStatus.INTERNAL_SERVER_ERROR or is there any one specific to FGAC permissions errors? I'm just wondering if the frontend will propagate this correctly as a permissions issue.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294#discussion_r512091741", "createdAt": "2020-10-26T16:22:29Z", "author": {"login": "ohltyler"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/rest/RestExecuteAnomalyDetectorAction.java", "diffHunk": "@@ -168,7 +169,12 @@ private String validateAdExecutionInput(AnomalyDetectorExecutionInput input) {\n     private void preivewAnomalyDetector(NodeClient client, RestChannel channel, AnomalyDetectorExecutionInput input) {\n         if (!StringUtils.isBlank(input.getDetectorId())) {\n             GetRequest getRequest = new GetRequest(AnomalyDetector.ANOMALY_DETECTORS_INDEX).id(input.getDetectorId());\n-            client.get(getRequest, onGetAnomalyDetectorResponse(channel, input));\n+            try (ThreadContext.StoredContext context = client.threadPool().getThreadContext().stashContext()) {\n+                client.get(getRequest, onGetAnomalyDetectorResponse(channel, input));\n+            } catch (Exception e) {\n+                logger.error(\"Fail to get detector for preview\", e);\n+                channel.sendResponse(new BytesRestResponse(RestStatus.INTERNAL_SERVER_ERROR, e.getMessage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTg1NjY2", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294#pullrequestreview-516985666", "createdAt": "2020-10-26T16:55:50Z", "commit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTg5OTEw", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294#pullrequestreview-516989910", "createdAt": "2020-10-26T17:00:21Z", "commit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTk1NDY4", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/294#pullrequestreview-516995468", "createdAt": "2020-10-26T17:06:14Z", "commit": {"oid": "89c905718f8786d6edf0650b8e6ec8dcaaa270cb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1407, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}