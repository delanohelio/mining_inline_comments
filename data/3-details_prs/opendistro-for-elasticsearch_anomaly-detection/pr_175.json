{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MzU2MDk2", "number": 175, "title": "Add dyanmic setting for memory threshold", "bodyText": "Issue #, if available:\n#170\nDescription of changes:\nWe have the following two memory threshold:\n\na detector's model size per node cannot exceed 10% of heap memory\nthe total model size per node cannot exceed 10% of heap memory.\n\nIf users use the ES cluster mainly for anomaly detection, they should be able to increase the memory for AD.  This PR makes the threshold dynamically adjustable via the setting opendistro.anomaly_detection.model_max_size_percent.\nTesting done:\n\nManually verified I can dynamically adjust the memory threshold setting.\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-06-24T17:44:48Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175", "merged": true, "mergeCommit": {"oid": "15f0a25349817e1bec7ccc857afecee8e34a2e59"}, "closed": true, "closedAt": "2020-06-30T00:44:54Z", "author": {"login": "kaituo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcud8CEgFqTQzNjg4MTUzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwKqh0gFqTQzOTU5MjM0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODgxNTM1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#pullrequestreview-436881535", "createdAt": "2020-06-24T17:59:25Z", "commit": {"oid": "dffdf3207668778f21f86916ae9d87247cedf26a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTk4MDc4", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#pullrequestreview-436998078", "createdAt": "2020-06-24T20:52:35Z", "commit": {"oid": "dffdf3207668778f21f86916ae9d87247cedf26a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDo1MjozNVrOGoituA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDo1NTo1MFrOGoi0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NDk4NA==", "bodyText": "minor. why not add maxvalue?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r445164984", "createdAt": "2020-06-24T20:52:35Z", "author": {"login": "wnbts"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/settings/AnomalyDetectorSettings.java", "diffHunk": "@@ -163,7 +163,8 @@ private AnomalyDetectorSettings() {}\n \n     public static final double DESIRED_MODEL_SIZE_PERCENTAGE = 0.0002;\n \n-    public static final double MODEL_MAX_SIZE_PERCENTAGE = 0.1;\n+    public static final Setting<Double> MODEL_MAX_SIZE_PERCENTAGE = Setting\n+        .doubleSetting(\"opendistro.anomaly_detection.model_max_size_percent\", 0.1, 0, Setting.Property.NodeScope, Setting.Property.Dynamic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dffdf3207668778f21f86916ae9d87247cedf26a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NjY0OA==", "bodyText": "why not do this at plugin configuration to reduce unnecessary dependencies only used once?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#discussion_r445166648", "createdAt": "2020-06-24T20:55:50Z", "author": {"login": "wnbts"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/ml/ModelManager.java", "diffHunk": "@@ -197,6 +200,9 @@ public ModelManager(\n         this.forests = new ConcurrentHashMap<>();\n         this.thresholds = new ConcurrentHashMap<>();\n         this.shingleSize = shingleSize;\n+\n+        this.modelMaxSizePercentage = MODEL_MAX_SIZE_PERCENTAGE.get(settings);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dffdf3207668778f21f86916ae9d87247cedf26a"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "337779b3c5e391d76e6da2e280ddf44a0d4313ac", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/337779b3c5e391d76e6da2e280ddf44a0d4313ac", "committedDate": "2020-06-29T17:59:16Z", "message": "Add dyanmic setting for memory threshold\n\nWe have the following two memory threshold:\n* a detector's model size per node cannot exceed 10% of heap memory\n* the total model size per node cannot exceed 10% of heap memory.\nIf users use the ES cluster mainly for anomaly detection, they should be able to increase the memory for AD.This PR makes the threshold dynamically adjustable via the setting opendistro.anomaly_detection.model_max_size_percent.\n\nTesting done:\n* Manually verified I can dynamically adjust the memory threshold setting. \u00a0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02ca222bea716c4745f6da14408a8bc03c9815a", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/b02ca222bea716c4745f6da14408a8bc03c9815a", "committedDate": "2020-06-29T17:59:16Z", "message": "Move modelMaxSizePercentage's value source to plugin configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bc3b8894b8e839532b73abdc074052d925fbdc3", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/1bc3b8894b8e839532b73abdc074052d925fbdc3", "committedDate": "2020-06-29T17:55:22Z", "message": "Move modelMaxSizePercentage's value source to plugin configuration"}, "afterCommit": {"oid": "b02ca222bea716c4745f6da14408a8bc03c9815a", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/b02ca222bea716c4745f6da14408a8bc03c9815a", "committedDate": "2020-06-29T17:59:16Z", "message": "Move modelMaxSizePercentage's value source to plugin configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTkyMzQw", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/175#pullrequestreview-439592340", "createdAt": "2020-06-30T00:39:57Z", "commit": {"oid": "b02ca222bea716c4745f6da14408a8bc03c9815a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1489, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}