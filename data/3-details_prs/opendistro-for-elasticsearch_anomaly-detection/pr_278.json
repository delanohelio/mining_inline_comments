{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Mjk2MjQ4", "number": 278, "title": "Upgrade mapping", "bodyText": "Issue #, if available:\nDescription of changes:\nThis PR updates the current AD index mapping if a new version is detected.  Previously, we didn't do so.  This will cause issues when upgrading AD binary version: newly added fields will not be searchable, though we can still send get requests to fetch them.\nThis PR also makes the cache miss handling setting a dynamic setting.\nTesting done:\n\nmanual upgrade testing passes with fgac on and off.\nwill add unit tests later.\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-19T21:43:03Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278", "merged": true, "mergeCommit": {"oid": "8def1ba1f68d73680bc543cfc1d3f3eea21c65f5"}, "closed": true, "closedAt": "2020-10-20T05:52:12Z", "author": {"login": "kaituo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdULt82AFqTUxMjE5NzkyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUSOxmgFqTUxMjM0OTUxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTk3OTI3", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#pullrequestreview-512197927", "createdAt": "2020-10-19T22:14:51Z", "commit": {"oid": "c501a64dddcd56892be8b42a5ec85d0b5dfaeeb4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxNDo1MlrOHkjlUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxNDo1MlrOHkjlUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzc3Nw==", "bodyText": "Will this fail with FGAC ?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#discussion_r508093777", "createdAt": "2020-10-19T22:14:52Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/rest/RestIndexAnomalyDetectorAction.java", "diffHunk": "@@ -124,6 +126,7 @@ protected RestChannelConsumer prepareRequest(RestRequest request, NodeClient cli\n             ? WriteRequest.RefreshPolicy.parse(request.param(REFRESH))\n             : WriteRequest.RefreshPolicy.IMMEDIATE;\n         RestRequest.Method method = request.getHttpRequest().method();\n+        anomalyDetectionIndices.updateMappingIfNecessary();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c501a64dddcd56892be8b42a5ec85d0b5dfaeeb4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b7e51339d1f3477146ea16fd84fe3c6d4481e3c", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/8b7e51339d1f3477146ea16fd84fe3c6d4481e3c", "committedDate": "2020-10-20T05:03:43Z", "message": "Upgrade mapping\n\nThis PR updates the current AD index mapping if a new version is detected. \u00a0Previously, we didn't do so. \u00a0This will cause issues when upgrading AD binary version: newly added fields will not be searchable, though we can still send get requests to fetch them.\n\nTesting done:\n1. manual upgrade testing passes.\n2. will add unit tests later."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "committedDate": "2020-10-20T05:35:02Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c501a64dddcd56892be8b42a5ec85d0b5dfaeeb4", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c501a64dddcd56892be8b42a5ec85d0b5dfaeeb4", "committedDate": "2020-10-19T21:30:03Z", "message": "Upgrade mapping\n\nThis PR updates the current AD index mapping if a new version is detected. \u00a0Previously, we didn't do so. \u00a0This will cause issues when upgrading AD binary version: newly added fields will not be searchable, though we can still send get requests to fetch them.\n\nTesting done:\n1. manual upgrade testing passes.\n2. will add unit tests later."}, "afterCommit": {"oid": "c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/c599d377cb9f9ccf6efe5ffc7964b1729d9063a0", "committedDate": "2020-10-20T05:35:02Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzQ2Mzgw", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#pullrequestreview-512346380", "createdAt": "2020-10-20T05:42:29Z", "commit": {"oid": "c599d377cb9f9ccf6efe5ffc7964b1729d9063a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2d1ebbfac76dd1a30b9ad309f62f22a60b63a24", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/f2d1ebbfac76dd1a30b9ad309f62f22a60b63a24", "committedDate": "2020-10-20T05:43:31Z", "message": "fix spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMzQ5NTE0", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/278#pullrequestreview-512349514", "createdAt": "2020-10-20T05:50:09Z", "commit": {"oid": "f2d1ebbfac76dd1a30b9ad309f62f22a60b63a24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1390, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}