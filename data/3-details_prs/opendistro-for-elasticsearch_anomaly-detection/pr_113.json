{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MzYzMDIz", "number": 113, "title": "Add shingle size, total model size, and model's hash ring to profile API", "bodyText": "Issue #, if available:\n#111\nDescription of changes:\nHash ring helps identify node X runs the AD job for a detector Y with models on node 1,2,3. \u00a0This helps oncalls locate logs. Total model size gives transparency relating to the current memory usage. What's more, shingle size help answer question \"why my detector does not report anything?\"\nThis PR adds the above info to profile API via a broadcast call that consults ModelManager and FeatureManager about current state pertaining to a detector. \u00a0Then these states are consolidated into information humans can parse.\nThis PR also queries all AD result indices instead of only current result index so that we can fetch a stopped detector's error after the result index with the error is rotated.\nTesting done:\n\nadd unit tests for the newly added code\nRun end-to-end testing to verify new profiles make senses when a detector stops running and is running\n\nExample:\n% curl -X GET \"localhost:9200/_opendistro/_anomaly_detection/detectors/cneh7HEBHPICjJIdXdrR/_profile?_all=true&pretty\"\n{\n  \"state\" : \"RUNNING\",\n  \"models\" : [\n    {\n      \"model_id\" : \"cneh7HEBHPICjJIdXdrR_model_rcf_2\",\n      \"model_size_in_bytes\" : 4456448,\n      \"node_id\" : \"VS29z70PSzOdHiEw4SoV9Q\"\n    },\n    {\n      \"model_id\" : \"cneh7HEBHPICjJIdXdrR_model_rcf_1\",\n      \"model_size_in_bytes\" : 4456448,\n      \"node_id\" : \"VS29z70PSzOdHiEw4SoV9Q\"\n    },\n    {\n      \"model_id\" : \"cneh7HEBHPICjJIdXdrR_model_threshold\",\n      \"node_id\" : \"Og23iUroTdKrkwS-y89zLw\"\n    },\n    {\n      \"model_id\" : \"cneh7HEBHPICjJIdXdrR_model_rcf_0\",\n      \"model_size_in_bytes\" : 4456448,\n      \"node_id\" : \"Og23iUroTdKrkwS-y89zLw\"\n    }\n  ],\n  \"shingle_size\" : 8,\n  \"coordinating_node\" : \"Og23iUroTdKrkwS-y89zLw\",\n  \"total_size_in_bytes\" : 13369344\n}\n\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-06T22:19:26Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113", "merged": true, "mergeCommit": {"oid": "e06cf6f11e86da9f1679057080184257d384fed4"}, "closed": true, "closedAt": "2020-05-07T03:01:07Z", "author": {"login": "kaituo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcew8f4AFqTQwNzA0NjE1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABce0UCzABqjMzMTEwMjI1NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDQ2MTUz", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407046153", "createdAt": "2020-05-06T23:05:20Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzowNToyMFrOGRogBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzowNToyMFrOGRogBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0MjUzMw==", "bodyText": "cool. I guess this can fix this issue as well: #111", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421142533", "createdAt": "2020-05-06T23:05:20Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorProfileRunner.java", "diffHunk": "@@ -280,8 +312,42 @@ private SearchRequest createLatestAnomalyResultRequest(String detectorId, long e\n \n         SearchSourceBuilder source = new SearchSourceBuilder().query(filterQuery).size(1).sort(sortQuery);\n \n-        SearchRequest request = new SearchRequest(AnomalyResult.ANOMALY_RESULT_INDEX);\n+        SearchRequest request = new SearchRequest(AnomalyDetectionIndices.ALL_AD_RESULTS_INDEX_PATTERN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDMxMzU1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407031355", "createdAt": "2020-05-06T22:29:17Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjoyOToxN1rOGRnsYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjo1OTo1NVrOGRoYng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyOTMxNQ==", "bodyText": "Nit: Add a comment describing what this means for those not familiar with MultiResponseDelegateActionListener", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421129315", "createdAt": "2020-05-06T22:29:17Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorProfileRunner.java", "diffHunk": "@@ -70,9 +78,26 @@ public void profile(String detectorId, ActionListener<DetectorProfile> listener,\n             return;\n         }\n \n+        int totalListener = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzNDA1Nw==", "bodyText": "Nit: Typo", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421134057", "createdAt": "2020-05-06T22:42:18Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/ModelProfile.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.amazon.opendistroforelasticsearch.ad.model;\n+\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+import java.io.IOException;\n+\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.io.stream.Writeable;\n+import org.elasticsearch.common.xcontent.ToXContent;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+public class ModelProfile implements Writeable, ToXContent {\n+    // filed name in toXContent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzNDg1NA==", "bodyText": "Why hardcode these strings?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421134854", "createdAt": "2020-05-06T22:44:23Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/model/ProfileName.java", "diffHunk": "@@ -38,26 +42,20 @@ public String getName() {\n         return name;\n     }\n \n-    /**\n-     * Get set of profile names\n-     *\n-     * @return set of profile names\n-     */\n-    public static Set<String> getNames() {\n-        Set<String> names = new HashSet<>();\n-\n-        for (ProfileName statName : ProfileName.values()) {\n-            names.add(statName.getName());\n-        }\n-        return names;\n-    }\n-\n     public static ProfileName getName(String name) {\n         switch (name) {\n             case \"state\":\n                 return STATE;\n             case \"error\":\n                 return ERROR;\n+            case \"coordinating_node\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzNTkwOQ==", "bodyText": "Use _all instead of all?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421135909", "createdAt": "2020-05-06T22:47:09Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/rest/RestGetAnomalyDetectorAction.java", "diffHunk": "@@ -111,13 +115,14 @@ protected RestChannelConsumer prepareRequest(RestRequest request, NodeClient cli\n             throw new IllegalStateException(CommonErrorMessages.DISABLED_ERR_MSG);\n         }\n         String detectorId = request.param(DETECTOR_ID);\n-        boolean returnJob = request.paramAsBoolean(\"job\", false);\n         String typesStr = request.param(TYPE);\n         String rawPath = request.rawPath();\n         if (!Strings.isEmpty(typesStr) || rawPath.endsWith(PROFILE) || rawPath.endsWith(PROFILE + \"/\")) {\n+            boolean all = request.paramAsBoolean(\"all\", false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzODM3Mg==", "bodyText": "These strings are already defined aren't they?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421138372", "createdAt": "2020-05-06T22:53:51Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/transport/ProfileResponse.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import org.elasticsearch.action.FailedNodeException;\n+import org.elasticsearch.action.support.nodes.BaseNodesResponse;\n+import org.elasticsearch.cluster.ClusterName;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentFragment;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import com.amazon.opendistroforelasticsearch.ad.model.ModelProfile;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This class consists of the aggregated responses from the nodes\n+ */\n+public class ProfileResponse extends BaseNodesResponse<ProfileNodeResponse> implements ToXContentFragment {\n+    // filed name in toXContent\n+    static final String COORDINATING_NODE = \"coordinating_node\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0MDYzOA==", "bodyText": "What is significant about first entry as opposed to others?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421140638", "createdAt": "2020-05-06T22:59:55Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/transport/ProfileResponse.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import org.elasticsearch.action.FailedNodeException;\n+import org.elasticsearch.action.support.nodes.BaseNodesResponse;\n+import org.elasticsearch.cluster.ClusterName;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentFragment;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import com.amazon.opendistroforelasticsearch.ad.model.ModelProfile;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This class consists of the aggregated responses from the nodes\n+ */\n+public class ProfileResponse extends BaseNodesResponse<ProfileNodeResponse> implements ToXContentFragment {\n+    // filed name in toXContent\n+    static final String COORDINATING_NODE = \"coordinating_node\";\n+    static final String SHINGLE_SIZE = \"shingle_size\";\n+    static final String TOTAL_SIZE = \"total_size\";\n+    static final String MODELS = \"models\";\n+\n+    private ModelProfile[] modelProfile;\n+    private int shingleSize;\n+    private String coordinatingNode;\n+    private long totalSizeInBytes;\n+\n+    /**\n+     * Constructor\n+     *\n+     * @param in StreamInput\n+     * @throws IOException thrown when unable to read from stream\n+     */\n+    public ProfileResponse(StreamInput in) throws IOException {\n+        super(in);\n+        int size = in.readVInt();\n+        modelProfile = new ModelProfile[size];\n+        for (int i = 0; i < size; i++) {\n+            modelProfile[i] = new ModelProfile(in);\n+        }\n+        shingleSize = in.readVInt();\n+        coordinatingNode = in.readString();\n+        totalSizeInBytes = in.readVLong();\n+    }\n+\n+    /**\n+     * Constructor\n+     *\n+     * @param clusterName name of cluster\n+     * @param nodes List of ProfileNodeResponse from nodes\n+     * @param failures List of failures from nodes\n+     */\n+    public ProfileResponse(ClusterName clusterName, List<ProfileNodeResponse> nodes, List<FailedNodeException> failures) {\n+        super(clusterName, nodes, failures);\n+        totalSizeInBytes = 0L;\n+        List<ModelProfile> modelProfileList = new ArrayList<>();\n+        for (ProfileNodeResponse response : nodes) {\n+            String curNodeId = response.getNode().getId();\n+            if (response.getShingleSize() >= 0) {\n+                coordinatingNode = curNodeId;\n+                shingleSize = response.getShingleSize();\n+            }\n+            for (Map.Entry<String, Long> entry : response.getModelSize().entrySet()) {\n+                totalSizeInBytes += entry.getValue();\n+                modelProfileList.add(new ModelProfile(entry.getKey(), entry.getValue(), curNodeId));\n+            }\n+\n+        }\n+        if (coordinatingNode == null) {\n+            coordinatingNode = \"\";\n+        }\n+        this.modelProfile = modelProfileList.toArray(new ModelProfile[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDUyNjEw", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407052610", "createdAt": "2020-05-06T23:22:29Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoyMjozMFrOGRo2wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoyMjozMFrOGRo2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0ODM1Mg==", "bodyText": "is it used?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421148352", "createdAt": "2020-05-06T23:22:30Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/transport/ProfileRequest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import org.elasticsearch.action.support.nodes.BaseNodesRequest;\n+import org.elasticsearch.cluster.node.DiscoveryNode;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+\n+import com.amazon.opendistroforelasticsearch.ad.model.ProfileName;\n+\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * implements a request to obtain profiles about an AD detector\n+ */\n+public class ProfileRequest extends BaseNodesRequest<ProfileRequest> {\n+\n+    /**\n+     * Key indicating all profiles should be retrieved\n+     */\n+    public static final String ALL_PROFILE_KEY = \"_all\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDU0NDMy", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407054432", "createdAt": "2020-05-06T23:27:26Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoyNzoyNlrOGRo9LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoyNzoyNlrOGRo9LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0OTk5Nw==", "bodyText": "use ProfileName enum to replace these?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421149997", "createdAt": "2020-05-06T23:27:26Z", "author": {"login": "yizheliu-amazon"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/transport/ProfileResponse.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.ad.transport;\n+\n+import org.elasticsearch.action.FailedNodeException;\n+import org.elasticsearch.action.support.nodes.BaseNodesResponse;\n+import org.elasticsearch.cluster.ClusterName;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentFragment;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import com.amazon.opendistroforelasticsearch.ad.model.ModelProfile;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This class consists of the aggregated responses from the nodes\n+ */\n+public class ProfileResponse extends BaseNodesResponse<ProfileNodeResponse> implements ToXContentFragment {\n+    // filed name in toXContent\n+    static final String COORDINATING_NODE = \"coordinating_node\";\n+    static final String SHINGLE_SIZE = \"shingle_size\";\n+    static final String TOTAL_SIZE = \"total_size\";\n+    static final String MODELS = \"models\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDU2MjIz", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407056223", "createdAt": "2020-05-06T23:32:29Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzozMjoyOVrOGRpDYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzozMjoyOVrOGRpDYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1MTU4NA==", "bodyText": "why removing this?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421151584", "createdAt": "2020-05-06T23:32:29Z", "author": {"login": "yizheliu-amazon"}, "path": "src/test/java/test/com/amazon/opendistroforelasticsearch/ad/util/JsonDeserializer.java", "diffHunk": "@@ -333,11 +333,11 @@ public static String getTextValue(String jsonString, String paths, boolean retur\n     }\n \n     /**\n-     * Search an int number inside a JSON string matching the input path expression\n+     * Search an array inside a JSON string matching the input path expression\n      *\n      * @param jsonString an encoded JSON string\n+     * @param function function to parse each element\n      * @param paths      path fragments\n-     * @return list of double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDU2OTk5", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407056999", "createdAt": "2020-05-06T23:34:48Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzozNDo0OFrOGRpGEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzozNDo0OFrOGRpGEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1MjI3Mw==", "bodyText": "Is there test case against customized profiles?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#discussion_r421152273", "createdAt": "2020-05-06T23:34:48Z", "author": {"login": "yizheliu-amazon"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/ad/rest/AnomalyDetectorRestApiIT.java", "diffHunk": "@@ -898,4 +898,11 @@ public void testProfileAnomalyDetector() throws Exception {\n         Response profileResponse = getDetectorProfile(detector.getDetectorId());\n         assertEquals(\"Incorrect profile status\", RestStatus.OK, restStatus(profileResponse));\n     }\n+\n+    public void testAllProfileAnomalyDetector() throws Exception {\n+        AnomalyDetector detector = createRandomAnomalyDetector(true, true);\n+\n+        Response profileResponse = getDetectorProfile(detector.getDetectorId(), true);\n+        assertEquals(\"Incorrect profile status\", RestStatus.OK, restStatus(profileResponse));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDY5NzY1", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407069765", "createdAt": "2020-05-07T00:12:30Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDg5NzUx", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/113#pullrequestreview-407089751", "createdAt": "2020-05-07T01:18:45Z", "commit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab19f982f780f6da8034d3ec98e3062b4b61092", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/cab19f982f780f6da8034d3ec98e3062b4b61092", "committedDate": "2020-05-07T03:00:33Z", "message": "Add shingle size, total model size, and model's hash ring to profile API\n\nHash ring helps identify node X runs the AD job for a detector Y with models on node 1,2,3. \u00a0This helps oncalls locate logs. Total model size gives transparency relating to the current memory usage. What's more, shingle size help answer question \"why my detector does not report anything?\"\n\nThis PR adds the above info to profile API via a broadcast call that consults ModelManager and FeatureManager about current state pertaining to a detector. \u00a0Then these states are consolidated into information humans can parse.\n\nThis PR also queries all AD result indices instead of only current result index so that we can fetch a stopped detector's error after the result index with the error is rotated.\n\nTesting done:\n1. add unit tests for the newly added code\n2. Run end-to-end testing to verify new profiles make senses when a detector stops running and is running"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "198676b576a5b79f6f0f59e00d726af315a4cc8c", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/198676b576a5b79f6f0f59e00d726af315a4cc8c", "committedDate": "2020-05-06T22:00:41Z", "message": "Add shingle size, total model size, and model's hash ring to profile API\n\nHash ring helps identify node X runs the AD job for a detector Y with models on node 1,2,3. \u00a0This helps oncalls locate logs. Total model size gives transparency relating to the current memory usage. What's more, shingle size help answer question \"why my detector does not report anything?\"\n\nThis PR adds the above info to profile API via a broadcast call that consults ModelManager and FeatureManager about current state pertaining to a detector. \u00a0Then these states are consolidated into information humans can parse.\n\nThis PR also queries all AD result indices instead of only current result index so that we can fetch a stopped detector's error after the result index with the error is rotated.\n\nTesting done:\n1. add unit tests for the newly added code\n2. Run end-to-end testing to verify new profiles make senses when a detector stops running and is running"}, "afterCommit": {"oid": "cab19f982f780f6da8034d3ec98e3062b4b61092", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/cab19f982f780f6da8034d3ec98e3062b4b61092", "committedDate": "2020-05-07T03:00:33Z", "message": "Add shingle size, total model size, and model's hash ring to profile API\n\nHash ring helps identify node X runs the AD job for a detector Y with models on node 1,2,3. \u00a0This helps oncalls locate logs. Total model size gives transparency relating to the current memory usage. What's more, shingle size help answer question \"why my detector does not report anything?\"\n\nThis PR adds the above info to profile API via a broadcast call that consults ModelManager and FeatureManager about current state pertaining to a detector. \u00a0Then these states are consolidated into information humans can parse.\n\nThis PR also queries all AD result indices instead of only current result index so that we can fetch a stopped detector's error after the result index with the error is rotated.\n\nTesting done:\n1. add unit tests for the newly added code\n2. Run end-to-end testing to verify new profiles make senses when a detector stops running and is running"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1680, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}