{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MDg0OTU0", "number": 309, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1MTozOFrOE2_DUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1NzowMFrOE2_Jvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MDkxNjAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1MTozOFrOHwEyAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMzoxMTozNlrOHwFR4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3MjAzNA==", "bodyText": "If remove this line, will not update index mapping if any exception happens?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/309#discussion_r520172034", "createdAt": "2020-11-09T22:51:38Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "diffHunk": "@@ -578,7 +578,11 @@ public void updateMappingIfNecessary() {\n         }\n \n         final GroupedActionListener<Void> conglomerateListeneer = new GroupedActionListener<>(\n-            ActionListener.wrap(r -> updateRunning.set(false), exception -> logger.error(\"Fail to updatea all mappings\")),\n+            ActionListener.wrap(r -> updateRunning.set(false), exception -> {\n+                // TODO: don't retry endlessly. Can be annoying if there are too many exception logs.\n+                updateRunning.set(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a42ee95f27de230fbe360fa4ab394b865fc13cb6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4MDE5Mg==", "bodyText": "if removing this line, we will only try to update mapping once per node.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/309#discussion_r520180192", "createdAt": "2020-11-09T23:11:36Z", "author": {"login": "kaituo"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "diffHunk": "@@ -578,7 +578,11 @@ public void updateMappingIfNecessary() {\n         }\n \n         final GroupedActionListener<Void> conglomerateListeneer = new GroupedActionListener<>(\n-            ActionListener.wrap(r -> updateRunning.set(false), exception -> logger.error(\"Fail to updatea all mappings\")),\n+            ActionListener.wrap(r -> updateRunning.set(false), exception -> {\n+                // TODO: don't retry endlessly. Can be annoying if there are too many exception logs.\n+                updateRunning.set(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3MjAzNA=="}, "originalCommit": {"oid": "a42ee95f27de230fbe360fa4ab394b865fc13cb6"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MDkzMjQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMjo1NzowMFrOHwE7bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMzoxMToxN1rOHwFRWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3NDQ0NQ==", "bodyText": "Add ad to the error message.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/309#discussion_r520174445", "createdAt": "2020-11-09T22:57:00Z", "author": {"login": "ylwu-amzn"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "diffHunk": "@@ -578,7 +578,11 @@ public void updateMappingIfNecessary() {\n         }\n \n         final GroupedActionListener<Void> conglomerateListeneer = new GroupedActionListener<>(\n-            ActionListener.wrap(r -> updateRunning.set(false), exception -> logger.error(\"Fail to updatea all mappings\")),\n+            ActionListener.wrap(r -> updateRunning.set(false), exception -> {\n+                // TODO: don't retry endlessly. Can be annoying if there are too many exception logs.\n+                updateRunning.set(false);\n+                logger.error(\"Fail to updatea all mappings\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a42ee95f27de230fbe360fa4ab394b865fc13cb6"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4MDA1OA==", "bodyText": "added", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/309#discussion_r520180058", "createdAt": "2020-11-09T23:11:17Z", "author": {"login": "kaituo"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/indices/AnomalyDetectionIndices.java", "diffHunk": "@@ -578,7 +578,11 @@ public void updateMappingIfNecessary() {\n         }\n \n         final GroupedActionListener<Void> conglomerateListeneer = new GroupedActionListener<>(\n-            ActionListener.wrap(r -> updateRunning.set(false), exception -> logger.error(\"Fail to updatea all mappings\")),\n+            ActionListener.wrap(r -> updateRunning.set(false), exception -> {\n+                // TODO: don't retry endlessly. Can be annoying if there are too many exception logs.\n+                updateRunning.set(false);\n+                logger.error(\"Fail to updatea all mappings\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE3NDQ0NQ=="}, "originalCommit": {"oid": "a42ee95f27de230fbe360fa4ab394b865fc13cb6"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2813, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}