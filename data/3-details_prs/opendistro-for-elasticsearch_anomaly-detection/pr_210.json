{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2ODkxODI2", "number": 210, "title": "not return estimated minutes remaining until cold start is finished", "bodyText": "Issue #, if available:\n#198\nDescription of changes:\nCurrently, the progress bar on AD Kibana will show the estimated time remaining to initialize a detector. This can be confusing if this message is displayed before cold start is finished, where the actual initialization time may be much shorter if sufficient historical data exists. This PR changes the profile api to not return any estimated time left until the cold start is finished to prevent this.\nTesting done:\n\nManually verified the problem is fixed.\nadded unit test for the issue.\n\nBefore the PR:\nkaituo@dev-dsk-kaituo-2a-74e3f324.us-west-2: ~\n% curl -XGET \"http://localhost:9200/_opendistro/_anomaly_detection/detectors/F5nQ4HMBALosA6jhE7Ni/_profile?_all=true&pretty\"\n{\n\"state\" : \"INIT\",\n\"shingle_size\" : 0,\n\"coordinating_node\" : \"\",\n\"total_size_in_bytes\" : 0,\n\"init_progress\" : {\n\"percentage\" : \"0%\",\n\"estimated_minutes_left\" : 128,\n\"needed_shingles\" : 128\n}\n}\nAfter the PR:\nkaituo@dev-dsk-kaituo-2a-74e3f324.us-west-2: ~\n% curl -XGET \"http://localhost:9200/_opendistro/_anomaly_detection/detectors/FO7a4HMBTu_4lKyQCdgs/_profile?_all=true&pretty\"\n{\n\"state\" : \"INIT\",\n\"shingle_size\" : 0,\n\"coordinating_node\" : \"\",\n\"total_size_in_bytes\" : 0,\n\"init_progress\" : {\n\"percentage\" : \"0%\",\n\"needed_shingles\" : 128\n}\n}\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-08-12T16:52:21Z", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210", "merged": true, "mergeCommit": {"oid": "fed3b78c40545d341caecc9e53a28da5b4268524"}, "closed": true, "closedAt": "2020-08-18T16:41:50Z", "author": {"login": "kaituo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-Dvd-gH2gAyNDY2ODkxODI2Ojc4YWJmOTVlYzJjYjk1YjgyNDY5MjU1Y2FjOTVmYzMzMTg4YmNhNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_3cyaAH2gAyNDY2ODkxODI2Ojg0ZjdjZDE3ZDI3ZTM5MTQxZDdiN2UyMGY5YWZjYzgzZTU2ZTViNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78abf95ec2cb95b82469255cac95fc33188bca67", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/78abf95ec2cb95b82469255cac95fc33188bca67", "committedDate": "2020-08-12T04:30:57Z", "message": "Change profile API to not return estimated minutes remaining until cold start is finished\n\nCurrently, the progress bar on AD Kibana will show the estimated time remaining to initialize a detector. This can be confusing if this message is displayed before cold start is finished, where the actual initialization time may be much shorter if sufficient historical data exists. This PR changes the profile api to not return any estimated time left until the cold start is finished to prevent this.\n\nTesting done:\n1. Manually verified the problem is fixed.\n2. added unit test for the issue."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzQxMTEy", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#pullrequestreview-466341112", "createdAt": "2020-08-12T23:23:13Z", "commit": {"oid": "78abf95ec2cb95b82469255cac95fc33188bca67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzoyMzoxM1rOG_2KDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzoyMzoxM1rOG_2KDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwMDc4MA==", "bodyText": "this should be hide estimate, which affects minutes left and data points needed.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#discussion_r469600780", "createdAt": "2020-08-12T23:23:13Z", "author": {"login": "wnbts"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorProfileRunner.java", "diffHunk": "@@ -391,19 +399,26 @@ private void processInitResponse(\n         String detectorId,\n         Set<ProfileName> profilesToCollect,\n         MultiResponsesDelegateActionListener<DetectorProfile> listener,\n-        long totalUpdates\n+        long totalUpdates,\n+        boolean hideMinutesLeft", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78abf95ec2cb95b82469255cac95fc33188bca67"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDMxMDIx", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#pullrequestreview-467031021", "createdAt": "2020-08-13T18:35:19Z", "commit": {"oid": "78abf95ec2cb95b82469255cac95fc33188bca67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODozNToxOVrOHAYkmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODozNToxOVrOHAYkmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE2NDYzMw==", "bodyText": "any chance the passed in requiredSamples is null/0?", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#discussion_r470164633", "createdAt": "2020-08-13T18:35:19Z", "author": {"login": "ohltyler"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorProfileRunner.java", "diffHunk": "@@ -308,6 +301,17 @@ private void profileStateRelated(\n         }, exception -> { listener.failImmediately(FAIL_TO_FIND_DETECTOR_MSG + detectorId, exception); });\n     }\n \n+    private InitProgressProfile computeInitProgressProfile(long totalUpdates, long intervalMins) {\n+        float percent = (100.0f * totalUpdates) / requiredSamples;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78abf95ec2cb95b82469255cac95fc33188bca67"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db10243041fb930a77840e57416647caacab8e37", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/db10243041fb930a77840e57416647caacab8e37", "committedDate": "2020-08-13T19:56:11Z", "message": "throw exception if passed in requiredSamples is <= 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTQwODgz", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#pullrequestreview-467140883", "createdAt": "2020-08-13T21:24:01Z", "commit": {"oid": "db10243041fb930a77840e57416647caacab8e37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTg3Njkz", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#pullrequestreview-467187693", "createdAt": "2020-08-13T23:05:27Z", "commit": {"oid": "db10243041fb930a77840e57416647caacab8e37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowNToyN1rOHAgl6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowNToyN1rOHAgl6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI5NjA0MQ==", "bodyText": "testing. the testing of this condition is missing.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#discussion_r470296041", "createdAt": "2020-08-13T23:05:27Z", "author": {"login": "wnbts"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/ad/AnomalyDetectorProfileRunner.java", "diffHunk": "@@ -76,6 +76,9 @@ public AnomalyDetectorProfileRunner(\n         this.client = client;\n         this.xContentRegistry = xContentRegistry;\n         this.nodeFilter = nodeFilter;\n+        if (requiredSamples <= 0) {\n+            throw new IllegalArgumentException(\"required samples should be a positive number, but was \" + requiredSamples);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db10243041fb930a77840e57416647caacab8e37"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NzYzOTgw", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/210#pullrequestreview-467763980", "createdAt": "2020-08-14T17:54:58Z", "commit": {"oid": "db10243041fb930a77840e57416647caacab8e37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f7cd17d27e39141d7b7e20f9afcc83e56e5b70", "author": {"user": {"login": "kaituo", "name": "Kaituo Li"}}, "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/commit/84f7cd17d27e39141d7b7e20f9afcc83e56e5b70", "committedDate": "2020-08-17T19:19:32Z", "message": "Added test case for invalid required samples"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1521, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}