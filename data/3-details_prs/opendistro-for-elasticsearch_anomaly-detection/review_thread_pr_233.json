{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2OTE4OTU0", "number": 233, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToxMzo1OVrOEqkXnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToyNToyNFrOEqkfCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDcxNTE5OnYy", "diffSide": "RIGHT", "path": "cli/cmd/update.go", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToxMzo1OVrOHc2Lhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMjozODoyMFrOHdcWgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwOTg2Mw==", "bodyText": "User can only \"restart\" a running detector? If current detector hasn't been started, is it possible user only set \"restart\" as true to start it after update ?\nFrom the description \"Will start detector if update is successful\", it's better to name the flag as \"start\".", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500009863", "createdAt": "2020-10-06T05:13:59Z", "author": {"login": "ylwu-amzn"}, "path": "cli/cmd/update.go", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package cmd\n+\n+import (\n+\thandler \"esad/internal/handler/ad\"\n+\t\"fmt\"\n+\n+\t\"github.com/spf13/cobra\"\n+)\n+\n+const (\n+\tcommandUpdate = \"update\"\n+\tflagForce     = \"force\"\n+\tflagRestart   = \"restart\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNTI2NA==", "bodyText": "Ack", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500635264", "createdAt": "2020-10-06T22:38:20Z", "author": {"login": "VijayanB"}, "path": "cli/cmd/update.go", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package cmd\n+\n+import (\n+\thandler \"esad/internal/handler/ad\"\n+\t\"fmt\"\n+\n+\t\"github.com/spf13/cobra\"\n+)\n+\n+const (\n+\tcommandUpdate = \"update\"\n+\tflagForce     = \"force\"\n+\tflagRestart   = \"restart\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwOTg2Mw=="}, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDcyNjgwOnYy", "diffSide": "RIGHT", "path": "cli/internal/controller/ad/ad.go", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToyMDo1NlrOHc2SaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMjozMTo0OVrOHdcNRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMTYyNQ==", "bodyText": "If \"force\" is false, no need to stop detector.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500011625", "createdAt": "2020-10-06T05:20:56Z", "author": {"login": "ylwu-amzn"}, "path": "cli/internal/controller/ad/ad.go", "diffHunk": "@@ -520,3 +521,48 @@ func (c controller) GetDetectorsByName(ctx context.Context, pattern string, disp\n \t}\n \treturn output, nil\n }\n+\n+//UpdateDetector updates detector based on DetectorID, if force is enabled, it overrides without checking whether\n+// user downloaded latest version before updating it, if restart is true, detector will be started after update\n+func (c controller) UpdateDetector(ctx context.Context, input entity.UpdateDetectorUserInput, force bool, restart bool) error {\n+\tif len(input.ID) < 1 {\n+\t\treturn fmt.Errorf(\"detector Id cannot be empty\")\n+\t}\n+\tif !force {\n+\t\tlatestDetector, err := c.GetDetector(ctx, input.ID)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif latestDetector.LastUpdatedAt > input.LastUpdatedAt {\n+\t\t\treturn fmt.Errorf(\n+\t\t\t\t\"new version for detector is available. Please fetch latest version and then merge your changes\")\n+\t\t}\n+\t}\n+\tproceed := c.askForConfirmation(\n+\t\tcmapper.StringToStringPtr(\n+\t\t\tfmt.Sprintf(\n+\t\t\t\t\"esad will update detector: %s . Do you want to proceed? please type (y)es or (n)o and then press enter:\",\n+\t\t\t\tinput.ID,\n+\t\t\t),\n+\t\t),\n+\t)\n+\tif !proceed {\n+\t\treturn nil\n+\t}\n+\terr := c.StopDetector(ctx, input.ID)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMjkwMA==", "bodyText": "Ack", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500632900", "createdAt": "2020-10-06T22:31:49Z", "author": {"login": "VijayanB"}, "path": "cli/internal/controller/ad/ad.go", "diffHunk": "@@ -520,3 +521,48 @@ func (c controller) GetDetectorsByName(ctx context.Context, pattern string, disp\n \t}\n \treturn output, nil\n }\n+\n+//UpdateDetector updates detector based on DetectorID, if force is enabled, it overrides without checking whether\n+// user downloaded latest version before updating it, if restart is true, detector will be started after update\n+func (c controller) UpdateDetector(ctx context.Context, input entity.UpdateDetectorUserInput, force bool, restart bool) error {\n+\tif len(input.ID) < 1 {\n+\t\treturn fmt.Errorf(\"detector Id cannot be empty\")\n+\t}\n+\tif !force {\n+\t\tlatestDetector, err := c.GetDetector(ctx, input.ID)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif latestDetector.LastUpdatedAt > input.LastUpdatedAt {\n+\t\t\treturn fmt.Errorf(\n+\t\t\t\t\"new version for detector is available. Please fetch latest version and then merge your changes\")\n+\t\t}\n+\t}\n+\tproceed := c.askForConfirmation(\n+\t\tcmapper.StringToStringPtr(\n+\t\t\tfmt.Sprintf(\n+\t\t\t\t\"esad will update detector: %s . Do you want to proceed? please type (y)es or (n)o and then press enter:\",\n+\t\t\t\tinput.ID,\n+\t\t\t),\n+\t\t),\n+\t)\n+\tif !proceed {\n+\t\treturn nil\n+\t}\n+\terr := c.StopDetector(ctx, input.ID)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMTYyNQ=="}, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDczNDE2OnYy", "diffSide": "RIGHT", "path": "cli/internal/controller/ad/ad.go", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNToyNToyNFrOHc2W7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMjozNzozMFrOHdcVUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMjc4MQ==", "bodyText": "Check if detector is running? If detector is running and force is false, we should fail immediately.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500012781", "createdAt": "2020-10-06T05:25:24Z", "author": {"login": "ylwu-amzn"}, "path": "cli/internal/controller/ad/ad.go", "diffHunk": "@@ -520,3 +521,48 @@ func (c controller) GetDetectorsByName(ctx context.Context, pattern string, disp\n \t}\n \treturn output, nil\n }\n+\n+//UpdateDetector updates detector based on DetectorID, if force is enabled, it overrides without checking whether\n+// user downloaded latest version before updating it, if restart is true, detector will be started after update\n+func (c controller) UpdateDetector(ctx context.Context, input entity.UpdateDetectorUserInput, force bool, restart bool) error {\n+\tif len(input.ID) < 1 {\n+\t\treturn fmt.Errorf(\"detector Id cannot be empty\")\n+\t}\n+\tif !force {\n+\t\tlatestDetector, err := c.GetDetector(ctx, input.ID)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif latestDetector.LastUpdatedAt > input.LastUpdatedAt {\n+\t\t\treturn fmt.Errorf(\n+\t\t\t\t\"new version for detector is available. Please fetch latest version and then merge your changes\")\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNDk2Mg==", "bodyText": "Ack.", "url": "https://github.com/opendistro-for-elasticsearch/anomaly-detection/pull/233#discussion_r500634962", "createdAt": "2020-10-06T22:37:30Z", "author": {"login": "VijayanB"}, "path": "cli/internal/controller/ad/ad.go", "diffHunk": "@@ -520,3 +521,48 @@ func (c controller) GetDetectorsByName(ctx context.Context, pattern string, disp\n \t}\n \treturn output, nil\n }\n+\n+//UpdateDetector updates detector based on DetectorID, if force is enabled, it overrides without checking whether\n+// user downloaded latest version before updating it, if restart is true, detector will be started after update\n+func (c controller) UpdateDetector(ctx context.Context, input entity.UpdateDetectorUserInput, force bool, restart bool) error {\n+\tif len(input.ID) < 1 {\n+\t\treturn fmt.Errorf(\"detector Id cannot be empty\")\n+\t}\n+\tif !force {\n+\t\tlatestDetector, err := c.GetDetector(ctx, input.ID)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif latestDetector.LastUpdatedAt > input.LastUpdatedAt {\n+\t\t\treturn fmt.Errorf(\n+\t\t\t\t\"new version for detector is available. Please fetch latest version and then merge your changes\")\n+\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMjc4MQ=="}, "originalCommit": {"oid": "37d4c624ef096e2694ae8ba4e354089ee938dd67"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2939, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}