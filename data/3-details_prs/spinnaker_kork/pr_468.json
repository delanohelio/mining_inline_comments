{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMjg3Nzk2", "number": 468, "title": "feat(plugins): Support for extracting plugin bundles", "bodyText": "Plugin bundles are an aggregate of one or more PF4J plugin zip artifacts. It provides an experience for plugin developers to produce a single plugin artifact that is applied to one or more services. A bundle would look something like this:\nmy-cool-plugin.zip\n  orca.zip\n  deck.zip\n  ...\n\nThe PluginBundleExtractor provides the ability to extract a downloaded plugin bundle and source the correct internal plugin artifact for use by a service. It is also backwards compatible with a normal PF4J plugin artifact, in case a developer does not need bundle capabilities.", "createdAt": "2020-01-15T18:58:59Z", "url": "https://github.com/spinnaker/kork/pull/468", "merged": true, "mergeCommit": {"oid": "9328c587237da4685cbfe11ab581152ec3092688"}, "closed": true, "closedAt": "2020-01-15T23:04:10Z", "author": {"login": "robzienert"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6s3wyABqjI5NTI0NjY0NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6tuNKABqjI5NTI2MTI0NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3a38437512c05fc7c23d22993ae49333a687dbd", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/a3a38437512c05fc7c23d22993ae49333a687dbd", "committedDate": "2020-01-15T18:58:26Z", "message": "feat(plugins): Support for extracting plugin bundles"}, "afterCommit": {"oid": "09906cae458de7536a60f4f4c62762b46efa0372", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/09906cae458de7536a60f4f4c62762b46efa0372", "committedDate": "2020-01-15T21:59:11Z", "message": "feat(plugins): Support for extracting plugin bundles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNTYzMjcz", "url": "https://github.com/spinnaker/kork/pull/468#pullrequestreview-343563273", "createdAt": "2020-01-15T22:23:32Z", "commit": {"oid": "09906cae458de7536a60f4f4c62762b46efa0372"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMjoyMzozM1rOFeIZqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMjoyMzozM1rOFeIZqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzOTI0Mg==", "bodyText": "This could probably be private?  Or, maybe we could just remove this function and have one extract function.", "url": "https://github.com/spinnaker/kork/pull/468#discussion_r367139242", "createdAt": "2020-01-15T22:23:33Z", "author": {"login": "jonsie"}, "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/bundle/PluginBundleExtractor.kt", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Netflix, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.netflix.spinnaker.kork.plugins.bundle\n+\n+import com.netflix.spinnaker.kork.exceptions.IntegrationException\n+import org.pf4j.util.FileUtils\n+import org.slf4j.LoggerFactory\n+import java.nio.file.Path\n+\n+/**\n+ * Provides extraction capabilities for plugin bundles.\n+ *\n+ * Plugin Bundles are a ZIP files containing service-specific plugin ZIP files. When the plugin bundle is downloaded,\n+ * we first need to extract the bundle, then locate the service plugin ZIP and extract that. Plugin bundles are based\n+ * on naming convention, so we can assume that a service ZIP will always be \"{service}.zip\".\n+ *\n+ * Individual service plugins will be as what PF4J would normally expect.\n+ */\n+class PluginBundleExtractor {\n+\n+  private val log by lazy { LoggerFactory.getLogger(javaClass) }\n+\n+  /**\n+   * Extract the bundle. This does not unpack any of the underlying plugin zips.\n+   */\n+  fun extractBundle(bundlePath: Path): Path {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09906cae458de7536a60f4f4c62762b46efa0372"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNTYzNDcw", "url": "https://github.com/spinnaker/kork/pull/468#pullrequestreview-343563470", "createdAt": "2020-01-15T22:23:54Z", "commit": {"oid": "09906cae458de7536a60f4f4c62762b46efa0372"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff9b3c52ea7449ecdda48c0b4f506a4f3cd723b", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/8ff9b3c52ea7449ecdda48c0b4f506a4f3cd723b", "committedDate": "2020-01-15T22:58:36Z", "message": "feat(plugins): Support for extracting plugin bundles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09906cae458de7536a60f4f4c62762b46efa0372", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/09906cae458de7536a60f4f4c62762b46efa0372", "committedDate": "2020-01-15T21:59:11Z", "message": "feat(plugins): Support for extracting plugin bundles"}, "afterCommit": {"oid": "8ff9b3c52ea7449ecdda48c0b4f506a4f3cd723b", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/8ff9b3c52ea7449ecdda48c0b4f506a4f3cd723b", "committedDate": "2020-01-15T22:58:36Z", "message": "feat(plugins): Support for extracting plugin bundles"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1617, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}