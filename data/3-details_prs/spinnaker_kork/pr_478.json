{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0OTQ5MDQ5", "number": 478, "title": "refactor(secrets/s3): s3 custom endpoint", "bodyText": "In order to use another storage system like for example Minio, this change allows to set a custom endpoint url to the s3 secret configuration.\nsecrets:\n  s3:\n    enabled: true\n    endpoint-url: <custom-endpoint>\n    path-style-access-enabled: true", "createdAt": "2020-01-20T17:59:04Z", "url": "https://github.com/spinnaker/kork/pull/478", "merged": true, "mergeCommit": {"oid": "6b7ed8db3e720a2f8d03ce82bc2ff6da18ea360e"}, "closed": true, "closedAt": "2020-02-10T21:08:42Z", "author": {"login": "jorgebee65"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb69S5PgH2gAyMzY0OTQ5MDQ5OmFhOWRkY2IzYzAwMWQ3ZjQ5NzUyOGE1MzE1NGJkNTljM2E4YzY2MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDDlNogH2gAyMzY0OTQ5MDQ5OjcyNjFhOWZhZmIwM2U2OGRiYmM3ZGExNjY1ZGRkYzdlZGQ0M2FjZjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa9ddcb3c001d7f497528a53154bd59c3a8c6618", "author": {"user": null}, "url": "https://github.com/spinnaker/kork/commit/aa9ddcb3c001d7f497528a53154bd59c3a8c6618", "committedDate": "2020-01-16T17:07:23Z", "message": "Add the url to the s3 configuration properties in order to point to custom buckets (Minio for example)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f830479fa21751799c8216d004ab8388ad6edda9", "author": {"user": null}, "url": "https://github.com/spinnaker/kork/commit/f830479fa21751799c8216d004ab8388ad6edda9", "committedDate": "2020-01-17T18:07:16Z", "message": "remove lombok version, rename configuration parameters, validate a possible NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1", "author": {"user": null}, "url": "https://github.com/spinnaker/kork/commit/75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1", "committedDate": "2020-01-20T17:34:08Z", "message": "replace ConditionalOnExpression by ConditionalOnProperty on configuration, rename attributes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NDg5MDMz", "url": "https://github.com/spinnaker/kork/pull/478#pullrequestreview-345489033", "createdAt": "2020-01-20T18:59:31Z", "commit": {"oid": "75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxODo1OTozMVrOFfnEmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxOTowMjoyOFrOFfnH_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY5MDMyOA==", "bodyText": "Logger isn't used anywhere in this class - remove.", "url": "https://github.com/spinnaker/kork/pull/478#discussion_r368690328", "createdAt": "2020-01-20T18:59:31Z", "author": {"login": "robzienert"}, "path": "kork-secrets-aws/src/main/java/com/netflix/spinnaker/kork/secrets/engines/S3Configuration.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Armory, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.netflix.spinnaker.kork.secrets.engines;\n+\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.stereotype.Component;\n+\n+@Getter\n+@Component\n+@Configuration\n+@ConditionalOnProperty(\"secrets.s3.enabled\")\n+@Slf4j", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY5MDczMA==", "bodyText": "This class is odd: It's acting like a @ConfigurationProperties, but it isn't one.\nWe prefer to avoid the use of @Value annotations in favor of @ConfigurationProperties classes that get injected where they need to go. Would recommend refactoring to fall in line with this pattern.", "url": "https://github.com/spinnaker/kork/pull/478#discussion_r368690730", "createdAt": "2020-01-20T19:00:51Z", "author": {"login": "robzienert"}, "path": "kork-secrets-aws/src/main/java/com/netflix/spinnaker/kork/secrets/engines/S3Configuration.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Armory, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.netflix.spinnaker.kork.secrets.engines;\n+\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.stereotype.Component;\n+\n+@Getter\n+@Component\n+@Configuration\n+@ConditionalOnProperty(\"secrets.s3.enabled\")\n+@Slf4j\n+public class S3Configuration {\n+\n+  private String endpointUrl;\n+  private boolean pathStyleAccessEnabled;\n+\n+  @Autowired\n+  public S3Configuration(\n+      @Value(\"${secrets.s3.endpoint-url}\") String endpointUrl,\n+      @Value(\"${secrets.s3.path-style-access-enabled}\") boolean pathStyleAccessEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY5MTE5OA==", "bodyText": "I'm also worried (having not looked at the whole module) that you have a @ConditionalOnProperty annotation here, but then use it directly in S3SecretEngine's constructor, but have it typed as a required object. Depending on how the rest of the module is wired up, this could cause a runtime exception during startup.", "url": "https://github.com/spinnaker/kork/pull/478#discussion_r368691198", "createdAt": "2020-01-20T19:02:28Z", "author": {"login": "robzienert"}, "path": "kork-secrets-aws/src/main/java/com/netflix/spinnaker/kork/secrets/engines/S3Configuration.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Armory, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.netflix.spinnaker.kork.secrets.engines;\n+\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.stereotype.Component;\n+\n+@Getter\n+@Component\n+@Configuration\n+@ConditionalOnProperty(\"secrets.s3.enabled\")\n+@Slf4j\n+public class S3Configuration {\n+\n+  private String endpointUrl;\n+  private boolean pathStyleAccessEnabled;\n+\n+  @Autowired\n+  public S3Configuration(\n+      @Value(\"${secrets.s3.endpoint-url}\") String endpointUrl,\n+      @Value(\"${secrets.s3.path-style-access-enabled}\") boolean pathStyleAccessEnabled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY5MDczMA=="}, "originalCommit": {"oid": "75ff4d41a95b2cfb60b0c76571a5c5a4a77dfff1"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b15f96b72f9e9afffc6c17b449fb655b8eb3c023", "author": {"user": null}, "url": "https://github.com/spinnaker/kork/commit/b15f96b72f9e9afffc6c17b449fb655b8eb3c023", "committedDate": "2020-01-22T00:37:22Z", "message": "refactor(secrets/s3): s3 custom endpoint, remove logger from S3CongigurationProperties class, also change from Component to Configuration annotation and ConfigurationProperties instead Values, in S3SecretEngine add an Autowired (required = false) property instead of initialize from constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24c9f8440f4fb467d0cb15acf636218246dc5efe", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/24c9f8440f4fb467d0cb15acf636218246dc5efe", "committedDate": "2020-01-22T14:44:55Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef4bf8c42bd3adbfde3281624d249a31d467c494", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/ef4bf8c42bd3adbfde3281624d249a31d467c494", "committedDate": "2020-01-24T17:11:51Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67255da32918ac61421910e22cdb0a4a5a60ce00", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/67255da32918ac61421910e22cdb0a4a5a60ce00", "committedDate": "2020-01-27T16:16:38Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODc2MDkz", "url": "https://github.com/spinnaker/kork/pull/478#pullrequestreview-348876093", "createdAt": "2020-01-27T18:22:16Z", "commit": {"oid": "67255da32918ac61421910e22cdb0a4a5a60ce00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoyMjoxNlrOFiMtpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoyMjoxNlrOFiMtpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwNDE5Nw==", "bodyText": "Just do org.projectlombok:lombok so that kork-bom takes care of the lombok version.", "url": "https://github.com/spinnaker/kork/pull/478#discussion_r371404197", "createdAt": "2020-01-27T18:22:16Z", "author": {"login": "robzienert"}, "path": "kork-secrets-aws/kork-secrets-aws.gradle", "diffHunk": "@@ -6,4 +6,8 @@ dependencies {\n   api project(':kork-secrets')\n \n   implementation \"com.amazonaws:aws-java-sdk-s3\"\n+\n+  compileOnly 'org.projectlombok:lombok:+'\n+\n+  annotationProcessor 'org.projectlombok:lombok:+'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67255da32918ac61421910e22cdb0a4a5a60ce00"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "159c49577ac45c3846730f2b7c165c9fd507bdb2", "author": {"user": null}, "url": "https://github.com/spinnaker/kork/commit/159c49577ac45c3846730f2b7c165c9fd507bdb2", "committedDate": "2020-01-28T20:02:34Z", "message": "refactor(secrets/s3): Change the S3ConfigurationProperties injection from property to constructor wrapping it as Optional, also change the lombok references by a plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9699730ef2b14b1ce409324656c4000e4d4f05fa", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/9699730ef2b14b1ce409324656c4000e4d4f05fa", "committedDate": "2020-01-28T20:16:43Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0333eb927486c51dcc33f4aebe03f8c17da81aa0", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/0333eb927486c51dcc33f4aebe03f8c17da81aa0", "committedDate": "2020-01-28T23:01:58Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593c9a14b2c09fa7e499d8b4909a1c1b843e827a", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/593c9a14b2c09fa7e499d8b4909a1c1b843e827a", "committedDate": "2020-01-29T18:28:55Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30d5491139bdc2a4836d38d95fa3b9de90e8c2e0", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/30d5491139bdc2a4836d38d95fa3b9de90e8c2e0", "committedDate": "2020-02-03T16:42:12Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "380c6fe1db5da95c082b690bc338510fae51fc30", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/380c6fe1db5da95c082b690bc338510fae51fc30", "committedDate": "2020-02-05T15:07:47Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "967a89b845e464ec85cf7965be69cc7644bbb9f6", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/967a89b845e464ec85cf7965be69cc7644bbb9f6", "committedDate": "2020-02-10T15:25:35Z", "message": "Merge branch 'master' into s3-custom-url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MjA2NjI3", "url": "https://github.com/spinnaker/kork/pull/478#pullrequestreview-356206627", "createdAt": "2020-02-10T19:35:38Z", "commit": {"oid": "967a89b845e464ec85cf7965be69cc7644bbb9f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7261a9fafb03e68dbbc7da1665dddc7edd43acf3", "author": {"user": {"login": "jorgebee65", "name": "JB"}}, "url": "https://github.com/spinnaker/kork/commit/7261a9fafb03e68dbbc7da1665dddc7edd43acf3", "committedDate": "2020-02-10T20:58:13Z", "message": "Merge branch 'master' into s3-custom-url"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1622, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}