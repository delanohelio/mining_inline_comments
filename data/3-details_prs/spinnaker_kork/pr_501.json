{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNjU2NDUx", "number": 501, "title": "fix(swagger): Exclude MetaClass from swagger model generation", "bodyText": "All groovy classes have an implicit metaClass field that handles metaprogramming. In cases where a groovy class is used in an API the springfox library to generate Swagger docs is including the metaClass in the model for the class. In addition to being confusing (as a producer/consumer of the API would never set that field), it also leads to terrible performance in some cases.\nThe performance issues come from the fact that it then tries to build a model of MetaClass by reflecting its fields, etc. until it has built models of most of the Groovy classes.\nIn particular, before this change, front50 took 140 seconds to start; with this change it now takes 13 seconds.", "createdAt": "2020-02-06T00:49:29Z", "url": "https://github.com/spinnaker/kork/pull/501", "merged": true, "mergeCommit": {"oid": "a1f937a2dcc3849a037916138867ec14e8d920dd"}, "closed": true, "closedAt": "2020-02-11T19:13:24Z", "author": {"login": "ezimanyi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBf5WHAH2gAyMzcxNjU2NDUxOmZlZjYxODhjNjY0YzNlODMwZDA0OGFhNWI0NTVlZTBjNTgzMTE0YWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDWmwfAH2gAyMzcxNjU2NDUxOjI0ZWNhMzMwZDRmODM1NmE1ZTkwZmU3ODBjMDZmZDdkZTllOGZlZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fef6188c664c3e830d048aa5b455ee0c583114aa", "author": {"user": {"login": "ezimanyi", "name": "Eric Zimanyi"}}, "url": "https://github.com/spinnaker/kork/commit/fef6188c664c3e830d048aa5b455ee0c583114aa", "committedDate": "2020-02-06T00:49:42Z", "message": "fix(swagger): Exclude MetaClass from swagger model generation\n\nAll groovy classes have an implicit metaClass field that handles\nmetaprogramming. In cases where a groovy class is used in an\nAPI the springfox library to generate Swagger docs is including\nthe metaClass in the model for the class. In addition to being\nconfusing (as a producer/consumer of the API would never set\nthat field), it also leads to terrible performance in some\ncases.\n\nThe performance issues come from the fact that it then tries to\nbuild a model of MetaClass by reflecting its fields, etc. until\nit has built models of most of the Groovy classes.\n\nIn particular, before this change, front50 took 140 seconds to start;\nwith this change it now takes 13 seconds."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTQxNDY0", "url": "https://github.com/spinnaker/kork/pull/501#pullrequestreview-354141464", "createdAt": "2020-02-06T00:52:30Z", "commit": {"oid": "fef6188c664c3e830d048aa5b455ee0c583114aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDo1MjozMFrOFmMMKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDo1MjozMFrOFmMMKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4OTkzMA==", "bodyText": "I don't love needing to pull in groovy as a dependency just to exclude a groovy class from model building...open to suggestions for a better way of doing this.  (I think it needs to be api as if this isn't on the classpath of the consuming service at runtime I think it will fail if it looks at the list of excluded types and finds an undefined class.)\nOne other thought I had was to define a bean of type List<Class> excludedSwaggerClasses() here that's empty, and leave it to services to override that bean with anything they want to exclude...given that we'd probably want this in almost all services (as they almost all have groovy) that seemed more verbose, but definitely open to thoughts on that.", "url": "https://github.com/spinnaker/kork/pull/501#discussion_r375589930", "createdAt": "2020-02-06T00:52:30Z", "author": {"login": "ezimanyi"}, "path": "kork-swagger/kork-swagger.gradle", "diffHunk": "@@ -6,4 +6,5 @@ dependencies {\n   api \"org.springframework.boot:spring-boot-autoconfigure\"\n   api \"io.springfox:springfox-swagger2\"\n   api \"io.springfox:springfox-swagger-ui\"\n+  api \"org.codehaus.groovy:groovy-all\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fef6188c664c3e830d048aa5b455ee0c583114aa"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c71141501979a116471e69e4c8f213b737ee89d5", "author": {"user": {"login": "ezimanyi", "name": "Eric Zimanyi"}}, "url": "https://github.com/spinnaker/kork/commit/c71141501979a116471e69e4c8f213b737ee89d5", "committedDate": "2020-02-11T15:41:28Z", "message": "fix(swagger): Make groovy implementation dependency\n\nThis does not need to be an API dependency."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b4ccdaf133cff2dd1ba06af775e1f5b3979715", "author": {"user": {"login": "ezimanyi", "name": "Eric Zimanyi"}}, "url": "https://github.com/spinnaker/kork/commit/84b4ccdaf133cff2dd1ba06af775e1f5b3979715", "committedDate": "2020-02-11T15:56:27Z", "message": "fix(swagger): Only bring in core groovy\n\nWe don't need all of it, only the core"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2OTE3NDgy", "url": "https://github.com/spinnaker/kork/pull/501#pullrequestreview-356917482", "createdAt": "2020-02-11T19:07:03Z", "commit": {"oid": "84b4ccdaf133cff2dd1ba06af775e1f5b3979715"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24eca330d4f8356a5e90fe780c06fd7de9e8fed4", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/spinnaker/kork/commit/24eca330d4f8356a5e90fe780c06fd7de9e8fed4", "committedDate": "2020-02-11T19:08:06Z", "message": "Merge branch 'master' into exclude-groovy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1543, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}