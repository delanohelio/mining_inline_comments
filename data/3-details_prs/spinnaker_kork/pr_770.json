{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODYyNjIw", "number": 770, "title": "refactor(test): Migrate Spek to Spek2", "bodyText": "Could've removed Spek from kork entirely, but I wanted to see how Spek 2.x works.\nSupposedly it has better IDE performance than Spek 1.x, but I haven't seen evidence of this yet via kork: Orca has some really large, phenomenally slow tests that could be upgraded that should give better results. Spek 1.x and Spek 2.x can live side-by-side, so I'll try converting a single test to compare, but kork has been entirely migrated.", "createdAt": "2020-09-02T14:31:32Z", "url": "https://github.com/spinnaker/kork/pull/770", "merged": true, "mergeCommit": {"oid": "6e616fe7baf994623cd8feca1919ac589df0296a"}, "closed": true, "closedAt": "2020-09-08T20:27:32Z", "author": {"login": "robzienert"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE9xBOgFqTQ4MDk0MDgxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG9gqcABqjM3NDI2NjUwMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTQwODE5", "url": "https://github.com/spinnaker/kork/pull/770#pullrequestreview-480940819", "createdAt": "2020-09-02T15:27:22Z", "commit": {"oid": "8050833e7d6cf98ce6aa8189c6ab4d778875f95a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNToyNzoyMlrOHL00ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNToyOTo0MlrOHL07kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE2MTgyNw==", "bodyText": "Shouldn't that be a Then rather than a When?", "url": "https://github.com/spinnaker/kork/pull/770#discussion_r482161827", "createdAt": "2020-09-02T15:27:22Z", "author": {"login": "robfletcher"}, "path": "kork-sql/src/test/kotlin/com/netflix/spinnaker/kork/sql/PagedIteratorSpec.kt", "diffHunk": "@@ -28,42 +28,38 @@ import com.nhaarman.mockito_kotlin.whenever\n import org.assertj.core.api.AbstractAssert\n import org.assertj.core.api.Assertions.assertThat\n import org.assertj.core.api.Assertions.assertThatThrownBy\n-import org.jetbrains.spek.api.Spek\n-import org.jetbrains.spek.api.dsl.describe\n-import org.jetbrains.spek.api.dsl.given\n-import org.jetbrains.spek.api.dsl.it\n-import org.jetbrains.spek.api.dsl.on\n+import org.spekframework.spek2.Spek\n+import org.spekframework.spek2.style.gherkin.Feature\n \n internal object PagedIteratorSpec : Spek({\n \n-  describe(\"fetching paged data\") {\n-\n+  Feature(\"fetching paged data\") {\n     val pageSize = 3\n     val nextPage = mock<(Int, String?) -> Iterable<String>>()\n \n-    given(\"there is no data\") {\n+    Scenario(\"there is no data\") {\n       val subject = PagedIterator(pageSize, String::toString, nextPage)\n \n-      beforeGroup {\n+      beforeScenario {\n         whenever(nextPage(eq(pageSize), anyOrNull())) doReturn emptyList<String>()\n       }\n \n-      afterGroup { reset(nextPage) }\n+      afterScenario { reset(nextPage) }\n \n-      it(\"has no elements\") {\n+      When(\"has no elements\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8050833e7d6cf98ce6aa8189c6ab4d778875f95a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE2MzYwMg==", "bodyText": "Seems weird you can have a declaration outside the DSL scope like this", "url": "https://github.com/spinnaker/kork/pull/770#discussion_r482163602", "createdAt": "2020-09-02T15:29:42Z", "author": {"login": "robfletcher"}, "path": "kork-sql/src/test/kotlin/com/netflix/spinnaker/kork/sql/PagedIteratorSpec.kt", "diffHunk": "@@ -107,32 +103,32 @@ internal object PagedIteratorSpec : Spek({\n         }\n       }\n \n-      afterGroup { reset(nextPage) }\n+      afterScenario { reset(nextPage) }\n \n-      it(\"has some elements\") {\n+      Given(\"has some elements\") {\n         assertThat(subject.hasNext()).isTrue()\n       }\n \n-      on(\"draining the iterator\") {\n-        val results = mutableListOf<String>()\n+      val results = mutableListOf<String>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8050833e7d6cf98ce6aa8189c6ab4d778875f95a"}, "originalPosition": 112}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDA2ODEz", "url": "https://github.com/spinnaker/kork/pull/770#pullrequestreview-481006813", "createdAt": "2020-09-02T16:42:48Z", "commit": {"oid": "8050833e7d6cf98ce6aa8189c6ab4d778875f95a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8050833e7d6cf98ce6aa8189c6ab4d778875f95a", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/8050833e7d6cf98ce6aa8189c6ab4d778875f95a", "committedDate": "2020-09-02T14:30:34Z", "message": "refactor(test): Migrate Spek to Spek2"}, "afterCommit": {"oid": "be8f15bbf126227f7d3d8622feb2ddf8cc8127e9", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/be8f15bbf126227f7d3d8622feb2ddf8cc8127e9", "committedDate": "2020-09-04T00:29:34Z", "message": "refactor(test): Migrate Spek to Spek2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f5407eac2f9b3c2ed560dcf3f7ddebe2fc55ae", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/d7f5407eac2f9b3c2ed560dcf3f7ddebe2fc55ae", "committedDate": "2020-09-08T20:19:00Z", "message": "refactor(test): Migrate Spek to Spek2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be8f15bbf126227f7d3d8622feb2ddf8cc8127e9", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/be8f15bbf126227f7d3d8622feb2ddf8cc8127e9", "committedDate": "2020-09-04T00:29:34Z", "message": "refactor(test): Migrate Spek to Spek2"}, "afterCommit": {"oid": "d7f5407eac2f9b3c2ed560dcf3f7ddebe2fc55ae", "author": {"user": {"login": "robzienert", "name": "Rob Zienert"}}, "url": "https://github.com/spinnaker/kork/commit/d7f5407eac2f9b3c2ed560dcf3f7ddebe2fc55ae", "committedDate": "2020-09-08T20:19:00Z", "message": "refactor(test): Migrate Spek to Spek2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1482, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}