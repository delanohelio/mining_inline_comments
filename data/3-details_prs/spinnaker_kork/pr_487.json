{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NjQ0ODY4", "number": 487, "title": "refactor(plugins): Plugin version and service requirement selected via SpinnakerUpdateManager", "bodyText": "This does a few things for us:\n\nUpdate repositories should return all plugin info objects, that includes the front50 repo.  Cache the world.  This keeps the process of determining which plugin to install unified, which leads me to...\nSpinnakerUpdateManager.getLastPluginRelease will be used to select the plugin version for installation.  There will be a follow up PR to Gate for this (for use in the DeckPluginCache). We will eventually refactor this, but at least it's all in one place.", "createdAt": "2020-01-24T01:35:08Z", "url": "https://github.com/spinnaker/kork/pull/487", "merged": true, "mergeCommit": {"oid": "92209c8b9f46c1ee0c8c9f483359010a49687bb4"}, "closed": true, "closedAt": "2020-01-24T19:04:28Z", "author": {"login": "jonsie"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9Vc-jABqjI5NzU5MjAxNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9jnbPgH2gAyMzY2NjQ0ODY4OmVjOTVkNDg2NDQwYWY1Y2VmNzRkNjEzMzliMDMwOGQ0ZmNhZmMwNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb1f8f3ed0336a27b745b6d5918234c4a23f52f4", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/fb1f8f3ed0336a27b745b6d5918234c4a23f52f4", "committedDate": "2020-01-24T01:34:14Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}, "afterCommit": {"oid": "f543366c392cafde3a435419d84848bae4bd4990", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/f543366c392cafde3a435419d84848bae4bd4990", "committedDate": "2020-01-24T02:23:33Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzI1ODcw", "url": "https://github.com/spinnaker/kork/pull/487#pullrequestreview-347725870", "createdAt": "2020-01-24T02:33:36Z", "commit": {"oid": "f543366c392cafde3a435419d84848bae4bd4990"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMjozMzozNlrOFhSlPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMjozMzozNlrOFhSlPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ1MTc3Mg==", "bodyText": "Minor -- Going to switch Gate's DeckPluginCache over to using the SpinnakerUpdateManager downloadPluginRelease since it has a dependency on UpdateManager already, and then we can remove PluginUpdateService as a dependency in DeckPluginCache.", "url": "https://github.com/spinnaker/kork/pull/487#discussion_r370451772", "createdAt": "2020-01-24T02:33:36Z", "author": {"login": "jonsie"}, "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/update/PluginUpdateService.kt", "diffHunk": "@@ -58,13 +57,6 @@ class PluginUpdateService(\n     installNewPlugins()\n   }\n \n-  /**\n-   * This is used in Gate to download Deck plugin artifacts - do not remove and must remain public.\n-   */\n-  fun download(pluginId: String, version: String): Path {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f543366c392cafde3a435419d84848bae4bd4990"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f543366c392cafde3a435419d84848bae4bd4990", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/f543366c392cafde3a435419d84848bae4bd4990", "committedDate": "2020-01-24T02:23:33Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}, "afterCommit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/af26069174a1a52be3df8cee50e295a786be0770", "committedDate": "2020-01-24T18:36:32Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MTQ4MTAy", "url": "https://github.com/spinnaker/kork/pull/487#pullrequestreview-348148102", "createdAt": "2020-01-24T18:40:48Z", "commit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODo0MDo0OFrOFhmxpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODo0MDo0OFrOFhmxpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4MjYzMA==", "bodyText": "What does this marker do? I've never seen that before.", "url": "https://github.com/spinnaker/kork/pull/487#discussion_r370782630", "createdAt": "2020-01-24T18:40:48Z", "author": {"login": "robzienert"}, "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/update/PluginUpdateService.kt", "diffHunk": "@@ -74,10 +66,12 @@ class PluginUpdateService(\n     val updates = updateManager.updates\n     log.debug(\"Found {} plugin updates\", updates.size)\n \n-    updates.forEach { plugin ->\n+    updates.forEach updates@{ plugin ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MTQ5NjAw", "url": "https://github.com/spinnaker/kork/pull/487#pullrequestreview-348149600", "createdAt": "2020-01-24T18:43:30Z", "commit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODo0MzozMFrOFhm2bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODo0MzozMFrOFhm2bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4Mzg1Mg==", "bodyText": "We don't use this endpoint anymore, do we? Why not just remove it?", "url": "https://github.com/spinnaker/kork/pull/487#discussion_r370783852", "createdAt": "2020-01-24T18:43:30Z", "author": {"login": "robzienert"}, "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/update/front50/Front50Service.kt", "diffHunk": "@@ -33,5 +33,8 @@ interface Front50Service {\n   fun getById(@Path(\"id\") id: String): Call<SpinnakerPluginInfo>\n \n   @GET(\"/pluginInfo\")\n-  fun list(@Query(\"service\") service: String): Call<Collection<SpinnakerPluginInfo>>\n+  fun listByService(@Query(\"service\") service: String): Call<Collection<SpinnakerPluginInfo>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MTQ5NzYw", "url": "https://github.com/spinnaker/kork/pull/487#pullrequestreview-348149760", "createdAt": "2020-01-24T18:43:45Z", "commit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MTUwNDAw", "url": "https://github.com/spinnaker/kork/pull/487#pullrequestreview-348150400", "createdAt": "2020-01-24T18:44:51Z", "commit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e7b4cbdccd45aa25b51115121c7dd38b38fea8", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/70e7b4cbdccd45aa25b51115121c7dd38b38fea8", "committedDate": "2020-01-24T18:47:11Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af26069174a1a52be3df8cee50e295a786be0770", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/af26069174a1a52be3df8cee50e295a786be0770", "committedDate": "2020-01-24T18:36:32Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}, "afterCommit": {"oid": "70e7b4cbdccd45aa25b51115121c7dd38b38fea8", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/70e7b4cbdccd45aa25b51115121c7dd38b38fea8", "committedDate": "2020-01-24T18:47:11Z", "message": "refactor(plugins): Plugin service requirement selected via SpinnakerUpdateManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec95d486440af5cef74d61339b0308d4fcafc070", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/ec95d486440af5cef74d61339b0308d4fcafc070", "committedDate": "2020-01-24T18:54:03Z", "message": "Merge branch 'master' into filter-service-name-update-manager"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1631, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}