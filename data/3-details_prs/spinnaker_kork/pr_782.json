{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDE1OTMw", "number": 782, "title": "feat(plugins): Add remote extension synchronous read and write capabilities", "bodyText": "Tried to implement this in a transport agnostic way - ideally we should be able to swap the transport config out with a gRPC config and the interaction with RemoteExtension will stay the same.\n\nAlso includes a small breaking change to remove usage of M<S, O> in ServiceEndpoint\nRemove usage of Provider in favor of ObjectProvider - I find the errors much easier to grok as they are native Spring errors, and the API is more robust.\nSmall remote plugin package refactor", "createdAt": "2020-09-15T04:01:50Z", "url": "https://github.com/spinnaker/kork/pull/782", "merged": true, "mergeCommit": {"oid": "dedc37c98b648a1cd4884d8999a6870795f70aa4"}, "closed": true, "closedAt": "2020-09-17T22:02:32Z", "author": {"login": "jonsie"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI_wQ9AFqTQ4ODMwNzEzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ4NylAH2gAyNDg3MDE1OTMwOjIwMTgzNjNiNTZhYjNlNjAyOTRjODg3ZDk4MTJiYTJiOWJjN2RiNWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzA3MTMx", "url": "https://github.com/spinnaker/kork/pull/782#pullrequestreview-488307131", "createdAt": "2020-09-15T04:05:22Z", "commit": {"oid": "a1cd88feb404034eab777fda06bb0eed9e23cce4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNDowNToyMlrOHRvvGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNDowNToyMlrOHRvvGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM2OTk0NA==", "bodyText": "I'll follow up where necessary (Gate and internal libraries) with this change.", "url": "https://github.com/spinnaker/kork/pull/782#discussion_r488369944", "createdAt": "2020-09-15T04:05:22Z", "author": {"login": "jonsie"}, "path": "kork-web/src/main/java/com/netflix/spinnaker/config/ServiceEndpoint.java", "diffHunk": "@@ -33,7 +33,7 @@\n \n   /** Misc. config necessary for the service client. */\n   @Nonnull\n-  public Map<String, Object> getConfig();\n+  public Map<String, String> getConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1cd88feb404034eab777fda06bb0eed9e23cce4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/d5bb4fc4074c9cde59ffd9e01d6730a74713b760", "committedDate": "2020-09-15T04:09:05Z", "message": "feat(plugins): Add remote extension sychronous read and write capabilities\n\nTried to implement this in a transport agnostic way - ideally we should be able to swap the transport config out with a gRPC config and the interaction with `RemoteExtension` will stay the same.\n\n- Also includes a small breaking change to remove usage of M<S, O> in ServiceEndpoint\n- Remove usage of Provider in favor of ObjectProvider - I find the errors much easier to grok as they are native Spring errors, and the API is more robust.\n- Small remote plugin package refactor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1cd88feb404034eab777fda06bb0eed9e23cce4", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/a1cd88feb404034eab777fda06bb0eed9e23cce4", "committedDate": "2020-09-15T04:00:55Z", "message": "feat(plugins): Add remote extension sychronous read and write capabilities\n\nTried to implement this in a transport agnostic way - ideally we should be able to swap the transport config out with a gRPC config and the interaction with `RemoteExtension` will stay the same.\n\n- Also includes a small breaking change to remove usage of M<S, O> in ServiceEndpoint\n- Remove usage of Provider in favor of ObjectProvider - I find the errors much easier to grok as they are native Spring errors, and the API is more robust.\n- Small remote plugin package refactor"}, "afterCommit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/d5bb4fc4074c9cde59ffd9e01d6730a74713b760", "committedDate": "2020-09-15T04:09:05Z", "message": "feat(plugins): Add remote extension sychronous read and write capabilities\n\nTried to implement this in a transport agnostic way - ideally we should be able to swap the transport config out with a gRPC config and the interaction with `RemoteExtension` will stay the same.\n\n- Also includes a small breaking change to remove usage of M<S, O> in ServiceEndpoint\n- Remove usage of Provider in favor of ObjectProvider - I find the errors much easier to grok as they are native Spring errors, and the API is more robust.\n- Small remote plugin package refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTAzMTYw", "url": "https://github.com/spinnaker/kork/pull/782#pullrequestreview-488903160", "createdAt": "2020-09-15T17:22:23Z", "commit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyMjoyM1rOHSMHpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyMjoyM1rOHSMHpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzNDk4Mg==", "bodyText": "Interesting thought: We should support an in-process transport. I think it could be beneficial to converge on \"remote-first\" extension points, but still allowing in-process plugins to implement them. What do you think?", "url": "https://github.com/spinnaker/kork/pull/782#discussion_r488834982", "createdAt": "2020-09-15T17:22:23Z", "author": {"login": "robzienert"}, "path": "kork-plugins/src/test/kotlin/com/netflix/spinnaker/kork/plugins/remote/extension/RemoteExtensionTest.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.netflix.spinnaker.kork.plugins.remote.extension\n+\n+\n+import com.netflix.spinnaker.kork.plugins.remote.extension.transport.RemoteExtensionPayload\n+import com.netflix.spinnaker.kork.plugins.remote.extension.transport.RemoteExtensionQuery\n+import com.netflix.spinnaker.kork.plugins.remote.extension.transport.RemoteExtensionResponse\n+import com.netflix.spinnaker.kork.plugins.remote.extension.transport.RemoteExtensionTransport\n+import dev.minutest.junit.JUnit5Minutests\n+import dev.minutest.rootContext\n+import io.mockk.every\n+import io.mockk.mockk\n+import strikt.api.expectThat\n+import strikt.assertions.isA\n+\n+class RemoteExtensionTest : JUnit5Minutests {\n+  fun tests() = rootContext<Fixture> {\n+    fixture {\n+      Fixture()\n+    }\n+\n+    test (\"Get config type\") {\n+      val result = subject.getTypedConfig<ConfigType>()\n+      expectThat(result).isA<ConfigType>()\n+    }\n+\n+    test(\"Invoke is void\") {\n+      val result = subject.invoke(remoteExtensionPayload)\n+      expectThat(result).isA<Unit>()\n+    }\n+\n+    test(\"Returns the write response\") {\n+      every { transport.write(any()) } returns writeResponse\n+      val result = subject.write<WriteResponse>(remoteExtensionPayload)\n+      expectThat(result).isA<WriteResponse>()\n+    }\n+\n+    test(\"Returns the read response\") {\n+      every { transport.read(any()) } returns readResponse\n+      val result = subject.read<ReadResponse>(remoteExtensionQuery)\n+      expectThat(result).isA<ReadResponse>()\n+    }\n+  }\n+\n+  private class Fixture {\n+    val writeResponse = WriteResponse()\n+    val readResponse = ReadResponse()\n+    val remoteExtensionPayload = Payload()\n+    val remoteExtensionQuery = Query()\n+    val transport: RemoteExtensionTransport = mockk(relaxed = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTAzMjM2", "url": "https://github.com/spinnaker/kork/pull/782#pullrequestreview-488903236", "createdAt": "2020-09-15T17:22:29Z", "commit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODU2NjA1", "url": "https://github.com/spinnaker/kork/pull/782#pullrequestreview-490856605", "createdAt": "2020-09-17T18:02:23Z", "commit": {"oid": "d5bb4fc4074c9cde59ffd9e01d6730a74713b760"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2018363b56ab3e60294c887d9812ba2b9bc7db5b", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/2018363b56ab3e60294c887d9812ba2b9bc7db5b", "committedDate": "2020-09-17T21:52:18Z", "message": "Merge branch 'master' into read-write-remote-extension"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1488, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}