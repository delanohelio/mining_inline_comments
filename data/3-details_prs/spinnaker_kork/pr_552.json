{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NDYwMTQ2", "number": 552, "title": "fix(plugins): Set the service version to the actual resolved value in\u2026", "bodyText": "This fixes the issue where gate was attempting to download all plugins instead of just deck related plugins.\nService version was always set to 'unknown' before and this fix will actually set it what  itwas resolved to.", "createdAt": "2020-03-14T22:15:55Z", "url": "https://github.com/spinnaker/kork/pull/552", "merged": true, "mergeCommit": {"oid": "33a110cacffe30be4d810c7ea8215067f4c9a599"}, "closed": true, "closedAt": "2020-03-17T03:56:13Z", "author": {"login": "srekapalli"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNsYPiAH2gAyMzg4NDYwMTQ2OjBkMGRkNTVmNWYzNGJkOTgxZTU5MTQ5OTRjNzFmMDgxOWRkNWY3NmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOaeFkgH2gAyMzg4NDYwMTQ2OjMxNWEzNmFiOWJlNTM5YTc0NDA1MDVlNTBjNWJmZTY3YmExZWFiMWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d0dd55f5f34bd981e5914994c71f0819dd5f76e", "author": {"user": {"login": "srekapalli", "name": "Sairam Rekapalli"}}, "url": "https://github.com/spinnaker/kork/commit/0d0dd55f5f34bd981e5914994c71f0819dd5f76e", "committedDate": "2020-03-14T22:09:24Z", "message": "fix(plugins): Set the service version to the actual resolved value instead of default it to unknown all the time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "author": {"user": {"login": "srekapalli", "name": "Sairam Rekapalli"}}, "url": "https://github.com/spinnaker/kork/commit/bf8e88f2319ac6bd543e12a9d352dbbd0097ece1", "committedDate": "2020-03-14T22:16:11Z", "message": "Merge branch 'master' into plugin_version_bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODE2NTQ0", "url": "https://github.com/spinnaker/kork/pull/552#pullrequestreview-374816544", "createdAt": "2020-03-15T17:07:13Z", "commit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNzowNzoxM1rOF2gE0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNzowNzoxM1rOF2gE0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5Mjk0Ng==", "bodyText": "lol oops \ud83d\udcaf", "url": "https://github.com/spinnaker/kork/pull/552#discussion_r392692946", "createdAt": "2020-03-15T17:07:13Z", "author": {"login": "robzienert"}, "path": "kork-core/src/main/java/com/netflix/spinnaker/kork/version/ServiceVersion.java", "diffHunk": "@@ -62,7 +62,10 @@ public String resolve() {\n         }\n       }\n \n-      resolvedServiceVersion = UNKNOWN_VERSION;\n+      if (resolvedServiceVersion == null || resolvedServiceVersion.isEmpty()) {\n+        log.warn(\"Unable to determine the service version, setting it to unknown\");\n+        resolvedServiceVersion = UNKNOWN_VERSION;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODE2Nzgy", "url": "https://github.com/spinnaker/kork/pull/552#pullrequestreview-374816782", "createdAt": "2020-03-15T17:10:58Z", "commit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNzoxMDo1OFrOF2gF0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNzoxMDo1OFrOF2gF0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY5MzIwMQ==", "bodyText": "nit: Seeing 0.0.0 across two different files. Worth making a const somewhere instead?", "url": "https://github.com/spinnaker/kork/pull/552#discussion_r392693201", "createdAt": "2020-03-15T17:10:58Z", "author": {"login": "robzienert"}, "path": "kork-plugins/src/main/kotlin/com/netflix/spinnaker/kork/plugins/update/SpinnakerUpdateManager.kt", "diffHunk": "@@ -108,8 +108,15 @@ class SpinnakerUpdateManager(\n     val versionManager = SpinnakerServiceVersionManager(serviceName)\n     val lastPluginRelease: MutableMap<String, PluginRelease> = mutableMapOf()\n \n+    // If service version cannot be determined(i.e 0.0.0),\n+    // just check if the release requirement mentions the service to see if the plugin is applicable. This case should\n+    // never happen, we should always know the system version but if it happens we can at least give a matching plugin\n+    // to the service name in question.\n+    //\n+    // If version is determined, check the version constraint explicitly to decide if the plugin is applicable or not.\n     for (release in pluginInfo.releases) {\n-      if (systemVersion == \"0.0.0\" || versionManager.checkVersionConstraint(systemVersion, release.requires)) {\n+      if ((systemVersion == \"0.0.0\" && release.requires.contains(serviceName, ignoreCase = true)) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODE2Nzkz", "url": "https://github.com/spinnaker/kork/pull/552#pullrequestreview-374816793", "createdAt": "2020-03-15T17:11:11Z", "commit": {"oid": "bf8e88f2319ac6bd543e12a9d352dbbd0097ece1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362903f71a7a4d8cb7046faa0af7c74839ddd5a0", "author": {"user": {"login": "srekapalli", "name": "Sairam Rekapalli"}}, "url": "https://github.com/spinnaker/kork/commit/362903f71a7a4d8cb7046faa0af7c74839ddd5a0", "committedDate": "2020-03-17T03:45:43Z", "message": "fix(plugins): Set the default service version as const"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "315a36ab9be539a7440505e50c5bfe67ba1eab1b", "author": {"user": {"login": "srekapalli", "name": "Sairam Rekapalli"}}, "url": "https://github.com/spinnaker/kork/commit/315a36ab9be539a7440505e50c5bfe67ba1eab1b", "committedDate": "2020-03-17T03:51:25Z", "message": "Merge branch 'master' into plugin_version_bug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1580, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}