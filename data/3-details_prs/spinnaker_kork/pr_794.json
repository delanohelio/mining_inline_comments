{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1Nzg0NjM0", "number": 794, "title": "feat(exceptions): Support decorating error messages that are the result of validation errors", "bodyText": "", "createdAt": "2020-09-30T20:58:41Z", "url": "https://github.com/spinnaker/kork/pull/794", "merged": true, "mergeCommit": {"oid": "70b0c5b37a1ee681326b7c023f8c9c53b360b79e"}, "closed": true, "closedAt": "2020-09-30T21:31:23Z", "author": {"login": "jonsie"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdODPAigH2gAyNDk1Nzg0NjM0OmMxMTY3NTEwMDY2YjEwMTYyZjIzNTFjM2I3MDAyZjFjYzA2ZjUzNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdODr9FAFqTQ5OTgyNjI4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372", "author": {"user": {"login": "jonsie", "name": "Chris Smalley"}}, "url": "https://github.com/spinnaker/kork/commit/c1167510066b10162f2351c3b7002f1cc06f5372", "committedDate": "2020-09-30T20:58:17Z", "message": "feat(exceptions): Support decorating error messages that are the result of validation errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODA3NDg5", "url": "https://github.com/spinnaker/kork/pull/794#pullrequestreview-499807489", "createdAt": "2020-09-30T20:59:43Z", "commit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1OTo0M1rOHavHwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1OTo0M1rOHavHwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzA1Nw==", "bodyText": "Deleted this concept of supports - the implementation of the two message functions will just determine if the throwable or errorCode are supported.", "url": "https://github.com/spinnaker/kork/pull/794#discussion_r497797057", "createdAt": "2020-09-30T20:59:43Z", "author": {"login": "jonsie"}, "path": "kork-api/src/main/java/com/netflix/spinnaker/kork/api/exceptions/ExceptionMessage.java", "diffHunk": "@@ -12,12 +13,6 @@\n  */\n public interface ExceptionMessage extends SpinnakerExtensionPoint {\n \n-  /**\n-   * The user message generated will largely be based off the exception type, so check if this\n-   * implementation supports the specified exception type.\n-   */\n-  boolean supports(Class<? extends Throwable> throwable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODA4MDg3", "url": "https://github.com/spinnaker/kork/pull/794#pullrequestreview-499808087", "createdAt": "2020-09-30T21:00:35Z", "commit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowMDozNVrOHavJkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowMDozNVrOHavJkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzUyMw==", "bodyText": "Unrelated - just noticed I missed an exception message decoration spot in GenericExceptionHandlers.", "url": "https://github.com/spinnaker/kork/pull/794#discussion_r497797523", "createdAt": "2020-09-30T21:00:35Z", "author": {"login": "jonsie"}, "path": "kork-web/src/main/java/com/netflix/spinnaker/kork/web/exceptions/GenericExceptionHandlers.java", "diffHunk": "@@ -76,7 +76,8 @@ public void handleNotFoundException(\n   public void handleInvalidRequestException(\n       Exception e, HttpServletResponse response, HttpServletRequest request) throws IOException {\n     storeException(request, response, e);\n-    response.sendError(HttpStatus.BAD_REQUEST.value(), e.getMessage());\n+    response.sendError(\n+        HttpStatus.BAD_REQUEST.value(), exceptionMessageDecorator.decorate(e, e.getMessage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODEwNjMx", "url": "https://github.com/spinnaker/kork/pull/794#pullrequestreview-499810631", "createdAt": "2020-09-30T21:04:21Z", "commit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowNDoyMVrOHavQ-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowNDoyMVrOHavQ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5OTQxNw==", "bodyText": "Support decorating an exception message based off an errorCode.  This will typically come from a CloudDriver validation error (UPDATE: actually we send off these validation errors from a few other services too).", "url": "https://github.com/spinnaker/kork/pull/794#discussion_r497799417", "createdAt": "2020-09-30T21:04:21Z", "author": {"login": "jonsie"}, "path": "kork-api/src/main/java/com/netflix/spinnaker/kork/api/exceptions/ExceptionMessage.java", "diffHunk": "@@ -27,6 +22,17 @@\n    * @return The string to append to the message. Note that this will not modify the original\n    *     exception message but only append to the message that is delivered to the end-user.\n    */\n-  @Nullable\n-  String message(Throwable throwable, @Nullable ExceptionDetails exceptionDetails);\n+  Optional<String> message(Throwable throwable, @Nullable ExceptionDetails exceptionDetails);\n+\n+  /**\n+   * Create the message.\n+   *\n+   * @param errorCode The error code. This typically comes into play when using Spring's Errors\n+   *     during validation, prior to throwing an exception.\n+   * @param exceptionDetails Additional details about the error that can be used to inform the\n+   *     message.\n+   * @return The string to append to the message. Note that this will not modify the original\n+   *     exception message but only append to the message that is delivered to the end-user.\n+   */\n+  Optional<String> message(String errorCode, @Nullable ExceptionDetails exceptionDetails);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODI2Mjg3", "url": "https://github.com/spinnaker/kork/pull/794#pullrequestreview-499826287", "createdAt": "2020-09-30T21:29:55Z", "commit": {"oid": "c1167510066b10162f2351c3b7002f1cc06f5372"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1496, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}