{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MTA3OTAy", "number": 3405, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0ODo1MlrOEgWjgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo1MToyN1rOEgWmWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMzU5NDI0OnYy", "diffSide": "RIGHT", "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0ODo1MlrOHNKjbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0ODo1MlrOHNKjbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NjQ0NA==", "bodyText": "you can add this to previous if or remove completely.", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483566444", "createdAt": "2020-09-04T11:48:52Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "diffHunk": "@@ -108,6 +114,11 @@ public TbRuleEngineProcessingDecision analyze(TbRuleEngineProcessingResult resul\n                         } catch (InterruptedException e) {\n                             throw new RuntimeException(e);\n                         }\n+                        if (multiplyPauseBetweenRetries && maxPauseBetweenRetries > 0) {\n+                            if (pauseBetweenRetries != maxPauseBetweenRetries) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMzU5NjUzOnYy", "diffSide": "RIGHT", "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0OTo0NVrOHNKkzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMjowMTo1NlrOHNK5Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2Njc5Ng==", "bodyText": "Maybe\npauseBetweenRetries = Math.min(maxPauseBetweenRetries, pauseBetweenRetries * 2);\n?", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483566796", "createdAt": "2020-09-04T11:49:45Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "diffHunk": "@@ -108,6 +114,11 @@ public TbRuleEngineProcessingDecision analyze(TbRuleEngineProcessingResult resul\n                         } catch (InterruptedException e) {\n                             throw new RuntimeException(e);\n                         }\n+                        if (multiplyPauseBetweenRetries && maxPauseBetweenRetries > 0) {\n+                            if (pauseBetweenRetries != maxPauseBetweenRetries) {\n+                                pauseBetweenRetries = Math.min(maxPauseBetweenRetries, pauseBetweenRetries * pauseBetweenRetries);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3MjAzMA==", "bodyText": "@ashvayka sorry for this typo.", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483572030", "createdAt": "2020-09-04T12:01:56Z", "author": {"login": "ShvaykaD"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "diffHunk": "@@ -108,6 +114,11 @@ public TbRuleEngineProcessingDecision analyze(TbRuleEngineProcessingResult resul\n                         } catch (InterruptedException e) {\n                             throw new RuntimeException(e);\n                         }\n+                        if (multiplyPauseBetweenRetries && maxPauseBetweenRetries > 0) {\n+                            if (pauseBetweenRetries != maxPauseBetweenRetries) {\n+                                pauseBetweenRetries = Math.min(maxPauseBetweenRetries, pauseBetweenRetries * pauseBetweenRetries);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2Njc5Ng=="}, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMzYwMTU0OnYy", "diffSide": "RIGHT", "path": "common/queue/src/main/java/org/thingsboard/server/queue/settings/TbRuleEngineQueueAckStrategyConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo1MToyN1rOHNKn0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMjowMTowM1rOHNK32Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NzU2OQ==", "bodyText": "Maybe we don't need this flag at all? Just check if max-pause-between-retries > pause-between-retries to calculate this.", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483567569", "createdAt": "2020-09-04T11:51:27Z", "author": {"login": "ashvayka"}, "path": "common/queue/src/main/java/org/thingsboard/server/queue/settings/TbRuleEngineQueueAckStrategyConfiguration.java", "diffHunk": "@@ -24,5 +24,7 @@\n     private int retries;\n     private double failurePercentage;\n     private long pauseBetweenRetries;\n+    private boolean multiplyPauseBetweenRetries;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3MTY3Mw==", "bodyText": "@ashvayka Ok", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483571673", "createdAt": "2020-09-04T12:01:03Z", "author": {"login": "ShvaykaD"}, "path": "common/queue/src/main/java/org/thingsboard/server/queue/settings/TbRuleEngineQueueAckStrategyConfiguration.java", "diffHunk": "@@ -24,5 +24,7 @@\n     private int retries;\n     private double failurePercentage;\n     private long pauseBetweenRetries;\n+    private boolean multiplyPauseBetweenRetries;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NzU2OQ=="}, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1348, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}