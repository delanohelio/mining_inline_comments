{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNTE5MzMy", "number": 3565, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMTowOVrOEsCqeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMjoyN1rOEsCsWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjE2NDQxOnYy", "diffSide": "RIGHT", "path": "dao/src/main/java/org/thingsboard/server/dao/sql/query/DefaultEntityQueryRepository.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMTowOVrOHfJDyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMTowOVrOHfJDyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxNjMzMQ==", "bodyText": "Duplicated\nnotExistsPart.append(whereFilter.toString());", "url": "https://github.com/thingsboard/thingsboard/pull/3565#discussion_r502416331", "createdAt": "2020-10-09T13:11:09Z", "author": {"login": "ashvayka"}, "path": "dao/src/main/java/org/thingsboard/server/dao/sql/query/DefaultEntityQueryRepository.java", "diffHunk": "@@ -556,7 +559,9 @@ private String relationQuery(QueryContext ctx, RelationsQueryFilter entityFilter\n                     .append(\" and \")\n                     .append(\"nr.\").append(fromOrTo).append(\"_id\").append(\" = re.\").append(toOrFrom).append(\"_id\")\n                     .append(\" and \")\n-                    .append(\"nr.\").append(fromOrTo).append(\"_type\").append(\" = re.\").append(toOrFrom).append(\"_type\");\n+                    .append(\"nr.\").append(fromOrTo).append(\"_type\").append(\" = re.\").append(toOrFrom).append(\"_type\")\n+                    .append(\" and \")\n+                    .append(whereFilter.toString().replaceAll(\"re\\\\.\", \"nr\\\\.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9442cdb7805b88ae7f307b1e4a32670b6d57d06f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjE2OTIxOnYy", "diffSide": "RIGHT", "path": "dao/src/main/java/org/thingsboard/server/dao/sql/query/DefaultEntityQueryRepository.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMjoyN1rOHfJGwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxMjoyN1rOHfJGwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxNzA4OQ==", "bodyText": "This should be removed ?\n            if (!StringUtils.isEmpty(entityFilter.getRelationType())) {\n                notExistsPart.append(\" and nr.relation_type = :where_relation_type\");\n            }", "url": "https://github.com/thingsboard/thingsboard/pull/3565#discussion_r502417089", "createdAt": "2020-10-09T13:12:27Z", "author": {"login": "ashvayka"}, "path": "dao/src/main/java/org/thingsboard/server/dao/sql/query/DefaultEntityQueryRepository.java", "diffHunk": "@@ -472,10 +472,13 @@ private String entitySearchQuery(QueryContext ctx, EntitySearchQueryFilter entit\n         if (entityFilter.isFetchLastLevelOnly()) {\n             String fromOrTo = (entityFilter.getDirection().equals(EntitySearchDirection.FROM) ? \"from\" : \"to\");\n             StringBuilder notExistsPart = new StringBuilder();\n-            notExistsPart.append(\" NOT EXISTS (SELECT 1 from relation nr where \")\n+            notExistsPart.append(\" NOT EXISTS (SELECT 1 from relation nr \")\n+                    .append(whereFilter.replaceAll(\"re\\\\.\", \"nr\\\\.\"))\n+                    .append(\" and \")\n                     .append(\"nr.\").append(fromOrTo).append(\"_id\").append(\" = re.\").append(toOrFrom).append(\"_id\")\n                     .append(\" and \")\n                     .append(\"nr.\").append(fromOrTo).append(\"_type\").append(\" = re.\").append(toOrFrom).append(\"_type\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9442cdb7805b88ae7f307b1e4a32670b6d57d06f"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1332, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}