{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NzM5MTE0", "number": 3593, "title": "[3.3] Feature/attributes cache", "bodyText": "", "createdAt": "2020-10-16T10:17:00Z", "url": "https://github.com/thingsboard/thingsboard/pull/3593", "merged": true, "mergeCommit": {"oid": "467b6a06980fd84d2d2f42633ab939e4d2c575e5"}, "closed": true, "closedAt": "2021-02-22T11:30:09Z", "author": {"login": "vzikratyi-tb"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSHTDSgH2gAyNTA0NzM5MTE0OmY1ZTEzOTFjM2FkZjg1NTdlMzg1NjcwNWVhYmYzMTEwNGNiZDdhZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd8k01bgFqTU5NTE4NjA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5e1391c3adf8557e3856705eabf31104cbd7afd", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/f5e1391c3adf8557e3856705eabf31104cbd7afd", "committedDate": "2020-10-13T11:58:01Z", "message": "Use TenantCacheService interface in AttributesCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "410ced7091ee657808cd924eb02105244d5f0ac3", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/410ced7091ee657808cd924eb02105244d5f0ac3", "committedDate": "2020-10-13T13:07:53Z", "message": "Added Google cache with loader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d7e14f908343d141ef81ae5860062ea1717e88a", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/4d7e14f908343d141ef81ae5860062ea1717e88a", "committedDate": "2020-10-15T09:32:39Z", "message": "Implemented cache for attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a5e359f3f9284c38d8454001cfddc978d242ad0", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/6a5e359f3f9284c38d8454001cfddc978d242ad0", "committedDate": "2020-10-15T12:41:23Z", "message": "Merge branch 'master' into feature/attributes-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef9b80b34642bb05849f680ee69856f30b7763a6", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/ef9b80b34642bb05849f680ee69856f30b7763a6", "committedDate": "2020-10-15T13:03:20Z", "message": "Moved cache logic to separate class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b096d4ac2e895758ee701d918398c3fe98a5d3d", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/4b096d4ac2e895758ee701d918398c3fe98a5d3d", "committedDate": "2020-10-15T15:13:49Z", "message": "Updated AttributesCacheConfiguration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4d64df749efb114288fe252c0cf36ccde243e65", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/c4d64df749efb114288fe252c0cf36ccde243e65", "committedDate": "2020-10-15T15:16:25Z", "message": "Added tests for AttributesCache with google-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ca5572636f563dae05b73b980273fa9ad789a23", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/2ca5572636f563dae05b73b980273fa9ad789a23", "committedDate": "2020-10-15T15:17:51Z", "message": "Merge branch 'master' into feature/attributes-cache\n\n# Conflicts:\n#\tapplication/src/main/java/org/thingsboard/server/service/queue/TbClusterService.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57178a278dbdd5eb7dc8ae4d7188ae6502af3827", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/57178a278dbdd5eb7dc8ae4d7188ae6502af3827", "committedDate": "2020-10-16T10:02:14Z", "message": "Update cache after save/remove"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8bdf3a0a559542f27fa89d495d033b0418eea4d", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/f8bdf3a0a559542f27fa89d495d033b0418eea4d", "committedDate": "2020-10-16T10:15:34Z", "message": "Added test for CachedAttributesService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "120466202c05686d035785a495da016339929eca", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/120466202c05686d035785a495da016339929eca", "committedDate": "2020-10-16T11:00:23Z", "message": "Merge branch 'master' into feature/attributes-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4caba3e6e1560aab2fb8ea29fed89a7c687cfeb5", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/4caba3e6e1560aab2fb8ea29fed89a7c687cfeb5", "committedDate": "2020-10-16T16:03:50Z", "message": "Changed Optional to CacheEntry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "226ed6bd206cb70f454af48f1c8b4fa6cb3cca5d", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/226ed6bd206cb70f454af48f1c8b4fa6cb3cca5d", "committedDate": "2020-10-19T08:34:47Z", "message": "Merge branch 'master' into feature/attributes-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00230554b17632b737e552c7cc30cc952363a7c8", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/00230554b17632b737e552c7cc30cc952363a7c8", "committedDate": "2020-10-19T09:05:00Z", "message": "Broadcast cache updated msg to RuleEngines too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223315af6903b37c109879df6725cacde441e1b6", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/223315af6903b37c109879df6725cacde441e1b6", "committedDate": "2020-10-19T09:43:15Z", "message": "Process cache update in RuleEngines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae5254b92a80a710f527ce0792e7546a93f10a8b", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/ae5254b92a80a710f527ce0792e7546a93f10a8b", "committedDate": "2020-10-19T10:03:48Z", "message": "Made attributes cache optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5049fd6d8e5ed6ad7510abe40dc38bf930396a1d", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/5049fd6d8e5ed6ad7510abe40dc38bf930396a1d", "committedDate": "2020-10-19T10:42:26Z", "message": "Added endpoint to invalidate attributes cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "629497058d2dbc26da898a304267787fd6bea494", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/629497058d2dbc26da898a304267787fd6bea494", "committedDate": "2020-12-28T11:00:03Z", "message": "Added stats for attributesCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8248a12617121666f7fa86c3df87a315582e471", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/d8248a12617121666f7fa86c3df87a315582e471", "committedDate": "2020-12-28T11:10:09Z", "message": "Fixed bug with SysAdmin working with Tenant's attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdbe508a8ac994b9233e9c9946529b8f2476d407", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/fdbe508a8ac994b9233e9c9946529b8f2476d407", "committedDate": "2020-12-28T11:30:12Z", "message": "Merge remote-tracking branch 'upstream/develop/3.3' into feature/attributes-cache\n\n# Conflicts:\n#\tapplication/src/main/java/org/thingsboard/server/controller/AdminController.java\n#\tapplication/src/main/java/org/thingsboard/server/service/queue/DefaultTbClusterService.java\n#\tapplication/src/main/java/org/thingsboard/server/service/queue/DefaultTbCoreConsumerService.java\n#\tapplication/src/main/java/org/thingsboard/server/service/queue/DefaultTbRuleEngineConsumerService.java\n#\tapplication/src/main/java/org/thingsboard/server/service/queue/processing/AbstractConsumerService.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9904b1df50347521cdad101ed7d6c50141028a88", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/9904b1df50347521cdad101ed7d6c50141028a88", "committedDate": "2020-12-28T13:44:04Z", "message": "Fixed merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc06fb3a3766160e077800f5cb52c641b3f44203", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/fc06fb3a3766160e077800f5cb52c641b3f44203", "committedDate": "2020-12-28T13:49:20Z", "message": "Refactored and fixed AttributeCacheTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3823723c2a5a4f050a3c2f4bc1b05fa47e01f0ac", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/3823723c2a5a4f050a3c2f4bc1b05fa47e01f0ac", "committedDate": "2021-01-22T16:23:50Z", "message": "Removed .* imports for Attributes feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "151db59f261f1ebf2d327da02b2627c0f23dedd4", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/151db59f261f1ebf2d327da02b2627c0f23dedd4", "committedDate": "2021-01-26T14:29:15Z", "message": "Added Caffeine attr cache, updated caffeine version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e33b7f63575e26aee3d78f948e69f40826ed02ea", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/e33b7f63575e26aee3d78f948e69f40826ed02ea", "committedDate": "2021-01-28T13:40:57Z", "message": "Merge branch 'develop/3.3' into feature/attributes-cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d354c7d8cbfcdbd7fe8d522d09bb5dee21f987a", "author": {"user": {"login": "vzikratyi-tb", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/1d354c7d8cbfcdbd7fe8d522d09bb5dee21f987a", "committedDate": "2021-01-28T14:44:54Z", "message": "Fixed merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk1MTg2MDUx", "url": "https://github.com/thingsboard/thingsboard/pull/3593#pullrequestreview-595186051", "createdAt": "2021-02-22T10:06:58Z", "commit": {"oid": "1d354c7d8cbfcdbd7fe8d522d09bb5dee21f987a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxMDowNjo1OVrOIpP9WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxMDowNjo1OVrOIpP9WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDEyMzk5Mg==", "bodyText": "Code duplication.", "url": "https://github.com/thingsboard/thingsboard/pull/3593#discussion_r580123992", "createdAt": "2021-02-22T10:06:59Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/DefaultTbClusterService.java", "diffHunk": "@@ -306,6 +322,28 @@ private void broadcast(ComponentLifecycleMsg msg) {\n         }\n     }\n \n+    private void broadcast(AttributesCacheUpdatedMsg msg) {\n+        byte[] msgBytes = encodingService.encode(msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d354c7d8cbfcdbd7fe8d522d09bb5dee21f987a"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3255, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}