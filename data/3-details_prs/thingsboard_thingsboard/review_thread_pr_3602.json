{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODE0MTM4", "number": 3602, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwOToyOToyMlrOE3n_iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwOToyOToyMlrOE3n_iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NzYyMzc3OnYy", "diffSide": "RIGHT", "path": "application/src/main/java/org/thingsboard/server/controller/BaseController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwOToyOToyMlrOHxFL7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxODoyNToxN1rOHxZL1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyNzI0NQ==", "bodyText": "TsKvEntry also has a timestamp. The timestamp is lost in such a case. This is wrong.\nI suggest using the following format\n         [\n            {\n                \"ts\":1527863043000,\n                \"values\":{\n                    \"battery\":3.99,\n                    \"temperature\":27.05\n                }\n            },\n            {\n                \"ts\":1527863044000,\n                \"values\":{\n                    \"battery\":3.98,\n                    \"temperature\":27.06\n                }\n            }\n        ]", "url": "https://github.com/thingsboard/thingsboard/pull/3602#discussion_r521227245", "createdAt": "2020-11-11T09:29:22Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/controller/BaseController.java", "diffHunk": "@@ -775,6 +769,13 @@ public static Exception toException(Throwable error) {\n                         if (keys != null) {\n                             keys.forEach(attrsArrayNode::add);\n                         }\n+                    } else if (actionType == ActionType.TIMESERIES_UPDATED) {\n+                        List<TsKvEntry> telemetry = extractParameter(List.class, 0, additionalInfo);\n+                        if (telemetry != null) {\n+                            for (TsKvEntry tsKvEntry : telemetry) {\n+                                addKvEntry(entityNode, tsKvEntry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fc43c3bd4b1b5623397acc93bbe987e2a06381f"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU1NDkwMA==", "bodyText": "In current implementation, the condition at line 772 will be true only when method saveTelemetry() in TelemetryController was called. The timestamp is set in the same saveTelemetry() method (TelemetryController, line 425) and equals to current system time.\nSo tsKvEntry element of the list will always have timestamp here.\nTo process telemetry update according to proposed format it's necessary to add a new endpoint (to avoid API breaking changes) in TelemetryController, in addition to existing ones:\n\nPOST /api/plugins/telemetry/{entityType}/{entityId}/timeseries/{scope}\nPOST /api/plugins/telemetry/{entityType}/{entityId}/timeseries/{scope}/{ttl}\n@ashvayka should I add a new endpoint to handle the proposed format of request body?", "url": "https://github.com/thingsboard/thingsboard/pull/3602#discussion_r521554900", "createdAt": "2020-11-11T18:25:17Z", "author": {"login": "vkukhtyn"}, "path": "application/src/main/java/org/thingsboard/server/controller/BaseController.java", "diffHunk": "@@ -775,6 +769,13 @@ public static Exception toException(Throwable error) {\n                         if (keys != null) {\n                             keys.forEach(attrsArrayNode::add);\n                         }\n+                    } else if (actionType == ActionType.TIMESERIES_UPDATED) {\n+                        List<TsKvEntry> telemetry = extractParameter(List.class, 0, additionalInfo);\n+                        if (telemetry != null) {\n+                            for (TsKvEntry tsKvEntry : telemetry) {\n+                                addKvEntry(entityNode, tsKvEntry);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyNzI0NQ=="}, "originalCommit": {"oid": "0fc43c3bd4b1b5623397acc93bbe987e2a06381f"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1337, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}