{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMTUzNDkw", "number": 3501, "title": "Update knob control", "bodyText": "", "createdAt": "2020-09-21T09:13:48Z", "url": "https://github.com/thingsboard/thingsboard/pull/3501", "merged": true, "mergeCommit": {"oid": "7347230ec42b880c0ec6fa860714894771f5fdea"}, "closed": true, "closedAt": "2020-10-06T15:28:27Z", "author": {"login": "kalutkaz"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdK_awFgH2gAyNDkwMTUzNDkwOjNiMTM1YTkwNWZhNGUxMjlhMDg0YTc1MWVjNDkyOGNmODQwOTU4MjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLXy6rAFqTQ5MzQ0NDQzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b135a905fa4e129a084a751ec4928cf84095822", "author": {"user": {"login": "kalutkaz", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/3b135a905fa4e129a084a751ec4928cf84095822", "committedDate": "2020-09-21T08:49:43Z", "message": "Epdate knob control"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c", "author": {"user": {"login": "kalutkaz", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/e0bc5e4a2bca0ae03dca969e630b84286750f25c", "committedDate": "2020-09-21T09:16:19Z", "message": "Fix click function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNzk2MzM4", "url": "https://github.com/thingsboard/thingsboard/pull/3501#pullrequestreview-492796338", "createdAt": "2020-09-21T16:40:59Z", "commit": {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0MDo1OVrOHVZiFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzowMTo0NFrOHVaSCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMDQ2OA==", "bodyText": "These imports don't use", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492200468", "createdAt": "2020-09-21T16:40:59Z", "author": {"login": "vvlladd28"}, "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -25,6 +25,8 @@ import { CanvasDigitalGauge, CanvasDigitalGaugeOptions } from '@home/components/\n import * as tinycolor_ from 'tinycolor2';\n import { ResizeObserver } from '@juggle/resize-observer';\n import GenericOptions = CanvasGauges.GenericOptions;\n+import {number} from \"prop-types\";\n+import {eventTargetLegacyPatch} from \"zone.js/lib/browser/event-target-legacy\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMTQ5MA==", "bodyText": "Please formatting this code", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492211490", "createdAt": "2020-09-21T16:59:41Z", "author": {"login": "vvlladd28"}, "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -166,43 +170,52 @@ export class KnobComponent extends PageComponent implements OnInit, OnDestroy {\n \n     this.canvasBar = new CanvasDigitalGauge(canvasBarData).draw();\n \n-    this.knob.on('click', (e) => {\n-      if (this.moving) {\n-        this.moving = false;\n-        return false;\n-      }\n-      e.preventDefault();\n \n-      const offset = this.knob.offset();\n-      const center = {\n-        y : offset.top + this.knob.height()/2,\n-        x: offset.left + this.knob.width()/2\n-      };\n-      const rad2deg = 180/Math.PI;\n-      const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n \n-      const a = center.y - t.pageY;\n-      const b = center.x - t.pageX;\n-      let deg = Math.atan2(a,b)*rad2deg;\n-      if(deg < 0){\n-        deg = 360 + deg;\n-      }\n-      if (deg > this.maxDeg) {\n-        if (deg - 360 > this.minDeg) {\n-          deg = deg - 360;\n-        } else {\n+    this.knob.on('click', (e) => {\n+        if (this.moving) {\n+          this.moving = false;\n           return false;\n         }\n+        e.preventDefault();\n+\n+        const offset = this.knob.offset();\n+        const center = {\n+          y: offset.top + this.knob.height() / 2,\n+          x: offset.left + this.knob.width() / 2\n+        };\n+        const rad2deg = 180 / Math.PI;\n+        const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n+        const a = center.y - t.pageY;\n+        const b = center.x - t.pageX;\n+        let deg = Math.atan2(a, b) * rad2deg;\n+        if (deg < 0) {\n+          deg = 360 + deg;\n+        }\n+        if (deg > this.maxDeg) {\n+          if (deg - 360 > this.minDeg) {\n+            deg = deg - 360;\n+          } else {\n+            return false;\n+          }\n+        }\n+        this.currentDeg = deg;\n+        this.lastDeg = deg;\n+        this.knobTopPointerContainer.css('transform', 'rotate(' + (this.currentDeg) + 'deg)');\n+        this.turn(this.degreeToRatio(this.currentDeg));\n+        this.rotation = this.currentDeg;\n+        this.startDeg = -1;\n+        this.rpcUpdateValue(this.newValue);\n+    });\n+\n+    $(document).on('mouseup touchend', (e) => {\n+      if(this.newValue !== this.rpcValue && this.moving) {\n+        this.rpcUpdateValue(this.newValue);\n       }\n-      this.currentDeg = deg;\n-      this.lastDeg = deg;\n-      this.knobTopPointerContainer.css('transform','rotate('+(this.currentDeg)+'deg)');\n-      this.turn(this.degreeToRatio(this.currentDeg));\n-      this.rotation = this.currentDeg;\n-      this.startDeg = -1;\n     });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMjc0NQ==", "bodyText": "You may need to move this code to this.knob.on('mousedown touchstart'", "url": "https://github.com/thingsboard/thingsboard/pull/3501#discussion_r492212745", "createdAt": "2020-09-21T17:01:44Z", "author": {"login": "vvlladd28"}, "path": "ui-ngx/src/app/modules/home/components/widget/lib/rpc/knob.component.ts", "diffHunk": "@@ -166,43 +170,52 @@ export class KnobComponent extends PageComponent implements OnInit, OnDestroy {\n \n     this.canvasBar = new CanvasDigitalGauge(canvasBarData).draw();\n \n-    this.knob.on('click', (e) => {\n-      if (this.moving) {\n-        this.moving = false;\n-        return false;\n-      }\n-      e.preventDefault();\n \n-      const offset = this.knob.offset();\n-      const center = {\n-        y : offset.top + this.knob.height()/2,\n-        x: offset.left + this.knob.width()/2\n-      };\n-      const rad2deg = 180/Math.PI;\n-      const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n \n-      const a = center.y - t.pageY;\n-      const b = center.x - t.pageX;\n-      let deg = Math.atan2(a,b)*rad2deg;\n-      if(deg < 0){\n-        deg = 360 + deg;\n-      }\n-      if (deg > this.maxDeg) {\n-        if (deg - 360 > this.minDeg) {\n-          deg = deg - 360;\n-        } else {\n+    this.knob.on('click', (e) => {\n+        if (this.moving) {\n+          this.moving = false;\n           return false;\n         }\n+        e.preventDefault();\n+\n+        const offset = this.knob.offset();\n+        const center = {\n+          y: offset.top + this.knob.height() / 2,\n+          x: offset.left + this.knob.width() / 2\n+        };\n+        const rad2deg = 180 / Math.PI;\n+        const t: Touch = ((e.originalEvent as any).touches) ? (e.originalEvent as any).touches[0] : e;\n+        const a = center.y - t.pageY;\n+        const b = center.x - t.pageX;\n+        let deg = Math.atan2(a, b) * rad2deg;\n+        if (deg < 0) {\n+          deg = 360 + deg;\n+        }\n+        if (deg > this.maxDeg) {\n+          if (deg - 360 > this.minDeg) {\n+            deg = deg - 360;\n+          } else {\n+            return false;\n+          }\n+        }\n+        this.currentDeg = deg;\n+        this.lastDeg = deg;\n+        this.knobTopPointerContainer.css('transform', 'rotate(' + (this.currentDeg) + 'deg)');\n+        this.turn(this.degreeToRatio(this.currentDeg));\n+        this.rotation = this.currentDeg;\n+        this.startDeg = -1;\n+        this.rpcUpdateValue(this.newValue);\n+    });\n+\n+    $(document).on('mouseup touchend', (e) => {\n+      if(this.newValue !== this.rpcValue && this.moving) {\n+        this.rpcUpdateValue(this.newValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc5e4a2bca0ae03dca969e630b84286750f25c"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b915936487771186da1e3d4ecba3d3a7d091898", "author": {"user": {"login": "kalutkaz", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/2b915936487771186da1e3d4ecba3d3a7d091898", "committedDate": "2020-09-22T09:32:14Z", "message": "Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf386c7a790b85fdcbf8ae67521d8925d5c41d85", "author": {"user": {"login": "kalutkaz", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/bf386c7a790b85fdcbf8ae67521d8925d5c41d85", "committedDate": "2020-09-22T09:45:11Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90fbdd5abd7347568fc8882995b637b96533095", "author": {"user": {"login": "kalutkaz", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/a90fbdd5abd7347568fc8882995b637b96533095", "committedDate": "2020-09-22T11:28:37Z", "message": "Change 'mouseup'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNDQ0NDM4", "url": "https://github.com/thingsboard/thingsboard/pull/3501#pullrequestreview-493444438", "createdAt": "2020-09-22T13:13:50Z", "commit": {"oid": "a90fbdd5abd7347568fc8882995b637b96533095"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3277, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}