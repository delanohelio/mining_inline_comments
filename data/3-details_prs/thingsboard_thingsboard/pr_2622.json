{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMjU4NTE4", "number": 2622, "title": "[2.5] kafka topic settings", "bodyText": "", "createdAt": "2020-04-14T15:33:29Z", "url": "https://github.com/thingsboard/thingsboard/pull/2622", "merged": true, "mergeCommit": {"oid": "d654e09d6a52c0a0d038ac176f36214c0dce25b2"}, "closed": true, "closedAt": "2020-04-15T14:47:47Z", "author": {"login": "YevhenBondarenko"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXlFApAH2gAyNDAzMjU4NTE4OjBhYWM1Y2I4MDA4OGI1OTQ5MzM4ZjY3NjBiZWMyNTQzZTMxZGRhNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX1HyggH2gAyNDAzMjU4NTE4OjRhZjA1OWVkMTY1ODU2NGM3ZmQ5MWRjZjZlNjUwNjBjZTk3MTkyNWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0aac5cb80088b5949338f6760bec2543e31dda50", "author": {"user": {"login": "YevhenBondarenko", "name": "Yevhen Bondarenko"}}, "url": "https://github.com/thingsboard/thingsboard/commit/0aac5cb80088b5949338f6760bec2543e31dda50", "committedDate": "2020-04-14T15:18:18Z", "message": "added topic-properties to kafka queue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd560b9b8cd7f627c271bd2425e6cf74f5f71d9", "author": {"user": {"login": "YevhenBondarenko", "name": "Yevhen Bondarenko"}}, "url": "https://github.com/thingsboard/thingsboard/commit/dfd560b9b8cd7f627c271bd2425e6cf74f5f71d9", "committedDate": "2020-04-14T15:32:27Z", "message": "added topic-properties to kafka queue to transport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be", "author": {"user": {"login": "YevhenBondarenko", "name": "Yevhen Bondarenko"}}, "url": "https://github.com/thingsboard/thingsboard/commit/f04b4bbb8b56cc26e75968d7572e9e486b9b09be", "committedDate": "2020-04-14T15:36:19Z", "message": "Merge branch 'develop/2.5' of https://github.com/thingsboard/thingsboard into develop/2.5-kafka-topic-settings\n\n# Conflicts:\n#\tcommon/queue/src/main/java/org/thingsboard/server/queue/kafka/TBKafkaAdmin.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTI2MTU4", "url": "https://github.com/thingsboard/thingsboard/pull/2622#pullrequestreview-393526158", "createdAt": "2020-04-15T07:38:31Z", "commit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODozMlrOGFtdog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODozMlrOGFtdog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDkzMA==", "bodyText": "Code duplication.. Maybe create abstract class?", "url": "https://github.com/thingsboard/thingsboard/pull/2622#discussion_r408640930", "createdAt": "2020-04-15T07:38:32Z", "author": {"login": "ashvayka"}, "path": "common/queue/src/main/java/org/thingsboard/server/queue/kafka/NotificationsTbKafkaTopicConfig.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * Copyright \u00a9 2016-2020 The Thingsboard Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.thingsboard.server.queue.kafka;\n+\n+import lombok.Data;\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+@Data\n+@Component(\"notificationsTbKafkaTopicConfig\")\n+@ConfigurationProperties(prefix = \"queue.kafka.topic-properties.notifications\")\n+public class NotificationsTbKafkaTopicConfig implements TbKafkaTopicConfig {\n+\n+    private List<TbKafkaProperty> properties;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTI3Njc3", "url": "https://github.com/thingsboard/thingsboard/pull/2622#pullrequestreview-393527677", "createdAt": "2020-04-15T07:40:51Z", "commit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0MDo1MVrOGFtiyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0MDo1MVrOGFtiyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MjI1MA==", "bodyText": "why not ConcurrentHashSet? It asks to eat?", "url": "https://github.com/thingsboard/thingsboard/pull/2622#discussion_r408642250", "createdAt": "2020-04-15T07:40:51Z", "author": {"login": "ashvayka"}, "path": "common/queue/src/main/java/org/thingsboard/server/queue/kafka/TBKafkaProducerTemplate.java", "diffHunk": "@@ -46,8 +49,12 @@\n     @Getter\n     private final TbKafkaSettings settings;\n \n+    private final TbQueueAdmin admin;\n+\n+    private final Set<TopicPartitionInfo> topics;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTI4ODEx", "url": "https://github.com/thingsboard/thingsboard/pull/2622#pullrequestreview-393528811", "createdAt": "2020-04-15T07:42:38Z", "commit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0MjozOFrOGFtmWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0MjozOFrOGFtmWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MzE2MA==", "bodyText": "There are also tb-http-transport.yml and tb-coap-transport.yml", "url": "https://github.com/thingsboard/thingsboard/pull/2622#discussion_r408643160", "createdAt": "2020-04-15T07:42:38Z", "author": {"login": "ashvayka"}, "path": "transport/mqtt/src/main/resources/tb-mqtt-transport.yml", "diffHunk": "@@ -81,6 +81,48 @@ queue:\n     batch.size: \"${TB_KAFKA_BATCH_SIZE:16384}\"\n     linger.ms: \"${TB_KAFKA_LINGER_MS:1}\"\n     buffer.memory: \"${TB_BUFFER_MEMORY:33554432}\"\n+    replication_factor: \"${TB_QUEUE_KAFKA_REPLICATION_FACTOR:1}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTMxNDEx", "url": "https://github.com/thingsboard/thingsboard/pull/2622#pullrequestreview-393531411", "createdAt": "2020-04-15T07:46:23Z", "commit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0NjoyM1rOGFtvAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo0NjoyM1rOGFtvAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0NTM3Ng==", "bodyText": "This Definition appears to be \"huge\" waste of space in the config. Maybe something like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  rule-engine:\n          \n          \n            \n                  rule-engine: \"${TB_QUEUE_KAFKA_RE_TOPIC_PROPERTIES:retention.ms:604800000;segment.bytes:26214400;retention.bytes:1048576000}\"", "url": "https://github.com/thingsboard/thingsboard/pull/2622#discussion_r408645376", "createdAt": "2020-04-15T07:46:23Z", "author": {"login": "ashvayka"}, "path": "application/src/main/resources/thingsboard.yml", "diffHunk": "@@ -521,6 +521,48 @@ queue:\n     batch.size: \"${TB_KAFKA_BATCH_SIZE:16384}\"\n     linger.ms: \"${TB_KAFKA_LINGER_MS:1}\"\n     buffer.memory: \"${TB_BUFFER_MEMORY:33554432}\"\n+    replication_factor: \"${TB_QUEUE_KAFKA_REPLICATION_FACTOR:1}\"\n+    topic-properties:\n+      rule-engine:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b4bbb8b56cc26e75968d7572e9e486b9b09be"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4af059ed1658564c7fd91dcf6e65060ce971925f", "author": {"user": {"login": "YevhenBondarenko", "name": "Yevhen Bondarenko"}}, "url": "https://github.com/thingsboard/thingsboard/commit/4af059ed1658564c7fd91dcf6e65060ce971925f", "committedDate": "2020-04-15T09:59:49Z", "message": "kafka topic settings improvements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3300, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}