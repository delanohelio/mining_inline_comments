{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MTA3OTAy", "number": 3405, "title": "[2.5.5] Improvements/queue reprocessing strategy", "bodyText": "", "createdAt": "2020-09-01T14:08:22Z", "url": "https://github.com/thingsboard/thingsboard/pull/3405", "merged": true, "mergeCommit": {"oid": "7604b78f0e0b5df6b9810f26dec60599a98eaf7d"}, "closed": true, "closedAt": "2020-09-16T09:08:45Z", "author": {"login": "ShvaykaD"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEnNP3AH2gAyNDc3MTA3OTAyOmI5M2YzZDE4YzA0OWZmOWM4M2EwMjc4ZTk3NWY1YmEwMTg5NDhkZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFmRRhgH2gAyNDc3MTA3OTAyOjNhMTlkMmM4NjEzMzNkZGE2NDE5OGVkNDQzZGM5N2YzYWY1OWY1YTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b93f3d18c049ff9c83a0278e975f5ba018948dfc", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/b93f3d18c049ff9c83a0278e975f5ba018948dfc", "committedDate": "2020-09-01T13:13:42Z", "message": "added ability to use exp-pause-between-retries on queue msgs reprocessing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a1c6593e09d818f6f0369519893f18bea982111", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/6a1c6593e09d818f6f0369519893f18bea982111", "committedDate": "2020-09-01T14:06:50Z", "message": "change the defaults"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f", "committedDate": "2020-09-03T14:04:52Z", "message": "changed logic to multiplication pause"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTg1ODQz", "url": "https://github.com/thingsboard/thingsboard/pull/3405#pullrequestreview-482585843", "createdAt": "2020-09-04T11:48:52Z", "commit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0ODo1MlrOHNKjbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0ODo1MlrOHNKjbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NjQ0NA==", "bodyText": "you can add this to previous if or remove completely.", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483566444", "createdAt": "2020-09-04T11:48:52Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "diffHunk": "@@ -108,6 +114,11 @@ public TbRuleEngineProcessingDecision analyze(TbRuleEngineProcessingResult resul\n                         } catch (InterruptedException e) {\n                             throw new RuntimeException(e);\n                         }\n+                        if (multiplyPauseBetweenRetries && maxPauseBetweenRetries > 0) {\n+                            if (pauseBetweenRetries != maxPauseBetweenRetries) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTg2MjY1", "url": "https://github.com/thingsboard/thingsboard/pull/3405#pullrequestreview-482586265", "createdAt": "2020-09-04T11:49:45Z", "commit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0OTo0NVrOHNKkzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo0OTo0NVrOHNKkzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2Njc5Ng==", "bodyText": "Maybe\npauseBetweenRetries = Math.min(maxPauseBetweenRetries, pauseBetweenRetries * 2);\n?", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483566796", "createdAt": "2020-09-04T11:49:45Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/queue/processing/TbRuleEngineProcessingStrategyFactory.java", "diffHunk": "@@ -108,6 +114,11 @@ public TbRuleEngineProcessingDecision analyze(TbRuleEngineProcessingResult resul\n                         } catch (InterruptedException e) {\n                             throw new RuntimeException(e);\n                         }\n+                        if (multiplyPauseBetweenRetries && maxPauseBetweenRetries > 0) {\n+                            if (pauseBetweenRetries != maxPauseBetweenRetries) {\n+                                pauseBetweenRetries = Math.min(maxPauseBetweenRetries, pauseBetweenRetries * pauseBetweenRetries);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTg3MTg1", "url": "https://github.com/thingsboard/thingsboard/pull/3405#pullrequestreview-482587185", "createdAt": "2020-09-04T11:51:27Z", "commit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo1MToyN1rOHNKn0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMTo1MToyN1rOHNKn0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NzU2OQ==", "bodyText": "Maybe we don't need this flag at all? Just check if max-pause-between-retries > pause-between-retries to calculate this.", "url": "https://github.com/thingsboard/thingsboard/pull/3405#discussion_r483567569", "createdAt": "2020-09-04T11:51:27Z", "author": {"login": "ashvayka"}, "path": "common/queue/src/main/java/org/thingsboard/server/queue/settings/TbRuleEngineQueueAckStrategyConfiguration.java", "diffHunk": "@@ -24,5 +24,7 @@\n     private int retries;\n     private double failurePercentage;\n     private long pauseBetweenRetries;\n+    private boolean multiplyPauseBetweenRetries;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b82c2d0537d1ab6f1ae501ecac9f460b58e27f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aff0692ae0510117275fdc6a367e55d46d3b628", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/9aff0692ae0510117275fdc6a367e55d46d3b628", "committedDate": "2020-09-04T12:47:11Z", "message": "clean up code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2a0f51050ce6c7600681da72056f6d003256af", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/ac2a0f51050ce6c7600681da72056f6d003256af", "committedDate": "2020-09-04T13:13:29Z", "message": "removed unnecessary flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70021e7a61be4c9024dc77d30a0dfb66fbd1b45a", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/70021e7a61be4c9024dc77d30a0dfb66fbd1b45a", "committedDate": "2020-09-04T13:50:50Z", "message": "changed env variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a19d2c861333dda64198ed443dc97f3af59f5a2", "author": {"user": {"login": "ShvaykaD", "name": null}}, "url": "https://github.com/thingsboard/thingsboard/commit/3a19d2c861333dda64198ed443dc97f3af59f5a2", "committedDate": "2020-09-04T14:42:07Z", "message": "changed defaults max-pause-between-retries params"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3270, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}