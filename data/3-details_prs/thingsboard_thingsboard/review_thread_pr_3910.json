{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTU5ODY0", "number": 3910, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMToyMDoxMlrOFLpG_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMjoyOTo1NVrOFLqylA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NzUyMTg5OnYy", "diffSide": "RIGHT", "path": "application/src/main/java/org/thingsboard/server/service/script/RuleNodeJsScriptEngine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMToyMDoxMlrOIO673Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMToyMDoxMlrOIO673Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjUxNjU3Mw==", "bodyText": "json.size()", "url": "https://github.com/thingsboard/thingsboard/pull/3910#discussion_r552516573", "createdAt": "2021-01-06T11:20:12Z", "author": {"login": "ashvayka"}, "path": "application/src/main/java/org/thingsboard/server/service/script/RuleNodeJsScriptEngine.java", "diffHunk": "@@ -116,14 +118,19 @@ public TbMsg executeUpdate(TbMsg msg) throws ScriptException {\n     }\n \n     @Override\n-    public ListenableFuture<TbMsg> executeUpdateAsync(TbMsg msg) {\n+    public ListenableFuture<List<TbMsg>> executeUpdateAsync(TbMsg msg) {\n         ListenableFuture<JsonNode> result = executeScriptAsync(msg);\n         return Futures.transformAsync(result, json -> {\n-            if (!json.isObject()) {\n+            if (json.isObject()) {\n+                return Futures.immediateFuture(Collections.singletonList(unbindMsg(json, msg)));\n+            } else if (json.isArray()){\n+                List<TbMsg> res = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9399d4ed402a018caadbb6c4bb8d38ee40a538f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3Nzc5NzMyOnYy", "diffSide": "RIGHT", "path": "rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/transform/TbAbstractTransformNode.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMjoyOTo1NVrOIO9oIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMjoyOTo1NVrOIO9oIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjU2MDY3Mw==", "bodyText": "ctx.ack", "url": "https://github.com/thingsboard/thingsboard/pull/3910#discussion_r552560673", "createdAt": "2021-01-06T12:29:55Z", "author": {"login": "ashvayka"}, "path": "rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/transform/TbAbstractTransformNode.java", "diffHunk": "@@ -61,7 +62,20 @@ protected void transformSuccess(TbContext ctx, TbMsg msg, TbMsg m) {\n         }\n     }\n \n-    protected abstract ListenableFuture<TbMsg> transform(TbContext ctx, TbMsg msg);\n+    protected void transformSuccess(TbContext ctx, TbMsg msg, List<TbMsg> msgs) {\n+        if (msgs != null && !msgs.isEmpty()) {\n+            if (msgs.size() == 1) {\n+                ctx.tellSuccess(msgs.get(0));\n+            } else {\n+                TbMsgCallbackWrapper wrapper = new MultipleTbMsgsCallbackWrapper(msgs.size(), msg.getCallback());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f873fdc678d05634e0f4716acc8f21c5c61458a"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1306, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}