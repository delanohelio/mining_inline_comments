{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTA1NzIw", "number": 7754, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1MDo1MVrODW82rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNjozNFrODq1rcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MzkyMzAyOnYy", "diffSide": "RIGHT", "path": "assignment/tool/src/webapp/vm/assignment/chef_assignments_instructor_grading_submission.vm", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1MDo1MVrOFb__rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1MDo1MVrOFb__rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwNDM2Ng==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7754#discussion_r364904366", "createdAt": "2020-01-09T18:50:51Z", "author": {"login": "accesslint"}, "path": "assignment/tool/src/webapp/vm/assignment/chef_assignments_instructor_grading_submission.vm", "diffHunk": "@@ -680,7 +680,55 @@\n             #else\n                 #set($resubmitStyle=\"display:none\")\n             #end\n-            <div class=\"form-group\" id=\"tempAllowRes\" #if ($submissionType == 4) style=\"display:none\"#end>\n+  ##decide whether to show the Extension options\n+            #if($!displayExtensionOptions && $submissionType != 4)\n+                #set($extensionStyle=\"display:block\")\n+                #set($resubmitVisibility=\"display:none\")\n+            #else\n+                #set($extensionStyle=\"display:none\")\n+                #if($submissionType != 4)\n+                    #set($resubmitVisibility=\"display:block\")\n+                #else\n+                    #set($resubmitVisibility=\"display:none\")\n+                #end\n+            #end\n+\n+            <div class=\"form-group\" id=\"allowExtensionForm\" style=\"$extensionStyle\">\n+                <input type=\"checkbox\" id=\"allowExtensionToggle\" name=\"allowExtensionToggle\"\n+                    #if($extensionCloseTime && $submissionType != 4)\n+                       checked=\"checked\"\n+                    #end\n+                    onclick=\"if(checked){document.getElementById('allowExtensionTime').style.display = 'block';ASN.resizeFrame();}else{document.getElementById('allowExtensionTime').style.display = 'none';}\"\n+                />\n+                <label for=\"allowExtensionToggle\" >$tlang.getString(\"allowExtension\")</label>\n+                <label class=\"text-warning\" >$tlang.getString(\"allowExtensionCaption\")</label>\n+                <div id=\"allowExtensionTime\"\n+                    #if($extensionCloseTime && $submissionType != 4)\n+                        style=\"display: block\"\n+                    #else\n+                        style=\"display: none\"\n+                    #end\n+                >\n+                    <label >$tlang.getString(\"gen.acesubunt\")</label>\n+                    <input type=\"text\" id=\"allowExtensionDate\" name=\"allowExtensionDate\" class=\"datepicker\" value=\"\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f9db210721b8708d5b0c2113129d11960584518"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQ2MjU3OnYy", "diffSide": "RIGHT", "path": "assignment/tool/src/java/org/sakaiproject/assignment/tool/AssignmentAction.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToxNjozNFrOF61MuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0yOVQxNDo1Mjo1OVrOKtUC5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMzMzNw==", "bodyText": "Is it possible to add the AssignmentConstants.ALLOW_EXTENSION_CLOSETIME as a parameter vs adding to the session state?\nWere try avoid adding anything new to the session state, as it's a bad pattern.", "url": "https://github.com/sakaiproject/sakai/pull/7754#discussion_r397233337", "createdAt": "2020-03-24T15:16:34Z", "author": {"login": "ern"}, "path": "assignment/tool/src/java/org/sakaiproject/assignment/tool/AssignmentAction.java", "diffHunk": "@@ -13366,6 +13426,34 @@ public void doModel_answer(RunData data) {\n         }\n     }\n \n+    private void assignment_extension_option_into_context(Context context, SessionState state){\n+        String allowExtensionTimeString = null;\n+        if (state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME) != null){\n+            allowExtensionTimeString = (String) state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME);\n+            Instant extensionCloseTime = Instant.ofEpochMilli(Long.parseLong(allowExtensionTimeString));\n+            context.put(\"extensionCloseTime\", assignmentService.getUsersLocalDateTimeString(extensionCloseTime));\n+        }\n+        putTimePropertiesInContext(context, state, \"Extension\", ALLOW_EXTENSION_CLOSEMONTH, ALLOW_EXTENSION_CLOSEDAY, ALLOW_EXTENSION_CLOSEYEAR, ALLOW_EXTENSION_CLOSEHOUR, ALLOW_EXTENSION_CLOSEMIN);\n+    }\n+\n+    private void assignment_extension_option_into_state(Assignment a, AssignmentSubmission s, SessionState state){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22fdcdc735581888bef494a2ab278e452b512453"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM3MDU5Nw==", "bodyText": "Sorry, missed this message. I'm sure this doesn't need to be added to the session state. Myself or Joe will take a look at this as soon as possible.", "url": "https://github.com/sakaiproject/sakai/pull/7754#discussion_r399370597", "createdAt": "2020-03-27T16:00:30Z", "author": {"login": "davidpbauer"}, "path": "assignment/tool/src/java/org/sakaiproject/assignment/tool/AssignmentAction.java", "diffHunk": "@@ -13366,6 +13426,34 @@ public void doModel_answer(RunData data) {\n         }\n     }\n \n+    private void assignment_extension_option_into_context(Context context, SessionState state){\n+        String allowExtensionTimeString = null;\n+        if (state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME) != null){\n+            allowExtensionTimeString = (String) state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME);\n+            Instant extensionCloseTime = Instant.ofEpochMilli(Long.parseLong(allowExtensionTimeString));\n+            context.put(\"extensionCloseTime\", assignmentService.getUsersLocalDateTimeString(extensionCloseTime));\n+        }\n+        putTimePropertiesInContext(context, state, \"Extension\", ALLOW_EXTENSION_CLOSEMONTH, ALLOW_EXTENSION_CLOSEDAY, ALLOW_EXTENSION_CLOSEYEAR, ALLOW_EXTENSION_CLOSEHOUR, ALLOW_EXTENSION_CLOSEMIN);\n+    }\n+\n+    private void assignment_extension_option_into_state(Assignment a, AssignmentSubmission s, SessionState state){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMzMzNw=="}, "originalCommit": {"oid": "22fdcdc735581888bef494a2ab278e452b512453"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxMDAzMw==", "bodyText": "Hey Earle. I finally got around to taking a look at this today. It looks like the extension feature was written to match the existing pattern that resubmission uses. Would it make sense to leave this as it's written and open a new ticket to refactor both?", "url": "https://github.com/sakaiproject/sakai/pull/7754#discussion_r410410033", "createdAt": "2020-04-17T18:52:03Z", "author": {"login": "davidpbauer"}, "path": "assignment/tool/src/java/org/sakaiproject/assignment/tool/AssignmentAction.java", "diffHunk": "@@ -13366,6 +13426,34 @@ public void doModel_answer(RunData data) {\n         }\n     }\n \n+    private void assignment_extension_option_into_context(Context context, SessionState state){\n+        String allowExtensionTimeString = null;\n+        if (state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME) != null){\n+            allowExtensionTimeString = (String) state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME);\n+            Instant extensionCloseTime = Instant.ofEpochMilli(Long.parseLong(allowExtensionTimeString));\n+            context.put(\"extensionCloseTime\", assignmentService.getUsersLocalDateTimeString(extensionCloseTime));\n+        }\n+        putTimePropertiesInContext(context, state, \"Extension\", ALLOW_EXTENSION_CLOSEMONTH, ALLOW_EXTENSION_CLOSEDAY, ALLOW_EXTENSION_CLOSEYEAR, ALLOW_EXTENSION_CLOSEHOUR, ALLOW_EXTENSION_CLOSEMIN);\n+    }\n+\n+    private void assignment_extension_option_into_state(Assignment a, AssignmentSubmission s, SessionState state){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMzMzNw=="}, "originalCommit": {"oid": "22fdcdc735581888bef494a2ab278e452b512453"}, "originalPosition": 217}, {"id": "PRRC_kwDOAbQ-jc4q1QLn", "bodyText": "yep", "url": "https://github.com/sakaiproject/sakai/pull/7754#discussion_r718602983", "createdAt": "2021-09-29T14:52:59Z", "author": {"login": "ern"}, "path": "assignment/tool/src/java/org/sakaiproject/assignment/tool/AssignmentAction.java", "diffHunk": "@@ -13366,6 +13426,34 @@ public void doModel_answer(RunData data) {\n         }\n     }\n \n+    private void assignment_extension_option_into_context(Context context, SessionState state){\n+        String allowExtensionTimeString = null;\n+        if (state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME) != null){\n+            allowExtensionTimeString = (String) state.getAttribute(AssignmentConstants.ALLOW_EXTENSION_CLOSETIME);\n+            Instant extensionCloseTime = Instant.ofEpochMilli(Long.parseLong(allowExtensionTimeString));\n+            context.put(\"extensionCloseTime\", assignmentService.getUsersLocalDateTimeString(extensionCloseTime));\n+        }\n+        putTimePropertiesInContext(context, state, \"Extension\", ALLOW_EXTENSION_CLOSEMONTH, ALLOW_EXTENSION_CLOSEDAY, ALLOW_EXTENSION_CLOSEYEAR, ALLOW_EXTENSION_CLOSEHOUR, ALLOW_EXTENSION_CLOSEMIN);\n+    }\n+\n+    private void assignment_extension_option_into_state(Assignment a, AssignmentSubmission s, SessionState state){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMzMzNw=="}, "originalCommit": {"oid": "22fdcdc735581888bef494a2ab278e452b512453"}, "originalPosition": 217}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2847, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}