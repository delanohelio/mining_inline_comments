{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNTA3Mzk1", "number": 8249, "title": "SAK-43698 - Initial MVP of tool keyset URL", "bodyText": "This is the first of several commits to the branch.   This is MVP of the feature. The next branches will pretty up the UI bits.", "createdAt": "2020-05-26T22:58:16Z", "url": "https://github.com/sakaiproject/sakai/pull/8249", "merged": true, "mergeCommit": {"oid": "34ee34fe756a007c223c627567e20d08afa93396"}, "closed": true, "closedAt": "2020-05-29T00:26:33Z", "author": {"login": "csev"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclMxVxAH2gAyNDIzNTA3Mzk1OmY0M2RiOTJlN2NiYTQzNzQ1MTQ0YTkyOWExOTgxMjE2ZmNjZGVmYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl21CUgH2gAyNDIzNTA3Mzk1OjAwNjcyN2Y0NzI1ZDAwOTdkYjFiMDEyYTY2NTMzN2QxOWE0NjhiMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/f43db92e7cba43745144a929a1981216fccdefb6", "committedDate": "2020-05-26T22:54:02Z", "message": "SAK-43698 - Initial MVP of tool keyset URL\n\nThis still needs some testing (Deep Link)\nand a pass through the Admin UI and to\nturn off the auto creation of the public/private\ntool pair when there is a keyset.  Make it so\nnon-keyset support can fade off into the sunset."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzQ1NzA5", "url": "https://github.com/sakaiproject/sakai/pull/8249#pullrequestreview-418745709", "createdAt": "2020-05-26T23:28:42Z", "commit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyODo0MlrOGazn5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyODo0MlrOGazn5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2MTk1Ng==", "bodyText": "just delete this code?", "url": "https://github.com/sakaiproject/sakai/pull/8249#discussion_r430761956", "createdAt": "2020-05-26T23:28:42Z", "author": {"login": "ottenhoff"}, "path": "basiclti/basiclti-common/src/java/org/sakaiproject/basiclti/util/SakaiBLTIUtil.java", "diffHunk": "@@ -1092,16 +1133,20 @@ public static DeepLinkResponse getDeepLinkFromToken(Map<String, Object> tool, St\n \t\t\tif (lti_errorlog != null) {\n \t\t\t\tlog.warn(lti_errorlog);\n \t\t\t}\n-\n+/*\n+\t\t\t// TODO: Remove this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzQ1Nzgw", "url": "https://github.com/sakaiproject/sakai/pull/8249#pullrequestreview-418745780", "createdAt": "2020-05-26T23:28:57Z", "commit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyODo1N1rOGazoMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyODo1N1rOGazoMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2MjAzMg==", "bodyText": "indentation looks odd here", "url": "https://github.com/sakaiproject/sakai/pull/8249#discussion_r430762032", "createdAt": "2020-05-26T23:28:57Z", "author": {"login": "ottenhoff"}, "path": "basiclti/basiclti-common/src/java/org/sakaiproject/basiclti/util/SakaiBLTIUtil.java", "diffHunk": "@@ -1092,16 +1133,20 @@ public static DeepLinkResponse getDeepLinkFromToken(Map<String, Object> tool, St\n \t\t\tif (lti_errorlog != null) {\n \t\t\t\tlog.warn(lti_errorlog);\n \t\t\t}\n-\n+/*\n+\t\t\t// TODO: Remove this\n \t\t\tString publicKeyStr = (String) tool.get(LTIService.LTI13_TOOL_PUBLIC);\n \t\t\tif (publicKeyStr == null) {\n \t\t\t\tthrow new RuntimeException(\"Could not find tool public key\");\n \t\t\t}\n \n-\t\t\tKey publicKey = LTI13Util.string2PublicKey(publicKeyStr);\n+\t\t\tKey publicKey = string2PublicKey(publicKeyStr);\n \t\t\tif (publicKey == null) {\n \t\t\t\tthrow new RuntimeException(\"Could not deserialize tool public key\");\n \t\t\t}\n+*/\n+\t\t\t// May throw a RunTimeException on our behalf :)\n+\t\t    Key publicKey = SakaiBLTIUtil.getPublicKey(tool, id_token);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzQ2MDUy", "url": "https://github.com/sakaiproject/sakai/pull/8249#pullrequestreview-418746052", "createdAt": "2020-05-26T23:29:43Z", "commit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyOTo0M1rOGazpFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzoyOTo0M1rOGazpFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2MjI2Mg==", "bodyText": "tabs/spaces", "url": "https://github.com/sakaiproject/sakai/pull/8249#discussion_r430762262", "createdAt": "2020-05-26T23:29:43Z", "author": {"login": "ottenhoff"}, "path": "basiclti/tsugi-util/src/java/org/tsugi/lti13/LTI13KeySetUtil.java", "diffHunk": "@@ -75,4 +77,29 @@ public static String getKeySetJSON(RSAPublicKey key)\n \t\treturn getKeySetJSON(keys);\n \t}\n \n+\tpublic static RSAPublicKey getKeyFromKeySet(String kid, String url) \n+\t\tthrows java.text.ParseException, com.nimbusds.jose.JOSEException, java.net.MalformedURLException, java.io.IOException\n+\t{\n+\t\tcom.nimbusds.jose.jwk.JWKSet localKeys = com.nimbusds.jose.jwk.JWKSet.load(new java.net.URL(url));\n+\n+        com.nimbusds.jose.jwk.RSAKey nimbusPublic = (com.nimbusds.jose.jwk.RSAKey) localKeys.getKeyByKeyId(kid);\n+\n+        RSAPublicKey publicKey = nimbusPublic.toRSAPublicKey();\n+        java.security.interfaces.RSAKey rsaPublicKey = (java.security.interfaces.RSAKey) publicKey;\n+\n+\t\treturn publicKey;\n+\t}\n+\n+\tpublic static RSAPublicKey getKeyFromKeySetString(String kid, String json) \n+\t\tthrows java.text.ParseException, com.nimbusds.jose.JOSEException\n+\t{\n+\t\tcom.nimbusds.jose.jwk.JWKSet localKeys = com.nimbusds.jose.jwk.JWKSet.parse(json);\n+\n+        com.nimbusds.jose.jwk.RSAKey nimbusPublic = (com.nimbusds.jose.jwk.RSAKey) localKeys.getKeyByKeyId(kid);\n+\n+        RSAPublicKey publicKey = nimbusPublic.toRSAPublicKey();\n+        java.security.interfaces.RSAKey rsaPublicKey = (java.security.interfaces.RSAKey) publicKey;\n+\n+\t\treturn publicKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f43db92e7cba43745144a929a1981216fccdefb6"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75908821b561f3b8900552806d06d619facf30ec", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/75908821b561f3b8900552806d06d619facf30ec", "committedDate": "2020-05-28T04:32:08Z", "message": "SAK-43698 - Add UI bits and auto updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da4bf5174ba6bd7a3d2b841ebcb7c7881b17683e", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/da4bf5174ba6bd7a3d2b841ebcb7c7881b17683e", "committedDate": "2020-05-28T04:38:29Z", "message": "SAK-43698 - Cleanup indentation and remove old code\n\nThanks Sam."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3407ca668e77d3e0b28e47136c6c2748cd55aa01", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/3407ca668e77d3e0b28e47136c6c2748cd55aa01", "committedDate": "2020-05-28T13:30:20Z", "message": "SAK-43698 - Cleanup the UI, show issuer, cleanup codacy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMTI3ODA2", "url": "https://github.com/sakaiproject/sakai/pull/8249#pullrequestreview-420127806", "createdAt": "2020-05-28T13:51:19Z", "commit": {"oid": "3407ca668e77d3e0b28e47136c6c2748cd55aa01"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fafcb011d8c57b44d8d7ebdd50f8b39a4f994af0", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/fafcb011d8c57b44d8d7ebdd50f8b39a4f994af0", "committedDate": "2020-05-28T16:06:30Z", "message": "SAK-43698 - Moar codacy cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a9e4280efb912b393da9cf4ba7399b03835af2a", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/4a9e4280efb912b393da9cf4ba7399b03835af2a", "committedDate": "2020-05-28T22:56:43Z", "message": "SAK-43698 - Update test plans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "006727f4725d0097db1b012a665337d19a468b15", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/006727f4725d0097db1b012a665337d19a468b15", "committedDate": "2020-05-28T23:54:05Z", "message": "More test plan updates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1949, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}