{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDI2ODA2", "number": 7934, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMVrODiWcIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo1NFrODlUnbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MzQ1ODI1OnYy", "diffSide": "RIGHT", "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step4.html", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMVrOFtjAsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNDo0MjowNVrOFyWKnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg1OA==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303858", "createdAt": "2020-02-24T14:42:11Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step4.html", "diffHunk": "@@ -25,6 +25,7 @@\n           <input type=\"hidden\" th:field=\"*{groupNumberByGroup}\" name=\"groupNumberByGroup\">\n           <input type=\"hidden\" th:field=\"*{groupTitleByUser}\" name=\"sgroupTitleByUser\">\n           <input type=\"hidden\" th:field=\"*{groupNumberByUser}\" name=\"groupNumberByUser\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNjI4Nw==", "bodyText": "Hidden does not need a label", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388336287", "createdAt": "2020-03-05T14:42:05Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step4.html", "diffHunk": "@@ -25,6 +25,7 @@\n           <input type=\"hidden\" th:field=\"*{groupNumberByGroup}\" name=\"groupNumberByGroup\">\n           <input type=\"hidden\" th:field=\"*{groupTitleByUser}\" name=\"sgroupTitleByUser\">\n           <input type=\"hidden\" th:field=\"*{groupNumberByUser}\" name=\"groupNumberByUser\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg1OA=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MzQ1ODI3OnYy", "diffSide": "RIGHT", "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMlrOFtjAtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjozMToyMlrOFyawIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Mg==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303862", "createdAt": "2020-02-24T14:42:12Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "diffHunk": "@@ -52,6 +52,10 @@\n                 <td><input type=\"checkbox\" name=\"selectedSectionList\" th:field=\"*{selectedSectionList}\" th:value=\"${section.id}\"/></td>\n                 <td th:text=\"${section.title}\"></td>\n               </tr>\n+              <tr>\n+                <td><input type=\"checkbox\" name=\"useManuallyAddedUsers\" th:field=\"*{useManuallyAddedUsers}\"/></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNjYyMg==", "bodyText": "Can we get a label for this checkbox?", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388336622", "createdAt": "2020-03-05T14:42:38Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "diffHunk": "@@ -52,6 +52,10 @@\n                 <td><input type=\"checkbox\" name=\"selectedSectionList\" th:field=\"*{selectedSectionList}\" th:value=\"${section.id}\"/></td>\n                 <td th:text=\"${section.title}\"></td>\n               </tr>\n+              <tr>\n+                <td><input type=\"checkbox\" name=\"useManuallyAddedUsers\" th:field=\"*{useManuallyAddedUsers}\"/></td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Mg=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMTQyNg==", "bodyText": "Added as additional commit.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388411426", "createdAt": "2020-03-05T16:31:22Z", "author": {"login": "mpellicer"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "diffHunk": "@@ -52,6 +52,10 @@\n                 <td><input type=\"checkbox\" name=\"selectedSectionList\" th:field=\"*{selectedSectionList}\" th:value=\"${section.id}\"/></td>\n                 <td th:text=\"${section.title}\"></td>\n               </tr>\n+              <tr>\n+                <td><input type=\"checkbox\" name=\"useManuallyAddedUsers\" th:field=\"*{useManuallyAddedUsers}\"/></td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Mg=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MzQ1ODMxOnYy", "diffSide": "RIGHT", "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step3.html", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMlrOFtjAuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjozMjoyN1rOFyay3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Nw==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303867", "createdAt": "2020-02-24T14:42:12Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step3.html", "diffHunk": "@@ -33,6 +34,7 @@\n           <input type=\"hidden\" th:field=\"*{selectedRoleList}\" name=\"selectedRoleList\">\n           <input type=\"hidden\" th:field=\"*{selectedSectionList}\" name=\"selectedSectionList\">\n           <input type=\"hidden\" th:field=\"*{sectionsOption}\" name=\"sectionsOption\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNjEzNw==", "bodyText": "Hidden does not need a label", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388336137", "createdAt": "2020-03-05T14:41:50Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step3.html", "diffHunk": "@@ -33,6 +34,7 @@\n           <input type=\"hidden\" th:field=\"*{selectedRoleList}\" name=\"selectedRoleList\">\n           <input type=\"hidden\" th:field=\"*{selectedSectionList}\" name=\"selectedSectionList\">\n           <input type=\"hidden\" th:field=\"*{sectionsOption}\" name=\"sectionsOption\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Nw=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMjEyNQ==", "bodyText": "Hi Brian, th:field does not render a label, binds a form object attribute.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388412125", "createdAt": "2020-03-05T16:32:27Z", "author": {"login": "mpellicer"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step3.html", "diffHunk": "@@ -33,6 +34,7 @@\n           <input type=\"hidden\" th:field=\"*{selectedRoleList}\" name=\"selectedRoleList\">\n           <input type=\"hidden\" th:field=\"*{selectedSectionList}\" name=\"selectedSectionList\">\n           <input type=\"hidden\" th:field=\"*{sectionsOption}\" name=\"sectionsOption\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Nw=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODU0NjE0OnYy", "diffSide": "RIGHT", "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoxNjoxNlrOFxPD2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDoyNVrOFyJf8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3MTI4OA==", "bodyText": "@mpellicer, try the following, I think it might work for you:\nAuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\nSet<Member> grants = realm.getMembers();\n\nThen, the Member object has a .isProvided() method:\nif (!member.isProvided()) // or one line lambda\n{\n    // add to list of non-provided users\n}\n\nHope this works, it's much less to write and easier to understand. For reference, I initially found this type of logic in SiteParticipantHelper.addParticipantsFromMembers() and SiteParticipantHelper.prepareParticipants(), as the participants list must show both provided and non-provided users.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r387171288", "createdAt": "2020-03-03T17:16:16Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,25 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                List<Member> allSiteMembers = site.getMembers().stream().filter(m -> selectedRoleList.contains(m.getRole().getId())).collect(Collectors.toList());\n+                // Build the section list.\n+                List<Group> sectionList = site.getGroups().stream()\n+                    .filter(\n+                        group -> group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED) == null || \n+                        !Boolean.valueOf(group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED)).booleanValue()\n+                    ).collect(Collectors.toList());\n+                List<Member> siteSectionMembers = new ArrayList<Member>(); \n+                sectionList.forEach(section -> {siteSectionMembers.addAll(section.getMembers());});\n+                for (Member member : allSiteMembers) {\n+                    if (siteSectionMembers.stream().noneMatch(sectionMember -> sectionMember.getUserId().equals(member.getUserId()))) {\n+                        filteredMembers.add(member);\n+                    }\n+                }\n+                \n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODc1NA==", "bodyText": "Thanks @bjones86, makes sense to me. I tested with the demo mode and seems working.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388128754", "createdAt": "2020-03-05T08:00:25Z", "author": {"login": "mpellicer"}, "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,25 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                List<Member> allSiteMembers = site.getMembers().stream().filter(m -> selectedRoleList.contains(m.getRole().getId())).collect(Collectors.toList());\n+                // Build the section list.\n+                List<Group> sectionList = site.getGroups().stream()\n+                    .filter(\n+                        group -> group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED) == null || \n+                        !Boolean.valueOf(group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED)).booleanValue()\n+                    ).collect(Collectors.toList());\n+                List<Member> siteSectionMembers = new ArrayList<Member>(); \n+                sectionList.forEach(section -> {siteSectionMembers.addAll(section.getMembers());});\n+                for (Member member : allSiteMembers) {\n+                    if (siteSectionMembers.stream().noneMatch(sectionMember -> sectionMember.getUserId().equals(member.getUserId()))) {\n+                        filteredMembers.add(member);\n+                    }\n+                }\n+                \n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3MTI4OA=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDYxNjc4OnYy", "diffSide": "RIGHT", "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo1NFrOFyJgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo1NFrOFyJgxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODk2Nw==", "bodyText": "@bjones86 simpler and nicer.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388128967", "createdAt": "2020-03-05T08:00:54Z", "author": {"login": "mpellicer"}, "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,13 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                // Add non-provided members filtering by the selected roles.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2358, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}