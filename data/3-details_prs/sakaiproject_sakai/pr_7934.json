{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDI2ODA2", "number": 7934, "title": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups", "bodyText": "https://jira.sakaiproject.org/browse/SAK-43273", "createdAt": "2020-02-24T14:42:05Z", "url": "https://github.com/sakaiproject/sakai/pull/7934", "merged": true, "mergeCommit": {"oid": "17baac68a7601936835d63b038ff935142e2a3a3"}, "closed": true, "closedAt": "2020-03-05T18:05:10Z", "author": {"login": "mpellicer"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHel_aAFqTM2MzQzNzgyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKvc9vAFqTM2OTc5MzIzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDM3ODI3", "url": "https://github.com/sakaiproject/sakai/pull/7934#pullrequestreview-363437827", "createdAt": "2020-02-24T14:42:11Z", "commit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMVrOFtjAsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo0MjoxMlrOFtjAuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg1OA==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303858", "createdAt": "2020-02-24T14:42:11Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step4.html", "diffHunk": "@@ -25,6 +25,7 @@\n           <input type=\"hidden\" th:field=\"*{groupNumberByGroup}\" name=\"groupNumberByGroup\">\n           <input type=\"hidden\" th:field=\"*{groupTitleByUser}\" name=\"sgroupTitleByUser\">\n           <input type=\"hidden\" th:field=\"*{groupNumberByUser}\" name=\"groupNumberByUser\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Mg==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303862", "createdAt": "2020-02-24T14:42:12Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "diffHunk": "@@ -52,6 +52,10 @@\n                 <td><input type=\"checkbox\" name=\"selectedSectionList\" th:field=\"*{selectedSectionList}\" th:value=\"${section.id}\"/></td>\n                 <td th:text=\"${section.title}\"></td>\n               </tr>\n+              <tr>\n+                <td><input type=\"checkbox\" name=\"useManuallyAddedUsers\" th:field=\"*{useManuallyAddedUsers}\"/></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Nw==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r383303867", "createdAt": "2020-02-24T14:42:12Z", "author": {"login": "accesslint"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step3.html", "diffHunk": "@@ -33,6 +34,7 @@\n           <input type=\"hidden\" th:field=\"*{selectedRoleList}\" name=\"selectedRoleList\">\n           <input type=\"hidden\" th:field=\"*{selectedSectionList}\" name=\"selectedSectionList\">\n           <input type=\"hidden\" th:field=\"*{sectionsOption}\" name=\"sectionsOption\">\n+          <input type=\"hidden\" th:field=\"*{useManuallyAddedUsers}\" name=\"useManuallyAddedUsers\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTcwMDQz", "url": "https://github.com/sakaiproject/sakai/pull/7934#pullrequestreview-368170043", "createdAt": "2020-03-03T17:16:16Z", "commit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoxNjoxNlrOFxPD2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoxNjoxNlrOFxPD2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3MTI4OA==", "bodyText": "@mpellicer, try the following, I think it might work for you:\nAuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\nSet<Member> grants = realm.getMembers();\n\nThen, the Member object has a .isProvided() method:\nif (!member.isProvided()) // or one line lambda\n{\n    // add to list of non-provided users\n}\n\nHope this works, it's much less to write and easier to understand. For reference, I initially found this type of logic in SiteParticipantHelper.addParticipantsFromMembers() and SiteParticipantHelper.prepareParticipants(), as the participants list must show both provided and non-provided users.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r387171288", "createdAt": "2020-03-03T17:16:16Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,25 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                List<Member> allSiteMembers = site.getMembers().stream().filter(m -> selectedRoleList.contains(m.getRole().getId())).collect(Collectors.toList());\n+                // Build the section list.\n+                List<Group> sectionList = site.getGroups().stream()\n+                    .filter(\n+                        group -> group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED) == null || \n+                        !Boolean.valueOf(group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED)).booleanValue()\n+                    ).collect(Collectors.toList());\n+                List<Member> siteSectionMembers = new ArrayList<Member>(); \n+                sectionList.forEach(section -> {siteSectionMembers.addAll(section.getMembers());});\n+                for (Member member : allSiteMembers) {\n+                    if (siteSectionMembers.stream().noneMatch(sectionMember -> sectionMember.getUserId().equals(member.getUserId()))) {\n+                        filteredMembers.add(member);\n+                    }\n+                }\n+                \n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/4d8040572df4aad3405aa13400343699299ebab8", "committedDate": "2020-03-05T07:59:05Z", "message": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/df51c06592fde40c37e82ee192b669f1dd0eacd5", "committedDate": "2020-02-24T14:41:37Z", "message": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups"}, "afterCommit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/4d8040572df4aad3405aa13400343699299ebab8", "committedDate": "2020-03-05T07:59:05Z", "message": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzU3NTk2", "url": "https://github.com/sakaiproject/sakai/pull/7934#pullrequestreview-369357596", "createdAt": "2020-03-05T08:00:54Z", "commit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo1NFrOFyJgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo1NFrOFyJgxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODk2Nw==", "bodyText": "@bjones86 simpler and nicer.", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388128967", "createdAt": "2020-03-05T08:00:54Z", "author": {"login": "mpellicer"}, "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,13 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                // Add non-provided members filtering by the selected roles.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjI0Nzk4", "url": "https://github.com/sakaiproject/sakai/pull/7934#pullrequestreview-369624798", "createdAt": "2020-03-05T14:42:38Z", "commit": {"oid": "4d8040572df4aad3405aa13400343699299ebab8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNDo0MjozOFrOFyWL7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNDo0MjozOFrOFyWL7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNjYyMg==", "bodyText": "Can we get a label for this checkbox?", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388336622", "createdAt": "2020-03-05T14:42:38Z", "author": {"login": "bjones86"}, "path": "site-manage/site-group-manager/src/main/webapp/WEB-INF/templates/auto_groups_step2.html", "diffHunk": "@@ -52,6 +52,10 @@\n                 <td><input type=\"checkbox\" name=\"selectedSectionList\" th:field=\"*{selectedSectionList}\" th:value=\"${section.id}\"/></td>\n                 <td th:text=\"${section.title}\"></td>\n               </tr>\n+              <tr>\n+                <td><input type=\"checkbox\" name=\"useManuallyAddedUsers\" th:field=\"*{useManuallyAddedUsers}\"/></td>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwMzg2Mg=="}, "originalCommit": {"oid": "df51c06592fde40c37e82ee192b669f1dd0eacd5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29f14b462dc6ee6f11f42474b0460b23c2e6da92", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/29f14b462dc6ee6f11f42474b0460b23c2e6da92", "committedDate": "2020-03-05T16:31:00Z", "message": "Added label for the checkbox"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzkzMjMx", "url": "https://github.com/sakaiproject/sakai/pull/7934#pullrequestreview-369793231", "createdAt": "2020-03-05T18:02:30Z", "commit": {"oid": "29f14b462dc6ee6f11f42474b0460b23c2e6da92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2204, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}