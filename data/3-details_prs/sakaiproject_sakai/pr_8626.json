{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MDE1MTY5", "number": 8626, "title": "SAK-44324: SAMIGO - Calculated Questions: Some functions don't work (mXparser)", "bodyText": "", "createdAt": "2020-09-28T09:36:12Z", "url": "https://github.com/sakaiproject/sakai/pull/8626", "merged": true, "mergeCommit": {"oid": "c084c6e8a4e2d77e30c51a87cc898f04dd7c21b7"}, "closed": true, "closedAt": "2020-10-14T15:29:18Z", "author": {"login": "jesusmmp"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNQQkpAH2gAyNDk0MDE1MTY5OjZjYjViNThhNDlmNzg4ZjZkZTczM2ZiY2I3Yzc5NDUzMGU5MjY4ZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQbnU-gH2gAyNDk0MDE1MTY5OmI3YmRlMjZkNTQ1MjBkYmIwNzk0ZjFjZTIxZWI2OWYxODQ1YWExNTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df", "author": {"user": {"login": "jesusmmp", "name": "Jes\u00fas Mar\u00eda M\u00e9ndez P\u00e9rez"}}, "url": "https://github.com/sakaiproject/sakai/commit/6cb5b58a49f788f6de733fbcb7c794530e9268df", "committedDate": "2020-09-28T09:34:50Z", "message": "SAK-44324: SAMIGO - Calculated Questions: Some functions don't work (mXparser)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTExMTQ4", "url": "https://github.com/sakaiproject/sakai/pull/8626#pullrequestreview-498111148", "createdAt": "2020-09-29T05:43:30Z", "commit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0MzozMFrOHZbvTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0MzozMFrOHZbvTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMDkyNA==", "bodyText": "@ottenhoff Added spanish translations", "url": "https://github.com/sakaiproject/sakai/pull/8626#discussion_r496430924", "createdAt": "2020-09-29T05:43:30Z", "author": {"login": "jesusmmp"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/bundle/AuthorMessages_es.properties", "diffHunk": "@@ -120,11 +120,11 @@ calc_question_answer_variance=Puede definir la tolerancia aceptable como una con\n calc_question_answer_decimal=Variables y f\\u00f3rmulas soportan cifras decimales. Por defecto ser\\u00e1n 3.\n calc_question_example1=Kevin tiene {x} manzanas. \\u00c9l compra {y} m\\u00e1s. Ahora Kevin tiene [[{x}+{y}]]. Jane come {z} manzanas. Kevin tiene ahora {{w}} manzanas.\n calc_question_example1_formula=La f\\u00f3rmula w en el ejemplo anterior se definir\\u00eda como\\: {x} + {y} - {z}\n-calc_question_functions=Puede usar las siguientes funciones matem\\u00e1ticas\\: SIN, COS, TAN, ASIN, ACOS, ATAN, ABS, EXP, SGN, SQRT, LOG10, y LN.\n-calc_question_example2=Resolver\\: COS({a}) * ({c} - {b}) \\= {{z}}.\n-calc_question_example2_formula=La f\\u00f3rmula z en el ejemplo anterior se definir\\u00eda como\\: COS({a}) * ({c} - {b})\n+calc_question_functions=Puede usar las siguientes funciones matem\\u00e1ticas\\: sin, cos, tan, asin, acos, atan, abs, exp, sgn, sqrt, log10 y ln.\n+calc_question_example2=Resolver\\: cos({a}) * ({c} - {b}) \\= {{z}}.\n+calc_question_example2_formula=La f\\u00f3rmula z en el ejemplo anterior se definir\\u00eda como\\: cos({a}) * ({c} - {b})\n calc_question_example3=El \\u00e1rea del cuadrado es [[ {s} * {s} ]]m. Encuentra la longitud del lado {{Z}}. La f\\u00f3rmula Z ser\\u00eda {s}.\n-calc_question_constants=Hay dos constantes integradas, PI(3.14...) y e(2.718...). Pueden ser utilizadas en sus expresiones de f\\u00f3rmula.\n+calc_question_constants=Hay constantes integradas: pi(3.14...), e(2.718...), [phi](1.618...), etc. Pueden ser utilizadas en sus expresiones de f\\u00f3rmula.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTExNDY5", "url": "https://github.com/sakaiproject/sakai/pull/8626#pullrequestreview-498111469", "createdAt": "2020-09-29T05:44:24Z", "commit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0NDoyNFrOHZbwUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0NDoyNFrOHZbwUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTE4Nw==", "bodyText": "@ottenhoff Added unescape to make work functions that contains <, and >", "url": "https://github.com/sakaiproject/sakai/pull/8626#discussion_r496431187", "createdAt": "2020-09-29T05:44:24Z", "author": {"login": "jesusmmp"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/author/CalculatedQuestionExtractListener.java", "diffHunk": "@@ -460,7 +462,7 @@ private Long getMaxSequenceValue(Map<String, CalculatedQuestionVariableBean> var\n \n             // evaluate each calculation\n             for (CalculatedQuestionCalculationBean cqcb : calculatedQuestionBean.getCalculationsList()) {\n-                String formulaStr = GradingService.cleanFormula(cqcb.getText());\n+                String formulaStr = StringEscapeUtils.unescapeHtml4(GradingService.cleanFormula(cqcb.getText()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTExNjgx", "url": "https://github.com/sakaiproject/sakai/pull/8626#pullrequestreview-498111681", "createdAt": "2020-09-29T05:44:59Z", "commit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0NDo1OVrOHZbw9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0NDo1OVrOHZbw9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTM0OQ==", "bodyText": "@ottenhoff Added a new test that contains >", "url": "https://github.com/sakaiproject/sakai/pull/8626#discussion_r496431349", "createdAt": "2020-09-29T05:44:59Z", "author": {"login": "jesusmmp"}, "path": "samigo/samigo-services/src/test/org/sakaiproject/tool/assessment/services/GradingServiceTest.java", "diffHunk": "@@ -431,7 +449,41 @@ public void testCalculationsToValues() throws SamigoExpressionError {\n         Assert.assertEquals(\"1E11\", result);                 \n         result = gradingService.processFormulaIntoValue(\"1000000000000.00\", 2);\n         Assert.assertNotNull(result);\n-        Assert.assertEquals(\"1E12\", result);                 \n+        Assert.assertEquals(\"1E12\", result);\n+\n+        // mixed-case functions\n+        result = gradingService.processFormulaIntoValue(\"qNor(0.5, 2, 1)\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"2\", result);\n+        result = gradingService.processFormulaIntoValue(\"cNor(0.7, 3, 1)\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"0.01\", result);\n+        // test lowercasing\n+        result = gradingService.processFormulaIntoValue(\"pi + E\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"5.86\", result);\n+        // speed of light\n+        result = gradingService.processFormulaIntoValue(\"[c]*3\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"899377374\", result);\n+        // golden ratio\n+        result = gradingService.processFormulaIntoValue(\"3*[phi]\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"4.85\", result);\n+        // binomial coefficient\n+        result = gradingService.processFormulaIntoValue(\"C(8,3)\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"56\", result);\n+        result = gradingService.processFormulaIntoValue(\"if(1>3, 5, 2)\", 2);\n+        Assert.assertNotNull(result);\n+        Assert.assertEquals(\"2\", result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDEwNDIx", "url": "https://github.com/sakaiproject/sakai/pull/8626#pullrequestreview-499010421", "createdAt": "2020-09-30T00:23:32Z", "commit": {"oid": "6cb5b58a49f788f6de733fbcb7c794530e9268df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7bde26d54520dbb0794f1ce21eb69f1845aa159", "author": {"user": {"login": "jesusmmp", "name": "Jes\u00fas Mar\u00eda M\u00e9ndez P\u00e9rez"}}, "url": "https://github.com/sakaiproject/sakai/commit/b7bde26d54520dbb0794f1ce21eb69f1845aa159", "committedDate": "2020-10-08T06:30:25Z", "message": "SAK-44324: SAMIGO - Calculated Questions: Some functions don't work (mXparser)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2708, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}