{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NTQyNzY1", "number": 8566, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNToxMjowOVrOEmIk5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo0NzozNVrOEtp_zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDIxODYwOnYy", "diffSide": "RIGHT", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNToxMjowOVrOHV_IQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDoyNjoyN1rOHhjz9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ==", "bodyText": "this should be a list() as more than one group/section should be returned.", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r492816449", "createdAt": "2020-09-22T15:12:09Z", "author": {"login": "ern"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNTQzMQ==", "bodyText": "Done!", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r494215431", "createdAt": "2020-09-24T10:44:51Z", "author": {"login": "feralvarez95"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzIzOQ==", "bodyText": "@ern Is there any problem with the changes?", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r497317239", "createdAt": "2020-09-30T08:02:39Z", "author": {"login": "jesusmmp"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1OTkxMg==", "bodyText": "Earle has a huge refactoring of msgcntr queued up ... with huge performance gains.\nAlso, I was never able to replicate the reported bug. I tried several times on my local trunk  .....", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r497759912", "createdAt": "2020-09-30T19:48:21Z", "author": {"login": "ottenhoff"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMjk2Ng==", "bodyText": "@ottenhoff I uploaded a video with the problem. Have you seen it?", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r498002966", "createdAt": "2020-10-01T06:08:51Z", "author": {"login": "jesusmmp"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MzI0Nw==", "bodyText": "Yes, I watched several times and followed the steps several times.", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r498253247", "createdAt": "2020-10-01T13:41:48Z", "author": {"login": "ottenhoff"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzUxMA==", "bodyText": "We have reproduced this issue in our Sakai 20 in production. We introduced a new ticket (SAK-44462) but @jesusmmp has advised that our new ticket in fact duplicated SAK-44292 Maybe our testing plan in SAK-44462 can help to reproduce the issue", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504817510", "createdAt": "2020-10-14T16:34:14Z", "author": {"login": "mateullas"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgzNjM1OQ==", "bodyText": "I was able to replicate today. @ern and I are looking at it", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504836359", "createdAt": "2020-10-14T17:04:57Z", "author": {"login": "ottenhoff"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk1MTc5OA==", "bodyText": "yes looking", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504951798", "createdAt": "2020-10-14T20:26:27Z", "author": {"login": "ern"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, "originalCommit": {"oid": "8cddd595db4b6f186c7a327d68e09098ae91c384"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzA5NDU0OnYy", "diffSide": "RIGHT", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/UIPermissionsManagerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo0NzozNVrOHhkeKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo0NzozNVrOHhkeKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk2MjYwMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(String group: groupTitle) {\n          \n          \n            \n                      \t  if(groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(group)))\n          \n          \n            \n                      \t\t  return true;\n          \n          \n            \n                        }\n          \n          \n            \n                        return groups.stream().map(site::getGroup).anyMatch(g -> groupTitle.contains(g.getTitle()));", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504962600", "createdAt": "2020-10-14T20:47:35Z", "author": {"login": "ern"}, "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/UIPermissionsManagerImpl.java", "diffHunk": "@@ -130,7 +130,10 @@ private boolean isInstructorForAllowedGroup(Long forumId, boolean isForum) {\n         try {\n             Site site = siteService.getSite(siteId);\n             Set<String> groups = getGroupsWithMember(site, getCurrentUserId());\n-            return groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(groupTitle));\n+            for(String group: groupTitle) {\n+          \t  if(groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(group)))\n+          \t\t  return true;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9661f9d2cce75d55b48f30ea8e0d94c305f49ad"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2641, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}