{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MjY3Mzg1", "number": 8088, "title": "SAK-41905 - site info: Import from Site always shows complete list of\u2026", "bodyText": "\u2026 sites, including hidden ones.", "createdAt": "2020-03-26T16:10:21Z", "url": "https://github.com/sakaiproject/sakai/pull/8088", "merged": true, "mergeCommit": {"oid": "3203e72a1f4e85c1944c3b4d7fed48c0bcf3eff9"}, "closed": true, "closedAt": "2020-04-01T15:49:36Z", "author": {"login": "mpellicer"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRrVVegBqjMxNzEyMjI0MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTXlPOAFqTM4NTU3NTYyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "530941ed0931cb0937f54a137ea7b00a75d23de6", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/530941ed0931cb0937f54a137ea7b00a75d23de6", "committedDate": "2020-03-26T16:09:41Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}, "afterCommit": {"oid": "c8e79623f16971b881154e0a46f1c42e8bfca308", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/c8e79623f16971b881154e0a46f1c42e8bfca308", "committedDate": "2020-03-27T07:11:41Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNjIxNDQz", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-382621443", "createdAt": "2020-03-27T07:12:09Z", "commit": {"oid": "c8e79623f16971b881154e0a46f1c42e8bfca308"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNzoxMjowOVrOF8lbBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNzoxMjowOVrOF8lbBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA3MjAwNA==", "bodyText": "This input has more that one label.", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r399072004", "createdAt": "2020-03-27T07:12:09Z", "author": {"login": "accesslint"}, "path": "site-manage/site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-importMigrate.vm", "diffHunk": "@@ -32,6 +29,26 @@\n \t\t\t\t\t</div>\t\n \t\t\t\t#end\n \t\t\t#end\n+\t\t\t#if ($!hiddenSites && $hiddenSites.size() > 1)\n+\t\t\t\t<p class=\"instruction\">\n+\t\t\t\t\t$tlang.getString(\"sitinfimp.hiddensites\")\n+\t\t\t\t</p>\n+\t\t\t\t#foreach($hiddenSite in $hiddenSites)\n+\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t#if ($!currentSite && ($hiddenSite.Id != $!currentSite.Id))\n+\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" value=\"$hiddenSite.getId()\" \n+\t\t\t\t\t\t\t\t\t#if ($!importSiteList.containsKey($!hiddenSite))\n+\t\t\t\t\t\t\t\t\t\tchecked=\"checked\"\n+\t\t\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t\t\t/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8e79623f16971b881154e0a46f1c42e8bfca308"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8e79623f16971b881154e0a46f1c42e8bfca308", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/c8e79623f16971b881154e0a46f1c42e8bfca308", "committedDate": "2020-03-27T07:11:41Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}, "afterCommit": {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/07e8c6f0f095b70d28453df1e4da60ee66cc6272", "committedDate": "2020-03-27T17:54:17Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMDgxNzkx", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-383081791", "createdAt": "2020-03-27T17:54:43Z", "commit": {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo1NDo0NFrOF88EnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo1NDo0NFrOF88Enw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0MzEwMQ==", "bodyText": "This input has more that one label.", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r399443101", "createdAt": "2020-03-27T17:54:44Z", "author": {"login": "accesslint"}, "path": "site-manage/site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-importMigrate.vm", "diffHunk": "@@ -10,28 +10,60 @@\n \t<form name=\"featuresForm\" action=\"#toolForm(\"$action\")\" method=\"post\">\n \t\t## import is possible when use has maintain rights on at least one site other than the current one\n \t\t#if ($!sites && $sites.size()>1)\n-\t\t\t<p class=\"step\">\n-\t\t\t\t$tlang.getString(\"sitinfimp.reuse\")\n-\t\t\t</p>\n \t\t\t<p class=\"instruction\">\n \t\t\t\t$tlang.getString(\"sitinfimp.replace\")\n \t\t\t</p>\n-\t\t\t#set ($siteIDCounter =0)\n-\t\t\t#foreach($site in $sites)\n-\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n-\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n-\t\t\t\t\t<div class=\"radio\">\t\n-\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n-\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" value=\"$site.getId()\" \n-\t\t\t\t\t\t\t\t#if ($!importSiteList.containsKey($!site))\n-\t\t\t\t\t\t\t\t\tchecked=\"checked\"\n+\t\t\t<div class=\"panel-group\" id=\"sitesAccordion\">\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#mysites\">$tlang.getString(\"sitinfimp.mysites\") ($sites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"mysites\" class=\"panel-collapse collapse in\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t#set ($siteIDCounter =0)\n+\t\t\t\t\t\t\t#foreach($site in $sites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!site)) checked=\"checked\"#end value=\"$site.getId()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0MzEwMw==", "bodyText": "This input has more that one label.", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r399443103", "createdAt": "2020-03-27T17:54:44Z", "author": {"login": "accesslint"}, "path": "site-manage/site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-importMigrate.vm", "diffHunk": "@@ -10,28 +10,60 @@\n \t<form name=\"featuresForm\" action=\"#toolForm(\"$action\")\" method=\"post\">\n \t\t## import is possible when use has maintain rights on at least one site other than the current one\n \t\t#if ($!sites && $sites.size()>1)\n-\t\t\t<p class=\"step\">\n-\t\t\t\t$tlang.getString(\"sitinfimp.reuse\")\n-\t\t\t</p>\n \t\t\t<p class=\"instruction\">\n \t\t\t\t$tlang.getString(\"sitinfimp.replace\")\n \t\t\t</p>\n-\t\t\t#set ($siteIDCounter =0)\n-\t\t\t#foreach($site in $sites)\n-\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n-\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n-\t\t\t\t\t<div class=\"radio\">\t\n-\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n-\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" value=\"$site.getId()\" \n-\t\t\t\t\t\t\t\t#if ($!importSiteList.containsKey($!site))\n-\t\t\t\t\t\t\t\t\tchecked=\"checked\"\n+\t\t\t<div class=\"panel-group\" id=\"sitesAccordion\">\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#mysites\">$tlang.getString(\"sitinfimp.mysites\") ($sites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"mysites\" class=\"panel-collapse collapse in\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t#set ($siteIDCounter =0)\n+\t\t\t\t\t\t\t#foreach($site in $sites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!site)) checked=\"checked\"#end value=\"$site.getId()\"/>\n+\t\t\t\t\t\t\t\t\t\t\t$formattedText.escapeHtml($site.getTitle())\n+\t\t\t\t\t\t\t\t\t\t</label>\n+\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t</div>\n+\t\t\t\t\t</div>\n+\t\t\t\t</div>\n+\n+\t\t\t#if ($!hiddenSites && $hiddenSites.size() > 0)\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#hiddenSites\">$tlang.getString(\"sitinfimp.hiddensites\") ($hiddenSites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"hiddenSites\" class=\"panel-collapse collapse\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t#foreach($hiddenSite in $hiddenSites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($hiddenSite.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!hiddenSite)) checked=\"checked\" #end value=\"$hiddenSite.getId()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272"}, "originalPosition": 58}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/07e8c6f0f095b70d28453df1e4da60ee66cc6272", "committedDate": "2020-03-27T17:54:17Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}, "afterCommit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/23705ed08c308332ebd8bbee3f046106c6877d1d", "committedDate": "2020-03-27T18:05:39Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMDkwMDM2", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-383090036", "createdAt": "2020-03-27T18:06:01Z", "commit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODowNjowMVrOF88eGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODowNjowMVrOF88eGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0OTYyNg==", "bodyText": "This input has more that one label.", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r399449626", "createdAt": "2020-03-27T18:06:01Z", "author": {"login": "accesslint"}, "path": "site-manage/site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-importMigrate.vm", "diffHunk": "@@ -10,28 +10,63 @@\n \t<form name=\"featuresForm\" action=\"#toolForm(\"$action\")\" method=\"post\">\n \t\t## import is possible when use has maintain rights on at least one site other than the current one\n \t\t#if ($!sites && $sites.size()>1)\n-\t\t\t<p class=\"step\">\n-\t\t\t\t$tlang.getString(\"sitinfimp.reuse\")\n-\t\t\t</p>\n \t\t\t<p class=\"instruction\">\n \t\t\t\t$tlang.getString(\"sitinfimp.replace\")\n \t\t\t</p>\n-\t\t\t#set ($siteIDCounter =0)\n-\t\t\t#foreach($site in $sites)\n-\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n-\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n-\t\t\t\t\t<div class=\"radio\">\t\n-\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n-\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" value=\"$site.getId()\" \n-\t\t\t\t\t\t\t\t#if ($!importSiteList.containsKey($!site))\n-\t\t\t\t\t\t\t\t\tchecked=\"checked\"\n+\t\t\t<div class=\"panel-group\" id=\"sitesAccordion\">\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#mysites\">$tlang.getString(\"sitinfimp.mysites\") ($sites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"mysites\" class=\"panel-collapse collapse in\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t#set ($siteIDCounter =0)\n+\t\t\t\t\t\t\t#foreach($site in $sites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!site)) checked=\"checked\"#end value=\"$site.getId()\"/>\n+\t\t\t\t\t\t\t\t\t\t\t$formattedText.escapeHtml($site.getTitle())\n+\t\t\t\t\t\t\t\t\t\t</label>\n+\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t</div>\n+\t\t\t\t\t</div>\n+\t\t\t\t</div>\n+\n+\t\t\t#if ($!hiddenSites && $hiddenSites.size() > 0)\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#hiddenSites\">$tlang.getString(\"sitinfimp.hiddensites\") ($hiddenSites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"hiddenSites\" class=\"panel-collapse collapse\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t<p class=\"instruction\">\n+\t\t\t\t\t\t\t\ttlang.getString(\"sitinfimp.hiddensites.info\")\n+\t\t\t\t\t\t\t</p>\n+\t\t\t\t\t\t\t#foreach($hiddenSite in $hiddenSites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($hiddenSite.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!hiddenSite)) checked=\"checked\" #end value=\"$hiddenSite.getId()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODIwNDc4", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-384820478", "createdAt": "2020-03-31T14:58:10Z", "commit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNDo1ODoxMFrOF-aBTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNDo1ODoxMFrOF-aBTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4MjM1MA==", "bodyText": "Could be reduced to a one line lambda ;)", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r400982350", "createdAt": "2020-03-31T14:58:10Z", "author": {"login": "ern"}, "path": "site-manage/site-manage-tool/tool/src/java/org/sakaiproject/site/tool/SiteAction.java", "diffHunk": "@@ -4205,11 +4206,31 @@ private void pageOrderToolTitleIntoContext(Context context, SessionState state,\n \t */\n \tprivate void putImportSitesInfoIntoContext(Context context, Site site, SessionState state, boolean ownTypeOnly) {\n \t\tcontext.put(\"currentSite\", site);\n-\t\tcontext.put(\"importSiteList\", state\n-\t\t\t\t.getAttribute(STATE_IMPORT_SITES));\n-\t\tcontext.put(\"sites\", SiteService.getSites(\n-\t\t\t\torg.sakaiproject.site.api.SiteService.SelectionType.UPDATE,\n-\t\t\t\townTypeOnly?site.getType():null, null, null, SortType.TITLE_ASC, null));\n+\t\tcontext.put(\"importSiteList\", state.getAttribute(STATE_IMPORT_SITES));\n+\t\tfinal List<Site> siteList = SiteService.getSites(org.sakaiproject.site.api.SiteService.SelectionType.UPDATE, ownTypeOnly?site.getType():null, null, null, SortType.TITLE_ASC, null);\n+\t\tList<String> hiddenSiteIdList = new ArrayList<>();\n+\t\tList<Site> hiddenSiteList = new ArrayList<>();\n+\t\tList<Site> visibleSiteList = new ArrayList<>();\n+\t\tPreferences preferences = preferencesService.getPreferences(userDirectoryService.getCurrentUser().getId());\n+\t\tif (preferences != null) {\n+\t\t\tResourceProperties properties = preferences.getProperties(PreferencesService.SITENAV_PREFS_KEY);\n+\t\t\thiddenSiteIdList = (List<String>) properties.getPropertyList(PreferencesService.SITENAV_PREFS_EXCLUDE_KEY);\n+\t\t}\n+\n+\t\tif (hiddenSiteIdList != null && !hiddenSiteIdList.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODI2MjQw", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-384826240", "createdAt": "2020-03-31T15:03:52Z", "commit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "committedDate": "2020-04-01T13:18:46Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/23705ed08c308332ebd8bbee3f046106c6877d1d", "committedDate": "2020-03-27T18:05:39Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}, "afterCommit": {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "author": {"user": {"login": "mpellicer", "name": "Miguel Pellicer"}}, "url": "https://github.com/sakaiproject/sakai/commit/1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "committedDate": "2020-04-01T13:18:46Z", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NTc1NjI1", "url": "https://github.com/sakaiproject/sakai/pull/8088#pullrequestreview-385575625", "createdAt": "2020-04-01T13:19:07Z", "commit": {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxOTowOFrOF_AMyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxOTowOFrOF_AMyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNzg4Mw==", "bodyText": "This input has more that one label.", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r401607883", "createdAt": "2020-04-01T13:19:08Z", "author": {"login": "accesslint"}, "path": "site-manage/site-manage-tool/tool/src/webapp/vm/sitesetup/chef_site-siteInfo-importMigrate.vm", "diffHunk": "@@ -10,28 +10,63 @@\n \t<form name=\"featuresForm\" action=\"#toolForm(\"$action\")\" method=\"post\">\n \t\t## import is possible when use has maintain rights on at least one site other than the current one\n \t\t#if ($!sites && $sites.size()>1)\n-\t\t\t<p class=\"step\">\n-\t\t\t\t$tlang.getString(\"sitinfimp.reuse\")\n-\t\t\t</p>\n \t\t\t<p class=\"instruction\">\n \t\t\t\t$tlang.getString(\"sitinfimp.replace\")\n \t\t\t</p>\n-\t\t\t#set ($siteIDCounter =0)\n-\t\t\t#foreach($site in $sites)\n-\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n-\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n-\t\t\t\t\t<div class=\"radio\">\t\n-\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n-\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" value=\"$site.getId()\" \n-\t\t\t\t\t\t\t\t#if ($!importSiteList.containsKey($!site))\n-\t\t\t\t\t\t\t\t\tchecked=\"checked\"\n+\t\t\t<div class=\"panel-group\" id=\"sitesAccordion\">\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#mysites\">$tlang.getString(\"sitinfimp.mysites\") ($sites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"mysites\" class=\"panel-collapse collapse in\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t#set ($siteIDCounter =0)\n+\t\t\t\t\t\t\t#foreach($site in $sites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($site.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!site)) checked=\"checked\"#end value=\"$site.getId()\"/>\n+\t\t\t\t\t\t\t\t\t\t\t$formattedText.escapeHtml($site.getTitle())\n+\t\t\t\t\t\t\t\t\t\t</label>\n+\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t\t#end\n+\t\t\t\t\t\t</div>\n+\t\t\t\t\t</div>\n+\t\t\t\t</div>\n+\n+\t\t\t#if ($!hiddenSites && $hiddenSites.size() > 0)\n+\t\t\t\t<div class=\"panel panel-default\">\n+\t\t\t\t\t<div class=\"panel-heading\">\n+\t\t\t\t\t\t<h4 class=\"panel-title\">\n+\t\t\t\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#sitesAccordion\" href=\"#hiddenSites\">$tlang.getString(\"sitinfimp.hiddensites\") ($hiddenSites.size())</a>\n+\t\t\t\t\t\t</h4>\n+\t\t\t\t\t</div>\n+\t\t\t\t\t<div id=\"hiddenSites\" class=\"panel-collapse collapse\">\n+\t\t\t\t\t\t<div class=\"panel-body\">\n+\t\t\t\t\t\t\t<p class=\"instruction\">\n+\t\t\t\t\t\t\t\ttlang.getString(\"sitinfimp.hiddensites.info\")\n+\t\t\t\t\t\t\t</p>\n+\t\t\t\t\t\t\t#foreach($hiddenSite in $hiddenSites)\n+\t\t\t\t\t\t\t\t#set ($siteIDCounter = $siteIDCounter + 1)\n+\t\t\t\t\t\t\t\t#if ($!currentSite && ($hiddenSite.Id != $!currentSite.Id))\n+\t\t\t\t\t\t\t\t\t<div class=\"radio\">\t\n+\t\t\t\t\t\t\t\t\t\t<label for=\"site_$siteIDCounter\">\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" name=\"importSites\" id=\"site_$siteIDCounter\" #if ($!importSiteList.containsKey($!hiddenSite)) checked=\"checked\" #end value=\"$hiddenSite.getId()\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2159, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}