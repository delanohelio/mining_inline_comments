{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MDA4NjYy", "number": 8784, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxODoxNjowM1rOE2MIdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxODoxNjowM1rOE2MIdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjU3MzM1OnYy", "diffSide": "RIGHT", "path": "webcomponents/tool/src/main/frontend/js/rubrics/rubrics-element.js", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxODoxNjowM1rOHu4jLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNzoyNToyMlrOH-oVAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkyMzA1NQ==", "bodyText": "You can simplify this with:\nthis.locale = (window.top?.portal?.locale || window.top?.sakai?.locale?.userLocale || \"en-US\").replace(\"_\", \"-\");", "url": "https://github.com/sakaiproject/sakai/pull/8784#discussion_r518923055", "createdAt": "2020-11-06T18:16:03Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/rubrics/rubrics-element.js", "diffHunk": "@@ -6,7 +6,7 @@ class RubricsElement extends SakaiElement {\n \n     super();\n \n-    this.locale = window.portal ? window.portal.locale : window.top.portal.locale;\n+    this.locale = window.portal ? window.portal.locale : window.top.portal ? window.top.portal.locale : window.top.sakai.locale.userLocale.replace(\"_\",\"-\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7490a0c45bd380cefeaa6e89afb796ae487d0f1d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0OTQyOA==", "bodyText": "What that line means is:\nif we have window.top.portal.locale, use it, else, if we have window.top.sakai.locale, use that, else use en-US. Then replace _ with - on whatever we end with.", "url": "https://github.com/sakaiproject/sakai/pull/8784#discussion_r532649428", "createdAt": "2020-11-30T14:46:02Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/rubrics/rubrics-element.js", "diffHunk": "@@ -6,7 +6,7 @@ class RubricsElement extends SakaiElement {\n \n     super();\n \n-    this.locale = window.portal ? window.portal.locale : window.top.portal.locale;\n+    this.locale = window.portal ? window.portal.locale : window.top.portal ? window.top.portal.locale : window.top.sakai.locale.userLocale.replace(\"_\",\"-\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkyMzA1NQ=="}, "originalCommit": {"oid": "7490a0c45bd380cefeaa6e89afb796ae487d0f1d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzMzA0MA==", "bodyText": "Thanks for the suggestion @adrianfish , I've just uploaded the changes.", "url": "https://github.com/sakaiproject/sakai/pull/8784#discussion_r535433040", "createdAt": "2020-12-03T17:23:21Z", "author": {"login": "josecebe"}, "path": "webcomponents/tool/src/main/frontend/js/rubrics/rubrics-element.js", "diffHunk": "@@ -6,7 +6,7 @@ class RubricsElement extends SakaiElement {\n \n     super();\n \n-    this.locale = window.portal ? window.portal.locale : window.top.portal.locale;\n+    this.locale = window.portal ? window.portal.locale : window.top.portal ? window.top.portal.locale : window.top.sakai.locale.userLocale.replace(\"_\",\"-\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkyMzA1NQ=="}, "originalCommit": {"oid": "7490a0c45bd380cefeaa6e89afb796ae487d0f1d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzNDQ5OQ==", "bodyText": "this is probably out of scope for this JIRA, but there is no guarantee we are window.top!!!!!", "url": "https://github.com/sakaiproject/sakai/pull/8784#discussion_r535434499", "createdAt": "2020-12-03T17:25:22Z", "author": {"login": "ottenhoff"}, "path": "webcomponents/tool/src/main/frontend/js/rubrics/rubrics-element.js", "diffHunk": "@@ -6,7 +6,7 @@ class RubricsElement extends SakaiElement {\n \n     super();\n \n-    this.locale = window.portal ? window.portal.locale : window.top.portal.locale;\n+    this.locale = window.portal ? window.portal.locale : window.top.portal ? window.top.portal.locale : window.top.sakai.locale.userLocale.replace(\"_\",\"-\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkyMzA1NQ=="}, "originalCommit": {"oid": "7490a0c45bd380cefeaa6e89afb796ae487d0f1d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2508, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}