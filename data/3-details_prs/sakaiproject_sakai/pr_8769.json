{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDE5ODk0", "number": 8769, "title": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation", "bodyText": "https://jira.sakaiproject.org/browse/SAK-44486", "createdAt": "2020-11-03T01:02:00Z", "url": "https://github.com/sakaiproject/sakai/pull/8769", "merged": true, "mergeCommit": {"oid": "04c21a3d8f1cb462957c5fb3103a1cef9ff84a59"}, "closed": true, "closedAt": "2020-12-03T13:16:22Z", "author": {"login": "austin48"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYud7-gH2gAyNTE0NDE5ODk0OmRmNDJhNWI4ZDBhOTI0MDZhZjcyZGJlMWMyZjA4YmFlNTQ2ZjkyZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiXw4UAFqTU0MzM0MTczNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "df42a5b8d0a92406af72dbe1c2f08bae546f92da", "author": {"user": {"login": "austin48", "name": null}}, "url": "https://github.com/sakaiproject/sakai/commit/df42a5b8d0a92406af72dbe1c2f08bae546f92da", "committedDate": "2020-11-03T00:59:45Z", "message": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzMxNDQ4", "url": "https://github.com/sakaiproject/sakai/pull/8769#pullrequestreview-541331448", "createdAt": "2020-11-30T22:03:16Z", "commit": {"oid": "df42a5b8d0a92406af72dbe1c2f08bae546f92da"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMjowMzoxNlrOH8Po_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMjowMzoxNlrOH8Po_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkzMjg2Mw==", "bodyText": "Use the newer log pattern please!", "url": "https://github.com/sakaiproject/sakai/pull/8769#discussion_r532932863", "createdAt": "2020-11-30T22:03:16Z", "author": {"login": "ern"}, "path": "msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java", "diffHunk": "@@ -7375,13 +7376,16 @@ public void  sendEmailNotification(Message reply, DiscussionMessageBean currthre\n \t\twhile (iter.hasNext()){\n \t\t\tDiscussionMessageBean decoMessage = (DiscussionMessageBean) iter.next();\n \t\t\tString threadauthor = decoMessage.getMessage().getCreatedBy();\n-\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n-\t\t\t// only add level 1 users , since we've already got level2 users. \n-\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n-\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\tlog.debug(\"The author: \" + threadauthor + \" wants to be notified\");\n+\t\t\t// don't include the reply author\n+\t\t\tif (!threadauthor.equals(reply.getCreatedBy())) {\n+\t\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n+\t\t\t\t// only add level 1 users , since we've already got level2 users.\n+\t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n+\t\t\t\t\tif (log.isDebugEnabled()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df42a5b8d0a92406af72dbe1c2f08bae546f92da"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b47b856013d17f51b827f4639a5c13e6040615a", "author": {"user": {"login": "austin48", "name": null}}, "url": "https://github.com/sakaiproject/sakai/commit/6b47b856013d17f51b827f4639a5c13e6040615a", "committedDate": "2020-12-01T00:51:53Z", "message": "SAK-44486 Forums - email notification is sent to users who didn't participate in conversation\n\nuse newer logging pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMzQxMTA3", "url": "https://github.com/sakaiproject/sakai/pull/8769#pullrequestreview-543341107", "createdAt": "2020-12-03T00:10:13Z", "commit": {"oid": "6b47b856013d17f51b827f4639a5c13e6040615a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwMDoxMDoxM1rOH9zd1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwMDoxMDoxM1rOH9zd1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU2ODQwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tif (log.isDebugEnabled()){\n          \n          \n            \n            \t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n          \n          \n            \n            \t\t\t\t\t}\n          \n          \n            \n            \t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);", "url": "https://github.com/sakaiproject/sakai/pull/8769#discussion_r534568404", "createdAt": "2020-12-03T00:10:13Z", "author": {"login": "ern"}, "path": "msgcntr/messageforums-app/src/java/org/sakaiproject/tool/messageforums/DiscussionForumTool.java", "diffHunk": "@@ -7375,13 +7376,16 @@ public void  sendEmailNotification(Message reply, DiscussionMessageBean currthre\n \t\twhile (iter.hasNext()){\n \t\t\tDiscussionMessageBean decoMessage = (DiscussionMessageBean) iter.next();\n \t\t\tString threadauthor = decoMessage.getMessage().getCreatedBy();\n-\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n-\t\t\t// only add level 1 users , since we've already got level2 users. \n-\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n-\t\t\t\tif (log.isDebugEnabled()){\n-\t\t\t\t\tlog.debug(\"The author: \" + threadauthor + \" wants to be notified\");\n+\t\t\t// don't include the reply author\n+\t\t\tif (!threadauthor.equals(reply.getCreatedBy())) {\n+\t\t\t\tEmailNotification authorNotificationLevel = emailNotificationManager.getEmailNotification(threadauthor);\n+\t\t\t\t// only add level 1 users , since we've already got level2 users.\n+\t\t\t\tif (EmailNotification.EMAIL_REPLY_TO_MY_MESSAGE.equalsIgnoreCase(authorNotificationLevel.getNotificationLevel())){\n+\t\t\t\t\tif (log.isDebugEnabled()){\n+\t\t\t\t\t\tlog.debug(\"The author: {} wants to be notified\", threadauthor);\n+\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b47b856013d17f51b827f4639a5c13e6040615a"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed3ff9aba694fc8b0a701d56d4345959ba0b117e", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/ed3ff9aba694fc8b0a701d56d4345959ba0b117e", "committedDate": "2020-12-03T00:10:46Z", "message": "Update log pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMzQxNzM1", "url": "https://github.com/sakaiproject/sakai/pull/8769#pullrequestreview-543341735", "createdAt": "2020-12-03T00:11:52Z", "commit": {"oid": "ed3ff9aba694fc8b0a701d56d4345959ba0b117e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2414, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}