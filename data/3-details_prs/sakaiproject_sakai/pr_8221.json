{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NDkwOTcz", "number": 8221, "title": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes", "bodyText": "", "createdAt": "2020-05-13T16:56:31Z", "url": "https://github.com/sakaiproject/sakai/pull/8221", "merged": true, "mergeCommit": {"oid": "6edff7c1de299b35250f470401d09195571e6f82"}, "closed": true, "closedAt": "2020-05-28T15:38:46Z", "author": {"login": "frasese"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchLiKNgFqTQxMTY5NjM3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchTWa0ABqjMzMzgyNzUxMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNjk2Mzc4", "url": "https://github.com/sakaiproject/sakai/pull/8221#pullrequestreview-411696378", "createdAt": "2020-05-14T11:05:04Z", "commit": {"oid": "df5a0852f073f5b726dee7e3088b2ac869c0608b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTowNTowNVrOGVXN-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTowODoxN1rOGVXUYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1MzY4OQ==", "bodyText": "I'd move this code into your resetPermissions function body. You do this by waiting on the updateComplete promise.\nthis.updateComplete.then(() => {\nlet inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\ninputs.forEach(elem => {\nlet role = elem.getAttribute('data-role');\nlet perm = elem.getAttribute('data-perm');\n  if (role && perm) {\n    elem.checked = this.on[role].includes(perm);\n  }\n})\n\n});\n... you get the idea. That way the  render has finished and you can manipulate the checks.", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425053689", "createdAt": "2020-05-14T11:05:05Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -65,6 +65,16 @@ class SakaiPermissions extends SakaiElement {\n   get tool() { return this._tool; }\n \n   updated(changedProperties) {\n+    let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+    inputs.forEach(elem => { \n+      let role = elem.getAttribute('data-role');\n+      let perm = elem.getAttribute('data-perm');\n+      \n+      if(role && perm){\n+        elem.checked = this.on[role].includes(perm);\n+      }\n+    })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5a0852f073f5b726dee7e3088b2ac869c0608b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NTI3Nw==", "bodyText": "blank line here please, it makes js easier to read, imo, if you leave a blank line at the start of any multi line function body, even lambdas.", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425055277", "createdAt": "2020-05-14T11:08:13Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -65,6 +65,16 @@ class SakaiPermissions extends SakaiElement {\n   get tool() { return this._tool; }\n \n   updated(changedProperties) {\n+    let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+    inputs.forEach(elem => { \n+      let role = elem.getAttribute('data-role');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5a0852f073f5b726dee7e3088b2ac869c0608b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA1NTMyOQ==", "bodyText": "Please leave a space between between if and the brace. Same for the curly brace on the end.\nif (role && perm) {\nI am very fussy about these tiny things ... :) I also like a blank line after the function definition if the body has more than one line of code in it. I am fussy, ask Miguel!", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425055329", "createdAt": "2020-05-14T11:08:17Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -65,6 +65,16 @@ class SakaiPermissions extends SakaiElement {\n   get tool() { return this._tool; }\n \n   updated(changedProperties) {\n+    let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+    inputs.forEach(elem => { \n+      let role = elem.getAttribute('data-role');\n+      let perm = elem.getAttribute('data-perm');\n+      \n+      if(role && perm){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5a0852f073f5b726dee7e3088b2ac869c0608b"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df5a0852f073f5b726dee7e3088b2ac869c0608b", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/df5a0852f073f5b726dee7e3088b2ac869c0608b", "committedDate": "2020-05-13T16:39:36Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "6600f8b0fd06ddbc954f426e7d174f181d26bb54", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/6600f8b0fd06ddbc954f426e7d174f181d26bb54", "committedDate": "2020-05-14T14:52:11Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6600f8b0fd06ddbc954f426e7d174f181d26bb54", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/6600f8b0fd06ddbc954f426e7d174f181d26bb54", "committedDate": "2020-05-14T14:52:11Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "510116b9074a8275bd0e00efe2af2322170b672e", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/510116b9074a8275bd0e00efe2af2322170b672e", "committedDate": "2020-05-14T14:56:35Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "510116b9074a8275bd0e00efe2af2322170b672e", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/510116b9074a8275bd0e00efe2af2322170b672e", "committedDate": "2020-05-14T14:56:35Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "f9d0d5766af6c35ac80377997304988f0dd93af1", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/f9d0d5766af6c35ac80377997304988f0dd93af1", "committedDate": "2020-05-14T15:19:50Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExOTM1ODAz", "url": "https://github.com/sakaiproject/sakai/pull/8221#pullrequestreview-411935803", "createdAt": "2020-05-14T15:42:39Z", "commit": {"oid": "f9d0d5766af6c35ac80377997304988f0dd93af1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTo0MjozOVrOGVibyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjowNjowOVrOGVjfNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIzNzQ1MA==", "bodyText": "You don't need a blank like on if blocks, just function bodies. Sorry for not being clear :(\nI know I am being a bit pedantic here - I just think this approach makes the js more readable later. Adding blanks before every block would be a bit too much whitespace though. So, a compromise.", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425237450", "createdAt": "2020-05-14T15:42:39Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -172,6 +172,31 @@ class SakaiPermissions extends SakaiElement {\n   }\n \n   resetPermissions() {\n+\n+    this.updateComplete.then(() => {\n+\n+      let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+      inputs.forEach(elem => {\n+\n+          let role = elem.getAttribute('data-role');\n+          let perm = elem.getAttribute('data-perm');\n+          if (role && perm) {\n+\n+            elem.checked = this.on[role].includes(perm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9d0d5766af6c35ac80377997304988f0dd93af1"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1NDcwOQ==", "bodyText": "Can't you just use \"new Event(\"change\", { bubbles: true })\" for these lines? Maybe you don't even need to bubble it.\nhttps://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425254709", "createdAt": "2020-05-14T16:06:09Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -172,6 +172,31 @@ class SakaiPermissions extends SakaiElement {\n   }\n \n   resetPermissions() {\n+\n+    this.updateComplete.then(() => {\n+\n+      let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+      inputs.forEach(elem => {\n+\n+          let role = elem.getAttribute('data-role');\n+          let perm = elem.getAttribute('data-perm');\n+          if (role && perm) {\n+\n+            elem.checked = this.on[role].includes(perm);\n+            if (\"createEvent\" in document) {\n+\n+                let evt = document.createEvent(\"HTMLEvents\");\n+                evt.initEvent(\"change\", false, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9d0d5766af6c35ac80377997304988f0dd93af1"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9d0d5766af6c35ac80377997304988f0dd93af1", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/f9d0d5766af6c35ac80377997304988f0dd93af1", "committedDate": "2020-05-14T15:19:50Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "906873df9f046e2852d07808dd072c0df2322188", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/906873df9f046e2852d07808dd072c0df2322188", "committedDate": "2020-05-14T16:23:39Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "906873df9f046e2852d07808dd072c0df2322188", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/906873df9f046e2852d07808dd072c0df2322188", "committedDate": "2020-05-14T16:23:39Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "60483a0fe993ec45432d1a504fbdd61b5a17a34a", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/60483a0fe993ec45432d1a504fbdd61b5a17a34a", "committedDate": "2020-05-14T16:33:54Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60483a0fe993ec45432d1a504fbdd61b5a17a34a", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/60483a0fe993ec45432d1a504fbdd61b5a17a34a", "committedDate": "2020-05-14T16:33:54Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "812b40835892170819159869371ad42b1c861a22", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/812b40835892170819159869371ad42b1c861a22", "committedDate": "2020-05-14T16:43:45Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDY2NTc3", "url": "https://github.com/sakaiproject/sakai/pull/8221#pullrequestreview-412066577", "createdAt": "2020-05-14T18:14:28Z", "commit": {"oid": "812b40835892170819159869371ad42b1c861a22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoxNDoyOVrOGVonKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoxNDoyOVrOGVonKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODY2NQ==", "bodyText": "I'd get rid of this test. Only really old crappy browsers don't have this. Up to you though.", "url": "https://github.com/sakaiproject/sakai/pull/8221#discussion_r425338665", "createdAt": "2020-05-14T18:14:29Z", "author": {"login": "adrianfish"}, "path": "webcomponents/tool/src/main/frontend/js/sakai-permissions.js", "diffHunk": "@@ -172,6 +172,30 @@ class SakaiPermissions extends SakaiElement {\n   }\n \n   resetPermissions() {\n+\n+    this.updateComplete.then(() => {\n+\n+      let inputs = this.renderRoot.querySelectorAll(\"input[type='checkbox']\");\n+      inputs.forEach(elem => {\n+\n+          let role = elem.getAttribute('data-role');\n+          let perm = elem.getAttribute('data-perm');\n+          if (role && perm) {\n+            let elemChanged = (elem.checked != this.on[role].includes(perm));\n+            elem.checked = this.on[role].includes(perm);\n+            if (elemChanged) {\n+              if (elem.dispatchEvent) {\n+                  elem.dispatchEvent(new Event(\"change\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "812b40835892170819159869371ad42b1c861a22"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDY3NDU4", "url": "https://github.com/sakaiproject/sakai/pull/8221#pullrequestreview-412067458", "createdAt": "2020-05-14T18:15:43Z", "commit": {"oid": "812b40835892170819159869371ad42b1c861a22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08d25c8b65f99aff2cc7845e4beb3bf763925581", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/08d25c8b65f99aff2cc7845e4beb3bf763925581", "committedDate": "2020-05-14T20:17:49Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "812b40835892170819159869371ad42b1c861a22", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/812b40835892170819159869371ad42b1c861a22", "committedDate": "2020-05-14T16:43:45Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}, "afterCommit": {"oid": "08d25c8b65f99aff2cc7845e4beb3bf763925581", "author": {"user": {"login": "frasese", "name": "Francisco Saez Segura"}}, "url": "https://github.com/sakaiproject/sakai/commit/08d25c8b65f99aff2cc7845e4beb3bf763925581", "committedDate": "2020-05-14T20:17:49Z", "message": "SAK-43649: SWITCH: Permissions widget: Stay in page after Undo Changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1933, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}