{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNjg4MTgy", "number": 8826, "title": "SAK-44447 Save dark theme to server with user pref plus detect OS theme", "bodyText": "https://jira.sakaiproject.org/browse/SAK-44447\nThe dark theme preference is now saved as a user preference. If the user preference doesn't exist yet or the user isn't logged in, we check for OS theme preference. If that doesn't exist, we default to light mode for Sakai.\nAlso cleaned up some unneeded code.\nStill a work in progress.", "createdAt": "2020-11-19T05:32:50Z", "url": "https://github.com/sakaiproject/sakai/pull/8826", "merged": true, "mergeCommit": {"oid": "0f0398dc1a596a892a5582b98ebe245dbea073a3"}, "closed": true, "closedAt": "2021-01-05T16:34:20Z", "author": {"login": "fostersdesign"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd8R2_gBqjQwMTQwODY0MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtNmADAFqTU2MTk0MzYwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62391e4ab4e40ad9e50d3682bb4e4155abc6c1da", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/62391e4ab4e40ad9e50d3682bb4e4155abc6c1da", "committedDate": "2020-11-19T05:23:12Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "7ce3473f5b6b138185defd00035c7597194684e5", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/7ce3473f5b6b138185defd00035c7597194684e5", "committedDate": "2020-11-19T05:54:15Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ce3473f5b6b138185defd00035c7597194684e5", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/7ce3473f5b6b138185defd00035c7597194684e5", "committedDate": "2020-11-19T05:54:15Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "152184ae3b5f76e9ca6839c88908ce941894c1d8", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/152184ae3b5f76e9ca6839c88908ce941894c1d8", "committedDate": "2020-11-19T05:56:24Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "152184ae3b5f76e9ca6839c88908ce941894c1d8", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/152184ae3b5f76e9ca6839c88908ce941894c1d8", "committedDate": "2020-11-19T05:56:24Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "a084079c928129b6204c9cd00620e9b47ca68a32", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/a084079c928129b6204c9cd00620e9b47ca68a32", "committedDate": "2020-11-19T06:02:20Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a084079c928129b6204c9cd00620e9b47ca68a32", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/a084079c928129b6204c9cd00620e9b47ca68a32", "committedDate": "2020-11-19T06:02:20Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "f7dd3907c408d0465eff7e59ad4cbd240ba4c449", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/f7dd3907c408d0465eff7e59ad4cbd240ba4c449", "committedDate": "2020-11-19T06:14:07Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7dd3907c408d0465eff7e59ad4cbd240ba4c449", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/f7dd3907c408d0465eff7e59ad4cbd240ba4c449", "committedDate": "2020-11-19T06:14:07Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/e71775ffc9e0d0c54b438222722cce740dfdace2", "committedDate": "2020-11-19T06:18:32Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDU0OTYx", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-534454961", "createdAt": "2020-11-19T13:41:32Z", "commit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzo0MTozM1rOH2fH0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzo0NjozOFrOH2fVRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg5NTA1Nw==", "bodyText": "This is a little redundant. Just return the result of the check:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(window.matchMedia('(prefers-color-scheme: dark)').matches) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    } else {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }\n          \n          \n            \n                    return window.matchMedia('(prefers-color-scheme: dark)').matches;", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526895057", "createdAt": "2020-11-19T13:41:33Z", "author": {"login": "bjones86"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {\n+            if(isOsDarkThemeSet()) {\n+                setThemeSwitcherToggle(true);\n+                addThemeToHTMLTag(darkThemeClass);\n+                setPortalThemeUserPref(true);\n+            } else {\n+                // to define a user preference:\n+                setPortalThemeUserPref(false);\n+            }\n+        }\n+    } else if(isOsDarkThemeSet()) {\n+        addThemeToHTMLTag(darkThemeTag);\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addThemeToHTMLTag(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeThemeFromHTMLTag(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        if(window.matchMedia('(prefers-color-scheme: dark)').matches) {\n+            return true;\n+        } else {\n+            return false;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg5NTQxOA==", "bodyText": "Same here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (portal.user.id) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    } else {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }\n          \n          \n            \n                    return portal.user.id;", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526895418", "createdAt": "2020-11-19T13:42:09Z", "author": {"login": "bjones86"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {\n+            if(isOsDarkThemeSet()) {\n+                setThemeSwitcherToggle(true);\n+                addThemeToHTMLTag(darkThemeClass);\n+                setPortalThemeUserPref(true);\n+            } else {\n+                // to define a user preference:\n+                setPortalThemeUserPref(false);\n+            }\n+        }\n+    } else if(isOsDarkThemeSet()) {\n+        addThemeToHTMLTag(darkThemeTag);\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addThemeToHTMLTag(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeThemeFromHTMLTag(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        if(window.matchMedia('(prefers-color-scheme: dark)').matches) {\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n \n-        // Set to dark mode\n-        if (themeSwitcher.getAttribute(\"aria-checked\") === \"true\") {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"false\");\n-            document.firstElementChild.classList.add('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'dark');\n+    function isLoggedIn() {\n+        if (portal.user.id) {\n+            return true;\n+        } else {\n+            return false;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg5NjIwOA==", "bodyText": "Same here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (portal.themeUserPref === \"-1\") {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    } else {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }\n          \n          \n            \n                    return portal.themeUserPref === \"-1\";", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526896208", "createdAt": "2020-11-19T13:43:20Z", "author": {"login": "bjones86"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {\n+            if(isOsDarkThemeSet()) {\n+                setThemeSwitcherToggle(true);\n+                addThemeToHTMLTag(darkThemeClass);\n+                setPortalThemeUserPref(true);\n+            } else {\n+                // to define a user preference:\n+                setPortalThemeUserPref(false);\n+            }\n+        }\n+    } else if(isOsDarkThemeSet()) {\n+        addThemeToHTMLTag(darkThemeTag);\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addThemeToHTMLTag(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeThemeFromHTMLTag(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        if(window.matchMedia('(prefers-color-scheme: dark)').matches) {\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n \n-        // Set to dark mode\n-        if (themeSwitcher.getAttribute(\"aria-checked\") === \"true\") {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"false\");\n-            document.firstElementChild.classList.add('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'dark');\n+    function isLoggedIn() {\n+        if (portal.user.id) {\n+            return true;\n+        } else {\n+            return false;\n         }\n-        // Set to light mode\n-        else {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"true\");\n-            document.firstElementChild.classList.remove('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'light')\n+    }\n+\n+    function isPortalThemeUserPrefNull() {\n+        if (portal.themeUserPref === \"-1\") {\n+            return true;\n+        } else {\n+            return false;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg5NzgyMg==", "bodyText": "Shorten this with a ternary:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                if(themePrefs.getBooleanProperty(\"darkTheme\")) {\n          \n          \n            \n                                                    themeUserPref = 1;\n          \n          \n            \n                                                } else {\n          \n          \n            \n                                                    themeUserPref = 0;\n          \n          \n            \n                                                }\n          \n          \n            \n                                                themePrefs.getBooleanProperty(\"darkTheme\") ? themeUserPref = 1 : themeUserPref = 0;", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526897822", "createdAt": "2020-11-19T13:45:35Z", "author": {"login": "bjones86"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/SkinnableCharonPortal.java", "diffHunk": "@@ -1738,13 +1738,33 @@ public void includeBottom(PortalRenderContext rcontext, Site site)\n                         \t\t\tlog.error(e1.getMessage(), e1);\n                         \t\t}\n                         \t}\n-\t\t\t\t\t\t}\n+                        }\n \n                         if(sakaiThemeSwitcherEnabled) {\n                             rcontext.put(\"themeSwitcher\", true);\n+\n+                            boolean darkTheme = false;\n+                            int themeUserPref = -1;\n+                            \n+                            ResourceProperties themePrefs = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS);\n+                            try {\n+                                    darkTheme = themePrefs.getBooleanProperty(\"darkTheme\");\n+                                    \n+                                    //temporary:\n+                                    if(themePrefs.getBooleanProperty(\"darkTheme\")) {\n+                                        themeUserPref = 1;\n+                                    } else {\n+                                        themeUserPref = 0;\n+                                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg5ODUwMA==", "bodyText": "Boolean.valueOf() not necessary here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        rcontext.put(\"darkTheme\", Boolean.valueOf(darkTheme));\n          \n          \n            \n                                        rcontext.put(\"darkTheme\", darkTheme);", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526898500", "createdAt": "2020-11-19T13:46:38Z", "author": {"login": "bjones86"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/SkinnableCharonPortal.java", "diffHunk": "@@ -1738,13 +1738,33 @@ public void includeBottom(PortalRenderContext rcontext, Site site)\n                         \t\t\tlog.error(e1.getMessage(), e1);\n                         \t\t}\n                         \t}\n-\t\t\t\t\t\t}\n+                        }\n \n                         if(sakaiThemeSwitcherEnabled) {\n                             rcontext.put(\"themeSwitcher\", true);\n+\n+                            boolean darkTheme = false;\n+                            int themeUserPref = -1;\n+                            \n+                            ResourceProperties themePrefs = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS);\n+                            try {\n+                                    darkTheme = themePrefs.getBooleanProperty(\"darkTheme\");\n+                                    \n+                                    //temporary:\n+                                    if(themePrefs.getBooleanProperty(\"darkTheme\")) {\n+                                        themeUserPref = 1;\n+                                    } else {\n+                                        themeUserPref = 0;\n+                                    }\n+                            }\n+                            catch (Exception any) { \n+                                    // We'll default to light theme\n+                            }\n+                            \n+                            rcontext.put(\"darkTheme\", Boolean.valueOf(darkTheme));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTk3NTUw", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-534597550", "createdAt": "2020-11-19T16:00:55Z", "commit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowMDo1NVrOH2lsuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowMDo1NVrOH2lsuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwMjgwOA==", "bodyText": "Change this to a Sakai generic theme class.", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r527002808", "createdAt": "2020-11-19T16:00:55Z", "author": {"login": "fostersdesign"}, "path": "portal/portal-render-engine-impl/impl/src/webapp/vm/morpheus/includeStandardHead.vm", "diffHunk": "@@ -2,7 +2,7 @@\n ## Don't put anything before the <!DOCTYPE or it breaks IE9\n ## DOCTYPE detection and puts it in quirks mode.\n <!DOCTYPE html>\n-<html lang=\"$!{locale}\" dir=\"$!{dir}\" class=\"Mrphs-html\">\n+<html lang=\"$!{locale}\" dir=\"$!{dir}\" class=\"Mrphs-html #if ( $!{darkTheme} ) sakai-dark-theme #end\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTYyMDQ3", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-534562047", "createdAt": "2020-11-19T15:26:57Z", "commit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNToyNjo1N1rOH2kCfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo0OToxNFrOH2lHYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NTYxNA==", "bodyText": "themeSwitcher && themeSwitcher.addEventListener('click', toggleDarkTheme, false);", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526975614", "createdAt": "2020-11-19T15:26:57Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzA1Mw==", "bodyText": "should this be darkThemeClass?", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526977053", "createdAt": "2020-11-19T15:28:52Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {\n+            if(isOsDarkThemeSet()) {\n+                setThemeSwitcherToggle(true);\n+                addThemeToHTMLTag(darkThemeClass);\n+                setPortalThemeUserPref(true);\n+            } else {\n+                // to define a user preference:\n+                setPortalThemeUserPref(false);\n+            }\n+        }\n+    } else if(isOsDarkThemeSet()) {\n+        addThemeToHTMLTag(darkThemeTag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzY3OQ==", "bodyText": "I'd keep my formatting consistent here. So ..\nif (isPortalThemeUserPrefNull()) {", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526977679", "createdAt": "2020-11-19T15:29:39Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3OTc0NQ==", "bodyText": "I'd just replace the function entirely, one line:\nif (portal.user.id) {\nstuff ...\n}", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526979745", "createdAt": "2020-11-19T15:32:11Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,84 @@\n function themeSwitcher(){\n \n     let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    const darkThemeClass = 'sakai-dark-theme';\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    if(themeSwitcher !== null) {\n+        themeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+    }\n \n-    if(themeSwitcher != null) {\n-        \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+    if(isLoggedIn()) {\n+        // only check for null preference because light and dark themes are already set by Java\n+        if( isPortalThemeUserPrefNull() ) {\n+            if(isOsDarkThemeSet()) {\n+                setThemeSwitcherToggle(true);\n+                addThemeToHTMLTag(darkThemeClass);\n+                setPortalThemeUserPref(true);\n+            } else {\n+                // to define a user preference:\n+                setPortalThemeUserPref(false);\n+            }\n+        }\n+    } else if(isOsDarkThemeSet()) {\n+        addThemeToHTMLTag(darkThemeTag);\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addThemeToHTMLTag(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeThemeFromHTMLTag(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        if(window.matchMedia('(prefers-color-scheme: dark)').matches) {\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n \n-        // Set to dark mode\n-        if (themeSwitcher.getAttribute(\"aria-checked\") === \"true\") {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"false\");\n-            document.firstElementChild.classList.add('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'dark');\n+    function isLoggedIn() {\n+        if (portal.user.id) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5MzI1MA==", "bodyText": "Or just one line rcontext.put(\"darkTheme\", themePrefs.getBooleanProperty(\"darkTheme\"));", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r526993250", "createdAt": "2020-11-19T15:49:14Z", "author": {"login": "adrianfish"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/SkinnableCharonPortal.java", "diffHunk": "@@ -1738,13 +1738,33 @@ public void includeBottom(PortalRenderContext rcontext, Site site)\n                         \t\t\tlog.error(e1.getMessage(), e1);\n                         \t\t}\n                         \t}\n-\t\t\t\t\t\t}\n+                        }\n \n                         if(sakaiThemeSwitcherEnabled) {\n                             rcontext.put(\"themeSwitcher\", true);\n+\n+                            boolean darkTheme = false;\n+                            int themeUserPref = -1;\n+                            \n+                            ResourceProperties themePrefs = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS);\n+                            try {\n+                                    darkTheme = themePrefs.getBooleanProperty(\"darkTheme\");\n+                                    \n+                                    //temporary:\n+                                    if(themePrefs.getBooleanProperty(\"darkTheme\")) {\n+                                        themeUserPref = 1;\n+                                    } else {\n+                                        themeUserPref = 0;\n+                                    }\n+                            }\n+                            catch (Exception any) { \n+                                    // We'll default to light theme\n+                            }\n+                            \n+                            rcontext.put(\"darkTheme\", Boolean.valueOf(darkTheme));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e71775ffc9e0d0c54b438222722cce740dfdace2", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/e71775ffc9e0d0c54b438222722cce740dfdace2", "committedDate": "2020-11-19T06:18:32Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/993b310a1e7f44c03369f27bf11ee635eadebbb9", "committedDate": "2020-12-17T05:23:53Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzM5OTg3", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-554739987", "createdAt": "2020-12-17T15:54:24Z", "commit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1NDoyNFrOIH8T-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1NDoyNFrOIH8T-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE5OTA5Ng==", "bodyText": "const isPortalThemeUserPrefUnset = () => !portal.userTheme;", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r545199096", "createdAt": "2020-12-17T15:54:24Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,97 @@\n-function themeSwitcher(){\n+function sakaiThemeSwitcher(){\n \n-    let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    let darkThemeSwitcher = document.getElementById(\"sakai-darkThemeSwitcher\");\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    const defaultThemeClass = 'sakaiUserTheme-notSet';\n+    const lightThemeClass = 'sakaiUserTheme-light';\n+    const darkThemeClass = 'sakaiUserTheme-dark';\n \n-    if(themeSwitcher != null) {\n+    init();\n+    \n+    function init() {\n+        // attach listener to dark theme toggle switch\n+        darkThemeSwitcher && darkThemeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+\n+        if(isLoggedIn()) {\n+            // only check for unset theme preference because light and dark themes are already set by Java\n+            if(isPortalThemeUserPrefUnset()) {\n+                if(isOsDarkThemeSet()) {\n+                    enableDarkTheme();\n+                } else {\n+                    // to define a user preference:\n+                    setPortalThemeUserPref(lightThemeClass);\n+                }\n+            }\n+        } else if(isOsDarkThemeSet()) {\n+            addCssClassToMarkup(darkThemeClass);\n+        }\n         \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+        if (document.documentElement.classList.contains(darkThemeClass)) {\n+            // the dark theme switch toggle is off by default, so toggle to on if dark theme is enabled\n+            setDarkThemeSwitcherToggle(true);\n+        }\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addCssClassToMarkup(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeCssClassFromMarkup(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n+    }\n+\n+    function isLoggedIn() {\n+        return portal.user.id;\n+    }\n \n-        // Set to dark mode\n-        if (themeSwitcher.getAttribute(\"aria-checked\") === \"true\") {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"false\");\n-            document.firstElementChild.classList.add('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'dark');\n+    function isPortalThemeUserPrefUnset() {\n+        if (portal.userTheme === \"\") {\n+            return true;\n+        } else {\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzQzMjE4", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-554743218", "createdAt": "2020-12-17T15:57:34Z", "commit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1NzozNFrOIH8eJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1NzozNFrOIH8eJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwMTcwMg==", "bodyText": "darkThemeSwitcher.getAttribute(\"aria-checked\") === \"false\" ? enableDarkTheme() : enableLightTheme();", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r545201702", "createdAt": "2020-12-17T15:57:34Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,97 @@\n-function themeSwitcher(){\n+function sakaiThemeSwitcher(){\n \n-    let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    let darkThemeSwitcher = document.getElementById(\"sakai-darkThemeSwitcher\");\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    const defaultThemeClass = 'sakaiUserTheme-notSet';\n+    const lightThemeClass = 'sakaiUserTheme-light';\n+    const darkThemeClass = 'sakaiUserTheme-dark';\n \n-    if(themeSwitcher != null) {\n+    init();\n+    \n+    function init() {\n+        // attach listener to dark theme toggle switch\n+        darkThemeSwitcher && darkThemeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+\n+        if(isLoggedIn()) {\n+            // only check for unset theme preference because light and dark themes are already set by Java\n+            if(isPortalThemeUserPrefUnset()) {\n+                if(isOsDarkThemeSet()) {\n+                    enableDarkTheme();\n+                } else {\n+                    // to define a user preference:\n+                    setPortalThemeUserPref(lightThemeClass);\n+                }\n+            }\n+        } else if(isOsDarkThemeSet()) {\n+            addCssClassToMarkup(darkThemeClass);\n+        }\n         \n-        initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+        if (document.documentElement.classList.contains(darkThemeClass)) {\n+            // the dark theme switch toggle is off by default, so toggle to on if dark theme is enabled\n+            setDarkThemeSwitcherToggle(true);\n+        }\n+    }\n \n-        themeSwitcher.addEventListener('click', setTheme, false);\n+    function addCssClassToMarkup(themeClass) {\n+        document.documentElement.classList.add(themeClass);\n+    }\n \n+    function removeCssClassFromMarkup(themeClass) {\n+        document.documentElement.classList.remove(themeClass);\n     }\n \n-    function setTheme() {\n+    function isOsDarkThemeSet() {\n+        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n+    }\n+\n+    function isLoggedIn() {\n+        return portal.user.id;\n+    }\n \n-        // Set to dark mode\n-        if (themeSwitcher.getAttribute(\"aria-checked\") === \"true\") {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"false\");\n-            document.firstElementChild.classList.add('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'dark');\n+    function isPortalThemeUserPrefUnset() {\n+        if (portal.userTheme === \"\") {\n+            return true;\n+        } else {\n+            return false;\n         }\n-        // Set to light mode\n-        else {\n-            themeSwitcher.setAttribute(\"aria-checked\", \"true\");\n-            document.firstElementChild.classList.remove('sakai-dark-theme');\n-            localStorage.setItem('sakai-theme', 'light')\n+    }\n+\n+    function setDarkThemeSwitcherToggle(onOff) {\n+        darkThemeSwitcher.setAttribute(\"aria-checked\", onOff);\n+    }\n+\n+    function setPortalThemeUserPref(theme) {\n+        var url = '/direct/userPrefs/updateKey/' + portal.user.id + '/sakai:portal:theme?theme=' + theme;\n+        var ajaxRequest = new XMLHttpRequest();\n+        ajaxRequest.open(\"PUT\", url);\n+        ajaxRequest.send();\n+    }\n+\n+    function toggleDarkTheme() {\n+        // Set to dark theme\n+        if (darkThemeSwitcher.getAttribute(\"aria-checked\") === \"false\") {\n+            enableDarkTheme();\n+        } else {\n+            // Set to light theme\n+            enableLightTheme();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzQ0ODMx", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-554744831", "createdAt": "2020-12-17T15:59:10Z", "commit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1OToxMFrOIH8jEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNTo1OToxMFrOIH8jEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwMjk2Mw==", "bodyText": "PEDANT ALERT: I like a single space after the if. You've done that in some places.", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r545202963", "createdAt": "2020-12-17T15:59:10Z", "author": {"login": "adrianfish"}, "path": "portal/portal-charon/charon/src/webapp/scripts/themeswitcher.js", "diffHunk": "@@ -1,43 +1,97 @@\n-function themeSwitcher(){\n+function sakaiThemeSwitcher(){\n \n-    let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+    let darkThemeSwitcher = document.getElementById(\"sakai-darkThemeSwitcher\");\n \n-    SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+    const defaultThemeClass = 'sakaiUserTheme-notSet';\n+    const lightThemeClass = 'sakaiUserTheme-light';\n+    const darkThemeClass = 'sakaiUserTheme-dark';\n \n-    if(themeSwitcher != null) {\n+    init();\n+    \n+    function init() {\n+        // attach listener to dark theme toggle switch\n+        darkThemeSwitcher && darkThemeSwitcher.addEventListener('click', toggleDarkTheme, false);\n+\n+        if(isLoggedIn()) {\n+            // only check for unset theme preference because light and dark themes are already set by Java\n+            if(isPortalThemeUserPrefUnset()) {\n+                if(isOsDarkThemeSet()) {\n+                    enableDarkTheme();\n+                } else {\n+                    // to define a user preference:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzUwNjI0", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-554750624", "createdAt": "2020-12-17T16:05:03Z", "commit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowNTowM1rOIH80kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowNTowM1rOIH80kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzQ0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        String userTheme = \"sakaiUserTheme-notSet\";\n          \n          \n            \n                                        \n          \n          \n            \n                                        //ResourceProperties themePrefs = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS);\n          \n          \n            \n                                        userTheme = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS).getProperty(\"theme\");\n          \n          \n            \n                                        String userTheme = StringUtils.defaultIfEmpty(prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS).getProperty(\"theme\"), \"sakaiUserTheme-notSet\");", "url": "https://github.com/sakaiproject/sakai/pull/8826#discussion_r545207440", "createdAt": "2020-12-17T16:05:03Z", "author": {"login": "ern"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/SkinnableCharonPortal.java", "diffHunk": "@@ -1735,13 +1735,18 @@ public void includeBottom(PortalRenderContext rcontext, Site site)\n                         \t\t\tlog.error(e1.getMessage(), e1);\n                         \t\t}\n                         \t}\n-\t\t\t\t\t\t}\n+                        }\n \n                         if(sakaiThemeSwitcherEnabled) {\n                             rcontext.put(\"themeSwitcher\", true);\n+                            \n+                            String userTheme = \"sakaiUserTheme-notSet\";\n+                            \n+                            //ResourceProperties themePrefs = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS);\n+                            userTheme = prefs.getProperties(org.sakaiproject.user.api.PreferencesService.USER_SELECTED_UI_THEME_PREFS).getProperty(\"theme\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "993b310a1e7f44c03369f27bf11ee635eadebbb9", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/993b310a1e7f44c03369f27bf11ee635eadebbb9", "committedDate": "2020-12-17T05:23:53Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "d05e1c7b05bd56973b874017ea29696a3c747055", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/d05e1c7b05bd56973b874017ea29696a3c747055", "committedDate": "2020-12-23T21:06:23Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64766e5649fe8a59a4a06161a64063044c020f9a", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/64766e5649fe8a59a4a06161a64063044c020f9a", "committedDate": "2020-12-23T21:33:03Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d05e1c7b05bd56973b874017ea29696a3c747055", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/d05e1c7b05bd56973b874017ea29696a3c747055", "committedDate": "2020-12-23T21:06:23Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}, "afterCommit": {"oid": "64766e5649fe8a59a4a06161a64063044c020f9a", "author": {"user": {"login": "fostersdesign", "name": "Shawn Foster"}}, "url": "https://github.com/sakaiproject/sakai/commit/64766e5649fe8a59a4a06161a64063044c020f9a", "committedDate": "2020-12-23T21:33:03Z", "message": "SAK-44447 Save dark theme to server with user pref plus detect OS theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxOTQyMjg5", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-561942289", "createdAt": "2021-01-05T16:32:40Z", "commit": {"oid": "64766e5649fe8a59a4a06161a64063044c020f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxOTQyNzQ0", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-561942744", "createdAt": "2021-01-05T16:33:11Z", "commit": {"oid": "64766e5649fe8a59a4a06161a64063044c020f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxOTQzNjAx", "url": "https://github.com/sakaiproject/sakai/pull/8826#pullrequestreview-561943601", "createdAt": "2021-01-05T16:34:06Z", "commit": {"oid": "64766e5649fe8a59a4a06161a64063044c020f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2505, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}