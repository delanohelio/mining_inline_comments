{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDMwMjg2", "number": 8438, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwODozMTo0MVrOEXHAIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwODo0ODoyMFrOEXHY1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNjY3NDI2OnYy", "diffSide": "RIGHT", "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwODozMTo0MVrOG-tycw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMzowODo1NFrOG_ggNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQxNTA5MQ==", "bodyText": "I'd just make hidden a boolean. You don't use that string in any console output, so there's no point overcomplicating it. Actually, forget that. I'd just use document.hidden. It's supported in all the browsers we're interested in. Sakai won't work in IE < 10, anyway. I'd just remove your hidden var and use document.hidden.", "url": "https://github.com/sakaiproject/sakai/pull/8438#discussion_r468415091", "createdAt": "2020-08-11T08:31:41Z", "author": {"login": "adrianfish"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "diffHunk": "@@ -1,4 +1,49 @@\n-function updatePresence(){\n+var active_tab_listener_attached = false; // initial load\n+\n+// Set the name of the hidden property and the change event for visibility\n+var hidden, visibilityChange;\n+if (typeof document.hidden !== \"undefined\") { // Opera 12.10 and Firefox 18 and later support \n+    hidden = \"hidden\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fe378b2af7364f126e8f80bb07872eece04c81e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0NDY2OA==", "bodyText": "I'm going to remove the variable declaration - it's not used (should have seen that ;p) and it works without it.\nBrowser support for the Page Visibility API is currently good.\nIE - 10+\nFirefox - 10+\nChrome - 14+\nSafari - 6.1+\nOpera - 12.1+", "url": "https://github.com/sakaiproject/sakai/pull/8438#discussion_r469244668", "createdAt": "2020-08-12T13:06:47Z", "author": {"login": "TurRil"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "diffHunk": "@@ -1,4 +1,49 @@\n-function updatePresence(){\n+var active_tab_listener_attached = false; // initial load\n+\n+// Set the name of the hidden property and the change event for visibility\n+var hidden, visibilityChange;\n+if (typeof document.hidden !== \"undefined\") { // Opera 12.10 and Firefox 18 and later support \n+    hidden = \"hidden\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQxNTA5MQ=="}, "originalCommit": {"oid": "2fe378b2af7364f126e8f80bb07872eece04c81e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0NjAwNw==", "bodyText": "Awesome browser support. Great.", "url": "https://github.com/sakaiproject/sakai/pull/8438#discussion_r469246007", "createdAt": "2020-08-12T13:08:54Z", "author": {"login": "ottenhoff"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "diffHunk": "@@ -1,4 +1,49 @@\n-function updatePresence(){\n+var active_tab_listener_attached = false; // initial load\n+\n+// Set the name of the hidden property and the change event for visibility\n+var hidden, visibilityChange;\n+if (typeof document.hidden !== \"undefined\") { // Opera 12.10 and Firefox 18 and later support \n+    hidden = \"hidden\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQxNTA5MQ=="}, "originalCommit": {"oid": "2fe378b2af7364f126e8f80bb07872eece04c81e"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNjczNzQ5OnYy", "diffSide": "RIGHT", "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwODo0ODoyMFrOG-uY2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMzowNjo0M1rOG_gawg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQyNDkyMQ==", "bodyText": "I think you should be using your variable  \"visibilityChange\" from earlier. Although perhaps \"visibiitychange\" just works on all the modern browsers now. Anyway, you should use that variable you created.", "url": "https://github.com/sakaiproject/sakai/pull/8438#discussion_r468424921", "createdAt": "2020-08-11T08:48:20Z", "author": {"login": "adrianfish"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "diffHunk": "@@ -1,4 +1,49 @@\n-function updatePresence(){\n+var active_tab_listener_attached = false; // initial load\n+\n+// Set the name of the hidden property and the change event for visibility\n+var hidden, visibilityChange;\n+if (typeof document.hidden !== \"undefined\") { // Opera 12.10 and Firefox 18 and later support \n+    hidden = \"hidden\";\n+    visibilityChange = \"visibilitychange\";\n+} else if (typeof document.msHidden !== \"undefined\") {\n+    hidden = \"msHidden\";\n+    visibilityChange = \"msvisibilitychange\";\n+} else if (typeof document.webkitHidden !== \"undefined\") {\n+    hidden = \"webkitHidden\";\n+    visibilityChange = \"webkitvisibilitychange\";\n+}\n+\n+function updatePresenceTimeout(_ms, _go) {\n+    if (window.sakaiLastPresenceTimeOut != null) {\n+        clearTimeout(window.sakaiLastPresenceTimeOut);\n+        window.sakaiLastPresenceTimeOut = null;\n+    }\n+    if (_go) {\n+        window.sakaiLastPresenceTimeOut = setTimeout('updatePresence()', _ms);\n+    }\n+}\n+\n+// Triggers when visibility changes\n+function handleVisibilityChange() {\n+    if (document.hidden) {\n+        console.log(\"hidden\");\n+        updatePresenceTimeout(window.sakaiPresenceTimeDelay, false); //stop\n+    } else  {\n+        console.log(\"visible\");\n+        updatePresenceTimeout(window.sakaiPresenceTimeDelay, false); \n+        updatePresence(); //start immediately\n+    }\n+}\n+\n+function updatePresence() {\n+  if (!active_tab_listener_attached) {\n+    document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fe378b2af7364f126e8f80bb07872eece04c81e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0NDYxMA==", "bodyText": "Yes, can pretty much remove the variable declaration and run it as is.", "url": "https://github.com/sakaiproject/sakai/pull/8438#discussion_r469244610", "createdAt": "2020-08-12T13:06:43Z", "author": {"login": "TurRil"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.update.presence.js", "diffHunk": "@@ -1,4 +1,49 @@\n-function updatePresence(){\n+var active_tab_listener_attached = false; // initial load\n+\n+// Set the name of the hidden property and the change event for visibility\n+var hidden, visibilityChange;\n+if (typeof document.hidden !== \"undefined\") { // Opera 12.10 and Firefox 18 and later support \n+    hidden = \"hidden\";\n+    visibilityChange = \"visibilitychange\";\n+} else if (typeof document.msHidden !== \"undefined\") {\n+    hidden = \"msHidden\";\n+    visibilityChange = \"msvisibilitychange\";\n+} else if (typeof document.webkitHidden !== \"undefined\") {\n+    hidden = \"webkitHidden\";\n+    visibilityChange = \"webkitvisibilitychange\";\n+}\n+\n+function updatePresenceTimeout(_ms, _go) {\n+    if (window.sakaiLastPresenceTimeOut != null) {\n+        clearTimeout(window.sakaiLastPresenceTimeOut);\n+        window.sakaiLastPresenceTimeOut = null;\n+    }\n+    if (_go) {\n+        window.sakaiLastPresenceTimeOut = setTimeout('updatePresence()', _ms);\n+    }\n+}\n+\n+// Triggers when visibility changes\n+function handleVisibilityChange() {\n+    if (document.hidden) {\n+        console.log(\"hidden\");\n+        updatePresenceTimeout(window.sakaiPresenceTimeDelay, false); //stop\n+    } else  {\n+        console.log(\"visible\");\n+        updatePresenceTimeout(window.sakaiPresenceTimeDelay, false); \n+        updatePresence(); //start immediately\n+    }\n+}\n+\n+function updatePresence() {\n+  if (!active_tab_listener_attached) {\n+    document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQyNDkyMQ=="}, "originalCommit": {"oid": "2fe378b2af7364f126e8f80bb07872eece04c81e"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2816, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}