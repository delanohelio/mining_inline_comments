{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMDA2NTk4", "number": 8068, "title": "SAK-43470 TurnitinOC: Pass TCA user roles when submitting and viewing\u2026", "bodyText": "\u2026 reports", "createdAt": "2020-03-24T13:56:54Z", "url": "https://github.com/sakaiproject/sakai/pull/8068", "merged": true, "mergeCommit": {"oid": "e1fa55ee2a82bb91bb03383573c93f68a7464c96"}, "closed": true, "closedAt": "2020-03-25T14:32:49Z", "author": {"login": "baholladay"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQzXYXAFqTM4MDMzNTUyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ5IZjABqjMxNjE0ODc3NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzM1NTIw", "url": "https://github.com/sakaiproject/sakai/pull/8068#pullrequestreview-380335520", "createdAt": "2020-03-24T13:59:33Z", "commit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMzo1OTozM1rOF6xifQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMzo1OTozM1rOF6xifQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3MzM3Mw==", "bodyText": "I just looked through the existing default templates... are there any default Sakai roles that I may have missed? Custom roles can be mapped in the sakai.properties?", "url": "https://github.com/sakaiproject/sakai/pull/8068#discussion_r397173373", "createdAt": "2020-03-24T13:59:33Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin-oc/src/main/java/org/sakaiproject/contentreview/turnitin/oc/ContentReviewServiceTurnitinOC.java", "diffHunk": "@@ -159,8 +166,26 @@\n \tprivate static final String VIEWER_PERMISSION_MAY_VIEW_SUBMISSIONS_FULL_SOURCE = \"may_view_submission_full_source\";\n \tprivate static final String VIEWER_PERMISSION_MAY_VIEW_MATCH_SUBMISSION_INFO = \"may_view_match_submission_info\";\n \tprivate static final String VIEWER_DEFAULT_PERMISSIONS = \"viewer_default_permission_set\";\n-\tprivate static final String INSTRUCTOR = \"INSTRUCTOR\";\n-\tprivate static final String LEARNER = \"LEARNER\";\n+\tprivate enum ROLES{\n+\t\tINSTRUCTOR(Arrays.asList(\"Faculty\", \"Instructor\", \"Mentor\", \"Staff\", \"maintain\", \"Teaching Assistant\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzYzOTQ4", "url": "https://github.com/sakaiproject/sakai/pull/8068#pullrequestreview-380363948", "createdAt": "2020-03-24T14:28:26Z", "commit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDoyODoyNlrOF6y3uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDoyODoyNlrOF6y3uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5NTE5NQ==", "bodyText": "Can this be put into the above if(site != null) block? Conditional seems duplicated.\nEdit: disregard, I didn't notice the check on submitterID", "url": "https://github.com/sakaiproject/sakai/pull/8068#discussion_r397195195", "createdAt": "2020-03-24T14:28:26Z", "author": {"login": "bjones86"}, "path": "content-review/impl/turnitin-oc/src/main/java/org/sakaiproject/contentreview/turnitin/oc/ContentReviewServiceTurnitinOC.java", "diffHunk": "@@ -883,8 +911,14 @@ private String getSubmissionId(ContentReviewItem item, String fileName, Site sit\n \t\t\t// Build header maps\n \t\t\tMap<String, Object> data = new HashMap<String, Object>();\n \t\t\tdata.put(\"owner\", userID);\n+\t\t\tif(site != null) {\n+\t\t\t\tdata.put(\"owner_default_permission_set\", mapUserRole(userID, site.getId(), false));\n+\t\t\t}\n \t\t\tif (StringUtils.isNotBlank(submitterID)) {\n-\t\t\t\tdata.put(\"submitter\", submitterID);\t\n+\t\t\t\tdata.put(\"submitter\", submitterID);\n+\t\t\t\tif(site != null) {\n+\t\t\t\t\tdata.put(\"submitter_default_permission_set\", mapUserRole(submitterID, site.getId(), false));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNDAyMTE2", "url": "https://github.com/sakaiproject/sakai/pull/8068#pullrequestreview-380402116", "createdAt": "2020-03-24T15:06:06Z", "commit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNDE0NjIy", "url": "https://github.com/sakaiproject/sakai/pull/8068#pullrequestreview-380414622", "createdAt": "2020-03-24T15:18:45Z", "commit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c959bc07d55c0c0eea47a2d57ab69c8c91734d8b", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/c959bc07d55c0c0eea47a2d57ab69c8c91734d8b", "committedDate": "2020-03-24T20:42:17Z", "message": "SAK-43470 TurnitinOC: Pass TCA user roles when submitting and viewing reports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b64d039a31ebd926c020ef91787ebe4f80f1b1d", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/8b64d039a31ebd926c020ef91787ebe4f80f1b1d", "committedDate": "2020-03-24T13:56:05Z", "message": "SAK-43470 TurnitinOC: Pass TCA user roles when submitting and viewing reports"}, "afterCommit": {"oid": "c959bc07d55c0c0eea47a2d57ab69c8c91734d8b", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/c959bc07d55c0c0eea47a2d57ab69c8c91734d8b", "committedDate": "2020-03-24T20:42:17Z", "message": "SAK-43470 TurnitinOC: Pass TCA user roles when submitting and viewing reports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2119, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}