{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MzU3NzI0", "number": 8789, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMToyNVrOE2GPeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNzoyN1rOE2GY6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYwODI2OnYy", "diffSide": "RIGHT", "path": "config/configuration/bundles/src/bundle/org/sakaiproject/config/bundle/default.sakai.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMToyNVrOHuvLOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToyNDoyMlrOHuybig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2OTQ2Ng==", "bodyText": "you may want to change this to snake case to be consistent with the other permissions", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518769466", "createdAt": "2020-11-06T14:01:25Z", "author": {"login": "baholladay"}, "path": "config/configuration/bundles/src/bundle/org/sakaiproject/config/bundle/default.sakai.properties", "diffHunk": "@@ -2074,6 +2074,10 @@\n # turnitin.report_gen_speed.setting.2=1\n # turnitin.report_gen_speed.setting.3=2\n \n+# Allow Sakai TAs to be sent to Turnitin as Instructors so they can view TII reports\n+# DEFAULT: false\n+# turnitin.enrollAssistantsAsInstructors=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyMjc5NA==", "bodyText": "agree", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518822794", "createdAt": "2020-11-06T15:24:22Z", "author": {"login": "ottenhoff"}, "path": "config/configuration/bundles/src/bundle/org/sakaiproject/config/bundle/default.sakai.properties", "diffHunk": "@@ -2074,6 +2074,10 @@\n # turnitin.report_gen_speed.setting.2=1\n # turnitin.report_gen_speed.setting.3=2\n \n+# Allow Sakai TAs to be sent to Turnitin as Instructors so they can view TII reports\n+# DEFAULT: false\n+# turnitin.enrollAssistantsAsInstructors=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2OTQ2Ng=="}, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYxMjg0OnYy", "diffSide": "RIGHT", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjozM1rOHuvN8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjozM1rOHuvN8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDE2MQ==", "bodyText": "@SuppressWarnings is not needed any longer", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770161", "createdAt": "2020-11-06T14:02:33Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYxMzQ1OnYy", "diffSide": "RIGHT", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjo0M1rOHuvOTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjo0M1rOHuvOTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDI1NQ==", "bodyText": "@SuppressWarnings is not needed any longer", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770255", "createdAt": "2020-11-06T14:02:43Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")\n-\tpublic Map getInstructorInfo(String siteId) {\n+\tpublic Map<String, String> getInstructorInfo(String siteId) {\n \t\treturn getInstructorInfo(siteId, false);\n \t}\n \n \t@SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYxNjY2OnYy", "diffSide": "RIGHT", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMzo0MFrOHuvQPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMzo0MFrOHuvQPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDc1MQ==", "bodyText": "final isn't needed", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770751", "createdAt": "2020-11-06T14:03:40Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYxODc3OnYy", "diffSide": "RIGHT", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNDoxMFrOHuvRgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToyNTo0NFrOHuyfFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MTA3Mg==", "bodyText": "spacing", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518771072", "createdAt": "2020-11-06T14:04:10Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {\n+\t\ttry {\n+\t\t\tSite site = siteService.getSite(siteId);\n+\t\t\treturn getActiveUsersForRole(rolePermission, site);\n+\t\t} catch (IdUnusedException e) {\n+\t\t\tlog.info(\"Ignoring site \" + siteId + \" which no longer exists.\");\n+\t\t}\n+\n+    return new HashSet<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyMzcwMw==", "bodyText": "yup tabs", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518823703", "createdAt": "2020-11-06T15:25:44Z", "author": {"login": "ottenhoff"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {\n+\t\ttry {\n+\t\t\tSite site = siteService.getSite(siteId);\n+\t\t\treturn getActiveUsersForRole(rolePermission, site);\n+\t\t} catch (IdUnusedException e) {\n+\t\t\tlog.info(\"Ignoring site \" + siteId + \" which no longer exists.\");\n+\t\t}\n+\n+    return new HashSet<String>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MTA3Mg=="}, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTYzMjQxOnYy", "diffSide": "RIGHT", "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNzoyN1rOHuvZWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNToyNjoyMFrOHuygqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MzA4MQ==", "bodyText": "is final needed here?", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518773081", "createdAt": "2020-11-06T14:07:27Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2750,39 +2768,13 @@ private User getUser(String userid) {\n \t\treturn user;\n \t}\n \n-\t/**\n-\t * Return a Map containing all users of x type enrolled on a site\n-\t * @param siteId Sakai site ID\n-\t * @param role specific user role e.g. 'instructor'\n-\t * @return\n-\t */\n-\t@SuppressWarnings(\"unchecked\")\n-\tprivate Map getAllUsers(String siteId, String role) {\n-\t\tString ROLE = \"section.role.\"+role;\n-\t\tMap<String,String> users = new HashMap<>();\n-\t\tSite site = null;\n-\t\ttry {\n-\t\t\tsite = siteService.getSite(siteId);\n-\t\t\tSet<String> instIds = site.getUsersIsAllowed(ROLE);\n-\t\t\tList<User> activeUsers = userDirectoryService.getUsers(instIds);\n-\t\t\tfor (int i = 0; i < activeUsers.size(); i++) {\n-\t\t\t\tUser user = activeUsers.get(i);\n-\t\t\t\tusers.put(user.getId(),user.getId());\n-\t\t\t}\n-\t\t} catch (IdUnusedException e) {\n-\t\t\tlog.error(\"Unable to fetch site in getAllUsers: \" + siteId, e);\n-\t\t} catch (Exception e) {\n-\t\t\tlog.error(\"Exception in getAllUsers\", e);\n-\t\t}\n-\t\treturn users;\n-\t}\n \t/**\n \t * The primary method of this class. Syncs the enrollment between a Sakai\n \t * Site and it's corresponding\n \t *\n \t * @param sakaiSiteID\n \t */\n-\tprivate boolean syncSiteWithTurnitin(String sakaiSiteID) {\n+\tprivate boolean syncSiteWithTurnitin(final String sakaiSiteID) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyNDEwNQ==", "bodyText": "not really needed just helps me when doing refactoring as the IDE then lets me know if the value is being manipulated", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518824105", "createdAt": "2020-11-06T15:26:20Z", "author": {"login": "ottenhoff"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2750,39 +2768,13 @@ private User getUser(String userid) {\n \t\treturn user;\n \t}\n \n-\t/**\n-\t * Return a Map containing all users of x type enrolled on a site\n-\t * @param siteId Sakai site ID\n-\t * @param role specific user role e.g. 'instructor'\n-\t * @return\n-\t */\n-\t@SuppressWarnings(\"unchecked\")\n-\tprivate Map getAllUsers(String siteId, String role) {\n-\t\tString ROLE = \"section.role.\"+role;\n-\t\tMap<String,String> users = new HashMap<>();\n-\t\tSite site = null;\n-\t\ttry {\n-\t\t\tsite = siteService.getSite(siteId);\n-\t\t\tSet<String> instIds = site.getUsersIsAllowed(ROLE);\n-\t\t\tList<User> activeUsers = userDirectoryService.getUsers(instIds);\n-\t\t\tfor (int i = 0; i < activeUsers.size(); i++) {\n-\t\t\t\tUser user = activeUsers.get(i);\n-\t\t\t\tusers.put(user.getId(),user.getId());\n-\t\t\t}\n-\t\t} catch (IdUnusedException e) {\n-\t\t\tlog.error(\"Unable to fetch site in getAllUsers: \" + siteId, e);\n-\t\t} catch (Exception e) {\n-\t\t\tlog.error(\"Exception in getAllUsers\", e);\n-\t\t}\n-\t\treturn users;\n-\t}\n \t/**\n \t * The primary method of this class. Syncs the enrollment between a Sakai\n \t * Site and it's corresponding\n \t *\n \t * @param sakaiSiteID\n \t */\n-\tprivate boolean syncSiteWithTurnitin(String sakaiSiteID) {\n+\tprivate boolean syncSiteWithTurnitin(final String sakaiSiteID) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MzA4MQ=="}, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 141}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2515, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}