{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MjU4MDQy", "number": 8171, "title": "SAK-43502 Recover focus after updating cells and avoid data lose afte\u2026", "bodyText": "\u2026r adding a new category", "createdAt": "2020-04-22T12:28:46Z", "url": "https://github.com/sakaiproject/sakai/pull/8171", "merged": true, "mergeCommit": {"oid": "20804e2ea9beb7069cfb8466ce8f5ca0c6866555"}, "closed": true, "closedAt": "2020-08-31T16:53:50Z", "author": {"login": "josecebe"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaHcy3AFqTM5ODEzODM3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEVviqAFqTQ3ODc3OTI1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTM4Mzc1", "url": "https://github.com/sakaiproject/sakai/pull/8171#pullrequestreview-398138375", "createdAt": "2020-04-22T12:28:53Z", "commit": {"oid": "a46b5f4e2c812fadf25ade2dea5d820884d0f551"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMjoyODo1M1rOGJzuKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMjoyODo1NFrOGJzuKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzNzc2OA==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r412937768", "createdAt": "2020-04-22T12:28:53Z", "author": {"login": "accesslint"}, "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b5f4e2c812fadf25ade2dea5d820884d0f551"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzNzc3MA==", "bodyText": "Looks like there's a label missing for this input. That makes it hard for people using screen readers or voice control to use the input.", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r412937770", "createdAt": "2020-04-22T12:28:54Z", "author": {"login": "accesslint"}, "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b5f4e2c812fadf25ade2dea5d820884d0f551"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6", "author": {"user": {"login": "josecebe", "name": "Jose Cebell\u00e1n"}}, "url": "https://github.com/sakaiproject/sakai/commit/1261a15032bfc7bc7dba45067003e22d883f05c6", "committedDate": "2020-04-23T12:09:32Z", "message": "SAK-43502 Recover focus after updating cells and avoid data lose after adding a new category"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a46b5f4e2c812fadf25ade2dea5d820884d0f551", "author": {"user": {"login": "josecebe", "name": "Jose Cebell\u00e1n"}}, "url": "https://github.com/sakaiproject/sakai/commit/a46b5f4e2c812fadf25ade2dea5d820884d0f551", "committedDate": "2020-04-22T12:27:28Z", "message": "SAK-43502 Recover focus after updating cells and avoid data lose after adding a new category"}, "afterCommit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6", "author": {"user": {"login": "josecebe", "name": "Jose Cebell\u00e1n"}}, "url": "https://github.com/sakaiproject/sakai/commit/1261a15032bfc7bc7dba45067003e22d883f05c6", "committedDate": "2020-04-23T12:09:32Z", "message": "SAK-43502 Recover focus after updating cells and avoid data lose after adding a new category"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxODMzMTYy", "url": "https://github.com/sakaiproject/sakai/pull/8171#pullrequestreview-401833162", "createdAt": "2020-04-28T13:27:33Z", "commit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMzoyNzozM1rOGNT-AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMzo1NDoyOFrOGNVOWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYxMTg0MQ==", "bodyText": "I'd put an aria-label on this.", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416611841", "createdAt": "2020-04-28T13:27:33Z", "author": {"login": "adrianfish"}, "path": "gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.html", "diffHunk": "@@ -42,8 +42,8 @@ <h3 class=\"panel-title\">\n \t\t\t\t\t\t\t\t\t</thead>\n \t\t\t\t\t\t\t\t\t<tbody>\n \t\t\t\t\t\t\t\t\t<tr wicket:id=\"schemaView\" class=\"gb-schema-row\">\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n-\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"minPercent\" type=\"text\" size=\"10\" class=\"form-control\" /></td>\n+\t\t\t\t\t\t\t\t\t\t<td><input wicket:id=\"grade\" type=\"text\" size=\"10\" class=\"form-control schema-input\" /></td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYyNTU1OA==", "bodyText": "I'd just use vanillajs here. jQuery seems like overkill\nif (document.activeElement.classList.contains(\"schema-input\")) {\nsakai.gradebookng.settings.gradingschemas.cellName = document.activeElement.getAttribute('name');\n}", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416625558", "createdAt": "2020-04-28T13:45:39Z", "author": {"login": "adrianfish"}, "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzMDEyNg==", "bodyText": "This seems an expensive lookup. It looks like it will scan the entire dom for this attribute and that can be a lot of markup in gbng. I'd anchor the search using an id from an ancestor. Lot faster.", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416630126", "createdAt": "2020-04-28T13:51:32Z", "author": {"login": "adrianfish"}, "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);\n+  if ($activeElement.hasClass('schema-input')) {\n+    sakai.gradebookng.settings.gradingschemas.cellName = $activeElement.attr('name');\n+  }\n+}\n+\n+GradebookGradingSchemaSettings.prototype.focusPreviousCell = function() {\n+  // This is a trick to focus the previous focused cell after table re-render\n+  var cellName = sakai.gradebookng.settings.gradingschemas.cellName;\n+  var $inputSameName = $('[name=\"' + cellName + '\"]');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYzMjQxMA==", "bodyText": "Generally, I'd use vanillajs here. You can use querySelectorAll and forEach on the results of that.", "url": "https://github.com/sakaiproject/sakai/pull/8171#discussion_r416632410", "createdAt": "2020-04-28T13:54:28Z", "author": {"login": "adrianfish"}, "path": "gradebookng/tool/src/webapp/scripts/gradebook-settings.js", "diffHunk": "@@ -100,6 +108,23 @@ GradebookGradingSchemaSettings.prototype.focusLastRow = function() {\n   Wicket.Focus.setFocusOnId($input.attr(\"id\"));\n }\n \n+GradebookGradingSchemaSettings.prototype.getFocusedCell = function() {\n+  var $activeElement = $(document.activeElement);\n+  if ($activeElement.hasClass('schema-input')) {\n+    sakai.gradebookng.settings.gradingschemas.cellName = $activeElement.attr('name');\n+  }\n+}\n+\n+GradebookGradingSchemaSettings.prototype.focusPreviousCell = function() {\n+  // This is a trick to focus the previous focused cell after table re-render\n+  var cellName = sakai.gradebookng.settings.gradingschemas.cellName;\n+  var $inputSameName = $('[name=\"' + cellName + '\"]');\n+  if ($inputSameName.length > 0) {\n+    $inputSameName.focus();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1261a15032bfc7bc7dba45067003e22d883f05c6"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f2727289c90e2a062679539d2f87d29eb8443bd", "author": {"user": {"login": "adrianfish", "name": "Adrian Fish"}}, "url": "https://github.com/sakaiproject/sakai/commit/8f2727289c90e2a062679539d2f87d29eb8443bd", "committedDate": "2020-08-31T15:53:46Z", "message": "Moved from jQuery to vanillajs.\n\nTightened up schema cell selector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Nzc5MjUx", "url": "https://github.com/sakaiproject/sakai/pull/8171#pullrequestreview-478779251", "createdAt": "2020-08-31T16:52:52Z", "commit": {"oid": "8f2727289c90e2a062679539d2f87d29eb8443bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2042, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}