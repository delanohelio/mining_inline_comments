{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDU4Njg1", "number": 8884, "title": "SAK-44763 - Improve URL matching on CC import", "bodyText": "", "createdAt": "2020-12-09T20:55:30Z", "url": "https://github.com/sakaiproject/sakai/pull/8884", "merged": true, "mergeCommit": {"oid": "f18f3995170d382d6eb4d633be7c3cfc3894d1eb"}, "closed": true, "closedAt": "2020-12-16T16:55:33Z", "author": {"login": "csev"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdklGr9AH2gAyNTM1NDU4Njg1OjlkODBlMzdkMzViZTM4NDY3ZTQzN2RmM2ZkM2IxYTg3ZDQ0MjE1ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmiMFqAH2gAyNTM1NDU4Njg1OjQyMDQ1ZjJlNTA2NjkzMjU4MTgwNmM0MTViNjM3N2I5ZDk0ZjQ5OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d80e37d35be38467e437df3fd3b1a87d4421587", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/9d80e37d35be38467e437df3fd3b1a87d4421587", "committedDate": "2020-12-09T20:52:18Z", "message": "SAK-44763 - Improve URL matching on CC import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NjAzOTEz", "url": "https://github.com/sakaiproject/sakai/pull/8884#pullrequestreview-548603913", "createdAt": "2020-12-09T20:59:40Z", "commit": {"oid": "9d80e37d35be38467e437df3fd3b1a87d4421587"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMDo1OTo0MVrOICpOBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQyMDo1OTo0MVrOICpOBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY0MzM5Ng==", "bodyText": "If you have a nice URL object, then just re-create it from the URL \ud83d\udc4d\nnew URI(uri.getScheme(),\nuri.getAuthority(),\nuri.getPath(),\nnull, // Ignore query\nuri.getFragment()).toString();", "url": "https://github.com/sakaiproject/sakai/pull/8884#discussion_r539643396", "createdAt": "2020-12-09T20:59:41Z", "author": {"login": "ottenhoff"}, "path": "basiclti/basiclti-common/src/java/org/sakaiproject/basiclti/util/SakaiBLTIUtil.java", "diffHunk": "@@ -2725,6 +2725,136 @@ public static Long getLongKey(Object key) {\n \t\treturn getLong(key);\n \t}\n \n+\tpublic static URL getUrlOrNull(String urlString) {\n+\t\tif ( urlString == null ) return null;\n+\t\ttry\n+\t\t{\n+\t\t\tURL url = new URL(urlString);\n+\t\t\turl.toURI();\n+\t\t\treturn url;\n+\t\t} catch (Exception exception) {\n+\t\t\treturn null;\n+\t\t}\n+\t}\n+\n+\tpublic static String stripOffQuery(String urlString)\n+\t{\n+\t\tif ( urlString == null ) return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d80e37d35be38467e437df3fd3b1a87d4421587"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b0701b75a829648b9ae9452497ba3928f103a54", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/3b0701b75a829648b9ae9452497ba3928f103a54", "committedDate": "2020-12-10T15:49:04Z", "message": "SAK-44763 - Change priority to all local first, unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNjE4MzY0", "url": "https://github.com/sakaiproject/sakai/pull/8884#pullrequestreview-552618364", "createdAt": "2020-12-15T16:06:53Z", "commit": {"oid": "3b0701b75a829648b9ae9452497ba3928f103a54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNjowNjo1M1rOIGTMNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNjowNjo1M1rOIGTMNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ3Njc5MA==", "bodyText": "use log.debug much better than System.out", "url": "https://github.com/sakaiproject/sakai/pull/8884#discussion_r543476790", "createdAt": "2020-12-15T16:06:53Z", "author": {"login": "ern"}, "path": "basiclti/basiclti-common/src/java/org/sakaiproject/basiclti/util/SakaiBLTIUtil.java", "diffHunk": "@@ -2725,6 +2725,120 @@ public static Long getLongKey(Object key) {\n \t\treturn getLong(key);\n \t}\n \n+\tpublic static URL getUrlOrNull(String urlString) {\n+\t\tif ( urlString == null ) return null;\n+\t\ttry\n+\t\t{\n+\t\t\tURL url = new URL(urlString);\n+\t\t\turl.toURI();\n+\t\t\treturn url;\n+\t\t} catch (Exception exception) {\n+\t\t\treturn null;\n+\t\t}\n+\t}\n+\n+\tpublic static String stripOffQuery(String urlString)\n+\t{\n+\t\tif ( urlString == null ) return null;\n+\t\t// Next we snip off the query string\n+\t\tString retval = urlString;\n+\t\tint pos = retval.indexOf('?');\n+\t\tif ( pos > 1 ) {\n+\t\t\tretval = retval.substring(0,pos);\n+\t\t}\n+\t\treturn retval;\n+\t}\n+\n+\tpublic static Map<String, Object> findBestToolMatch(boolean global, String launchUrl, List<Map<String,Object>> tools)\n+\t{\n+\t\tboolean local = ! global;  // Makes it easier to read :)\n+\n+\t\t// First we look for a tool with an exact match\n+\t\tfor ( Map<String,Object> tool : tools ) {\n+\t\t\tString toolLaunch = (String) tool.get(LTIService.LTI_LAUNCH);\n+\t\t\tString toolSite = (String) tool.get(LTIService.LTI_SITE_ID);\n+\n+\t\t\tif ( local && StringUtils.stripToNull(toolSite) == null ) continue;\n+\t\t\tif ( global && StringUtils.stripToNull(toolSite) != null ) continue;\n+\n+\t\t\tif ( launchUrl != null && launchUrl.equals(toolLaunch) ) {\n+\t\t\t\tlog.debug(\"Matched exact tool {}={}\", launchUrl, toolLaunch);\n+\t\t\t\t// System.out.println(\"Matched exact tool\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b0701b75a829648b9ae9452497ba3928f103a54"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abbdc45291472386fd8722eb24ca8dc816d72828", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/abbdc45291472386fd8722eb24ca8dc816d72828", "committedDate": "2020-12-15T22:31:29Z", "message": "SAK-44763 - Use URIBuilder to remove the query\n\nPer Matt Jones."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42045f2e5066932581806c415b6377b9d94f4999", "author": {"user": {"login": "csev", "name": "Charles Severance"}}, "url": "https://github.com/sakaiproject/sakai/commit/42045f2e5066932581806c415b6377b9d94f4999", "committedDate": "2020-12-15T22:36:20Z", "message": "SAK-44763 - Remove System.out.println per Earle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2961, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}