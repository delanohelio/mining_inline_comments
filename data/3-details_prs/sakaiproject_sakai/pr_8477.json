{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MTQ4Nzky", "number": 8477, "title": "SAK-44151 General small improvements and fixes for Lessons", "bodyText": "These improvements and bug fixes include:\n\ntoggling a css class on section headers based on if the section is open or closed\nFixing a typo in the polls markup causing styling inconsistencies\nLowering all of the z-index values for lessons dialogs\nFixing styling inconsistencies in Checklist feature\nAdding tabindex to the Learning Apps iframe\nLinked checklist items are broken when imported into a new site, but are not\nindicated as broken to the user\nChange checklist item duplication to use JSON instead of String manipulation\nFix date picker when no date is set\nFix issue with checklist item indexes\nFix auto select multiple choice on add question load\nKeep subpage group release info on duplication / import\nFix group releasing LTI items in Lessons", "createdAt": "2020-08-26T20:57:02Z", "url": "https://github.com/sakaiproject/sakai/pull/8477", "merged": true, "mergeCommit": {"oid": "d7f4930cd51eaf488af7524239733b20bc74dc87"}, "closed": true, "closedAt": "2020-08-31T15:13:51Z", "author": {"login": "davidpbauer"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCvfy2gH2gAyNDc0MTQ4NzkyOjRmMjUwZjU1OTRkNGZiNWVlMWEyNTQwZWM2ZDJiNDQ5MjE0NWE5ODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC-Z1cgFqTQ3NjYxMjQ1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f250f5594d4fb5ee1a2540ec6d2b4492145a980", "author": {"user": {"login": "davidpbauer", "name": "David P. Bauer"}}, "url": "https://github.com/sakaiproject/sakai/commit/4f250f5594d4fb5ee1a2540ec6d2b4492145a980", "committedDate": "2020-08-26T17:45:21Z", "message": "SAK-44151 General small improvements and fixes for Lessons\n\nThese improvements and bug fixes include:\n- toggling a css class on section headers based on if the section is open or closed\n- Fixing a typo in the polls markup causing styling inconsistencies\n- Lowering all of the z-index values for lessons dialogs\n- Fixing styling inconsistencies in Checklist feature\n- Adding tabindex to the Learning Apps iframe\n- Linked checklist items are broken when imported into a new site, but are not\nindicated as broken to the user\n- Change checklist item duplication to use JSON instead of String manipulation\n- Fix date picker when no date is set\n- Fix issue with checklist item indexes\n- Fix auto select multiple choice on add question load\n- Keep subpage group release info on duplication / import\n- Fix group releasing LTI items in Lessons"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTcxMDA4", "url": "https://github.com/sakaiproject/sakai/pull/8477#pullrequestreview-476571008", "createdAt": "2020-08-27T10:04:12Z", "commit": {"oid": "4f250f5594d4fb5ee1a2540ec6d2b4492145a980"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMDowNDoxM1rOHIJWCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMDoxODoxOVrOHIJ1CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMwMzc1Mw==", "bodyText": "I'd just use for (String part : parts) { here. Clearer, unless you need to test the index.", "url": "https://github.com/sakaiproject/sakai/pull/8477#discussion_r478303753", "createdAt": "2020-08-27T10:04:13Z", "author": {"login": "adrianfish"}, "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/service/LessonBuilderEntityProducer.java", "diffHunk": "@@ -1006,31 +1033,41 @@ else if (type == SimplePageItem.ASSESSMENT)\n        return needFix;\n     }\n \n-    String mergeGroups(Element itemElement, String attr, Collection<Group> siteGroups) {\n+    String mergeGroups(Element itemElement, String attr, Collection<Group> siteGroups, String fromSiteId) {\n \n \t// not currently doing this, although the code has been tested.\n \t// The problem is that other tools don't do it. Since much of our group\n \t// awareness comes from the other tools, enabling this produces\n \t// inconsistent results\n \n-\tNodeList groups = itemElement.getElementsByTagName(attr);\n+\tString groups = itemElement.getAttribute(attr);\n \tString groupString = null;\n-\t\n-\t// translate groups from title to ID\n-\tif (groups != null && siteGroups != null) {\n-\t    for (int n = 0; n < groups.getLength(); n ++) {\n-\t\tElement group = (Element)groups.item(n);\n-\t\tString title = group.getAttribute(\"title\");\n-\t\tif (title != null && !title.equals(\"\")) {\n-\t\t    for (Group g: siteGroups) {\n-\t\t\tif (title.equals(g.getTitle())) {\n-\t\t\t    if (groupString == null)\n-\t\t\t\tgroupString = g.getId();\n-\t\t\t    else\n-\t\t\t\tgroupString = groupString + \",\" + g.getId();\n+\tSite oldSite = null;\n+\ttry {\n+\t\toldSite = siteService.getSite(fromSiteId);\n+\t} catch (Exception e) {\n+\t\tlog.debug(\"site \" + fromSiteId + \" not found.\", e);\n+\t}\n+\t// For each old group, get the corresponding new group id\n+\tif (!groups.isEmpty() && siteGroups != null && oldSite != null) {\n+\t\tfinal String[] parts = groups.split(\",\");\n+\t\tfor (int n = 0; n < parts.length; n ++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f250f5594d4fb5ee1a2540ec6d2b4492145a980"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMxMTY4OA==", "bodyText": "Why not use j2ee JsonObject here, instead? I know simplepagebean uses Google's lib, but the j2ee version is a very similar api, with perhaps better builder patterns.", "url": "https://github.com/sakaiproject/sakai/pull/8477#discussion_r478311688", "createdAt": "2020-08-27T10:18:19Z", "author": {"login": "adrianfish"}, "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/service/LessonBuilderEntityProducer.java", "diffHunk": "@@ -510,6 +515,28 @@ else if (item.getType() == SimplePageItem.ASSESSMENT)\n \t\t    addAttr(doc, itemElement, \"samewindow\", item.isSameWindow() ? \"true\" : \"false\");\n \t\t\n \t\tString attrString = item.getAttributeString(); //json encoded attributes\n+\n+\t\tfinal JSONParser jsonParser = new JSONParser(); // JSON parser used to parse the attribute string into a JSON object", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f250f5594d4fb5ee1a2540ec6d2b4492145a980"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjEyNDUy", "url": "https://github.com/sakaiproject/sakai/pull/8477#pullrequestreview-476612452", "createdAt": "2020-08-27T11:07:25Z", "commit": {"oid": "4f250f5594d4fb5ee1a2540ec6d2b4492145a980"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2745, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}