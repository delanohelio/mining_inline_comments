{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjY5NjU5", "number": 8823, "title": "SAK-44687 ElFinder don't produce thumbnails for images over 20MB", "bodyText": "https://jira.sakaiproject.org/browse/SAK-44687", "createdAt": "2020-11-18T15:33:59Z", "url": "https://github.com/sakaiproject/sakai/pull/8823", "merged": true, "mergeCommit": {"oid": "5b1f2b6690c26a464a245a61c6ed04f612ffe63e"}, "closed": true, "closedAt": "2020-11-19T15:21:17Z", "author": {"login": "ern"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddv7xkAH2gAyNTIzMjY5NjU5OmNiMjRmODY1NTg4MDE1YWQ3Y2RlODcyZTUwOTc3NmNjYmY5NmM0ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeChLogFqTUzNDQyMjAxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb24f865588015ad7cde872e509776ccbf96c4dd", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/cb24f865588015ad7cde872e509776ccbf96c4dd", "committedDate": "2020-11-18T15:31:52Z", "message": "SAK-44687 ElFinder free resources associated with BufferedImage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNTcxMDA0", "url": "https://github.com/sakaiproject/sakai/pull/8823#pullrequestreview-533571004", "createdAt": "2020-11-18T15:36:08Z", "commit": {"oid": "cb24f865588015ad7cde872e509776ccbf96c4dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjY3NDM4", "url": "https://github.com/sakaiproject/sakai/pull/8823#pullrequestreview-533667438", "createdAt": "2020-11-18T17:06:55Z", "commit": {"oid": "2fde4e77e60fced79899556febb2888cde6d7274"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzowNjo1NlrOH14I2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzowNjo1NlrOH14I2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI1NjM0NQ==", "bodyText": "FY I didn't opt to creating a config option for this as it is simply a reasonable upper limit and injecting the services into these classes is not trivial due to the way they are instantiated.", "url": "https://github.com/sakaiproject/sakai/pull/8823#discussion_r526256345", "createdAt": "2020-11-18T17:06:56Z", "author": {"login": "ern"}, "path": "textarea/elfinder-sakai/src/java/org/sakaiproject/elfinder/controller/executors/SakaiTmbCommandExecutor.java", "diffHunk": "@@ -29,12 +29,14 @@\n     public void execute(FsService fsService, HttpServletRequest request, HttpServletResponse response, ServletContext servletContext) throws Exception {\n         String target = request.getParameter(\"target\");\n         FsItemEx fsi = super.findItem(fsService, target);\n-        int width = fsService.getServiceConfig().getTmbWidth();\n-        try (InputStream is = fsi.openInputStream()) {\n-            ByteArrayOutputStream baos = resize(is, width);\n-            response.setHeader(HttpHeaders.LAST_MODIFIED, DateTimeFormatter.RFC_1123_DATE_TIME.format(ZonedDateTime.now().withZoneSameInstant(ZoneId.of(\"GMT\"))));\n-            response.setHeader(HttpHeaders.EXPIRES, DateTimeFormatter.RFC_1123_DATE_TIME.format(ZonedDateTime.now().withZoneSameInstant(ZoneId.of(\"GMT\")).plus(2, ChronoUnit.YEARS)));\n-            response.getOutputStream().write(baos.toByteArray());\n+        if (fsi.getSize() < 20971520) { // image must be less than 20MB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fde4e77e60fced79899556febb2888cde6d7274"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd825a09531cd224e3ad90091e47c43711d3db7", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/ffd825a09531cd224e3ad90091e47c43711d3db7", "committedDate": "2020-11-18T21:16:02Z", "message": "Only produce thumbnails for images with a size less than 20MB"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fde4e77e60fced79899556febb2888cde6d7274", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/2fde4e77e60fced79899556febb2888cde6d7274", "committedDate": "2020-11-18T16:58:07Z", "message": "Only produce thumbnails for images with a size less than 20MB"}, "afterCommit": {"oid": "ffd825a09531cd224e3ad90091e47c43711d3db7", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/ffd825a09531cd224e3ad90091e47c43711d3db7", "committedDate": "2020-11-18T21:16:02Z", "message": "Only produce thumbnails for images with a size less than 20MB"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODg3MDEw", "url": "https://github.com/sakaiproject/sakai/pull/8823#pullrequestreview-533887010", "createdAt": "2020-11-18T21:22:33Z", "commit": {"oid": "ffd825a09531cd224e3ad90091e47c43711d3db7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDIyMDEz", "url": "https://github.com/sakaiproject/sakai/pull/8823#pullrequestreview-534422013", "createdAt": "2020-11-19T13:11:01Z", "commit": {"oid": "ffd825a09531cd224e3ad90091e47c43711d3db7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2496, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}