{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTAzNzc3", "number": 8759, "title": "SAK-42266 lessons > add open date to assignment links which are not yet open", "bodyText": "https://jira.sakaiproject.org/browse/SAK-42266\nIf an instructor links an assignment into a lesson, but the assignment is not yet open, the link is grey. There is only a hover tool-tip which says \"Item is not available\", which can easily be missed or not discovered at all.\nLet's add the open date in parenthesis beside the assignment title if it's not open for submission, so that the student quickly understands why they can't click the link.", "createdAt": "2020-10-30T15:56:03Z", "url": "https://github.com/sakaiproject/sakai/pull/8759", "merged": true, "mergeCommit": {"oid": "80e57def64ffcff999e5bb05f54018647d57b322"}, "closed": true, "closedAt": "2020-11-02T16:09:09Z", "author": {"login": "bjones86"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXo3j5gH2gAyNTEzMTAzNzc3OmVlMWM4MmQ3ZjI0ZjU0Y2QxNDVmZjc2OGZmOTY5ZDcyYTRmNjI2NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYmJTHAFqTUyMTcyMzI3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c", "author": {"user": {"login": "bjones86", "name": "Brian Jones"}}, "url": "https://github.com/sakaiproject/sakai/commit/ee1c82d7f24f54cd145ff768ff969d72a4f6265c", "committedDate": "2020-10-30T15:54:23Z", "message": "SAK-42266 lessons > add open date to assignment links which are not yet open"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODA4NjQ2", "url": "https://github.com/sakaiproject/sakai/pull/8759#pullrequestreview-520808646", "createdAt": "2020-10-30T15:57:26Z", "commit": {"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTo1NzoyNlrOHrViYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTo1NzoyNlrOHrViYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIwMzY4MA==", "bodyText": "Perhaps there's a better way to do this in Lessons code? I'm not sure. I found this comment and code earlier in the file:\n\t\t    // assignments won't let us get the entity if we're not in the group, so set up permissions before other tests\n\t\t\tif (usable && i.isPrerequisite()) {\n\t\t\t    simplePageBean.checkItemPermissions(i, true);\n\t\t\t}\n\nHowever if I call this method in the location here, nothing changes and I still get a permission exception in AssignmentEntity when trying to resolve the entity to access the open date.", "url": "https://github.com/sakaiproject/sakai/pull/8759#discussion_r515203680", "createdAt": "2020-10-30T15:57:26Z", "author": {"login": "bjones86"}, "path": "lessonbuilder/tool/src/java/org/sakaiproject/lessonbuildertool/tool/producers/ShowPageProducer.java", "diffHunk": "@@ -4004,7 +4006,19 @@ protected static boolean makeLink(UIContainer container, String ID, SimplePageIt\n \n \t\tif (fake) {\n \t\t\tID = ID + \"-fake\";\n-\t\t\tUIOutput link = UIOutput.make(container, ID, i.getName());\n+\t\t\tString linkText = i.getName();\n+\t\t\tif (i.getType() == SimplePageItem.ASSIGNMENT) {\n+\t\t\t\tSecurityAdvisor yesMan = (String arg0, String arg1, String agr2) -> SecurityAdvisor.SecurityAdvice.ALLOWED;\n+\t\t\t\tsecurityService.pushAdvisor(yesMan);\n+\t\t\t\ttry {\n+\t\t\t\t\tAssignmentEntity assignment = (AssignmentEntity) assignmentEntity.getEntity(i.getSakaiId(), simplePageBean);\n+\t\t\t\t\tlinkText += \" \" + messageLocator.getMessage(\"simplepage.assignment.open_date\", new Object[] {assignment.getOpenDate()});\n+\t\t\t\t} catch (Exception ex) {}\n+\t\t\t\tfinally {\n+\t\t\t\t\tsecurityService.popAdvisor(yesMan);\n+\t\t\t\t}\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzIxOTUw", "url": "https://github.com/sakaiproject/sakai/pull/8759#pullrequestreview-521721950", "createdAt": "2020-11-02T15:16:35Z", "commit": {"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzIzMjc0", "url": "https://github.com/sakaiproject/sakai/pull/8759#pullrequestreview-521723274", "createdAt": "2020-11-02T15:17:58Z", "commit": {"oid": "ee1c82d7f24f54cd145ff768ff969d72a4f6265c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2389, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}