{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2Nzk5ODg1", "number": 8393, "title": "SAK-43936 - Gradebook: no points validation when editing a Gradebook \u2026", "bodyText": "This ended up being a lot more complicated than I expected.\n\nProblem 1: updateAssignment returned a boolean true/false and did a catch (final Exception e) { only logging the error. There was no way to tell what the error was\nProblem 2: Exceptions were only caught when adding an assignment\nProblem 3: This method didn't check for a problem with points at all\n\nWhen working on this I ended up refactoring a lot of this because of redundancy between addAssignment and updateAssignment checking for errors. There's probably more refactoring that can be done.\nI had updateAssignment either do the update or throw an Exception so it ended up just changing to a void.\nI could have changed this to a less-code-change solution and just have updateAssignment check for points and return false, but then we wouldn't have the specific message related to points in the UI.", "createdAt": "2020-07-26T20:15:39Z", "url": "https://github.com/sakaiproject/sakai/pull/8393", "merged": true, "mergeCommit": {"oid": "926ae50404f0e8ff051786ae2499da04e3e2d4a2"}, "closed": true, "closedAt": "2020-08-17T04:31:33Z", "author": {"login": "jonespm"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5B_4pgFqTQ1NTc4OTgyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc93AyVAFqTQ2NTA3NTI3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Nzg5ODIz", "url": "https://github.com/sakaiproject/sakai/pull/8393#pullrequestreview-455789823", "createdAt": "2020-07-27T13:39:27Z", "commit": {"oid": "0678c69b4d6206a97ada9e11bc883b0debde9ac2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzozOToyN1rOG3i35Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzozOToyN1rOG3i35Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg5NjIyOQ==", "bodyText": "can you return the validatedName from your helper function instead? is that cleaner?", "url": "https://github.com/sakaiproject/sakai/pull/8393#discussion_r460896229", "createdAt": "2020-07-27T13:39:27Z", "author": {"login": "ottenhoff"}, "path": "edu-services/gradebook-service/impl/src/java/org/sakaiproject/component/gradebook/GradebookServiceHibernateImpl.java", "diffHunk": "@@ -614,29 +614,27 @@ public Object doInHibernate(final Session session) throws HibernateException {\n \n \t}\n \n+\n \t@Override\n \tpublic Long addAssignment(final String gradebookUid, final org.sakaiproject.service.gradebook.shared.Assignment assignmentDefinition) {\n \t\tif (!getAuthz().isUserAbleToEditAssessments(gradebookUid)) {\n \t\t\tlog.error(\"AUTHORIZATION FAILURE: User {} in gradebook {} attempted to add an assignment\", getUserUid(), gradebookUid);\n \t\t\tthrow new GradebookSecurityException();\n \t\t}\n \n-\t\t// Ensure that points is > zero.\n-\t\tfinal Double points = assignmentDefinition.getPoints();\n-\t\tif ((points == null) || (points <= 0)) {\n-\t\t\tthrow new AssignmentHasIllegalPointsException(\"Points must be > 0\");\n-\t\t}\n+\t\tGradebookHelper.validateAssignmentNameAndPoints(assignmentDefinition);\n \n \t\tfinal Gradebook gradebook = getGradebook(gradebookUid);\n+\t\tfinal String validatedName = StringUtils.trimToNull(assignmentDefinition.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0678c69b4d6206a97ada9e11bc883b0debde9ac2"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470668827caca1be16c4159f26ef0b7d55b2ddf7", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/470668827caca1be16c4159f26ef0b7d55b2ddf7", "committedDate": "2020-08-11T01:31:41Z", "message": "SAK-43936 - Gradebook: no points validation when editing a Gradebook Item"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0678c69b4d6206a97ada9e11bc883b0debde9ac2", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/0678c69b4d6206a97ada9e11bc883b0debde9ac2", "committedDate": "2020-07-26T20:10:08Z", "message": "SAK-43936 - Gradebook: no points validation when editing a Gradebook Item"}, "afterCommit": {"oid": "470668827caca1be16c4159f26ef0b7d55b2ddf7", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/470668827caca1be16c4159f26ef0b7d55b2ddf7", "committedDate": "2020-08-11T01:31:41Z", "message": "SAK-43936 - Gradebook: no points validation when editing a Gradebook Item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2bf30921a4c686a2abedf57dfae4d85a5f8033", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/bd2bf30921a4c686a2abedf57dfae4d85a5f8033", "committedDate": "2020-08-11T02:24:19Z", "message": "Some simplifactions based on comments from @ottenhoff\n\nReturn the validated name if valid, otherwise an exception."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "200501ed822e113f66df23278ee3b0eeada2f37c", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/200501ed822e113f66df23278ee3b0eeada2f37c", "committedDate": "2020-08-11T13:40:05Z", "message": "tabs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff7244c611716d867d1204a9c60cbc67c785a9f", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/dff7244c611716d867d1204a9c60cbc67c785a9f", "committedDate": "2020-08-11T13:40:56Z", "message": "tab"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MDc1Mjcw", "url": "https://github.com/sakaiproject/sakai/pull/8393#pullrequestreview-465075270", "createdAt": "2020-08-11T13:41:06Z", "commit": {"oid": "dff7244c611716d867d1204a9c60cbc67c785a9f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2859, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}