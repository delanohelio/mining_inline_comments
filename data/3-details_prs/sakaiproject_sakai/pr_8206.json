{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTk2OTIx", "number": 8206, "title": "SAK-43598 remove fake itemgrading created in Linear Access to assessment", "bodyText": "The fake itemgrading should be deleted when a real itemgrading coming from the user is present.\nIn those type of questions it was not controled producing duplicated itemgradings for the same question that produces grading problems for CQ.", "createdAt": "2020-05-04T21:32:56Z", "url": "https://github.com/sakaiproject/sakai/pull/8206", "merged": true, "mergeCommit": {"oid": "e7542fd353daca88349b7ac97d513016eb2d8460"}, "closed": true, "closedAt": "2020-06-29T14:26:31Z", "author": {"login": "rmengod"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd-LSqAH2gAyNDEzMTk2OTIxOmMzNDdlNjc4MDFhNTEzNzYxMDMwZjRhNjhmNDUxZWI2Y2Y5OWU4NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwB4ypgFqTQzOTE5ODkwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c347e67801a513761030f4a68f451eb6cf99e85c", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/c347e67801a513761030f4a68f451eb6cf99e85c", "committedDate": "2020-05-04T11:56:20Z", "message": "SAK-43598 delete fake itemgrading record for FIN/FIB/CQ/IMAGE question"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/55d2ee433325cb268d3db6d920e267800003aca3", "committedDate": "2020-05-04T21:18:01Z", "message": "SAK-43598 change fake detection order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDA2ODQ3", "url": "https://github.com/sakaiproject/sakai/pull/8206#pullrequestreview-407006847", "createdAt": "2020-05-06T21:39:13Z", "commit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMTozOToxNFrOGRma-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMTo0MToxOFrOGRmehQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEwODQ3NQ==", "bodyText": "can you choose a better variable name here? what is the purpose of the variable?", "url": "https://github.com/sakaiproject/sakai/pull/8206#discussion_r421108475", "createdAt": "2020-05-06T21:39:14Z", "author": {"login": "ottenhoff"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/SubmitToGradingActionListener.java", "diffHunk": "@@ -707,28 +707,40 @@ private void prepareItemGradingPerItem(ActionEvent ae, DeliveryBean delivery,\n \t\tcase 15: // CALCULATED_QUESTION\n \t\tcase 16: //IMAGEMAP_QUESTION \t\n \t\tcase 11: // FIN\n-\t\t\tboolean addedToAdds = false;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n \t\t\t\titemgrading.setAgentId(AgentFacade.getAgentString());\n \t\t\t\titemgrading.setSubmittedDate(new Date());\n \t\t\t}\n+\t\t\tint fake=-1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEwODcwMQ==", "bodyText": "why the brackets around this? can you also space it out like the other code?", "url": "https://github.com/sakaiproject/sakai/pull/8206#discussion_r421108701", "createdAt": "2020-05-06T21:39:42Z", "author": {"login": "ottenhoff"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/SubmitToGradingActionListener.java", "diffHunk": "@@ -707,28 +707,40 @@ private void prepareItemGradingPerItem(ActionEvent ae, DeliveryBean delivery,\n \t\tcase 15: // CALCULATED_QUESTION\n \t\tcase 16: //IMAGEMAP_QUESTION \t\n \t\tcase 11: // FIN\n-\t\t\tboolean addedToAdds = false;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n \t\t\t\titemgrading.setAgentId(AgentFacade.getAgentString());\n \t\t\t\titemgrading.setSubmittedDate(new Date());\n \t\t\t}\n+\t\t\tint fake=-1;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n+\t\t\t\tString s = itemgrading.getAnswerText();\n \t\t\t\tif (itemgrading.getItemGradingId() != null\n \t\t\t\t\t\t&& itemgrading.getItemGradingId().intValue() > 0) {\n-\t\t\t\t\tadds.addAll(grading);\n-\t\t\t\t\tbreak;\n-\t\t\t\t} else if (itemgrading.getAnswerText() != null && !itemgrading.getAnswerText().equals(\"\")) {\n-\t\t\t\t\tString s = itemgrading.getAnswerText();\n+\t\t\t\t\t if (\"1\".equals(delivery.getNavigation()) && itemgrading.getPublishedAnswerId()==null && (s==null || s.equals(\"\"))) {\n+\t\t\t\t\t\t//Mark this as the fake itemgrading record\n+\t\t\t\t\t\t{fake=m;}\t ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEwODk2Mg==", "bodyText": "can you make sure the tabs/spaces line up ?", "url": "https://github.com/sakaiproject/sakai/pull/8206#discussion_r421108962", "createdAt": "2020-05-06T21:40:22Z", "author": {"login": "ottenhoff"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/SubmitToGradingActionListener.java", "diffHunk": "@@ -707,28 +707,40 @@ private void prepareItemGradingPerItem(ActionEvent ae, DeliveryBean delivery,\n \t\tcase 15: // CALCULATED_QUESTION\n \t\tcase 16: //IMAGEMAP_QUESTION \t\n \t\tcase 11: // FIN\n-\t\t\tboolean addedToAdds = false;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n \t\t\t\titemgrading.setAgentId(AgentFacade.getAgentString());\n \t\t\t\titemgrading.setSubmittedDate(new Date());\n \t\t\t}\n+\t\t\tint fake=-1;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n+\t\t\t\tString s = itemgrading.getAnswerText();\n \t\t\t\tif (itemgrading.getItemGradingId() != null\n \t\t\t\t\t\t&& itemgrading.getItemGradingId().intValue() > 0) {\n-\t\t\t\t\tadds.addAll(grading);\n-\t\t\t\t\tbreak;\n-\t\t\t\t} else if (itemgrading.getAnswerText() != null && !itemgrading.getAnswerText().equals(\"\")) {\n-\t\t\t\t\tString s = itemgrading.getAnswerText();\n+\t\t\t\t\t if (\"1\".equals(delivery.getNavigation()) && itemgrading.getPublishedAnswerId()==null && (s==null || s.equals(\"\"))) {\n+\t\t\t\t\t\t//Mark this as the fake itemgrading record\n+\t\t\t\t\t\t{fake=m;}\t \n+\t\t\t\t     } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEwOTIzNg==", "bodyText": "can you make this a better debug message? What does s mean?\nAlso, please use debug substitution:\nlog.debug(\"xxxxx yyyyyy zzzz: {}\", s)", "url": "https://github.com/sakaiproject/sakai/pull/8206#discussion_r421109236", "createdAt": "2020-05-06T21:40:59Z", "author": {"login": "ottenhoff"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/SubmitToGradingActionListener.java", "diffHunk": "@@ -707,28 +707,40 @@ private void prepareItemGradingPerItem(ActionEvent ae, DeliveryBean delivery,\n \t\tcase 15: // CALCULATED_QUESTION\n \t\tcase 16: //IMAGEMAP_QUESTION \t\n \t\tcase 11: // FIN\n-\t\t\tboolean addedToAdds = false;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n \t\t\t\titemgrading.setAgentId(AgentFacade.getAgentString());\n \t\t\t\titemgrading.setSubmittedDate(new Date());\n \t\t\t}\n+\t\t\tint fake=-1;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n+\t\t\t\tString s = itemgrading.getAnswerText();\n \t\t\t\tif (itemgrading.getItemGradingId() != null\n \t\t\t\t\t\t&& itemgrading.getItemGradingId().intValue() > 0) {\n-\t\t\t\t\tadds.addAll(grading);\n-\t\t\t\t\tbreak;\n-\t\t\t\t} else if (itemgrading.getAnswerText() != null && !itemgrading.getAnswerText().equals(\"\")) {\n-\t\t\t\t\tString s = itemgrading.getAnswerText();\n+\t\t\t\t\t if (\"1\".equals(delivery.getNavigation()) && itemgrading.getPublishedAnswerId()==null && (s==null || s.equals(\"\"))) {\n+\t\t\t\t\t\t//Mark this as the fake itemgrading record\n+\t\t\t\t\t\t{fake=m;}\t \n+\t\t\t\t     } else {\n+\t\t\t\t\t\t log.debug(\"s = \" + s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEwOTM4MQ==", "bodyText": "If StringUtils is available here, it's preferable", "url": "https://github.com/sakaiproject/sakai/pull/8206#discussion_r421109381", "createdAt": "2020-05-06T21:41:18Z", "author": {"login": "ottenhoff"}, "path": "samigo/samigo-app/src/java/org/sakaiproject/tool/assessment/ui/listener/delivery/SubmitToGradingActionListener.java", "diffHunk": "@@ -707,28 +707,40 @@ private void prepareItemGradingPerItem(ActionEvent ae, DeliveryBean delivery,\n \t\tcase 15: // CALCULATED_QUESTION\n \t\tcase 16: //IMAGEMAP_QUESTION \t\n \t\tcase 11: // FIN\n-\t\t\tboolean addedToAdds = false;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n \t\t\t\titemgrading.setAgentId(AgentFacade.getAgentString());\n \t\t\t\titemgrading.setSubmittedDate(new Date());\n \t\t\t}\n+\t\t\tint fake=-1;\n \t\t\tfor (int m = 0; m < grading.size(); m++) {\n \t\t\t\tItemGradingData itemgrading = grading.get(m);\n+\t\t\t\tString s = itemgrading.getAnswerText();\n \t\t\t\tif (itemgrading.getItemGradingId() != null\n \t\t\t\t\t\t&& itemgrading.getItemGradingId().intValue() > 0) {\n-\t\t\t\t\tadds.addAll(grading);\n-\t\t\t\t\tbreak;\n-\t\t\t\t} else if (itemgrading.getAnswerText() != null && !itemgrading.getAnswerText().equals(\"\")) {\n-\t\t\t\t\tString s = itemgrading.getAnswerText();\n+\t\t\t\t\t if (\"1\".equals(delivery.getNavigation()) && itemgrading.getPublishedAnswerId()==null && (s==null || s.equals(\"\"))) {\n+\t\t\t\t\t\t//Mark this as the fake itemgrading record\n+\t\t\t\t\t\t{fake=m;}\t \n+\t\t\t\t     } else {\n+\t\t\t\t\t\t log.debug(\"s = \" + s);\n+\t\t\t\t\t\t // Change to allow student submissions in rich-text [SAK-17021]\n+\t\t\t\t\t\t itemgrading.setAnswerText(s);\n+\t\t\t\t\t\t adds.add(itemgrading);\n+\t\t\t\t     }\t\n+\t\t\t\t}\n+\t\t\t\telse if (s != null && !s.equals(\"\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55d2ee433325cb268d3db6d920e267800003aca3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5842a13fbcfdbcd44a1653870ce1eceaff69edce", "author": {"user": null}, "url": "https://github.com/sakaiproject/sakai/commit/5842a13fbcfdbcd44a1653870ce1eceaff69edce", "committedDate": "2020-05-27T20:03:19Z", "message": "Change suggested changes in PR 8206"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MTk4OTAw", "url": "https://github.com/sakaiproject/sakai/pull/8206#pullrequestreview-439198900", "createdAt": "2020-06-29T14:26:23Z", "commit": {"oid": "5842a13fbcfdbcd44a1653870ce1eceaff69edce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2071, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}