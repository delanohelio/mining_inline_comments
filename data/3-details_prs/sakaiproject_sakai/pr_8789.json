{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MzU3NzI0", "number": 8789, "title": "SAK-44630 allow institution to send Sakai TAs to Turnitin as Instructors", "bodyText": "", "createdAt": "2020-11-05T21:43:00Z", "url": "https://github.com/sakaiproject/sakai/pull/8789", "merged": true, "mergeCommit": {"oid": "cd1efa412c04c07b56107ffc41bb02f1e50705cd"}, "closed": true, "closedAt": "2020-11-06T16:26:00Z", "author": {"login": "ottenhoff"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZpYuDgH2gAyNTE2MzU3NzI0Ojk5NWU1NjUzZmQ4NGIxYTY4OTZlZmRkNmRmNzdjNTA0NDZhY2VhNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ4qnBAH2gAyNTE2MzU3NzI0OmM4NDFlZjVhN2U0YmZhNDMxODNjYzRmZmI5ZTEwMTg3YmY4NmJiNDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "995e5653fd84b1a6896efdd6df77c50446acea55", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/995e5653fd84b1a6896efdd6df77c50446acea55", "committedDate": "2020-11-05T21:38:27Z", "message": "SAK-44630 allow institution to send Sakai TAs to Turnitin as Instructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc4919911e2430b1764eb8e09028db26622f97d", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/6dc4919911e2430b1764eb8e09028db26622f97d", "committedDate": "2020-11-05T21:40:54Z", "message": "config setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6", "committedDate": "2020-11-05T21:50:16Z", "message": "fix build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzMwMDEw", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-524730010", "createdAt": "2020-11-05T22:42:25Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTczMTM2", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525173136", "createdAt": "2020-11-06T14:01:25Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMToyNVrOHuvLOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMToyNVrOHuvLOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2OTQ2Ng==", "bodyText": "you may want to change this to snake case to be consistent with the other permissions", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518769466", "createdAt": "2020-11-06T14:01:25Z", "author": {"login": "baholladay"}, "path": "config/configuration/bundles/src/bundle/org/sakaiproject/config/bundle/default.sakai.properties", "diffHunk": "@@ -2074,6 +2074,10 @@\n # turnitin.report_gen_speed.setting.2=1\n # turnitin.report_gen_speed.setting.3=2\n \n+# Allow Sakai TAs to be sent to Turnitin as Instructors so they can view TII reports\n+# DEFAULT: false\n+# turnitin.enrollAssistantsAsInstructors=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTc0MDQ0", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525174044", "createdAt": "2020-11-06T14:02:33Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjozM1rOHuvN8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjozM1rOHuvN8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDE2MQ==", "bodyText": "@SuppressWarnings is not needed any longer", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770161", "createdAt": "2020-11-06T14:02:33Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTc0MTc3", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525174177", "createdAt": "2020-11-06T14:02:43Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjo0M1rOHuvOTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMjo0M1rOHuvOTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDI1NQ==", "bodyText": "@SuppressWarnings is not needed any longer", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770255", "createdAt": "2020-11-06T14:02:43Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2260,23 +2269,22 @@ private String getTEM(String cid) {\n \t * @return\n \t */\n \t@SuppressWarnings(\"unchecked\")\n-\tpublic Map getInstructorInfo(String siteId) {\n+\tpublic Map<String, String> getInstructorInfo(String siteId) {\n \t\treturn getInstructorInfo(siteId, false);\n \t}\n \n \t@SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTc0OTQ2", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525174946", "createdAt": "2020-11-06T14:03:40Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMzo0MFrOHuvQPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowMzo0MFrOHuvQPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDc1MQ==", "bodyText": "final isn't needed", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518770751", "createdAt": "2020-11-06T14:03:40Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTc1NDYz", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525175463", "createdAt": "2020-11-06T14:04:10Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNDoxMFrOHuvRgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNDoxMFrOHuvRgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MTA3Mg==", "bodyText": "spacing", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518771072", "createdAt": "2020-11-06T14:04:10Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2312,14 +2320,24 @@ public Map getInstructorInfo(String siteId, boolean ignoreUseSource) {\n \t\treturn togo;\n \t}\n \n-\tprivate Set<String> getActiveInstructorIds(String INST_ROLE, Site site) {\n+\tprivate Set<String> getActiveUsersForRole(final String rolePermission, final String siteId) {\n+\t\ttry {\n+\t\t\tSite site = siteService.getSite(siteId);\n+\t\t\treturn getActiveUsersForRole(rolePermission, site);\n+\t\t} catch (IdUnusedException e) {\n+\t\t\tlog.info(\"Ignoring site \" + siteId + \" which no longer exists.\");\n+\t\t}\n+\n+    return new HashSet<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTc4MzIw", "url": "https://github.com/sakaiproject/sakai/pull/8789#pullrequestreview-525178320", "createdAt": "2020-11-06T14:07:27Z", "commit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNzoyN1rOHuvZWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDowNzoyN1rOHuvZWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MzA4MQ==", "bodyText": "is final needed here?", "url": "https://github.com/sakaiproject/sakai/pull/8789#discussion_r518773081", "createdAt": "2020-11-06T14:07:27Z", "author": {"login": "baholladay"}, "path": "content-review/impl/turnitin/src/main/java/org/sakaiproject/contentreview/turnitin/TurnitinReviewServiceImpl.java", "diffHunk": "@@ -2750,39 +2768,13 @@ private User getUser(String userid) {\n \t\treturn user;\n \t}\n \n-\t/**\n-\t * Return a Map containing all users of x type enrolled on a site\n-\t * @param siteId Sakai site ID\n-\t * @param role specific user role e.g. 'instructor'\n-\t * @return\n-\t */\n-\t@SuppressWarnings(\"unchecked\")\n-\tprivate Map getAllUsers(String siteId, String role) {\n-\t\tString ROLE = \"section.role.\"+role;\n-\t\tMap<String,String> users = new HashMap<>();\n-\t\tSite site = null;\n-\t\ttry {\n-\t\t\tsite = siteService.getSite(siteId);\n-\t\t\tSet<String> instIds = site.getUsersIsAllowed(ROLE);\n-\t\t\tList<User> activeUsers = userDirectoryService.getUsers(instIds);\n-\t\t\tfor (int i = 0; i < activeUsers.size(); i++) {\n-\t\t\t\tUser user = activeUsers.get(i);\n-\t\t\t\tusers.put(user.getId(),user.getId());\n-\t\t\t}\n-\t\t} catch (IdUnusedException e) {\n-\t\t\tlog.error(\"Unable to fetch site in getAllUsers: \" + siteId, e);\n-\t\t} catch (Exception e) {\n-\t\t\tlog.error(\"Exception in getAllUsers\", e);\n-\t\t}\n-\t\treturn users;\n-\t}\n \t/**\n \t * The primary method of this class. Syncs the enrollment between a Sakai\n \t * Site and it's corresponding\n \t *\n \t * @param sakaiSiteID\n \t */\n-\tprivate boolean syncSiteWithTurnitin(String sakaiSiteID) {\n+\tprivate boolean syncSiteWithTurnitin(final String sakaiSiteID) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a8e6a12bfef80b709cc2e57c87cf1ac0ae14e6"}, "originalPosition": 141}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c841ef5a7e4bfa43183cc4ffb9e10187bf86bb44", "author": {"user": {"login": "ottenhoff", "name": "Sam Ottenhoff"}}, "url": "https://github.com/sakaiproject/sakai/commit/c841ef5a7e4bfa43183cc4ffb9e10187bf86bb44", "committedDate": "2020-11-06T15:26:34Z", "message": "bryan suggestions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2446, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}