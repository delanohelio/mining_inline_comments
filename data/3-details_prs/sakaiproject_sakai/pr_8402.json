{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3ODM4NzY4", "number": 8402, "title": "SAK-43981: Library/Portal Dark theme and theme switcher", "bodyText": "Would love feedback on the general approach and whether this is how to put something behind a property.", "createdAt": "2020-07-28T14:14:07Z", "url": "https://github.com/sakaiproject/sakai/pull/8402", "merged": true, "mergeCommit": {"oid": "f00437d93d12e9c09d4ca80146504741961c5f8f"}, "closed": true, "closedAt": "2020-09-01T15:30:53Z", "author": {"login": "profmikegreene"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5XyhfAFqTQ1NjcyNTUyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEpKEJAFqTQ3OTg2NDM0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NzI1NTI4", "url": "https://github.com/sakaiproject/sakai/pull/8402#pullrequestreview-456725528", "createdAt": "2020-07-28T15:00:09Z", "commit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNTowMDowOVrOG4Q_dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNTowMjowMlrOG4REzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1MTgyOQ==", "bodyText": "=== better than == here", "url": "https://github.com/sakaiproject/sakai/pull/8402#discussion_r461651829", "createdAt": "2020-07-28T15:00:09Z", "author": {"login": "bjones86"}, "path": "library/src/morpheus-master/js/src/sakai.morpheus.themeswitcher.js", "diffHunk": "@@ -0,0 +1,43 @@\n+//There is a bright flash of light theme before this is loaded and dark theme\n+//is set. Can this be moved higher in the DOM somehow or made more performant\n+//to avoid this?\n+\n+let themeSwitcher = document.getElementById(\"themeSwitcher\");\n+\n+SAK_THEME_SELECTION_KEY = portal.user.id + \"#theme\";\n+\n+if(themeSwitcher != null) {\n+    \n+    initTheme(); // on page load, if user has already selected a specific theme -> apply it\n+  \n+    themeSwitcher.addEventListener('click', setTheme, false);\n+\n+}\n+\n+function setTheme() {\n+\n+    // Set to dark mode\n+    if (themeSwitcher.getAttribute(\"aria-checked\") == \"true\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1MjE3Nw==", "bodyText": "Whitespace is a little off here", "url": "https://github.com/sakaiproject/sakai/pull/8402#discussion_r461652177", "createdAt": "2020-07-28T15:00:37Z", "author": {"login": "bjones86"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/SkinnableCharonPortal.java", "diffHunk": "@@ -1736,7 +1738,11 @@ public void includeBottom(PortalRenderContext rcontext, Site site)\n                         \t\t\tlog.error(e1.getMessage(), e1);\n                         \t\t}\n                         \t}\n-                        }\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif(sakaiThemeSwitcherEnabled) {\n+\t\t\t\t\t\t\trcontext.put(\"themeSwitcher\", true);\n+\t\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1MjgwMQ==", "bodyText": "This can be reduced to one line:\nrenderContextMap.put(\"themeSwitcher\", serverConfigurationService.getBoolean(\"portal.themeswitcher\", true));", "url": "https://github.com/sakaiproject/sakai/pull/8402#discussion_r461652801", "createdAt": "2020-07-28T15:01:27Z", "author": {"login": "bjones86"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/site/DefaultSiteViewImpl.java", "diffHunk": "@@ -164,6 +164,11 @@ public Object getRenderContextObject()\n \t\t} else {\n \t\t\trenderContextMap.put(\"tutorial\", false);\n \t\t}\n+\t\tif (serverConfigurationService.getBoolean(\"portal.themeswitcher\", true)) {\n+\t\t\trenderContextMap.put(\"themeSwitcher\", true);\n+\t\t} else {\n+\t\t\trenderContextMap.put(\"themeSwitcher\", false);\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY1MzE5Nw==", "bodyText": "Same here, one line:\nrenderContextMap.put(\"themeSwitcher\", serverConfigurationService.getBoolean(\"portal.themeswitcher\", true));", "url": "https://github.com/sakaiproject/sakai/pull/8402#discussion_r461653197", "createdAt": "2020-07-28T15:02:02Z", "author": {"login": "bjones86"}, "path": "portal/portal-impl/impl/src/java/org/sakaiproject/portal/charon/site/MoreSiteViewImpl.java", "diffHunk": "@@ -181,6 +181,11 @@ public Object getRenderContextObject()\n \t\t} else {\n \t\t\trenderContextMap.put(\"tutorial\", false);\n \t\t}\n+\t\tif (serverConfigurationService.getBoolean(\"portal.themeswitcher\", true)) {\n+\t\t\trenderContextMap.put(\"themeSwitcher\", true);\n+\t\t} else {\n+\t\t\trenderContextMap.put(\"themeSwitcher\", false);\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb516ace7c7d15bb06282fd036bea7893aebc50f", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/bb516ace7c7d15bb06282fd036bea7893aebc50f", "committedDate": "2020-08-27T16:25:52Z", "message": "SAK-43981 WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b23c2be34f194627c469e5173b2c2549f7634b06", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/b23c2be34f194627c469e5173b2c2549f7634b06", "committedDate": "2020-08-27T16:25:52Z", "message": "SAK-43981 WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6cfe1d8c8843dbec07b5e3234534b097610ff5f", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/b6cfe1d8c8843dbec07b5e3234534b097610ff5f", "committedDate": "2020-08-27T16:25:52Z", "message": "SAK43981 WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d427e969d3dc47dc35588436cf459784cf70fdd", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/9d427e969d3dc47dc35588436cf459784cf70fdd", "committedDate": "2020-08-27T16:25:52Z", "message": "SAK-43981 WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1007bf39bb624304f0dd57a7af2f59b9dc28314d", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/1007bf39bb624304f0dd57a7af2f59b9dc28314d", "committedDate": "2020-08-28T17:21:17Z", "message": "SAK-43981 WIP move all theme related styles to css custom properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342741c2395e5b2abcc3d219c1765db78ee3e2c2", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/342741c2395e5b2abcc3d219c1765db78ee3e2c2", "committedDate": "2020-08-28T20:10:27Z", "message": "SAK-43981 WIP documentation and color clean up in light theme"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4d8928eabea92bc82909b09daf552505a8ce74c", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/b4d8928eabea92bc82909b09daf552505a8ce74c", "committedDate": "2020-07-28T14:12:14Z", "message": "SAK-43981 WIP"}, "afterCommit": {"oid": "342741c2395e5b2abcc3d219c1765db78ee3e2c2", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/342741c2395e5b2abcc3d219c1765db78ee3e2c2", "committedDate": "2020-08-28T20:10:27Z", "message": "SAK-43981 WIP documentation and color clean up in light theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593171273b5487ae9c8f0e5a0d7545b1c54bbb94", "author": {"user": {"login": "profmikegreene", "name": "Michael Greene"}}, "url": "https://github.com/sakaiproject/sakai/commit/593171273b5487ae9c8f0e5a0d7545b1c54bbb94", "committedDate": "2020-09-01T02:20:11Z", "message": "SAK-43981 Library/Portal dark/light theme switchter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY0MzQ3", "url": "https://github.com/sakaiproject/sakai/pull/8402#pullrequestreview-479864347", "createdAt": "2020-09-01T15:30:02Z", "commit": {"oid": "593171273b5487ae9c8f0e5a0d7545b1c54bbb94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2873, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}