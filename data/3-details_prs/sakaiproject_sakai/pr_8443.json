{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MjAyNjky", "number": 8443, "title": "SAK-40369 - Intermittent startup failure", "bodyText": "It looks like the startScheduler check only occurred when start() was running. This was from  org.springframework.context.Lifecycle. I added this check to also early not run the the init().\nI added a NPE check on the problematic line with a warning as detail  has potential to still be null in some conditions otherwise.", "createdAt": "2020-08-09T21:05:59Z", "url": "https://github.com/sakaiproject/sakai/pull/8443", "merged": true, "mergeCommit": {"oid": "79402bf04040ff387e4a75c8845a3b4e22b53498"}, "closed": true, "closedAt": "2020-08-17T04:30:57Z", "author": {"login": "jonespm"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9prWNgFqTQ2NDYxNjU1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc93DPjgFqTQ2NTA3Nzc0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjE2NTUw", "url": "https://github.com/sakaiproject/sakai/pull/8443#pullrequestreview-464616550", "createdAt": "2020-08-10T21:58:14Z", "commit": {"oid": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMTo1ODoxNFrOG-hOsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjowNTo1MFrOG-hasA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwOTMzMA==", "bodyText": "There should always be a scheduler instance, but it may not actually be executing and running jobs.", "url": "https://github.com/sakaiproject/sakai/pull/8443#discussion_r468209330", "createdAt": "2020-08-10T21:58:14Z", "author": {"login": "ern"}, "path": "jobscheduler/scheduler-component-shared/src/java/org/sakaiproject/component/app/scheduler/SchedulerManagerImpl.java", "diffHunk": "@@ -99,6 +99,10 @@\n \n   public void init()\n   {\n+    if (!startScheduler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxMjQwMA==", "bodyText": "Since the SchedulerManager Bean is injected via spring it should never be non null. If schedulerManager.getScheduler() is returning null then there is likely some timing issue going on.", "url": "https://github.com/sakaiproject/sakai/pull/8443#discussion_r468212400", "createdAt": "2020-08-10T22:05:50Z", "author": {"login": "ern"}, "path": "jobscheduler/scheduler-utils/src/java/org/sakaiproject/scheduler/util/AutoProvisionJobs.java", "diffHunk": "@@ -54,13 +54,18 @@\n \n     public void init() throws ParserConfigurationException, XPathException, ParseException, IOException, ValidationException, SchedulerException, SAXException, ClassNotFoundException {\n \n+        Scheduler scheduler = schedulerManager.getScheduler();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469012df18adbbe6b094c2c8038d734b94528866", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/469012df18adbbe6b094c2c8038d734b94528866", "committedDate": "2020-08-11T01:17:13Z", "message": "SAK-40369 - Intermittent startup failure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9", "committedDate": "2020-08-09T21:58:05Z", "message": "Needed to catch for a null return of getScheduler to avoid NPE's"}, "afterCommit": {"oid": "469012df18adbbe6b094c2c8038d734b94528866", "author": {"user": {"login": "jonespm", "name": "Code Hugger (Matthew Jones)"}}, "url": "https://github.com/sakaiproject/sakai/commit/469012df18adbbe6b094c2c8038d734b94528866", "committedDate": "2020-08-11T01:17:13Z", "message": "SAK-40369 - Intermittent startup failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9feabdeb4e5c8840ec3e998ae73abf5f1a0d93", "author": {"user": {"login": "ern", "name": "Earle Nietzel"}}, "url": "https://github.com/sakaiproject/sakai/commit/fb9feabdeb4e5c8840ec3e998ae73abf5f1a0d93", "committedDate": "2020-08-11T13:42:12Z", "message": "Updated job detail log message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MDc3NzQx", "url": "https://github.com/sakaiproject/sakai/pull/8443#pullrequestreview-465077741", "createdAt": "2020-08-11T13:43:47Z", "commit": {"oid": "fb9feabdeb4e5c8840ec3e998ae73abf5f1a0d93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2906, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}