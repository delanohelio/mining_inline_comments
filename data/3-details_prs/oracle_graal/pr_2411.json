{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMTE3MDM3", "number": 2411, "title": "AArch64 Debug Info fixes", "bodyText": "This patch fixes several problems with debug info on AArch64. Associated issue is #2378.\nFixed functionality includes\n.debug_frame section CIE records:\nestablish correct stack call frame address at entry\n.debug_line section:\nrestate initial line position at end of method prologue  -- workaround for bad gdb behaviour\n.debug_frame section FDE records:\nnotify gdb of save/restore for frame and link register\nIn terms of user experience what this achieves is that gdb now\n- places method breaks at the first rather than the second line of a method\n- does not crash when you try to display a stack backtrace\n- correctly identifies the return address and stack top for the previous frame", "createdAt": "2020-04-28T13:25:01Z", "url": "https://github.com/oracle/graal/pull/2411", "merged": true, "mergeCommit": {"oid": "6227c434ba923406382c2ff80a252c721d7f1fac"}, "closed": true, "closedAt": "2020-05-11T17:19:51Z", "author": {"login": "adinn"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcacftAgH2gAyNDEwMTE3MDM3OmQ2MDA1ZWJlZWIyMGY5OTczOTc5YzhlNzAyOGFjZmEyYTg2MGRjNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfQDPGgFqTQwODE3MDYwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6005ebeeb20f9973979c8e7028acfa2a860dc67", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/d6005ebeeb20f9973979c8e7028acfa2a860dc67", "committedDate": "2020-04-23T13:00:05Z", "message": "correct error establishing call frame address on AArch64"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e501ddc4e32d6762c87d1acb723897da2814fa4f", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/e501ddc4e32d6762c87d1acb723897da2814fa4f", "committedDate": "2020-04-24T12:57:24Z", "message": "convince gdb to place method break at end of prologue on AArch64"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6357be2fb3132852a545f37c4df521d63621de71", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/6357be2fb3132852a545f37c4df521d63621de71", "committedDate": "2020-04-28T13:00:45Z", "message": "update prologue address"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed580387fd03b9f133a3a393cbd62d89375db658", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/ed580387fd03b9f133a3a393cbd62d89375db658", "committedDate": "2020-04-28T13:03:16Z", "message": "generate correct debug frame info on AArch64"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24d6da17cea6ba18592d2e726ca44f48f0fda68c", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/24d6da17cea6ba18592d2e726ca44f48f0fda68c", "committedDate": "2020-04-28T14:46:09Z", "message": "style fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzI2MjM4", "url": "https://github.com/oracle/graal/pull/2411#pullrequestreview-407326238", "createdAt": "2020-05-07T10:01:31Z", "commit": {"oid": "24d6da17cea6ba18592d2e726ca44f48f0fda68c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDowMTozMVrOGR3dYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDowMTozMVrOGR3dYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4NzYxOA==", "bodyText": "You don't need an accessor if you make elfMachine a public final field.", "url": "https://github.com/oracle/graal/pull/2411#discussion_r421387618", "createdAt": "2020-05-07T10:01:31Z", "author": {"login": "olpaw"}, "path": "substratevm/src/com.oracle.objectfile/src/com/oracle/objectfile/elf/dwarf/DwarfDebugInfo.java", "diffHunk": "@@ -201,4 +203,8 @@ public DwarfARangesSectionImpl getARangesSectionImpl() {\n     public DwarfLineSectionImpl getLineSectionImpl() {\n         return dwarfLineSection;\n     }\n+\n+    public ELFMachine getELFMachine() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24d6da17cea6ba18592d2e726ca44f48f0fda68c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c24f78610741fb043bccce38c60e3cf8249429d8", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/c24f78610741fb043bccce38c60e3cf8249429d8", "committedDate": "2020-05-07T14:43:39Z", "message": "avoid need for accessor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTcwNDc1", "url": "https://github.com/oracle/graal/pull/2411#pullrequestreview-408170475", "createdAt": "2020-05-08T11:19:29Z", "commit": {"oid": "c24f78610741fb043bccce38c60e3cf8249429d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMToxOToyOVrOGSiNag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMToxOToyOVrOGSiNag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4ODA0Mg==", "bodyText": "If doing the same also for AMD64 does not have any negative side effects then maybe it's not worth to make this piece architecture specific.", "url": "https://github.com/oracle/graal/pull/2411#discussion_r422088042", "createdAt": "2020-05-08T11:19:29Z", "author": {"login": "olpaw"}, "path": "substratevm/src/com.oracle.objectfile/src/com/oracle/objectfile/elf/dwarf/DwarfLineSectionImpl.java", "diffHunk": "@@ -478,6 +479,32 @@ private int writeLineNumberTable(DebugContext context, ClassEntry classEntry, by\n             }\n             pos = writeCopyOp(context, buffer, pos);\n \n+            /*\n+             * On AArch64 gdb expects to see a line record at the start of the method and a second\n+             * one at the end of the prologue marking the point where the method code begins for\n+             * real. If we don't provide it then gdb will skip to the second line record when we\n+             * place a breakpoint on the method.\n+             *\n+             * We can identify the end of the prologue for normal methods by noting where the stack\n+             * frame height is first adjusted. This should normally be no more a few instructions in\n+             * total.\n+             */\n+            if (isAArch64() && !primaryEntry.getFrameSizeInfos().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c24f78610741fb043bccce38c60e3cf8249429d8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTcwNjA3", "url": "https://github.com/oracle/graal/pull/2411#pullrequestreview-408170607", "createdAt": "2020-05-08T11:19:45Z", "commit": {"oid": "c24f78610741fb043bccce38c60e3cf8249429d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1174, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}