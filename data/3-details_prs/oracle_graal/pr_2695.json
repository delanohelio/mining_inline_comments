{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzODA2NTQ5", "number": 2695, "title": "Enforce consistent lookup of class and file names", "bodyText": "This patch fixes issue  #2693. It ensures that the NativeImageDebugInfoProvider hands out consistent source file names and class names when providing info about types compiled into a native image.", "createdAt": "2020-07-20T20:25:29Z", "url": "https://github.com/oracle/graal/pull/2695", "merged": true, "mergeCommit": {"oid": "d77a34db84d3e3d406fb4a1886d0370dee049cb5"}, "closed": true, "closedAt": "2020-07-31T16:39:28Z", "author": {"login": "adinn"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3bB_uABqjM1NzU4MzU1NDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6V6XlgFqTQ1OTI2MjMzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db0b92f8c8297d1e79f42ef111c21add2d60b419", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/db0b92f8c8297d1e79f42ef111c21add2d60b419", "committedDate": "2020-07-20T20:22:36Z", "message": "enforce consistent lookup of class and file names"}, "afterCommit": {"oid": "ea4f593e18dec168f6d5f0f0bbcdeb816702243b", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/ea4f593e18dec168f6d5f0f0bbcdeb816702243b", "committedDate": "2020-07-22T13:41:14Z", "message": "Enforce consistent lookup of class and file names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea4f593e18dec168f6d5f0f0bbcdeb816702243b", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/ea4f593e18dec168f6d5f0f0bbcdeb816702243b", "committedDate": "2020-07-22T13:41:14Z", "message": "Enforce consistent lookup of class and file names"}, "afterCommit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/275d58e1815ab9550d1af274ad1e40e2ebbd6f94", "committedDate": "2020-07-22T15:42:38Z", "message": "Enforce consistent lookup of class and file names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTMxOTU5", "url": "https://github.com/oracle/graal/pull/2695#pullrequestreview-456531959", "createdAt": "2020-07-28T11:13:48Z", "commit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMToxMzo0OFrOG4H4gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMToxMzo0OFrOG4H4gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUwMjU5Mg==", "bodyText": "Shouldn't this be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            declaringClass = ((HostedType) declaringClass).getWrapped();\n          \n          \n            \n                            declaringClass = ((HostedType) declaringClass).getWrapped().getWrapped();\n          \n      \n    \n    \n  \n\n?", "url": "https://github.com/oracle/graal/pull/2695#discussion_r461502592", "createdAt": "2020-07-28T11:13:48Z", "author": {"login": "zakkak"}, "path": "substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/image/NativeImageDebugInfoProvider.java", "diffHunk": "@@ -309,8 +314,9 @@ private void computeFullFilePathAndCachePath() {\n                 clazz = ((OriginalClassProvider) declaringClass).getJavaClass();\n             }\n             /*\n-             * HostedType and AnalysisType punt calls to getSourceFilename to the wrapped class so\n-             * for consistency we need to do the path lookup relative to the wrapped class.\n+             * HostedType wraps an AnalysisType and both HostedType and AnalysisType punt calls to\n+             * getSourceFilename to the wrapped class so for consistency we need to do the path\n+             * lookup relative to the doubly unwrapped HostedType.\n              */\n             if (declaringClass instanceof HostedType) {\n                 declaringClass = ((HostedType) declaringClass).getWrapped();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjgzNDcy", "url": "https://github.com/oracle/graal/pull/2695#pullrequestreview-456683472", "createdAt": "2020-07-28T14:20:29Z", "commit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDoyMDoyOVrOG4PBMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDoyMDoyOVrOG4PBMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYxOTUwNA==", "bodyText": "Indeed. So a potential optimization would be to change the following if in an else if since the result of HostedType#getWrapped() returns an AnalysisType as you point out.\nI might be nit-picking here :)", "url": "https://github.com/oracle/graal/pull/2695#discussion_r461619504", "createdAt": "2020-07-28T14:20:29Z", "author": {"login": "zakkak"}, "path": "substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/image/NativeImageDebugInfoProvider.java", "diffHunk": "@@ -309,8 +314,9 @@ private void computeFullFilePathAndCachePath() {\n                 clazz = ((OriginalClassProvider) declaringClass).getJavaClass();\n             }\n             /*\n-             * HostedType and AnalysisType punt calls to getSourceFilename to the wrapped class so\n-             * for consistency we need to do the path lookup relative to the wrapped class.\n+             * HostedType wraps an AnalysisType and both HostedType and AnalysisType punt calls to\n+             * getSourceFilename to the wrapped class so for consistency we need to do the path\n+             * lookup relative to the doubly unwrapped HostedType.\n              */\n             if (declaringClass instanceof HostedType) {\n                 declaringClass = ((HostedType) declaringClass).getWrapped();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUwMjU5Mg=="}, "originalCommit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff83c334e4df9f722b7012db6cce9686738b725", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/3ff83c334e4df9f722b7012db6cce9686738b725", "committedDate": "2020-07-29T09:55:07Z", "message": "Enforce consistent lookup of class and file names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "275d58e1815ab9550d1af274ad1e40e2ebbd6f94", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/275d58e1815ab9550d1af274ad1e40e2ebbd6f94", "committedDate": "2020-07-22T15:42:38Z", "message": "Enforce consistent lookup of class and file names"}, "afterCommit": {"oid": "3ff83c334e4df9f722b7012db6cce9686738b725", "author": {"user": {"login": "adinn", "name": "Andrew Dinn"}}, "url": "https://github.com/oracle/graal/commit/3ff83c334e4df9f722b7012db6cce9686738b725", "committedDate": "2020-07-29T09:55:07Z", "message": "Enforce consistent lookup of class and file names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjYyMzM2", "url": "https://github.com/oracle/graal/pull/2695#pullrequestreview-459262336", "createdAt": "2020-07-31T15:25:28Z", "commit": {"oid": "3ff83c334e4df9f722b7012db6cce9686738b725"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1064, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}