{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNTEyMTU4", "number": 2270, "title": "Introduced a small JVMTI agent framework and refactored native-image-agent.", "bodyText": "", "createdAt": "2020-03-18T15:41:36Z", "url": "https://github.com/oracle/graal/pull/2270", "merged": true, "mergeCommit": {"oid": "e7a67b08c42ae0ae66a3c03eaace23bdb5e39965"}, "closed": true, "closedAt": "2020-04-16T03:03:09Z", "author": {"login": "gradinac"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO5ZHxgBqjMxNDIwODE3NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXnCrnABqjMyMzIxODMwMjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "520747085daa381d026c272ebd43d5c549b643b9", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/520747085daa381d026c272ebd43d5c549b643b9", "committedDate": "2020-03-18T13:50:15Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/9ded9fada13ccf7ca6af53b0c013053be35ab94b", "committedDate": "2020-03-18T15:50:31Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTU0OTAx", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377154901", "createdAt": "2020-03-18T19:03:17Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowMzoxOFrOF4S_6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowMzoxOFrOF4S_6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3NTg0OA==", "bodyText": "I think NativeImageAgentHandles would be a better name.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r394575848", "createdAt": "2020-03-18T19:03:18Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/NIHandles.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent;\n+\n+import com.oracle.svm.agent.core.JavaHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+public class NIHandles extends JavaHandles {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTU1NTQ1", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377155545", "createdAt": "2020-03-18T19:04:15Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowNDoxNVrOF4TB7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowNDoxNVrOF4TB7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3NjM2Nw==", "bodyText": "Perhaps rename this to NativeImageAgent too. Then you could also rename AgentBase to Agent if you'd like.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r394576367", "createdAt": "2020-03-18T19:04:15Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/Agent.java", "diffHunk": "@@ -88,37 +72,34 @@\n import com.oracle.svm.configure.config.ConfigurationSet;\n import com.oracle.svm.configure.filters.FilterConfigurationParser;\n import com.oracle.svm.configure.filters.RuleNode;\n+import com.oracle.svm.configure.json.JsonPrintable;\n import com.oracle.svm.configure.json.JsonWriter;\n import com.oracle.svm.configure.trace.AccessAdvisor;\n import com.oracle.svm.configure.trace.TraceProcessor;\n import com.oracle.svm.core.FallbackExecutor;\n import com.oracle.svm.core.SubstrateUtil;\n-import com.oracle.svm.core.c.function.CEntryPointOptions;\n-import com.oracle.svm.core.c.function.CEntryPointSetup;\n import com.oracle.svm.core.configure.ConfigurationFiles;\n import com.oracle.svm.driver.NativeImage;\n import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n-import com.oracle.svm.jni.nativeapi.JNIErrors;\n import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n-import com.oracle.svm.jni.nativeapi.JNIVersion;\n \n-public final class Agent {\n+public final class Agent extends AgentBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTU2Njc2", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377156676", "createdAt": "2020-03-18T19:05:57Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowNTo1N1rOF4TFUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowNTo1N1rOF4TFUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3NzIzNQ==", "bodyText": "Our style checking gate will likely complain that this could be declared static, perhaps other methods too.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r394577235", "createdAt": "2020-03-18T19:05:57Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/Agent.java", "diffHunk": "@@ -345,27 +324,19 @@ public static int onLoad(JNIJavaVM vm, CCharPointer options, @SuppressWarnings(\"\n             }\n         }\n \n-        check(jvmti.getFunctions().SetEventCallbacks().invoke(jvmti, callbacks, SizeOf.get(JvmtiEventCallbacks.class)));\n-        UnmanagedMemory.free(callbacks);\n-\n-        check(jvmti.getFunctions().SetEventNotificationMode().invoke(jvmti, JVMTI_ENABLE, JVMTI_EVENT_VM_START, nullHandle()));\n-        check(jvmti.getFunctions().SetEventNotificationMode().invoke(jvmti, JVMTI_ENABLE, JVMTI_EVENT_VM_INIT, nullHandle()));\n-        check(jvmti.getFunctions().SetEventNotificationMode().invoke(jvmti, JVMTI_ENABLE, JVMTI_EVENT_VM_DEATH, nullHandle()));\n-        check(jvmti.getFunctions().SetEventNotificationMode().invoke(jvmti, JVMTI_ENABLE, JVMTI_EVENT_THREAD_END, nullHandle()));\n-\n         setupExecutorServiceForPeriodicConfigurationCapture(configWritePeriod, configWritePeriodInitialDelay);\n         return 0;\n     }\n \n-    private static int parseIntegerOrNegative(String number) {\n+    private int parseIntegerOrNegative(String number) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "originalPosition": 306}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTcwNDAy", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377170402", "createdAt": "2020-03-18T19:26:39Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToyNjozOVrOF4Tv6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToyNjozOVrOF4Tv6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4ODEzNg==", "bodyText": "You can make this field non-static and access it via singleton(). In order to avoid casts, you could introduce a type parameter <H extends JavaHandles> that subclasses can specify for the field type and the return type of constructJavaHandles, but that might be overkill.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r394588136", "createdAt": "2020-03-18T19:26:39Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/AgentBase.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.agent.core.Support.check;\n+import static com.oracle.svm.agent.core.Support.checkJni;\n+import static com.oracle.svm.agent.core.Support.fromCString;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_THREAD_END;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_DEATH;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_INIT;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_START;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEventMode.JVMTI_ENABLE;\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+import static org.graalvm.word.WordFactory.nullPointer;\n+\n+import com.oracle.svm.core.annotate.AutomaticFeature;\n+import com.oracle.svm.core.util.VMError;\n+import com.oracle.svm.hosted.FeatureImpl;\n+import com.oracle.svm.jni.nativeapi.JNIErrors;\n+import com.oracle.svm.jni.nativeapi.JNIVersion;\n+import org.graalvm.compiler.api.replacements.Fold;\n+import org.graalvm.nativeimage.CurrentIsolate;\n+import org.graalvm.nativeimage.ImageSingletons;\n+import org.graalvm.nativeimage.Platform;\n+import org.graalvm.nativeimage.Platforms;\n+import org.graalvm.nativeimage.StackValue;\n+import org.graalvm.nativeimage.UnmanagedMemory;\n+import org.graalvm.nativeimage.c.function.CEntryPoint;\n+import org.graalvm.nativeimage.c.function.CEntryPointLiteral;\n+import org.graalvm.nativeimage.c.function.CFunctionPointer;\n+import org.graalvm.nativeimage.c.struct.SizeOf;\n+import org.graalvm.nativeimage.c.type.CCharPointer;\n+import org.graalvm.nativeimage.c.type.WordPointer;\n+import org.graalvm.nativeimage.hosted.Feature;\n+import org.graalvm.word.PointerBase;\n+\n+import com.oracle.svm.agent.core.jvmti.JvmtiEnv;\n+import com.oracle.svm.agent.core.jvmti.JvmtiEventCallbacks;\n+import com.oracle.svm.core.c.function.CEntryPointOptions;\n+import com.oracle.svm.core.c.function.CEntryPointSetup;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+import java.util.List;\n+\n+public abstract class AgentBase {\n+\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMInitLiteral = CEntryPointLiteral.create(AgentBase.class, \"onVMInit\", JvmtiEnv.class, JNIEnvironment.class, JNIObjectHandle.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMStartLiteral = CEntryPointLiteral.create(AgentBase.class, \"onVMStart\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMDeathLiteral = CEntryPointLiteral.create(AgentBase.class, \"onVMDeath\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onThreadEndLiteral = CEntryPointLiteral.create(AgentBase.class, \"onThreadEnd\", JvmtiEnv.class, JNIEnvironment.class,\n+                    JNIObjectHandle.class);\n+\n+    protected abstract JavaHandles constructJavaHandles(JNIEnvironment env);\n+\n+    protected abstract int onLoadCallback(JNIJavaVM vm, JvmtiEnv jvmti, JvmtiEventCallbacks callbacks, String options);\n+\n+    protected abstract int onUnloadCallback(JNIJavaVM vm);\n+\n+    protected abstract void onVMStartCallback(JvmtiEnv jvmti, JNIEnvironment jni);\n+\n+    protected abstract void onVMInitCallback(JvmtiEnv jvmti, JNIEnvironment jni, @SuppressWarnings(\"unused\") JNIObjectHandle thread);\n+\n+    protected abstract void onVmDeathCallback(JvmtiEnv jvmti, @SuppressWarnings(\"unused\") JNIEnvironment jni);\n+\n+    protected abstract int getRequiredJVMTIVersion();\n+\n+    protected static JavaHandles handles;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTcxMDMx", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377171031", "createdAt": "2020-03-18T19:27:39Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToyNzozOVrOF4Txyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToyNzozOVrOF4Txyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4ODYxOA==", "bodyText": "On second thought, perhaps HandleSet would be a better name.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r394588618", "createdAt": "2020-03-18T19:27:39Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JavaHandles.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+public abstract class JavaHandles {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTcyODYz", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-377172863", "createdAt": "2020-03-18T19:30:33Z", "commit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ded9fada13ccf7ca6af53b0c013053be35ab94b", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/9ded9fada13ccf7ca6af53b0c013053be35ab94b", "committedDate": "2020-03-18T15:50:31Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "91423d22e1025de2249613bf55f7b8c0d9a7e59e", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/91423d22e1025de2249613bf55f7b8c0d9a7e59e", "committedDate": "2020-03-19T15:54:30Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91423d22e1025de2249613bf55f7b8c0d9a7e59e", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/91423d22e1025de2249613bf55f7b8c0d9a7e59e", "committedDate": "2020-03-19T15:54:30Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "a714cc99e55d261d45ebdd16918e9de5adc446d1", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/a714cc99e55d261d45ebdd16918e9de5adc446d1", "committedDate": "2020-03-19T16:12:02Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a714cc99e55d261d45ebdd16918e9de5adc446d1", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/a714cc99e55d261d45ebdd16918e9de5adc446d1", "committedDate": "2020-03-19T16:12:02Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "ee7483e51f177a610d106999b72a79348c09f097", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/ee7483e51f177a610d106999b72a79348c09f097", "committedDate": "2020-04-06T12:47:40Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee7483e51f177a610d106999b72a79348c09f097", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/ee7483e51f177a610d106999b72a79348c09f097", "committedDate": "2020-04-06T12:47:40Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "2299bd6244b57f7604d699cce3c8609d5a60f448", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/2299bd6244b57f7604d699cce3c8609d5a60f448", "committedDate": "2020-04-06T14:40:03Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2299bd6244b57f7604d699cce3c8609d5a60f448", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/2299bd6244b57f7604d699cce3c8609d5a60f448", "committedDate": "2020-04-06T14:40:03Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "70aefe0f8e19cb341e85717b58bbfb3b2dbdf2e7", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/70aefe0f8e19cb341e85717b58bbfb3b2dbdf2e7", "committedDate": "2020-04-06T14:51:10Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70aefe0f8e19cb341e85717b58bbfb3b2dbdf2e7", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/70aefe0f8e19cb341e85717b58bbfb3b2dbdf2e7", "committedDate": "2020-04-06T14:51:10Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "b873f5324697222428fbf12c5761761669dbfb05", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/b873f5324697222428fbf12c5761761669dbfb05", "committedDate": "2020-04-06T16:12:25Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b873f5324697222428fbf12c5761761669dbfb05", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/b873f5324697222428fbf12c5761761669dbfb05", "committedDate": "2020-04-06T16:12:25Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/1bc2ffe02be8f8bebeba7a911bdc392119410b2c", "committedDate": "2020-04-06T16:48:23Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTE1NzM5", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-388515739", "createdAt": "2020-04-06T18:35:44Z", "commit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODozNTo0NVrOGBk1GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODozNTo0NVrOGBk1GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMwNTE3Nw==", "bodyText": "I find HandleSet is an overly generic name. Can we give a name to this set that describes all the handles well.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r404305177", "createdAt": "2020-04-06T18:35:45Z", "author": {"login": "vjovanov"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/HandleSet.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+public abstract class HandleSet {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTE2MDg0", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-388516084", "createdAt": "2020-04-06T18:36:12Z", "commit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODozNjoxMlrOGBk2Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODozNjoxMlrOGBk2Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMwNTQyMw==", "bodyText": "What is 16?", "url": "https://github.com/oracle/graal/pull/2270#discussion_r404305423", "createdAt": "2020-04-06T18:36:12Z", "author": {"login": "vjovanov"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/HandleSet.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+public abstract class HandleSet {\n+    private final ReentrantLock globalRefsLock = new ReentrantLock();\n+    private JNIObjectHandle[] globalRefs = new JNIObjectHandle[16];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODczNTQ2", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-388873546", "createdAt": "2020-04-07T07:59:24Z", "commit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODg3MDM1", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-388887035", "createdAt": "2020-04-07T08:17:20Z", "commit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoxNzoyMVrOGB4NgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoxNzo1NlrOGB4PKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyMjcyMQ==", "bodyText": "Where's the javadoc comment explaining the purpose and usage of this class?", "url": "https://github.com/oracle/graal/pull/2270#discussion_r404622721", "createdAt": "2020-04-07T08:17:21Z", "author": {"login": "dougxc"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JvmtiAgentBase.java", "diffHunk": "@@ -0,0 +1,186 @@\n+/*\n+ * Copyright (c) 2020, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.agent.core.Support.check;\n+import static com.oracle.svm.agent.core.Support.checkJni;\n+import static com.oracle.svm.agent.core.Support.fromCString;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_THREAD_END;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_DEATH;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_INIT;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_START;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEventMode.JVMTI_ENABLE;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+import static org.graalvm.word.WordFactory.nullPointer;\n+\n+import org.graalvm.nativeimage.CurrentIsolate;\n+import org.graalvm.nativeimage.StackValue;\n+import org.graalvm.nativeimage.UnmanagedMemory;\n+import org.graalvm.nativeimage.c.function.CEntryPoint;\n+import org.graalvm.nativeimage.c.function.CEntryPointLiteral;\n+import org.graalvm.nativeimage.c.function.CFunctionPointer;\n+import org.graalvm.nativeimage.c.struct.SizeOf;\n+import org.graalvm.nativeimage.c.type.CCharPointer;\n+import org.graalvm.nativeimage.c.type.WordPointer;\n+import org.graalvm.word.PointerBase;\n+\n+import com.oracle.svm.agent.core.jvmti.JvmtiEnv;\n+import com.oracle.svm.agent.core.jvmti.JvmtiEventCallbacks;\n+import com.oracle.svm.core.c.function.CEntryPointOptions;\n+import com.oracle.svm.core.c.function.CEntryPointSetup;\n+import com.oracle.svm.core.util.VMError;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIErrors;\n+import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+import com.oracle.svm.jni.nativeapi.JNIVersion;\n+\n+public abstract class JvmtiAgentBase<T extends HandleSet> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyMzE0Nw==", "bodyText": "At least having a javadoc comment for the class would help clarify what kind of handles this class manages.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r404623147", "createdAt": "2020-04-07T08:17:56Z", "author": {"login": "dougxc"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/HandleSet.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+public abstract class HandleSet {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMwNTE3Nw=="}, "originalCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bc2ffe02be8f8bebeba7a911bdc392119410b2c", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/1bc2ffe02be8f8bebeba7a911bdc392119410b2c", "committedDate": "2020-04-06T16:48:23Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "8fab53480ffcb0b9142541835f6350dd7d1fd889", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/8fab53480ffcb0b9142541835f6350dd7d1fd889", "committedDate": "2020-04-07T16:32:54Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTMwNjI4", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-389930628", "createdAt": "2020-04-08T12:35:42Z", "commit": {"oid": "8fab53480ffcb0b9142541835f6350dd7d1fd889"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMjozNTo0MlrOGCtIvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMjozNTo0MlrOGCtIvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ4OTg1NA==", "bodyText": "In this API I find inconsistencies with capitalization: why is VM here, and Vm later. Why is it JNIJavaVM but then we have a JvmtiEnv. We should stick to one naming convention in this API, whichever it is. \\CC @peter-hofer", "url": "https://github.com/oracle/graal/pull/2270#discussion_r405489854", "createdAt": "2020-04-08T12:35:42Z", "author": {"login": "vjovanov"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JvmtiAgentBase.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/*\n+ * Copyright (c) 2020, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.agent.core.Support.check;\n+import static com.oracle.svm.agent.core.Support.checkJni;\n+import static com.oracle.svm.agent.core.Support.fromCString;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_THREAD_END;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_DEATH;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_INIT;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_START;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEventMode.JVMTI_ENABLE;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+import static org.graalvm.word.WordFactory.nullPointer;\n+\n+import org.graalvm.nativeimage.CurrentIsolate;\n+import org.graalvm.nativeimage.StackValue;\n+import org.graalvm.nativeimage.UnmanagedMemory;\n+import org.graalvm.nativeimage.c.function.CEntryPoint;\n+import org.graalvm.nativeimage.c.function.CEntryPointLiteral;\n+import org.graalvm.nativeimage.c.function.CFunctionPointer;\n+import org.graalvm.nativeimage.c.struct.SizeOf;\n+import org.graalvm.nativeimage.c.type.CCharPointer;\n+import org.graalvm.nativeimage.c.type.WordPointer;\n+import org.graalvm.word.PointerBase;\n+\n+import com.oracle.svm.agent.core.jvmti.JvmtiEnv;\n+import com.oracle.svm.agent.core.jvmti.JvmtiEventCallbacks;\n+import com.oracle.svm.core.c.function.CEntryPointOptions;\n+import com.oracle.svm.core.c.function.CEntryPointSetup;\n+import com.oracle.svm.core.util.VMError;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIErrors;\n+import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+import com.oracle.svm.jni.nativeapi.JNIVersion;\n+\n+/**\n+ * Base class for a JVMTI agent.\n+ *\n+ * In order to create a new JVMTI agent, you must:\n+ * <ol>\n+ * <li>Subclass {@link JNIHandleSetBase}.</li>\n+ * <li>Subclass this class and parametrize it with your @{link {@link JNIHandleSetBase} class}.</li>\n+ * <li>Create a {@link org.graalvm.nativeimage.hosted.Feature} that will register the agent using\n+ * {@link #registerAgent(JvmtiAgentBase)} in its'\n+ * {@link org.graalvm.nativeimage.hosted.Feature#afterRegistration} callback.</li>\n+ * </ol>\n+ * The created feature must then be passed to native-image on creation of shared library.\n+ *\n+ * This agent contains the bare minimum of the JVMTI events. In order to receive a a JVMTI event\n+ * that is not implemented here, you must:\n+ * <ol>\n+ * <li>Create a callback method annotated with {@link CEntryPoint} that matches the signature\n+ * (parameters and the return type) of the desired JVMTI event. The method must also be annotated\n+ * with {@link CEntryPointOptions} and must use the\n+ * {@link com.oracle.svm.agent.core.AgentIsolate.Prologue} prologue.</li>\n+ * <li>Create a {@link CEntryPointLiteral} from your callback method.</li>\n+ * <li>Set the callback in the callbacks argument of your {@link #onLoadCallback} method.</li>\n+ * <lI>Enable the event using {@link com.oracle.svm.agent.core.jvmti.JvmtiEventMode}.</lI>\n+ * </ol>\n+ *\n+ * Only one agent can be created in a single native image.\n+ *\n+ * @param <T> The subclass of {@link JNIHandleSetBase} containg the JNI handles this agent requires.\n+ */\n+@SuppressWarnings(\"JavadocReference\")\n+public abstract class JvmtiAgentBase<T extends JNIHandleSetBase> {\n+\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMInitLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMInit\", JvmtiEnv.class, JNIEnvironment.class,\n+                    JNIObjectHandle.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMStartLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMStart\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMDeathLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMDeath\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onThreadEndLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onThreadEnd\", JvmtiEnv.class, JNIEnvironment.class,\n+                    JNIObjectHandle.class);\n+\n+    @SuppressWarnings({\"rawtypes\"}) private static JvmtiAgentBase singleton;\n+\n+    /**\n+     * Callback method that should create your subclass of {@link JNIHandleSetBase}.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @return An instance of your {@link JNIHandleSetBase} subclass.\n+     */\n+    protected abstract JNIHandleSetBase constructJavaHandles(JNIEnvironment env);\n+\n+    /**\n+     * JVMTI Agent_OnLoad callback.\n+     *\n+     * @param vm The JNI Java VM.\n+     * @param jvmti The JVMTI environment.\n+     * @param callbacks A structure that allows setting the callbacks for JVMTI events.\n+     * @param options Command line options passed to the agent.\n+     * @return 0 on success, anything else on failure.\n+     */\n+    protected abstract int onLoadCallback(JNIJavaVM vm, JvmtiEnv jvmti, JvmtiEventCallbacks callbacks, String options);\n+\n+    /**\n+     * JVMTI Agent_OnUnload callback.\n+     *\n+     * @param vm The JNI Java VM.\n+     * @return 0 on success, anything else on failure.\n+     */\n+    protected abstract int onUnloadCallback(JNIJavaVM vm);\n+\n+    /**\n+     * JVMTI VMStart event callback.\n+     *\n+     * @param jvmti The JVMTI environment.\n+     * @param jni The JNI environment of the thread running the JVMTI callback.\n+     */\n+    protected abstract void onVMStartCallback(JvmtiEnv jvmti, JNIEnvironment jni);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fab53480ffcb0b9142541835f6350dd7d1fd889"}, "originalPosition": 134}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzYwMDQ2", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390760046", "createdAt": "2020-04-09T12:48:28Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0ODoyOFrOGDXNbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0ODoyOFrOGDXNbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3OTE4MQ==", "bodyText": "with the creation and management of", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406179181", "createdAt": "2020-04-09T12:48:28Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzYwMzkz", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390760393", "createdAt": "2020-04-09T12:48:59Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0ODo1OVrOGDXOlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0ODo1OVrOGDXOlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3OTQ3Ng==", "bodyText": "You can use @see for this.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406179476", "createdAt": "2020-04-09T12:48:59Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * See also: {@link com.oracle.svm.agent.core.JvmtiAgentBase}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzYyNzk4", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390762798", "createdAt": "2020-04-09T12:52:24Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1MjoyNFrOGDXWCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1MjoyNFrOGDXWCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MTM4NQ==", "bodyText": "guarantee at runtime is substituted and aborts the entire VM, see the substitution in Target_com_oracle_svm_core_util_VMError.shouldNotReachHere. The class must exist.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406181385", "createdAt": "2020-04-09T12:52:24Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * See also: {@link com.oracle.svm.agent.core.JvmtiAgentBase}.\n+ */\n+public abstract class JNIHandleSetBase {\n+    private static final int INITIAL_GLOBAL_HANDLE_CAPACITY = 16;\n+    private final ReentrantLock globalRefsLock = new ReentrantLock();\n+    private JNIObjectHandle[] globalRefs = new JNIObjectHandle[INITIAL_GLOBAL_HANDLE_CAPACITY];\n+    private int globalRefCount = 0;\n+\n+    JNIMethodId javaLangClassGetName;\n+\n+    public JNIHandleSetBase(JNIEnvironment env) {\n+        JNIObjectHandle javaLangClass = findClass(env, \"java/lang/Class\");\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(\"getName\"); CTypeConversion.CCharPointerHolder signature = Support.toCString(\"()Ljava/lang/String;\")) {\n+            javaLangClassGetName = Support.jniFunctions().getGetMethodID().invoke(env, javaLangClass, name.get(), signature.get());\n+            guarantee(javaLangClassGetName.isNonNull());\n+        }\n+    }\n+\n+    /**\n+     * Returns a local handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown. If the handle must survive a return\n+     * from native code, {@link #newTrackedGlobalRef} should be used on the returned handle.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzY0NTQ1", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390764545", "createdAt": "2020-04-09T12:54:43Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1NDo0M1rOGDXbCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1NDo0M1rOGDXbCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MjY2NQ==", "bodyText": "This documentation doesn't mention that the reference is freed eventually by this class and a user might believe they are responsible for freeing it. I would just the public method newTrackedGlobalRef here.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406182665", "createdAt": "2020-04-09T12:54:43Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * See also: {@link com.oracle.svm.agent.core.JvmtiAgentBase}.\n+ */\n+public abstract class JNIHandleSetBase {\n+    private static final int INITIAL_GLOBAL_HANDLE_CAPACITY = 16;\n+    private final ReentrantLock globalRefsLock = new ReentrantLock();\n+    private JNIObjectHandle[] globalRefs = new JNIObjectHandle[INITIAL_GLOBAL_HANDLE_CAPACITY];\n+    private int globalRefCount = 0;\n+\n+    JNIMethodId javaLangClassGetName;\n+\n+    public JNIHandleSetBase(JNIEnvironment env) {\n+        JNIObjectHandle javaLangClass = findClass(env, \"java/lang/Class\");\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(\"getName\"); CTypeConversion.CCharPointerHolder signature = Support.toCString(\"()Ljava/lang/String;\")) {\n+            javaLangClassGetName = Support.jniFunctions().getGetMethodID().invoke(env, javaLangClass, name.get(), signature.get());\n+            guarantee(javaLangClassGetName.isNonNull());\n+        }\n+    }\n+\n+    /**\n+     * Returns a local handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown. If the handle must survive a return\n+     * from native code, {@link #newTrackedGlobalRef} should be used on the returned handle.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param className The VM type signature of the class.\n+     * @return Local JNI handle representing the class object.\n+     */\n+    protected static JNIObjectHandle findClass(JNIEnvironment env, String className) {\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(className)) {\n+            JNIObjectHandle h = Support.jniFunctions().getFindClass().invoke(env, name.get());\n+            guarantee(h.notEqual(nullHandle()));\n+            return h;\n+        }\n+    }\n+\n+    /**\n+     * A convenience method to return a global handle to a Java class object.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzY1ODcy", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390765872", "createdAt": "2020-04-09T12:56:30Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1NjozMFrOGDXe0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1NjozMFrOGDXe0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MzYzNQ==", "bodyText": "Document that this instance remembers the reference and destroys it in destroy.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406183635", "createdAt": "2020-04-09T12:56:30Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * See also: {@link com.oracle.svm.agent.core.JvmtiAgentBase}.\n+ */\n+public abstract class JNIHandleSetBase {\n+    private static final int INITIAL_GLOBAL_HANDLE_CAPACITY = 16;\n+    private final ReentrantLock globalRefsLock = new ReentrantLock();\n+    private JNIObjectHandle[] globalRefs = new JNIObjectHandle[INITIAL_GLOBAL_HANDLE_CAPACITY];\n+    private int globalRefCount = 0;\n+\n+    JNIMethodId javaLangClassGetName;\n+\n+    public JNIHandleSetBase(JNIEnvironment env) {\n+        JNIObjectHandle javaLangClass = findClass(env, \"java/lang/Class\");\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(\"getName\"); CTypeConversion.CCharPointerHolder signature = Support.toCString(\"()Ljava/lang/String;\")) {\n+            javaLangClassGetName = Support.jniFunctions().getGetMethodID().invoke(env, javaLangClass, name.get(), signature.get());\n+            guarantee(javaLangClassGetName.isNonNull());\n+        }\n+    }\n+\n+    /**\n+     * Returns a local handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown. If the handle must survive a return\n+     * from native code, {@link #newTrackedGlobalRef} should be used on the returned handle.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param className The VM type signature of the class.\n+     * @return Local JNI handle representing the class object.\n+     */\n+    protected static JNIObjectHandle findClass(JNIEnvironment env, String className) {\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(className)) {\n+            JNIObjectHandle h = Support.jniFunctions().getFindClass().invoke(env, name.get());\n+            guarantee(h.notEqual(nullHandle()));\n+            return h;\n+        }\n+    }\n+\n+    /**\n+     * A convenience method to return a global handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param className Java VM type signature of the class.\n+     * @return Global JNI handle representing the class object.\n+     */\n+    protected JNIObjectHandle newClassGlobalRef(JNIEnvironment env, String className) {\n+        return newTrackedGlobalRef(env, findClass(env, className));\n+    }\n+\n+    /**\n+     * Returns a JNI method ID of a Java method.\n+     *\n+     * If the method is not found, a RuntimeException is thrown.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param clazz Handle to the class containing the method.\n+     * @param name Name of the method.\n+     * @param signature Signature of the method. See the JNI specification for more details.\n+     * @param isStatic Specifies whether the method is static or not.\n+     * @return JNI method ID of the Java method.\n+     */\n+    protected static JNIMethodId getMethodId(JNIEnvironment env, JNIObjectHandle clazz, String name, String signature, boolean isStatic) {\n+        JNIMethodId id = getMethodIdOptional(env, clazz, name, signature, isStatic);\n+        guarantee(id.isNonNull());\n+        return id;\n+    }\n+\n+    /**\n+     * Returns a JNI method ID of a Java method. If the method is not found, returns a\n+     * {@link JNIObjectHandles#nullHandle()}.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param clazz Handle to the class containing the method.\n+     * @param name Name of the method.\n+     * @param signature Signature of the method. See the JNI specification for more details.\n+     * @param isStatic Specifies whether the method is static or not.\n+     * @return JNI method ID of the Java method if found, {@link JNIObjectHandles#nullHandle}\n+     *         otherwise.\n+     */\n+    protected static JNIMethodId getMethodIdOptional(JNIEnvironment env, JNIObjectHandle clazz, String name, String signature, boolean isStatic) {\n+        try (CTypeConversion.CCharPointerHolder cname = Support.toCString(name); CTypeConversion.CCharPointerHolder csignature = Support.toCString(signature)) {\n+            if (isStatic) {\n+                return Support.jniFunctions().getGetStaticMethodID().invoke(env, clazz, cname.get(), csignature.get());\n+            } else {\n+                return Support.jniFunctions().getGetMethodID().invoke(env, clazz, cname.get(), csignature.get());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Creates a global JNI handle of the specified local JNI handle.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 140}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzY3NDg2", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390767486", "createdAt": "2020-04-09T12:58:36Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1ODozNlrOGDXjuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo1ODozNlrOGDXjuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4NDg4OA==", "bodyText": "This might be worth a boolean destroyed to check in asserts in the methods.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406184888", "createdAt": "2020-04-09T12:58:36Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and manages JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * See also: {@link com.oracle.svm.agent.core.JvmtiAgentBase}.\n+ */\n+public abstract class JNIHandleSetBase {\n+    private static final int INITIAL_GLOBAL_HANDLE_CAPACITY = 16;\n+    private final ReentrantLock globalRefsLock = new ReentrantLock();\n+    private JNIObjectHandle[] globalRefs = new JNIObjectHandle[INITIAL_GLOBAL_HANDLE_CAPACITY];\n+    private int globalRefCount = 0;\n+\n+    JNIMethodId javaLangClassGetName;\n+\n+    public JNIHandleSetBase(JNIEnvironment env) {\n+        JNIObjectHandle javaLangClass = findClass(env, \"java/lang/Class\");\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(\"getName\"); CTypeConversion.CCharPointerHolder signature = Support.toCString(\"()Ljava/lang/String;\")) {\n+            javaLangClassGetName = Support.jniFunctions().getGetMethodID().invoke(env, javaLangClass, name.get(), signature.get());\n+            guarantee(javaLangClassGetName.isNonNull());\n+        }\n+    }\n+\n+    /**\n+     * Returns a local handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown. If the handle must survive a return\n+     * from native code, {@link #newTrackedGlobalRef} should be used on the returned handle.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param className The VM type signature of the class.\n+     * @return Local JNI handle representing the class object.\n+     */\n+    protected static JNIObjectHandle findClass(JNIEnvironment env, String className) {\n+        try (CTypeConversion.CCharPointerHolder name = Support.toCString(className)) {\n+            JNIObjectHandle h = Support.jniFunctions().getFindClass().invoke(env, name.get());\n+            guarantee(h.notEqual(nullHandle()));\n+            return h;\n+        }\n+    }\n+\n+    /**\n+     * A convenience method to return a global handle to a Java class object.\n+     *\n+     * If the class is not found, a RuntimeException is thrown.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param className Java VM type signature of the class.\n+     * @return Global JNI handle representing the class object.\n+     */\n+    protected JNIObjectHandle newClassGlobalRef(JNIEnvironment env, String className) {\n+        return newTrackedGlobalRef(env, findClass(env, className));\n+    }\n+\n+    /**\n+     * Returns a JNI method ID of a Java method.\n+     *\n+     * If the method is not found, a RuntimeException is thrown.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param clazz Handle to the class containing the method.\n+     * @param name Name of the method.\n+     * @param signature Signature of the method. See the JNI specification for more details.\n+     * @param isStatic Specifies whether the method is static or not.\n+     * @return JNI method ID of the Java method.\n+     */\n+    protected static JNIMethodId getMethodId(JNIEnvironment env, JNIObjectHandle clazz, String name, String signature, boolean isStatic) {\n+        JNIMethodId id = getMethodIdOptional(env, clazz, name, signature, isStatic);\n+        guarantee(id.isNonNull());\n+        return id;\n+    }\n+\n+    /**\n+     * Returns a JNI method ID of a Java method. If the method is not found, returns a\n+     * {@link JNIObjectHandles#nullHandle()}.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param clazz Handle to the class containing the method.\n+     * @param name Name of the method.\n+     * @param signature Signature of the method. See the JNI specification for more details.\n+     * @param isStatic Specifies whether the method is static or not.\n+     * @return JNI method ID of the Java method if found, {@link JNIObjectHandles#nullHandle}\n+     *         otherwise.\n+     */\n+    protected static JNIMethodId getMethodIdOptional(JNIEnvironment env, JNIObjectHandle clazz, String name, String signature, boolean isStatic) {\n+        try (CTypeConversion.CCharPointerHolder cname = Support.toCString(name); CTypeConversion.CCharPointerHolder csignature = Support.toCString(signature)) {\n+            if (isStatic) {\n+                return Support.jniFunctions().getGetStaticMethodID().invoke(env, clazz, cname.get(), csignature.get());\n+            } else {\n+                return Support.jniFunctions().getGetMethodID().invoke(env, clazz, cname.get(), csignature.get());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Creates a global JNI handle of the specified local JNI handle.\n+     *\n+     * If the specified handle is a {@link JNIObjectHandles#nullHandle} a RuntimeException is\n+     * thrown.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @param ref A local JNI object handle.\n+     * @return A global JNI object handle.\n+     */\n+    public JNIObjectHandle newTrackedGlobalRef(JNIEnvironment env, JNIObjectHandle ref) {\n+        JNIObjectHandle global = Support.jniFunctions().getNewGlobalRef().invoke(env, ref);\n+        guarantee(global.notEqual(nullHandle()));\n+        globalRefsLock.lock();\n+        try {\n+            if (globalRefCount == globalRefs.length) {\n+                globalRefs = Arrays.copyOf(globalRefs, globalRefs.length * 2);\n+            }\n+            globalRefs[globalRefCount] = global;\n+            globalRefCount++;\n+        } finally {\n+            globalRefsLock.unlock();\n+        }\n+        return global;\n+    }\n+\n+    /**\n+     * Releases all global JNI handles. This class and the handles must not be used after a call to\n+     * this method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 167}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzY5MjU3", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390769257", "createdAt": "2020-04-09T13:00:55Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowMDo1NVrOGDXpCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowMDo1NVrOGDXpCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4NjI0OA==", "bodyText": "Wasn't there a check that the agent hasn't been set before? I think it should stay.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406186248", "createdAt": "2020-04-09T13:00:55Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JvmtiAgentBase.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/*\n+ * Copyright (c) 2020, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.agent.core.Support.check;\n+import static com.oracle.svm.agent.core.Support.checkJni;\n+import static com.oracle.svm.agent.core.Support.fromCString;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_THREAD_END;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_DEATH;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_INIT;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEvent.JVMTI_EVENT_VM_START;\n+import static com.oracle.svm.agent.core.jvmti.JvmtiEventMode.JVMTI_ENABLE;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+import static org.graalvm.word.WordFactory.nullPointer;\n+\n+import org.graalvm.nativeimage.CurrentIsolate;\n+import org.graalvm.nativeimage.StackValue;\n+import org.graalvm.nativeimage.UnmanagedMemory;\n+import org.graalvm.nativeimage.c.function.CEntryPoint;\n+import org.graalvm.nativeimage.c.function.CEntryPointLiteral;\n+import org.graalvm.nativeimage.c.function.CFunctionPointer;\n+import org.graalvm.nativeimage.c.struct.SizeOf;\n+import org.graalvm.nativeimage.c.type.CCharPointer;\n+import org.graalvm.nativeimage.c.type.WordPointer;\n+import org.graalvm.word.PointerBase;\n+\n+import com.oracle.svm.agent.core.jvmti.JvmtiEnv;\n+import com.oracle.svm.agent.core.jvmti.JvmtiEventCallbacks;\n+import com.oracle.svm.core.c.function.CEntryPointOptions;\n+import com.oracle.svm.core.c.function.CEntryPointSetup;\n+import com.oracle.svm.core.util.VMError;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIErrors;\n+import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+import com.oracle.svm.jni.nativeapi.JNIVersion;\n+\n+/**\n+ * Base class for a JVMTI agent.\n+ *\n+ * In order to create a new JVMTI agent, you must:\n+ * <ol>\n+ * <li>Subclass {@link JNIHandleSetBase}.</li>\n+ * <li>Subclass this class and parametrize it with your @{link {@link JNIHandleSetBase} class}.</li>\n+ * <li>Create a {@link org.graalvm.nativeimage.hosted.Feature} that will register the agent using\n+ * {@link #registerAgent(JvmtiAgentBase)} in its'\n+ * {@link org.graalvm.nativeimage.hosted.Feature#afterRegistration} callback.</li>\n+ * </ol>\n+ * The created feature must then be passed to native-image on creation of shared library.\n+ *\n+ * This agent contains the bare minimum of the JVMTI events. In order to receive a a JVMTI event\n+ * that is not implemented here, you must:\n+ * <ol>\n+ * <li>Create a callback method annotated with {@link CEntryPoint} that matches the signature\n+ * (parameters and the return type) of the desired JVMTI event. The method must also be annotated\n+ * with {@link CEntryPointOptions} and must use the\n+ * {@link com.oracle.svm.agent.core.AgentIsolate.Prologue} prologue.</li>\n+ * <li>Create a {@link CEntryPointLiteral} from your callback method.</li>\n+ * <li>Set the callback in the callbacks argument of your {@link #onLoadCallback} method.</li>\n+ * <lI>Enable the event using {@link com.oracle.svm.agent.core.jvmti.JvmtiEventMode}.</lI>\n+ * </ol>\n+ *\n+ * Only one agent can be created in a single native image.\n+ *\n+ * @param <T> The subclass of {@link JNIHandleSetBase} containg the JNI handles this agent requires.\n+ */\n+@SuppressWarnings(\"JavadocReference\")\n+public abstract class JvmtiAgentBase<T extends JNIHandleSetBase> {\n+\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMInitLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMInit\", JvmtiEnv.class, JNIEnvironment.class,\n+                    JNIObjectHandle.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMStartLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMStart\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onVMDeathLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onVMDeath\", JvmtiEnv.class, JNIEnvironment.class);\n+    private static final CEntryPointLiteral<CFunctionPointer> onThreadEndLiteral = CEntryPointLiteral.create(JvmtiAgentBase.class, \"onThreadEnd\", JvmtiEnv.class, JNIEnvironment.class,\n+                    JNIObjectHandle.class);\n+\n+    @SuppressWarnings({\"rawtypes\"}) private static JvmtiAgentBase singleton;\n+\n+    /**\n+     * Callback method that should create your subclass of {@link JNIHandleSetBase}.\n+     *\n+     * @param env JNI environment of the thread running the JVMTI callback.\n+     * @return An instance of your {@link JNIHandleSetBase} subclass.\n+     */\n+    protected abstract JNIHandleSetBase constructJavaHandles(JNIEnvironment env);\n+\n+    /**\n+     * JVMTI Agent_OnLoad callback.\n+     *\n+     * @param vm The JNI Java VM.\n+     * @param jvmti The JVMTI environment.\n+     * @param callbacks A structure that allows setting the callbacks for JVMTI events.\n+     * @param options Command line options passed to the agent.\n+     * @return 0 on success, anything else on failure.\n+     */\n+    protected abstract int onLoadCallback(JNIJavaVM vm, JvmtiEnv jvmti, JvmtiEventCallbacks callbacks, String options);\n+\n+    /**\n+     * JVMTI Agent_OnUnload callback.\n+     *\n+     * @param vm The JNI Java VM.\n+     * @return 0 on success, anything else on failure.\n+     */\n+    protected abstract int onUnloadCallback(JNIJavaVM vm);\n+\n+    /**\n+     * JVMTI VMStart event callback.\n+     *\n+     * @param jvmti The JVMTI environment.\n+     * @param jni The JNI environment of the thread running the JVMTI callback.\n+     */\n+    protected abstract void onVMStartCallback(JvmtiEnv jvmti, JNIEnvironment jni);\n+\n+    /**\n+     * JVMTI VMInit event callback.\n+     *\n+     * @param jvmti The JVMTI environment.\n+     * @param jni The JNI environment of the thread running the JVMTI callback.\n+     * @param thread The initial thread.\n+     */\n+    protected abstract void onVMInitCallback(JvmtiEnv jvmti, JNIEnvironment jni, @SuppressWarnings(\"unused\") JNIObjectHandle thread);\n+\n+    /**\n+     * JVMTI VMDeath event callback.\n+     *\n+     * @param jvmti The JVMTI environment.\n+     * @param jni The JNi environment of the thead running the JVMTI callback.\n+     */\n+    protected abstract void onVMDeathCallback(JvmtiEnv jvmti, @SuppressWarnings(\"unused\") JNIEnvironment jni);\n+\n+    /**\n+     * Returns the JVMTI version required by the agent.\n+     *\n+     * See also: {@link com.oracle.svm.agent.core.jvmti.JvmtiInterface}\n+     *\n+     * @return The JVMTI version required by the agent.\n+     */\n+    protected abstract int getRequiredJvmtiVersion();\n+\n+    private T handles;\n+\n+    /**\n+     * Returns the JNI handle set constructed with {@link #constructJavaHandles}. The handles are\n+     * guaranteed to be created before {@link #onLoadCallback} is called.\n+     *\n+     * @return The JNI handle set constructed with {@link #constructJavaHandles}.\n+     */\n+    public T handles() {\n+        return handles;\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    public static <T extends JNIHandleSetBase, U extends JvmtiAgentBase<T>> U singleton() {\n+        VMError.guarantee(singleton != null, \"The singleton class must be initialized.\");\n+        return (U) singleton;\n+    }\n+\n+    /**\n+     * Registers the agent singleton. This method must be called only once during a native image\n+     * build.\n+     *\n+     * @param agentSingleton The agent implementation.\n+     */\n+    @SuppressWarnings({\"rawtypes\"})\n+    protected static <T extends JNIHandleSetBase> void registerAgent(JvmtiAgentBase<T> agentSingleton) {\n+        singleton = agentSingleton;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 188}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzcwNDc1", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390770475", "createdAt": "2020-04-09T13:02:35Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowMjozNVrOGDXslQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowMjozNVrOGDXslQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4NzE1Nw==", "bodyText": "Why are these no longer final?", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406187157", "createdAt": "2020-04-09T13:02:35Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/NativeImageAgentJNIHandleSet.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent;\n+\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import com.oracle.svm.agent.core.JNIHandleSetBase;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+public class NativeImageAgentJNIHandleSet extends JNIHandleSetBase {\n+\n+    JNIMethodId javaLangClassForName3;\n+    JNIMethodId javaLangReflectMemberGetName;\n+    JNIMethodId javaLangReflectMemberGetDeclaringClass;\n+    JNIMethodId javaUtilEnumerationHasMoreElements;\n+    JNIMethodId javaUtilMissingResourceExceptionCtor3;\n+    JNIObjectHandle javaLangClassLoader;\n+    public JNIObjectHandle javaLangSecurityException;\n+    public JNIObjectHandle javaLangNoClassDefFoundError;\n+    public JNIObjectHandle javaLangNoSuchMethodError;\n+    JNIObjectHandle javaLangNoSuchMethodException;\n+    public JNIObjectHandle javaLangNoSuchFieldError;\n+    JNIObjectHandle javaLangNoSuchFieldException;\n+    JNIObjectHandle javaLangClassNotFoundException;\n+    JNIObjectHandle javaLangRuntimeException;\n+    JNIObjectHandle javaUtilMissingResourceException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzcyMzA2", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-390772306", "createdAt": "2020-04-09T13:04:59Z", "commit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowNDo1OVrOGDXx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMzowNDo1OVrOGDXx7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4ODUyNA==", "bodyText": "That's more about JVMTI agents in general. Leaving Agent shutdown [...] or using JVMTI agent shutdown [...] would be better.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r406188524", "createdAt": "2020-04-09T13:04:59Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/NativeImageTracingAgent.java", "diffHunk": "@@ -644,10 +605,10 @@ public static void onUnload(@SuppressWarnings(\"unused\") JNIJavaVM vm) {\n         }\n \n         /*\n-         * Agent shutdown is tricky: apparently we can still have events at the same time as this\n-         * function executes, so we would need to synchronize. We could do this with a combined\n-         * shared+exclusive lock, but that adds some cost to all events. We choose to leak a few\n-         * handles and some memory for now -- this agent isn't supposed to be attached only\n+         * JvmtiAgentBase shutdown is tricky: apparently we can still have events at the same time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5"}, "originalPosition": 432}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c05bedf8886e75e0389d509e7603d572dc3a5ad5", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/c05bedf8886e75e0389d509e7603d572dc3a5ad5", "committedDate": "2020-04-09T10:57:03Z", "message": "mend"}, "afterCommit": {"oid": "e33f53fb08dc85597dd0bb94125e0f104f662e6e", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/e33f53fb08dc85597dd0bb94125e0f104f662e6e", "committedDate": "2020-04-09T14:18:30Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e33f53fb08dc85597dd0bb94125e0f104f662e6e", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/e33f53fb08dc85597dd0bb94125e0f104f662e6e", "committedDate": "2020-04-09T14:18:30Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/805f2bf1bbe35c8b4baab0861cae1767af5ecef3", "committedDate": "2020-04-09T15:19:05Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzczMzcx", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-392773371", "createdAt": "2020-04-14T09:51:02Z", "commit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTo1MTowMlrOGFG9Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTo1MTowMlrOGFG9Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMDA0Mg==", "bodyText": "I think this class is useful even without subclassing (although at least one instance is needed for the agent). I'd consider dropping the Base name suffix and change some methods from protected to public.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r408010042", "createdAt": "2020-04-14T09:51:02Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent.core/src/com/oracle/svm/agent/core/JNIHandleSetBase.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ */\n+package com.oracle.svm.agent.core;\n+\n+import static com.oracle.svm.core.util.VMError.guarantee;\n+import static com.oracle.svm.jni.JNIObjectHandles.nullHandle;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.locks.ReentrantLock;\n+\n+import org.graalvm.nativeimage.c.type.CTypeConversion;\n+\n+import com.oracle.svm.jni.JNIObjectHandles;\n+import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n+import com.oracle.svm.jni.nativeapi.JNIMethodId;\n+import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n+\n+/**\n+ * Helps with creation and management of JNI handles for JVMTI agents.\n+ *\n+ * A JVMTI agent must provide a subclass of this class. It should contain handles to classes and\n+ * methods that are needed across different JVMTI calls (for example, a JNIObjectHandle to\n+ * java/lang/Class).\n+ *\n+ * For JNI handles that are created in a JVMTI callback and that should survive a return from native\n+ * code, a helper method {@link #newTrackedGlobalRef} is provided.\n+ *\n+ * @see com.oracle.svm.agent.core.JvmtiAgentBase\n+ */\n+public abstract class JNIHandleSetBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzc1MjU0", "url": "https://github.com/oracle/graal/pull/2270#pullrequestreview-392775254", "createdAt": "2020-04-14T09:53:33Z", "commit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTo1MzozNFrOGFHDOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTo1MzozNFrOGFHDOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMTU3OA==", "bodyText": "I'd rather keep the name NativeImageAgent, which is also consistent with the name of the build artifact. Tracing is only part of the agent functionality, the other major part being the restriction mode.", "url": "https://github.com/oracle/graal/pull/2270#discussion_r408011578", "createdAt": "2020-04-14T09:53:34Z", "author": {"login": "peter-hofer"}, "path": "substratevm/src/com.oracle.svm.agent/src/com/oracle/svm/agent/NativeImageTracingAgent.java", "diffHunk": "@@ -88,53 +70,58 @@\n import com.oracle.svm.configure.config.ConfigurationSet;\n import com.oracle.svm.configure.filters.FilterConfigurationParser;\n import com.oracle.svm.configure.filters.RuleNode;\n+import com.oracle.svm.configure.json.JsonPrintable;\n import com.oracle.svm.configure.json.JsonWriter;\n import com.oracle.svm.configure.trace.AccessAdvisor;\n import com.oracle.svm.configure.trace.TraceProcessor;\n import com.oracle.svm.core.FallbackExecutor;\n import com.oracle.svm.core.SubstrateUtil;\n-import com.oracle.svm.core.c.function.CEntryPointOptions;\n-import com.oracle.svm.core.c.function.CEntryPointSetup;\n import com.oracle.svm.core.configure.ConfigurationFiles;\n import com.oracle.svm.driver.NativeImage;\n import com.oracle.svm.jni.nativeapi.JNIEnvironment;\n-import com.oracle.svm.jni.nativeapi.JNIErrors;\n import com.oracle.svm.jni.nativeapi.JNIJavaVM;\n import com.oracle.svm.jni.nativeapi.JNIObjectHandle;\n-import com.oracle.svm.jni.nativeapi.JNIVersion;\n+import org.graalvm.nativeimage.hosted.Feature;\n \n-public final class Agent {\n-    public static final String AGENT_NAME = \"native-image-agent\";\n+public final class NativeImageTracingAgent extends JvmtiAgentBase<NativeImageAgentJNIHandleSet> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3"}, "originalPosition": 80}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "805f2bf1bbe35c8b4baab0861cae1767af5ecef3", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/805f2bf1bbe35c8b4baab0861cae1767af5ecef3", "committedDate": "2020-04-09T15:19:05Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "df4be6c15525eeb69f6c8f7128b26e9bc4347332", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/df4be6c15525eeb69f6c8f7128b26e9bc4347332", "committedDate": "2020-04-14T12:22:00Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df4be6c15525eeb69f6c8f7128b26e9bc4347332", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/df4be6c15525eeb69f6c8f7128b26e9bc4347332", "committedDate": "2020-04-14T12:22:00Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "3f13c2ddd1ac34ded54bd4a838c1619bdf7d6dfa", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/3f13c2ddd1ac34ded54bd4a838c1619bdf7d6dfa", "committedDate": "2020-04-14T12:27:07Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d80732e8ebb3007aaf92520999cd7f85c4c0c882", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/d80732e8ebb3007aaf92520999cd7f85c4c0c882", "committedDate": "2020-04-14T17:33:53Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f13c2ddd1ac34ded54bd4a838c1619bdf7d6dfa", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/3f13c2ddd1ac34ded54bd4a838c1619bdf7d6dfa", "committedDate": "2020-04-14T12:27:07Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}, "afterCommit": {"oid": "d80732e8ebb3007aaf92520999cd7f85c4c0c882", "author": {"user": {"login": "gradinac", "name": "Aleksandar Gradinac"}}, "url": "https://github.com/oracle/graal/commit/d80732e8ebb3007aaf92520999cd7f85c4c0c882", "committedDate": "2020-04-14T17:33:53Z", "message": "Introduced a small JVMTI agent framework and refactored native-image-agent."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1118, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}