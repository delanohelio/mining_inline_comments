{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTk3Mjk4", "number": 3513, "title": "Fixes #3506: Image height remains zero for some time on bad network", "bodyText": "Optimised Width loading\nFixes #3506 Image View Height remains zero for some time on a bad network\nWhat changes did you make and why?\nThe calculation of image height used the width of scroll view which took time to inflate, now the width is retrieved from context which has almost no latency", "createdAt": "2020-03-13T21:26:40Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3513", "merged": true, "mergeCommit": {"oid": "c82283a0143d8eb2d36505a802cc5ea1344cb621"}, "closed": true, "closedAt": "2020-04-07T14:30:25Z", "author": {"login": "kbhardwaj123"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNXK0iAFqTM3NDYyODk4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVTxRDAFqTM4OTE0NTQzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjI4OTg3", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#pullrequestreview-374628987", "createdAt": "2020-03-13T21:26:44Z", "commit": {"oid": "3bd8d6cc2bae0caddc030ee2eeaee24cbbb80274"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/88a8a52e63b31c37057c2e013fa9144d5909d693", "committedDate": "2020-03-13T21:29:15Z", "message": "optimise width loading"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bd8d6cc2bae0caddc030ee2eeaee24cbbb80274", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/3bd8d6cc2bae0caddc030ee2eeaee24cbbb80274", "committedDate": "2020-03-13T21:22:25Z", "message": "optimise width loading"}, "afterCommit": {"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/88a8a52e63b31c37057c2e013fa9144d5909d693", "committedDate": "2020-03-13T21:29:15Z", "message": "optimise width loading"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDc1NDA4", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#pullrequestreview-375075408", "createdAt": "2020-03-16T10:22:34Z", "commit": {"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDoyMjozNFrOF2tc0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDoyMjozNFrOF2tc0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMjA4MA==", "bodyText": "you don't need to create a variable just return dm.widthPixels", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r392912080", "createdAt": "2020-03-16T10:22:34Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -243,13 +246,22 @@ private void displayMediaDetails() {\n \n     private void updateAspectRatio(ImageInfo imageInfo) {\n         if (imageInfo != null) {\n-            int finalHeight = (scrollView.getWidth()*imageInfo.getHeight()) / imageInfo.getWidth();\n+            int screenWidth = getScreenWidth(getContext());\n+            int finalHeight = (screenWidth*imageInfo.getHeight()) / imageInfo.getWidth();\n             ViewGroup.LayoutParams params = image.getLayoutParams();\n             params.height = finalHeight;\n             image.setLayoutParams(params);\n         }\n     }\n \n+    private int getScreenWidth(Context context) {\n+        DisplayMetrics dm = new DisplayMetrics();\n+        WindowManager windowManager = (WindowManager) context.getSystemService(WINDOW_SERVICE);\n+        windowManager.getDefaultDisplay().getMetrics(dm);\n+        int width = dm.widthPixels;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dc0deca3a5332b48fc3588d9b7ac340fa737b2b", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/1dc0deca3a5332b48fc3588d9b7ac340fa737b2b", "committedDate": "2020-04-02T15:08:28Z", "message": "amending as per the reviews"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "committedDate": "2020-04-07T07:56:11Z", "message": "aspect ratio updates after layout completion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6df58c4b8dcf2cfaab1c50155ea2809d7752f3a7", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/6df58c4b8dcf2cfaab1c50155ea2809d7752f3a7", "committedDate": "2020-04-07T08:13:38Z", "message": "some explanation"}, "afterCommit": {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "committedDate": "2020-04-07T07:56:11Z", "message": "aspect ratio updates after layout completion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcbe9eb66e456a29b128d9baf777b7ec99df7483", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/bcbe9eb66e456a29b128d9baf777b7ec99df7483", "committedDate": "2020-04-07T08:30:48Z", "message": "explained the run method"}, "afterCommit": {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "committedDate": "2020-04-07T07:56:11Z", "message": "aspect ratio updates after layout completion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39dcc10519bb92ac603fa858fec4b9857687028d", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/39dcc10519bb92ac603fa858fec4b9857687028d", "committedDate": "2020-04-07T12:54:46Z", "message": "MediaDetailFragment: update aspect ratio using onGlobalLayoutListener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDg3NzQ1", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#pullrequestreview-389087745", "createdAt": "2020-04-07T12:57:33Z", "commit": {"oid": "39dcc10519bb92ac603fa858fec4b9857687028d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjo1NzozM1rOGCCO6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjo1NzozM1rOGCCO6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4NjkyMA==", "bodyText": "This should be the only new import I think", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r404786920", "createdAt": "2020-04-07T12:57:33Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -9,11 +9,14 @@\n import android.os.Bundle;\n import android.text.Editable;\n import android.text.TextWatcher;\n+import android.util.DisplayMetrics;\n import android.util.TypedValue;\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n import android.view.ViewTreeObserver;\n+import android.view.ViewTreeObserver.OnGlobalLayoutListener;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dcc10519bb92ac603fa858fec4b9857687028d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86b7aa55efc6afe370afc5313af8eda3e53e6735", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/86b7aa55efc6afe370afc5313af8eda3e53e6735", "committedDate": "2020-04-07T13:25:01Z", "message": "remove unnecessary imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTQ1NDMy", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#pullrequestreview-389145432", "createdAt": "2020-04-07T14:00:30Z", "commit": {"oid": "86b7aa55efc6afe370afc5313af8eda3e53e6735"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 418, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}