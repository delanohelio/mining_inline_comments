{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjcxNzMx", "number": 3830, "title": "DownSample Upload image to be shown in UploadMediaDetailFragment to handle OOM, Bitmap Too large exception", "bodyText": "Description (required)\nDownSample Upload image to be shown in UploadMediaDetailFragment to handle OOM, Bitmap Too large exception\nFixes #3829\nWhat changes did you make and why?\nDownsampled bitmap shown in UploadMediaDetailsFragment\nTests performed (required)\nTested betaDebug on Api 27 & 29 by uploading a very large image", "createdAt": "2020-06-22T04:22:59Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3830", "merged": true, "mergeCommit": {"oid": "e471226405d776991fa47e35352e5558145eae42"}, "closed": true, "closedAt": "2020-06-24T08:57:26Z", "author": {"login": "ashishkumar468"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctpA8ogH2gAyNDM3NjcxNzMxOmQ4MDIzY2IxMjk1MDcwMmU1YmZkM2IwYjA3YTQ4M2EzMGViMDRjYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuWHtkAFqTQzNjQ1MTQwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d8023cb12950702e5bfd3b0b07a483a30eb04cb5", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/d8023cb12950702e5bfd3b0b07a483a30eb04cb5", "committedDate": "2020-06-22T04:19:49Z", "message": "Fixes #3829\n* DownSample Upload image to be shown in UploadMediaDetailFragment to handle OOM, Bitmap Too large exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTk0NzEy", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-434594712", "createdAt": "2020-06-22T04:23:03Z", "commit": {"oid": "d8023cb12950702e5bfd3b0b07a483a30eb04cb5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6b1b686dfa0a392321832d7aea7d3f470ed0e03", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/b6b1b686dfa0a392321832d7aea7d3f470ed0e03", "committedDate": "2020-06-22T04:29:40Z", "message": "removed unused imports, handled possible exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Njk1MDI5", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-434695029", "createdAt": "2020-06-22T08:11:08Z", "commit": {"oid": "b6b1b686dfa0a392321832d7aea7d3f470ed0e03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoxMTowOFrOGm2LsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwODoxMTowOFrOGm2LsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4NjgwMA==", "bodyText": "Can we use a SimpleDraweeView and .setImageURI to avoid manual bounds decoding?", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r443386800", "createdAt": "2020-06-22T08:11:08Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/upload/mediaDetails/UploadMediaDetailFragment.java", "diffHunk": "@@ -284,7 +296,15 @@ public void onImageProcessed(UploadItem uploadItem, Place place) {\n         }\n \n         descriptions = uploadItem.getDescriptions();\n-        photoViewBackgroundImage.setImageURI(uploadItem.getMediaUri());\n+        compositeDisposable\n+            .add(downSampleImage(uploadItem.getContentUri())\n+                .subscribeOn(Schedulers.io())\n+                .observeOn(AndroidSchedulers.mainThread())\n+                .subscribe(bitmap -> {\n+                    if (null != bitmap) {\n+                        photoViewBackgroundImage.setImageBitmap(bitmap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b1b686dfa0a392321832d7aea7d3f470ed0e03"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be76890986bce899f5200378f898f985a5aa3260", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/be76890986bce899f5200378f898f985a5aa3260", "committedDate": "2020-06-23T16:46:52Z", "message": "Let Fresco handle the downsampling of image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39394dc36957f29bc1ef1b00170843a8789511e4", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/39394dc36957f29bc1ef1b00170843a8789511e4", "committedDate": "2020-06-23T16:56:44Z", "message": "invalidate in onTransformEnd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/4f23331682fab46a9e22dea0293e36fa736b9116", "committedDate": "2020-06-23T17:10:28Z", "message": "Expose an interface TransformationListener in ZoomableDraweeView to listen to transformation change end"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDA3MjU4", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-436407258", "createdAt": "2020-06-24T07:53:17Z", "commit": {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1MzoxOFrOGoG-GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1MzoxOFrOGoG-GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMDQyNA==", "bodyText": "I believe this was the last usage of PhotoView, we could remove the dependency", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444710424", "createdAt": "2020-06-24T07:53:18Z", "author": {"login": "macgills"}, "path": "app/src/main/res/layout/fragment_upload_media_detail_fragment.xml", "diffHunk": "@@ -6,11 +6,12 @@\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\">\n \n-    <com.github.chrisbanes.photoview.PhotoView", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDA4ODU2", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-436408856", "createdAt": "2020-06-24T07:55:32Z", "commit": {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1NTozMlrOGoHDaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1NTozMlrOGoHDaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTc4NA==", "bodyText": "was this too long to fit on 1 line?", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444711784", "createdAt": "2020-06-24T07:55:32Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/media/zoomControllers/zoomable/ZoomableDraweeView.java", "diffHunk": "@@ -73,9 +74,18 @@ public void onTransformChanged(Matrix transform) {\n                 }\n \n                 @Override\n-                public void onTransformEnd(Matrix transform) {}\n+                public void onTransformEnd(Matrix transform) {\n+                    if (null != transformationListener) {\n+                        transformationListener.onTransformationEnd();\n+                    }\n+                }\n             };\n \n+    public void setTransformationListener(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "535a32a55c668d4a88631196d2c1b6ba4a91c17d", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/535a32a55c668d4a88631196d2c1b6ba4a91c17d", "committedDate": "2020-06-24T08:12:48Z", "message": "removed photoView dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6064c6d351e566e8e17df73cf71557bb6b587f3f", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/6064c6d351e566e8e17df73cf71557bb6b587f3f", "committedDate": "2020-06-24T08:13:51Z", "message": "removed unused imports in ZoomableActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9c01b609842fdf32ad64099d4c4c3379f8e855c", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/e9c01b609842fdf32ad64099d4c4c3379f8e855c", "committedDate": "2020-06-24T08:27:48Z", "message": "Bugfix, expand/collapse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDM1NDE3", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-436435417", "createdAt": "2020-06-24T08:31:43Z", "commit": {"oid": "e9c01b609842fdf32ad64099d4c4c3379f8e855c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwODozMTo0NFrOGoITVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwODozMTo0NFrOGoITVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczMjI0Ng==", "bodyText": "needs more space to adhere to codestyle, also can we rename this method? the Ll I am guessing stands for LinearLayout but it just looks so fugly", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444732246", "createdAt": "2020-06-24T08:31:44Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/upload/mediaDetails/UploadMediaDetailFragment.java", "diffHunk": "@@ -401,6 +413,9 @@ public void onRlContainerTitleClicked() {\n      * @param shouldExpand\n      */\n     private void expandCollapseLlMediaDetail(boolean shouldExpand){\n+        if(isExpanded==shouldExpand){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9c01b609842fdf32ad64099d4c4c3379f8e855c"}, "originalPosition": 106}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03ef3610e73259b1020c01381bfd8ef16f9af748", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/03ef3610e73259b1020c01381bfd8ef16f9af748", "committedDate": "2020-06-24T08:50:09Z", "message": "changed functio name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDUxNDAx", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#pullrequestreview-436451401", "createdAt": "2020-06-24T08:52:56Z", "commit": {"oid": "03ef3610e73259b1020c01381bfd8ef16f9af748"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 624, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}