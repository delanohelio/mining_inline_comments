{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODI5ODky", "number": 3438, "title": "Add a dialog to prompt user if location is off in Nearby when Locate me button is pressed.", "bodyText": "Description (required)\nThis PR adds a dialog box that will prompt the user if the location is off while using the Nearby map. The location state is checked each time the user clicks on the Locate me button.\nFixes #3397: \"Locate me\" icon in Nearby doesn't prompt user to enable GPS\nWhy do this?\nPreviously, when the user pressed the Locate me button, they were not prompted to turn on location in case it was off. This can confuse the user while using Nearby.\nWhat changed did you make?\nPlease refer to the opening comment of issue #3397 for a complete description of how it has been implemented along with some code to help explain it's working.\nYou can also refer to this #3397 (comment) to see a working demonstration of the change.\nTests performed\nTested prodDebug on Redmi Note 5 Pro with API level 28.\nScreenshots showing what changed", "createdAt": "2020-02-27T12:45:02Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3438", "merged": true, "mergeCommit": {"oid": "021105ac4d45a8db43a047cda676f16c70b68ea8"}, "closed": true, "closedAt": "2020-03-18T10:20:01Z", "author": {"login": "aryan-earth"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIat4DgFqTM2NTY1MDI0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO0m7GAFqTM3NjcyODQwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjUwMjQ3", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-365650247", "createdAt": "2020-02-27T12:45:07Z", "commit": {"oid": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjU4Nzky", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-365658792", "createdAt": "2020-02-27T12:59:04Z", "commit": {"oid": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjo1OTowNVrOFvRO-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMjo1OTowNVrOFvRO-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw==", "bodyText": "Hi @glitch101, instead of making a new instance of NearbyParentFragment, as the NearbyParentFragmentPresenter is already implementing LocationUpdateListener, how about adding a new method in LocationUpdateListener, enableLocationOffDialog(boolean shouldEnable) and as the presenter will be implementing it, it can be routed from there to the fragment", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r385109753", "createdAt": "2020-02-27T12:59:05Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java", "diffHunk": "@@ -212,6 +213,14 @@ public void onProviderEnabled(String provider) {\n     @Override\n     public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzEyOTcw", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-365712970", "createdAt": "2020-02-27T14:14:14Z", "commit": {"oid": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNDoxNDoxNFrOFvTxNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNDoxNDoxNFrOFvTxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE1MTI4Ng==", "bodyText": "You are right! That would be a cleaner and robust method to toggle the dialog based on location state. I have pushed the changes you recommended. Thanks for the tip @ashishkumar468! Please let me know if I did something wrong. :)", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r385151286", "createdAt": "2020-02-27T14:14:14Z", "author": {"login": "aryan-earth"}, "path": "app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java", "diffHunk": "@@ -212,6 +213,14 @@ public void onProviderEnabled(String provider) {\n     @Override\n     public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw=="}, "originalCommit": {"oid": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjA3Njgw", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-368207680", "createdAt": "2020-03-03T18:10:24Z", "commit": {"oid": "0777cb032da0218585684471d4c55f425b7ab916"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODoxMDoyNVrOFxQ3TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODozMToyMFrOFxRi-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMDg0NQ==", "bodyText": "This seems to be code used during development. Would it be useful to keep this in production too?", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r387200845", "createdAt": "2020-03-03T18:10:25Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java", "diffHunk": "@@ -528,6 +528,15 @@ public void onLocationChangedMedium(LatLng latLng) {\n         updateClosestNearbyCardViewInfo();\n     }\n \n+    @Override\n+    public void changeDialogState(boolean enableDialog) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0777cb032da0218585684471d4c55f425b7ab916"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg==", "bodyText": "There's an unintended consequence of handling the null state of curLatLng this way, I suppose. Consider this, the location is on and is in \"High Accuracy mode\" but the device has not yet been located. In this case tapping on the \"Locate me\" icon shows the the \"Turn on location?\" dialog each time I tap on it. So, it looks like we get null in curLatLng for more cases than you mentioned. This app behaviour is not ideal and should be corrected.\nNote that the app behaviour I describe is accurate, but I'm speculating that I'm observing the behaviour as a consequence of curLatLng being null. I haven't confirmed this. So, there's a possibility that I'm observing the behaviour for different reasons. Anyways, can you look into how to fix this?", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r387212026", "createdAt": "2020-03-03T18:31:20Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1235,7 +1239,12 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            showLocationNullDialog();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0777cb032da0218585684471d4c55f425b7ab916"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDc3MTIz", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-371077123", "createdAt": "2020-03-09T11:07:29Z", "commit": {"oid": "30650ec770957d9b4f6d93ebaad6efaf835694ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTowNzoyOVrOFzi5lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTowNzoyOVrOFzi5lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MzQ5Mg==", "bodyText": "As we don't handle the NULL case separately anymore, this comment would be misleading and can be removed.", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389593492", "createdAt": "2020-03-09T11:07:29Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1235,7 +1237,12 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            showEnableLocationDialog();\n             return;\n+        } else if (!locationManager.isLocationEnabled()) {\n+            // location is not null but it is not enabled. So, user should be prompted", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30650ec770957d9b4f6d93ebaad6efaf835694ea"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDY0ODM4", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-371464838", "createdAt": "2020-03-09T19:24:56Z", "commit": {"oid": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOToyNDo1NlrOFz2Olw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOToyNjowN1rOFz2Q8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw==", "bodyText": "Ok. I think I've managed to figure out a way to show the dialog only when appropriate.\nTry this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (curLatLng == null) {\n          \n          \n            \n                        return;\n          \n          \n            \n                    } else if (!locationManager.isLocationEnabled()) {\n          \n          \n            \n                        // Location is not set to High Accuracy.\n          \n          \n            \n                        // Let's prompt the user using a dialog box.\n          \n          \n            \n                        showEnableLocationDialog();\n          \n          \n            \n                    }\n          \n          \n            \n                    if (curLatLng == null) {\n          \n          \n            \n                        if (!locationManager.isLocationEnabled()) {\n          \n          \n            \n                            // Location is not set to High Accuracy.\n          \n          \n            \n                            // Let's prompt the user using a dialog box.\n          \n          \n            \n                            showEnableLocationDialog();\n          \n          \n            \n                        }\n          \n          \n            \n            \n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nLet me know if this works fine.", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389910167", "createdAt": "2020-03-09T19:24:56Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1236,6 +1238,10 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n             return;\n+        } else if (!locationManager.isLocationEnabled()) {\n+            // Location is not set to High Accuracy.\n+            // Let's prompt the user using a dialog box.\n+            showEnableLocationDialog();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDI4Ng==", "bodyText": "These strings should be moved to strings.xml. \"Yes\" and \"No\" should already be there.", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389910286", "createdAt": "2020-03-09T19:25:10Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1265,6 +1271,23 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    private void showEnableLocationDialog() {\n+        // This dialog box prompts the user to set the location to High Accuracy\n+        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",\n+                \"Yes\", \"No\",  this::openLocationSettings, null);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDc3MA==", "bodyText": "Should we be saying GPS instead of location as that's what we're looking for? \ud83e\udd14", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389910770", "createdAt": "2020-03-09T19:26:07Z", "author": {"login": "sivaraam"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -596,4 +596,7 @@ Upload your first media by tapping on the add button.</string>\n   <string name=\"wallpaper_set_unsuccessfully\">Something went wrong. Could not set the wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_title\">Set as Wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_message\">Setting Wallpaper. Please wait\u2026</string>\n+\n+  <string name=\"cannot_open_location_settings\">Could not open location settings. Please turn location on manually</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDI5NTgw", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-373029580", "createdAt": "2020-03-11T18:41:49Z", "commit": {"oid": "831f303bd24d9a99c12fad888d1898a48e4a1f30"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo0MTo1MFrOF1EFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODo0MjoyNVrOF1EG3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE4NTgzMA==", "bodyText": "I just wanted to share another thing I've been wondering about the usage of the word \"High Accuracy\" for some time now. Apologies before hand if I'm being overly pedantic. Personally, due to the diversity of Android devices out there I don't think we could even use \"High Accuracy\" reliably. For instance, my device reads out the parameters it uses in each location mode:\n\nPixel has a totally different approach:\n\nSo, I'm not sure if that would be a best choice.\nThat said, I don't think we could do anything better about it too. Let me know if there are better suggestions.", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r391185830", "createdAt": "2020-03-11T18:41:50Z", "author": {"login": "sivaraam"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -596,4 +596,9 @@ Upload your first media by tapping on the add button.</string>\n   <string name=\"wallpaper_set_unsuccessfully\">Something went wrong. Could not set the wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_title\">Set as Wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_message\">Setting Wallpaper. Please wait\u2026</string>\n+\n+  <string name=\"cannot_open_location_settings\">Failed to open location settings. Please turn on location and set it to High Accuracy</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831f303bd24d9a99c12fad888d1898a48e4a1f30"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE4NjE0MA==", "bodyText": "Kindly move these strings to strings.xml too.", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r391186140", "createdAt": "2020-03-11T18:42:25Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1265,6 +1277,25 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showGPSOffDialog() {\n+        // This dialog box prompts the user to set the location to High Accuracy\n+        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831f303bd24d9a99c12fad888d1898a48e4a1f30"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "committedDate": "2020-03-16T13:52:37Z", "message": "Added a dialog box that pops up when location is disabled and the user presses tbe Re Center button in the Nearby map."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49242bde36030928bb22f8ebebb03f7289f3817a", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/49242bde36030928bb22f8ebebb03f7289f3817a", "committedDate": "2020-03-16T13:52:39Z", "message": "Renamed method showDialogagain() to enableLocationOffDialog() for better code redeability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d217a648074f6701de47eba219afdec22a908054", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/d217a648074f6701de47eba219afdec22a908054", "committedDate": "2020-03-16T13:52:41Z", "message": "Renamed NearbyParentFragment object in LocationServiceManager to something better to read."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae9f4c0974d7549822a9be902d29b9b2ad8533a", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/fae9f4c0974d7549822a9be902d29b9b2ad8533a", "committedDate": "2020-03-16T13:52:41Z", "message": "Removed a TODO from LocationServiceManager which was related to previous commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e2c2a44492d92cc2c3447e3db594a197f71879a", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/2e2c2a44492d92cc2c3447e3db594a197f71879a", "committedDate": "2020-03-16T13:52:42Z", "message": "Made changes as recommended by @ashishkumar468 which allowed for a more cleaner and robust approach for toggeling the dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e326446b935328672596b3fed512d9513225cfa", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/7e326446b935328672596b3fed512d9513225cfa", "committedDate": "2020-03-16T13:52:43Z", "message": "Changed the behaviour of the dialog box and now it will always show up when the user presses Locate Me button while the location is off."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70dac7e91e151a42f9c9dfaac916fe45eda57d1d", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/70dac7e91e151a42f9c9dfaac916fe45eda57d1d", "committedDate": "2020-03-16T13:52:49Z", "message": "[WIP] GPS Off dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a2cb922d0cdf339efb4fb8f86edfa7ff8d7d0d", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/86a2cb922d0cdf339efb4fb8f86edfa7ff8d7d0d", "committedDate": "2020-03-16T13:52:50Z", "message": "[WIP] Some minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7249ca76f5d131dcc81ee96f130ce4e562090b36", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/7249ca76f5d131dcc81ee96f130ce4e562090b36", "committedDate": "2020-03-16T13:52:52Z", "message": "Nearby now checks if network location provider is enabled or not when the user clicks on Locate Me button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/53279a74a77f54f2820e700ea2a4c4308510643b", "committedDate": "2020-03-16T14:38:48Z", "message": "Added location off dialog box to nearby"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE0NjM3", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375314637", "createdAt": "2020-03-16T15:15:30Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNTozMFrOF248UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNTozMFrOF248UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMDM2OQ==", "bodyText": "revert changes to this file please", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393100369", "createdAt": "2020-03-16T15:15:30Z", "author": {"login": "macgills"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -47,31 +47,9 @@\n       <option name=\"SPACE_BEFORE_SUPERCLASS_COLON\" value=\"false\" />\n     </Objective-C>\n     <Objective-C-extensions>\n-      <option name=\"GENERATE_INSTANCE_VARIABLES_FOR_PROPERTIES\" value=\"ASK\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE0OTQ3", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375314947", "createdAt": "2020-03-16T15:15:50Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNTo1MFrOF249SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNTo1MFrOF249SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMDYxNg==", "bodyText": "revert this change", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393100616", "createdAt": "2020-03-16T15:15:50Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -213,7 +212,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n     @Override\n     public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        isDarkTheme = systemThemeUtils.isDeviceInNightMode();\n+        isDarkTheme = applicationKvStore.getBoolean(\"theme\", false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE1MTQ4", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375315148", "createdAt": "2020-03-16T15:16:04Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNjowNFrOF2494w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNjowNFrOF2494w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMDc3MQ==", "bodyText": "revert this change", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393100771", "createdAt": "2020-03-16T15:16:04Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -229,8 +228,8 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 UiSettings uiSettings = mapBoxMap.getUiSettings();\n                 uiSettings.setCompassGravity(Gravity.BOTTOM | Gravity.LEFT);\n                 uiSettings.setCompassMargins(12, 0, 0, 24);\n-                uiSettings.setLogoEnabled(true);\n-                uiSettings.setAttributionEnabled(true);\n+                uiSettings.setLogoEnabled(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE2MDYz", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375316063", "createdAt": "2020-03-16T15:17:05Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNzowNVrOF25Aqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxNzowNVrOF25Aqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMTQ4Mg==", "bodyText": "this log is not in keeping with the name of this method, which one is happening here? Slightly or significantly?", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393101482", "createdAt": "2020-03-16T15:17:05Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -911,7 +910,7 @@ public void onLocationChangedSignificantly(fr.free.nrw.commons.location.LatLng l\n \n     @Override\n     public void onLocationChangedSlightly(fr.free.nrw.commons.location.LatLng latLng) {\n-        Timber.d(\"Location slightly changed\");\n+        Timber.d(\"Location significantly changed\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE3OTI4", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375317928", "createdAt": "2020-03-16T15:19:08Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxOTowOFrOF25GOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToxOTowOFrOF25GOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMjkwNw==", "bodyText": "The user of locationManager needs to know the correct strings to give this method for it to be able to work. A method isNetworkProviderEnabled would be better from an API perspective, or if this method accepted an Enum", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393102907", "createdAt": "2020-03-16T15:19:08Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1238,6 +1237,9 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            if (!locationManager.isProviderEnabled(\"network\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzE5NTQ1", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375319545", "createdAt": "2020-03-16T15:20:53Z", "commit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToyMDo1M1rOF25LDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNToyMDo1M1rOF25LDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNDE0MQ==", "bodyText": "We should never catch Exception, if you need to catch an exception catch the one that is actually thrown.\nYou probably don't need to catch an Exception here, you could resolve the intent", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393104141", "createdAt": "2020-03-16T15:20:53Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1268,6 +1270,27 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showLocationOffDialog() {\n+        // This creates a dialog box that prompts the user to enable location\n+        DialogUtil\n+            .showAlertDialog(getActivity(), getString(R.string.ask_to_turn_location_on), getString(R.string.nearby_needs_location),\n+                getString(R.string.yes), getString(R.string.no),  this::openLocationSettings, null);\n+    }\n+\n+    @Override\n+    public void openLocationSettings() {\n+        // This method opens the location settings of the device along with a followup toast.\n+        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n+        try {\n+            getContext().startActivity(intent);\n+            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d969c4091485af3e6ade88421aef7091fb3478f6", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/d969c4091485af3e6ade88421aef7091fb3478f6", "committedDate": "2020-03-16T15:23:39Z", "message": "Fixed a typo in NearbyParentFragment where significantly was written instead of slightly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "committedDate": "2020-03-16T16:25:56Z", "message": "Some Changes reverted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/55fb9487268efd0c17523d51206f8694f1be5dc4", "committedDate": "2020-03-16T16:28:29Z", "message": "Reverted some changes in Project.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1Mzg3MzEx", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375387311", "createdAt": "2020-03-16T16:36:24Z", "commit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozNjoyNVrOF28Y6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozODoyNlrOF28ePA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg==", "bodyText": "These should be constants or enums", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393156842", "createdAt": "2020-03-16T16:36:25Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java", "diffHunk": "@@ -214,8 +215,12 @@ public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);\n     }\n \n-    public boolean isProviderEnabled(String provider) {\n-        return locationManager.isProviderEnabled(provider);\n+    public boolean isNetworkProviderEnabled() {\n+        return locationManager.isProviderEnabled(String.valueOf(R.string.network_provider));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzMyNg==", "bodyText": "Is this related with this PR?", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157326", "createdAt": "2020-03-16T16:37:07Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -228,8 +231,8 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 UiSettings uiSettings = mapBoxMap.getUiSettings();\n                 uiSettings.setCompassGravity(Gravity.BOTTOM | Gravity.LEFT);\n                 uiSettings.setCompassMargins(12, 0, 0, 24);\n-                uiSettings.setLogoEnabled(false);\n-                uiSettings.setAttributionEnabled(false);\n+                uiSettings.setLogoEnabled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzYxNA==", "bodyText": "Un related, revert changes", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157614", "createdAt": "2020-03-16T16:37:33Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -823,10 +826,10 @@ public void animateFABs() {\n     }\n \n     private void showFABs() {\n-            NearbyFABUtils.addAnchorToBigFABs(fabPlus, bottomSheetDetails.getId());\n-            fabPlus.show();\n-            NearbyFABUtils.addAnchorToSmallFABs(fabGallery, getView().findViewById(R.id.empty_view).getId());\n-            NearbyFABUtils.addAnchorToSmallFABs(fabCamera, getView().findViewById(R.id.empty_view1).getId());\n+        NearbyFABUtils.addAnchorToBigFABs(fabPlus, bottomSheetDetails.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Nzg2OQ==", "bodyText": "Remove this", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157869", "createdAt": "2020-03-16T16:37:57Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1289,6 +1292,7 @@ public void openLocationSettings() {\n             Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n             Timber.e(e);\n         }\n+//        PackageManager packageManager = getActivity().getPackageManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1ODAyNw==", "bodyText": "Remove these from strings, use constants or enums", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393158027", "createdAt": "2020-03-16T16:38:10Z", "author": {"login": "ashishkumar468"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -607,5 +607,7 @@ Upload your first media by tapping on the add button.</string>\n   <string name=\"set_location_mode_high_accuracy\">Please make sure that location is set to both GPS and mobile networks</string>\n   <string name=\"ask_to_turn_location_on\">Turn on location?</string>\n   <string name=\"nearby_needs_location\">Nearby needs location enabled to work properly</string>\n+  <string name=\"gps_provider\">gps</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1ODIwNA==", "bodyText": "Revert the changes in this file", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393158204", "createdAt": "2020-03-16T16:38:26Z", "author": {"login": "ashishkumar468"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -47,9 +47,31 @@\n       <option name=\"SPACE_BEFORE_SUPERCLASS_COLON\" value=\"false\" />\n     </Objective-C>\n     <Objective-C-extensions>\n+      <option name=\"GENERATE_INSTANCE_VARIABLES_FOR_PROPERTIES\" value=\"ASK\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec4f1dd9bc96528400945f8c17bc98801de3b009", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/ec4f1dd9bc96528400945f8c17bc98801de3b009", "committedDate": "2020-03-16T16:52:29Z", "message": "Made recommended changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/0b67324df8772169b5c63301e561a83e57a375e1", "committedDate": "2020-03-16T16:53:41Z", "message": "Removed unused import in LocationServiceManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDA4MzEx", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375408311", "createdAt": "2020-03-16T16:55:23Z", "commit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODI5Njcw", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-375829670", "createdAt": "2020-03-17T08:38:01Z", "commit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2Mjg3NzA3", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-376287707", "createdAt": "2020-03-17T18:13:04Z", "commit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODoxMzowNFrOF3oVFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODo0MjowOFrOF3pYyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Njc1Ng==", "bodyText": "Just like I expected this sort of brings us back to the unintended behaviour that I described before. When I have the location mode set to \"GPS only\" and tap on the \"Locate me\" icon before the device is located I see the dialog. I thought we didn't want that.\nIn the following screenshot, note the location icon in the notification area indicating GPS is on.\n\nThe following fixes this issue:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (!locationManager.isNetworkProviderEnabled()) {\n          \n          \n            \n                        if (!(locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())) {", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393876756", "createdAt": "2020-03-17T18:13:04Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1238,6 +1241,9 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            if (!locationManager.isNetworkProviderEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg5NDA5MA==", "bodyText": "Just a few points about the strings:\n\nIt would be great if we could make both consistent. We use \"High Accuracy\" in the failed message but explicitly mention the location providers in the other one.\nAre we not asking for more than what's required here? We just need the location turned on, right? So can't we just get away with showing the toast corresponding to 'set_location_mode_high_accuracy'? Or if we really need to show the toast it would be nice we re-phrase the string as: \"Please turn on location. For best results, choose the High Accuracy mode.\"", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393894090", "createdAt": "2020-03-17T18:42:08Z", "author": {"login": "sivaraam"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -602,4 +602,10 @@ Upload your first media by tapping on the add button.</string>\n   <string name=\"theme_default_name\">Default</string>\n   <string name=\"theme_dark_name\">Dark</string>\n   <string name=\"theme_light_name\">Light</string>\n+\n+  <string name=\"cannot_open_location_settings\">Failed to open location settings. Please turn on location and set it to High Accuracy</string>\n+  <string name=\"set_location_mode_high_accuracy\">Please make sure that location is set to both GPS and mobile networks</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b67324df8772169b5c63301e561a83e57a375e1"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90bcdc8ecd7ce48913f04760c8a13d999a4cd1e1", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/90bcdc8ecd7ce48913f04760c8a13d999a4cd1e1", "committedDate": "2020-03-17T19:41:00Z", "message": "Update app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\nCo-Authored-By: Kaartic Sivaraam <kaartic.sivaraam+github@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7282c63b59f912af8e53c474fad1132d12062405", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/7282c63b59f912af8e53c474fad1132d12062405", "committedDate": "2020-03-17T19:55:47Z", "message": "Updated strings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTkzNjA4", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-376593608", "createdAt": "2020-03-18T06:32:51Z", "commit": {"oid": "7282c63b59f912af8e53c474fad1132d12062405"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjozMjo1MVrOF33y3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjozMjo1MVrOF33y3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMDE0MA==", "bodyText": "Looks like you've forgot to update this after updating the strings file.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n          \n          \n            \n                        Toast.makeText(getContext(), R.string.recommend_high_accuracy_mode, Toast.LENGTH_LONG).show();", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r394130140", "createdAt": "2020-03-18T06:32:51Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1268,6 +1274,28 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showLocationOffDialog() {\n+        // This creates a dialog box that prompts the user to enable location\n+        DialogUtil\n+            .showAlertDialog(getActivity(), getString(R.string.ask_to_turn_location_on), getString(R.string.nearby_needs_location),\n+                getString(R.string.yes), getString(R.string.no),  this::openLocationSettings, null);\n+    }\n+\n+    @Override\n+    public void openLocationSettings() {\n+        // This method opens the location settings of the device along with a followup toast.\n+        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n+        PackageManager packageManager = getActivity().getPackageManager();\n+\n+        if (intent.resolveActivity(packageManager)!= null) {\n+            startActivity(intent);\n+            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7282c63b59f912af8e53c474fad1132d12062405"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac643c38bfd0ffe3c928c9a5611a349bf2c49997", "author": {"user": null}, "url": "https://github.com/commons-app/apps-android-commons/commit/ac643c38bfd0ffe3c928c9a5611a349bf2c49997", "committedDate": "2020-03-18T09:29:52Z", "message": "Update app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\nCo-Authored-By: Kaartic Sivaraam <kaartic.sivaraam+github@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzI4NDA0", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#pullrequestreview-376728404", "createdAt": "2020-03-18T10:18:36Z", "commit": {"oid": "ac643c38bfd0ffe3c928c9a5611a349bf2c49997"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 380, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}