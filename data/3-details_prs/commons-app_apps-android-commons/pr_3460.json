{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMjcwOTkx", "number": 3460, "title": "Added Support for System Wide Dark Theme", "bodyText": "Description\nFixes #3377\nWhat changes did you make and why?\nI added the support for system-wide dark theme, so if you have a system-wide dark theme enabled in your phone then the app will automatically switch to dark mode. In case you prefer the light mode for app or dark mode app (irrespective of the system-wide setting) the app will retain the theme.\nTests performed\nTested betaDebug on Xiaomi Mi A2 with API level 29.\nScreenshots showing what changed", "createdAt": "2020-03-04T00:44:39Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3460", "merged": true, "mergeCommit": {"oid": "1584ffe0e2b9d646ead72f30ee2b0d95ec848efd"}, "closed": true, "closedAt": "2020-03-05T14:33:58Z", "author": {"login": "madhurgupta10"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKL7d1AH2gAyMzgzMjcwOTkxOmFlZWQ3Y2M1NzgxYzc5ZjBiNmY5ZmFkMDQ5NzM4Njk2NGYwMjJlYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKsbtkgFqTM2OTYxNTE1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aeed7cc5781c79f0b6f9fad0497386964f022ec7", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/aeed7cc5781c79f0b6f9fad0497386964f022ec7", "committedDate": "2020-03-04T00:39:14Z", "message": "Added Support for System Wide Dark Theme"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NDI5MTUz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368429153", "createdAt": "2020-03-04T00:44:43Z", "commit": {"oid": "aeed7cc5781c79f0b6f9fad0497386964f022ec7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/f1162e2e95a6043d9075c381c8e66cb8e5dc05ed", "committedDate": "2020-03-04T00:50:55Z", "message": "changed methods to private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjMxMjYz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368631263", "createdAt": "2020-03-04T09:44:44Z", "commit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo0NDo0NFrOFxmROA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo0NDo0NFrOFxmROA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MTU0NA==", "bodyText": "These methods are repeated across classes, making future updates to this functionality more difficult.\nI would extract a class NightModeChecker or something similarly named and have it be injected", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387551544", "createdAt": "2020-03-04T09:44:44Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -241,6 +242,27 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n         });\n     }\n \n+    // Return true is system wide dark theme is enabled else false\n+    private boolean getSystemDefaultThemeBool(String theme) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjMzNDgw", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368633480", "createdAt": "2020-03-04T09:47:43Z", "commit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo0Nzo0M1rOFxmYBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo0Nzo0M1rOFxmYBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MzI4Ng==", "bodyText": "If you just returned true or false here you could simplify this method down to\nreturn (getResources().getConfiguration().uiMode & Configuration.UI_MODE_NIGHT_MASK) == Configuration.UI_MODE_NIGHT_YES;", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387553286", "createdAt": "2020-03-04T09:47:43Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/auth/LoginActivity.java", "diffHunk": "@@ -133,14 +136,35 @@ public void onCreate(Bundle savedInstanceState) {\n         usernameEdit.addTextChangedListener(textWatcher);\n         passwordEdit.addTextChangedListener(textWatcher);\n         twoFactorEdit.addTextChangedListener(textWatcher);\n-        \n+\n         if (ConfigUtils.isBetaFlavour()) {\n             loginCredentials.setText(getString(R.string.login_credential));\n         } else {\n             loginCredentials.setVisibility(View.GONE);\n         }\n     }\n \n+    // Return true is system wide dark theme is enabled else false\n+    private boolean getSystemDefaultThemeBool(String theme) {\n+        switch (theme) {\n+            case \"Dark\":\n+                return true;\n+            case \"Default\":\n+                return getSystemDefaultThemeBool(getSystemDefaultTheme());\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    // Returns the default system wide theme\n+    private String getSystemDefaultTheme() {\n+        if ((getResources().getConfiguration().uiMode &", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjM3MzE5", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368637319", "createdAt": "2020-03-04T09:52:59Z", "commit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1Mjo1OVrOFxmj7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1Mjo1OVrOFxmj7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NjMzMg==", "bodyText": "There is no separation between UI and data representation. As such these strings are untranslatable", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387556332", "createdAt": "2020-03-04T09:52:59Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,6 +141,71 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    // Return true is system wide dark theme is enabled else false\n+    private boolean getSystemDefaultThemeBool(String theme) {\n+        switch (theme) {\n+            case \"Dark\":\n+                return true;\n+            case \"Default\":\n+                return getSystemDefaultThemeBool(getSystemDefaultTheme());\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    // Returns the default system wide theme\n+    private String getSystemDefaultTheme() {\n+        if ((getResources().getConfiguration().uiMode &\n+                Configuration.UI_MODE_NIGHT_MASK) == Configuration.UI_MODE_NIGHT_YES) {\n+            return \"Dark\";\n+        }\n+        return \"Light\";\n+    }\n+\n+    /**\n+     * Prepares themes list and adds them to list preference as pairs.\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     * Adds preference theme listener and saves value choosen by user to shared preferences\n+     * to remember later\n+     */\n+    private void prepareTheme() {\n+\n+        String[] themeOptionsNames = {\"Default\", \"Dark\", \"Light\"};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjY1MzYy", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368665362", "createdAt": "2020-03-04T10:32:06Z", "commit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDozMjowNlrOFxn6pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDozMjowNlrOFxn6pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU3ODUzNQ==", "bodyText": "You are using a different key than the one used preferences.xml, is this intentional?", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387578535", "createdAt": "2020-03-04T10:32:06Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/Prefs.java", "diffHunk": "@@ -9,6 +9,7 @@\n     public static final String IS_CONTRIBUTION_COUNT_CHANGED = \"ccontributionCountChanged\";\n     public static final String MANAGED_EXIF_TAGS = \"managed_exif_tags\";\n     public static final String KEY_LANGUAGE_VALUE = \"languageDescription\";\n+    public static final String KEY_THEME_VALUE = \"theme\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1162e2e95a6043d9075c381c8e66cb8e5dc05ed"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5114d2626a6328b8825fe695c2ed1f9950133d5", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/b5114d2626a6328b8825fe695c2ed1f9950133d5", "committedDate": "2020-03-04T10:48:33Z", "message": "Moved Strings to strings.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fd47e88efd7e6953d375a7a41cb5173c68fc185", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/1fd47e88efd7e6953d375a7a41cb5173c68fc185", "committedDate": "2020-03-04T13:05:48Z", "message": "Used Dagger to reduce code repetition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NzY2NjU5", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368766659", "createdAt": "2020-03-04T13:16:16Z", "commit": {"oid": "1fd47e88efd7e6953d375a7a41cb5173c68fc185"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzoxNjoxN1rOFxszXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzoxNjoxN1rOFxszXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY1ODU5MQ==", "bodyText": "You shouldn't perform field injection and constructor injection, wherever possible use constructor injection. Also this will not be injected and should crash the application with a NPE.\nMove @Named(\"default_preferences\") JsonKvStore applicationKvStore into the constructor like context", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387658591", "createdAt": "2020-03-04T13:16:17Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/utils/SystemThemeUtils.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package fr.free.nrw.commons.utils;\n+\n+import android.content.Context;\n+import android.content.res.Configuration;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import fr.free.nrw.commons.R;\n+import fr.free.nrw.commons.kvstore.JsonKvStore;\n+import fr.free.nrw.commons.settings.Prefs;\n+\n+public class SystemThemeUtils {\n+\n+    private Context context;\n+\n+    @Inject\n+    @Named(\"default_preferences\")\n+    JsonKvStore applicationKvStore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fd47e88efd7e6953d375a7a41cb5173c68fc185"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/479a51c6ca7067e80229096ed902f697e4bac20c", "committedDate": "2020-03-04T13:30:27Z", "message": "Changes made as per review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NzgyMTk1", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368782195", "createdAt": "2020-03-04T13:38:16Z", "commit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzozODoxNlrOFxth7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzozODoxNlrOFxth7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY3MDUxMA==", "bodyText": "now you can delete all of this except\nsetOnPreferenceChangeListener{\nactivity.recreate()\n}", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387670510", "createdAt": "2020-03-04T13:38:16Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,10 +145,51 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    /**\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     * Adds preference theme listener and saves value chosen by user to shared preferences\n+     * to remember later\n+     */\n+    private void prepareTheme() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Nzg0MTcz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368784173", "createdAt": "2020-03-04T13:40:56Z", "commit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzo0MDo1NlrOFxtn4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzo0MDo1NlrOFxtn4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY3MjAzMw==", "bodyText": "I am uncomfortable using a potentially translated string to represent the underlying value. If the user changes language none of these comparisons will be accurate for the stored value. I'd use numbers 0..2", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387672033", "createdAt": "2020-03-04T13:40:56Z", "author": {"login": "macgills"}, "path": "app/src/main/res/xml/preferences.xml", "diffHunk": "@@ -5,11 +5,13 @@\n     <fr.free.nrw.commons.ui.LongTitlePreferences.LongTitlePreferenceCategory\n         android:title=\"@string/preference_category_appearance\">\n \n-        <fr.free.nrw.commons.ui.LongTitlePreferences.LongTitleSwitchPreference\n-            android:title=\"@string/preference_theme\"\n-            android:defaultValue=\"false\"\n-            android:summary=\"@string/preference_theme_summary\"\n-            android:key=\"theme\" />\n+        <fr.free.nrw.commons.ui.LongTitlePreferences.LongTitleListPreference\n+            android:key=\"themePref\"\n+            android:title= \"@string/preference_theme\"\n+            android:defaultValue=\"@string/theme_default_name\"\n+            android:entries=\"@array/pref_theme_entries\"\n+            android:entryValues=\"@array/pref_theme_entries\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Nzg0NzIz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-368784723", "createdAt": "2020-03-04T13:41:42Z", "commit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzo0MTo0MlrOFxtpjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzo0MTo0MlrOFxtpjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY3MjQ2Mg==", "bodyText": "context has a method getString(), you don't need resources to get a String", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r387672462", "createdAt": "2020-03-04T13:41:42Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/utils/SystemThemeUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package fr.free.nrw.commons.utils;\n+\n+import android.content.Context;\n+import android.content.res.Configuration;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import fr.free.nrw.commons.R;\n+import fr.free.nrw.commons.kvstore.JsonKvStore;\n+import fr.free.nrw.commons.settings.Prefs;\n+\n+public class SystemThemeUtils {\n+\n+    private Context context;\n+    private JsonKvStore applicationKvStore;\n+\n+    @Inject\n+    public SystemThemeUtils(Context context, @Named(\"default_preferences\") JsonKvStore applicationKvStore) {\n+        this.context = context;\n+        this.applicationKvStore = applicationKvStore;\n+    }\n+\n+    // Return true is system wide dark theme is enabled else false\n+    public boolean getSystemDefaultThemeBool(String theme) {\n+        if (context.getResources().getString(R.string.theme_dark_name).equals(theme)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "479a51c6ca7067e80229096ed902f697e4bac20c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/568448af968e547c4891b0b015d4b5fae96a91d4", "committedDate": "2020-03-04T22:02:06Z", "message": "Minor Changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzk0NDQ0", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369394444", "createdAt": "2020-03-05T09:04:56Z", "commit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowNDo1NlrOFyLRvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowNDo1NlrOFyLRvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE1Nzg4Nw==", "bodyText": "You actually don't want to specify these as string resources, now they will get translated and that will lead us to back to an original problem", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388157887", "createdAt": "2020-03-05T09:04:56Z", "author": {"login": "macgills"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -599,4 +598,10 @@ Upload your first media by tapping on the add button.</string>\n   <string name=\"wallpaper_set_unsuccessfully\">Something went wrong. Could not set the wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_title\">Set as Wallpaper</string>\n   <string name=\"setting_wallpaper_dialog_message\">Setting Wallpaper. Please wait\u2026</string>\n+  <string name=\"theme_default_name\">Default</string>\n+  <string name=\"theme_dark_name\">Dark</string>\n+  <string name=\"theme_light_name\">Light</string>\n+  <string name=\"theme_default_value\">0</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzk3NDkz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369397493", "createdAt": "2020-03-05T09:09:35Z", "commit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowOTozNVrOFyLa4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowOTozNVrOFyLa4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2MDIyNQ==", "bodyText": "this is never true", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388160225", "createdAt": "2020-03-05T09:09:35Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,10 +141,42 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    /**\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     * Adds preference theme listener and saves value chosen by user to shared preferences\n+     * to remember later\n+     */\n+    private void prepareTheme() {\n+\n+        String currentTheme = getCurrentTheme();\n+        if (currentTheme.equals(\"\")){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzk3OTIw", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369397920", "createdAt": "2020-03-05T09:10:13Z", "commit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMDoxM1rOFyLcEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMDoxM1rOFyLcEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2MDUzMQ==", "bodyText": "You can just use simpleSummary, see the docs", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388160531", "createdAt": "2020-03-05T09:10:13Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,10 +141,42 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    /**\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     * Adds preference theme listener and saves value chosen by user to shared preferences\n+     * to remember later\n+     */\n+    private void prepareTheme() {\n+\n+        String currentTheme = getCurrentTheme();\n+        if (currentTheme.equals(\"\")){\n+            // If current theme code is empty, means none selected by user yet so use default\n+            themeListPreference.setSummary(getString(R.string.theme_default_name));\n+            themeListPreference.setValue(getString(R.string.theme_default_value));\n+        } else {\n+            // If any theme is selected by user previously, use it\n+            int prefIndex = themeListPreference.findIndexOfValue(currentTheme);\n+            themeListPreference.setSummary(themeListPreference.getEntries()[prefIndex]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDAwMDY3", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369400067", "createdAt": "2020-03-05T09:13:25Z", "commit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMzoyNVrOFyLikw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxMzoyNVrOFyLikw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2MjE5NQ==", "bodyText": "AS should suggest turning this into a ternary", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388162195", "createdAt": "2020-03-05T09:13:25Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/utils/SystemThemeUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package fr.free.nrw.commons.utils;\n+\n+import android.content.Context;\n+import android.content.res.Configuration;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import fr.free.nrw.commons.R;\n+import fr.free.nrw.commons.kvstore.JsonKvStore;\n+import fr.free.nrw.commons.settings.Prefs;\n+\n+public class SystemThemeUtils {\n+\n+    private Context context;\n+    private JsonKvStore applicationKvStore;\n+\n+    @Inject\n+    public SystemThemeUtils(Context context, @Named(\"default_preferences\") JsonKvStore applicationKvStore) {\n+        this.context = context;\n+        this.applicationKvStore = applicationKvStore;\n+    }\n+\n+    // Return true is system wide dark theme is enabled else false\n+    public boolean getSystemDefaultThemeBool(String theme) {\n+        if (theme.equals(context.getString(R.string.theme_dark_value))) {\n+            return true;\n+        } else if (theme.equals(context.getString(R.string.theme_default_value))) {\n+            return getSystemDefaultThemeBool(getSystemDefaultTheme());\n+        }\n+        return false;\n+    }\n+\n+    // Returns the default system wide theme\n+    public String getSystemDefaultTheme() {\n+        if ((context.getResources().getConfiguration().uiMode &", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568448af968e547c4891b0b015d4b5fae96a91d4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0371eeef98ed2601edcbb82b613b3738734bf16", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/e0371eeef98ed2601edcbb82b613b3738734bf16", "committedDate": "2020-03-05T12:42:16Z", "message": "Fixes as per suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTQ5MTk5", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369549199", "createdAt": "2020-03-05T13:03:40Z", "commit": {"oid": "e0371eeef98ed2601edcbb82b613b3738734bf16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzowMzo0MFrOFySrZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzowMzo0MFrOFySrZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3OTE0MA==", "bodyText": "the recreate of the activity should mean that the summary gets set by the code above us anyhow, or at least that is how the code is running in my head. try it with deleting setSummary", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388279140", "createdAt": "2020-03-05T13:03:40Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,10 +141,39 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    /**\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     * Adds preference theme listener and saves value chosen by user to shared preferences\n+     * to remember later\n+     */\n+    private void prepareTheme() {\n+\n+        String currentTheme = getCurrentTheme();\n+\n+        themeListPreference.setSummary(getThemeSummary(currentTheme));\n+        themeListPreference.setValue(currentTheme);\n+\n+        themeListPreference.setOnPreferenceChangeListener((preference, newValue) -> {\n+            String userSelectedValue = (String) newValue;\n+            themeListPreference.setSummary(getThemeSummary(userSelectedValue));\n+            getActivity().recreate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0371eeef98ed2601edcbb82b613b3738734bf16"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTU4MTg4", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369558188", "createdAt": "2020-03-05T13:17:22Z", "commit": {"oid": "e0371eeef98ed2601edcbb82b613b3738734bf16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzoxNzoyMlrOFyTFsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzoxNzoyMlrOFyTFsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI4NTg3Mw==", "bodyText": "These are magic strings and it would be good if we could not be using them like this.\nThere are 2 options:\n\nextract constants for 1,2,3 THEME_MODE_DEFAULT etc\ncreate a enum to represent these values, wrapping the retrieval from the keystore\n\nI much prefer 2 because it is a superiorily typed expression. 2 is easier. Your choice", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388285873", "createdAt": "2020-03-05T13:17:22Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/utils/SystemThemeUtils.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package fr.free.nrw.commons.utils;\n+\n+import android.content.Context;\n+import android.content.res.Configuration;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import fr.free.nrw.commons.kvstore.JsonKvStore;\n+import fr.free.nrw.commons.settings.Prefs;\n+\n+public class SystemThemeUtils {\n+\n+    private Context context;\n+    private JsonKvStore applicationKvStore;\n+\n+    @Inject\n+    public SystemThemeUtils(Context context, @Named(\"default_preferences\") JsonKvStore applicationKvStore) {\n+        this.context = context;\n+        this.applicationKvStore = applicationKvStore;\n+    }\n+\n+    // Return true is system wide dark theme is enabled else false\n+    public boolean getSystemDefaultThemeBool(String theme) {\n+        if (theme.equals(\"1\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0371eeef98ed2601edcbb82b613b3738734bf16"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "492a336c9abc1bcd256d90452667f4fd54953899", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/492a336c9abc1bcd256d90452667f4fd54953899", "committedDate": "2020-03-05T13:40:32Z", "message": "Minor Fixes as per suggestion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTc2NTMx", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369576531", "createdAt": "2020-03-05T13:43:23Z", "commit": {"oid": "492a336c9abc1bcd256d90452667f4fd54953899"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo0MzoyM1rOFyT8jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo0MzoyM1rOFyT8jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI5OTkxNg==", "bodyText": "make these static and access them statically", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388299916", "createdAt": "2020-03-05T13:43:23Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/utils/SystemThemeUtils.java", "diffHunk": "@@ -14,6 +14,10 @@\n     private Context context;\n     private JsonKvStore applicationKvStore;\n \n+    public final String THEME_MODE_DEFAULT = \"0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "492a336c9abc1bcd256d90452667f4fd54953899"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a99f7724c39d0d050da8959103ae659e2580810", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/8a99f7724c39d0d050da8959103ae659e2580810", "committedDate": "2020-03-05T13:49:26Z", "message": "made the variables static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTg0Nzc3", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369584777", "createdAt": "2020-03-05T13:54:18Z", "commit": {"oid": "8a99f7724c39d0d050da8959103ae659e2580810"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1NDoxOFrOFyUVoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1NDoxOFrOFyUVoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwNjMzNg==", "bodyText": "You can get rid of setValue, this should be the last comment!", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#discussion_r388306336", "createdAt": "2020-03-05T13:54:18Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/settings/SettingsFragment.java", "diffHunk": "@@ -144,10 +143,35 @@ public void afterTextChanged(Editable s) {\n         }\n     }\n \n+    /**\n+     * Uses previously saved theme if there is any, if not then uses default.\n+     */\n+    private void prepareTheme() {\n+\n+        String currentTheme = getCurrentTheme();\n+\n+        themeListPreference.setSummary(getThemeSummary(currentTheme));\n+        themeListPreference.setValue(currentTheme);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a99f7724c39d0d050da8959103ae659e2580810"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7e820ee437bf767ddca385b978394aa88d58b89", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/e7e820ee437bf767ddca385b978394aa88d58b89", "committedDate": "2020-03-05T14:17:40Z", "message": "removed irrelevant code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjE1MTUz", "url": "https://github.com/commons-app/apps-android-commons/pull/3460#pullrequestreview-369615153", "createdAt": "2020-03-05T14:31:25Z", "commit": {"oid": "e7e820ee437bf767ddca385b978394aa88d58b89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 389, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}