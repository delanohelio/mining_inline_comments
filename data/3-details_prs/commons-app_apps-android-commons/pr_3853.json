{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzA0OTc1", "number": 3853, "title": "Hidden categories are not showed in suggested categories", "bodyText": "Description\nCategories marked as not allowed for the user are now hidden\nFixes #3640\nWhat changes did you make and why?\nI added the functionality to hidde categories marked, because before these categories were shown to the user and and supposed to be prohibited\nTested ProdDebug on Nexus 5x and Nexus 4 with API level 30.", "createdAt": "2020-06-29T23:49:09Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3853", "merged": true, "mergeCommit": {"oid": "67beb947c54fc91a00f0d7fb6a5adeaa350d3bc3"}, "closed": true, "closedAt": "2020-07-19T15:29:30Z", "author": {"login": "PaulinaQuintero"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwI2cIgH2gAyNDQxNzA0OTc1OjJhOTMyODVmODc5MzZjYTNlNmYxOWVmYTdmMzE0ZTNiMjgzZDg1Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2eAemAH2gAyNDQxNzA0OTc1OjE0YTNiZTMxMTJmNTZiYjI0Y2FiMTJhNDFhODFiMmM4ZDNmOGMwZDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2a93285f87936ca3e6f19efa7f314e3b283d85cb", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/2a93285f87936ca3e6f19efa7f314e3b283d85cb", "committedDate": "2020-06-29T22:33:09Z", "message": "fixed the problem of the hidden categories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2462c9fc35f794d8e881b68c5a9fa0f088870370", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/2462c9fc35f794d8e881b68c5a9fa0f088870370", "committedDate": "2020-06-29T23:39:30Z", "message": "fixed the problem of the hidden categories"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTc2MDA0", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#pullrequestreview-439576004", "createdAt": "2020-06-29T23:49:13Z", "commit": {"oid": "2462c9fc35f794d8e881b68c5a9fa0f088870370"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c98bab95058b06bc8f37829c73cb5597a6a14029", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/c98bab95058b06bc8f37829c73cb5597a6a14029", "committedDate": "2020-06-30T00:00:15Z", "message": "Merge branch 'master' into add-pquinterom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "004369c9219aa3df86e53cc5adfc056047c9722b", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/004369c9219aa3df86e53cc5adfc056047c9722b", "committedDate": "2020-06-30T01:08:24Z", "message": "corrections made in other parts of the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/b316aaf0cd1eb2af2310de0925e73585d327ebcd", "committedDate": "2020-06-30T01:11:31Z", "message": "Merge branch 'add-pquinterom' of https://github.com/PaulinaQuintero/apps-android-commons into add-pquinterom"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTU2OTg2", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#pullrequestreview-441956986", "createdAt": "2020-07-02T19:11:28Z", "commit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOToxMToyOFrOGsaFDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOToxMzozOVrOGsaJAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxNzgwNA==", "bodyText": "For the API to actually return the categoryinfo in the requests made by the app you should do this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        + \"&generator=allcategories\")\n          \n          \n            \n                        + \"&generator=allcategories&prop=categoryinfo\")", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449217804", "createdAt": "2020-07-02T19:11:28Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryInterface.java", "diffHunk": "@@ -33,9 +33,11 @@\n      */\n     @GET(\"w/api.php?action=query&format=json&formatversion=2\"\n             + \"&generator=allcategories\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxODAxNw==", "bodyText": "Revert these whitespace changes.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449218017", "createdAt": "2020-07-02T19:11:56Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryInterface.java", "diffHunk": "@@ -33,9 +33,11 @@\n      */\n     @GET(\"w/api.php?action=query&format=json&formatversion=2\"\n             + \"&generator=allcategories\")\n+\n     Single<MwQueryResponse> searchCategoriesForPrefix(@Query(\"gacprefix\") String prefix,\n                                                           @Query(\"gaclimit\") int itemLimit, @Query(\"gacoffset\") int offset);\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxODI0Nw==", "bodyText": "Revert this whitespace change too.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449218247", "createdAt": "2020-07-02T19:12:21Z", "author": {"login": "sivaraam"}, "path": "data-client/src/main/java/org/wikipedia/dataclient/mwapi/MwQueryPage.java", "diffHunk": "@@ -194,6 +210,9 @@ String source() {\n         }\n     }\n \n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxODU0Nw==", "bodyText": "Revert this removal of the newline too.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449218547", "createdAt": "2020-07-02T19:13:01Z", "author": {"login": "sivaraam"}, "path": "data-client/src/main/java/org/wikipedia/dataclient/mwapi/MwQueryPage.java", "diffHunk": "@@ -234,4 +253,4 @@ public boolean hidden() {\n         @SuppressWarnings(\"unused\") private List<String> alias;\n         @SuppressWarnings(\"unused\") private List<String> label;\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxODcxNA==", "bodyText": "Revert this removal of the newline.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449218714", "createdAt": "2020-07-02T19:13:24Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryClient.kt", "diffHunk": "@@ -92,8 +92,9 @@ class CategoryClient @Inject constructor(private val categoryInterface: Category\n                 it.query()?.pages() ?: emptyList()\n             }\n             .map {\n-                it.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }\n+                it.filter { page -> !page.categoryInfo().isHidden\n+                }.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }\n             }\n     }\n \n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxODgxOQ==", "bodyText": "Revert changes to this file.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449218819", "createdAt": "2020-07-02T19:13:39Z", "author": {"login": "sivaraam"}, "path": "data-client/src/main/java/org/wikipedia/search/SearchResults.java", "diffHunk": "@@ -60,5 +60,4 @@ public SearchResults(@NonNull List<MwQueryPage> pages, @NonNull WikiSite wiki,\n     @Nullable public Map<String, String> getContinuation() {\n         return continuation;\n     }\n-}\n-\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b316aaf0cd1eb2af2310de0925e73585d327ebcd"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "782cffd190a1932ac3f2f595d7900fc6264bc1dd", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/782cffd190a1932ac3f2f595d7900fc6264bc1dd", "committedDate": "2020-07-03T23:28:45Z", "message": "corrections made"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/83aad510dde4105cf3be293da75886f7e1accce5", "committedDate": "2020-07-03T23:37:35Z", "message": "all corrections made"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjI4ODg0", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#pullrequestreview-442628884", "createdAt": "2020-07-04T20:04:22Z", "commit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMDowNDoyM1rOGs9tfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMDowODo0M1rOGs9uvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTU5Nw==", "bodyText": "I think we need to be careful here as the categoryInfo object wouldn't be present in all the responses that are handled by responseMapper. So, we should do this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            it.filter { page -> !page.categoryInfo().isHidden\n          \n          \n            \n                            }.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }\n          \n          \n            \n                            it.filter {\n          \n          \n            \n                                page -> page.categoryInfo() == null || !page.categoryInfo().isHidden\n          \n          \n            \n                            }.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }\n          \n      \n    \n    \n  \n\nNot handling this is likely a reason for the tests failing in Travis CI.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449801597", "createdAt": "2020-07-04T20:04:23Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryClient.kt", "diffHunk": "@@ -92,8 +92,8 @@ class CategoryClient @Inject constructor(private val categoryInterface: Category\n                 it.query()?.pages() ?: emptyList()\n             }\n             .map {\n-                it.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }\n+                it.filter { page -> !page.categoryInfo().isHidden\n+                }.map { page -> page.title().replace(CATEGORY_PREFIX, \"\") }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTY1Nw==", "bodyText": "Remove this additional new line.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449801657", "createdAt": "2020-07-04T20:05:07Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryInterface.java", "diffHunk": "@@ -32,10 +32,11 @@\n      * @return\n      */\n     @GET(\"w/api.php?action=query&format=json&formatversion=2\"\n-            + \"&generator=allcategories\")\n+            + \"&generator=allcategories&prop=categoryinfo\")\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTY5MA==", "bodyText": "Remove this needless whitespace.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449801690", "createdAt": "2020-07-04T20:05:26Z", "author": {"login": "sivaraam"}, "path": "app/src/main/java/fr/free/nrw/commons/category/CategoryInterface.java", "diffHunk": "@@ -32,10 +32,11 @@\n      * @return\n      */\n     @GET(\"w/api.php?action=query&format=json&formatversion=2\"\n-            + \"&generator=allcategories\")\n+            + \"&generator=allcategories&prop=categoryinfo\")\n+\n     Single<MwQueryResponse> searchCategoriesForPrefix(@Query(\"gacprefix\") String prefix,\n                                                           @Query(\"gaclimit\") int itemLimit, @Query(\"gacoffset\") int offset);\n-\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTkxNw==", "bodyText": "I don't see any need for this file to be changed. So, revert the changes to this file. You could use the following commands to revert the changes in this file:\ngit fetch origin\ngit checkout origin/master -- data-client/src/main/java/org/wikipedia/search/SearchResults.java\nAssuming origin points to this repo.", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#discussion_r449801917", "createdAt": "2020-07-04T20:08:43Z", "author": {"login": "sivaraam"}, "path": "data-client/src/main/java/org/wikipedia/search/SearchResults.java", "diffHunk": "@@ -35,7 +35,7 @@ public SearchResults() {\n      * @param suggestion a search suggestion to show to the user: \"Did you mean ...?\"\n      */\n     public SearchResults(@NonNull List<MwQueryPage> pages, @NonNull WikiSite wiki,\n-                         @Nullable Map<String, String> continuation, @Nullable String suggestion) {\n+        @Nullable Map<String, String> continuation, @Nullable String suggestion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83aad510dde4105cf3be293da75886f7e1accce5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37546c4af45e2184dcbaa80c574af6d0e3a6e0f", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/c37546c4af45e2184dcbaa80c574af6d0e3a6e0f", "committedDate": "2020-07-04T21:09:47Z", "message": "new corrections done, removed whitespaces and corrections in responsemapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "646a2871201600001fc2e96e01e7fb7542aa6c6f", "author": {"user": {"login": "PaulinaQuintero", "name": "Paulina"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/646a2871201600001fc2e96e01e7fb7542aa6c6f", "committedDate": "2020-07-04T21:11:53Z", "message": "new corrections done, removed whitespaces and corrections in responsemapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50e4b0c85be5872dce12aac5e31948fc81a9aa12", "author": {"user": {"login": "sivaraam", "name": "Kaartic Sivaraam"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/50e4b0c85be5872dce12aac5e31948fc81a9aa12", "committedDate": "2020-07-19T14:06:15Z", "message": "Revert some whitespace changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTM2MDkx", "url": "https://github.com/commons-app/apps-android-commons/pull/3853#pullrequestreview-451136091", "createdAt": "2020-07-19T14:20:54Z", "commit": {"oid": "50e4b0c85be5872dce12aac5e31948fc81a9aa12"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14a3be3112f56bb24cab12a41a81b2c8d3f8c0d0", "author": {"user": {"login": "sivaraam", "name": "Kaartic Sivaraam"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/14a3be3112f56bb24cab12a41a81b2c8d3f8c0d0", "committedDate": "2020-07-19T14:35:40Z", "message": "Merge remote-tracking branch 'origin/master' into hide-hidden-categories"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 634, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}