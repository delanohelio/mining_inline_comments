{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNjE1OTgx", "number": 3649, "title": "Fixed logout problem #3547", "bodyText": "When User clicks logout it should go to the Logout screen.\nFixes #3547\nWhat changes did you make and why?\nAdded updateDatabaseAll method in another Thread.", "createdAt": "2020-04-13T12:07:54Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3649", "merged": true, "mergeCommit": {"oid": "5308c29240e4e7b43485d4564053357d69f1e203"}, "closed": true, "closedAt": "2020-04-14T10:34:08Z", "author": {"login": "gouri-panda"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXNwYUgFqTM5MjEwNjk3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXg8WKgFqTM5MjgwMDQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTA2OTcy", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392106972", "createdAt": "2020-04-13T12:07:57Z", "commit": {"oid": "c36206d74ee25222dc752ce5fc30b7cf660bb19b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTIzODgy", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392123882", "createdAt": "2020-04-13T12:49:58Z", "commit": {"oid": "c36206d74ee25222dc752ce5fc30b7cf660bb19b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjo0OTo1OFrOGElh4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMjo0OTo1OFrOGElh4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ2MjM2OQ==", "bodyText": "We should not do this, a) threads are expensive and b) Rx gives us the ability to switch threads easily\nYou can use andThen to execute another completable and keep the logoutListener on the main thread.\nIf you have any questions about Rx then please ask me", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r407462369", "createdAt": "2020-04-13T12:49:58Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -275,7 +275,7 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n                     //TODO: fix preference manager\n                     defaultPrefs.clearAll();\n                     defaultPrefs.putBoolean(\"firstrun\", false);\n-                    updateAllDatabases();\n+                    new Thread(this::updateAllDatabases).start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c36206d74ee25222dc752ce5fc30b7cf660bb19b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjkyOTg2", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392692986", "createdAt": "2020-04-14T08:05:08Z", "commit": {"oid": "209e590b417cf3ccc0830bf6d63b1bcf6390950e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwODowNTowOFrOGFC4Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwODowNTowOFrOGFC4Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk0MzE5MA==", "bodyText": "I would move everything but logoutListener to the new callable to preserve the original ordering, juuuust in case that actually matters", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r407943190", "createdAt": "2020-04-14T08:05:08Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -275,7 +280,6 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n                     //TODO: fix preference manager\n                     defaultPrefs.clearAll();\n                     defaultPrefs.putBoolean(\"firstrun\", false);\n-                    updateAllDatabases();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "209e590b417cf3ccc0830bf6d63b1bcf6390950e"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjk1Mjc2", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392695276", "createdAt": "2020-04-14T08:08:23Z", "commit": {"oid": "209e590b417cf3ccc0830bf6d63b1bcf6390950e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwODowODoyM1rOGFC_Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwODowODoyM1rOGFC_Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk0NTAyNw==", "bodyText": "It is annoying we have to return null here, in kotlin the void return types analogue is Unit. You don't have to do any changes here I am pretty sure but be careful about null and Rx, it causes a crash in Single/Flowable/Observable since RxJava 2.0 with the introduction of Maybe to handle potentially null things", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r407945027", "createdAt": "2020-04-14T08:08:23Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -267,6 +268,10 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n         }\n \n         sessionManager.logout()\n+            .andThen(Completable.fromCallable(() -> {\n+                updateAllDatabases();\n+                return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "209e590b417cf3ccc0830bf6d63b1bcf6390950e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4721e663981e9e4b4d3a3894c59a73eeb04b0817", "author": {"user": {"login": "gouri-panda", "name": null}}, "url": "https://github.com/commons-app/apps-android-commons/commit/4721e663981e9e4b4d3a3894c59a73eeb04b0817", "committedDate": "2020-04-14T09:56:28Z", "message": "fixed logout problem\n\nfixed logout problem\n\nfixed logout problem\n\nfixed logout problem\n\nfixed logout problem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzg1NjYx", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392785661", "createdAt": "2020-04-14T10:07:45Z", "commit": {"oid": "4721e663981e9e4b4d3a3894c59a73eeb04b0817"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowNzo0NlrOGFHk9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowNzo0NlrOGFHk9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAyMDIxMg==", "bodyText": "instead of doOnError you can use the 2 param version of subscribe", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r408020212", "createdAt": "2020-04-14T10:07:46Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -267,15 +268,19 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n         }\n \n         sessionManager.logout()\n+            .andThen(Completable.fromAction(() ->{\n+                Timber.d(\"All accounts have been removed\");\n+                clearImageCache();\n+                //TODO: fix preference manager\n+                defaultPrefs.clearAll();\n+                defaultPrefs.putBoolean(\"firstrun\", false);\n+                updateAllDatabases();\n+\n+                }\n+            )).doOnError(Timber::e)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4721e663981e9e4b4d3a3894c59a73eeb04b0817"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzg2MDI2", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392786026", "createdAt": "2020-04-14T10:08:15Z", "commit": {"oid": "4721e663981e9e4b4d3a3894c59a73eeb04b0817"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowODoxNVrOGFHmNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowODoxNVrOGFHmNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAyMDUzNA==", "bodyText": "don't need this space", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r408020534", "createdAt": "2020-04-14T10:08:15Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -267,15 +268,19 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n         }\n \n         sessionManager.logout()\n+            .andThen(Completable.fromAction(() ->{\n+                Timber.d(\"All accounts have been removed\");\n+                clearImageCache();\n+                //TODO: fix preference manager\n+                defaultPrefs.clearAll();\n+                defaultPrefs.putBoolean(\"firstrun\", false);\n+                updateAllDatabases();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4721e663981e9e4b4d3a3894c59a73eeb04b0817"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a5cde9af858e1b675e67ac18bfdeeec07df39e", "author": {"user": {"login": "gouri-panda", "name": null}}, "url": "https://github.com/commons-app/apps-android-commons/commit/57a5cde9af858e1b675e67ac18bfdeeec07df39e", "committedDate": "2020-04-14T10:12:19Z", "message": "added error handling on logout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzk5OTkz", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392799993", "createdAt": "2020-04-14T10:28:33Z", "commit": {"oid": "57a5cde9af858e1b675e67ac18bfdeeec07df39e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDoyODozNFrOGFIUcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDoyODozNFrOGFIUcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAzMjM3MA==", "bodyText": "ahhh pretty pretty method references", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#discussion_r408032370", "createdAt": "2020-04-14T10:28:34Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/CommonsApplication.java", "diffHunk": "@@ -275,14 +275,11 @@ public void clearApplicationData(Context context, LogoutListener logoutListener)\n                 defaultPrefs.clearAll();\n                 defaultPrefs.putBoolean(\"firstrun\", false);\n                 updateAllDatabases();\n-\n                 }\n-            )).doOnError(Timber::e)\n-                .subscribeOn(Schedulers.io())\n-                .observeOn(AndroidSchedulers.mainThread())\n-                .subscribe(() -> {\n-                    logoutListener.onLogoutComplete();\n-                });\n+            ))\n+            .subscribeOn(Schedulers.io())\n+            .observeOn(AndroidSchedulers.mainThread())\n+            .subscribe(logoutListener::onLogoutComplete, Timber::e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a5cde9af858e1b675e67ac18bfdeeec07df39e"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyODAwNDE0", "url": "https://github.com/commons-app/apps-android-commons/pull/3649#pullrequestreview-392800414", "createdAt": "2020-04-14T10:29:13Z", "commit": {"oid": "57a5cde9af858e1b675e67ac18bfdeeec07df39e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 575, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}