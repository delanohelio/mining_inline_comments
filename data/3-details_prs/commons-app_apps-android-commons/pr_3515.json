{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MjY3MDAx", "number": 3515, "title": "Fixes #3359 Duplicate Photos in Contributions Page", "bodyText": "Description (required)\nFixes #3359 Duplicate Photos in Contributions Page\nWhat changes did you make and why?\n\nCache thumb url & imageUrl in local db\nUse Fresco's ImageRequest to show images in ContributionViewHolder[this was the issue, we should have always used this to show the image]\nDeleted DisplayableContribution (not needed anymore)\nExposed abstract function in ContributionDao to update contribution\n\nTests performed (required)\nThis is subject to more tests (someone who has a significant number of contributions can help test this). I have only ~20 contributions, seems to be a fix for me.\nTested prodDebug on API 27", "createdAt": "2020-03-14T11:26:31Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3515", "merged": true, "mergeCommit": {"oid": "efdb00b5ee31d858e2aea117901535e623dea73b"}, "closed": true, "closedAt": "2020-03-18T10:47:52Z", "author": {"login": "ashishkumar468"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNjFWSgH2gAyMzg4MjY3MDAxOjIwYWYxNmY3NThkMmEwYzYyOTUyNGE4ZTBhMmExZjk0N2MwODA2MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO1BnGgFqTM3Njc0ODk5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/20af16f758d2a0c629524a8e0a2a1f947c08061d", "committedDate": "2020-03-14T11:19:37Z", "message": "Fixes #3359\n* Cache thumb url & imageUrl in local db\n* Use Fresco's ImageRequest to show images in ContributionViewHolder[this was the issue, we should have always used this to show the image]\n* Deleted DisplayableContribution (not needed anymore)\n* Exposed abstract function in ContributionDao to updateContribution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzE1NzI1", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-374715725", "createdAt": "2020-03-14T11:26:34Z", "commit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDU4MzQy", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-375058342", "createdAt": "2020-03-16T10:00:28Z", "commit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowMDoyOFrOF2svGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowMDoyOFrOF2svGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMDM3Ng==", "bodyText": "why was this added?", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392900376", "createdAt": "2020-03-16T10:00:28Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java", "diffHunk": "@@ -77,6 +79,8 @@\n     @Inject OkHttpJsonApiClient okHttpJsonApiClient;\n     @Inject CampaignsPresenter presenter;\n     @Inject LocationServiceManager locationManager;\n+    @Inject", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDU5MTI4", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-375059128", "createdAt": "2020-03-16T10:01:40Z", "commit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowMTo0MFrOF2sxrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowMTo0MFrOF2sxrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwMTAzNg==", "bodyText": "This is now default visibility?", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r392901036", "createdAt": "2020-03-16T10:01:40Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n-    private int position;\n+    int position;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20af16f758d2a0c629524a8e0a2a1f947c08061d"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/ad5980c6586b025f2b4378ef01cde5b44dd62755", "committedDate": "2020-03-16T10:04:28Z", "message": "* Make position private in ContributionViewHolder\n* Remove MediaDataExtractor from ContributionsFragment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTY3MTMx", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-375967131", "createdAt": "2020-03-17T11:57:41Z", "commit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTcxMDgx", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-375971081", "createdAt": "2020-03-17T12:03:49Z", "commit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjowMzo0OVrOF3ZPZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjowMzo0OVrOF3ZPZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyOTU0MA==", "bodyText": "this should probably be else", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393629540", "createdAt": "2020-03-17T12:03:49Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;\n         this.position=position;\n-        this.contribution = contribution;\n-        fetchAndDisplayThumbnail(contribution);\n+        String imageSource = contribution.thumbUrl;\n+        if (TextUtils.isEmpty(imageSource)) {\n+            imageSource =\n+                contribution.getLocalUri() != null ? contribution.getLocalUri().toString()\n+                    : null;\n+        }\n+        if (!TextUtils.isEmpty(imageSource)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTc3NTc5", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-375977579", "createdAt": "2020-03-17T12:14:05Z", "commit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoxNDowNVrOF3ZjwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoxNDowNVrOF3ZjwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNDc1Mg==", "bodyText": ".setProgressiveRenderingEnabled(true).setProgressiveRenderingEnabled(true) so nice you said it twice", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393634752", "createdAt": "2020-03-17T12:14:05Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +33,33 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;\n         this.position=position;\n-        this.contribution = contribution;\n-        fetchAndDisplayThumbnail(contribution);\n+        String imageSource = contribution.thumbUrl;\n+        if (TextUtils.isEmpty(imageSource)) {\n+            imageSource =\n+                contribution.getLocalUri() != null ? contribution.getLocalUri().toString()\n+                    : null;\n+        }\n+        if (!TextUtils.isEmpty(imageSource)) {\n+            final ImageRequest imageRequest =\n+                ImageRequestBuilder.newBuilderWithSource(Uri.parse(imageSource)).setProgressiveRenderingEnabled(true).setProgressiveRenderingEnabled(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5980c6586b025f2b4378ef01cde5b44dd62755"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/c7e042c19cb7c27745a38e9583f9466863da325a", "committedDate": "2020-03-17T13:47:25Z", "message": "* Show placeholder image for Contributions while the image loads\n* setHasStableId's ContributionsAdapter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDUzNzk0", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376053794", "createdAt": "2020-03-17T13:53:02Z", "commit": {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzo1MzowMlrOF3dNxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzo1MzowMlrOF3dNxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NDY2MA==", "bodyText": "default visibility", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393694660", "createdAt": "2020-03-17T13:53:02Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -35,25 +39,35 @@\n \n     private int position;\n     private Contribution contribution;\n+    Random random =new Random();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0da2def128d77924e613349b0ff391598a6904a1", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/0da2def128d77924e613349b0ff391598a6904a1", "committedDate": "2020-03-17T13:54:04Z", "message": "make Random variable private in ContributionViewHolder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDU2Mjc3", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376056277", "createdAt": "2020-03-17T13:55:41Z", "commit": {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzo1NTo0MVrOF3dVKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzo1NTo0MVrOF3dVKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY5NjU1Mg==", "bodyText": "don't do this, return the value when it is correct, you don't need a variable this can all collapse into a ternary if you so choose", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393696552", "createdAt": "2020-03-17T13:55:41Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -96,6 +110,25 @@ public void init(int position, Contribution contribution) {\n         }\n     }\n \n+    /**\n+     * Returns the image source for the image view, first preference is given to thumbUrl if that is\n+     * null, moves to local uri and if both are null return null\n+     *\n+     * @param thumbUrl\n+     * @param localUri\n+     * @return\n+     */\n+    @Nullable\n+    private String chooseImageSource(String thumbUrl, Uri localUri) {\n+        String imageSource = thumbUrl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e042c19cb7c27745a38e9583f9466863da325a"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/1f306c4c77c0fc2183d46e7954a57c22112867e9", "committedDate": "2020-03-17T13:58:18Z", "message": "replace local variable-if-with ternary operator in ContributionViewHolder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDYxNDM2", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376061436", "createdAt": "2020-03-17T14:01:18Z", "commit": {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDowMToxOFrOF3dkOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDowMToxOFrOF3dkOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMDQwOA==", "bodyText": "I am a huge nitpicker, I apologise.\nFor these scenarios I generally put each value that is returned on its own line\ncondition ? value :\n  condition ? value :\n    value\n\nfeel free to ignore", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393700408", "createdAt": "2020-03-17T14:01:18Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -120,13 +120,8 @@ public void init(int position, Contribution contribution) {\n      */\n     @Nullable\n     private String chooseImageSource(String thumbUrl, Uri localUri) {\n-        String imageSource = thumbUrl;\n-        if (TextUtils.isEmpty(imageSource)) {\n-            imageSource =\n-                localUri != null ? localUri.toString()\n-                    : null;\n-        }\n-        return imageSource;\n+        return !TextUtils.isEmpty(thumbUrl) ? thumbUrl : (localUri != null ? localUri.toString()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b40c559580b42dcec63eab8f27c4a3210ef61f4d", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/b40c559580b42dcec63eab8f27c4a3210ef61f4d", "committedDate": "2020-03-17T14:03:31Z", "message": "Fix indentation/formatting of ternary operator in ContributionViewHolder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDY0NTEy", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376064512", "createdAt": "2020-03-17T14:04:37Z", "commit": {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDowNDozN1rOF3dtkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDowNDozN1rOF3dtkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwMjgwMw==", "bodyText": "Do we need a cache? was there performance issues in your testing?\nI don't think ColorDrawables are that expensive but android can always surprise ya.", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393702803", "createdAt": "2020-03-17T14:04:37Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,43 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random =new Random();\n+    private HashMap<Integer,ColorDrawable> drawablesCache=new HashMap();\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n+        populateDrawableCache();\n+    }\n+    \n+    /**\n+     * Cache's the drawables to be shown as image placeholders\n+     */\n+    private void populateDrawableCache() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f306c4c77c0fc2183d46e7954a57c22112867e9"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "627ac9151799a76aba5e2c1f115b9a0dd35bb4eb", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/627ac9151799a76aba5e2c1f115b9a0dd35bb4eb", "committedDate": "2020-03-17T14:18:18Z", "message": "I might revert this commit[I have reasons]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e", "committedDate": "2020-03-17T14:22:21Z", "message": "Create in-memory drawables in CVH's onBind, caches are bad, add mental overhead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTA3ODU1", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376107855", "createdAt": "2020-03-17T14:50:16Z", "commit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MDoxNlrOF3fwbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MDoxNlrOF3fwbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNjMwMQ==", "bodyText": "formatting in this file is still not correct, no space around operators", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393736301", "createdAt": "2020-03-17T14:50:16Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,32 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random =new Random();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTA4NzQy", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376108742", "createdAt": "2020-03-17T14:51:10Z", "commit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MToxMFrOF3fzLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MToxMFrOF3fzLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzAwNw==", "bodyText": "also you can remove the brackets here", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393737007", "createdAt": "2020-03-17T14:51:10Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -104,40 +100,18 @@ public void init(int position, DisplayableContribution contribution) {\n     }\n \n     /**\n-     * This method fetches the thumbnail url from file name\n-     * If the thumbnail url is present in cache, then it is used otherwise API call is made to fetch the thumbnail\n-     * This can be removed once #2904 is in place and contribution contains all metadata beforehand\n-     * @param contribution\n+     * Returns the image source for the image view, first preference is given to thumbUrl if that is\n+     * null, moves to local uri and if both are null return null\n+     *\n+     * @param thumbUrl\n+     * @param localUri\n+     * @return\n      */\n-    private void fetchAndDisplayThumbnail(DisplayableContribution contribution) {\n-        String keyForLRUCache = contribution.getFilename();\n-        String cacheUrl = thumbnailCache.get(keyForLRUCache);\n-        if (!StringUtils.isBlank(cacheUrl)) {\n-            imageView.setImageURI(cacheUrl);\n-            return;\n-        }\n-\n-        imageView.setBackground(null);\n-        if ((contribution.getState() != Contribution.STATE_COMPLETED) && FileUtils.fileExists(\n-                contribution.getLocalUri())) {\n-            imageView.setImageURI(contribution.getLocalUri());\n-        } else {\n-            Timber.d(\"Fetching thumbnail for %s\", contribution.getFilename());\n-            Disposable disposable = mediaDataExtractor\n-                    .getMediaFromFileName(contribution.getFilename())\n-                    .subscribeOn(Schedulers.io())\n-                    .observeOn(AndroidSchedulers.mainThread())\n-                    .subscribe(media -> {\n-                        thumbnailCache.put(keyForLRUCache, media.getThumbUrl());\n-                        imageView.setImageURI(media.getThumbUrl());\n-                    });\n-            compositeDisposable.add(disposable);\n-        }\n-\n-    }\n-\n-    public void clear() {\n-        compositeDisposable.clear();\n+    @Nullable\n+    private String chooseImageSource(String thumbUrl, Uri localUri) {\n+        return !TextUtils.isEmpty(thumbUrl) ? thumbUrl :\n+            (localUri != null ? localUri.toString() :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "originalPosition": 139}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTExMDMx", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376111031", "createdAt": "2020-03-17T14:53:31Z", "commit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MzozMlrOF3f5xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1MzozMlrOF3f5xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczODY5Mg==", "bodyText": "View recycling is kind of the point of a Recyclerview. I am very hesitant to approve this.", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r393738692", "createdAt": "2020-03-17T14:53:32Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsListFragment.java", "diffHunk": "@@ -108,6 +109,7 @@ private void initRecyclerView() {\n         }\n \n         rvContributionsList.setAdapter(adapter);\n+        rvContributionsList.setItemViewCacheSize(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00ab4f20da4da8f563f2f00f7d4d1d3af775c5e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34a5dca6742848d1dd4e66023c90df50b3914480", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/34a5dca6742848d1dd4e66023c90df50b3914480", "committedDate": "2020-03-18T08:17:35Z", "message": "Revert \"I might revert this commit[I have reasons]\"\n\nThis reverts commit 627ac9151799a76aba5e2c1f115b9a0dd35bb4eb."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "895c5c727b6ec9de13e41718b80b32db0c64ac4f", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/895c5c727b6ec9de13e41718b80b32db0c64ac4f", "committedDate": "2020-03-18T08:19:34Z", "message": "minor formatting changes, reverted 627ac9151799a76aba5e2c1f115b9a0dd35bb4eb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae6f8cc894dcc1a30b8658e80027f10720e8848c", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/ae6f8cc894dcc1a30b8658e80027f10720e8848c", "committedDate": "2020-03-18T08:21:01Z", "message": "uh-oh missed semicolon, java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjkzNTgy", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376693582", "createdAt": "2020-03-18T09:32:28Z", "commit": {"oid": "ae6f8cc894dcc1a30b8658e80027f10720e8848c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOTozMjoyOVrOF38uiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOTozMjoyOVrOF38uiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMDk1NQ==", "bodyText": "this isn't formatted", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#discussion_r394210955", "createdAt": "2020-03-18T09:32:29Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionViewHolder.java", "diffHunk": "@@ -41,32 +37,32 @@\n     @BindView(R.id.contributionProgress) ProgressBar progressView;\n     @BindView(R.id.failed_image_options) LinearLayout failedImageOptions;\n \n-    @Inject\n-    MediaDataExtractor mediaDataExtractor;\n-\n-    @Inject\n-    @Named(\"thumbnail-cache\")\n-    LruCache<String, String> thumbnailCache;\n-\n-    private DisplayableContribution contribution;\n-    private CompositeDisposable compositeDisposable = new CompositeDisposable();\n     private int position;\n+    private Contribution contribution;\n+    private Random random = new Random();\n \n     ContributionViewHolder(View parent, Callback callback) {\n         super(parent);\n         ButterKnife.bind(this, parent);\n         this.callback=callback;\n     }\n \n-    public void init(int position, DisplayableContribution contribution) {\n-        ApplicationlessInjection.getInstance(itemView.getContext())\n-                .getCommonsApplicationComponent().inject(this);\n+    public void init(int position, Contribution contribution) {\n+        this.contribution=contribution;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6f8cc894dcc1a30b8658e80027f10720e8848c"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1", "author": {"user": {"login": "ashishkumar468", "name": "Ashish"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1", "committedDate": "2020-03-18T09:48:02Z", "message": "minor formatting changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzE0NTQ0", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376714544", "createdAt": "2020-03-18T09:59:56Z", "commit": {"oid": "ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzIyMDI4", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376722028", "createdAt": "2020-03-18T10:10:04Z", "commit": {"oid": "ab53d8aa002cc331cfd6ebea31f1ee476e9cefe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzQ4OTk0", "url": "https://github.com/commons-app/apps-android-commons/pull/3515#pullrequestreview-376748994", "createdAt": "2020-03-18T10:47:45Z", "commit": {"oid": "ae6f8cc894dcc1a30b8658e80027f10720e8848c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 421, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}