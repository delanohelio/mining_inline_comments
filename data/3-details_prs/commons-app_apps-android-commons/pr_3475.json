{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MzQ2NTky", "number": 3475, "title": "Added AboutActivityTest", "bodyText": "Description\nAdded Tests for the AboutActivity\nFixes #2889 Write Instrumentation Tests for AboutActivity\nTests performed\nTested betaDebug on Xiaomi Mi A2 with API level 29.", "createdAt": "2020-03-09T01:39:42Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3475", "merged": true, "mergeCommit": {"oid": "d925e32d2f6d2d331fe7098a3130e4f4f71de020"}, "closed": true, "closedAt": "2020-03-11T22:02:31Z", "author": {"login": "madhurgupta10"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLzwdIAH2gAyMzg1MzQ2NTkyOmU0YWEwNDlkMTQxYjZjMGQzZjYxZTFkMTY3YjJjYWFiODcwMjMxOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMuevZgFqTM3MzE1NTQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/e4aa049d141b6c0d3f61e1d167b2caab8702319a", "committedDate": "2020-03-09T01:37:20Z", "message": "Added AboutActivityTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODgwOTQ0", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-370880944", "createdAt": "2020-03-09T01:39:46Z", "commit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNjI4OTM5", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-371628939", "createdAt": "2020-03-10T01:31:38Z", "commit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMTozMTozOFrOFz-pPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMTozMjoyMlrOFz-pzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA0ODA2Mw==", "bodyText": "Why is the package name com.android.vending?", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390048063", "createdAt": "2020-03-10T01:31:38Z", "author": {"login": "maskaravivek"}, "path": "app/src/main/java/fr/free/nrw/commons/Urls.kt", "diffHunk": "@@ -7,6 +7,9 @@ internal object Urls {\n     const val CREDITS_URL = \"https://github.com/commons-app/apps-android-commons/blob/master/CREDITS\"\n     const val FAQ_URL = \"https://github.com/commons-app/apps-android-commons/wiki/Frequently-Asked-Questions\"\n     const val PLAY_STORE_URL = \"https://play.google.com/store/apps/details?id=fr.free.nrw.commons\"\n+    const val PLAY_STORE_PREFIX = \"market://details?id=\"\n+    const val PLAY_STORE_URL_PREFIX = \"https://play.google.com/store/apps/details?id=\"\n+    const val PLAY_STORE_PACKAGE_NAME = \"com.android.vending\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA0ODIwNA==", "bodyText": "Lets not hardcode package name. Use context to get current package name.", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390048204", "createdAt": "2020-03-10T01:32:22Z", "author": {"login": "maskaravivek"}, "path": "app/src/androidTest/java/fr/free/nrw/commons/AboutActivityTest.kt", "diffHunk": "@@ -0,0 +1,116 @@\n+package fr.free.nrw.commons\n+\n+import android.app.Activity\n+import android.app.Instrumentation\n+import android.content.Intent\n+import androidx.test.core.app.ApplicationProvider.getApplicationContext\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.action.ViewActions\n+import androidx.test.espresso.assertion.ViewAssertions\n+import androidx.test.espresso.intent.Intents\n+import androidx.test.espresso.intent.matcher.IntentMatchers\n+import androidx.test.espresso.matcher.ViewMatchers\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.rule.ActivityTestRule\n+import androidx.test.runner.AndroidJUnit4\n+import fr.free.nrw.commons.utils.ConfigUtils\n+import org.hamcrest.CoreMatchers\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+class AboutActivityTest {\n+    @get:Rule\n+    var activityRule: ActivityTestRule<*> = ActivityTestRule(AboutActivity::class.java)\n+\n+    @Before\n+    fun setup() {\n+        Intents.init()\n+        UITestHelper.skipWelcome()\n+        UITestHelper.skipLogin()\n+        Intents.intending(CoreMatchers.not(IntentMatchers.isInternal()))\n+                .respondWith(Instrumentation.ActivityResult(Activity.RESULT_OK, null))\n+    }\n+\n+    @Test\n+    fun testBuildNumber() {\n+        Espresso.onView(ViewMatchers.withId(R.id.about_version))\n+                .check(ViewAssertions.matches(withText(ConfigUtils.getVersionNameWithSha(getApplicationContext()))))\n+    }\n+\n+    @Test\n+    fun testLaunchWebsite() {\n+        Espresso.onView(ViewMatchers.withId(R.id.website_launch_icon)).perform(ViewActions.click())\n+        Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                IntentMatchers.hasData(Urls.WEBSITE_URL)))\n+    }\n+\n+    @Test\n+    fun testLaunchFacebook() {\n+        Espresso.onView(ViewMatchers.withId(R.id.facebook_launch_icon)).perform(ViewActions.click())\n+        try {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.hasPackage(Urls.FACEBOOK_PACKAGE_NAME)))\n+        } catch (e: Exception) {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.hasData(Urls.FACEBOOK_WEB_URL)))\n+        }\n+    }\n+\n+    @Test\n+    fun testLaunchGithub() {\n+        Espresso.onView(ViewMatchers.withId(R.id.github_launch_icon)).perform(ViewActions.click())\n+        Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                IntentMatchers.hasData(Urls.GITHUB_REPO_URL)))\n+    }\n+\n+    @Test\n+    fun testLaunchRateUs() {\n+        val appPackageName = BuildConfig::class.java.getPackage().name\n+        Espresso.onView(ViewMatchers.withId(R.id.about_rate_us)).perform(ViewActions.click())\n+        try {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.toPackage(Urls.PLAY_STORE_PACKAGE_NAME)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzY3NjQ5", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-371767649", "createdAt": "2020-03-10T08:53:29Z", "commit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwODo1MzoyOVrOF0F5lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwODo1MzoyOVrOF0F5lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE2NjkzNA==", "bodyText": "This rule should just launch you to AboutActivity, why do you have to launch the app from the beginning?", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390166934", "createdAt": "2020-03-10T08:53:29Z", "author": {"login": "macgills"}, "path": "app/src/androidTest/java/fr/free/nrw/commons/AboutActivityTest.kt", "diffHunk": "@@ -0,0 +1,116 @@\n+package fr.free.nrw.commons\n+\n+import android.app.Activity\n+import android.app.Instrumentation\n+import android.content.Intent\n+import androidx.test.core.app.ApplicationProvider.getApplicationContext\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.action.ViewActions\n+import androidx.test.espresso.assertion.ViewAssertions\n+import androidx.test.espresso.intent.Intents\n+import androidx.test.espresso.intent.matcher.IntentMatchers\n+import androidx.test.espresso.matcher.ViewMatchers\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.rule.ActivityTestRule\n+import androidx.test.runner.AndroidJUnit4\n+import fr.free.nrw.commons.utils.ConfigUtils\n+import org.hamcrest.CoreMatchers\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+class AboutActivityTest {\n+    @get:Rule\n+    var activityRule: ActivityTestRule<*> = ActivityTestRule(AboutActivity::class.java)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzY4OTE1", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-371768915", "createdAt": "2020-03-10T08:55:26Z", "commit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwODo1NToyNlrOF0F90w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwODo1NToyNlrOF0F90w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE2ODAxOQ==", "bodyText": "generally a test should not be catching exceptions and especially not overly broad ones like Exception", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390168019", "createdAt": "2020-03-10T08:55:26Z", "author": {"login": "macgills"}, "path": "app/src/androidTest/java/fr/free/nrw/commons/AboutActivityTest.kt", "diffHunk": "@@ -0,0 +1,116 @@\n+package fr.free.nrw.commons\n+\n+import android.app.Activity\n+import android.app.Instrumentation\n+import android.content.Intent\n+import androidx.test.core.app.ApplicationProvider.getApplicationContext\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.action.ViewActions\n+import androidx.test.espresso.assertion.ViewAssertions\n+import androidx.test.espresso.intent.Intents\n+import androidx.test.espresso.intent.matcher.IntentMatchers\n+import androidx.test.espresso.matcher.ViewMatchers\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.rule.ActivityTestRule\n+import androidx.test.runner.AndroidJUnit4\n+import fr.free.nrw.commons.utils.ConfigUtils\n+import org.hamcrest.CoreMatchers\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+class AboutActivityTest {\n+    @get:Rule\n+    var activityRule: ActivityTestRule<*> = ActivityTestRule(AboutActivity::class.java)\n+\n+    @Before\n+    fun setup() {\n+        Intents.init()\n+        UITestHelper.skipWelcome()\n+        UITestHelper.skipLogin()\n+        Intents.intending(CoreMatchers.not(IntentMatchers.isInternal()))\n+                .respondWith(Instrumentation.ActivityResult(Activity.RESULT_OK, null))\n+    }\n+\n+    @Test\n+    fun testBuildNumber() {\n+        Espresso.onView(ViewMatchers.withId(R.id.about_version))\n+                .check(ViewAssertions.matches(withText(ConfigUtils.getVersionNameWithSha(getApplicationContext()))))\n+    }\n+\n+    @Test\n+    fun testLaunchWebsite() {\n+        Espresso.onView(ViewMatchers.withId(R.id.website_launch_icon)).perform(ViewActions.click())\n+        Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                IntentMatchers.hasData(Urls.WEBSITE_URL)))\n+    }\n+\n+    @Test\n+    fun testLaunchFacebook() {\n+        Espresso.onView(ViewMatchers.withId(R.id.facebook_launch_icon)).perform(ViewActions.click())\n+        try {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.hasPackage(Urls.FACEBOOK_PACKAGE_NAME)))\n+        } catch (e: Exception) {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.hasData(Urls.FACEBOOK_WEB_URL)))\n+        }\n+    }\n+\n+    @Test\n+    fun testLaunchGithub() {\n+        Espresso.onView(ViewMatchers.withId(R.id.github_launch_icon)).perform(ViewActions.click())\n+        Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                IntentMatchers.hasData(Urls.GITHUB_REPO_URL)))\n+    }\n+\n+    @Test\n+    fun testLaunchRateUs() {\n+        val appPackageName = BuildConfig::class.java.getPackage().name\n+        Espresso.onView(ViewMatchers.withId(R.id.about_rate_us)).perform(ViewActions.click())\n+        try {\n+            Intents.intended(CoreMatchers.allOf(IntentMatchers.hasAction(Intent.ACTION_VIEW),\n+                    IntentMatchers.toPackage(Urls.PLAY_STORE_PACKAGE_NAME)))\n+        } catch (e: Exception) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4aa049d141b6c0d3f61e1d167b2caab8702319a"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0132b10ac78ef926e07665505a0c160077471c5", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/d0132b10ac78ef926e07665505a0c160077471c5", "committedDate": "2020-03-10T19:56:01Z", "message": "Changes made as per suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3a4b211da5fe04170012f728ab05e44865c5d2b", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/b3a4b211da5fe04170012f728ab05e44865c5d2b", "committedDate": "2020-03-10T22:21:51Z", "message": "Removed File to resolve conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjU0NTk4", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-372654598", "createdAt": "2020-03-11T10:55:59Z", "commit": {"oid": "b3a4b211da5fe04170012f728ab05e44865c5d2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NTo1OVrOF0yDaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NTo1OVrOF0yDaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MDM0NQ==", "bodyText": "oh, this should definitely be changed, it is a bad example that led you astray. context.getPackageName()", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390890345", "createdAt": "2020-03-11T10:55:59Z", "author": {"login": "macgills"}, "path": "app/src/main/java/fr/free/nrw/commons/Utils.java", "diffHunk": "@@ -117,10 +117,10 @@ public static String fixExtension(String title, String extension) {\n     public static void rateApp(Context context) {\n         final String appPackageName = BuildConfig.class.getPackage().getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3a4b211da5fe04170012f728ab05e44865c5d2b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ed7109c3213752170eec3c5f7353e51da7b729", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/46ed7109c3213752170eec3c5f7353e51da7b729", "committedDate": "2020-03-11T13:18:28Z", "message": "Removed hardcoded packagename"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzYwMTU4", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-372760158", "createdAt": "2020-03-11T13:33:55Z", "commit": {"oid": "46ed7109c3213752170eec3c5f7353e51da7b729"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzozMzo1NVrOF03Dmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzozMzo1NVrOF03Dmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk3MjMxNQ==", "bodyText": "hasData was still a valuable test", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#discussion_r390972315", "createdAt": "2020-03-11T13:33:55Z", "author": {"login": "macgills"}, "path": "app/src/androidTest/java/fr/free/nrw/commons/AboutActivityTest.kt", "diffHunk": "@@ -63,11 +60,8 @@ class AboutActivityTest {\n \n     @Test\n     fun testLaunchRateUs() {\n-        val appPackageName = InstrumentationRegistry.getInstrumentation().targetContext.packageName\n         Espresso.onView(ViewMatchers.withId(R.id.about_rate_us)).perform(ViewActions.click())\n         Intents.intended(IntentMatchers.hasAction(Intent.ACTION_VIEW))\n-        Intents.intended(CoreMatchers.anyOf(IntentMatchers.toPackage(Urls.PLAY_STORE_PACKAGE_NAME),\n-                IntentMatchers.hasData(\"${Urls.PLAY_STORE_URL_PREFIX}$appPackageName\")))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46ed7109c3213752170eec3c5f7353e51da7b729"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43dda4251c063deb127baf1df4aa3bc150b412c", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/a43dda4251c063deb127baf1df4aa3bc150b412c", "committedDate": "2020-03-11T16:27:47Z", "message": "Changes as per suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8713ea077f4e5c841de02c84e23ad61df46bf9da", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/8713ea077f4e5c841de02c84e23ad61df46bf9da", "committedDate": "2020-03-11T17:13:16Z", "message": "Removed Unrelated changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18917da1ecb65e43ea3d9aa3815f837e0c4347c0", "author": {"user": {"login": "madhurgupta10", "name": "Madhur Gupta"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/18917da1ecb65e43ea3d9aa3815f837e0c4347c0", "committedDate": "2020-03-11T21:32:24Z", "message": "Fixed Build Issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTU1NDg4", "url": "https://github.com/commons-app/apps-android-commons/pull/3475#pullrequestreview-373155488", "createdAt": "2020-03-11T22:02:23Z", "commit": {"oid": "18917da1ecb65e43ea3d9aa3815f837e0c4347c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 392, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}