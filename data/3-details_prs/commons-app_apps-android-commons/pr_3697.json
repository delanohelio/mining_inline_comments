{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MzY3MjI1", "number": 3697, "title": "Fixes #3679: Issues with new media details UI", "bodyText": "Issues with new media details UI\nFixes #3679\nTests performed (required)\nTested prodDebug on Honor Play with API level 29.\nGIF of what's changed", "createdAt": "2020-04-22T15:31:05Z", "url": "https://github.com/commons-app/apps-android-commons/pull/3697", "merged": true, "mergeCommit": {"oid": "82bf2d757f7bc32507d3cf6c783be610fbd025fd"}, "closed": true, "closedAt": "2020-04-25T09:34:29Z", "author": {"login": "kbhardwaj123"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaFRktAH2gAyNDA3MzY3MjI1OmQ1OGIzOGI0M2M1YjA4ZjE1MTY4OGJiNzA5ODgzZjM5YzkxMzcwM2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcatuQfAFqTM5OTc1ODY4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/d58b38b43c5b08f151688bb709883f39c913703f", "committedDate": "2020-04-22T09:56:50Z", "message": "fix issues with media details ui"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzEzMTA4", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#pullrequestreview-398313108", "createdAt": "2020-04-22T15:31:09Z", "commit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89dc6fa5de0ce58c7f96deb405f742ba07e35fbe", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/89dc6fa5de0ce58c7f96deb405f742ba07e35fbe", "committedDate": "2020-04-24T04:40:55Z", "message": "code refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ee23eeaeaa59a77f83b61730ea517249bd9c40b", "author": {"user": {"login": "kbhardwaj123", "name": "Kshitij Bhardwaj"}}, "url": "https://github.com/commons-app/apps-android-commons/commit/9ee23eeaeaa59a77f83b61730ea517249bd9c40b", "committedDate": "2020-04-24T04:46:08Z", "message": "minor indentation fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzU4MjE5", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#pullrequestreview-399758219", "createdAt": "2020-04-24T08:49:08Z", "commit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzU4Njgw", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#pullrequestreview-399758680", "createdAt": "2020-04-24T08:49:48Z", "commit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwODo0OTo0OFrOGLNYcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTowMzo1M1rOGLN8Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQwNjc2OA==", "bodyText": "Plase add a space before =", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414406768", "createdAt": "2020-04-24T08:49:48Z", "author": {"login": "neslihanturan"}, "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -144,10 +147,14 @@ public static MediaDetailFragment forMedia(int index, boolean editable, boolean\n      * However unlike categories depictions is multi-lingual\n      * Ex: key: en value: monument\n      */\n+    private ImageInfo imageData;\n+    private int oldWidth;\n+    private int newWidth=0;\n     private Depictions depictions;\n     private boolean categoriesLoaded = false;\n     private boolean categoriesPresent = false;\n     private boolean depictionLoaded = false;\n+    private boolean heightVerifyingBoolean= true; // helps in maintaining aspect ratio", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxNDcwNA==", "bodyText": "Please use more descriptive naming explaining old width of what. And there shouldn't be a need to initialize 0 value of int, condiering it is a member variable and default value is already 0.", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414414704", "createdAt": "2020-04-24T09:01:42Z", "author": {"login": "neslihanturan"}, "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -144,10 +147,14 @@ public static MediaDetailFragment forMedia(int index, boolean editable, boolean\n      * However unlike categories depictions is multi-lingual\n      * Ex: key: en value: monument\n      */\n+    private ImageInfo imageData;\n+    private int oldWidth;\n+    private int newWidth=0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxNTk2Nw==", "bodyText": "I would name imageData as imageInfo, considering its class type and the other usages in the code.", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414415967", "createdAt": "2020-04-24T09:03:53Z", "author": {"login": "neslihanturan"}, "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -262,29 +306,31 @@ private void displayMediaDetails() {\n      * The imageSpacer is Basically a transparent overlay for the SimpleDraweeView\n      * which holds the image to be displayed( moreover this image is out of\n      * the scroll view )\n-     * @param imageInfo used to calculate height of the ImageSpacer\n+     * @param scrollWidth the current width of the scrollView\n      */\n-    private void updateAspectRatio(ImageInfo imageInfo) {\n-        if (imageInfo != null) {\n-            int screenWidth = scrollView.getWidth();\n-            int finalHeight = (screenWidth*imageInfo.getHeight()) / imageInfo.getWidth();\n+    private void updateAspectRatio(int scrollWidth) {\n+        if (imageData != null) {\n+            int finalHeight = (scrollWidth*imageData.getHeight()) / imageData.getWidth();\n             ViewGroup.LayoutParams params = image.getLayoutParams();\n             ViewGroup.LayoutParams spacerParams = imageSpacer.getLayoutParams();\n             params.height = finalHeight;\n             spacerParams.height = finalHeight;\n             image.setLayoutParams(params);\n             imageSpacer.setLayoutParams(spacerParams);\n+            imageLandscape.setLayoutParams(params);\n         }\n     }\n \n     private final ControllerListener aspectRatioListener = new BaseControllerListener<ImageInfo>() {\n         @Override\n         public void onIntermediateImageSet(String id, @Nullable ImageInfo imageInfo) {\n-            updateAspectRatio(imageInfo);\n+            imageData = imageInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d58b38b43c5b08f151688bb709883f39c913703f"}, "originalPosition": 110}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 588, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}