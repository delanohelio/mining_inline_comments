{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMjIwNjIy", "number": 2853, "title": "Fix MetricPredicate and add MetricExistsPredicate", "bodyText": "This PR fixes the current implementation of MetricPredicate and adds a new MetricExistsPredicate to cope with our Elasticsearch data schema\nRelated Issue\nFixes #2852\nDescription of the solution adopted\nMetricPredicateImpl has been reworked to match the \"metrics.metricName.typ\" notation; also MetricExistsPredicate has been created to match the schema notation. The current ExistsPredicate hasn't changed since it could be used for other fields", "createdAt": "2020-02-10T16:09:54Z", "url": "https://github.com/eclipse/kapua/pull/2853", "merged": true, "mergeCommit": {"oid": "3d9ca1fe563229bca7831bf9afd3eef83f102e13"}, "closed": true, "closedAt": "2020-02-12T08:52:54Z", "author": {"login": "lorthirk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC_emBABqjMwMjMzNjEwMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDP6RogFqTM1NjU3ODc0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef53ab2cd9d75bb54120ca066635b689ead512eb", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/ef53ab2cd9d75bb54120ca066635b689ead512eb", "committedDate": "2020-02-10T16:05:56Z", "message": "Fix MetricPredicate and add MetricExistsPredicate\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/2e693da37f471ad5d703c6f17b97e3d80402da12", "committedDate": "2020-02-10T16:11:15Z", "message": "Fix MetricPredicate and add MetricExistsPredicate\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTc1ODQ2", "url": "https://github.com/eclipse/kapua/pull/2853#pullrequestreview-356575846", "createdAt": "2020-02-11T11:15:03Z", "commit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMToxNTowM1rOFoFMNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMToxNTozN1rOFoFNPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3MjQwNQ==", "bodyText": "@since 1.2.0", "url": "https://github.com/eclipse/kapua/pull/2853#discussion_r377572405", "createdAt": "2020-02-11T11:15:03Z", "author": {"login": "Coduz"}, "path": "service/datastore/api/src/main/java/org/eclipse/kapua/service/datastore/model/query/MetricExistsPredicate.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*******************************************************************************\n+ * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\n+ *\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     Eurotech - initial API and implementation\n+ *******************************************************************************/\n+package org.eclipse.kapua.service.datastore.model.query;\n+\n+/**\n+ * Query predicate for matching messages with existing metrics\n+ *\n+ * @since 1.0.0\n+ */\n+public interface MetricExistsPredicate extends ExistsPredicate {\n+\n+    /**\n+     * Gets the metric type to search.\n+     * This is required because metric with the same name can have different types.\n+     *\n+     * @return The metric type\n+     * @since 1.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3MjQzMg==", "bodyText": "@since 1.2.0", "url": "https://github.com/eclipse/kapua/pull/2853#discussion_r377572432", "createdAt": "2020-02-11T11:15:07Z", "author": {"login": "Coduz"}, "path": "service/datastore/api/src/main/java/org/eclipse/kapua/service/datastore/model/query/MetricExistsPredicate.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*******************************************************************************\n+ * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\n+ *\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     Eurotech - initial API and implementation\n+ *******************************************************************************/\n+package org.eclipse.kapua.service.datastore.model.query;\n+\n+/**\n+ * Query predicate for matching messages with existing metrics\n+ *\n+ * @since 1.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3MjQ2Nw==", "bodyText": "@since 1.2.0", "url": "https://github.com/eclipse/kapua/pull/2853#discussion_r377572467", "createdAt": "2020-02-11T11:15:11Z", "author": {"login": "Coduz"}, "path": "service/datastore/api/src/main/java/org/eclipse/kapua/service/datastore/model/query/MetricExistsPredicate.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*******************************************************************************\n+ * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\n+ *\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     Eurotech - initial API and implementation\n+ *******************************************************************************/\n+package org.eclipse.kapua.service.datastore.model.query;\n+\n+/**\n+ * Query predicate for matching messages with existing metrics\n+ *\n+ * @since 1.0.0\n+ */\n+public interface MetricExistsPredicate extends ExistsPredicate {\n+\n+    /**\n+     * Gets the metric type to search.\n+     * This is required because metric with the same name can have different types.\n+     *\n+     * @return The metric type\n+     * @since 1.0.0\n+     */\n+    Class<?> getType();\n+\n+    /**\n+     * Sets the metric type so search.\n+     *\n+     * @param type The metric type to search.\n+     * @since 1.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3MjY2OA==", "bodyText": "@since 1.2.0", "url": "https://github.com/eclipse/kapua/pull/2853#discussion_r377572668", "createdAt": "2020-02-11T11:15:37Z", "author": {"login": "Coduz"}, "path": "service/datastore/internal/src/main/java/org/eclipse/kapua/service/datastore/internal/model/query/MetricExistsPredicateImpl.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*******************************************************************************\n+ * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\n+ *\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     Eurotech - initial API and implementation\n+ *******************************************************************************/\n+package org.eclipse.kapua.service.datastore.internal.model.query;\n+\n+import org.eclipse.kapua.service.datastore.client.DatamodelMappingException;\n+import org.eclipse.kapua.service.datastore.internal.mediator.DatastoreUtils;\n+import org.eclipse.kapua.service.datastore.internal.schema.KeyValueEntry;\n+import org.eclipse.kapua.service.datastore.internal.schema.SchemaUtil;\n+import org.eclipse.kapua.service.datastore.model.query.MetricExistsPredicate;\n+\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+/**\n+ * Implementation of query predicate for checking if a field exists\n+ *\n+ * @since 1.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e766e1c9d25e32bf860c33c03dcd59fe4487b505", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/e766e1c9d25e32bf860c33c03dcd59fe4487b505", "committedDate": "2020-02-11T11:18:33Z", "message": "Fix MetricPredicate and add MetricExistsPredicate\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e693da37f471ad5d703c6f17b97e3d80402da12", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/2e693da37f471ad5d703c6f17b97e3d80402da12", "committedDate": "2020-02-10T16:11:15Z", "message": "Fix MetricPredicate and add MetricExistsPredicate\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "e766e1c9d25e32bf860c33c03dcd59fe4487b505", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/e766e1c9d25e32bf860c33c03dcd59fe4487b505", "committedDate": "2020-02-11T11:18:33Z", "message": "Fix MetricPredicate and add MetricExistsPredicate\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTc4NzQx", "url": "https://github.com/eclipse/kapua/pull/2853#pullrequestreview-356578741", "createdAt": "2020-02-11T11:20:05Z", "commit": {"oid": "e766e1c9d25e32bf860c33c03dcd59fe4487b505"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 212, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}