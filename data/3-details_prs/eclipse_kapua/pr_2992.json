{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MTU3NTcy", "number": 2992, "title": "Fixed missing OpenID Provider session invalidation", "bodyText": "Logout from the OpenID Connect Provider in case the Kapua Console session is expired.\nRelated Issue\nThis PR fixes #2971\nDescription of the solution adopted\nAdded an HttpSessionListener that listens to the Kapua Console session invalidation. When the session is invalidated, it performs an HTTP request to the OpenID Provider logout endpoint.\nNote that this does not follow the same flow as the normal OpenID logout. Moreover, this feature can be disabled with a dedicated property called console.sso.openid.session_listener.logout.enabled.\nScreenshots\nN/A\nAny side note on the changes made\nAlso updated comments and removed unused variables that are part of the SSO code.\nThis PR requires PR #2996 to be merged!", "createdAt": "2020-05-29T15:01:32Z", "url": "https://github.com/eclipse/kapua/pull/2992", "merged": true, "mergeCommit": {"oid": "bd12a3a5c2d62a6eab15e125585f8efefabc2ac8"}, "closed": true, "closedAt": "2020-06-17T09:33:01Z", "author": {"login": "gbarbon"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoRtONABqjM0MTEwNTkwMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp62SXAH2gAyNDI1MTU3NTcyOjM2MjVmMzA2NTVkN2M1ODk0YmJiY2U1YzZlN2QxZTAyOWZmOTNmNWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6a436a20e1ff02d2daf461ae848994972ea6104", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/a6a436a20e1ff02d2daf461ae848994972ea6104", "committedDate": "2020-05-29T14:42:09Z", "message": "Init fix for OpenID Provider session invalidation\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "76f75afbf8619721115acd0e2d0ffd3e8114edcb", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/76f75afbf8619721115acd0e2d0ffd3e8114edcb", "committedDate": "2020-06-05T12:20:27Z", "message": "Init fix for OpenID Provider session invalidation\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76f75afbf8619721115acd0e2d0ffd3e8114edcb", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/76f75afbf8619721115acd0e2d0ffd3e8114edcb", "committedDate": "2020-06-05T12:20:27Z", "message": "Init fix for OpenID Provider session invalidation\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "302c3eb65b9299f12062a5ca33878d8582433151", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/302c3eb65b9299f12062a5ca33878d8582433151", "committedDate": "2020-06-09T10:46:31Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "302c3eb65b9299f12062a5ca33878d8582433151", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/302c3eb65b9299f12062a5ca33878d8582433151", "committedDate": "2020-06-09T10:46:31Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "ba00b4aa8dee4e1921dd424d78587af499287a12", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/ba00b4aa8dee4e1921dd424d78587af499287a12", "committedDate": "2020-06-09T10:51:47Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba00b4aa8dee4e1921dd424d78587af499287a12", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/ba00b4aa8dee4e1921dd424d78587af499287a12", "committedDate": "2020-06-09T10:51:47Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "791b519c104f61946c0f855ec2a2bab8dd081961", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/791b519c104f61946c0f855ec2a2bab8dd081961", "committedDate": "2020-06-09T13:49:16Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "791b519c104f61946c0f855ec2a2bab8dd081961", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/791b519c104f61946c0f855ec2a2bab8dd081961", "committedDate": "2020-06-09T13:49:16Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "b7c785a5b1033215f480a3f67ec40af956b00f20", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/b7c785a5b1033215f480a3f67ec40af956b00f20", "committedDate": "2020-06-10T10:41:51Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTUyNzA3", "url": "https://github.com/eclipse/kapua/pull/2992#pullrequestreview-427952707", "createdAt": "2020-06-10T11:16:12Z", "commit": {"oid": "b7c785a5b1033215f480a3f67ec40af956b00f20"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToxNjoxMlrOGhwNUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToxNjoxNFrOGhwNbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0NjAzNA==", "bodyText": "Hey @gbarbon,\ncan you change the header of this file to \" * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\" ?\nBecause last change is from the current year \ud83d\ude04", "url": "https://github.com/eclipse/kapua/pull/2992#discussion_r438046034", "createdAt": "2020-06-10T11:16:12Z", "author": {"login": "LeoNerdoG"}, "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/shiro/CredentialsFactoryImpl.java", "diffHunk": "@@ -39,8 +39,8 @@ public ApiKeyCredentials newApiKeyCredentials(String apiKey) {\n     }\n \n     @Override\n-    public JwtCredentials newJwtCredentials(String jwt) {\n-        return new JwtCredentialsImpl(jwt);\n+    public JwtCredentials newJwtCredentials(String jwt, String idToken) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7c785a5b1033215f480a3f67ec40af956b00f20"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0NjA2MA==", "bodyText": "Hey @gbarbon,\ncan you change the header of this file to \" * Copyright (c) 2011, 2020 Eurotech and/or its affiliates and others\" ?\nBecause last change is from the current year \ud83d\ude04", "url": "https://github.com/eclipse/kapua/pull/2992#discussion_r438046060", "createdAt": "2020-06-10T11:16:14Z", "author": {"login": "LeoNerdoG"}, "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/shiro/JwtCredentialsImpl.java", "diffHunk": "@@ -19,9 +19,11 @@\n     private static final long serialVersionUID = -5920944517814926028L;\n \n     private String jwt;\n+    private String idToken;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7c785a5b1033215f480a3f67ec40af956b00f20"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7c785a5b1033215f480a3f67ec40af956b00f20", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/b7c785a5b1033215f480a3f67ec40af956b00f20", "committedDate": "2020-06-10T10:41:51Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "7e6ef900020afd40fa5d0625db4c661bd1eb8940", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/7e6ef900020afd40fa5d0625db4c661bd1eb8940", "committedDate": "2020-06-10T12:00:03Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0f2c05644221c9b6c7b56a74c8a903209574ec5", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/e0f2c05644221c9b6c7b56a74c8a903209574ec5", "committedDate": "2020-06-10T12:04:52Z", "message": "Init fix for OpenID Provider session invalidation\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fb181576a14f248609a7509129f4e7c9d9b4d17", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/6fb181576a14f248609a7509129f4e7c9d9b4d17", "committedDate": "2020-06-10T12:04:52Z", "message": "Removed again GwtSession from the ShiroSession, added info to the KapuaSession, added field to distinguish user initiated logout in session\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a034d6237b2d6eef8c4574462014f143493f2bf5", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/a034d6237b2d6eef8c4574462014f143493f2bf5", "committedDate": "2020-06-10T12:04:52Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e6ef900020afd40fa5d0625db4c661bd1eb8940", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/7e6ef900020afd40fa5d0625db4c661bd1eb8940", "committedDate": "2020-06-10T12:00:03Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}, "afterCommit": {"oid": "a034d6237b2d6eef8c4574462014f143493f2bf5", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/a034d6237b2d6eef8c4574462014f143493f2bf5", "committedDate": "2020-06-10T12:04:52Z", "message": "Using modified JwtCredentials instead of new method on the AuthenticationService\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3625f30655d7c5894bbbce5c6e7d1e029ff93f5f", "author": {"user": {"login": "gbarbon", "name": "Gianluca Barbon"}}, "url": "https://github.com/eclipse/kapua/commit/3625f30655d7c5894bbbce5c6e7d1e029ff93f5f", "committedDate": "2020-06-10T14:50:46Z", "message": "Minor sso doc update\n\nSigned-off-by: Gianluca Barbon <gianluca.barbon@eurotech.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 179, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}