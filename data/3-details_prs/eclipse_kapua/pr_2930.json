{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMjAyMTg4", "number": 2930, "title": "ServiceDAO findByField improvements", "bodyText": "This PR extends ServiceDAO.findByField() to all fields, and also adds optional scopeId checking\nRelated Issue\nNo related issue", "createdAt": "2020-04-07T11:15:33Z", "url": "https://github.com/eclipse/kapua/pull/2930", "merged": true, "mergeCommit": {"oid": "e287be3d9d1d3bd58e31224bebe27bc6eef1f95e"}, "closed": true, "closedAt": "2020-04-17T09:43:22Z", "author": {"login": "lorthirk"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVUIuBgBqjMyMTAxMTc5NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV4Ul2ABqjMyMTczMjk5MTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc1a66695a42455b24947d6eaec69b0077c7af86", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/dc1a66695a42455b24947d6eaec69b0077c7af86", "committedDate": "2020-04-06T09:17:23Z", "message": "Add scopeId to findByName\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/7cc720a59aa1926520ed9d83919b3e3b2023ef2f", "committedDate": "2020-04-07T14:25:59Z", "message": "Add scopeId to findByName\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MjIyNzM3", "url": "https://github.com/eclipse/kapua/pull/2930#pullrequestreview-389222737", "createdAt": "2020-04-07T15:18:21Z", "commit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNToxODoyMVrOGCIs8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNToyODoyMFrOGCJMSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MjkxMw==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404892913", "createdAt": "2020-04-07T15:18:21Z", "author": {"login": "Coduz"}, "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/step/internal/JobStepDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobStep find(EntityManager em, KapuaId scopeId, KapuaId jobStepId)\n      * @return\n      */\n     public static JobStep findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobStepImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobStepImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzI3Mw==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893273", "createdAt": "2020-04-07T15:18:45Z", "author": {"login": "Coduz"}, "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobDAO.java", "diffHunk": "@@ -89,7 +89,7 @@ public static Job find(EntityManager em, KapuaId scopeId, KapuaId jobId) {\n      * @return\n      */\n     public static Job findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzQwNg==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893406", "createdAt": "2020-04-07T15:18:54Z", "author": {"login": "Coduz"}, "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/execution/internal/JobExecutionDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobExecution find(EntityManager em, KapuaId scopeId, KapuaId jobEx\n      * @since 1.0.0\n      */\n     public static JobExecution findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobExecutionImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobExecutionImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5MzYzNQ==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893635", "createdAt": "2020-04-07T15:19:12Z", "author": {"login": "Coduz"}, "path": "service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountDAO.java", "diffHunk": "@@ -95,7 +95,7 @@ public static Account find(EntityManager em, KapuaId scopeId, KapuaId accountId)\n      * @return\n      */\n     public static Account findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, AccountImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, AccountImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5Mzg4Ng==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404893886", "createdAt": "2020-04-07T15:19:30Z", "author": {"login": "Coduz"}, "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/targets/internal/JobTargetDAO.java", "diffHunk": "@@ -92,7 +92,7 @@ public static JobTarget find(EntityManager em, KapuaId scopeId, KapuaId jobTarge\n      * @return\n      */\n     public static JobTarget findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, JobTargetImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, JobTargetImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5Njk0OQ==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404896949", "createdAt": "2020-04-07T15:23:19Z", "author": {"login": "Coduz"}, "path": "service/user/internal/src/main/java/org/eclipse/kapua/service/user/internal/UserDAO.java", "diffHunk": "@@ -89,7 +89,7 @@ public static User find(EntityManager em, KapuaId scopeId, KapuaId userId) {\n      * @return\n      */\n     public static User findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, UserImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, UserImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5NzE3NQ==", "bodyText": "Please use UserAttributes.EXTETNAL_ID", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404897175", "createdAt": "2020-04-07T15:23:34Z", "author": {"login": "Coduz"}, "path": "service/user/internal/src/main/java/org/eclipse/kapua/service/user/internal/UserDAO.java", "diffHunk": "@@ -100,7 +100,7 @@ public static User findByName(EntityManager em, String name) {\n      * @return the user record, may be {@code null}\n      */\n     public static User findByExternalId(final EntityManager em, final String externalId) {\n-        return ServiceDAO.findByField(em, UserImpl.class, \"externalId\", externalId);\n+        return ServiceDAO.findByField(em, UserImpl.class, null, \"externalId\", externalId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5NzQ5MA==", "bodyText": "Please use KapuaNamedEntityAttributes.NAME", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404897490", "createdAt": "2020-04-07T15:23:59Z", "author": {"login": "Coduz"}, "path": "commons/src/main/java/org/eclipse/kapua/commons/configuration/ServiceConfigDAO.java", "diffHunk": "@@ -83,7 +83,7 @@ public static ServiceConfig find(EntityManager em, KapuaId scopeId, KapuaId user\n      * @return\n      */\n     public static ServiceConfig findByName(EntityManager em, String name) {\n-        return ServiceDAO.findByField(em, ServiceConfigImpl.class, \"name\", name);\n+        return ServiceDAO.findByField(em, ServiceConfigImpl.class, null, \"name\", name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkwMDkzOA==", "bodyText": "I would have kept\n\nfindByField(em, clazz, name, value) \nfindByField(em, clazz, scopeId name, value)\n\nin order to avoid to pass null to a methods which usage could be confusing.\nAlso they actually have a slight difference which is that the one without scopeId needs checkaccess perfomed after invokation while with scopeId check access should have already happened", "url": "https://github.com/eclipse/kapua/pull/2930#discussion_r404900938", "createdAt": "2020-04-07T15:28:20Z", "author": {"login": "Coduz"}, "path": "commons/src/main/java/org/eclipse/kapua/commons/service/internal/ServiceDAO.java", "diffHunk": "@@ -268,14 +271,21 @@ protected ServiceDAO() {\n     /**\n      * Find by fields {@link KapuaEntity} utility method\n      *\n-     * @param em    The {@link EntityManager} that holds the transaction.\n-     * @param clazz The {@link KapuaEntity} class. This must be the implementing {@code class}.\n-     * @param name  The {@link KapuaEntity} name of the field from which to search.\n-     * @param value The value of the field from which to search.\n+     * @param em      The {@link EntityManager} that holds the transaction.\n+     * @param clazz   The {@link KapuaEntity} class. This must be the implementing {@code class}.\n+     * @param scopeId\n+     * @param name    The {@link KapuaEntity} name of the field from which to search.\n+     * @param value   The value of the field from which to search.\n      * @return The {@link KapuaEntity} found, or {@code null} if not found.\n+     * @throws NonUniqueResultException When more than one result is returned\n      * @since 1.0.0\n      */\n-    public static <E extends KapuaEntity> E findByField(@NotNull EntityManager em, @NotNull Class<E> clazz, @NotNull String name, @NotNull String value) {\n+    @Nullable\n+    public static <E extends KapuaEntity> E findByField(@NotNull EntityManager em,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cc720a59aa1926520ed9d83919b3e3b2023ef2f"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22eb86f8e3d0577561944401b1e605ef1003b1ec", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/22eb86f8e3d0577561944401b1e605ef1003b1ec", "committedDate": "2020-04-07T15:37:28Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "933bcabffb399cce5508a23390a83c91c6d133de", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/933bcabffb399cce5508a23390a83c91c6d133de", "committedDate": "2020-04-07T16:08:18Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Mjc2Njk1", "url": "https://github.com/eclipse/kapua/pull/2930#pullrequestreview-389276695", "createdAt": "2020-04-07T16:14:57Z", "commit": {"oid": "933bcabffb399cce5508a23390a83c91c6d133de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b69d33795d1aaa91555a9b511fbf4986835bf4f", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/9b69d33795d1aaa91555a9b511fbf4986835bf4f", "committedDate": "2020-04-08T15:54:23Z", "message": "Throw exception if multiple results are found, non-string value search\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "933bcabffb399cce5508a23390a83c91c6d133de", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/933bcabffb399cce5508a23390a83c91c6d133de", "committedDate": "2020-04-07T16:08:18Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "committedDate": "2020-04-08T15:54:23Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/d7a516f6ebb4db1f62a5b71c05dddaf235f585b7", "committedDate": "2020-04-08T15:54:23Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "32bad670c3d6cc775b3ca2574ce763cb86322e4e", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/32bad670c3d6cc775b3ca2574ce763cb86322e4e", "committedDate": "2020-04-08T15:55:48Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d08048c6b989b814ecdb1a6781e15ba26a7b24bf", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/d08048c6b989b814ecdb1a6781e15ba26a7b24bf", "committedDate": "2020-04-09T08:34:00Z", "message": "Use findByName() methods instead of query() where applicable\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "183fa9350682645bab53b5cd16a8bc98a84604bc", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/183fa9350682645bab53b5cd16a8bc98a84604bc", "committedDate": "2020-04-09T08:34:49Z", "message": "Add scopeId to findByName\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aacbd93d82c5b1d228e076fd32d7092c1a1824b", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/2aacbd93d82c5b1d228e076fd32d7092c1a1824b", "committedDate": "2020-04-09T08:35:10Z", "message": "Add overload without scopeId\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08bef72cf161873e34c3578dbb7b097bcf798895", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/08bef72cf161873e34c3578dbb7b097bcf798895", "committedDate": "2020-04-09T08:35:13Z", "message": "Add doPriviledge to findByField method calls\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60e7ff21d234ba18847959660571ae7dce1eca78", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/60e7ff21d234ba18847959660571ae7dce1eca78", "committedDate": "2020-04-09T07:40:53Z", "message": "Add doPriviledge to findByField method calls\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}, "afterCommit": {"oid": "08bef72cf161873e34c3578dbb7b097bcf798895", "author": {"user": {"login": "lorthirk", "name": "Claudio Mezzasalma"}}, "url": "https://github.com/eclipse/kapua/commit/08bef72cf161873e34c3578dbb7b097bcf798895", "committedDate": "2020-04-09T08:35:13Z", "message": "Add doPriviledge to findByField method calls\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}