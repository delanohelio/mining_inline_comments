{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTIwOTY0", "number": 233, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzo0NjoxM1rODaLKgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDoyMToxMFrODaL83A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzcyNDgxOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzo0NjoxM1rOFg-nnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDo1Nzo0MVrOFhBMDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNDcwMw==", "bodyText": "Why two methods instead of a single method with a Nullable version?  Either way, some javadoc here would be helpful.", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370124703", "createdAt": "2020-01-23T13:46:13Z", "author": {"login": "EricWittmann"}, "path": "app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java", "diffHunk": "@@ -28,10 +29,28 @@\n \n /**\n  * The storage layer for the registry.\n+ *\n  * @author eric.wittmann@gmail.com\n  */\n public interface RegistryStorage {\n \n+    /**\n+     * Update artifact state.\n+     *\n+     * @param artifactId\n+     * @param state\n+     */\n+    void updateArtifactState(String artifactId, ArtifactState state);\n+\n+    /**\n+     * Update artifact state.\n+     *\n+     * @param artifactId\n+     * @param state\n+     * @param version\n+     */\n+    void updateArtifactState(String artifactId, ArtifactState state, Integer version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2Njc5Ng==", "bodyText": "We have similar for all other ops, hence I added both.\nFeel free to remove one.", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370166796", "createdAt": "2020-01-23T14:57:41Z", "author": {"login": "alesj"}, "path": "app/src/main/java/io/apicurio/registry/storage/RegistryStorage.java", "diffHunk": "@@ -28,10 +29,28 @@\n \n /**\n  * The storage layer for the registry.\n+ *\n  * @author eric.wittmann@gmail.com\n  */\n public interface RegistryStorage {\n \n+    /**\n+     * Update artifact state.\n+     *\n+     * @param artifactId\n+     * @param state\n+     */\n+    void updateArtifactState(String artifactId, ArtifactState state);\n+\n+    /**\n+     * Update artifact state.\n+     *\n+     * @param artifactId\n+     * @param state\n+     * @param version\n+     */\n+    void updateArtifactState(String artifactId, ArtifactState state, Integer version);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNDcwMw=="}, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzczNzE2OnYy", "diffSide": "RIGHT", "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzo0OTo0NFrOFg-u9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTowMDo0MlrOFhBTjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNjU4Mw==", "bodyText": "Why remove VersionNotFoundException when the method can definitely throw it?", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370126583", "createdAt": "2020-01-23T13:49:44Z", "author": {"login": "EricWittmann"}, "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -93,29 +98,37 @@ protected void afterInit() {\n         return v2c;\n     }\n \n-    private Map<String, String> getContentMap(String artifactId, Long version) throws ArtifactNotFoundException, VersionNotFoundException {\n+    private Map<String, String> getContentMap(String artifactId, Long version, EnumSet<ArtifactState> states) throws ArtifactNotFoundException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNzM0Mg==", "bodyText": "Also maybe add ArtifactStateInvalidException?  I realize these are all unchecked exceptions.  It seems like we should either declare them or not declare them...but not declare only some of them.", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370127342", "createdAt": "2020-01-23T13:50:56Z", "author": {"login": "EricWittmann"}, "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -93,29 +98,37 @@ protected void afterInit() {\n         return v2c;\n     }\n \n-    private Map<String, String> getContentMap(String artifactId, Long version) throws ArtifactNotFoundException, VersionNotFoundException {\n+    private Map<String, String> getContentMap(String artifactId, Long version, EnumSet<ArtifactState> states) throws ArtifactNotFoundException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNjU4Mw=="}, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2ODcxOQ==", "bodyText": "Yeah, IntelliJ was pointing it out, since VNFE extends ANFE, hence it's obsolete (even more).\nImo, we should cleanup these unchecked exceptions ...", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370168719", "createdAt": "2020-01-23T15:00:42Z", "author": {"login": "alesj"}, "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -93,29 +98,37 @@ protected void afterInit() {\n         return v2c;\n     }\n \n-    private Map<String, String> getContentMap(String artifactId, Long version) throws ArtifactNotFoundException, VersionNotFoundException {\n+    private Map<String, String> getContentMap(String artifactId, Long version, EnumSet<ArtifactState> states) throws ArtifactNotFoundException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNjU4Mw=="}, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Nzc2MTUxOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzo1NjozNVrOFg-9lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTowMTozM1rOFhBVoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEzMDMyNA==", "bodyText": "I know we don't have an answer on this yet, but IMO this should be ACTIVE_STATES", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370130324", "createdAt": "2020-01-23T13:56:35Z", "author": {"login": "EricWittmann"}, "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -267,7 +304,7 @@ public StoredArtifact getArtifact(String artifactId) throws ArtifactNotFoundExce\n      */\n     @Override\n     public ArtifactMetaDataDto getArtifactMetaData(String artifactId) throws ArtifactNotFoundException, RegistryStorageException {\n-        Map<String, String> content = getLatestContentMap(artifactId);\n+        Map<String, String> content = getLatestContentMap(artifactId, ArtifactStateExt.ALL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2OTI0OA==", "bodyText": "Yup, makes the most sense.\nI'll fix this asap, and adjust the tests to fit this behavior.", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370169248", "createdAt": "2020-01-23T15:01:33Z", "author": {"login": "alesj"}, "path": "app/src/main/java/io/apicurio/registry/storage/impl/AbstractMapRegistryStorage.java", "diffHunk": "@@ -267,7 +304,7 @@ public StoredArtifact getArtifact(String artifactId) throws ArtifactNotFoundExce\n      */\n     @Override\n     public ArtifactMetaDataDto getArtifactMetaData(String artifactId) throws ArtifactNotFoundException, RegistryStorageException {\n-        Map<String, String> content = getLatestContentMap(artifactId);\n+        Map<String, String> content = getLatestContentMap(artifactId, ArtifactStateExt.ALL);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEzMDMyNA=="}, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 191}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Nzg1MzcyOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/io/apicurio/registry/types/ArtifactState.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDoyMToxMFrOFg_0VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTowMjo0MVrOFhBYhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0NDM0MQ==", "bodyText": "Is this needed?  Are we actually soft-deleting artifacts in the storage layer?  If so, I think a side effect of this is that a user could delete an artifact by calling \"updateArtifactState\" and passing it DELETE.  Maybe that's ok?", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370144341", "createdAt": "2020-01-23T14:21:10Z", "author": {"login": "EricWittmann"}, "path": "common/src/main/java/io/apicurio/registry/types/ArtifactState.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright 2019 Red Hat\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.types;\n+\n+/**\n+ * @author Ales Justin\n+ */\n+public enum ArtifactState {\n+\n+    ENABLED,\n+    DISABLED,\n+    DEPRECATED,\n+    DELETED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2OTk4OQ==", "bodyText": "That's how I have it now ...\nI added it since it (the DELETE state) came around when we discussed it with Andrew ...", "url": "https://github.com/Apicurio/apicurio-registry/pull/233#discussion_r370169989", "createdAt": "2020-01-23T15:02:41Z", "author": {"login": "alesj"}, "path": "common/src/main/java/io/apicurio/registry/types/ArtifactState.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright 2019 Red Hat\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.types;\n+\n+/**\n+ * @author Ales Justin\n+ */\n+public enum ArtifactState {\n+\n+    ENABLED,\n+    DISABLED,\n+    DEPRECATED,\n+    DELETED", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0NDM0MQ=="}, "originalCommit": {"oid": "26afcba8905b2d1c450c6ca2e0e71ceb32a9fca8"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3409, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}