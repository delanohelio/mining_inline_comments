{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNDE4Njc1", "number": 745, "title": "Enhancements to the release workflow", "bodyText": "Added step to tweet about the release\nRetry maven deploy step 3 times\nOther fixes to the flow due to steps introduced for apicurio website changes\nAdded comments to project.yaml for clarity", "createdAt": "2020-08-05T14:25:10Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/745", "merged": true, "mergeCommit": {"oid": "583ad166fd8825014d31d41cec1b9a2aaa467154"}, "closed": true, "closedAt": "2020-08-11T17:21:55Z", "author": {"login": "riprasad"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc78B1HgH2gAyNDYzNDE4Njc1OjVkYjBjZDEwMjQ1OGI0MzM3ODMyZmZiNDkxYjVhMWU0MjAwNWE3NGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc96KxFgFqTQ2NTI3NDQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5db0cd102458b4337832ffb491b5a1e42005a74f", "author": {"user": {"login": "riprasad", "name": "Rishab Prasad"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/5db0cd102458b4337832ffb491b5a1e42005a74f", "committedDate": "2020-08-05T14:23:55Z", "message": "Enhancements to the release workflow\n\nAdd step to tweet about the release\nRetry maven deploy step 3 times\nOther fixes to the flow due to steps introduced for apicurio website changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "388df72328153280e1447139414d2a1fab002100", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/388df72328153280e1447139414d2a1fab002100", "committedDate": "2020-08-10T13:23:33Z", "message": "Merge branch 'master' into feature/enhance-github-actions-workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "727dd5773ea73d0f9cd70323429e685a0ced342a", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/727dd5773ea73d0f9cd70323429e685a0ced342a", "committedDate": "2020-08-10T15:11:37Z", "message": "Merge branch 'master' into feature/enhance-github-actions-workflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MzcwNzc2", "url": "https://github.com/Apicurio/apicurio-registry/pull/745#pullrequestreview-464370776", "createdAt": "2020-08-10T16:06:06Z", "commit": {"oid": "727dd5773ea73d0f9cd70323429e685a0ced342a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjowNjowNlrOG-VbDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjowNjowNlrOG-VbDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAxNTg4NQ==", "bodyText": "Can you explain why this works?  I know && can be used to string together multiple commands - but I'm unfamiliar with the gritty details.\nE.g. does this stop trying if the first attempt succeeds?\n@jsenko and @carlesarnal - I would appreciate your thoughts on this.  I'm wondering if a script might be better here.", "url": "https://github.com/Apicurio/apicurio-registry/pull/745#discussion_r468015885", "createdAt": "2020-08-10T16:06:06Z", "author": {"login": "EricWittmann"}, "path": ".github/workflows/release.yaml", "diffHunk": "@@ -62,22 +57,28 @@ jobs:\n           git branch --set-upstream-to=origin/master\n           git pull\n       - name: Update Release Version ${{steps.metadata.outputs.release-version}}\n-        run: mvn versions:set -DnewVersion=${{steps.metadata.outputs.release-version}} -DgenerateBackupPoms=false -DprocessAllModules=true\n+        run: cd registry && mvn versions:set -DnewVersion=${{steps.metadata.outputs.release-version}} -DgenerateBackupPoms=false -DprocessAllModules=true\n       - name: Build All Variants\n-        run: mvn clean install -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests\n+        run: cd registry && mvn clean install -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests\n       - name: Commit Release Version Change\n         run: |\n+          cd registry\n           git add .\n           git commit -m \"Automated update to Release Version:: ${{steps.metadata.outputs.release-version}}\"\n           git push\n-      - name: Publish to Maven Central\n-        uses: samuelmeuli/action-maven-publish@v1\n-        with:\n-          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}\n-          gpg_passphrase: ${{ secrets.GPG_PASSPHRASE }}\n-          nexus_username: ${{ secrets.OSSRH_USERNAME }}\n-          nexus_password: ${{ secrets.OSSRH_TOKEN }}\n-          maven_goals_phases: deploy --batch-mode -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests -Prelease --settings /home/runner/.m2/settings.xml -DskipTests\n+      - name: Import GPG Key\n+        uses: crazy-max/ghaction-import-gpg@v1\n+        env:\n+          GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}\n+          PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }} \n+      - name: Maven Deploy\n+        run: |\n+          cd registry\n+          # Retry 3 times before the steps actually fails\n+          (echo \"===== Maven Deploy Attempt: 1 ====\" && mvn deploy --batch-mode -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests -Prelease --settings /home/runner/.m2/settings.xml -DskipTests) || \\\n+          (echo \"===== Maven Deploy Attempt: 2 ====\" && mvn deploy --batch-mode -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests -Prelease --settings /home/runner/.m2/settings.xml -DskipTests) || \\\n+          (echo \"===== Maven Deploy Attempt: 3 ====\" && mvn deploy --batch-mode -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests -Prelease --settings /home/runner/.m2/settings.xml -DskipTests) || \\\n+          (echo \"==== Maven Deploy Step Failed ====\" && exit 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "727dd5773ea73d0f9cd70323429e685a0ced342a"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1Mjc0NDU4", "url": "https://github.com/Apicurio/apicurio-registry/pull/745#pullrequestreview-465274458", "createdAt": "2020-08-11T17:21:43Z", "commit": {"oid": "727dd5773ea73d0f9cd70323429e685a0ced342a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4480, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}