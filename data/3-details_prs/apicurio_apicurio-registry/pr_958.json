{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzczNzA5", "number": 958, "title": "Return the list of errors that cause validity/compatibility issues", "bodyText": "", "createdAt": "2020-10-27T13:57:11Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/958", "merged": true, "mergeCommit": {"oid": "e7d0be70ff783efbe86563576319812ed771007f"}, "closed": true, "closedAt": "2020-11-03T18:31:43Z", "author": {"login": "adiohana"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWpYuagH2gAyNTEwNzczNzA5OjYyYmExYjA4NDI2ZjczZTMwZTE0Njc2OTE1YTYwMDQ3Y2U3ZmZkZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY9g36AFqTUyMjc3MjY2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/62ba1b08426f73e30e14676915a60047ce7ffdf3", "committedDate": "2020-10-27T13:56:41Z", "message": "Return the list of errors that cause validity/compatibility issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzUzNzg3", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517753787", "createdAt": "2020-10-27T14:16:55Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxNjo1NlrOHo-ikg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxNjo1NlrOHo-ikg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcyOTc0Ng==", "bodyText": "When should someone return an empty compatibility result? What does it mean?", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512729746", "createdAt": "2020-10-27T14:16:56Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/CompatibilityExecutionResult.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package io.apicurio.registry.rules.compatibility;\n+\n+import io.apicurio.registry.rules.compatibility.jsonschema.diff.Difference;\n+\n+import java.util.Collections;\n+import java.util.Set;\n+\n+/**\n+ * Created by aohana\n+ */\n+public class CompatibilityExecutionResult {\n+\n+    private boolean isCompatible;\n+    private Set<Difference> incompatibleDifferences;\n+\n+    public CompatibilityExecutionResult(boolean isCompatible, Set<Difference> incompatibleDifferences) {\n+        this.isCompatible = isCompatible;\n+        this.incompatibleDifferences = incompatibleDifferences;\n+    }\n+\n+    public boolean isCompatible() {\n+        return isCompatible;\n+    }\n+\n+    public void setCompatible(boolean compatible) {\n+        isCompatible = compatible;\n+    }\n+\n+    public Set<Difference> getIncompatibleDifferences() {\n+        return incompatibleDifferences;\n+    }\n+\n+    public void setIncompatibleDifferences(Set<Difference> incompatibleDifferences) {\n+        this.incompatibleDifferences = incompatibleDifferences;\n+    }\n+\n+    public static CompatibilityExecutionResult empty(boolean isCompatible) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzU0NjQy", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517754642", "createdAt": "2020-10-27T14:17:43Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxNzo0M1rOHo-lMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxNzo0M1rOHo-lMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczMDQxOQ==", "bodyText": "Indentation isn't compatible with existing code", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512730419", "createdAt": "2020-10-27T14:17:43Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/CompatibilityChecker.java", "diffHunk": "@@ -37,17 +38,17 @@\n      *                           (e.g. a global COMPATIBILITY rule with {@see io.apicurio.registry.rules.RuleApplicationType#CREATE})\n      * @param proposedArtifact   MUST NOT be null\n      */\n-    default boolean isCompatibleWith(CompatibilityLevel compatibilityLevel, List<ContentHandle> existingArtifacts, ContentHandle proposedArtifact) {\n+    default CompatibilityExecutionResult testCompatibility(CompatibilityLevel compatibilityLevel, List<ContentHandle> existingArtifacts, ContentHandle proposedArtifact) {\n         requireNonNull(compatibilityLevel, \"compatibilityLevel MUST NOT be null\");\n         requireNonNull(existingArtifacts, \"existingArtifacts MUST NOT be null\");\n         requireNonNull(proposedArtifact, \"proposedArtifact MUST NOT be null\");\n         if (existingArtifacts.contains(null)) {\n             throw new IllegalStateException(\"existingArtifacts contains null element(s)\");\n         }\n-        return isCompatibleWith(\n-            compatibilityLevel,\n-            existingArtifacts.stream().map(ContentHandle::content).collect(Collectors.toList()),\n-            proposedArtifact.content()\n+        return testCompatibility(\n+                compatibilityLevel,\n+                existingArtifacts.stream().map(ContentHandle::content).collect(Collectors.toList()),\n+                proposedArtifact.content()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzU1Mzk5", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517755399", "createdAt": "2020-10-27T14:18:26Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxODoyNlrOHo-ncg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxODoyNlrOHo-ncg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczMDk5NA==", "bodyText": "Can you add to the comment some explanation on this class?", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512730994", "createdAt": "2020-10-27T14:18:26Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/CompatibilityExecutionResult.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package io.apicurio.registry.rules.compatibility;\n+\n+import io.apicurio.registry.rules.compatibility.jsonschema.diff.Difference;\n+\n+import java.util.Collections;\n+import java.util.Set;\n+\n+/**\n+ * Created by aohana\n+ */\n+public class CompatibilityExecutionResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzU2MjE1", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517756215", "createdAt": "2020-10-27T14:19:10Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxOToxMFrOHo-qAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoxOToxMFrOHo-qAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczMTY0OA==", "bodyText": "indentation too deep", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512731648", "createdAt": "2020-10-27T14:19:10Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/CompatibilityRuleExecutor.java", "diffHunk": "@@ -56,14 +61,31 @@ public void execute(RuleContext context) throws RuleViolationException {\n         CompatibilityChecker checker = provider.getCompatibilityChecker();\n         List<ContentHandle> existingArtifacts = context.getCurrentContent() != null\n             ? singletonList(context.getCurrentContent()) : emptyList();\n-        if (!checker.isCompatibleWith(\n-            level,\n-            existingArtifacts,\n-            context.getUpdatedContent())\n-        ) {\n-            throw new RuleViolationException(String.format(\"Incompatible artifact: %s [%s]\",\n-                context.getArtifactId(), context.getArtifactType()),\n-                RuleType.COMPATIBILITY, context.getConfiguration());\n+        CompatibilityExecutionResult compatibilityExecutionResult = checker.testCompatibility(\n+                level,\n+                existingArtifacts,\n+                context.getUpdatedContent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzY1NDQ1", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517765445", "createdAt": "2020-10-27T14:27:03Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoyNzowNFrOHo_FNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoyNzowNFrOHo_FNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczODYxMg==", "bodyText": "indentation", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512738612", "createdAt": "2020-10-27T14:27:04Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/jsonschema/JsonSchemaDiffLibrary.java", "diffHunk": "@@ -45,12 +48,12 @@ public static DiffContext findDifferences(String original, String updated) {\n             JSONObject updatedJson = MAPPER.readValue(updated, JSONObject.class);\n \n             Schema originalSchema = SchemaLoader.builder()\n-                .schemaJson(originalJson)\n-                .build().load().build();\n+                    .schemaJson(originalJson)\n+                    .build().load().build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NzY1ODQ3", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-517765847", "createdAt": "2020-10-27T14:27:25Z", "commit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoyNzoyNVrOHo_Gig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDoyNzoyNVrOHo_Gig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjczODk1NA==", "bodyText": "indentation", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r512738954", "createdAt": "2020-10-27T14:27:25Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/jsonschema/diff/DiffContext.java", "diffHunk": "@@ -85,12 +86,12 @@ private void addToDifferenceSets(Difference difference) {\n \n     public void addDifference(DiffType type, Object originalSubchema, Object updatedSubchema) {\n         Difference difference = Difference.builder()\n-            .diffType(type)\n-            .pathOriginal(\"\")\n-            .pathUpdated(pathUpdated)\n-            .subSchemaOriginal(Objects.toString(originalSubchema)) // make sure toString is good enough\n-            .subSchemaUpdated(Objects.toString(updatedSubchema))\n-            .build();\n+                .diffType(type)\n+                .pathOriginal(\"\")\n+                .pathUpdated(pathUpdated)\n+                .subSchemaOriginal(Objects.toString(originalSubchema)) // make sure toString is good enough\n+                .subSchemaUpdated(Objects.toString(updatedSubchema))\n+                .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ba1b08426f73e30e14676915a60047ce7ffdf3"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d312f451c0e556b6761af8ec43f413aa6c5b85c", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/7d312f451c0e556b6761af8ec43f413aa6c5b85c", "committedDate": "2020-10-27T15:02:32Z", "message": "fixed tests and indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a44129b447d596caf798604c486ad1b71f2f44ce", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/a44129b447d596caf798604c486ad1b71f2f44ce", "committedDate": "2020-10-27T15:21:08Z", "message": "remove thread sleep from resource test. CompatibilityExecutionResult class description."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTQ1MTcw", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-518545170", "createdAt": "2020-10-28T11:03:48Z", "commit": {"oid": "7d312f451c0e556b6761af8ec43f413aa6c5b85c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTowMzo0OFrOHpkutA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTowMzo0OFrOHpkutA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1NTQ0NA==", "bodyText": "...result for a compatibility check", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r513355444", "createdAt": "2020-10-28T11:03:48Z", "author": {"login": "ronsher"}, "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/CompatibilityExecutionResult.java", "diffHunk": "@@ -7,6 +7,9 @@\n \n /**\n  * Created by aohana\n+ *\n+ * Holds the result for compatibility check", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d312f451c0e556b6761af8ec43f413aa6c5b85c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5eb00eb9b0d6497940a845685711e20871c1973", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/b5eb00eb9b0d6497940a845685711e20871c1973", "committedDate": "2020-10-28T13:37:19Z", "message": "fixed typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTUwMTA1", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-522550105", "createdAt": "2020-11-03T14:29:29Z", "commit": {"oid": "b5eb00eb9b0d6497940a845685711e20871c1973"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNDoyOToyOVrOHsxUkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNDoyOToyOVrOHsxUkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwNzQ3NQ==", "bodyText": ":) nice catch", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#discussion_r516707475", "createdAt": "2020-11-03T14:29:29Z", "author": {"login": "EricWittmann"}, "path": "common/src/main/resources/META-INF/openapi.json", "diffHunk": "@@ -2233,7 +2233,7 @@\n                 }\n             },\n             \"RuleViolationCause\": {\n-                \"title\": \"Root Type for RuleViolationCAuse\",\n+                \"title\": \"Root Type for RuleViolationCause\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5eb00eb9b0d6497940a845685711e20871c1973"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTY1MTYy", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-522565162", "createdAt": "2020-11-03T14:42:44Z", "commit": {"oid": "b5eb00eb9b0d6497940a845685711e20871c1973"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abefab6e32b81e4511a6bba1d002758a313f8172", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/abefab6e32b81e4511a6bba1d002758a313f8172", "committedDate": "2020-11-03T15:02:45Z", "message": "Merge branch 'master' into issue_712_rule_violation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5141416776a8e42e4acfc2a5816437b6c24819c2", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/5141416776a8e42e4acfc2a5816437b6c24819c2", "committedDate": "2020-11-03T15:26:44Z", "message": "Merge branch 'master' of https://github.com/Apicurio/apicurio-registry into issue_712_rule_violation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f202da1a89d6c08311a36157df15ead2cd18f867", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/f202da1a89d6c08311a36157df15ead2cd18f867", "committedDate": "2020-11-03T15:28:21Z", "message": "fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f32181b01b9b335461b2cfd6f408b9dea9236707", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/f32181b01b9b335461b2cfd6f408b9dea9236707", "committedDate": "2020-11-03T15:29:28Z", "message": "Merge branch 'issue_712_rule_violation' of https://github.com/adiohana/apicurio-registry into issue_712_rule_violation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b68e8163d422cda862c59602704a3c4c688c45df", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/b68e8163d422cda862c59602704a3c4c688c45df", "committedDate": "2020-11-03T15:39:48Z", "message": "fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13e3d9ccd0451037a4da4f168f07b16d1f9e9d3", "author": {"user": {"login": "adiohana", "name": null}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/b13e3d9ccd0451037a4da4f168f07b16d1f9e9d3", "committedDate": "2020-11-03T16:27:59Z", "message": "Merge branch 'master' into issue_712_rule_violation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNzcyNjY5", "url": "https://github.com/Apicurio/apicurio-registry/pull/958#pullrequestreview-522772669", "createdAt": "2020-11-03T18:31:32Z", "commit": {"oid": "b13e3d9ccd0451037a4da4f168f07b16d1f9e9d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4342, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}