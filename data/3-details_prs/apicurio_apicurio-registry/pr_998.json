{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDI2NzYx", "number": 998, "title": "Allow client headers modification on a per request basis", "bodyText": "This is a first attempt/version and I think that it worth a preliminary review.", "createdAt": "2020-11-10T11:37:56Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/998", "merged": true, "mergeCommit": {"oid": "68c02d80703e85ead873f9cd99a84e15e10d2830"}, "closed": true, "closedAt": "2020-11-23T13:59:12Z", "author": {"login": "carlesarnal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddW5DWAH2gAyNTE4NDI2NzYxOjBhNmRlMjU1ZTdhZmRhOGU2MTkyYTMwMDJkYmQ4ZjhlNDY4MTY5Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddZ88dAFqTUzMjM4Mzk4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a6de255e7afda8e6192a3002dbd8f8e46816967", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/0a6de255e7afda8e6192a3002dbd8f8e46816967", "committedDate": "2020-11-17T10:21:16Z", "message": "Allow client headers modification on a per request basis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0eccca7013a4b221780b7820bc42a6725f82030", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/f0eccca7013a4b221780b7820bc42a6725f82030", "committedDate": "2020-11-17T10:21:16Z", "message": "Use thread local for customize request headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2243a4e282598175af4891c3ca8b2cbef4ce211d", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/2243a4e282598175af4891c3ca8b2cbef4ce211d", "committedDate": "2020-11-17T10:21:16Z", "message": "Remove unnecessary dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f10df25b3d89ce4b9762d2f2e320365907425e4", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/6f10df25b3d89ce4b9762d2f2e320365907425e4", "committedDate": "2020-11-17T10:21:16Z", "message": "Clear headers before actually making the request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "281483e3862945d6cfab1eec10fe548afd97c097", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/281483e3862945d6cfab1eec10fe548afd97c097", "committedDate": "2020-11-17T10:21:17Z", "message": "Add client concurrent calls test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd3be8c7a845926684317d5f7cea97f938586e34", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/bd3be8c7a845926684317d5f7cea97f938586e34", "committedDate": "2020-11-17T10:21:17Z", "message": "Add non concurrent client test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ed759a92385808433f6a87c2a90ed80f177970f", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/7ed759a92385808433f6a87c2a90ed80f177970f", "committedDate": "2020-11-17T10:18:56Z", "message": "Add non concurrent client test"}, "afterCommit": {"oid": "bd3be8c7a845926684317d5f7cea97f938586e34", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/bd3be8c7a845926684317d5f7cea97f938586e34", "committedDate": "2020-11-17T10:21:17Z", "message": "Add non concurrent client test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30490a92a046cb62765acd9059cb67beb65786d7", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/30490a92a046cb62765acd9059cb67beb65786d7", "committedDate": "2020-11-17T13:50:34Z", "message": "Update JsonSerdeTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzgyNTM1", "url": "https://github.com/Apicurio/apicurio-registry/pull/998#pullrequestreview-532382535", "createdAt": "2020-11-17T13:53:45Z", "commit": {"oid": "30490a92a046cb62765acd9059cb67beb65786d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzo1Mzo0NVrOH015OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzo1Mzo0NVrOH015OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE3MTAwMQ==", "bodyText": "I didn't expect to see this based on our design session on this feature.  I expected setNextRequestHeaders but not getHeaders.  I may be forgetting something... what is the use-case for this?  My recollection is that getHeaders was my (rejected) suggestion for allowing per-request headers.  But I thought we were all in favor of Fabian's idea.", "url": "https://github.com/Apicurio/apicurio-registry/pull/998#discussion_r525171001", "createdAt": "2020-11-17T13:53:45Z", "author": {"login": "EricWittmann"}, "path": "rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClient.java", "diffHunk": "@@ -145,4 +146,7 @@\n \n     VersionSearchResults searchVersions(String artifactId, Integer offset, Integer limit);\n \n+    void setNextRequestHeaders(Map<String, String> headers);\n+\n+    Map<String, String> getHeaders();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30490a92a046cb62765acd9059cb67beb65786d7"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzgzOTg3", "url": "https://github.com/Apicurio/apicurio-registry/pull/998#pullrequestreview-532383987", "createdAt": "2020-11-17T13:55:14Z", "commit": {"oid": "30490a92a046cb62765acd9059cb67beb65786d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzo1NToxNFrOH019nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzo1NToxNFrOH019nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE3MjEyNw==", "bodyText": "Is this guaranteed to get called even if the request fails?", "url": "https://github.com/Apicurio/apicurio-registry/pull/998#discussion_r525172127", "createdAt": "2020-11-17T13:55:14Z", "author": {"login": "EricWittmann"}, "path": "rest-client/src/main/java/io/apicurio/registry/client/request/RequestExecutor.java", "diffHunk": "@@ -18,15 +18,26 @@\n \n import retrofit2.Call;\n \n+import java.util.Map;\n+\n+\n /**\n  * @author Carles Arnal <carles.arnal@redhat.com>\n  */\n public class RequestExecutor {\n \n+    private final ThreadLocal<Map<String, String>> requestHeaders;\n+\n+    public RequestExecutor(ThreadLocal<Map<String, String>> requestHeaders) {\n+        this.requestHeaders = requestHeaders;\n+    }\n+\n     public <T> T execute(Call<T> call) {\n \n         final ResultCallback<T> resultCallback = new ResultCallback<T>();\n \n+        requestHeaders.remove();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30490a92a046cb62765acd9059cb67beb65786d7"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4376, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}