{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NzQ1Nzk3", "number": 772, "title": "Add create/updateArtifactWithMetadata methods to storage interface", "bodyText": "This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\nIt also means the hacky wait code in ibmcompat/api/impl/ApiServiceImple.java that was\nadded for the async storage types can be removed.\n\nSigned-off-by: Andrew Borley borley@uk.ibm.com", "createdAt": "2020-08-18T21:03:25Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/772", "merged": true, "mergeCommit": {"oid": "57a3778b98eba816a14ee5483eb92989f5109dd2"}, "closed": true, "closedAt": "2020-08-21T12:53:32Z", "author": {"login": "ajborley"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdANixhgBqjM2NjgxMjE2MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAwgoLgFqTQ3MTYzMjI3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0719ca1cb2fa4acd90f3b61756a583b9064843b1", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/0719ca1cb2fa4acd90f3b61756a583b9064843b1", "committedDate": "2020-08-18T20:58:33Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}, "afterCommit": {"oid": "cdc49ca2310556788142e00a1851bbb3b8059aa6", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/cdc49ca2310556788142e00a1851bbb3b8059aa6", "committedDate": "2020-08-18T21:03:49Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdc49ca2310556788142e00a1851bbb3b8059aa6", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/cdc49ca2310556788142e00a1851bbb3b8059aa6", "committedDate": "2020-08-18T21:03:49Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}, "afterCommit": {"oid": "012ffa0a8c147eeceeab9a5e3a272c37218110d3", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/012ffa0a8c147eeceeab9a5e3a272c37218110d3", "committedDate": "2020-08-19T11:44:24Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "012ffa0a8c147eeceeab9a5e3a272c37218110d3", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/012ffa0a8c147eeceeab9a5e3a272c37218110d3", "committedDate": "2020-08-19T11:44:24Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}, "afterCommit": {"oid": "8d61bcb8f8cea13a2d55ed94c7c9b1b7ccefd768", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/8d61bcb8f8cea13a2d55ed94c7c9b1b7ccefd768", "committedDate": "2020-08-19T12:11:53Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDgzNTMz", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#pullrequestreview-470483533", "createdAt": "2020-08-19T13:56:28Z", "commit": {"oid": "a167486080e1d75213fc5826a0149f29a00d5da3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzo1NjoyOVrOHDIoDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzo1NjoyOVrOHDIoDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA0OTEwMA==", "bodyText": "Perhaps extract these Submitter::submitMetadata calls into new method -- so we have this (cryptic parameters :-)) in one place.\n(same for Kafka storage)", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473049100", "createdAt": "2020-08-19T13:56:29Z", "author": {"login": "alesj"}, "path": "storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java", "diffHunk": "@@ -411,6 +435,15 @@ public StoredArtifact getArtifact(String artifactId) throws ArtifactNotFoundExce\n                        });\n     }\n \n+\n+    @Override\n+    public CompletionStage<ArtifactMetaDataDto> updateArtifactWithMetadata(String artifactId, ArtifactType artifactType, ContentHandle content, EditableArtifactMetaDataDto metaData) throws ArtifactAlreadyExistsException, RegistryStorageException {\n+        return updateArtifact(artifactId, artifactType, content)\n+            .thenCompose(amdd -> submitter.submitMetadata(Str.ActionType.UPDATE, artifactId, -1, metaData.getName(), metaData.getDescription(), metaData.getLabels())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a167486080e1d75213fc5826a0149f29a00d5da3"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDg2MjAy", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#pullrequestreview-470486202", "createdAt": "2020-08-19T13:59:04Z", "commit": {"oid": "a167486080e1d75213fc5826a0149f29a00d5da3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzo1OTowNVrOHDIvrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzo1OTowNVrOHDIvrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTA1Mg==", "bodyText": "I just got bitten by this :-)\nSo I know why it is set to 200 ... but I have a better fix. ;-)", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473051052", "createdAt": "2020-08-19T13:59:05Z", "author": {"login": "alesj"}, "path": "app/src/test/java/io/apicurio/registry/ibmcompat/IBMCompatApiTest.java", "diffHunk": "@@ -89,6 +89,7 @@ public void testGetSchemas() throws Exception {\n         // Get the list of artifacts via ibmcompat API\n         List<SchemaListItem> schemas = given()\n             .when()\n+                .param(\"per_page\", 200)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a167486080e1d75213fc5826a0149f29a00d5da3"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b44e1b23bda58586a30b1ff60a93bedf10c838e", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/9b44e1b23bda58586a30b1ff60a93bedf10c838e", "committedDate": "2020-08-20T11:08:20Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8444dc95d221c8e5bb6a4cd06f244b01b3e730a", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/c8444dc95d221c8e5bb6a4cd06f244b01b3e730a", "committedDate": "2020-08-19T18:56:36Z", "message": "Merge branch 'master' into create-with-metadata"}, "afterCommit": {"oid": "9b44e1b23bda58586a30b1ff60a93bedf10c838e", "author": {"user": {"login": "ajborley", "name": "Andrew Borley"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/9b44e1b23bda58586a30b1ff60a93bedf10c838e", "committedDate": "2020-08-20T11:08:20Z", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93c69ab3f84c5a9acdff5abaf261d645d17fd9f5", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/93c69ab3f84c5a9acdff5abaf261d645d17fd9f5", "committedDate": "2020-08-20T13:24:34Z", "message": "Merge branch 'master' into create-with-metadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjMyMjc1", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#pullrequestreview-471632275", "createdAt": "2020-08-20T13:48:19Z", "commit": {"oid": "93c69ab3f84c5a9acdff5abaf261d645d17fd9f5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4486, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}