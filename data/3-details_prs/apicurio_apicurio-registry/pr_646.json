{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3OTE3NDYx", "number": 646, "title": "Simplify properties handling, remove retry from poll (handle with exception consumer), change KeyValue store lookup", "bodyText": "", "createdAt": "2020-06-22T12:43:20Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/646", "merged": true, "mergeCommit": {"oid": "afa97ca640e64effd218382022b814686d5c739c"}, "closed": true, "closedAt": "2020-06-25T14:56:07Z", "author": {"login": "alesj"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctwHN4AH2gAyNDM3OTE3NDYxOjA4NmM0ZTQxMmRjNDJhOWFjNjBmODg3MjhkOTJjNTFmZjlkZjc4Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuurOtgH2gAyNDM3OTE3NDYxOjc4ZGVjYzc5ZGY2ZjcyYjE0OTIwMmMyN2NjZDQ2ZmI3ZDU3OGRjYTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "086c4e412dc42a9ac60f88728d92c51ff9df78cb", "author": {"user": {"login": "alesj", "name": "Ale\u0161 Justin"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/086c4e412dc42a9ac60f88728d92c51ff9df78cb", "committedDate": "2020-06-22T12:36:00Z", "message": "Simplify Kafka container and properties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6977411e8a822cec573e84dceacb5267a8fc25f7", "author": {"user": {"login": "alesj", "name": "Ale\u0161 Justin"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/6977411e8a822cec573e84dceacb5267a8fc25f7", "committedDate": "2020-06-22T12:36:00Z", "message": "Fix store lookup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36a2dc768650550f4e3bb474d3306457946f8cf9", "author": {"user": {"login": "alesj", "name": "Ale\u0161 Justin"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/36a2dc768650550f4e3bb474d3306457946f8cf9", "committedDate": "2020-06-22T12:36:00Z", "message": "Use Quarkus 1.5.1.Final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2", "author": {"user": {"login": "alesj", "name": "Ale\u0161 Justin"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/c4da634882804383f270a20f643f48a6b5d529f2", "committedDate": "2020-06-22T14:06:46Z", "message": "Use concurrent set."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NDkxNjcx", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#pullrequestreview-435491671", "createdAt": "2020-06-23T06:57:06Z", "commit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNjo1NzowNlrOGnbtvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwNjo1NzowNlrOGnbtvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwMTcyNA==", "bodyText": "The last upstream Quarkus version is 1.5.2. In that blog, they state that it is safe to upgrade from 1.5.1 to 1.5.2.", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#discussion_r444001724", "createdAt": "2020-06-23T06:57:06Z", "author": {"login": "carlesarnal"}, "path": "pom.xml", "diffHunk": "@@ -114,7 +114,7 @@\n         <yarn.version>1.22.4</yarn.version>\n         \n         <!-- Quarkus Version -->\n-        <quarkus.version>1.5.0.Final</quarkus.version>\n+        <quarkus.version>1.5.1.Final</quarkus.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NTcyMzgz", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#pullrequestreview-435572383", "createdAt": "2020-06-23T08:47:53Z", "commit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODo0Nzo1M1rOGnfhKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODo0Nzo1M1rOGnfhKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA2NDA0Mg==", "bodyText": "Maybe extract a method here could be a good idea.", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#discussion_r444064042", "createdAt": "2020-06-23T08:47:53Z", "author": {"login": "carlesarnal"}, "path": "utils/kafka/src/main/java/io/apicurio/registry/utils/kafka/ConsumerContainer.java", "diffHunk": "@@ -132,42 +147,46 @@ public ConsumerContainer(\n \n     private void consumerLoop() {\n         boolean waitingForSubscriptionOrAssignment = false;\n-        Map<TopicPartition, Long> activeTopics = idlePingConsumer == null ? null : new HashMap<>();\n+        Map<TopicPartition, Long> activeTopics = idlePingHandler == null ? null : new HashMap<>();\n         try (KafkaConsumer<K, V> consumer = new KafkaConsumer<>(consumerProperties, keyDeserializer, valueDeserializer)) {\n-            while (!stopping) {\n-                CompletableFuture<Consumer<K, V>> task = waitingForSubscriptionOrAssignment\n-                                                         ? tasks.take()\n-                                                         : tasks.poll();\n+            while (!closed) {\n+                CompletableFuture<Consumer<K, V>> task;\n+                boolean interrupted = false;\n+                try {\n+                    task = waitingForSubscriptionOrAssignment ? tasks.take() : tasks.poll();\n+                } catch (InterruptedException e) {\n+                    log.warn(\"Consumer thread interrupted\", e);\n+                    task = null;\n+                    interrupted = true;\n+                }\n                 if (task != null) {\n                     task.complete(consumer);\n                     if (waitingForSubscriptionOrAssignment) {\n                         waitingForSubscriptionOrAssignment = consumer.subscription().isEmpty() &&\n-                                                             consumer.assignment().isEmpty();\n+                                consumer.assignment().isEmpty();\n                     }\n-                } else {\n+                } else if (!interrupted) {\n                     assert !waitingForSubscriptionOrAssignment;\n \n-                    boolean[] flag = new boolean[1];\n-                    ConsumerRecords<K, V> records = consumeRetryable(null, r -> {\n-                        try {\n-                            return consumer.poll(consumerPollTimeout);\n-                        } catch (IllegalStateException e) { // thrown when there's no subscription or assignment\n-                            log.info(\"{} - will wait\", e.getMessage());\n-                            flag[0] = true;\n-                            return null;\n-                        }\n-                    }, consumer);\n-                    waitingForSubscriptionOrAssignment = flag[0];\n+                    ConsumerRecords<K, V> records = null;\n+                    try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2"}, "originalPosition": 173}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NTc4OTU5", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#pullrequestreview-435578959", "createdAt": "2020-06-23T08:55:38Z", "commit": {"oid": "c4da634882804383f270a20f643f48a6b5d529f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72fa1ae26ceae7753f89966ff88707cba98a7af", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/e72fa1ae26ceae7753f89966ff88707cba98a7af", "committedDate": "2020-06-23T19:23:25Z", "message": "Update pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MDkwNTc3", "url": "https://github.com/Apicurio/apicurio-registry/pull/646#pullrequestreview-436090577", "createdAt": "2020-06-23T19:29:40Z", "commit": {"oid": "e72fa1ae26ceae7753f89966ff88707cba98a7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4593daeb4f60950b8b436c9fa3686c1753f62fb9", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/4593daeb4f60950b8b436c9fa3686c1753f62fb9", "committedDate": "2020-06-23T19:29:48Z", "message": "Merge branch 'master' into cont_props_1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78decc79df6f72b149202c27ccd46fb7d578dca6", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/78decc79df6f72b149202c27ccd46fb7d578dca6", "committedDate": "2020-06-25T13:29:27Z", "message": "Merge branch 'master' into cont_props_1"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4458, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}