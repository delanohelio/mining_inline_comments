{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMDkyNzk1", "number": 774, "title": "Add option for avro json encoding, issue #643", "bodyText": "Add option to encode message using json encoding.\nIncludes an enum with constants to switch according to\nthe config specified\nSigned-off-by: A. Garrard GARRARD@uk.ibm.com", "createdAt": "2020-08-19T11:08:26Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/774", "merged": true, "mergeCommit": {"oid": "04ecd9ae3ae2ff01f66b65d0d2172a570573bfbe"}, "closed": true, "closedAt": "2020-08-24T16:47:19Z", "author": {"login": "tagarr"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAZkThgH2gAyNDcwMDkyNzk1OmM5YzU0NWRhYzg4YzYxNjZhOTVmZjQ0ZGYxODMwYTIwZTY5NDExZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCFd1oAFqTQ3MzY3NzU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9c545dac88c6166a95ff44df1830a20e69411df", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/c9c545dac88c6166a95ff44df1830a20e69411df", "committedDate": "2020-08-19T11:04:31Z", "message": "Add option for avro json encoding, issue #643\n\nAdd option to encode message using json encoding.\nIncludes an enum ith constants to switch according to\nthe config specified\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "899357fa32afbe9748841891564ae585e76bd16d", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/899357fa32afbe9748841891564ae585e76bd16d", "committedDate": "2020-08-19T12:26:31Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTQ5NDM3", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#pullrequestreview-470549437", "createdAt": "2020-08-19T15:02:32Z", "commit": {"oid": "899357fa32afbe9748841891564ae585e76bd16d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNTowMjozMlrOHDLo6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNTowMjozMlrOHDLo6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA5ODQ3Mw==", "bodyText": "I think it would be good to check these bytes here to ensure the data has been encoded as json. I think this test would currently still pass if the encoding was avro-binary.", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#discussion_r473098473", "createdAt": "2020-08-19T15:02:32Z", "author": {"login": "ajborley"}, "path": "app/src/test/java/io/apicurio/registry/RegistrySerdeTest.java", "diffHunk": "@@ -209,6 +208,33 @@ public void testAvro(Supplier<RegistryService> supplier) throws Exception {\n         }\n     }\n \n+    @RegistryServiceTest\n+    public void testAvroJSON(Supplier<RegistryService> supplier) throws Exception {\n+        Schema schema = new Schema.Parser().parse(\"{\\\"type\\\":\\\"record\\\",\\\"name\\\":\\\"myrecord3\\\",\\\"fields\\\":[{\\\"name\\\":\\\"bar\\\",\\\"type\\\":\\\"string\\\"}]}\");\n+        try (AvroKafkaSerializer<GenericData.Record> serializer = new AvroKafkaSerializer<GenericData.Record>(supplier.get());\n+             Deserializer<GenericData.Record> deserializer = new AvroKafkaDeserializer<>(supplier.get())) {\n+            HashMap<String, String> config = new HashMap();\n+            config.put(AvroEncoding.AVRO_ENCODING, AvroEncoding.AVRO_JSON );\n+            serializer.configure(config,false);\n+            deserializer.configure(config, false);\n+            serializer.setGlobalIdStrategy(new AutoRegisterIdStrategy<>());\n+\n+            GenericData.Record record = new GenericData.Record(schema);\n+            record.put(\"bar\", \"somebar\");\n+\n+            String subject = generateArtifactId();\n+\n+            byte[] bytes = serializer.serialize(subject, record);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "899357fa32afbe9748841891564ae585e76bd16d"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7dee196ad8df892594387af76b5b5c268ce479f", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/a7dee196ad8df892594387af76b5b5c268ce479f", "committedDate": "2020-08-19T16:03:48Z", "message": "Add option for avro json encoding, issue #643\n\nAdd check in test that msg is encoded as json\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb80a48601737237524deffd40f3c3ef8623a11", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/8eb80a48601737237524deffd40f3c3ef8623a11", "committedDate": "2020-08-19T16:06:56Z", "message": "Merge branch 'master' of https://github.com/tagarr/apicurio-registry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd58e25fbb7fa1eff7e3a1036d697231206f9792", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/cd58e25fbb7fa1eff7e3a1036d697231206f9792", "committedDate": "2020-08-19T18:21:27Z", "message": "Add option for avro json encoding, issue #643\n\nAdd option to encode message using json encoding.\nIncludes an enum ith constants to switch according to\nthe config specified\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ffd6f3633f90d77ee6f28dc7262c4944d22fdf5", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/8ffd6f3633f90d77ee6f28dc7262c4944d22fdf5", "committedDate": "2020-08-19T18:21:27Z", "message": "Add option for avro json encoding, issue #643\n\nAdd check in test that msg is encoded as json\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5239a32ebd58265c15d6567495c94a777db688c4", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/5239a32ebd58265c15d6567495c94a777db688c4", "committedDate": "2020-08-19T18:31:11Z", "message": "Merge branch 'master' of https://github.com/tagarr/apicurio-registry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9", "committedDate": "2020-08-19T18:55:35Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d0381c55ef2e28ae52d5abf4229345a8cfcad8", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/b4d0381c55ef2e28ae52d5abf4229345a8cfcad8", "committedDate": "2020-08-20T10:18:28Z", "message": "Add option for avro json encoding, issue #643\n\nRemove hard coded length on array copy\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "690d088d8570b02905d90a31951b41e0b45f22c1", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/690d088d8570b02905d90a31951b41e0b45f22c1", "committedDate": "2020-08-20T10:19:44Z", "message": "Merge branch 'master' of https://github.com/tagarr/apicurio-registry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTY5NzQ2", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#pullrequestreview-471569746", "createdAt": "2020-08-20T13:00:07Z", "commit": {"oid": "a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzowMDowN1rOHD_oUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzowMDowN1rOHD_oUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk1MDI5MQ==", "bodyText": "Extra space at the end ...", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#discussion_r473950291", "createdAt": "2020-08-20T13:00:07Z", "author": {"login": "alesj"}, "path": "app/src/test/java/io/apicurio/registry/RegistrySerdeTest.java", "diffHunk": "@@ -209,6 +210,38 @@ public void testAvro(Supplier<RegistryService> supplier) throws Exception {\n         }\n     }\n \n+    @RegistryServiceTest\n+    public void testAvroJSON(Supplier<RegistryService> supplier) throws Exception {\n+        Schema schema = new Schema.Parser().parse(\"{\\\"type\\\":\\\"record\\\",\\\"name\\\":\\\"myrecord3\\\",\\\"fields\\\":[{\\\"name\\\":\\\"bar\\\",\\\"type\\\":\\\"string\\\"}]}\");\n+        try (AvroKafkaSerializer<GenericData.Record> serializer = new AvroKafkaSerializer<GenericData.Record>(supplier.get());\n+             Deserializer<GenericData.Record> deserializer = new AvroKafkaDeserializer<>(supplier.get())) {\n+            HashMap<String, String> config = new HashMap();\n+            config.put(AvroEncoding.AVRO_ENCODING, AvroEncoding.AVRO_JSON );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTcwODYz", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#pullrequestreview-471570863", "createdAt": "2020-08-20T13:01:32Z", "commit": {"oid": "a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzowMTozMlrOHD_rzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzowMTozMlrOHD_rzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk1MTE4MQ==", "bodyText": "No need for this, it's already set to this", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#discussion_r473951181", "createdAt": "2020-08-20T13:01:32Z", "author": {"login": "alesj"}, "path": "utils/serde/src/main/java/io/apicurio/registry/utils/serde/AvroEncoding.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package io.apicurio.registry.utils.serde;\n+\n+import java.util.Map;\n+\n+public enum AvroEncoding {\n+\n+    BINARY,\n+    JSON;\n+\n+    public static final String AVRO_ENCODING = \"apicurio.avro.encoding\";\n+\n+    public static final String AVRO_JSON = \"JSON\";\n+\n+    public static final String AVRO_BINARY = \"BINARY\";\n+\n+    public static AvroEncoding fromConfig(Map<String, ?> config){\n+        AvroEncoding encoding = AvroEncoding.BINARY;\n+        if(config.containsKey(AVRO_ENCODING)){\n+            try {\n+                encoding = AvroEncoding.valueOf((String) config.get(AVRO_ENCODING));\n+            }\n+            catch (IllegalArgumentException ex){\n+                encoding = AvroEncoding.BINARY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9384781dbacf8c0aabfd6d4867f8eb0b8d58cf9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f195851f8ac505c69b9ed69fb87a8f566c6bec1", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/0f195851f8ac505c69b9ed69fb87a8f566c6bec1", "committedDate": "2020-08-20T13:19:58Z", "message": "Add option for avro json encoding, issue #643\n\nMake changes according to comments\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42c9424d3315e298472db998fc84a4a98aee997f", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/42c9424d3315e298472db998fc84a4a98aee997f", "committedDate": "2020-08-20T13:28:20Z", "message": "Add option for avro json encoding, issue #643\n\nAdd option to encode message using json encoding.\nIncludes an enum ith constants to switch according to\nthe config specified\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f941a0b978fb0583706484bf658cddbf059c8018", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/f941a0b978fb0583706484bf658cddbf059c8018", "committedDate": "2020-08-20T13:28:20Z", "message": "Add option for avro json encoding, issue #643\n\nAdd check in test that msg is encoded as json\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada4fe3752765a902119697c0be4b82244cb0340", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/ada4fe3752765a902119697c0be4b82244cb0340", "committedDate": "2020-08-20T13:34:31Z", "message": "Add option for avro json encoding, issue #643\n\nAdd option to encode message using json encoding.\nIncludes an enum ith constants to switch according to\nthe config specified\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "632e06cc2e133638bb6dc4808880cd0fbeed418b", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/632e06cc2e133638bb6dc4808880cd0fbeed418b", "committedDate": "2020-08-20T13:34:31Z", "message": "Add option for avro json encoding, issue #643\n\nRemove hard coded length on array copy\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610791d4e7810f19273dd5147d7bc3ced412cd8a", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/610791d4e7810f19273dd5147d7bc3ced412cd8a", "committedDate": "2020-08-20T13:34:31Z", "message": "Add option for avro json encoding, issue #643\n\nMake changes according to comments\n\nSigned-off-by: A. Garrard <GARRARD@uk.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5228d39c61194c7f01387d0a40776e1533debac4", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/5228d39c61194c7f01387d0a40776e1533debac4", "committedDate": "2020-08-20T13:35:04Z", "message": "Merge branch 'master' of https://github.com/tagarr/apicurio-registry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9061bc81010516964c1e9104c308d6ab5193b0e", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/e9061bc81010516964c1e9104c308d6ab5193b0e", "committedDate": "2020-08-21T12:55:07Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de51fa71ddc5b027f68a1758ae62c020d7d644f4", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/de51fa71ddc5b027f68a1758ae62c020d7d644f4", "committedDate": "2020-08-21T16:17:57Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f107a73fb20ea06ae3560d5495c7e1aa73721b4d", "author": {"user": {"login": "EricWittmann", "name": "Eric Wittmann"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/f107a73fb20ea06ae3560d5495c7e1aa73721b4d", "committedDate": "2020-08-21T20:20:13Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1119fba95031bb24c96608ef8a27d92cc2aa98ad", "author": {"user": {"login": "tagarr", "name": "Tony Garrard"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/1119fba95031bb24c96608ef8a27d92cc2aa98ad", "committedDate": "2020-08-24T15:34:22Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNjc3NTg3", "url": "https://github.com/Apicurio/apicurio-registry/pull/774#pullrequestreview-473677587", "createdAt": "2020-08-24T16:47:12Z", "commit": {"oid": "1119fba95031bb24c96608ef8a27d92cc2aa98ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4489, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}