{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MTQ1Njcy", "number": 942, "title": "Log deprecated artifacts usage", "bodyText": "", "createdAt": "2020-10-22T09:22:44Z", "url": "https://github.com/Apicurio/apicurio-registry/pull/942", "merged": true, "mergeCommit": {"oid": "39abae6af45d74acd6c77f15e262130b5dc27ff0"}, "closed": true, "closedAt": "2020-10-22T13:51:11Z", "author": {"login": "carlesarnal"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdU-ap-gH2gAyNTA4MTQ1NjcyOjBkNDM5ZTdmNDFkNTdhZDVjZjFjOTA4YzY3Y2EyNzhmY2RkMjhlNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVCTwXAFqTUxNDc0ODQ2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d439e7f41d57ad5cf1c908c67ca278fcdd28e57", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/0d439e7f41d57ad5cf1c908c67ca278fcdd28e57", "committedDate": "2020-10-22T09:18:57Z", "message": "Log deprecated artifacts usage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjM0MjA0", "url": "https://github.com/Apicurio/apicurio-registry/pull/942#pullrequestreview-514634204", "createdAt": "2020-10-22T11:42:47Z", "commit": {"oid": "0d439e7f41d57ad5cf1c908c67ca278fcdd28e57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTo0Mjo0OFrOHmdnfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTo0NToxMVrOHmds7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5MzE4MA==", "bodyText": "It's probably good enough to check for the presence of the header, but just to be sure you check to make sure the value is \"true\"?  The HeadersHack class sets the header value to true.", "url": "https://github.com/Apicurio/apicurio-registry/pull/942#discussion_r510093180", "createdAt": "2020-10-22T11:42:48Z", "author": {"login": "EricWittmann"}, "path": "rest-client/src/main/java/io/apicurio/registry/client/request/RequestHandler.java", "diffHunk": "@@ -59,5 +64,21 @@ private void handleError(Throwable e) {\n             }\n             logger.log(Level.SEVERE, \"Error getting call result\", e);\n         }\n+\n+\n+        private static void checkIfDeprecated(okhttp3.Headers headers) {\n+            String isDeprecated = headers.get(Headers.DEPRECATED);\n+            if (isDeprecated != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d439e7f41d57ad5cf1c908c67ca278fcdd28e57"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NDI4Nw==", "bodyText": "The stateSupplier stuff is not really needed here, right?  This can just be a logDeprecated method like this:\nprivate static void logDeprecated(String artifactId, Object version) {\n    logger.warning(String.format(\"Artifact %s [%s] is deprecated\", artifactId, version));\n}", "url": "https://github.com/Apicurio/apicurio-registry/pull/942#discussion_r510094287", "createdAt": "2020-10-22T11:44:43Z", "author": {"login": "EricWittmann"}, "path": "rest-client/src/main/java/io/apicurio/registry/client/request/RequestHandler.java", "diffHunk": "@@ -59,5 +64,21 @@ private void handleError(Throwable e) {\n             }\n             logger.log(Level.SEVERE, \"Error getting call result\", e);\n         }\n+\n+\n+        private static void checkIfDeprecated(okhttp3.Headers headers) {\n+            String isDeprecated = headers.get(Headers.DEPRECATED);\n+            if (isDeprecated != null) {\n+                String id = headers.get(Headers.ARTIFACT_ID);\n+                String version = headers.get(Headers.VERSION);\n+                logIfDeprecated(() -> ArtifactState.DEPRECATED, id, version);\n+            }\n+        }\n+\n+        private static void logIfDeprecated(Supplier<ArtifactState> stateSupplier, String artifactId, Object version) {\n+            if (stateSupplier.get() == ArtifactState.DEPRECATED) {\n+                logger.warning(String.format(\"Artifact %s [%s] is deprecated\", artifactId, version));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d439e7f41d57ad5cf1c908c67ca278fcdd28e57"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NDU3NA==", "bodyText": "Unless this method is intended to be used in other ways.", "url": "https://github.com/Apicurio/apicurio-registry/pull/942#discussion_r510094574", "createdAt": "2020-10-22T11:45:11Z", "author": {"login": "EricWittmann"}, "path": "rest-client/src/main/java/io/apicurio/registry/client/request/RequestHandler.java", "diffHunk": "@@ -59,5 +64,21 @@ private void handleError(Throwable e) {\n             }\n             logger.log(Level.SEVERE, \"Error getting call result\", e);\n         }\n+\n+\n+        private static void checkIfDeprecated(okhttp3.Headers headers) {\n+            String isDeprecated = headers.get(Headers.DEPRECATED);\n+            if (isDeprecated != null) {\n+                String id = headers.get(Headers.ARTIFACT_ID);\n+                String version = headers.get(Headers.VERSION);\n+                logIfDeprecated(() -> ArtifactState.DEPRECATED, id, version);\n+            }\n+        }\n+\n+        private static void logIfDeprecated(Supplier<ArtifactState> stateSupplier, String artifactId, Object version) {\n+            if (stateSupplier.get() == ArtifactState.DEPRECATED) {\n+                logger.warning(String.format(\"Artifact %s [%s] is deprecated\", artifactId, version));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NDI4Nw=="}, "originalCommit": {"oid": "0d439e7f41d57ad5cf1c908c67ca278fcdd28e57"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52aec273112ef88b1520b9348617387eb712cce2", "author": {"user": {"login": "carlesarnal", "name": "Carles Arnal"}}, "url": "https://github.com/Apicurio/apicurio-registry/commit/52aec273112ef88b1520b9348617387eb712cce2", "committedDate": "2020-10-22T12:39:04Z", "message": "Simplify deprecated check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NzQ4NDYz", "url": "https://github.com/Apicurio/apicurio-registry/pull/942#pullrequestreview-514748463", "createdAt": "2020-10-22T13:51:02Z", "commit": {"oid": "52aec273112ef88b1520b9348617387eb712cce2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4327, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}