{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDU2NTc3", "number": 390, "title": "adds PyList support to ForTag", "bodyText": "Fixes #321\nThis pull request is wrt the above-mentioned Issue.\nThe support for For-Tag was limited to Maps and the else block in ForTag.java file could not handle tuples(list of tuples) types. This PR adds the needed code as well as the supporting tests.\nCheers!", "createdAt": "2020-01-21T18:51:38Z", "url": "https://github.com/HubSpot/jinjava/pull/390", "merged": true, "mergeCommit": {"oid": "4661af3f34e4cffc1f85d09829f089b807c172ab"}, "closed": true, "closedAt": "2020-01-27T16:46:43Z", "author": {"login": "gabru-md"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8lejtgH2gAyMzY1NDU2NTc3OmMxNjZjODgxYzYwMWJkNGViYjIzNTdjYTU3Y2FlOTAzMWY2ZDMxNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-ffJtgH2gAyMzY1NDU2NTc3Ojc4YTAyMjZiNDdmMDEwMzQ0Yzg4NGIyYjY2ODI1NjFlMTk3MTc3ODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147", "author": {"user": {"login": "gabru-md", "name": "Manish Devgan"}}, "url": "https://github.com/HubSpot/jinjava/commit/c166c881c601bd4ebb2357ca57cae9031f6d3147", "committedDate": "2020-01-21T18:30:15Z", "message": "adds PyList support to ForTag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjM4NzI4", "url": "https://github.com/HubSpot/jinjava/pull/390#pullrequestreview-346238728", "createdAt": "2020-01-21T22:33:16Z", "commit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjozMzoxNlrOFgLDHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjozOToyNVrOFgLMrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTc3NA==", "bodyText": "any reason for running this through the escape filter (e) here?", "url": "https://github.com/HubSpot/jinjava/pull/390#discussion_r369279774", "createdAt": "2020-01-21T22:33:16Z", "author": {"login": "boulter"}, "path": "src/test/java/com/hubspot/jinjava/lib/tag/ForTagTest.java", "diffHunk": "@@ -205,6 +205,27 @@ public void testForLoopWithDates() {\n     assertEquals(new PyishDate(testDate).toString(), rendered);\n   }\n \n+  @Test\n+  public void testTuplesWithPyList() {\n+\t  String template = \"{% for href, caption in [('index.html', 'Index'), ('downloads.html', 'Downloads'), ('products.html', 'Products')] %}\" + \n+\t  \t\t\"<li><a href=\\\"{{href|e}}\\\">{{caption|e}}</a></li>\\n\" + ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTk4OQ==", "bodyText": "this could be broken out into a separate test", "url": "https://github.com/HubSpot/jinjava/pull/390#discussion_r369279989", "createdAt": "2020-01-21T22:33:50Z", "author": {"login": "boulter"}, "path": "src/test/java/com/hubspot/jinjava/lib/tag/ForTagTest.java", "diffHunk": "@@ -205,6 +205,27 @@ public void testForLoopWithDates() {\n     assertEquals(new PyishDate(testDate).toString(), rendered);\n   }\n \n+  @Test\n+  public void testTuplesWithPyList() {\n+\t  String template = \"{% for href, caption in [('index.html', 'Index'), ('downloads.html', 'Downloads'), ('products.html', 'Products')] %}\" + \n+\t  \t\t\"<li><a href=\\\"{{href|e}}\\\">{{caption|e}}</a></li>\\n\" + \n+\t  \t\t\"{% endfor %}\";\n+\t  String expected = \"<li><a href=\\\"index.html\\\">Index</a></li>\\n\" +\n+\t  \t\t\"<li><a href=\\\"downloads.html\\\">Downloads</a></li>\\n\" +\n+\t  \t\t\"<li><a href=\\\"products.html\\\">Products</a></li>\\n\";\n+\t  \n+\t  String rendered = jinjava.render(template, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4MDUxOA==", "bodyText": "could you also add a test that confirms that this works for non-string values? Perhaps add 1 + 2 + 3?", "url": "https://github.com/HubSpot/jinjava/pull/390#discussion_r369280518", "createdAt": "2020-01-21T22:35:09Z", "author": {"login": "boulter"}, "path": "src/test/java/com/hubspot/jinjava/lib/tag/ForTagTest.java", "diffHunk": "@@ -205,6 +205,27 @@ public void testForLoopWithDates() {\n     assertEquals(new PyishDate(testDate).toString(), rendered);\n   }\n \n+  @Test\n+  public void testTuplesWithPyList() {\n+\t  String template = \"{% for href, caption in [('index.html', 'Index'), ('downloads.html', 'Downloads'), ('products.html', 'Products')] %}\" + \n+\t  \t\t\"<li><a href=\\\"{{href|e}}\\\">{{caption|e}}</a></li>\\n\" + \n+\t  \t\t\"{% endfor %}\";\n+\t  String expected = \"<li><a href=\\\"index.html\\\">Index</a></li>\\n\" +\n+\t  \t\t\"<li><a href=\\\"downloads.html\\\">Downloads</a></li>\\n\" +\n+\t  \t\t\"<li><a href=\\\"products.html\\\">Products</a></li>\\n\";\n+\t  \n+\t  String rendered = jinjava.render(template, context);\n+\t  assertEquals(rendered, expected);\n+\t  \n+\t  template = \"{% for a, b, c in [(1,2,3), (4,5,6)] %}\"\n+\t  \t\t+ \"<p>{{a}} {{b}} {{c}}</p>\\n\"\n+\t  \t\t+ \"{% endfor %}\";\n+\t  expected = \"<p>1 2 3</p>\\n\"\n+\t  \t\t+ \"<p>4 5 6</p>\\n\";\n+\t  rendered = jinjava.render(template, context);\n+\t  assertEquals(rendered, expected);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4MjIyMA==", "bodyText": "can you add a test for this case?", "url": "https://github.com/HubSpot/jinjava/pull/390#discussion_r369282220", "createdAt": "2020-01-21T22:39:25Z", "author": {"login": "boulter"}, "path": "src/main/java/com/hubspot/jinjava/lib/tag/ForTag.java", "diffHunk": "@@ -159,6 +162,14 @@ public String interpret(TagNode tagNode, JinjavaInterpreter interpreter) {\n                 entryVal = entry.getValue();\n               }\n \n+              interpreter.getContext().put(loopVar, entryVal);\n+            } else if (List.class.isAssignableFrom(val.getClass())) {\n+              List<Object> entries = ((PyList) val).toList();\n+              String entryVal = null;\n+              // safety check for size\n+              if (entries.size() >= loopVarIndex) {\n+                entryVal = Objects.toString(entries.get(loopVarIndex));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f23d1086a70c0fcf83f1063c4634e50825343dd", "author": {"user": {"login": "gabru-md", "name": "Manish Devgan"}}, "url": "https://github.com/HubSpot/jinjava/commit/9f23d1086a70c0fcf83f1063c4634e50825343dd", "committedDate": "2020-01-22T05:40:16Z", "message": "adds tests for ForTag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NzYzNzAx", "url": "https://github.com/HubSpot/jinjava/pull/390#pullrequestreview-348763701", "createdAt": "2020-01-27T15:45:09Z", "commit": {"oid": "9f23d1086a70c0fcf83f1063c4634e50825343dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTo0NTowOVrOFiHZ2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTo0NTowOVrOFiHZ2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxNzIxMA==", "bodyText": "Ok, can you remove anything that's not relevant to the test then? We don't want to be testing the escape filter here.", "url": "https://github.com/HubSpot/jinjava/pull/390#discussion_r371317210", "createdAt": "2020-01-27T15:45:09Z", "author": {"login": "boulter"}, "path": "src/test/java/com/hubspot/jinjava/lib/tag/ForTagTest.java", "diffHunk": "@@ -205,6 +205,27 @@ public void testForLoopWithDates() {\n     assertEquals(new PyishDate(testDate).toString(), rendered);\n   }\n \n+  @Test\n+  public void testTuplesWithPyList() {\n+\t  String template = \"{% for href, caption in [('index.html', 'Index'), ('downloads.html', 'Downloads'), ('products.html', 'Products')] %}\" + \n+\t  \t\t\"<li><a href=\\\"{{href|e}}\\\">{{caption|e}}</a></li>\\n\" + ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTc3NA=="}, "originalCommit": {"oid": "c166c881c601bd4ebb2357ca57cae9031f6d3147"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a0226b47f010344c884b2b6682561e19717781", "author": {"user": {"login": "gabru-md", "name": "Manish Devgan"}}, "url": "https://github.com/HubSpot/jinjava/commit/78a0226b47f010344c884b2b6682561e19717781", "committedDate": "2020-01-27T16:39:19Z", "message": "removes escape filter from fortag test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1562, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}