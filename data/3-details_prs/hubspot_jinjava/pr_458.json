{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4Njk5NjUy", "number": 458, "title": "Map Json string to Object instead of HashMap", "bodyText": "Resolves #457\nRelated to https://hubspotdev.slack.com/archives/C2YH119N2/p1592854855031000\nThis pr changes jinjava.lib.filter.FromJsonFilter to return a Object instead of a HashMap in order to also support deserializing JSON array strings (see issue).\nNow, we are able to use array JSON strings:\n// template\n{% test = \"[one, two, three]\" | fromjson %}\n{{  test[0] }}\n\n// output\none\n\n/* Before this would raise an InvalidInputException */", "createdAt": "2020-06-23T16:59:09Z", "url": "https://github.com/HubSpot/jinjava/pull/458", "merged": true, "mergeCommit": {"oid": "c52b7f5c1234395d3d8df029d8ce17aeb2a7d78f"}, "closed": true, "closedAt": "2020-06-25T17:47:25Z", "author": {"login": "AlpriElse"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuIUxwAH2gAyNDM4Njk5NjUyOjYxNTdjY2FjNWVjYzcwNjczOWIxZDBjZTFmYjY5MTQxYmVlOTAxM2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuyRBvgFqTQzNzcxNzQ2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6157ccac5ecc706739b1d0ce1fb69141bee9013c", "author": {"user": {"login": "AlpriElse", "name": "Alpri Else"}}, "url": "https://github.com/HubSpot/jinjava/commit/6157ccac5ecc706739b1d0ce1fb69141bee9013c", "committedDate": "2020-06-23T16:48:32Z", "message": "Map Json string to JsonNode instead of HashMap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MDE5ODIz", "url": "https://github.com/HubSpot/jinjava/pull/458#pullrequestreview-436019823", "createdAt": "2020-06-23T17:51:02Z", "commit": {"oid": "6157ccac5ecc706739b1d0ce1fb69141bee9013c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNzo1MTowMlrOGn0N9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNzo1MTowMlrOGn0N9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQwMzE4OQ==", "bodyText": "I think a better option for these tests is to render a jinjava template directly. See https://github.com/HubSpot/jinjava/blob/master/src/test/java/com/hubspot/jinjava/lib/filter/MinusTimeFilterTest.java#L37 as an example. That way we can make sure the API from Jinjava perspective is the same: for example: {% set obj = test|fromjson %} {{ obj.property }}", "url": "https://github.com/HubSpot/jinjava/pull/458#discussion_r444403189", "createdAt": "2020-06-23T17:51:02Z", "author": {"login": "mattcoley"}, "path": "src/test/java/com/hubspot/jinjava/lib/filter/FromJsonFilterTest.java", "diffHunk": "@@ -46,21 +48,73 @@ public void itFailsWhenParameterIsNotString() {\n     filter.filter(nestedJson, interpreter);\n   }\n \n+  @Test\n+  public void itReadsEmptyJsonObjectString() {\n+    JsonNode node = (JsonNode) filter.filter(EMPTY_JSON_OBJECT, interpreter);\n+    assertThat(node.elements().hasNext()).isEqualTo(false);\n+  }\n+\n+  @Test\n+  public void itReadsStringAsObject() {\n+    JsonNode node = (JsonNode) filter.filter(NESTED_JSON, interpreter);\n+\n+    checkNestedJson(node);\n+  }\n+\n   @Test\n   public void itReadsSafeStringAsObject() {\n     SafeString nestedJson = new SafeString(NESTED_JSON);\n-    HashMap<String, Object> node = (HashMap<String, Object>) filter.filter(\n-      nestedJson,\n-      interpreter\n-    );\n-    checkedNestJson(node);\n+    JsonNode node = (JsonNode) filter.filter(nestedJson, interpreter);\n+\n+    checkNestedJson(node);\n   }\n \n-  private void checkedNestJson(HashMap<String, Object> node) {\n-    assertThat(node.get(\"first\")).isEqualTo(Arrays.asList(1, 2, 3));\n+  @Test\n+  public void itReadsEmptyJsonArrayString() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6157ccac5ecc706739b1d0ce1fb69141bee9013c"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7a628a54b84b6cb6ef53b31fa9fcd863683a3bc", "author": {"user": {"login": "AlpriElse", "name": "Alpri Else"}}, "url": "https://github.com/HubSpot/jinjava/commit/d7a628a54b84b6cb6ef53b31fa9fcd863683a3bc", "committedDate": "2020-06-23T20:40:48Z", "message": "Map Json string to Object instead of JsonNode, rewrite tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266e7700c00a7104c9c84b0f26ae20f015bf68bc", "author": {"user": {"login": "AlpriElse", "name": "Alpri Else"}}, "url": "https://github.com/HubSpot/jinjava/commit/266e7700c00a7104c9c84b0f26ae20f015bf68bc", "committedDate": "2020-06-25T14:26:40Z", "message": "Trigger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a7713018a58e459af8458c47303de9f17fc1323", "author": {"user": {"login": "AlpriElse", "name": "Alpri Else"}}, "url": "https://github.com/HubSpot/jinjava/commit/5a7713018a58e459af8458c47303de9f17fc1323", "committedDate": "2020-06-25T16:35:46Z", "message": "Travis: wait for maven"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NjY4OTk0", "url": "https://github.com/HubSpot/jinjava/pull/458#pullrequestreview-437668994", "createdAt": "2020-06-25T16:36:56Z", "commit": {"oid": "5a7713018a58e459af8458c47303de9f17fc1323"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozNjo1NlrOGpC1Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozNjo1NlrOGpC1Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5MTE1NA==", "bodyText": "I've been getting build failures because some packages take a while to install.\nhttps://docs.travis-ci.com/user/common-build-problems/#build-times-out-because-no-output-was-received", "url": "https://github.com/HubSpot/jinjava/pull/458#discussion_r445691154", "createdAt": "2020-06-25T16:36:56Z", "author": {"login": "AlpriElse"}, "path": ".travis.yml", "diffHunk": "@@ -21,6 +21,6 @@ notifications:\n before_install:\n   - pip install --user codecov\n after_success:\n-  - mvn validate -e\n+  - travis_wait mvn validate -e", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a7713018a58e459af8458c47303de9f17fc1323"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzE3NDY2", "url": "https://github.com/HubSpot/jinjava/pull/458#pullrequestreview-437717466", "createdAt": "2020-06-25T17:40:27Z", "commit": {"oid": "5a7713018a58e459af8458c47303de9f17fc1323"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2540, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}