{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2ODgxMjMz", "number": 403, "title": "evalulate variables in dict keys", "bodyText": "While you could previously add variables as elements in list, this was not possible with dict keys.\nSo\n{% set keyName = \"key1\" %}\n{% set test = {keyName: \"value1\"} %}\n{{ test[keyName] }}\n\nwill now return \"value1\"\nThis could have adverse side effects. We were liberally accepting unquoted key names for dicts. Now they will be evaluated.\nThis does work in Jinja 2.11.1 for lists and dicts:\n>>> Template('Hello {% set key = \"key1\" %}{% set d = [key, \"val\"] %}{{ d[0] }}').render()\nu'Hello key1'\n\n>>> Template('Hello {% set d = [key, \"val\"] %}{{ d[0] }}').render(key=\"key1\")\nu'Hello key1'\n\nFor compatibility, key names that evaluate to null (meaning probably undefined) will be treated as strings.\nFixes #379", "createdAt": "2020-02-18T23:05:41Z", "url": "https://github.com/HubSpot/jinjava/pull/403", "merged": true, "mergeCommit": {"oid": "f4dc15af0d4384b4e37812ea98994545975545e6"}, "closed": true, "closedAt": "2020-02-24T18:15:07Z", "author": {"login": "boulter"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFqK_JgH2gAyMzc2ODgxMjMzOjkyYmY5ODliNTM2YzUzYWIxNGY0YjEzZmQ5MTQ1NWI4ZmFlZjNmNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHhkkrAH2gAyMzc2ODgxMjMzOmY1ZDI4NzQ0ZTQ3NTJjOWZkYjJlNWVlNjQ3NzdiOGFkZDVhNGI5ZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "92bf989b536c53ab14f4b13fd91455b8faef3f64", "author": {"user": {"login": "boulter", "name": "Jeff Boulter"}}, "url": "https://github.com/HubSpot/jinjava/commit/92bf989b536c53ab14f4b13fd91455b8faef3f64", "committedDate": "2020-02-18T23:03:43Z", "message": "evalulate variables in dict keys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzQwMDA0", "url": "https://github.com/HubSpot/jinjava/pull/403#pullrequestreview-360740004", "createdAt": "2020-02-18T23:08:21Z", "commit": {"oid": "92bf989b536c53ab14f4b13fd91455b8faef3f64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzowODoyMVrOFrVyaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzowODoyMVrOFrVyaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk5MDA1Ng==", "bodyText": "this just confirms that variables do work in lists.", "url": "https://github.com/HubSpot/jinjava/pull/403#discussion_r380990056", "createdAt": "2020-02-18T23:08:21Z", "author": {"login": "boulter"}, "path": "src/test/java/com/hubspot/jinjava/objects/collections/PyListTest.java", "diffHunk": "@@ -105,4 +105,11 @@ public void itReturnsNegativeOneForMissingObjectForIndexWithinBounds() {\n     assertThat(jinjava.render(\"{% set test = [10, 20, 30, 10, 20, 30] %}\" +\n         \"{{ test.index(999, 1, 5) }}\", Collections.emptyMap())).isEqualTo(\"-1\");\n   }\n+\n+  @Test\n+  public void itInterpretsVariables() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92bf989b536c53ab14f4b13fd91455b8faef3f64"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4233e8d7ea36c37b43dccae3ac1095a19b2f1cd9", "author": {"user": {"login": "boulter", "name": "Jeff Boulter"}}, "url": "https://github.com/HubSpot/jinjava/commit/4233e8d7ea36c37b43dccae3ac1095a19b2f1cd9", "committedDate": "2020-02-18T23:15:57Z", "message": "ignore missing keys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzQzNzQ1", "url": "https://github.com/HubSpot/jinjava/pull/403#pullrequestreview-360743745", "createdAt": "2020-02-18T23:17:51Z", "commit": {"oid": "4233e8d7ea36c37b43dccae3ac1095a19b2f1cd9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoxNzo1MlrOFrV-aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoxNzo1MlrOFrV-aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk5MzEzMQ==", "bodyText": "A possible fallback here to preserve the existing behavior would be to return the identifier name when the key evaluates to null.", "url": "https://github.com/HubSpot/jinjava/pull/403#discussion_r380993131", "createdAt": "2020-02-18T23:17:52Z", "author": {"login": "boulter"}, "path": "src/main/java/com/hubspot/jinjava/el/ext/AstDict.java", "diffHunk": "@@ -33,7 +33,11 @@ public Object eval(Bindings bindings, ELContext context) {\n       if (entry.getKey() instanceof AstString) {\n         key = Objects.toString(entry.getKey().eval(bindings, context));\n       } else if (entry.getKey() instanceof AstIdentifier) {\n-        key = ((AstIdentifier) entry.getKey()).getName();\n+        Object result = entry.getKey().eval(bindings, context);\n+        if (result == null) {\n+          continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4233e8d7ea36c37b43dccae3ac1095a19b2f1cd9"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ed2dfb1544f8e89be5ee96c2a8f0d3273cdf427", "author": {"user": {"login": "boulter", "name": "Jeff Boulter"}}, "url": "https://github.com/HubSpot/jinjava/commit/6ed2dfb1544f8e89be5ee96c2a8f0d3273cdf427", "committedDate": "2020-02-19T15:23:03Z", "message": "literal keys now must be quoted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTgyNDA5", "url": "https://github.com/HubSpot/jinjava/pull/403#pullrequestreview-362182409", "createdAt": "2020-02-20T19:43:07Z", "commit": {"oid": "6ed2dfb1544f8e89be5ee96c2a8f0d3273cdf427"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5d28744e4752c9fdb2e5ee64777b8add5a4b9db", "author": {"user": {"login": "boulter", "name": "Jeff Boulter"}}, "url": "https://github.com/HubSpot/jinjava/commit/f5d28744e4752c9fdb2e5ee64777b8add5a4b9db", "committedDate": "2020-02-24T18:10:22Z", "message": "fall back to previous behavior"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1569, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}