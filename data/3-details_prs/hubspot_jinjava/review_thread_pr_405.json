{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDc3ODAz", "number": 405, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjo0ODo0NlrODj4Uxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjo0ODo0NlrODj4Uxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTQ5NTc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjo0ODo0NlrOFv7pwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDowMjowOVrOFwBQtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg==", "bodyText": "Could it evaluate the supplier but catch any exception and return empty string?", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385804736", "createdAt": "2020-02-28T16:48:46Z", "author": {"login": "mattcoley"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMDcxOQ==", "bodyText": "That is a good question. It depends what the serialization wants. What I wanted here is to get the current state -- no more evaluation. Maybe there is a need to finalize any un-evaluated expression.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385830719", "createdAt": "2020-02-28T17:39:30Z", "author": {"login": "hs-lsong"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzODM2OA==", "bodyText": "LazyExpression was created as a more under-the-hood optimization where we could use it to prevent computing something if it wasn't needed. It would be still useful to compute when debugging information.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385838368", "createdAt": "2020-02-28T17:56:33Z", "author": {"login": "mattcoley"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg0MDI4Mw==", "bodyText": "When debugging, you either just use the toString(), and/or with get() to evaluate it.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385840283", "createdAt": "2020-02-28T18:00:27Z", "author": {"login": "hs-lsong"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3MTI5MQ==", "bodyText": "I am talking from the developer perspective. Developers depend on the developer info button that displays the context.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385871291", "createdAt": "2020-02-28T19:07:58Z", "author": {"login": "mattcoley"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3Nzc2NA==", "bodyText": "How does it work now? It will throw exceptions for serialization. If it is not using the json serialization, it does not affect anything.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385877764", "createdAt": "2020-02-28T19:22:21Z", "author": {"login": "hs-lsong"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4OTA5Ng==", "bodyText": "I think the serialization breaks if the get() method throws an exception (in the case of the NPE). We should also at least fall back on the image property.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385889096", "createdAt": "2020-02-28T19:47:57Z", "author": {"login": "mattcoley"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg5NjYyOQ==", "bodyText": "I assume when we store the lazyExpression in somewhere, we assume to store the value, only when we need it. However, the serialization should not execute the function because it may have side effect -- which may cause concurrent modification exception. I thought the image is the expression itself. I think they should be evaluate to empty, but I am OK if you change to keep it.", "url": "https://github.com/HubSpot/jinjava/pull/405#discussion_r385896629", "createdAt": "2020-02-28T20:02:09Z", "author": {"login": "hs-lsong"}, "path": "src/main/java/com/hubspot/jinjava/interpret/LazyExpression.java", "diffHunk": "@@ -19,13 +19,20 @@ public static LazyExpression of(Supplier supplier, String image) {\n   }\n \n   @Override\n-  @JsonValue\n   public Object get() {\n-    return supplier.get();\n+    if (jsonValue == null) {\n+      jsonValue = supplier.get();\n+    }\n+    return jsonValue;\n   }\n \n   @Override\n   public String toString() {\n     return image;\n   }\n+\n+  @JsonValue\n+  public Object getJsonValue() {\n+    return jsonValue == null ? \"\" : jsonValue;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgwNDczNg=="}, "originalCommit": {"oid": "7c7337469679f47bfcaa65a20753fe9eca939949"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1758, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}