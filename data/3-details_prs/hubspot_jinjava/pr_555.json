{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNTE2NDg3", "number": 555, "title": "Limit eager length", "bodyText": "Based on the suggestion from @Joeoh here: #554 (comment)\nHaving the LengthLimitingStringBuilder is useful to prevent code explosion when doing eager execution which could result in very large output. Using this will catch nodes that are creating too much output and defer them rather than continuing with their eager execution. This PR also introduces a StringJoiner wrapper called LengthLimitingStringJoiner which functions like the string builder, but allows for a delimiter to be specified.\nThis approach allows the overriding subclasses to have the flexibility to use the length limiters on some or all of their output. By default, the entire output is limited, as well as the tag image reconstruction, and the set tag pre-pending. If any are too large, then eager execution will quit and the node will be marked and handles as a deferred node via handleDeferredNode(). (This happens when the DeferredValueException is thrown but not caught within the decorator)\nIn the future, this may be substituted or supplemented with a check on the overall output size of the render from eager execution.", "createdAt": "2020-12-01T19:15:37Z", "url": "https://github.com/HubSpot/jinjava/pull/555", "merged": true, "mergeCommit": {"oid": "84745f554421a085fec3d731caf930c2366c61a9"}, "closed": true, "closedAt": "2020-12-03T19:20:05Z", "author": {"login": "jasmith-hs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh8pFfgH2gAyNTMwNTE2NDg3OjI1MDU0NTJiMmRlOGZmODM5ZGE5MGY2MjQ1ODhkNGZlYWIwMWU3MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdikos7AFqTU0NDA1MzUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2505452b2de8ff839da90f624588d4feab01e713", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/2505452b2de8ff839da90f624588d4feab01e713", "committedDate": "2020-12-01T16:35:55Z", "message": "Add length limiting for eager execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5f95a29df33913984e43d54858e2cb8ae3791b", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/ce5f95a29df33913984e43d54858e2cb8ae3791b", "committedDate": "2020-12-01T16:45:43Z", "message": "Don't limit in renderChildren as that is easily legitimately long"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2484ae519ef144fa81f49fa6af8af52a7a6cb64", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/b2484ae519ef144fa81f49fa6af8af52a7a6cb64", "committedDate": "2020-12-01T17:21:35Z", "message": "Add length limiting string joiner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69064329d91cf36315f410ee4cbe0244d4e2a1bb", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/69064329d91cf36315f410ee4cbe0244d4e2a1bb", "committedDate": "2020-12-01T19:10:02Z", "message": "Add more length limiting tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyOTYxNjIy", "url": "https://github.com/HubSpot/jinjava/pull/555#pullrequestreview-542961622", "createdAt": "2020-12-02T15:36:33Z", "commit": {"oid": "69064329d91cf36315f410ee4cbe0244d4e2a1bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNTozNjozM1rOH9g3Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNTozNjozM1rOH9g3Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI2MzU2Nw==", "bodyText": "Should you be using e or e1 here?", "url": "https://github.com/HubSpot/jinjava/pull/555#discussion_r534263567", "createdAt": "2020-12-02T15:36:33Z", "author": {"login": "boulter"}, "path": "src/main/java/com/hubspot/jinjava/lib/tag/eager/EagerTagDecorator.java", "diffHunk": "@@ -51,7 +55,17 @@ public String interpret(TagNode tagNode, JinjavaInterpreter interpreter) {\n     try {\n       return tag.interpret(tagNode, interpreter);\n     } catch (DeferredValueException | TemplateSyntaxException e) {\n-      return wrapInAutoEscapeIfNeeded(eagerInterpret(tagNode, interpreter), interpreter);\n+      try {\n+        return wrapInAutoEscapeIfNeeded(\n+          eagerInterpret(tagNode, interpreter),\n+          interpreter\n+        );\n+      } catch (OutputTooBigException e1) {\n+        interpreter.addError(TemplateError.fromOutputTooBigException(e));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69064329d91cf36315f410ee4cbe0244d4e2a1bb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3097aa7eabba4378d8331a15dd60a95b78722744", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/3097aa7eabba4378d8331a15dd60a95b78722744", "committedDate": "2020-12-02T15:54:51Z", "message": "Add template error from correct exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDUzNTI3", "url": "https://github.com/HubSpot/jinjava/pull/555#pullrequestreview-544053527", "createdAt": "2020-12-03T15:11:42Z", "commit": {"oid": "3097aa7eabba4378d8331a15dd60a95b78722744"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2490, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}