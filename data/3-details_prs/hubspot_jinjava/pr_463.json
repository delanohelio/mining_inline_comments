{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MDEzNTY5", "number": 463, "title": "log error on parent loop", "bodyText": "Still not really sure how this could happen but we've been encountering it. This code runs up the parent tree and logs an error if a parent loop is found.", "createdAt": "2020-07-09T18:05:55Z", "url": "https://github.com/HubSpot/jinjava/pull/463", "merged": true, "mergeCommit": {"oid": "f6dfff5ca736497eae0df279726b7f7fe1fe2920"}, "closed": true, "closedAt": "2020-07-13T19:18:57Z", "author": {"login": "kacperadach"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczTATkgH2gAyNDQ3MDEzNTY5OmE4N2QwNmJkY2Y4OWQ5YTRiYzUzZjhkOGE3NGM4NWFjZDJmNzkyZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0iQcwgH2gAyNDQ3MDEzNTY5OjhmYTg4MDllYjc3ZmFlMmMwZmY3YTUxZTZjZDNiOGVjZjIwYTgyZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe", "author": {"user": null}, "url": "https://github.com/HubSpot/jinjava/commit/a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe", "committedDate": "2020-07-09T18:04:45Z", "message": "log error on parent loop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODkzMDIz", "url": "https://github.com/HubSpot/jinjava/pull/463#pullrequestreview-445893023", "createdAt": "2020-07-09T19:06:55Z", "commit": {"oid": "a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxOTowNjo1NVrOGveLZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxOTowNjo1NVrOGveLZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzMDY5NQ==", "bodyText": "I think you only need to check new parent against the existing parents, right? If we're running this every time a new ScopeMap is created, it will get them all.", "url": "https://github.com/HubSpot/jinjava/pull/463#discussion_r452430695", "createdAt": "2020-07-09T19:06:55Z", "author": {"login": "boulter"}, "path": "src/main/java/com/hubspot/jinjava/util/ScopeMap.java", "diffHunk": "@@ -19,6 +25,23 @@ public ScopeMap() {\n   public ScopeMap(ScopeMap<K, V> parent) {\n     this.scope = new HashMap<K, V>();\n     this.parent = parent;\n+\n+    Set<ScopeMap<K, V>> parents = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NDIwNDkw", "url": "https://github.com/HubSpot/jinjava/pull/463#pullrequestreview-446420490", "createdAt": "2020-07-10T13:54:12Z", "commit": {"oid": "a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzo1NDoxMlrOGv4SKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMzo1NDoxMlrOGv4SKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1ODQxMA==", "bodyText": "I see we use ENGINE_LOG everywhere else in jinjava, should we keep using that?", "url": "https://github.com/HubSpot/jinjava/pull/463#discussion_r452858410", "createdAt": "2020-07-10T13:54:12Z", "author": {"login": "hs-lsong"}, "path": "src/main/java/com/hubspot/jinjava/util/ScopeMap.java", "diffHunk": "@@ -2,13 +2,19 @@\n \n import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.Collection;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.Map;\n import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public class ScopeMap<K, V> implements Map<K, V> {\n+  private static final Logger LOG = LoggerFactory.getLogger(ScopeMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87d06bdcf89d9a4bc53f8d8a74c85acd2f792fe"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ff418d24cc3a19690dc1aef3f5aa0648866b83", "author": {"user": null}, "url": "https://github.com/HubSpot/jinjava/commit/13ff418d24cc3a19690dc1aef3f5aa0648866b83", "committedDate": "2020-07-10T14:17:52Z", "message": "use ENGINE_LOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fa8809eb77fae2c0ff7a51e6cd3b8ecf20a82ed", "author": {"user": null}, "url": "https://github.com/HubSpot/jinjava/commit/8fa8809eb77fae2c0ff7a51e6cd3b8ecf20a82ed", "committedDate": "2020-07-13T14:24:53Z", "message": "only check if current parent is in parent tree"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1528, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}