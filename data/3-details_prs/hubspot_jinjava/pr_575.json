{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0OTQ4OTU1", "number": 575, "title": "Replicate handling of non-existent variables in ChunkResolver", "bodyText": "This PR addresses 2 bugs in the ChunkResolver:\n\nAn even number of slashes followed by a quote character would be interpreted as an escaped quote when it shouldn't be escaped\nIn Jinjava, when an unknown variable is used in an expression node, the result is an empty string:\nSomething {{ nonexistent }}! -> Something ! So match this functionality with the ChunkResolver, as it previously would just output the variable name\n\nChunkResolver is currently just used within Eager Execution so the scope of this bug is essentially nothing.", "createdAt": "2020-12-23T17:22:19Z", "url": "https://github.com/HubSpot/jinjava/pull/575", "merged": true, "mergeCommit": {"oid": "fc136638c7422db6d796352ed716fb919ccaa149"}, "closed": true, "closedAt": "2020-12-23T17:27:47Z", "author": {"login": "jasmith-hs"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpCFxtgH2gAyNTQ0OTQ4OTU1OjEyYWY5NTJjNThkNTM1Njg1MmIyYTRjM2Y2N2U4YTM1NjhlNmNkNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpCiMEgFqTU1ODEzMzQ3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "12af952c58d5356852b2a4c3f67e8a3568e6cd58", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/12af952c58d5356852b2a4c3f67e8a3568e6cd58", "committedDate": "2020-12-23T16:54:15Z", "message": "Cancel out even number of backslashes for escaping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8fac7e00910d43977a83539a8b2b6263cd86f7f", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/a8fac7e00910d43977a83539a8b2b6263cd86f7f", "committedDate": "2020-12-23T17:07:45Z", "message": "Handle unknown variables like the rest of Jinjava in chunk resolver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f5338bc1bd92a71bd9fceb5c450a0312de8e885", "author": {"user": {"login": "jasmith-hs", "name": "Jack Smith"}}, "url": "https://github.com/HubSpot/jinjava/commit/5f5338bc1bd92a71bd9fceb5c450a0312de8e885", "committedDate": "2020-12-23T17:14:54Z", "message": "Add test for cancelling backslashes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTMzNDcx", "url": "https://github.com/HubSpot/jinjava/pull/575#pullrequestreview-558133471", "createdAt": "2020-12-23T17:25:16Z", "commit": {"oid": "5f5338bc1bd92a71bd9fceb5c450a0312de8e885"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzoyNToxN1rOIKraQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzoyNToxN1rOIKraQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA2NzkwNQ==", "bodyText": "Here it's just set to the null character as prevChar is only used to check escaping. So setting it to the null character simply ignores the slash for escaping purposes, allowing any number of slashes to be back-to-back.", "url": "https://github.com/HubSpot/jinjava/pull/575#discussion_r548067905", "createdAt": "2020-12-23T17:25:17Z", "author": {"login": "jasmith-hs"}, "path": "src/main/java/com/hubspot/jinjava/util/ChunkResolver.java", "diffHunk": "@@ -182,14 +184,23 @@ public String resolveChunks() {\n         }\n         continue;\n       }\n-      prevChar = c;\n+      setPrevChar(c);\n       tokenBuilder.append(c);\n     }\n     miniChunkBuilder.append(resolveToken(tokenBuilder.toString()));\n     chunks.add(resolveChunk(miniChunkBuilder.toString()));\n     return chunks;\n   }\n \n+  private void setPrevChar(char c) {\n+    if (c == '\\\\' && prevChar == '\\\\') {\n+      // Backslashes cancel each other out for escaping when there's an even number.\n+      prevChar = '\\0';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f5338bc1bd92a71bd9fceb5c450a0312de8e885"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2504, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}