{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MjI3NDcy", "number": 495, "title": "Simplify PR.Close() logic", "bodyText": "From earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "createdAt": "2020-04-20T18:29:05Z", "url": "https://github.com/dogtagpki/jss/pull/495", "merged": true, "mergeCommit": {"oid": "edfdbb545c9e2d8921b9c30c7f2a83b7ffa0fe97"}, "closed": true, "closedAt": "2020-04-22T01:44:05Z", "author": {"login": "cipherboy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZjkdCgBqjMyNTMwNzU5MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZzyAXABqjMyNTYyNTg5NTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5d95c91b2c591a791ead4dc5e7d8e0c8cec24c5", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/d5d95c91b2c591a791ead4dc5e7d8e0c8cec24c5", "committedDate": "2020-04-20T18:23:17Z", "message": "Simplify PR.Close() logic\n\nFrom earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "8e437161783cc989df7859ebb3f06da6dd85d3ff", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/8e437161783cc989df7859ebb3f06da6dd85d3ff", "committedDate": "2020-04-20T18:37:14Z", "message": "Simplify PR.Close() logic\n\nFrom earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2ODY4NDg2", "url": "https://github.com/dogtagpki/jss/pull/495#pullrequestreview-396868486", "createdAt": "2020-04-20T22:56:01Z", "commit": {"oid": "8e437161783cc989df7859ebb3f06da6dd85d3ff"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMjo1NjowMlrOGIq_Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMjo1OTowMlrOGIrEJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc0NjA4Mg==", "bodyText": "This probably can be simplified into:\nreturn Close(fd, false);", "url": "https://github.com/dogtagpki/jss/pull/495#discussion_r411746082", "createdAt": "2020-04-20T22:56:02Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/nss/PR.java", "diffHunk": "@@ -88,18 +92,14 @@ public static int Close(PRFDProxy fd) {\n      *           org.mozilla.jss.nss.SSLFDProxy.releaseNativeResources\n      */\n     public synchronized static int Close(SSLFDProxy fd) throws Exception {\n-        if (fd.isNull()) {\n+        if (fd == null || fd.isNull()) {\n             return SUCCESS;\n         }\n \n-        SSL.RemoveCallbacks(fd);\n-\n         // Because a SSLFDProxy instance needs to free other native resources,\n         // we can't release the pointer here. Instead, let NativeProxy.close()\n         // handle clearing the PRFileDesc pointer.\n-        int ret = PR.Close((PRFDProxy) fd, false);\n-        fd.close();\n-        return ret;\n+        return PR.Close((PRFDProxy) fd, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e437161783cc989df7859ebb3f06da6dd85d3ff"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc0NzM2Ng==", "bodyText": "The PR class still has a reference on SSLFDProxy. I think ideally NSPR classes should not deal with SSL.", "url": "https://github.com/dogtagpki/jss/pull/495#discussion_r411747366", "createdAt": "2020-04-20T22:59:02Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/nss/PR.java", "diffHunk": "@@ -88,18 +92,14 @@ public static int Close(PRFDProxy fd) {\n      *           org.mozilla.jss.nss.SSLFDProxy.releaseNativeResources\n      */\n     public synchronized static int Close(SSLFDProxy fd) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e437161783cc989df7859ebb3f06da6dd85d3ff"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a72f6c7b001b6984a75f9340ee8ca4f500d71a98", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/a72f6c7b001b6984a75f9340ee8ca4f500d71a98", "committedDate": "2020-04-21T13:33:17Z", "message": "Simplify PR.Close() logic\n\nFrom earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e437161783cc989df7859ebb3f06da6dd85d3ff", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/8e437161783cc989df7859ebb3f06da6dd85d3ff", "committedDate": "2020-04-20T18:37:14Z", "message": "Simplify PR.Close() logic\n\nFrom earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "a72f6c7b001b6984a75f9340ee8ca4f500d71a98", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/a72f6c7b001b6984a75f9340ee8ca4f500d71a98", "committedDate": "2020-04-21T13:33:17Z", "message": "Simplify PR.Close() logic\n\nFrom earlier discussions on memory management, we should isolate the\nconcerns of the NSPR layer from having to deal with SSL FD specific\nstuff as much as possible. Move what used to be in the SSLFD-specific\nNSPR close layer to SSLEngine itself.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1480, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}