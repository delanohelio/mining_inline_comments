{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTM1NjIy", "number": 473, "title": "Improve Memory Management", "bodyText": "This is built on top of #472.\nThere are a few new fixes:\n\nPK11Cert, PK11Cipher, PK11Key, PK11MessageDigest, and PK11Signature all now have AutoCloseable for their internal CertProxies.\nFix NativeProxy registry tracking, candidate for backport.\nImprove SSLFDProxy's globalRef access.\nFix handling of NULL pointers in various places.", "createdAt": "2020-04-06T22:19:59Z", "url": "https://github.com/dogtagpki/jss/pull/473", "merged": true, "mergeCommit": {"oid": "0c5f6703ce736782b554665dc6b584313757fb23"}, "closed": true, "closedAt": "2020-04-16T00:06:49Z", "author": {"login": "cipherboy"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVGZtMAFqTM4ODY2MTU3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYBCRVgBqjMyMzc2NjQ3OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjYxNTc1", "url": "https://github.com/dogtagpki/jss/pull/473#pullrequestreview-388661575", "createdAt": "2020-04-06T22:25:59Z", "commit": {"oid": "bf5f7252435f0fdcff8c14e25b3e8779391b13d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjoyNTo1OVrOGBsLpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjoyNTo1OVrOGBsLpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQyNTYzNw==", "bodyText": "Duplicate line.", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r404425637", "createdAt": "2020-04-06T22:25:59Z", "author": {"login": "cipherboy"}, "path": "org/mozilla/jss/util/NativeProxy.java", "diffHunk": "@@ -125,11 +140,13 @@ protected void finalize() throws Throwable {\n      *\n      * See comment in finalize.\n      */\n-    public final void close() throws Exception {\n+    public synchronized final void close() throws Exception {\n         try {\n-            if (registry.remove(this)) {\n+            registry.remove(this);\n+            if (mPointer != null) {\n                 releaseNativeResources();\n             }\n+            registry.remove(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf5f7252435f0fdcff8c14e25b3e8779391b13d6"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjYxNzU3", "url": "https://github.com/dogtagpki/jss/pull/473#pullrequestreview-388661757", "createdAt": "2020-04-06T22:26:22Z", "commit": {"oid": "bf5f7252435f0fdcff8c14e25b3e8779391b13d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjoyNjoyM1rOGBsMNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMjoyNjoyM1rOGBsMNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQyNTc4Mw==", "bodyText": "Noisy diff.", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r404425783", "createdAt": "2020-04-06T22:26:23Z", "author": {"login": "cipherboy"}, "path": "org/mozilla/jss/util/NativeProxy.java", "diffHunk": "@@ -144,15 +161,16 @@ public final void close() throws Exception {\n      *\n      * See also: JSS_clearPtrFromProxy(...) in jssutil.h\n      */\n-    public final void clear() {\n-        this.mPointer = null;\n+    public synchronized final void clear() {\n         registry.remove(this);\n+        this.mPointer = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf5f7252435f0fdcff8c14e25b3e8779391b13d6"}, "originalPosition": 78}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bb7a13af919b5d7103a6d221f972a697c1172c7", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/5bb7a13af919b5d7103a6d221f972a697c1172c7", "committedDate": "2020-04-06T22:16:44Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/8369e97dcf566172bfe42444f7e0eaf80de670bb", "committedDate": "2020-04-06T22:28:39Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Njc5NDAw", "url": "https://github.com/dogtagpki/jss/pull/473#pullrequestreview-388679400", "createdAt": "2020-04-06T23:08:06Z", "commit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzowODowNlrOGBtJoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzoyNjowNVrOGBth8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MTUwNA==", "bodyText": "How about we convert this method into SSLFDProxy.close()?\nclass PRFDProxy extends NativeProxy {\n    public void close() {\n        PR.Close(this); // don't call JSS_clearPtrFromProxy()\n        super.close(); // release native resources\n    }\n}\n\nclass SSLFDProxy extends PRFDProxy {\n    public void close() {\n        if (!fd.isNull()) {\n            SSL.RemoveCallbacks(fd); \n        }\n        super.close();\n    }\n}", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r404441504", "createdAt": "2020-04-06T23:08:06Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/nss/PR.java", "diffHunk": "@@ -66,20 +66,38 @@ public static native PRFDProxy NewBufferPRFD(BufferProxy read_buf,\n                                                  BufferProxy write_buf,\n                                                  byte[] peer_info);\n     /**\n-     * Close an existing PRFDProxy.\n+     * Close an existing PRFDProxy, clearing the pointer if successful.\n      *\n      * See also: PR_Close in /usr/include/nspr4/prio.h\n      */\n-    public static native int Close(PRFDProxy fd);\n+    public static int Close(PRFDProxy fd) {\n+        return Close(fd, true);\n+    }\n+\n+    /**\n+     * Close an existing PRFDProxy with an option to clear the pointer.\n+     *\n+     * See also: PR_Close in /usr/include/nspr4/prio.h\n+     */\n+    public static native int Close(PRFDProxy fd, boolean clear);\n \n     /**\n      * Close an existing SSLFDProxy.\n      *\n      * See also: org.mozilla.jss.nss.PR.Close\n-     *           org.mozilla.jss.nss.SSLFD.releaseNativeResources\n+     *           org.mozilla.jss.nss.SSLFDProxy.releaseNativeResources\n      */\n-    public static int Close(SSLFDProxy fd) throws Exception {\n-        int ret = PR.Close((PRFDProxy) fd);\n+    public synchronized static int Close(SSLFDProxy fd) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MzY1OA==", "bodyText": "It looks like this condition only happens in JSS tests. If there is no real usage where clear == JNI_TRUE we might as well simplify the code to no longer call JSS_clearPtrFromProxy(). See also my other comment about not calling JSS_clearPtrFromProxy().", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r404443658", "createdAt": "2020-04-06T23:14:17Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/nss/PR.c", "diffHunk": "@@ -106,7 +106,7 @@ Java_org_mozilla_jss_nss_PR_Close(JNIEnv *env, jclass clazz, jobject fd)\n     }\n \n     PRStatus ret = PR_Close(real_fd);\n-    if (ret == PR_SUCCESS) {\n+    if (ret == PR_SUCCESS && clear == JNI_TRUE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0NzczMQ==", "bodyText": "We probably can use AtomicInteger:\nstatic AtomicInteger counter = new AtomicInteger();\nint index;\n\nprotected NativeProxy(byte[] pointer, boolean track) {\n    index = counter.getAndIncrement();\n}\npublic int hashCode() {\n    return index;\n}", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r404447731", "createdAt": "2020-04-06T23:26:05Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/util/NativeProxy.java", "diffHunk": "@@ -173,6 +197,21 @@ public final void clear() {\n      * releaseNativeResources() gets called.\n      */\n     static HashSet<NativeProxy> registry = new HashSet<NativeProxy>();\n+    static int registryIndex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb"}, "originalPosition": 105}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8369e97dcf566172bfe42444f7e0eaf80de670bb", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/8369e97dcf566172bfe42444f7e0eaf80de670bb", "committedDate": "2020-04-06T22:28:39Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "4a1057d3cdf7cd7c58e1b551eefa8b1b083cece7", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/4a1057d3cdf7cd7c58e1b551eefa8b1b083cece7", "committedDate": "2020-04-07T13:17:18Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a1057d3cdf7cd7c58e1b551eefa8b1b083cece7", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/4a1057d3cdf7cd7c58e1b551eefa8b1b083cece7", "committedDate": "2020-04-07T13:17:18Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "6b885a914df633d6342c863b32e35c0f9762f3a6", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/6b885a914df633d6342c863b32e35c0f9762f3a6", "committedDate": "2020-04-07T13:21:29Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b885a914df633d6342c863b32e35c0f9762f3a6", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/6b885a914df633d6342c863b32e35c0f9762f3a6", "committedDate": "2020-04-07T13:21:29Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "1c5598c93dd38139609e1bf3760a957757935621", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/1c5598c93dd38139609e1bf3760a957757935621", "committedDate": "2020-04-09T12:06:59Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzM2NzIy", "url": "https://github.com/dogtagpki/jss/pull/473#pullrequestreview-390736722", "createdAt": "2020-04-09T12:13:13Z", "commit": {"oid": "1c5598c93dd38139609e1bf3760a957757935621"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjoxMzoxM1rOGDWELQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjoxMzoxM1rOGDWELQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE2MDQyOQ==", "bodyText": "@edewata  -- I think this might be better and provide more random distribution of mHashCode.", "url": "https://github.com/dogtagpki/jss/pull/473#discussion_r406160429", "createdAt": "2020-04-09T12:13:13Z", "author": {"login": "cipherboy"}, "path": "org/mozilla/jss/util/NativeProxy.java", "diffHunk": "@@ -51,10 +53,13 @@ public NativeProxy(byte[] pointer) {\n      */\n     protected NativeProxy(byte[] pointer, boolean track) {\n         mPointer = pointer;\n+        mHashCode = registryIndex.getAndIncrement();\n+        if (mPointer != null) {\n+            mHashCode = Objects.hash(mHashCode, Arrays.hashCode(mPointer));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c5598c93dd38139609e1bf3760a957757935621"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c5598c93dd38139609e1bf3760a957757935621", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/1c5598c93dd38139609e1bf3760a957757935621", "committedDate": "2020-04-09T12:06:59Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "c8e1c4b41533b6bea743ed48fa9afe50b0740c7f", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/c8e1c4b41533b6bea743ed48fa9afe50b0740c7f", "committedDate": "2020-04-09T14:17:59Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8e1c4b41533b6bea743ed48fa9afe50b0740c7f", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/c8e1c4b41533b6bea743ed48fa9afe50b0740c7f", "committedDate": "2020-04-09T14:17:59Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "2da782288f2d21c1faa8f1fac2d55162c3914afc", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/2da782288f2d21c1faa8f1fac2d55162c3914afc", "committedDate": "2020-04-14T14:47:26Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae96fe7ecfe1720cfc56b6c893132ead76cd3880", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/ae96fe7ecfe1720cfc56b6c893132ead76cd3880", "committedDate": "2020-04-15T14:48:59Z", "message": "Make PK11Cert AutoCloseable\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e4880edc8990bbc4b4ffeaf10bf4eb0ada04000", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/3e4880edc8990bbc4b4ffeaf10bf4eb0ada04000", "committedDate": "2020-04-15T14:49:00Z", "message": "Make PK11Cipher AutoCloseable\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6651a3e2c6f3b5852a4135dccc31db318c4fa6d1", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/6651a3e2c6f3b5852a4135dccc31db318c4fa6d1", "committedDate": "2020-04-15T14:49:00Z", "message": "Make PK11Key AutoCloseable\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32cb00de71e0709bbd74c6eb27e7aa93a84f93a8", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/32cb00de71e0709bbd74c6eb27e7aa93a84f93a8", "committedDate": "2020-04-15T14:49:00Z", "message": "Make PK11MessageDigest AutoCloseable\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fcb9c7bfa9535d6eb2943d9185aaea7db3c121e", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/4fcb9c7bfa9535d6eb2943d9185aaea7db3c121e", "committedDate": "2020-04-15T14:49:00Z", "message": "Make PK11Signature AutoCloseable\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21359dd4178f7491603256a3d9a5e4f0f0c235cb", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/21359dd4178f7491603256a3d9a5e4f0f0c235cb", "committedDate": "2020-04-15T14:49:00Z", "message": "Fix NativeProxy registry tracking\n\nWhen the switch was made to a HashSet-based registry in\neb5df01003d74b57473eacb84e538d31f5bb06ca, NativeProxy didn't override\nhashCode(...). This resulted in calls to close() (and thus, finalize())\nnot invoking the releaseNativeResources() function to release the\nunderlying memory.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea19394c2af3d965463c22803d31cb45a347db4", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/5ea19394c2af3d965463c22803d31cb45a347db4", "committedDate": "2020-04-15T14:49:01Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2da782288f2d21c1faa8f1fac2d55162c3914afc", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/2da782288f2d21c1faa8f1fac2d55162c3914afc", "committedDate": "2020-04-14T14:47:26Z", "message": "Improve SSLFDProxy's globalRef access\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "ee7e17ec7c12716965c1813b7dbbc524e6f4b2bb", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/ee7e17ec7c12716965c1813b7dbbc524e6f4b2bb", "committedDate": "2020-04-15T14:59:16Z", "message": "Handle NULL SigContextProxy pointer\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee7e17ec7c12716965c1813b7dbbc524e6f4b2bb", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/ee7e17ec7c12716965c1813b7dbbc524e6f4b2bb", "committedDate": "2020-04-15T14:59:16Z", "message": "Handle NULL SigContextProxy pointer\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "bd931acc416624b05cfe627ea3feddcb0f4a54a3", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/bd931acc416624b05cfe627ea3feddcb0f4a54a3", "committedDate": "2020-04-15T15:06:45Z", "message": "Handle NULL pointers in releaseNativeResources\n\nIn the style of the previous commit, ensure all pointers are\nnon-NULL before continuing to free them. Some of these are excessive as\nNSS does do some checking, but in this case consistency is better.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156e0e7fe6bf56279eb9ebc0f2ce1031a2e9dc03", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/156e0e7fe6bf56279eb9ebc0f2ce1031a2e9dc03", "committedDate": "2020-04-15T23:40:27Z", "message": "Fix SSLSocketBase/SocketProxy closure\n\nWith NativeProxy now exposing a close method, we can fix the interaction\nbetween SSLSocketBase and its wrapped SocketProxy. Previously,\nSSLSocketBase invoked a native method, socketClose() during its close()\nhandler (which is invoked from SSLSocket.close() and in turn from\nSSLSocket.finalize()). This gives a potential race condition when the\nvalue of mPointer is NULLed between SocketProxy.finalize() and\nSSLSocket.close() / SSLSocket.finalize() -- if the former executes\nbefore the latter, socketClose() would attempt to dereference a NULL\npointer.\n\nFix this in two parts:\n\n 1. Make SocketProxy.releaseNativeResource() actually release native\n    resources by calling JSSL_DestroySocketData(...); at the same time,\n    make closeSocket merely call PR_Close(...).\n 2. Update SSLSocketBase to call SocketProxy.close() explicitly.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f284e3390b0722535505478ce9886f4ee92c6483", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/f284e3390b0722535505478ce9886f4ee92c6483", "committedDate": "2020-04-15T23:40:27Z", "message": "Handle NULL pointers in releaseNativeResources\n\nIn the style of the previous commit, ensure all pointers are\nnon-NULL before continuing to free them. Some of these are excessive as\nNSS does do some checking, but in this case consistency is better.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd931acc416624b05cfe627ea3feddcb0f4a54a3", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/bd931acc416624b05cfe627ea3feddcb0f4a54a3", "committedDate": "2020-04-15T15:06:45Z", "message": "Handle NULL pointers in releaseNativeResources\n\nIn the style of the previous commit, ensure all pointers are\nnon-NULL before continuing to free them. Some of these are excessive as\nNSS does do some checking, but in this case consistency is better.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}, "afterCommit": {"oid": "f284e3390b0722535505478ce9886f4ee92c6483", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/f284e3390b0722535505478ce9886f4ee92c6483", "committedDate": "2020-04-15T23:40:27Z", "message": "Handle NULL pointers in releaseNativeResources\n\nIn the style of the previous commit, ensure all pointers are\nnon-NULL before continuing to free them. Some of these are excessive as\nNSS does do some checking, but in this case consistency is better.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1580, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}