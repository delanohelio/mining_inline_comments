{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODQwMDM5", "number": 361, "title": "Fetch certificate by alias in JSSKeyManager", "bodyText": "Expose functionality of CryptoManager in JSSKeyManager, allowing the\ncaller to fetch a certificate by alias (NSS DB's nickname).\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>\n\nPulled out of #150.", "createdAt": "2020-01-14T21:10:15Z", "url": "https://github.com/dogtagpki/jss/pull/361", "merged": true, "mergeCommit": {"oid": "73ff1b4cb4baab26748f118832c36f3a26ba1e40"}, "closed": true, "closedAt": "2020-01-15T14:17:38Z", "author": {"login": "cipherboy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6Xh9pgH2gAyMzYyODQwMDM5OjYwMmYzNDU0NjhmN2JkNzdlN2JiMGU2NzI1NWZiODhjYTQwZTQ0NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6Z8J0AFqTM0MjkxNTgwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445", "author": {"user": {"login": "cipherboy", "name": "Alexander Scheel"}}, "url": "https://github.com/dogtagpki/jss/commit/602f345468f7bd77e7bb0e67255fb88ca40e4445", "committedDate": "2020-01-14T21:07:27Z", "message": "Fetch certificate by alias in JSSKeyManager\n\nExpose functionality of CryptoManager in JSSKeyManager, allowing the\ncaller to fetch a certificate by alias (NSS DB's nickname).\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODQ4OTIx", "url": "https://github.com/dogtagpki/jss/pull/361#pullrequestreview-342848921", "createdAt": "2020-01-14T21:26:07Z", "commit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMToyNjowOFrOFdmSeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMToyNjowOFrOFdmSeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MDM0NA==", "bodyText": "@edewata Is there a better exception here? The existing KeyManagers doesn't raise any exceptions, and this'll get called fairly early in the SSLEngine initialization (though, in Tomcat, that only happens when the first inbound connection occurs).\nThoughts?", "url": "https://github.com/dogtagpki/jss/pull/361#discussion_r366580344", "createdAt": "2020-01-14T21:26:08Z", "author": {"login": "cipherboy"}, "path": "org/mozilla/jss/provider/javax/crypto/JSSKeyManager.java", "diffHunk": "@@ -69,6 +69,16 @@ public String chooseServerAlias(String keyType, Principal[] issuers, Socket sock\n         return null;  // not implemented\n     }\n \n+    public org.mozilla.jss.crypto.X509Certificate getCertificate(String alias) {\n+        try {\n+            CryptoManager cm = CryptoManager.getInstance();\n+            return cm.findCertByNickname(alias);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage(), e);\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODY0ODIy", "url": "https://github.com/dogtagpki/jss/pull/361#pullrequestreview-342864822", "createdAt": "2020-01-14T21:55:11Z", "commit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTo1NToxMVrOFdnD5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMTo1ODozNVrOFdnJpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU5Mjk5OA==", "bodyText": "I think the RuntimeException is fine. It's consistent with other methods and I don't have any better suggestion.", "url": "https://github.com/dogtagpki/jss/pull/361#discussion_r366592998", "createdAt": "2020-01-14T21:55:11Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/provider/javax/crypto/JSSKeyManager.java", "diffHunk": "@@ -69,6 +69,16 @@ public String chooseServerAlias(String keyType, Principal[] issuers, Socket sock\n         return null;  // not implemented\n     }\n \n+    public org.mozilla.jss.crypto.X509Certificate getCertificate(String alias) {\n+        try {\n+            CryptoManager cm = CryptoManager.getInstance();\n+            return cm.findCertByNickname(alias);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage(), e);\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4MDM0NA=="}, "originalCommit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU5NDQ3MQ==", "bodyText": "I think we should return a java.security.cert.X509Certificate just like getCertificateChain().\nBTW, I just noticed this in lines 96-98:\nif (!(c instanceof PK11Cert)) {\n    logger.error(\"JSSKeyManager: Can't cast to PK11Cert: \" + c);\n}\n\nThis code is only logging an error message, but the actual error will happen later in line 101:\nlist.add((PK11Cert) c);\n\nI think we can just remove lines 96-98 because line 101 will generate another error message.\nIdeally org.mozilla.jss.crypto.X509Certificate should extend java.security.cert.X509Certificate, but that's a separate issue.", "url": "https://github.com/dogtagpki/jss/pull/361#discussion_r366594471", "createdAt": "2020-01-14T21:58:35Z", "author": {"login": "edewata"}, "path": "org/mozilla/jss/provider/javax/crypto/JSSKeyManager.java", "diffHunk": "@@ -69,6 +69,16 @@ public String chooseServerAlias(String keyType, Principal[] issuers, Socket sock\n         return null;  // not implemented\n     }\n \n+    public org.mozilla.jss.crypto.X509Certificate getCertificate(String alias) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTE1ODAz", "url": "https://github.com/dogtagpki/jss/pull/361#pullrequestreview-342915803", "createdAt": "2020-01-14T23:55:52Z", "commit": {"oid": "602f345468f7bd77e7bb0e67255fb88ca40e4445"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1596, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}