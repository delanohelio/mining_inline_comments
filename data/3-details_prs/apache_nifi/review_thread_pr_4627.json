{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNDk4NDkx", "number": 4627, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOTo0OTozNlrOE6vRBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDowMToxMFrOE6vi-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDI3MjY5OnYy", "diffSide": "RIGHT", "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOTo0OTozNlrOH1_Ztw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo1ODoxNlrOH2lkLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3NTM1MQ==", "bodyText": "@tlsmith109 It is best we don't create a new variable for this.  Rather we should use createDirectorExistsValidator() as this is the way it is commonly done to enforce a directory existing.  See [1] and [2]\n[1] https://github.com/apache/nifi/blob/main/nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/GetFile.java#L115\n[2] https://github.com/apache/nifi/blob/main/nifi-nar-bundles/nifi-standard-bundle/nifi-standard-reporting-tasks/src/main/java/org/apache/nifi/controller/MonitorDiskUsage.java#L55", "url": "https://github.com/apache/nifi/pull/4627#discussion_r526375351", "createdAt": "2020-11-18T19:49:36Z", "author": {"login": "NissimShiman"}, "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "diffHunk": "@@ -503,6 +503,7 @@ public ValidationResult validate(final String subject, final String input, final\n     };\n \n     public static final Validator FILE_EXISTS_VALIDATOR = new FileExistsValidator(true);\n+    public static final Validator DIRECTORY_EXISTS_VALIDATOR = new DirectoryExistsValidator(true,false);\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwMDYyMA==", "bodyText": "Will remove, I just added for consistency.", "url": "https://github.com/apache/nifi/pull/4627#discussion_r527000620", "createdAt": "2020-11-19T15:58:16Z", "author": {"login": "tlsmith109"}, "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "diffHunk": "@@ -503,6 +503,7 @@ public ValidationResult validate(final String subject, final String input, final\n     };\n \n     public static final Validator FILE_EXISTS_VALIDATOR = new FileExistsValidator(true);\n+    public static final Validator DIRECTORY_EXISTS_VALIDATOR = new DirectoryExistsValidator(true,false);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3NTM1MQ=="}, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDI5Mjc0OnYy", "diffSide": "RIGHT", "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOTo1NDo0NFrOH1_l2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMDo1MTowOFrOIA6IoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3ODQ1Ng==", "bodyText": "@tlsmith109   I can see why these modifications were made, but it is out of the scope of this ticket.  It is best to open a new ticket specifically for this so the community has visibility into modifying FileExistsValidator to not include directories.", "url": "https://github.com/apache/nifi/pull/4627#discussion_r526378456", "createdAt": "2020-11-18T19:54:44Z", "author": {"login": "NissimShiman"}, "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "diffHunk": "@@ -848,8 +849,8 @@ public ValidationResult validate(final String subject, final String value, final\n             }\n \n             final File file = new File(substituted);\n-            final boolean valid = file.exists();\n-            final String explanation = valid ? null : \"File \" + file + \" does not exist\";\n+            final boolean valid = file.exists() & !file.isDirectory();\n+            final String explanation = valid ? null : \"File \" + file + \" does not exist or is directory\";\n             return new ValidationResult.Builder().subject(subject).input(value).valid(valid).explanation(explanation).build();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI3MDk2Nw==", "bodyText": "After discussions with @tlsmith109, I stand corrected.  This is very much relevant to this ticket.\nMy only question is why the apache nifi community hasn't noticed this sooner.  Maybe they have, but have left it on purpose to make sure everything works with backward compatibility?\n@pvillard31 I noticed when you were working on TailFile in https://issues.apache.org/jira/browse/NIFI-1170 , when wishing to enforce that a filename is not a directory, you chose to check the validation in  customValidate() [1]  as opposed to modifying FileExistsValidator to not validate directories.\nWas this by design to allow FileExistsValidator to validate directories?\n[1] https://github.com/apache/nifi/blob/main/nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/TailFile.java#L288-L293", "url": "https://github.com/apache/nifi/pull/4627#discussion_r527270967", "createdAt": "2020-11-19T23:24:42Z", "author": {"login": "NissimShiman"}, "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "diffHunk": "@@ -848,8 +849,8 @@ public ValidationResult validate(final String subject, final String value, final\n             }\n \n             final File file = new File(substituted);\n-            final boolean valid = file.exists();\n-            final String explanation = valid ? null : \"File \" + file + \" does not exist\";\n+            final boolean valid = file.exists() & !file.isDirectory();\n+            final String explanation = valid ? null : \"File \" + file + \" does not exist or is directory\";\n             return new ValidationResult.Builder().subject(subject).input(value).valid(valid).explanation(explanation).build();\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3ODQ1Ng=="}, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyMzM5Mg==", "bodyText": "@tlsmith See comment from @MikeThomsen [1] \" Any refactored version would have to not change the current default behavior. So, what I'd suggest would be a second constructor that allows you to set a boolean flag to put in a \"file-only\" mode.\"\nI agree with this assessment and recommend this as well for this ticket.\n[1] https://mail-archives.apache.org/mod_mbox/nifi-dev/202011.mbox/browser.\nSubject: Re: FILE_EXISTS_VALIDATOR allows directories as well, is this a feature or a bug?", "url": "https://github.com/apache/nifi/pull/4627#discussion_r537823392", "createdAt": "2020-12-07T20:51:08Z", "author": {"login": "NissimShiman"}, "path": "nifi-commons/nifi-utils/src/main/java/org/apache/nifi/processor/util/StandardValidators.java", "diffHunk": "@@ -848,8 +849,8 @@ public ValidationResult validate(final String subject, final String value, final\n             }\n \n             final File file = new File(substituted);\n-            final boolean valid = file.exists();\n-            final String explanation = valid ? null : \"File \" + file + \" does not exist\";\n+            final boolean valid = file.exists() & !file.isDirectory();\n+            final String explanation = valid ? null : \"File \" + file + \" does not exist or is directory\";\n             return new ValidationResult.Builder().subject(subject).input(value).valid(valid).explanation(explanation).build();\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3ODQ1Ng=="}, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDMxODY1OnYy", "diffSide": "RIGHT", "path": "nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/TailFile.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDowMToxMFrOH1_1fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowODo1NVrOH2mE4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4MjQ2MA==", "bodyText": "@tlsmith109 A new ticket should be opened if we want to modify TailFile as well as the ticket is specific to FetchSFTP\nThat being said, it looks like there is code that already makes sure this is a directory [1].  Although, at first glance I am unsure why this wasn't handled here, as your code is suggesting.\n[1] https://github.com/apache/nifi/blob/main/nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/TailFile.java#L277", "url": "https://github.com/apache/nifi/pull/4627#discussion_r526382460", "createdAt": "2020-11-18T20:01:10Z", "author": {"login": "NissimShiman"}, "path": "nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/TailFile.java", "diffHunk": "@@ -131,7 +131,7 @@\n             .displayName(\"Base directory\")\n             .description(\"Base directory used to look for files to tail. This property is required when using Multifile mode.\")\n             .expressionLanguageSupported(ExpressionLanguageScope.VARIABLE_REGISTRY)\n-            .addValidator(StandardValidators.FILE_EXISTS_VALIDATOR)\n+            .addValidator(StandardValidators.DIRECTORY_EXISTS_VALIDATOR)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwODk5Mw==", "bodyText": "Didn't realize I left this in here, will remove", "url": "https://github.com/apache/nifi/pull/4627#discussion_r527008993", "createdAt": "2020-11-19T16:08:55Z", "author": {"login": "tlsmith109"}, "path": "nifi-nar-bundles/nifi-standard-bundle/nifi-standard-processors/src/main/java/org/apache/nifi/processors/standard/TailFile.java", "diffHunk": "@@ -131,7 +131,7 @@\n             .displayName(\"Base directory\")\n             .description(\"Base directory used to look for files to tail. This property is required when using Multifile mode.\")\n             .expressionLanguageSupported(ExpressionLanguageScope.VARIABLE_REGISTRY)\n-            .addValidator(StandardValidators.FILE_EXISTS_VALIDATOR)\n+            .addValidator(StandardValidators.DIRECTORY_EXISTS_VALIDATOR)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4MjQ2MA=="}, "originalCommit": {"oid": "bf1b2a097037a4dc8c9e1236253bbf7bb58b8f97"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 139, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}