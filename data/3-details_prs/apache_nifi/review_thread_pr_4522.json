{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MjQ4MDgx", "number": 4522, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMToyOTowOFrOEjUfHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo0OTo0N1rOEpGElA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NDcxMjYyOnYy", "diffSide": "RIGHT", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/PrometheusMetricsUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMToyOTowOFrOHRnPgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMjo1MDowNVrOHSAL9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIzMDc4Nw==", "bodyText": "@mattyb149 in this instance we'll need to keep the TOTAL_BYTES_READ and TOTAL_BYTES_WRITTEN (lines previously on 252 and 253 however the portStatus.getInputBytes() and portStatus.getOutputBytes() should be used respectively as in lines 250 and 251", "url": "https://github.com/apache/nifi/pull/4522#discussion_r488230787", "createdAt": "2020-09-14T21:29:08Z", "author": {"login": "YolandaMDavis"}, "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/PrometheusMetricsUtil.java", "diffHunk": "@@ -249,10 +249,8 @@ public static CollectorRegistry createNifiMetrics(NiFiMetricsRegistry nifiMetric\n                 nifiMetricsRegistry.setDataPoint(portStatus.getBytesSent(), \"AMOUNT_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getInputBytes(), \"AMOUNT_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getOutputBytes(), \"AMOUNT_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesRead(), \"TOTAL_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesWritten(), \"TOTAL_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesReceived(), \"TOTAL_BYTES_RECEIVED\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesSent(), \"TOTAL_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n+                nifiMetricsRegistry.incrementCounter(portStatus.getBytesReceived(), \"TOTAL_BYTES_RECEIVED\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n+                nifiMetricsRegistry.incrementCounter(portStatus.getBytesSent(), \"TOTAL_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdf64dc16c513180302e8392b64c62281778f0f"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzOTQ3Nw==", "bodyText": "Good catch, I saw the behavior while doing some additional testing. Since the second commit isn't valid, I'll just correct the original and force-push", "url": "https://github.com/apache/nifi/pull/4522#discussion_r488639477", "createdAt": "2020-09-15T12:50:05Z", "author": {"login": "mattyb149"}, "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/PrometheusMetricsUtil.java", "diffHunk": "@@ -249,10 +249,8 @@ public static CollectorRegistry createNifiMetrics(NiFiMetricsRegistry nifiMetric\n                 nifiMetricsRegistry.setDataPoint(portStatus.getBytesSent(), \"AMOUNT_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getInputBytes(), \"AMOUNT_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getOutputBytes(), \"AMOUNT_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesRead(), \"TOTAL_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesWritten(), \"TOTAL_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesReceived(), \"TOTAL_BYTES_RECEIVED\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesSent(), \"TOTAL_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n+                nifiMetricsRegistry.incrementCounter(portStatus.getBytesReceived(), \"TOTAL_BYTES_RECEIVED\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n+                nifiMetricsRegistry.incrementCounter(portStatus.getBytesSent(), \"TOTAL_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIzMDc4Nw=="}, "originalCommit": {"oid": "2fdf64dc16c513180302e8392b64c62281778f0f"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NDcxNjQ4OnYy", "diffSide": "LEFT", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/PrometheusMetricsUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMTozMDoxOFrOHRnRtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMTozMDoxOFrOHRnRtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIzMTM0OQ==", "bodyText": "same as comment above", "url": "https://github.com/apache/nifi/pull/4522#discussion_r488231349", "createdAt": "2020-09-14T21:30:18Z", "author": {"login": "YolandaMDavis"}, "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/PrometheusMetricsUtil.java", "diffHunk": "@@ -277,10 +275,8 @@ public static CollectorRegistry createNifiMetrics(NiFiMetricsRegistry nifiMetric\n                 nifiMetricsRegistry.setDataPoint(portStatus.getBytesSent(), \"AMOUNT_BYTES_SENT\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getInputBytes(), \"AMOUNT_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n                 nifiMetricsRegistry.setDataPoint(portStatus.getOutputBytes(), \"AMOUNT_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesRead(), \"TOTAL_BYTES_READ\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesWritten(), \"TOTAL_BYTES_WRITTEN\", instanceId, portComponentType, portComponentName, portComponentId, parentId);\n-                nifiMetricsRegistry.incrementCounter(status.getBytesReceived(), \"TOTAL_BYTES_RECEIVED\", instanceId, portComponentType, portComponentName, portComponentId, parentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdf64dc16c513180302e8392b64c62281778f0f"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNDg5Mzc2OnYy", "diffSide": "RIGHT", "path": "nifi-api/src/main/java/org/apache/nifi/reporting/EventAccess.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDozMTo1MVrOHagiig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo0ODo1OVrOHakJJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1ODE1NA==", "bodyText": "@mattyb149 wondering if this interface can be simplified? In the implementation class (RingBufferEventRepository) the aggregatedValues object is used to produce these values by first converting that object to a flowFileEvent.  Can we  instead do a method like \"reportAggregatedEvents\" which returns a FlowFileEvent?  Then callers could just use that single FlowFileEvent to do getBytesRead/getBytesWritten etc.", "url": "https://github.com/apache/nifi/pull/4522#discussion_r497558154", "createdAt": "2020-09-30T14:31:51Z", "author": {"login": "YolandaMDavis"}, "path": "nifi-api/src/main/java/org/apache/nifi/reporting/EventAccess.java", "diffHunk": "@@ -63,4 +63,32 @@\n      */\n     List<Action> getFlowChanges(int firstActionId, final int maxActions);\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f73b5b7155eddce23e278e2e2e52416fc87b93"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4MTkzNw==", "bodyText": "Makes sense, but FlowFileEvent is in nifi-framework-core-api, so we'd likely have to move that into nifi-api so everyone can use it. I'll look into the best way to do that.", "url": "https://github.com/apache/nifi/pull/4522#discussion_r497581937", "createdAt": "2020-09-30T15:01:35Z", "author": {"login": "mattyb149"}, "path": "nifi-api/src/main/java/org/apache/nifi/reporting/EventAccess.java", "diffHunk": "@@ -63,4 +63,32 @@\n      */\n     List<Action> getFlowChanges(int firstActionId, final int maxActions);\n \n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1ODE1NA=="}, "originalCommit": {"oid": "f4f73b5b7155eddce23e278e2e2e52416fc87b93"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYxNzE5MQ==", "bodyText": "@mattyb149 my apologies I meant to mark my comment on the FlowFileEventRepository, not EventAccess.", "url": "https://github.com/apache/nifi/pull/4522#discussion_r497617191", "createdAt": "2020-09-30T15:48:59Z", "author": {"login": "YolandaMDavis"}, "path": "nifi-api/src/main/java/org/apache/nifi/reporting/EventAccess.java", "diffHunk": "@@ -63,4 +63,32 @@\n      */\n     List<Action> getFlowChanges(int firstActionId, final int maxActions);\n \n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1ODE1NA=="}, "originalCommit": {"oid": "f4f73b5b7155eddce23e278e2e2e52416fc87b93"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNTI2NTQ4OnYy", "diffSide": "RIGHT", "path": "nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core-api/src/main/java/org/apache/nifi/controller/repository/FlowFileEventRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo0OTo0N1rOHakLdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0NzoxM1rOHamg1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYxNzc4Mg==", "bodyText": "@mattyb149 this is interface I meant to reference in my comments above.", "url": "https://github.com/apache/nifi/pull/4522#discussion_r497617782", "createdAt": "2020-09-30T15:49:47Z", "author": {"login": "YolandaMDavis"}, "path": "nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core-api/src/main/java/org/apache/nifi/controller/repository/FlowFileEventRepository.java", "diffHunk": "@@ -51,4 +51,32 @@\n      * @param componentIdentifier Identifier of the component\n      */\n     void purgeTransferEvents(String componentIdentifier);\n+\n+    /**\n+     * Returns the total number of bytes read by this instance (at the root process group level) since the instance started", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f73b5b7155eddce23e278e2e2e52416fc87b93"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1NjAyMg==", "bodyText": "Sounds good, will update to return a FlowFileEvent", "url": "https://github.com/apache/nifi/pull/4522#discussion_r497656022", "createdAt": "2020-09-30T16:47:13Z", "author": {"login": "mattyb149"}, "path": "nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core-api/src/main/java/org/apache/nifi/controller/repository/FlowFileEventRepository.java", "diffHunk": "@@ -51,4 +51,32 @@\n      * @param componentIdentifier Identifier of the component\n      */\n     void purgeTransferEvents(String componentIdentifier);\n+\n+    /**\n+     * Returns the total number of bytes read by this instance (at the root process group level) since the instance started", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYxNzc4Mg=="}, "originalCommit": {"oid": "f4f73b5b7155eddce23e278e2e2e52416fc87b93"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 150, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}