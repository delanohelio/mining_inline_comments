{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODc4MTc5", "number": 1348, "title": "DBZ-1874 Stablize MongoDB transaction metadata support", "bodyText": "https://issues.redhat.com/browse/DBZ-1874", "createdAt": "2020-03-17T14:40:46Z", "url": "https://github.com/debezium/debezium/pull/1348", "merged": true, "mergeCommit": {"oid": "2f6308bee9bdbae897f350ecc2545655f854d6f8"}, "closed": true, "closedAt": "2020-03-20T08:37:42Z", "author": {"login": "Naros"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOjwNAgH2gAyMzg5ODc4MTc5OmJhZDA4NTJiNTMxMTUzZDg2YWQxZWQ5MDVlMzIwZWRkM2I4OTZjYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPcXHOAFqTM3ODMwMjA5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bad0852b531153d86ad1ed905e320edd3b896cc4", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/bad0852b531153d86ad1ed905e320edd3b896cc4", "committedDate": "2020-03-17T14:40:21Z", "message": "DBZ-1874 Stablize MongoDB transaction metadata support\n\n* Added TransactionMetadataIT use test\n* Correctly resolve transaction metadata and field emission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b82f70463cc7ca8f7893d9ae5a563bc941fa329d", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/b82f70463cc7ca8f7893d9ae5a563bc941fa329d", "committedDate": "2020-03-17T15:31:39Z", "message": "DBZ-1874 Add check for tx support in test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTY2MDkx", "url": "https://github.com/debezium/debezium/pull/1348#pullrequestreview-376166091", "createdAt": "2020-03-17T15:51:03Z", "commit": {"oid": "bad0852b531153d86ad1ed905e320edd3b896cc4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTo1MTowM1rOF3iiEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjo1MzoxMVrOF3lPSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc4MTc3Nw==", "bodyText": "This looks a bit suspicious; shouldn't at least the var name (txOrder) be adjusted, too?", "url": "https://github.com/debezium/debezium/pull/1348#discussion_r393781777", "createdAt": "2020-03-17T15:51:03Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/MongoDbEventMetadataProvider.java", "diffHunk": "@@ -59,7 +59,7 @@ public String getTransactionId(DataCollectionId source, OffsetContext offset, Ob\n         if (source == null) {\n             return null;\n         }\n-        final Long txOrder = sourceInfo.getInt64(SourceInfo.TX_ORD);\n+        final Long txOrder = sourceInfo.getInt64(SourceInfo.OPERATION_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bad0852b531153d86ad1ed905e320edd3b896cc4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgyNjEyMg==", "bodyText": "Maybe extract \"h\" into a constant, to give it some meaning?", "url": "https://github.com/debezium/debezium/pull/1348#discussion_r393826122", "createdAt": "2020-03-17T16:53:11Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/MongoDbStreamingChangeEventSource.java", "diffHunk": "@@ -300,7 +300,7 @@ private boolean handleOplogEvent(ServerAddress primaryAddress, Document event, D\n                 return true;\n             }\n             try {\n-                dispatcher.dispatchTransactionStartedEvent(Long.toString(txOrder), oplogContext.getOffset());\n+                dispatcher.dispatchTransactionStartedEvent(Long.toString(event.getLong(\"h\")), oplogContext.getOffset());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bad0852b531153d86ad1ed905e320edd3b896cc4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5bbe3edade4d0cf4ed8703183c6f89273ec2a98", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/e5bbe3edade4d0cf4ed8703183c6f89273ec2a98", "committedDate": "2020-03-17T19:50:02Z", "message": "DBZ-1874 Recommended changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfeb90066ece01f4212b821cf6eb4241ea01380", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/1cfeb90066ece01f4212b821cf6eb4241ea01380", "committedDate": "2020-03-17T19:51:03Z", "message": "DBZ-1880 Fix compatibility with event metadata and V1 source info block"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDAwMjYw", "url": "https://github.com/debezium/debezium/pull/1348#pullrequestreview-376400260", "createdAt": "2020-03-17T20:58:23Z", "commit": {"oid": "1cfeb90066ece01f4212b821cf6eb4241ea01380"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo1ODoyM1rOF3tzYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo1ODoyM1rOF3tzYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2NjQzMg==", "bodyText": "Isn't the units for the \"sec\" field second, not microseconds?", "url": "https://github.com/debezium/debezium/pull/1348#discussion_r393966432", "createdAt": "2020-03-17T20:58:23Z", "author": {"login": "jgraf50"}, "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/MongoDbEventMetadataProvider.java", "diffHunk": "@@ -32,6 +33,10 @@ public Instant getEventTimestamp(DataCollectionId source, OffsetContext offset,\n         if (source == null) {\n             return null;\n         }\n+        if (sourceInfo.schema().field(SourceInfo.TIMESTAMP) != null) {\n+            final Integer timestamp = sourceInfo.getInt32(SourceInfo.TIMESTAMP);\n+            return timestamp == null ? null : Conversions.toInstantFromMicros(timestamp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cfeb90066ece01f4212b821cf6eb4241ea01380"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "898ee8b7d6a5c9adad31c1a2e791ed3c19de1062", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/898ee8b7d6a5c9adad31c1a2e791ed3c19de1062", "committedDate": "2020-03-18T15:17:45Z", "message": "DBZ-1874 Use seconds to get timestamp from legacy source info blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89ac061861cb75aa30cd4f30540a68c541954ec5", "author": {"user": {"login": "Naros", "name": "Chris Cranford"}}, "url": "https://github.com/debezium/debezium/commit/89ac061861cb75aa30cd4f30540a68c541954ec5", "committedDate": "2020-03-18T18:18:26Z", "message": "DBZ-1874 Resolve metrics test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzAyMDky", "url": "https://github.com/debezium/debezium/pull/1348#pullrequestreview-378302092", "createdAt": "2020-03-20T08:37:32Z", "commit": {"oid": "89ac061861cb75aa30cd4f30540a68c541954ec5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2149, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}