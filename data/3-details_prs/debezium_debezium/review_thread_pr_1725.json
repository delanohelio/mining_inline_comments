{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5MTIyNzgz", "number": 1725, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjozMDoxM1rOETqFgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjozMDoxM1rOETqFgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDQ3OTM3OnYy", "diffSide": "RIGHT", "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/databases/db2/DB2Controller.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjozMDoxM1rOG5g5cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMTozOToxOFrOG62OmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MTAwOA==", "bodyText": "Hey @SeanRooooney, we could need some helps on Db2 :) Specifically,@jcechace here is looking for a way to ensure the database has started (as a container) in integration tests before running any test. I.e. some readiness probe of sort. We do specific selects e.g. for Postgres in order to achieve that, and are looking for any Db2 equivalent. Thanks for any advise.", "url": "https://github.com/debezium/debezium/pull/1725#discussion_r462961008", "createdAt": "2020-07-30T12:30:13Z", "author": {"login": "gunnarmorling"}, "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/databases/db2/DB2Controller.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright Debezium Authors.\n+ *\n+ * Licensed under the Apache Software License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.debezium.testing.openshift.tools.databases.db2;\n+\n+import io.debezium.testing.openshift.tools.ConfigProperties;\n+import io.debezium.testing.openshift.tools.WaitConditions;\n+import io.debezium.testing.openshift.tools.databases.DatabaseInitListener;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseClient;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseController;\n+import io.fabric8.kubernetes.api.model.Pod;\n+import io.fabric8.kubernetes.api.model.Service;\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.fabric8.kubernetes.client.dsl.ExecWatch;\n+import io.fabric8.openshift.client.OpenShiftClient;\n+import org.awaitility.Awaitility;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.net.URISyntaxException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.List;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_DBNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_PASSWORD;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_USERNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_POSTGRESQL_DBZ_DBNAME;\n+import static org.awaitility.Awaitility.await;\n+\n+/**\n+ *\n+ * @author Jakub Cechacek\n+ */\n+public class DB2Controller extends SqlDatabaseController {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DB2Controller.class);\n+    private static final String READINESS_SQL_SELECT = \"SELECT 1 FROM DB2INST1.CUSTOMERS;\";\n+\n+    public DB2Controller(Deployment deployment, List<Service> services, String dbType, OpenShiftClient ocp) {\n+        super(deployment, services, dbType, ocp);\n+    }\n+\n+\n+    public void initialize() {\n+        LOGGER.info(\"Waiting until DB2 instance is ready\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3Nzk5Ng==", "bodyText": "The issue at hand is not exactly about detecting the DB startup. It's more about why the statement execution fails.", "url": "https://github.com/debezium/debezium/pull/1725#discussion_r463077996", "createdAt": "2020-07-30T15:23:30Z", "author": {"login": "jcechace"}, "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/databases/db2/DB2Controller.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright Debezium Authors.\n+ *\n+ * Licensed under the Apache Software License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.debezium.testing.openshift.tools.databases.db2;\n+\n+import io.debezium.testing.openshift.tools.ConfigProperties;\n+import io.debezium.testing.openshift.tools.WaitConditions;\n+import io.debezium.testing.openshift.tools.databases.DatabaseInitListener;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseClient;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseController;\n+import io.fabric8.kubernetes.api.model.Pod;\n+import io.fabric8.kubernetes.api.model.Service;\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.fabric8.kubernetes.client.dsl.ExecWatch;\n+import io.fabric8.openshift.client.OpenShiftClient;\n+import org.awaitility.Awaitility;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.net.URISyntaxException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.List;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_DBNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_PASSWORD;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_USERNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_POSTGRESQL_DBZ_DBNAME;\n+import static org.awaitility.Awaitility.await;\n+\n+/**\n+ *\n+ * @author Jakub Cechacek\n+ */\n+public class DB2Controller extends SqlDatabaseController {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DB2Controller.class);\n+    private static final String READINESS_SQL_SELECT = \"SELECT 1 FROM DB2INST1.CUSTOMERS;\";\n+\n+    public DB2Controller(Deployment deployment, List<Service> services, String dbType, OpenShiftClient ocp) {\n+        super(deployment, services, dbType, ocp);\n+    }\n+\n+\n+    public void initialize() {\n+        LOGGER.info(\"Waiting until DB2 instance is ready\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MTAwOA=="}, "originalCommit": null, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM1OTA2NQ==", "bodyText": "it looks like not in a readiness state. You can connect, but not all of the preparing work is done. About IBM Db2 on Openshift will be probably found here https://hub.docker.com/r/ibmcom/db2 .", "url": "https://github.com/debezium/debezium/pull/1725#discussion_r464359065", "createdAt": "2020-08-03T11:39:18Z", "author": {"login": "zrlurb"}, "path": "debezium-testing/debezium-testing-openshift/src/main/java/io/debezium/testing/openshift/tools/databases/db2/DB2Controller.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright Debezium Authors.\n+ *\n+ * Licensed under the Apache Software License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package io.debezium.testing.openshift.tools.databases.db2;\n+\n+import io.debezium.testing.openshift.tools.ConfigProperties;\n+import io.debezium.testing.openshift.tools.WaitConditions;\n+import io.debezium.testing.openshift.tools.databases.DatabaseInitListener;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseClient;\n+import io.debezium.testing.openshift.tools.databases.SqlDatabaseController;\n+import io.fabric8.kubernetes.api.model.Pod;\n+import io.fabric8.kubernetes.api.model.Service;\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.fabric8.kubernetes.client.dsl.ExecWatch;\n+import io.fabric8.openshift.client.OpenShiftClient;\n+import org.awaitility.Awaitility;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.net.URISyntaxException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.List;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_DBNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_PASSWORD;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_DB2_DBZ_USERNAME;\n+import static io.debezium.testing.openshift.tools.ConfigProperties.DATABASE_POSTGRESQL_DBZ_DBNAME;\n+import static org.awaitility.Awaitility.await;\n+\n+/**\n+ *\n+ * @author Jakub Cechacek\n+ */\n+public class DB2Controller extends SqlDatabaseController {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DB2Controller.class);\n+    private static final String READINESS_SQL_SELECT = \"SELECT 1 FROM DB2INST1.CUSTOMERS;\";\n+\n+    public DB2Controller(Deployment deployment, List<Service> services, String dbType, OpenShiftClient ocp) {\n+        super(deployment, services, dbType, ocp);\n+    }\n+\n+\n+    public void initialize() {\n+        LOGGER.info(\"Waiting until DB2 instance is ready\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MTAwOA=="}, "originalCommit": null, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4261, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}