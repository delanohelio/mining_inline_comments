{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMDkxMDMy", "number": 2024, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzo0MzozMlrOFHsY5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNToxMlrOFHt93A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNjExNjIzOnYy", "diffSide": "RIGHT", "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/DebeziumServerIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzo0MzozMlrOIJO-Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMjowMDo0MFrOIJV9cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MzM5MA==", "bodyText": "Where is this used?", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546553390", "createdAt": "2020-12-21T07:43:32Z", "author": {"login": "gunnarmorling"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/DebeziumServerIT.java", "diffHunk": "@@ -26,32 +26,22 @@\n  * @author Jiri Pechanec\n  */\n @QuarkusTest\n+@QuarkusTestResource(TestDatabase.class)\n public class DebeziumServerIT {\n \n     private static final int MESSAGE_COUNT = 4;\n-    protected static TestDatabase db = null;\n+    @Inject\n+    DebeziumServer server;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY2Nzg5MA==", "bodyText": "not 100% sure but, i believe this needed to start debezium-server and consume events, test that events are generated.\nused in line 56\n        final TestConsumer testConsumer = (TestConsumer) server.getConsumer();", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546667890", "createdAt": "2020-12-21T12:00:40Z", "author": {"login": "ismailsimsek"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/DebeziumServerIT.java", "diffHunk": "@@ -26,32 +26,22 @@\n  * @author Jiri Pechanec\n  */\n @QuarkusTest\n+@QuarkusTestResource(TestDatabase.class)\n public class DebeziumServerIT {\n \n     private static final int MESSAGE_COUNT = 4;\n-    protected static TestDatabase db = null;\n+    @Inject\n+    DebeziumServer server;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MzM5MA=="}, "originalCommit": null, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNjM3MTE0OnYy", "diffSide": "RIGHT", "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNDoxMFrOIJRSoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNDoxMFrOIJRSoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTM5Mg==", "bodyText": "@gunnarmorling  Maybe we can move https://github.com/debezium/debezium-ui-poc/blob/master/backend/src/test/java/io/debezium/configserver/util/PostgresInfrastructureTestResourceLifecycleManager.java from the UI PoC to debezium-testing-testcontainers as \"PostgresTestResourceLifecycleManager\" instead? This is related to @ani-sha's current work, isn't it?", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546591392", "createdAt": "2020-12-21T09:14:10Z", "author": {"login": "rk3rn3r"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -6,16 +6,20 @@\n package io.debezium.server;\n \n import java.time.Duration;\n+import java.util.Collections;\n+import java.util.Map;\n \n import org.junit.jupiter.api.Assertions;\n import org.testcontainers.containers.FixedHostPortGenericContainer;\n import org.testcontainers.containers.GenericContainer;\n import org.testcontainers.containers.wait.strategy.Wait;\n \n+import io.quarkus.test.common.QuarkusTestResourceLifecycleManager;\n+\n /**\n  * @author Jiri Pechanec\n  */\n-public class TestDatabase {\n+public class TestDatabase implements QuarkusTestResourceLifecycleManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNjM3NDY4OnYy", "diffSide": "RIGHT", "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNToxMlrOIJRUtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDowNDo1N1rOIJ8Rww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTkyNg==", "bodyText": "This should not be a fixed port. Instead use dynamic port assignment and configure quarkus like shown in the UI PoC implementation: https://github.com/debezium/debezium-ui-poc/blob/master/backend/src/test/java/io/debezium/configserver/util/PostgresInfrastructureTestResourceLifecycleManager.java#L16", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546591926", "createdAt": "2020-12-21T09:15:12Z", "author": {"login": "rk3rn3r"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -26,7 +30,7 @@\n \n     private GenericContainer container;\n \n-    public void start() {\n+    public Map<String, String> start() {\n         try {\n \n             container = new FixedHostPortGenericContainer(POSTGRES_IMAGE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3NzU4NA==", "bodyText": "makes sense, also it seems like FixedHostPortGenericContainer deprecated. is it possible to pass the dynamic port to  ConfigSource before the server initializes?\nneed to check how to pas dynamic port to TestConfigSource.java and set property  'debezium.source.database.port'", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546677584", "createdAt": "2020-12-21T12:24:34Z", "author": {"login": "ismailsimsek"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -26,7 +30,7 @@\n \n     private GenericContainer container;\n \n-    public void start() {\n+    public Map<String, String> start() {\n         try {\n \n             container = new FixedHostPortGenericContainer(POSTGRES_IMAGE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTkyNg=="}, "originalCommit": null, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5NTY4Mw==", "bodyText": "Instead of FixedHostPortGenericContainer use org.testcontainers.containers.PostgreSQLContainer#PostgreSQLContainer. The default docker behavior is dynamic port mapping anyways, you don't have to do anything. See the linked code in PostgresInfrastructureTestResourceLifecycleManager on how to configure Quarkus with the dynamic port.", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r547295683", "createdAt": "2020-12-22T14:04:57Z", "author": {"login": "rk3rn3r"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -26,7 +30,7 @@\n \n     private GenericContainer container;\n \n-    public void start() {\n+    public Map<String, String> start() {\n         try {\n \n             container = new FixedHostPortGenericContainer(POSTGRES_IMAGE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTkyNg=="}, "originalCommit": null, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4113, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}