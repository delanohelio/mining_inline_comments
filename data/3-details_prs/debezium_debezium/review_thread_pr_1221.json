{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1ODA4ODU4", "number": 1221, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMToyODo0OFrODbL7PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowOTo1MlrODcN7oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODMzNTMyOnYy", "diffSide": "RIGHT", "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/TransactionMetadataIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMToyODo0OFrOFihrYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjo1Mjo0N1rOFij20Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0NzY4Mw==", "bodyText": "That's unused.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371747683", "createdAt": "2020-01-28T11:28:48Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/TransactionMetadataIT.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright Debezium Authors.\n+ *\n+ * Licensed under the Apache Software License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+package io.debezium.connector.postgresql;\n+\n+import java.sql.SQLException;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.kafka.connect.source.SourceRecord;\n+import org.fest.assertions.Assertions;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TestRule;\n+\n+import io.debezium.config.Configuration;\n+import io.debezium.connector.postgresql.PostgresConnectorConfig.SnapshotMode;\n+import io.debezium.connector.postgresql.junit.SkipTestDependingOnDecoderPluginNameRule;\n+import io.debezium.embedded.AbstractConnectorTest;\n+import io.debezium.util.Testing;\n+\n+public class TransactionMetadataIT extends AbstractConnectorTest {\n+\n+    private static final String INSERT_STMT = \"INSERT INTO s1.a (aa) VALUES (1);\" +\n+            \"INSERT INTO s2.a (aa) VALUES (1);\";\n+    private static final String SETUP_TABLES_STMT = \"DROP SCHEMA IF EXISTS s1 CASCADE;\" +\n+            \"DROP SCHEMA IF EXISTS s2 CASCADE;\" +\n+            \"CREATE SCHEMA s1; \" +\n+            \"CREATE SCHEMA s2; \" +\n+            \"CREATE TABLE s1.a (pk SERIAL, aa integer, PRIMARY KEY(pk));\" +\n+            \"CREATE TABLE s2.a (pk SERIAL, aa integer, bb varchar(20), PRIMARY KEY(pk));\" +\n+            INSERT_STMT;\n+    private PostgresConnector connector;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc4MzM3Nw==", "bodyText": "Removed", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371783377", "createdAt": "2020-01-28T12:52:47Z", "author": {"login": "jpechane"}, "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/TransactionMetadataIT.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright Debezium Authors.\n+ *\n+ * Licensed under the Apache Software License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+\n+package io.debezium.connector.postgresql;\n+\n+import java.sql.SQLException;\n+import java.util.List;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.kafka.connect.source.SourceRecord;\n+import org.fest.assertions.Assertions;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TestRule;\n+\n+import io.debezium.config.Configuration;\n+import io.debezium.connector.postgresql.PostgresConnectorConfig.SnapshotMode;\n+import io.debezium.connector.postgresql.junit.SkipTestDependingOnDecoderPluginNameRule;\n+import io.debezium.embedded.AbstractConnectorTest;\n+import io.debezium.util.Testing;\n+\n+public class TransactionMetadataIT extends AbstractConnectorTest {\n+\n+    private static final String INSERT_STMT = \"INSERT INTO s1.a (aa) VALUES (1);\" +\n+            \"INSERT INTO s2.a (aa) VALUES (1);\";\n+    private static final String SETUP_TABLES_STMT = \"DROP SCHEMA IF EXISTS s1 CASCADE;\" +\n+            \"DROP SCHEMA IF EXISTS s2 CASCADE;\" +\n+            \"CREATE SCHEMA s1; \" +\n+            \"CREATE SCHEMA s2; \" +\n+            \"CREATE TABLE s1.a (pk SERIAL, aa integer, PRIMARY KEY(pk));\" +\n+            \"CREATE TABLE s2.a (pk SERIAL, aa integer, bb varchar(20), PRIMARY KEY(pk));\" +\n+            INSERT_STMT;\n+    private PostgresConnector connector;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0NzY4Mw=="}, "originalCommit": null, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ1NDk3OnYy", "diffSide": "RIGHT", "path": "debezium-connector-sqlserver/src/test/java/io/debezium/connector/sqlserver/SqlServerConnectorIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoxMjo1NlrOFiiy2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjo1Mjo1NlrOFij3DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NTk3OA==", "bodyText": "As that's a user-facing topic -- unlike heartbeats -- I'd suggest to stick to the established naming pattern for topics and make it <logical name>.transactions, e.g. dbserver1.transactions.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371765978", "createdAt": "2020-01-28T12:12:56Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-sqlserver/src/test/java/io/debezium/connector/sqlserver/SqlServerConnectorIT.java", "diffHunk": "@@ -379,6 +379,70 @@ public void update() throws Exception {\n         stopConnector();\n     }\n \n+    @Test\n+    public void transactionMetadata() throws Exception {\n+        final int RECORDS_PER_TABLE = 5;\n+        final int ID_START = 10;\n+        final Configuration config = TestHelper.defaultConfig()\n+                .with(SqlServerConnectorConfig.SNAPSHOT_MODE, SnapshotMode.INITIAL)\n+                .with(SqlServerConnectorConfig.PROVIDE_TRANSACTION_METADATA, true)\n+                .build();\n+\n+        start(SqlServerConnector.class, config);\n+        assertConnectorIsRunning();\n+\n+        Testing.Print.enable();\n+        // Wait for snapshot completion\n+        consumeRecordsByTopic(1);\n+\n+        connection.setAutoCommit(false);\n+        final String[] inserts = new String[RECORDS_PER_TABLE * 2];\n+        for (int i = 0; i < RECORDS_PER_TABLE; i++) {\n+            final int id = ID_START + i;\n+            inserts[2 * i] = \"INSERT INTO tablea VALUES(\" + id + \", 'a')\";\n+            inserts[2 * i + 1] = \"INSERT INTO tableb VALUES(\" + id + \", 'b')\";\n+        }\n+        connection.execute(inserts);\n+        connection.setAutoCommit(true);\n+\n+        connection.execute(\"INSERT INTO tableb VALUES(1000, 'b')\");\n+\n+        // BEGIN, data, END, BEGIN, data\n+        final SourceRecords records = consumeRecordsByTopic(1 + RECORDS_PER_TABLE * 2 + 1 + 1 + 1);\n+        final List<SourceRecord> tableA = records.recordsForTopic(\"server1.dbo.tablea\");\n+        final List<SourceRecord> tableB = records.recordsForTopic(\"server1.dbo.tableb\");\n+        final List<SourceRecord> tx = records.recordsForTopic(\"__debezium.transaction.server1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc4MzQzNg==", "bodyText": "Done", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371783436", "createdAt": "2020-01-28T12:52:56Z", "author": {"login": "jpechane"}, "path": "debezium-connector-sqlserver/src/test/java/io/debezium/connector/sqlserver/SqlServerConnectorIT.java", "diffHunk": "@@ -379,6 +379,70 @@ public void update() throws Exception {\n         stopConnector();\n     }\n \n+    @Test\n+    public void transactionMetadata() throws Exception {\n+        final int RECORDS_PER_TABLE = 5;\n+        final int ID_START = 10;\n+        final Configuration config = TestHelper.defaultConfig()\n+                .with(SqlServerConnectorConfig.SNAPSHOT_MODE, SnapshotMode.INITIAL)\n+                .with(SqlServerConnectorConfig.PROVIDE_TRANSACTION_METADATA, true)\n+                .build();\n+\n+        start(SqlServerConnector.class, config);\n+        assertConnectorIsRunning();\n+\n+        Testing.Print.enable();\n+        // Wait for snapshot completion\n+        consumeRecordsByTopic(1);\n+\n+        connection.setAutoCommit(false);\n+        final String[] inserts = new String[RECORDS_PER_TABLE * 2];\n+        for (int i = 0; i < RECORDS_PER_TABLE; i++) {\n+            final int id = ID_START + i;\n+            inserts[2 * i] = \"INSERT INTO tablea VALUES(\" + id + \", 'a')\";\n+            inserts[2 * i + 1] = \"INSERT INTO tableb VALUES(\" + id + \", 'b')\";\n+        }\n+        connection.execute(inserts);\n+        connection.setAutoCommit(true);\n+\n+        connection.execute(\"INSERT INTO tableb VALUES(1000, 'b')\");\n+\n+        // BEGIN, data, END, BEGIN, data\n+        final SourceRecords records = consumeRecordsByTopic(1 + RECORDS_PER_TABLE * 2 + 1 + 1 + 1);\n+        final List<SourceRecord> tableA = records.recordsForTopic(\"server1.dbo.tablea\");\n+        final List<SourceRecord> tableB = records.recordsForTopic(\"server1.dbo.tableb\");\n+        final List<SourceRecord> tx = records.recordsForTopic(\"__debezium.transaction.server1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NTk3OA=="}, "originalCommit": null, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ5Mzg3OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyNjozOVrOFijJxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNjowNDowNFrOFi9c-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTg0NQ==", "bodyText": "Have you tested this? I'd expect that the nested attributes will need proper handling, i.e. prefixing them with with some constant literal as they are all put into one flat namespace. That said I'm a bit dubious about the nested structure begin with. This ties into my question about the purpose of these attributes in change events themselves. I kinda thought we'd only need the TX id, in which case the question of nesting is a moot point.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371771845", "createdAt": "2020-01-28T12:26:39Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "diffHunk": "@@ -431,6 +431,9 @@ else if (schema.type() == Type.INT8 || schema.type() == Type.INT16 || schema.typ\n         else if (schema.type() == Type.STRING || schema.type() == Type.INT64) {\n             ceExtensionSchema = SchemaBuilder.string();\n         }\n+        else if (schema.type() == Type.STRUCT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3OTM4Nw==", "bodyText": "Yes, CE test fails due to this reason, thus I added this as a hotfix - for whether we need or not other information please see other comment.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371779387", "createdAt": "2020-01-28T12:43:52Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "diffHunk": "@@ -431,6 +431,9 @@ else if (schema.type() == Type.INT8 || schema.type() == Type.INT16 || schema.typ\n         else if (schema.type() == Type.STRING || schema.type() == Type.INT64) {\n             ceExtensionSchema = SchemaBuilder.string();\n         }\n+        else if (schema.type() == Type.STRUCT) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTg0NQ=="}, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIwMjc0NA==", "bodyText": "Removed as transaction is no longer in source info block", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372202744", "createdAt": "2020-01-29T06:04:04Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "diffHunk": "@@ -431,6 +431,9 @@ else if (schema.type() == Type.INT8 || schema.type() == Type.INT16 || schema.typ\n         else if (schema.type() == Type.STRING || schema.type() == Type.INT64) {\n             ceExtensionSchema = SchemaBuilder.string();\n         }\n+        else if (schema.type() == Type.STRUCT) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTg0NQ=="}, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ5NTU4OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/pipeline/spi/OffsetContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyNzoxNVrOFijKww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjo1MzowNlrOFij3Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MjA5OQ==", "bodyText": "Please add a comment, as it's a public contract and it'll be beneficial for us, too.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371772099", "createdAt": "2020-01-28T12:27:15Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/pipeline/spi/OffsetContext.java", "diffHunk": "@@ -69,4 +70,6 @@\n      * Records the name of the collection and the timestamp of the last event\n      */\n     void event(DataCollectionId collectionId, Instant timestamp);\n+\n+    TransactionContext getTransactionContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc4MzUxMA==", "bodyText": "Added", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r371783510", "createdAt": "2020-01-28T12:53:06Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/pipeline/spi/OffsetContext.java", "diffHunk": "@@ -69,4 +70,6 @@\n      * Records the name of the collection and the timestamp of the last event\n      */\n     void event(DataCollectionId collectionId, Instant timestamp);\n+\n+    TransactionContext getTransactionContext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MjA5OQ=="}, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNTAyNjMxOnYy", "diffSide": "LEFT", "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/connection/pgoutput/PgOutputMessageDecoder.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1NDo0MlrOFjh90Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowNTozNVrOFkJd0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMDk3Nw==", "bodyText": "This situation of COMMIT and next BEGIN sharing the same LSN sounds really weird. Is this something you actually observed, too, @jpechane ?", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372800977", "createdAt": "2020-01-30T07:54:42Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/connection/pgoutput/PgOutputMessageDecoder.java", "diffHunk": "@@ -130,13 +131,6 @@ public boolean shouldMessageBeSkipped(ByteBuffer buffer, Long lastReceivedLsn, L\n                     // same session a `R` message was followed by an insert/update/delete message.\n                     // @formatter:on\n                 case COMMIT:\n-                    // For now skip these message types so that the LSN associated with the message won't\n-                    // be flushed back to PostgreSQL. There is a potential LSN assignment concern with\n-                    // ReplicationConnectionIT#testHowRelationMessagesAreReceived where the first COMMIT", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5Njk1Nw==", "bodyText": "@gunnarmorling No, I've not encountered yet. I've discussed the matter with @Naros and we came to conclusion that if the problem is no longer viisble in tests that we can remove it.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372896957", "createdAt": "2020-01-30T11:29:50Z", "author": {"login": "jpechane"}, "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/connection/pgoutput/PgOutputMessageDecoder.java", "diffHunk": "@@ -130,13 +131,6 @@ public boolean shouldMessageBeSkipped(ByteBuffer buffer, Long lastReceivedLsn, L\n                     // same session a `R` message was followed by an insert/update/delete message.\n                     // @formatter:on\n                 case COMMIT:\n-                    // For now skip these message types so that the LSN associated with the message won't\n-                    // be flushed back to PostgreSQL. There is a potential LSN assignment concern with\n-                    // ReplicationConnectionIT#testHowRelationMessagesAreReceived where the first COMMIT", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMDk3Nw=="}, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0ODE0Ng==", "bodyText": "Ok, thanks!", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r373448146", "createdAt": "2020-01-31T12:05:35Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/connection/pgoutput/PgOutputMessageDecoder.java", "diffHunk": "@@ -130,13 +131,6 @@ public boolean shouldMessageBeSkipped(ByteBuffer buffer, Long lastReceivedLsn, L\n                     // same session a `R` message was followed by an insert/update/delete message.\n                     // @formatter:on\n                 case COMMIT:\n-                    // For now skip these message types so that the LSN associated with the message won't\n-                    // be flushed back to PostgreSQL. There is a potential LSN assignment concern with\n-                    // ReplicationConnectionIT#testHowRelationMessagesAreReceived where the first COMMIT", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMDk3Nw=="}, "originalCommit": null, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNTAyNzY3OnYy", "diffSide": "RIGHT", "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/PostgresConnectorIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1NToxNVrOFjh-sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1NToxNVrOFjh-sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTIwMA==", "bodyText": "Ooops. Good spot.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372801200", "createdAt": "2020-01-30T07:55:15Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/PostgresConnectorIT.java", "diffHunk": "@@ -1369,11 +1369,13 @@ public void shouldConsumeEventsWithMaskedColumns() throws Exception {\n         stopConnector();\n     }\n \n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNTAzMjAzOnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1NzoyNVrOFjiBjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1NzoyNVrOFjiBjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMTkzMg==", "bodyText": "Good; that should help with other non-CDC events, too.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372801932", "createdAt": "2020-01-30T07:57:25Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "diffHunk": "@@ -167,6 +170,10 @@ public void configure(Map<String, ?> configs, boolean isKey) {\n         if (schema == null || value == null) {\n             return null;\n         }\n+        if (!schema.name().endsWith(\".Envelope\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNTAzNjQ4OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1OToyNVrOFjiEXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNzo1OToyNVrOFjiEXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwMjY1Mg==", "bodyText": "Can you also add (or update) the example event shown in the converter docs?", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r372802652", "createdAt": "2020-01-30T07:59:25Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/converters/CloudEventsConverter.java", "diffHunk": "@@ -68,6 +70,7 @@\n public class CloudEventsConverter implements Converter {\n \n     private static final String EXTENSION_NAME_PREFIX = \"iodebezium\";\n+    private static final String TX_ATTRIBUTE_PREFIX = \"tx\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjk2MDkzOnYy", "diffSide": "RIGHT", "path": "documentation/modules/ROOT/pages/integrations/cloudevents.adoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODowNDo0MlrOFj0mEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwNDo1NDoyNVrOFkBYzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwNjE5NA==", "bodyText": "There is iodebeziumtxId already (see above). That's really what I'm a bit concerned about -- the redundancy of this new info. I don't have a good answer right now. Maybe we should deprecate and eventually remove the current txId attribute in the source block?", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r373106194", "createdAt": "2020-01-30T18:04:42Z", "author": {"login": "gunnarmorling"}, "path": "documentation/modules/ROOT/pages/integrations/cloudevents.adoc", "diffHunk": "@@ -97,6 +101,9 @@ Alternatively, Avro can be used as content type for the `data` attribute:\n   \"iodebeziumtxId\" : \"578\",\n   \"iodebeziumlsn\" : \"33227720\",\n   \"iodebeziumxmin\" : null,\n+  \"iodebeziumtxid\": \"589\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMxNTc5MQ==", "bodyText": "@gunnarmorling I don't think that it is necessary to remove the redundancy. Don't forget that transaction metadata are optional. So I'd keep it in source info.\nIn fact this looks like a problem only in flattened format and in this case I propose to just document it and/or change iodebeziumtx to a different one so the difference is more visible, maybe iodebeziumTxn?", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r373315791", "createdAt": "2020-01-31T04:54:25Z", "author": {"login": "jpechane"}, "path": "documentation/modules/ROOT/pages/integrations/cloudevents.adoc", "diffHunk": "@@ -97,6 +101,9 @@ Alternatively, Avro can be used as content type for the `data` attribute:\n   \"iodebeziumtxId\" : \"578\",\n   \"iodebeziumlsn\" : \"33227720\",\n   \"iodebeziumxmin\" : null,\n+  \"iodebeziumtxid\": \"589\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwNjE5NA=="}, "originalCommit": null, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTEzODcwOnYy", "diffSide": "RIGHT", "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/PostgresStreamingChangeEventSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowNTowM1rOFkJdJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowNTowM1rOFkJdJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0Nzk3NQ==", "bodyText": "Isn't the early return a problem as we'd miss the update of lastCompletelyProcessedLsn below?", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r373447975", "createdAt": "2020-01-31T12:05:03Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/main/java/io/debezium/connector/postgresql/PostgresStreamingChangeEventSource.java", "diffHunk": "@@ -126,15 +128,33 @@ public void execute(ChangeEventSourceContext context) throws InterruptedExceptio\n                         dispatcher.dispatchHeartbeatEvent(offsetContext);\n                         return;\n                     }\n+                    if (TransactionMessage.isTransactionalMessage(message) && !connectorConfig.shouldProvideTransactionMetadata()) {\n+                        LOGGER.trace(\"Received transactional message {}\", message);\n+                        return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f41544b8777e819091e17c4d2b132bba9b746e3"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTE0OTc2OnYy", "diffSide": "RIGHT", "path": "documentation/modules/ROOT/pages/integrations/cloudevents.adoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowOTo1MlrOFkJjtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowOTo1MlrOFkJjtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0OTY1Mw==", "bodyText": "Ok, so I'm still not happy about this; but no blocker for now. I've added it to DBZ-1701 to get rid of iodebeziumtxId if iodebeziumtxid is present.", "url": "https://github.com/debezium/debezium/pull/1221#discussion_r373449653", "createdAt": "2020-01-31T12:09:52Z", "author": {"login": "gunnarmorling"}, "path": "documentation/modules/ROOT/pages/integrations/cloudevents.adoc", "diffHunk": "@@ -97,6 +101,9 @@ Alternatively, Avro can be used as content type for the `data` attribute:\n   \"iodebeziumtxId\" : \"578\",\n   \"iodebeziumlsn\" : \"33227720\",\n   \"iodebeziumxmin\" : null,\n+  \"iodebeziumtxid\": \"578\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f41544b8777e819091e17c4d2b132bba9b746e3"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4497, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}