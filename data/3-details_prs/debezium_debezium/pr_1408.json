{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzU3NzAz", "number": 1408, "title": "DBZ-1949 Return BitSet instead of short/int/long", "bodyText": "https://issues.redhat.com/browse/DBZ-1949\nWhen converting Postgres bit varying column, convert to byte array\ninstead of short/int/long to handle cases where the value is larger than\nLong.MAX_VALUE", "createdAt": "2020-04-13T17:47:49Z", "url": "https://github.com/debezium/debezium/pull/1408", "merged": true, "mergeCommit": {"oid": "ad8beb76d02fdbd676319e1ef8adff19aad3c4fa"}, "closed": true, "closedAt": "2020-04-21T09:26:50Z", "author": {"login": "dajerome"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXSjEQAH2gAyNDAyNzU3NzAzOmY2ODMyNjIxOGJhNDYwNTk4MTE0NjA5YjI0Yjk4ZTU3M2MyNWQ2MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZkIAbgH2gAyNDAyNzU3NzAzOjc4MzdlNWMzYzYzMzM4OGZhMTg2NzE0YTUxYjZhYWE4ZGZlNjg0Y2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f68326218ba460598114609b24b98e573c25d603", "author": {"user": {"login": "dajerome", "name": null}}, "url": "https://github.com/debezium/debezium/commit/f68326218ba460598114609b24b98e573c25d603", "committedDate": "2020-04-13T17:42:56Z", "message": "DBZ-1949 Return byte array instead of short/int/long\n\nWhen converting Postgres bit varying column, convert to byte array\ninstead of short/int/long to handle cases where the value is larger than\nLong.MAX_VALUE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTI4NzQx", "url": "https://github.com/debezium/debezium/pull/1408#pullrequestreview-392928741", "createdAt": "2020-04-14T13:31:44Z", "commit": {"oid": "f68326218ba460598114609b24b98e573c25d603"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzozMTo0NFrOGFOw9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzozMTo0NFrOGFOw9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEzNzk3NA==", "bodyText": "Why is it this got changed?", "url": "https://github.com/debezium/debezium/pull/1408#discussion_r408137974", "createdAt": "2020-04-14T13:31:44Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/AbstractRecordsProducerTest.java", "diffHunk": "@@ -525,8 +525,9 @@ private Schema hstoreMapSchema() {\n     protected List<SchemaAndValueField> schemaAndValuesForBinTypes() {\n         return Arrays.asList(new SchemaAndValueField(\"ba\", Schema.OPTIONAL_BYTES_SCHEMA, ByteBuffer.wrap(new byte[]{ 1, 2, 3 })),\n                 new SchemaAndValueField(\"bol\", Schema.OPTIONAL_BOOLEAN_SCHEMA, false),\n-                new SchemaAndValueField(\"bs\", Bits.builder(2).optional().build(), new byte[]{ 3, 0 }), // bitsets get converted from two's complement", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f68326218ba460598114609b24b98e573c25d603"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDAyNTEx", "url": "https://github.com/debezium/debezium/pull/1408#pullrequestreview-396402511", "createdAt": "2020-04-20T12:23:26Z", "commit": {"oid": "f68326218ba460598114609b24b98e573c25d603"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMjoyMzoyN1rOGIRz7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMjoyMzoyN1rOGIRz7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTMzMzYxNA==", "bodyText": "Ok, understood. Yes, agreed that the leading 0 is non-significant and it makes sense to get rid of it. This made me realize though that there's a problem with the currently proposed change: it reverses the endian-ness of the produced data (i.e. the order of the byte array).\nThis becomes apparent when using some values longer than a byte (the previous test data is really lacking in that regard...). E.g. consider a value like B'000000110000001000000001' (bytes 3, 2 and 1). Before your change, it would have been emitted as [1, 2, 3, 0]. I.e. \"little-endian\", with least significant byte as the first. Whereas now, with your change, it's [3, 2, 1, 0]. It actually should be [1, 2, 3] (little-endian as before, insignificant 0's removed). This means the expected value for your new column should be [0, 0, 0, 0, 0, 0, 0, -128].\nNote the little-endian byte ordering seems a bit odd IMHO, but it's the existing behavior and it also is described as such in the connector docs. Hence we should stick to it, yet removing insignificant leading 0's.\nDoes that make sense?\n@jpechane, if you could double-check what I wrote, that'd be much appreciated. Thanks!", "url": "https://github.com/debezium/debezium/pull/1408#discussion_r411333614", "createdAt": "2020-04-20T12:23:27Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-postgres/src/test/java/io/debezium/connector/postgresql/AbstractRecordsProducerTest.java", "diffHunk": "@@ -525,8 +525,9 @@ private Schema hstoreMapSchema() {\n     protected List<SchemaAndValueField> schemaAndValuesForBinTypes() {\n         return Arrays.asList(new SchemaAndValueField(\"ba\", Schema.OPTIONAL_BYTES_SCHEMA, ByteBuffer.wrap(new byte[]{ 1, 2, 3 })),\n                 new SchemaAndValueField(\"bol\", Schema.OPTIONAL_BOOLEAN_SCHEMA, false),\n-                new SchemaAndValueField(\"bs\", Bits.builder(2).optional().build(), new byte[]{ 3, 0 }), // bitsets get converted from two's complement", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODEzNzk3NA=="}, "originalCommit": {"oid": "f68326218ba460598114609b24b98e573c25d603"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1e7e0fcccae764d7264a1c4374755c77135ba12", "author": {"user": {"login": "dajerome", "name": null}}, "url": "https://github.com/debezium/debezium/commit/a1e7e0fcccae764d7264a1c4374755c77135ba12", "committedDate": "2020-04-20T18:41:30Z", "message": "DBZ-1949 Return BitSet instead of short/int/long\n\nWhen converting Postgres bit varying column, convert to BitSet\ninstead of short/int/long to handle cases where the value is larger than\nLong.MAX_VALUE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7837e5c3c633388fa186714a51b6aaa8dfe684ce", "author": {"user": {"login": "dajerome", "name": null}}, "url": "https://github.com/debezium/debezium/commit/7837e5c3c633388fa186714a51b6aaa8dfe684ce", "committedDate": "2020-04-20T19:19:31Z", "message": "DBZ-1949 Resolve formatting issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2003, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}