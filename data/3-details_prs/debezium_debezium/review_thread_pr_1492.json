{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2OTY2NTYy", "number": 1492, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyNToxOVrOD77ODQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjozMDowM1rOD77SLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTYyODI5OnYy", "diffSide": "RIGHT", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentState.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyNToxOVrOGUjDJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyNToxOVrOGUjDJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5ODk1MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static List<String> determienAdditionalSourceField(String addSourceFieldsConfig) {\n          \n          \n            \n                private static List<String> determineAdditionalSourceField(String addSourceFieldsConfig) {", "url": "https://github.com/debezium/debezium/pull/1492#discussion_r424198951", "createdAt": "2020-05-13T06:25:19Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentState.java", "diffHunk": "@@ -420,4 +508,107 @@ public void configure(final Map<String, ?> map) {\n         delegateConfig.put(\"delimiter\", delimiter);\n         recordFlattener.configure(delegateConfig);\n     }\n+\n+    private static List<String> determienAdditionalSourceField(String addSourceFieldsConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f613f55b5b950862fd79d193294a273aac24a8"}, "originalPosition": 237}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTYzMDczOnYy", "diffSide": "RIGHT", "path": "documentation/modules/ROOT/pages/configuration/mongodb-event-flattening.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyNjoyNFrOGUjEmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyNjoyNFrOGUjEmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5OTMyMQ==", "bodyText": "Now it's on me to suggest to add the link anchors :)", "url": "https://github.com/debezium/debezium/pull/1492#discussion_r424199321", "createdAt": "2020-05-13T06:26:24Z", "author": {"login": "gunnarmorling"}, "path": "documentation/modules/ROOT/pages/configuration/mongodb-event-flattening.adoc", "diffHunk": "@@ -276,9 +279,26 @@ For `DELETE` events, this option is only supported when the `delete.handling.mod\n |`drop`\n |The SMT can `drop`, `rewrite` or pass delete records (`none`). The `rewrite` mode will add a `__deleted` field set to `true` or `false` depending on the represented operation.\n \n-|`add.source.fields`\n+ifndef::cdc-product[]\n+|`add.source.fields` +\n |\n-|Fields from the change event's `source` structure to add as metadata (prefixed with \"__\") to the flattened record\n+|Fields from the change event's `source` structure to add as metadata (prefixed with \"__\") to the flattened record. +\n+This is deprecated as of Debezium 1.2, please use `add.headers` and `add.fields` instead.\n+endif::[]\n+\n+|`add.headers`\n+|\n+|Specify a list of metadata fields to add to header of the flattened message.\n+In case of duplicate field names (e.g. \"ts_ms\" exists twice), the struct should be specified to get the correct field (e.g. \"source.ts_ms\").\n+The fields will be prefixed with \"__\" or \"__<struct>__\", depending on the specification of the struct.\n+Please use a comma separated list without spaces.\n+\n+|`add.fields`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f613f55b5b950862fd79d193294a273aac24a8"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTYzNTUwOnYy", "diffSide": "RIGHT", "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentState.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyODozNFrOGUjHgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjoyODozNFrOGUjHgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMDA2NQ==", "bodyText": "ADD_SOURCE_FIELDS and the new non-deprecated ones missing here?", "url": "https://github.com/debezium/debezium/pull/1492#discussion_r424200065", "createdAt": "2020-05-13T06:28:34Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mongodb/src/main/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentState.java", "diffHunk": "@@ -381,7 +467,7 @@ public void configure(final Map<String, ?> map) {\n         smtManager = new SmtManager<>(config);\n \n         final Field.Set configFields = Field.setOf(ARRAY_ENCODING, FLATTEN_STRUCT, DELIMITER,\n-                ExtractNewRecordStateConfigDefinition.OPERATION_HEADER,\n+                OPERATION_HEADER,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f613f55b5b950862fd79d193294a273aac24a8"}, "originalPosition": 212}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTYzODg0OnYy", "diffSide": "RIGHT", "path": "debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentStateTestIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjozMDowM1rOGUjJlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjozMDowM1rOGUjJlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMDU5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testAddHeadrsForMissingOrInvalidFields() throws Exception {\n          \n          \n            \n                public void testAddHeadersForMissingOrInvalidFields() throws Exception {", "url": "https://github.com/debezium/debezium/pull/1492#discussion_r424200597", "createdAt": "2020-05-13T06:30:03Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/transforms/ExtractNewDocumentStateTestIT.java", "diffHunk": "@@ -1195,7 +1198,248 @@ public void shouldFlattenWithDelimiterTransformRecordForUpdateEvent() throws Int\n         assertThat(value.schema().fields()).hasSize(4);\n     }\n \n+    @Test\n+    @FixFor(\"DBZ-1791\")\n+    public void testAddHeader() throws Exception {\n+        waitForStreamingRunning();\n+\n+        final Map<String, String> props = new HashMap<>();\n+        props.put(ADD_HEADERS, \"op\");\n+        transformation.configure(props);\n+\n+        final SourceRecord createRecord = createCreateRecord();\n+        final SourceRecord transformed = transformation.apply(createRecord);\n+        assertThat(transformed.headers()).hasSize(1);\n+        assertThat(getSourceRecordHeaderByKey(transformed, \"__op\")).isEqualTo(Operation.CREATE.code());\n+    }\n+\n+    @Test\n+    @FixFor(\"DBZ-1791\")\n+    public void testAddHeadrsForMissingOrInvalidFields() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f613f55b5b950862fd79d193294a273aac24a8"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4325, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}