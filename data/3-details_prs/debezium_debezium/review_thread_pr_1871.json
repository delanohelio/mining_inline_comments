{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjUzODk0", "number": 1871, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDo1NToxM1rOEqkLkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDo1NToxM1rOEqkLkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDY4NDMzOnYy", "diffSide": "RIGHT", "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/listener/CreateTableParserListener.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDo1NToxM1rOHc15jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNzowOToyMVrOHc4sfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwNTI2Mw==", "bodyText": "hi @jpechane May I know why previous parser.currentDatabaseCharset() does not return database encoding?", "url": "https://github.com/debezium/debezium/pull/1871#discussion_r500005263", "createdAt": "2020-10-06T04:55:13Z", "author": {"login": "victorxiang30"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/listener/CreateTableParserListener.java", "diffHunk": "@@ -55,7 +55,8 @@ public void exitColumnCreateTable(MySqlParser.ColumnCreateTableContext ctx) {\n         parser.runIfNotNull(() -> {\n             // Make sure that the table's character set has been set ...\n             if (!tableEditor.hasDefaultCharsetName()) {\n-                tableEditor.setDefaultCharsetName(parser.currentDatabaseCharset());\n+                final String defaultDatabaseCharset = parser.charsetNameForDatabase().get(tableEditor.tableId().catalog());\n+                tableEditor.setDefaultCharsetName(defaultDatabaseCharset != null ? defaultDatabaseCharset : parser.currentDatabaseCharset());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwNzQyMw==", "bodyText": "It reads character_set_database db variable which is set to the database to which Debezium JDBC client is connected, not to table/database DDL which is now parsing and processing.", "url": "https://github.com/debezium/debezium/pull/1871#discussion_r500007423", "createdAt": "2020-10-06T05:03:48Z", "author": {"login": "jpechane"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/listener/CreateTableParserListener.java", "diffHunk": "@@ -55,7 +55,8 @@ public void exitColumnCreateTable(MySqlParser.ColumnCreateTableContext ctx) {\n         parser.runIfNotNull(() -> {\n             // Make sure that the table's character set has been set ...\n             if (!tableEditor.hasDefaultCharsetName()) {\n-                tableEditor.setDefaultCharsetName(parser.currentDatabaseCharset());\n+                final String defaultDatabaseCharset = parser.charsetNameForDatabase().get(tableEditor.tableId().catalog());\n+                tableEditor.setDefaultCharsetName(defaultDatabaseCharset != null ? defaultDatabaseCharset : parser.currentDatabaseCharset());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwNTI2Mw=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA0NjgzNA==", "bodyText": "I see. Does this mean db variable will override table/database DDL which is now parsing? How about the cases when column level is UTF8mb4 but db variable is latin2? In this case, the column will be misintepreted as latin2 but is supposed to be encoded as UTF8mb4", "url": "https://github.com/debezium/debezium/pull/1871#discussion_r500046834", "createdAt": "2020-10-06T07:00:04Z", "author": {"login": "victorxiang30"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/listener/CreateTableParserListener.java", "diffHunk": "@@ -55,7 +55,8 @@ public void exitColumnCreateTable(MySqlParser.ColumnCreateTableContext ctx) {\n         parser.runIfNotNull(() -> {\n             // Make sure that the table's character set has been set ...\n             if (!tableEditor.hasDefaultCharsetName()) {\n-                tableEditor.setDefaultCharsetName(parser.currentDatabaseCharset());\n+                final String defaultDatabaseCharset = parser.charsetNameForDatabase().get(tableEditor.tableId().catalog());\n+                tableEditor.setDefaultCharsetName(defaultDatabaseCharset != null ? defaultDatabaseCharset : parser.currentDatabaseCharset());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwNTI2Mw=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1MTA3MQ==", "bodyText": "No the logic is\n\nif column has its own charset then use it\nif table has default charset then use it\nif database to which the table belongs has a charset value then use it", "url": "https://github.com/debezium/debezium/pull/1871#discussion_r500051071", "createdAt": "2020-10-06T07:09:21Z", "author": {"login": "jpechane"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/listener/CreateTableParserListener.java", "diffHunk": "@@ -55,7 +55,8 @@ public void exitColumnCreateTable(MySqlParser.ColumnCreateTableContext ctx) {\n         parser.runIfNotNull(() -> {\n             // Make sure that the table's character set has been set ...\n             if (!tableEditor.hasDefaultCharsetName()) {\n-                tableEditor.setDefaultCharsetName(parser.currentDatabaseCharset());\n+                final String defaultDatabaseCharset = parser.charsetNameForDatabase().get(tableEditor.tableId().catalog());\n+                tableEditor.setDefaultCharsetName(defaultDatabaseCharset != null ? defaultDatabaseCharset : parser.currentDatabaseCharset());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwNTI2Mw=="}, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4124, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}