{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMDkxMDMy", "number": 2024, "title": "DBZ-2868 imprt TestDatabase as QuarkusTestResource for debezium-server IT tests", "bodyText": "https://issues.redhat.com/browse/DBZ-2868\nimplementing QuarkusTestResourceLifecycleManager with TestDatabase it simplifies IT tests\ni will open jira ticket if the changes looks ok", "createdAt": "2020-12-20T16:18:20Z", "url": "https://github.com/debezium/debezium/pull/2024", "merged": true, "mergeCommit": {"oid": "dfd7b02554cfc73d848a1b8c2336ed22afe5d4d3"}, "closed": true, "closedAt": "2021-01-12T16:47:17Z", "author": {"login": "ismailsimsek"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoRBkFAFqTU1NjE4MjUxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvbnflgH2gAyNTQzMDkxMDMyOjg5NjliNjgzZTZiM2ZjNWRhYTkxYjBlZDI1ZDVmYzk4YTY4ODdkZjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTgyNTEy", "url": "https://github.com/debezium/debezium/pull/2024#pullrequestreview-556182512", "createdAt": "2020-12-21T07:43:32Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzo0MzozMlrOIJO-Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNzo0MzozMlrOIJO-Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MzM5MA==", "bodyText": "Where is this used?", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546553390", "createdAt": "2020-12-21T07:43:32Z", "author": {"login": "gunnarmorling"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/DebeziumServerIT.java", "diffHunk": "@@ -26,32 +26,22 @@\n  * @author Jiri Pechanec\n  */\n @QuarkusTest\n+@QuarkusTestResource(TestDatabase.class)\n public class DebeziumServerIT {\n \n     private static final int MESSAGE_COUNT = 4;\n-    protected static TestDatabase db = null;\n+    @Inject\n+    DebeziumServer server;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MjMyMDk3", "url": "https://github.com/debezium/debezium/pull/2024#pullrequestreview-556232097", "createdAt": "2020-12-21T09:14:09Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNDoxMFrOIJRSoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNDoxMFrOIJRSoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTM5Mg==", "bodyText": "@gunnarmorling  Maybe we can move https://github.com/debezium/debezium-ui-poc/blob/master/backend/src/test/java/io/debezium/configserver/util/PostgresInfrastructureTestResourceLifecycleManager.java from the UI PoC to debezium-testing-testcontainers as \"PostgresTestResourceLifecycleManager\" instead? This is related to @ani-sha's current work, isn't it?", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546591392", "createdAt": "2020-12-21T09:14:10Z", "author": {"login": "rk3rn3r"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -6,16 +6,20 @@\n package io.debezium.server;\n \n import java.time.Duration;\n+import java.util.Collections;\n+import java.util.Map;\n \n import org.junit.jupiter.api.Assertions;\n import org.testcontainers.containers.FixedHostPortGenericContainer;\n import org.testcontainers.containers.GenericContainer;\n import org.testcontainers.containers.wait.strategy.Wait;\n \n+import io.quarkus.test.common.QuarkusTestResourceLifecycleManager;\n+\n /**\n  * @author Jiri Pechanec\n  */\n-public class TestDatabase {\n+public class TestDatabase implements QuarkusTestResourceLifecycleManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MjMyNzU5", "url": "https://github.com/debezium/debezium/pull/2024#pullrequestreview-556232759", "createdAt": "2020-12-21T09:15:12Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNToxMlrOIJRUtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOToxNToxMlrOIJRUtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTkyNg==", "bodyText": "This should not be a fixed port. Instead use dynamic port assignment and configure quarkus like shown in the UI PoC implementation: https://github.com/debezium/debezium-ui-poc/blob/master/backend/src/test/java/io/debezium/configserver/util/PostgresInfrastructureTestResourceLifecycleManager.java#L16", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546591926", "createdAt": "2020-12-21T09:15:12Z", "author": {"login": "rk3rn3r"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -26,7 +30,7 @@\n \n     private GenericContainer container;\n \n-    public void start() {\n+    public Map<String, String> start() {\n         try {\n \n             container = new FixedHostPortGenericContainer(POSTGRES_IMAGE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzI5Mzgx", "url": "https://github.com/debezium/debezium/pull/2024#pullrequestreview-556329381", "createdAt": "2020-12-21T12:00:40Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMjowMDo0MFrOIJV9cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMjoyNDozNFrOIJWjUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY2Nzg5MA==", "bodyText": "not 100% sure but, i believe this needed to start debezium-server and consume events, test that events are generated.\nused in line 56\n        final TestConsumer testConsumer = (TestConsumer) server.getConsumer();", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546667890", "createdAt": "2020-12-21T12:00:40Z", "author": {"login": "ismailsimsek"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/DebeziumServerIT.java", "diffHunk": "@@ -26,32 +26,22 @@\n  * @author Jiri Pechanec\n  */\n @QuarkusTest\n+@QuarkusTestResource(TestDatabase.class)\n public class DebeziumServerIT {\n \n     private static final int MESSAGE_COUNT = 4;\n-    protected static TestDatabase db = null;\n+    @Inject\n+    DebeziumServer server;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MzM5MA=="}, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3NzU4NA==", "bodyText": "makes sense, also it seems like FixedHostPortGenericContainer deprecated. is it possible to pass the dynamic port to  ConfigSource before the server initializes?\nneed to check how to pas dynamic port to TestConfigSource.java and set property  'debezium.source.database.port'", "url": "https://github.com/debezium/debezium/pull/2024#discussion_r546677584", "createdAt": "2020-12-21T12:24:34Z", "author": {"login": "ismailsimsek"}, "path": "debezium-server/debezium-server-core/src/test/java/io/debezium/server/TestDatabase.java", "diffHunk": "@@ -26,7 +30,7 @@\n \n     private GenericContainer container;\n \n-    public void start() {\n+    public Map<String, String> start() {\n         try {\n \n             container = new FixedHostPortGenericContainer(POSTGRES_IMAGE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5MTkyNg=="}, "originalCommit": null, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23c7802e0998f277dc4dae368a3b0d5775e3514", "author": {"user": {"login": "ismailsimsek", "name": "ismail simsek"}}, "url": "https://github.com/debezium/debezium/commit/e23c7802e0998f277dc4dae368a3b0d5775e3514", "committedDate": "2021-01-08T12:26:25Z", "message": "DBZ-2868 change TestDatabase to QuarkusTestResource for debezium-server integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "e23c7802e0998f277dc4dae368a3b0d5775e3514", "author": {"user": {"login": "ismailsimsek", "name": "ismail simsek"}}, "url": "https://github.com/debezium/debezium/commit/e23c7802e0998f277dc4dae368a3b0d5775e3514", "committedDate": "2021-01-08T12:26:25Z", "message": "DBZ-2868 change TestDatabase to QuarkusTestResource for debezium-server integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf6a8c10e33a67049c27dba1ab1e4ee3dc72f20d", "author": {"user": {"login": "ismailsimsek", "name": "ismail simsek"}}, "url": "https://github.com/debezium/debezium/commit/bf6a8c10e33a67049c27dba1ab1e4ee3dc72f20d", "committedDate": "2021-01-08T19:07:05Z", "message": "DBZ-2868 move TestDatabase to debezium-testing-testcontainers project and rename to PostgresTestResourceLifecycleManager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "bf6a8c10e33a67049c27dba1ab1e4ee3dc72f20d", "author": {"user": {"login": "ismailsimsek", "name": "ismail simsek"}}, "url": "https://github.com/debezium/debezium/commit/bf6a8c10e33a67049c27dba1ab1e4ee3dc72f20d", "committedDate": "2021-01-08T19:07:05Z", "message": "DBZ-2868 move TestDatabase to debezium-testing-testcontainers project and rename to PostgresTestResourceLifecycleManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8969b683e6b3fc5daa91b0ed25d5fc98a6887df7", "author": {"user": {"login": "gunnarmorling", "name": "Gunnar Morling"}}, "url": "https://github.com/debezium/debezium/commit/8969b683e6b3fc5daa91b0ed25d5fc98a6887df7", "committedDate": "2021-01-12T14:02:15Z", "message": "DBZ-2868 Removing superfluous property definitions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2278, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}