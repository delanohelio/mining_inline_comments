{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MjgxMzc5", "number": 1723, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMzoyODozMVrOETQP0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0NDoxMlrOETScnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NjI0NTk1OnYy", "diffSide": "RIGHT", "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/Filters.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMzoyODozMVrOG44a8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjoxMDoxNlrOG5Uang==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI5Nzg0MQ==", "bodyText": "Maybe we should later make this a config property (might be in RelationalDatabaseConnectorConfig) that gets sane defaults by different connector implementations (mysql will set this default list, PG a different one)?\nOr one step ahead, what about configuring \"database.environment\" where users can select things like amazon_rds_mysql, amazon_rds_postgres, standard_mysql, standard_postgres_huge_transactions, etc and we pick \"the best defaults\" and correct builtin tables? might make some people's life easier?", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r462297841", "createdAt": "2020-07-29T13:28:31Z", "author": {"login": "rk3rn3r"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/Filters.java", "diffHunk": "@@ -30,49 +27,53 @@\n \n     protected static final Set<String> BUILT_IN_DB_NAMES = Collect.unmodifiableSet(\"mysql\", \"performance_schema\", \"sys\", \"information_schema\");\n \n+    /**\n+     * A list of tables that are always ignored. Useful for ignoring \"phantom\"\n+     * tables occasionally exposed by services such as Amazon RDS Aurora. See\n+     * DBZ-1939.\n+     */\n+    private static final Set<String> IGNORED_TABLE_NAMES = Collect.unmodifiableSet(\n+            \"mysql.rds_configuration\",\n+            \"mysql.rds_global_status_history\",\n+            \"mysql.rds_global_status_history_old\",\n+            \"mysql.rds_history\",\n+            \"mysql.rds_replication_status\",\n+            \"mysql.rds_sysinfo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NjUxMA==", "bodyText": "Perhaps, but I don't think it's needed. Let's not overcomplicate things by adding too many knobs and options. Also keep in mind that the issue supposedly is fixed by AWS (in some cases?) already.", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r462756510", "createdAt": "2020-07-30T06:10:16Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/Filters.java", "diffHunk": "@@ -30,49 +27,53 @@\n \n     protected static final Set<String> BUILT_IN_DB_NAMES = Collect.unmodifiableSet(\"mysql\", \"performance_schema\", \"sys\", \"information_schema\");\n \n+    /**\n+     * A list of tables that are always ignored. Useful for ignoring \"phantom\"\n+     * tables occasionally exposed by services such as Amazon RDS Aurora. See\n+     * DBZ-1939.\n+     */\n+    private static final Set<String> IGNORED_TABLE_NAMES = Collect.unmodifiableSet(\n+            \"mysql.rds_configuration\",\n+            \"mysql.rds_global_status_history\",\n+            \"mysql.rds_global_status_history_old\",\n+            \"mysql.rds_history\",\n+            \"mysql.rds_replication_status\",\n+            \"mysql.rds_sysinfo\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI5Nzg0MQ=="}, "originalCommit": null, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NjYwNjM5OnYy", "diffSide": "RIGHT", "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/SnapshotReader.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0NDoxMlrOG477tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNTo1Mjo0NVrOG5pRcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NTM4MQ==", "bodyText": "So this would solve the \"phantom\" tables issue but will unfortunately cause a regression:\nConfig:\ndatabase.history.store.only.monitored.tables.ddl=false\ntable.whitelist=mydb.table1\n\nInput:\nid: mydb.table2\n\nPredicate:\nif (!filters.tableFilter().test(id)) {\n   return false;\n}\n\nWill then return false which is not what we want for this configuration.", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r462355381", "createdAt": "2020-07-29T14:44:12Z", "author": {"login": "okayrunner"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/SnapshotReader.java", "diffHunk": "@@ -866,8 +866,16 @@ private void readTableSchema(final AtomicReference<String> sql, final JdbcConnec\n         });\n     }\n \n-    private boolean shouldRecordTableSchema(final MySqlSchema schema, final Filters filters, TableId id) {\n-        return !schema.isStoreOnlyMonitoredTablesDdl() || filters.tableFilter().test(id);\n+    /**\n+     * Whether DDL for the given table should be recorded.\n+     */\n+    private boolean shouldRecordTableSchema(MySqlSchema schema, Filters filters, TableId id) {\n+        // filtered, built-in, or globally ignored table\n+        if (!filters.tableFilter().test(id)) {\n+            return false;\n+        }\n+\n+        return !schema.isStoreOnlyMonitoredTablesDdl();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc2NTQwMQ==", "bodyText": "Yeah :( Seems there's indeed no way around querying the ignore predicate separately.", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r462765401", "createdAt": "2020-07-30T06:34:02Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/SnapshotReader.java", "diffHunk": "@@ -866,8 +866,16 @@ private void readTableSchema(final AtomicReference<String> sql, final JdbcConnec\n         });\n     }\n \n-    private boolean shouldRecordTableSchema(final MySqlSchema schema, final Filters filters, TableId id) {\n-        return !schema.isStoreOnlyMonitoredTablesDdl() || filters.tableFilter().test(id);\n+    /**\n+     * Whether DDL for the given table should be recorded.\n+     */\n+    private boolean shouldRecordTableSchema(MySqlSchema schema, Filters filters, TableId id) {\n+        // filtered, built-in, or globally ignored table\n+        if (!filters.tableFilter().test(id)) {\n+            return false;\n+        }\n+\n+        return !schema.isStoreOnlyMonitoredTablesDdl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NTM4MQ=="}, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA5NDEyNQ==", "bodyText": "Not unless we somehow refactor the database.history.store.only.monitored.tables.ddl to be visible in the Filters class in order to take it into account internally? But I'm not sure what's LOE there.", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r463094125", "createdAt": "2020-07-30T15:46:53Z", "author": {"login": "okayrunner"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/SnapshotReader.java", "diffHunk": "@@ -866,8 +866,16 @@ private void readTableSchema(final AtomicReference<String> sql, final JdbcConnec\n         });\n     }\n \n-    private boolean shouldRecordTableSchema(final MySqlSchema schema, final Filters filters, TableId id) {\n-        return !schema.isStoreOnlyMonitoredTablesDdl() || filters.tableFilter().test(id);\n+    /**\n+     * Whether DDL for the given table should be recorded.\n+     */\n+    private boolean shouldRecordTableSchema(MySqlSchema schema, Filters filters, TableId id) {\n+        // filtered, built-in, or globally ignored table\n+        if (!filters.tableFilter().test(id)) {\n+            return false;\n+        }\n+\n+        return !schema.isStoreOnlyMonitoredTablesDdl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NTM4MQ=="}, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA5ODIyNw==", "bodyText": "Yeah, in any case not worth the effort at this point. There's larger refactorings ahead for the MySQL connector in general and filter handling in particular.", "url": "https://github.com/debezium/debezium/pull/1723#discussion_r463098227", "createdAt": "2020-07-30T15:52:45Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/SnapshotReader.java", "diffHunk": "@@ -866,8 +866,16 @@ private void readTableSchema(final AtomicReference<String> sql, final JdbcConnec\n         });\n     }\n \n-    private boolean shouldRecordTableSchema(final MySqlSchema schema, final Filters filters, TableId id) {\n-        return !schema.isStoreOnlyMonitoredTablesDdl() || filters.tableFilter().test(id);\n+    /**\n+     * Whether DDL for the given table should be recorded.\n+     */\n+    private boolean shouldRecordTableSchema(MySqlSchema schema, Filters filters, TableId id) {\n+        // filtered, built-in, or globally ignored table\n+        if (!filters.tableFilter().test(id)) {\n+            return false;\n+        }\n+\n+        return !schema.isStoreOnlyMonitoredTablesDdl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NTM4MQ=="}, "originalCommit": null, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4259, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}