{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjUzNTAx", "number": 1412, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NDo0MFrODx_9wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowOFrODyHbWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzU0ODE2OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NDo0MFrOGFyYyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0MDoyN1rOGFz7wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyMTYxMQ==", "bodyText": "@gunnarmorling Maybe add a comment that this is only temporary restriction?", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408721611", "createdAt": "2020-04-15T09:54:40Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);\n+        String language = config.getStringNonEmpty(LANGUAGE);\n+\n+        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language, expression);\n \n         nullHandling = NullHandling.parse(config.getString(NULL_HANDLING));\n \n-        try {\n-            engine = language.getEngine().newInstance();\n+        if (!language.startsWith(JAVAX_SCRIPT_ENGINE_PREFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0Njk0NQ==", "bodyText": "Pushed an update for that.", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408746945", "createdAt": "2020-04-15T10:40:27Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);\n+        String language = config.getStringNonEmpty(LANGUAGE);\n+\n+        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language, expression);\n \n         nullHandling = NullHandling.parse(config.getString(NULL_HANDLING));\n \n-        try {\n-            engine = language.getEngine().newInstance();\n+        if (!language.startsWith(JAVAX_SCRIPT_ENGINE_PREFIX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyMTYxMQ=="}, "originalCommit": null, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzU3NDU0OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowMTo0NFrOGFyo7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzoxNToxMVrOGF5GbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg==", "bodyText": "As enum is no longer used would it it be better to switch to the withValidator on config definition?", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408725742", "createdAt": "2020-04-15T10:01:44Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0NTkyNA==", "bodyText": "Good idea in general; just tried it, but it seems validation logic isn't invoked (expected DebeziumException isn't raised). Is this supported for SMT options actually?", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408745924", "createdAt": "2020-04-15T10:38:51Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg=="}, "originalCommit": null, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1OTQxMg==", "bodyText": "@gunnarmorling IMHO you need to call config.validate(), see ExtractNewRecord for example", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408759412", "createdAt": "2020-04-15T11:04:57Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg=="}, "originalCommit": null, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgyNDgwMw==", "bodyText": "Gotcha, pushed an update for that.", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408824803", "createdAt": "2020-04-15T13:04:31Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg=="}, "originalCommit": null, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgzMTU5Ng==", "bodyText": "@gunnarmorling Looks like there is a formatting issue", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408831596", "createdAt": "2020-04-15T13:15:11Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg=="}, "originalCommit": null, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODI0MjI0OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/config/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzoxNDo0N1rOGF5Faw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzozNTozNFrOGF5-QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgzMTMzOQ==", "bodyText": "@gunnarmorling No longer used", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408831339", "createdAt": "2020-04-15T13:14:47Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/config/Configuration.java", "diffHunk": "@@ -1019,6 +1020,28 @@ default String getString(String key, Supplier<String> defaultValueSupplier) {\n         return value != null ? value : (defaultValueSupplier != null ? defaultValueSupplier.get() : null);\n     }\n \n+    /**\n+     * Get the string value associated with the given field.\n+     *\n+     * @param field the field; may not be null\n+     * @return the configuration's value for the field, never {@code null} or empty.\n+     *\n+     * @throws DebeziumException If if the configuration doesn't have a non-empty value for the given field\n+     */\n+    default String getStringNonEmpty(Field field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg0NTg4OA==", "bodyText": "Removed.", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408845888", "createdAt": "2020-04-15T13:35:34Z", "author": {"login": "gunnarmorling"}, "path": "debezium-core/src/main/java/io/debezium/config/Configuration.java", "diffHunk": "@@ -1019,6 +1020,28 @@ default String getString(String key, Supplier<String> defaultValueSupplier) {\n         return value != null ? value : (defaultValueSupplier != null ? defaultValueSupplier.get() : null);\n     }\n \n+    /**\n+     * Get the string value associated with the given field.\n+     *\n+     * @param field the field; may not be null\n+     * @return the configuration's value for the field, never {@code null} or empty.\n+     *\n+     * @throws DebeziumException If if the configuration doesn't have a non-empty value for the given field\n+     */\n+    default String getStringNonEmpty(Field field) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgzMTMzOQ=="}, "originalCommit": null, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODc3MDU5OnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowNVrOGF-UaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowNVrOGF-UaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkxNzA5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Evaluates whether the record should be filtered out or not by executing the expression.\n          \n          \n            \n                 * Evaluates whether the record matches the predicate expression.", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408917097", "createdAt": "2020-04-15T15:08:05Z", "author": {"login": "Naros"}, "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "diffHunk": "@@ -26,7 +26,7 @@\n      * Evaluates whether the record should be filtered out or not by executing the expression.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODc3MDgzOnYy", "diffSide": "RIGHT", "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowOFrOGF-Ukg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowOFrOGF-Ukg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkxNzEzOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return true to keep the record, false to remove it\n          \n          \n            \n                 * @return true if the input argument matches the predicate expression, otherwise false", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408917138", "createdAt": "2020-04-15T15:08:08Z", "author": {"login": "Naros"}, "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "diffHunk": "@@ -26,7 +26,7 @@\n      * Evaluates whether the record should be filtered out or not by executing the expression.\n      *\n      * @param record to be evaluated\n-     * @return true to remove the record, false to keep it\n+     * @return true to keep the record, false to remove it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4386, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}