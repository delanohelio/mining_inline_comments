{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MzIzMjIx", "number": 1563, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo0ODoyNVrOED1eMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo0ODoyNVrOED1eMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDU3MjY0OnYy", "diffSide": "RIGHT", "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo0ODoyNlrOGhFhew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo0MToxNlrOGhNeTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw==", "bodyText": "It's not so unexpected then as per the comment above?", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437346683", "createdAt": "2020-06-09T11:48:26Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1NDE3Mg==", "bodyText": "Well yes but I don't understand why this happens. What I observed are two ROTATE events sequentially received with one of them with no timestamp (they are identical, this aside). And there are plenty of other events so maybe that's not the only case, maybe I should edit a bit the comment?", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437354172", "createdAt": "2020-06-09T12:02:30Z", "author": {"login": "ebrard"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw=="}, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQyODQ1OQ==", "bodyText": "yes +1; the note to ROTATE is more confusing than anything else then, I think.", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437428459", "createdAt": "2020-06-09T13:43:37Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw=="}, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0MTE2Ng==", "bodyText": "alright, let me modify it a bit", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437441166", "createdAt": "2020-06-09T13:55:43Z", "author": {"login": "ebrard"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw=="}, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0Mzc4Mw==", "bodyText": "I removed it.", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437443783", "createdAt": "2020-06-09T13:58:17Z", "author": {"login": "ebrard"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw=="}, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3Njk0Mw==", "bodyText": "Thx!", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437476943", "createdAt": "2020-06-09T14:41:16Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw=="}, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4288, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}