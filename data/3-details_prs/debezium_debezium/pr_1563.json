{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MzIzMjIx", "number": 1563, "title": "DBZ-1989 Avoid returning distorted (Milli)SecondsBehindSource values", "bodyText": "https://issues.jboss.org/browse/DBZ-1989", "createdAt": "2020-06-05T09:05:57Z", "url": "https://github.com/debezium/debezium/pull/1563", "merged": true, "mergeCommit": {"oid": "c7ef4128dbd19529d96cc778eb41f4a51fa34ade"}, "closed": true, "closedAt": "2020-06-09T15:21:09Z", "author": {"login": "ebrard"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoO6QGgH2gAyNDI4MzIzMjIxOjFkZWQwMGFmY2U4OWNmMWJlZDFiOGQ3NjFjNjQ0OWI3MDZjMjY4NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcplfUCAH2gAyNDI4MzIzMjIxOjA2NWRkZmFhOTA3NDUyMDNiYTVhMzY3OGQwYTdkODFiOWJjODg4ZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1ded00afce89cf1bed1b8d761c6449b706c26862", "author": {"user": {"login": "ebrard", "name": "Emmanuel"}}, "url": "https://github.com/debezium/debezium/commit/1ded00afce89cf1bed1b8d761c6449b706c26862", "committedDate": "2020-06-05T09:05:21Z", "message": "DBZ-1989 Avoid returning distorted (Milli)SecondsBehindSource values in jmx mbean of same name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2", "author": {"user": {"login": "ebrard", "name": "Emmanuel"}}, "url": "https://github.com/debezium/debezium/commit/bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2", "committedDate": "2020-06-09T11:22:24Z", "message": "DBZ-1989 Get (Milli)SecondsBehindSource from event timestamp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MDU3NjA4", "url": "https://github.com/debezium/debezium/pull/1563#pullrequestreview-427057608", "createdAt": "2020-06-09T11:48:25Z", "commit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo0ODoyNlrOGhFhew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo0ODoyNlrOGhFhew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0NjY4Mw==", "bodyText": "It's not so unexpected then as per the comment above?", "url": "https://github.com/debezium/debezium/pull/1563#discussion_r437346683", "createdAt": "2020-06-09T11:48:26Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/BinlogReader.java", "diffHunk": "@@ -494,6 +495,33 @@ protected void logEvent(Event event) {\n         logger.trace(\"Received event: {}\", event);\n     }\n \n+    protected void onEvent(Event event) {\n+        long ts = 0;\n+\n+        if (event.getHeader().getEventType() == EventType.HEARTBEAT) {\n+            // HEARTBEAT events have no timestamp but are fired only when\n+            // there is no traffic on the connection which means we are caught-up\n+            // https://dev.mysql.com/doc/internals/en/heartbeat-event.html\n+            metrics.setMilliSecondsBehindSource(ts);\n+            return;\n+        }\n+\n+        // MySQL has seconds resolution but mysql-binlog-connector-java returns\n+        // a value in milliseconds\n+        long eventTs = event.getHeader().getTimestamp();\n+\n+        if (eventTs == 0) {\n+            // A zero-valued timestamp can also happen if case of ROTATE events\n+            // in which case we keep the previous value\n+            logger.trace(\"Received unexpected event with 0 timestamp: {}\", event);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6cceda49e50c2132f1fa7eb72e03eba4eb09d2"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "065ddfaa90745203ba5a3678d0a7d81b9bc888fd", "author": {"user": {"login": "ebrard", "name": "Emmanuel"}}, "url": "https://github.com/debezium/debezium/commit/065ddfaa90745203ba5a3678d0a7d81b9bc888fd", "committedDate": "2020-06-09T13:57:40Z", "message": "DBZ-1989 Get (Milli)SecondsBehindSource from event timestamp"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2578, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}