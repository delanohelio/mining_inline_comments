{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMTk5MzE2", "number": 1295, "title": "DBZ-1834 Support dots in table names", "bodyText": "https://issues.redhat.com/browse/DBZ-1834", "createdAt": "2020-03-02T06:26:29Z", "url": "https://github.com/debezium/debezium/pull/1295", "merged": true, "mergeCommit": {"oid": "e4b4aa818aab2b349b6a697857ea6d958b4b754b"}, "closed": true, "closedAt": "2020-03-03T09:56:21Z", "author": {"login": "jpechane"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJnsNNgH2gAyMzgyMTk5MzE2OmE1OTg5YmU0ZWRmZWNkOGU2NTlhN2ZiYjgyNDBjNmFkMzI3YjkzOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJqsugABqjMwODcyMDgyMjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5989be4edfecd8e659a7fbb8240c6ad327b9399", "author": {"user": {"login": "jpechane", "name": "Jiri Pechanec"}}, "url": "https://github.com/debezium/debezium/commit/a5989be4edfecd8e659a7fbb8240c6ad327b9399", "committedDate": "2020-03-02T06:25:59Z", "message": "DBZ-1834 Support dots in table names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDA4OTA0", "url": "https://github.com/debezium/debezium/pull/1295#pullrequestreview-367008904", "createdAt": "2020-03-02T08:13:20Z", "commit": {"oid": "a5989be4edfecd8e659a7fbb8240c6ad327b9399"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODoxMzoyMFrOFwWhOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODoxMzoyMFrOFwWhOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI0NDkyMw==", "bodyText": "Couldn't we encounter something like inventory.`My.Table` ?", "url": "https://github.com/debezium/debezium/pull/1295#discussion_r386244923", "createdAt": "2020-03-02T08:13:20Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/MySqlAntlrDdlParser.java", "diffHunk": "@@ -215,7 +215,8 @@ public String parseName(MySqlParser.UidContext uidContext) {\n     public TableId parseQualifiedTableId(MySqlParser.FullIdContext fullIdContext) {\n         String fullTableName = fullIdContext.getText();\n         int dotIndex;\n-        if ((dotIndex = fullTableName.indexOf(\".\")) > 0) {\n+        // The quoted table name that contains dot means that it is just a part of the name of the table\n+        if (!isQuoted(fullTableName) && ((dotIndex = fullTableName.indexOf(\".\")) > 0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5989be4edfecd8e659a7fbb8240c6ad327b9399"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb316be4123dec2472e4c2ca4303c8e50c65dec3", "author": {"user": {"login": "jpechane", "name": "Jiri Pechanec"}}, "url": "https://github.com/debezium/debezium/commit/cb316be4123dec2472e4c2ca4303c8e50c65dec3", "committedDate": "2020-03-02T08:14:43Z", "message": "DBZ-1834 Support separately quoted schema and table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDI1OTM5", "url": "https://github.com/debezium/debezium/pull/1295#pullrequestreview-367025939", "createdAt": "2020-03-02T08:47:01Z", "commit": {"oid": "cb316be4123dec2472e4c2ca4303c8e50c65dec3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODo0NzowMVrOFwXWJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODo0NzowMVrOFwXWJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI1ODQ2OA==", "bodyText": "Do we have any test for this case actually? How would escaping of the quote look like?", "url": "https://github.com/debezium/debezium/pull/1295#discussion_r386258468", "createdAt": "2020-03-02T08:47:01Z", "author": {"login": "gunnarmorling"}, "path": "debezium-connector-mysql/src/main/java/io/debezium/connector/mysql/antlr/MySqlAntlrDdlParser.java", "diffHunk": "@@ -213,15 +213,39 @@ public String parseName(MySqlParser.UidContext uidContext) {\n      * @return qualified {@link TableId}.\n      */\n     public TableId parseQualifiedTableId(MySqlParser.FullIdContext fullIdContext) {\n-        String fullTableName = fullIdContext.getText();\n-        int dotIndex;\n-        if ((dotIndex = fullTableName.indexOf(\".\")) > 0) {\n-            return resolveTableId(withoutQuotes(fullTableName.substring(0, dotIndex)),\n-                    withoutQuotes(fullTableName.substring(dotIndex + 1, fullTableName.length())));\n-        }\n-        else {\n-            return resolveTableId(currentSchema(), withoutQuotes(fullTableName));\n+        final char[] fullTableName = fullIdContext.getText().toCharArray();\n+        StringBuilder component = new StringBuilder();\n+        String dbName = null;\n+        String tableName = null;\n+        final char EMPTY = '\\0';\n+        char lastQuote = EMPTY;\n+        for (char c : fullTableName) {\n+            if (isQuote(c)) {\n+                // Opening quote\n+                if (lastQuote == EMPTY) {\n+                    lastQuote = c;\n+                }\n+                // Closing quote\n+                else if (lastQuote == c) {\n+                    lastQuote = EMPTY;\n+                }\n+                // Quote that is part of name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb316be4123dec2472e4c2ca4303c8e50c65dec3"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76463ed928ab332dd96d0864dd7dc79d1cc9583f", "author": {"user": {"login": "jpechane", "name": "Jiri Pechanec"}}, "url": "https://github.com/debezium/debezium/commit/76463ed928ab332dd96d0864dd7dc79d1cc9583f", "committedDate": "2020-03-02T09:56:05Z", "message": "DBZ-1834 Support for escaping"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "76463ed928ab332dd96d0864dd7dc79d1cc9583f", "author": {"user": {"login": "jpechane", "name": "Jiri Pechanec"}}, "url": "https://github.com/debezium/debezium/commit/76463ed928ab332dd96d0864dd7dc79d1cc9583f", "committedDate": "2020-03-02T09:56:05Z", "message": "DBZ-1834 Support for escaping"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2084, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}