{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjUzNTAx", "number": 1412, "title": "DBZ-1782 Allowing any JSR 223 implementation for filtering SMT", "bodyText": "https://issues.redhat.com/browse/DBZ-1782\n@jpechane, as discussed.", "createdAt": "2020-04-15T09:45:17Z", "url": "https://github.com/debezium/debezium/pull/1412", "merged": true, "mergeCommit": {"oid": "786aab37d9d8f17b78866643885ebd8edf429e05"}, "closed": true, "closedAt": "2020-04-15T15:52:36Z", "author": {"login": "gunnarmorling"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX1DEwAFqTM5MzYyNTYyNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX6Kc5gH2gAyNDAzNjUzNTAxOjUyYjcxNzJjNzUxM2I4NzNiMzVkZjlhMWJmNDUwMTk2ZjYwNWM3YmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjI1NjI0", "url": "https://github.com/debezium/debezium/pull/1412#pullrequestreview-393625624", "createdAt": "2020-04-15T09:54:40Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NDo0MFrOGFyYyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTo1NDo0MFrOGFyYyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyMTYxMQ==", "bodyText": "@gunnarmorling Maybe add a comment that this is only temporary restriction?", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408721611", "createdAt": "2020-04-15T09:54:40Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);\n+        String language = config.getStringNonEmpty(LANGUAGE);\n+\n+        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language, expression);\n \n         nullHandling = NullHandling.parse(config.getString(NULL_HANDLING));\n \n-        try {\n-            engine = language.getEngine().newInstance();\n+        if (!language.startsWith(JAVAX_SCRIPT_ENGINE_PREFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 112}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjMwODc3", "url": "https://github.com/debezium/debezium/pull/1412#pullrequestreview-393630877", "createdAt": "2020-04-15T10:01:44Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowMTo0NFrOGFyo7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowMTo0NFrOGFyo7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNTc0Mg==", "bodyText": "As enum is no longer used would it it be better to switch to the withValidator on config definition?", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408725742", "createdAt": "2020-04-15T10:01:44Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/transforms/Filter.java", "diffHunk": "@@ -178,31 +120,32 @@ public static NullHandling parse(String value, String defaultValue) {\n     private Engine engine;\n     private NullHandling nullHandling;\n \n-    public Filter() {\n-    }\n-\n     @Override\n     public void configure(Map<String, ?> configs) {\n         final Configuration config = Configuration.from(configs);\n-        final ExpressionLanguage language = ExpressionLanguage.parse(config.getString(LANGUAGE));\n-        final String expression = config.getString(EXPRESSION);\n-        if (language == null || expression == null) {\n-            throw new DebeziumException(\n-                    \"Options '\" + LANGUAGE + \"' and '\" + EXPRESSION + \"' must be present. Language must be one of (\" + Arrays.toString(ExpressionLanguage.values())\n-                            + \")\");\n-        }\n-        LOGGER.info(\"Using language '{}' to evaluate expression '{}'\", language.getValue(), expression);\n+        final String expression = config.getStringNonEmpty(EXPRESSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 103}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzYwNjAy", "url": "https://github.com/debezium/debezium/pull/1412#pullrequestreview-393760602", "createdAt": "2020-04-15T13:14:47Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzoxNDo0N1rOGF5Faw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzoxNDo0N1rOGF5Faw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgzMTMzOQ==", "bodyText": "@gunnarmorling No longer used", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408831339", "createdAt": "2020-04-15T13:14:47Z", "author": {"login": "jpechane"}, "path": "debezium-core/src/main/java/io/debezium/config/Configuration.java", "diffHunk": "@@ -1019,6 +1020,28 @@ default String getString(String key, Supplier<String> defaultValueSupplier) {\n         return value != null ? value : (defaultValueSupplier != null ? defaultValueSupplier.get() : null);\n     }\n \n+    /**\n+     * Get the string value associated with the given field.\n+     *\n+     * @param field the field; may not be null\n+     * @return the configuration's value for the field, never {@code null} or empty.\n+     *\n+     * @throws DebeziumException If if the configuration doesn't have a non-empty value for the given field\n+     */\n+    default String getStringNonEmpty(Field field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7db6a537f451481b6a7869c74e779f7bf21f653", "author": {"user": {"login": "gunnarmorling", "name": "Gunnar Morling"}}, "url": "https://github.com/debezium/debezium/commit/f7db6a537f451481b6a7869c74e779f7bf21f653", "committedDate": "2020-04-15T13:34:47Z", "message": "DBZ-1782 Allowing any JSR 223 implementation for filtering SMT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff", "author": {"user": {"login": "gunnarmorling", "name": "Gunnar Morling"}}, "url": "https://github.com/debezium/debezium/commit/29e4e7275f348311b8695cd94d67574d73f401ff", "committedDate": "2020-04-15T13:34:47Z", "message": "DBZ-1782 Inverting filtering logic, so to be consistent with Stream#filter() and other similar APIs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff", "author": {"user": {"login": "gunnarmorling", "name": "Gunnar Morling"}}, "url": "https://github.com/debezium/debezium/commit/29e4e7275f348311b8695cd94d67574d73f401ff", "committedDate": "2020-04-15T13:34:47Z", "message": "DBZ-1782 Inverting filtering logic, so to be consistent with Stream#filter() and other similar APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODY4NDM2", "url": "https://github.com/debezium/debezium/pull/1412#pullrequestreview-393868436", "createdAt": "2020-04-15T15:08:05Z", "commit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowNVrOGF-UaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowNVrOGF-UaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkxNzA5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Evaluates whether the record should be filtered out or not by executing the expression.\n          \n          \n            \n                 * Evaluates whether the record matches the predicate expression.", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408917097", "createdAt": "2020-04-15T15:08:05Z", "author": {"login": "Naros"}, "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "diffHunk": "@@ -26,7 +26,7 @@\n      * Evaluates whether the record should be filtered out or not by executing the expression.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODY4NDg0", "url": "https://github.com/debezium/debezium/pull/1412#pullrequestreview-393868484", "createdAt": "2020-04-15T15:08:08Z", "commit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowOFrOGF-Ukg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNTowODowOFrOGF-Ukg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkxNzEzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return true to keep the record, false to remove it\n          \n          \n            \n                 * @return true if the input argument matches the predicate expression, otherwise false", "url": "https://github.com/debezium/debezium/pull/1412#discussion_r408917138", "createdAt": "2020-04-15T15:08:08Z", "author": {"login": "Naros"}, "path": "debezium-core/src/main/java/io/debezium/transforms/filter/Engine.java", "diffHunk": "@@ -26,7 +26,7 @@\n      * Evaluates whether the record should be filtered out or not by executing the expression.\n      *\n      * @param record to be evaluated\n-     * @return true to remove the record, false to keep it\n+     * @return true to keep the record, false to remove it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29e4e7275f348311b8695cd94d67574d73f401ff"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52b7172c7513b873b35df9a1bf450196f605c7bb", "author": {"user": {"login": "gunnarmorling", "name": "Gunnar Morling"}}, "url": "https://github.com/debezium/debezium/commit/52b7172c7513b873b35df9a1bf450196f605c7bb", "committedDate": "2020-04-15T15:52:15Z", "message": "DBZ-1782 JavaDoc improvements;\r\n\r\nAs per Chris's suggestions.\n\nCo-Authored-By: Chris Cranford <ccranfor@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2015, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}