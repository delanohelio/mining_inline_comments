{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0ODc1MzIz", "number": 2873, "title": "NMS-12453: Allow exposing status information (New Graph API)", "bodyText": "Here we provide a foundation to expose status information.\nAt the moment only the status for applications are enriched.\nOthers can be added very easily.\nThe solution is very flexible and generic.\nBesides severity and count, custom properties can be added as well.\nThis allows to be compatible even with the old Topology where we expose some custom styling details via the status object.\nJIRA: https://issues.opennms.org/browse/NMS-12453", "createdAt": "2020-01-20T14:57:16Z", "url": "https://github.com/OpenNMS/opennms/pull/2873", "merged": true, "mergeCommit": {"oid": "03aefb0b72e44df025517b154ee263841fcaef46"}, "closed": true, "closedAt": "2020-01-31T11:32:23Z", "author": {"login": "mvrueden"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8nWlWgFqTM0NjE3NDc1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_rD4fgBqjI5OTYyNTM1OTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MTc0NzUw", "url": "https://github.com/OpenNMS/opennms/pull/2873#pullrequestreview-346174750", "createdAt": "2020-01-21T20:37:46Z", "commit": {"oid": "d6a365fe0ee13e108fe97af8bbe59f0f673ea8ef"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMDozNzo0N1rOFgIBsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMDozODoxOVrOFgIC4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTIzMDI1OQ==", "bodyText": "This is a pretty heavy dependency to add to the API module :)\nLooks like there's no easy way around it if we want to use the OnmsSeverity model though.", "url": "https://github.com/OpenNMS/opennms/pull/2873#discussion_r369230259", "createdAt": "2020-01-21T20:37:47Z", "author": {"login": "j-white"}, "path": "features/graph/api/pom.xml", "diffHunk": "@@ -32,6 +32,10 @@\n             <artifactId>org.opennms.features.graph.jung</artifactId>\n             <version>${jungVersion}</version>\n         </dependency>\n+        <dependency>\n+            <groupId>org.opennms</groupId>\n+            <artifactId>opennms-model</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6a365fe0ee13e108fe97af8bbe59f0f673ea8ef"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTIzMDU2Mg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/OpenNMS/opennms/pull/2873#discussion_r369230562", "createdAt": "2020-01-21T20:38:19Z", "author": {"login": "j-white"}, "path": "smoke-test/src/test/java/org/opennms/smoketest/graph/GraphRestServiceIT.java", "diffHunk": "@@ -361,6 +378,136 @@ public void verifyNodeEnrichment() throws InterruptedException {\n                 .content(\"vertices[2].nodeInfo.categories\", Matchers.hasItems(\"Test\", \"Node\"));\n     }\n \n+    @Test\n+    public void verifyStatusExposureBsm() {\n+        try {\n+            karafShell.runCommand(\"opennms-bsm:generate-hierarchies 5 2\");\n+\n+            // Fetch data\n+            final JSONObject query = new JSONObject().put(\"semanticZoomLevel\", 1);\n+            given().log().ifValidationFails()\n+                    .body(query.toString())\n+                    .contentType(ContentType.JSON)\n+                    .post(\"{container_id}/{namespace}\", \"bsm\", \"bsm\")\n+                    .then()\n+                    .log().ifValidationFails()\n+                    .statusCode(200)\n+                    .contentType(ContentType.JSON)\n+                    .content(\"vertices\", Matchers.hasSize(1))\n+                    .content(\"vertices[0].status\", Matchers.is(\"Normal\"));\n+        } finally {\n+            karafShell.runCommand(\"opennms-bsm:delete-generated-hierarchies\");\n+        }\n+    }\n+\n+    @Test\n+    public void verifyStatusEnrichmentApplication() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6a365fe0ee13e108fe97af8bbe59f0f673ea8ef"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48efb7ef7f6d44c08cee082d2a5cdff5f1cbea61", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/48efb7ef7f6d44c08cee082d2a5cdff5f1cbea61", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Expose application status via Graph Service API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf48e694c9d1f24535863ff98677156dfa57fdc", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/daf48e694c9d1f24535863ff98677156dfa57fdc", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Fix application status calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9295cf1f36e582692bf42506d731b49a6fc2bb78", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/9295cf1f36e582692bf42506d731b49a6fc2bb78", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Expose bsm status and allow to manually invalidate graph cache via karaf shell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14b421b89b910dfca700889cedd96ce8a9639476", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/14b421b89b910dfca700889cedd96ce8a9639476", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Add some basic documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1aebdf9f26699e97906d40f13ac14bec35fff4f", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/d1aebdf9f26699e97906d40f13ac14bec35fff4f", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Fix count being null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3f84d56161566f3ebc382c2625bc15e09f7aaca", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/e3f84d56161566f3ebc382c2625bc15e09f7aaca", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be1b633c0d1bf2af2218756c2480d5e9aeef0ff", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/3be1b633c0d1bf2af2218756c2480d5e9aeef0ff", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Verify appilcation status enrichment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6a365fe0ee13e108fe97af8bbe59f0f673ea8ef", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/d6a365fe0ee13e108fe97af8bbe59f0f673ea8ef", "committedDate": "2020-01-20T14:54:15Z", "message": "NMS-12453: Verify appilcation status enrichment"}, "afterCommit": {"oid": "3be1b633c0d1bf2af2218756c2480d5e9aeef0ff", "author": {"user": {"login": "mvrueden", "name": null}}, "url": "https://github.com/OpenNMS/opennms/commit/3be1b633c0d1bf2af2218756c2480d5e9aeef0ff", "committedDate": "2020-01-31T08:42:08Z", "message": "NMS-12453: Verify appilcation status enrichment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3720, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}