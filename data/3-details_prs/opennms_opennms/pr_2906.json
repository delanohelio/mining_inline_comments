{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDIzODA3", "number": 2906, "title": "NMS-12413: Fix remove from definitions", "bodyText": "Using getAgentConfig  comes with some defaults which results in equality check failure.\nGet config directly from snmp config by matching specifics and ranges.\nExternal References\n\nJIRA (Issue Tracker): http://issues.opennms.org/browse/NMS-12413\nBamboo (Continuous Integration): https://bamboo.opennms.org/", "createdAt": "2020-02-27T19:14:34Z", "url": "https://github.com/OpenNMS/opennms/pull/2906", "merged": true, "mergeCommit": {"oid": "eb7f02837648b745f6e305976083604a59353d90"}, "closed": true, "closedAt": "2020-03-09T15:26:57Z", "author": {"login": "cgorantla"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIgOWpgH2gAyMzgxMDIzODA3OmU4YzE3YjIwMjUxMmM0MWU1YzVlYjg4OTllOGYzYmMyNDNkMDYwOTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKvOHigH2gAyMzgxMDIzODA3OmI3M2FiMjdiZWRmNmMwY2ExOTJmNjc4N2QxMDg5MzcwZDNlYmQ1NWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8c17b202512c41e5c5eb8899e8f3bc243d06093", "author": {"user": {"login": "cgorantla", "name": "Chandra Gorantla"}}, "url": "https://github.com/OpenNMS/opennms/commit/e8c17b202512c41e5c5eb8899e8f3bc243d06093", "committedDate": "2020-02-27T19:10:07Z", "message": "NMS-12413: Fix remove from definition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTY2OTY2", "url": "https://github.com/OpenNMS/opennms/pull/2906#pullrequestreview-367566966", "createdAt": "2020-03-02T22:11:28Z", "commit": {"oid": "e8c17b202512c41e5c5eb8899e8f3bc243d06093"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzE4OTY0", "url": "https://github.com/OpenNMS/opennms/pull/2906#pullrequestreview-369718964", "createdAt": "2020-03-05T16:26:27Z", "commit": {"oid": "e8c17b202512c41e5c5eb8899e8f3bc243d06093"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoyNjoyN1rOFyai-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNjoyNjoyN1rOFyai-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwODA1Nw==", "bodyText": "Let's use LocationUtils here.", "url": "https://github.com/OpenNMS/opennms/pull/2906#discussion_r388408057", "createdAt": "2020-03-05T16:26:27Z", "author": {"login": "j-white"}, "path": "opennms-config/src/main/java/org/opennms/netmgt/config/SnmpPeerFactory.java", "diffHunk": "@@ -470,6 +480,84 @@ public boolean removeFromDefinition(InetAddress inetAddress, String location, St\n         return succeeded;\n     }\n \n+    private Definition findMatchingDefinition(InetAddress inetAddress, String location) {\n+        SnmpConfig config = getSnmpConfig();\n+        List<Definition> definitions = config.getDefinitions();\n+        return definitions.stream().filter(definition -> matchDefinition(definition, inetAddress, location)).findFirst().orElse(null);\n+    }\n+\n+    private  static Definition createDefinition(Definition matchingDefinition) {\n+        Definition definition = new Definition();\n+        definition.setProfileLabel(matchingDefinition.getProfileLabel());\n+        definition.setLocation(matchingDefinition.getLocation());\n+        // Fill configuration\n+        definition.setProxyHost(matchingDefinition.getProxyHost());\n+        definition.setMaxVarsPerPdu(matchingDefinition.getMaxVarsPerPdu());\n+        definition.setMaxRepetitions(matchingDefinition.getMaxRepetitions());\n+        definition.setMaxRequestSize(matchingDefinition.getMaxRequestSize());\n+\n+        definition.setSecurityName(matchingDefinition.getSecurityName());\n+        definition.setSecurityLevel(matchingDefinition.getSecurityLevel());\n+        definition.setAuthPassphrase(matchingDefinition.getAuthPassphrase());\n+        definition.setAuthProtocol(matchingDefinition.getAuthProtocol());\n+        definition.setEngineId(matchingDefinition.getEngineId());\n+        definition.setContextEngineId(matchingDefinition.getContextEngineId());\n+        definition.setContextName(matchingDefinition.getContextName());\n+        definition.setEnterpriseId(matchingDefinition.getEnterpriseId());\n+        definition.setPrivacyPassphrase(matchingDefinition.getPrivacyPassphrase());\n+        definition.setPrivacyProtocol(matchingDefinition.getPrivacyProtocol());\n+        definition.setVersion(matchingDefinition.getVersion());\n+        definition.setReadCommunity(matchingDefinition.getReadCommunity());\n+        definition.setWriteCommunity(matchingDefinition.getWriteCommunity());\n+        definition.setPort(matchingDefinition.getPort());\n+        definition.setTimeout(matchingDefinition.getTimeout());\n+        definition.setTTL(matchingDefinition.getTTL());\n+        definition.setRetry(matchingDefinition.getRetry());\n+        return definition;\n+    }\n+\n+    private boolean matchDefinition(Definition definition, InetAddress inetAddress, String location) {\n+        String locationFromDefinition = definition.getLocation();\n+        if(DEFAULT_LOCATION.equals(location)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c17b202512c41e5c5eb8899e8f3bc243d06093"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73ab27bedf6c0ca192f6787d1089370d3ebd55e", "author": {"user": {"login": "cgorantla", "name": "Chandra Gorantla"}}, "url": "https://github.com/OpenNMS/opennms/commit/b73ab27bedf6c0ca192f6787d1089370d3ebd55e", "committedDate": "2020-03-05T17:46:17Z", "message": "NMS-12413: Use LocationUtils"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3779, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}