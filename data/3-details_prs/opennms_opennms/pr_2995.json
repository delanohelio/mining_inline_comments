{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDU4MTE3", "number": 2995, "title": "NMS-12687: Additional Confd templates for Minion configuration", "bodyText": "This PR adds new CONFD templates for configuring minion - specifically, the karaf SSH port and the \"management\" ports (RMI server and registry).\nAll Contributors\n\n Have you read and followed our Contribution Guidelines?\n Have you made an issue in the OpenNMS issue tracker?If so, you should:\n\nupdate the title of this PR to be of the format: ${JIRA-ISSUE-NUMBER}: subject of pull request\nupdate the JIRA link at the bottom of this comment to refer to the real issue number\nprefix your commit messages with the issue number, if possible\n\n\n Have you made a comment in that issue which points back to this PR?\n Have you updated the JIRA link at the bottom of this comment to link to your issue?\n If this is a new or updated feature, is there documentation for the new behavior?\n If this is new code, are there unit and/or integration tests?\n If this PR targets a foundation-* branch, does it avoid changing files in $OPENNMS_HOME/etc/?\n\nPull Request Process\nOne or more reviewers should be assigned to each PR.\nIf you know that a particular person is subject matter expert in the area your PR affects, feel free to assign one or more reviewers when you create this PR, otherwise reviewers will be assigned for you.\nOnce the reviewer(s) accept the PR and the branch passes continuous integration in Bamboo, the PR is eligible for merge.\nAt that time, if you have commit access (are an OpenNMS Group employee or a member of the Order of the Green Polo) you are welcome to merge the PR.\nOtherwise, a reviewer can merge it for you.\nThanks for taking time to contribute!\nExternal References\n\nJIRA (Issue Tracker): http://issues.opennms.org/browse/NMS-12687\nBamboo (Continuous Integration): https://bamboo.opennms.org/", "createdAt": "2020-05-04T16:35:34Z", "url": "https://github.com/OpenNMS/opennms/pull/2995", "merged": true, "mergeCommit": {"oid": "04d303313a927324e231448ea991d443c8b13f75"}, "closed": true, "closedAt": "2020-05-19T13:56:56Z", "author": {"login": "bouff"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccGAtZAH2gAyNDEzMDU4MTE3OjIxY2ZkNDVmYWIyNzJhYmE1ZmE1OGYxOWUwYTc1ZWNhMjFkZTg2NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcii3TSgFqTQxMzc3NjAxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21cfd45fab272aba5fa58f19e0a75eca21de866a", "author": {"user": {"login": "bouff", "name": "Pierre Bouffard"}}, "url": "https://github.com/OpenNMS/opennms/commit/21cfd45fab272aba5fa58f19e0a75eca21de866a", "committedDate": "2020-04-28T15:56:10Z", "message": "Add confd templates for Minion: Karaf configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "900b1a3b3b2e9b3e33289bcf666982e5c38f6281", "author": {"user": {"login": "bouff", "name": "Pierre Bouffard"}}, "url": "https://github.com/OpenNMS/opennms/commit/900b1a3b3b2e9b3e33289bcf666982e5c38f6281", "committedDate": "2020-05-01T19:47:43Z", "message": "Fix smoke tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc3a75b0eb0c2f3e84259c9af40a07722403b157", "author": {"user": {"login": "bouff", "name": "Pierre Bouffard"}}, "url": "https://github.com/OpenNMS/opennms/commit/dc3a75b0eb0c2f3e84259c9af40a07722403b157", "committedDate": "2020-05-05T05:11:12Z", "message": "Add CONFD template for Jetty port for minion (used by jolokia)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODA2Njk2", "url": "https://github.com/OpenNMS/opennms/pull/2995#pullrequestreview-405806696", "createdAt": "2020-05-05T13:49:55Z", "commit": {"oid": "dc3a75b0eb0c2f3e84259c9af40a07722403b157"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzo0OTo1NVrOGQqVNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzo1MjowMVrOGQqbYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyMzk1OQ==", "bodyText": "Should rename this to jetty - it's also used by Hawtio and other webapps.", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420123959", "createdAt": "2020-05-05T13:49:55Z", "author": {"login": "j-white"}, "path": "opennms-container/minion/CONFD_README.md", "diffHunk": "@@ -161,3 +161,33 @@ system:\n ```\n Config specified will be written to `etc/confd.system.properties` which gets automatically appended to `etc/system.properties`. Additionally, provided the\n `jaeger-agent-host` key is specified, `etc/featuresBoot.d/jaeger.boot` will also be updated.\n+\n+### Karaf Properties\n+```\n+---\n+karaf:\n+    shell:\n+        ssh:\n+            host: \"0.0.0.0\"\n+            port: 8201\n+    management:\n+        rmi:\n+            registry:\n+                host: \"127.0.0.1\"\n+                port: 1299\n+            server:\n+                host: \"127.0.0.1\"\n+                port: 45444\n+```\n+Config specified will be written to:\n+- `etc/org.apache.karaf.shell.cfg` for content under `shell`.\n+- `etc/org.apache.karaf.management.cfg` for content under `management`.\n+\n+### Jolokia Properties\n+```\n+---\n+jolokia:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc3a75b0eb0c2f3e84259c9af40a07722403b157"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyNDYxMQ==", "bodyText": "Can we add the host as well? We should be able to bind this to the loopback.\norg.ops4j.pax.web.listening.addresses may work - see https://ops4j1.jira.com/wiki/spaces/paxweb/pages/12059275/Basic+Configuration", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420124611", "createdAt": "2020-05-05T13:50:46Z", "author": {"login": "j-white"}, "path": "opennms-container/minion/CONFD_README.md", "diffHunk": "@@ -161,3 +161,33 @@ system:\n ```\n Config specified will be written to `etc/confd.system.properties` which gets automatically appended to `etc/system.properties`. Additionally, provided the\n `jaeger-agent-host` key is specified, `etc/featuresBoot.d/jaeger.boot` will also be updated.\n+\n+### Karaf Properties\n+```\n+---\n+karaf:\n+    shell:\n+        ssh:\n+            host: \"0.0.0.0\"\n+            port: 8201\n+    management:\n+        rmi:\n+            registry:\n+                host: \"127.0.0.1\"\n+                port: 1299\n+            server:\n+                host: \"127.0.0.1\"\n+                port: 45444\n+```\n+Config specified will be written to:\n+- `etc/org.apache.karaf.shell.cfg` for content under `shell`.\n+- `etc/org.apache.karaf.management.cfg` for content under `management`.\n+\n+### Jolokia Properties\n+```\n+---\n+jolokia:\n+    web:\n+        port: 8181", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc3a75b0eb0c2f3e84259c9af40a07722403b157"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyNTUzOQ==", "bodyText": "I don't think we've done this yet - but maybe we should add a # Managed with confd - DO NOT EDIT style \"header\" to these files.", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420125539", "createdAt": "2020-05-05T13:52:01Z", "author": {"login": "j-white"}, "path": "opennms-container/minion/container-fs/confd/templates/org.apache.karaf.management.cfg.tmpl", "diffHunk": "@@ -0,0 +1,104 @@\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc3a75b0eb0c2f3e84259c9af40a07722403b157"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9", "author": {"user": {"login": "bouff", "name": "Pierre Bouffard"}}, "url": "https://github.com/OpenNMS/opennms/commit/8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9", "committedDate": "2020-05-05T15:48:44Z", "message": "Review Feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MTc0NDYw", "url": "https://github.com/OpenNMS/opennms/pull/2995#pullrequestreview-406174460", "createdAt": "2020-05-05T21:38:29Z", "commit": {"oid": "8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMTozODoyOVrOGQ8i0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMTo0NToxMFrOGQ8vRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQyMjM1Mw==", "bodyText": "This is fine, however we could make the restriction broader to avoid having to update the keys in the future.\nCould just use /karaf/management/rmi then you will get access to all the children as well.\nSame for the other toml's.", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420422353", "createdAt": "2020-05-05T21:38:29Z", "author": {"login": "mattixtech"}, "path": "opennms-container/minion/container-fs/confd/conf.d/org.apache.karaf.management.cfg.toml", "diffHunk": "@@ -0,0 +1,9 @@\n+[template]\n+src = \"org.apache.karaf.management.cfg.tmpl\"\n+dest = \"/opt/minion/etc/org.apache.karaf.management.cfg\"\n+keys = [\n+    \"/karaf/management/rmi/registry/host\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQyNDAyNg==", "bodyText": "Not strictly necessary, but it may be a good idea to assign the common parts of the path to a variable and then concatenate to get the full path. Avoids churning in the future should we change key paths (not that its likely). See confd-telemetry-feature.xml.tmpl $flowsPath variable as example.\nSame for other templates here.", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420424026", "createdAt": "2020-05-05T21:41:54Z", "author": {"login": "mattixtech"}, "path": "opennms-container/minion/container-fs/confd/templates/org.apache.karaf.management.cfg.tmpl", "diffHunk": "@@ -0,0 +1,107 @@\n+#\n+# DON'T EDIT THIS FILE :: GENERATED WITH CONFD\n+#\n+\n+#\n+# The properties in this file define the configuration of Apache Karaf's JMX Management\n+#\n+\n+#\n+# Port number for RMI registry connection\n+#\n+rmiRegistryPort = {{getv \"/karaf/management/rmi/registry/port\" \"1299\"}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQyNTU0MA==", "bodyText": "Looks like this is the default. Could remove it, s'pose it doesn't hurt though.", "url": "https://github.com/OpenNMS/opennms/pull/2995#discussion_r420425540", "createdAt": "2020-05-05T21:45:10Z", "author": {"login": "mattixtech"}, "path": "smoke-test/src/main/resources/minion-config/minion-config.yaml", "diffHunk": "@@ -22,3 +22,9 @@ telemetry:\n netmgt:\n   traps:\n     trapd.listen.interface: \"0.0.0.0\"\n+\n+karaf:\n+  shell:\n+    ssh:\n+      host: \"0.0.0.0\"\n+      port: 8201", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3868aac45d6a7e42e92fe7d54dbb0c04207ed9"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cad950996553297f5bc74ce6e8adc80616efbe7", "author": {"user": {"login": "bouff", "name": "Pierre Bouffard"}}, "url": "https://github.com/OpenNMS/opennms/commit/8cad950996553297f5bc74ce6e8adc80616efbe7", "committedDate": "2020-05-05T23:43:37Z", "message": "Review Feedback 2."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzA5NjA2", "url": "https://github.com/OpenNMS/opennms/pull/2995#pullrequestreview-406709606", "createdAt": "2020-05-06T15:07:51Z", "commit": {"oid": "8cad950996553297f5bc74ce6e8adc80616efbe7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzc2MDE2", "url": "https://github.com/OpenNMS/opennms/pull/2995#pullrequestreview-413776016", "createdAt": "2020-05-18T16:56:41Z", "commit": {"oid": "8cad950996553297f5bc74ce6e8adc80616efbe7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3623, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}