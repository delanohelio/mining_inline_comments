{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Nzk0MDE4", "number": 2920, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjowOTowM1rODosYpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozOToyNlrODo0nEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzOTk2ODM5OnYy", "diffSide": "RIGHT", "path": "features/telemetry/protocols/bmp/transport/src/main/resources/transport.proto", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjowOTowM1rOF3ZZ4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NjoxMFrOF3fkYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMjIyNA==", "bodyText": "Can we carry the capability structures over and only convert to strings in the BMP forwarder?\nThis will give us more flexibility to do things with them later.", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r393632224", "createdAt": "2020-03-17T12:09:03Z", "author": {"login": "j-white"}, "path": "features/telemetry/protocols/bmp/transport/src/main/resources/transport.proto", "diffHunk": "@@ -68,6 +68,7 @@ message PeerUpPacket {\n         fixed32 as = 2;\n         uint32 hold_time = 3;\n         IpAddress id = 4;\n+        string capabilities = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc338e6307475b64ca283f9d6cb6466ebfad128e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMzgwOQ==", "bodyText": "Ok. I'll change it.", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r393633809", "createdAt": "2020-03-17T12:12:13Z", "author": {"login": "christianpape"}, "path": "features/telemetry/protocols/bmp/transport/src/main/resources/transport.proto", "diffHunk": "@@ -68,6 +68,7 @@ message PeerUpPacket {\n         fixed32 as = 2;\n         uint32 hold_time = 3;\n         IpAddress id = 4;\n+        string capabilities = 5;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMjIyNA=="}, "originalCommit": {"oid": "cc338e6307475b64ca283f9d6cb6466ebfad128e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMzIxNg==", "bodyText": "done", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r393733216", "createdAt": "2020-03-17T14:46:10Z", "author": {"login": "christianpape"}, "path": "features/telemetry/protocols/bmp/transport/src/main/resources/transport.proto", "diffHunk": "@@ -68,6 +68,7 @@ message PeerUpPacket {\n         fixed32 as = 2;\n         uint32 hold_time = 3;\n         IpAddress id = 4;\n+        string capabilities = 5;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzMjIyNA=="}, "originalCommit": {"oid": "cc338e6307475b64ca283f9d6cb6466ebfad128e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMwMTUwOnYy", "diffSide": "RIGHT", "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/Capability.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozNTozNVrOF3m6Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjowOTowMFrOF33aCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1MzQ3NQ==", "bodyText": "Not that it currently is required to implement right now, but do we have a clue about what this value could be?", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r393853475", "createdAt": "2020-03-17T17:35:35Z", "author": {"login": "fooker"}, "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/Capability.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*******************************************************************************\n+ * This file is part of OpenNMS(R).\n+ *\n+ * Copyright (C) 2020 The OpenNMS Group, Inc.\n+ * OpenNMS(R) is Copyright (C) 1999-2020 The OpenNMS Group, Inc.\n+ *\n+ * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n+ *\n+ * OpenNMS(R) is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published\n+ * by the Free Software Foundation, either version 3 of the License,\n+ * or (at your option) any later version.\n+ *\n+ * OpenNMS(R) is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with OpenNMS(R).  If not, see:\n+ *      http://www.gnu.org/licenses/\n+ *\n+ * For more information contact:\n+ *     OpenNMS(R) Licensing <license@opennms.org>\n+ *     http://www.opennms.org/\n+ *     http://www.opennms.com/\n+ *******************************************************************************/\n+\n+package org.opennms.netmgt.telemetry.protocols.bmp.parser.proto.bgp.packets;\n+\n+import static org.opennms.netmgt.telemetry.listeners.utils.BufferUtils.slice;\n+import static org.opennms.netmgt.telemetry.listeners.utils.BufferUtils.uint8;\n+\n+import com.google.protobuf.ByteString;\n+\n+import io.netty.buffer.ByteBuf;\n+\n+public class Capability {\n+\n+    private final int code;\n+    private final int length;\n+    private final ByteBuf value;\n+\n+    public Capability(final ByteBuf buffer) {\n+        this.code = uint8(buffer);\n+        this.length = uint8(buffer);\n+        this.value = slice(buffer, this.length);\n+    }\n+\n+    public int getCode() {\n+        return code;\n+    }\n+\n+    public int getLength() {\n+        return length;\n+    }\n+\n+    public ByteString getValue() {\n+        return ByteString.copyFrom(value.array());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "271f29b0bf4cbfef20dc6571aa5bd867f06f53c4"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEyMzc4NA==", "bodyText": "We currently implement the parsing for this value for code 1 and 69, like the OpenBMP implementation does.", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r394123784", "createdAt": "2020-03-18T06:09:00Z", "author": {"login": "christianpape"}, "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/Capability.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*******************************************************************************\n+ * This file is part of OpenNMS(R).\n+ *\n+ * Copyright (C) 2020 The OpenNMS Group, Inc.\n+ * OpenNMS(R) is Copyright (C) 1999-2020 The OpenNMS Group, Inc.\n+ *\n+ * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n+ *\n+ * OpenNMS(R) is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published\n+ * by the Free Software Foundation, either version 3 of the License,\n+ * or (at your option) any later version.\n+ *\n+ * OpenNMS(R) is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with OpenNMS(R).  If not, see:\n+ *      http://www.gnu.org/licenses/\n+ *\n+ * For more information contact:\n+ *     OpenNMS(R) Licensing <license@opennms.org>\n+ *     http://www.opennms.org/\n+ *     http://www.opennms.com/\n+ *******************************************************************************/\n+\n+package org.opennms.netmgt.telemetry.protocols.bmp.parser.proto.bgp.packets;\n+\n+import static org.opennms.netmgt.telemetry.listeners.utils.BufferUtils.slice;\n+import static org.opennms.netmgt.telemetry.listeners.utils.BufferUtils.uint8;\n+\n+import com.google.protobuf.ByteString;\n+\n+import io.netty.buffer.ByteBuf;\n+\n+public class Capability {\n+\n+    private final int code;\n+    private final int length;\n+    private final ByteBuf value;\n+\n+    public Capability(final ByteBuf buffer) {\n+        this.code = uint8(buffer);\n+        this.length = uint8(buffer);\n+        this.value = slice(buffer, this.length);\n+    }\n+\n+    public int getCode() {\n+        return code;\n+    }\n+\n+    public int getLength() {\n+        return length;\n+    }\n+\n+    public ByteString getValue() {\n+        return ByteString.copyFrom(value.array());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1MzQ3NQ=="}, "originalCommit": {"oid": "271f29b0bf4cbfef20dc6571aa5bd867f06f53c4"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMxNjAzOnYy", "diffSide": "RIGHT", "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/OpenPacket.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzozOToyNlrOF3nDyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjowOToxNVrOF33aWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1NTk0Nw==", "bodyText": "I don't think we should filter the parameters, as capabilities are parameters, too. An we should keep the link to the rfc for further reference to there parameter types, if there are any.", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r393855947", "createdAt": "2020-03-17T17:39:26Z", "author": {"login": "fooker"}, "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/OpenPacket.java", "diffHunk": "@@ -66,8 +92,10 @@ public OpenPacket(final Header header, final ByteBuf buffer, final PeerFlags fla\n \n         final int parametersLength = uint8(buffer);\n \n-        // Skip the parameters (see https://tools.ietf.org/html/rfc4271#section-4.2)\n-        skip(buffer, parametersLength);\n+        final List<Parameter> list = repeatRemaining(slice(buffer, parametersLength), Parameter::new);\n+\n+        parameters = list.stream().filter(p -> p.type != 2).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "271f29b0bf4cbfef20dc6571aa5bd867f06f53c4"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEyMzg2NA==", "bodyText": "Ok", "url": "https://github.com/OpenNMS/opennms/pull/2920#discussion_r394123864", "createdAt": "2020-03-18T06:09:15Z", "author": {"login": "christianpape"}, "path": "features/telemetry/protocols/bmp/parser/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/parser/proto/bgp/packets/OpenPacket.java", "diffHunk": "@@ -66,8 +92,10 @@ public OpenPacket(final Header header, final ByteBuf buffer, final PeerFlags fla\n \n         final int parametersLength = uint8(buffer);\n \n-        // Skip the parameters (see https://tools.ietf.org/html/rfc4271#section-4.2)\n-        skip(buffer, parametersLength);\n+        final List<Parameter> list = repeatRemaining(slice(buffer, parametersLength), Parameter::new);\n+\n+        parameters = list.stream().filter(p -> p.type != 2).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1NTk0Nw=="}, "originalCommit": {"oid": "271f29b0bf4cbfef20dc6571aa5bd867f06f53c4"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 810, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}