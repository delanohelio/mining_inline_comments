{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxNDQ5NTU5", "number": 3072, "title": "NMS-12769: fix pid file handling", "bodyText": "This PR fixes 2 things:\n\nwriting the PID file even when running under systemd (which previously used the -f option to run in the foreground)\nput karaf.pid back into the logs directory; I assume this got missed in a karaf upgrade/merge and reverted to writing to $OPENNMS_HOME/karaf.pid rather than $OPENNMS_HOME/logs/karaf.pid\n\nIt retrieves the PID from a supported API on Java 10+, and falls back to using the same approach as spring boot on earlier JDKs (parsing it out of RuntimeMXBean.getName()).\nJIRA: https://issues.opennms.org/browse/NMS-12769", "createdAt": "2020-07-17T20:44:54Z", "url": "https://github.com/OpenNMS/opennms/pull/3072", "merged": true, "mergeCommit": {"oid": "a61af940923ab8ae1404b59b2a5c219e5ef3910e"}, "closed": true, "closedAt": "2020-08-20T16:34:47Z", "author": {"login": "RangerRick"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc16JJOgBqjM1NTk4Mjk1MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAy3wDgFqTQ3MTc5MTAxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "105ad86ddeb5087bd1dfa1606ace77948f365e05", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/105ad86ddeb5087bd1dfa1606ace77948f365e05", "committedDate": "2020-07-17T20:30:09Z", "message": "NMS-12769: write PID from Java and notify Systemd"}, "afterCommit": {"oid": "573407123f6a811dd0a21f62568bdc84a6d23c82", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/573407123f6a811dd0a21f62568bdc84a6d23c82", "committedDate": "2020-07-17T20:48:26Z", "message": "NMS-12769: write PID from Java and notify Systemd"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "573407123f6a811dd0a21f62568bdc84a6d23c82", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/573407123f6a811dd0a21f62568bdc84a6d23c82", "committedDate": "2020-07-17T20:48:26Z", "message": "NMS-12769: write PID from Java and notify Systemd"}, "afterCommit": {"oid": "0d6fabcde74b225ec03129edf8fcb96840f491c7", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/0d6fabcde74b225ec03129edf8fcb96840f491c7", "committedDate": "2020-07-23T20:15:10Z", "message": "NMS-12769: write PID from Java and notify Systemd"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MzMwMDA5", "url": "https://github.com/OpenNMS/opennms/pull/3072#pullrequestreview-454330009", "createdAt": "2020-07-23T17:03:56Z", "commit": {"oid": "573407123f6a811dd0a21f62568bdc84a6d23c82"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNzowMzo1NlrOG2Tm7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNzowMzo1NlrOG2Tm7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NzU0OQ==", "bodyText": "If we're changing back to Type=forking, I think we need to change the flag to ExecStart from -f (for \"foreground\") to -Q or just no flags at all. Otherwise Systemd has the wrong expectation.", "url": "https://github.com/OpenNMS/opennms/pull/3072#discussion_r459597549", "createdAt": "2020-07-23T17:03:56Z", "author": {"login": "jeffgdotorg"}, "path": "opennms-base-assembly/src/main/filtered/etc/opennms.service", "diffHunk": "@@ -8,7 +8,7 @@ After=${install.postgresql.service}.service postgresql-10.service postgresql-11.\n User=root\n Environment=\"OPENNMS_HOME=${install.dir}\"\n \n-Type=simple\n+Type=forking\n PIDFile=${install.pid.file}\n \n ExecStart=${install.init.dir}/opennms -f start", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "573407123f6a811dd0a21f62568bdc84a6d23c82"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjcxOTM0", "url": "https://github.com/OpenNMS/opennms/pull/3072#pullrequestreview-462671934", "createdAt": "2020-08-06T16:17:33Z", "commit": {"oid": "0d6fabcde74b225ec03129edf8fcb96840f491c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d6fabcde74b225ec03129edf8fcb96840f491c7", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/0d6fabcde74b225ec03129edf8fcb96840f491c7", "committedDate": "2020-07-23T20:15:10Z", "message": "NMS-12769: write PID from Java and notify Systemd"}, "afterCommit": {"oid": "fb6669112147055811834740fa2cdbcf7f5f0560", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/fb6669112147055811834740fa2cdbcf7f5f0560", "committedDate": "2020-08-12T21:16:14Z", "message": "NMS-12769: just let the first one check instead"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb6669112147055811834740fa2cdbcf7f5f0560", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/fb6669112147055811834740fa2cdbcf7f5f0560", "committedDate": "2020-08-12T21:16:14Z", "message": "NMS-12769: just let the first one check instead"}, "afterCommit": {"oid": "5b31c0c3fa8c172e0ececda589250419ffe716fa", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/5b31c0c3fa8c172e0ececda589250419ffe716fa", "committedDate": "2020-08-13T15:20:14Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b31c0c3fa8c172e0ececda589250419ffe716fa", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/5b31c0c3fa8c172e0ececda589250419ffe716fa", "committedDate": "2020-08-13T15:20:14Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}, "afterCommit": {"oid": "ed518a44e682383c068ac2e61206ace4b10d0fad", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/ed518a44e682383c068ac2e61206ace4b10d0fad", "committedDate": "2020-08-13T15:29:58Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed518a44e682383c068ac2e61206ace4b10d0fad", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/ed518a44e682383c068ac2e61206ace4b10d0fad", "committedDate": "2020-08-13T15:29:58Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}, "afterCommit": {"oid": "9304ff1cd8076bf113de44353512efe33276bb63", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/9304ff1cd8076bf113de44353512efe33276bb63", "committedDate": "2020-08-13T16:09:20Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9304ff1cd8076bf113de44353512efe33276bb63", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/9304ff1cd8076bf113de44353512efe33276bb63", "committedDate": "2020-08-13T16:09:20Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}, "afterCommit": {"oid": "1047adfb8ed45084d092425c3ffba948b66f52c6", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/1047adfb8ed45084d092425c3ffba948b66f52c6", "committedDate": "2020-08-19T19:30:05Z", "message": "NMS-12769: write PID from Java and notify Systemd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d43c0fbb490e40d7e8535c94d31570f399f137", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/06d43c0fbb490e40d7e8535c94d31570f399f137", "committedDate": "2020-08-19T20:01:05Z", "message": "NMS-12769: put karaf.pid in the log directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8a32ccfc706dd48fea38d2efbbce4875d7f23e", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/4c8a32ccfc706dd48fea38d2efbbce4875d7f23e", "committedDate": "2020-08-19T20:01:05Z", "message": "NMS-12769: write PID from Java and notify Systemd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e10a561271120b5f8c4ea0efad04583ed4abf4aa", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/e10a561271120b5f8c4ea0efad04583ed4abf4aa", "committedDate": "2020-08-19T20:01:05Z", "message": "clean up some formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5851e52a5554a7f28a715f7d36cdd0d8dd0bf6b4", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/5851e52a5554a7f28a715f7d36cdd0d8dd0bf6b4", "committedDate": "2020-08-19T20:01:05Z", "message": "NMS-12769: only write PID on startup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09d30b79de66e1d39a9fcdaf0b582352ab5e4859", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/09d30b79de66e1d39a9fcdaf0b582352ab5e4859", "committedDate": "2020-08-19T20:01:05Z", "message": "NMS-12769: delete, rather than just blanking out, the PID files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2733b14672389df526c51f895462a50ae4be1d34", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/2733b14672389df526c51f895462a50ae4be1d34", "committedDate": "2020-08-20T01:13:14Z", "message": "fix systemd on Debian systems"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1047adfb8ed45084d092425c3ffba948b66f52c6", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/1047adfb8ed45084d092425c3ffba948b66f52c6", "committedDate": "2020-08-19T19:30:05Z", "message": "NMS-12769: write PID from Java and notify Systemd"}, "afterCommit": {"oid": "2733b14672389df526c51f895462a50ae4be1d34", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/2733b14672389df526c51f895462a50ae4be1d34", "committedDate": "2020-08-20T01:13:14Z", "message": "fix systemd on Debian systems"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNzkxMDE2", "url": "https://github.com/OpenNMS/opennms/pull/3072#pullrequestreview-471791016", "createdAt": "2020-08-20T16:33:23Z", "commit": {"oid": "2733b14672389df526c51f895462a50ae4be1d34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}