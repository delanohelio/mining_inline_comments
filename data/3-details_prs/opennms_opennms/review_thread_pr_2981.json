{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MTQzNjkx", "number": 2981, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzoxMjoyM1rODz1VzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzoxMjoyM1rODz1VzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Njc3OTAxOnYy", "diffSide": "RIGHT", "path": "features/kafka/producer/src/test/java/org/opennms/features/kafka/producer/collection/KafkaPersisterIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzoxMjoyM1rOGIe8Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMTo0NDoxOFrOGIo-Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU0ODY3NQ==", "bodyText": "Can we move this to the org.opennms.netmgt.collection.support.builder package? Would be useful there so we could reuse it.", "url": "https://github.com/OpenNMS/opennms/pull/2981#discussion_r411548675", "createdAt": "2020-04-20T17:12:23Z", "author": {"login": "j-white"}, "path": "features/kafka/producer/src/test/java/org/opennms/features/kafka/producer/collection/KafkaPersisterIT.java", "diffHunk": "@@ -136,16 +141,65 @@ public void testKafkaCollection() throws IOException {\n         OnmsNode node = databasePopulator.getNode5();\n         CollectionAgent agent = new MockCollectionAgent(node.getId(), \"test\", InetAddress.getLocalHost());\n         NodeLevelResource nodeResource = new NodeLevelResource(node.getId());\n+\n         CollectionSet collectionSet = new CollectionSetBuilder(agent).withTimestamp(new Date(2))\n                 .withNumericAttribute(nodeResource, \"group1\", \"node5\", 105, AttributeType.GAUGE)\n-                .withNumericAttribute(nodeResource, \"group2\", \"node5\", 1050, AttributeType.GAUGE).build();\n+                .withNumericAttribute(nodeResource, \"group2\", \"node5\", 1050, AttributeType.GAUGE)\n+                .withNumericAttribute(new ResponseTimeResource(), \"ICMP\", \"ICMP\", 120, AttributeType.GAUGE).build();\n         persister.visitCollectionSet(collectionSet);\n         \n-        await().atMost(1, TimeUnit.MINUTES).pollInterval(15, TimeUnit.SECONDS).until(() -> kafkaConsumer.getCollectionSet(), not(nullValue()));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNode().getNodeId(), equalTo(node.getId().longValue()));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNumericCount(), equalTo(2));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNumeric(1).getValue(), equalTo(1050.0));\n+        await().atMost(1, TimeUnit.MINUTES).pollInterval(15, TimeUnit.SECONDS).until(() -> kafkaConsumer.getCollectionSetValues(), not(Matchers.empty()));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(0).getNode().getNodeId(), equalTo(node.getId().longValue()));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(0).getNumericCount(), equalTo(2));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(1).getResponse().getInstance(), equalTo(IP_ADDRESS));\n+\n+    }\n+\n+    private class ResponseTimeResource implements Resource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7e2619a8b0759cad5fd5ac59664e08f585493d1"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcxMzA3MA==", "bodyText": "I ended up not using the LatencyTypeResource in the test but still kept it for future use.", "url": "https://github.com/OpenNMS/opennms/pull/2981#discussion_r411713070", "createdAt": "2020-04-20T21:44:18Z", "author": {"login": "cgorantla"}, "path": "features/kafka/producer/src/test/java/org/opennms/features/kafka/producer/collection/KafkaPersisterIT.java", "diffHunk": "@@ -136,16 +141,65 @@ public void testKafkaCollection() throws IOException {\n         OnmsNode node = databasePopulator.getNode5();\n         CollectionAgent agent = new MockCollectionAgent(node.getId(), \"test\", InetAddress.getLocalHost());\n         NodeLevelResource nodeResource = new NodeLevelResource(node.getId());\n+\n         CollectionSet collectionSet = new CollectionSetBuilder(agent).withTimestamp(new Date(2))\n                 .withNumericAttribute(nodeResource, \"group1\", \"node5\", 105, AttributeType.GAUGE)\n-                .withNumericAttribute(nodeResource, \"group2\", \"node5\", 1050, AttributeType.GAUGE).build();\n+                .withNumericAttribute(nodeResource, \"group2\", \"node5\", 1050, AttributeType.GAUGE)\n+                .withNumericAttribute(new ResponseTimeResource(), \"ICMP\", \"ICMP\", 120, AttributeType.GAUGE).build();\n         persister.visitCollectionSet(collectionSet);\n         \n-        await().atMost(1, TimeUnit.MINUTES).pollInterval(15, TimeUnit.SECONDS).until(() -> kafkaConsumer.getCollectionSet(), not(nullValue()));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNode().getNodeId(), equalTo(node.getId().longValue()));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNumericCount(), equalTo(2));\n-        assertThat(kafkaConsumer.getCollectionSet().getResource(0).getNumeric(1).getValue(), equalTo(1050.0));\n+        await().atMost(1, TimeUnit.MINUTES).pollInterval(15, TimeUnit.SECONDS).until(() -> kafkaConsumer.getCollectionSetValues(), not(Matchers.empty()));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(0).getNode().getNodeId(), equalTo(node.getId().longValue()));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(0).getNumericCount(), equalTo(2));\n+        assertThat(kafkaConsumer.getCollectionSetValues().get(0).getResource(1).getResponse().getInstance(), equalTo(IP_ADDRESS));\n+\n+    }\n+\n+    private class ResponseTimeResource implements Resource {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU0ODY3NQ=="}, "originalCommit": {"oid": "d7e2619a8b0759cad5fd5ac59664e08f585493d1"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 624, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}