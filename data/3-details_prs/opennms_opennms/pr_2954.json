{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MzI2MjQ5", "number": 2954, "title": "update CircleCI checksums to conserve space/bandwidth", "bodyText": "These changes make builds take anywhere from a few seconds to a few minutes less time, by reducing the amount of workspace junk that gets passed around from different caches.\nIn general, the major thing it does is add a level of caching based on the <version> tag in pom.xml, since dependency churn among single versions is less common.  This greatly reduces the size of the cache that's passed around between workspaces (in some cases up to 1GB!).\nI also got rid of the \"generic\" keys for nodejs and maven dependencies since they increase the chances of passing old junk along, at the expense of the first build of a pom version being a bit slower (since it needs to download new dependencies).  This will have the side-effect of catching if upstream dependencies go away, which we're probably pretty immune to now and could make it hard to know that upstream repos are permanently gone or changed.\nFinally, I got rid of checksumming-the-checksums in favor of just catting everything together in a repeatable way.", "createdAt": "2020-04-03T18:37:13Z", "url": "https://github.com/OpenNMS/opennms/pull/2954", "merged": true, "mergeCommit": {"oid": "8bdd8f5e81794d301b018ad91b2bd677cf4ba1ea"}, "closed": true, "closedAt": "2020-04-05T16:04:59Z", "author": {"login": "RangerRick"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR1uY9AH2gAyMzk4MzI2MjQ5OjQzNDI3M2I3ZjNlZjkxOGM2MDcwYTJiOTJlYTY5NmFkN2E1MDMyZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUS8NAgFqTM4NzY4NzU4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "434273b7f3ef918c6070a2b92ea696ad7a5032e9", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/434273b7f3ef918c6070a2b92ea696ad7a5032e9", "committedDate": "2020-03-27T19:18:26Z", "message": "checksum file contents, not other checksums, also use version as an intermediate checksum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/8b3dbf9c363d9a174ce41d41bdef5ab975efe378", "committedDate": "2020-04-03T18:45:28Z", "message": "pull pom extraction out to a command"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "536b4f85edbee1b4bcb7ed8504557ce51c0eeba8", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/536b4f85edbee1b4bcb7ed8504557ce51c0eeba8", "committedDate": "2020-04-03T18:43:07Z", "message": "pull pom extraction out to a command"}, "afterCommit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378", "author": {"user": {"login": "RangerRick", "name": "Benjamin Reed"}}, "url": "https://github.com/OpenNMS/opennms/commit/8b3dbf9c363d9a174ce41d41bdef5ab975efe378", "committedDate": "2020-04-03T18:45:28Z", "message": "pull pom extraction out to a command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjI3NjU0", "url": "https://github.com/OpenNMS/opennms/pull/2954#pullrequestreview-387627654", "createdAt": "2020-04-03T23:08:44Z", "commit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjI3Nzg1", "url": "https://github.com/OpenNMS/opennms/pull/2954#pullrequestreview-387627785", "createdAt": "2020-04-03T23:09:14Z", "commit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMzowOToxNFrOGAsOjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMzowOToxNFrOGAsOjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NzgwNA==", "bodyText": "This will need to be adapted for foundation-2019+", "url": "https://github.com/OpenNMS/opennms/pull/2954#discussion_r403377804", "createdAt": "2020-04-03T23:09:14Z", "author": {"login": "j-white"}, "path": ".circleci/config.yml", "diffHunk": "@@ -55,26 +61,24 @@ commands:\n     description: \"Maven: Save cache\"\n     steps:\n       - save_cache:\n-          key: maven-dependencies-v2-{{ checksum \"maven-dependency-cache.key\" }}\n+          key: maven-dependencies-v3-{{ checksum \"pom-version-cache.key\" }}-{{ checksum \"maven-dependency-pom-cache.key\" }}\n           paths:\n             - ~/.m2\n   restore-nodejs-cache:\n       description: \"NodeJS: Calculate cache key and restore cache\"\n       steps:\n         - run:\n             name: Calculate cache key\n-            command: |\n-              sha256sum opennms-webapp/bower.json > nodejs-dependency-cache.key\n-              sha256sum opennms-webapp/package.json >> nodejs-dependency-cache.key\n+            command: find opennms-webapp -name package\\*.json -o -name bower.json | grep -v /target/ | sort -u | xargs cat > nodejs-dependency-json-cache.key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Njg3NTg2", "url": "https://github.com/OpenNMS/opennms/pull/2954#pullrequestreview-387687586", "createdAt": "2020-04-04T10:28:37Z", "commit": {"oid": "8b3dbf9c363d9a174ce41d41bdef5ab975efe378"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3564, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}