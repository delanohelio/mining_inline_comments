{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNDI4NjY1", "number": 3016, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoxNDo0NVrOD-A_tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoyNzo0OFrOD-BI9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzU0NjE1OnYy", "diffSide": "RIGHT", "path": "features/kafka/producer/src/main/java/org/opennms/features/kafka/producer/ProtobufMapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoxNDo0NVrOGX2-wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoxNDo0NVrOGX2-wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3MTIzMg==", "bodyText": "We don't need to escape here do we?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        String value = EventDatabaseConstants.escape(parm.getValue().getContent() == null ? \"\" :\n          \n          \n            \n                        String value = parm.getValue().getContent() == null ? \"\" : parm.getValue().getContent();", "url": "https://github.com/OpenNMS/opennms/pull/3016#discussion_r427671232", "createdAt": "2020-05-20T00:14:45Z", "author": {"login": "j-white"}, "path": "features/kafka/producer/src/main/java/org/opennms/features/kafka/producer/ProtobufMapper.java", "diffHunk": "@@ -220,16 +223,26 @@ public ProtobufMapper(EventConfDao eventConfDao, HwEntityDao hwEntityDao, Sessio\n                 LOG.warn(\"An error occurred when building node criteria for node with id: {}.\" +\n                         \" The node foreign source and foreign id (if set) will be missing from the event with id: {}.\",\n                         event.getNodeid(), event.getDbid(), e);\n+                // We only include the node id in the node criteria in when forwarding events\n+                // since the event does not currently contain the fs:fid or a reference to the node object.\n                 builder.setNodeCriteria(OpennmsModelProtos.NodeCriteria.newBuilder()\n                         .setId(event.getNodeid()));\n             }\n-            // We only include the node id in the node criteria in when forwarding events\n-            // since the event does not currently contain the fs:fid or a reference to the node object.\n-            builder.setNodeCriteria(OpennmsModelProtos.NodeCriteria.newBuilder()\n-                    .setId(event.getNodeid()));\n+\n         }\n-        if (event.getInterface() != null) {\n-            builder.setIpAddress(event.getInterface());\n+\n+        getString(event.getInterface()).ifPresent(builder::setIpAddress);\n+\n+        for (Parm parm : event.getParmCollection()) {\n+            if (parm.getParmName() == null || parm.getValue() == null) {\n+                continue;\n+            }\n+            String value = EventDatabaseConstants.escape(parm.getValue().getContent() == null ? \"\" :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de464984859987d9b34254f17ff9bd0368e52948"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzU2OTgwOnYy", "diffSide": "LEFT", "path": "core/daemon/src/main/java/org/opennms/netmgt/daemon/DaemonTools.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoyNzo0OFrOGX3M8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNDowNzozM1rOGYNkpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3NDg2Ng==", "bodyText": "Related?", "url": "https://github.com/OpenNMS/opennms/pull/3016#discussion_r427674866", "createdAt": "2020-05-20T00:27:48Z", "author": {"login": "j-white"}, "path": "core/daemon/src/main/java/org/opennms/netmgt/daemon/DaemonTools.java", "diffHunk": "@@ -60,7 +60,6 @@ public static void handleReloadEvent(Event e, String daemonName, Consumer<Event>\n                 LOG.info(\"Reload successful.\");\n \n                 ebldr = new EventBuilder(EventConstants.RELOAD_DAEMON_CONFIG_SUCCESSFUL_UEI, daemonName);\n-                ebldr.addParam(EventConstants.PARM_DAEMON_NAME, daemonName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42eca237d3665383f614cc1f901c6cba4d9a91e2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwOTM2MA==", "bodyText": "Not related but saw duplicate params for this event while validating this.", "url": "https://github.com/OpenNMS/opennms/pull/3016#discussion_r428009360", "createdAt": "2020-05-20T13:27:47Z", "author": {"login": "cgorantla"}, "path": "core/daemon/src/main/java/org/opennms/netmgt/daemon/DaemonTools.java", "diffHunk": "@@ -60,7 +60,6 @@ public static void handleReloadEvent(Event e, String daemonName, Consumer<Event>\n                 LOG.info(\"Reload successful.\");\n \n                 ebldr = new EventBuilder(EventConstants.RELOAD_DAEMON_CONFIG_SUCCESSFUL_UEI, daemonName);\n-                ebldr.addParam(EventConstants.PARM_DAEMON_NAME, daemonName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3NDg2Ng=="}, "originalCommit": {"oid": "42eca237d3665383f614cc1f901c6cba4d9a91e2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA0MTM4MA==", "bodyText": "Ah I see - it's still added bellow.", "url": "https://github.com/OpenNMS/opennms/pull/3016#discussion_r428041380", "createdAt": "2020-05-20T14:07:33Z", "author": {"login": "j-white"}, "path": "core/daemon/src/main/java/org/opennms/netmgt/daemon/DaemonTools.java", "diffHunk": "@@ -60,7 +60,6 @@ public static void handleReloadEvent(Event e, String daemonName, Consumer<Event>\n                 LOG.info(\"Reload successful.\");\n \n                 ebldr = new EventBuilder(EventConstants.RELOAD_DAEMON_CONFIG_SUCCESSFUL_UEI, daemonName);\n-                ebldr.addParam(EventConstants.PARM_DAEMON_NAME, daemonName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3NDg2Ng=="}, "originalCommit": {"oid": "42eca237d3665383f614cc1f901c6cba4d9a91e2"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 667, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}