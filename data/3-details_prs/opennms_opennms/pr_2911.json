{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MjcyNTky", "number": 2911, "title": "NMS-12574: Apply default to OpenBMP kafka producer", "bodyText": "This applies default values to the Kafka producer of the OpenBMP\nIntegration Adapter. The defaults are the same as the ones used in the\nOpenBMP reference implementation.\nThis is a follow-up of #2910 and this PR should be re-targeted to features/bmp after merging #2910.\nExternal References\n\nJIRA (Issue Tracker): http://issues.opennms.org/browse/NMS-12574", "createdAt": "2020-03-05T13:21:56Z", "url": "https://github.com/OpenNMS/opennms/pull/2911", "merged": true, "mergeCommit": {"oid": "62adef2dd415f9f19c37880b6ec6dcfda9b21c30"}, "closed": true, "closedAt": "2020-03-23T19:47:47Z", "author": {"login": "fooker"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKr3XZgFqTM2OTU4Mjc1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO6bFdAFqTM3NzA2NTQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTgyNzU5", "url": "https://github.com/OpenNMS/opennms/pull/2911#pullrequestreview-369582759", "createdAt": "2020-03-05T13:51:43Z", "commit": {"oid": "21ec1e46c060e359c06c194e79c802f53ce8d703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1MTo0M1rOFyUPuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1MTo0M1rOFyUPuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwNDgyNw==", "bodyText": "The Kafka client library has constants for these strings, would nice to use those.", "url": "https://github.com/OpenNMS/opennms/pull/2911#discussion_r388304827", "createdAt": "2020-03-05T13:51:43Z", "author": {"login": "j-white"}, "path": "features/telemetry/protocols/bmp/adapter/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/adapter/openbmp/BmpKafkaProducer.java", "diffHunk": "@@ -59,7 +59,18 @@ public BmpKafkaProducer(final String topicPrefix,\n     }\n \n     private static KafkaProducer<String, String> buildProducer(final Map<String, Object> kafkaConfig) {\n-        // TODO fooker: Apply defaults (steal from https://github.com/SNAS/openbmp/blob/1a615a3c75a0143cc87ec70458471f0af67d3929/Server/src/kafka/MsgBusImpl_kafka.cpp#L162) (see https://issues.opennms.org/browse/NMS-12574)\n+        // Apply some defaults\n+        kafkaConfig.putIfAbsent(\"batch.num.messages\", 100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21ec1e46c060e359c06c194e79c802f53ce8d703"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODYxMTkx", "url": "https://github.com/OpenNMS/opennms/pull/2911#pullrequestreview-369861191", "createdAt": "2020-03-05T19:43:29Z", "commit": {"oid": "21ec1e46c060e359c06c194e79c802f53ce8d703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTo0MzoyOVrOFyheDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTo0MzoyOVrOFyheDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUyMTQ4Ng==", "bodyText": "Can't find this property with quick search on producer config.  If you can directly get them from kafka client as Jesse suggested, that would rule out any outdated configuration.", "url": "https://github.com/OpenNMS/opennms/pull/2911#discussion_r388521486", "createdAt": "2020-03-05T19:43:29Z", "author": {"login": "cgorantla"}, "path": "features/telemetry/protocols/bmp/adapter/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/adapter/openbmp/BmpKafkaProducer.java", "diffHunk": "@@ -59,7 +59,18 @@ public BmpKafkaProducer(final String topicPrefix,\n     }\n \n     private static KafkaProducer<String, String> buildProducer(final Map<String, Object> kafkaConfig) {\n-        // TODO fooker: Apply defaults (steal from https://github.com/SNAS/openbmp/blob/1a615a3c75a0143cc87ec70458471f0af67d3929/Server/src/kafka/MsgBusImpl_kafka.cpp#L162) (see https://issues.opennms.org/browse/NMS-12574)\n+        // Apply some defaults\n+        kafkaConfig.putIfAbsent(\"batch.num.messages\", 100);\n+        kafkaConfig.putIfAbsent(\"compression.codec\", \"snappy\");\n+        kafkaConfig.putIfAbsent(\"message.max.bytes\", 1000000);\n+        kafkaConfig.putIfAbsent(\"receive.message.max.bytes\", 100000000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21ec1e46c060e359c06c194e79c802f53ce8d703"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d", "author": {"user": {"login": "fooker", "name": "Dustin Frisch"}}, "url": "https://github.com/OpenNMS/opennms/commit/d567196a43d7d110625bdb47703c30c7ef15ff5d", "committedDate": "2020-03-12T12:40:59Z", "message": "NMS-12574: Apply default to OpenBMP kafka producer\n\nThis applies default values to the Kafka producer of the OpenBMP\nIntegration Adapter. The defaults are the same as the ones used in the\nOpenBMP reference implementation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21ec1e46c060e359c06c194e79c802f53ce8d703", "author": {"user": {"login": "fooker", "name": "Dustin Frisch"}}, "url": "https://github.com/OpenNMS/opennms/commit/21ec1e46c060e359c06c194e79c802f53ce8d703", "committedDate": "2020-03-05T13:17:06Z", "message": "NMS-12574: Apply default to OpenBMP kafka producer\n\nThis applies default values to the Kafka producer of the OpenBMP\nIntegration Adapter. The defaults are the same as the ones used in the\nOpenBMP reference implementation."}, "afterCommit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d", "author": {"user": {"login": "fooker", "name": "Dustin Frisch"}}, "url": "https://github.com/OpenNMS/opennms/commit/d567196a43d7d110625bdb47703c30c7ef15ff5d", "committedDate": "2020-03-12T12:40:59Z", "message": "NMS-12574: Apply default to OpenBMP kafka producer\n\nThis applies default values to the Kafka producer of the OpenBMP\nIntegration Adapter. The defaults are the same as the ones used in the\nOpenBMP reference implementation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTA4MDE1", "url": "https://github.com/OpenNMS/opennms/pull/2911#pullrequestreview-373908015", "createdAt": "2020-03-12T21:19:54Z", "commit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxOTo1NFrOF1vqJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMToxOTo1NFrOF1vqJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5OTY4NA==", "bodyText": "I think these two parameters are sufficient for increasing the default message size. By default it is 1MB, you may want to increase it to 10MB.\nkafkaConfig.putIfAbsent(ProducerConfig.COMPRESSION_TYPE_CONFIG, \"snappy\");\nkafkaConfig.putIfAbsent(ProducerConfig.MAX_REQUEST_SIZE_CONFIG, 1000000);\nAlso we should allow the config to be added from osgi configuration just like here\nThe loaded config should override anything that we set here.  So we can totally skip these defaults and allow user to add them.", "url": "https://github.com/OpenNMS/opennms/pull/2911#discussion_r391899684", "createdAt": "2020-03-12T21:19:54Z", "author": {"login": "cgorantla"}, "path": "features/telemetry/protocols/bmp/adapter/src/main/java/org/opennms/netmgt/telemetry/protocols/bmp/adapter/openbmp/BmpKafkaProducer.java", "diffHunk": "@@ -59,7 +60,12 @@ public BmpKafkaProducer(final String topicPrefix,\n     }\n \n     private static KafkaProducer<String, String> buildProducer(final Map<String, Object> kafkaConfig) {\n-        // TODO fooker: Apply defaults (steal from https://github.com/SNAS/openbmp/blob/1a615a3c75a0143cc87ec70458471f0af67d3929/Server/src/kafka/MsgBusImpl_kafka.cpp#L162) (see https://issues.opennms.org/browse/NMS-12574)\n+        // Apply some defaults\n+        kafkaConfig.putIfAbsent(ProducerConfig.BATCH_SIZE_CONFIG, 100);\n+        kafkaConfig.putIfAbsent(ProducerConfig.COMPRESSION_TYPE_CONFIG, \"snappy\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2OTczNjE1", "url": "https://github.com/OpenNMS/opennms/pull/2911#pullrequestreview-376973615", "createdAt": "2020-03-18T15:25:23Z", "commit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDY1NDUz", "url": "https://github.com/OpenNMS/opennms/pull/2911#pullrequestreview-377065453", "createdAt": "2020-03-18T17:05:06Z", "commit": {"oid": "d567196a43d7d110625bdb47703c30c7ef15ff5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3787, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}