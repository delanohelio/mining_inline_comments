{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDQ3ODcw", "number": 3825, "title": "Feature/partial starred", "bodyText": "Fix for https://ucsc-cgl.atlassian.net/browse/SEAB-1689 plus tests", "createdAt": "2020-09-23T21:22:37Z", "url": "https://github.com/dockstore/dockstore/pull/3825", "merged": true, "mergeCommit": {"oid": "6e877bf8e2272121c5e47029e48997c84bbab394"}, "closed": true, "closedAt": "2020-09-25T23:24:59Z", "author": {"login": "denis-yuen"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLy_kCgH2gAyNDkyMDQ3ODcwOmRlNDQwYzg4MzQwYWM4MGZmNmZiMTQ0NjdhYjIzMGNjZWViMDI3ZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMb2JDAH2gAyNDkyMDQ3ODcwOjMxZDgwZGEyOTc5MmM4Y2RjM2I5MmU2NmU3Y2Y3NGFmOTZlOGFjNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de440c88340ac80ff6fb14467ab230cceeb027e4", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/de440c88340ac80ff6fb14467ab230cceeb027e4", "committedDate": "2020-09-23T20:55:05Z", "message": "Fix issue with no starred org or no starred entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77aaa87cdcb47452874cd8289cfec300eb02accb", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/77aaa87cdcb47452874cd8289cfec300eb02accb", "committedDate": "2020-09-23T21:20:51Z", "message": "Tests and cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/98afa831ed2d49c341c8145d4f39750eb6800128", "committedDate": "2020-09-24T15:44:27Z", "message": "Merge branch 'develop' into feature/partial_starred"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTkwNDcy", "url": "https://github.com/dockstore/dockstore/pull/3825#pullrequestreview-495990472", "createdAt": "2020-09-24T22:21:56Z", "commit": {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoyMTo1NlrOHXunBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjoyMTo1NlrOHXunBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0Mjk0OQ==", "bodyText": "could probably delete this then?", "url": "https://github.com/dockstore/dockstore/pull/3825#discussion_r494642949", "createdAt": "2020-09-24T22:21:56Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Event.java", "diffHunk": "@@ -41,7 +41,7 @@\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByEntryId\", query = \"SELECT e FROM Event e where e.workflow.id = :entryId OR e.tool.id = :entryId\"),\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllForOrganization\", query = \"SELECT eve FROM Event eve WHERE eve.organization.id = :organizationId ORDER BY id DESC\"),\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIds\", query = \"SELECT e FROM Event e WHERE e.organization.id in :organizationIDs ORDER BY id DESC\"),\n-        @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\", query = \"SELECT e FROM Event e WHERE (e.organization.id in :organizationIDs) OR (e.tool.id in :entryIDs) OR (e.workflow.id in :entryIDs) ORDER BY id DESC\"),\n+        @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\", query = \"SELECT e FROM Event e WHERE e.organization.id in (:organizationIDs) OR e.tool.id in (:entryIDs) OR e.workflow.id in (:entryIDs) ORDER BY id DESC\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDI3MzY5", "url": "https://github.com/dockstore/dockstore/pull/3825#pullrequestreview-496027369", "createdAt": "2020-09-25T00:05:42Z", "commit": {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDowNTo0MlrOHXwlhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMDowNTo0MlrOHXwlhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3NTMzMw==", "bodyText": "Does this work correctly? Doesn't event.get(\"organization\") return an Organization object? And it's trying to see if it's in a list of Long?\nI know this gets converted into SQL, so maybe it ends up automagically working, that it knows to get the id of the organization, and you have passing tests, but still, just want to be sure.", "url": "https://github.com/dockstore/dockstore/pull/3825#discussion_r494675333", "createdAt": "2020-09-25T00:05:42Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/jdbi/EventDAO.java", "diffHunk": "@@ -68,13 +76,29 @@ public long countAllEventsForOrganization(long organizationId) {\n \n     public List<Event> findAllByOrganizationIdsOrEntryIds(Set<Long> organizationIds, Set<Long> entryIds, Integer offset, int limit) {\n         int newLimit = Math.min(MAX_LIMIT, limit);\n-        if (organizationIds.isEmpty()) {\n+\n+        CriteriaBuilder cb = currentSession().getCriteriaBuilder();\n+        CriteriaQuery<Event> query = criteriaQuery();\n+        Root<Event> event = query.from(Event.class);\n+\n+        if (organizationIds.isEmpty() && entryIds.isEmpty()) {\n             return Collections.emptyList();\n         }\n-        Query<Event> query = this.currentSession().getNamedQuery(\"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\");\n-        query.setParameterList(\"organizationIDs\", organizationIds).setParameter(\"entryIDs\", entryIds)\n-                .setFirstResult(offset).setMaxResults(newLimit);\n-        return list(query);\n+        List<Predicate> list = new ArrayList<>();\n+        if (!organizationIds.isEmpty()) {\n+            list.add(event.get(\"organization\").in(organizationIds));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2914f0bc8a5f9adfb4250ce163c6870579fc7769", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/2914f0bc8a5f9adfb4250ce163c6870579fc7769", "committedDate": "2020-09-25T14:37:14Z", "message": "Laggard delete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTA3MDQ0", "url": "https://github.com/dockstore/dockstore/pull/3825#pullrequestreview-496507044", "createdAt": "2020-09-25T15:04:48Z", "commit": {"oid": "2914f0bc8a5f9adfb4250ce163c6870579fc7769"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NjIyMjM3", "url": "https://github.com/dockstore/dockstore/pull/3825#pullrequestreview-496622237", "createdAt": "2020-09-25T17:41:52Z", "commit": {"oid": "2914f0bc8a5f9adfb4250ce163c6870579fc7769"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31d80da29792c8cdc3b92e66e7cf74af96e8ac49", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/31d80da29792c8cdc3b92e66e7cf74af96e8ac49", "committedDate": "2020-09-25T20:30:54Z", "message": "Merge branch 'develop' into feature/partial_starred"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1778, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}