{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTYwNzk2", "number": 3853, "title": "fix githubWebhookDelete() for deleting default WorkflowVersion", "bodyText": "Main issue: #3796\nWe currently don't handle deleting versions via GitHub Apps that are the default version for a workflow on Dockstore (results in an SQL foreign key violation).\nThis PR checks if the version being deleted is a default version for a workflow, and if so, unsets the workflow's default version.", "createdAt": "2020-10-08T20:12:01Z", "url": "https://github.com/dockstore/dockstore/pull/3853", "merged": true, "mergeCommit": {"oid": "15ad4ce281b1c063e8968dc72b0a84b7c1271b6b"}, "closed": true, "closedAt": "2020-10-09T21:10:44Z", "author": {"login": "GFJHogue"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQnPg6AH2gAyNTAwMTYwNzk2OmY1Yjk2ZjU4YTMzMDcyN2Q1NDQxMzc4ODVhMzBmZWY5YjhhZGNlYmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ8ptSgFqTUwNTk4NjEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5b96f58a330727d544137885a30fef9b8adcebb", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/f5b96f58a330727d544137885a30fef9b8adcebb", "committedDate": "2020-10-08T20:03:16Z", "message": "fix githubWebhookDelete() for deleting default WorkflowVersion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTUwMzAy", "url": "https://github.com/dockstore/dockstore/pull/3853#pullrequestreview-505150302", "createdAt": "2020-10-08T20:42:26Z", "commit": {"oid": "f5b96f58a330727d544137885a30fef9b8adcebb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTYyOTI0", "url": "https://github.com/dockstore/dockstore/pull/3853#pullrequestreview-505162924", "createdAt": "2020-10-08T21:01:41Z", "commit": {"oid": "f5b96f58a330727d544137885a30fef9b8adcebb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTowMTo0MVrOHewQ6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTowMTo0MVrOHewQ6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxMDA4OQ==", "bodyText": "This may depend on the resolution to Louise's comment, but you should probably make this a filter/findFirst so you don't keep looping through the versions even after you've found the default.", "url": "https://github.com/dockstore/dockstore/pull/3853#discussion_r502010089", "createdAt": "2020-10-08T21:01:41Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractWorkflowResource.java", "diffHunk": "@@ -282,6 +282,13 @@ private WorkflowVersion updateDBVersionSourceFilesWithRemoteVersionSourceFiles(W\n         List<Workflow> workflows = workflowDAO.findAllByPath(\"github.com/\" + repository, false).stream().filter(workflow -> Objects.equals(workflow.getMode(), DOCKSTORE_YML)).collect(\n                 Collectors.toList());\n \n+        // When the git reference is the default version, unset the default version\n+        workflows.forEach(workflow -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5b96f58a330727d544137885a30fef9b8adcebb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee82dbfa0689a0d55e8283133ca18bdc50f47463", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/ee82dbfa0689a0d55e8283133ca18bdc50f47463", "committedDate": "2020-10-09T14:39:43Z", "message": "reset default to next latest version when deleting the default version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1e5267c91ffcbff4045d3513d57f7cd6f4dd323", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/c1e5267c91ffcbff4045d3513d57f7cd6f4dd323", "committedDate": "2020-10-09T14:40:08Z", "message": "Merge branch 'develop' into feature/3796/githubapp-delete-default-version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzQxMjM5", "url": "https://github.com/dockstore/dockstore/pull/3853#pullrequestreview-505741239", "createdAt": "2020-10-09T14:44:15Z", "commit": {"oid": "c1e5267c91ffcbff4045d3513d57f7cd6f4dd323"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1ODMzOTYw", "url": "https://github.com/dockstore/dockstore/pull/3853#pullrequestreview-505833960", "createdAt": "2020-10-09T16:41:29Z", "commit": {"oid": "c1e5267c91ffcbff4045d3513d57f7cd6f4dd323"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "612fd32d9a09e13a61bef592599f54bdbe94bc3f", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/612fd32d9a09e13a61bef592599f54bdbe94bc3f", "committedDate": "2020-10-09T19:53:03Z", "message": "Merge branch 'develop' into feature/3796/githubapp-delete-default-version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTg2MTI4", "url": "https://github.com/dockstore/dockstore/pull/3853#pullrequestreview-505986128", "createdAt": "2020-10-09T20:59:53Z", "commit": {"oid": "612fd32d9a09e13a61bef592599f54bdbe94bc3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1799, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}