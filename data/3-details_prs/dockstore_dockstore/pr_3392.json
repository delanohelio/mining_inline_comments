{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDEyODE3", "number": 3392, "title": "Feature/seab 1063/500 search endpoint", "bodyText": "For SEAB-1063\nSurface the ES response code so that there's less 500 errors.  Not entirely sure this is what we want.\nAlso removed security from the openapi search endpoint, it's not supposed to have it.", "createdAt": "2020-04-14T21:03:10Z", "url": "https://github.com/dockstore/dockstore/pull/3392", "merged": true, "mergeCommit": {"oid": "aefae0757f37153e67a8659ad88d82ee1bd060fd"}, "closed": true, "closedAt": "2020-04-21T18:38:43Z", "author": {"login": "garyluu"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXppy7AH2gAyNDAzNDEyODE3OmUxMmFjNmYyMDc5NjQ4MzE0ZmUzOTVhMjUwMTFkNzE4ZDE1MWJhZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ0tj4gH2gAyNDAzNDEyODE3OmE0NzUzN2FhNTRkMDM3NGI3MzY2NDMyYjU1ZTE4OGUwMDE0ZDhiNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e12ac6f2079648314fe395a25011d718d151baf4", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/e12ac6f2079648314fe395a25011d718d151baf4", "committedDate": "2020-04-14T20:38:06Z", "message": "Surface ES error code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f9a7c9fedf4312065a2f9fb804f2edfeb3cc139", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/2f9a7c9fedf4312065a2f9fb804f2edfeb3cc139", "committedDate": "2020-04-14T20:38:41Z", "message": "Remove security from endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdcd539bf2bccae315141f2a2eb0ee9b043169a7", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/fdcd539bf2bccae315141f2a2eb0ee9b043169a7", "committedDate": "2020-04-14T21:04:38Z", "message": "Update swagger/openapi"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODM2MDkz", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-393836093", "createdAt": "2020-04-15T14:35:20Z", "commit": {"oid": "fdcd539bf2bccae315141f2a2eb0ee9b043169a7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/b69b86fb624be896fac1fd7dce3b4b54f45c1bb6", "committedDate": "2020-04-15T14:49:41Z", "message": "Only surface 400 errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTEwMTYy", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-393910162", "createdAt": "2020-04-15T15:53:15Z", "commit": {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTQ2OTM0", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-393946934", "createdAt": "2020-04-15T16:38:01Z", "commit": {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozODowMVrOGGCNLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozODoxNFrOGGCNyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk4MDc4Mw==", "bodyText": "We should log the exception", "url": "https://github.com/dockstore/dockstore/pull/3392#discussion_r408980783", "createdAt": "2020-04-15T16:38:01Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/proposedGA4GH/ToolsApiExtendedServiceImpl.java", "diffHunk": "@@ -211,9 +213,17 @@ public Response toolsIndexSearch(String query, MultivaluedMap<String, String> qu\n                             HttpStatus.SC_INTERNAL_SERVER_ERROR);\n                 }\n                 return Response.ok().entity(get.getEntity().getContent()).build();\n-            } catch (IOException e) {\n-                LOG.error(\"Could not use elastic search index\", e);\n-                throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+            } catch (ResponseException e) {\n+                // Only surface these codes to the user, everything else is not entirely obvious so returning 500 instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk4MDkzNw==", "bodyText": "Log the exception", "url": "https://github.com/dockstore/dockstore/pull/3392#discussion_r408980937", "createdAt": "2020-04-15T16:38:14Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/proposedGA4GH/ToolsApiExtendedServiceImpl.java", "diffHunk": "@@ -211,9 +213,17 @@ public Response toolsIndexSearch(String query, MultivaluedMap<String, String> qu\n                             HttpStatus.SC_INTERNAL_SERVER_ERROR);\n                 }\n                 return Response.ok().entity(get.getEntity().getContent()).build();\n-            } catch (IOException e) {\n-                LOG.error(\"Could not use elastic search index\", e);\n-                throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+            } catch (ResponseException e) {\n+                // Only surface these codes to the user, everything else is not entirely obvious so returning 500 instead.\n+                int[] codesToResurface = {HttpStatus.SC_BAD_REQUEST};\n+                int statusCode = e.getResponse().getStatusLine().getStatusCode();\n+                if (ArrayUtils.contains(codesToResurface, statusCode)) {\n+                    throw new CustomWebApplicationException(e.getMessage(), statusCode);\n+                } else {\n+                    throw new CustomWebApplicationException(e.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);\n+                }\n+            } catch (IOException e2) {\n+                throw new CustomWebApplicationException(e2.getMessage(), HttpStatus.SC_INTERNAL_SERVER_ERROR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b69b86fb624be896fac1fd7dce3b4b54f45c1bb6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8601d7f652a5c68e21690f142de3d8a7cec3e7d1", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/8601d7f652a5c68e21690f142de3d8a7cec3e7d1", "committedDate": "2020-04-15T16:54:32Z", "message": "Log exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTYxNDIy", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-393961422", "createdAt": "2020-04-15T16:56:37Z", "commit": {"oid": "8601d7f652a5c68e21690f142de3d8a7cec3e7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTYzNzcz", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-393963773", "createdAt": "2020-04-15T16:59:32Z", "commit": {"oid": "8601d7f652a5c68e21690f142de3d8a7cec3e7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a76cad1bf8b2a2975b4510c8164e766beb1195fa", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/a76cad1bf8b2a2975b4510c8164e766beb1195fa", "committedDate": "2020-04-15T17:10:53Z", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDY5MjEz", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-394069213", "createdAt": "2020-04-15T19:25:17Z", "commit": {"oid": "a76cad1bf8b2a2975b4510c8164e766beb1195fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MTgzNjAz", "url": "https://github.com/dockstore/dockstore/pull/3392#pullrequestreview-395183603", "createdAt": "2020-04-17T06:09:54Z", "commit": {"oid": "a76cad1bf8b2a2975b4510c8164e766beb1195fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "387f41d3c566cf465d1a07337c8293bdb44db75c", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/387f41d3c566cf465d1a07337c8293bdb44db75c", "committedDate": "2020-04-20T14:01:35Z", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a47537aa54d0374b7366432b55e188e0014d8b50", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/a47537aa54d0374b7366432b55e188e0014d8b50", "committedDate": "2020-04-21T14:39:01Z", "message": "Merge branch 'develop' into feature/SEAB-1063/500SearchEndpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1844, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}