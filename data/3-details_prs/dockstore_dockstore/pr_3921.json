{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3OTkxODI5", "number": 3921, "title": "deleting snapshotted version", "bodyText": "#3915\nWe weren't checking if the version was frozen before deleting.", "createdAt": "2020-11-09T19:33:55Z", "url": "https://github.com/dockstore/dockstore/pull/3921", "merged": true, "mergeCommit": {"oid": "b3821a4121d3cda95ee156072eca3a261e6e1a09"}, "closed": true, "closedAt": "2020-11-20T20:29:28Z", "author": {"login": "NatalieEO"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda5_SfgH2gAyNTE3OTkxODI5OjU2ZDU1MTJlZjlkNTFhZTA4NTdiNTczZTk5OGU3ZjcxOWYzNjVmMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeLtzggH2gAyNTE3OTkxODI5OjgxZjI3MzliNjc4ZTlmMzc1MjE3YTFkYTExN2FmN2NjZjk2NTIxZjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/56d5512ef9d51ae0857b573e998e7f719f365f00", "committedDate": "2020-11-09T19:32:59Z", "message": "deleting snapshotted version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjEyNDE3", "url": "https://github.com/dockstore/dockstore/pull/3921#pullrequestreview-526612417", "createdAt": "2020-11-09T20:05:19Z", "commit": {"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjM3OTg0", "url": "https://github.com/dockstore/dockstore/pull/3921#pullrequestreview-526637984", "createdAt": "2020-11-09T20:42:49Z", "commit": {"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjYyMzEx", "url": "https://github.com/dockstore/dockstore/pull/3921#pullrequestreview-526662311", "createdAt": "2020-11-09T21:18:56Z", "commit": {"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToxODo1NlrOHwB_3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToxODo1NlrOHwB_3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEyNjQyOA==", "bodyText": "If the version isn't present, it will silently fail as well. Fail less severely than the bug you're fixing, but I think you should throw a 404 in that case.", "url": "https://github.com/dockstore/dockstore/pull/3921#discussion_r520126428", "createdAt": "2020-11-09T21:18:56Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -394,6 +394,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Parameter(hidden = true,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+\n+        Optional<U> deleteVersion =  entry.getWorkflowVersions().stream().filter(v -> Objects.equals(v.getName(), version)).findFirst();\n+        if (deleteVersion.isPresent() && deleteVersion.get().isFrozen()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56d5512ef9d51ae0857b573e998e7f719f365f00"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a1f86616c4b82b0e3b51ba9fd1f4024e97d1e6d", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/7a1f86616c4b82b0e3b51ba9fd1f4024e97d1e6d", "committedDate": "2020-11-17T00:57:28Z", "message": "throw error if version not found"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29acb298f413a8f151690d1b10e2629c3f5f9b7", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/e29acb298f413a8f151690d1b10e2629c3f5f9b7", "committedDate": "2020-11-17T00:57:55Z", "message": "Merge branch 'develop' into 3915/deletingFrozenHostedVersion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTg2NTMz", "url": "https://github.com/dockstore/dockstore/pull/3921#pullrequestreview-531986533", "createdAt": "2020-11-17T02:58:05Z", "commit": {"oid": "e29acb298f413a8f151690d1b10e2629c3f5f9b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18dca653105bd4b1abbf73e3c0bc975f356399f2", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/18dca653105bd4b1abbf73e3c0bc975f356399f2", "committedDate": "2020-11-19T01:58:11Z", "message": "fix test, never deleted the version before."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDUyMzg3", "url": "https://github.com/dockstore/dockstore/pull/3921#pullrequestreview-534052387", "createdAt": "2020-11-19T03:17:52Z", "commit": {"oid": "18dca653105bd4b1abbf73e3c0bc975f356399f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "902e2470e2620a9a8bb9a2f571365bb06bc424c5", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/902e2470e2620a9a8bb9a2f571365bb06bc424c5", "committedDate": "2020-11-19T17:43:22Z", "message": "add test that deleting frozen version fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81f2739b678e9f375217a1da117af7ccf96521f3", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/81f2739b678e9f375217a1da117af7ccf96521f3", "committedDate": "2020-11-19T23:53:57Z", "message": "Merge branch 'develop' into 3915/deletingFrozenHostedVersion"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1615, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}