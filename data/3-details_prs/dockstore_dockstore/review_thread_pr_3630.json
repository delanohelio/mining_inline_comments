{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjExMjg0", "number": 3630, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozMzoxMVrOEMhGrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMTozOTo1NVrOEMqfnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTYwNzQ5OnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozMzoxMVrOGurBiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozMzoxMVrOGurBiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU5MjU4NA==", "bodyText": "Probably a bit more readable as SourceControl.GITHUB + '/' + serviceRepo", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451592584", "createdAt": "2020-07-08T14:33:11Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "diffHunk": "@@ -249,6 +255,7 @@ public void testSelfDestruct() throws ApiException {\n         // Verify that admin can access unpublished workflow, because admin is going to verify later\n         // that the workflow is gone\n         adminWorkflowsApi.getWorkflowByPath(WorkflowIT.DOCKSTORE_TEST_USER2_HELLO_DOCKSTORE_WORKFLOW, null, false);\n+        adminWorkflowsApi.getWorkflowByPath(github + \"/\" + serviceRepo, null, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08990df20330b1a3ae8338d1aa680aa7ca05e34c"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTYwOTM3OnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozMzozNlrOGurCww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozMzozNlrOGurCww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU5Mjg5OQ==", "bodyText": "Ditto, can use constant", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451592899", "createdAt": "2020-07-08T14:33:36Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "diffHunk": "@@ -278,6 +285,15 @@ public void testSelfDestruct() throws ApiException {\n         }\n         assertTrue(expectedAdminAccessToFail);\n \n+        // Verify that self-destruct also deleted the service\n+        boolean expectedAdminServiceAccessToFail = false;\n+        try {\n+            adminWorkflowsApi.getWorkflowByPath(github + \"/\" + serviceRepo, null, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08990df20330b1a3ae8338d1aa680aa7ca05e34c"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTYxNTAyOnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozNDo1NVrOGurGiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozNDo1NVrOGurGiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU5Mzg2NA==", "bodyText": "Should assert that the exception is due to it being missing (would have expected a relevant error message or a wrapped 404 or something)\nOtherwise, this could \"pass\" if the api is just broken in some other way.", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451593864", "createdAt": "2020-07-08T14:34:55Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "diffHunk": "@@ -278,6 +285,15 @@ public void testSelfDestruct() throws ApiException {\n         }\n         assertTrue(expectedAdminAccessToFail);\n \n+        // Verify that self-destruct also deleted the service\n+        boolean expectedAdminServiceAccessToFail = false;\n+        try {\n+            adminWorkflowsApi.getWorkflowByPath(github + \"/\" + serviceRepo, null, true);\n+        } catch (ApiException e) {\n+            expectedAdminServiceAccessToFail = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08990df20330b1a3ae8338d1aa680aa7ca05e34c"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNTY2NTQ0OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDo0NTo1NlrOGurmaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDo0ODoyOFrOGurtkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMjAyNw==", "bodyText": "what's the difference between this filter and the DAO findByUser?", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451602027", "createdAt": "2020-07-08T14:45:56Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "diffHunk": "@@ -313,6 +314,13 @@ private void deleteSelfFromEntries(User user) {\n                 });\n     }\n \n+    // We don't delete the LambdaEvent because it is useful for other users\n+    private void deleteSelfFromLambdaEvents(User user) {\n+        lambdaEventDAO.findByUser(user).stream()\n+                .filter(lambdaEvent -> lambdaEvent.getUser() == user)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08990df20330b1a3ae8338d1aa680aa7ca05e34c"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMzg1Nw==", "bodyText": "D'oh, there isn't any. Will fix.", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451603857", "createdAt": "2020-07-08T14:48:28Z", "author": {"login": "GFJHogue"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "diffHunk": "@@ -313,6 +314,13 @@ private void deleteSelfFromEntries(User user) {\n                 });\n     }\n \n+    // We don't delete the LambdaEvent because it is useful for other users\n+    private void deleteSelfFromLambdaEvents(User user) {\n+        lambdaEventDAO.findByUser(user).stream()\n+                .filter(lambdaEvent -> lambdaEvent.getUser() == user)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMjAyNw=="}, "originalCommit": {"oid": "08990df20330b1a3ae8338d1aa680aa7ca05e34c"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNzAwNjY4OnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDo1MjoyOVrOGu40CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDo1MjoyOVrOGu40CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgxODUwNA==", "bodyText": "Can use a constant to be more readable, something like the version 4 equivalent\nhttps://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/HttpStatus.html#SC_BAD_REQUEST", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451818504", "createdAt": "2020-07-08T20:52:29Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "diffHunk": "@@ -274,10 +280,21 @@ public void testSelfDestruct() throws ApiException {\n             adminWorkflowsApi.getWorkflowByPath(WorkflowIT.DOCKSTORE_TEST_USER2_HELLO_DOCKSTORE_WORKFLOW, null, false);\n \n         } catch (ApiException e) {\n+            assertTrue(e.getCode() == 400);\n             expectedAdminAccessToFail = true;\n         }\n         assertTrue(expectedAdminAccessToFail);\n \n+        // Verify that self-destruct also deleted the service\n+        boolean expectedAdminServiceAccessToFail = false;\n+        try {\n+            adminWorkflowsApi.getWorkflowByPath(SourceControl.GITHUB + \"/\" + serviceRepo, null, true);\n+        } catch (ApiException e) {\n+            assertTrue(e.getCode() == 400);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb817e48e91a67e2f731672d8866aea960cea86d"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNzE0NTg5OnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMTozOTo1NVrOGu6KtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMTozOTo1NVrOGu6KtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg0MDY5Mg==", "bodyText": "assertEquals(expected, actual) or assertEquals(message, expected, actual) here and below", "url": "https://github.com/dockstore/dockstore/pull/3630#discussion_r451840692", "createdAt": "2020-07-08T21:39:55Z", "author": {"login": "garyluu"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/webservice/UserResourceIT.java", "diffHunk": "@@ -274,10 +280,21 @@ public void testSelfDestruct() throws ApiException {\n             adminWorkflowsApi.getWorkflowByPath(WorkflowIT.DOCKSTORE_TEST_USER2_HELLO_DOCKSTORE_WORKFLOW, null, false);\n \n         } catch (ApiException e) {\n+            assertTrue(e.getCode() == HttpStatus.SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6093b55ca776f1f50adaf7b6a75d58e53dc02b55"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2990, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}