{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NDgzNDUx", "number": 3692, "title": "Feature/2834/record parsing info", "bodyText": "For #2834 #1569 #2985\nJust recording, not hooked up to frontend or anything.  Probably needs workflows/{workflowId}/versions/{versionId} endpoint first\nCould use a better name for ParsedInformation", "createdAt": "2020-07-24T20:46:35Z", "url": "https://github.com/dockstore/dockstore/pull/3692", "merged": true, "mergeCommit": {"oid": "1ef100ed43edaa399dc6a174aa2c7574c642933b"}, "closed": true, "closedAt": "2020-07-31T15:01:03Z", "author": {"login": "garyluu"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3Miv-AH2gAyNDU2NDgzNDUxOjJhMDg4ZTJmMjk0MjcwYTQ1MGUyYjQ3OWQ5YjRlMTE1ZDI2NDg4MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6KdACgH2gAyNDU2NDgzNDUxOjU3YTg2NTNhNzQwYzI2M2MyNzNmN2ExMGZmNGViNTI4Y2Q3YjY0NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2a088e2f294270a450e2b479d9b4e115d2648830", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/2a088e2f294270a450e2b479d9b4e115d2648830", "committedDate": "2020-07-21T20:48:44Z", "message": "Add new elementcollection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c46a8a839fa488abcd259b3d31ae79ee1c1b141", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/9c46a8a839fa488abcd259b3d31ae79ee1c1b141", "committedDate": "2020-07-24T00:35:27Z", "message": "Add migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0367a476d09b677cc1a330ca46e0b0f171224447", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/0367a476d09b677cc1a330ca46e0b0f171224447", "committedDate": "2020-07-24T00:35:27Z", "message": "Add warning message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683bd691aca7a6628d334e1b2a1a08cc121c2587", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/683bd691aca7a6628d334e1b2a1a08cc121c2587", "committedDate": "2020-07-24T00:35:27Z", "message": "Parse descriptors for type of imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41883a4f20ffba9f3b538138a1596c47415c2e8f", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/41883a4f20ffba9f3b538138a1596c47415c2e8f", "committedDate": "2020-07-24T00:35:27Z", "message": "Actually return the ParsedInformation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff6c0ccf9107cb89e88979b256c9ea2483b6859", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/fff6c0ccf9107cb89e88979b256c9ea2483b6859", "committedDate": "2020-07-24T20:11:18Z", "message": "Add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea6b5c251d8ade2d97e2f80d406a9ab92c65e13f", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ea6b5c251d8ade2d97e2f80d406a9ab92c65e13f", "committedDate": "2020-07-24T20:11:18Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f6e9d1576c792fa1472e5d36e035db22fc1d4ad", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/2f6e9d1576c792fa1472e5d36e035db22fc1d4ad", "committedDate": "2020-07-24T20:11:18Z", "message": "Fix migration?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37763a69d4eabc926214d5b78709d47f1a6028c5", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/37763a69d4eabc926214d5b78709d47f1a6028c5", "committedDate": "2020-07-24T20:11:18Z", "message": "Update swagger/openapi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4827a3cb0fd9a5beea0191503949983aa6655c", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/4e4827a3cb0fd9a5beea0191503949983aa6655c", "committedDate": "2020-07-28T14:14:58Z", "message": "Merge branch 'develop' into feature/2834/recordParsingInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79e0078318aa359437183ce04f25e99620f6989a", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/79e0078318aa359437183ce04f25e99620f6989a", "committedDate": "2020-07-28T17:57:21Z", "message": "Attempt to fix database"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf4766e7f54266ec714734dcdbdaf52a29e946e6", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/cf4766e7f54266ec714734dcdbdaf52a29e946e6", "committedDate": "2020-07-28T17:36:22Z", "message": "Fix again"}, "afterCommit": {"oid": "79e0078318aa359437183ce04f25e99620f6989a", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/79e0078318aa359437183ce04f25e99620f6989a", "committedDate": "2020-07-28T17:57:21Z", "message": "Attempt to fix database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff561e388ea8ec4037b0ea27c26c8740977074e0", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ff561e388ea8ec4037b0ea27c26c8740977074e0", "committedDate": "2020-07-28T21:45:24Z", "message": "Fix orphans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/fc5ac87d968ac3777422ac765b94336fff250a56", "committedDate": "2020-07-28T23:48:05Z", "message": "Self review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTg3NzQw", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-457587740", "createdAt": "2020-07-29T14:36:56Z", "commit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDozNjo1N1rOG47l4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0NDowNlrOG477Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM0OTc5NQ==", "bodyText": "Can this be split into two shorter tests for CWL and WDL separately?\n(Makes it easier to debug in the future if one language parsing method is broken)", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462349795", "createdAt": "2020-07-29T14:36:57Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/WorkflowIT.java", "diffHunk": "@@ -205,6 +206,74 @@ private Workflow manualRegisterAndPublish(WorkflowsApi workflowsApi, String work\n         return workflow;\n     }\n \n+    // Tests 6 things:\n+    // WDL workflow with local imports\n+    // WDL workflow with HTTP imports\n+    // CWL workflow with local imports\n+    // CWL workflow with HTTP imports\n+    // WDL workflow with HTTP imports and local imports and nested\n+    // CWL workflow with HTTP imports and local imports and nested\n+    @Test\n+    public void testLanguageParsingInformation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1MjEzOA==", "bodyText": "Might become more clear further down, but since this only is two booleans, it might be worth looking into making this embedded https://www.baeldung.com/jpa-embedded-embeddable so you can still interact with this as an object but it has no independent id and/or table from version metadata", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462352138", "createdAt": "2020-07-29T14:39:57Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/ParsedInformation.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package io.dockstore.webservice.core;\n+\n+import javax.persistence.Entity;\n+import javax.persistence.EnumType;\n+import javax.persistence.Enumerated;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+\n+import io.dockstore.common.DescriptorLanguage;\n+\n+/**\n+ * This is for information gained after parsing the workflow with a language parser (WDLHandler, CWLHandler, etc)\n+ *\n+ * Putting DescriptorLanguage here instead of using a map with DescriptorLanguage because there may be cases where the language is\n+ * irrelevant. For example, workflows only have one language.\n+ */\n+@Entity\n+public class ParsedInformation {\n+    @Id\n+    @GeneratedValue\n+    private Long id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1MzUxMg==", "bodyText": "Ah rats", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462353512", "createdAt": "2020-07-29T14:41:45Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -141,7 +141,9 @@\n     @ApiModelProperty(value = \"True if user has altered the tag\", position = 8)\n     private boolean dirtyBit = false;\n \n-    @JsonIgnore\n+    // Warning: this is eagerly loaded because of two reasons:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NTI5NQ==", "bodyText": "could this be a problem if some jerk has a folder with a name like httpStuffIgot/data/?\nhttps://commons.apache.org/proper/commons-validator/apidocs/org/apache/commons/validator/routines/UrlValidator.html might be an option already on our classpath", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462355295", "createdAt": "2020-07-29T14:44:06Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -492,6 +495,19 @@ private void handleMap(String repositoryId, String parentFilePath, Version versi\n         }\n     }\n \n+    /**\n+     * Sets the type of imports in ParsedInformation based on the import string\n+     * @param parsedInformation     A version's version metadata's\n+     * @param mapValue              Import string (should be either a local import or an HTTP(s) import\n+     */\n+    private void setImportsBasedOnMapValue(ParsedInformation parsedInformation, String mapValue) {\n+        if (mapValue.startsWith(\"http\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71ccbf02ab997596fe66539749d307fe848ddeb6", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/71ccbf02ab997596fe66539749d307fe848ddeb6", "committedDate": "2020-07-29T16:19:23Z", "message": "Simple PR changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa1760fdbdd3f8b329d280d670d6856f7da4b350", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/aa1760fdbdd3f8b329d280d670d6856f7da4b350", "committedDate": "2020-07-29T16:23:21Z", "message": "Seperate test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NjczNjIz", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-457673623", "createdAt": "2020-07-29T16:07:52Z", "commit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNjowNzo1M1rOG4_p7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNjoxNzowNFrOG5ACaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQxNjM2Ng==", "bodyText": "Why is this Long instead of long? I think Long should only be used if it's nullable.", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462416366", "createdAt": "2020-07-29T16:07:53Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/ParsedInformation.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package io.dockstore.webservice.core;\n+\n+import javax.persistence.Entity;\n+import javax.persistence.EnumType;\n+import javax.persistence.Enumerated;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+\n+import io.dockstore.common.DescriptorLanguage;\n+\n+/**\n+ * This is for information gained after parsing the workflow with a language parser (WDLHandler, CWLHandler, etc)\n+ *\n+ * Putting DescriptorLanguage here instead of using a map with DescriptorLanguage because there may be cases where the language is\n+ * irrelevant. For example, workflows only have one language.\n+ */\n+@Entity\n+public class ParsedInformation {\n+    @Id\n+    @GeneratedValue\n+    private Long id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyMjYzMg==", "bodyText": "This would normally result in a database record being persisted. However, if this ends up getting called from a read-only transaction, it won't be saved.\n\nMaybe this doesn't get called from a read-only transaction (don't have the whole flow in my head), in which case this whole comment is moot.\nIt looks very lightweight, so no big deal if it's not saved?\n\nPointing it out just in case.", "url": "https://github.com/dockstore/dockstore/pull/3692#discussion_r462422632", "createdAt": "2020-07-29T16:17:04Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/LanguageHandlerInterface.java", "diffHunk": "@@ -171,6 +172,19 @@ default String getCleanDAG(String mainDescriptorPath, String mainDescriptor, Set\n         return DAGHelper.cleanDAG(getContent(mainDescriptorPath, mainDescriptor, secondarySourceFiles, type, dao));\n     }\n \n+    default ParsedInformation getParsedInformation(Version version, DescriptorLanguage descriptorLanguage) {\n+        Optional<ParsedInformation> foundParsedInformation = version.getVersionMetadata().getParsedInformationSet().stream()\n+                .filter(parsedInformation -> parsedInformation.getDescriptorLanguage() == descriptorLanguage).findFirst();\n+        if (foundParsedInformation.isPresent()) {\n+            return foundParsedInformation.get();\n+        } else {\n+            ParsedInformation parsedInformation = new ParsedInformation();\n+            parsedInformation.setDescriptorLanguage(descriptorLanguage);\n+            version.getVersionMetadata().getParsedInformationSet().add(parsedInformation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc5ac87d968ac3777422ac765b94336fff250a56"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad2c8c610feb9aedbd57edbc7aaaa502e4570813", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ad2c8c610feb9aedbd57edbc7aaaa502e4570813", "committedDate": "2020-07-29T16:29:15Z", "message": "Add one more test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5362e8bdef6b2309f925e1bb73389a48584d0a4e", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/5362e8bdef6b2309f925e1bb73389a48584d0a4e", "committedDate": "2020-07-29T16:50:18Z", "message": "@Embedded attempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "282b8f5a0b3f4d99f3ed705dd41666057864e7cb", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/282b8f5a0b3f4d99f3ed705dd41666057864e7cb", "committedDate": "2020-07-29T19:57:35Z", "message": "Element collection list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTU5ODg4", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-457959888", "createdAt": "2020-07-29T23:12:31Z", "commit": {"oid": "282b8f5a0b3f4d99f3ed705dd41666057864e7cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e47dbdb6fd44eed37ef1619e2369206fe25c80f0", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/e47dbdb6fd44eed37ef1619e2369206fe25c80f0", "committedDate": "2020-07-30T04:44:37Z", "message": "Merge branch 'develop' into feature/2834/recordParsingInfo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NDY0MTE4", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-458464118", "createdAt": "2020-07-30T14:36:41Z", "commit": {"oid": "e47dbdb6fd44eed37ef1619e2369206fe25c80f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTkwMTE5", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-458590119", "createdAt": "2020-07-30T17:00:11Z", "commit": {"oid": "e47dbdb6fd44eed37ef1619e2369206fe25c80f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjQxODQz", "url": "https://github.com/dockstore/dockstore/pull/3692#pullrequestreview-458641843", "createdAt": "2020-07-30T18:11:51Z", "commit": {"oid": "e47dbdb6fd44eed37ef1619e2369206fe25c80f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5ad965e1a23e4313606a9af874a34f19dcb17ba", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/a5ad965e1a23e4313606a9af874a34f19dcb17ba", "committedDate": "2020-07-30T20:00:36Z", "message": "Merge branch 'develop' into feature/2834/recordParsingInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a8653a740c263c273f7a10ff4eb528cd7b6463", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/57a8653a740c263c273f7a10ff4eb528cd7b6463", "committedDate": "2020-07-31T02:04:25Z", "message": "Merge branch 'develop' into feature/2834/recordParsingInfo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1682, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}