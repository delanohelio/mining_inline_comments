{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODMwNDkz", "number": 3470, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1MToxMVrOD73R4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1NDowNFrOD73T9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDk4MjcyOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/BitBucketSourceCodeRepo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1MToxMVrOGUc3EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1MToxMVrOGUc3EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NzU1Mw==", "bodyText": "Log the exception", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424097553", "createdAt": "2020-05-12T23:51:11Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/BitBucketSourceCodeRepo.java", "diffHunk": "@@ -249,17 +249,23 @@ protected String getCommitID(String repositoryId, Version version) {\n         RefsApi refsApi = new RefsApi(apiClient);\n         try {\n             Branch branch = refsApi.repositoriesUsernameRepoSlugRefsBranchesNameGet(repositoryId.split(\"/\")[0], version.getReference(),\n-                repositoryId.split(\"/\")[0]);\n-            Tag tag = refsApi.repositoriesUsernameRepoSlugRefsTagsNameGet(repositoryId.split(\"/\")[0], version.getReference(),\n-                repositoryId.split(\"/\")[0]);\n+                repositoryId.split(\"/\")[1]);\n             if (branch != null) {\n                 return branch.getTarget().getHash();\n             }\n+        } catch (ApiException e) {\n+            LOG.error(gitUsername + \": apiexception on reading branch commitid\" + e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDk4MzIxOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/BitBucketSourceCodeRepo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1MToyNFrOGUc3Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1MToyNFrOGUc3Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NzYyMg==", "bodyText": "Log the exception", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424097622", "createdAt": "2020-05-12T23:51:24Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/BitBucketSourceCodeRepo.java", "diffHunk": "@@ -249,17 +249,23 @@ protected String getCommitID(String repositoryId, Version version) {\n         RefsApi refsApi = new RefsApi(apiClient);\n         try {\n             Branch branch = refsApi.repositoriesUsernameRepoSlugRefsBranchesNameGet(repositoryId.split(\"/\")[0], version.getReference(),\n-                repositoryId.split(\"/\")[0]);\n-            Tag tag = refsApi.repositoriesUsernameRepoSlugRefsTagsNameGet(repositoryId.split(\"/\")[0], version.getReference(),\n-                repositoryId.split(\"/\")[0]);\n+                repositoryId.split(\"/\")[1]);\n             if (branch != null) {\n                 return branch.getTarget().getHash();\n             }\n+        } catch (ApiException e) {\n+            LOG.error(gitUsername + \": apiexception on reading branch commitid\" + e.getMessage());\n+            // this is not so critical to warrant a http error code\n+        }\n+\n+        try {\n+            Tag tag = refsApi.repositoriesUsernameRepoSlugRefsTagsNameGet(repositoryId.split(\"/\")[0], version.getReference(),\n+                    repositoryId.split(\"/\")[1]);\n             if (tag != null) {\n                 return tag.getTarget().getHash();\n             }\n         } catch (ApiException e) {\n-            LOG.error(gitUsername + \": apiexception on reading commitid\" + e.getMessage());\n+            LOG.error(gitUsername + \": apiexception on reading tag commitid\" + e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDk4ODA1OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMzo1NDowNFrOGUc6XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjo1MDowNFrOGUv9Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODM5Ng==", "bodyText": "Without understanding the whole flow, why can't this return version.getCommitId()? If not, what is the TODO that you need to do?", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424098396", "createdAt": "2020-05-12T23:54:04Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "diffHunk": "@@ -185,7 +188,7 @@ public void updateReferenceType(String repositoryId, Version version) {\n \n     @Override\n     protected String getCommitID(String repositoryId, Version version) {\n-        //TODO: optimize here for gitlab by returning actual sha1\n+        //TODO: Commit ID is returned by an existing API call", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwNDY0NA==", "bodyText": "It could, but the only time this is called for GitLab is while doing tool refresh, which is not yet handled, so it would be null anyways.\nThis PR is just for workflows (to deal with refresh) so I didn't touch that part.", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424404644", "createdAt": "2020-05-13T12:40:56Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "diffHunk": "@@ -185,7 +188,7 @@ public void updateReferenceType(String repositoryId, Version version) {\n \n     @Override\n     protected String getCommitID(String repositoryId, Version version) {\n-        //TODO: optimize here for gitlab by returning actual sha1\n+        //TODO: Commit ID is returned by an existing API call", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODM5Ng=="}, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwNTExMg==", "bodyText": "I'll update the todo to make more sense.", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424405112", "createdAt": "2020-05-13T12:41:42Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "diffHunk": "@@ -185,7 +188,7 @@ public void updateReferenceType(String repositoryId, Version version) {\n \n     @Override\n     protected String getCommitID(String repositoryId, Version version) {\n-        //TODO: optimize here for gitlab by returning actual sha1\n+        //TODO: Commit ID is returned by an existing API call", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODM5Ng=="}, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQxMDM3NQ==", "bodyText": "Actually I'll just implement it.", "url": "https://github.com/dockstore/dockstore/pull/3470#discussion_r424410375", "createdAt": "2020-05-13T12:50:04Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "diffHunk": "@@ -185,7 +188,7 @@ public void updateReferenceType(String repositoryId, Version version) {\n \n     @Override\n     protected String getCommitID(String repositoryId, Version version) {\n-        //TODO: optimize here for gitlab by returning actual sha1\n+        //TODO: Commit ID is returned by an existing API call", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODM5Ng=="}, "originalCommit": {"oid": "c9449ff9a45f697094ff86b932e156a6f7bbc1e1"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2943, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}