{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDc4NDIz", "number": 3837, "title": "prevent workflow tool list from updating workflowversion when frozen", "bodyText": "Main bug: #3819\nThe workflowversion table has a policy that blocks UPDATEs when frozen = true.\nIf the workflow tool list endpoint doesn't find toolTableJson, it attempts to examine files and attempt to update the table. For frozen entries (snapshotted/DOI) this results in a 500 error.\nThis PR blocks the UPDATE for frozen workflowversions and preserves the existing behaviour.", "createdAt": "2020-09-29T20:18:44Z", "url": "https://github.com/dockstore/dockstore/pull/3837", "merged": true, "mergeCommit": {"oid": "8eba4ed4ccfcc6368d61a2d8b5b2db03f203ef83"}, "closed": true, "closedAt": "2020-10-01T16:03:06Z", "author": {"login": "GFJHogue"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNt5NaAH2gAyNDk1MDc4NDIzOjMyZmU5NTg0YWU2NDFmMmVkOGIzMDAwZDIyYjVhZDA0YzMxYTg1NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOBJdqgH2gAyNDk1MDc4NDIzOjY0ZGQ2MmQwNTMzZmJiMzEyYzQ3NTIyZTI5MGI0MWE0MzNlZDBkOGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/32fe9584ae641f2ed8b3000d22b5ad04c31a8575", "committedDate": "2020-09-29T20:06:28Z", "message": "prevent workflow tool list from updating workflowversion when frozen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTQ0NzI4", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-498944728", "createdAt": "2020-09-29T22:22:58Z", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDY3NTA4", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499467508", "createdAt": "2020-09-30T14:04:59Z", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTg1OTEw", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499585910", "createdAt": "2020-09-30T16:00:15Z", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTg4Nzk2", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499588796", "createdAt": "2020-09-30T16:03:27Z", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjowMzoyN1rOHakxHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjowMzoyN1rOHakxHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYyNzQyMA==", "bodyText": "oh wait, based off the convo, shouldn't this message change?", "url": "https://github.com/dockstore/dockstore/pull/3837#discussion_r497627420", "createdAt": "2020-09-30T16:03:27Z", "author": {"login": "NatalieEO"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -1531,7 +1531,13 @@ public String getTableToolContent(@ApiParam(hidden = true) @Parameter(hidden = t\n             LanguageHandlerInterface lInterface = LanguageHandlerFactory.getInterface(workflow.getFileType());\n             final String toolTableJson = lInterface.getContent(workflowVersion.getWorkflowPath(), mainDescriptor.getContent(), secondaryDescContent,\n                 LanguageHandlerInterface.Type.TOOLS, toolDAO);\n-            workflowVersion.setToolTableJson(toolTableJson);\n+\n+            // Can't UPDATE workflowversion when frozen = true\n+            if (workflowVersion.isFrozen()) {\n+                LOG.warn(\"workflow version \" + workflowVersionId + \" is frozen without a mainDescriptor\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTk0NTY0", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499594564", "createdAt": "2020-09-30T16:10:02Z", "commit": {"oid": "32fe9584ae641f2ed8b3000d22b5ad04c31a8575"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afdafca901d079d44c7e179a379b132512b9a1f3", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/afdafca901d079d44c7e179a379b132512b9a1f3", "committedDate": "2020-09-30T16:28:52Z", "message": "reword warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjI1NTc0", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499625574", "createdAt": "2020-09-30T16:46:56Z", "commit": {"oid": "afdafca901d079d44c7e179a379b132512b9a1f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjMxODk1", "url": "https://github.com/dockstore/dockstore/pull/3837#pullrequestreview-499631895", "createdAt": "2020-09-30T16:54:33Z", "commit": {"oid": "afdafca901d079d44c7e179a379b132512b9a1f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64dd62d0533fbb312c47522e290b41a433ed0d8d", "author": {"user": {"login": "GFJHogue", "name": "Gregory F J Hogue"}}, "url": "https://github.com/dockstore/dockstore/commit/64dd62d0533fbb312c47522e290b41a433ed0d8d", "committedDate": "2020-09-30T18:32:25Z", "message": "Merge branch 'develop' into feature/3819/workflow-tool-list-update-frozen"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1783, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}