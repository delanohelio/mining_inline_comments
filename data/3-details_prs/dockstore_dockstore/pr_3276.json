{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODk1MjQy", "number": 3276, "title": "added logging statements for tool and workflow refresh endpoints", "bodyText": "For https://ucsc-cgl.atlassian.net/browse/SEAB-844.\nAdded logging statements for tool and workflow refresh endpoints so Cloudwatch metrics can be created from them.", "createdAt": "2020-02-27T14:59:13Z", "url": "https://github.com/dockstore/dockstore/pull/3276", "merged": true, "mergeCommit": {"oid": "aa4d8e7c15f0b8868423413c5c1315be5391f686"}, "closed": true, "closedAt": "2020-02-28T19:04:33Z", "author": {"login": "kathy-t"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIchP2AH2gAyMzgwODk1MjQyOjBkNzY3NzFiNTEwZDhlNDE2MDQyYTkyMWI3MDVkNDUyZDY5M2M1OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIzLYcAFqTM2NTk5MTY5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c", "author": {"user": null}, "url": "https://github.com/dockstore/dockstore/commit/0d76771b510d8e416042a921b705d452d693c58c", "committedDate": "2020-02-27T14:51:08Z", "message": "added logging statements for tool and workflow refresh endpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzY4OTc3", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-365768977", "createdAt": "2020-02-27T15:47:39Z", "commit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODQ1OTcy", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-365845972", "createdAt": "2020-02-27T17:17:09Z", "commit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNzoxMFrOFvZ9nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxNzoxMFrOFvZ9nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1Mjc2NA==", "bodyText": "I don't have the whole context for this, and I see the ticket says to only log the type, but since you're in here anyways why not log the actual tool as well?\nJust a thought, which may not be applicable.", "url": "https://github.com/dockstore/dockstore/pull/3276#discussion_r385252764", "createdAt": "2020-02-27T17:17:10Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/AbstractImageRegistry.java", "diffHunk": "@@ -276,6 +280,17 @@ public Tool refreshTool(final long toolId, final Long userId, final UserDAO user\n         return updatedTool;\n     }\n \n+    /**\n+     * Logs a refresh statement with the tool's descriptor language(s)\n+     * @param tool                tool that is being refreshed\n+     */\n+    private void logToolRefresh(final Tool tool) {\n+        List<String> descriptorTypes = tool.getDescriptorType();\n+        for (String descriptorType : descriptorTypes) {\n+            LOG.info(\"Refreshing \" + descriptorType + \" tool\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1OTA1NDc2", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-365905476", "createdAt": "2020-02-27T18:41:51Z", "commit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODo0MTo1MVrOFvcxZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODo0MTo1MVrOFvcxZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI5ODc5MA==", "bodyText": "Could use an additional comment on why it's logging it.", "url": "https://github.com/dockstore/dockstore/pull/3276#discussion_r385298790", "createdAt": "2020-02-27T18:41:51Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -363,6 +365,16 @@ private void refreshHelper(final SourceCodeRepoInterface sourceCodeRepoInterface\n         }\n     }\n \n+    /**\n+     * Logs a refresh statement with the workflow's descriptor language if workflow is a FULL workflow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d76771b510d8e416042a921b705d452d693c58c"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97", "author": {"user": null}, "url": "https://github.com/dockstore/dockstore/commit/f9cdbd35e4dd0e621aefd85dea42366a5acdbd97", "committedDate": "2020-02-27T20:37:16Z", "message": "created a configurable string to use as a prefix. added tool/workflow name in logging statement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDA3OTIz", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-366007923", "createdAt": "2020-02-27T21:22:50Z", "commit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMToyMjo1MVrOFvhqOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMToyMjo1MVrOFvhqOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM3ODg3NA==", "bodyText": "workflow.getEntryPath() here, tool.getEntryPath() up there seems simpler.", "url": "https://github.com/dockstore/dockstore/pull/3276#discussion_r385378874", "createdAt": "2020-02-27T21:22:51Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -363,6 +367,17 @@ private void refreshHelper(final SourceCodeRepoInterface sourceCodeRepoInterface\n         }\n     }\n \n+    /**\n+     * Logs a refresh statement with the workflow's descriptor language if workflow is a FULL workflow.\n+     * These logs will be monitored by CloudWatch and displayed on Grafana.\n+     * @param workflow                workflow that is being refreshed\n+     */\n+    private void logFullWorkflowRefresh(final Workflow workflow) {\n+        if (workflow.getMode() == WorkflowMode.FULL) {\n+            LOG.info(String.format(\"%s: Refreshing %s workflow named %s\", dashboardPrefix, workflow.getDescriptorType(), workflow.getWorkflowPath()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDA0NDE4", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-366404418", "createdAt": "2020-02-28T13:43:10Z", "commit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMzo0MzoxMFrOFv1V6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMzo0MzoxMFrOFv1V6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcwMTM1NA==", "bodyText": "Missing new parameter in function JavaDoc.", "url": "https://github.com/dockstore/dockstore/pull/3276#discussion_r385701354", "createdAt": "2020-02-28T13:43:10Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/AbstractImageRegistry.java", "diffHunk": "@@ -145,7 +145,7 @@\n     @SuppressWarnings(\"checkstyle:parameternumber\")\n     public List<Tool> refreshTools(final long userId, final UserDAO userDAO, final ToolDAO toolDAO, final TagDAO tagDAO,\n             final FileDAO fileDAO, final FileFormatDAO fileFormatDAO, final HttpClient client, final Token githubToken, final Token bitbucketToken, final Token gitlabToken,\n-            String organization, final EventDAO eventDAO) {\n+            String organization, final EventDAO eventDAO, final String dashboardPrefix) {\n         // Get all the namespaces for the given registry", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "072eafcf5bb3eb1e5de9773dda6116af06657e83", "author": {"user": null}, "url": "https://github.com/dockstore/dockstore/commit/072eafcf5bb3eb1e5de9773dda6116af06657e83", "committedDate": "2020-02-28T14:06:58Z", "message": "used workflow.getEntryPath() and tool.getEntryPath(). added dashboardPrefix parameter to refreshTools JavaDoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NTE0NDE2", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-366514416", "createdAt": "2020-02-28T16:13:55Z", "commit": {"oid": "072eafcf5bb3eb1e5de9773dda6116af06657e83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1OTkxNjk1", "url": "https://github.com/dockstore/dockstore/pull/3276#pullrequestreview-365991695", "createdAt": "2020-02-27T20:56:19Z", "commit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMDo1NjoyMFrOFvg5ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMDo1NjoyMFrOFvg5ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM2NjQzNQ==", "bodyText": "I think the name is redundant, but it doesn't hurt.", "url": "https://github.com/dockstore/dockstore/pull/3276#discussion_r385366435", "createdAt": "2020-02-27T20:56:20Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/DockstoreWebserviceConfiguration.java", "diffHunk": "@@ -481,6 +483,15 @@ public void setExternalGoogleClientIdPrefixes(List<String> externalGoogleClientI\n         this.externalGoogleClientIdPrefixes = externalGoogleClientIdPrefixes;\n     }\n \n+    @JsonProperty(\"dashboard\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9cdbd35e4dd0e621aefd85dea42366a5acdbd97"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1796, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}