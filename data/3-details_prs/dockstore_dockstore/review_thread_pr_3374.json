{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODk1NzI5", "number": 3374, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDowODoyMlrODukGaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozMToxMFrODwInEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMTUyNTUzOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDowODoyMlrOGAnIaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMToyMToyNlrOGAqDlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI5NDMxMw==", "bodyText": "Thinking it might be better to just choose the newest version available and setting that to the default version (in the case that there is at least one left).", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403294313", "createdAt": "2020-04-03T20:08:22Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,10 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            entry.setActualDefaultVersion(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MjIzMQ==", "bodyText": "Ok, that's do-able", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403342231", "createdAt": "2020-04-03T21:21:26Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,10 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            entry.setActualDefaultVersion(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI5NDMxMw=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMTU3NDU0OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoxNzoyMFrOGAnhxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNjo1NToyOVrOGD_56Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg==", "bodyText": "This is changing from the default always being the most recent to being \"sticky\".\nThoughts?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403300806", "createdAt": "2020-04-03T20:17:20Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MTk0OA==", "bodyText": "I think the problem was that the user keeps refreshing the entire organization and the UI would change the implicit default version to the most recent one (which they did not want).  This will set the default version to the most recent one once.  If it's the wrong one they can just change it to whatever.\nFor hosted ones, we also want to avoid changing too often (like if they were doing small modifications for testing purposes)", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403341948", "createdAt": "2020-04-03T21:20:46Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0NDE5MQ==", "bodyText": "seems reasonable, pinging @coverbeck @wshands for thoughts", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403344191", "createdAt": "2020-04-03T21:26:14Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NDQwOQ==", "bodyText": "Agreed, the implicit default version has led to confusion with Terra team.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403394409", "createdAt": "2020-04-04T00:23:33Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0NTkyOQ==", "bodyText": "I agree", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r406845929", "createdAt": "2020-04-10T16:55:29Z", "author": {"login": "wshands"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMTY2MTg0OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDozMjo1NFrOGAoQUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMTo0MDozMVrOGAqhLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjcyMQ==", "bodyText": "Not sure this is the right date to sort on. This is generated by the DB with @UpdateTimestamp\nI think this means that it will change when something like frozen is set.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403312721", "createdAt": "2020-04-03T20:32:54Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -354,7 +363,10 @@ public void setDefaultBranchIfNotSet(Entry entry, String repositoryId) {\n                             String reference = workflowVersion.getReference();\n                             return branch.equals(reference);\n                         }).findFirst();\n-                firstWorkflowVersion.ifPresent(version -> entry.checkAndSetDefaultVersion(version.getName()));\n+                firstWorkflowVersion.ifPresentOrElse(version -> entry.checkAndSetDefaultVersion(version.getName()), () -> {\n+                    Version newestVersion = Collections.max(workflowVersions, Comparator.comparingInt(s -> s.getDbUpdateDate().getNanos()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0NDUyOQ==", "bodyText": "do you think lastBuilt for tags and lastModified for workflowversion is better?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403344529", "createdAt": "2020-04-03T21:27:06Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -354,7 +363,10 @@ public void setDefaultBranchIfNotSet(Entry entry, String repositoryId) {\n                             String reference = workflowVersion.getReference();\n                             return branch.equals(reference);\n                         }).findFirst();\n-                firstWorkflowVersion.ifPresent(version -> entry.checkAndSetDefaultVersion(version.getName()));\n+                firstWorkflowVersion.ifPresentOrElse(version -> entry.checkAndSetDefaultVersion(version.getName()), () -> {\n+                    Version newestVersion = Collections.max(workflowVersions, Comparator.comparingInt(s -> s.getDbUpdateDate().getNanos()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjcyMQ=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0OTgwNg==", "bodyText": "Looking at \"Dates/Timestamps in Database for Tools and Workflows\" in the shared drive, looks like yes", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403349806", "createdAt": "2020-04-03T21:40:31Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -354,7 +363,10 @@ public void setDefaultBranchIfNotSet(Entry entry, String repositoryId) {\n                             String reference = workflowVersion.getReference();\n                             return branch.equals(reference);\n                         }).findFirst();\n-                firstWorkflowVersion.ifPresent(version -> entry.checkAndSetDefaultVersion(version.getName()));\n+                firstWorkflowVersion.ifPresentOrElse(version -> entry.checkAndSetDefaultVersion(version.getName()), () -> {\n+                    Version newestVersion = Collections.max(workflowVersions, Comparator.comparingInt(s -> s.getDbUpdateDate().getNanos()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjcyMQ=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMjIyMzM1OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDoxNjo0NlrOGAtKaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDoxNjo0NlrOGAtKaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5MzEyOQ==", "bodyText": "Can you put the implementation in entry? Looks like the Tool and Workflow implementations are identical.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403393129", "createdAt": "2020-04-04T00:16:46Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -158,6 +166,25 @@ public Tool(long id, String name) {\n         workflowVersions = new TreeSet<>();\n     }\n \n+    @Override\n+    public String getDefaultVersion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbe44d9bf10f44793d50f24455b98c312287ee02"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMjI0Mjg1OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDozMDowNVrOGAtUXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDozMDowNVrOGAtUXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTY3OA==", "bodyText": "Shouldn't the filter be !Object.equals(...? You're trying to grab the max date of all versions excluding the version you're about to delete?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403395678", "createdAt": "2020-04-04T00:30:05Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> Objects.equals(v.getName(), version))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbe44d9bf10f44793d50f24455b98c312287ee02"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwODA2MDcxOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTozOTowM1rOGBd0FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MzoxNlrOGBeAdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MDIyOA==", "bodyText": "Why call this actual default version instead of just default version?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404190228", "createdAt": "2020-04-06T15:39:03Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -143,6 +146,11 @@\n     @Cascade(CascadeType.DETACH)\n     private final SortedSet<Tag> workflowVersions;\n \n+    @JsonIgnore\n+    @OneToOne(targetEntity = Tag.class, fetch = FetchType.LAZY)\n+    @JoinColumn(name = \"actualDefaultVersion\", referencedColumnName = \"id\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MzM5Nw==", "bodyText": "it already exists", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404193397", "createdAt": "2020-04-06T15:43:16Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -143,6 +146,11 @@\n     @Cascade(CascadeType.DETACH)\n     private final SortedSet<Tag> workflowVersions;\n \n+    @JsonIgnore\n+    @OneToOne(targetEntity = Tag.class, fetch = FetchType.LAZY)\n+    @JoinColumn(name = \"actualDefaultVersion\", referencedColumnName = \"id\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MDIyOA=="}, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwODA2Njk0OnYy", "diffSide": "LEFT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Entry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MDoyNlrOGBd4GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo1MzoxMFrOGBedZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MTI1Ng==", "bodyText": "Removing this might break the CLI. Can you confirm if this is the case or not?\n(and how broken or not it is)", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404191256", "createdAt": "2020-04-06T15:40:26Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Entry.java", "diffHunk": "@@ -136,10 +136,6 @@\n     @ApiModelProperty(value = \"This is the email of the git organization\", position = 6)\n     private String email;\n \n-    @Column", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwMDgwNg==", "bodyText": "CLI and the UI is based on the swagger.yaml . I made sure to not alter it. It seems unlikely to break.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404200806", "createdAt": "2020-04-06T15:53:10Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Entry.java", "diffHunk": "@@ -136,10 +136,6 @@\n     @ApiModelProperty(value = \"This is the email of the git organization\", position = 6)\n     private String email;\n \n-    @Column", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MTI1Ng=="}, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwODA4MDc5OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MzoyMVrOGBeAtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MzoyMVrOGBeAtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MzQ2MQ==", "bodyText": "Javadoc this (looks like a date for the underlying content, whether descriptor files or docker image) and", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404193461", "createdAt": "2020-04-06T15:43:21Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -195,6 +196,9 @@ public String getVerifiedSource() {\n         }\n     }\n \n+    @JsonIgnore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzk5MzEyOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozMToxMFrOGC90uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDowOTozM1rOGC_E9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2MzI1OQ==", "bodyText": "I feel like we should give the user with a warning that they're deleting the default version so we're setting the new default to latest. Maybe we should log this message to surface in the UI?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r405763259", "createdAt": "2020-04-08T19:31:10Z", "author": {"login": "Ldcabansay"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> !Objects.equals(v.getName(), version))\n+                    .max(Comparator.comparingLong(ver -> ver.getDate().getTime()));\n+            entry.setActualDefaultVersion(max.orElse(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2NTg0OA==", "bodyText": "@garyluu please create a follow-up ticket", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r405765848", "createdAt": "2020-04-08T19:36:12Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> !Objects.equals(v.getName(), version))\n+                    .max(Comparator.comparingLong(ver -> ver.getDate().getTime()));\n+            entry.setActualDefaultVersion(max.orElse(null));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2MzI1OQ=="}, "originalCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc4Mzc5Ng==", "bodyText": "#3381", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r405783796", "createdAt": "2020-04-08T20:09:33Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> !Objects.equals(v.getName(), version))\n+                    .max(Comparator.comparingLong(ver -> ver.getDate().getTime()));\n+            entry.setActualDefaultVersion(max.orElse(null));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2MzI1OQ=="}, "originalCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2895, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}