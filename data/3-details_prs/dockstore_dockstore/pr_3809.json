{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2OTQzODE4", "number": 3809, "title": "Feature/3559/notification char limit", "bodyText": "#3559\nIncrease Size of message for notifications from 280 to 1024\nDatabase migration to generate changes for database\nAdd integration test for notifications to try and create and update notifications that are over the limit\nAdd a text file that is over 1024 characters", "createdAt": "2020-09-14T23:30:59Z", "url": "https://github.com/dockstore/dockstore/pull/3809", "merged": true, "mergeCommit": {"oid": "258968372617f33921391378ce74d93d53fb54f7"}, "closed": true, "closedAt": "2020-09-18T16:13:54Z", "author": {"login": "nolwarre"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH9xA3gH2gAyNDg2OTQzODE4OmJmNDgzZjhhZjBiODY5ODA3MzU0OTEzMzA1MmY5NDE0Yjg4Y2FlZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJiGuIAH2gAyNDg2OTQzODE4OjIyMmNkODI0MmY3ZjBiODY5ZjBhMWFhNGFiYTI5ZGJhZWZjYjFjZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf483f8af0b8698073549133052f9414b88caef8", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/bf483f8af0b8698073549133052f9414b88caef8", "committedDate": "2020-09-11T23:12:27Z", "message": "Notification char limit increase, migrations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b33a973e7fbd57965aadd43b29cfb86ced98f89d", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/b33a973e7fbd57965aadd43b29cfb86ced98f89d", "committedDate": "2020-09-14T21:29:04Z", "message": "Make an integration test for notifications that are too long using a file with over 1024 characters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/e57b07ca87fc49c28c96bae2e458208a585cc7f3", "committedDate": "2020-09-14T21:45:51Z", "message": "Modify IT imports to satisfy checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MjMyMzcw", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-488232370", "createdAt": "2020-09-14T23:58:30Z", "commit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMzo1ODozMFrOHRrmOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMzo1ODo0OFrOHRrmlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMjEzNw==", "bodyText": "You need a fail after this line; otherwise if the test doesn't throw an error it will pass.", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488302137", "createdAt": "2020-09-14T23:58:30Z", "author": {"login": "coverbeck"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -131,4 +145,33 @@ public void testUpdateNotification() {\n         assertEquals(currentMsg, message);  // confirm that the database entry was updated\n \n     }\n+    @Test\n+    public void testLongNotification() throws IOException {\n+\n+        // set up a notification that is too long\n+        Notification notification = longNotification();\n+\n+        // try to create notification with too long of a message\n+        try {\n+            curationApiAdmin.createNotification(notification);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMjIyOA==", "bodyText": "Also need fail after this line.", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488302228", "createdAt": "2020-09-14T23:58:48Z", "author": {"login": "coverbeck"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -131,4 +145,33 @@ public void testUpdateNotification() {\n         assertEquals(currentMsg, message);  // confirm that the database entry was updated\n \n     }\n+    @Test\n+    public void testLongNotification() throws IOException {\n+\n+        // set up a notification that is too long\n+        Notification notification = longNotification();\n+\n+        // try to create notification with too long of a message\n+        try {\n+            curationApiAdmin.createNotification(notification);\n+        } catch (ApiException e) {\n+            assertEquals(Response.Status.BAD_REQUEST.getStatusCode(), e.getCode()); // this should return a 400 code right now\n+        }\n+\n+        // make another notification that will be updated\n+        Notification updateNotification = curationApiAdmin.createNotification(testNotification());\n+        long id = updateNotification.getId();\n+        notification.setId(id);\n+\n+        // try to update notification with long notification\n+        try {\n+            curationApiAdmin.updateNotification(id, notification);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzYwMzY1", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-488760365", "createdAt": "2020-09-15T14:43:34Z", "commit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDo0MzozNFrOHSFaTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDo1MjozN1rOHSF2fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA2OA==", "bodyText": "Seems like an arbitrary number before and now. Can you make some sort of general comment about the number chosen?", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488725068", "createdAt": "2020-09-15T14:43:34Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Notification.java", "diffHunk": "@@ -44,7 +44,7 @@\n     private long id;\n \n     @Column\n-    @Size(max = 280)\n+    @Size(max = 1024)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczMjI4Ng==", "bodyText": "You can use Java 11's Files.readString(Paths.get(ResourceHelpers.resourceFilePath(\"longNotification\"))); instead of Apache commons", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488732286", "createdAt": "2020-09-15T14:52:37Z", "author": {"login": "garyluu"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -45,6 +50,15 @@ private Notification anotherTestNotification() {\n         return notification;\n     }\n \n+    private Notification longNotification() throws IOException {\n+        Notification notification = new Notification();\n+        String message = FileUtils.readFileToString(new File(ResourceHelpers.resourceFilePath(\"longNotification.txt\")), StandardCharsets.UTF_8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/db6c467a596fbce198740b5c6c82c26baafb8243", "committedDate": "2020-09-15T17:37:30Z", "message": "Added failure points for test\n\nChanged to Java 11 file read"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTIyODcy", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-488922872", "createdAt": "2020-09-15T17:46:13Z", "commit": {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDUyMzU0", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-489052354", "createdAt": "2020-09-15T20:38:35Z", "commit": {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTQ3ODE4", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-489147818", "createdAt": "2020-09-15T22:20:54Z", "commit": {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjoyMDo1NVrOHSXsHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjoyMDo1NVrOHSXsHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAyNDU0Mw==", "bodyText": "I know you just changed this, and I overlooked it in my first review, but I think it would be better to generate the string right here. Java 11 has a feature has a feature Sting.repeat. If you do it this way:\n\nYou know exactly how long the string is. How long is longNotification.txt? I have to open it an editor or run some tool that counts chars. At a glance, I don't know if you're really over testing the limit or not.\nYou could easily test different inputs, up to the limit, just over the limit, etc.\n\nSomething like this:\nString message = \"a\".repeat(1024);\n\nYou could make 1024 a parameter on line 53, so then you test it with exactly 1024, then test again with 1025.\nYou could even make the length a parameter on line 53.", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r489024543", "createdAt": "2020-09-15T22:20:55Z", "author": {"login": "coverbeck"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -45,6 +50,15 @@ private Notification anotherTestNotification() {\n         return notification;\n     }\n \n+    private Notification longNotification() throws IOException {\n+        Notification notification = new Notification();\n+        String message = Files.readString(Paths.get(ResourceHelpers.resourceFilePath(\"longNotification.txt\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4b1a1bed8822d6c319d88389f6c6fcfb1d38580", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/a4b1a1bed8822d6c319d88389f6c6fcfb1d38580", "committedDate": "2020-09-15T22:55:05Z", "message": "Update test to create a string of desired length instead of text file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Nzc2MDM3", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-489776037", "createdAt": "2020-09-16T16:00:38Z", "commit": {"oid": "a4b1a1bed8822d6c319d88389f6c6fcfb1d38580"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Nzg0MDIx", "url": "https://github.com/dockstore/dockstore/pull/3809#pullrequestreview-489784021", "createdAt": "2020-09-16T16:09:58Z", "commit": {"oid": "a4b1a1bed8822d6c319d88389f6c6fcfb1d38580"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "222cd8242f7f0b869f0a1aa4aba29dbaefcb1cdc", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/222cd8242f7f0b869f0a1aa4aba29dbaefcb1cdc", "committedDate": "2020-09-16T20:06:40Z", "message": "Merge branch 'develop' into feature/3559/notificationCharLimit"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1767, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}