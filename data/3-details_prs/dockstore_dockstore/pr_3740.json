{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDU4MDcw", "number": 3740, "title": "feature/3712/lazyLoadSourcefiles", "bodyText": "#3712\nFinally lazy loading source files. I wasn't sure if there was a way to get around refreshing/editing hosted entries loading the sourcefiles in order to update the database. So if I understand how hibernate works, those calls will still load them. Instead I strip source files before returning to the entry to the UI.\nHope the tests passed overnight.", "createdAt": "2020-08-12T23:28:53Z", "url": "https://github.com/dockstore/dockstore/pull/3740", "merged": true, "mergeCommit": {"oid": "308194e13a953e0877a12f86f8d0f6b0e4f61b4a"}, "closed": true, "closedAt": "2020-08-28T17:05:43Z", "author": {"login": "NatalieEO"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-2VRtAFqTQ2NzY2OTgyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDX6qbAFqTQ3Nzg4MjEyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjY5ODI1", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-467669825", "createdAt": "2020-08-14T15:27:30Z", "commit": {"oid": "1e14c2dd4fe31598fc6f3aa0b4d84bdeaf02e704"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3ODE4Nzc1", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-467818775", "createdAt": "2020-08-14T19:14:26Z", "commit": {"oid": "1e14c2dd4fe31598fc6f3aa0b4d84bdeaf02e704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOToxNDoyNlrOHBAmMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOToxNDoyNlrOHBAmMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgyMDQwMw==", "bodyText": "Have a question. if I understand correctly, the deleted code was relying on eager loading but prevents deleting content when stripping it out before serialization.\nremoveSourceFilesFromEntry seems to save the current state and then do the eviction. But why is a eviction no longer needed here specifically? Is it because lazy loading causes the source files to not be serialized anyway?", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r470820403", "createdAt": "2020-08-14T19:14:26Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/EntryVersionHelper.java", "diffHunk": "@@ -134,15 +136,20 @@ static void stripContent(List<? extends Entry> entries, AbstractDockstoreDAO dao\n             dao.evict(entry);\n             // clear users which are also lazy loaded\n             entry.setUsers(null);\n-            // need to have this evicted so that hibernate does not actually delete the tags and users", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e14c2dd4fe31598fc6f3aa0b4d84bdeaf02e704"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDI2NDU5", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-474026459", "createdAt": "2020-08-25T01:10:26Z", "commit": {"oid": "6bead7c5892eeabce10be1f4b880bd91ade0050f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMToxMDoyNlrOHF-Ygw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMToxMDoyNlrOHF-Ygw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNzAxMQ==", "bodyText": "Can you add a comment to the method explaining what is going on here? If I knew Hibernate better, I might understand. But I don't. I sort of see what's happening, but I don't think I grok all the details.", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r476027011", "createdAt": "2020-08-25T01:10:26Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/EntryVersionHelper.java", "diffHunk": "@@ -134,15 +136,20 @@ static void stripContent(List<? extends Entry> entries, AbstractDockstoreDAO dao\n             dao.evict(entry);\n             // clear users which are also lazy loaded\n             entry.setUsers(null);\n-            // need to have this evicted so that hibernate does not actually delete the tags and users\n-            Set<Version> versions = entry.getWorkflowVersions();\n-            versions.forEach(version ->\n-                version.getSourceFiles().forEach(sourceFile ->\n-                        ((SourceFile)sourceFile).setContent(null))\n-            );\n         }\n     }\n \n+    static void removeSourceFilesFromEntry(Entry entry, SessionFactory sessionFactory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bead7c5892eeabce10be1f4b880bd91ade0050f"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bead7c5892eeabce10be1f4b880bd91ade0050f", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/6bead7c5892eeabce10be1f4b880bd91ade0050f", "committedDate": "2020-08-24T15:50:03Z", "message": "Merge branch 'develop' into feature/3712/lazyLoadSourcefiles"}, "afterCommit": {"oid": "db8550f5c6cd04d9ce581f2bc714e828bf42b230", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/db8550f5c6cd04d9ce581f2bc714e828bf42b230", "committedDate": "2020-08-25T18:55:30Z", "message": "just add comment for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65bced32371ad9ac26395db30658266d92a5295d", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/65bced32371ad9ac26395db30658266d92a5295d", "committedDate": "2020-08-26T19:51:30Z", "message": "fix tests?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ec85848c58f55a3b2b94ece0cc233c23c9583a2", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/3ec85848c58f55a3b2b94ece0cc233c23c9583a2", "committedDate": "2020-08-26T19:51:30Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "586e6f108625645d1e2271b6e73a64eb248cf15f", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/586e6f108625645d1e2271b6e73a64eb248cf15f", "committedDate": "2020-08-26T19:51:30Z", "message": "forgot this file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a23c32805e9bffab4a1ad38a6b5db230483577d2", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/a23c32805e9bffab4a1ad38a6b5db230483577d2", "committedDate": "2020-08-26T19:51:30Z", "message": "see what else fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54cc28ef97f3786a17bad0f04d89242038f109c5", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/54cc28ef97f3786a17bad0f04d89242038f109c5", "committedDate": "2020-08-26T19:51:30Z", "message": "more fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53ed8f749a0373202d685e18b970c5ae7952e89", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/f53ed8f749a0373202d685e18b970c5ae7952e89", "committedDate": "2020-08-26T19:51:30Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35c4d657bfe3b55c9148ff525a3c1c3b87a0768a", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/35c4d657bfe3b55c9148ff525a3c1c3b87a0768a", "committedDate": "2020-08-26T19:51:30Z", "message": "fix tests and strip sourcefile from hosted entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2cc598902d7cb3943a7354f61ce588b67f97ed8", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/a2cc598902d7cb3943a7354f61ce588b67f97ed8", "committedDate": "2020-08-26T19:51:30Z", "message": "just add comment for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/f90fa9367600def0530256e920bd82b4f8c69c5e", "committedDate": "2020-08-26T20:08:43Z", "message": "rebase, checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db8550f5c6cd04d9ce581f2bc714e828bf42b230", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/db8550f5c6cd04d9ce581f2bc714e828bf42b230", "committedDate": "2020-08-25T18:55:30Z", "message": "just add comment for now"}, "afterCommit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/f90fa9367600def0530256e920bd82b4f8c69c5e", "committedDate": "2020-08-26T20:08:43Z", "message": "rebase, checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTQ4ODQ2", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-476948846", "createdAt": "2020-08-27T17:47:26Z", "commit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTc3NjE0", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-476977614", "createdAt": "2020-08-27T18:28:22Z", "commit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODoyODoyMlrOHIcTfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODoyODoyMlrOHIcTfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNDM5Nw==", "bodyText": "remove TODO", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r478614397", "createdAt": "2020-08-27T18:28:22Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -126,7 +126,7 @@\n     // watch out for https://hibernate.atlassian.net/browse/HHH-3799 if this is set to EAGER\n     // TODO: @JsonIgnore this field to catch more places in UI that use it.\n     // TODO: Change to FetchType.LAZY", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDU0Nzg2", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-477054786", "createdAt": "2020-08-27T20:25:13Z", "commit": {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753c798ef68730f5081b66544460eaf4c98b53e0", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/753c798ef68730f5081b66544460eaf4c98b53e0", "committedDate": "2020-08-27T20:41:19Z", "message": "remove todo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f323455d52975e050dec59526187c97057ec2b7e", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/f323455d52975e050dec59526187c97057ec2b7e", "committedDate": "2020-08-27T20:41:33Z", "message": "Merge branch 'develop' into feature/3712/lazyLoadSourcefiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODgyMTI3", "url": "https://github.com/dockstore/dockstore/pull/3740#pullrequestreview-477882127", "createdAt": "2020-08-28T16:50:54Z", "commit": {"oid": "f323455d52975e050dec59526187c97057ec2b7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1730, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}