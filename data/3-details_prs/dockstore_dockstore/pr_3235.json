{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDk5NzI0", "number": 3235, "title": "Feature/reduce language hardcoding", "bodyText": "Working on #3058, along with preceding work like #3163 this clears up about 90% of the hardcoded references for workflows. Tools are another matter and will require significant work, but is not needed for Galaxy support", "createdAt": "2020-02-13T21:36:27Z", "url": "https://github.com/dockstore/dockstore/pull/3235", "merged": true, "mergeCommit": {"oid": "f322b622544340a347464f0e76a34e9d2ebfb79b"}, "closed": true, "closedAt": "2020-02-18T22:04:27Z", "author": {"login": "denis-yuen"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEBW21gH2gAyMzc1MDk5NzI0OjQwNDg3Mzc4ZjcwZjc0M2Y4YmU2ZTI2ZDg1ZDAzYzY4YTNlMjgyMmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFpMZSgFqTM2MDcwMTk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40487378f70f743f8be6e26d85d03c68a3e2822f", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/40487378f70f743f8be6e26d85d03c68a3e2822f", "committedDate": "2020-02-13T20:56:39Z", "message": "Further reduce hardcoded languages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2095466012b7b02a288d916155287e330982211", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/a2095466012b7b02a288d916155287e330982211", "committedDate": "2020-02-13T21:33:51Z", "message": "Reduce more hardcoding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa3dbec61501d8d385bcc7c02e497fccb55fcca", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/4fa3dbec61501d8d385bcc7c02e497fccb55fcca", "committedDate": "2020-02-13T22:17:23Z", "message": "Fix found due to tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/a5d82ce4198f71c8ed33bc0e32758f1dad2107d9", "committedDate": "2020-02-13T22:31:24Z", "message": "Make codacy happier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDU0MjIw", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-359054220", "createdAt": "2020-02-14T16:14:33Z", "commit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDk5OTkw", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-359099990", "createdAt": "2020-02-14T17:24:49Z", "commit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzoyNDo1MFrOFp-CjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzozNDoxOVrOFp-Sjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU1MjM5Nw==", "bodyText": "Was like this, but I'm on a mission to log all exceptions and I would also make this LOG.error", "url": "https://github.com/dockstore/dockstore/pull/3235#discussion_r379552397", "createdAt": "2020-02-14T17:24:50Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "diffHunk": "@@ -700,8 +690,6 @@ public User getUserMetadata(User user) {\n         } catch (IOException ex) {\n             LOG.info(\"Could not find user information for user \" + user.getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU1NDMwMw==", "bodyText": "Not entirely grokking this whole flow, but should nextflow.config be hard-coded like this?", "url": "https://github.com/dockstore/dockstore/pull/3235#discussion_r379554303", "createdAt": "2020-02-14T17:29:09Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -1230,23 +1230,19 @@ public Workflow manualRegister(@ApiParam(hidden = true) @Auth User user,\n         @ApiParam(value = \"Descriptor type\", required = true) @QueryParam(\"descriptorType\") String descriptorType,\n         @ApiParam(value = \"Default test parameter file path\") @QueryParam(\"defaultTestParameterFilePath\") String defaultTestParameterFilePath) {\n \n-        // Validate descriptor path based on type\n-        if (\"nfl\".equals(descriptorType) && !defaultWorkflowPath.endsWith(\"nextflow.config\")) {\n-            throw new CustomWebApplicationException(\n-                    \"Please ensure that the given workflow path '\" + defaultWorkflowPath + \"' is of type \" + descriptorType\n+        for (DescriptorLanguage typeItem : DescriptorLanguage.values()) {\n+            if (typeItem.getShortName().equalsIgnoreCase(descriptorType)) {\n+                // check that plugin is active\n+                if (typeItem.isPluginLanguage() && !LanguageHandlerFactory.getPluginMap().containsKey(typeItem)) {\n+                    throw new CustomWebApplicationException(\"plugin for \" + typeItem.getShortName() + \" is not installed\",\n+                        HttpStatus.SC_BAD_REQUEST);\n+                }\n+                if (typeItem.getDefaultPrimaryDescriptorExtensions().stream().noneMatch(defaultWorkflowPath::endsWith)) {\n+                    throw new CustomWebApplicationException(\n+                        \"Please ensure that the given workflow path '\" + defaultWorkflowPath + \"' is of type \" + descriptorType\n                             + \" and ends in the file nextflow.config\", HttpStatus.SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU1NjQ5NQ==", "bodyText": "This is for line 1228, since I can't comment directly on it, and it's beyond the scope of the PR, but that one should mention nextflow, and eventually Galaxy. It's going to be an unfortunate mismatch, as the OpenAPI is generated at buildtime, the the language plugin support is at runtime.", "url": "https://github.com/dockstore/dockstore/pull/3235#discussion_r379556495", "createdAt": "2020-02-14T17:34:19Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -1230,23 +1230,19 @@ public Workflow manualRegister(@ApiParam(hidden = true) @Auth User user,\n         @ApiParam(value = \"Descriptor type\", required = true) @QueryParam(\"descriptorType\") String descriptorType,\n         @ApiParam(value = \"Default test parameter file path\") @QueryParam(\"defaultTestParameterFilePath\") String defaultTestParameterFilePath) {\n \n-        // Validate descriptor path based on type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d82ce4198f71c8ed33bc0e32758f1dad2107d9"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3099931e50024bf55948f17387e492a5ce93ad35", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/3099931e50024bf55948f17387e492a5ce93ad35", "committedDate": "2020-02-18T15:50:45Z", "message": "PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDg0OTU4", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-360484958", "createdAt": "2020-02-18T16:27:48Z", "commit": {"oid": "3099931e50024bf55948f17387e492a5ce93ad35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjoyNzo0OFrOFrJWDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjoyNzo0OFrOFrJWDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc4NjE5MQ==", "bodyText": "SonarLint doesn't like Joiner.on btw https://rules.sonarsource.com/java/RSPEC-4738", "url": "https://github.com/dockstore/dockstore/pull/3235#discussion_r380786191", "createdAt": "2020-02-18T16:27:48Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/WorkflowResource.java", "diffHunk": "@@ -1240,7 +1241,8 @@ public Workflow manualRegister(@ApiParam(hidden = true) @Auth User user,\n                 if (typeItem.getDefaultPrimaryDescriptorExtensions().stream().noneMatch(defaultWorkflowPath::endsWith)) {\n                     throw new CustomWebApplicationException(\n                         \"Please ensure that the given workflow path '\" + defaultWorkflowPath + \"' is of type \" + descriptorType\n-                            + \" and ends in the file nextflow.config\", HttpStatus.SC_BAD_REQUEST);\n+                            + \" and ends in an extension from\" + Joiner.on(\",\").join(typeItem.getDefaultPrimaryDescriptorExtensions()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3099931e50024bf55948f17387e492a5ce93ad35"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/6a7546c0fcfaba4d0819f92aaed6d3613ef2c036", "committedDate": "2020-02-18T17:12:46Z", "message": "More cleanup, discovered while hooking up Galaxy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjI0MDk3", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-360624097", "createdAt": "2020-02-18T19:47:33Z", "commit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjY5MDcw", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-360669070", "createdAt": "2020-02-18T21:00:55Z", "commit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzAwMjYw", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-360700260", "createdAt": "2020-02-18T21:52:29Z", "commit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1MjoyOVrOFrTyfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1MjoyOVrOFrTyfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzMxMA==", "bodyText": "I guess since it doesn't return anything now it might be better named setUserMetadata?", "url": "https://github.com/dockstore/dockstore/pull/3235#discussion_r380957310", "createdAt": "2020-02-18T21:52:29Z", "author": {"login": "david4096"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "diffHunk": "@@ -680,9 +671,8 @@ protected String getCommitID(String repositoryId, Version version) {\n     /**\n      * Updates a user object with metadata from GitHub\n      * @param user the user to be updated\n-     * @return Updated user object\n      */\n-    public User getUserMetadata(User user) {\n+    public void getUserMetadata(User user) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzAxOTg0", "url": "https://github.com/dockstore/dockstore/pull/3235#pullrequestreview-360701984", "createdAt": "2020-02-18T21:55:21Z", "commit": {"oid": "6a7546c0fcfaba4d0819f92aaed6d3613ef2c036"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1906, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}