{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzU3MDA3", "number": 3414, "title": "A little more sane path resolution for TRS", "bodyText": "working on #3335\nThere are two routes for this PR:\n\n\nDemonstrates backwards-compatible behaviour, behaviour which seems odd. Basically one test relies upon this trying a passed path as both a relative and an absolute path.\nLook at 4bc22a2 to see what that would look like\nFor example: even if the main descriptor is /cwls/cgpmap-bamOut.cwl, we allow cgpmap-bamOut.cwl (relative to the main), /cwls/cgpmap-bamOut.cwl (absolute) and /cgpmap-bamOut.cwl (no idea why)\nThis last case seems to stem from #1441\nI'm not entirely sure what might rely upon that extra slash although #1422 (comment) seems to indicate that we had doubled slashes being passed around at one point\n\n\nThe final state, breaks backwards compatible behaviour. We rely upon the user properly specifying a leading slash to indicate an absolute path rather than a relative path (rather than trying both). This seems more sane, but might break something.\n\n\nThoughts?", "createdAt": "2020-04-17T21:52:21Z", "url": "https://github.com/dockstore/dockstore/pull/3414", "merged": true, "mergeCommit": {"oid": "df59d65e25e727b4e7ba39f8faca4ccc038d8fee"}, "closed": true, "closedAt": "2020-04-27T18:56:17Z", "author": {"login": "denis-yuen"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYoKORAH2gAyNDA1MzU3MDA3OjAyMjg3N2I5MDEzMzE3ZGQ3ODFhZGE2ZDExNDAwZDk0YjNjNDJlZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbyrwWgFqTQwMTE2NzU1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "022877b9013317dd781ada6d11400d94b3c42ed2", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/022877b9013317dd781ada6d11400d94b3c42ed2", "committedDate": "2020-04-17T21:27:38Z", "message": "A little more sane path resolution, run through tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28d9761c9a32e48ac802f57d5a6177f16c4d6671", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/28d9761c9a32e48ac802f57d5a6177f16c4d6671", "committedDate": "2020-04-20T16:18:33Z", "message": "Fix for tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd719af88f4bce1284601fdd343554a0c3859c08", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/dd719af88f4bce1284601fdd343554a0c3859c08", "committedDate": "2020-04-20T18:45:23Z", "message": "More fix, adding specific test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bc22a2978d5c0b333b8530c3a3b5154233c1ba0", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/4bc22a2978d5c0b333b8530c3a3b5154233c1ba0", "committedDate": "2020-04-20T22:00:46Z", "message": "Terrible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed59ce5d19d60e07369eb2866cfb6d5a1d378c0a", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/ed59ce5d19d60e07369eb2866cfb6d5a1d378c0a", "committedDate": "2020-04-20T23:43:32Z", "message": "Merge branch 'develop' into feature/better_trs_relative_paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da8c9b1108e1a3f47782d11acff301201e4d38cf", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/da8c9b1108e1a3f47782d11acff301201e4d38cf", "committedDate": "2020-04-21T15:25:55Z", "message": "\"Proper fix\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63b4679f0415c43c6c8bb01f71fa3750d9c2e197", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/63b4679f0415c43c6c8bb01f71fa3750d9c2e197", "committedDate": "2020-04-21T15:26:06Z", "message": "Merge branch 'feature/better_trs_relative_paths' of github.com:dockstore/dockstore into feature/better_trs_relative_paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a85ebaf5f4eeb60565d6430a5f36f5f31fe7849", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/6a85ebaf5f4eeb60565d6430a5f36f5f31fe7849", "committedDate": "2020-04-21T22:06:10Z", "message": "Merge branch 'develop' into feature/better_trs_relative_paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9051a7dd0af038c86f12bdc8ab48e052fb85306", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/a9051a7dd0af038c86f12bdc8ab48e052fb85306", "committedDate": "2020-04-22T16:37:08Z", "message": "Additional side-effect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b9446806fdc255bed93fd604b17cd0f91a2d93", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/c9b9446806fdc255bed93fd604b17cd0f91a2d93", "committedDate": "2020-04-22T16:37:38Z", "message": "Merge branch 'feature/better_trs_relative_paths' of github.com:dockstore/dockstore into feature/better_trs_relative_paths"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTMwNTE1", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-399530515", "createdAt": "2020-04-23T22:50:16Z", "commit": {"oid": "c9b9446806fdc255bed93fd604b17cd0f91a2d93"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjo1MDoxNlrOGK_P8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjo1MDoxNlrOGK_P8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3NTIxNg==", "bodyText": "Why toLowerCase here and the rest of the method? This may never occur in practice, but Git is case-sensitive, and in theory somebody could have some the same filename with different casing and this might yield unexpected results.", "url": "https://github.com/dockstore/dockstore/pull/3414#discussion_r414175216", "createdAt": "2020-04-23T22:50:16Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java", "diffHunk": "@@ -605,28 +606,28 @@ public String getReasonPhrase() {\n      * Return a matching source file\n      *\n      * @param sourceFiles      files to look through\n-     * @param searchPathParam       file to look for\n+     * @param searchPathParam       file to look for, could be relative or absolute\n      * @param workingDirectory working directory if relevant\n      * @return\n      */\n     public Optional<SourceFile> lookForFilePath(Set<SourceFile> sourceFiles, String searchPathParam, String workingDirectory) {\n-        // ignore leading slashes\n-        String searchPath = cleanRelativePath(searchPathParam);\n-\n-        for (SourceFile sourceFile : sourceFiles) {\n-            String calculatedPath = sourceFile.getAbsolutePath();\n-            // annoyingly, test json and Dockerfiles include a fullpath whereas descriptors are just relative to the main descriptor,\n-            // so we need to standardize relative to the main descriptor\n-            if (SourceFile.TEST_FILE_TYPES.contains(sourceFile.getType())) {\n-                calculatedPath = StringUtils.removeStart(cleanRelativePath(sourceFile.getPath()), cleanRelativePath(workingDirectory));\n-            }\n-            calculatedPath = cleanRelativePath(calculatedPath);\n-            if (searchPath.equalsIgnoreCase(calculatedPath) || searchPath\n-                .equalsIgnoreCase(StringUtils.removeStart(calculatedPath, workingDirectory + \"/\"))) {\n-                return Optional.of(sourceFile);\n-            }\n+        String targetPath;\n+        if (searchPathParam.startsWith(\"/\")) {\n+            // treat searchPath as an absolute path\n+            targetPath = cleanRelativePath(searchPathParam).toLowerCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9b9446806fdc255bed93fd604b17cd0f91a2d93"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c", "author": {"user": {"login": "denis-yuen", "name": "Denis Yuen"}}, "url": "https://github.com/dockstore/dockstore/commit/d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c", "committedDate": "2020-04-24T19:39:01Z", "message": "Merge branch 'develop' into feature/better_trs_relative_paths"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjI3OTky", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-400227992", "createdAt": "2020-04-24T19:50:33Z", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTAzNDE2", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-401103416", "createdAt": "2020-04-27T16:06:43Z", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTE5NzE3", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-401119717", "createdAt": "2020-04-27T16:25:51Z", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTM4NDM1", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-401138435", "createdAt": "2020-04-27T16:48:24Z", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTY3NTU4", "url": "https://github.com/dockstore/dockstore/pull/3414#pullrequestreview-401167558", "createdAt": "2020-04-27T17:25:06Z", "commit": {"oid": "d64c057f9c819ab9a73f7fe34f9a38f4d02c4d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1849, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}