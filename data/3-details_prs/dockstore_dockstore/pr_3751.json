{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDcyNDY2", "number": 3751, "title": "Feature/3675/store license info", "bodyText": "For #3675\nAlso, what eles should we be storing in the license information (aside from name)?", "createdAt": "2020-08-17T21:17:52Z", "url": "https://github.com/dockstore/dockstore/pull/3751", "merged": true, "mergeCommit": {"oid": "f34f61677ad6040179692e15e9db5527e5ee16f4"}, "closed": true, "closedAt": "2020-08-25T19:07:22Z", "author": {"login": "garyluu"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_2FJCAH2gAyNDY5MDcyNDY2OjQzMWNhYWFlZDVkMDNjYmJmMDM4YTRmZTY0NmRkNjhiYjcxZWFiOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCaxZNAH2gAyNDY5MDcyNDY2OmMyMTU1YTRjMWM1MTQxZTQ0ODk0MTU2Mjk5ZjMxOWRiZmQ4MWZkNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "431caaaed5d03cbbf038a4fe646dd68bb71eab90", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/431caaaed5d03cbbf038a4fe646dd68bb71eab90", "committedDate": "2020-08-17T17:43:48Z", "message": "Update GitHub API dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c7a4b48d141418adb86d58ebc76c948d217ab2b", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/3c7a4b48d141418adb86d58ebc76c948d217ab2b", "committedDate": "2020-08-17T20:40:16Z", "message": "Add LicenseInformation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a445590694047efe301d89a063b05130fc6a19ba", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/a445590694047efe301d89a063b05130fc6a19ba", "committedDate": "2020-08-17T21:23:55Z", "message": "Add a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64b70b7f8187a128e36c6b7db21f836448715cd3", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/64b70b7f8187a128e36c6b7db21f836448715cd3", "committedDate": "2020-08-17T21:23:55Z", "message": "Add migration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ca80162bceeea0b38a067e1e9d6731dfff9ddea", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/7ca80162bceeea0b38a067e1e9d6731dfff9ddea", "committedDate": "2020-08-17T20:56:05Z", "message": "Add TODOs"}, "afterCommit": {"oid": "465e9c8db0a44b137c47ae6d7032931935ef2802", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/465e9c8db0a44b137c47ae6d7032931935ef2802", "committedDate": "2020-08-17T21:23:55Z", "message": "Add TODOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5aa0215ae64cdd1482f6b7db663115638f97dee", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/c5aa0215ae64cdd1482f6b7db663115638f97dee", "committedDate": "2020-08-18T15:15:50Z", "message": "Add TODOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b2b911c2913e304bdb6b2e24d1d858db1e7f9ed", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/8b2b911c2913e304bdb6b2e24d1d858db1e7f9ed", "committedDate": "2020-08-18T15:15:50Z", "message": "Move to repository level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a482d8590b253ab7c9fb461913b565d97c2bbf", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/39a482d8590b253ab7c9fb461913b565d97c2bbf", "committedDate": "2020-08-18T15:15:50Z", "message": "Handle no license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac3a69175b505c7f30002c22bb84f2fb955ed42b", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ac3a69175b505c7f30002c22bb84f2fb955ed42b", "committedDate": "2020-08-18T15:15:50Z", "message": "Update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53882a4edee0e4dc674de76240012b1641ab7ce8", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/53882a4edee0e4dc674de76240012b1641ab7ce8", "committedDate": "2020-08-18T15:15:50Z", "message": "Update swagger/openapi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea7436d4a15aa95079b121e5db435691605091db", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ea7436d4a15aa95079b121e5db435691605091db", "committedDate": "2020-08-18T15:46:20Z", "message": "Add workflow integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f2abf2761a677447d1193cdd9871800e13fd79", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/62f2abf2761a677447d1193cdd9871800e13fd79", "committedDate": "2020-08-18T17:58:35Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89b764140e3bff787bc83484247eab9e89ec7b45", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/89b764140e3bff787bc83484247eab9e89ec7b45", "committedDate": "2020-08-18T17:59:50Z", "message": "Generalize the setting of license information, support tools, non-null license information"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2dd3c040387bc882d09ce533061f5efa1bbbfde", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/b2dd3c040387bc882d09ce533061f5efa1bbbfde", "committedDate": "2020-08-18T15:11:21Z", "message": "Update test"}, "afterCommit": {"oid": "89b764140e3bff787bc83484247eab9e89ec7b45", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/89b764140e3bff787bc83484247eab9e89ec7b45", "committedDate": "2020-08-18T17:59:50Z", "message": "Generalize the setting of license information, support tools, non-null license information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad849abb5390d0237aa8331de0f9adb76a2b29d1", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/ad849abb5390d0237aa8331de0f9adb76a2b29d1", "committedDate": "2020-08-18T19:26:53Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b20ea9195f3274e480abbbcf78d36c9f498b78b", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/7b20ea9195f3274e480abbbcf78d36c9f498b78b", "committedDate": "2020-08-19T23:25:05Z", "message": "Don't set license name on register"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjQwMzU3", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-471640357", "createdAt": "2020-08-20T13:56:21Z", "commit": {"oid": "7b20ea9195f3274e480abbbcf78d36c9f498b78b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/9b7e82678f0f22eb25784ad1681d2fe65c831d09", "committedDate": "2020-08-20T15:08:30Z", "message": "Never return null license information"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTM2Mzgz", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-471936383", "createdAt": "2020-08-20T19:49:04Z", "commit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0OTowNVrOHEQ9OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0OTowNVrOHEQ9OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzNDE2OA==", "bodyText": "oops, will change these repo after others review", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r474234168", "createdAt": "2020-08-20T19:49:05Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/helpers/GitHubHelperTest.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package io.dockstore.webservice.helpers;\n+\n+import java.io.IOException;\n+\n+import io.dockstore.webservice.core.LicenseInformation;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.kohsuke.github.AbuseLimitHandler;\n+import org.kohsuke.github.GitHub;\n+import org.kohsuke.github.GitHubBuilder;\n+import org.kohsuke.github.RateLimitHandler;\n+\n+public class GitHubHelperTest {\n+\n+    // TODO: Replace repos with something less likely to change\n+    @Test\n+    public void testGitHubLicense() throws IOException {\n+        GitHub gitHub = new GitHubBuilder().withRateLimitHandler(RateLimitHandler.WAIT).withAbuseLimitHandler(\n+                AbuseLimitHandler.WAIT).build();\n+        LicenseInformation licenseInformation = GitHubHelper.getLicenseInformation(gitHub, \"dockstore/lambda\");\n+        Assert.assertEquals(\"Apache License 2.0\", licenseInformation.getLicenseName());\n+\n+        licenseInformation = GitHubHelper.getLicenseInformation(gitHub, \"dockstore/dockstore\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMDIwMTcz", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-472020173", "createdAt": "2020-08-20T22:10:48Z", "commit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjoxMDo0OFrOHEU_8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjoxMzowM1rOHEVDZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMwMDQwMA==", "bodyText": "commented code likely to be uncommented?", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r474300400", "createdAt": "2020-08-20T22:10:48Z", "author": {"login": "denis-yuen"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralIT.java", "diffHunk": "@@ -1357,7 +1357,13 @@ public void testManualToAuto() {\n         ContainersApi toolsApi = setupWebService();\n         DockstoreTool tool = getQuayContainer(gitUrl);\n         DockstoreTool toolTest = toolsApi.registerManual(tool);\n-        toolsApi.refresh(toolTest.getId());\n+        // Assert.assertEquals(\"Should be able to get license after manual register\", \"Apache License 2.0\", toolTest.getLicenseInformation().getLicenseName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMwMDk0Nw==", "bodyText": "interface methods should have javadoc", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r474300947", "createdAt": "2020-08-20T22:12:12Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -96,7 +96,7 @@ public static boolean matchesREADME(String filename) {\n     }\n \n     public abstract String getName();\n-\n+    public abstract void setLicenseInformation(Entry entry, String gitRepository);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMwMTI4NA==", "bodyText": "add TODO for highlighting\nhttps://www.jetbrains.com/help/idea/using-todo.html\nalternatively can setToolLicenseInformation skip tools without a github token to avoid it being dead code?", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r474301284", "createdAt": "2020-08-20T22:13:03Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/DockerRepoResource.java", "diffHunk": "@@ -596,9 +596,32 @@ public Tool registerManual(@ApiParam(hidden = true) @Parameter(hidden = true, na\n             tool.setGitUrl(convertHttpsToSsh(tool.getGitUrl()));\n         }\n \n+        // Can't set tool license information here, far too many tests register a tool without a GitHub token", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b7e82678f0f22eb25784ad1681d2fe65c831d09"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "385952498f6490d9e298978b3fcc94c13ca078e5", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/385952498f6490d9e298978b3fcc94c13ca078e5", "committedDate": "2020-08-21T03:37:07Z", "message": "Add and update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4488a8481c1577eeb8bd8f118fcbfdb58014ecd", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/e4488a8481c1577eeb8bd8f118fcbfdb58014ecd", "committedDate": "2020-08-21T03:45:07Z", "message": "PR changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0cbc321c8520fa5630265e2770b8d37de89baf3", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/e0cbc321c8520fa5630265e2770b8d37de89baf3", "committedDate": "2020-08-21T16:10:12Z", "message": "Also update license information for GitHub Apps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "262e59ca60dd91e8fc610f38e08d0b55f21262ba", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/262e59ca60dd91e8fc610f38e08d0b55f21262ba", "committedDate": "2020-08-21T16:10:25Z", "message": "Add single test, auto-fix some other tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/8cc08a56b443db935259ee27c762929cedda56ed", "committedDate": "2020-08-21T19:44:52Z", "message": "Add another test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzk2MDYz", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-472796063", "createdAt": "2020-08-21T20:19:29Z", "commit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzA1MDY4", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-473705068", "createdAt": "2020-08-24T17:20:11Z", "commit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDE5NzUy", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-474019752", "createdAt": "2020-08-25T00:48:30Z", "commit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMDo0ODozMFrOHF9gNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMTowNDo1NlrOHF-KYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxMjU5OA==", "bodyText": "You already have an empty LicenseInformation from line 99.", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476012598", "createdAt": "2020-08-25T00:48:30Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubHelper.java", "diffHunk": "@@ -85,6 +89,27 @@ public static String getGitHubAccessToken(String code, String githubClientID, St\n         }\n     }\n \n+    /**\n+     * Get license for a specific GitHub repository\n+     * @param gitHub    The GitHub API\n+     * @param repositoryName    Name of the GitHub repository (e.g. dockstore/lambda)\n+     * @return  The LicenseInformation associated with the repository\n+     */\n+    public static LicenseInformation getLicenseInformation(GitHub gitHub, String repositoryName) {\n+        LicenseInformation licenseInformation = new LicenseInformation();\n+        try {\n+            GHRepository repository = gitHub.getRepository(repositoryName);\n+            GHLicense license = repository.getLicense();\n+            if (license == null) {\n+                return new LicenseInformation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxNDAwNA==", "bodyText": "You could also use the same empty LicenseInformation here.", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476014004", "createdAt": "2020-08-25T00:50:40Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubHelper.java", "diffHunk": "@@ -85,6 +89,27 @@ public static String getGitHubAccessToken(String code, String githubClientID, St\n         }\n     }\n \n+    /**\n+     * Get license for a specific GitHub repository\n+     * @param gitHub    The GitHub API\n+     * @param repositoryName    Name of the GitHub repository (e.g. dockstore/lambda)\n+     * @return  The LicenseInformation associated with the repository\n+     */\n+    public static LicenseInformation getLicenseInformation(GitHub gitHub, String repositoryName) {\n+        LicenseInformation licenseInformation = new LicenseInformation();\n+        try {\n+            GHRepository repository = gitHub.getRepository(repositoryName);\n+            GHLicense license = repository.getLicense();\n+            if (license == null) {\n+                return new LicenseInformation();\n+            }\n+            licenseInformation.setLicenseName(license.getName());\n+            return licenseInformation;\n+        } catch (IOException e) {\n+            return new LicenseInformation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxNDM2Mg==", "bodyText": "Any reason not to log this? Unless it's common, it's a new feature and might be helpful in figuring out what is going wrong.", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476014362", "createdAt": "2020-08-25T00:51:12Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubHelper.java", "diffHunk": "@@ -85,6 +89,27 @@ public static String getGitHubAccessToken(String code, String githubClientID, St\n         }\n     }\n \n+    /**\n+     * Get license for a specific GitHub repository\n+     * @param gitHub    The GitHub API\n+     * @param repositoryName    Name of the GitHub repository (e.g. dockstore/lambda)\n+     * @return  The LicenseInformation associated with the repository\n+     */\n+    public static LicenseInformation getLicenseInformation(GitHub gitHub, String repositoryName) {\n+        LicenseInformation licenseInformation = new LicenseInformation();\n+        try {\n+            GHRepository repository = gitHub.getRepository(repositoryName);\n+            GHLicense license = repository.getLicense();\n+            if (license == null) {\n+                return new LicenseInformation();\n+            }\n+            licenseInformation.setLicenseName(license.getName());\n+            return licenseInformation;\n+        } catch (IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxNzYxNQ==", "bodyText": "Hadn't noticed this before, but it would be nice if the keys were at least constants. But this is already like this in several places, so don't bother", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476017615", "createdAt": "2020-08-25T00:56:13Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/AbstractImageRegistry.java", "diffHunk": "@@ -329,12 +331,25 @@ public Tool refreshTool(final long toolId, final Long userId, final UserDAO user\n         logToolRefresh(dashboardPrefix, tool);\n \n         String repositoryId = sourceCodeRepoInterface.getRepositoryId(updatedTool);\n+        String gitUrl = tool.getGitUrl();\n+        String gitRepository = getGitRepositoryFromGitUrl(gitUrl);\n+        sourceCodeRepoInterface.setLicenseInformation(updatedTool, gitRepository);\n         sourceCodeRepoInterface.setDefaultBranchIfNotSet(updatedTool, repositoryId);\n         updatedTool.syncMetadataWithDefault();\n         // Return the updated tool\n         return updatedTool;\n     }\n \n+    public static String getGitRepositoryFromGitUrl(String gitUrl) {\n+        Map<String, String> repoUrlMap = parseGitUrl(gitUrl);\n+        if (repoUrlMap == null) {\n+            return null;\n+        }\n+        String username = repoUrlMap.get(\"Username\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAxODgwMA==", "bodyText": "You're not getting a quay token", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476018800", "createdAt": "2020-08-25T00:57:56Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/DockerRepoResource.java", "diffHunk": "@@ -596,9 +596,33 @@ public Tool registerManual(@ApiParam(hidden = true) @Parameter(hidden = true, na\n             tool.setGitUrl(convertHttpsToSsh(tool.getGitUrl()));\n         }\n \n+        // Can't set tool license information here, far too many tests register a tool without a GitHub token\n+        setToolLicenseInformation(user, tool);\n+\n         return toolDAO.findById(id);\n     }\n \n+    /**\n+     * Set the license information for a tool\n+     * @param user  The user the tool belongs to\n+     * @param tool  The tool to get license information for\n+     */\n+    private void setToolLicenseInformation(User user, Tool tool) {\n+        // Get user's quay and git tokens", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyMzM5Mw==", "bodyText": "Interesting, hadn't noticed/clicked until now that you're doing this for the entry, not the version. This means it's getting the license for the repo. Is it going off the default branch? Probably fine for now, but I wonder if we eventually need to track at the version level. It's rare that licenses change, although I've seen it, and I don't know if they're retroactive or not -- I guess it depends on how the license content.", "url": "https://github.com/dockstore/dockstore/pull/3751#discussion_r476023393", "createdAt": "2020-08-25T01:04:56Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/helpers/GitHubHelperTest.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package io.dockstore.webservice.helpers;\n+\n+import java.io.IOException;\n+\n+import io.dockstore.webservice.core.LicenseInformation;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.kohsuke.github.AbuseLimitHandler;\n+import org.kohsuke.github.GitHub;\n+import org.kohsuke.github.GitHubBuilder;\n+import org.kohsuke.github.RateLimitHandler;\n+\n+public class GitHubHelperTest {\n+\n+    // TODO: Replace repos with something less likely to change\n+    @Test\n+    public void testGitHubLicense() throws IOException {\n+        GitHub gitHub = new GitHubBuilder().withRateLimitHandler(RateLimitHandler.WAIT).withAbuseLimitHandler(\n+                AbuseLimitHandler.WAIT).build();\n+        LicenseInformation licenseInformation = GitHubHelper.getLicenseInformation(gitHub, \"dockstore-testing/md5sum-checker\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cc08a56b443db935259ee27c762929cedda56ed"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11a1f103d815d6b994948daa9900b076bbc36dc6", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/11a1f103d815d6b994948daa9900b076bbc36dc6", "committedDate": "2020-08-25T01:39:43Z", "message": "PR changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3589763e88c79765703e698326d61618a1420d38", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/3589763e88c79765703e698326d61618a1420d38", "committedDate": "2020-08-25T01:40:20Z", "message": "Merge branch 'develop' into feature/3675/storeLicenseInfo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDQ4OTAw", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-474048900", "createdAt": "2020-08-25T02:24:42Z", "commit": {"oid": "3589763e88c79765703e698326d61618a1420d38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDc5NjUw", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-474479650", "createdAt": "2020-08-25T13:27:48Z", "commit": {"oid": "3589763e88c79765703e698326d61618a1420d38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NjM0MDEy", "url": "https://github.com/dockstore/dockstore/pull/3751#pullrequestreview-474634012", "createdAt": "2020-08-25T16:07:21Z", "commit": {"oid": "3589763e88c79765703e698326d61618a1420d38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2155a4c1c5141e44894156299f319dbfd81fd58", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/c2155a4c1c5141e44894156299f319dbfd81fd58", "committedDate": "2020-08-25T17:36:34Z", "message": "Merge branch 'develop' into feature/3675/storeLicenseInfo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1735, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}