{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNDYxNDU2", "number": 3206, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo1MDo1OVrODcvLcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxODowN1rODeF74g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNDU5Njk5OnYy", "diffSide": "RIGHT", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/ValidationIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo1MDo1OVrOFk8BZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0MTo0NlrOFmbZFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NjQ1Mw==", "bodyText": "Should mention why it's invalid", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374276453", "createdAt": "2020-02-03T18:50:59Z", "author": {"login": "garyluu"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/ValidationIT.java", "diffHunk": "@@ -168,12 +168,12 @@ public void testWdlWorkflow() {\n         workflow = workflowsApi.refresh(workflow.getId());\n         Assert.assertFalse(isWorkflowVersionValid(workflow, \"master\"));\n \n-        // change to valid tool - should be valid\n+        // change to valid tool - should be invalid\n         workflow.setWorkflowPath(\"/validTool.wdl\");\n         workflow = workflowsApi.updateWorkflow(workflow.getId(), workflow);\n         workflowsApi.updateWorkflowPath(workflow.getId(), workflow);\n         workflow = workflowsApi.refresh(workflow.getId());\n-        Assert.assertTrue(\"Should be valid\", isWorkflowVersionValid(workflow, \"master\"));\n+        Assert.assertFalse(\"Should be invalid\", isWorkflowVersionValid(workflow, \"master\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzODk5Ng==", "bodyText": "Reverted the test back to what it was originally because WDL tools with one task call can be registered as a WDL workflow (based on discussion with Denis).", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r375838996", "createdAt": "2020-02-06T13:41:46Z", "author": {"login": "kathy-t"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/ValidationIT.java", "diffHunk": "@@ -168,12 +168,12 @@ public void testWdlWorkflow() {\n         workflow = workflowsApi.refresh(workflow.getId());\n         Assert.assertFalse(isWorkflowVersionValid(workflow, \"master\"));\n \n-        // change to valid tool - should be valid\n+        // change to valid tool - should be invalid\n         workflow.setWorkflowPath(\"/validTool.wdl\");\n         workflow = workflowsApi.updateWorkflow(workflow.getId(), workflow);\n         workflowsApi.updateWorkflowPath(workflow.getId(), workflow);\n         workflow = workflowsApi.refresh(workflow.getId());\n-        Assert.assertTrue(\"Should be valid\", isWorkflowVersionValid(workflow, \"master\"));\n+        Assert.assertFalse(\"Should be invalid\", isWorkflowVersionValid(workflow, \"master\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NjQ1Mw=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNDYxODUxOnYy", "diffSide": "RIGHT", "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo1Nzo1MlrOFk8Orw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODo1Nzo1MlrOFk8Orw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3OTg1NQ==", "bodyText": "I would find it easier to read if (numberOfTaskCalls != 1) {", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374279855", "createdAt": "2020-02-03T18:57:52Z", "author": {"login": "coverbeck"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -71,11 +92,16 @@ class WdlBridge {\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateTool(filePath: String, sourceFilePath: String) = {\n-    validateWorkflow(filePath, sourceFilePath)\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n     val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (executableCallable.taskCallNodes.seq.size > 1) {\n-      throw new WdlParser.SyntaxError(\"A WDL tool can only have one task.\")\n+    if (numberOfTaskCalls > 1 || numberOfTaskCalls == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNDYzNjI2OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxOTowMzo1M1rOFk8Z4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0NDoxMFrOFmbeFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI4MjcyMg==", "bodyText": "Suggest mentioning the exact class(es) rather than the the possible choices.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374282722", "createdAt": "2020-02-03T19:03:53Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -736,7 +736,10 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n                 validationMessage = \"Primary descriptor is empty.\";\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage = \"A CWL workflow requires class: Workflow.\";\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    validationMessage += \" This file contains class: CommandLineTool or ExpressionTool. Did you mean to register a tool?\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg0MDI3OQ==", "bodyText": "Fixed so the message shows the exact class.\nCommandLineTool:\n\nExpressionTool:", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r375840279", "createdAt": "2020-02-06T13:44:10Z", "author": {"login": "kathy-t"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -736,7 +736,10 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n                 validationMessage = \"Primary descriptor is empty.\";\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage = \"A CWL workflow requires class: Workflow.\";\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    validationMessage += \" This file contains class: CommandLineTool or ExpressionTool. Did you mean to register a tool?\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI4MjcyMg=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzU1MTA2OnYy", "diffSide": "RIGHT", "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNToyNTozMFrOFlYO7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzozOTo1MVrOFmbUxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODY2OA==", "bodyText": "This is probably the fault of our definition, but while a WDL tool should be enforced to only have one task.\nI don't know if we want to enforce that a WDL workflow should have more than one task.\nI realize that this means that one-task workflows will basically count as \"both\", but I think that will be better because it won't confuse users who want to register and launch-with one-step workflows.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374738668", "createdAt": "2020-02-04T15:25:30Z", "author": {"login": "denis-yuen"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -52,16 +52,37 @@ class WdlBridge {\n     secondaryWdlFiles = secondaryFiles\n   }\n \n+  /**\n+   *\n+   * Validates that the workflow or tool given by filePath has a workflow declaration\n+   * @param filePath absolute path to file\n+   */\n+  @throws(classOf[WdlParser.SyntaxError])\n+  def validateWorkflowDeclaration(filePath: String, sourceFilePath: String) = {\n+    val bundle = getBundle(filePath, sourceFilePath)\n+\n+    if (!bundle.primaryCallable.isDefined) {\n+      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    }\n+  }\n+\n   /**\n     * Validates the workflow given by filePath\n     * @param filePath absolute path to file\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateWorkflow(filePath: String, sourceFilePath: String) = {\n-    val bundle = getBundle(filePath, sourceFilePath)\n+    val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (!bundle.primaryCallable.isDefined) {\n-      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n+\n+    if (numberOfTaskCalls <= 1) {\n+      val validationMessage = new StringBuilder(\"A WDL workflow must call more than one task.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc0MDUzNw==", "bodyText": "Note that we can/should enforce this for CWL because of the much clearer definition", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374740537", "createdAt": "2020-02-04T15:28:07Z", "author": {"login": "denis-yuen"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -52,16 +52,37 @@ class WdlBridge {\n     secondaryWdlFiles = secondaryFiles\n   }\n \n+  /**\n+   *\n+   * Validates that the workflow or tool given by filePath has a workflow declaration\n+   * @param filePath absolute path to file\n+   */\n+  @throws(classOf[WdlParser.SyntaxError])\n+  def validateWorkflowDeclaration(filePath: String, sourceFilePath: String) = {\n+    val bundle = getBundle(filePath, sourceFilePath)\n+\n+    if (!bundle.primaryCallable.isDefined) {\n+      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    }\n+  }\n+\n   /**\n     * Validates the workflow given by filePath\n     * @param filePath absolute path to file\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateWorkflow(filePath: String, sourceFilePath: String) = {\n-    val bundle = getBundle(filePath, sourceFilePath)\n+    val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (!bundle.primaryCallable.isDefined) {\n-      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n+\n+    if (numberOfTaskCalls <= 1) {\n+      val validationMessage = new StringBuilder(\"A WDL workflow must call more than one task.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODY2OA=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3MTU5MQ==", "bodyText": "Should I remove the error message for WDL workflows then?\nAdditionally, how should WDL workflows and tools with zero tasks be handled? For example, if we enforce that a WDL tool should only have one task, would a WDL tool with zero tasks throw an error?", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374771591", "createdAt": "2020-02-04T16:16:08Z", "author": {"login": "kathy-t"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -52,16 +52,37 @@ class WdlBridge {\n     secondaryWdlFiles = secondaryFiles\n   }\n \n+  /**\n+   *\n+   * Validates that the workflow or tool given by filePath has a workflow declaration\n+   * @param filePath absolute path to file\n+   */\n+  @throws(classOf[WdlParser.SyntaxError])\n+  def validateWorkflowDeclaration(filePath: String, sourceFilePath: String) = {\n+    val bundle = getBundle(filePath, sourceFilePath)\n+\n+    if (!bundle.primaryCallable.isDefined) {\n+      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    }\n+  }\n+\n   /**\n     * Validates the workflow given by filePath\n     * @param filePath absolute path to file\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateWorkflow(filePath: String, sourceFilePath: String) = {\n-    val bundle = getBundle(filePath, sourceFilePath)\n+    val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (!bundle.primaryCallable.isDefined) {\n-      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n+\n+    if (numberOfTaskCalls <= 1) {\n+      val validationMessage = new StringBuilder(\"A WDL workflow must call more than one task.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODY2OA=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc4Mzc2OA==", "bodyText": "Yeah, I think WDL workflows should be fine with 1 or many tasks.\nI would have thought that a WDL workflow or tool with zero tasks would be an error either way. But it might be worth looking at a few examples to double check. Or writing a few and having https://cromwell.readthedocs.io/en/develop/WOMtool/ validate them", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r374783768", "createdAt": "2020-02-04T16:35:08Z", "author": {"login": "denis-yuen"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -52,16 +52,37 @@ class WdlBridge {\n     secondaryWdlFiles = secondaryFiles\n   }\n \n+  /**\n+   *\n+   * Validates that the workflow or tool given by filePath has a workflow declaration\n+   * @param filePath absolute path to file\n+   */\n+  @throws(classOf[WdlParser.SyntaxError])\n+  def validateWorkflowDeclaration(filePath: String, sourceFilePath: String) = {\n+    val bundle = getBundle(filePath, sourceFilePath)\n+\n+    if (!bundle.primaryCallable.isDefined) {\n+      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    }\n+  }\n+\n   /**\n     * Validates the workflow given by filePath\n     * @param filePath absolute path to file\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateWorkflow(filePath: String, sourceFilePath: String) = {\n-    val bundle = getBundle(filePath, sourceFilePath)\n+    val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (!bundle.primaryCallable.isDefined) {\n-      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n+\n+    if (numberOfTaskCalls <= 1) {\n+      val validationMessage = new StringBuilder(\"A WDL workflow must call more than one task.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODY2OA=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzNzg5Mw==", "bodyText": "I reverted the WDL workflow validation back to what it was originally so WDL tools with 1 task call can be registered as a workflow.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r375837893", "createdAt": "2020-02-06T13:39:51Z", "author": {"login": "kathy-t"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -52,16 +52,37 @@ class WdlBridge {\n     secondaryWdlFiles = secondaryFiles\n   }\n \n+  /**\n+   *\n+   * Validates that the workflow or tool given by filePath has a workflow declaration\n+   * @param filePath absolute path to file\n+   */\n+  @throws(classOf[WdlParser.SyntaxError])\n+  def validateWorkflowDeclaration(filePath: String, sourceFilePath: String) = {\n+    val bundle = getBundle(filePath, sourceFilePath)\n+\n+    if (!bundle.primaryCallable.isDefined) {\n+      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    }\n+  }\n+\n   /**\n     * Validates the workflow given by filePath\n     * @param filePath absolute path to file\n     */\n   @throws(classOf[WdlParser.SyntaxError])\n   def validateWorkflow(filePath: String, sourceFilePath: String) = {\n-    val bundle = getBundle(filePath, sourceFilePath)\n+    val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (!bundle.primaryCallable.isDefined) {\n-      throw new WdlParser.SyntaxError(\"Workflow is missing a workflow declaration.\")\n+    validateWorkflowDeclaration(filePath, sourceFilePath)\n+\n+    if (numberOfTaskCalls <= 1) {\n+      val validationMessage = new StringBuilder(\"A WDL workflow must call more than one task.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczODY2OA=="}, "originalCommit": {"oid": "62eae48668c86059011b4d9ec5844274e9d74ad9"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjA0MDAxOnYy", "diffSide": "RIGHT", "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMDo1ODoyNVrOFmp_kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMDo1ODoyNVrOFmp_kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3ODIyNA==", "bodyText": "I think you can remove the numberOfTaskCalls != 0.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376078224", "createdAt": "2020-02-06T20:58:25Z", "author": {"login": "agduncan94"}, "path": "dockstore-common/src/main/scala/io/dockstore/common/WdlBridge.scala", "diffHunk": "@@ -73,9 +73,11 @@ class WdlBridge {\n   def validateTool(filePath: String, sourceFilePath: String) = {\n     validateWorkflow(filePath, sourceFilePath)\n     val executableCallable = convertFilePathToExecutableCallable(filePath, sourceFilePath)\n+    val numberOfTaskCalls = executableCallable.taskCallNodes.seq.size\n \n-    if (executableCallable.taskCallNodes.seq.size > 1) {\n-      throw new WdlParser.SyntaxError(\"A WDL tool can only have one task.\")\n+    // WDL tool with zero task calls are valid\n+    if (numberOfTaskCalls != 0 && numberOfTaskCalls > 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61bead7e2bd73dd4788c8b8140934b8b84d7345f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjA1OTk1OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMTowNTozM1rOFmqMBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMToyMjowMVrOFmqpBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA4MTQxNA==", "bodyText": "Might be just me, but I think it'd look cleaner with String.format", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376081414", "createdAt": "2020-02-06T21:05:33Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -736,7 +736,12 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n                 validationMessage = \"Primary descriptor is empty.\";\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage = \"A CWL workflow requires class: Workflow.\";\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    validationMessage += \" This file contains class: \";\n+                    validationMessage += (content.contains(\"class: CommandLineTool\")) ? \"CommandLineTool.\" : \"ExpressionTool.\";\n+                    validationMessage += \" Did you mean to register a tool?\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61bead7e2bd73dd4788c8b8140934b8b84d7345f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA4ODgzOQ==", "bodyText": "Another consideration is efficiency, this repeated concatenation is pretty inefficient.\nConsider a StringBuilder https://stackoverflow.com/questions/4645020/when-to-use-stringbuilder-in-java", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376088839", "createdAt": "2020-02-06T21:22:01Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -736,7 +736,12 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n                 validationMessage = \"Primary descriptor is empty.\";\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage = \"A CWL workflow requires class: Workflow.\";\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    validationMessage += \" This file contains class: \";\n+                    validationMessage += (content.contains(\"class: CommandLineTool\")) ? \"CommandLineTool.\" : \"ExpressionTool.\";\n+                    validationMessage += \" Did you mean to register a tool?\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA4MTQxNA=="}, "originalCommit": {"oid": "61bead7e2bd73dd4788c8b8140934b8b84d7345f"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjA3MDU2OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMTowOToxMVrOFmqSbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMTowOToxMVrOFmqSbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA4MzA1NQ==", "bodyText": "Perhaps single quotes around actual code", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376083055", "createdAt": "2020-02-06T21:09:11Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -768,7 +773,10 @@ public VersionTypeValidation validateToolSet(Set<SourceFile> sourcefiles, String\n                 validationMessage = \"Primary CWL descriptor is empty.\";\n             } else if (!content.contains(\"class: CommandLineTool\") && !content.contains(\"class: ExpressionTool\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: CommandLineTool or ExpressionTool.\";\n+                validationMessage = \"A CWL tool requires class: CommandLineTool or ExpressionTool.\";\n+                if (content.contains(\"class: Workflow\")) {\n+                    validationMessage += \" This file contains class: Workflow. Did you mean to register a workflow?\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61bead7e2bd73dd4788c8b8140934b8b84d7345f"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODM2NTU1OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTowNDo1OVrOFm_8Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNTo1MTowMVrOFnBjMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQzNzg1MA==", "bodyText": "I prefer: validationMessage.append(String.format(\" This file contains 'class: %s'. Did you mean to register a tool?\", cwlClass));", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376437850", "createdAt": "2020-02-07T15:04:59Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    String cwlClass = content.contains(\"class: CommandLineTool\") ? \"CommandLineTool\" : \"ExpressionTool\";\n+                    validationMessage.append(\" This file contains 'class: \").append(cwlClass).append(\"'. Did you mean to register a tool?\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ2Mjc0OQ==", "bodyText": "String.format is less efficient than StringBuilder so I just stuck with using StringBuilder's append since using String.format would defeat the purpose of using StringBuilder for efficiency.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376462749", "createdAt": "2020-02-07T15:48:25Z", "author": {"login": "kathy-t"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    String cwlClass = content.contains(\"class: CommandLineTool\") ? \"CommandLineTool\" : \"ExpressionTool\";\n+                    validationMessage.append(\" This file contains 'class: \").append(cwlClass).append(\"'. Did you mean to register a tool?\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQzNzg1MA=="}, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQ2NDE3OQ==", "bodyText": "It's for readability: https://stackoverflow.com/a/44127617", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376464179", "createdAt": "2020-02-07T15:51:01Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    String cwlClass = content.contains(\"class: CommandLineTool\") ? \"CommandLineTool\" : \"ExpressionTool\";\n+                    validationMessage.append(\" This file contains 'class: \").append(cwlClass).append(\"'. Did you mean to register a tool?\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQzNzg1MA=="}, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODc5MjgyOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxMToxMlrOFnEF7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxMToxMlrOFnEF7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwNTgzOQ==", "bodyText": "This is nit-picky and you don't need to change the PR for it, but FYI string searches can be relatively expensive so you should generally try to avoid searching for the same substring more than once. Imagine if content was 100K or bigger -- worst case it will go through the whole string two times if there's not a match for CommandLineTool, plus twice more for however far into the string the match for ExpressionTool is. Unless the compiler/runtime does some fancy optimization, but I wouldn't rely on it.\nOTOH, descriptors aren't typically that big, it will still be fast, and this code is not frequently executed.", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376505839", "createdAt": "2020-02-07T17:11:12Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");\n+                if (content.contains(\"class: CommandLineTool\") || content.contains(\"class: ExpressionTool\")) {\n+                    String cwlClass = content.contains(\"class: CommandLineTool\") ? \"CommandLineTool\" : \"ExpressionTool\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODgxMTIyOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxODowN1rOFnER5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozMzo0MVrOFnGS-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwODkwMQ==", "bodyText": "I would personally use double quotes, but I can go either way: \"...\\\"class: Workflow\\\".\"", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376508901", "createdAt": "2020-02-07T17:18:07Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzODQxOQ==", "bodyText": "This is what it would look like with double quotes:\n\nIt also looks like single quotes are used for some error messages, such as the one for /Dockstore.wdl when the file has no content. Do you think it would be better to just keep it as single quotes for uniformity?\nWhat it looks like with single quotes:", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376538419", "createdAt": "2020-02-07T18:26:09Z", "author": {"login": "kathy-t"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwODkwMQ=="}, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MTk0Nw==", "bodyText": "Ah, sorry, I did not look at other messages for comparison before I wrote my comment... If we're already using single quotes elsewhere, especially in the same message, we should be consistent and continue to use single quotes.\nI was commenting from more of a grammar perspective, although I don't actually know what the official rule is on that -- it just felt right to use double quotes. :)", "url": "https://github.com/dockstore/dockstore/pull/3206#discussion_r376541947", "createdAt": "2020-02-07T18:33:41Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/languages/CWLHandler.java", "diffHunk": "@@ -725,28 +725,32 @@ public VersionTypeValidation validateWorkflowSet(Set<SourceFile> sourcefiles, St\n         Optional<SourceFile> mainDescriptor = filteredSourcefiles.stream().filter((sourceFile -> Objects.equals(sourceFile.getPath(), primaryDescriptorFilePath))).findFirst();\n \n         boolean isValid = true;\n-        String validationMessage = null;\n+        StringBuilder validationMessage = new StringBuilder();\n         Map<String, String> validationMessageObject = new HashMap<>();\n \n         if (mainDescriptor.isPresent()) {\n             Yaml yaml = new Yaml();\n             String content = mainDescriptor.get().getContent();\n             if (content == null || content.isEmpty()) {\n                 isValid = false;\n-                validationMessage = \"Primary descriptor is empty.\";\n+                validationMessage.append(\"Primary descriptor is empty.\");\n             } else if (!content.contains(\"class: Workflow\")) {\n                 isValid = false;\n-                validationMessage = \"Requires class: Workflow.\";\n+                validationMessage.append(\"A CWL workflow requires 'class: Workflow'.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwODkwMQ=="}, "originalCommit": {"oid": "9f75249ae3f185b2484eb7fbd7be8a80e2161a11"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3108, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}