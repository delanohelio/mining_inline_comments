{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDQxODI5", "number": 3818, "title": "db migration script update for docker", "bodyText": "Add docker commands to comment/uncomment out\nAdditional non-timeout command", "createdAt": "2020-09-21T17:10:23Z", "url": "https://github.com/dockstore/dockstore/pull/3818", "merged": true, "mergeCommit": {"oid": "c8dbe6cd40cbc5a28718de333613052e3dfbd982"}, "closed": true, "closedAt": "2020-09-21T20:12:40Z", "author": {"login": "nolwarre"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLGiwqAH2gAyNDkwNDQxODI5OmRiMjFhNTEyNmIxNWI5MGZiNGEyODg2OTRhMGRlYzMyNjM4NGU0YjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLImpFgH2gAyNDkwNDQxODI5OjViNzBkZDY5YThmZWI4NzVmYzk4ZmE1OTVhYWQ5NDUzYWRjMmQxMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "db21a5126b15b90fb4a288694a0dec326384e4b0", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/db21a5126b15b90fb4a288694a0dec326384e4b0", "committedDate": "2020-09-21T17:07:48Z", "message": "add docker support\n\naddition non-timeout command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODIwNTI4", "url": "https://github.com/dockstore/dockstore/pull/3818#pullrequestreview-492820528", "createdAt": "2020-09-21T17:13:05Z", "commit": {"oid": "db21a5126b15b90fb4a288694a0dec326384e4b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzowNlrOHVarVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzowNlrOHVarVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxOTIyMw==", "bodyText": "previous comment is probably sufficient rather than duplicating the command.", "url": "https://github.com/dockstore/dockstore/pull/3818#discussion_r492219223", "createdAt": "2020-09-21T17:13:06Z", "author": {"login": "Ldcabansay"}, "path": "propose_migration.sh", "diffHunk": "@@ -13,18 +13,28 @@ if [ \"${CIRCLECI-false}\" = \"true\" ]; then\n     createdb -U postgres webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n else\n+    ## uncomment/comment this section if database is running locally on postgres\n     sudo -i -u postgres dropdb webservice_test || true\n     sudo -i -u postgres dropdb webservice_test_proposed || true\n     sudo -i -u postgres createdb webservice_test || true\n     sudo -i -u postgres createdb webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n+    ## uncomment/comment this section if running on docker\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test_proposed || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test with owner = dockstore;\" || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test_proposed with owner = dockstore;\" || true\n+#    rm dockstore-webservice/target/detected-migrations.xml || true\n fi\n \n ## load up the old database based on current migration\n rm dockstore-webservice/target/dockstore-webservice-*sources.jar || true\n java -jar dockstore-webservice/target/dockstore-webservice-*.jar db migrate dockstore-integration-testing/src/test/resources/dockstore.yml --include 1.3.0.generated,1.4.0,1.5.0,1.6.0,1.7.0,1.8.0,1.9.0,1.10.0\n+\n ## create the new database based on JPA (ugly, should really create a proper dw command if this works)\n+## remove timeout for mac devices by commenting that line and uncomment the following line, will have to stop manually\n timeout 15 java -Ddw.database.url=jdbc:postgresql://localhost:5432/webservice_test_proposed -Ddw.database.properties.hibernate.hbm2ddl.auto=create -jar dockstore-webservice/target/dockstore-webservice-*.jar server dockstore-integration-testing/src/test/resources/dockstore.yml || true\n+#java -Ddw.database.url=jdbc:postgresql://localhost:5432/webservice_test_proposed -Ddw.database.properties.hibernate.hbm2ddl.auto=create -jar dockstore-webservice/target/dockstore-webservice-*.jar server dockstore-integration-testing/src/test/resources/dockstore.yml || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db21a5126b15b90fb4a288694a0dec326384e4b0"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/6bd61f941967cdb45a2cf1d30bc6e072d478cb54", "committedDate": "2020-09-21T17:30:04Z", "message": "Remove duplicate line\n\nClarify comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODM4NDMy", "url": "https://github.com/dockstore/dockstore/pull/3818#pullrequestreview-492838432", "createdAt": "2020-09-21T17:36:53Z", "commit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzozNjo1M1rOHVbjTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzozNjo1M1rOHVbjTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIzMzU0OA==", "bodyText": "Or install and use gtimeout. But probably not worth getting into here.", "url": "https://github.com/dockstore/dockstore/pull/3818#discussion_r492233548", "createdAt": "2020-09-21T17:36:53Z", "author": {"login": "coverbeck"}, "path": "propose_migration.sh", "diffHunk": "@@ -13,17 +13,26 @@ if [ \"${CIRCLECI-false}\" = \"true\" ]; then\n     createdb -U postgres webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n else\n+    ## uncomment/comment this section if database is running locally on postgres\n     sudo -i -u postgres dropdb webservice_test || true\n     sudo -i -u postgres dropdb webservice_test_proposed || true\n     sudo -i -u postgres createdb webservice_test || true\n     sudo -i -u postgres createdb webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n+    ## uncomment/comment this section if running on docker\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test_proposed || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test with owner = dockstore;\" || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test_proposed with owner = dockstore;\" || true\n+#    rm dockstore-webservice/target/detected-migrations.xml || true\n fi\n \n ## load up the old database based on current migration\n rm dockstore-webservice/target/dockstore-webservice-*sources.jar || true\n java -jar dockstore-webservice/target/dockstore-webservice-*.jar db migrate dockstore-integration-testing/src/test/resources/dockstore.yml --include 1.3.0.generated,1.4.0,1.5.0,1.6.0,1.7.0,1.8.0,1.9.0,1.10.0\n+\n ## create the new database based on JPA (ugly, should really create a proper dw command if this works)\n+## remove timeout for mac devices, will have to break manually", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODYzODA4", "url": "https://github.com/dockstore/dockstore/pull/3818#pullrequestreview-492863808", "createdAt": "2020-09-21T18:12:06Z", "commit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODc2OTg1", "url": "https://github.com/dockstore/dockstore/pull/3818#pullrequestreview-492876985", "createdAt": "2020-09-21T18:31:26Z", "commit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODg1NTIz", "url": "https://github.com/dockstore/dockstore/pull/3818#pullrequestreview-492885523", "createdAt": "2020-09-21T18:43:34Z", "commit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b70dd69a8feb875fc98fa595aad9453adc2d131", "author": {"user": {"login": "nolwarre", "name": "Noah Warren"}}, "url": "https://github.com/dockstore/dockstore/commit/5b70dd69a8feb875fc98fa595aad9453adc2d131", "committedDate": "2020-09-21T19:31:51Z", "message": "Merge branch 'develop' into feature/SEAB-1726/db-migration-docker"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1775, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}