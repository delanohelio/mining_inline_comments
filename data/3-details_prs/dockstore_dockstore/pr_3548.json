{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNjEzMjAw", "number": 3548, "title": "added timeout to executeCommand utilities", "bodyText": "", "createdAt": "2020-06-10T17:57:26Z", "url": "https://github.com/dockstore/dockstore/pull/3548", "merged": true, "mergeCommit": {"oid": "fb13a5161f9565b53ef390cf56ee1e3c0f7e3f46"}, "closed": true, "closedAt": "2020-06-24T17:03:01Z", "author": {"login": "emlys"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpYQ6HAH2gAyNDMyNjEzMjAwOmRlMzY0MGM5ZDkxMWQwZTg1NDRhYTdlMWQwZDU1NWMxMzE0Y2E1NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuGLBWAFqTQzNTgzMDI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548", "author": {"user": {"login": "emlys", "name": "Emily Soth"}}, "url": "https://github.com/dockstore/dockstore/commit/de3640c9d911d0e8544aa7e1d0d555c1314ca548", "committedDate": "2020-06-08T22:33:10Z", "message": "added timeout to executeCommand utilities"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzEzNjc2", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-428313676", "createdAt": "2020-06-10T18:16:35Z", "commit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxNjozNVrOGiA9Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxODowNVrOGiBAmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDQ3NQ==", "bodyText": "You should keep this method signature and create an additional one with the next line. This module is used outside of the webservice, by the CLI, and having a signature go away will break the CLI. We could update the CLI when it starts using the latest version, but it would be easier not to.", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438320475", "createdAt": "2020-06-10T18:16:35Z", "author": {"login": "coverbeck"}, "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -85,7 +86,7 @@ public static INIConfiguration parseConfig(String configFile) {\n         return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), null);\n     }\n \n-    public static ImmutablePair<String, String> executeCommand(String command, File workingDir) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDcxOA==", "bodyText": "What's the longest time you ever saw in the logs?\nSuggest adding the unit to the variable name, e.g. TIMEOUT_MS or TIMEOUT_IN_MILLISECONDS or TIMEOUT_MILLISECONDS.", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438320718", "createdAt": "2020-06-10T18:17:02Z", "author": {"login": "coverbeck"}, "path": "dockstore-common/src/main/java/io/dockstore/common/NextflowUtilities.java", "diffHunk": "@@ -42,6 +42,7 @@\n public final class NextflowUtilities {\n     private static final Logger LOG = LoggerFactory.getLogger(NextflowUtilities.class);\n     private static final String DEFAULT_NEXTFLOW_VERSION = \"19.01.0\";\n+    private static final long TIMEOUT = 15000;  // based on webservice logs, usually <6 seconds is needed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMTMwNw==", "bodyText": "I'm worried this is too low, but I don't know all the cases where we call it. How about a minute?", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438321307", "createdAt": "2020-06-10T18:18:05Z", "author": {"login": "coverbeck"}, "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private static final Map<String, ConfigurationBuilder<INIConfiguration>> MAP = new HashMap<>();\n \n     private static final Logger LOG = LoggerFactory.getLogger(Utilities.class);\n+    private static final long DEFAULT_TIMEOUT = 20000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19053941ff34611208a69b95feb9bfa0700a7e5", "author": {"user": {"login": "emlys", "name": "Emily Soth"}}, "url": "https://github.com/dockstore/dockstore/commit/a19053941ff34611208a69b95feb9bfa0700a7e5", "committedDate": "2020-06-10T19:12:22Z", "message": "raise time limits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7", "author": {"user": {"login": "emlys", "name": "Emily Soth"}}, "url": "https://github.com/dockstore/dockstore/commit/e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7", "committedDate": "2020-06-10T20:20:07Z", "message": "renamed timeout variables, added new executeCommand signature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDA3MDk1", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-428407095", "createdAt": "2020-06-10T20:34:06Z", "commit": {"oid": "e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDozNDowNlrOGiFVsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDozNDowNlrOGiFVsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5MjI0MQ==", "bodyText": "This should call the next method with the DEFAULT_TIMEOUT_MILLISECONDS as the extra param\nLine 85/86 should call this method with the null as the extra parameter.\n\nI know the second one as like that, but we should only have command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()) once in the file, and we now have it 3 times.", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438392241", "createdAt": "2020-06-10T20:34:06Z", "author": {"login": "coverbeck"}, "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -89,6 +90,10 @@ public static INIConfiguration parseConfig(String configFile) {\n         return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), workingDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37", "author": {"user": {"login": "emlys", "name": "Emily Soth"}}, "url": "https://github.com/dockstore/dockstore/commit/31ae107682bfc2ba898ae7aaa3ac681b17545c37", "committedDate": "2020-06-10T20:58:16Z", "message": "removed duplicated funciton calls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTYyOTMx", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-428962931", "createdAt": "2020-06-11T14:22:22Z", "commit": {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoyMjoyMlrOGifsMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoyMjoyMlrOGifsMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyMzk4Ng==", "bodyText": "Hmmm, not sure.\nBut I think this means the default for all commands is now 15 seconds rather than just nextflow parsing in the webservice. For example workflow launches via cromwell or cwltool\nPlease confirm (you would need to build the CLI using this branch version of dockstore-common)", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438823986", "createdAt": "2020-06-11T14:22:22Z", "author": {"login": "denis-yuen"}, "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -82,13 +83,16 @@ public static INIConfiguration parseConfig(String configFile) {\n     }\n \n     public static ImmutablePair<String, String> executeCommand(String command) {\n-        return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), null);\n+        return executeCommand(command, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjY0MDg2", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-432664086", "createdAt": "2020-06-17T18:26:41Z", "commit": {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjkwODk0", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-432690894", "createdAt": "2020-06-17T19:01:06Z", "commit": {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowMTowNlrOGlTbdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowMTowNlrOGlTbdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2ODgyMw==", "bodyText": "Elaborating on the comment above, this will change it so that anything that calls executeCommand(String command, File workingDir) or executeCommand(String command) will have a timeout now. They may not have expected it in the past.\nFor example, https://github.com/dockstore/dockstore-cli/blob/develop/dockstore-client/src/main/java/io/dockstore/client/cli/nested/BaseLauncher.java#L112-L114 might mean that running workflows would also be under a time limit now which doesn't make sense.\nI think we basically need a \"opt-in\" timeout rather than a default.\nSorry for not elaborating before", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r441768823", "createdAt": "2020-06-17T19:01:06Z", "author": {"login": "denis-yuen"}, "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -85,7 +86,7 @@ public static INIConfiguration parseConfig(String configFile) {\n         return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), null);\n     }\n \n-    public static ImmutablePair<String, String> executeCommand(String command, File workingDir) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDQ3NQ=="}, "originalCommit": {"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36cf61b41aaa232cc6a4c363d0920b2bee94cb6f", "author": {"user": {"login": "emlys", "name": "Emily Soth"}}, "url": "https://github.com/dockstore/dockstore/commit/36cf61b41aaa232cc6a4c363d0920b2bee94cb6f", "committedDate": "2020-06-17T20:54:23Z", "message": "made timeout optional with default 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzY1MzQ5", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-433365349", "createdAt": "2020-06-18T14:52:10Z", "commit": {"oid": "36cf61b41aaa232cc6a4c363d0920b2bee94cb6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzczMDEy", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-433373012", "createdAt": "2020-06-18T14:59:52Z", "commit": {"oid": "36cf61b41aaa232cc6a4c363d0920b2bee94cb6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1ODMwMjQw", "url": "https://github.com/dockstore/dockstore/pull/3548#pullrequestreview-435830240", "createdAt": "2020-06-23T14:18:04Z", "commit": {"oid": "36cf61b41aaa232cc6a4c363d0920b2bee94cb6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1922, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}