{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MzM3MTI0", "number": 3299, "title": "Feature/1232/migrate existing workflow to d yml", "bodyText": "Can migrate existing STUB and FULL workflows to DOCKSTORE_YML (new version column for keeping track)\nCan no longer refresh DOCKSTORE_YML workflows and services\n\n#3263", "createdAt": "2020-03-05T15:19:32Z", "url": "https://github.com/dockstore/dockstore/pull/3299", "merged": true, "mergeCommit": {"oid": "d55ae7f77376366cbd031156f6a25e722618d46c"}, "closed": true, "closedAt": "2020-03-06T18:25:15Z", "author": {"login": "agduncan94"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKIqrhgH2gAyMzg0MzM3MTI0OmY5ZGNjMzQ3ZTQxYTg2YjdmMTJjZjIyOGEwOGIxZDM2MjE4NjgyYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLCubJAH2gAyMzg0MzM3MTI0OjI2NjY2OGU0MjIxYzViOGFlM2FhNzVjYzU2Y2Y3NjJlNzA1ZWFlNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9dcc347e41a86b7f12cf228a08b1d36218682a7", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/f9dcc347e41a86b7f12cf228a08b1d36218682a7", "committedDate": "2020-03-03T20:51:11Z", "message": "add new column to version table to keep track of if a version is legacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5765bf5943a47fcab836db11916e28ad42e28eac", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/5765bf5943a47fcab836db11916e28ad42e28eac", "committedDate": "2020-03-04T14:15:46Z", "message": "convert workflow path to dockstore.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c75c3ada3934dc260d77f59272a4fad563b297de", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/c75c3ada3934dc260d77f59272a4fad563b297de", "committedDate": "2020-03-04T14:33:23Z", "message": "improve description of new column for open api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a11aea81626695cd4fc1ea08301547393fb560ad", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/a11aea81626695cd4fc1ea08301547393fb560ad", "committedDate": "2020-03-04T15:10:08Z", "message": "fix migration for legacy version column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4594490319e395bf5220131ef8c88ab41dbcb1b2", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/4594490319e395bf5220131ef8c88ab41dbcb1b2", "committedDate": "2020-03-05T13:29:51Z", "message": "tests for legacyversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a70403745768499f4c8f8a7db43901db3b4cd09", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/6a70403745768499f4c8f8a7db43901db3b4cd09", "committedDate": "2020-03-05T13:45:48Z", "message": "no longer allow refresh of dockstore.yml workflows and services"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "963f3f650d87c99fef1d9908606fc028cf19312c", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/963f3f650d87c99fef1d9908606fc028cf19312c", "committedDate": "2020-03-05T14:12:39Z", "message": "added tests for migrations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eac9e6f1602e4c8b7c8807057c043176e0e6227", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/6eac9e6f1602e4c8b7c8807057c043176e0e6227", "committedDate": "2020-03-05T14:25:59Z", "message": "fix failing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzU2MjQ2", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-369756246", "createdAt": "2020-03-05T17:09:52Z", "commit": {"oid": "6eac9e6f1602e4c8b7c8807057c043176e0e6227"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzU3NzYz", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-369757763", "createdAt": "2020-03-05T17:12:02Z", "commit": {"oid": "6eac9e6f1602e4c8b7c8807057c043176e0e6227"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzoxMjowMlrOFycYRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzoxMjowMlrOFycYRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzODA4Ng==", "bodyText": "I don't understand the whole code flow here, but it is confusing that we have a method named getWorkflow, whose JavaDoc says it creates or updates a workflow, and whose error message says it cannot refresh the workflow. :)\nThis may not be easily actionable, but just wanted to note it.", "url": "https://github.com/dockstore/dockstore/pull/3299#discussion_r388438086", "createdAt": "2020-03-05T17:12:02Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -223,15 +225,20 @@ public Workflow getWorkflow(String repositoryId, Optional<Workflow> existingWork\n             workflow.setDescriptorType(DescriptorLanguage.CWL);\n             return workflow;\n         }\n+\n+        if (Objects.equals(existingWorkflow.get().getMode(), WorkflowMode.DOCKSTORE_YML)) {\n+            String msg = \"Cannot refresh .dockstore.yml workflows\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eac9e6f1602e4c8b7c8807057c043176e0e6227"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0813e4c8d62c7b61fc15866d32b841be74ffaef5", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/0813e4c8d62c7b61fc15866d32b841be74ffaef5", "committedDate": "2020-03-05T17:58:50Z", "message": "fix codacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "808f49d469a9f8356e813b62371e0316f7c74e94", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/808f49d469a9f8356e813b62371e0316f7c74e94", "committedDate": "2020-03-05T18:02:09Z", "message": "missed codacy thing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODAwMzEy", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-369800312", "createdAt": "2020-03-05T18:13:22Z", "commit": {"oid": "808f49d469a9f8356e813b62371e0316f7c74e94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoxMzoyMlrOFyeceA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODoxMzoyMlrOFyeceA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MTkyOA==", "bodyText": "Double-check, this seems to set all versions of workflows in mode DOCKSTORE_YML to not be in legacy mode.\nWill this be true while people are migrating from one to another?\nMaybe it doesn't matter if this runs before people have access to workflows via GitHub apps, but then why set anyone to false?", "url": "https://github.com/dockstore/dockstore/pull/3299#discussion_r388471928", "createdAt": "2020-03-05T18:13:22Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/resources/migrations.1.9.0.xml", "diffHunk": "@@ -41,4 +41,14 @@\n             </column>\n         </addColumn>\n     </changeSet>\n+    <changeSet author=\"aduncan (generated)\" id=\"addLegacyVersionColumn\">\n+        <addColumn tableName=\"workflowversion\">\n+            <column name=\"islegacyversion\" type=\"bool\"/>\n+        </addColumn>\n+        <sql dbms=\"postgresql\">\n+            UPDATE workflowversion SET islegacyversion=true;\n+            UPDATE workflowversion SET islegacyversion=false WHERE id IN (SELECT wv.id FROM workflowversion wv JOIN workflow_workflowversion wwv ON wv.id=wwv.workflowversionid WHERE wwv.workflowid IN (SELECT id FROM workflow WHERE mode='DOCKSTORE_YML'));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "808f49d469a9f8356e813b62371e0316f7c74e94"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODQ1ODc2", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-369845876", "createdAt": "2020-03-05T19:20:30Z", "commit": {"oid": "808f49d469a9f8356e813b62371e0316f7c74e94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTMxMzM4", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-369931338", "createdAt": "2020-03-05T21:34:35Z", "commit": {"oid": "808f49d469a9f8356e813b62371e0316f7c74e94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d55bd4f9b0ccd6e814207d2a7cda8aea2cbcc754", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/d55bd4f9b0ccd6e814207d2a7cda8aea2cbcc754", "committedDate": "2020-03-06T13:18:30Z", "message": "Merge branch 'develop' into feature/1232/migrate-existing-workflow-to-d-yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c998b018a6f4380f252278514aa549151535a64", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/3c998b018a6f4380f252278514aa549151535a64", "committedDate": "2020-03-06T15:15:00Z", "message": "fix issue with gitlab api and files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "682a0854820555d575bc35755a3892ca87cfe994", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/682a0854820555d575bc35755a3892ca87cfe994", "committedDate": "2020-03-06T16:11:52Z", "message": "another attempt to fix gitlab"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNDU0ODg4", "url": "https://github.com/dockstore/dockstore/pull/3299#pullrequestreview-370454888", "createdAt": "2020-03-06T16:28:20Z", "commit": {"oid": "682a0854820555d575bc35755a3892ca87cfe994"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNjoyODoyMFrOFy-65g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNjoyODoyMFrOFy-65g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAwNDAwNg==", "bodyText": "form", "url": "https://github.com/dockstore/dockstore/pull/3299#discussion_r389004006", "createdAt": "2020-03-06T16:28:20Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitLabSourceCodeRepo.java", "diffHunk": "@@ -227,9 +227,11 @@ public String getMainBranch(Entry entry, String repositoryId) {\n      */\n     @Override\n     public SourceFile getSourceFile(String path, String id, String branch, DescriptorLanguage.FileType type) {\n+        // Need to remove root slash form path", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "682a0854820555d575bc35755a3892ca87cfe994"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266668e4221c5b8ae3aa75cc56cf762e705eae72", "author": {"user": {"login": "agduncan94", "name": "Andrew Duncan"}}, "url": "https://github.com/dockstore/dockstore/commit/266668e4221c5b8ae3aa75cc56cf762e705eae72", "committedDate": "2020-03-06T16:29:46Z", "message": "fix typo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1810, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}