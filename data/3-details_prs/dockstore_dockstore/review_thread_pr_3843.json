{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NjEwNTYw", "number": 3843, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMDo1MjoyOFrOEpqy8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjowNDo1NVrOEp9dUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTI4MjQxOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMDo1MjoyOFrOHbewng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjozMjowOFrOHb0F_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3NzU2Ng==", "bodyText": "Whatever this pattern is (see next item), should be a static, ideally; regexes are relatively expensive.\nI feel this regex is more complicated than need be -- you're using lookaheads I think, whose syntax I always have to look up. They have their place, but can't you just have the pattern be Pattern.compile(\"dockstore|admin|curator|system|manager\")? And then change line 273 to if (matcher.find()) { ? I may be missing a more complex case though.\nI think you should leave a backdoor for admins and curators. We may want to use some of these for ourselves.", "url": "https://github.com/dockstore/dockstore/pull/3843#discussion_r498577566", "createdAt": "2020-10-02T00:52:28Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "diffHunk": "@@ -264,6 +267,16 @@ public User changeUsername(@ApiParam(hidden = true) @Parameter(hidden = true, na\n         return userDAO.findById(user.getId());\n     }\n \n+    public static void restrictUsername(String username) {\n+        Pattern pattern = Pattern.compile(\"(?i)^(?!.*(dockstore|admin|curator|system|manager)).*$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4df3f2888dcb45f2c9feb141227ae8624232eaa"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkyNzEwMg==", "bodyText": "After some discussion, not addressing third point. Okay for now.", "url": "https://github.com/dockstore/dockstore/pull/3843#discussion_r498927102", "createdAt": "2020-10-02T16:32:08Z", "author": {"login": "NatalieEO"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/UserResource.java", "diffHunk": "@@ -264,6 +267,16 @@ public User changeUsername(@ApiParam(hidden = true) @Parameter(hidden = true, na\n         return userDAO.findById(user.getId());\n     }\n \n+    public static void restrictUsername(String username) {\n+        Pattern pattern = Pattern.compile(\"(?i)^(?!.*(dockstore|admin|curator|system|manager)).*$\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3NzU2Ng=="}, "originalCommit": {"oid": "f4df3f2888dcb45f2c9feb141227ae8624232eaa"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTI5Mjg2OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/resources/UserResourceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMTowMToxMlrOHbe28w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwMTowMToxMlrOHbe28w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU3OTE4Nw==", "bodyText": "\ud83d\udc4d for unit test", "url": "https://github.com/dockstore/dockstore/pull/3843#discussion_r498579187", "createdAt": "2020-10-02T01:01:12Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/resources/UserResourceTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package io.dockstore.webservice.resources;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.dockstore.webservice.CustomWebApplicationException;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class UserResourceTest {\n+\n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4df3f2888dcb45f2c9feb141227ae8624232eaa"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNDM0MDAxOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/resources/UserResourceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjowNDo1NVrOHb8wgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjowNDo1NVrOHb8wgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2OTA1Ng==", "bodyText": "Ideally you would have some valid usernames as well, to make sure your code just doesn't always reject everything. Not that it does, and it's pretty straightforward. Just for future reference.", "url": "https://github.com/dockstore/dockstore/pull/3843#discussion_r499069056", "createdAt": "2020-10-02T22:04:55Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/test/java/io/dockstore/webservice/resources/UserResourceTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package io.dockstore.webservice.resources;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.dockstore.webservice.CustomWebApplicationException;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class UserResourceTest {\n+\n+    @Test\n+    public void usernameRestrictionsTest() {\n+        List<String> invalidUsernames = new ArrayList<>(List.of(\"dockstore\", \"DOCKSTORE\", \"thisIsDoCkStOrE\", \"admin\", \"aaaaadminbbb\", \"curator\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15e7c7e3cbc21354e169d12c2677753fd12f0208"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2868, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}