{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzEwNTk2", "number": 3332, "title": "hook up checksums to trs", "bodyText": "https://ucsc-cgl.atlassian.net/browse/SEAB-905\nHooked up checksums in the various TODOs that were left. I also got rid of DOCKSTORE_IMAGEID. That doesn't seem to be what checksums for images are intended for, but can change back if I'm misunderstanding something\nI think this ticket #3329 is also addressed by changing the toString to getDockerPath. I tried it locally, and could register a tool.\nMissed it in my previous PR.", "createdAt": "2020-03-18T23:13:53Z", "url": "https://github.com/dockstore/dockstore/pull/3332", "merged": true, "mergeCommit": {"oid": "c18c25e563ff06951591e13602aadc9aed34d146"}, "closed": true, "closedAt": "2020-03-23T23:18:37Z", "author": {"login": "NatalieEO"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO_i_yAH2gAyMzkwNzEwNTk2OmQ4YjkxZWU3MTRiNzExMTM4MDk3ZTdmODc1NWM3MDJmY2ZkNDExZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQkbeoAH2gAyMzkwNzEwNTk2OjY1MzAwZjA4MDAwN2U2ZTNiN2Q4MzEzMTdhYzEyNDZkNTQ3Njg0NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d8b91ee714b711138097e7f8755c702fcfd411d8", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/d8b91ee714b711138097e7f8755c702fcfd411d8", "committedDate": "2020-03-18T23:03:16Z", "message": "hook up checksums to trs, getDockerPath for registry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/1cfb107d82e52dde0871830cd928e45555bf6b0a", "committedDate": "2020-03-18T23:11:03Z", "message": "forgot to commit these files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzE4MjAw", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-377718200", "createdAt": "2020-03-19T13:29:39Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzU0NjAy", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-377754602", "createdAt": "2020-03-19T14:09:52Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTIxNDE2", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-377921416", "createdAt": "2020-03-19T17:05:42Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzM0NTc1", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-377334575", "createdAt": "2020-03-19T00:22:40Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoyMjo0MFrOF4bsYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoyMjo0MFrOF4bsYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxODMwNg==", "bodyText": "Isn't the Dockerfile the... Dockerfile? Isn't this supposed to be for the descriptor files? I guess Descriptor is overloaded, but I was thinking of it in terms of source file descriptors.", "url": "https://github.com/dockstore/dockstore/pull/3332#discussion_r394718306", "createdAt": "2020-03-19T00:22:40Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java", "diffHunk": "@@ -515,7 +517,7 @@ private Response getFileByToolVersionID(String registryId, String versionIdParam\n                 if (potentialDockerfile.isPresent()) {\n                     ExtendedFileWrapper dockerfile = new ExtendedFileWrapper();\n                     //TODO: hook up file checksum here\n-                    dockerfile.setChecksum(Lists.newArrayList());\n+                    dockerfile.setChecksum(getFileDescriptorChecksumsForTrs(potentialDockerfile.get()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzEzMTg5", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-379713189", "createdAt": "2020-03-23T18:35:04Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNTowNFrOF6S8rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNzoyNVrOF6TCeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MjE3NQ==", "bodyText": "I think you should rename this method to getSourceFileChecksums or getSourceFileChecksumsForTrs (I prefer the former). I think this caused the confusion on my other comment -- you're calling a method that says get file descriptor checksums, but then pass it a Dockerfile.", "url": "https://github.com/dockstore/dockstore/pull/3332#discussion_r396672175", "createdAt": "2020-03-23T18:35:04Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java", "diffHunk": "@@ -567,6 +569,19 @@ private Response getFileByToolVersionID(String registryId, String versionIdParam\n         return Response.status(status).build();\n     }\n \n+    public static List<Checksum> getFileDescriptorChecksumsForTrs(final SourceFile sourceFile) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MzY1Ng==", "bodyText": "If sourceFile.getChecksums() returns a non-empty value, this method will return an empty ArrayList, which on line 520 you will use to overwrite the existing checksums.", "url": "https://github.com/dockstore/dockstore/pull/3332#discussion_r396673656", "createdAt": "2020-03-23T18:37:25Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java", "diffHunk": "@@ -567,6 +569,19 @@ private Response getFileByToolVersionID(String registryId, String versionIdParam\n         return Response.status(status).build();\n     }\n \n+    public static List<Checksum> getFileDescriptorChecksumsForTrs(final SourceFile sourceFile) {\n+        List<Checksum> trsChecksums = new ArrayList<>();\n+        if (sourceFile.getChecksums() != null && !sourceFile.getChecksums().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Nzk1MDM2", "url": "https://github.com/dockstore/dockstore/pull/3332#pullrequestreview-379795036", "createdAt": "2020-03-23T20:25:54Z", "commit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyNTo1NFrOF6WyAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyNTo1NFrOF6WyAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjczNDk3Ng==", "bodyText": "At this point it's not an issue, but what if we end up storing an MD5 checksum?", "url": "https://github.com/dockstore/dockstore/pull/3332#discussion_r396734976", "createdAt": "2020-03-23T20:25:54Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java", "diffHunk": "@@ -567,6 +569,19 @@ private Response getFileByToolVersionID(String registryId, String versionIdParam\n         return Response.status(status).build();\n     }\n \n+    public static List<Checksum> getFileDescriptorChecksumsForTrs(final SourceFile sourceFile) {\n+        List<Checksum> trsChecksums = new ArrayList<>();\n+        if (sourceFile.getChecksums() != null && !sourceFile.getChecksums().isEmpty()) {\n+            sourceFile.getChecksums().stream().forEach(checksum -> {\n+                Checksum trsChecksum = new Checksum();\n+                trsChecksum.setType(DESCRIPTOR_FILE_SHA_TYPE_FOR_TRS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cfb107d82e52dde0871830cd928e45555bf6b0a"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65300f080007e6e3b7d831317ac1246d54768444", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/65300f080007e6e3b7d831317ac1246d54768444", "committedDate": "2020-03-23T20:35:28Z", "message": "rename function"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1837, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}