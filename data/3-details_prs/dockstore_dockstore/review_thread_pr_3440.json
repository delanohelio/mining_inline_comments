{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNTA0MzM1", "number": 3440, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDozOFrOD4H3zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMDoxNFrOD4IbVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTc1ODIwOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDozOFrOGOxplA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjo0NDozOFrOGOxplA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE0NjcwOA==", "bodyText": "Just my opinion:\nI know it's a hassle to code and I know it's nit-picky, but I think we shouldn't use the (s) in messages -- we know if it's singular or plural.", "url": "https://github.com/dockstore/dockstore/pull/3440#discussion_r418146708", "createdAt": "2020-04-30T16:44:38Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "diffHunk": "@@ -704,20 +708,30 @@ private WorkflowVersion setupWorkflowFilesForGitHubVersion(Triple<String, Date,\n                         testJson.setContent(testJsonContent);\n \n                         // Only add test parameter file if it hasn't already been added\n-                        boolean hasDuplicate = version.getSourceFiles().stream().anyMatch(\n-                            (SourceFile sf) -> sf.getPath().equals(workflow.getDefaultTestParameterFilePath()) && sf.getType() == testJson.getType());\n+                        boolean hasDuplicate = version.getSourceFiles().stream().anyMatch((SourceFile sf) -> sf.getPath().equals(workflow.getDefaultTestParameterFilePath()) && sf.getType() == testJson.getType());\n                         if (!hasDuplicate) {\n                             version.getSourceFiles().add(testJson);\n                         }\n+                    } else {\n+                        missingParamFiles.add(testParameterPath);\n                     }\n                 }\n+\n+                if (missingParamFiles.size() > 0) {\n+                    validationMessage.put(\"/.dockstore.yml\", String.format(\"The following file(s) are missing: %s.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba829f2e399ac318243fb4b4ab0a21274c4b54c9"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTg0OTE2OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMDoxNFrOGOyj_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMDoxNFrOGOyj_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2MTY2Mg==", "bodyText": "Can you make \"/.dockstore.yml\" a constant somewhere?  There was a recent ticket saying how it sometimes was \"/dockstore.yml\" and it seems like now is as good a time as any to just start using a constant for that file path.", "url": "https://github.com/dockstore/dockstore/pull/3440#discussion_r418161662", "createdAt": "2020-04-30T17:10:14Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/GitHubSourceCodeRepo.java", "diffHunk": "@@ -704,20 +708,30 @@ private WorkflowVersion setupWorkflowFilesForGitHubVersion(Triple<String, Date,\n                         testJson.setContent(testJsonContent);\n \n                         // Only add test parameter file if it hasn't already been added\n-                        boolean hasDuplicate = version.getSourceFiles().stream().anyMatch(\n-                            (SourceFile sf) -> sf.getPath().equals(workflow.getDefaultTestParameterFilePath()) && sf.getType() == testJson.getType());\n+                        boolean hasDuplicate = version.getSourceFiles().stream().anyMatch((SourceFile sf) -> sf.getPath().equals(workflow.getDefaultTestParameterFilePath()) && sf.getType() == testJson.getType());\n                         if (!hasDuplicate) {\n                             version.getSourceFiles().add(testJson);\n                         }\n+                    } else {\n+                        missingParamFiles.add(testParameterPath);\n                     }\n                 }\n+\n+                if (missingParamFiles.size() > 0) {\n+                    validationMessage.put(\"/.dockstore.yml\", String.format(\"The following file(s) are missing: %s.\",\n+                            missingParamFiles.stream().map(paramFile -> String.format(\"'%s'\", paramFile)).collect(Collectors.joining(\", \"))));\n+                }\n             }\n         } else {\n             // File not found or null\n             LOG.info(\"Could not find file \" + primaryDescriptorPath + \" in repo \" + repository);\n-            return null;\n+            validationMessage.put(\"/.dockstore.yml\", \"Could not find the primary descriptor file '\" + primaryDescriptorPath + \"'.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba829f2e399ac318243fb4b4ab0a21274c4b54c9"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2931, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}