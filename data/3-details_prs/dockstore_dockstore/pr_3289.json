{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNTI2ODky", "number": 3289, "title": "add registry column to image table", "bodyText": "#3275", "createdAt": "2020-03-02T18:01:29Z", "url": "https://github.com/dockstore/dockstore/pull/3289", "merged": true, "mergeCommit": {"oid": "7b2ab6f86da145aad0187c7f6ca4d264f3d9b32c"}, "closed": true, "closedAt": "2020-03-12T15:42:58Z", "author": {"login": "NatalieEO"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJyFI4AFqTM2NzQxNDE5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMvx0yAFqTM3MzE5NDAwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDE0MTk2", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-367414196", "createdAt": "2020-03-02T18:11:00Z", "commit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoxMTowMFrOFwpxPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozMTowMVrOFwqZtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2MDMxNw==", "bodyText": "Real nit-picky, but maybe Registry the image belongs to? At first glance I read Registry image as noun phrase", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386560317", "createdAt": "2020-03-02T18:11:00Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Image.java", "diffHunk": "@@ -61,6 +61,10 @@\n     @ApiModelProperty(value = \"Docker ID of the image\", position = 4)\n     private String imageID;\n \n+    @Column()\n+    @ApiModelProperty(value = \"Registry image belongs to\", position = 5)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2MTQ1MQ==", "bodyText": "You don't need to create an intermediate Set; you can just add the image directly by calling tag.getImages().add(<image>).", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386561451", "createdAt": "2020-03-02T18:13:22Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/AbstractImageRegistry.java", "diffHunk": "@@ -330,7 +330,7 @@ private void logToolRefresh(final String dashboardPrefix, final Tool tool) {\n                         final String manifestDigest = i.getDigest();\n                         checksums.add(new Checksum(manifestDigest.split(\":\")[0], manifestDigest.split(\":\")[1]));\n                     }\n-                    Set<Image> images = Collections.singleton(new Image(checksums, repo, tag.getName(), r.getImageID()));\n+                    Set<Image> images = Collections.singleton(new Image(checksums, repo, tag.getName(), r.getImageID(), tool.getRegistry()));\n                     tag.getImages().addAll(images);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2MjI0MA==", "bodyText": "Same, you don't need intermediate set", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386562240", "createdAt": "2020-03-02T18:14:54Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/AbstractImageRegistry.java", "diffHunk": "@@ -595,7 +595,7 @@ private void updateImageInformation(Tool tool, Tag newTag, Tag oldTag) {\n                                 List<Checksum> checksums = new ArrayList<>();\n \n                                 checksums.add(new Checksum(manifestDigest.split(\":\")[0], manifestDigest.split(\":\")[1]));\n-                                Set<Image> images = Collections.singleton(new Image(checksums, tool.getNamespace() + '/' + tool.getName(), tag.getName(), null));\n+                                Set<Image> images = Collections.singleton(new Image(checksums, tool.getNamespace() + '/' + tool.getName(), tag.getName(), null, tool.getRegistry()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3MDY3Ng==", "bodyText": "Following up on my previous comments, if this always returns a max of one Image (?), then the method should return an Optional and not a Set.", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386570676", "createdAt": "2020-03-02T18:31:01Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/QuayImageRegistry.java", "diffHunk": "@@ -121,7 +121,7 @@ public QuayImageRegistry(final Token quayToken) {\n             final String imageID = quayTag.getImageId();\n             List<Checksum> checksums = new ArrayList<>();\n             checksums.add(new Checksum(manifestDigest.split(\":\")[0], manifestDigest.split(\":\")[1]));\n-            return Collections.singleton(new Image(checksums, repo, tag.getName(), imageID));\n+            return Collections.singleton(new Image(checksums, repo, tag.getName(), imageID, tool.getRegistry()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDcyNjMy", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-367472632", "createdAt": "2020-03-02T19:38:44Z", "commit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTozODo0NFrOFwspBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTozODo0NFrOFwspBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNzM2NQ==", "bodyText": "Assert getImages() not empty.", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386607365", "createdAt": "2020-03-02T19:38:44Z", "author": {"login": "garyluu"}, "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/WorkflowIT.java", "diffHunk": "@@ -889,6 +890,10 @@ private void testTRSConversion(final List<ToolVersion> versions, final String sn\n                 assertTrue(trsVersion.isIsProduction());\n                 assertEquals(\"There should be\" + numImages + \"image(s) in this workflow\", numImages, trsVersion.getImages().size());\n                 snapshotInList = true;\n+                for (ImageData imageData :trsVersion.getImages()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDc1NTM2", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-367475536", "createdAt": "2020-03-02T19:43:21Z", "commit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTo0MzoyMVrOFwsxoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTo0MzoyMVrOFwsxoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwOTU2OA==", "bodyText": "Should this just use an Enum?\nSee Organization.status for an example.\nThe enum would seem to just be io.dockstore.common.Registry", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r386609568", "createdAt": "2020-03-02T19:43:21Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Image.java", "diffHunk": "@@ -61,6 +61,10 @@\n     @ApiModelProperty(value = \"Docker ID of the image\", position = 4)\n     private String imageID;\n \n+    @Column()\n+    @ApiModelProperty(value = \"Registry image belongs to\", position = 5)\n+    private String imageRegistry;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94cadfd349440fe1b2b6183703e4f5a40e07be6b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MDIzNjA5", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-368023609", "createdAt": "2020-03-03T14:28:48Z", "commit": {"oid": "f9aeb8d2317a8f226e626ca48719411ca2d6b4fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDoyODo0OFrOFxH-4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDoyODo0OFrOFxH-4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA1NTMzMQ==", "bodyText": "Swagger doesn't match openapi", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r387055331", "createdAt": "2020-03-03T14:28:48Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/resources/swagger.yaml", "diffHunk": "@@ -6874,6 +6874,16 @@ definitions:\n         type: \"string\"\n         position: 4\n         description: \"Docker ID of the image\"\n+      imageRegistry:\n+        type: \"string\"\n+        position: 5\n+        description: \"Registry the image belongs to\"\n+        enum:\n+        - \"QUAY_IO\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9aeb8d2317a8f226e626ca48719411ca2d6b4fc"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDI2NDIz", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-371426423", "createdAt": "2020-03-09T18:27:17Z", "commit": {"oid": "f9aeb8d2317a8f226e626ca48719411ca2d6b4fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxODoyNzoxOFrOFz0X2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxODoyNzoxOFrOFz0X2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg3OTc3MQ==", "bodyText": "Comment above seems to be out-of-date now.\nI guess the bigger issue is I don't understand how/if this deals with paging and the identified problem that we may need to page through a large number of tags in order to get images.", "url": "https://github.com/dockstore/dockstore/pull/3289#discussion_r389879771", "createdAt": "2020-03-09T18:27:18Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/QuayImageRegistry.java", "diffHunk": "@@ -112,7 +113,7 @@ public QuayImageRegistry(final Token quayToken) {\n     }\n \n     //TODO: If the repo has a lot of tags, then it needs to be paged through. Can get tag info individually, but then that's more API calls.\n-    private Set<Image> getImagesForTag(final Tool tool, final Tag tag, final QuayTag quayTag) {\n+    private Optional<Image> getImageForTag(final Tool tool, final Tag tag, final QuayTag quayTag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9aeb8d2317a8f226e626ca48719411ca2d6b4fc"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223fe946d2b919ad4dc7eed44d6eccb03acc7499", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/223fe946d2b919ad4dc7eed44d6eccb03acc7499", "committedDate": "2020-03-09T18:39:32Z", "message": "add registry column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d1feab9b80aa99483a8dd4eeba4be51f5b69b06", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/3d1feab9b80aa99483a8dd4eeba4be51f5b69b06", "committedDate": "2020-03-09T18:39:32Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f34c71d6b8ad31846db72ab5f7e3978287dfe8e", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/5f34c71d6b8ad31846db72ab5f7e3978287dfe8e", "committedDate": "2020-03-09T18:39:32Z", "message": "openapi and swagger should match"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e26098bae8b1e182be4dfa18280ea7cad4219710", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/e26098bae8b1e182be4dfa18280ea7cad4219710", "committedDate": "2020-03-09T18:34:03Z", "message": "openapi and swagger should match"}, "afterCommit": {"oid": "5f34c71d6b8ad31846db72ab5f7e3978287dfe8e", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/5f34c71d6b8ad31846db72ab5f7e3978287dfe8e", "committedDate": "2020-03-09T18:39:32Z", "message": "openapi and swagger should match"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDQyMDE1", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-371442015", "createdAt": "2020-03-09T18:50:01Z", "commit": {"oid": "5f34c71d6b8ad31846db72ab5f7e3978287dfe8e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "884ef121d11b724e2539b687458b4ec78c0a976f", "author": {"user": {"login": "NatalieEO", "name": null}}, "url": "https://github.com/dockstore/dockstore/commit/884ef121d11b724e2539b687458b4ec78c0a976f", "committedDate": "2020-03-11T19:33:30Z", "message": "remove toString in Registry enum so openapi matches swagger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTQ2Mzc2", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-373146376", "createdAt": "2020-03-11T21:43:42Z", "commit": {"oid": "884ef121d11b724e2539b687458b4ec78c0a976f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTUxNTQ4", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-373151548", "createdAt": "2020-03-11T21:54:04Z", "commit": {"oid": "884ef121d11b724e2539b687458b4ec78c0a976f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTk0MDAw", "url": "https://github.com/dockstore/dockstore/pull/3289#pullrequestreview-373194000", "createdAt": "2020-03-11T23:33:08Z", "commit": {"oid": "884ef121d11b724e2539b687458b4ec78c0a976f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1804, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}