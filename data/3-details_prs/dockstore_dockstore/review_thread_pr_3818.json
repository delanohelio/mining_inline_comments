{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDQxODI5", "number": 3818, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzowNlrOElwx2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzozNjo1M1rOElxVFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDMxOTYwOnYy", "diffSide": "RIGHT", "path": "propose_migration.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzowNlrOHVarVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzowNlrOHVarVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxOTIyMw==", "bodyText": "previous comment is probably sufficient rather than duplicating the command.", "url": "https://github.com/dockstore/dockstore/pull/3818#discussion_r492219223", "createdAt": "2020-09-21T17:13:06Z", "author": {"login": "Ldcabansay"}, "path": "propose_migration.sh", "diffHunk": "@@ -13,18 +13,28 @@ if [ \"${CIRCLECI-false}\" = \"true\" ]; then\n     createdb -U postgres webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n else\n+    ## uncomment/comment this section if database is running locally on postgres\n     sudo -i -u postgres dropdb webservice_test || true\n     sudo -i -u postgres dropdb webservice_test_proposed || true\n     sudo -i -u postgres createdb webservice_test || true\n     sudo -i -u postgres createdb webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n+    ## uncomment/comment this section if running on docker\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test_proposed || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test with owner = dockstore;\" || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test_proposed with owner = dockstore;\" || true\n+#    rm dockstore-webservice/target/detected-migrations.xml || true\n fi\n \n ## load up the old database based on current migration\n rm dockstore-webservice/target/dockstore-webservice-*sources.jar || true\n java -jar dockstore-webservice/target/dockstore-webservice-*.jar db migrate dockstore-integration-testing/src/test/resources/dockstore.yml --include 1.3.0.generated,1.4.0,1.5.0,1.6.0,1.7.0,1.8.0,1.9.0,1.10.0\n+\n ## create the new database based on JPA (ugly, should really create a proper dw command if this works)\n+## remove timeout for mac devices by commenting that line and uncomment the following line, will have to stop manually\n timeout 15 java -Ddw.database.url=jdbc:postgresql://localhost:5432/webservice_test_proposed -Ddw.database.properties.hibernate.hbm2ddl.auto=create -jar dockstore-webservice/target/dockstore-webservice-*.jar server dockstore-integration-testing/src/test/resources/dockstore.yml || true\n+#java -Ddw.database.url=jdbc:postgresql://localhost:5432/webservice_test_proposed -Ddw.database.properties.hibernate.hbm2ddl.auto=create -jar dockstore-webservice/target/dockstore-webservice-*.jar server dockstore-integration-testing/src/test/resources/dockstore.yml || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db21a5126b15b90fb4a288694a0dec326384e4b0"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDQwOTgxOnYy", "diffSide": "RIGHT", "path": "propose_migration.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzozNjo1M1rOHVbjTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzozNjo1M1rOHVbjTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIzMzU0OA==", "bodyText": "Or install and use gtimeout. But probably not worth getting into here.", "url": "https://github.com/dockstore/dockstore/pull/3818#discussion_r492233548", "createdAt": "2020-09-21T17:36:53Z", "author": {"login": "coverbeck"}, "path": "propose_migration.sh", "diffHunk": "@@ -13,17 +13,26 @@ if [ \"${CIRCLECI-false}\" = \"true\" ]; then\n     createdb -U postgres webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n else\n+    ## uncomment/comment this section if database is running locally on postgres\n     sudo -i -u postgres dropdb webservice_test || true\n     sudo -i -u postgres dropdb webservice_test_proposed || true\n     sudo -i -u postgres createdb webservice_test || true\n     sudo -i -u postgres createdb webservice_test_proposed || true\n     rm dockstore-webservice/target/detected-migrations.xml || true\n+    ## uncomment/comment this section if running on docker\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 dropdb webservice_test_proposed || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test with owner = dockstore;\" || true\n+#    docker exec -it -u postgres -e PGPASSWORD=dockstore postgres1 psql -c \"create database webservice_test_proposed with owner = dockstore;\" || true\n+#    rm dockstore-webservice/target/detected-migrations.xml || true\n fi\n \n ## load up the old database based on current migration\n rm dockstore-webservice/target/dockstore-webservice-*sources.jar || true\n java -jar dockstore-webservice/target/dockstore-webservice-*.jar db migrate dockstore-integration-testing/src/test/resources/dockstore.yml --include 1.3.0.generated,1.4.0,1.5.0,1.6.0,1.7.0,1.8.0,1.9.0,1.10.0\n+\n ## create the new database based on JPA (ugly, should really create a proper dw command if this works)\n+## remove timeout for mac devices, will have to break manually", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd61f941967cdb45a2cf1d30bc6e072d478cb54"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2851, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}