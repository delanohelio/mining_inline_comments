{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODk1NzI5", "number": 3374, "title": "Feature/3345/default version", "bodyText": "For #3345\nAlso for: #3340\nGot rid of the old default version column and added a new column that's has the version id instead.\nSome default versions settings were lost when using prod db (but they don't exist anyways).\nTry to better set the default version during refresh.\nCould not seem to automatically set default version to null when default version was deleted.  Have to manually set it to null before deleting.", "createdAt": "2020-04-03T02:06:44Z", "url": "https://github.com/dockstore/dockstore/pull/3374", "merged": true, "mergeCommit": {"oid": "21119ed8b05571b8ff4d4aecfd35ea801ebf220b"}, "closed": true, "closedAt": "2020-04-12T15:31:58Z", "author": {"login": "garyluu"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUB_yqgBqjMxOTY3MTg2Mjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWUGnygFqTM5MTU0NzA3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c93f929bef1cd0b72ec06cccb7b1edfd0cc9595", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/5c93f929bef1cd0b72ec06cccb7b1edfd0cc9595", "committedDate": "2020-04-03T02:07:08Z", "message": "Merge branch 'develop' into feature/3345/defaultVersion"}, "afterCommit": {"oid": "af105295225aeab031bc6c8063e571fc4a579c4d", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/af105295225aeab031bc6c8063e571fc4a579c4d", "committedDate": "2020-04-03T14:44:01Z", "message": "Add tests, fix behaviour"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bc8a071eb559aa891baeaa8bcde06882070e708", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/3bc8a071eb559aa891baeaa8bcde06882070e708", "committedDate": "2020-04-03T14:44:32Z", "message": "Remove old function"}, "afterCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/9019d398dec60e77bd5b7fac2e85f7f971cc6327", "committedDate": "2020-04-03T16:13:15Z", "message": "Remove old function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTQ4NDg2", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-387548486", "createdAt": "2020-04-03T20:08:22Z", "commit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDowODoyMlrOGAnIaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDozMjo1NFrOGAoQUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI5NDMxMw==", "bodyText": "Thinking it might be better to just choose the newest version available and setting that to the default version (in the case that there is at least one left).", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403294313", "createdAt": "2020-04-03T20:08:22Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,10 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            entry.setActualDefaultVersion(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg==", "bodyText": "This is changing from the default always being the most recent to being \"sticky\".\nThoughts?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403300806", "createdAt": "2020-04-03T20:17:20Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxMjcyMQ==", "bodyText": "Not sure this is the right date to sort on. This is generated by the DB with @UpdateTimestamp\nI think this means that it will change when something like frozen is set.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403312721", "createdAt": "2020-04-03T20:32:54Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -354,7 +363,10 @@ public void setDefaultBranchIfNotSet(Entry entry, String repositoryId) {\n                             String reference = workflowVersion.getReference();\n                             return branch.equals(reference);\n                         }).findFirst();\n-                firstWorkflowVersion.ifPresent(version -> entry.checkAndSetDefaultVersion(version.getName()));\n+                firstWorkflowVersion.ifPresentOrElse(version -> entry.checkAndSetDefaultVersion(version.getName()), () -> {\n+                    Version newestVersion = Collections.max(workflowVersions, Comparator.comparingInt(s -> s.getDbUpdateDate().getNanos()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjQzMDQz", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-387643043", "createdAt": "2020-04-04T00:16:46Z", "commit": {"oid": "bbe44d9bf10f44793d50f24455b98c312287ee02"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDoxNjo0NlrOGAtKaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwMDozMDowNVrOGAtUXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5MzEyOQ==", "bodyText": "Can you put the implementation in entry? Looks like the Tool and Workflow implementations are identical.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403393129", "createdAt": "2020-04-04T00:16:46Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -158,6 +166,25 @@ public Tool(long id, String name) {\n         workflowVersions = new TreeSet<>();\n     }\n \n+    @Override\n+    public String getDefaultVersion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbe44d9bf10f44793d50f24455b98c312287ee02"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NDQwOQ==", "bodyText": "Agreed, the implicit default version has led to confusion with Terra team.", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403394409", "createdAt": "2020-04-04T00:23:33Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTY3OA==", "bodyText": "Shouldn't the filter be !Object.equals(...? You're trying to grab the max date of all versions excluding the version you're about to delete?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r403395678", "createdAt": "2020-04-04T00:30:05Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> Objects.equals(v.getName(), version))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbe44d9bf10f44793d50f24455b98c312287ee02"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b84d12eb5f078c86227b549ae17db2bf8d9d860a", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/b84d12eb5f078c86227b549ae17db2bf8d9d860a", "committedDate": "2020-04-04T01:15:50Z", "message": "Fix"}, "afterCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/7a54d598d3183efa827f654328b705dc7ef5cb26", "committedDate": "2020-04-06T14:46:06Z", "message": "Simplify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Mzc0Njcx", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-388374671", "createdAt": "2020-04-06T15:39:03Z", "commit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTozOTowM1rOGBd0FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTozOTowM1rOGBd0FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MDIyOA==", "bodyText": "Why call this actual default version instead of just default version?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404190228", "createdAt": "2020-04-06T15:39:03Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -143,6 +146,11 @@\n     @Cascade(CascadeType.DETACH)\n     private final SortedSet<Tag> workflowVersions;\n \n+    @JsonIgnore\n+    @OneToOne(targetEntity = Tag.class, fetch = FetchType.LAZY)\n+    @JoinColumn(name = \"actualDefaultVersion\", referencedColumnName = \"id\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Mzc1OTQx", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-388375941", "createdAt": "2020-04-06T15:40:26Z", "commit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MDoyNlrOGBd4GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNTo0MzoyMVrOGBeAtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MTI1Ng==", "bodyText": "Removing this might break the CLI. Can you confirm if this is the case or not?\n(and how broken or not it is)", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404191256", "createdAt": "2020-04-06T15:40:26Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Entry.java", "diffHunk": "@@ -136,10 +136,6 @@\n     @ApiModelProperty(value = \"This is the email of the git organization\", position = 6)\n     private String email;\n \n-    @Column", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5MzQ2MQ==", "bodyText": "Javadoc this (looks like a date for the underlying content, whether descriptor files or docker image) and", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r404193461", "createdAt": "2020-04-06T15:43:21Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -195,6 +196,9 @@ public String getVerifiedSource() {\n         }\n     }\n \n+    @JsonIgnore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Mzk4NzY4", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-388398768", "createdAt": "2020-04-06T16:05:23Z", "commit": {"oid": "7a54d598d3183efa827f654328b705dc7ef5cb26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71b2770e472724fc4c14b1b284891e9e196b31fe", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/71b2770e472724fc4c14b1b284891e9e196b31fe", "committedDate": "2020-04-06T16:04:12Z", "message": "Add comment"}, "afterCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/768557fc142437cb91464668164917e1298d3c70", "committedDate": "2020-04-06T16:26:56Z", "message": "Add comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDE5MjUy", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-388419252", "createdAt": "2020-04-06T16:29:34Z", "commit": {"oid": "71b2770e472724fc4c14b1b284891e9e196b31fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTU1Njky", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-388555692", "createdAt": "2020-04-06T19:33:40Z", "commit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjY5MTUz", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-390269153", "createdAt": "2020-04-08T19:31:10Z", "commit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozMToxMFrOGC90uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTozMToxMFrOGC90uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2MzI1OQ==", "bodyText": "I feel like we should give the user with a warning that they're deleting the default version so we're setting the new default to latest. Maybe we should log this message to surface in the UI?", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r405763259", "createdAt": "2020-04-08T19:31:10Z", "author": {"login": "Ldcabansay"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -361,6 +364,12 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         checkEntry(entry);\n         checkUserCanUpdate(user, entry);\n         checkHosted(entry);\n+        // If the version that's about to be deleted is the default version, unset it\n+        if (entry.getActualDefaultVersion().getName().equals(version)) {\n+            Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> !Objects.equals(v.getName(), version))\n+                    .max(Comparator.comparingLong(ver -> ver.getDate().getTime()));\n+            entry.setActualDefaultVersion(max.orElse(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzA5NjQ4", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-390309648", "createdAt": "2020-04-08T20:32:22Z", "commit": {"oid": "768557fc142437cb91464668164917e1298d3c70"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8fd2b1cf104cc116ca9bb9da4a9234ed117b5f", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/2f8fd2b1cf104cc116ca9bb9da4a9234ed117b5f", "committedDate": "2020-04-08T21:26:13Z", "message": "Add new column, temporarily add new property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "042657f5385ae2385d8e263a09c173d2559b10ab", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/042657f5385ae2385d8e263a09c173d2559b10ab", "committedDate": "2020-04-08T21:26:13Z", "message": "Overwrite previous default version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d34d7611b6fffc6c23951326c5517a77b1e48b3", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/3d34d7611b6fffc6c23951326c5517a77b1e48b3", "committedDate": "2020-04-08T21:26:13Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5c5331b4b57fd42d8ae9cb13b135baa19ffb77e", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/c5c5331b4b57fd42d8ae9cb13b135baa19ffb77e", "committedDate": "2020-04-08T21:26:13Z", "message": "Migrate to new column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be1caa552a60e8824db93e32ea6d09fcdd64e513", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/be1caa552a60e8824db93e32ea6d09fcdd64e513", "committedDate": "2020-04-08T21:26:53Z", "message": "Remove old column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6a7e24ac648eaa1ac1f2aa24d6cdfba3338173c", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/d6a7e24ac648eaa1ac1f2aa24d6cdfba3338173c", "committedDate": "2020-04-08T21:26:53Z", "message": "Fix one test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9337609ce452b9adfc12ad7efe5c4e990ae4a4c5", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/9337609ce452b9adfc12ad7efe5c4e990ae4a4c5", "committedDate": "2020-04-08T21:26:54Z", "message": "Fix some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c01af057ff72a16463a2b16c46e652b07e030b7", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/6c01af057ff72a16463a2b16c46e652b07e030b7", "committedDate": "2020-04-08T21:26:54Z", "message": "Remove old function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "193a6c187086afb77a9a4b873ee9144a43d2fad0", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/193a6c187086afb77a9a4b873ee9144a43d2fad0", "committedDate": "2020-04-08T21:26:54Z", "message": "Change how recentVersion is determined"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70eaab0ef73e63aedabbcdca611b2a414fb440f8", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/70eaab0ef73e63aedabbcdca611b2a414fb440f8", "committedDate": "2020-04-08T21:26:54Z", "message": "Try getting newest version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398c8919b20deb29ccdf5ad4db671231d725ac15", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/398c8919b20deb29ccdf5ad4db671231d725ac15", "committedDate": "2020-04-08T21:26:54Z", "message": "Simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15bc0c33f1ba355a281a98ea6b61a2ae3a7059c3", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/15bc0c33f1ba355a281a98ea6b61a2ae3a7059c3", "committedDate": "2020-04-08T21:26:54Z", "message": "Add comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "768557fc142437cb91464668164917e1298d3c70", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/768557fc142437cb91464668164917e1298d3c70", "committedDate": "2020-04-06T16:26:56Z", "message": "Add comment"}, "afterCommit": {"oid": "15bc0c33f1ba355a281a98ea6b61a2ae3a7059c3", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/15bc0c33f1ba355a281a98ea6b61a2ae3a7059c3", "committedDate": "2020-04-08T21:26:54Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98b6971b19cea2e5131aae4892aac7671eb0ea0e", "author": {"user": {"login": "garyluu", "name": "Gary Luu"}}, "url": "https://github.com/dockstore/dockstore/commit/98b6971b19cea2e5131aae4892aac7671eb0ea0e", "committedDate": "2020-04-09T17:52:42Z", "message": "Merge branch 'develop' into feature/3345/defaultVersion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNTQ3MDcx", "url": "https://github.com/dockstore/dockstore/pull/3374#pullrequestreview-391547071", "createdAt": "2020-04-10T16:55:29Z", "commit": {"oid": "98b6971b19cea2e5131aae4892aac7671eb0ea0e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNjo1NToyOVrOGD_56Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNjo1NToyOVrOGD_56Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0NTkyOQ==", "bodyText": "I agree", "url": "https://github.com/dockstore/dockstore/pull/3374#discussion_r406845929", "createdAt": "2020-04-10T16:55:29Z", "author": {"login": "wshands"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -238,10 +238,13 @@ T saveVersion(User user, Long entryId, T entry, U version, Set<SourceFile> versi\n         validatedVersion.setParent(entry);\n         long l = getVersionDAO().create(validatedVersion);\n         entry.getWorkflowVersions().add(getVersionDAO().findById(l));\n-        entry.checkAndSetDefaultVersion(validatedVersion.getName());\n+        // Only set if the default version isn't already there\n+        if (entry.getDefaultVersion() == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwMDgwNg=="}, "originalCommit": {"oid": "9019d398dec60e77bd5b7fac2e85f7f971cc6327"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1827, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}