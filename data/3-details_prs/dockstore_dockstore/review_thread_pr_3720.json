{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTA0NDA2", "number": 3720, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjowMjoyM1rOEWRSCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyMDoxOVrOEWSz2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzg3Mjc0OnYy", "diffSide": "LEFT", "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjowMjoyM1rOG9fY1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNTo0MzoyMlrOG-Uilg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg==", "bodyText": "ok, now i'm confused which yq is supposed to be used", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467130582", "createdAt": "2020-08-07T16:02:23Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDkxOA==", "bodyText": "I installed 3.1.2, which was the same as the circle ci config :( Any ideas?", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467130918", "createdAt": "2020-08-07T16:03:02Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2ODEzNg==", "bodyText": "so in the last PR, it looks like the it was supposed to be 3.1.2.  now it looks like the new version (the one mentioned in develop).  i think someone else merged a openapi.yaml with a new version of yq between the two base branches", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467168136", "createdAt": "2020-08-07T17:16:23Z", "author": {"login": "garyluu"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg4MDcxOA==", "bodyText": "Should I run again with yq 3.3.2 (from develop)?", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467880718", "createdAt": "2020-08-10T12:51:22Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMDcwMg==", "bodyText": "It's worth a shot, or at least 3.3.1 looks like my install says this\n$ snap info yq\nname:      yq\nsummary:   A lightweight and portable command-line YAML processor\npublisher: Mike Farah (mikefarah)\nstore-url: https://snapcraft.io/yq\ncontact:   https://github.com/mikefarah/yq/issues\nlicense:   unset\ndescription: |\n  The aim of the project is to be the jq or sed of yaml files.\ncommands:\n  - yq\nsnap-id:      b1xa1ED1Aw4HN9BnJVP3Je95pyEVN6gu\ntracking:     latest/stable\nrefresh-date: 60 days ago, at 21:13 EDT\nchannels:\n  latest/stable:    3.3.1 2020-06-11 (736) 2MB -\n  latest/candidate: \u2191                          \n  latest/beta:      \u2191                          \n  latest/edge:      3.3.2 2020-06-15 (772) 2MB -\ninstalled:          3.3.1            (736) 2MB -", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467930702", "createdAt": "2020-08-10T14:10:30Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMDg4OQ==", "bodyText": "Also #3629", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467930889", "createdAt": "2020-08-10T14:10:45Z", "author": {"login": "denis-yuen"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAwMTQzMA==", "bodyText": "Ok, I used 3.3.2 (same as develop)", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r468001430", "createdAt": "2020-08-10T15:43:22Z", "author": {"login": "agduncan94"}, "path": "dockstore-webservice/src/main/resources/openapi3/openapi.yaml", "diffHunk": "@@ -4225,7 +4343,7 @@ paths:\n           description: default response\n       summary: Successful response if elastic search is up and running\n       tags:\n-        - metadata", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzEzMDU4Mg=="}, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 4114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODA5OTkxOnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoxMjozN1rOG9hkUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoxMjozN1rOG9hkUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NjI5MA==", "bodyText": "Totally optional, but only because it took me a bit to understand this: Either add a comment saying something to the effect that there is no need to change because the version has not changed, or create a function for the if condition whose name represents that.\nI guess the disconnect is that cognitively SKIP_COMMIT_ID != unmodified to me.", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467166290", "createdAt": "2020-08-07T17:12:37Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/SourceCodeRepoInterface.java", "diffHunk": "@@ -332,7 +353,9 @@ public void updateEntryMetadata(final Entry<?, ?> entry, final DescriptorLanguag\n             Workflow workflow = (Workflow)entry;\n             workflow.getWorkflowVersions().forEach(workflowVersion -> {\n                 String filePath = workflowVersion.getWorkflowPath();\n-                updateVersionMetadata(filePath, workflowVersion, type, repositoryId);\n+                if (!Objects.equals(SKIP_COMMIT_ID, workflowVersion.getCommitID())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODEyMzE0OnYy", "diffSide": "RIGHT", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractWorkflowResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyMDoxOVrOG9hyrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyMDoxOVrOG9hyrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2OTk2Nw==", "bodyText": "I know I suggested the stream/filter, but by making it a Set there is the possibility that a version may get filtered out that wasn't being filtered before. Probably never happens with our data, but still... I would just get rid of the set and the intermediate variable, and use forEach directly on the stream:\nnewWorkflow.getWorkflowVersions().stream()\n    .filter(workflowVersion -> !Objects.equals(SKIP_COMMIT_ID, workflowVersion.getCommitID()))\n    .forEach(version -> {\n        WorkflowVersion workflowVersionFromDB = existingVersionMap.get(version.getName());\n        ...\n});", "url": "https://github.com/dockstore/dockstore/pull/3720#discussion_r467169967", "createdAt": "2020-08-07T17:20:19Z", "author": {"login": "coverbeck"}, "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractWorkflowResource.java", "diffHunk": "@@ -166,10 +168,15 @@ protected void updateDBWorkflowWithSourceControlWorkflow(Workflow workflow, Work\n             }\n         }\n \n+        // Remove versions that do not need to be updated\n+        Set<WorkflowVersion> filteredVersions = newWorkflow.getWorkflowVersions().stream().filter(workflowVersion -> !Objects.equals(SKIP_COMMIT_ID, workflowVersion.getCommitID())).collect(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae5f436e4a4fc384da3a87d2d244dfd2f4b8dac"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2808, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}