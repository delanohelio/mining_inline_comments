{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NTgxMDMw", "number": 688, "title": "KOGITO-3055  Refactor Quarkus Extension", "bodyText": "I'll be away until end of August, so I invite you to take a look, and if something looks off, I would still encourage you to merge and then amend with further PRs, because I believe this refactor is long overdue -- unless there are larger issues. Alternatively, whoever has right may push on top of this.\n\n\nI have moved and renamed a lot of code into methods and/or their own classes. It is a bit tidier, although it can be further improved. E.g. I have created a Quarkus-specific InMemoryCompiler that delegates to the Drools' Java Compiler wrapper hiding some internal flags.\n\n\nI have also removed usages of the XGenerator#fromJar() method; instead I have added an utility method to read a <Path, Resource> pair (called CollectedResource for lack of a better name) from Paths. If a Path is actually a Jar, then the the resource is read from the Jar directly into a Resource, transparently.\nThe new usage pattern is XGenerator.fromCollectedResources(CollectedResources.fromPaths(Path...)). This is cleaner and more transparent.\nWe can probably deprecate most of the XGenerator.fromY() methods in favor of this one.\n\n\nI have also added a new ResourceType SW (serverless workflow). Because SW uses a double extension (sw.yaml, sw.json etc.) I have removed the check that raised an exception if the extension contained a dot (because now it does).\nIncidentally, this also means that the method to match a file name to a resource type is a bit less cheap because you cannot just do lastIndexOf('.').", "createdAt": "2020-08-10T15:42:24Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688", "merged": true, "mergeCommit": {"oid": "bece507d15db8b3270d4d35408b29ec34dffc1de"}, "closed": true, "closedAt": "2020-08-24T14:44:27Z", "author": {"login": "evacchi"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9kSb_gBqjM2Mzk0MDYwNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCDqSHgFqTQ3MzU1MDgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f205568fb0501f921a222b072d6bd223cd378b35", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/f205568fb0501f921a222b072d6bd223cd378b35", "committedDate": "2020-08-10T15:12:03Z", "message": "wip"}, "afterCommit": {"oid": "efa57f65b43726b41e914565b891f9f64b030556", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/efa57f65b43726b41e914565b891f9f64b030556", "committedDate": "2020-08-10T13:41:13Z", "message": "add another exclusion for coverage"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32cc54620d9f33f6f94dc155c4ccceb539675ced", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/32cc54620d9f33f6f94dc155c4ccceb539675ced", "committedDate": "2020-08-10T16:14:06Z", "message": "refactored quarkus extension"}, "afterCommit": {"oid": "cc44a618c07d1bf6cb192cc6d6c8eb8b70599e50", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/cc44a618c07d1bf6cb192cc6d6c8eb8b70599e50", "committedDate": "2020-08-12T07:58:50Z", "message": "use jars directly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc44a618c07d1bf6cb192cc6d6c8eb8b70599e50", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/cc44a618c07d1bf6cb192cc6d6c8eb8b70599e50", "committedDate": "2020-08-12T07:58:50Z", "message": "use jars directly"}, "afterCommit": {"oid": "5369fd7ffe817006136afb3075b1c61a42564c21", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/5369fd7ffe817006136afb3075b1c61a42564c21", "committedDate": "2020-08-12T12:36:09Z", "message": "use jars directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53043bb8fd2f1e786010998158774530ece48ebc", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/53043bb8fd2f1e786010998158774530ece48ebc", "committedDate": "2020-08-13T13:20:22Z", "message": "KOGITO-3055 Refactor Quarkus Extension"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5369fd7ffe817006136afb3075b1c61a42564c21", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/5369fd7ffe817006136afb3075b1c61a42564c21", "committedDate": "2020-08-12T12:36:09Z", "message": "use jars directly"}, "afterCommit": {"oid": "53043bb8fd2f1e786010998158774530ece48ebc", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/53043bb8fd2f1e786010998158774530ece48ebc", "committedDate": "2020-08-13T13:20:22Z", "message": "KOGITO-3055 Refactor Quarkus Extension"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NzU0NzE4", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466754718", "createdAt": "2020-08-13T13:21:54Z", "commit": {"oid": "53043bb8fd2f1e786010998158774530ece48ebc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzoyMTo1NFrOHALPvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzoyMTo1NFrOHALPvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk0NjMwMQ==", "bodyText": "moved to its own class, instead of a static private class", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r469946301", "createdAt": "2020-08-13T13:21:54Z", "author": {"login": "evacchi"}, "path": "kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/AppPaths.java", "diffHunk": "@@ -0,0 +1,172 @@\n+package org.kie.kogito.quarkus.deployment;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53043bb8fd2f1e786010998158774530ece48ebc"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/b1f3ab372f581e669d8cee477bba8f44a9864f69", "committedDate": "2020-08-13T13:31:18Z", "message": "copyright"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ac4d64136500873a94954c0300b838b56047106", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/7ac4d64136500873a94954c0300b838b56047106", "committedDate": "2020-08-13T13:29:33Z", "message": "copyright"}, "afterCommit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/b1f3ab372f581e669d8cee477bba8f44a9864f69", "committedDate": "2020-08-13T13:31:18Z", "message": "copyright"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NzY0NTk2", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466764596", "createdAt": "2020-08-13T13:33:05Z", "commit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzozMzowNVrOHALtKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzozMzowNVrOHALtKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk1MzgzNQ==", "bodyText": ".sw.json, sw.yaml, etc. need the dot", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r469953835", "createdAt": "2020-08-13T13:33:05Z", "author": {"login": "evacchi"}, "path": "api/kogito-api/src/main/java/org/kie/api/io/ResourceType.java", "diffHunk": "@@ -83,9 +83,6 @@ public static ResourceType addResourceTypeToRegistry(final String resourceType,\n \n         CACHE.put( resourceType, resource );\n         resource.getAllExtensions().forEach( ext -> {\n-            if (ext.contains( \".\" )) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NzY0ODc5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466764879", "createdAt": "2020-08-13T13:33:22Z", "commit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzozMzoyMlrOHALuBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMzozMzoyMlrOHALuBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk1NDA1Mg==", "bodyText": "therefore, the simple lastIndexOf() check does not work", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r469954052", "createdAt": "2020-08-13T13:33:22Z", "author": {"login": "evacchi"}, "path": "api/kogito-api/src/main/java/org/kie/api/io/ResourceType.java", "diffHunk": "@@ -281,8 +286,10 @@ public static ResourceType getResourceType(final String resourceType) {\n     }\n \n     public static ResourceType determineResourceType(final String resourceName) {\n-        int dotPos = resourceName.lastIndexOf( '.' );\n-        return dotPos < 0 ? null : CACHE.get( resourceName.substring( dotPos ) );\n+        return CACHE.values().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1f3ab372f581e669d8cee477bba8f44a9864f69"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/f6c09e13bac8f960d778f3ee45f8040c764ada72", "committedDate": "2020-08-13T13:59:39Z", "message": "docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODQ4NTEy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466848512", "createdAt": "2020-08-13T15:01:19Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTowMToxOVrOHAPp3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTowMToxOVrOHAPp3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAxODUyNg==", "bodyText": "sorry for the stupid question, but what is the difference between this new CollectedResource and a Kie api Resource? Or to better frame the question, why this class is not a specialization of the Kie api Resource?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470018526", "createdAt": "2020-08-13T15:01:19Z", "author": {"login": "tarilabs"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/io/CollectedResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen.io;\n+\n+import java.io.IOException;\n+import java.io.UncheckedIOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Enumeration;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipFile;\n+\n+import org.drools.core.io.impl.ByteArrayResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.core.io.internal.InternalResource;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+\n+import static org.drools.core.util.IoUtils.readBytesFromInputStream;\n+import static org.kie.api.io.ResourceType.determineResourceType;\n+\n+/**\n+ * A (Path basePath, Resource resource) pair\n+ */\n+public class CollectedResource {\n+\n+    /**\n+     * Returns a collection of CollectedResource from the given paths.\n+     * If a path is a jar, then walks inside the jar.\n+     */\n+    public static Collection<CollectedResource> fromPaths(Path... paths) {\n+        Collection<CollectedResource> resources = new ArrayList<>();\n+\n+        for (Path path : paths) {\n+            if (path.toFile().isDirectory()) {\n+                Collection<CollectedResource> res = fromDirectory(path);\n+                resources.addAll(res);\n+            } else if (path.getFileName().toString().endsWith(\".jar\")) {\n+                Collection<CollectedResource> res = fromJarFile(path);\n+                resources.addAll(res);\n+            } else {\n+                throw new IllegalArgumentException(\"Expected directory or archive, file given: \" + path);\n+            }\n+        }\n+\n+        return resources;\n+    }\n+\n+    /**\n+     * Returns a collection of CollectedResource from the given jar file.\n+     */\n+    public static Collection<CollectedResource> fromJarFile(Path jarPath) {\n+        Collection<CollectedResource> resources = new ArrayList<>();\n+        try (ZipFile zipFile = new ZipFile(jarPath.toFile())) {\n+            Enumeration<? extends ZipEntry> entries = zipFile.entries();\n+            while (entries.hasMoreElements()) {\n+                ZipEntry entry = entries.nextElement();\n+                ResourceType resourceType = determineResourceType(entry.getName());\n+                if (resourceType != null) {\n+                    InternalResource resource = new ByteArrayResource(readBytesFromInputStream(zipFile.getInputStream(entry)));\n+                    resource.setResourceType(resourceType);\n+                    resource.setSourcePath(entry.getName());\n+                    CollectedResource collectedResource = new CollectedResource(jarPath, resource);\n+                    resources.add(collectedResource);\n+                }\n+            }\n+            return resources;\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+    }\n+\n+    /**\n+     * Returns a collection of CollectedResource from the given directory.\n+     */\n+    public static Collection<CollectedResource> fromDirectory(Path path) {\n+        Collection<CollectedResource> resources = new ArrayList<>();\n+        try {\n+            Files.walk(path).map(Path::toFile)\n+                    .map(f -> new FileSystemResource(f).setResourceType(determineResourceType(f.getName())))\n+                    .map(f -> new CollectedResource(path, f))\n+                    .forEach(resources::add);\n+        } catch (IOException e) {\n+            throw new UncheckedIOException(e);\n+        }\n+        return resources;\n+    }\n+\n+    private final Path basePath;\n+    private final Resource resource;\n+\n+    public CollectedResource(Path basePath, Resource resource) {\n+        this.basePath = basePath;\n+        this.resource = resource;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODY5MTY1", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466869165", "createdAt": "2020-08-13T15:23:05Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNToyMzowNVrOHAQmjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNToyMzowNVrOHAQmjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAzNDA2MA==", "bodyText": "I could not find a better name for this <Path, Resource> pair. feel free to propose a better one.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470034060", "createdAt": "2020-08-13T15:23:05Z", "author": {"login": "evacchi"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/io/CollectedResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen.io;\n+\n+import java.io.IOException;\n+import java.io.UncheckedIOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Enumeration;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipFile;\n+\n+import org.drools.core.io.impl.ByteArrayResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.core.io.internal.InternalResource;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+\n+import static org.drools.core.util.IoUtils.readBytesFromInputStream;\n+import static org.kie.api.io.ResourceType.determineResourceType;\n+\n+/**\n+ * A (Path basePath, Resource resource) pair\n+ */\n+public class CollectedResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODkwNjEy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466890612", "createdAt": "2020-08-13T15:47:23Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTo0NzoyM1rOHARmEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTo0ODo1MVrOHARqAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA1MDMyMA==", "bodyText": "I think this is the same as PredictionCodegen.ofCollectedResource(CollectedResource.fromJar(...))\nWe could refactor these functions and annotate with @Deprecate", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470050320", "createdAt": "2020-08-13T15:47:23Z", "author": {"login": "ricardozanini"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -86,6 +88,14 @@ public PredictionCodegen(List<PMMLResource> resources) {\n         this.moduleGenerator = new PredictionContainerGenerator(applicationCanonicalName, resources);\n     }\n \n+    public static PredictionCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+        List<PMMLResource> dmnResources = resources.stream()\n+                .filter(r -> r.resource().getResourceType() == ResourceType.PMML)\n+                .flatMap(r -> parsePredictions(r.basePath(), Collections.singletonList(r.resource())).stream())\n+                .collect(toList());\n+        return ofPredictions(dmnResources);\n+    }\n+\n     public static PredictionCodegen ofJar(Path... jarPaths) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA1MDc2OA==", "bodyText": "Same here: ProcessCodegen.ofCollectedResource(CollectedResource.fromJar(...))", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470050768", "createdAt": "2020-08-13T15:48:00Z", "author": {"login": "ricardozanini"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/process/ProcessCodegen.java", "diffHunk": "@@ -108,6 +111,24 @@\n     private ResourceGeneratorFactory resourceGeneratorFactory;\n     private String packageName;\n \n+    public static ProcessCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+        List<Process> processes = resources.stream()\n+                .map(CollectedResource::resource)\n+                .flatMap(resource -> {\n+                    if (SUPPORTED_BPMN_EXTENSIONS.stream().anyMatch(resource.getSourcePath()::endsWith)) {\n+                        return parseProcessFile(resource).stream();\n+                    } else {\n+                        return SUPPORTED_SW_EXTENSIONS.entrySet()\n+                                .stream()\n+                                .filter(e -> resource.getSourcePath().endsWith(e.getKey()))\n+                                .map(e -> parseWorkflowFile(resource, e.getValue()));\n+                    }\n+                })\n+                .collect(toList());\n+\n+        return ofProcesses(processes);\n+    }\n+\n     public static ProcessCodegen ofJar(Path... jarPaths) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA1MTMzMA==", "bodyText": "Same here :D @Deprecate and CollectedResource new API.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470051330", "createdAt": "2020-08-13T15:48:51Z", "author": {"login": "ricardozanini"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/rules/IncrementalRuleCodegen.java", "diffHunk": "@@ -89,6 +90,14 @@\n \n public class IncrementalRuleCodegen extends AbstractGenerator {\n \n+    public static IncrementalRuleCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+        List<Resource> dmnResources = resources.stream()\n+                .map(CollectedResource::resource)\n+                .filter(IncrementalRuleCodegen::isSupportedResourceType)\n+                .collect(toList());\n+        return ofResources(dmnResources);\n+    }\n+\n     public static IncrementalRuleCodegen ofJar(Path... jarPaths) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTk0MDk0", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466994094", "createdAt": "2020-08-13T17:43:11Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDI2NTA4", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-469426508", "createdAt": "2020-08-18T12:55:34Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTEyMjcy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-469512272", "createdAt": "2020-08-18T14:28:49Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNDoyODo0OVrOHCXQOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNDoyODo0OVrOHCXQOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI0MDE4Ng==", "bodyText": "I suspect this wouldn't be completely correct since you're missing the case of the file ending with \".jar.original\" as covered by the AppPaths at line 133 ( https://github.com/kiegroup/kogito-runtimes/pull/688/files#diff-02ab48c8cb4aa88ed360c563c29777b1R133 ). More in general wouldn't be better to use the enumeration already defined there to avoid duplicating that logic?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r472240186", "createdAt": "2020-08-18T14:28:49Z", "author": {"login": "mariofusco"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/io/CollectedResource.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen.io;\n+\n+import java.io.IOException;\n+import java.io.UncheckedIOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Enumeration;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipFile;\n+\n+import org.drools.core.io.impl.ByteArrayResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.core.io.internal.InternalResource;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+\n+import static org.drools.core.util.IoUtils.readBytesFromInputStream;\n+import static org.kie.api.io.ResourceType.determineResourceType;\n+\n+/**\n+ * A (Path basePath, Resource resource) pair\n+ */\n+public class CollectedResource {\n+\n+    /**\n+     * Returns a collection of CollectedResource from the given paths.\n+     * If a path is a jar, then walks inside the jar.\n+     */\n+    public static Collection<CollectedResource> fromPaths(Path... paths) {\n+        Collection<CollectedResource> resources = new ArrayList<>();\n+\n+        for (Path path : paths) {\n+            if (path.toFile().isDirectory()) {\n+                Collection<CollectedResource> res = fromDirectory(path);\n+                resources.addAll(res);\n+            } else if (path.getFileName().toString().endsWith(\".jar\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMwMTg3", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-466930187", "createdAt": "2020-08-13T16:35:19Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNToxOVrOHATbKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNToxOVrOHATbKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MDI5Nw==", "bodyText": "Since these two statement only differ in class name, should it not better to have a private  method\nprivate void addChildrenClasses(Index index,\nClass<?> superClass,\nBuildProducer reflectiveClass) {\nindex.getAllKnownSubclasses(createDotName(superClass.getName()))\n.forEach(c -> reflectiveClass.produce(\nnew ReflectiveClassBuildItem(true,\ntrue,\nc.name().toString())));\n}?\nI suspect this wont be the last super class we will add there\nAnd to make the code shorter, I realize now (I did not include that in my fix, which proof the different state of mind between author and reviewer ;)) we can use import org.kie.kogito.services.event.AbstractProcessDataEvent, so you just have AbstractProcessDataEvent.class in the call to createSimple", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r470080297", "createdAt": "2020-08-13T16:35:19Z", "author": {"login": "fjtirado"}, "path": "kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java", "diffHunk": "@@ -193,259 +386,96 @@ public RuntimeInitializedClassBuildItem runtimeInitializedClass() {\n         return new RuntimeInitializedClassBuildItem(ClassFieldAccessorFactory.class.getName());\n     }\n \n-    @BuildStep\n-    public void generateModel(ArchiveRootBuildItem root,\n-                              BuildProducer<GeneratedBeanBuildItem> generatedBeans,\n-                              CombinedIndexBuildItem combinedIndexBuildItem,\n-                              LaunchModeBuildItem launchMode,\n-                              LiveReloadBuildItem liveReload,\n-                              BuildProducer<NativeImageResourceBuildItem> resource,\n-                              BuildProducer<GeneratedResourceBuildItem> genResBI,\n-                              BuildProducer<ReflectiveClassBuildItem> reflectiveClass,\n-                              CurateOutcomeBuildItem curateOutcomeBuildItem) throws IOException, BootstrapDependencyProcessingException {\n+    private void writeJsonSchema(AppPaths appPaths, Index index) throws IOException {\n+        Path relativePath = JsonSchemaUtil.getJsonDir();\n+        Path targetClasses = appPaths.getFirstProjectPath().resolve(targetClassesDir);\n+        Collection<GeneratedFile> jsonFiles = getJsonSchemaFiles(targetClasses, index);\n+        Path jsonSchemaPath = targetClasses.resolve(relativePath);\n+        Files.createDirectories(jsonSchemaPath);\n \n-        if (liveReload.isLiveReload()) {\n-            return;\n-        }\n-\n-        AppPaths appPaths = new AppPaths(root.getPaths());\n-\n-        ApplicationGenerator appGen = createApplicationGenerator(appPaths, combinedIndexBuildItem);\n-        Collection<GeneratedFile> generatedFiles = appGen.generate();\n-\n-        Collection<GeneratedFile> javaFiles = generatedFiles.stream().filter( f -> f.relativePath().endsWith( \".java\" ) ).collect( Collectors.toCollection( ArrayList::new ));\n-        writeGeneratedFiles(appPaths, generatedFiles, resource, genResBI);\n-\n-        if (!javaFiles.isEmpty()) {\n-\n-            Indexer kogitoIndexer = new Indexer();\n-            Set<DotName> kogitoIndex = new HashSet<>();\n-\n-            MemoryFileSystem trgMfs = new MemoryFileSystem();\n-            CompilationResult result = compile(appPaths, trgMfs, curateOutcomeBuildItem.getEffectiveModel(), javaFiles, launchMode.getLaunchMode());\n-            register(appPaths, trgMfs, generatedBeans,\n-                     (className, data) -> generateBeanBuildItem( combinedIndexBuildItem, kogitoIndexer, kogitoIndex, className, data ),\n-                     launchMode.getLaunchMode(), result);\n-\n-\n-            Index index = kogitoIndexer.complete();\n-\n-            generatePersistenceInfo(appPaths, generatedBeans, CompositeIndex.create(combinedIndexBuildItem.getIndex(), index),\n-                                    launchMode, resource, curateOutcomeBuildItem);\n-\n-\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.event.AbstractDataEvent\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.AbstractProcessDataEvent\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.ProcessInstanceDataEvent\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.VariableInstanceDataEvent\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.ProcessInstanceEventBody\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.NodeInstanceEventBody\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.ProcessErrorEventBody\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.VariableInstanceEventBody\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.UserTaskInstanceDataEvent\"));\n-            reflectiveClass.produce(\n-                    new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.UserTaskInstanceEventBody\"));\n-\n-            addChildrenClasses(index, org.kie.kogito.services.event.AbstractProcessDataEvent.class, reflectiveClass);\n-            // not sure there is any generated class directly inheriting from AbstractDataEvent, keeping just in case\n-            addChildrenClasses(index, org.kie.kogito.event.AbstractDataEvent.class, reflectiveClass);\n-            \n-            Collection<GeneratedFile> jsonFiles = getJsonSchemaFiles(index, trgMfs);\n-            Path relativePath = JsonSchemaUtil.getJsonDir();\n-            Path jsonSchemaPath = appPaths.getFirstProjectPath().resolve(\"target\").resolve(\"classes\").resolve(relativePath);\n-            Files.createDirectories(jsonSchemaPath);\n-\n-            for (GeneratedFile jsonFile : jsonFiles) {\n-                Files.write(jsonSchemaPath.resolve(jsonFile.relativePath()), jsonFile.contents());\n-                resource.produce(new NativeImageResourceBuildItem(relativePath.resolve(jsonFile.relativePath()).toString()));\n-            }\n+        for (GeneratedFile jsonFile : jsonFiles) {\n+            Files.write(jsonSchemaPath.resolve(jsonFile.relativePath()), jsonFile.contents());\n+            resource.produce(new NativeImageResourceBuildItem(relativePath.resolve(jsonFile.relativePath()).toString()));\n         }\n     }\n-    \n-    private void addChildrenClasses(Index index,\n-                                    Class<?> superClass,\n-                                    BuildProducer<ReflectiveClassBuildItem> reflectiveClass) {\n-        index.getAllKnownSubclasses(createDotName(superClass.getName()))\n-             .forEach(c -> reflectiveClass.produce(\n-                                                   new ReflectiveClassBuildItem(true,\n-                                                                                true,\n-                                                                                c.name().toString())));\n-    }\n \n-    private void writeGeneratedFiles(AppPaths appPaths, Collection<GeneratedFile> resourceFiles, BuildProducer<NativeImageResourceBuildItem> niResBI, BuildProducer<GeneratedResourceBuildItem> genResBI) {\n-        for (Path projectPath : appPaths.projectPaths) {\n-            String restResourcePath = projectPath.resolve( generatedCustomizableSourcesDir ).toString();\n-            String resourcePath = projectPath.resolve( generatedResourcesDir ).toString();\n-            String sourcePath = projectPath.resolve( generatedSourcesDir ).toString();\n-\n-            for (GeneratedFile f : resourceFiles) {\n-                try {\n-                    if ( f.getType() == GeneratedFile.Type.RESOURCE ) {\n-                        writeGeneratedFile( f, resourcePath );\n-                    } else if (f.getType() == GeneratedFile.Type.GENERATED_CP_RESOURCE) { // since quarkus-maven-plugin is later phase of maven-resources-plugin, need to manually late-provide the resource in the expected location for quarkus:dev phase --so not: writeGeneratedFile( f, resourcePath );\n-                        Path resolve = appPaths.getFirstProjectPath().resolve(\"target\").resolve(\"classes\").resolve(f.relativePath());\n-                        resolve.getParent().toFile().mkdirs();\n-                        Files.write(resolve, f.contents());\n-                        genResBI.produce(new GeneratedResourceBuildItem(f.relativePath(), f.contents()));\n-                        niResBI.produce(new NativeImageResourceBuildItem(f.relativePath()));\n-                    } else if (f.getType().isCustomizable()) {\n-                        writeGeneratedFile(f, restResourcePath);\n-                    } else {\n-                        writeGeneratedFile(f, sourcePath);\n-                    }\n-                } catch (IOException e) {\n-                    logger.warn(String.format(\"Could not write file '%s'\", f.toString()), e);\n-                }\n-            }\n-        }\n-    }\n+    private void registerDataEventsForReflection(Index index) {\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.event.AbstractDataEvent\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.AbstractProcessDataEvent\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.ProcessInstanceDataEvent\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.VariableInstanceDataEvent\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.ProcessInstanceEventBody\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.NodeInstanceEventBody\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.ProcessErrorEventBody\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.VariableInstanceEventBody\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.UserTaskInstanceDataEvent\"));\n+        reflectiveClass.produce(\n+                new ReflectiveClassBuildItem(true, true, \"org.kie.kogito.services.event.impl.UserTaskInstanceEventBody\"));\n+\n+        // not sure there is any generated class directly inheriting from AbstractDataEvent, keeping just in case\n+        index.getAllKnownSubclasses(DotName.createSimple(org.kie.kogito.event.AbstractDataEvent.class.getCanonicalName()))\n+                .forEach(c -> reflectiveClass.produce(\n+                        new ReflectiveClassBuildItem(true, true, c.name().toString())));\n+\n+        index.getAllKnownSubclasses(DotName.createSimple(org.kie.kogito.services.event.AbstractProcessDataEvent.class.getCanonicalName()))\n+                .forEach(c -> reflectiveClass.produce(\n+                        new ReflectiveClassBuildItem(true, true, c.name().toString())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "originalPosition": 585}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjMxMzQ0", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-470231344", "createdAt": "2020-08-19T08:22:15Z", "commit": {"oid": "f6c09e13bac8f960d778f3ee45f8040c764ada72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df902bce4813ff1cec3e944ed6e8e2db8b837a9e", "author": {"user": {"login": "danielezonca", "name": "Daniele Zonca"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/df902bce4813ff1cec3e944ed6e8e2db8b837a9e", "committedDate": "2020-08-19T08:25:00Z", "message": "Update CollectedResource.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjM3OTY2", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-470237966", "createdAt": "2020-08-19T08:31:00Z", "commit": {"oid": "df902bce4813ff1cec3e944ed6e8e2db8b837a9e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5015f1d5c47d550bdd732054f1cadc04a8d2533b", "author": {"user": {"login": "danielezonca", "name": "Daniele Zonca"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/5015f1d5c47d550bdd732054f1cadc04a8d2533b", "committedDate": "2020-08-19T08:40:58Z", "message": "Update KogitoAssetsProcessor.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNTUwODA1", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#pullrequestreview-473550805", "createdAt": "2020-08-24T14:35:57Z", "commit": {"oid": "5015f1d5c47d550bdd732054f1cadc04a8d2533b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDozNTo1N1rOHFn54g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNDozNTo1N1rOHFn54g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY1ODcyMg==", "bodyText": "Just a side note, if there are more paths in the PathsCollection and only one of them is a JAR, then this flag is set for all paths, which may break the getPath() method as it will either treat all paths as jars or as classes paths. Maybe it doesn't cause any issues now, but it may in future... For sure it behaves differently, as without a JAR it will return src/main/resources directories, but with at least one JAR it will return JAR file paths and classes in target\\classes - i.e. just entries stored in the classesPaths list.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/688#discussion_r475658722", "createdAt": "2020-08-24T14:35:57Z", "author": {"login": "MarianMacik"}, "path": "kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/AppPaths.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.quarkus.deployment;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.UncheckedIOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Enumeration;\n+import java.util.LinkedHashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarFile;\n+\n+import io.quarkus.bootstrap.model.PathsCollection;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+class AppPaths {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(AppPaths.class);\n+\n+    final Set<Path> projectPaths = new LinkedHashSet<>();\n+    final List<Path> classesPaths = new ArrayList<>();\n+\n+    boolean isJar = false;\n+\n+    AppPaths(PathsCollection paths) {\n+        for (Path path : paths) {\n+            PathType pathType = getPathType(path);\n+            switch (pathType) {\n+                case CLASSES: {\n+                    classesPaths.add(path);\n+                    projectPaths.add(path.getParent().getParent());\n+                    break;\n+                }\n+                case TEST_CLASSES: {\n+                    projectPaths.add(path.getParent().getParent());\n+                    break;\n+                }\n+                case JAR: {\n+                    isJar = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5015f1d5c47d550bdd732054f1cadc04a8d2533b"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4101, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}