{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMDYxMTMy", "number": 587, "title": "Kogito 2532 - monitoring addon support multiple dmn built in types", "bodyText": "Jira: https://issues.redhat.com/browse/KOGITO-2532\nThis PR adds the support of the remaining dmn built-in types in the prometheus-monitoring-addon.\nIn particular, the remaining 5 time-based built in types are supported. For all of them, a graph with the quantiles is generated in the grafana dashboards (with different scale and unit measurement):\n\ndate and time:\n\ndays and time duration:\n\nyears and months duration: total number of months (Period - toTotalMonths)\n\ntime:\n\ndate:\n\n\nMany thanks for submitting your Pull Request \u2764\ufe0f!\nPlease make sure that your PR meets the following requirements:\n\n You have read the contributors guide\n Pull Request title is properly formatted: KOGITO-XYZ Subject\n Pull Request title contains the target branch if not targeting master: [0.9.x] KOGITO-XYZ Subject\n Pull Request contains link to the JIRA issue\n Pull Request contains link to any dependent or related Pull Request\n Pull Request contains description of the issue\n Pull Request does not include fixes for issues other than the main ticket", "createdAt": "2020-06-25T14:32:29Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587", "merged": true, "mergeCommit": {"oid": "769b04ac53b7f3308b94f8b332df9b4c30e6bb9e"}, "closed": true, "closedAt": "2020-07-03T13:10:12Z", "author": {"login": "r00ta"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuvh02gH2gAyNDQwMDYxMTMyOmFhNTJiZjhkZGFhNjQyZjA4ZTU5ZjI4ODgzNjYzZGYwMGEzYzlhNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxQhM3gFqTQ0MjMwMjAwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa52bf8ddaa642f08e59f28883663df00a3c9a42", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/aa52bf8ddaa642f08e59f28883663df00a3c9a42", "committedDate": "2020-06-25T14:29:05Z", "message": "add LocalDateTime handler, generate metrics for LocalDateTime, generate panels for date and time dmn type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a559c63f4e591d11a5c7b4957ed1d34f28e20e93", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/a559c63f4e591d11a5c7b4957ed1d34f28e20e93", "committedDate": "2020-06-25T14:30:04Z", "message": "add licence headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "693966b80a00a841ed5ebc92e95feacb09a7145e", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/693966b80a00a841ed5ebc92e95feacb09a7145e", "committedDate": "2020-06-25T15:00:41Z", "message": "add LocalDateTimeHandlerTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDkwNjgy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#pullrequestreview-438090682", "createdAt": "2020-06-26T08:00:36Z", "commit": {"oid": "693966b80a00a841ed5ebc92e95feacb09a7145e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwODowMDozNlrOGpXfkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwODowMDozNlrOGpXfkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAyOTcxNQ==", "bodyText": "What is the reason of this change? How this string is used?\nSide note, are you sure type cannot be null?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#discussion_r446029715", "createdAt": "2020-06-26T08:00:36Z", "author": {"login": "danielezonca"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -95,10 +95,11 @@ public static String generateDomainSpecificDMNDashboard(String templatePath, Str\n                     jgrafana.addPanel(PanelType.GRAPH,\n                                       \"Decision \" + decision.getName(),\n                                       String.format(\"%s_dmn_result{endpoint = \\\"%s\\\", decision = \\\"%s\\\"}\",\n-                                                    type,\n+                                                    type.toString().replace(\" \", \"_\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693966b80a00a841ed5ebc92e95feacb09a7145e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fadd41622f6d39a4308ee956f6d3b7df2b03da08", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/fadd41622f6d39a4308ee956f6d3b7df2b03da08", "committedDate": "2020-06-26T09:09:26Z", "message": "add Duration type support, refactoring quantiles tests with abstract class, add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88509584c17494d2b87404807a0d3529b89943e", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/a88509584c17494d2b87404807a0d3529b89943e", "committedDate": "2020-06-26T09:10:18Z", "message": "add licence header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398e29e17fc5c8e1cd24802806176770147b193c", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/398e29e17fc5c8e1cd24802806176770147b193c", "committedDate": "2020-06-26T09:15:23Z", "message": "optimize imports and code, remove duplicated code with constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "922254290705c15111eaf48ed593bd59e0019b3d", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/922254290705c15111eaf48ed593bd59e0019b3d", "committedDate": "2020-06-26T14:10:29Z", "message": "add support for years and months duration + add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "087b45ac518ac520c0cbc15509117144901dde45", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/087b45ac518ac520c0cbc15509117144901dde45", "committedDate": "2020-06-29T15:10:41Z", "message": "add date and time handlers and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6def3231b29a2dcd34a74643426c7d830c90ee06", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6def3231b29a2dcd34a74643426c7d830c90ee06", "committedDate": "2020-06-30T07:34:22Z", "message": "Refactoring type handling with abstract class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da713f5ac3d51f3f06645141671f0228ceb3eef9", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/da713f5ac3d51f3f06645141671f0228ceb3eef9", "committedDate": "2020-06-30T07:35:09Z", "message": "rename initializeDefaultSummary method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a654ceeea128d84f5c69af6927d6a2b89d1122", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/e0a654ceeea128d84f5c69af6927d6a2b89d1122", "committedDate": "2020-06-30T08:17:25Z", "message": "refactoring localTime and localDate grafana functions, add licence headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d4ff2c1ff587c329632c3701483b69ce42bb875", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/9d4ff2c1ff587c329632c3701483b69ce42bb875", "committedDate": "2020-06-30T11:24:02Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODQ5NDEx", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#pullrequestreview-439849411", "createdAt": "2020-06-30T09:43:32Z", "commit": {"oid": "e0a654ceeea128d84f5c69af6927d6a2b89d1122"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwOTo0MzozM1rOGq0iHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwOTo0Mzo0OFrOGq0iuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1NDA3OQ==", "bodyText": "Please use lower letter at the beginning of the method.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#discussion_r447554079", "createdAt": "2020-06-30T09:43:33Z", "author": {"login": "jiripetrlik"}, "path": "addons/monitoring-prometheus-addon/src/test/java/org/kie/kogito/monitoring/integration/LocalDateTimeHandlerTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.monitoring.integration;\n+\n+import java.time.LocalDateTime;\n+import java.time.ZoneOffset;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.DecisionConstants;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.LocalDateTimeHandler;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class LocalDateTimeHandlerTest extends AbstractQuantilesTest<LocalDateTimeHandler> {\n+\n+    @BeforeEach\n+    public void setUp() {\n+        registry = new CollectorRegistry();\n+        handler = new LocalDateTimeHandler(\"hello\", registry);\n+    }\n+\n+    @AfterEach\n+    public void destroy() {\n+        registry.clear();\n+    }\n+\n+    @Test\n+    public void GivenLocalDateTimeMetrics_WhenMetricsAreStored_ThenTheQuantilesAreCorrect() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0a654ceeea128d84f5c69af6927d6a2b89d1122"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1NDE2MQ==", "bodyText": "Please use lower letter at the beginning of the method.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#discussion_r447554161", "createdAt": "2020-06-30T09:43:41Z", "author": {"login": "jiripetrlik"}, "path": "addons/monitoring-prometheus-addon/src/test/java/org/kie/kogito/monitoring/integration/LocalTimeHandlerTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.monitoring.integration;\n+\n+import java.time.LocalTime;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.DecisionConstants;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.LocalTimeHandler;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class LocalTimeHandlerTest extends AbstractQuantilesTest<LocalTimeHandler> {\n+\n+    @BeforeEach\n+    public void setUp() {\n+        registry = new CollectorRegistry();\n+        handler = new LocalTimeHandler(\"hello\", registry);\n+    }\n+\n+    @AfterEach\n+    public void destroy() {\n+        registry.clear();\n+    }\n+\n+    @Test\n+    public void GivenLocalTimeMetrics_WhenMetricsAreStored_ThenTheQuantilesAreCorrect() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0a654ceeea128d84f5c69af6927d6a2b89d1122"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU1NDIzMg==", "bodyText": "Please use lower letter at the beginning of the method.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#discussion_r447554232", "createdAt": "2020-06-30T09:43:48Z", "author": {"login": "jiripetrlik"}, "path": "addons/monitoring-prometheus-addon/src/test/java/org/kie/kogito/monitoring/integration/YearsAndMonthsDurationHandlerTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.monitoring.integration;\n+\n+import java.time.Period;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.DecisionConstants;\n+import org.kie.kogito.monitoring.system.metrics.dmnhandlers.YearsAndMonthsDurationHandler;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class YearsAndMonthsDurationHandlerTest extends AbstractQuantilesTest<YearsAndMonthsDurationHandler> {\n+\n+    @BeforeEach\n+    public void setUp() {\n+        registry = new CollectorRegistry();\n+        handler = new YearsAndMonthsDurationHandler(\"hello\", registry);\n+    }\n+\n+    @AfterEach\n+    public void destroy() {\n+        registry.clear();\n+    }\n+\n+    @Test\n+    public void GivenYearsAndMonthsMetrics_WhenMetricsAreStored_ThenTheQuantilesAreCorrect() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0a654ceeea128d84f5c69af6927d6a2b89d1122"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f34bda899d3e154dc3625d7650b99dd7a1bfbbc7", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/f34bda899d3e154dc3625d7650b99dd7a1bfbbc7", "committedDate": "2020-06-30T13:44:21Z", "message": "rename test names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b651a433ac2e0cf344de01b6cb8d7064acff3d4a", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/b651a433ac2e0cf344de01b6cb8d7064acff3d4a", "committedDate": "2020-06-30T15:39:35Z", "message": "Merge remote-tracking branch 'upstream/master' into KOGITO-2532-support-multiple-dmn-built-in-types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7706eb4641fc88daf0535c216c91845567cfdff", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/b7706eb4641fc88daf0535c216c91845567cfdff", "committedDate": "2020-07-01T08:37:21Z", "message": "fix grafana yaxes test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzk0NjMw", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#pullrequestreview-440394630", "createdAt": "2020-06-30T21:20:38Z", "commit": {"oid": "b651a433ac2e0cf344de01b6cb8d7064acff3d4a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMToyMDozOVrOGrO5xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMToyMDozOVrOGrO5xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk4NjExOQ==", "bodyText": "What about use an interface instead with initializeDefaultSummary as default method?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#discussion_r447986119", "createdAt": "2020-06-30T21:20:39Z", "author": {"login": "danielezonca"}, "path": "addons/monitoring-prometheus-addon/src/main/java/org/kie/kogito/monitoring/system/metrics/dmnhandlers/TypeHandlerWithSummary.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.monitoring.system.metrics.dmnhandlers;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Summary;\n+\n+public abstract class TypeHandlerWithSummary<T> implements TypeHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b651a433ac2e0cf344de01b6cb8d7064acff3d4a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06783628ee6b444be05e3e8b74081402401130a1", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/06783628ee6b444be05e3e8b74081402401130a1", "committedDate": "2020-07-01T12:13:43Z", "message": "make TypeHandlerWithSummary an interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee09df2eb41d5eac8e40e52a78b3be3f5c8e0460", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/ee09df2eb41d5eac8e40e52a78b3be3f5c8e0460", "committedDate": "2020-07-03T07:09:22Z", "message": "Merge remote-tracking branch 'upstream/master' into KOGITO-2532-support-multiple-dmn-built-in-types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMzAyMDAx", "url": "https://github.com/kiegroup/kogito-runtimes/pull/587#pullrequestreview-442302001", "createdAt": "2020-07-03T10:03:07Z", "commit": {"oid": "ee09df2eb41d5eac8e40e52a78b3be3f5c8e0460"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4191, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}