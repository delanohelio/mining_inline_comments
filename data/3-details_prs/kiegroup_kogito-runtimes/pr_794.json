{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1Mzg5MTIz", "number": 794, "title": "[KOGITO-3495] Error handling on RestworkItemhandler", "bodyText": "If rest invocation failed, workitem will be aborted.", "createdAt": "2020-09-30T09:51:42Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794", "merged": true, "mergeCommit": {"oid": "3a99bca967cc19340652ebd2b29966c5ce02e18f"}, "closed": true, "closedAt": "2020-10-09T11:04:20Z", "author": {"login": "fjtirado"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN6HLTgBqjM4MjM3NzIwNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQzw3CgFqTUwNTU1Njk4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b44fa8e1a7aea141bed5e3ef7cb4320f68d12071", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/b44fa8e1a7aea141bed5e3ef7cb4320f68d12071", "committedDate": "2020-09-30T09:51:06Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}, "afterCommit": {"oid": "800dee1f7e166c900fe59b753907e58e450eb44b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/800dee1f7e166c900fe59b753907e58e450eb44b", "committedDate": "2020-09-30T10:20:14Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "800dee1f7e166c900fe59b753907e58e450eb44b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/800dee1f7e166c900fe59b753907e58e450eb44b", "committedDate": "2020-09-30T10:20:14Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}, "afterCommit": {"oid": "19f32f5af8ec9f64e0ffbbc5a40308f337d0b4aa", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/19f32f5af8ec9f64e0ffbbc5a40308f337d0b4aa", "committedDate": "2020-10-02T13:34:47Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTMxMTEw", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794#pullrequestreview-501131110", "createdAt": "2020-10-02T13:24:27Z", "commit": {"oid": "800dee1f7e166c900fe59b753907e58e450eb44b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoyNDoyN1rOHbtewg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDoyNFrOHbt1bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxODc1NA==", "bodyText": "Probably a better message would be welcome.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794#discussion_r498818754", "createdAt": "2020-10-02T13:24:27Z", "author": {"login": "MarianMacik"}, "path": "kogito-workitems/kogito-rest-workitem/src/main/java/org/kogito/workitem/rest/RestWorkItemHandler.java", "diffHunk": "@@ -87,28 +88,24 @@ public void executeWorkItem(WorkItem workItem, WorkItemManager manager) {\n         endPoint = resolvePathParams(endPoint, parameters, resolver);\n         URI uri = URI.create(endPoint);\n         String host = uri.getHost() != null ? uri.getHost() : hostProp;\n-        int port = uri.getPort() > 0? uri.getPort() : Integer.parseInt(portProp);\n+        int port = uri.getPort() > 0 ? uri.getPort() : Integer.parseInt(portProp);\n         HttpRequest<Buffer> request = client.request(method, port, host, uri.getPath());\n         if (user != null && !user.trim().isEmpty() && password != null && !password.trim().isEmpty()) {\n             request.basicAuthentication(user, password);\n         }\n         // execute request\n-         Handler<AsyncResult<HttpResponse<Buffer>>> handler = event -> \n-                manager\n-                .completeWorkItem(\n-                                  workItem.getId(),\n-                                  Collections\n-                                      .singletonMap(RESULT, resultHandler.apply(inputModel, event.result().bodyAsJsonObject())));\n+        Handler<AsyncResult<HttpResponse<Buffer>>> handler = event -> {\n+            if (event.cause() != null) {\n+                throw new WorkItemExecutionError(\"500\", event.cause());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "800dee1f7e166c900fe59b753907e58e450eb44b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyNDU1Nw==", "bodyText": "Probably more straightforward would be\nif (event.failed()) {\n    throw new WorkItemExecutionError(\"500\", event.cause());\n}", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794#discussion_r498824557", "createdAt": "2020-10-02T13:34:24Z", "author": {"login": "MarianMacik"}, "path": "kogito-workitems/kogito-rest-workitem/src/main/java/org/kogito/workitem/rest/RestWorkItemHandler.java", "diffHunk": "@@ -87,28 +88,24 @@ public void executeWorkItem(WorkItem workItem, WorkItemManager manager) {\n         endPoint = resolvePathParams(endPoint, parameters, resolver);\n         URI uri = URI.create(endPoint);\n         String host = uri.getHost() != null ? uri.getHost() : hostProp;\n-        int port = uri.getPort() > 0? uri.getPort() : Integer.parseInt(portProp);\n+        int port = uri.getPort() > 0 ? uri.getPort() : Integer.parseInt(portProp);\n         HttpRequest<Buffer> request = client.request(method, port, host, uri.getPath());\n         if (user != null && !user.trim().isEmpty() && password != null && !password.trim().isEmpty()) {\n             request.basicAuthentication(user, password);\n         }\n         // execute request\n-         Handler<AsyncResult<HttpResponse<Buffer>>> handler = event -> \n-                manager\n-                .completeWorkItem(\n-                                  workItem.getId(),\n-                                  Collections\n-                                      .singletonMap(RESULT, resultHandler.apply(inputModel, event.result().bodyAsJsonObject())));\n+        Handler<AsyncResult<HttpResponse<Buffer>>> handler = event -> {\n+            if (event.cause() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "800dee1f7e166c900fe59b753907e58e450eb44b"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19f32f5af8ec9f64e0ffbbc5a40308f337d0b4aa", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/19f32f5af8ec9f64e0ffbbc5a40308f337d0b4aa", "committedDate": "2020-10-02T13:34:47Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}, "afterCommit": {"oid": "fcfc5e638e52a328b1c41ab783d837374e7773d2", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/fcfc5e638e52a328b1c41ab783d837374e7773d2", "committedDate": "2020-10-02T14:21:20Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcfc5e638e52a328b1c41ab783d837374e7773d2", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/fcfc5e638e52a328b1c41ab783d837374e7773d2", "committedDate": "2020-10-02T14:21:20Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}, "afterCommit": {"oid": "0d3d61844ef2f4e6fd6b1d81da08b8c5fc4bb6a6", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/0d3d61844ef2f4e6fd6b1d81da08b8c5fc4bb6a6", "committedDate": "2020-10-06T08:31:15Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d3d61844ef2f4e6fd6b1d81da08b8c5fc4bb6a6", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/0d3d61844ef2f4e6fd6b1d81da08b8c5fc4bb6a6", "committedDate": "2020-10-06T08:31:15Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then exception is thrown"}, "afterCommit": {"oid": "fea7bd34ff274c63b2c2e3eb5ea2e795aae2271e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/fea7bd34ff274c63b2c2e3eb5ea2e795aae2271e", "committedDate": "2020-10-06T08:46:15Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then work item is aborted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868798935118f87569890765c2daf6a9d9c16a5c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/868798935118f87569890765c2daf6a9d9c16a5c", "committedDate": "2020-10-06T08:46:59Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then work item is aborted"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fea7bd34ff274c63b2c2e3eb5ea2e795aae2271e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/fea7bd34ff274c63b2c2e3eb5ea2e795aae2271e", "committedDate": "2020-10-06T08:46:15Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then work item is aborted"}, "afterCommit": {"oid": "868798935118f87569890765c2daf6a9d9c16a5c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/868798935118f87569890765c2daf6a9d9c16a5c", "committedDate": "2020-10-06T08:46:59Z", "message": "[KOGITO-3495] Error handling on RestworkItemhandler\n\nIf call fails, event will be null, then work item is aborted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MjU2Mzg1", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794#pullrequestreview-505256385", "createdAt": "2020-10-09T00:07:04Z", "commit": {"oid": "868798935118f87569890765c2daf6a9d9c16a5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NTU2OTg5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/794#pullrequestreview-505556989", "createdAt": "2020-10-09T10:38:33Z", "commit": {"oid": "868798935118f87569890765c2daf6a9d9c16a5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3987, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}