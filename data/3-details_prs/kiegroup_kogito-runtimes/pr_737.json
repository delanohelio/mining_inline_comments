{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDc1NDg4", "number": 737, "title": "[KOGITO-3222] Implement jpmml/trustypmml co-existence", "bodyText": "This PR depends on kiegroup/kie-jpmml-integration#40\n@danielezonca @tarilabs  @jiripetrlik\nsee https://issues.redhat.com/browse/KOGITO-3222\nThis PR\nAt compile time:\n\nverify the presence of \"jpmml\" in the classpath\nif jpmml is present, trusty-pmml compilaation is completely skipped\n\nAt runtime:\n\nif \"jpmml\" is present, DMN will use it for pmml evaluation\nif \"jpmml\" is present, no pmml endpoints will be generated (since trusty pmml compilation has completely been skipped)", "createdAt": "2020-09-01T13:18:15Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737", "merged": true, "mergeCommit": {"oid": "23d33b23acfc269e1aa3236aa8fb5d693d6facf4"}, "closed": true, "closedAt": "2020-09-09T13:50:43Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEnH8_gH2gAyNDc3MDc1NDg4OjMyNzUxYWM5NTYwNmM2YWU2MWJhNTU3ZGVhNjk3ODE0NjIyZmY4YWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHLNyLgH2gAyNDc3MDc1NDg4OjlhMGY2MGVkNGM1ZDgwM2UwM2MzMTVlZjFhOWQwNmIyNzQyN2NjNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "32751ac95606c6ae61ba557dea697814622ff8af", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/32751ac95606c6ae61ba557dea697814622ff8af", "committedDate": "2020-09-01T13:07:55Z", "message": "[KOGITO-3222] Implement jpmml/trustypmml co-existence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a933086d771c88d46fa828aeb5ea1f3a84b1f08", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/8a933086d771c88d46fa828aeb5ea1f3a84b1f08", "committedDate": "2020-09-01T15:19:59Z", "message": "[KOGITO-3222] Implement jpmml/trustypmml co-existence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/c4edb4708d1450d4203226f16bc1cbc19b338f24", "committedDate": "2020-09-02T07:09:18Z", "message": "[KOGITO-3222] Using Jandex to verify jpmml presence in quarkus. Completely disabling trusty-pmml if jpmml is present"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTA1NjAy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#pullrequestreview-480905602", "createdAt": "2020-09-02T14:54:42Z", "commit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNDo1NDo0MlrOHLzHoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNDo1NTowOVrOHLzJOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzMzkyMQ==", "bodyText": "Can you please add a log message?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r482133921", "createdAt": "2020-09-02T14:54:42Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -88,15 +90,23 @@ public PredictionCodegen(List<PMMLResource> resources) {\n         this.moduleGenerator = new PredictionContainerGenerator(applicationCanonicalName, resources);\n     }\n \n-    public static PredictionCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+    public static PredictionCodegen ofCollectedResources(boolean isJPMMLAvailable,\n+                                                         Collection<CollectedResource> resources) {\n+        if (isJPMMLAvailable) {\n+            return ofPredictions(Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzNDA1NQ==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r482134055", "createdAt": "2020-09-02T14:54:51Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -88,15 +90,23 @@ public PredictionCodegen(List<PMMLResource> resources) {\n         this.moduleGenerator = new PredictionContainerGenerator(applicationCanonicalName, resources);\n     }\n \n-    public static PredictionCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+    public static PredictionCodegen ofCollectedResources(boolean isJPMMLAvailable,\n+                                                         Collection<CollectedResource> resources) {\n+        if (isJPMMLAvailable) {\n+            return ofPredictions(Collections.emptyList());\n+        }\n         List<PMMLResource> dmnResources = resources.stream()\n                 .filter(r -> r.resource().getResourceType() == ResourceType.PMML)\n-                .flatMap(r -> parsePredictions(r.basePath(), Collections.singletonList(r.resource())).stream())\n+                .flatMap(r -> parsePredictions(r.basePath(),\n+                                               Collections.singletonList(r.resource())).stream())\n                 .collect(toList());\n         return ofPredictions(dmnResources);\n     }\n \n-    public static PredictionCodegen ofJar(Path... jarPaths) throws IOException {\n+    public static PredictionCodegen ofJar(boolean isJPMMLAvailable, Path... jarPaths) throws IOException {\n+        if (isJPMMLAvailable) {\n+            return ofPredictions(Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzNDE5Mw==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r482134193", "createdAt": "2020-09-02T14:54:59Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -119,7 +129,10 @@ public static PredictionCodegen ofJar(Path... jarPaths) throws IOException {\n         return ofPredictions(pmmlResources);\n     }\n \n-    public static PredictionCodegen ofPath(Path... paths) throws IOException {\n+    public static PredictionCodegen ofPath(boolean isJPMMLAvailable, Path... paths) throws IOException {\n+        if (isJPMMLAvailable) {\n+            return ofPredictions(Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEzNDMzMA==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r482134330", "createdAt": "2020-09-02T14:55:09Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -133,7 +146,10 @@ public static PredictionCodegen ofPath(Path... paths) throws IOException {\n         return ofPredictions(resources);\n     }\n \n-    public static PredictionCodegen ofFiles(Path basePath, List<File> files) {\n+    public static PredictionCodegen ofFiles(boolean isJPMMLAvailable, Path basePath, List<File> files) {\n+        if (isJPMMLAvailable) {\n+            return ofPredictions(Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4edb4708d1450d4203226f16bc1cbc19b338f24"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59089f36679eafc60349f8dd39d4acbabecf2cf4", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/59089f36679eafc60349f8dd39d4acbabecf2cf4", "committedDate": "2020-09-03T03:52:21Z", "message": "[KOGITO-3222] Logging usage of jpmml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b", "committedDate": "2020-09-03T03:52:29Z", "message": "Merge remote-tracking branch 'origin/master' into KOGITO-3222"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTA4Mzgw", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#pullrequestreview-481508380", "createdAt": "2020-09-03T05:45:46Z", "commit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MTc3NjEy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#pullrequestreview-484177612", "createdAt": "2020-09-08T14:07:57Z", "commit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDowNzo1OFrOHOe9NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDoxMDozMFrOHOfEcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk0OTMwMQ==", "bodyText": "I would advise merging #741 before. Most of these factory methods have been deleted for good", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r484949301", "createdAt": "2020-09-08T14:07:58Z", "author": {"login": "evacchi"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -88,15 +90,25 @@ public PredictionCodegen(List<PMMLResource> resources) {\n         this.moduleGenerator = new PredictionContainerGenerator(applicationCanonicalName, resources);\n     }\n \n-    public static PredictionCodegen ofCollectedResources(Collection<CollectedResource> resources) {\n+    public static PredictionCodegen ofCollectedResources(boolean isJPMMLAvailable,\n+                                                         Collection<CollectedResource> resources) {\n+        if (isJPMMLAvailable) {\n+            logger.info(\"jpmml libraries available on classpath, skipping kie-pmml parsing and compilation\");\n+            return ofPredictions(Collections.emptyList());\n+        }\n         List<PMMLResource> dmnResources = resources.stream()\n                 .filter(r -> r.resource().getResourceType() == ResourceType.PMML)\n-                .flatMap(r -> parsePredictions(r.basePath(), Collections.singletonList(r.resource())).stream())\n+                .flatMap(r -> parsePredictions(r.basePath(),\n+                                               Collections.singletonList(r.resource())).stream())\n                 .collect(toList());\n         return ofPredictions(dmnResources);\n     }\n \n-    public static PredictionCodegen ofJar(Path... jarPaths) throws IOException {\n+    public static PredictionCodegen ofJar(boolean isJPMMLAvailable, Path... jarPaths) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk0OTk2OQ==", "bodyText": "is the rest of this file just being reformatted or...?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r484949969", "createdAt": "2020-09-08T14:08:51Z", "author": {"login": "evacchi"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -198,14 +217,15 @@ public PredictionContainerGenerator moduleGenerator() {\n         if (resources.isEmpty()) {\n             return Collections.emptyList();\n         }\n-        ModelBuilderImpl<KogitoPackageSources> modelBuilder = new ModelBuilderImpl<>( KogitoPackageSources::dumpSources,\n-                new KnowledgeBuilderConfigurationImpl(getClass().getClassLoader()), new ReleaseIdImpl(\"dummy:dummy:0.0.0\"), true, false );\n+        ModelBuilderImpl<KogitoPackageSources> modelBuilder = new ModelBuilderImpl<>(KogitoPackageSources::dumpSources,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk1MDU5Nw==", "bodyText": "let's merge after 7.43.0 is Final", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r484950597", "createdAt": "2020-09-08T14:09:45Z", "author": {"login": "evacchi"}, "path": "kogito-build-parent/pom.xml", "diffHunk": "@@ -129,7 +129,8 @@\n     <version.org.keycloak>11.0.0</version.org.keycloak>\n     <version.org.mockito>3.3.3</version.org.mockito>\n     <version.org.mvel>2.4.7.Final</version.org.mvel>\n-    <version.org.kie7>7.43.0.t20200824</version.org.kie7>\n+<!--    <version.org.kie7>7.43.0.t20200824</version.org.kie7>-->\n+    <version.org.kie7>7.43.0-SNAPSHOT</version.org.kie7>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk1MTE1NA==", "bodyText": "all the remaining changes in this file are just whitespace changes right?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r484951154", "createdAt": "2020-09-08T14:10:30Z", "author": {"login": "evacchi"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java", "diffHunk": "@@ -198,14 +217,15 @@ public PredictionContainerGenerator moduleGenerator() {\n         if (resources.isEmpty()) {\n             return Collections.emptyList();\n         }\n-        ModelBuilderImpl<KogitoPackageSources> modelBuilder = new ModelBuilderImpl<>( KogitoPackageSources::dumpSources,\n-                new KnowledgeBuilderConfigurationImpl(getClass().getClassLoader()), new ReleaseIdImpl(\"dummy:dummy:0.0.0\"), true, false );\n+        ModelBuilderImpl<KogitoPackageSources> modelBuilder = new ModelBuilderImpl<>(KogitoPackageSources::dumpSources,\n+                                                                                     new KnowledgeBuilderConfigurationImpl(getClass().getClassLoader()), new ReleaseIdImpl(\"dummy:dummy:0.0.0\"), true, false);\n         CompositeKnowledgeBuilder batch = modelBuilder.batch();\n         for (PMMLResource resource : resources) {\n             List<KiePMMLModel> kiepmmlModels = resource.getKiePmmlModels();\n             for (KiePMMLModel model : kiepmmlModels) {\n                 if (model.getName() == null || model.getName().isEmpty()) {\n-                    String errorMessage = String.format(\"Model name should not be empty inside %s\", resource.getModelPath());\n+                    String errorMessage = String.format(\"Model name should not be empty inside %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjY4MzIy", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#pullrequestreview-484268322", "createdAt": "2020-09-08T15:40:48Z", "commit": {"oid": "faaacf0d4d7cfc51981ffd4618ea1ea68fa4077b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "553dc45ecc01182b1939ad4491af55bdf944f859", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/553dc45ecc01182b1939ad4491af55bdf944f859", "committedDate": "2020-09-09T09:01:26Z", "message": "Merge remote-tracking branch 'origin/master' into KOGITO-3222\n\n# Conflicts:\n#\tkogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java\n#\tkogito-codegen/src/test/java/org/kie/kogito/codegen/AbstractCodegenTest.java\n#\tkogito-codegen/src/test/java/org/kie/kogito/codegen/prediction/PredictionCodegenTest.java\n#\tkogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/GenerateModelMojo.java\n#\tkogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "473a4fb1d5be8eff6b9d395790145ad4d2802a12", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/473a4fb1d5be8eff6b9d395790145ad4d2802a12", "committedDate": "2020-09-09T09:50:14Z", "message": "[KOGITO-3222] Merged with master. Removing snapshot dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTQ0Nzc4", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#pullrequestreview-484944778", "createdAt": "2020-09-09T12:14:03Z", "commit": {"oid": "473a4fb1d5be8eff6b9d395790145ad4d2802a12"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoxNDowM1rOHPEaeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoxNDowM1rOHPEaeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2MzAwMQ==", "bodyText": "Why this new line?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/737#discussion_r485563001", "createdAt": "2020-09-09T12:14:03Z", "author": {"login": "jiripetrlik"}, "path": "drools/kogito-pmml/src/test/java/org/kie/kogito/pmml/PmmlPredictionModelTest.java", "diffHunk": "@@ -93,6 +94,7 @@ private static PMMLRuntime getPMMLRuntime() {\n             public PMML4Result evaluate(String s, PMMLContext pmmlContext) {\n                 return PMML_4_RESULT;\n             }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "473a4fb1d5be8eff6b9d395790145ad4d2802a12"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0f60ed4c5d803e03c315ef1a9d06b27427cc41", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/9a0f60ed4c5d803e03c315ef1a9d06b27427cc41", "committedDate": "2020-09-09T12:18:43Z", "message": "[KOGITO-3222] Removed empty line"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4156, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}